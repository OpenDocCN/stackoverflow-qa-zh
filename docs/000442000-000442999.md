# StackOverflow 问答 000442000-000442999

# datagridview - 如何让我的控件在 DataGridView 关闭我的控件之前检测到 Escape 键？

> ID：442009
> 
> 赞同：2
> 
> 时间：2009-01-14T05:27:01.017
> 
> 标签：datagridview, escaping, undo

我有一个具有撤消功能的控件，当用户按下 Escape 时，控件将恢复原始值。

问题是当我将控件集成到 DataGridView 时。DataGridView “吃掉” Escape 键，因此我的控件无法检测到 Escape 键。

当我在 EditingControlWantsInputKey 上设置“return true”时，我的控件能够检测到 Escape 键，但出现了其他问题，DataGridView 无法关闭我的控件，它停留在 EditMode。

如何让我的控件检测 Escape 键同时还允许 DataGridView 关闭我的控件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T06:39:58.547

我能够解决我自己的问题。我公开了我的**LookupBox的****Undo**方法，然后在我的 DataGridView 控件（**类 DgvLookupBoxEditingControl : LookupBox, IDataGridViewEditingControl**）上，我输入了以下代码：

 ****```
 protected override bool ProcessCmdKey(ref Message msg, Keys keyData)
    {
        if (keyData == Keys.Escape)            
            this.Undo();            

        return base.ProcessCmdKey(ref msg, keyData);

    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T05:40:01.117

仅当 Keys.KeyCode == Keys.Escape; 时才应“返回 true”；
否则返回 !dataGridViewWantsInputKey。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-07-21T20:51:47.550

或者您可以将 PreviewKeyDown 处理程序添加到您的编辑控件并在那里检测 Escape。

```
 dataGridView1.EditingControlShowing += (o, e) => {

            if(e.Control is DataGridViewTextBoxEditingControl)
            {                 
                var editBox = e.Control as DataGridViewTextBoxEditingControl;
                editBox.PreviewKeyDown += KeyPressHandler;
            } 
```

# zsh - 在 zsh 中，如何将匿名数组传递给函数？

> ID：442012
> 
> 赞同：8
> 
> 时间：2009-01-14T05:28:23.200
> 
> 标签：zsh

在 zsh 中，如何将匿名数组传递给函数？例如寻找类似的东西：

```
foo() {
  echo ${1[2]} '\n';
}

a=(abc def ghi)
foo $a

--> def 
```

或者理想情况下：

```
foo (abc def ghi) 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2013-02-04T19:09:09.073

您可以将数组的*名称*传递给函数，然后函数可以通过将名称解释为变量名称来读取数组。这种技术对于 bash 中的关联数组之类的东西也很有用。ZSH 使它很容易做到，因为 (P) 运算符将以所需的方式解释变量。

一个例子可以说明这一点。如果你定义这个函数：

```
function i_want_array () {
    local array_name=$1

    echo "first array element is: " ${(P)${array_name}[1]}
} 
```

然后下面的代码将执行它：

```
% a=(one two three)
% i_want_array "a"
first array element is:  one 
```

澄清一下，这是通过对真实数组进行操作来实现的，因此可以正确处理任何空格：

```
% a=("one two" three)
% i_want_array "a"
first array element is:  one two 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-08-24T21:18:06.363

你不能。函数像任何其他命令一样采用位置参数。

另请注意，您的解决方法不允许任何“数组”元素包含空格。

我能想到的最干净的事情是要求调用者创建一个本地数组，然后从函数中读取它：

```
$ foo() {
   for element in $FOO_ARRAY
   do
       echo "[$element]"
   done
}
$ local FOO_ARRAY; FOO_ARRAY=(foo bar baz quux)
$ foo
[foo]
[bar]
[baz]
[quux] 
```

我知道 bash 为其完成系统做了类似的杂技，我认为 zsh 也可能。这不是太不寻常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-01-22T12:37:56.270

没有用匿名数组解决......但我试过这个东西！重击！...

```
function join {
  local tmp=($1)

  for (( i=0 ; i<${#tmp[@]}-1 ; i++ )) ; do
    echo -n ${tmp[$i]}$2
  done

  echo ${tmp[$i]}
}

test="abc def ghi"

join "$test" "|" 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-07-24T20:42:18.967

如果只需要一个数组参数：作为尾参数。

```
foo() {
  : if you have any leading non-array args, grab those first:
  local arg1="$1"
  shift
  local arg2="$1"
  shift
  : now $@ is your array arg
  echo $@[2] '\n';
}

a=(abc def ghi)
foo "arg 1" arg2 $a

--> def 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-01-14T08:11:10.110

想出了一个解决方法：

```
foo() {
  local a=$1
  local b=$2

  echo ${(j:---:)${=b}}

  foreach d in ${${=b}}
  do
      echo $d
  done
} 
```

其中 parameter2 是一串白色分隔的文本，例如 'a badkljf odod'

# timezone - 如何枚举 .NET 中的所有时区？

> ID：442019
> 
> 赞同：27
> 
> 时间：2009-01-14T05:35:25.680
> 
> 标签：timezone

我想要一个 Windows 机器上所有可用时区的列表。我怎样才能在.NET 中做到这一点？

我知道 TimeZoneInfo.GetSystemTimeZones 方法，但这仅返回当前选择的时区

```
DateTimeOffset current = DateTimeOffset.Now;
ReadOnlyCollection<TimeZoneInfo> timeZones = TimeZoneInfo.GetSystemTimeZones();
Console.WriteLine("You might be in the following time zones:");
foreach (TimeZoneInfo timeZoneInfo in timeZones)
{
   // Compare offset with offset for that date in that time zone
   if (timeZoneInfo.GetUtcOffset(current).Equals(current.Offset))
   {
        Console.WriteLine("   {0}", timeZoneInfo.DisplayName);
   }
} 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-01-14T05:58:17.663

不，它不会返回 Windows 机器知道的每个时区（在我的安装中，它是 91）。您在那里的`if`陈述是限制您的输出的原因。把它去掉但留下`Console.WriteLine`部分，你会看到所有 91 个（或更多）时区。

例如

```
ReadOnlyCollection<TimeZoneInfo> timeZones = TimeZoneInfo.GetSystemTimeZones();

foreach (TimeZoneInfo timeZoneInfo in timeZones)
  Console.WriteLine("{0}", timeZoneInfo.DisplayName); 
```

这应该在您的控制台上写出 91 个时区。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-14T06:29:55.680

你的代码对我来说很好。这是我盒子上的输出：

> 您可能处于以下时区： (GMT) 卡萨布兰卡 (GMT)
> 格林威治标准时间：都柏林、
> 爱丁堡、里斯本、伦敦 (GMT)
> 蒙罗维亚、雷克雅未克

这就是目前具有相同偏移量的所有那些，这就是您的代码清楚显示的内容 - 如果您想要*所有*时区，只需删除“if”部分，正如罗伯特所说。

如果您认为应该看到更多区域，您能否告诉我们您所在的时区，以便我们确定应该显示哪些其他时区？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-01-07T06:39:25.387

该方法用于绑定 Dev express Drop Down 中的所有时区。我希望它对某人有所帮助。

```
private void FillTimeZone(ASPxComboBox ddlTimeZone)
{   
   ddlTimeZone.DataSource = TimeZoneInfo.GetSystemTimeZones();   
   ddlTimeZone.DataBind();  
   ListEditItem oListEditItem=new ListEditItem();   
   oListEditItem.Text=Helper.SELECT;   
   oListEditItem.Value=Helper.SELECT;   
   ddlTimeZone.Items.Add(oListEditItem);   
   ddlTimeZone.SelectedIndex = 0;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-07-13T15:30:59.850

如果想要来自 WebAPI 调用的 json 输出：

```
using System;
using System.Collections.Generic;

namespace MyProject.ViewModels
{
    public class TimeZoneViewModel
    {
        public readonly List<CTimeZone> CTimeZones;

        public TimeZoneViewModel()
        {
            CTimeZones = new List<CTimeZone>();
            foreach (TimeZoneInfo z in TimeZoneInfo.GetSystemTimeZones())
            {
                var tz = new CTimeZone(z.Id, z.DisplayName, z.BaseUtcOffset);
                CTimeZones.Add(tz);
            }
        }

    }

    public class CTimeZone
    {
        public string Id { get; set; }
        public string DisplayName { get; set; }
        public TimeSpan BaseUtcOffset { get; set; }

        public CTimeZone(string id, string displayName, TimeSpan utcOffset)
        {
            Id = id;
            DisplayName = displayName;
            BaseUtcOffset = utcOffset;
        }
    }
} 
```

然后在 WebAPI 中使用它：

```
[HttpGet("Api/TimeZones")]
public JsonResult GetTimeZones()
{
    return Json(new TimeZoneViewModel().CTimeZones);
} 
```

输出：

```
[{
    "id": "Dateline Standard Time",
    "displayName": "(UTC-12:00) International Date Line West",
    "baseUtcOffset": "-12:00:00"
  },
  {
    "id": "UTC-11",
    "displayName": "(UTC-11:00) Coordinated Universal Time-11",
    "baseUtcOffset": "-11:00:00"
  },
  {
    "id": "Aleutian Standard Time",
    "displayName": "(UTC-10:00) Aleutian Islands",
    "baseUtcOffset": "-10:00:00"
  },
  {
    "id": "Hawaiian Standard Time",
    "displayName": "(UTC-10:00) Hawaii",
    "baseUtcOffset": "-10:00:00"
  },... 
```

# c# - 如何在 C# 中构建一个线程化的评论系统？帮助

> ID：442022
> 
> 赞同：1
> 
> 时间：2009-01-14T05:36:35.880
> 
> 标签：c#, list, nested-sets, threaded-comments

我正在为我的一个网站构建一个线程评论系统，我遇到了一个问题......

我有一个从具有 ID 字段和父 ID 字段的数据库中提取的列表。父 ID 字段可以为空，但 ID 字段永远不会为空。

由于这将是一个线程评论系统，我将列表组织到 ID 位于顶部的位置，但如果存在父 ID，则它将插入到 ID 下。然后这也可以无限进行。所以第二级现在也有一个 ID，我想在它下面插入任何具有该 ID 的父 ID 的项目。

例如：

---1。废话

--------2。Blah Blah -> ParentID=1

------------ 3。Blah Blah -> parentID=2

-------------- 4\. Blah Blah ->parentID=3

----------- 3.Blah Blah -> parentID=2

--------2。Blah Blah -> parentID=1

我认为你说对了。

所以这就是我到目前为止所拥有的......

```
List<comment> finalList = new List<comment>();
    for (int i = 0; i < getComments.Count(); i++)
    {
        string item = getComments[i].parentComment;
        getComments[i].threadID = 1;
        finalList.Add(getComments[i]);
        for (int ii = 0; ii < getComments.Count(); ii++)
        {
            if (getComments[ii].commentID == item)
            {
                getComments[ii].threadID = 2;
                finalList.Add(getComments[i]);
            }
        }
    } 
```

它似乎对它进行了一半排序，但不是真正的...... ThreadID 当然是它被种植到右边的距离。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T07:10:22.463

鉴于您使用的是 Count() 扩展方法而不是 Count 属性（这本身就有点效率低下；尽管开始使用 foreach 会更好），您可能正在使用 .NET 3.5。

我不认为我完全理解您的方案 - 例如，您的图表中带有 threadID=4 的注释在第一个 threadID=3 元素而不是第二个元素下有什么说法？

在不了解您所追求的详细信息的情况下，通常我会考虑使用以下注释数据结构：

*   CommentID：这个实体的ID
*   RootID：线程的根元素的 ID（因此您可以轻松获取线程的所有评论）
*   ParentID：此评论的父级的 CommentID，如果是根元素，则为 null
*   时间戳：或其他允许对一个父级中的子评论进行适当排序的东西。

鉴于此，如果这是您所关心的，那么计算缩进级别将相当容易。如果这听起来有用，我可以详细说明 - 如果没有，请澄清问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T15:42:59.650

谢谢大家的帮助。我很感激。

不过，我确实找到了一个完全为它写了一切的人的东西。

[http://www.scip.be/index.php?Page=ArticlesNET23](http://www.scip.be/index.php?Page=ArticlesNET23)

[http://www.scip.be/index.php?Page=ArticlesNET09](http://www.scip.be/index.php?Page=ArticlesNET09)

[http://www.scip.be/index.php?Page=ArticlesNET18](http://www.scip.be/index.php?Page=ArticlesNET18)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T05:46:31.993

您需要一个递归函数，并且根据您遍历列表的样子，存储 ID 和 ChildID（而不是父 ID）可能会更好。这样递归函数可以在 ChildID == null 时结束遍历。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T12:40:50.407

这可能有效：

```
class Program
    {
        static void Main(string[] args)
        {
            CommentCollection collection=new CommentCollection();
            Comment c1=new Comment("Blah",1,0,collection);
            Comment c2=new Comment("Blah blah",2,1,collection);
            Comment c3=new Comment("Blah blah", 3, 2, collection);
            Console.WriteLine(collection);
        }
    }
    [DebuggerDisplay("{id}-{parentId}: {text}")]
    class Comment:IEnumerable<Comment>
    {
        private readonly CommentCollection collection;
        private readonly int parentId;

        public Comment(string text, int id, int parentId, CommentCollection collection)
        {
            Id = id;
            this.parentId = parentId;
            collection.Add(this);
            this.collection = collection;
            this.text = text;
        }
        public Comment Parent
        {
            get
            {
                if (parent == null)
                {
                    parent = parentId == 0 ? null : collection[parentId];
                }
                return parent;
            }
        }

        private Comment parent;
        private readonly string text;
        public int Id{ get; private set;}
        public IEnumerator<Comment> GetEnumerator()
        {
            return collection.Where(c => c.Parent == this).GetEnumerator();
        }

        IEnumerator IEnumerable.GetEnumerator()
        {
            return GetEnumerator();
        }
        public int Level
        {
            get { return Parent == null ? 0 : Parent.Level + 1; }
        }
        public override string ToString()
        {
            return Parent == null ? text : Parent + " > " + text;
        }
        public string ToString(bool tree)
        {
            if (!tree)
            {
                return ToString();
            }
            else
            {
                StringBuilder output = new StringBuilder();
                output.AppendLine(new string(' ', Level) + ToString(false));
                foreach (Comment comment in this)
                {
                    output.AppendLine(comment.ToString(true));
                }
                return output.ToString();
            }
        }
    }
    class CommentCollection:IEnumerable<Comment>
    {
        public void Add(Comment comment)
        {
            comments.Add(comment.Id,comment);
        }
        public Comment this[int id]
        {
            get { return comments[id]; }
        }
        private readonly Dictionary<int,Comment> comments=new Dictionary<int, Comment>();

        public IEnumerator<Comment> GetEnumerator()
        {
            return comments.Select(p => p.Value).GetEnumerator();
        }

        public IEnumerable<Comment> GetTopLevel()
        {
            return comments.Where(c => c.Value.Parent == null).
                Select(c => c.Value);
        }

        IEnumerator IEnumerable.GetEnumerator()
        {
            return GetEnumerator();
        }
        public override string ToString()
        {
            StringBuilder output=new StringBuilder();
            foreach (Comment comment in GetTopLevel())
            {
                output.AppendLine(comment.ToString(true));
            }
            return output.ToString();
        }
    } 
```

# programming-languages - 返回类型的函数重载？

> ID：442026
> 
> 赞同：265
> 
> 时间：2009-01-14T05:38:05.037
> 
> 标签：programming-languages, language-design, overloading, function-calls

为什么更多主流静态类型语言不支持返回类型的函数/方法重载？我想不出有什么办法。它似乎与支持参数类型的重载一样有用或合理。怎么人气这么低？

* * *

## 回答 #1

> 赞同：536
> 
> 时间：2009-01-14T08:33:16.290

与其他人所说的相反，通过返回类型重载**是**可能的，并且**由**一些现代语言完成。通常的反对意见是在代码中

```
int func();
string func();
int main() { func(); } 
```

你不知道哪个`func()`被调用。这可以通过以下几种方式解决：

1.  有一个可预测的方法来确定在这种情况下调用哪个函数。
2.  每当发生这种情况时，它就是一个编译时错误。但是，具有允许程序员消除歧义的语法，例如`int main() { (string)func(); }`.
3.  不要有副作用。如果您没有副作用并且从不使用函数的返回值，那么编译器可以避免一开始就调用该函数。

我经常（[ab](https://stackoverflow.com/questions/23930/factorial-algorithms-in-different-languages?answer=441229#441229)）按返回类型使用重载的两种语言：**Perl**和**Haskell**。让我描述一下他们的工作。

在**Perl中，***标量*和*列表*上下文（以及其他，但我们假设有两个）之间存在根本区别。Perl 中的每个内置函数都可以根据调用它的*上下文执行不同的操作。*例如，`join`运算符强制列表上下文（在被连接的事物上），而`scalar`​​运算符强制标量上下文，所以比较：

```
print join " ", localtime(); # printed "58 11 2 14 0 109 3 13 0" for me right now
print scalar localtime(); # printed "Wed Jan 14 02:12:44 2009" for me right now. 
```

Perl 中的每个运算符都在标量上下文中执行某些操作，在列表上下文中执行某些操作，并且它们可能不同，如图所示。（这不仅适用于像`localtime`. ) 此外，每个运算符都可以*强制*一个上下文，例如加法强制标量上下文。每个条目都记录了这一点。例如，这里是条目的一部分：`@a``print @a``print 0+@a`*`+``man perlfunc``glob EXPR`*

 *> 在列表上下文中，返回一个（可能为空的）文件名扩展列表，`EXPR`例如标准 Unix shell的值`/bin/csh`。在标量上下文中，glob 遍历此类文件名扩展，当列表用完时返回 undef。

现在，列表和标量上下文之间的关系是什么？嗯，`man perlfunc`说

> 请记住以下重要规则：没有规则将列表上下文中的表达式行为与其在标量上下文中的行为相关联，反之亦然。它可能会做两件完全不同的事情。每个运算符和函数决定在标量上下文中返回哪种值最合适。一些运算符返回在列表上下文中返回的列表长度。一些运算符返回列表中的第一个值。一些运算符返回列表中的最后一个值。一些运算符返回成功​​操作的计数。一般来说，他们做你想做的事，除非你想要一致性。

所以不是一个简单的函数，然后你在最后做简单的转换。事实上，我选择这个`localtime`例子就是出于这个原因。

不仅仅是内置函数有这种行为。任何用户都可以使用 定义这样的函数`wantarray`，它允许您区分列表、标量和 void 上下文。因此，例如，如果您在 void 上下文中被调用，您可以决定什么都不做。

现在，您可能会抱怨这不是*真正*的返回值重载，因为您只有一个函数，它被告知调用它的上下文，然后根据该信息进行操作。然而，这显然是等价的（类似于 Perl 不允许通常的重载，但函数可以只检查它的参数）。此外，它很好地解决了本回复开头提到的模棱两可的情况。Perl 不会抱怨它不知道调用哪个方法。它只是调用它。它所要做的就是找出调用函数的上下文，这总是可能的：

```
sub func {
    if( not defined wantarray ) {
        print "void\n";
    } elsif( wantarray ) {
        print "list\n";
    } else {
        print "scalar\n";
    }
}

func(); # prints "void"
() = func(); # prints "list"
0+func(); # prints "scalar" 
```

（注意：当我指的是函数时，我有时可能会说 Perl 运算符。这对于本次讨论并不重要。）

**Haskell**采用另一种方法，即没有副作用。它还具有强大的类型系统，因此您可以编写如下代码：

```
main = do n <- readLn
          print (sqrt n) -- note that this is aligned below the n, if you care to run this 
```

此代码从标准输入读取浮点数，并打印其平方根。但这有什么令人惊讶的呢？嗯，类型`readLn`是`readLn :: Read a => IO a`。这意味着对于任何可能的类型`Read`（正式地，作为类型类的实例的每个`Read`类型）`readLn`都可以读取它。Haskell 是如何知道我想读取浮点数的？好吧，`sqrt`is的类型`sqrt :: Floating a => a -> a`，本质上意味着它`sqrt`只能接受浮点数作为输入，所以 Haskell 推断出我想要的。

当 Haskell 无法推断出我想要什么时会发生什么？嗯，有几种可能性。如果我根本不使用返回值，Haskell 根本不会首先调用该函数。但是，如果我*确实*使用了返回值，那么 Haskell 会抱怨它无法推断类型：

```
main = do n <- readLn
          print n
-- this program results in a compile-time error "Unresolved top-level overloading" 
```

我可以通过指定我想要的类型来解决歧义：

```
main = do n <- readLn
          print (n::Int)
-- this compiles (and does what I want) 
```

无论如何，整个讨论的意思是通过返回值重载是可能的并且已经完成，这回答了您的部分问题。

您问题的另一部分是为什么更多的语言不这样做。我会让其他人回答这个问题。但是，有几点评论：主要原因可能是这里混淆的机会确实比参数类型重载要大。您还可以查看各个语言的基本原理：

[Ada](http://archive.adaic.com/standards/83rat/html/ratl-11-05.html)：“看起来最简单的重载解析规则是使用所有内容（来自尽可能广泛的上下文的所有信息）来解析重载引用。这条规则可能很简单，但没有帮助。它需要人工阅读扫描任意大的文本，并做出任意复杂的推论（例如上面的（g））。我们认为更好的规则是明确说明人类阅读器或编译器必须执行的任务，并使该任务对人类读者来说尽可能自然。”

C ++（Bjarne Stroustrup 的“C++ 编程语言”的第 7.4.1 小节）：“在重载解析中不考虑返回类型。原因是保持单个运算符或函数调用的解析与上下文无关。考虑：

```
float sqrt(float);
double sqrt(double);

void f(double da, float fla)
{
    float fl = sqrt(da);     // call sqrt(double)
    double d = sqrt(da); // call sqrt(double)
    fl = sqrt(fla);            // call sqrt(float)
    d = sqrt(fla);             // call sqrt(float)
} 
```

如果考虑到返回类型，就不再可能`sqrt()`孤立地查看调用并确定调用了哪个函数。”（注意，为了比较，在 Haskell 中没有*隐式*转换。）

Java（[Java 语言规范 9.4.1](https://docs.oracle.com/javase/specs/jls/se11/html/jls-9.html#jls-9.4.1.3)）：“其中一个继承的方法必须可以返回类型替代所有其他继承的方法，否则会发生编译时错误。” （是的，我知道这并没有给出理由。我确信 Gosling 在“Java 编程语言”中给出了理由。也许有人有副本？我敢打赌它本质上是“最少意外原则”。 ) 然而，关于 Java 的有趣事实：JVM*允许*通过返回值重载！例如，这在[Scala](http://www.drmaciver.com/2008/08/a-curious-fact-about-overloading-in-scala/)中使用，并且可以[通过 Java 直接](http://today.java.net/pub/a/today/2008/07/31/return-type-based-method-overloading.html)访问，也可以通过玩内部结构来访问。

PS。最后一点，实际上可以通过 C++ 中的返回值通过技巧来重载。见证：

```
struct func {
    operator string() { return "1";}
    operator int() { return 2; }
};

int main( ) {
    int x    = func(); // calls int version
    string y = func(); // calls string version
    double d = func(); // calls int version
    cout << func() << endl; // calls int version
    func(); // calls neither
} 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-01-14T06:27:18.103

如果函数被返回类型重载并且你有这两个重载

```
int func();
string func(); 
```

在看到这样的调用时，编译器无法确定要调用这两个函数中的哪一个

```
void main() 
{
    func();
} 
```

出于这个原因，语言设计者通常不允许返回值重载。

但是，某些语言（例如 MSIL）*确实*允许按返回类型进行重载。当然，他们也面临上述困难，但他们有解决方法，您必须查阅他们的文档。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-01-14T05:46:14.240

在这样的语言中，您将如何解决以下问题：

```
f(g(x)) 
```

if`f`有重载`void f(int)`and有重载`void f(string)`and ? 你需要某种消歧器。`g``int g(int)``string g(int)`

我认为通过为函数选择一个新名称可以更好地满足您可能需要它的情况。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-01-14T05:47:52.100

[从另一个非常相似的问题](https://stackoverflow.com/questions/249296/return-type-polymorphism-in-c-like-languages#249309)（欺骗？）中窃取 C++ 特定答案：

* * *

函数返回类型不会仅仅因为 Stroustrup（我假设来自其他 C++ 架构师的输入）希望重载决策是“上下文无关的”而在重载决议中发挥作用。请参阅“C++ 编程语言，第三版”中的 7.4.1 - “重载和返回类型”。

> 原因是保持单个运算符或函数调用的分辨率与上下文无关。

他们希望它只基于重载的调用方式——而不是结果的使用方式（如果它被使用的话）。事实上，许多函数在调用时不使用结果，或者结果将用作更大表达式的一部分。当他们决定这样做时，我肯定会发挥作用的一个因素是，如果返回类型是解决方案的一部分，则会有许多对重载函数的调用，这些函数需要使用复杂的规则来解决，或者必须让编译器抛出调用不明确的错误。

而且，天知道，C++ 重载解析就目前而言已经足够复杂了……

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-14T08:56:47.147

在 haskell 中，即使它没有函数重载也是可能的。Haskell 使用类型类。在一个程序中你可以看到：

```
class Example a where
    example :: Integer -> a

instance Example Integer where  -- example is now implemented for Integer
    example :: Integer -> Integer
    example i = i * 10 
```

函数重载本身并不那么流行。我见过的大多数语言是 C++，也许是 java 和/或 C#。在所有动态语言中，它是以下内容的简写：

```
define example:i
  ↑i type route:
    Integer = [↑i & 0xff]
    String = [↑i upper]

def example(i):
    if isinstance(i, int):
        return i & 0xff
    elif isinstance(i, str):
        return i.upper() 
```

因此，它没有多大意义。大多数人对语言是否可以帮助您在使用它的任何地方删除一行都不感兴趣。

模式匹配有点类似于函数重载，我想有时也有类似的工作方式。但它并不常见，因为它仅对少数程序有用，并且在大多数语言上实现起来很棘手。

您会看到还有无数其他更好更易于实现的功能可以在语言中实现，包括：

*   动态类型
*   对列表、字典和 Unicode 字符串的内部支持
*   优化（JIT、类型推断、编译）
*   集成部署工具
*   图书馆支持
*   社区支持和聚会场所
*   丰富的标准库
*   良好的语法
*   读取评估打印循环
*   支持反射式编程

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-11-18T23:29:05.237

好答案！特别是 A.Rex 的回答非常详细和有启发性。正如他所指出的，C++在编译时*确实*考虑了用户提供的类型转换运算符`lhs = func();` *（其中 func 实际上是结构的名称）*。我的解决方法有点不同 - 不是更好，只是不同（尽管它基于相同的基本思想）。

而我本来*想写*...

```
template <typename T> inline T func() { abort(); return T(); }

template <> inline int func()
{ <<special code for int>> }

template <> inline double func()
{ <<special code for double>> }

.. etc, then ..

int x = func(); // ambiguous!
int x = func<int>(); // *also* ambiguous!?  you're just being difficult, g++! 
```

我最终得到了一个使用参数化结构（T = 返回类型）的解决方案：

```
template <typename T>
struct func
{
    operator T()
    { abort(); return T(); } 
};

// explicit specializations for supported types
// (any code that includes this header can add more!)

template <> inline
func<int>::operator int()
{ <<special code for int>> }

template <> inline
func<double>::operator double()
{ <<special code for double>> }

.. etc, then ..

int x = func<int>(); // this is OK!
double d = func<double>(); // also OK :) 
```

此解决方案的一个好处是，任何包含这些模板定义的代码都可以为更多类型添加更多特化。您也可以根据需要对结构进行部分特化。例如，如果您想对指针类型进行特殊处理：

```
template <typename T>
struct func<T*>
{
    operator T*()
    { <<special handling for T*>> } 
}; 
```

作为否定，你不能`int x = func();`用我的解决方案写。你必须写`int x = func<int>();`。您必须明确说明返回类型是什么，而不是要求编译器通过查看类型转换运算符来确定它。我会说“我的”解决方案和 A.Rex 都属于解决这个 C++ 困境的[帕累托最优前沿:)](http://en.wikipedia.org/wiki/Pareto_efficiency#Pareto_frontier "一组非支配解")

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-05-30T10:03:49.327

如果您想重载具有不同返回类型的方法，只需添加一个**具有默认值的虚拟参数**以允许重载执行，但不要忘记参数类型应该不同，因此重载逻辑接下来起作用的是例如在 delphi 上：

```
type    
    myclass = class
    public
      function Funct1(dummy: string = EmptyStr): String; overload;
      function Funct1(dummy: Integer = -1): Integer; overload;
    end; 
```

像这样使用它

```
procedure tester;
var yourobject : myclass;
  iValue: integer;
  sValue: string;
begin
  yourobject:= myclass.create;
  iValue:= yourobject.Funct1(); //this will call the func with integer result
  sValue:= yourobject.Funct1(); //this will call the func with string result
end; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-08-04T09:08:42.780

如前所述 - 仅通过返回类型不同的函数的模棱两可调用会引入模棱两可。歧义会导致有缺陷的代码。必须避免有缺陷的代码。

试图模棱两可导致的复杂性表明这不是一个好的hack。除了智力练习之外 - 为什么不使用带有参考参数的程序。

```
procedure(reference string){};
procedure(reference int){};
string blah;
procedure(blah) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-12-15T21:03:35.307

如果您以稍微不同的方式看待它，那么这个重载功能并不难管理。考虑以下，

```
public Integer | String f(int choice){
if(choice==1){
return new string();
}else{
return new Integer();
}} 
```

如果一种语言确实返回重载，它将允许参数重载，但不允许重复。这将解决以下问题：

```
main (){
f(x)
} 
```

因为只有一个 f(int choice) 可供选择。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-05-10T20:25:01.230

在 .NET 中，有时我们使用一个参数来指示通用结果的所需输出，然后进行转换以获得我们期望的结果。

### C＃

```
public enum FooReturnType{
        IntType,
        StringType,
        WeaType
    }

    class Wea { 
        public override string ToString()
        {
            return "Wea class";
        }
    }

    public static object Foo(FooReturnType type){
        object result = null;
        if (type == FooReturnType.IntType) 
        {
            /*Int related actions*/
            result = 1;
        }
        else if (type == FooReturnType.StringType)
        {
            /*String related actions*/
            result = "Some important text";
        }
        else if (type == FooReturnType.WeaType)
        {
            /*Wea related actions*/
            result = new Wea();
        }
        return result;
    }

    static void Main(string[] args)
    {
        Console.WriteLine("Expecting Int from Foo: " + Foo(FooReturnType.IntType));
        Console.WriteLine("Expecting String from Foo: " + Foo(FooReturnType.StringType));
        Console.WriteLine("Expecting Wea from Foo: " + Foo(FooReturnType.WeaType));
        Console.Read();
    } 
```

也许这个例子也可以帮助：

### C++

```
 #include <iostream>

enum class FooReturnType{ //Only C++11
    IntType,
    StringType,
    WeaType
}_FooReturnType;

class Wea{
public:
    const char* ToString(){
        return "Wea class";
    }
};

void* Foo(FooReturnType type){
    void* result = 0;
    if (type == FooReturnType::IntType) //Only C++11
    {
        /*Int related actions*/
        result = (void*)1;
    }
    else if (type == FooReturnType::StringType) //Only C++11
    {
        /*String related actions*/
        result = (void*)"Some important text";
    }
    else if (type == FooReturnType::WeaType) //Only C++11
    {
        /*Wea related actions*/
        result = (void*)new Wea();
    }
    return result;
}

int main(int argc, char* argv[])
{
    int intReturn = (int)Foo(FooReturnType::IntType);
    const char* stringReturn = (const char*)Foo(FooReturnType::StringType);
    Wea *someWea = static_cast<Wea*>(Foo(FooReturnType::WeaType));
    std::cout << "Expecting Int from Foo: " << intReturn << std::endl;
    std::cout << "Expecting String from Foo: " << stringReturn << std::endl;
    std::cout << "Expecting Wea from Foo: " << someWea->ToString() << std::endl;
    delete someWea; // Don't leak oil!
    return 0;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-11-09T18:51:44.807

作为记录，**Octave**允许根据返回元素是标量还是数组而产生不同的结果。

```
x = min ([1, 3, 0, 2, 0])
   ⇒  x = 0

[x, ix] = min ([1, 3, 0, 2, 0])
   ⇒  x = 0
      ix = 3 (item index) 
```

参见[奇异值分解](http:////http://octave.sourceforge.net/octave/function/svd.html%20Singular%20Value%20Decomposition)。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-03-15T17:20:20.467

这与 C++ 略有不同；我不知道它是否会被视为直接通过返回类型重载。它更像是一种模板专业化，其行为方式如下。

**实用程序.h**

```
#ifndef UTIL_H
#define UTIL_H

#include <string>
#include <sstream>
#include <algorithm>

class util {
public: 
    static int      convertToInt( const std::string& str );
    static unsigned convertToUnsigned( const std::string& str );
    static float    convertToFloat( const std::string& str );
    static double   convertToDouble( const std::string& str );

private:
    util();
    util( const util& c );
    util& operator=( const util& c );

    template<typename T>
    static bool stringToValue( const std::string& str, T* pVal, unsigned numValues );

    template<typename T>
    static T getValue( const std::string& str, std::size_t& remainder );
};

#include "util.inl"

#endif UTIL_H 
```

**实用程序.inl**

```
template<typename T>
static bool util::stringToValue( const std::string& str, T* pValue, unsigned numValues ) {
    int numCommas = std::count(str.begin(), str.end(), ',');
    if (numCommas != numValues - 1) {
        return false;
    }

    std::size_t remainder;
    pValue[0] = getValue<T>(str, remainder);

    if (numValues == 1) {
        if (str.size() != remainder) {
            return false;
        }
    }
    else {
        std::size_t offset = remainder;
        if (str.at(offset) != ',') {
            return false;
        }

        unsigned lastIdx = numValues - 1;
        for (unsigned u = 1; u < numValues; ++u) {
            pValue[u] = getValue<T>(str.substr(++offset), remainder);
            offset += remainder;
            if ((u < lastIdx && str.at(offset) != ',') ||
                (u == lastIdx && offset != str.size()))
            {
                return false;
            }
        }
    }
    return true;    
} 
```

**实用程序.cpp**

```
#include "util.h"

template<>
int util::getValue( const std::string& str, std::size_t& remainder ) {
    return std::stoi( str, &remainder );
} 

template<>
unsigned util::getValue( const std::string& str, std::size_t& remainder ) {
    return std::stoul( str, &remainder );
}

template<>
float util::getValue( const std::string& str, std::size_t& remainder ) {
    return std::stof( str, &remainder );
}     

template<>   
double util::getValue( const std::string& str, std::size_t& remainder ) {
    return std::stod( str, &remainder );
}

int util::convertToInt( const std::string& str ) {
    int i = 0;
    if ( !stringToValue( str, &i, 1 ) ) {
        std::ostringstream strStream;
        strStream << __FUNCTION__ << " Bad conversion of [" << str << "] to int";
        throw strStream.str();
    }
    return i;
}

unsigned util::convertToUnsigned( const std::string& str ) {
    unsigned u = 0;
    if ( !stringToValue( str, &u, 1 ) ) {
        std::ostringstream strStream;
        strStream << __FUNCTION__ << " Bad conversion of [" << str << "] to unsigned";
        throw strStream.str();
    }
    return u;
}     

float util::convertToFloat(const std::string& str) {
    float f = 0;
    if (!stringToValue(str, &f, 1)) {
        std::ostringstream strStream;
        strStream << __FUNCTION__ << " Bad conversion of [" << str << "] to float";
        throw strStream.str();
    }
    return f;
}

double util::convertToDouble(const std::string& str) {
    float d = 0;
    if (!stringToValue(str, &d, 1)) {
        std::ostringstream strStream;
        strStream << __FUNCTION__ << " Bad conversion of [" << str << "] to double";
        throw strStream.str();
    }
    return d;
} 
```

这个例子并没有完全使用返回类型的函数重载解析，但是这个 c++ 非对象类使用模板特化来模拟返回类型的函数重载解析和私有静态方法。

每个`convertToType`函数都在调用函数模板`stringToValue()`，如果您查看它正在调用的此函数模板的实现细节或算法，`getValue<T>( param, param )`它会返回一个类型`T`并将其存储到作为其参数之一`T*`传递给函数模板的 a 中`stringToValue()`.

除了这样的事情；C++ 并没有真正的机制来通过返回类型进行函数重载解析。可能还有其他我不知道的构造或机制可以通过返回类型来模拟解析。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2018-05-07T11:36:41.720

我认为这是现代 C++ 定义中的一个 GAP……为什么？

```
int func();
double func();

// example 1\. → defined
int i = func();

// example 2\. → defined
double d = func();

// example 3\. → NOT defined. error
void main() 
{
    func();
} 
```

为什么 C++ 编译器不能在示例“3”中抛出错误并接受示例“1+2”中的代码？

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2009-01-14T06:51:38.443

大多数静态语言现在也支持泛型，这将解决您的问题。如前所述，如果没有参数差异，就无法知道要调用哪一个。因此，如果您想这样做，只需使用泛型并收工。

# python - 预填充内联 FormSet？

> ID：442040
> 
> 赞同：45
> 
> 时间：2009-01-14T05:49:25.467
> 
> 标签：python, django, django-forms

我正在为一个乐队制作一份出勤登记表。我的想法是在表格的一部分中输入演出或排练的活动信息。这是事件表的模型：

```
class Event(models.Model):
    event_id = models.AutoField(primary_key=True)
    date = models.DateField()
    event_type = models.ForeignKey(EventType)
    description = models.TextField() 
```

然后我想要一个内联 FormSet 将乐队成员链接到事件并记录他们是否在场、缺席或请假：

```
class Attendance(models.Model):
    attendance_id = models.AutoField(primary_key=True)
    event_id = models.ForeignKey(Event)
    member_id = models.ForeignKey(Member)
    attendance_type = models.ForeignKey(AttendanceType)
    comment = models.TextField(blank=True) 
```

现在，我想做的是用所有当前成员的条目预先填充这个内联 FormSet，并将它们默认为存在（大约 60 个成员）。不幸的是，Django[在这种情况下不允许使用初始值。](http://groups.google.com/group/django-developers/browse_thread/thread/73af9e58bd7626a8)

有什么建议么？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-01-14T06:08:25.503

所以，你不会喜欢这个答案，部分原因是我还没有写完代码，部分原因是工作量很大。

正如我自己遇到这个问题时发现的那样，您需要做的是：

1.  花大量时间阅读 formset 和 model-formset 代码以了解它是如何工作的（某些功能存在于 formset 类中，而其中一些存在于吐出的工厂函数中，这无济于事他们出去）。在后面的步骤中您将需要这些知识。
2.  编写您自己的 formset 类，该类继承自`BaseInlineFormSet`并接受`initial`. 这里真正棘手的一点是您*必须*覆盖`__init__()`，并且您*必须*确保它调用`BaseFormSet.__init__()`而不是使用直接父或祖父`__init__()`（因为它们分别是`BaseInlineFormSet`和`BaseModelFormSet`，并且它们都不能处理初始数据）。
3.  编写您自己的适当管理内联类的子类（在我的情况下是`TabularInline`）并覆盖其`get_formset`方法以返回`inlineformset_factory()`使用您的自定义表单集类的结果。
4.  在模型的实际`ModelAdmin`子类中，使用内联、覆盖`add_view`和`change_view`复制大部分代码，但有一个很大的变化：构建您的表单集需要的初始数据，并将其传递给您的自定义表单集（这将由您的`ModelAdmin`的`get_formsets()`方法）。

我与 Brian 和 Joseph 进行了一些富有成效的聊天，讨论如何为未来的 Django 版本改进这一点；目前，模型表单集的工作方式只是让这比通常的价值更麻烦，但是通过一些 API 清理，我认为它可以变得非常容易。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2010-09-22T04:35:19.163

我花了相当多的时间试图提出一个可以跨站点重复使用的解决方案。`BaseInlineFormSet`詹姆斯的帖子包含扩展但战略性地调用反对的关键智慧`BaseFormSet`。

下面的解决方案分为两部分： a`AdminInline`和 a `BaseInlineFormSet`。

1.  根据`InlineAdmin`公开的请求对象动态生成初始值。
2.  `BaseInlineFormSet`它使用柯里化通过传递给构造函数的关键字参数将初始值公开给自定义。
3.  构造`BaseInlineFormSet`函数从关键字参数列表中弹出初始值并正常构造。
4.  最后一部分是通过更改表单的最大总数并使用`BaseFormSet._construct_form`and`BaseFormSet._construct_forms`方法来覆盖表单构建过程

以下是一些使用 OP 类的具体片段。我已经针对 Django 1.2.3 对此进行了测试。我强烈建议在开发时将[表单集](http://docs.djangoproject.com/en/1.2/topics/forms/formsets/)和[管理](http://docs.djangoproject.com/en/1.2/ref/contrib/admin/#inlinemodeladmin-objects)文档放在手边。

**管理员.py**

```
from django.utils.functional import curry
from django.contrib import admin
from example_app.forms import *
from example_app.models import *

class AttendanceInline(admin.TabularInline):
    model           = Attendance
    formset         = AttendanceFormSet
    extra           = 5

    def get_formset(self, request, obj=None, **kwargs):
        """
        Pre-populating formset using GET params
        """
        initial = []
        if request.method == "GET":
            #
            # Populate initial based on request
            #
            initial.append({
                'foo': 'bar',
            })
        formset = super(AttendanceInline, self).get_formset(request, obj, **kwargs)
        formset.__init__ = curry(formset.__init__, initial=initial)
        return formset 
```

**表格.py**

```
from django.forms import formsets
from django.forms.models import BaseInlineFormSet

class BaseAttendanceFormSet(BaseInlineFormSet):
    def __init__(self, *args, **kwargs):
        """
        Grabs the curried initial values and stores them into a 'private'
        variable. Note: the use of self.__initial is important, using
        self.initial or self._initial will be erased by a parent class
        """
        self.__initial = kwargs.pop('initial', [])
        super(BaseAttendanceFormSet, self).__init__(*args, **kwargs)

    def total_form_count(self):
        return len(self.__initial) + self.extra

    def _construct_forms(self):
        return formsets.BaseFormSet._construct_forms(self)

    def _construct_form(self, i, **kwargs):
        if self.__initial:
            try:
                kwargs['initial'] = self.__initial[i]
            except IndexError:
                pass
        return formsets.BaseFormSet._construct_form(self, i, **kwargs)

AttendanceFormSet = formsets.formset_factory(AttendanceForm, formset=BaseAttendanceFormSet) 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2013-05-07T11:01:21.890

Django 1.4 及更高版本支持[提供初始值](https://docs.djangoproject.com/en/3.1/topics/forms/modelforms/#providing-initial-values)。

就原始问题而言，以下方法可行：

```
class AttendanceFormSet(models.BaseInlineFormSet):
    def __init__(self, *args, **kwargs):
        super(AttendanceFormSet, self).__init__(*args, **kwargs)
        # Check that the data doesn't already exist
        if not kwargs['instance'].member_id_set.filter(# some criteria):
            initial = []
            initial.append({}) # Fill in with some data
            self.initial = initial
            # Make enough extra formsets to hold initial forms
            self.extra += len(initial) 
```

如果您发现表单正在填充但未保存，那么您可能需要自定义您的模型表单。一个简单的方法是在初始数据中传递一个标签，并在表单 init 中查找它：

```
class AttendanceForm(forms.ModelForm):
    def __init__(self, *args, **kwargs):
        super(AttendanceForm, self).__init__(*args, **kwargs)
        # If the form was prepopulated from default data (and has the
        # appropriate tag set), then manually set the changed data
        # so later model saving code is activated when calling
        # has_changed().
        initial = kwargs.get('initial')
        if initial:
            self._changed_data = initial.copy()

    class Meta:
        model = Attendance 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-11-06T19:16:42.923

我遇到了同样的问题。

您可以通过 JavaScript 来完成，制作一个简单的 JS，对所有乐队成员进行 ajax 调用，并填充表单。

这个解决方案缺乏 DRY 原则，因为你需要为你拥有的每个内联表单编写这个。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-02-07T19:55:54.670

使用 django 1.7，我们在创建内联表单时遇到了一些问题，该表单将附加上下文烘焙到模型中（不仅仅是要传入的模型实例）。

我想出了一个不同的解决方案，将数据注入到传递给表单集的 ModelForm 中。因为在python中你可以动态创建类，而不是试图直接通过表单的构造函数传入数据，类可以由一个方法构建，带有你想要传入的任何参数。然后当类被实例化时，它可以访问方法的参数。

```
def build_my_model_form(extra_data):
    return class MyModelForm(forms.ModelForm):
        def __init__(self, *args, **kwargs):
            super(MyModelForm, self).__init__(args, kwargs)
            # perform any setup requiring extra_data here

        class Meta:
            model = MyModel
            # define widgets here 
```

然后对内联表单集工厂的调用将如下所示：

```
inlineformset_factory(ParentModel, 
                      MyModel, 
                      form=build_my_model_form(extra_data)) 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-06-05T21:12:14.030

-6 年后我遇到了这个问题，我们现在使用 Django 1.8。

仍然没有完全干净，简短的问题答案。

问题在于 ModelAdmin._create_formsets() *[github](https://github.com/django/django/blob/master/django/contrib/admin/options.py#L1711-1722)*；我的解决方案是覆盖它，并在 github 链接中突出显示的行周围注入我想要的初始数据。

我还必须覆盖 InlineModelAdmin.get_extra() 以便为提供的初始数据“留出空间”。保留默认值，它将仅显示 3 个初始数据

我相信在即将发布的版本中应该有更清晰的答案

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-04-28T12:38:53.157

您可以在表单集上覆盖 empty_form getter。这是一个关于如何与 django admin 一起处理的示例：

```
class MyFormSet(forms.models.BaseInlineFormSet):
    model = MyModel

    @property
    def empty_form(self):
        initial = {}
        if self.parent_obj:
            initial['name'] = self.parent_obj.default_child_name
        form = self.form(
            auto_id=self.auto_id,
            prefix=self.add_prefix('__prefix__'),
            empty_permitted=True, initial=initial
        )
        self.add_fields(form, None)
        return form    

class MyModelInline(admin.StackedInline):
    model = MyModel
    formset = MyFormSet

    def get_formset(self, request, obj=None, **kwargs):    
        formset = super(HostsSpaceInline, self).get_formset(request, obj, **kwargs)
        formset.parent_obj = obj
        return formset 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-03-08T20:27:17.883

这是我解决问题的方法。在创建和删除记录方面有一些权衡，但代码很干净......

```
def manage_event(request, event_id):
    """
    Add a boolean field 'record_saved' (default to False) to the Event model
    Edit an existing Event record or, if the record does not exist:
    - create and save a new Event record
    - create and save Attendance records for each Member
    Clean up any unsaved records each time you're using this view
    """
    # delete any "unsaved" Event records (cascading into Attendance records)
    Event.objects.filter(record_saved=False).delete()
    try:
        my_event = Event.objects.get(pk=int(event_id))
    except Event.DoesNotExist:
        # create a new Event record
        my_event = Event.objects.create()
        # create an Attendance object for each Member with the currect Event id
        for m in Members.objects.get.all():
            Attendance.objects.create(event_id=my_event.id, member_id=m.id)
    AttendanceFormSet = inlineformset_factory(Event, Attendance, 
                                        can_delete=False, 
                                        extra=0, 
                                        form=AttendanceForm)
    if request.method == "POST":
        form = EventForm(request.POST, request.FILES, instance=my_event)
        formset = AttendanceFormSet(request.POST, request.FILES, 
                                        instance=my_event)
        if formset.is_valid() and form.is_valid():
            # set record_saved to True before saving
            e = form.save(commit=False)
            e.record_saved=True
            e.save()
            formset.save()
            return HttpResponseRedirect('/')
    else:
        form = EventForm(instance=my_event)
        formset = OptieFormSet(instance=my_event)
    return render_to_response("edit_event.html", {
                            "form":form, 
                            "formset": formset,
                            }, 
                            context_instance=RequestContext(request)) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-12-19T17:15:07.753

只需覆盖“save_new”方法，它在 Django 1.5.5 中对我有用：

```
class ModelAAdminFormset(forms.models.BaseInlineFormSet):
    def save_new(self, form, commit=True):
        result = super(ModelAAdminFormset, self).save_new(form, commit=False)
        # modify "result" here
        if commit:
            result.save()
        return result 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-05-20T13:52:12.577

我有同样的问题。我正在使用 Django 1.9，我尝试了 Simanas 提出的解决方案，覆盖了属性“empty_form”，在 de dict 初始值中添加了一些默认值。那行得通，但在我的情况下，我有 4 个额外的内联表单，总共 5 个，并且五个表单中只有一个填充了初始数据。

我已经像这样修改了代码（参见初始字典）：

```
class MyFormSet(forms.models.BaseInlineFormSet):
    model = MyModel

    @property
    def empty_form(self):
        initial = {'model_attr_name':'population_value'}
        if self.parent_obj:
            initial['name'] = self.parent_obj.default_child_name
        form = self.form(
            auto_id=self.auto_id,
            prefix=self.add_prefix('__prefix__'),
            empty_permitted=True, initial=initial
        )
        self.add_fields(form, None)
        return form    

class MyModelInline(admin.StackedInline):
    model = MyModel
    formset = MyFormSet

    def get_formset(self, request, obj=None, **kwargs):    
        formset = super(HostsSpaceInline, self).get_formset(request, obj, **kwargs)
        formset.parent_obj = obj
        return formset 
```

如果我们找到一种方法让它在有额外的表单时工作，这个解决方案将是一个很好的解决方法。

# sql-server - 从 UNIX 上的 Web 应用程序调用存储过程在 xp_cmdshell 上抛出错误

> ID：442045
> 
> 赞同：1
> 
> 时间：2009-01-14T05:55:07.857
> 
> 标签：sql-server, ftp, jakarta-ee, xp-cmdshell

大家好，我正在把头发拉出来。

我已经检查了我在数据库服务器（SQL Server 2000）和文件系统上的所有权限，以确保我想要做的事情应该是可能的。情况如下：

我有一个 Java EE Web 应用程序在我公司 Intranet 上的 Tomcat 服务器上运行。长话短说，这个应用程序处理数字，创建一个以管道分隔的记录文件，将其批量插入到我们的数据库中，并将文件保存在 UNIX 服务器上。

然后调用一个存储过程，它利用 xp_cmdshell 将文件从 UNIX FTP 到我们的 Windows SQL Server 框，以便 BULK INSERT 文件。当我从 Management Studio 调用此存储过程（以运行 Web 应用程序的 tomcat 用户身份登录）时，没有任何错误，并且 FTP 传输，并且文件已加载。

这是让我感到恼火的部分。

当 Java EE 应用程序调用此存储过程时，它实际上将文件通过 FTP 传输到 SQL Server 框，但即使成功，我最终也会出现 SQLServerException。没有押韵或理由。但是......即使抛出异常，我的文件最终还是在服务器上，一切都很好而且很舒适。

SQL Server 在从 UNIX 服务器运行 xp_cmdshell 时是否存在问题（这听起来很可笑，因为所有程序都在调用存储过程，所以我在星期二晚上 11:55 还在办公室，所以我想没有什么是太可笑了……）

任何见解都会很棒......

编辑：

此外，我一直在使用 SQL Profiler 查看到 SQL Server 的流量……我可以看到我用来调用存储过程的实际语句。当我将它复制到 SQL Server Management Studio 并使用我的 tomcat 用户凭据执行它时，它完美地执行......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T06:06:56.490

哇。这就是为什么在晚上 11 点编写代码不好的原因。

xp_cmdshell 在每次执行时返回一个结果集。它基本上为您提供命令行的输出，就像您在命令提示符下看到的那样。这里的关键是结果集。

我调用存储过程的 JDBC 方法是 issueUpdate()，它在 xp_cmdshell 返回的结果集上引发异常。当我更改为 issueQuery() 时，我没有收到异常，其余代码执行完成。

我想我需要做一些工作来清理这个问题，但我对这个解决方案很满意。

# jquery - 你如何根据风格选择元素？

> ID：442048
> 
> 赞同：27
> 
> 时间：2009-01-14T05:59:54.087
> 
> 标签：jquery, css, css-selectors

使用 jQuery，您将如何找到具有特定样式（例如：）的元素`float: left`，无论它是内联样式还是在 CSS 文件中定义的样式？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-01-14T06:20:18.680

使用[过滤功能](http://docs.jquery.com/Traversing/filter)：

```
$('*').filter(function() {
     return $(this).css('float') == 'left';
}); 
```

将 '*' 替换为适合您情况的选择器。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-14T06:25:26.203

这会很慢。就像真的很慢。如果您知道需要选择具有给定 CSS 样式的所有元素，则通过将单个附加 css 规则应用于每个元素，然后按该规则进行选择，您将看到更好的性能。

启动起来会更快、更易读。

CSS：

```
.float-left {float:left} 
```

Javascript：

```
$('.float-left'); 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-01-14T06:22:43.697

好吧，我不知道我是否会这样处理。为什么不直接用一致的 ID 或类名重命名这些元素，然后选择它呢？

如果这不是一个选项，这应该工作：

```
this.getElementsByTagName('div').item(0).style.float = 'left'; 
```

我认为。

# winapi - 在整个 Windows 中替换一个 Window 类

> ID：442054
> 
> 赞同：0
> 
> 时间：2009-01-14T06:04:15.013
> 
> 标签：winapi, hook

我需要替换整个 Windows 中的预定义窗口类之一。例如，我想替换“EDIT”类，以便在任何 Windows 程序`CreateWindowEx`以“EDIT”作为类名参数调用时使用我自己的自定义编辑框。

我怎样才能做到这一点？消息挂钩会有帮助吗？我相信在这种情况下，消息挂钩会带来过多的开销。我的替代方案是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T06:31:31.713

您所要求的，即更改其他进程看到的“EDIT”类的行为是一种安全风险，并且不容易实现：例如， http: [//msdn.microsoft.com/en-us/library /ms997565.aspx](http://msdn.microsoft.com/en-us/library/ms997565.aspx)说，“**子类化只允许在进程内。应用程序不能子类化属于另一个进程的窗口或类。** ”

不可能的架构原因是代码与窗口类相关联，您的代码与您的子类相关联，并且您的代码不容易用于（无法从）其他进程（通过hackish除外） DLL 注入等技术）。

API`SetWindowsHookEx`是否可以为您提供所需的东西，而不是子类化？

# python - 如何使用第一个可用端口在 Python 中创建 HTTP 服务器？

> ID：442062
> 
> 赞同：3
> 
> 时间：2009-01-14T06:08:39.263
> 
> 标签：python, httpserver

我想避免硬编码端口号，如下所示：

```
httpd = make_server('', 8000, simple_app) 
```

我以这种方式创建服务器的原因是我想将它用作 Adob​​e AIR 应用程序的“内核”，以便它可以使用 PyAMF 进行通信。由于我在客户端运行它，我定义的任何端口很可能已经在使用中。如果有更好的方法可以做到这一点并且我问错了问题，请告诉我。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-14T06:16:22.633

问题是您需要一个已知端口供应用程序使用。但是如果你给一个端口号 0，我相信操作系统会为你提供第一个可用的未使用端口。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-14T13:41:38.617

> 问题是您需要一个已知端口供应用程序使用。但是如果你给一个端口号 0，我相信操作系统会为你提供第一个可用的未使用端口。

你是对的，先生。这是它的工作原理：

```
>>> import socket
>>> s = socket.socket()
>>> s.bind(("", 0))
>>> s.getsockname()
('0.0.0.0', 54485) 
```

我现在有一个绑定到端口 54485 的套接字。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-14T06:16:18.233

是`make_server`你写的函数吗？更具体地说，您是否处理创建套接字的代码？如果这样做，应该有一种方法可以不指定端口号（或指定 0 作为端口号），操作系统会为您选择一个可用的端口号。

除此之外，您可以选择一个随机端口号，例如 54315 ......不太可能有人会使用那个端口号。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-01-14T06:20:30.877

防火墙允许您逐个端口允许或拒绝流量。仅出于这个原因，没有明确定义端口的应用程序应该会在客户端安装中遇到各种问题。

我说选择一个随机端口，如果需要，用户可以很容易地更改端口。

这里是[知名港口](http://www.iana.org/assignments/port-numbers)的良好起点。

# iphone - 不使用 MPMoviePlayer 在 iPhone 上动画图像（如电影）的方法

> ID：442076
> 
> 赞同：2
> 
> 时间：2009-01-14T06:18:13.877
> 
> 标签：iphone, animation, core-animation

我需要能够在静态图像上显示动画。

鉴于 MPMoviePlayer 无法让您控制任何有用的东西，我能想到的唯一方法是使用多个静态图像，我们会（一个接一个地）显示这些图像来创建“类似电影”的动画。

我知道我们可以使用 UIImageView 来做到这一点（通过设置 UIImageView **animationImages**属性然后调用**startAnimation**），但是我们的动画中将有超过 100 个图像 - 所以内存使用量将被最大化。

有没有人有任何好的方法来做这种动画？使用核心动画还是 OpenGL？

我的猜测是我们需要创建一个图像缓冲区，当我们加载新图像时，我们会显示图像缓冲区中的图像？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T16:46:53.500

您可以使用 Core Animation CALayer 来托管您的动画，并在该主层内外交换一系列 CALayer 来执行逐帧动画。您可以使用其内容属性将图像帧托管 CALayer 的内容设置为 CGImageRef。可以根据需要创建一系列包含图像的 CALayer 并将其存储在 NSMutableArray 中，然后在完成后将其删除以最大程度地减少内存使用。

您可以通过在 CATransaction 中包装 replaceSublayer:with: 方法调用来设置帧之间的过渡持续时间，如下所示：

```
[CATransaction begin];
[CATransaction setValue:[NSNumber numberWithFloat:0.25f] // 1/4th of a second per frame
                 forKey:kCATransactionAnimationDuration];   
[mainLayer replaceSublayer:[imageLayers objectAtIndex:oldImageIndex] with:[imageLayers objectAtIndex:newImageIndex]];
[CATransaction commit]; 
```

如果您的帧显示时间足够短，您可能还可以在主层的内容中换入和换出 CGImageRef。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-20T20:44:07.200

正如您所发现的，使用 UIImageView.animationImages 不起作用，因为它会耗尽您的所有系统内存并且会使您的应用程序崩溃。您可以使用计时器并在每次计时器触发时设置 UIImageView 的图像属性，每次计时器触发时都需要加载用作内容的 UIImage 对象。这与另一个答案中描述的方法基本相同，只是它使用 CALayer 而不是 UIImageView。每次计时器触发时加载图像并更改图像内容是一种不错的方法，但它只能在 iPhone 上获得大约 11 FPS 的全屏图像。

如果您想使用实现 UIImageView 切换逻辑的工作示例，请下载此[PNG 动画](http://www.modejong.com/iOS "PNG动画")示例项目用于 xcode。我还提供了[AVAnimator](http://www.modejong.com/AVAnimator/ "AV动画师")库，它是同类功能的优化版本，它支持 Quicktime Animation 和 APNG 格式以及压缩。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2021-08-10T13:08:17.747

您可以使用`CAKeyframeAnimation`动画一系列图像/播放图像，如电影。

```
 //Get UIImage array
    NSMutableArray<UIImage *> *frames = [[NSMutableArray alloc] init];
    [frames addObject:[UIImage imageNamed:@"1"]];
    [frames addObject:[UIImage imageNamed:@"2"]];
    [frames addObject:[UIImage imageNamed:@"3"]];
    [frames addObject:[UIImage imageNamed:@"4"]];
    [frames addObject:[UIImage imageNamed:@"5"]];

    //Declare an array for animationSequenceArray
    NSMutableArray *animationSequenceArray = [[NSMutableArray alloc] init];

    //Prepare animation
    CAKeyframeAnimation *animationSequence = [CAKeyframeAnimation animationWithKeyPath: @"contents"];
    animationSequence.calculationMode = kCAAnimationDiscrete;
    animationSequence.autoreverses = YES;
    animationSequence.duration = 5.00; // Total Playing duration
    animationSequence.repeatCount = HUGE_VALF;

    for (UIImage *image in frames) {
        [animationSequenceArray addObject:(id)image.CGImage];
    }
    animationSequence.values = animationSequenceArray;

    //Prepare CALayer
    CALayer *layer = [CALayer layer];
    layer.frame = self.view.frame;
    layer.masksToBounds = YES;
    [layer addAnimation:animationSequence forKey:@"contents"];
    [self.view.layer addSublayer:layer]; // Add CALayer to your desired view 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-20T04:51:07.137

对于序列中的动画图像，

首先拍摄一组您需要播放的图像。

然后将此数组提供给动画并完成。

Iphone 中的井解释[动画：一系列图像](http://www.appsfor2012.com/2012/10/animation-in-iphone-series-of-images.html)

# java - 有没有办法在 Visio for Java 中绘制 UML？

> ID：442099
> 
> 赞同：15
> 
> 时间：2009-01-14T06:26:55.343
> 
> 标签：java, uml, visio

我有 Visio2007，我真的很喜欢它。但是，它似乎没有用于 Java 的 UML 模型/数据类型。是否有一些我可以下载用于 Java 的模板？还是我应该完全忘记 Visio 并获得一个 Elipse 插件？

谢谢！

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2010-02-19T02:58:07.070

我有同样的问题，但后来我搞砸了，直到我弄清楚了。现在，忍受我；这是我第一次发布对答案的回复。既然我想通了，我想我应该将我大脑的数据转移到你的大脑中（eww ..我们正在连接）。

现在开始工作......您实际上可以制作自己的包和数据类型。我所做的是我去`Model Explorer`了左边的标签。然后，我右键单击`IDL Data Types`，然后单击`Duplicate`（因为我不想从头开始制作我自己的，它几乎有我想要的）。然后它将创建一个名为“Package 1”的新包。右键单击它并选择`Rename`；我将我的重命名为“Java Data Types”，因为这是我正在制作的，但如果你愿意，你可以将它命名为“Underpants”。然后，我打开我的新包并右键单击每种数据类型，一次一个，然后选择`Properties`. 然后它将打开`UML Property Editor`. 从那里，单击`Name`，然后从括号内删除单词“idl”，因此“boolean(idl)”现在表示“boolean()”。

现在，还有一件事：没有`int`数据类型，所以你需要创建一个。这很容易；只需右键单击新创建的文件夹，单击`New`，然后单击`Data Type`。它应该打开`UML Datatypes Properties`窗口。现在，在选项卡内单击`Name`，输入“int()”，然后单击`OK`。你已经完成了。

看，那还不错。哎呀，如果我能做到，你绝对应该能够做到。我希望这是可以理解和有帮助的。如果不是，那么我想我已经让你失望了，我现在应该用我的剑来拯救我的荣誉。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-02T13:35:15.043

[在http://barzeenotes.blogspot.com/2014/11/java-and-javascript-support-for.html](http://barzeenotes.blogspot.com/2014/11/java-and-javascript-support-for.html)有一个适用于 Java 的 Visio UML 模板

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-14T06:33:58.603

后者是一个更好的选择，恕我直言。此外，我不认为 UML 模型应该特定于 Java。我不知道周围是否有任何特定于 java 的 UML。

我在网上搜索时发现了这个。[UML 模型：MS Visio 2007](http://office.microsoft.com/en-us/visio/HP012088141033.aspx)。

# c - 用于 C/C++ 的 irb 类型工具

> ID：442105
> 
> 赞同：1
> 
> 时间：2009-01-14T06:30:02.107
> 
> 标签：c, ruby

在编写 ruby​​ 代码时，很容易通过在 irb 中测试不同函数的行为来测试它们。但是要在 C 中测试代码，我通常必须打开一个单独的 IDE 并在那里编写代码来测试它是如何工作的。在 Unix 或 Windows 平台上是否有类似解释器的工具？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T09:40:19.697

如果您只是想测试一段可复制和粘贴的代码，我经常使用[CodePad](http://codepad.org/)无需编译即可立即查看单个函数的结果。但是，它有其局限性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T06:37:18.380

C 不是解释型语言。但是，有几个口译员。我认为最好的一个是 Ch，但它不是开源的。CINT 是开源的：

[http://directory.fsf.org/project/CINT/](http://directory.fsf.org/project/CINT/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T06:35:35.590

我认为[Ch](http://www.softintegration.com/)是最接近 C/C++ REPL 的。我相信它支持 C 和一些 C++ 的所有特性。

# bug-tracking - Mantis 路线图功能

> ID：442128
> 
> 赞同：12
> 
> 时间：2009-01-14T06:43:56.167
> 
> 标签：bug-tracking, mantis

如何在[Mantis bugtracker 中启用和使用](http://www.mantisbt.org)[路线图](http://www.mantisbt.org/wiki/doku.php/mantisbt:features:roadmap)功能？

我自己回答这个问题，我希望它对其他 Mantis 用户有用。[这](http://www.mantisbt.org/forums/viewtopic.php?f=2&t=2294&st=0&sk=t&sd=a&start=0)是关于同一主题的讨论。

更新：例如，这里是Mantis 本身的[Mantis 路线图。](http://www.mantisbt.org/bugs/roadmap_page.php)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-14T06:47:31.993

据我了解，您先更新项目并添加一个或多个版本。稍后，将项目中问题的目标版本设置为这些值之一。您也可以从“查看问题”页面执行此操作，方法是在页面底部的下拉列表中选择“更新目标版本”，然后单击“确定”。这将提示您设置要设置的版本。设置完成后，您将在路线图页面下找到一些内容。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-26T12:19:34.193

还要确保不要设置版本的 Released 属性，否则它不会显示在路线图页面上。

# perl - 我可以与 CGI::Application::Dispatch 一起使用常规参数吗？

> ID：442135
> 
> 赞同：3
> 
> 时间：2009-01-14T06:49:37.263
> 
> 标签：perl, cgiapp

我很欣赏能够做到的能力：[http://server/controller/runmode](http://server/controller/runmode)甚至[http://server/controller/runmode/id](http://server/controller/runmode/id)。但是，如果我有很多可选参数，我希望能够执行常规操作：[http://server/controller/runmode?foo=bar&baz=frew](http://server/controller/runmode?foo=bar&baz=frew)，特别是因为我有很多 JS 可以执行后者为了我。有谁知道允许此功能的方法？

谢谢！

**编辑**：好的，我在 mpeters 的帮助下想通了。要获得 CAD 生成的参数，你显然只需要 $self->param('foo')，但如果你想要常规参数，你可以使用 $self->query()->param('bar')

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T15:25:21.217

您不必为此做任何神奇的事情，它会自行工作。您只是以不同的方式检索它们。如果它来自 CGI 查询字符串，那么您可以通过

`$self->query('param_name')`

如果它来自 PATH_INFO （`CGI::Application::Dispatch`处理的部分），那么您可以通过

`$self->param('param_name')`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T00:40:38.373

**编辑**：好的，我在 mpeters 的帮助下想通了。要获得 CAD 生成的参数，你显然只需要 $self->param('foo')，但如果你想要常规参数，你可以使用 $self->query()->param('bar')

# java - Eclipse：从插件代码访问编辑器模板

> ID：442138
> 
> 赞同：4
> 
> 时间：2009-01-14T06:50:48.273
> 
> 标签：java, eclipse, eclipse-plugin

假设我在我的编辑器首选项中定义了一个编辑器模板（它插入一些任意代码片段）。

我想以编程方式访问该模板。我该怎么做呢？

我知道存在 TemplateStore、TemplatePreferencesPage 和 TemplatePersistentData 类，但我无法将它们放在一起工作。

是否有任何示例代码可以让我通过 Java 代码访问我的编辑器模板？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-14T07:45:36.370

可能是这个[`JavaPlugin`类](http://kickjava.com/src/org/eclipse/jdt/internal/ui/JavaPlugin.java.htm)（在`org.eclipse.jdt.internal.ui`Eclipse 包内）可能会为您提供第一个线索。

```
 /**
  * Returns the template store for the code generation templates.
  *
  * @return the template store for the code generation templates
  * @since 3.0
  */
 public TemplateStore getCodeTemplateStore() {
     if (fCodeTemplateStore == null) {
         IPreferenceStore store= getPreferenceStore();
         boolean alreadyMigrated= store.getBoolean(CODE_TEMPLATES_MIGRATION_KEY);
         if (alreadyMigrated)
             fCodeTemplateStore= new ContributionTemplateStore(getCodeTemplateContextRegistry(), store, CODE_TEMPLATES_KEY);
         else {
             fCodeTemplateStore= new CompatibilityTemplateStore(getCodeTemplateContextRegistry(), store, CODE_TEMPLATES_KEY, getOldCodeTemplateStoreInstance());
             store.setValue(CODE_TEMPLATES_MIGRATION_KEY, true);
         }

         try {
             fCodeTemplateStore.load();
         } catch (IOException JavaDoc e) {
             log(e);
         }

         fCodeTemplateStore.startListeningForPreferenceChanges();

         // compatibility / bug fixing code for duplicated templates
         // TODO remove for 3.0
        CompatibilityTemplateStore.pruneDuplicates(fCodeTemplateStore, true);            
     }

     return fCodeTemplateStore;
 } 
```

从那里，您可以找到一些使用该函数的类：

[NewASInterfaceWizard](http://svn.axdt.org/tags/0.0.9%20beta/org.asdt.wizards/src/org/asdt/wizards/ui/NewASInterfaceWizard.java)似乎需要访问这些代码模板：

```
private String resolveTemplate(String templateName) {

        Template template = ASEditorPlugin.getDefault().getCodeTemplateStore().findTemplate(templateName);
        if (template == null) {
            showErrorBox("Could not resolve template (" + templateName +").");
            return "";
        }

        // Create the template context
        TemplateContext templeteContext = new TemplateContext(new ASContextType()) {

            public TemplateBuffer evaluate(Template template) throws BadLocationException, TemplateException {
                TemplateTranslator translator = new TemplateTranslator();
                TemplateBuffer buffer = translator.translate(template);
                getContextType().resolve(buffer, this);
                return buffer;
            }

            public boolean canEvaluate(Template template) {
                return true;
            }

        };

        try {
            return templeteContext.evaluate(template).getString();
        } catch (BadLocationException e) {
            logger.error("Couldnt evaluate template",e);
        } catch (TemplateException e) {
            logger.error("Couldnt evaluate template",e);
        }
       return "";

} 
```

像这样使用：

```
 private static final String FILE_HEADER_TEMPLATE = "file_header";
        // Header
        String header = resolveTemplate(FILE_HEADER_TEMPLATE);
        if (header.length() > 0) {
            content.append(header + "\n");
        } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-04-05T19:31:19.027

好吧，我就是这样做的。

```
/**
 * Get the Template Store of the JDT UI.
 * 
 * @return the JDT template store
 */
private TemplateStore getTemplateStore() {
    if (templateStore == null) {
        System.out.println("templateStore is null - Creating a new one");

        final ContributionContextTypeRegistry registry = new ContributionContextTypeRegistry(JavaUI.ID_CU_EDITOR);
        final IPreferenceStore store = PreferenceConstants.getPreferenceStore();

        templateStore = new ContributionTemplateStore(registry, store, TEMPLATES_KEY);

        try {
            templateStore.load();
        } catch (IOException e) {
            WSConsole.e(e);
        }
        templateStore.startListeningForPreferenceChanges();
    }
    return templateStore;
} 
```

上述方法返回 TemplateStore。您使用商店来添加、删除、查找模板。

```
private void filterTemplates() {
    templateStore = getTemplateStore();

    deleteTemplate(templateStore, "org.eclipse.jdt.ui.templates.sysout");

    try {
        templateStore.save();
    } catch (IOException e) {
    }
}

private void deleteTemplate(TemplateStore templateStore, String id) {
    TemplatePersistenceData templateData = templateStore.getTemplateData(id);
    if (templateData != null) {
        templateStore.delete(templateData);
    }
} 
```

这是对 TemplateStore 执行操作的方法。如果要查找模板的模式、名称、描述，可以通过从 TemplateStore 获取 Template 对象来获取。如果要查找模板的 id，可以从 TemplatePersistantData 对象中获取。

# c++ - 编译旧的 C++ unix 应用程序以在 Windows 中使用

> ID：442139
> 
> 赞同：0
> 
> 时间：2009-01-14T06:50:55.590
> 
> 标签：c++, gcc, cygwin

对于 1994 年为 UNIX 编写的某些代码，我需要有一个 Windows 可执行文件。我试图从 cygwin 环境中做到这一点。从那时起，C++ 标准和标准库都发生了变化。

我尝试使用 -std= 和 -traditional-cpp 选项，但这些选项根本没有帮助我。我还发现 -fno-for-scope 和 -fno-operator-names 减少了错误的数量。从那时起，输入/输出库也发生了重大变化。我也认为从那时起预定义的（由预处理器）宏也有可能发生变化。

作者对代码的注释：
[http ://research.microsoft.com/en-us/um/people/hoppe/code.htm](http://research.microsoft.com/en-us/um/people/hoppe/code.htm)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T08:01:47.507

库中的 C 代码（库/linpack 和库/食谱）使用以下代码编译得很好：

```
gcc -c *.c 
```

C++ 代码更成问题。../include 中有头文件，它们需要 -DANSI 来生成函数原型。它们没有`extern "C"`在标题中声明；它们正确包含在 C++ 源目录的标题中：

```
extern "C" {
#include "linpack.h"
} 
```

所以，编译 A3dStream.C，我得到：

```
$ g++ -DANSI -I../include -c A3dStream.C
In file included from /usr/lib/gcc/i686-pc-cygwin/3.4.4/include/c++/backward/iostream.h:31,
                 from Hh.h:12,
                 from A3dStream.C:4:
/usr/lib/gcc/i686-pc-cygwin/3.4.4/include/c++/backward/backward_warning.h:32:2:
warning: #warning This file includes at least one deprecated or antiquated header.
Please consider using one of the 32 headers found in section 17.4.1.2 of the C++
standard.    Examples include substituting the <X> header for the <X.h> header for
C++ includes, or <iostream> instead of the deprecated header <iostream.h>. To disable
this warning use -Wno-deprecated.
In file included from A3dStream.C:4:
Hh.h:15:23: strstream.h: No such file or directory
In file included from A3dStream.C:4:
Hh.h:45: error: declaration of C function `void bzero(void*, int)' conflicts with
/usr/include/string.h:54: error: previous declaration `void bzero(void*, size_t)' here
Hh.h:46: error: declaration of C function `int gethostname(char*, int)' conflicts with
/usr/include/sys/unistd.h:206: error: previous declaration `int gethostname(char*, size_t)' here
Hh.h:98: error: an explicit specialization must be preceded by 'template <>'
Hh.h:105: error: an explicit specialization must be preceded by 'template <>'
Hh.h:111: error: an explicit specialization must be preceded by 'template <>'
Hh.h:221: error: new declaration `void unsetenv(const char*)'
/usr/include/cygwin/stdlib.h:26: error: ambiguates old declaration `int unsetenv(const char*)'
In file included from Geometry.h:10,
                 from A3dStream.h:7,
                 from A3dStream.C:5:
Array.h: In member function `void Array<T>::resize(int)':
Array.h:40: error: `size' undeclared (first use this function)
Array.h:40: error: (Each undeclared identifier is reported only once for each function it appears in.)
Array.h:44: error: `a' undeclared (first use this function)
Array.h: In member function `void Array<T>::clear()':
Array.h:51: error: `a' undeclared (first use this function)
Array.h:51: error: `size' undeclared (first use this function)
Array.h: In member function `void Array<T>::init(int)':
Array.h:53: error: `size' undeclared (first use this function)
Array.h: In member function `void Array<T>::need(int)':
Array.h:57: error: `size' undeclared (first use this function)
Array.h: In member function `Array<T>& Array<T>::operator+=(const T&)':
Array.h:64: error: `a' undeclared (first use this function)
Array.h: In member function `void Array<T>::squeeze()':
Array.h:66: error: `size' undeclared (first use this function)
Array.h: In member function `const T& Array<T>::operator[](int) const':
Array.h:70: error: `a' undeclared (first use this function)
Array.h: In member function `T& Array<T>::operator[](int)':
Array.h:71: error: `a' undeclared (first use this function) 
```

其他文件产生类似的错误集。

我在 Windows XP 下的 Cygwin 上使用 GCC 3.4.4。

我不是 C++ 大师——尽管我在软件考古方面做了相当多的工作——但在我看来，你需要更新代码以使用 C++ 标准头文件，因为 strstream.h 尤其缺失（所以，名义上，`<strstream>`改为使用），这意味着您必须处理`std`名称空间等。这段代码比标准早了 5 年，因此必须努力破解它以使其更新并不是没有道理的。

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T08:14:20.650

I can think of two possibilities: AT&T offers both [UWIN](http://www.research.att.com/sw/tools/uwin/) (which may be different enough from Cygwin to avoid the same trouble) and the source for [old versions of CFront](http://www.softwarepreservation.org/projects/c_plus_plus/index.html#release_30) (which is probably the original compiler used).

Well, there's a third possibility, and I think it's the recommended action: edit the source and bring it up to date to the standard. If you intend to do any further development on this code, it's best to bite the bullet sooner rather than later.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T08:31:50.287

You can still download the source for gcc 2.7.0 from the GNU web site.

You could download and make the older version of the compiler.

# perl - 如何使用 mod_perl 在 CGI::Application 中拥有持久的 DBIx::Class？

> ID：442144
> 
> 赞同：4
> 
> 时间：2009-01-14T06:54:14.227
> 
> 标签：perl, mod-perl, dbix-class, cgiapp

我在带有 DBIx::Class 的 mod_perl 上使用 CGI::Application，我希望在实例化时定义一个新的 dbic 模式。到目前为止，我还无法让它工作。我最接近的是一个超类，它有一个 connect() 方法，它返回一个新对象，但我宁愿它已经被连接和实例化。

我真的很感激任何想法。

谢谢！

**注意**：好的，显然还没有帮助，但是，与此同时，我创建了一个访问器，它可以懒惰地实例化 DBIx::Class，所以这可能会更好一些。核实：

```
sub schema {
    my $self = shift;
    unless ($self->{schema}) {
        $self->{schema} = ACD::Model->connect(@{$self->cfg->{$ENV{MODE}}->{connect_params}});
    }
    return $self->{schema};
} 
```

然后当然要使用它，您可以执行以下操作：

```
$self->schema->resultset('Foo')->find(1234); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-06T00:02:18.503

当然，您不能将数据库连接序列化为会话文件或其他任何内容，也不能在 apache 分叉之前创建它，但您可以让每个子进程保持一个活动状态。

提前创建它的一个选项是在您的基本 mod_perl 处理程序子中执行它，但由于客户端连接已经在此时开始，它不会为您带来任何响应时间改进。

所以我会像上面那样做一个惰性实现，但不是将模式对象缓存在 中`$self`，而是将其缓存在包级别的私有变量中，这意味着每个 apache 子进程都只有一个模式连接：

```
my $_schema;

sub schema {
    return $_schema
        if $_schema; # actually, you should check the db connection is live

    return $_schema = ACD::Model->connect(...);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T08:14:39.997

我没有一个答案，但[http://lists.scsys.co.uk/pipermail/dbix-class/2006-June/001690.html](http://lists.scsys.co.uk/pipermail/dbix-class/2006-June/001690.html)可能值得一读，因此您了解 DBIC 如何管理连接。

# delphi - 如何在 Delphi 的类型库编辑器中进行复制和粘贴？

> ID：442145
> 
> 赞同：0
> 
> 时间：2009-01-14T06:55:57.937
> 
> 标签：delphi, delphi-2006, typelib, com-hell

帮助

我正忙于对 Datasnap 项目中的类型库进行更改。

如何在类型库编辑器中复制和粘贴文本？

Ps 我正在使用 BDS2006

编辑 1

有没有办法在不使用 TLB 编辑器的情况下更改类型库？

编辑 2

有没有办法在类型库编辑器的“属性”和“用户”屏幕中进行复制和粘贴？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-14T08:16:51.300

选择“文本”选项卡并关闭“只读”复选框。然后，您可以将粘贴复制到该选项卡中。

# asp.net - ASP.Net：如何使用 DOM/Javascript 向转发器添加行？

> ID：442151
> 
> 赞同：1
> 
> 时间：2009-01-14T06:58:02.817
> 
> 标签：asp.net, ajax, gridview, updatepanel, repeater

我知道 asp.net 转发器没有客户端对象模型，我们一直致力于提高许多具有转发器/网格视图的页面的性能，这些页面具有通过服务器端代码向它们添加行的功能。

我们已经使用更新面板来 ajaxify 将行添加到转发器/网格视图的功能，但是服务器跳闸和在浏览器上渲染所花费的时间是不可接受的。

有什么方法可以在客户端完成，以提高向转发器/网格视图添加行的性能。我们正在使用 Asp.net 2.0

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T07:14:32.157

UpdatePanels 仍然执行整页回发，然后简单地更新面板内的任何内容。这就是你减速的来源。

至于使用 AJAX 来加快速度，您将希望使用直接 AJAX 调用来仅请求您需要的数据。您可以使用 ASP.NET AJAX 做到这一点。

在 page_load 事件处理程序中，注册您的 AJAX。(VB.NET)

```
Ajax.Utility.RegisterTypeForAJAX(GetType(ThisPageClass)) 
```

然后，创建一个可由 AJAX 访问的函数，如下所示：

```
<Ajax.AjaxMethod()> _
Public Function GetNewRows() As String
    ''//do stuff
    Return jsonObj
End Function 
```

然后，在客户端，您可以这样调用它：

```
ThisPageClass.GetNewRows(someCallbackFunction);

function someCallbackFunction(result) {
    var json = ParseJSON(result.value);
    for(var i=0; i<json.length; i++) {
        // do whatever
    }
} 
```

你只需要塞住这些洞！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T15:13:25.623

我发现Repeater控件没有可用于执行客户端操作（例如添加行和内容）的DOM，唯一简单的出路（由于某些限制）是使用GridView控件代替然后使用它的 DOM，这就是我最终所做的。

# c# - 我可以在 lambda 表达式中调用函数吗？

> ID：442155
> 
> 赞同：8
> 
> 时间：2009-01-14T07:02:46.940
> 
> 标签：c#, lambda

我想做以下事情，但我认为这行不通：

```
.OrderByDescending(s => Score(s)), ...

private double Score(Story s)
        {
            DateTime now = DateTime.Now;
            TimeSpan elapsed = now.Subtract(s.PostedOn);
            double daysAgo = elapsed.TotalDays;

            return s.Votes.Count + s.Comments.Count - daysAgo;
        } 
```

一种。这应该工作吗？湾。如果没有，我是否需要查询这些故事，然后按分数对其进行排序？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-14T07:50:08.123

是的，如果序列是一系列`Story`项目，那应该可以工作；你有什么问题？请注意，如果`Score`不适用于任何实例，则可能值得将其设为静态。

另一种选择是使 Score() 方法成为 a 上的实例方法`Story`或扩展方法。

请注意，这只适用于 LINQ-to-Objects；如果您使用的是 LINQ-to-SQL / LINQ-to-Entities 等，则需要对整个事物使用 lambda，或者（仅在 LINQ-to-SQL 中）使用 UDF 映射函数（在数据上-上下文）来计算值。

使用原始语法的示例（LINQ-to-Objects）：

```
using System.Linq;
using System;
class Story { // declare type
    public DateTime PostedOn { get; set; }
    // simplified purely for convenience
    public int VotesCount { get; set; }
    public int CommentsCount { get; set; }
}
static class Program {
    static void Main() {
        // dummy data
        var data = new[] {
            new Story { PostedOn = DateTime.Today,
                VotesCount = 1, CommentsCount = 2},
            new Story { PostedOn = DateTime.Today.AddDays(-1),
                VotesCount = 5, CommentsCount = 22},
            new Story { PostedOn = DateTime.Today.AddDays(-2),
                VotesCount = 2, CommentsCount = 0}
        };
        var ordered = data.OrderByDescending(s=>Score(s));
        foreach (var row in ordered)
        {
            Console.WriteLine(row.PostedOn);
        }
    }

    private static double Score(Story s) {
        DateTime now = DateTime.Now;
        TimeSpan elapsed = now.Subtract(s.PostedOn);
        double daysAgo = elapsed.TotalDays;
        // simplified purely for convenience
        return s.VotesCount + s.CommentsCount - daysAgo;
    }
} 
```

添加一个`this`（即`Score(this Story s)`），您可以使用：

```
.OrderByDescending(s=>s.Score()) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-14T12:42:20.670

稍加注意，您可以写

```
.OrderByDescending(Score) 
```

因为“Score”的签名满足要求的签名。

# vb.net - VB.NET：如何引用 DataTable？

> ID：442158
> 
> 赞同：0
> 
> 时间：2009-01-14T07:07:25.823
> 
> 标签：vb.net, reference

我正在尝试引用 DataTable，但我不知道如何实现这一点。请帮忙，非常感谢。

在我的代码中，我想通过引用 dtCurr 将 dtTmp 分配给 dtTarget(i)。是否有可能在 VB.NET 中实现这一点？

```
Private dtA, dtB As DataTable

Dim dtTarget() As DataTable = {Me.dtA, Me.dtB}

For i As Integer = 0 To dtTarget.Length - 1

  dtTmp = New DataTable()
  'Do something to dtTmp

  'assign the new table to the reference
  dtTarget(i) = dtTmp      

Next 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T07:45:57.040

`dtCurr = dtTmp`更改 dtCurr 的引用，这是您以后不使用的指针。尝试写`dtTarget(i) = dtTmp`而不是最后一行。

# c# - 将数据插入 SQL 表

> ID：442159
> 
> 赞同：1
> 
> 时间：2009-01-14T07:08:57.973
> 
> 标签：c#, sql, stored-procedures, insert

我的 DataTable 中的数据就像

```
ID ContactName1  Designation1 ContactName2 Designation2
1  A             dummy        B            sam 
```

我的表的表结构是

```
ID ContactName Designation 
```

我将存储过程中的值传递为：

```
@ContactName1
@Designation1

@ContactName2
@Designation2 
```

我想要一个插入语句来插入记录。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T07:41:52.960

假设您的 ID 主键设置为自动递增，并且您的表具有三个字段：

```
INSERT INTO DataTable (ContactName, Designation) VALUES 
    (@ContactName1, @Designation1), 
    (@ContactName2, @Designation2); 
```

根据实际 ID，如果您没有自动增量，从 Ivan 的回复的评论来看，您没有，您实际上可以使用 MAX() 语句获取它：

```
SELECT MAX(ID) AS max_id FROM DataTable 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T07:41:53.740

既然它在一个存储过程中，你为什么要关心它是一个还是两个 INSERT 语句？显然，两个陈述是微不足道的。

一些 DBMS 允许您在单个 INSERT 中列出多个值子句（@Ivan 建议这样做）：

```
INSERT INTO Table(ID, ContactName, Designation)
    VALUES(1, @ContactName1, @Designation1)
    VALUES(1, @ContactName2, @Designation2); 
```

我不确定值列表之间是否需要逗号。我也不清楚是否允许 Table 中的两条记录具有相同的 ID，也不清楚 ID 是如何确定的——这可能是一些自动增量的东西，不同的 DBMS 也有不同的做法。

如果您的 DBMS 不支持单个 INSERT 语句中的多个 VALUES 子句，那么您最好接受两个 INSERT 语句。如果原子性是一个问题，您可以考虑事务 - 尽管如果这只是更大事务的一部分，特别是错误时的 ROLLBACK 将是一个问题。如果您的 DBMS 支持 SAVEPOINTS，则该过程可以在进入时建立一个保存点，并在退出时提交或回滚到该保存点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-17T06:53:36.063

INSERT INTO TABLENAME VALUES（根据数字和顺序给出值，以逗号分隔）

前任：-

`INSERT INTO TABLENAME VALUES(1,'INDIA')`

这里有两列 SN 和国家

# svg - 如何在 SVG 中获得文本的轮廓效果？

> ID：442164
> 
> 赞同：55
> 
> 时间：2009-01-14T07:12:11.727
> 
> 标签：svg

我只想要一个简单的 SVG 图像，它在某个角度上有一些任意文本，我可以做到。问题是，我还希望文本具有某种“轮廓”效果。与实心 D 不同，字母 D 的内边缘和外边缘是用指定粗细的线绘制的，而 D 的其余部分根本不绘制，因此看起来几乎是“空心的”。

SVG可以做到这一点吗？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2014-10-22T00:59:47.787

绘画顺序：笔画；在我正在处理的这个 D3 图表中为我创造了奇迹。

我的最终CSS：

```
.name-text {
    font-size:  18px;
    paint-order: stroke;
    stroke: #000000;
    stroke-width: 1px;
    stroke-linecap: butt;
    stroke-linejoin: miter;
    font-weight: 800;
} 
```

我的来源（向下滚动一点）： [https ://svgwg.org/svg2-draft/painting.html#PaintOrderProperty](https://svgwg.org/svg2-draft/painting.html#PaintOrderProperty)

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-01-14T07:17:47.173

是的，它可以 ;-）

我试图用[Inkscape](http://www.inkscape.org)实现这一点，然后编辑了 svg 文件的源代码。只是不要填充它并使用具有颜色和宽度的笔触来绘制它。我明白了：

```
<text x="100" y="100" id="text2383" xml:space="preserve" style="font-size:56px;font-style:normal;font-weight:normal;fill:none;fill-opacity:1;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans">
<tspan x="100" y="100" id="tspan2385">D</tspan></text>
```

有趣的部分在“style”属性中。

```
"fill:none;fill-opacity:1;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;" 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2017-09-08T19:13:44.137

您可以`<filter>`为此使用 a ，更具体地说是与 的组合`<feMorphology>`：

```
<svg style="height:100px;width:100%;background-color:Green">

<defs>
<filter id="whiteOutlineEffect" color-interpolation-filters="sRGB">
  <feMorphology in="SourceAlpha" result="MORPH" operator="dilate" radius="2" />
  <feColorMatrix in="MORPH" result="WHITENED" type="matrix" values="-1 0 0 0 1, 0 -1 0 0 1, 0 0 -1 0 1, 0 0 0 1 0"/>
  <feMerge>
    <feMergeNode in="WHITENED"/>
    <feMergeNode in="SourceGraphic"/>
  </feMerge>
</filter>
</defs>

<g>
  <text x="10" y="50" fill="black" font-size="60" filter="url(#whiteOutlineEffect)">
    Example
  </text>
</g>

</svg>
```

您可能必须调整过滤器的`x`///属性以适应过滤器画布大小，另请参阅< [filter> 的巨大高度值不防止](https://stackoverflow.com/q/46120700/2261442)[边缘处的](https://stackoverflow.com/q/6555600/2261442)截止或高斯模糊截止。`y``width``height`

我还创建了一个交互式[d3.js 驱动](https://d3js.org/)的演示，以比较此线程中提供的不同解决方案和各种设置：[https ://bl.ocks.org/Herst/d5db2d3d1ea51a8ab8740e22ebaa16aa](https://bl.ocks.org/Herst/d5db2d3d1ea51a8ab8740e22ebaa16aa)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-18T13:40:34.810

SVG 中的图形对象可以有填充（默认为黑色）和描边（默认为无）。如果你想在你的文本上有红色轮廓，那么设置 fill="none" 和 stroke="red"。您可能还想调整 stroke-width 属性的值。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-04-25T05:56:57.373

此处给出了轮廓和发光的另一个示例：http: [//www.w3.org/People/Dean/svg/texteffects/index.html](http://www.w3.org/People/Dean/svg/texteffects/index.html)

```
<svg width="350" height="75" viewBox="0 0 350 75"><title>MultiStroke</title><rect x="0" y="0" width="350" height="75" style="fill: #09f"/><g style="overflow:hidden; text-anchor: middle; font-size:45; font-weight: bold; font-family: Impact"><text x="175" y="55" style="fill: white; stroke: #0f9; stroke-width: 14">
    Stroked Text
    </text><text x="175" y="55" style="fill: white; stroke: #99f; stroke-width: 8">
    Stroked Text
    </text><text x="175" y="55" style="fill: white; stroke: black; stroke-width: 2">
    Stroked Text
    </text></g>
</svg> 
```

# perl - 如何让 mod_perl 在更改时重新加载源文件？

> ID：442166
> 
> 赞同：6
> 
> 时间：2009-01-14T07:13:53.877
> 
> 标签：perl, apache, mod-perl

我正在使用 mod `_`perl 开发一个应用程序，每次更改代码时都重新启动服务器是一个巨大的拖累。我想仍然使用 mod `_`perl 进行开发，因为它是我计划用于实时服务器的。我在文档中没有看到有关如何执行此操作的任何内容。

想法？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-14T07:22:46.760

我认为 Apache2::Reload 会在一定程度上完成你正在寻找的东西。但是，一旦您准备好将应用程序投入生产，请记住删除所有这些实现。

**监控 %INC 中的所有模块**

要在请求处理开始时监视和重新加载 %INC 中的所有模块，只需将以下配置添加到您的 httpd.conf：

```
PerlModule Apache2::Reload
PerlInitHandler Apache2::Reload 
```

使用连接过滤器和协议模块时，应在 pre_connection 阶段调用 Apache2::Reload：

```
PerlPreConnectionHandler Apache2::Reload 
```

**隐式注册模块**

要仅重新加载已向 Apache2::Reload 注册的模块，请将以下内容添加到 httpd.conf：

```
PerlModule Apache2::Reload
PerlInitHandler Apache2::Reload
PerlSetVar ReloadAll Off
# ReloadAll defaults to On 
```

然后任何带有该行的模块：

```
use Apache2::Reload; 
```

当他们改变时将被重新加载。

有关信息，请查看[此文档页面](http://theory.uwinnipeg.ca/modperl/docs/2.0/api/Apache2/Reload.html)。希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-28T15:54:39.997

我使用 Perrin Harkins 通过 PerlMonks 提供的这个解决方案：

> 将 MaxRequestsPerChild 设置为 1，然后在子节点中加载任何可能发生变化的模块，而不是父节点（显然仅适用于开发环境）。每个请求都会到达一个新的子服务器，它会重新加载所有可能发生变化的模块。

来自“[在运行的 Web 服务器中查看模块更改的更好方法](http://www.perlmonks.org/bare/?node_id=794860)”

# sql-server - 获取存储在 SQL Sproc 中的变量名的值

> ID：442174
> 
> 赞同：1
> 
> 时间：2009-01-14T07:20:21.880
> 
> 标签：sql-server, tsql, stored-procedures

这就是我想要做的

```
  Declare @Var varchar(50)
Declare @Num1 varchar(50)
Declare @Num2 varchar(50)
Declare @Counter smallint

Set @Counter=1
Set @Num1='Hello'
Set @Num2='Hi'

while (@Counter<2)
 begin
   Set @Var=N'@Num'+convert(varchar,@Counter)
   //Now I want to get the value of '@Num1' that is stored in @Var when @Counter=1
   //Help Needed
 Set @Counter=@Counter+1
 end 

```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-11-21T13:59:56.580

对于您的问题，这不是一个非常优雅的解决方案，但至少它解决了它:)

```
 Declare @Var varchar(50)
 Declare @Num1 varchar(50)
 Declare @Num2 varchar(50)
 Declare @Counter smallint
 Declare @text varchar(50)

 Set @Counter=1
 Set @Num1='Hello'
 Set @Num2='Hi'

 while (@Counter<3)
 begin
 SET @text =
     CASE @Counter 
          WHEN 1 THEN @Num1
          WHEN 2 THEN @Num2
     END
 Set @Counter=@Counter+1
 print @text
 end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T07:26:57.173

AFAIK，你不能直接这样做；有什么问题，例如：

```
SET @Var = SELECT CASE @Counter WHEN 1 THEN @Num1 ELSE @Num2 END 
```

如果您有很多值，请考虑使用`#table`（临时表）或`@table`（表变量） - 即

```
DECLARE @Data TABLE ([Key] int NOT NULL, [Value] varchar(50)) 
```

然后只是`INSERT`/`UPDATE`进入`@DATA`

```
SELECT @Var = [Value] FROM @Data WHERE [Key] = @Counter 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-14T07:27:34.207

@Num1 的值将始终为“Hello”。原因是您只是将一个字符串存储到@Var 中。

# html - 用 HTML 表示舞台脚本的最佳方式是什么？

> ID：442176
> 
> 赞同：30
> 
> 时间：2009-01-14T07:21:21.583
> 
> 标签：html, css, layout, html-table

我有一个草图想放在我的网站上，我还打算在某个时候写一个短剧，我也想免费提供。

我正在尝试找出用 HTML 表示它的最佳方式。我基本上需要两列——一列用于说话的角色，一列用于文本。不过，每个演讲显然都需要与演讲者保持一致。换句话说，是这样的：

```
    Jeff 这确实是我们现在拥有的一个不错的网站。

    乔尔 当然是。顺便说一句，在 FogCreek 工作。

    杰夫 当然可以。你玩过摇滚乐队吗？它是
                 多开心。

```

（嗯，它比 lorem ipsum 更好......）

我知道如何使用 HTML 表格（每个演讲一个表格行）来做到这一点，但这看起来很丑陋，而且每个人似乎都热衷于使用 CSS 来表示非表格数据。我看不出这是如何真正计算表格数据的——我之前对“行”和“列”的使用是与布局有关，而不是与基本数据有关。

那么，有什么想法吗？我认为我见过的大多数脚本网站（当然不是很多）要么`<pre>`像我上面的例子那样使用，要么不费心尝试保持正常的脚本格式，而只是在每个段落前加上演讲者的名字。（有关这种风格的示例，请参阅 podcast wiki。）坦率地说，我什至无法确定应该使用哪些 HTML 元素来表示这一点 - 一个字典定义列表，其中说话者作为术语，演讲作为定义可能是我想到的最接近的，但这感觉像是虐待。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-01-14T07:42:29.607

更合适（语义上）和更短的是使用定义列表：

```
dl {
  overflow: hidden;
}

dl dt {
  float: left;
  width: 30%;
}

dl dd {
  float: left;
  width: 70%;
}
```

```
<dl>
  <dt>Jeff</dt>
  <dd>This sure is a nice website we've got now.</dd>
  <dt>Joel</dt>
  <dd>It certainly is. By the way, working at FogCreek rocks.</dd>
  <dt>Jeff</dt>
  <dd>Of course it does. Have you played Rock Band yet? It's a lot of fun.</dd>
</dl>
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-14T19:41:23.150

我会说

```
<dialog>
  <dt>Jeff
  <dd>This sure is a nice website we've got now.
  <dt>Joel
  <dd>It certainly is. By the way, working at FogCreek rocks.
  <dt>Jeff
  <dd>Of course it does. Have you played Rock Band yet? It's a lot of fun.
</dialog> 
```

[如HTML5](http://www.whatwg.org/specs/web-apps/current-work/multipage/semantics.html#the-dialog-element)中定义的那样。

当然，你需要 a`<script>document.createElement('dialog');</script>`让 IE 做一些明智的事情，并`dialog { display:block; }`在你的 CSS 中让它完全工作。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-14T10:45:00.750

我最喜欢这样标记的示例是 Tantek 的 XHTML 化合物之一[http://tantek.com/presentations/2005/03/elementsofxhtml/](http://tantek.com/presentations/2005/03/elementsofxhtml/)（查看对话位）

总而言之，它是这样的：

```
<ol>
  <li><cite>Jeff</cite>
    <blockquote><p>This sure is a nice website we've got now.</p><blockquote>
  </li>
  <li><cite>Joel</cite>
    <blockquote><p>It certainly is. By the way, working at FogCreek rocks.</p></blockquote>
  </li>
  ...etc...
</ol> 
```

不知道你会如何标记舞台方向等......也许你最终会创建一个新的微格式:)

此外，该标记具有一些理想的 CSS 钩子，与定义列表不同，具有离散的 LInes。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-14T09:00:16.233

我支持异端：-)

在使用表格之前考虑 CSS 总是好的——但通常表格确实是最合适的。在这种情况下看起来像。

唯一的额外考虑是可访问性。我听说表格使文本阅读器软件更难处理表格​​，但我不明白为什么会这样（如果您了解更多，请随时在此处发表评论）。

另一件事——我想你会首先以其他格式保存原始数据——可能是数据库、xml 或其他结构化文本？

无论如何，在玩这些东西时，将其转换为 xml 格式并使用 xslt 将其转换为 html 可能会非常自由。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-14T07:35:06.063

IMO 实际上是表格数据。第一列是扬声器，第二列是文本。

但是，如果您想变得时尚并积极避开桌子，那么我认为符合网络专家本季规定的结构如下：

```
<div class="play">
  <div class="line">
    <div class="speaker">Jeff</div>
    <div class="text">This sure is a nice website we've got now. </div>
  </div>
  <div class="line">
    <div class="speaker">Joel</div>
    <div class="text">It certainly is. By the way, working at FogCreek rocks.</div>
  </div>
</div> 
```

然后，您可以使用适当的 CSS 控制它的布局方式。

如果看起来您基本上是在编写 XML 并使用 CSS 来指定其布局方式，那是因为 Web 专家认为您应该这样做，AFAICT。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-14T07:41:31.790

我会使用标题和段落。

使用以下样式，它会在您呈现时排列：

```
.play h2 {
  float: left;
  clear: left;
  width: 100px;
  margin: 0;
}

.play p {
  margin-left: 100px;
}
```

```
<div class="play">
  <h2>Jeff</h2>
  <p>This sure is a nice website we've got now.</p>

  <h2>Joel</h2>
  <p>It certainly is. By the way, working at FogCreek rocks.</p>

  <h2>Jeff</h2>
  <p>Of course it does. Have you played Rock Band yet? It's<br /> a lot of fun.</p>
</div>
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-14T09:04:04.603

请避免“大锤综合症”（如果您唯一的工具是锤子，那么您会尝试像钉子一样对待每一个问题）。HTML 是一种*表示*语言，而不是*源*语言。

所以我的建议是用最能代表你想法的东西（不一定是 XML）来编写剧本，然后将其转换为 HTML。对于我自己的作品，我使用了一个递归 XML 解析器，它可能无法对某些元素进行 XML 解析：

```
<content><<Hello,>> Forne smiled and thought: <<T Idiot.>></content> 
```

我的解析器将调用自定义解析器来解析`<content>`. 在我的例子中，它将创建一个中间 XML 树：

```
<content><say>Hello,</say> <char>Forne</char> smiled and thought: <think>Idiot.</think></content> 
```

然后将这棵树转换为 HTML、TeX、PDF 等等。

[编辑] 我想出一种紧凑语言的策略是这样的：我从 XML 开始。过了一会儿，我查看了 XML 并尝试查看模式。然后我想如何以更紧凑的方式表达这些模式 1.) 作为 XML，2.) 作为 XML 文本（带有自定义标记）和 3.) 完全不同的东西。当我想到一个想法时，我会为新格式编写一个解析器。

坦率地说，今天，编写可以将某些内容转换为 XML 以进行自动后台处理的解析器是一项小任务。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2018-09-04T08:21:10.440

# [对话](https://www.w3.org/TR/html52/common-idioms-without-dedicated-elements.html#conversations)的 HTML 5.2 建议

> 鼓励作者使用`p`元素和标点符号来标记对话。鼓励需要为样式目的标记扬声器的作者使用`span`或`b`。包含在元素中的文本的段落`i`可用于标记舞台方向。

## 带有最少标记的示例对话

```
<article class=stage-script>
  <h1>Water Cooler Talk at FogCreek</h1>

  <p><b>Jeff</b> This sure is a nice website we've got now.

  <p><b>Joel</b> It certainly is. By the way, working at FogCreek rocks.

  <p><b>Jeff</b> Of course it does. Have you played Rock Band yet? It's a lot of fun.

  <p><i>Joel and Jeff walk into the sunset</i>
</article> 
```

## 对话的 CSS

```
.stage-script > p > b:first-child {
    display: inline-block;
    width: 5em;
}
.stage-script > p > b:first-child::after {
    content: ':';
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-14T07:50:59.197

表是要走的路。

像使用 <div>s 和 css 或 XSLT 之类的其他任何事情都只是重新发明了 <table>，但使用了 ac**p 语法。

我会选择三到四个固定宽度的列。（任何不平凡的戏剧都需要舞台指导、特效、音效等）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-14T22:25:41.740

你不会得到这个问题的明确答案，因为 HTML 有很多差距，其中之一就是这个 - 网络上散布着一些关于他的主题的非常可靠的文章，一个好的起点是[Bruce Lawson 的文章来自2006 年](http://www.brucelawson.co.uk/2006/breaking-news-w3c-specs-are-not-word-of-god/)。

考虑到这个问题没有答案，我们能做的最好的就是看看我们可以使用哪些元素，并根据我们（和社区）对指南的解释做出我们自己的妥协。

我个人喜欢`cite`/`blockquote`和数据列表路由。我知道数据列表没有语义标记，但我真的相信数据列表的目的不是纯粹以字典方式列出数据定义，而是在`ul`s 和`ol`s 不能的地方配对数据。

我花了很多时间思考语义，在查看所有标记问题时，我（以及该领域的大多数其他人）确信的一件事是表格不是 99.9% 标记问题的答案（如果它不是您可以使用的表格数据`th`，`caption`那么表格应该真的从您的库存中删除）。也就是说，我还要说专门使用`div`s 也可能不是正确的答案。

我非常怀疑这个问题中的投票是否会反映最佳方法，但更有可能反映基于选民当前知识和 HTML 使用的方法的协议。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-10-24T23:38:49.107

在这种情况下，我将只使用*div*元素，以及描述域的好类。您可以上下争论使用各种 HTML 元素来提供更好的意图语义含义，但例如在*dialog*元素的情况下，它*不是*用于在戏剧中的角色之间编写对话，但是它是有意的向用户显示一个对话框以进行交互。但是，您可以在 CSS 中根据您的心愿更改和设置该元素的样式这一事实非常棒 - 但我不建议您这样做。

原因很简单，除非您小心，否则您会为每个此类元素覆盖该行为和外观。假设这是一个剧作家的交互式应用程序，您可能希望在剧中除了“对话”之外还包括对话。

我提出这个解决方案：

```
.character{
  display: block;
  float: left;
}

.line{
  margin-bottom: 20pt;
  width: 400px;
  margin-left: 50pt;
} 
```

使用以下 HTML：

```
<div class="character">Jeff</div>
<div class="line">This sure is a nice website we've got now.</div>
<div class="character">Joel</div>
<div class="line"> It certainly is. By the way, working at FogCreek rocks.</div>
<div class="character">Jeff</div>
<div class="line">Of course it does. Have you played Rock Band yet? 
  <br/>It's a lot of fun.</div> 
```

运行 JSFiddle：[https ://jsfiddle.net/quz9cj2f/6/](https://jsfiddle.net/quz9cj2f/6/)

现在你实际上可以实现一些标准的播放格式，我从这个地方删减了：http: [//ptfaculty.gordonstate.edu/lking/CPF_play_formatting2.pdf](http://ptfaculty.gordonstate.edu/lking/CPF_play_formatting2.pdf)

```
.play {
  font-family: courier;
}
.play{
  margin-top: 1in;
  margin-left: 1.5in;
  margin-right: 1in;
  margin-bottom: 1in;
}
.character {
  display: block;
  margin-left: 4in;
  text-transform: uppercase;
}
.direction:before{
  margin-left: 2.75in;
  content: "(";
}
.direction:after{
  content: ")";
}
.line {
  margin-bottom: .3in;
} 
```

使用此 HTML：

```
<div class="play">
  <div class="character">Jeff</div>
  <div class="direction">JEFF is enthusiastic!</div>
  <div class="line">This sure is a nice website we've got now.</div>
  <div class="character">Joel</div>
  <div class="direction">Jumping continuously</div>
  <div class="line"> It certainly is. By the way, working at FogCreek rocks.</div>
  <div class="character">Jeff</div>
  <div class="line">Of course it does. Have you played Rock Band yet?
    <br/>It's a lot of fun.</div>
</div> 
```

工作 JSFiddle：[https ://jsfiddle.net/quz9cj2f/9/](https://jsfiddle.net/quz9cj2f/9/)

或者您可以全力以赴并使用 CSS 属性选择器并为元信息创建自定义属性：

```
.play {
  font-family: courier;
}
.play{
  margin-top: 1in;
  margin-left: 1.5in;
  margin-right: 1in;
  margin-bottom: 1in;
}
.character {
  display: block;
  margin-left: 4in;
  text-transform: uppercase;
}
.line[direction]:before{
  margin-left: 2.75in;
  content: "(" attr(direction) ")";
  display: block;
}

.line {
  margin-bottom: .3in;
} 
```

现在您已经摆脱了额外的元素，并将元信息添加为属性 - 现在您可以很容易地将其从 JSON 或 XML 或其他交换格式的某种不错的数据结构转换为：

```
<div class="play">
  <div class="character">Jeff</div>
  <div direction="Enthusiastic" class="line">This sure is a nice website we've got now.</div>
  <div class="character">Joel</div>
  <div direction="Shaking his head" class="line"> It certainly is. By the way, working at FogCreek rocks.</div>
  <div class="character">Jeff</div>
  <div class="line">Of course it does. Have you played Rock Band yet?
    <br/>It's a lot of fun.</div>
</div> 
```

[https://jsfiddle.net/quz9cj2f/11/](https://jsfiddle.net/quz9cj2f/11/)

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2009-01-14T10:05:22.767

如果你想在语义上做到这一点，我会使用标签，比如：

```
<div class="script">
<label for="Jeff1">Jeff<label>
<div id="Jeff1">
  <p>This sure is a nice website we've got now.</p>
</div>

<label for="Joel1">Joel</label>
<div id="Joel1">
  <p>It certainly is.</p>
  <p>By the way, working at FogCreek rocks.</p>
</div>

<label for="Jeff2">Jeff</label>
<div id="Jeff2">
  <p>Of course it does.</p>
  <p>Have you played Rock Band yet? It's a lot of fun.</p>
</div>

</div> 
```

这会很好地退化，我认为这个标签更适合你想要做的事情。然后，在您的样式表中，我会将其设置为类似于 Eran Galperin 的示例 CSS 的样式。

如果您对此很认真，我的另一个建议是进一步研究死树脚本的编写方式，并尽最大努力保持其风格。这将有助于确保您的观众看起来熟悉（阅读专业）。

# asp.net - 如何从客户端在链接按钮控件上设置 postbackurl？

> ID：442185
> 
> 赞同：0
> 
> 时间：2009-01-14T07:31:19.237
> 
> 标签：asp.net

我在 aspx 页面上有一个服务器控件（ linkbutton ）。

由于一些复杂的原因 - 我需要从**客户端**为这个按钮设置 postbackurl。

有没有办法从客户端设置回发网址？

我得到了一些对 javascript:WebForm_DoPostBackWithOptions 方法的参考，但不确定如何最好地使用它。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-14T07:56:54.427

您可以使用 更改表单的目标`window.document.forms[0].target='otherpage.aspx'`。
您可能还需要取消发布到的页面上的事件验证。

# c# - 更改 ItemsSource 后，如何让 Silverlight ComboBox 调整下拉列表的大小？

> ID：442187
> 
> 赞同：2
> 
> 时间：2009-01-14T07:33:07.253
> 
> 标签：c#, data-binding, combobox, silverlight-2.0

网上有很多关于此问题的帖子，其中 ComboBox 仅更改其下拉高度以适应其第一个下拉列表中的项目。对所示项目的任何更改都不会导致下拉菜单调整大小。我发现的各种解决方法似乎对我不起作用，所以我想知道是否有人找到了解决这个问题的方法。

我当前的选择是使用 MinHeight 并将其设置为合理的大小（如果我设置 MinHeight 和 MaxHeight，我会遇到与设置 Height 相同的问题 - 当项目超出范围时没有滚动条。

我试过改变物品的容器，但似乎它们都有这个问题。有任何想法吗？

请注意，每当我按照几个论坛的指示更改 ItemsSource 时，我也尝试以编程方式重新创建组合，但我无法让它在不崩溃的情况下工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T15:12:59.843

“添加和删除”方法对我有用。这就是我要做的（如果你做的事情略有不同，或者其他人想尝试这种方法）：

* * *

*   读取并在本地存储您感兴趣的所有属性
*   从可视化树中移除组合框
*   将变量设置为空
*   创建一个新的组合框
*   恢复您在上面存储的属性
*   带走你最先想到的数字
*   将其添加回可视化树

例如：

```
string lName = lComboBox.Name;
DataTemplate lTemplate = lComboBox.ItemTemplate;
Thickness lMargin = lComboBox.Margin;
// Other properties

LayoutParent.Children.Remove(lComboBox);

lComboBox= null;
lComboBox= new ComboBox(){
    Name = lName,
    ItemTemplate = lTemplate,
    Margin = lMargin,
    ItemsSource = lList // Your datasource
};

LayoutParent.Children.Add(lComboBox); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-10T13:47:27.580

多亏了[这个答案](https://stackoverflow.com/questions/799403/silverlight-combobox-number-of-items-shown-refresh/812266#812266)，我找到了一个很好的解决方案。它工作得很好，不像其他建议那么老套（虽然有效）。

显然，社区 wiki-ing 这篇文章，因为这不是我的答案。请为真正的答案投票，[markti](https://stackoverflow.com/users/79749/markti)值得为此获得双重代表。

# python - Python 中的 ReadInt()、ReadByte()、ReadString() 等？

> ID：442188
> 
> 赞同：6
> 
> 时间：2009-01-14T07:34:04.677
> 
> 标签：python

函数 ReadInt()、ReadByte() 和 ReadString()（仅举几例）存在于其他语言中，用于从流中读取输入。我正在尝试从套接字读取，并且我想使用这些函数。他们是以不同的方式隐藏在 Python 中的某个地方，还是有人为它制作了一个库？

此外，还有 Write *datatype* () 对应项。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-12-02T18:37:08.683

Python 的方式是使用 struct.unpack 读取二进制数据。我非常习惯 C# 中的 BinaryReader 和 BinaryWriter，所以我做了这个：

```
from struct import *

class BinaryStream:
    def __init__(self, base_stream):
        self.base_stream = base_stream

    def readByte(self):
        return self.base_stream.read(1)

    def readBytes(self, length):
        return self.base_stream.read(length)

    def readChar(self):
        return self.unpack('b')

    def readUChar(self):
        return self.unpack('B')

    def readBool(self):
        return self.unpack('?')

    def readInt16(self):
        return self.unpack('h', 2)

    def readUInt16(self):
        return self.unpack('H', 2)

    def readInt32(self):
        return self.unpack('i', 4)

    def readUInt32(self):
        return self.unpack('I', 4)

    def readInt64(self):
        return self.unpack('q', 8)

    def readUInt64(self):
        return self.unpack('Q', 8)

    def readFloat(self):
        return self.unpack('f', 4)

    def readDouble(self):
        return self.unpack('d', 8)

    def readString(self):
        length = self.readUInt16()
        return self.unpack(str(length) + 's', length)

    def writeBytes(self, value):
        self.base_stream.write(value)

    def writeChar(self, value):
        self.pack('c', value)

    def writeUChar(self, value):
        self.pack('C', value)

    def writeBool(self, value):
        self.pack('?', value)

    def writeInt16(self, value):
        self.pack('h', value)

    def writeUInt16(self, value):
        self.pack('H', value)

    def writeInt32(self, value):
        self.pack('i', value)

    def writeUInt32(self, value):
        self.pack('I', value)

    def writeInt64(self, value):
        self.pack('q', value)

    def writeUInt64(self, value):
        self.pack('Q', value)

    def writeFloat(self, value):
        self.pack('f', value)

    def writeDouble(self, value):
        self.pack('d', value)

    def writeString(self, value):
        length = len(value)
        self.writeUInt16(length)
        self.pack(str(length) + 's', value)

    def pack(self, fmt, data):
        return self.writeBytes(pack(fmt, data))

    def unpack(self, fmt, length = 1):
        return unpack(fmt, self.readBytes(length))[0] 
```

一旦你有一个流，你把它放在 BinaryStream 构造函数中，你得到一个 BinaryStream :)

例子：

```
from binary import BinaryStream

f = open("Users", "rb")
stream = BinaryStream(f)
users_count = stream.readUInt64()
for i in range(users_count):
    username = stream.readString()
    password = stream.readString() 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-14T07:38:17.383

我认为[struct.unpack_from](http://docs.python.org/library/struct.html#struct.unpack_from)是你要找的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-03-19T13:30:37.033

我使用了 Zippoxer 的代码，它几乎适用于所有事情，谢谢。

但是我对 readString() 有一些问题。在 C# 文档中指定长度编码为 7 个字节。因此我使用了 readUChar 而不是 readUInt16：

```
def readString(self):
    length = self.readUChar()
    return self.unpack(str(length) + 's', length) 
```

现在可以了。也许它特定于我的问题？但它可能会帮助某人......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T11:40:01.653

请注意，Python 没有 readByte、readInt 和 readString，因为它不能直接处理所有这些花哨的数据类型。文件提供了可以转换的字符串。

Python `<=`2.6 有字符串，这就是你从输入流中得到的——字符串。简单`socket.read()`提供此输入。您可以使用`struct`将流转换为整数序列。重要的是打包和解包转换可以按字节、字、长或其他方式进行，但 Python 结果是整数。

所以你的输入可能是字节，但 Python 将它表示为一个字符串，其中大部分是不可打印的。您的愿望可能是一个单独的值数组，每个值都在 0 到 255 之间，它们是这些字节的数字版本。Python 将这些表示为整数。

Python `>=`3.0 具有可用于直接处理字节的字节数组。您可以将它们转换为字符串或整数（包括字节和长整数）或其他任何内容。

# algorithm - 您如何实现 Stackoverflow.com 中使用的相关标签功能？

> ID：442201
> 
> 赞同：6
> 
> 时间：2009-01-14T07:40:22.357
> 
> 标签：algorithm

您如何实现许多网站（如我们的 stackoverflow.com 和[http://tagexplorer.sandbox.yahoo.com/](http://tagexplorer.sandbox.yahoo.com/) ）中使用的“相关标签”功能。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-14T07:44:04.830

我的猜测是，这是最常一起使用的标签之间的相关性。

例如：

*   用 tag1、tag2 标记的问题 A
*   用 tag1、tag3 标记的问题 B
*   用 tag1、tag2 标记的问题 C

然后很自然地假设tag2“与”tag1“相关”。

我想说最好的学习场所是[O'Reilly 的 Programming Collective Intelligence 书](http://my.safaribooksonline.com/9780596529321)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T07:45:04.937

我想到了几种方法。你可以做一个快速查询来选择相关的标签名称：

```
SELECT * FROM tags WHERE tag_name LIKE '%$current_tag%' 
```

另一种方法是实际设置您的标签表以具有关系字段，可能是用逗号分隔的相关 ID，但这似乎很难维护。

我相信有人会想出更好的答案，所以我也很好奇。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T07:52:13.737

嗯，我不是很擅长数学:-)，但听起来你正在寻找两个标签之间的[相关性。](http://en.wikipedia.org/wiki/Correlation)我的第一直觉是将期望值设置为 50%（期望每个标签出现在 50% 的文章上——这可能会偏离），成对计算标签的相关系数并确定相关性是否高于一定的值（你必须通过实验来确定），它们是相关的。

或者，您可以通过使用简单的度量来获得，例如（它们共同出现的文章数量）/（至少出现一个标签的文章总数）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-14T13:53:38.000

也许如此跟踪有多少时间标签在一起

1.  我插入带有标签 A + B 的 Q1，因此 relationshipWeight(A,B) = 1

2.  我插入带有标签 A + B 的 Q2 所以 relationWeight(A,B) = 2

3.  现在我删除 Q1 和 Q2。当relationWeight = 0时，我必须知道“relationWeight”才能取消关联标签

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2010-06-02T13:47:19.357

利用：

```
(DataAccessDataContext db = new DataAccessDataContext())
        {
            Repeater1.DataSource = from rt in db.RelatedTags where st.ITEMID == itemid select new TagView() { ID = rt.Tag.ID, NAME = rt.Tag.NAME };
            Repeater1.DataBind();            
        }

///:) 
```

# visual-studio-2008 - VS2008 SP1：按 F5 需要很长时间才能启动网站

> ID：442213
> 
> 赞同：0
> 
> 时间：2009-01-14T07:45:45.887
> 
> 标签：visual-studio-2008, silverlight, model-view-controller, debugging

我有一个 Silverlight 项目（带有 ASP.net MVC Web 项目）

突然，当我按下 F5 时，从打开 Internet Explorer 到连接调试器需要 20 秒。请注意，这是一个自大约 3 个月以来就完美运行的项目。问题是前几天才开始的。

当我在没有调试的情况下开始时，一切都运行得很好。

关于如何解决这个问题的任何指示？

编辑：当我查看输出窗口时，它所做的只是加载所有不同的程序集，但一次一个，速度非常缓慢......

另请注意，即使在调试时，其他项目似乎也可以正常启动。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-14T08:55:13.657

几个月前我遇到了同样的问题，我浏览了几个小时，找到了不同的解决方案，最后解决方案真的很简单——只需单击“调试”->“删除所有断点”。对我来说这很奇怪，因为我没有任何我知道的断点......但是它起作用了......我已经手动删除了它们，但是在从菜单中选择删除所有断点之后它又开始正常工作了......

希望它有所帮助......因为这是我遇到过的最烦人的问题 VS :)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T08:09:31.407

在尝试使用“F5”运行 Web 应用程序时，我也看到了随机缓慢。我认为很多原因是由于 VS2008 中的客户端调试功能似乎需要一些时间才能加载。您最近是否向您的项目添加了任何大型 javascript 库？

我们大多数人只是在没有调试的情况下启动 Web 应用程序，然后在需要时将调试器附加到工作进程。因为大多数时候我们不需要调试器功能。如果我们需要客户端调试，我们使用 firebug 或 IE 开发工具栏。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T00:09:52.850

如果（像许多公司一样）您的“我的文档”目录映射到网络驱动器，我已经看到了一个减速问题。Visual Studio 在此处存储了几个设置，这可能会在调试时稍微增加延迟。将其更改回本地驱动器，您可能会看到改进，这也可能扩展到其他应用程序。

# web-applications - 用于 Web 应用程序的 Java、Python 或 Ruby？

> ID：442216
> 
> 赞同：32
> 
> 时间：2009-01-14T07:47:21.843
> 
> 标签：web-applications

如果我今天要从头开始实现一个 Web 应用程序，我应该选择哪个应用程序堆栈？三个主要候选者是 java、python 和 Ruby on Rails (RoR)。还有.NET，但它偏向于M$。

亲java：

```
1) Stacks of thick books
2) Largest developer community
3) Typed languages, which prevents subtle bugs
4) Augmented with groovy interpreted language 
```

亲python：

```
1) Concise code
2) Thin books
3) Can launch web app for free on Google Apps 
```

亲RoR：

```
1) Concise code
2) Thin books
3) Ruby may be slightly better programming language than python, but they are converging. 
```

总的来说，python/RoR之间没有太多选择。我必须在 Java 和 Python 之间做出选择。我稍微偏爱java，因为它是一种类型语言，但我的好朋友偏爱python，因为它更简洁。厚厚的 Java 书籍是否意味着它的解决方案更全面（而且我必须自己编写更少的代码）？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-14T08:13:56.033

*背景：我是一名专业的 Java 开发人员，一边做 Django。*

**爪哇**

Java主要在企业中使用，这是有很好的理由的。如果您需要一种成熟的语言，Java 是一个很好的解决方案，对并发、事务、访问多个数据库有很好的支持……Java 也是一个非常稳定的平台。稳定，我并不是说它比 Python 或 Ruby 有更少的错误，我的意思是它没有变化那么多。

Java有很棒的工具支持。出色的 IDE、出色的重构工具、出色的静态分析工具……您可能不会为任何其他语言找到如此多的工具。

有很多缓慢的 Java 应用程序，但在我看来，它更多来自使用他们不理解的架构的开发人员，他们试图做比他们需要的更复杂的事情。您可以使用 Java 开发高性能、非常快速的网站。

**姜戈**

Django 重量更轻，使用起来更有趣。您可以在很短的时间内运行一个应用程序。管理界面非常适合简单的 CRUD 操作，甚至可以用于非常复杂的逻辑。您可以找到许多“可重复使用的应用程序”，它们将实现您需要的一些功能。

即使 Django 现在是 1.0 版本，它也远非稳定。如果你需要在 1-2 年内继续开发你的项目，你可以期待很多变化只是为了跟随 Django 的状态。

***结论***

如果您已经了解 Java，并且需要复杂的架构和长期支持，请使用 Java。

如果您想要快速开发并且不在乎是否需要在 1-2 年内重写很多应用程序，请使用 Django（或 RoR）。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-01-14T07:53:43.280

选择您熟悉的并使用它运行。

或者，您可以[在 Jython 上选择 Django，](http://docs.djangoproject.com/en/dev/howto/jython/)以充分利用 Java 库和 Python 的速度编码。

或者，如果您需要让某人相信它是企业级的，请选择 Java。

我想说，如果您是单独工作/在一个小团队中工作，那么只需选择需要最少资源的那个（提示：Python）。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-14T08:11:02.747

反Java：

*   冗长，有时很麻烦
*   模板脚本的糟糕选择（可以通过使用辅助脚本语言如 Groovy、Jython 等来缓解）

反蟒蛇：

*   没有特定的标准框架，必须研究和选择（或者只是在 WSGI 之上使用独立的实用程序模块）
*   托管选项仍然相对有限（GAE 或自己的服务器除外）

抗RoR：

*   没有本机 Unicode，采用现代 Web 脚本语言？耻辱
*   潜在的性能扩展问题

就我个人而言，我最终选择了 Python，但所有这些选项 - 以及 .NET - 都很容易防御。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-01-14T09:56:42.113

我会推荐 Java 和 Spring 框架 - 它解决了典型 Java Web 应用程序的所有负担，并为您提供了获得所需内容的清晰方法。

我个人使用 Hibernate - JPA - Spring 框架（或 Spring Web Flow） - Tiles - Freemarker 堆栈，它使我能够相当快地创建新的 Web 应用程序，但总的来说它们会带来相当陡峭的学习曲线。

我建议 - 试一试 Spring。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-01-14T08:05:34.550

您的应用主要是演示、数据库（CRUD 类型维护）还是大量后端逻辑？

对于大多数演示，我会使用 Python/Django（甚至是 php）。

对于简单的 CRUD RoR，它已经被舔过了。

对于后端逻辑繁重的任何事物，或者使用现有遗留数据库的任何事物，我都会选择使用 Spring 和 Freemarker、Ibatis 和 Tomcat 或 Jetty 的 java servlet。

PS 不要担心可伸缩性性能——没有什么能像 Tomcat/java 解决方案那样伸缩。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-06-15T02:51:08.677

除非您在 Java/.net 商店或有特定原因使用 Java/.net，否则我建议使用更适合 Web 开发的平台之一：Python/Django（或 Ruby/Rails、PHP /CodeIgniter/蛋糕）。

你会发现 Python/Ruby/PHP 更容易学习、部署、编程等。有大量关于它们的文献和大量支持资源。所有这些都被用于制作主要的网站（Python 上的 YouTube、Ruby 上的 Twitter、PHP 上的 Facebook）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-14T07:54:11.703

如果要投入生产，请使用您目前最了解的技术。学习新的框架、语言或技术可能会导致延迟，并且一开始您的代码质量会降低。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-14T09:54:04.940

我曾经是一名 Java 开发人员，现在主要从事 C# 工作。我反对 Java 的论点是，安装和运行它是（或至少*是*）真正的痛苦。它也更适合需要大量组织和可维护性的大型应用程序。然而，这是有代价的。

从您的帖子的声音来看，我认为其中一种动态语言会更适合。另外，他们玩起来更有趣（恕我直言）。

# python - 如何在 numpy 中逐行使用二维布尔数组从一维数组中进行选择？

> ID：442218
> 
> 赞同：1
> 
> 时间：2009-01-14T07:49:24.600
> 
> 标签：python, numpy

让我用一个例子来说明这个问题：

```
import numpy

matrix = numpy.identity(5, dtype=bool) #Using identity as a convenient way to create an array with the invariant that there will only be one True value per row, the solution should apply to any array with this invariant
base = numpy.arange(5,30,5) #This could be any 1-d array, provided its length is the same as the length of axis=1 of matrix from above

result = numpy.array([ base[line] for line in matrix ]) 
```

`result`现在拥有所需的结果，但我确信有一种特定于 numpy 的方法可以避免显式迭代。它是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T11:42:09.357

如果我正确理解您的问题，您可以简单地使用矩阵乘法：

```
result = numpy.dot(matrix, base) 
```

如果结果必须与您的示例具有相同的形状，只需添加一个重塑：

```
result = numpy.dot(matrix, base).reshape((5,1)) 
```

如果矩阵不对称，请注意点中的顺序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T07:54:52.840

这是另一种丑陋的做法：

```
n.apply_along_axis(base.__getitem__, 0, matrix).reshape((5,1)) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T00:05:41.260

我的尝试：

```
numpy.sum(matrix * base, axis=1) 
```

# maven-2 - 如何在 Maven 2 中手动安装工件？

> ID：442230
> 
> 赞同：98
> 
> 时间：2009-01-14T07:54:27.257
> 
> 标签：maven-2, installation

当我尝试使用 Maven 2 手动安装工件时遇到了一些错误。我想使用命令从本地目录安装 jar

```
mvn install:install-file -Dfile=jta-1.0.1B.jar 
```

但是 Maven 给出了一个构建错误，内容如下：

```
Invalid task '.01B.jar': you must
specify a valid lifecycle phase, or a
goal in the format plugin:goal or
pluginGroupId:pluginArtifactId:pluginVersion:goal 
```

我的命令有错误吗？

* * *

## 回答 #1

> 赞同：154
> 
> 时间：2009-01-14T08:06:43.643

您需要为您的工件指明 groupId、artifactId 和版本：

```
mvn install:install-file \
  -DgroupId=javax.transaction \
  -DartifactId=jta \
  -Dpackaging=jar \
  -Dversion=1.0.1B \
  -Dfile=jta-1.0.1B.jar \
  -DgeneratePom=true 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-03-13T23:04:07.407

根据 maven's [Guide to install 3rd party JARs](http://maven.apache.org/guides/mini/guide-3rd-party-jars-local.html)，命令是：

```
mvn install:install-file -Dfile=<path-to-file> -DgroupId=<group-id> \
-DartifactId=<artifact-id> -Dversion=<version> -Dpackaging=<packaging> 
```

您确实需要包装选项。这回答了最初的问题。

现在，在您的上下文中，您正在与 Sun 提供的 jar 作斗争。您也应该阅读[Coping with Sun JARs](http://maven.apache.org/guides/mini/guide-coping-with-sun-jars.html)页面。在那里，您将学习如何帮助 maven 为您提供有关 Sun jar 位置的更好信息，以及**如何**[添加](https://maven2-repository.dev.java.net/)包含. 将此添加到您的~~（非便携式）或~~（便携式）中： **`jta-1.0.1B.jar`~~`settings.xml`~~ `pom.xml`**

 **```
 <repositories>
    <repository>
      <id>maven2-repository.dev.java.net</id>
      <name>Java.net Repository for Maven</name>
      <url>http://download.java.net/maven/2/</url>
      <layout>default</layout>
    </repository>
  </repositories> 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-03-03T16:45:08.630

我不得不添加包装，所以：

```
mvn install:install-file \
  -DgroupId=javax.transaction \
  -DartifactId=jta \
  -Dversion=1.0.1B \
  -Dfile=jta-1.0.1B.jar \
  -DgeneratePom=true \
  -Dpackaging=jar 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-09-27T11:47:17.743

答案是逃离破折号！

[http://www.mail-archive.com/users@maven.apache.org/msg83991.html](http://www.mail-archive.com/users@maven.apache.org/msg83991.html)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-05-14T10:00:00.097

如果您在使用 Windows PowerShell 时遇到类似错误，您应该尝试 Windows 的简单命令行。我没有找出是什么原因造成的，但 PowerShell 似乎可以解释一些 Maven 的参数。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-01-24T19:07:58.067

所有发布的答案都从严格的专家角度正确地讨论了这个问题。我的问题是使用 Netbeans 作为我的主要 IDE 为 maven 进行此安装。我发现下面的文章很有帮助。

归功于以下 netbeans 论坛文章： [http ://forums.netbeans.org/topic22907.html](http://forums.netbeans.org/topic22907.html)

1.  在 Maven 项目中打开“添加依赖项”对话框
2.  编一些groupId、artifactId和version，填上去，OK。
3.  依赖将被添加到 pom.xml 中，并会出现在 maven 项目的“Libraries”节点下
4.  右键单击 Lib 节点并“手动安装工件”，填写 jar 的路径。Jar 应安装到本地 Maven 存储库，并在步骤 2 中输入坐标）

# c# - 同步 XmlWriter 对文件的访问以防止 IOExceptions 的最佳方法是什么？

> ID：442235
> 
> 赞同：4
> 
> 时间：2009-01-14T07:57:46.033
> 
> 标签：c#, file-io, ioexception, xmlwriter

应用程序中有多个位置在同一个文件上调用 XmlWriter.Create，所有位置都通过以下函数访问。当一个人打电话而另一个人还在写信时，我得到一个 IOException。锁定或同步访问的最佳方式是什么？

这是正在使用的功能：

```
 public void SaveToDisk()
    {
        try
        {
            XmlWriterSettings settings = new XmlWriterSettings();
            settings.Indent = true;
            using (XmlWriter writer = XmlWriter.Create(SaveFileAbsolutePath, settings))
            {
                XamlWriter.Save(this, writer);
                writer.Close();
            }

        }
        catch (Exception ex)
        {
            // Log the error
            System.Diagnostics.Debug.WriteLine(ex.Message);

            // Rethrow so we know about the error
            throw;
        }
    } 
```

更新：看起来问题不仅来自对该函数的调用，还因为另一个线程正在读取该文件，而该函数正在写入。什么是最好的锁定方式，这样我们就不会在读取文件时尝试写入文件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-14T16:29:41.960

使用锁可以解决你的并发问题，从而避免 IOException，但你必须记住在 SaveToDisk 和 ReadFromDisk 上使用相同的对象（我假设这是读取函数），否则仅在读取时锁定完全没用。

```
private static readonly object syncLock = new object();

public void SaveToDisk()
{
     lock(syncLock)
     {
          ... write code ...
     }
}

public void ReadFromDisk()
{
     lock(syncLock)
     {
          ... read code ...
     }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-14T08:08:39.147

静态锁应该快速简单地完成这项工作：

```
private static readonly object syncLock = new object(); 
```

然后...

```
public void SaveToDisk()
{
    lock(syncLock)
    {
        ...your code...
    }
} 
```

您也可以使用`[MethodImpl(MethodImplOptions.Synchronized)]`（在接受实例作为参数的**静态**方法上 - 例如，扩展方法），但显式锁更通用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-14T13:35:07.013

我实际上会使用[ReaderWriterLock](http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlock.aspx)来最大化并发性。您可以允许多个阅读器，但一次只能允许一个作者。

```
private ReaderWriterLock myLock = new ReaderWriterLock();

public void SaveToDisk()
{
     myLock.AcquireWriterLock();
     try
     {
          ... write code ...
     } 
     finally
     {
          myLock.ReleaseWriterLock();
     }
}

public void ReadFromDisk()
{
     myLock.AcquireReaderLock();
     try
     {
          ... read code ...
     } 
     finally
     {
          myLock.ReleaseReaderLock();
     }
} 
```

只需确保使用[FileShare.Read](http://msdn.microsoft.com/en-us/library/system.io.fileshare.aspx)打开文件，以便后续读取不会失败。

# tfs - 从 Team Foundation Server 2005 导入到 2008

> ID：442239
> 
> 赞同：3
> 
> 时间：2009-01-14T08:03:37.550
> 
> 标签：tfs, import, tfs-2005

我们有一个现有的 TFS 2005 安装和一个较新的 2008。2008 服务器上已经有一些较新的项目，但我希望将旧项目从 2005 移动到这个较新的服务器上。

有谁知道一种简单的方法来做到这一点并维护审计历史，而不是仅仅破坏项目的源代码控制，然后将其添加到 2008 服务器？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-14T12:23:24.563

我使用 TFS 到 TFS 迁移工具来执行此操作：

[http://www.codeplex.com/tfstotfsmigration](http://www.codeplex.com/tfstotfsmigration)

您确实需要在运行它的机器上拥有一份本地 SQL 副本，该工具将其用作两者之间的复制区域。

此外，由于 TFS 存储版本历史信息的方式，所有历史都将显示为好像所有更改都发生在同一天。根据您的需要，中断并保留 2005 数据库直到不再需要该历史记录可能会更容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T04:31:36.153

根据您添加的新项目的数量，您是否可以将 2005 数据库恢复到新服务器，将它们升级到 2008，然后将较新的项目迁移到这个新更新的数据库中？这样，您将维护整个 TFS 历史记录，并且您的少数新项目只会遇到“一天中的每一次更改”问题。

# javascript - What's the best way to serialize JavaScript objects to XML?

> ID：442242
> 
> 赞同：5
> 
> 时间：2009-01-14T08:06:33.597
> 
> 标签：javascript, xml, serialization

I am looking for a best proved way to serialize JavaScript objects to XML, that could be sent to server further in Ajax style.

Just googling I've found some options like [http://svn.mirekrusin.com/pub/javascript/to_xml/trunk/to_xml.js](http://svn.mirekrusin.com/pub/javascript/to_xml/trunk/to_xml.js), but does somebody has proved experience and could recommend any specific library?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T10:28:16.073

尝试这个：

[Stefan Goessner 在 XML 和 JSON 之间进行转换](http://goessner.net/download/prj/jsonxml/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T00:16:31.870

我不知道是否有成名的作品会为你做到这一点，但......

```
// Define class constructor
var SampleObject1 = function()
{
    this.name = 'MySampleObject';
    this.id = 1;
    this.seed = 1.009;
    this.createdAt = new Date();
    this.obj = null;
};

// Create instance of serializer
var serializer = new Ant.Serializer();

// Register SampleObject1, so serializer gets to know how to deal with such objects
serializer.register('SampleObject1', SampleObject1);

// Create data that will be serialized
var object = new SampleObject1();
object.obj = new SampleObject1();

// Serialize and get string representation
var xml = serializer.save(object).toString();

// Displays (formatting is changed):
// <SampleObject1>
//  <name type="string">MySampleObject</name>
//  <id type="number">1</id>
//  <seed type="number">1.009</seed>
//  <createdAt>
//      <Date value="2007-7-26T20:31:24.156"/>
//  </createdAt>
//  <obj>
//      <SampleObject1>
//          <name type="string">MySampleObject</name>
//          <id type="number">1</id>
//          <seed type="number">1.009</seed>
//          <createdAt>
//              <Date value="2007-7-26T20:31:24.156"/>
//          </createdAt>
//          <obj/>
//      </SampleObject1>
//  </obj>
// </SampleObject1>
WScript.echo(xml);

// Displays: MySampleObject
WScript.echo(serializer.load(xml).name); 
```

# c# - C# 替换为 AS3 中的回调函数

> ID：442245
> 
> 赞同：9
> 
> 时间：2009-01-14T08:08:31.457
> 
> 标签：c#, regex, actionscript-3, function, replace

在 AS3 中，您在具有此签名的字符串上有一个函数：

```
function replace(pattern:*, repl:Object):String 
```

repl:Object 也可以指定一个函数。如果您指定一个函数，则该函数返回的字符串将插入到匹配内容的位置。

另外，是否可以获得我想要替换的原始字符串？

（在 AS3 中，您可以通过

```
var input:String = arguments[2]; //in the callback function 
```

)

我在类中没有看到`Match`包含原始字符串的属性...

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-14T08:16:23.373

```
static void Main() {

    string s1 = Regex.Replace("abcdefghik", "e",
        match => "*I'm a callback*");

    string s2 = Regex.Replace("abcdefghik", "c", Callback);
}
static string Callback(Match match) {
    return "*and so am i*";
} 
```

请注意，您可以通过参数访问匹配的数据（`match.Value`特别是，除非您想访问正则表达式组 ( `.Groups`) 等）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-14T08:12:46.220

为了在 C# 中执行此操作，请使用`System.Text.RegularExpressions.Regex.Replace()`which 接受回调。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-14T08:17:57.740

作为使现有答案绝对具体的示例，并展示 lambda 表达式如何方便：

```
using System;
using System.Text.RegularExpressions;

class Test
{
    static void Main()
    {
        var template = "On $today$ you need to do something.";
        var regex = new Regex(@"\$today\$");
        var text = regex.Replace(template,
            match => DateTime.Now.ToString("d"));
        Console.WriteLine(text);
    }
} 
```

（Marc 的答案出现在我写这篇文章的时候，但我会把它作为一个完整的例子留下来，除非有人认为它只是多余的。如果有建议，我很乐意删除它。）

# asp.net-mvc - 从控制器获取跟踪消息到失败的请求跟踪

> ID：442258
> 
> 赞同：2
> 
> 时间：2009-01-14T08:16:13.750
> 
> 标签：asp.net-mvc, trace, freb

在 ASP.NET MVC Preview 5 上，我们无法从全局或控制器获取任何跟踪消息以显示在页面（视图）或失败的请求跟踪（FREB）中。

这些调用都不能在控制器操作中工作：

```
HttpContext.Trace.Write("hello");
System.Diagnostics.Trace.WriteLine("world"); 
```

页面代码隐藏中的跟踪语句没有问题；这些消息正确显示。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T17:50:10.610

这些调用甚至在创建页面 (ViewPage) 之前发生，因此您需要在 Web.config 以及页面中启用跟踪。

在 Web.config 中，直接在节点内添加：

```
<trace enabled="true" /> 
```

您有两个选项来查看跟踪。您可以在 @Page 声明中的视图中启用它。

```
<%@ Page ... Trace="true" %> 
```

或者您可以导航到 /trace.axd

请注意，我们确实有一个错误，但我不记得它是什么时候修复的。我在 Beta 版中尝试过这个，而不是在 Preview 5 中。

# windows-services - 将应用程序开发为 Windows 服务有什么好处？

> ID：442264
> 
> 赞同：20
> 
> 时间：2009-01-14T08:18:40.563
> 
> 标签：windows-services

我将开发一个应用程序来处理在线数据（通过套接字），它不需要任何用户交互。

我正在考虑一个简单的控制台应用程序，但是 Windows 服务会提供额外的好处吗？（我知道 Windows 服务不需要用户登录来运行该服务，但我问的是额外的好处）

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-14T08:25:21.813

在我的头顶上：

*   您可以控制启动进程的用户（以及与此用户帐户关联的权限）
*   一个自动启动的进程意味着桌面需要打开，而不是用户登录，才能运行服务
*   可以定义失败策略（如果失败，尝试重新启动 n 次运行特定程序）
*   可以定义依赖项（如果您依赖其他服务）
*   你可以把你的纸币包裹在一个[看不见的窗户里](https://stackoverflow.com/questions/298562)
*   您可以轻松启动/停止/重新启动脚本 ( `net start <scriptname>`)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-14T08:40:50.953

我无法在 VonC 的列表中添加任何内容，但我想补充一点，如果您使用的是常用的 Microsoft 工具（VS 和 .net），那么两者都很容易做到。

我创建了一个包含所有应用程序逻辑的类库和一个具有 .Start() 和 .Stop() 方法的 MyServer 类。然后，您可以创建一个控制台应用程序和 winservice 应用程序都引用它。例如，控制台应用程序实例化一个新的 MyServer，调用 Start，等待按键并调用 Stop。

我在开发过程中使用控制台应用程序，并在部署时使用 Windows 服务。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-14T08:40:11.097

1.  您可以从另一台机器管理服务（启动/停止）
2.  当服务写入事件日志时，您还可以从另一台机器监控服务（尽管没有什么能阻止您从常规应用程序执行此操作）
3.  无需任何人登录即可运行服务

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-14T08:26:38.423

事实上，我认为这真的取决于您的应用程序的使用情况。

例如，如果您只需要在特定时间运行您的处理，则使用命令行就足够了。

如果您的进程需要连续且无声地运行（无用户交互），Windows 服务将非常有趣。

您还可以考虑 Windows 中的**任务调度**。基本上，它将在指定时间运行您的应用程序（例如通过 .bat 文件）。例如，如果您的应用程序需要在每天 02:00 运行，这会很有帮助……在“控制面板”中，您可以选择“计划任务”。然后，单击“添加计划任务”，然后按照向导...

# c# - 对包含 IDictionary 的类进行单元测试

> ID：442265
> 
> 赞同：0
> 
> 时间：2009-01-14T08:19:29.233
> 
> 标签：c#, unit-testing

我正在创建一个类，该类确定要调用的已注册 WCF 客户端回调的数量。当客户端向服务器注册时，它会提供它感兴趣的令牌。然后，该类在字典中存储令牌到该令牌的 IClientCallback 接口的映射。

被测方法及其类如下所示

```
public class Router
{
    private IDictionary<int, IClientCallBack> clients;

    public Router()
    {
        clients = new Dictionary<int, IClientCallBack>();
    }

    public Router(IDictionary<int, IClientCallBack> clients)
    {
        this.clients = clients;
    }

    public bool Register(int token, IClientCallBack client)
    {
        if (!clients.ContainsKey(token))
        {
            clients.Add(token, client);
            return true;
        }
        return false;
    }
} 
```

如何测试客户端是否成功注册到路由器？我想我可以假设如果函数返回 true，它是成功的（但是什么是阻止函数体只是“返回 true;”？）或者我可以将客户端 Dictionary 注入类的构造函数和我的测试我可以检查clients.Count是否等于1，如下所示。

```
[TestMethod]
public void RegisterTest()
{
    IDictionary<int, IClientCallBack> clients = new Dictionary<int, IClientCallBack>();
    var router = new Router(clients);
    var client = new Mock<IClientCallBack>().Object;
    var success = router.Register(4, client);
    Assert.IsTrue(success);
    Assert.AreEqual(1, clients.Count);
    Assert.AreEqual(clients[4], client);           
} 
```

虽然上面的测试看起来不错，但使用依赖注入来插入集合似乎有点过头了，这样我就可以测试它了。然而，它确实使测试更容易和更准确（在测试类的其他方法时）。

这是测试此方法的推荐方法，还是矫枉过正？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T08:29:40.743

好吧，你为什么关心字典的内容是什么？如果您已经注入了它，那么您可能会很在意——但此时它是 API 的一部分。如果您可以不使用字典的构造函数，那么只需测试字典内容的实际*效果*。

所以，如果你为同一个令牌调用 Register 两次，它应该返回 false，对吗？做一个测试。大概还有其他与令牌有关的事情 - 因此测试令牌何时注册以及何时未注册。

这么说吧：如果有人想使用令牌/客户端对的链表重新实现该类，那会破坏该类的有用功能吗？我怀疑不是 - 所以你的测试可能不应该关心。

现在，在我开始听起来太学术之前，我不是那些认为单元测试应该总是、总是只触及公共方法而不关心实现的人之一。它们不是黑盒测试。有时了解实现可以使仅测试一个复杂的逻辑位变得更容易，即使它通常只是通过实际上可以解决它的更多工作的东西*公开。*但在你提出的情况下，我真的会坚持“就外界所知，它是否做了它应该做的事情”的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T08:30:50.087

本质上，如果您正在查看内部数据结构，那么您的测试是在检查特定的实现，而不是断言类的*预期行为*。

如果这是我的测试，我宁愿在模拟对象上设置一些期望，然后在 Router 类上调用一些方法来验证这些期望。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T08:45:00.277

好点乔恩。上面的课程与我今天下午在工作中尝试的课程相比略有简化。在实际测试代码中，我提供了 1 个或多个令牌来注册 IClientCallBack。每个标记都应该有一个字典条目。这个想法是 Resolve(int token) 将返回映射的 IClientCallBack ...

如果我的方法是

```
public bool Register(int token, IClientCallBack client)
{
    return true;
} 
```

我的测试将错误地成功。现在，我可以在类中包含对另一个方法的调用，该方法将验证 IClientCallBack 是否正确映射，例如对 Resolve 的调用，但随后我将在一个测试中测试不同的方法，我认为这很糟糕业力？

以前我刚刚测试过该方法会返回 true，但是有声音告诉我，如果我编写要通过的方法，它可能也不一定会做我想要的。

也许我只是在搞乱 TDD 点:)

# jquery - jQuery scripts in the response of Ajax does not work

> ID：442269
> 
> 赞同：0
> 
> 时间：2009-01-14T08:21:21.697
> 
> 标签：jquery, ajax

I am using jQuery $.load() function to get content from server. the loaded content contain this:

```
<p id="p1">123</p>
<script>   
 $(document).ready(function(){
      $('#p1').html('ABC');
      alert($('#p1').html());
 });
</script> 
```

changing text of paragraph to 'ABC' not affected to page but alert() display 'ABC'.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T08:32:41.127

I think your selector is incorrect. $('#p') will select elements (though in principle there should be only one, but that's separate) with id "p". Not all

elements. So I think you either mean $('p') or $('#p1').

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T10:31:38.110

如果您通过 .load() 加载它，请摆脱周围的 $(document).ready(); 少量。这不是必需的，因为 DOM 已经加载。您的脚本应该按照您的预期运行。

不要忘记将 type="text/javascript" 添加到您的脚本标签中，以确保它不会破坏任何内容。

如果您仍然遇到问题，请尝试仅使用 .load() 的回调函数，例如。

```
 $("#somediv").load('some.html',{ /* empty data arg */ },function(){
    $("#p1").html('ABC');
  }); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T10:13:26.353

呃，当内容被加载时，文档不是已经“准备好”了吗？警报真的会触发吗？如果是这样，我同意 arnab_deka：使用 .text() 方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T08:36:50.447

"#p" selector looks for a DOM element with id "p" - and there is nothing like that in here.

The correct selector would be "#p1".

Also, to set the text in a node, use text(): (see text(val) in [http://docs.jquery.com/Manipulation](http://docs.jquery.com/Manipulation) )

> $("#p1").text('ABC');

# scorm - 使用包装工具将 SCORM 1.2 XML 转换为 2004

> ID：442272
> 
> 赞同：4
> 
> 时间：2009-01-14T08:22:46.000
> 
> 标签：scorm

我找到了一个很好的包装工具，可以将 SCORM 1.2 api 转换为 2004，但是除了 XML 文件还需要进行哪些最小更改？我认为至少 imsmanifest.xml 需要更新？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-05T18:28:27.237

要将 SCORM 1.2 清单转换为 SCORM 2004 清单，您需要进行一些更改：

1) 标头中的 XML 命名空间声明与 2004 不同。2) 您需要在清单级元数据节点的 schemeversion 元素中具有特定值。（该值取决于您使用的 SCORM 2004 版本）。3）资源节点上的“adlcp:scormType”属性中的“t”的大小写是大写而不是小写。4) 要获得大多数用户期望的行为（并复制大多数 SCORM 1.2 LMS 提供的行为），您将需要一些非常基本的排序信息。

[http://www.scorm.com/scorm-explained/technical-scorm/golf-examples/](http://www.scorm.com/scorm-explained/technical-scorm/golf-examples/)有一些很好的例子

请参阅 Simple Single SCO 了解 1.2 和 2004 之间的差异，以及基本运行时调用示例了解应包含的最少排序信息。

过去还有一个 XSLT 文档，用于将 SCORM 1.2 清单转换为 SCORM 2004 清单。你也许可以通过谷歌搜索来挖掘它。

# c# - 捕获插件 UserControl 抛出的异常

> ID：442273
> 
> 赞同：2
> 
> 时间：2009-01-14T08:23:15.810
> 
> 标签：c#, winforms, exception, plugins, user-controls

我正在编写一个 WinForms 应用程序，它以插件的形式（想想小部件）接受动态用户界面控件。为此，每个插件的主函数都会返回一个 UserControl，然后将其添加到主窗体中。

由于我的应用程序没有直接控制它们，我想对插件进行“沙箱化”处理，这样如果其中一个 UserControls 抛出错误，我可以捕获它并卸载罪魁祸首。明显的问题是 UserControls 是事件驱动的，并且可以在一百万个不同的地方抛出异常，所以我没有东西可以包装在 try/catch 块中。

如何捕获动态 UserControls 引发的异常，或者对于这样的模块化应用程序有什么更好的设计？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T09:08:41.913

您可以使用全局异常处理（如自定义 HTTPModule）然后确定异常是由哪个插件抛出的。

看看这个链接，也许有用
[http://www.15seconds.com/issue/030102.htm](http://www.15seconds.com/issue/030102.htm)
[http://codebetter.com/blogs/karlseguin/archive/2006/06/12/146356.aspx](http://codebetter.com/blogs/karlseguin/archive/2006/06/12/146356.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T09:41:28.693

通过简单地调用插件实现并在每个调用周围添加您的 try catch 逻辑，将您的 UserControl 封装在实现您的插件接口的对象中。

# ruby-on-rails - 为什么乘客如此积极地访问我的索引页面

> ID：442289
> 
> 赞同：3
> 
> 时间：2009-01-14T08:32:51.110
> 
> 标签：ruby-on-rails, passenger

我刚刚将我的 apache/mongrel 设置移动到使用乘客，我开始注意到我的索引页面被非常积极地点击（每天大约 5000 次点击）

我进行了一些日志记录，结果发现这些命中的 IP 地址（REMOTE_ADDR）显示为“::1”。

有人见过这样的活动吗？这一定是有原因的。有没有我忘记配置或设置的设置？

**编辑**

谢谢加文，看起来这是虚拟连接。现在的问题是我如何[禁用它](http://rackerhacker.com/2008/09/23/apache-22-internal-dummy-connection/)，Passenger 与[mod rewrite冲突](http://www.modrails.com/documentation/Users%20guide.html#_mod_rewrite_and_mod_alias)

我刚刚在乘客新闻组上发布了一个[问题](http://groups.google.com/group/phusion-passenger/browse_thread/thread/acbcb31155c700c9)（可能需要几分钟才能显示），我会在收到回复后立即更新。

**更新 2**

我的 Apache 配置中的这 3 行解决了这个问题：

```
RewriteEngine On
RewriteCond %{HTTP_USER_AGENT} ^.*internal\ dummy\ connection.*$ [NC]
RewriteRule .* - [F,L] 
```

我试图找出这是否属于乘客，或者是我设置的本地错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T16:54:48.477

请参阅[http://wiki.apache.org/httpd/InternalDummyConnection](http://wiki.apache.org/httpd/InternalDummyConnection)。

当 Apache HTTP 服务器管理其子进程时，它需要一种方法来唤醒正在侦听新连接的进程。为此，它向自身发送一个简单的 HTTP 请求。

您可以使用 mod_rewrite、SetEnvIf 或 User-Agent 上的正则表达式过滤它们（查找“内部虚拟连接”）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T16:46:58.040

您是否有某种类型的监控系统访问 Web 服务器？我已经使用Passenger 几个月了，还没有看到这个。

# c# - Datagridview custom vscrollbar

> ID：442290
> 
> 赞同：0
> 
> 时间：2009-01-14T08:32:51.720
> 
> 标签：c#, datagridview, c#-2.0

I would like disable vertical scroll bar in datagridview and managing the scrolling using separate vscroll control. I am using c# 2.0\. Any one can help....????

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T16:04:40.997

您可以将 DataGridView.ScrollBars 属性设置为 ScrollBars.None 或 ScrollBars.Horizo​​ntal（只有水平滚动条）。这样垂直滚动条将不会显示，您可以使用您的

# wpf - Microsoft Blend 6 月 2.5 已过期

> ID：442293
> 
> 赞同：2
> 
> 时间：2009-01-14T08:35:36.457
> 
> 标签：wpf, xaml

我找不到更新的 Microsoft Blend Preview。是可用的么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-14T08:39:49.677

前段时间我在另一个论坛上看到，2.5 被 Blend 2 和 SP1 取代。

编辑：我在[这里](http://www.microsoft.com/expression/products/FAQ.aspx?key=blend)找到它：

> 问：Expression Blend 2.5 发生了什么？
> 
> A. Expression Blend 2.5 通过其 Beta 周期（Beta 1 和 Beta 2）提供了对 Silverlight 2 的支持。Silverlight 2 现已发布，Expression Blend 2.5 启用的 Silverlight 2 平台支持通过以下方式提供给所有 Expression Blend 用户Expression Blend 2 服务包 1。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-14T08:39:56.090

[替换为 SP1](http://weblogs.asp.net/scottgu/archive/2008/09/25/silverlight-2-release-candidate-now-available.aspx)：

> “我们没有给它一个新的版本字符串（并强制现有用户升级到新版本），而是决定使用现有运输产品的服务包来发布该功能。以前 Blend 2.5 版本中的所有功能现在都包含在 SP1 中。”</p>

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-17T22:42:14.867

安装 SP1 将试用期延长 60 天

# linear-algebra - Linear Programming with Complication

> ID：442299
> 
> 赞同：1
> 
> 时间：2009-01-14T08:40:09.397
> 
> 标签：linear-algebra, mathematical-optimization, linear-programming

I'm trying to solve a problem that looks like a standard Linear Programming problem with one twist.

We have as input a set of "phrases" each of which has a weight. We need to choose how many times to repeat each phrase in a text to maximize the total weight, subject to a max character length limitation.

This seems like a straightforward linear programming problem, except for the fact that one phrase could be subphrase of another. So for example if your input phrases include "foo bar" and "foo", then if you repeat the phrase "foo bar", you also repeat the phrase "foo". I don't know how to deal with this in a linear programming model.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T09:41:51.767

您还有另一个问题，两个短语的串联可能会形成第三个短语。例如，如果您有

```
list...4
sting...6
ingrave...7
abcd...5 
```

那么一个解决方案“ `listingrave`”有“增益”17，而你可以用“ `abcd`”（“ `abcdingrave`”）做的任何事情都只有12，尽管长度为4，“`abcd` ”是最佳的。

但是，这是一个有趣的问题，我认为您需要构建一个自动机来搜索文本以查找您的单词，并且您需要在给定长度的自动机中找到一条路径，该路径通过“最简单”的状态（例如，通过给予最多的糖果作为回报）。我会进一步考虑。

更新：它应该像这样工作：

1.  从 Aho-Corasick 文本搜索算法构建 DFA
2.  从 DFA 的起始状态开始，以最大增益搜索给定长度的步行（不是路径，即允许重复的边和顶点）。您可以使用动态编程来做到这一点（从 1 个字符较短的步行构建更长的步行）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T09:12:57.987

只需重新计算权重。例如：

```
键 = 3
板 = 2
键盘 = 5

```

这将更改为：

```
键 = 3
板 = 2
键盘 = 5 + 3 + 2 = 10

```

如果您这样做，您必须注意包含短语的短语，其中包含短语。你必须确保你不这样做：

```
y = 7
键 = 3 + 7
板 = 2
键盘 = 5 + 7 + (3 + 7) + 2

```

您可以通过在短语长度之后对列表进行排序来避免它。（最长的优先）

BTW：这不是[动态规划](http://en.wikipedia.org/wiki/Dynamic_programming)问题吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T09:55:07.560

也许它可以通过只使用动态编程并每次重新计算整个事情来工作。可以使用大量优化来加快速度。（就像试图只重新计算最后一部分）我认为速度是合理的。O(n^2 * m) 左右。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-06T18:30:48.710

这看起来可以作为一个**背包问题**来解决，请参阅[http://en.wikipedia.org/wiki/Knapsack_problem](http://en.wikipedia.org/wiki/Knapsack_problem)，权重定义为 gs 建议的。

# vim - 选项卡视觉选择

> ID：442302
> 
> 赞同：31
> 
> 时间：2009-01-14T08:40:33.670
> 
> 标签：vim

在许多 GUI 中，当我选择一段文本然后点击`Tab`或`Shift`+`Tab`按钮时，所选部分将缩进或缩出。

在 VIM 中，我可以选择一个可视部分，然后按`<`或`>`键来更改缩进，但是一旦我按了`<`键，我的选择就会被清除，所以我不得不再次选择该部分并再次点击`<`。当我试图缩进一些东西并想要视觉反馈时，这真的很烦人。

在保持选定当前选定文本的同时，是否可以在 vim 中缩进和缩进内容？

是否有重新映射`Tab`和`Shift`+的技巧，`Tab`因此它们在视觉模式下以这种方式表现？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-01-14T08:47:11.330

您可以为数字添加前缀，即。`2>`缩进两个制表位。或者，您可以使用`>`to 缩进一次，然后`.`再次缩进（即使该块不再突出显示也可以使用）。如果你走得太远，`u`将一次撤消一步。

`gv`如果您需要应用不同的命令，另一个有用的命令是恢复最后一个可视块。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-01-14T20:04:48.110

```
vmap <Tab> >gv
vmap <S-Tab> <gv 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-14T20:33:48.237

另一种方法是选择一个块并使用以下顺序在行首插入一个缩进：

1.  `ctrl+V`+箭头键选择块。
2.  `I`*切换到插入模式，以便将插入的文本插入到所选块中每一*行中所选内容的开头。
3.  `ctrl+T`增加缩进或`ctrl+D`减少缩进。您可以像这样添加任意数量的缩进。 **注意：**缩进只会出现在块的第一行，但是当退出插入模式时，缩进将复制到块中的所有行。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-11T22:27:28.113

尝试使用“。” 重复该命令。它会记住范围，如果您走得太远，您可以使用“u”撤消一级。无需配置。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-14T09:02:35.793

或者，您可以转到最近的大括号并`=%`在正常模式下键入 - 它缩进大括号覆盖的块及其匹配的块。但我不确定这在 Python 等语言中有何用处。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-04-16T13:12:04.797

下面的键映射就像布赖恩的解决方案一样，但也保持光标位置与单词相关。

```
" tap indent movement (use mark `m' for cursor position)
vmap <S-Tab>  mm<`m:<C-U>exec "normal ".&shiftwidth."h"<CR>mmgv`m
vmap <Tab>    mm>`m:<C-U>exec "normal ".&shiftwidth."l"<CR>mmgv`m 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-06-17T06:35:53.263

具有视觉块选择

步骤：
选择块（`Ctrl`+ `v`）
类型`c`（更改）
类型所需空间
类型`esc`

[![在此处输入图像描述](https://i.stack.imgur.com/yuYtk.gif)](https://i.stack.imgur.com/yuYtk.gif)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-11T18:11:11.787

尝试**>}** '将下一段缩进一级'。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-14T13:45:59.467

自从我放弃 vi 到 vim 之后，我再也没有使用 > 或 < 了。我利用 vim 自动缩进，可以用 = 显式触发

它对像 =a{ 这样的动作非常有效，比 =% 更有效

否则，如果一个 > 不够，只需用 . 重做，或用 u 撤消更改。

# regex - 如何使用 Perl 从 Apache 访问日志中提取外部引用？

> ID：442311
> 
> 赞同：1
> 
> 时间：2009-01-14T08:47:22.983
> 
> 标签：regex, perl, apache, parsing, logging

我需要一些帮助，让正则表达式能够从 apache 访问日志文件中解析所有引荐来源网址，这些引荐来源网址来自**异地的真实链接**，并且是来自真人而不是机器人或蜘蛛的有效引荐。我在 Perl 工作。

这段代码*几乎*已经可以工作了[使用文件句柄 $fh 打开访问日志]：

```
my $totalreferals = 0;
while ( my $line = <$fh> ) {
    if ($line !~ m!

        \[\d{2}/\w{3}/\d{4}(?::\d\d){3}.+?\]
        \s"GET\s\S+\sHTTP/\d.\d"
        \s\S+
        \s\S+
        \s("-"|"http://(www\.|)mywebsite\.com.*"                

        !xi
        )
    {
          $totalreferals++;  
    }

    $line =~ m!

        \[(\d{2}/\w{3}/\d{4})(?::\d\d){3}.+?\]
        \s"GET\s(\S+)\sHTTP/\d.\d"
        \s(\S+)
        \s\S+
        \s"http://w{1,3}\.google\.
        (?:[a-z]{2}|com?\.[a-z]{2}|com)\.?/
        [^\"]*q=([^\"&]+)[^\"]*"

    !xi or next;

    my ( $datestr, $path, $status, $query ) = ( $1, $2, $3, $4 );
    .
    .
    #do other stuff  
    .
    .
} 
```

上面的正则表达式成功地消除了 access_log 中记录的所有内部链接以及没有引用者的记录，但它给出了一个太大的 $totalreferals。

第一个正则表达式计算的 log $line 示例，但我想排除的示例是：

```
61.247.221.45 - - [02/Jan/2009:20:51:41 -0600] "GET /oil-paintings/section.php/2451/0 HTTP/1.1" 200 85856 "-" "Yeti/1.0 (NHN Corp.; http://help.naver.com/robots/)" 
```

-- 似乎是来自韩国的蜘蛛

* * *

```
93.84.41.131 - - [31/Dec/2008:02:36:54 -0600] "GET /paintings/artists/w/Waterhouse_John_William/oil-big/Waterhouse_Destiny.jpg HTTP/1.1" 200 19924 "http://smrus.web-box.ru/Schemes" "Mozilla/5.0 (Windows; U; Windows NT 5.1; ru; rv:1.9.0.5) Gecko/2008120122 Firefox/3.0.5" 
```

-- 请求嵌入另一个网站的图像（我们允许这样做）

* * *

```
87.115.8.230 - - [31/Dec/2008:03:08:17 -0600] "GET /paintings/artists/recently-added/july2008/big/Crucifixion-of-St-Peter-xx-Guido-Reni.JPG HTTP/1.1" 200 37348 "http://images.google.co.uk/im........DN&frame=small" "Mozilla/5.0 (Windows; U; Windows NT 6.0; en-GB; rv:1.9.0.5) Gecko/2008120122 Firefox/3.0.5" 
```

-- 请求来自谷歌图片（可以查看全尺寸图片，或者爬取它）

* * *

```
216.145.5.42 - - [31/Dec/2008:02:21:49 -0600] "GET / HTTP/1.1" 200 53508 "http://whois.domaintools.com/mywebsite.com" "SurveyBot/2.3 (Whois Source)" 
```

-- 请求来自 whois 机器人

* * *

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T09:05:51.777

除非你有一些非常奇怪的要求来重新发明轮子，

[http://search.cpan.org/search?query=apache+log&mode=all](http://search.cpan.org/search?query=apache+log&mode=all)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T10:08:12.620

我认为你的问题在这里：

```
\s"http://w{0,3}\.mywebsite\.com[^\"]*" 
```

这不会捕获“ [http://mywebsite.com](http://mywebsite.com) ”的情况，因为它总是需要在“mywebsite”之前添加一个点。

此外，您仅排除 GET 请求。POST 和 HEAD 呢？

**编辑：** 如果您仍然得到看起来错误的数字，您绝对应该使用您的正则表达式捕获引荐来源并打印它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-14T16:01:15.637

Manni 消除 POST 和 HEAD 的建议确实是正确的，因为我正在寻找否定匹配（因此不应像解析查询字符串时那样限制为 GET）。同样，主机前的点中的错误没有www，并且还需要消除“-”（无推荐人）

此外，我消除了与图像文件的所有匹配项，这些匹配项通常不是来自外部站点的直接引荐，而是嵌入在这些站点中，或者正在被搜索引擎（主要是谷歌图像）索引。

我还发现许多服务器的图像文件在文件名中包含空格，这破坏了将 \S+ 用于文件名的正则表达式，我已将其更改为 .+

最后，由于在消除记录时我不需要 grep 日期，我可以简化正则表达式的第一部分。

结果与我预期的数字更接近。虽然我还没有找到一种消除来自机器人和蜘蛛的**所有请求的好方法。**

对于那些感兴趣的人，最终代码如下所示：

```
my $totalreferals = 0;
while ( my $line = <$fh> ) {
    if ($line !~ m!

        \[.+\]
        \s("\S+\s.+\sHTTP/\d.\d"
        \s\S+
        \s\S+
        \s("-"|"http://(www\.|)mywebsite\.com.*")|
        "\S+\s.+\.(jpg|jpeg|gif|png)\sHTTP/\d.\d"
        \s\S+
        \s\S+
        \s".*")
        !xi
        )
    {   
      $totalreferals++;  
    }

    $line =~ m!

        \[(\d{2}/\w{3}/\d{4})(?::\d\d){3}.+?\]
        \s"GET\s(\S+)\sHTTP/\d.\d"
        \s(\S+)
        \s\S+
        \s"http://w{1,3}\.google\.
        (?:[a-z]{2}|com?\.[a-z]{2}|com)\.?/
        [^\"]*q=([^\"&]+)[^\"]*"

    !xi or next;

    my ( $datestr, $path, $status, $query ) = ( $1, $2, $3, $4 );
    .
    .
    #do other stuff  
    .
    .
} 
```

**编辑**：在我的研究过程中，似乎唯一真正可行的区分自动爬虫和真正的人类访问者的方法是跟踪 cookie。我怀疑有没有办法通过纯日志分析来解决这个问题。如果有人知道通过分析日志来做到这一点，请告诉我。要知道，我只会在我的日志报告中添加一个脚注，表明它们包括来自机器人的流量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T13:39:42.397

对于 Regex 的匹配 URI，请尝试 Regex::Common（或更具体地说是 Regexp::Common::URI::http）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-22T16:01:44.423

目前，我的选择是根据 IP 过滤日志。最活跃的机器人是 google、yahoo、msn 等。所以，我将它们的 IP 范围从记录中删除。

# c# - Do I have to make a select query to create a relationship in Entity Framework?

> ID：442317
> 
> 赞同：0
> 
> 时间：2009-01-14T08:49:06.727
> 
> 标签：c#, entity-framework, linq-to-entities

I want to create a Blog object which has a relation between User. To create the relationship do I have to select User entity first, then set it to User property of Blog object? In Entity Framework samples suggest to set the User object to ViewState and retrieve it when you need to create the relationship, like a basic cache.

Is this necessary? Is there any other way to do this? (like in linq-to-sql setting the foreign keys only without select.)

Here my code sample;

```
Blog blog = new Blog
            {
                Name = blogName,
                Slogan = slogan,
                User = Entities.Users.First(u => u.Id == userId)
            }

Entities.AddToBlogs(blog);
Entities.SaveChanges(); 
```

Edit(To give another chance to question): Is there anything unclear or else?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-26T09:59:11.643

We use the following solution to set foreign keys without retreiving the corresponding entity from the context.

```
Blog blog = new Blog            
{                
   Name = blogName,                
   Slogan = slogan,                
   UsersReference.EntityKey = new EntityKey("EntityModel.Users", "UserId", userId)            
}

Entities.AddToBlogs(blog);
Entities.SaveChanges(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T14:11:21.363

目前还没有官方支持，[但可能会包含在未来的版本](http://blogs.msdn.com/efdesign/archive/2008/10/27/foreign-keys-in-the-conceptual-and-object-models.aspx "概念模型和对象模型中的外键")中。

~~但是，您也许可以破解它。我还没有尝试过，但这个想法在概念上似乎是合理的：~~

 ~~1.  创建一个新用户，并适当地设置 ID。将其附加到对象上下文。
2.  告诉对象上下文忘记您到目前为止所做的任何更改。
3.  现在创建一个新博客并将 User 属性设置为您刚刚创建的用户。
4.  保存对对象上下文的更改。~~ 

~~显然，如果数据库中实际上不存在用户，这将失败。~~

似乎是个好主意，但似乎行不通。:(

# can-bus - CANopen PDOs and a communication profile

> ID：442320
> 
> 赞同：1
> 
> 时间：2009-01-14T08:54:03.643
> 
> 标签：can-bus, canopen

If the data contains more than one value, how do I know what these values represent? And how do I break up the data into individual values? Am I right to say that the relationship between the [PDOs](http://en.wikipedia.org/wiki/CANopen#Process_Data_Object_.28PDO.29_protocol) and data to be transmitted are defined in the communication profile?

(I thank Matli for having explained that the [CAN](http://en.wikipedia.org/wiki/Controller_area_network) interface API probably has functions to retrieve the ID, data length and the data of a [CANopen](http://en.wikipedia.org/wiki/CANopen) message. Based on the explanation, one could tell if the frame is a PDO and derive the sender node's ID from the COB-ID.)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T12:47:04.530

PDO 和数据之间的关系在对象字典的 PDO 映射条目中定义。但这可能不是最简单的找出方法。

由于我不知道您尝试与哪个设备通信，因此我无法向您提供有关其数据输出的任何信息。您必须查阅设备的文档或询问制造商。但是，例如，如果您有一个完全符合特定设备配置文件的通用 I/O 模块（例如，通用 I/O 模块的 401），它可能会根据该设备配置文件具有默认映射。

我建议您阅读 CiA DS 301 以及任何适用的设备配置文件。这些文件可从[CiA获得](http://www.can-cia.org/index.php?id=440)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-07-07T16:52:11.000

OD 中有两个地方，您可以在其中获得有关围绕公共汽车旋转的 PDO 的所有信息。前提是您知道所有连接的节点：

1.  PDO 参数（R：0x14xx 和 T：0x18xx）。在每个子索引 1 中，您可以找到特定 PDO 使用的[COB-ID](https://en.wikipedia.org/wiki/CANopen#Communication_objects)。
2.  PDO 映射（R：0x16xx 和 0x1Axx）：每个大于 0 的子索引包含一个字典对象的映射以及在该 PDO 的 8 字节块中的位置。

了解更多信息：

*[与 PDO 的过程数据交换（“过程数据对象”）](http://www.canopensolutions.com/english/about_canopen/pdo.shtml)*

# java - Java 是否应该在未来的版本中打破向后兼容性以获得更简洁的语言？

> ID：442322
> 
> 赞同：7
> 
> 时间：2009-01-14T08:55:16.057
> 
> 标签：java, language-features

*   原语值得保留吗？
*   是否应该删除所有已弃用的内容？
*   我们需要 2 个 GUI 框架吗？
*   ...

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-14T09:01:56.340

正如我[已经提到](https://stackoverflow.com/questions/314540)的，即使在其[How and When To Deprecate APIs](http://java.sun.com/javase/6/docs/technotes/guides/javadoc/deprecation/deprecation.html)中，也没有提及有关实际*删除*已弃用 API 的政策......

基于旧 JVM（例如 1.4）的应用程序数量仍然很重要，部分原因是**应用程序服务器**需要很长时间才能使用新版本的 JVM 验证自己......

实际在生产中运行的应用程序数量之多意味着这种“向后兼容”策略可能不会很快被打破。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-14T11:18:40.027

向后兼容有几种类型：

1.  旧的源代码可以用新的编译器编译吗？

    这可以使用将旧结构转换为新结构的工具或类似“source 1.6”的工具来处理；文件顶部的指令。

2.  旧的类文件可以在新的 JVM 中运行吗？

    在我的世界里，这是一个完整的表演终结者。我们使用了如此多的第三方库，因此强制同时升级所有这些库的成本太高。

    这也是不删除已弃用的类和方法的驱动程序，但程度较轻。

3.  旧的类文件可以调用用新编译器编译的代码吗？

    由于回调，这是#2 的重要部分。

4.  新编译的代码可以从旧的类文件中调用代码吗？

    #2 的另一个重要部分。

5.  代码看起来与开发人员大体相似吗？

    这对于训练和处理尚未完全转换的大型代码库很重要。一个更微妙的方面是在混合代码库中可以使用多少新功能。如果你打破了这一点，你就会得到类似 Scala 而不是 Java++ 的东西。

以这样的方式添加了泛型以保留*所有*这些类型的兼容性。我认为对 Java 的任何不兼容更改都必须至少保留 2、3 和 4 才能有机会被接受为*Java*。处理 #1 的工具也是最低要求。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-14T09:15:05.660

您可以使用业余爱好 (Ruby)、低实现 (Python) 语言来做到这一点，但您无法想象全世界有多少应用程序是用 Java 编写的。只需检查freshmeat 或sourceforge。而这只是一部分。所以不，这不是一个好主意。实际上，这将是一个非常愚蠢的想法。

没有两个 GUI 框架。Swing 依赖并使用 AWT 作为它的基础。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-14T10:35:27.633

如果某些已弃用的功能被删除，我会非常高兴——例如，如果`Date`对象真的是不可变的，我会非常高兴。事实上，如果你正在编写一个不可变的类，你不能假设 Dates 是不可变的，并且必须防御性地复制它们，例如，你不能可靠地将它们用作 Hashmaps 中的键（因为在这两种情况下，其他代码无论方法是否被注释为已弃用，都可以改变日期）。

当谈到添加新的语言特性时，我并不完全理解向后兼容的口头禅。在我看来，如果为以前的版本编写的代码需要一些调整才能在以后的版本中运行，这没什么大不了的。事实上，无论如何，这都是有先例的。在 1.5 和 1.6 之间，向 ResultSet 接口添加了额外的方法，因此可以在 Java 1.5 下编译和运行的代码甚至无法在 1.6 下编译。

考虑到遗留应用程序，有人期望 5 年内未更新的应用程序在最新版本的 JVM 上完美运行是否合理？如果组织仍在使用 Java 1.4 和为其编写的应用程序，他们真的关心 Java 7 中的内容吗？破坏向后兼容性并不意味着所有先前版本的 JVM 也会被破坏。如果应用程序针对的是早期版本，则可以在该版本的 JVM 上运行它而无需担心。

最重要的是，随着时间的推移和人们使用 Java，错误和功能差距变得明显，纠正/实施这些将是一个重大的福音。在尝试改进语言时被束手无策，因为不幸的是之前发生的事情，在我看来这不是基本要求。

当然，需要对升级路径进行一些思考。例如，突然将 int 更改为 Integers 将需要为每个人进行大量繁琐的代码更改（以及必须添加额外的 null 检查等）。然而，添加一个碰巧破坏向后兼容性的新特性（例如闭包），或删除已被弃用多年的方法，对现有代码几乎没有影响。（如果您一直在使用不推荐使用的方法，那么您之前应该删除它们，但现在您被迫这样做！）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-14T10:48:05.627

出于兼容性原因，他们不能使用标准 Java 版本来做到这一点。现在有太多的 Java 软件在生产中，你根本无法用一个新的版本来打破它，消除所有的垃圾。

但是，我确实认为 Sun 可以发布一个“Java X”版本，删除所有笨拙的东西，并添加所有现有但当前未包含的良好和有用的 API（包括替换具有更好替代方案的 Java API，例如， log4j，让我们不要从日期和日历开始）。此版本不会被设计为取代 Java，但可以作为新软件项目的目标存在。我想他们还可以修复语言以包含与最新版本的 C# 等相比使 Java 看起来有点笨拙的缺失功能。如果他们也制作了可以修复或至少添加的代码移植工具“FIXME”到代码库中的所有问题区域......

必须承认，当 .NET 推出时，微软在将人们转移到更新版本的 .NET 方面做得很好。Sun 在这方面完全失败了，考虑到仍然在 1.4 上运行的应用程序的数量，以及许多公司昏昏欲睡的 Java 版本政策（他们似乎很乐意让他们的 .NET 人员以某种方式使用最新最好的版本）。鉴于在一台机器上安装多个 Java 很简单，我认为应该做更多的工作来鼓励公司和软件公司尽快升级。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-14T10:37:54.463

我会说打破向后兼容性对于java来说是一件愚蠢的事情。如果是这样，您可以称它为 Java++，它不再是 Java。另一方面，对于 java 的未来版本，它应该向动态语言学习语法简单等特性。由于硬件功能的增长速度如此之快，因此编译语言的抽象级别应该更高。将当前 java 版本的一些特性与动态语言进行比较，过于笨拙和冗长，从而降低了开发效率。似乎 C# 正在成为一种动态语言？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-14T14:34:54.890

在 JVM 上有许多很棒的替代语言，我真的不明白为什么。我宁愿拥有一个稳定的 Java，然后继续使用很酷的新东西（并且仍然与 Java 兼容）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-14T08:58:18.063

因为，大部分市场份额仍然使用较旧的 jdk/jre，我认为打破向后兼容性并不实用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-14T09:04:57.193

正如 Pat 所说，采用最新 JDK 版本的速度相当缓慢，而且目前许多应用程序都在使用 Java 的旧（有时真的很旧）版本运行。

因此，我认为不保证向后兼容性并没有真正的好处。

对于您的建议，我并没有真正看到删除原语的兴趣。当然，从 Java 5 开始就有自动装箱。但是原语仍然有他们的兴趣......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-14T09:06:23.507

如果 JVM 保持不变，那么破坏兼容性将是有意义的。在这种情况下，“新”Java 将成为在 JVM 上运行的一种新的、不同的语言，例如[此处](http://en.wikipedia.org/wiki/List_of_JVM_languages)列出的那些。幸运的是，JVM 的设计方式保证了语言和版本之间的互操作性，所以我认为影响是有限的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-14T09:21:30.793

我认为 fork 更适合对语言进行适当的检修。坦率地说，Java 泛型的工作方式开始让我很生气。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-14T09:30:24.317

我离开 PHP 的原因是它们在主要版本升级之间改变了 API/可用函数。真正的问题是对于旧脚本，PHP 不能在兼容模式下运行。我不想被迫升级我的代码。

Java 在同一个地方。只要确保你可以在新版本上使用旧的 1.4 的东西。要求新程序使用新的 xyntax 是可以的，但让旧的东西运行！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-14T10:06:44.540

关于原语，无论喜欢与否，它们都会一直存在，因为它们是对象的基本构建块。当然，您可以改用包装类，但这只会使编译器过度工作，在大多数情况下最终会转换回原语。

向后兼容性非常重要，正如这里已经提到的，还有很多用户仍在运行 1.3 和 1.4 代码。话虽如此，我认为如果有人仍在某些遗留系统中运行 java 1.0 或 1.1 代码，他们不太可能很快迁移到 Java 7，即使他们这样做了，他们也很可能需要重写他们的反正代码。我认为可以安全地删除 >1.2 版本的已弃用 API。

向后兼容的另一个方面是添加关键字，这总是不鼓励的。在 Java 5 中，主要的语言更改是通过添加一个新关键字“enum”来管理的，甚至这也引起了愤怒，因为现在每段带有名为“enum”的变量的代码都是不兼容的。据我所知，Java 7 中的更改是在没有新关键字的情况下计划的（呸！）。

尤瓦尔=8-)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-14T10:07:01.263

这会很好，这取决于 Sun 不会向所有客户端推送新的 JDK 升级。使用旧 API 的人不会升级，会使用旧版本的 JDK 一段时间。

或者，也许，通过实现向后兼容模式。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-07-25T16:13:52.073

我认为应该重写一些 API，例如日期时间。如果当前版本收到 EOL，则应删除旧 API。我们的统计数据显示，我们 99.3% 的客户使用 Java 6 或更新版本。不需要兼容性非常旧的 API。但是，如果要删除 API，则必须有明确的时间范围。

# parsing - Chomsky 层次结构和 LL(*) 解析器

> ID：442325
> 
> 赞同：4
> 
> 时间：2009-01-14T08:57:13.043
> 
> 标签：parsing, compiler-construction, antlr, theory, chomsky-hierarchy

我想解析一种编程语言。我阅读了很多关于形式语言、乔姆斯基层次结构和 ANTLR 的内容。但是我找不到有关如何将 ANTLR v3 语言作为 LL(*) 递归下降解析器接受到 chomsky 层次结构的信息。

Chomsky 类型如何与 LL(*) 混合？非常感谢任何信息（在线、书籍、论文）。

编辑：ANTLR 的句法/语义谓词和回溯如何映射到这个？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-14T09:24:06.547

乔姆斯基层次结构基本上是：

1.  常规语言
2.  上下文无关语法
3.  上下文相关语法
4.  递归可枚举（图灵完备）语法

LL 语法（和解析器）是上下文无关语法的一个子集。之所以使用它们，是因为常规语言对于编程目的来说太弱了，并且因为一般的上下文无关解析器是 O(n^3)，这对于解析程序来说太慢了。事实上，用辅助函数增强解析器确实使它更强大。 [LL 解析器上的维基百科条目](http://en.wikipedia.org/wiki/LL_parser)解释了其中的一些内容。[Dragon Book](http://dragonbook.stanford.edu/)被认为是编译器方面的主要教科书，并且可能会进一步解释。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-14T09:20:13.323

LL(*) 是上下文无关语言的一个子集。然而，一个不同的问题是 antlr 可以解析什么，给定谓词和回溯，这扩展了它的能力。

请注意，如果我们谈论 LL(*)，则表示 ANTLR v3，而不是 2。

# cocoa-touch - 带有 Core Graphics 绘图的 Core Animation

> ID：442326
> 
> 赞同：2
> 
> 时间：2009-01-14T08:58:04.493
> 
> 标签：cocoa-touch, core-animation, core-graphics

我在 UIView 子类中（下面代码中的 CustomView）。

我在 UIImageView 子类（containerView）中的图像周围绘制边框。为此，Core Graphics 代码位于`drawInRect:`子类内部。

核心动画转换是一个翻转，但是当它被绘制时，核心图形代码没有被使用，即`drawInRect:`没有被调用来为 CALayer 提供我的渲染图像。

相反，我从一个图像到另一个图像的动画没有发生任何核心图形绘制。

如何允许 CALayer 使用我的 Core Graphics 绘图而不是原始图像进行动画处理？

```
[CustomView beginAnimations:@"transitionNextImage" context:nil];
[CustomView setAnimationDuration:2.0];
[containerView setImage:image];
[CustomView setAnimationTransition:UIViewAnimationTransitionFlipFromLeft forView:containerView cache:YES];
[containerView setImage:differentImage];
[CustomView commitAnimations]; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T08:09:16.260

好的，是的，我正在实施`drawRect:`，是的，我的绘图在过渡之外工作。

问题是`drawRect:`在`UIImageView`子类内部没有被 CALayer 调用以进行绘图。

因此，当我将这个子类的父类切换到 时`UIView`，为图像实现了我自己的属性，并且还调整了动画 - 一切都融合在一起了。

上面代码中的动画`containerView`被更改为香草`UIView`实例。必须稍微更改动画代码以适应这一点：

```
[CustomView beginAnimations:@"transitionNextImage" context:nil];
[CustomView setAnimationDuration:2.0];
[containerView addSubview:aViewSubclass];
[CustomView setAnimationTransition:UIViewAnimationTransitionFlipFromLeft forView:containerView cache:YES];
[aViewSubclass removeFromSuperview];
[containerView addSubview:anotherInstanceOfTheViewSubclass];
[CustomView commitAnimations]; 
```

即来自Apple关于这些类型转换的文档：

> 如果你想在过渡期间改变视图的外观——例如，从一个视图翻转到另一个——然后使用容器视图，即 UIView 的一个实例，如下所示：
> 
> 1.  开始一个动画块。
> 2.  在容器视图上设置过渡。
> 3.  从容器视图中移除子视图。
> 4.  将新的子视图添加到容器视图。
> 5.  提交动画块。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-14T11:20:07.980

你正在实施`drawRect:`，不是`drawInRect:`，对吧？此外，您是否验证过在此过渡之外，它确实有效？

你能粘贴你的`drawRect:`实现吗？我只是担心 UIImageView 直接设置其图层的内容，而不是依靠`drawRect:`它来做，这意味着你`drawRect:`不起作用。

事实上，考虑到这实际上是多么简单，我建议你只继承 UIView 而不是 UIImageView。缩放图像以进行绘图时保持纵横比的数学非常简单。

当然，另一种选择是子类化 UIImageView，然后重写`setImage:`以基于第一个图像创建一个新图像，但在其周围绘制一个边框，然后将其传递给 super。这样你就不用做任何事情了`drawRect:`。

# calendar - iPhone native apps - access to call logs, SMS, calendar, iTunes library

> ID：442328
> 
> 赞同：1
> 
> 时间：2009-01-14T08:58:41.760
> 
> 标签：calendar, sms, accessibility, desktop, native

As I understand there aren't any public APIs available or any 'legal'/'official' way of accessing those...

I was just wondering how come some Desktop apps (MissingSync, iPhoneDrive) have access to those then...

UPDATE: I found that Desktop App still shows the most updated info from iPhone device, without having to sync/back-up the device to desktop. Which makes me conclude that the Desktop app must be fetching info directly from the device and NOT from the back-up residing on Desktop (Windows PC: `C:\Documents and Settings\USERNAME\Application Data\Apple Computer\MobileSync\Backup`) Pls. correct me if am missing something here..)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-14T09:51:26.927

iPhone 将这些存储在 SQLite 数据库中。如果应用程序有权访问这些文件，它就可以访问数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T09:09:28.290

I think it is because on the Desktop Apple has no way restricting a random application looking in a certain folder where the iPhone backup lives (Windows PC: C:\Documents and Settings\USERNAME\Application Data\Apple Computer\MobileSync\Backup) and reading information from it.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T15:46:34.603

好吧，我认为这取决于应用程序以及拥有最新信息的重要性 - 我已经看到两者都完成了。

但我认为直接从手机获取数据也是可能的，因为我从谷歌找到了这个项目 - [http://code.google.com/p/iphonebrowser/](http://code.google.com/p/iphonebrowser/)

某些应用程序的另一种方法是要求您的计算机和您的 iPhone 在同一个网络上，然后它们也可以直接访问 iPhone 的文件系统（Things 应用程序以及 Apple 自己的 iTunes 远程应用程序）

# c# - 将数组转换为对象[]

> ID：442334
> 
> 赞同：0
> 
> 时间：2009-01-14T09:02:14.030
> 
> 标签：c#, sybase, datawindow

我正在开发一个使用 Sybase Datawindow.net 的 winforms 应用程序。基本上我有一个检索数据的数据窗口（dw_retailer.Retrieve(id)），我得到的是一个对象列表。数据窗口本身存在标签和文本框，我像这样绑定数据

```
newRetailer.foto1 = ((object[])(dataWindowControl.PrimaryData.Rows[0]))[7].ToString();
newRetailer.foto2 = ((object[])(dataWindowControl.PrimaryData.Rows[0]))[6].ToString(); 
```

我现在要做的是将一个字符串放入 object[] 列表中，如下所示

```
((object[])(_targetForm.dw_retailer.PrimaryData.Rows[0]))[5] = retailer.text; 
```

但显然这不起作用。

```
((object[])(_targetForm.dw_retailer.PrimaryData.Rows[0])).SetValue(retailer.text,5); 
```

尽管它有 9 个对象，但它也不起作用（索引超出范围）

```
_targetForm.dw_retailer.PrimaryData.Rows[0] {object[9]} object {object[]} 
```

也试过这样

```
Array arrayList = _targetForm.dw_retailer.PrimaryData.Rows.ToArray();
            arrayList.SetValue(retailer.text, 0,5); 
```

数组不是多维的。因为我需要对象中的对象，所以我需要 arrayList[0][5] 但这也不起作用。

我什至不知道这是否只是我必须在 DataWindow Designer 应用程序中选择的设置。如何将数组转换为 object[]，以便可以将其放回 _targetForm.dw_retailer.PrimaryData.Rows。甚至可以编辑数据窗口吗？

* * *

仍然不工作马克

```
IList list = ((IList)(_targetForm.dw_retailer.PrimaryData.Rows[0]));
list[5] = retailer.text; 
```

Retailer.text 的值 "tekst" list[5] 不变。

它不完全是添加一个项目，更像是编辑一个项目。关于索引超出范围，我知道列表中只有 8 个项目，这就是为什么我觉得奇怪的是第五个是索引超出或范围。也许我只是不太了解 .SetValue() 。

感谢 IList 寿！但是如何将 IList 转换回 object[]？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T09:48:09.260

回复：将列表转换为对象，您可以手动进行：

```
object[] objs = new object[list.count];
for (int i=0; i < list.Count; i++) {
  objs[i] = list[i];
} 
```

这有点粗俗，但它的意图很明确，它会起作用:-)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T10:31:04.257

```
_targetForm.dw_retailer.SetColumn(6);
_targetForm.dw_retailer.SetText(retailer.text);
_targetForm.dw_retailer.SetColumn(9);
_targetForm.dw_retailer.SetText(retailer.webname); 
```

首先，您必须使用 SetColumn 激活要编辑的控件，然后调用 SetText。

现在大家都知道了！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T09:13:27.487

你说它是一个“对象列表”；而不是专注于`object[]`，非泛型`IList`怎么样？

```
((IList)(_targetForm.dw_retailer.PrimaryData.Rows[0]))[5] = retailer.text; 
```

那应该支持数组、列表等。

重新索引超出范围；C# 索引几乎总是从零开始，因此如果列表中有 9 项，则最后一项是`array[8]`. 如果要*添加*项目，`IList`首选：`list.Add(foo)`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T22:17:02.047

这可能无法回答您的直接问题，但我认为它可能会解决您的意图。DataWindow 控件具有专门用于更改缓冲区内数据的 GetItem() 和 SetItem() 方法。有了这些，您根本不必担心对象数组。

# c# - 检测分辨率的变化c#WinForms

> ID：442337
> 
> 赞同：28
> 
> 时间：2009-01-14T09:03:51.593
> 
> 标签：c#, .net, winforms

有没有一种简单的方法可以挂钩在更改全局屏幕分辨率时触发的事件？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-01-14T09:17:00.507

处理以下事件：

```
Microsoft.Win32.SystemEvents.DisplaySettingsChanged 
```

您可以参考[此](http://msdn.microsoft.com/en-us/library/microsoft.win32.systemevents.displaysettingschanged.aspx)页面了解更多详情。

您可能还想查看有关 SystemEvents 类的[msdn 文章。](http://msdn.microsoft.com/en-us/library/microsoft.win32.systemevents.aspx)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-14T09:23:18.793

有两个事件 -`SystemEvents.DisplaySettingsChanged`您`SystemEvents.DisplayedSettingsChanging`可以处理。请注意，这两个事件都是静态的，您需要在退出程序之前分离处理程序。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-09-02T07:16:09.090

当然，如果您的程序（进程）即将死去，您不必取消订阅静态事件（或任何事件）。操作系统将负责将进程的所有内存释放给操作系统。但是，如果您订阅了静态事件或指向生命周期比订阅的对象更长的对象的任何事件，并且您希望该对象符合 GC 条件 - 您需要取消订阅 (-=) 事件。

并且始终取消订阅所有事件始终是一个好习惯。在源代码/产品的生命周期中，您永远不知道对象的生命周期何时（被其他人）更改......

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-08-10T02:06:27.710

试试这个简单的代码

```
using Microsoft.Win32;

SystemEvents.DisplaySettingsChanged += new EventHandler(SystemEvents_DisplaySettingsChanged);

static void SystemEvents_DisplaySettingsChanged(object sender, EventArgs e)
{
     MessageBox.Show("Resolution Change.");
} 
```

不要忘记这条线`using Microsoft.Win32;`

# .net - 带有 HTTPS 的 WCF WSDL 位置地址

> ID：442342
> 
> 赞同：6
> 
> 时间：2009-01-14T09:05:02.310
> 
> 标签：.net, wcf, networking, hosting

WCF 的一个常见问题似乎是如何在 wsdl 中解析主机名以获取到其他文件的链接。问题是计算机的机器名称被放入 wsdl 以链接其他 wsdl 文件，因此如果您访问**[http://myhost/service.svc](http://myhost/service.svc)**它可能指向另一个位置上的其余 wsdl，**即[http ://mypc/service.svc?wsdl](http://mypc/service.svc?wsdl)**这显然是您在外部看不到的东西。

已经有一些解决方案，这是常见的解决方案。您可以在哪里设置主机标头。

*   [http://jberke.blogspot.com/2008/06/wsdl-for-wcf-aspnet-service-uses-local.html](http://jberke.blogspot.com/2008/06/wsdl-for-wcf-aspnet-service-uses-local.html)

我的问题是，使用外部 IP 时如何解决这个问题。我正在从他们的网站连接到客户总部以检索数据，它没有使用 dns 等设置，并且 ip 在内部重新路由到机器。有没有办法强制托管 WCF 的机器在 wsdl 文件中显示外部地址而不是机器名称？

我正在使用 SSL 进行连接，这可能会有所不同（与主机头一样）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-22T07:03:41.160

您需要在 IIS 中为网站的secureBingings 配置主机头。

这是一篇关于[WCF WSDL 和 xsd 的文章：在 IIS 中托管时，导入 schemaLocations 链接到本地​​机器名而不是域名](http://www.codemeit.com/wcf/wcf-wsdl-xsdimport-schemalocations-link-to-local-machine-name-not-domain-name-while-hosted-in-iis.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T11:57:39.223

是的，您可以将 IP 地址设置为主机标头。只需确保外部 IP 地址实际上也能在内部被识别。在我们的一个项目中，我们使用 ISA 服务器作为代理时，我很难学到这一点。

如果你曾经遇到过这样的情况，并且你仍然坚持使用外部 IP 地址作为主机头，那么你唯一的选择就是将 web 服务的机器名添加到 hosts 文件中。

# python - python的通用捕获

> ID：442343
> 
> 赞同：98
> 
> 时间：2009-01-14T09:05:20.077
> 
> 标签：python, exception

我有一些非常奇怪的行为，似乎会导致无声异常。如何编写一个通用的 try catch 来调试所有异常。类似于以下内容：

```
try:
    # something that fails
except e:
    print e 
```

更多关于手头问题的详细信息：

我有一个 Django 应用程序，它在我的计算机（Ubuntu Linux 8.10）上通过 runserver 和 mod-python 都可以正常工作。在部署服务器（Ubuntu Linux 8.10）上，它通过 runserver 工作正常，但通过 mod-python 中的 apache 失败。

我已将原因减少到使用 Berkeley DB (bsddb.db) 和辅助键的应用程序的一部分。辅助键的回调方法使用 pickle 来格式化键。当我在单个值上调用 pickle 时，它​​会失败。但是，只有当我使用 cPickle 时它才会失败，并且在回调函数之外对相同的值使用 pickle 也可以。

我只想知道为什么 cPickle 会失败。

* * *

## 回答 #1

> 赞同：185
> 
> 时间：2009-01-14T09:12:41.873

在程序终止之前，默认情况下已经打印了异常。如果您想将错误发送到其他地方（不打印），您可以这样做：

```
try:
    something()
except Exception as e:
    send_somewhere(traceback.format_exception(*sys.exc_info()))
    raise # reraises the exception 
```

请注意，这种使用`as`关键字的格式适用于 python > 2.6。旧的方法是：

```
except Exception, e: 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-14T09:10:18.943

[回溯模块](http://docs.python.org/library/traceback.html)对于格式化回溯非常有用。然后，您可以将其写入日志文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-14T09:07:41.413

这行得通吗？：

```
except BaseException, e: 
```

# php - 如何对 Mime 类型进行分类 (PHP)

> ID：442346
> 
> 赞同：3
> 
> 时间：2009-01-14T09:06:35.113
> 
> 标签：php, mime-types

我正在寻找对 mime 类型进行分类的代码片段。

例如，

应用程序/msword

应用程序/vnd.oasis.opendocument.text

申请/pdf

两者都是办公文件。当我将这些 mime 类型传递给函数时，我希望它返回一个结果，即“office”、“image”、“application”、“compressed”等。

但是，如您所知，有数百种 mime 类型，我无法收集所有这些类型。

你知道我在哪里可以找到它吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T13:35:54.620

我不知道有任何现有的脚本可以按照您的意愿对这些类型进行分类。您可能需要根据您需要的区别自己创建此功能，例如 application/msword -> office 而不是 application 等。

由于您的分类是相当随意的，并且特定于您自己的用例，您可能必须自己将它们分类到您想要的类别中，例如通过使用类似以下的函数：

```
/**
 * Classify mime types into pre-determined categories
 * 2-d array used for simplicity of example, error
 * checking omitted so unrecognised string returns
 * empty value here...
 */
function categorize_mime_types($mime)
{
    // Classify mime types into desired categories, key-val pairings
    $mimes = array("application/msword"=>"office",
                   "application/vnd.oasis.opendocument.text"=>"office",
                   ....
                   "image/jpeg"=>"image");
    return $mimes[$mime];
} 
```

收集所有的 mime 类型来执行此操作可能非常耗时，尽管有许多网站有[大量列表](http://reference.sitepoint.com/html/mime-types-full)可以帮助您入门。

# c++ - 命令行参数不起作用 - 完全跳过它们

> ID：442354
> 
> 赞同：3
> 
> 时间：2009-01-14T09:11:43.093
> 
> 标签：c++, command-line, arguments

好吧，我正在尝试让参数与小型测试应用程序一起正常工作。我的代码如下。我在 C++ 方面没有太多经验，所以我不确定为什么当我使用 -print（或 --print）启动测试时，它会自动声明“不是有效选项”，然后结束。

```
#include <iostream>

int main(int argc, char* argv[])
{
    int option;
    option = 1;
    char* argument;
    argument = argv[option];
    while (option < argc)
    {
        if (argument == "-print")
        {
            std::cout << "Printing Extra Text";
        }
        else
        {
            std::cout << "Not a valid option" << std::endl;
        }
        option++;
    }
    std::cout << "Printing normal text" << std::endl;
    return 0;
} 
```

我这样做对吗？提前致谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-14T09:14:54.410

您正在将字符串“-print”的内存地址与`argument`. 这行不通！用于`strcmp()`比较字符串值。代替：

```
if (argument == "-print") 
```

做

```
if (strcmp(argument, "-print") == 0) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-14T09:17:35.030

以下行有问题：

```
if (argument == "-print") 
```

在这里，您正在比较指针，而不是字符串值。用。。。来代替：

```
if (strcmp(argument, "-print") == 0) 
```

在字符串处理方面，C/C++ 的行为与 Java 或 C# 不同。字符串不是本机类型或对象，而只是美化了指向字符数组的指针。

或者，如果您的选项列表变得更复杂，请考虑使用专用的选项解析库，例如[Boost](http://www.boost.org/)的[Program_options](http://www.boost.org/doc/libs/1_37_0/doc/html/program_options.html)。它将处理所有方面，包括验证和用户消息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-14T09:25:10.943

我用 C++ 编程已经有一段时间了，但不应该只使用

```
std::string argument; 
```

然后与 == 的比较会起作用吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-14T09:15:00.497

```
if (argument == "-print") 
```

你不能像这样比较字符串！

使用 strcmp() 比较字符串。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-14T09:33:25.153

您的问题表明您还想测试 --print （两个破折号），但您的代码不会检查它。

此外，您在循环外分配参数，您将希望在循环内执行此操作，否则您每次在循环周围只会测试参数 #1。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-14T09:47:54.983

当您阅读该论点时，还有另一个问题。（进行所有必要的更改）

```
int main(int argc, char* argv[])
{
    int option;
    option = 1;
    char* argument;
    while (option < argc)
    {
        argument = argv[option];
        if (strcmp(argument, "-print") == 0)
        {
            std::cout << "Printing Extra Text";
        }
        else
        {
            std::cout << "Not a valid option" << std::endl;
        }
        option++;
    }
    std::cout << "Printing normal text" << std::endl;
    return 0;
} 
```

# python - 用 Django 实现配置应用程序的最佳方法是什么？

> ID：442355
> 
> 赞同：4
> 
> 时间：2009-01-14T09:11:43.933
> 
> 标签：python, django, configuration, django-models, django-admin

我需要为基于 Django 的应用程序编写一种配置注册表。

要求：

1.  最有可能`param_name`：`param_value`结构
2.  可通过管理界面编辑
3.  必须使用syncdb。如何处理其他应用程序依赖配置模型并且模型本身尚未在数据库中初始化的情况？假设我想拥有可配置的模型字段属性，即默认值设置？

任何想法或建议将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-22T11:51:51.600

我发现[djblets.siteconfig](http://www.chipx86.com/blog/?p=261)非常有用。与 Admin 应用程序配合得很好，并且非常易于使用。强烈推荐。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T11:05:37.620

有一次（一年前）我使用[dbsettings](http://code.google.com/p/django-values/)来通过管理界面访问某种业务配置，但我不能说它现在如何适合。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T19:25:43.180

我认为如果您让其他应用程序依赖（在解释/应用程序加载时）在您的配置应用程序中设置的值，您将遇到麻烦。您可以在解释时在 Python 代码中使用某种占位符值，然后在 post_syncdb 信号上提取真实的配置数据吗？

# visual-studio-2008 - 在 Web 应用程序项目 (MVC) 中发布失败

> ID：442374
> 
> 赞同：1
> 
> 时间：2009-01-14T09:18:01.393
> 
> 标签：visual-studio-2008, deployment, publish

我通常使用 VS 2008 中的“发布”功能来获取正确的文件等，以便我可以发布到我的网站。但有时发布失败，根本没有任何好的错误消息。我知道这可能是几个不同的原因，但我现在开始对此感到非常厌倦。

谁能教我如何从命令行构建网站？正如我所说，这是一个 MVC 项目。我可以用`aspnet_compiler`这个吗？我应该使用哪些参数来模拟与“发布”相同的行为？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T01:06:51.687

在发布到本地目录的*普通*Web 项目中，我偶尔会遇到同样的问题。

所以不需要 FP 并且目录权限永远不会改变。它有时会起作用，然后就失败了。输出控制台对于故障排除毫无用处。它会说构建成功，然后在下一行发布失败。记录结束。

没有任何关于发布失败原因的好消息是非常烦人的。这是 VS 2008，你会认为他们至少可以提供一个提示。

为了解决这个问题，我做了两件事。

1.  在“用本地副本替换匹配文件”和“发布前删除所有现有文件”选项之间切换。

2.  重新启动 IDE。

发布到不同的目录，清理然后构建，停止 IIS 不起作用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-18T00:54:19.223

解决方案！！！！

显示输出窗口。VS 2005 - 查看 -> 输出。

当你发布它会给你所有的错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T09:50:50.547

我有点想通了。不是失败的部分，而是我制作了一个命令行构建脚本。我[在这里写了博客](http://codepolice.net/2009/01/14/publish-web-application-project-failed/)。

我在这里粘贴代码时遇到了麻烦，但所有信息都在博客文章中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-03T17:54:21.127

我遇到了同样的问题。在查看了他发布的 Stuck 博客链接上的评论后，我尝试使用 TortoiseSVN 的导出功能来获得没有 svn 管理内容的代码的干净副本。从那里进行编译和发布工作。

不知道这是否与您的问题相同，但我们确实在这里使用 SVN、TortoiseSVN 和 AnkhSVN。如果您有相同的设置，可能值得一试。

我知道这篇文章对于最初的问题来说有点晚了——但这是谷歌上最好的结果之一，所以我认为其他有这个问题的人可能会发现对我有用的东西有点运气。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T16:29:48.910

我遇到了同样的问题，但我不知道原因，所以我无法重现它。

但是，如果您在解决方案中创建第二个 MVC 项目并将其发布，那么另一个也将重新开始工作。

至少在我的情况下这是有效的。

# javascript - 使用 JavaScript 跳转到新的 HTML 页面

> ID：442384
> 
> 赞同：11
> 
> 时间：2009-01-14T09:23:11.367
> 
> 标签：javascript, redirect

在我的 HTML 页面中，我需要检查是否安装了 Adob​​e Flash 播放器。如果没有，我想自动跳转到另一个 HTML 页面，告诉用户需要 Flash 播放器。

我正在使用 JavaScript 检查 Flash 播放器是否可用，使用“ [JavaScript Flash 检测库](http://www.featureblend.com/javascript-flash-detection-library.html)”。

我的 HTML 页面的正文如下所示：

```
<body>
    <script type="text/javascript"> 
    if(!FlashDetect.installed)
    {
        alert("Flash 9.0.115 is required to enjoy this site.");
    }
    </script>
    ...
    ... 
```

检测有效：我可以看到警报，但我没有找到跳转到另一个 HTML 页面的方法。

有什么提示吗？

**编辑：**有一些我没有提到的东西似乎有所不同：HTML 页面是本地页面（从 CD-ROM 运行），我想跳转到位于当前目录中的 HTML 页面.

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-01-14T09:26:40.300

```
window.location.href = "http://stackoverflow.com"; 
```

对于本地文件，如果您知道相对路径，这应该可以工作：（在您的情况下这是有效的。）

```
window.location.href = "someOtherFile.html"; 
```

也许你也可以绝对使用这个：（未测试。）

```
window.location.pathname = "/path/to/another/file.html/"; 
```

问题在于浏览器供应商的安全措施。谷歌有一些关于它的[好信息](http://blog.chromium.org/2008/12/security-in-depth-local-web-pages.html)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-14T10:58:40.473

非常警惕即时 JavaScript 重定向。Flash 检测脚本可能是错误的 (*)，因此最好允许用户通过某种手动覆盖或仅使用后备内容自行决定是否使用 Flash。

写入 location.href 有效，但可以“破坏后退按钮” - 如果用户按下后退并且您的页面将他们再次转发页面，他们不太可能感到高兴。location.replace('...') 避免了这个问题。

(* - there are two approaches to Flash detection, neither of them reliable. Creating a Flash instance and sniffing for it breaks with software like FlashBlock or just slow loading, and sniffing for plugins directly is not standardised and likely to break on more obscure platforms. Adobe's own code at [http://www.adobe.com/devnet/flashplayer/articles/future_detection_print.html](http://www.adobe.com/devnet/flashplayer/articles/future_detection_print.html) ends up resorting to sniffing the UA string, ugh.)

# hyper-v - Hyper-V：删除快照失败，无效状态

> ID：442386
> 
> 赞同：0
> 
> 时间：2009-01-14T09:23:33.363
> 
> 标签：hyper-v

运行虚拟机的驱动器空间不足，这导致我所有的虚拟机都进入暂停关键状态。

为了释放一些空间，我想删除我拍摄的一些快照。我的快照是从主 VM 扩展的，现在（绿色箭头）扩展了快照。

当我尝试删除快照时，出现以下错误。

```
Failed to perform the operation. The virtual machine is not in a valid state to perform the operation. 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T04:38:35.573

我试图做同样的事情并且有那个错误。之后，VM 的虚拟网络适配器设法为该 VM 禁用自身，因此所有用户都失去了与服务器的连接。需要关闭 VM 并重新启用虚拟网络适配器才能解决。所以要小心这个。不确定 SCVMM 是否存在问题？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-14T02:46:58.570

尝试将您的 VM 导出到具有足够空间的另一个位置。在我错误地单击快照并用完空间后，我能够恢复暂停的虚拟机。导出后，我从 Hyper-V 管理器中删除了 VM，然后重新创建/导入了 VM。

# cocoa - 如何为 NSPersistentDocument 窗口赋予标题

> ID：442396
> 
> 赞同：0
> 
> 时间：2009-01-14T09:28:16.367
> 
> 标签：cocoa, core-data

我将 NSPersistentDocument 子类化。我也重命名了窗口。但是当我运行应用程序时，我得到应用程序窗口的标题为“无标题”。没有`-setTitle:`可以用来更改标题的方法。有什么想法我该怎么做？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T10:27:51.580

您是否通过发送`setTitle:`到窗口来设置标题？

如果是这样，那就错了。`displayName`改为设置文档的 。（记住，`NSPersistentDocument`是 的子类`NSDocument`。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-14T16:55:47.820

您不更改标题，您的用户通过保存文档来更改。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-29T03:45:02.847

您可以将 Window 的标题绑定到文档并使用 Key-Value-Observation 来更新它。

使用 Interface Builder 选择 MyDocument.xib 的“窗口”并移至检查器中的“绑定”选项卡。检查“标题”以绑定到“文件所有者”和“模型密钥路径”为“标题”。

然后在 NSPersistentDocument 的子类中添加此代码

```
@interface MyDocument : NSPersistentDocument {
  NSString * _title;
}  
@end

@implementation MyDocument

//P All kinds of all your good stuff here

- (NSString *) title {
  return _title;
}

@end 
```

现在如果你想改变窗口的标题，你可以使用 KVO。例如

```
- (BOOL)readFromURL:(NSURL *)absoluteURL 
             ofType:(NSString *)typeName 
              error:(NSError **)outError {

  //P All your good code

  [self willChangeValueForKey:@"title"];
  _title = [absoluteURL lastPathComponent];
  [self didChangeValueForKey:@"title"];  

  //P More good code

} 
```

# javascript - 检索 HTML 元素的位置 (X,Y)

> ID：442404
> 
> 赞同：1995
> 
> 时间：2009-01-14T09:35:03.310
> 
> 标签：javascript, html, css, dom, position

我想知道如何在 JavaScript中获取 HTML 元素的 X`img`和Y 位置。`div`

* * *

## 回答 #1

> 赞同：2190
> 
> 时间：2012-07-09T14:06:24.990

正确的方法是使用[`element.getBoundingClientRect()`](https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect)：

```
var rect = element.getBoundingClientRect();
console.log(rect.top, rect.right, rect.bottom, rect.left); 
```

只要您可能关心，Internet Explorer 就一直支持这一点，并且它最终在[CSSOM 视图](http://www.w3.org/TR/cssom-view/#the-getclientrects-and-getboundingclientrect-methods)中标准化。所有其他浏览器[很久以前就](http://www.quirksmode.org/dom/w3c_cssom.html#t21)采用了它。

一些浏览器还返回高度和宽度属性，尽管这是非标准的。如果您担心较旧的浏览器兼容性，请检查此答案的修订以获取优化的降级实施。

返回的值`element.getBoundingClientRect()`是相对于视口的。如果您需要它相对于另一个元素，只需从另一个矩形中减去一个矩形：

```
var bodyRect = document.body.getBoundingClientRect(),
    elemRect = element.getBoundingClientRect(),
    offset   = elemRect.top - bodyRect.top;

alert('Element is ' + offset + ' vertical pixels from <body>'); 
```

* * *

## 回答 #2

> 赞同：355
> 
> 时间：2009-01-14T10:04:45.700

库会竭尽全力获得元素的准确偏移量。
这是一个简单的函数，可以在我尝试过的每种情况下完成这项工作。

```
function getOffset( el ) {
    var _x = 0;
    var _y = 0;
    while( el && !isNaN( el.offsetLeft ) && !isNaN( el.offsetTop ) ) {
        _x += el.offsetLeft - el.scrollLeft;
        _y += el.offsetTop - el.scrollTop;
        el = el.offsetParent;
    }
    return { top: _y, left: _x };
}
var x = getOffset( document.getElementById('yourElId') ).left; 
```

* * *

## 回答 #3

> 赞同：352
> 
> 时间：2015-01-29T18:46:34.720

此函数返回元素相对于整个文档（页面）的位置：

```
function getOffset(el) {
  const rect = el.getBoundingClientRect();
  return {
    left: rect.left + window.scrollX,
    top: rect.top + window.scrollY
  };
} 
```

使用它我们可以得到 X 位置：

```
getOffset(element).left 
```

...或Y位置：

```
getOffset(element).top 
```

* * *

## 回答 #4

> 赞同：149
> 
> 时间：2018-09-24T10:41:35.573

**如果您只想在 javascript 中完成**，这里有一些 使用的**衬垫**[`getBoundingClientRect()`](https://developer.mozilla.org/docs/Web/API/Element/getBoundingClientRect)

```
window.scrollY + document.querySelector('#elementId').getBoundingClientRect().top // Y

window.scrollX + document.querySelector('#elementId').getBoundingClientRect().left // X 
```

第一行将返回`offsetTop`相对于文档的 Y。第二行将返回`offsetLeft`相对于文档的 X。

[`getBoundingClientRect()`](https://developer.mozilla.org/docs/Web/API/Element/getBoundingClientRect)是一个 javascript 函数，它返回元素相对于窗口视口的位置。

* * *

## 回答 #5

> 赞同：56
> 
> 时间：2009-01-14T09:43:14.387

大多数浏览器上的 HTML 元素将具有：-

```
offsetLeft
offsetTop 
```

这些指定元素相对于其最近的具有布局的父元素的位置。如果有 offsetParent 属性，通常可以访问此父级。

IE和FF3都有

```
clientLeft
clientTop 
```

这些属性不太常见，它们使用其父客户区域指定元素位置（填充区域是客户区域的一部分，但边框和边距不是）。

* * *

## 回答 #6

> 赞同：38
> 
> 时间：2010-08-12T20:14:33.160

如果页面包含 - 至少 - 任何“DIV”，meouw 给出的函数会抛出超出当前页面限制的“Y”值。为了找到准确的位置，您需要同时处理 offsetParent 和 parentNode。

尝试下面给出的代码（检查 FF2）：

```
 var getAbsPosition = function(el){
    var el2 = el;
    var curtop = 0;
    var curleft = 0;
    if (document.getElementById || document.all) {
        do  {
            curleft += el.offsetLeft-el.scrollLeft;
            curtop += el.offsetTop-el.scrollTop;
            el = el.offsetParent;
            el2 = el2.parentNode;
            while (el2 != el) {
                curleft -= el2.scrollLeft;
                curtop -= el2.scrollTop;
                el2 = el2.parentNode;
            }
        } while (el.offsetParent);

    } else if (document.layers) {
        curtop += el.y;
        curleft += el.x;
    }
    return [curtop, curleft];
}; 
```

* * *

## 回答 #7

> 赞同：36
> 
> 时间：2012-01-14T08:57:16.677

您可以添加两个属性来`Element.prototype`获取任何元素的顶部/左侧。

```
Object.defineProperty( Element.prototype, 'documentOffsetTop', {
    get: function () { 
        return this.offsetTop + ( this.offsetParent ? this.offsetParent.documentOffsetTop : 0 );
    }
} );

Object.defineProperty( Element.prototype, 'documentOffsetLeft', {
    get: function () { 
        return this.offsetLeft + ( this.offsetParent ? this.offsetParent.documentOffsetLeft : 0 );
    }
} ); 
```

这被称为：

```
var x = document.getElementById( 'myDiv' ).documentOffsetLeft; 
```

`offset().top`这是一个将结果与 jQuery进行比较的演示：http `.left`: [//jsfiddle.net/ThinkingStiff/3G7EZ/](http://jsfiddle.net/ThinkingStiff/3G7EZ/)

* * *

## 回答 #8

> 赞同：26
> 
> 时间：2013-07-26T01:49:09.877

有效地检索相对于页面的位置，而不使用递归函数：（也包括 IE）

```
var element = document.getElementById('elementId'); //replace elementId with your element's Id.
var rect = element.getBoundingClientRect();
var elementLeft,elementTop; //x and y
var scrollTop = document.documentElement.scrollTop?
                document.documentElement.scrollTop:document.body.scrollTop;
var scrollLeft = document.documentElement.scrollLeft?                   
                 document.documentElement.scrollLeft:document.body.scrollLeft;
elementTop = rect.top+scrollTop;
elementLeft = rect.left+scrollLeft; 
```

* * *

## 回答 #9

> 赞同：23
> 
> 时间：2017-05-22T13:09:51.170

像这样的事情怎么样，通过传递元素的ID，它会返回left或top，我们也可以将它们组合起来：

**1) 找到左边**

```
function findLeft(element) {
  var rec = document.getElementById(element).getBoundingClientRect();
  return rec.left + window.scrollX;
} //call it like findLeft('#header'); 
```

**2）找到顶部**

```
function findTop(element) {
  var rec = document.getElementById(element).getBoundingClientRect();
  return rec.top + window.scrollY;
} //call it like findTop('#header'); 
```

或**3) 一起找到 left 和 top**

```
function findTopLeft(element) {
  var rec = document.getElementById(element).getBoundingClientRect();
  return {top: rec.top + window.scrollY, left: rec.left + window.scrollX};
} //call it like findTopLeft('#header'); 
```

* * *

## 回答 #10

> 赞同：17
> 
> 时间：2010-08-18T14:43:35.537

jQuery [.offset()](http://api.jquery.com/offset/)将获取第一个元素的当前坐标，或者设置匹配元素集中每个元素相对于文档的坐标。

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2009-01-14T09:47:21.337

使用 JavaScript 框架可能会更好地为您服务，该框架具有以独立于浏览器的方式返回此类信息（以及更多！）的功能。这里有几个：

*   [原型](http://www.prototypejs.org/)
*   [jQuery](http://jquery.com/)
*   [MooTools](http://mootools.net/)
*   [YUI（雅虎）](http://developer.yahoo.com/yui/)

使用这些框架，您可以执行以下操作： `$('id-of-img').top` 获取图像的 y 像素坐标。

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2019-08-29T04:10:50.980

```
/**
 *
 * @param {HTMLElement} el
 * @return {{top: number, left: number}}
 */
function getDocumentOffsetPosition(el) {
    var position = {
        top: el.offsetTop,
        left: el.offsetLeft
    };
    if (el.offsetParent) {
        var parentPosition = getDocumentOffsetPosition(el.offsetParent);
        position.top += parentPosition.top;
        position.left += parentPosition.left;
    }
    return position;
} 
```

感谢[ThinkingStiff](https://stackoverflow.com/users/918414/thinkingstiff)的[回答](https://stackoverflow.com/a/8861199/5984649)，这只是另一个版本。

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2015-12-01T07:24:49.480

我接受了@meouw 的回答，添加到允许边框的clientLeft 中，然后创建了三个版本：

getAbsoluteOffsetFromBody - 类似于@meouw，它获取相对于文档正文或 html 元素的绝对位置（取决于 quirks 模式）

getAbsoluteOffsetFromGivenElement - 返回相对于给定元素 (relativeEl) 的绝对位置。请注意，给定元素必须包含元素 el，否则其行为与 getAbsoluteOffsetFromBody 相同。如果您有两个元素包含在另一个（已知）元素中（可选地，节点树上的几个节点）并希望使它们处于相同位置，这将很有用。

getAbsoluteOffsetFromRelative - 返回相对于第一个具有 position: relative 的父元素的绝对位置。这类似于 getAbsoluteOffsetFromGivenElement，出于同样的原因，但只会到达第一个匹配元素。

```
getAbsoluteOffsetFromBody = function( el )
{   // finds the offset of el from the body or html element
    var _x = 0;
    var _y = 0;
    while( el && !isNaN( el.offsetLeft ) && !isNaN( el.offsetTop ) )
    {
        _x += el.offsetLeft - el.scrollLeft + el.clientLeft;
        _y += el.offsetTop - el.scrollTop + el.clientTop;
        el = el.offsetParent;
    }
    return { top: _y, left: _x };
}

getAbsoluteOffsetFromGivenElement = function( el, relativeEl )
{   // finds the offset of el from relativeEl
    var _x = 0;
    var _y = 0;
    while( el && el != relativeEl && !isNaN( el.offsetLeft ) && !isNaN( el.offsetTop ) )
    {
        _x += el.offsetLeft - el.scrollLeft + el.clientLeft;
        _y += el.offsetTop - el.scrollTop + el.clientTop;
        el = el.offsetParent;
    }
    return { top: _y, left: _x };
}

getAbsoluteOffsetFromRelative = function( el )
{   // finds the offset of el from the first parent with position: relative
    var _x = 0;
    var _y = 0;
    while( el && !isNaN( el.offsetLeft ) && !isNaN( el.offsetTop ) )
    {
        _x += el.offsetLeft - el.scrollLeft + el.clientLeft;
        _y += el.offsetTop - el.scrollTop + el.clientTop;
        el = el.offsetParent;
        if (el != null)
        {
            if (getComputedStyle !== 'undefined')
                valString = getComputedStyle(el, null).getPropertyValue('position');
            else
                valString = el.currentStyle['position'];
            if (valString === "relative")
                el = null;
        }
    }
    return { top: _y, left: _x };
} 
```

如果您仍然遇到问题，特别是与滚动有关的问题，您可以尝试查看[http://www.greywyvern.com/?post=331](http://www.greywyvern.com/?post=331) - 我注意到 getStyle 中至少有一段有问题的代码，假设浏览器表现良好，应该没问题，但根本没有测试其余部分。

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2021-08-16T15:14:47.107

这是一个现代的 1-liner 使用 vanilla JS 递归迭代[`element.offsetTop`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop)and [`element.offsetParent`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetParent)：

**功能：**

```
getTop = el => el.offsetTop + (el.offsetParent && getTop(el.offsetParent)) 
```

**用法：**

```
const el = document.querySelector('#div_id');
const elTop = getTop(el) 
```

**优势：**

无论当前滚动位置如何，始终返回绝对垂直偏移量。

* * *

**传统语法：**

```
function getTop(el) {
  return el.offsetTop + (el.offsetParent && getTop(el.offsetParent));
} 
```

* * *

## 回答 #15

> 赞同：10
> 
> 时间：2016-08-25T15:44:24.167

小与小的区别

```
function getPosition( el ) {
    var x = 0;
    var y = 0;
    while( el && !isNaN( el.offsetLeft ) && !isNaN( el.offsetTop ) ) {
    x += el.offsetLeft - el.scrollLeft;
    y += el.offsetTop - el.scrollTop;
    el = el.offsetParent;
    }
    return { top: y, left: x };
} 
```

看一个示例坐标：http: [//javascript.info/tutorial/coordinates](http://javascript.info/tutorial/coordinates)

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2013-04-16T04:56:33.163

如果您使用的是 jQuery，这可能是一个简单的解决方案：

```
<script>
  var el = $("#element");
  var position = el.position();
  console.log( "left: " + position.left + ", top: " + position.top );
</script> 
```

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2009-01-14T10:24:21.603

如果使用 jQuery，[尺寸插件](http://plugins.jquery.com/project/dimensions)非常好，可以让您准确指定您想要的内容。

例如

相对位置、绝对位置、不带填充的绝对位置、带填充...

它继续，让我们说你可以用它做很多事情。

加上使用 jQuery 的好处是它的文件大小轻巧且易于使用，以后没有它你就不会回到 JavaScript。

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2014-11-04T14:17:15.927

我发现的最简洁的方法是 jQuery 使用的技术的简化版本`offset`。与它开头的其他一些答案类似`getBoundingClientRect`；然后它使用`window`和`documentElement`来调整滚动位置以及边缘`body`（通常是默认值）之类的东西。

```
var rect = el.getBoundingClientRect();
var docEl = document.documentElement;

var rectTop = rect.top + window.pageYOffset - docEl.clientTop;
var rectLeft = rect.left + window.pageXOffset - docEl.clientLeft; 
```

```
var els = document.getElementsByTagName("div");
var docEl = document.documentElement;

for (var i = 0; i < els.length; i++) {

  var rect = els[i].getBoundingClientRect();

  var rectTop = rect.top + window.pageYOffset - docEl.clientTop;
  var rectLeft = rect.left + window.pageXOffset - docEl.clientLeft;

  els[i].innerHTML = "<b>" + rectLeft + ", " + rectTop + "</b>";
}
```

```
div {
  width: 100px;
  height: 100px;
  background-color: red;
  border: 1px solid black;
}
#rel {
  position: relative;
  left: 10px;
  top: 10px;
}
#abs {
  position: absolute;
  top: 250px;
  left: 250px;
}
```

```
<div id="rel"></div>
<div id="abs"></div>
<div></div>
```

* * *

## 回答 #19

> 赞同：7
> 
> 时间：2019-03-01T13:56:36.970

要获得元素的总偏移量，您可以递归地总结所有父偏移量：

```
function getParentOffset(el): number {
if (el.offsetParent) {
    return el.offsetParent.offsetTop + getParentOffset(el.offsetParent);
} else {
    return 0;
}
} 
```

使用此实用函数，dom 元素的总顶部偏移量为：

```
el.offsetTop + getParentOffset(el); 
```

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2011-09-10T17:05:08.647

这是我设法创建的最好的代码（也适用于 iframe，与 jQuery 的 offset() 不同）。似乎 webkit 有一点不同的行为。

根据 meouw 的评论：

```
function getOffset( el ) {
    var _x = 0;
    var _y = 0;
    while( el && !isNaN( el.offsetLeft ) && !isNaN( el.offsetTop ) ) {
        _x += el.offsetLeft - el.scrollLeft;
        _y += el.offsetTop - el.scrollTop;
        // chrome/safari
        if ($.browser.webkit) {
            el = el.parentNode;
        } else {
            // firefox/IE
            el = el.offsetParent;
        }
    }
    return { top: _y, left: _x };
} 
```

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2017-10-24T19:23:22.570

虽然这很可能在这么多答案的底部丢失，但这里的顶级解决方案对我不起作用。
据我所知，其他任何答案都没有帮助。

**情况**：
在 HTML5 页面中，我有一个菜单，它是标题内的导航元素（不是标题，而是另一个元素中的标题）。
一旦用户滚动到它，我希望导航保持在顶部，但在此之前，标题是绝对定位的（所以我可以让它稍微覆盖其他东西）。
上面的解决方案从未触发更改，因为 .offsetTop 不会更改，因为这是一个绝对定位的元素。此外， .scrollTop 属性只是最顶部元素的顶部......也就是说 0 并且始终为 0。
我使用这两个执行的任何测试（与 getBoundingClientRect 结果相同）都不会告诉我导航栏的顶部是否曾经滚动到可查看页面的顶部（再次，如控制台中所报告的，它们在滚动时只是保持相同的数字发生了）。

**解决**
方案我的解决方案是利用

```
window.visualViewport.pageTop 
```

pageTop 属性的值反映了屏幕的可视部分，因此允许我跟踪元素相对于可视区域边界的位置。

可能没必要说，每当我处理滚动时，我都希望使用此解决方案以编程方式响应被滚动元素的移动。
希望它可以帮助别人。
*重要提示：[这似乎目前在 Chrome 和 Opera 中有效，并且绝对不适用于 Firefox（6-2018）](https://developer.mozilla.org/en-US/docs/Web/API/VisualViewport) ......直到 Firefox 支持 visualViewport 我建议不要使用这种方法，（我希望他们很快就会这样做......比其他的更有意义）。*

**更新：**
只是有关此解决方案的说明。
虽然我仍然发现我发现对于“......以编程方式响应正在滚动的元素的移动”的情况非常有价值。适用。我遇到的问题的更好解决方案是使用 CSS 来设置[位置：sticky](https://css-tricks.com/position-sticky-2/)在元素上。使用粘性，您可以在不使用 javascript 的情况下使元素保持在顶部（注意：有时这不会像将元素更改为固定那样有效，但对于大多数用途而言，粘性方法可能会更好）

**UPDATE01：**
所以我意识到对于不同的页面，我有一个要求，我需要在一个稍微复杂的滚动设置中检测元素的位置（视差加上作为消息的一部分滚动过去的元素）。在那种情况下，我意识到以下提供了我用来确定何时做某事的价值：

```
 let bodyElement = document.getElementsByTagName('body')[0];
  let elementToTrack = bodyElement.querySelector('.trackme');
  trackedObjPos = elementToTrack.getBoundingClientRect().top;
  if(trackedObjPos > 264)
  {
    bodyElement.style.cssText = '';
  } 
```

希望这个答案现在更广泛有用。

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2015-03-15T12:11:11.583

我这样做是为了与旧浏览器交叉兼容。

```
// For really old browser's or incompatible ones
    function getOffsetSum(elem) {
        var top = 0,
            left = 0,
            bottom = 0,
            right = 0

         var width = elem.offsetWidth;
         var height = elem.offsetHeight;

        while (elem) {
            top += elem.offsetTop;
            left += elem.offsetLeft;
            elem = elem.offsetParent;
        }

         right = left + width;
         bottom = top + height;

        return {
            top: top,
            left: left,
            bottom: bottom,
            right: right,
        }
    }

    function getOffsetRect(elem) {
        var box = elem.getBoundingClientRect();

        var body = document.body;
        var docElem = document.documentElement;

        var scrollTop = window.pageYOffset || docElem.scrollTop || body.scrollTop;
        var scrollLeft = window.pageXOffset || docElem.scrollLeft || body.scrollLeft;

        var clientTop = docElem.clientTop;
        var clientLeft = docElem.clientLeft;

        var top = box.top + scrollTop - clientTop;
        var left = box.left + scrollLeft - clientLeft;
        var bottom = top + (box.bottom - box.top);
        var right = left + (box.right - box.left);

        return {
            top: Math.round(top),
            left: Math.round(left),
            bottom: Math.round(bottom),
            right: Math.round(right),
        }
    }

    function getOffset(elem) {
        if (elem) {
            if (elem.getBoundingClientRect) {
                return getOffsetRect(elem);
            } else { // old browser
                return getOffsetSum(elem);
            }
        } else
            return null;
    } 
```

更多关于 JavaScript 坐标的信息：http: [//javascript.info/tutorial/coordinates](http://javascript.info/tutorial/coordinates)

* * *

## 回答 #23

> 赞同：5
> 
> 时间：2021-05-23T18:13:36.520

```
HTML program to show (x, y) of an
element by dragging mouse over it  you just copied it and use it on your own 
<!DOCTYPE html>
<html>
    <head>
        <title>
            position of an element
        </title>

        <!-- scropt to get position -->
        <script type = "text/javascript">
            function getPositionXY(element) {
                var rect = element.getBoundingClientRect();
                document.getElementById('text').innerHTML
                = 'X: ' + rect.x + '<br>' + 'Y: ' + rect.y;
            }
        </script>
    </head>

    <body>
        <p>Move the mouse over the text</p>

        <div onmouseover = "getPositionXY(this)">
            Position:
            <p id = 'text'></p>
        </div>

    </body>
</html> 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2014-10-23T15:02:06.943

我成功地使用了 Andy E 的解决方案来定位引导程序 2 模式，具体取决于用户单击表格行中的链接。该页面是 Tapestry 5 页面，下面的 javascript 被导入到 java 页面类中。

javascript:

```
function setLinkPosition(clientId){
var bodyRect = document.body.getBoundingClientRect(),
elemRect = clientId.getBoundingClientRect(),
offset   = elemRect.top - bodyRect.top;
offset   = offset + 20;
$('#serviceLineModal').css("top", offset); 
```

}

我的模态代码：

```
<div id="serviceLineModal" class="modal hide fade add-absolute-position" data-backdrop="static" 
 tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="top:50%;">
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
    <h3 id="myModalLabel">Modal header</h3>
</div>

<div class="modal-body">
    <t:zone t:id="modalZone" id="modalZone">
        <p>You selected service line number: ${serviceLineNumberSelected}</p>
    </t:zone>
</div>

<div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    <!-- <button class="btn btn-primary">Save changes</button> -->
</div> 
```

循环中的链接：

```
<t:loop source="servicesToDisplay" value="service" encoder="encoder">
<tr style="border-right: 1px solid black;">       
    <td style="white-space:nowrap;" class="add-padding-left-and-right no-border"> 
        <a t:type="eventLink" t:event="serviceLineNumberSelected" t:context="service.serviceLineNumber" 
            t:zone="pageZone" t:clientId="modalLink${service.serviceLineNumber}"
            onmouseover="setLinkPosition(this);">
            <i class="icon-chevron-down"></i> <!-- ${service.serviceLineNumber} -->
        </a>
    </td> 
```

以及页面类中的java代码：

```
void onServiceLineNumberSelected(String number){
    checkForNullSession();
    serviceLineNumberSelected = number;
    addOpenServiceLineDialogCommand();
    ajaxResponseRenderer.addRender(modalZone);
}

protected void addOpenServiceLineDialogCommand() {
    ajaxResponseRenderer.addCallback(new JavaScriptCallback() {
        @Override
        public void run(JavaScriptSupport javascriptSupport) {
            javascriptSupport.addScript("$('#serviceLineModal').modal('show');");
        }
    });
} 
```

希望这对某人有所帮助，这篇文章有所帮助。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2014-10-12T10:57:36.440

只是想我也会把这个扔出去。
我无法在较旧的浏览器中对其进行测试，但它适用于最新的前 3 名浏览器。:)

```
Element.prototype.getOffsetTop = function() {
    return ( this.parentElement )? this.offsetTop + this.parentElement.getOffsetTop(): this.offsetTop;
};
Element.prototype.getOffsetLeft = function() {
    return ( this.parentElement )? this.offsetLeft + this.parentElement.getOffsetLeft(): this.offsetLeft;
};
Element.prototype.getOffset = function() {
    return {'left':this.getOffsetLeft(),'top':this.getOffsetTop()};
}; 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2015-06-17T20:48:24.567

经过大量研究和测试，这似乎有效

```
function getPosition(e) {
    var isNotFirefox = (navigator.userAgent.toLowerCase().indexOf('firefox') == -1);
    var x = 0, y = 0;
    while (e) {
        x += e.offsetLeft - e.scrollLeft + (isNotFirefox ? e.clientLeft : 0);
        y += e.offsetTop - e.scrollTop + (isNotFirefox ? e.clientTop : 0);
        e = e.offsetParent;
    }
    return { x: x + window.scrollX, y: y + window.scrollY };
} 
```

见[http://jsbin.com/xuvovalifo/edit?html,js,output](http://jsbin.com/xuvovalifo/edit?html,js,output)

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2020-07-18T06:36:51.047

这很简单，就像 JS 中的两行代码一样：

```
var elem = document.getElementById("id");    
alert(elem.getBoundingClientRect()); 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2015-01-08T17:42:16.023

由于不同的浏览器以不同的方式呈现边框、填充、边距等。我写了一个小函数来检索您想要精确尺寸的每个根元素中特定元素的顶部和左侧位置：

```
function getTop(root, offset) {
    var rootRect = root.getBoundingClientRect();
    var offsetRect = offset.getBoundingClientRect();
    return offsetRect.top - rootRect.top;
} 
```

要检索左侧位置，您必须返回：

```
 return offsetRect.left - rootRect.left; 
```

* * *

## 回答 #29

> 赞同：-2
> 
> 时间：2018-04-09T19:50:09.407

> 获取 div 相对于 left 和 Top 的位置

```
 var elm = $('#div_id');  //get the div
  var posY_top = elm.offset().top;  //get the position from top
  var posX_left = elm.offset().left; //get the position from left 
```

# regex - 正则表达式匹配所有有效链接

> ID：442405
> 
> 赞同：3
> 
> 时间：2009-01-14T09:35:30.517
> 
> 标签：regex, url

关于这一点：[http](https://web.archive.org/web/20130105040736/http://stackoverflow.uservoice.com:80/forums/1722-general/suggestions/103227-parser-does-not-match-all-valid-urls) ://stackoverflow.uservoice.com/pages/general/suggestions/103227-parser-does-not-match-all-valid-urls这个正则表达式是否足够或者是否需要改进，如果它需要细化怎么办？

```
\b(?P<link>(?:.*?://)[\w\-\_\.\@\:\/\?\#\=]*)\b 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-20T01:02:31.193

即使这个问题很模糊，我也会尝试用可能的解决方案来回应。

**可能的意图 1**：匹配给定文件中的任何 URL（用于替换）：

```
/^([^:]+):\/\/([-\w._]+)(\/[-\w._]\?(.+)?)?$/ig 
```

上面应该匹配几乎所有的 URL 格式，具有以下捕获的组：

```
0 => entire match
1 => protocol (eg. http, ftp, git, ...)
2 => hostname (eg. www.stackoverflow.com)
3 => requested_file_path (eg. /images/prod/1/4/success.gif)
4 => query_string (eg. param=1&param2=2&param3=3) 
```

**可能的意图 2**：获取有关当前请求 url 的详细信息

为了获取有关 url 的详细信息，例如协议、主机名、请求的文件路径和查询字符串，最好使用语言/对象方法来收集结果。在 php 中，您可以使用函数调用获取上述所有信息：

```
$protocol = $_SERVER['SERVER_PROTOCOL']; // HTTP/1.0
$host = $_SERVER['HTTP_HOST']; // www.stackoverflow.com
$path_to_file = dirname($_SERVER['SCRIPT_NAME']);
$file = basename($_SERVER['SCRIPT_NAME']);
$query_string = $_SERVER['QUERY_STRING']; 
```

希望这对您有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-18T20:31:13.700

我猜SO会在一段时间后阻止评论？localshred 的答案很好，除了缺少通配符和未转义的句点：

```
 /^([^:]+):\/\/([-\w\._]+)(\/[-\w\._]*\?(.+)?)?$/ig
                                        ^-- wildcard
                        ^
    we dont want to match everything ^ 
```

# c# - 计算带宽

> ID：442409
> 
> 赞同：17
> 
> 时间：2009-01-14T09:36:39.017
> 
> 标签：c#, .net

有什么方法可以通过网络计算 exe/应用程序的带宽（发送和接收的数据包）？已经研究[过 IPGlobalProperties](http://msdn.microsoft.com/en-us/library/system.net.networkinformation.ipglobalproperties.aspx)和其他类。

我想要由单个应用程序发送和接收的数据包。我已经检查了[http://netstatagent.com/](http://netstatagent.com/)并且需要类似的东西。

.Net 中有什么可以帮助我的吗？

我的应用程序连接到 Web 服务以发送和接收一些图像文件。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-14T09:58:15.400

一种方法是为您的应用程序检索[性能计数器](http://msdn.microsoft.com/en-us/library/system.diagnostics.performancecounter.aspx)“.NET CLR Networking/Bytes Received”和“.NET CLR Networking/Bytes Sent”的值：

```
PerformanceCounter bytesSentPerformanceCounter= new PerformanceCounter();
bytesSentPerformanceCounter.CategoryName = ".NET CLR Networking";
bytesSentPerformanceCounter.CounterName = "Bytes Sent";
bytesSentPerformanceCounter.InstanceName = GetInstanceName();
bytesSentPerformanceCounter.ReadOnly = true;

float bytesSent = bytesSentPerformanceCounter.NextValue();

//....

private static string GetInstanceName()
{
  // Used Reflector to find the correct formatting:
  string assemblyName = GetAssemblyName();
  if ((assemblyName == null) || (assemblyName.Length == 0))
  {
    assemblyName = AppDomain.CurrentDomain.FriendlyName;
  }
  StringBuilder builder = new StringBuilder(assemblyName);
  for (int i = 0; i < builder.Length; i++)
  {
    switch (builder[i])
    {
      case '/':
      case '\\':
      case '#':
        builder[i] = '_';
        break;
      case '(':
        builder[i] = '[';
        break;

      case ')':
        builder[i] = ']';
        break;
    }
  }
  return string.Format(CultureInfo.CurrentCulture, 
                       "{0}[{1}]", 
                       builder.ToString(), 
                       Process.GetCurrentProcess().Id);
}

private static string GetAssemblyName()
{
  string str = null;
  Assembly entryAssembly = Assembly.GetEntryAssembly();
  if (entryAssembly != null)
  {
    AssemblyName name = entryAssembly.GetName();
    if (name != null)
    {
      str = name.Name;
    }
  }
  return str;
} 
```

**请注意，** **直到您第一次使用相关网络库时才会创建**性能计数器（您将获得 InvalidOperation : Instance 'XXX' does not exist in the specified Category）并且您需要插入

```
<configuration>
  <system.net>
    <settings>
      <performanceCounters enabled="true" />
    </settings>
  </system.net>
</configuration> 
```

在您的 app.config 中。

如需完整示例，请下载[NetworkTraffic.cs](http://pastebin.com/f371375d6)和[NetworkTraffic.exe.config](http://pastebin.com/f52a1bc2a)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-21T12:55:51.580

我记得读过一篇关于这个的文章并为你挖出来，[http://nayyeri.net/blog/how-to-calculate-network-utilization-in-net/](http://nayyeri.net/blog/how-to-calculate-network-utilization-in-net/)

他们的代码之前的摘录：

> .NET 自带三个性能计数器，用于开箱即用的网络利用率公式中使用的参数。所有这些计数器都位于网络接口类别中，并被命名为“Bytes Sent/sec”、“Bytes Received/sec”和“Current Bandwidth”。唯一需要额外计算的参数是 time_in_sec。
> 
> “Bytes Sent/sec”和“Bytes Received/sec”计数器根据不同的样本计算它们的值，从这些计数器中获得更好值的最佳方法是在循环中找到它们的值的总和，因为在某些情况下它们的值可能与网络的真实状态为零或非常不同。然后我们可以通过查找循环迭代的次数来找到 time_in_sec 参数，因为我们的性能计数器在一秒钟内找到它们的值，以秒为单位的总时间等于迭代次数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T10:17:33.723

我正在寻找每个应用程序的字节/秒...不是整个计算机...。似乎不适用于控制台应用程序...错误消息：“指定类别中不存在控制台应用程序。”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T08:32:14.560

这不起作用...据我所知 bytesSentPerformanceCounter.InstanceName ="" // 这里你需要给网卡名称...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T12:50:24.180

不知何故，发送的字节比接收的字节少得多……这不是我从我的应用程序浏览网络……我发送到 Web 服务图像（作为字节）和其他 XML 文件（几个 kbs 作为 Web 服务的字符串输入功能）。作为回报，我有时会返回错误代码或布尔值...发送的字节仍然比收到的少得多...收到的字节数是 5 倍...我很困惑...

# sql-server - 无法让 Linq 和 Sql 2005 中的可更新视图正常工作。

> ID：442413
> 
> 赞同：2
> 
> 时间：2009-01-14T09:39:04.567
> 
> 标签：sql-server, linq, sql-server-2005

我正在尝试在 VS2008 Linq O/R 设计器 SQL 2005 中执行以下操作：

我有一个名为`Entity`自动递增主键的表`PKey`的表，另一个字段名为`Parent`

我已经从这个表中创建了一个视图，将其命名为 vwEmployees，并带有一个简单的 where 子句。

将两者都添加到 O/R 设计器。在 O/R 中，将视图设置`PKey`为`PrimaryKey=true`以使视图可更新。

在它们之间添加了一对多的关系，从`PKey`表中到视图中的父级。

（一个“父”“实体”可以有多个相同记录类型的“子”）

好吧，我得到这个错误：

```
Incorrect AutoSync specification for member 'PKey' 
```

我尝试将 AutoSync 设置为“从不”，但仍然没有骰子。

如果有人对为什么会发生这种情况有任何线索，我将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-21T18:23:21.040

我能够使用 Visual Studio 2008 使用您的示例成功创建 Linq to SQL dbml 文件：

[![替代文字](https://i.stack.imgur.com/YEuNW.png)](https://i.stack.imgur.com/YEuNW.png)

我会检查以确保您在实体表数据库中正确设置了主键。它也可能只是 2005 版设计器中的一个错误，现已在 2008 年解决。

# web-services - 如何保证 Compact Framework Web 服务调用中的数据传递？

> ID：442417
> 
> 赞同：0
> 
> 时间：2009-01-14T09:41:38.587
> 
> 标签：web-services, compact-framework, reliability

我们在非常不稳定的无线局域网环境中有一个移动应用程序。向网络服务器发送数据可能会导致超时或无线局域网连接丢失。

我们如何确保我们的数据正确交付？是否有可能在设备上安装 Web 服务可靠消息传递 (WSRM)？

MSMQ 目前是没有选择的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T14:08:15.503

不支持 WSRM。一种可靠的机制是确保 Web 服务在接收到数据后以 ack 响应上传（即同步调用），或者当您开始上传时，您会返回一个事务 ID，然后您可以将其发送回稍后的服务，以确保它在本地删除之前已经交付。

# php - 何时更喜欢 XAMPP 而不是 Linux、Apache、MySQL 和 PHP 的完整安装

> ID：442423
> 
> 赞同：1
> 
> 时间：2009-01-14T09:44:32.853
> 
> 标签：php, mysql, linux, apache, xampp

在哪些情况下，除了开发之外，您更喜欢 XAMPP 而不是 Linux、Apache、MySQL 和 PHP 的完整安装和配置？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-14T09:49:11.987

除了开发之外，我唯一一次使用它是为了演示 - 能够为客户提供“棒上的解决方案”真是太好了。

不过，我永远不会考虑将它用于实时/公共站点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T11:05:53.580

我想说 XAMPP 比完全手动安装更受欢迎，只要一个人不够自信、不够熟练、不够经验或受过足够的教育来正确安装操作系统、HTTP 服务器、数据库服务器和所有主流的语言系统牢记安全和稳定方面，并予以补偿。

尽管我承认 XAMPP 并不完美，但在 99% 的情况下，它比没有适当知识的任何人都可以完成的要好得多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-10T23:40:29.617

XAMPP 非常适合开发，因为它简单快速。

这不是因为缺乏构建服务器的技能或知识。这是一个更简单的解决方案。如果您想使用 PHP 和 MySQL，那就太好了。我不会尝试运行生产服务器或尝试向其添加模块。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2010-11-15T17:20:08.510

LAMP 的性能将提高 4 倍

基准测试：[http ://www.formboss.net/blog/2010/02/hosting-php-linux-vs-windows-benchmarks/](http://www.formboss.net/blog/2010/02/hosting-php-linux-vs-windows-benchmarks/)

# linq - 如何使用 LINQ 创建嵌套的分组字典？

> ID：442425
> 
> 赞同：23
> 
> 时间：2009-01-14T09:46:25.207
> 
> 标签：linq

如何使用 LINQ 为下表创建嵌套分组？我想按 分组`Code`，然后按`Mktcode`。

```
Code Mktcode Id
==== ======= ====
1    10      0001 
2    20      0010 
1    10      0012 
1    20      0010 
1    20      0014 
2    20      0001
2    30      0002
1    30      0002
1    30      0005 
```

最后，我想要一本字典，比如

```
Dictionary<Code, List<Dictionary<Mktcode, List<Id>>>> 
```

所以这个字典的值是

```
{1, ({10,(0001,0012)}, {20,(0010,0014)}, {30, (0002, 0005)})},
{2, ({20,(0001, 0010)}, {30, (0020)} )} 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-14T10:06:35.213

我会这样想：

*   您主要是按代码分组，所以先这样做
*   对于每个组，您仍然有一个结果列表 - 所以在那里应用另一个分组。

就像是：

```
var groupedByCode = source.GroupBy(x => x.Code);

var groupedByCodeAndThenId = groupedByCode.Select(group =>
    new { Key=group.Key, NestedGroup = group.ToLookup
                                         (result => result.MktCode, result => result.Id));

var dictionary = groupedByCodeAndThenId.ToDictionary
    (result => result.Key, result => result.NestedGroup); 
```

这会给你一个`Dictionary<Code, Lookup<MktCode, Id>>`- 我*认为*这就是你想要的。虽然它完全未经测试。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-14T10:03:26.933

您可以使用`group by into`

```
var lines = new []
{
    new {Code = 1, MktCode = 10, Id = 1},
    new {Code = 2, MktCode = 20, Id = 10},
    new {Code = 1, MktCode = 10, Id = 12},
    new {Code = 1, MktCode = 20, Id = 10},
    new {Code = 1, MktCode = 20, Id = 14},
    new {Code = 2, MktCode = 20, Id = 1},
    new {Code = 2, MktCode = 30, Id = 2},
    new {Code = 1, MktCode = 30, Id = 2},
    new {Code = 1, MktCode = 30, Id = 5},
};

var groups = from line in lines
    group line by line.Code
    into codeGroup
    select new
    {
        Code = codeGroup.Key,
        Items = from l in codeGroup
            group l by l.MktCode into mktCodeGroup
            select new
            {
                MktCode = mktCodeGroup.Key, 
                Ids = from mktLine in mktCodeGroup
                    select mktLine.Id
            }
    }; 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-01-14T13:31:06.967

这是我的做法：

```
Dictionary<Code, Dictionary<MktCode, List<Id>>> myStructure =
  myList
    .GroupBy(e => e.Code)
    .ToDictionary(
      g => g.Key,
      g => g
        .GroupBy(e => e.Mktcode)
        .ToDictionary(
          g2 => g2.Key,
          g2 => g2.Select(e => e.Id).ToList()
        )
   ) 
```

以下是该过程的细分：

按代码对元素进行分组，并创建一个外部字典，其中键是该代码。

```
 myList
    .GroupBy(e => e.Code)
    .ToDictionary(
      g => g.Key, 
```

对于外部字典中的每个键，通过 Mktcode 重新组合元素并创建内部字典。

```
 g => g
        .GroupBy(e => e.Mktcode)
        .ToDictionary(
          g2 => g2.Key, 
```

对于内部字典中的每个键，投影这些元素的 id 并将其转换为列表。

```
 g2 => g2.Select(e => e.Id).ToList()
        )
   ) 
```

# algorithm - Windows 资源管理器排序方法

> ID：442429
> 
> 赞同：21
> 
> 时间：2009-01-14T09:47:24.283
> 
> 标签：algorithm, sorting

我正在寻找一种对字符串进行排序的算法，类似于在 Windows 资源管理器中对文件（和文件夹）进行排序的方式。似乎在排序时会考虑字符串中的数值，这会导致类似

```
name 1, name 2, name 10 
```

代替

```
name 1, name 10, name 2 
```

您可以通过常规字符串比较获得。

我正要自己开始写这篇文章，但想检查一下是否有人以前做过，并愿意分享一些代码或见解。我将解决此问题的方法是在比较名称中的数值之前添加前导零。这将导致类似

```
name 00001, name 00010, name 00002 
```

当使用常规字符串排序时，它会给我正确的结果。

有任何想法吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-14T09:50:24.947

它被称为“自然排序顺序”。不久前， Jeff 有一篇[相当广泛的博客文章](http://blog.codinghorror.com/sorting-for-humans-natural-sort-order/)，其中描述了您可能会忽略的困难，并提供了几个实现的链接。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-14T09:57:35.760

Explorer 使用 API [StrCmpLogicalW](http://msdn.microsoft.com/en-us/library/bb759947(VS.85).aspx) () 进行这种排序（称为“自然排序顺序”）。

您不需要编写自己的比较函数，只需使用已经存在的比较函数即可。

一个很好的解释可以在[这里](http://www.siao2.com/2005/01/05/346933.aspx)找到。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-14T09:58:12.593

有[StrCmpLogicalW](http://msdn.microsoft.com/en-us/library/bb759947.aspx)，但它仅从 Windows XP 开始可用，并且仅作为 Unicode 实现。

一些背景资料： [http ://www.siao2.com/2006/10/01/778990.aspx](http://www.siao2.com/2006/10/01/778990.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-14T09:53:25.630

按照我的理解，Windows 资源管理器按照您的第二个示例进行排序 - 排序为 1、10、2 总是让我非常恼火。这就是为什么大多数写入大量文件的应用程序（如批处理应用程序）总是使用固定长度的文件名前导 0 或其他。

您的解决方案应该可以工作，但是您需要小心文件名中的数字，并且可能仅在它们位于最后时才使用您的方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-14T09:54:18.683

看一下

[http://www.interact-sw.co.uk/iangblog/2007/12/13/natural-sorting](http://www.interact-sw.co.uk/iangblog/2007/12/13/natural-sorting)

对于一些源代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-14T10:13:10.707

我还发布了一个相关问题，其中包含其他提示和陷阱：

[对字符串进行排序比您想象的要困难得多](https://stackoverflow.com/questions/127913/sorting-strings-is-much-harder-than-you-thought)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-08-13T01:59:17.520

我在这里发布了代码（C#）和算法描述：

[C#中的自然排序顺序](https://stackoverflow.com/questions/248603/natural-sort-order-in-c/7048016#7048016)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-05-15T06:26:06.373

这是尝试在 Java 中实现它：

[Java - 像 Windows 资源管理器一样对字符串进行排序](https://stackoverflow.com/questions/23205020/java-sort-strings-like-windows-explorer/23249000#23249000)

简而言之，它将两个字符串拆分为字母 - 数字部分进行比较，并以特定方式比较这些部分以实现这种排序。

# xml - Microsoft SSIS 2005 从 XML 源中删除列

> ID：442437
> 
> 赞同：0
> 
> 时间：2009-01-14T09:51:02.577
> 
> 标签：xml, sql-server-2005, ssis

我在 Microsoft SSIS 2005 包中有一个 XML 源，当我调试包时，我收到如下警告：

*[DTS.Pipeline] 警告：输出“AccFwdDetail”(303) 和组件“XML Source”(1) 上的输出列“AccBasicRateDesc”(15229) 随后未在数据流任务中使用。删除这个未使用的输出列可以提高数据流任务的性能。*

所以我试图删除所有这些，但这似乎会导致问题，因为会有我不会使用的整个 xml 输出，这给了我错误：

*联系人插入 [DTS.Pipeline] 时出错：“输出“AccFwdDetail”(19)”不包含输出列。异步输出必须包含输出列。*

有没有一种巧妙的方法来定义我想要从 xml 文件中得到哪些输出？我尝试在高级编辑器中删除整个输出，但这给了我错误：

*联系人插入错误 [XML 源 [1]]：无法从输出列中删除输出。*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T19:39:56.287

看起来像第 42 条军规。

在这种情况下，我会忽略原来的警告——它只是一个性能警告，不会引起任何真正的问题。在这种情况下，性能影响很小，因为没有人会使用此输出中的数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T05:49:39.427

在数据源之后，在数据流中使用 Union All 组件（将您的数据源作为唯一输入）。在此处删除所有未使用的列。

据我所知，这是摆脱这些警告的唯一方法。

以下是一些关于 SSIS 性能的非常有用的链接：

[http://blogs.msdn.com/michen/archive/2007/06/11/katmai-ssis-data-flow-improvements.aspx](http://blogs.msdn.com/michen/archive/2007/06/11/katmai-ssis-data-flow-improvements.aspx)

[http://www.microsoft.com/technet/prodtechnol/sql/2005/ssisperf.mspx](http://www.microsoft.com/technet/prodtechnol/sql/2005/ssisperf.mspx)

[http://www.simple-talk.com/sql/sql-server-2005/sql-server-2005-ssis-tuning-the-dataflow-task/](http://www.simple-talk.com/sql/sql-server-2005/sql-server-2005-ssis-tuning-the-dataflow-task/)

# .net - CLRProfiler 的问题

> ID：442439
> 
> 赞同：4
> 
> 时间：2009-01-14T09:51:41.560
> 
> 标签：.net, clrprofiler

我正在尝试使用 Microsoft 的[CLRProfiler](http://www.microsoft.com/downloads/details.aspx?familyid=A362781C-3870-43BE-8926-862B40AA0CD0&displaylang=en)来分析我相当大的应用程序，并且每当它尝试写入（或读取）日志文件时它就会崩溃。具有讽刺意味的是，确切的错误在[MS 的“反馈”网站](http://209.85.129.132/search?q=cache:I6-DV7i__YUJ:connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx%3FFeedbackID%3D255678+CLRProfiler.ReadNewLog.ReadFile()上被记录为不可重现，而且似乎从未得到修复。我得到了一个`NullReferenceException`：

```
CLRProfiler.ReadNewLog.ReadFile(Int64 startFileOffset, Int64 endFileOffset, ReadLogResult readLogResult)
at CLRProfiler.MainForm.checkProcessTimer_Tick(Object sender, EventArgs e)
at System.Windows.Forms.Timer.OnTick(EventArgs e)
at System.Windows.Forms.Timer.TimerNativeWindow.WndProc(Message& m)
at System.Windows.Forms.NativeWindow.Callback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam) 
```

有没有人知道我该如何获得帮助，或者理想情况下让该死的东西正常运行？MSDN 上的哀求求助被忽略了……谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-14T10:06:21.733

CLR Profiler 非常不稳定，我也经历过很多崩溃。

我在 PDC 听到的一个提示是仅将其用作快照工具：不要在应用程序运行期间收集内存使用信息，而是在您知道您已经存在内存问题的地方停止应用程序，并制作一个内存快照。

这样它就更稳定了，通常从参考图中你可以找出导致泄漏的原因。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-14T09:55:41.223

我怀疑那是一条死路。也许试试 jetBrains [dotTRACE](http://www.jetbrains.com/profiler/index.html)；您可以免费[试用 10 天](http://www.jetbrains.com/profiler/download/index.html)，看看是否合适。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T10:22:21.593

我们在 CLRProfiler 无法分析的远程 Citrix 服务器上调试崩溃的猛犸象时遇到了类似的问题。

我们能够使用[WinDbg找到问题](http://www.microsoft.com/whdc/devtools/debugging/debugstart.mspx#a)

此外，这也可以帮助[CorDbg](http://msdn.microsoft.com/en-us/library/a6zb7c8d(VS.80).aspx)

# python - 如何知道您何时处于符号链接中

> ID：442442
> 
> 赞同：4
> 
> 时间：2009-01-14T09:52:41.200
> 
> 标签：python

在 Python 中，如何知道您所在的目录在符号链接中？

我有一个目录**/tmp/foo/kiwi**

我创建了一个符号链接**/tmp/bar**指向**/tmp/foo**

我进入**/tmp/bar/kiwi**

linux 命令**pwd**告诉我我在**/tmp/bar/kiwi**，这是正确的。

python 命令提示符告诉我我在**/tmp/foo/kiwi**：

```
Python 2.5.1 (r251:54863, Oct  5 2007, 13:36:32) 
[GCC 4.1.3 20070929 (prerelease) (Ubuntu 4.1.2-16ubuntu2)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import os
>>> os.getcwd()
'/tmp/foo/kiwi' 
```

有没有办法在 Python 中获取我真正所在的目录？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-14T10:02:09.573

如果你没有找到任何其他东西，你可以使用

```
os.getenv("PWD") 
```

它不是真正的可移植 python 方法，但适用于 POSIX 系统。它获取`PWD`环境变量的值，该值由`cd`命令（如果您不使用）设置为您在运行 python 脚本之前`cd -P`导航到的路径名（请参阅）。`man cd`当然，该变量不会被 python 改变。因此，如果您在`os.chdir`其他地方，该变量将保留其值。

无论如何，作为一个侧节点，`/tmp/foo/kiwi` *是*你所在的目录。我不确定除了 shell 是否有任何东西知道你真的通过另一条路径导航到那个地方，实际上:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-14T09:57:12.330

如果您的符号链接是按照您声明的方式设置的，那么`/tmp/foo/kiwi`就是您真正所在的目录。`/tmp/bar/kiwi`这只是到达同一位置的另一种方式。

请注意，shell 命令`pwd -P`将为您提供当前目录的物理路径。在您的情况下，shell 会记住您通过`bar`符号链接获得了您所在的位置，因此它告诉您您在`/tmp/bar/kiwi`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T10:21:06.150

有趣的是，如果您在一个目录中，您可以使用 -P 选项来获取 pwd 命令来解析到其实际目录的所有符号链接。

```
$ ln -s Desktop toto
$ cd toto
$
$ pwd
/home/ken/toto
$ 
$ pwd -P
/home/ken/Desktop
$ 
```

高温高压

干杯，

抢

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T10:24:06.020

你也可以试试lstat。它将为您提供有关文件/目录的信息，包括告诉您它是否是链接并显示它链接到的位置（如果是）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T10:56:27.653

当您的 shell 返回路径时，它依赖于在您遍历符号链接路径时设置的 shell 环境变量“PWD”，但实际上它位于 getcwd() 返回的目录下。所以，如果你从 shell 的 PWD 中得到你想要的。

```
>>> os.getcwd()
'/home/ors/foo/tmp/foo/kiwi'
>>> os.environ["密码"]
'/home/ors/foo/tmp/bar/kiwi'
>>>

```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-01-14T20:11:22.203

这是另一种方式：

```
import os
os.popen('pwd').read().strip('\n') 
```

这是python shell中的演示：

```
>>> import os
>>> os.popen('pwd').read().strip('\n')
'/home/projteam/staging/site/proj'
>>> # This returns actual path
>>> import subprocess
>>> p = subprocess.Popen('pwd', stdout=subprocess.PIPE)
>>> p.communicate()[0]  # returns non-symlink path
'/home/projteam/staging/deploys/20150114-141114/site/proj\n' 
```

获取环境变量 PWD 并不总是对我有用，所以我使用 popen 方法。干杯!

# windows - Windows 上是否有某种安全的本地存储？

> ID：442443
> 
> 赞同：21
> 
> 时间：2009-01-14T09:53:06.270
> 
> 标签：windows, security, encryption, .net-2.0, native

我正在考虑制作一个小工具。该工具将做什么并不重要。重要的是，该工具需要在用户的硬盘上存储一些敏感信息。**编辑：将存储的信息是用户的信息 - 我不是试图保护我自己的内容，我与应用程序一起分发。**

我了解我需要对此信息进行加密。但是，我在哪里安全地存储加密密码？这是某种无限递归......

那么，有没有办法对 Windows 上的信息进行加密，并让 Windows 安全地管理密码？当我说 Windows 时，我指的是 Windows XP SP2 或更高版本。

我还应该注意，同一系统上的用户不得访问其他用户的信息（即使他们都在运行我的应用程序）。

我正在寻找 - .NET 2.0 (C#) 和本机 (C/C++) 解决方案来解决这个问题。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-14T10:15:05.850

> 有没有办法加密windows上的信息，让windows安全地管理密码？

CryptProtectData： http: [//msdn.microsoft.com/en-us/library/windows/desktop/aa380261 (v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/aa380261(v=vs.85).aspx)

从 .NET 使用：http: [//msdn.microsoft.com/en-us/library/aa302402.aspx](http://msdn.microsoft.com/en-us/library/aa302402.aspx)

从历史上看，受保护的存储（在 XP 中可用，在 vista+ 中只读）：http: [//msdn.microsoft.com/en-us/library/bb432403%28VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/bb432403%28VS.85%29.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-14T10:36:08.693

为此，您应该考虑使用 DPAPI。它将使用基于每个用户的特殊（内部）对称密钥加密您的数据。在这种情况下，您甚至不需要询问密码，因为系统上的不同用户将分配给他们不同的密钥。

它的缺点可能是如果用户被删除/重新安装 Windows，您将无法恢复数据（我相信是这种情况，但不太确定）。在这种情况下，使用从密码派生的“自生成”密钥加密数据，并将密码存储在使用 DPAPI 加密的注册表/文件中。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-14T09:57:50.097

您可以使用本机加密工具。在您的文件夹或文件上设置加密属性（从属性页，单击“高级”按钮）。然后您可以设置可以访问文件的用户（默认情况下，这仅包括文件创建者）。该解决方案的最大优势在于，从应用程序和用户的角度来看，它是完全透明的。

以编程方式执行此操作：使用 Win32 API，调用[`EncryptFile()`](http://msdn.microsoft.com/en-us/library/aa364021(VS.85).aspx)要存储敏感的每用户数据的目录。从现在开始，此目录中所有新创建的文件都将被加密，并且只能由其创建者（即您的应用程序的当前用户）读取。或者，您可以`FILE_ATTRIBUTE_ENCRYPTED`在创建时对单个文件使用标志。您可以在文件的属性页面上从资源管理器中检查加密信息，并查看应用创建的文件是否已正确加密并仅限于其各自的用户。没有密码可以存储或使用，一切都是透明的。

如果你想对所有用户隐藏数据，那么你可以创建一个特殊的应用程序特定用户并在你的应用程序中模拟它。这与 ACL 一起，是 Windows 上用于系统服务的幸运技术。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-14T09:59:07.880

您可能想查看独立存储，这是一种自动将设置和其他数据存储在每个应用程序数据上的方法。请参阅[示例](http://www.codeproject.com/KB/dotnet/IsolatedStorage.aspx)和[MSDN](http://msdn.microsoft.com/en-us/library/system.io.isolatedstorage.isolatedstoragefile.aspx)。

这是将正常设置存储在注册表中的一种替代方法，在很多情况下是一种更好的方法......我不确定数据是如何存储到文件中的，所以你需要检查一下，你不会想要它其他用户可以访问，甚至加密。从记忆中只有应用程序。创建存储的可以打开它-但这需要检查。

编辑：

从我上次使用它时的记忆来看，一个好的方法是编写一个“设置”类来处理应用程序中的所有设置等。然后，此类具有等效的 Serialize 和 DeSerialize 方法，允许它将所有数据写入到 IsolatedStorage 文件中，或再次加载它们。

以这种方式实现它的额外优势是您可以使用属性来标记源的位，然后可以使用属性网格快速为您提供设置的用户编辑控制（属性网格在运行时使用反射操作类属性） .

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T10:14:26.973

我建议您查看 Enterprise Library Cryptography Application Block。检查这篇[博文](http://www.davidhayden.com/blog/dave/archive/2006/03/02/2870.aspx)。Windows 具有用于加密数据的内置数据保护 API，但加密应用程序块使其更简单。

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2009-01-14T10:31:13.960

嗯，你想要实现的正是 DRM 想要实现的。加密某些东西，然后给用户密钥（无论多么模糊）和加密。他们用 DVD 做到了。他们用蓝光做到了。他们用 iTunes 做到了。

你打算做的事情永远不会安全。一般的外行人可能不会弄明白，但任何有足够积极性的攻击者都会弄明白并发现密钥、算法并解密数据。

如果您所做的只是加密用户数据，请询问用户的密码。如果您试图保护您的内部数据免受运行应用程序的用户的影响，那么您就是 SOL

* * *

## 回答 #7

> 赞同：-5
> 
> 时间：2009-01-14T10:07:19.313

Erm 对密码进行哈希处理？您不需要将真实交易存储在机器上的任何地方，只需一个散列密码（也可能加盐）。然后，当用户输入他们的密码时，您对其执行相同的操作，并将其与您存储在磁盘上的散列密码进行比较。

# unix - 数着没有。在 Unix 文件中的一行中的分隔符

> ID：442456
> 
> 赞同：5
> 
> 时间：2009-01-14T09:57:39.707
> 
> 标签：unix, shell, records

我有一个包含超过 200,000 条记录的文件“records.txt”。

每条记录都在单独的行上，并具有由分隔符“|”分隔的多个字段。

每行应该有 35 个字段，但**问题是其中一行有 <>35 个字段，即 <>35 '|' 人物。**

有人可以在Unix中提出一种方法，我可以通过它来识别行。（比如在文件的每一行中获取“|”字符的数量）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-14T10:07:56.113

试试这个：

```
awk -F '|'  'NF != 35 {print NR, $0} ' your_filefile 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T10:03:02.787

这个小的 perl 脚本应该这样做：

```
cat records.txt | perl -ne '$t = $_; $t =~ s/[^\|]//g; print unless length($t) == 35;' 
```

这通过删除*除*| 之外的所有字符来工作，然后计算剩下的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-14T11:05:03.910

Greg 使用 bash 的方式，给 bash 的朋友们 :)

```
while read n; do [ `echo $n | tr -cd '|' | wc -c` != 35 ] && echo $n; done < records.txt 
```

# php - 基于 MySQL 数据呈现 HTML 复选框输入

> ID：442460
> 
> 赞同：0
> 
> 时间：2009-01-14T09:58:50.627
> 
> 标签：php, mysql

我有这个表包含名称和值，我怎样才能转换内容

```
$row=mysql_fetch_array($result); 
```

进入复选框？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T10:34:48.087

假设 $row 是将列名映射到布尔值 1 或 0 的关联数组，您可以执行以下操作：

```
foreach($row as $colname=>$boolean)
{
    //create a name for the checkbox which will produce a nice 
    //PHP array of checked column names in $_POST['col']
    $name="col[$colname]";

    //create an id for the checkbox
    $id='col'.$colname;

    //now we output the checkbox - on form submission you will
    //see an element in $_POST['col'][$colname] if checked, and
    //no element at all if unchecked...
    echo '<input type="checkbox" value="1" '.
       'name="'.$name.'" id="'.$id.'" '.
       ($boolean?'checked="checked"':'').
       '>';

    //output a label - note we'd tied this to the id of the checkbox
    //which means you can click the label to tick the box   
    echo "<label for=\"$id\">colname</label><br/>";
} 
```

提交表单后，您将在 $_POST['col'] 中获得一个按列名索引的数组，但仅限于那些已选中的框，因此您将设置为 false 任何未设置的列。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T10:04:41.863

见这里：[http ://dev.w3.org/html5/spec/Overview.html#checkbox-state](http://dev.w3.org/html5/spec/Overview.html#checkbox-state)

所以，试试这个：

```
<input type="checkbox" checked="true"> 
```

# jquery - 来自服务器的响应数据的 jQuery 事件

> ID：442462
> 
> 赞同：1
> 
> 时间：2009-01-14T09:59:34.883
> 
> 标签：jquery, ajax, events

我使用 $.ajax() 函数从服务器获取了一些内容。我尝试用这些数据替换一些元素，然后对其进行操作。这是代码：

```
$.ajax({
    type: "GET",
    url: "smpl.php",
    success: function(servmsg){
        $('#panelInfo').replaceWith('<p>' + servmsg + '</p>');
    }
}); 
```

服务器的响应是：

```
<select id="years">
    <option>2008</option>
    <option>2009</option>
</select> 
```

当我尝试一些事件时，它什么也没做，例如：

```
$('#years').change(function() { //or .click()
    //do something
}); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T10:13:01.470

您需要将代码更改为：

```
$.ajax({
    type: "GET",
    url: "smpl.php",
    success: function(servmsg){
        $('#panelInfo').replaceWith('<p>' + servmsg + '</p>');
        $('#years').change(function() { //or .click()
            //do something
        });
    }
}); 
```

或者，您可以保留原始 ajax 调用代码，并像这样使用[livequery](http://brandonaaron.net/docs/livequery/)：

```
$('#years').livequery('change', function() { //or .click()
    //do something
}); 
```

然后，当您插入 #years 块时，它会`change`自动注册该事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T10:06:08.660

事件绑定代码应该在 'success' 函数中，所以它会在 #years 添加到页面后运行。否则，jquery 正在寻找 #years 并且找不到它，并且没有进行绑定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T11:41:49.217

如果您可以使用 jquery 1.3（今天发布）然后查看新的 .live() 方法。

# java - 查找 Lucene 索引中的文档数

> ID：442463
> 
> 赞同：11
> 
> 时间：2009-01-14T10:00:05.193
> 
> 标签：java, lucene

使用 Java 版本的 Lucene，如何找出索引中的文档数？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-14T11:05:18.353

IndexReader 包含您需要的方法，特别是 numDocs

[http://lucene.apache.org/core/3_6_0/api/all/org/apache/lucene/index/IndexReader.html#numDocs()](http://lucene.apache.org/core/3_6_0/api/all/org/apache/lucene/index/IndexReader.html#numDocs())

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-12-25T09:54:25.333

使用 java 你可以找到这样的文件数量：

```
IndexReader reader = IndexReader.open(FSDirectory.open(indexDirectory));
System.out.println(reader.maxDoc()); //this will give ya what you need. 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-14T11:31:35.603

官方文档： http: [//lucene.apache.org/java/2_4_0/api/org/apache/lucene/index/IndexReader.html#numDocs()](http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/index/IndexReader.html#numDocs())

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-01-31T08:07:16.103

使用 Hibernate Search 时，可以`IndexReader`通过 Hibernate Search API 获取一个 Lucene 实例，然后`reader.numDocs()`按照前面的答案中已经提到的那样使用。

```
FullTextEntityManager fullTextEntityManager = org.hibernate.search.jpa.Search.getFullTextEntityManager(get‌​EntityManager());
IndexReader reader = fullTextEntityManager.getSearchFactory().getIndexReaderAcces‌​sor().open(MyEntity1‌​.class, MyEntity2.class ...);
int numDocs = reader.numDocs(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-11-21T12:48:41.057

对于使用[IndexReader](https://lucene.apache.org/core/8_11_0//core/index.html?org/apache/lucene/index/IndexReader.html)的最新 Lucene 版本，以下 Kotlin 片段可以完成这项工作：

```
DirectoryReader.open(directory).use { reader ->
    println(reader.numDocs())
} 
```

其中`directory`是包含索引的[Directory实例。](https://lucene.apache.org/core/8_11_0//core/org/apache/lucene/store/Directory.html)

# html - 背景颜色未覆盖 div 的整个高度

> ID：442464
> 
> 赞同：3
> 
> 时间：2009-01-14T10:01:43.897
> 
> 标签：html, css

---HTML

```
<div id="story">
<div id="individual">
<img src='uploads/1231924837Picture.png'/>

<h2>2009-01-14</h2>
<h1>Headline</h1>
<p>stroy story etc stroy story etc stroy story etc</p>
</div>
<br />
<div id="storynav">
<a href='home.php?start=0'>1</a> 
<a href='home.php?start=1'>2</a> 
<a href='home.php?start=2'>3</a> 
<a href='home.php?start=3'>4</a> 
<a href='home.php?start=4'>5</a>  
<a href='home.php?start=5'>6</a>  
<a href='home.php?start=6'>7</a>  
<a href='home.php?start=7'>8</a>  
<a href='home.php?start=8'>9</a>         
</div>
</div> 
```

---CSS

```
#story img{
border: none;
float: right;
display: inline;
padding: 10px;
margin-top: 30px;
}
#story{
width: 600px;
height: inherit;
background-color:black;
margin-left: 34px;
margin-bottom: 3px;
}

#individual{
background-color: #000000;
clear:both;
}

#storynav{
font-size: 10px;
text-align: center;
} 
```

[![替代文字](https://i.stack.imgur.com/Zqh0u.png)](https://i.stack.imgur.com/Zqh0u.png)
[（来源：[bionic-comms.co.uk](http://clients.bionic-comms.co.uk/drew/testygubbins/OO/test/img.png)）]

上面的代码和 css 让我很头疼，因为如图所示，当我添加图像时，div 背景颜色会变得混乱。这是动态内容，但我认为显示静态 html 会更容易。谁能告诉我我做错了什么？背景颜色也应该覆盖图片。谢谢！

编辑

感谢那。这是我以前尝试过的，但它没有做任何事情。我也在那里尝试了一个垫片，但没有任何作用。糊涂了！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-14T10:18:14.330

您将图像设置为向右浮动，这意味着容器 div 无法计算出它的实际高度。您需要清除浮动元素，这实际上让容器知道图像实际有多大。

您需要`clear: both;`在 HTML 中的 img 标签下方添加一个样式元素，最好在 div 的末尾，如下所示：

```
<div id="story">
<div id="individual">
<img src='uploads/1231924837Picture.png'/>

<h2>2009-01-14</h2>
<h1>Headline</h1>
<p>stroy story etc stroy story etc stroy story etc</p>
</div>
<br />
<div id="storynav">
<a href='home.php?start=0'>1</a> 
<a href='home.php?start=1'>2</a> 
<a href='home.php?start=2'>3</a> 
<a href='home.php?start=3'>4</a> 
<a href='home.php?start=4'>5</a>  
<a href='home.php?start=5'>6</a>  
<a href='home.php?start=6'>7</a>  
<a href='home.php?start=7'>8</a>  
<a href='home.php?start=8'>9</a>         
</div>
  <div class="clear"></div> <-- add this here
</div> 
```

并添加类：

```
.clear
{
  clear: both;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T10:18:07.403

阅读：[http ://www.quirksmode.org/css/clearing.html](http://www.quirksmode.org/css/clearing.html)

简而言之，试试这个：

---HTML

```
<div id="story">
<div id="individual">
<img src='uploads/1231924837Picture.png'/>

<h2>2009-01-14</h2>
<h1>Headline</h1>
<p>stroy story etc stroy story etc stroy story etc</p>
</div>
<br />
<div id="storynav">
<a href='home.php?start=0'>1</a> 
<a href='home.php?start=1'>2</a> 
<a href='home.php?start=2'>3</a> 
<a href='home.php?start=3'>4</a> 
<a href='home.php?start=4'>5</a>  
<a href='home.php?start=5'>6</a>  
<a href='home.php?start=6'>7</a>  
<a href='home.php?start=7'>8</a>  
<a href='home.php?start=8'>9</a>
<div class="clear"></div>
</div>
</div> 
```

---CSS

```
#story img{
border: none;
float: right;
display: inline;
padding: 10px;
margin-top: 30px;
}
#story{
width: 600px;
height: inherit;
background-color:black;
margin-left: 34px;
margin-bottom: 3px;
}

#individual{
background-color: #000000;
clear:both;
}

#storynav{
font-size: 10px;
text-align: center;
}

.clear {
    clear: both;
} 
```

# sql-server-express - 使用事务执行 SqlCommand 时出现 InvalidOperationException

> ID：442465
> 
> 赞同：2
> 
> 时间：2009-01-14T10:01:59.073
> 
> 标签：sql-server-express, sql-server-2005-express, invalidoperationexception

我有这段代码，在两个单独的线程中并行运行。它可以正常工作几次，但在某个随机点它会抛出 InvalidOperationException：

事务要么与当前连接无关，要么已完成。

在异常点，我正在使用 Visual Studio 查看事务并验证其连接设置是否正常。还有 command.Transaction._internalTransaction。_transactionState 设置为 Active 并且 IsZombied 属性设置为 false。

这是一个测试应用程序，我正在使用 Thread.Sleep 创建更长的事务并导致重叠。

为什么会抛出异常，我该怎么办？

```
IDbCommand command = new SqlCommand("Select * From INFO");
IDbConnection connection = new SqlConnection(connectionString);
command.Connection = connection;
IDbTransaction transaction = null;
try
{
    connection.Open();
    transaction = connection.BeginTransaction();
    command.Transaction = transaction;
    command.ExecuteNonQuery(); // Sometimes throws exception
    Thread.Sleep(forawhile); // For overlapping transactions running in parallel
    transaction.Commit();
}
catch (ApplicationException exception)
{
    if (transaction != null)
    {
        transaction.Rollback();
    }
}
finally
{
    connection.Close();
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T15:14:48.023

找到了解决方案。原来叫这个

```
command.Connection = connection; 
```

并不意味着您设置了与命令的连接。就在调用这个之后，我检查了结果

```
command.Connection.GetHashCode();
command.GetHashCode(); 
```

他们是不平等的。重构代码以使用 connection.CreateCommand 并解决问题。

# dependency-injection - 结构图配置

> ID：442471
> 
> 赞同：0
> 
> 时间：2009-01-14T10:03:11.147
> 
> 标签：dependency-injection, structuremap

考虑下面的类

```
public class SchemaExecutor: ISchemaExecutor
{
    public SchemaExecutor(SqlPlusSettings sqlPlusSettings)
    {
        _sqlPlusSettings = sqlPlusSettings;
    }
... 
```

和容器配置

```
ObjectFactory.Initialize( x =>
{
    SqlPlusSettings sqlPlusSettings = GetSqlPlusSettings();
    x.ForRequestedType<ISchemaExecutor>().TheDefaultIsConcreteType<SchemaExecutor>()
        .WithCtorArg("sqlPlusSettings").EqualT(sqlPlusSettings);                       
 }); 
```

但`.WithCtorArg`仅适用于原语，因此上面的初始化不起作用。

有没有办法用非原始参数配置构造函数？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-20T06:08:40.980

你只需要让 IoC 做它所做的事情并为你注入你的依赖项......

```
ObjectFactory.Initialize( x =>
 {
      x.ForRequestedType<SqlPlusSettings>().TheDefaultIsConcreteType<SqlPlusSettings>().AsSingletons;
      x.ForRequestedType<ISchemaExecutor>().TheDefaultIsConcreteType<SchemaExecutor>();
 });

SqlPlusSettings sqlPlusSettings = GetSqlPlusSettings();
ObjectFactory.Inject<SqlPlusSettings>(sqlPlusSettings); 
```

你在这里没有自动装配的方式，我认为 SqlPlusSettings 的冗余行需要让 StructureMap 知道它。但本质上，SM 知道 SchemaExecutor 和 SqlPlusSettings，当实例化 SchemaExecutor 时，它会查找参数，看到 SqlPlusSettings 是一个单例，它已经有一个，并将它传递给实例化 SchemaExecutor。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-14T23:11:53.510

如果您希望准确控制您的类将接收的设置对象的实例，您可以通过配置具体类或每个插件通过配置其依赖项来完成此操作。

注意：我使用的是主干，但我相信这里的一切都在 2.5.3 中可用。

```
public class MySettings
{

}

public interface IMyClass
{
    MySettings Settings { get; }
}

public class MyClass : IMyClass
{
    public MySettings Settings { get; private set; }

    public MyClass(MySettings settings)
    {
        Settings = settings;
    }
}

[TestFixture]
public class registry_test
{
    [Test]
    public void configure_concrete_class()
    {
        var mySettings = new MySettings();

        var container = new Container(config =>
        {
            config.For<MySettings>().Use(mySettings);
            config.For<IMyClass>().TheDefaultIsConcreteType<MyClass>();
        });

        container.GetInstance<IMyClass>().Settings.ShouldBeTheSameAs(mySettings);
    }

    [Test]
    public void configure_concrete_ctor_dependency()
    {
        var mySettings = new MySettings();

        var container = new Container(config =>
        {
            config.For<IMyClass>().TheDefault.Is.OfConcreteType<MyClass>()
                .CtorDependency<MySettings>().Is(mySettings);
        });

        container.GetInstance<IMyClass>().Settings.ShouldBeTheSameAs(mySettings);
    }
} 
```

# msbuild - 如何在 MSBuild 中获取 Windows SDK 文件夹？

> ID：442476
> 
> 赞同：27
> 
> 时间：2009-01-14T10:05:37.833
> 
> 标签：msbuild, winapi, bootstrapper

在 MSBuild 任务中检索 Windows SDK 文件夹的方法是什么？

使用 generateBootstrapper 任务，我正在为我的设置创建一个引导程序，以便能够安装先决条件。该任务需要先决条件包所在文件夹的路径，即Windows SDK文件夹

```
"C:\Program Files\Microsoft SDKs\Windows\v6.0A\Bootstrapper\Packages\" 
```

使用 Visual Studio 2008 时。到目前为止，我一直在使用硬编码路径，但这不适用于任何系统。有没有更好的方法来获取路径？

这是我的构建脚本：

```
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" 
         ToolsVersion="3.5">
    <ItemGroup>
        <BootstrapperFile Include="Microsoft.Net.Framework.2.0">
            <ProductName>.NET Framework 2.0</ProductName>
        </BootstrapperFile>
        <BootstrapperFile Include="Microsoft.Windows.Installer.3.1">
            <ProductName>Windows Installer 3.1</ProductName>
        </BootstrapperFile>
    </ItemGroup>

    <Target Name="Bootstrapper">
        <GenerateBootstrapper ApplicationFile="mySetup.msi" 
            Culture="de-DE" 
            ApplicationName="My Application" 
            OutputPath="$(OutDir)\de-DE" 
            BootstrapperItems="@(BootstrapperFile)" 
            Path="C:\Program Files\Microsoft SDKs\Windows\v6.0A\Bootstrapper\Packages\" />

        <GenerateBootstrapper ApplicationFile="mySetup.msi" 
            Culture="en-US" 
            ApplicationName="My Application" 
            OutputPath="$(OutDir)\en-US" 
            BootstrapperItems="@(BootstrapperFile)" 
            Path="C:\Program Files\Microsoft SDKs\Windows\v6.0A\Bootstrapper\Packages\" />
    </Target>
</Project> 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-11T18:38:10.073

您还可以使用[GetFrameworkSdkPath](http://msdn.microsoft.com/en-us/library/ms164298.aspx) MSBuild 任务。

```
<GetFrameworkSdkPath>
  <Output TaskParameter="Path" PropertyName="WindowsSdkPath" />
</GetFrameworkSdkPath> 
```

例如：

```
<GenerateBootstrapper 
  ApplicationFile="$(SolutionName).application"
  ApplicationName="$(ClickOnceAppTitle)"
  ApplicationUrl="$(ClickOnceUrl)"
  BootstrapperItems="@(BootstrapperFile)"
  Culture="en"
  FallbackCulture="en-US"
  Path="$(WindowsSDKPath)"
  OutputPath="." /> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-14T11:52:03.253

谢谢约翰。根据您的帖子，我编辑了 MSBuild 脚本以从注册表中读取文件夹。然而，没有必要在最后附加“包”，这是我原始脚本中的另一个错误。

以下是工作脚本：

```
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

    <PropertyGroup>
        <WindowsSDKPath>$(registry:HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\GenericBootstrapper\3.5@Path)</WindowsSDKPath>
    </PropertyGroup>

    <ItemGroup>
        <BootstrapperFile Include="Microsoft.Net.Framework.2.0">
                <ProductName>.NET Framework 2.0</ProductName>
        </BootstrapperFile>
        <BootstrapperFile Include="Microsoft.Windows.Installer.3.1">
                <ProductName>Windows Installer 3.1</ProductName>
        </BootstrapperFile>
    </ItemGroup>

    <Target Name="Bootstrapper">
        <GenerateBootstrapper ApplicationFile="mySetup.msi" 
            Culture="de-DE" 
            ApplicationName="My Application" 
            OutputPath="$(OutDir)\de-DE" 
            BootstrapperItems="@(BootstrapperFile)" 
            Path="$(WindowsSDKPath)" />

        <GenerateBootstrapper ApplicationFile="mySetup.msi" 
            Culture="en-US" 
            ApplicationName="My Application" 
            OutputPath="$(OutDir)\en-US" 
            BootstrapperItems="@(BootstrapperFile)" 
            Path="$(WindowsSDKPath)" />
    </Target>
</Project> 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-05-26T06:10:39.970

Windows SDK 的安装路径存储在`CurrentInstallFolder`以下注册表项的值中：

`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SDKs\Windows`

![HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SDKs\Windows CurrentInstallFolder](https://i.stack.imgur.com/WnUxc.png)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-03-01T10:39:33.100

我按照 Jeremy D 的回答，但给出了错误消息：错误 MSB3147：在 'C:\Program Files (x86)\Microsoft SDKs\Windows\v8.0A\Engine' 中找不到所需的文件 'setup.bin' .

原因是引导程序的路径（至少使用 SDK 的 V8.0A）是 GetFrameworkSdKPath 返回的路径下的子目录。

所以对我有用的 MSBuild 代码是：

```
<Target Name="AfterBuild">
  <GetFrameworkSdkPath>
    <Output TaskParameter="Path" PropertyName="WindowsSdkPath"/>
  </GetFrameworkSdkPath>
  <GenerateBootstrapper 
      ApplicationFile="myapp.msi" 
      ApplicationName="MyApplication" 
      BootstrapperItems="@(BootstrapperFile)" 
      OutputPath="$(OutputPath)" 
      Path="$(WindowsSdkPath)\Bootstrapper" />
</Target> 
```

注意 $(WindowsSdkPath) 的 \Bootstrapper 后缀

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-14T11:19:27.297

引导程序的路径存储在注册表项下：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\GenericBootstrapper\3.5 
```

要找出包文件夹，请打开它，读取“路径”注册表值，然后在末尾附加“包”，这应该会为您提供所需文件夹的完整路径。

例如：

```
string bootStrapperPackagesFolder = "";

RegistryKey regKey = Registry.LocalMachine.OpenSubKey
   (@"SOFTWARE\Microsoft\GenericBootstrapper\3.5");
if (regKey != null)
{
   bootStrapperPackagesFolder = (string)regKey.GetValue("Path");
   if (bootStrapperPackagesFolder != null)
   {
      bootStrapperPackagesFolder += @"Packages\";
      Console.WriteLine(bootStrapperPackagesFolder);
   }
} 
```

# c# - 如何使用正则表达式在c#中获取部分字符串

> ID：442482
> 
> 赞同：1
> 
> 时间：2009-01-14T10:06:55.087
> 
> 标签：c#, regex

我正在尝试使用

`(?<key>.{5}keyword.{5}?)`

测试“其他字符串关键字其他文本”

它会得到“环关键字其他”

我希望“akeyword other text”或“other string keyworda”或“akeywordc”也匹配。

如何修改正则表达式？

* * *

我有一个长字符串，我想获取 find 关键字并使用前缀和后缀字符串获取它

要求 5 只是一个样本，它可能会更改为任何数字，例如 50

我的问题是关键字的位置是否小于 5 并且不匹配。

当前缀或后缀字符串长度为时如何使用关键字获取前缀或后缀字符串

不知道。

* * *

对不起，我的问题不清楚。

我想用关键字获取前缀或后缀字符串。我想得到最多 5 个字的前缀或后缀字符串。

例子：

“abcde 关键字 abcde” 我想得到“bcde 关键字 abcd”

并且当前缀字符串少于 5 个单词时

“关键字 abcde” 我想得到“关键字 abcd”

或后缀字符串少于 5 个字

“abcd 关键字 a” 我想得到“abcd 关键字 a”

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T10:17:10.433

这可能是您正在寻找的：

```
(?<key>.{0,5}keyword[\s\S]{0,5}) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T10:14:04.387

不清楚你想要通过什么失败；特别是，在`.{5}`之前需要 5 个字符`keyword`，所以我不确定“akeywordc”应该如何匹配。上面写着“ `[\s\S]{5}`5 个空白或非空白”......同样，这需要 5 个字符（并且可能是`.{5}`）。

所以：你希望它如何表现？

例如，`(?<key>.{1,5}keyword.{1,5})`将匹配之前或之后的 1-thru-5 个字符（贪婪地）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-14T11:18:13.943

这个？

```
(?<key>.{0,5}keyword.{0,5}) 
```

当你学习如何解决这个问题时，你可以使用像[The Regulator这样的东西来破解；](http://sourceforge.net/projects/regulator/)教人钓鱼，诸如此类。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T10:17:04.787

这可能很简单，`(.*?)keyword(.*?)`也可能`(.{0,5})`基于塞巴斯蒂安的回答，它仍然取决于您所说的“未知”是什么意思。

您的意思是可以接受任意数量的匹配，还是只有特定数量的匹配，但您直到运行时才知道该数字 - 在这种情况下，您如何在运行时知道该数字（我们无法为您回答）。

如果您发布一组匹配的示例字符串和不匹配的示例字符串，那仍然是最好的。

* * *

从 OP 更新 2 编辑：那么看来您需要结合标记和塞巴斯蒂安的答案

```
(?<key>.{0,5}keyword.{0,5}) 
```

这将包括 0 到 5 个字符的前缀和 0 到 5 个字符的后缀匹配

# c# - 如何使用 Graphics.DrawString 绘制双高文本？

> ID：442485
> 
> 赞同：1
> 
> 时间：2009-01-14T10:07:20.763
> 
> 标签：c#, graphics, system.drawing, drawstring

我正在尝试使用 System.Drawing 模拟 POS 打印机，我需要的功能之一是以双倍高度绘制文本。知道如何使用 .Net 的 Graphics 类来做到这一点吗？

我需要将文本绘制两倍大并压缩它还是绘制正常大小然后拉伸？两者似乎都是混乱的选择，但还有其他选择吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T10:17:22.180

使用 ScaleTransform 并仅放大 y。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-14T10:18:14.487

查看 Graphics 对象上的变换矩阵 - 您可以独立控制水平和垂直缩放。

# java - 解决 JPA 查询查找连接列表中的最后一个条目

> ID：442488
> 
> 赞同：1
> 
> 时间：2009-01-14T10:08:52.273
> 
> 标签：java, jpa, dao

给出了以下类结构：

```
class Job 
{
    String description;
    Collection<JobHistory> history;
}

class JobHistory
{
    Date assignDate;
    User jobOwner;
}

class JobOwner 
{
    String name;
    String id;
} 
```

可以通过 JPA 在 db 上访问此类结构。在 DAO 层中，我可以用 JPA 语法编写查询。

问题：我想要一个列表，其中包含具有给定 ID 的给定所有者的条目，并且谁是工作中的最后一个`Job`（按 assignDate 排序）。听起来很复杂，也许更简单：给我所有工作，并且指定的所有者是工作的实际所有者。`JobHistory``Jobhistory``JobHistory`

**更新：**为清楚起见，我将稍微更改类的名称。

```
class Job 
{
    String description;
    Collection<JobOwnerHistory> history;
}

class JobOwnerHistory
{
    Date assignDate;
    User jobOwner;
}

class JobOwner 
{
    String name;
    String id;
} 
```

每个`Job`人都有按 . 排序的所有者的历史`assignDate`。实际所有者得到了最后分配的工作（即`MAX(assignDate)`）。我想为每个工作找到特定用户的`JobOwnerHistory`条目。`MAX(assignDate)``User`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-24T05:53:50.027

我找到了以下查询的答案：

```
SELECT j, h FROM Job j JOIN j.history h JOIN h.jobOwner u
WHERE u.name = :name AND 
    (SELECT MAX(h2.assignDate) FROM Job j2 JOIN j2.history h2
     WHERE h2 member of j.history) = h.assignDate 
```

查询中最重要的部分是子选择，**`MAX(h2.assignDate)`**因为我想获得工作和所有者历史中的最新条目。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T10:28:36.463

尝试：

```
SELECT j, j.history FROM Job j JOIN User u WHERE u.name = :name 
```

如果我要在 EclipseLink 中执行此操作，我会稍微更改一下：

```
public List<Job> getAllJobsForUser(String username) {
  List<Job> jobs = entityManager
    .createQuery("SELECT j FROM Job j JOIN User u WHERE u.name = :name")
    .setParameter("name", username)
    .setHint(QueryHints.BATCH, "j.history")
    .queryForList();
} 
```

区别？在第一个版本中，您返回两个对象，因此您必须从 List 或 Object 数组中检索它们，而在第二个版本中，查询提示仅从（假定）惰性一对多关系中加载所有作业历史记录.

我不知道 Hibernate 是否有与此等价的功能。Toplink Essentials 没有。但它是我最喜欢的 EclipseLink 特性之一。

哦，显然您可以（并且可能应该）使用命名查询而不是像我所做的那样的临时查询（因为可以在构建期间验证这些查询）。

# iphone - 隐藏键盘

> ID：442491
> 
> 赞同：0
> 
> 时间：2009-01-14T10:09:02.523
> 
> 标签：iphone, cocoa, cocoa-touch

我有一个*UISearchBar*并且在清除文本字段时在委托方法上隐藏键盘：

```
- (void)searchBar:(UISearchBar *)filterBar textDidChange:(NSString *)filterText {
    NSLog(@"filter: %@", filterText);

    if ([filterText length] == 0) {
        NSLog(@"hiding keyboard");
        [filterBar resignFirstResponder ]; 
```

现在，当我使用退格按钮清除搜索词时，一切都很好。当搜索变为空时，键盘隐藏。当我按下“交叉”按钮完全清除搜索字段时，情况并非如此。

嗯，不完全正确。我确实调用*了 resignFirstResponder*并隐藏了键盘 - 你只是看不到它，因为它会立即备份。我通过观察键盘显示/隐藏事件发现了这一点。

**那么键盘怎么又出现了呢？我怎样才能防止这种情况？**

我已经尝试遍历*UISearchBar*的所有子视图，并在这些子视图上调用*resignFirstResponder* ......但除非我做错了什么 - 这也不能解决这个问题。

**更新：**

*事实上，我只是让键盘不禁用“完成”按钮:-D ...所以我将按照凯文的建议“停止”沿着这条路走下去。我仍然想知道为什么键盘会这样回来。*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T11:22:06.010

我建议你*停止*尝试这样做。当字段清空时隐藏键盘是完全不标准的行为，用户不会期望它。在这种情况下，最好让您的行为与系统中所有其他应用程序保持一致。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-24T13:24:27.640

我看到你已经接受了一个答案并且不打算继续这种方式，但我*很*好奇你是否可以通过实现这个来实现你想要的东西：

```
- (BOOL)canBecomeFirstResponder
{
   return !preventingKeyboardAppearance; // so to speak
}

- (void)searchBar:(UISearchBar *)filterBar textDidChange:(NSString *)filterText 
{
   // handle text

   preventingKeyboardAppearance = YES;
   [filterBar resignFirstResponder];
} 
```

我不清楚在什么情况下您会将 preventKeyboardAppearance 设置回 NO，但我确实想知道这是否可行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T13:10:00.770

我基本上同意凯文，但这对你没有帮助，所以这里是：

尝试遍历搜索栏的子视图并找到属于 UITextField 类的兄弟。然后将这个文本字段的委托属性设置为您的 ViewController 的类并在那里处理回调（例如 textViewShouldReturn），或者直接在文本字段上调用 ​​resignFirstResponder。前者显然需要在初始化/加载时完成，而后者可以在您现有的 textDidChange 回调中完成。

这里还有一些提示：

[http://discussions.apple.com/thread.jspa?threadID=1479468&tstart=0](http://discussions.apple.com/thread.jspa?threadID=1479468&tstart=0) [http://discussions.apple.com/thread.jspa?messageID=8176608](http://discussions.apple.com/thread.jspa?messageID=8176608)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-18T14:27:03.773

```
-(BOOL)textFieldShouldReturn:(UITextField *)textField {
        [textField resignFirstResponder];

        return YES;    
    } 
```

[textField resignFirstResponder] 有一段时间没有工作，所以使用这个
[YorTextFieldName resignFirstResponder] 它工作正常，而不是任何其他隐藏键区的功能

# java - 如何为 Solaris 10 安装 JDK 1.5

> ID：442494
> 
> 赞同：0
> 
> 时间：2009-01-14T10:11:21.897
> 
> 标签：java

我一直在尝试安装，但在接受许可协议后解压缩文件时，文件已损坏。

任何人都有任何建议。

[http://java.sun.com/javase/downloads/index_jdk5.jsp](http://java.sun.com/javase/downloads/index_jdk5.jsp)

我安装了这个 jdk-1_5_0_17-solaris-sparc.sh

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T10:23:23.633

安装程序 (jdk-1_5_0_17-solaris-sparc.sh) 是一个包含两部分的脚本：文本部分（根据许可协议）和二进制部分（压缩数据，JDK 本身）。

文件在第二个二进制部分损坏。

我的猜测是您通过 FTP 传输安装程序而不使用二进制模式。如果您使用的是普通的 ftp，只需在下载文件之前输入“bin”。如果那是另一个 FTP 客户端，请咨询帮助。

# java - Android HTTP 连接

> ID：442496
> 
> 赞同：18
> 
> 时间：2009-01-14T10:11:49.540
> 
> 标签：java, android, sockets, network-programming

谁能告诉我为什么这在 Android 模拟器中不起作用？从浏览器我可以访问并且服务器是内部的。我能想到的只是我的应用程序缺少一些配置，因此它可以访问网络层。

```
try {
    InetAddress server = Inet4Address.getByName("thehost");
    //Doesn't work either
    //or InetAddress server2 = Inet4Address.getByAddress(new String("192.168.1.30").getBytes());

    if(server.isReachable(5000)){
        Log.d(TAG, "Ping!");
    }

    Socket clientsocket = new Socket(server, 8080);
} catch (UnknownHostException e) {
    Log.e(TAG, "Server Not Found");
} catch (IOException e) {
    Log.e(TAG, "Couldn't open socket");
} 
```

**引发 UnknownHostException**

谢谢

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-01-14T10:58:28.243

就配置而言，您需要从应用程序访问 Internet 的唯一设置是 INTERNET 权限，通过在应用程序清单中的应用程序标记*之外添加以下行来启用。*

```
<uses-permission android:name="android.permission.INTERNET" /> 
```

所以清单将遵循这个一般结构

```
<manifest xmlns:android="http://schemas.android.com/apk/res/android" package="com.example.android.apis">    
  <uses-permission android:name="android.permission.INTERNET" />
  <application 
    android:name="MyApplication"    
    android:label="@string/application_title"
    android:icon="@drawable/my_icon">
    [ .. Your Activities go here ]
  </application>
</manifest> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-02T11:23:02.930

由于超时，它可能仍然无法正常工作。由于您需要 root 权限才能发送 ICMP 包，并且 isReachable 的实现将使用慢速 TCP 版本的 ECHO。查看 javaDoc。

# java - 如何使用 commons-digester 将 XML 文件表示为 Java 对象？

> ID：442498
> 
> 赞同：0
> 
> 时间：2009-01-14T10:12:35.980
> 
> 标签：java, xml, apache-commons-digester

继我最近[关于](https://stackoverflow.com/questions/428073/what-is-the-best-simplest-way-to-read-in-an-xml-file-in-java-application "问题") 在 Java 中解析 XML 文件的问题之后，我决定使用 commons-digester 库。我现在熟悉这个过程，现在想创建一个表示 XML 文件的 Java 类，这样当用户实例化该类的新对象时，XML 文件中的所有数据都将可用。

为了说明这一点，我有一个名为 MyConfig.xml 的 XML 文件，其结构如下：

```
<MyConfig>
    <ServerName>nile</ServerName>
    <ServerPort>8079</ServerPort>
</MyConfig> 
```

我还有一个名为 MyConfig.java 的 Java 类，它代表这个 XML 文件。它有一个构造函数，它接收 XML 文件的位置，然后解析并输出 XML 文件的内容。该类具有以下结构：

```
package com.digestersample;

import java.io.File;
import java.io.IOException;

import org.apache.commons.digester.Digester;
import org.xml.sax.SAXException;

public class MyConfig {
    private String serverName;
    private String serverPort;

    public MyConfig(String configFile) throws IOException, SAXException
    {
        Digester digester = new Digester();
        digester.setValidating(false);

        digester.addObjectCreate("MyConfig", MyConfig.class);

        digester.addCallMethod("MyConfig/ServerName", "setServerName", 0);
        digester.addCallMethod("MyConfig/ServerPort", "setServerPort", 0);

        System.out.println("Creating MyConfig...");
        MyConfig mc = (MyConfig) digester.parse(new File(configFile));
        System.out.println("Done.");

        System.out.println("Port: " + mc.getServerName());
        System.out.println("Port: " + mc.getServerPort());
    }

    public String getServerName() {
        return serverName;
    }

    public void setServerName(String serverName) {
        this.serverName = serverName;
    }

    public String getServerPort() {
        return serverPort;
    }

    public void setServerPort(String serverPort) {
        this.serverPort = serverPort;
    }

} 
```

我的问题是，如何更改此类，以便每当其他组件实例化该类的新对象时，XML 文件的内容将在实例中可用。例如：

```
package com.digestersample;

import java.io.IOException;

import org.xml.sax.SAXException;

public class MyOtherClass {

    public static void main(String[] args) {

        MyConfig mc;
        try {

            mc = new MyConfig("/home/user/MyConfig.xml");

            System.out.println( mc.getServerName() );
            System.out.println( mc.getServerPort() );

        } catch (IOException e) {
            e.printStackTrace();
        } catch (SAXException e) {
            e.printStackTrace();
        }

    }

} 
```

目前，上述实例化导致 java.lang.InstantiationException。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T10:28:38.617

我意识到这不是您问题的直接答案，但是对于这样一个简单的配置以及您遇到的问题来说，这真是一大堆代码。正如您在原始帖子 Simple XML [http://simple.sourceforge.net](http://simple.sourceforge.net)中提到的那样，我认为这项工作做得更好。

```
@Root
public class MyConfig {

  @Element
  private String serverName;

  @Element
  private int serverPort

  public MyConfig() {
     super();
  }

  public MyConfig(File file) {
     Style style = new CamelCaseStyle();
     Persister persister = new Persister(style);

     persister.read(this, file);
  }

  public String getServerName() {
    return name;
  }

  public int getServerPort() {
    return port;
  }
} 
```

并创建它。

```
MyConfig mc = new MyConfig("/home/user/MyConfig.xml");

System.out.println("Name: " + mc.getServerName());
System.out.println("Port: " + mc.getServerPort()); 
```

完毕！你不会看到任何例外。此外，对于您的消化器异常，您缺少类似于我添加到 MyConfig 示例中的公共无参数构造函数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T10:49:55.453

自从我查看公共摘要器以来已经有一段时间了，但我希望*InstantiationException*是因为摘要器希望*MyConfig*类是[JavaBean](http://java.sun.com/javase/technologies/desktop/javabeans/docs/spec.html)。JavaBean 的定义特征之一是它有一个**公共的、零参数的构造函数**。

您可能会考虑使用其他类来创建您的*MyConfig*实例：

```
public class MyConfigFactory

    public MyConfig createMyConfig(String configFile) throws IOException, SAXException
    {
        Digester digester = new Digester();
        digester.setValidating(false);

        digester.addObjectCreate("MyConfig", MyConfig.class);

        digester.addCallMethod("MyConfig/ServerName", "setServerName", 0);
        digester.addCallMethod("MyConfig/ServerPort", "setServerPort", 0);

        MyConfig mc = (MyConfig) digester.parse(new File(configFile));

        return mc;
    }

} 
```

# sql - 将列默认值绑定到 SQL 2005 中的函数

> ID：442503
> 
> 赞同：14
> 
> 时间：2009-01-14T10:13:12.407
> 
> 标签：sql, sql-server-2005, tsql, default-value

我有一列包含可以由用户排序的项目：

```
DOC_ID  DOC_Order DOC_Name
   1       1        aaa
   2       3        bbb
   3       2        ccc 
```

我试图找出一种在创建条目时正确初始化 DOC_Order 的方法。一个好的值要么是相应的 DO-CID（因为它是自动分配的），要么是 MAX(DOC-ORDER) + 1

经过一番谷歌搜索后，我发现可以将标量函数的返回值分配给默认列。

```
CREATE FUNCTION [dbo].[NEWDOC_Order] 
(
)
RETURNS int
AS
BEGIN

RETURN (SELECT MAX(DOC_ORDER) + 1 FROM DOC_Documents)

END 
```

但是我每次使用 MS SQL Management Studio 的尝试都以“验证列 'DOC_Order' 的默认值时出错”消息结束。

知道将函数分配给 DEFAULT 的确切 SQL 语法是什么吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-14T10:38:45.693

添加这样的默认值的语法是

```
alter table DOC_Order 
add constraint 
df_DOC_Order 
default([dbo].[NEWDOC_Order]())
for DOC_Order 
```

此外，当 DOC_Order 为空时，您可能希望更改要处理的函数

```
Create FUNCTION [dbo].[NEWDOC_Order] 
(
)
RETURNS int
AS
BEGIN

RETURN (SELECT ISNULL(MAX(DOC_ORDER),0) + 1 FROM DOC_Documents)

END 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-14T10:58:28.510

如果有人想使用界面执行此操作，请键入

```
[dbo].[NEWDOC_Order]() 
```

成功了。您显然需要所有括号，否则它将拒绝您的输入。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-01-28T22:00:37.547

这是通过 SQL Server Management Studio GUI 执行此操作的屏幕截图：

1.  右键单击表格并选择`Design`

[![在此处输入图像描述](https://i.stack.imgur.com/rXaV0.png)](https://i.stack.imgur.com/rXaV0.png)

2.  在表格的设计视图中选择*DOC_Order*列（或其他需要默认的列）以查看属性

[![在此处输入图像描述](https://i.stack.imgur.com/QdmkW.png)](https://i.stack.imgur.com/QdmkW.png)

3.  `Default Value or Binding`使用带括号的函数名称进行更新，如下所示：

[![在此处输入图像描述](https://i.stack.imgur.com/rLAcH.png)](https://i.stack.imgur.com/rLAcH.png)

注意：正如 Luk 所说，需要所有括号，包括模式（在这种情况下为*dbo ）。*

# performance - 测量同一服务器上特定 IIS 网站的 CPU 负载

> ID：442505
> 
> 赞同：2
> 
> 时间：2009-01-14T10:13:43.247
> 
> 标签：performance, iis

我有一个在 Windows Server 2003 上运行的 IIS 服务器。该服务器托管多个网站。

有时 CPU 负载会在很长一段时间内达到峰值，从而导致服务器停止响应或延迟响应。

问题是我们不知道多个网站中的哪一个正在创建高负载 - 我尝试在性能监视器中查看可以使用的计数器，但我没有看到任何有关特定 IIS 实例的 CPU 负载的信息。

这使得很难找到问题的根源。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T10:28:11.923

每个应用程序池都有 w3wp.exe 进程。所以尝试将每个 Web 应用程序设置在不同的应用程序池中。顺便说一句，这始终是一个好习惯。

然后运行[以下脚本](http://blogs.thesitedoctor.co.uk/tim/2007/10/16/Identify+Which+Application+Pool+Is+Associated+With+Which+W3WPexe+Process.aspx)。

然后，您可以通过任务管理器或性能监视器查看哪个 Web 应用程序正在创建高 CPU 负载。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T10:21:47.273

您是否尝试过检查垃圾收集 2 峰值（# **Gen 2 Collections**）的性能计数器？

非常高的 CPU 负载周期通常可归因于此。

编辑：这个 SO 答案可能有用：[要监视的最佳 ASP.NET 性能计数器是什么？](https://stackoverflow.com/questions/161737/what-are-the-best-asp-net-performance-counters-to-monitor)

这篇博文描述了收集和解释 GC 性能计数器：http: [//blogs.msdn.com/maoni/archive/2004/06/03/148029.aspx](http://blogs.msdn.com/maoni/archive/2004/06/03/148029.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T11:52:01.647

使用 WMI 尝试：

要获取进程使用情况 (W2K3/2K8)：
“从 Win32_PerfFormattedData_PerfProc_Process 中选择 IDProcess、PercentPrivilegedTime、PercentProcessorTime、PercentUserTime，其中 Name='w3wp'”

要识别您的站点，请使用：
“SELECT ProcessId, CommandLine, WorkingSetSize, ThreadCount, PrivatePageCount, PageFileUsage, PageFaults, HandleCount, CreationDate, Caption FROM Win32_Process where Caption='w3wp.exe'”

使用此工具测试 sql：[http ://code.msdn.microsoft.com/NitoWMI](http://code.msdn.microsoft.com/NitoWMI)

祝你好运。

# cocoa - 如何访问 Cocoa 中大型 NSDictionary 的特定子集？

> ID：442513
> 
> 赞同：3
> 
> 时间：2009-01-14T10:16:22.133
> 
> 标签：cocoa, nsdictionary, subset

我有一个包含大量自定义对象的 NSDictionary 对象。对象要么属于 B 类，要么属于 C 类，两者都从 A 类继承。如果对象属于 B 类，它们将有一个内部标志 (kindOfCIsh)，用于将来的分组。

如何在我的程序中的不同时间获取包含这些对象的不同分组的 NSDictionary（或 NSArray）？在一种情况下，我需要所有 B，但另一种情况下，我需要所有 C 对象，以及满足 (kindOfCIsh == true) 的 B 对象。

有没有一种简单的方法可以访问这些子集？也许使用过滤谓词？当然，我可以遍历整个字典并手动构建所需的子集，但我觉得有更好的方法。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-15T20:19:41.323

[[myDictionary allValues] filteredArrayUsingPredicate: pred];

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T12:26:29.890

您可以使用类别

代码是这样的

```
@interface NSDictionary (dictionaryForClass)

  -(NSMutableDictionary *) dictionaryWithObjectsKindOfClass:(Class)myClass;

@end

@implementation NSDictionary (dictionaryForClass)

-(NSMutableDictionary *) dictionaryWithObjectsKindOfClass:(Class)myClass;
{
  NSMutableDictionary *ret = [[[NSMutableDictionary alloc] init] autorelease];

  for (id object in self) {
    if ([object isKindOfClass:myClass]) {
       [ret addObject:object];
    }  
  }  
  return ret;

}

@end 
```

# xml - XML 元素有标准的命名约定吗？

> ID：442529
> 
> 赞同：103
> 
> 时间：2009-01-14T10:22:21.357
> 
> 标签：xml, coding-style, naming-conventions

对于 XML 文档，是否有任何事实上的标准或其他标准？例如，哪个是编写标签的“最佳”方式？

```
<MyTag />
<myTag />
<mytag />
<my-tag />
<my_tag /> 
```

同样，如果我有一个更好的属性的枚举值

```
<myTag attribute="value one"/>
<myTag attribute="ValueOne"/>
<myTag attribute="value-one"/> 
```

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-01-14T10:25:26.563

我怀疑最常见的值是camelCased - 即

```
<myTag someAttribute="someValue"/> 
```

特别是，如果与代码生成器混合使用空格（即将 xml 序列化为对象），空格会导致一些故障，因为没有多少语言允许使用空格的枚举（需要在两者之间进行映射）。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2015-06-30T06:13:56.427

# XML Naming Rules

## XML elements must follow these naming rules:

```
 - Element names are case-sensitive 
    - Element names must start with a letter or underscore
    - Element names cannot start with the letters xml(or XML, or Xml, etc) 
    - Element names can contain letters, digits, hyphens, underscores, and periods 
    - Element names cannot contain spaces 
```

Any name can be used, no words are reserved (except xml).

# Best Naming Practices

```
 - Create descriptive names, like this: <person>, <firstname>, <lastname>.
    - Create short and simple names, like this: <book_title> not like this: <the_title_of_the_book>.
    - Avoid "-". If you name something "first-name", some software may think you want to subtract "name" from "first".
    - Avoid ".". If you name something "first.name", some software may think that "name" is a property of the object "first".
    - Avoid ":". Colons are reserved for namespaces (more later).
    - Non-English letters like éòá are perfectly legal in XML, but watch out for problems if your software doesn't support them. 
```

# Naming Styles

There are no naming styles defined for XML elements. But here are some commonly used:

```
 - Lower case    <firstname> All letters lower case
    - Upper case    <FIRSTNAME> All letters upper case
    - Underscore    <first_name>    Underscore separates words
    - Pascal case   <FirstName> Uppercase first letter in each word
    - Camel case    <firstName> Uppercase first letter in each word except the first 
```

reference [http://www.w3schools.com/xml/xml_elements.asp](http://www.w3schools.com/xml/xml_elements.asp)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-14T11:33:25.600

我喜欢 TitleCase 用于元素名称，而 camelCase 用于属性。两者都没有空格。

```
<AnElement anAttribute="Some Value"/> 
```

顺便说一句，我快速搜索了 XML 中的最佳实践，并找到了这个相当有趣的链接：[XML 模式：最佳实践](http://www.xfront.com/BestPracticesHomepage.html)。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-01-14T12:10:53.277

对我来说，这就像讨论编程语言的代码风格：有些人会争论一种风格，有些人会捍卫另一种风格。我看到的唯一共识是：“选择一种风格并保持一致”！

我只是注意到许多 XML 方言只使用小写名称（SVG、Ant、XHTML...）。

我没有得到“属性值中没有空格”规则。不知何故，它引发了“在属性中放入什么以及作为文本放入什么？”的辩论。
也许这些不是最好的例子，但有一些众所周知的 XML 格式在属性中使用空格：

*   XHTML，尤其是类属性（您可以放置​​两个或更多类），当然还有 alt 和 title 属性。
*   SVG，例如路径标签的 d 属性。
*   两者都具有样式属性...

我不完全理解反对这种做法的论据（似乎只适用于某些用法），但它至少是合法的，并且被广泛使用。显然有缺点。

哦，自动关闭斜线之前不需要空格。:-)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-01-14T10:26:19.383

我倾向于使用**小写**或**驼峰**标记，因为属性通常应该反映数据值 - 而不是内容 - 我会坚持一个可以用作任何平台/语言可能感兴趣的变量名的值，即**避免空格**，但其他两种形式*都*可以

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2011-09-08T07:59:52.000

这是主观的，但如果元素标签中有两个单词，则可以通过在单词之间添加下划线（例如`<my_tag>`）而不是不使用分隔符来增强可读性。参考：[http](http://www.w3schools.com/xml/xml_elements.asp) ://www.w3schools.com/xml/xml_elements.asp 。所以根据 w3schools 的答案是：

```
<my_tag attribute="some value"> 
```

该值不需要使用下划线或分隔符，因为您可以在属性值中使用空格，但不能在元素标记名称中使用空格。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-01-14T14:53:34.167

许多以文档为中心的 XML 方言使用小写基本拉丁文和破折号。我倾向于这样做。

将 XML 直接映射到编程语言标识符的代码生成器很脆弱，并且（除了简单的对象序列化，例如 XAML）应避免在可移植文档格式中使用；为了获得最佳重用和信息寿命，XML 应该尝试匹配域，而不是实现。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-10-06T18:03:10.843

rss 可能是世界上使用最多的 xml 模式之一，它是驼峰式的。

规范在这里：[http ://cyber.law.harvard.edu/rss/rss.html](http://cyber.law.harvard.edu/rss/rss.html)

假设它在模式中没有节点属性，但所有节点元素名称都是驼峰式命名的。例如：

lastBuildDate 管理编辑器 pubDate

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-01-08T04:40:21.843

我通常将 XML 命名约定与代码其他部分中的相同命名约定保持一致。原因是当我将 XML 加载到 Object 中时，它的属性和元素名称可以引用为项目中当前使用的相同命名约定。

例如，如果您的 javascript 使用 camelCase，那么您的 XML 也使用 camelCase。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-03-17T23:42:43.167

Microsoft 采用两种约定：

1.  对于**配置**，Microsoft 使用**camelCase**。查看 Visual Studio 配置文件。对于VS2013，它存储在：

    C:\Program Files (x86)\Microsoft Visual Studio 12.0\Common7\IDE\devenv.exe.config

例子：

```
<startup useLegacyV2RuntimeActivationPolicy="true">
  <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.5" />
</startup> 
```

2.  Microsoft 还为他们的 XAML 使用**大写**。我想这是为了区别于 HTML（使用小写）。

例子：

```
<MenuItem Header="Open..." Command="ApplicationCommands.Open">
    <MenuItem.Icon>
        <Image Source="/Images/folder-horizontal-open.png" />
    </MenuItem.Icon>
</MenuItem> 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-05-27T00:23:07.267

没有明确的建议。根据 W3C 的其他建议，即[XHTML](https://www.w3.org/TR/xhtml1/#h-4.2)的建议，我选择了小写：

> 4.2\. 元素和属性名称必须小写
> 
> XHTML 文档必须为所有 HTML 元素和属性名称使用小写字母。这种差异是必要的，因为 XML 区分大小写，例如 <li> 和 <LI> 是不同的标记。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-09-06T09:05:18.050

**XML 命名规则**

XML 元素必须遵循以下命名规则：

*   名称可以包含字母、数字和其他字符
*   名称不能以数字或标点符号开头
*   名称不能以字母 xml（或 XML，或 Xml 等）开头
*   名称不能包含空格 可以使用任何名称，不保留任何字词。

资料来源：[W3学校](http://www.w3schools.com/xml/xml_elements.asp "W3学校")

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-03-25T14:49:54.993

我一直在寻找一个好的方法，也阅读了这个帖子和其他一些帖子，我会投票赞成*使用连字符*。

[它们在 ARIA ( https://developer.mozilla.org/de/docs/Web/Barrierefreiheit/ARIA](https://developer.mozilla.org/de/docs/Web/Barrierefreiheit/ARIA) )中被广泛使用，可以在许多源代码中看到，因此很常见。正如这里已经指出的那样，它们当然是允许的，这里也解释了这一点：[在 XML 元素名称中使用 -](https://stackoverflow.com/questions/1478486/using-in-xml-element-name)

还有一个附带的好处：当结合 CSS 编写 HTML 时，你经常有一些类的名字默认使用连字符作为分隔符。现在，如果您有使用 CSS 类的自定义标签或使用 CSS 类的标签的自定义属性，那么类似：

`<custom-tag class="some-css-class">`

更加一致并且阅读 - 在我的拙见中 - 比：

`<customTag class="some-css-class">`

# asp.net - 在 ASP.NET Web 应用程序中创建嵌套母版页

> ID：442535
> 
> 赞同：2
> 
> 时间：2009-01-14T10:25:04.847
> 
> 标签：asp.net, master-pages, nested

是否可以像在 ASP.NET 网站项目中那样在 ASP.NET Web 应用程序项目中创建嵌套母版页？

我正在使用 Visual Studio 2008 并使用 ASP.NET Web 应用程序。在创建母版页时，无法选择另一个母版页，如果该母版页可用，我可以创建嵌套母版页。

有没有人遇到过类似的问题？是否推荐任何解决方法？

提前感谢您的帮助。干杯。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-14T10:28:41.877

是的，从 .NET 框架的第 2 版开始，已支持嵌套母版页。一个警告是，如果您有嵌套的母版页，您将无法在 Visual Studio 2005 中获得设计时支持。这在 VS 2008 中不是问题。

```
<%@ Master Language="C#" AutoEventWireup="true" CodeFile="SecondLevelMaster.master.cs" Inherits="SecondLevelMaster" **MasterPageFile="~/RootMaster.master"** %> 
```

# asp.net - 阻止 IE 突出显示表单中的第一个提交按钮

> ID：442548
> 
> 赞同：11
> 
> 时间：2009-01-14T10:30:05.383
> 
> 标签：asp.net, html, internet-explorer, user-interface

[在HTML 4.01 规范](http://www.w3.org/TR/1999/REC-html401-19991224/)中似乎未定义在表单中输入的预期行为，而 HTML 5 规范[说它](http://www.whatwg.org/specs/web-apps/current-work/multipage/forms.html#implicit-submission)应该是表单中的第一个提交按钮。

Internet Explorer (IE) 通过添加专有边框或其他方式在表单具有焦点时突出显示表单中的第一个按钮。其他浏览器不添加这样的视觉线索。

我想使用另一个按钮作为默认按钮并设置此按钮的样式，以便所有浏览器都会提供一个视觉线索，表明它是默认按钮。（我们使用的是每页使用一个表单的 ASP.NET，因此很难设计页面以使默认按钮始终位于第一位。）

虽然我可以在大多数浏览器中使用 javascript 和 css 轻松完成此操作，但我无法让 IE 停止突出显示第一个按钮。

有什么方法可以告诉 IE 不突出显示第一个提交按钮或突出显示不同的按钮？还是我错过了其他一些解决方案？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-10-05T14:25:04.410

在您的 asp.net 按钮控件上，设置`useSubmitBehavior="false"`. 这会将 html 呈现为按钮而不是提交。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-14T15:05:53.547

ASP.Net 2.0 还引入了 DefaultButton 的概念。

这至少在 Form 和 Panel 元素上可用：

```
<form id="form1" runat="server" defaultbutton="Button2">
<div>
    <asp:TextBox id="TextBox1" runat="server"></asp:TextBox>
    <br />
    <asp:Button id="Button1" runat="server" text="1st Button" onclick="Button1_Click" />
    <br />
    <br />
    <asp:panel id="something" defaultbutton="button3" runat="server">
        <asp:TextBox id="TextBox2" runat="server"></asp:TextBox>
        <br />
        <asp:Button id="Button2" runat="server" text="2nd Button" onclick="Button2_Click" />
        <br />
        <asp:Button id="Button3" runat="server" text="3rd Button" onclick="Button3_Click" />

    </asp:panel>
    <br />
    <br />

</div>
</form> 
```

因此，当您加载页面或在 TextBox1 中输入文本时，按 Enter 将提交 Button2。当您在 TextBox2 中输入文本时，按 Enter 将提交 Button3 - 就像您在面板中一样。

这由 ASP.Net 创建的 onkeypress 方法提供支持。

当页面加载时，IE 和 Firefox 都会突出显示 Button2（如您所愿）。

如果您知道哪个按钮将被声明为默认按钮，则可以使用通常用于为所有浏览器设置样式的 CSS。

相当烦人的是，当您聚焦任一文本框时，IE 会（错误地）突出显示 Button1。

这是因为 IE 的默认行为被 ASP.Net 发出的一些 javascript 覆盖：

```
<script type="text/javascript">
//<![CDATA[
WebForm_AutoFocus('Button2');//]]>
</script> 
```

但是，一旦另一个元素获得焦点，IE 就会忽略这一点，并返回突出显示错误的按钮（除非用户在此示例中明确单击它，否则不会使用该按钮）。

除了用图像按钮替换它们之外，我不确定我还能建议什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-14T12:44:07.313

解决此问题的一种方法是在表单顶部创建一个虚拟按钮并将其移出视线。然后在 javascript 中处理 enter keycode 并使用 css 设置新的默认按钮的样式。

不过感觉很脏。有更好的想法吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-04-19T10:16:54.117

使用这些 CSS 样式中的任何一个

```
a:active, a:focus,input, input:active, input:focus{     outline: 0;     outline-style:none;     outline-width:0; }  
a:active, a:focus,button::-moz-focus-inner, input[type="reset"]::-moz-focus-inner, input[type="button"]::-moz-focus-inner, input[type="submit"]::-moz-focus-inner, input[type="file"] > input[type="button"]::-moz-focus-inner 
{     border: none; } 
```

或者

```
:focus {outline:none;} ::-moz-focus-inner {border:0;} 
```

CSS Style 部分完成后，您可能还需要设置 IE-Emulator。更新您的 Web 应用程序 web.config 文件并包含以下密钥。

```
 <system.webServer>
    <httpProtocol>
      <customHeaders>
        <clear />
        <add name="X-UA-Compatible" value="IE=7; IE=9; IE=8; IE=5;" />
      </customHeaders>
    </httpProtocol>

  </system.webServer> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T11:36:48.867

如果您使用的是 .Net 2 [，这](http://msdn.microsoft.com/en-us/library/system.web.ui.htmlcontrols.htmlform.defaultfocus(VS.80).aspx)可能会对您有所帮助

> ...使用 DefaultFocus 属性访问窗体上的控件，以便在加载 HtmlForm 控件时显示为具有输入焦点的控件。**可以选择的控件会显示一个视觉提示，表明它们具有焦点**。例如，带有焦点的 TextBox 控件显示时插入点位于其中。...

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-14T11:28:05.843

为这个按钮定义一个特定的 CSS 样式（或类）怎么样？

```
<input type="button" value="basic button" .../>
<input type="button" style="border: solid 2px red;" value="default button" .../> 
```

# c++ - 为什么函数不能完全执行？

> ID：442550
> 
> 赞同：0
> 
> 时间：2009-01-14T10:31:05.130
> 
> 标签：c++, callback

当我尝试调试以下函数段时，执行在 pCellTower->m_pCellTowerInfo = pCellInfo 行停止（跳出函数）：

```
RILCELLTOWERINFO* pCellInfo = (RILCELLTOWERINFO*)lpData;

CCellTower *pCellTower = (CCellTower*)cbData;
if(pCellTower != NULL)
{
    pCellTower->m_pCellTowerInfo = pCellInfo;
} 
```

（指针 pCellInfo 未设置）

然后我试图评论这一行：

```
RILCELLTOWERINFO* pCellInfo = (RILCELLTOWERINFO*)lpData;

CCellTower *pCellTower = (CCellTower*)cbData;
if(pCellTower != NULL)
{
    //pCellTower->m_pCellTowerInfo = pCellInfo;
} 
```

这样函数就可以正常执行了。

有谁知道可能出了什么问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T10:36:40.830

最可能的解释是 pCellTower 也没有设置。它可能包含随机位，并最终指向分配给您的应用程序的内存之外。操作系统不允许您的程序在分配给它的空间之外进行写入，因此它会向程序发送某种消息（Windows：异常，Unix/Linux：信号），表明写入被拒绝。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T10:42:42.860

如果您向后追溯 cbData 值的来源，您可能会发现它是一个未初始化的随机值。

# moss - MOSS 前端 (IIS) 负载平衡如何工作？

> ID：442555
> 
> 赞同：0
> 
> 时间：2009-01-14T10:33:17.013
> 
> 标签：moss, load-balancing

我想知道 MOSS 前端负载平衡是如何工作的，只是概述或指向包含此类信息的站点的链接。

换句话说，我在场中有 2 台前端服务器，MOSS 是如何分配工作负载的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T11:09:27.410

很抱歉让您失望了，但我刚刚被告知 MOSS 本身不会进行任何负载平衡，您需要在 MOSS 之外自行设置。

MOSS 前端场仅在彼此之间同步 IIS 内容 - 这是由 MOSS 提供的

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T21:41:16.993

MOSS 存在于 Windows 2003 或 2008 服务器上。您可以在 Web 前端的操作系统中启用 NLB 服务。我不记得支持它的操作系统版本，但肯定是企业版和数据中心版......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-05T13:21:54.587

所有服务器版本都支持 NLB（网络负载平衡）。实际上有三种方法可以实现负载平衡。

*   您可以使用 DNS 通过为同一个 FQDN 分配不同的 IP 地址来将用户指向不同的 WFE。这是 5 分钟负载平衡解决方案。
*   第二种解决方案是使用windows版本的网络负载均衡。这是更强大的负载平衡版本，因为它考虑了 WFE 上的实际负载。如果一个 WFE 正在处理大量请求流量，则将转到另一个框。如果一个盒子出现故障，此解决方案还可以提供故障转移。DNS 解决方案没有。
*   第三种解决方案是在 WFE 前使用负载平衡器，例如 cisco 或 F5 负载平衡器。这是具有许多 WFE 的农场的解决方案。

下一个问题是如何知道负载平衡是否正在发生。我为 sharepoint 编写了一个 webpart，您可以将其添加到任何页面，告诉您哪个服务器正在为该页面提供服务。如果您的负载平衡正常工作，您应该在向同一页面发出请求时看到服务器名称发生变化。

您可以在此处获取 Web 部件：[Sharepoint 服务器信息 Web 部件](http://spsiwp.codeplex.com/)

# xml - 规格。用于 JUnit XML 输出

> ID：442556
> 
> 赞同：92
> 
> 时间：2009-01-14T10:33:43.020
> 
> 标签：xml, unit-testing, junit

在哪里可以找到 JUnit 的 XML 输出规范。我的目标是编写一个生成类似 JUnit 的输出的 UnitTest++ XML 报告器。

请参阅：“[无法让 hudson 解析 JUnit 测试输出 XML](https://stackoverflow.com/questions/428553/unable-to-get-hudson-to-parse-junit-test-output-xml) ”和“ [Hudson、C++ 和 UnitTest++](https://stackoverflow.com/questions/411218/hudson-c-and-unittest) ”

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2011-02-07T20:17:48.830

[您可以在https://github.com/windyroad/JUnit-Schema](https://github.com/windyroad/JUnit-Schema)找到基于 Apache Ant 1.8.2 中的代码的 XSD

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-08-31T10:08:45.867

xml 输出不是由 JUnit（至少不是 junit.jar）生成的，而是由 junit ant 任务生成的。
相关类是[org.apache.tools.ant.taskdefs.optional.junit.XMLJUnitResultFormatter](http://svn.apache.org/repos/asf/ant/core/trunk/src/main/org/apache/tools/ant/taskdefs/optional/junit/XMLJUnitResultFormatter.java)。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-05T14:44:23.557

[我在http://ant.1045680.n5.nabble.com/schema-for-junit-xml-output-td1375274.html](http://ant.1045680.n5.nabble.com/schema-for-junit-xml-output-td1375274.html)找到了一些非正式规范

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-05-01T04:16:05.447

正如其他人提到的那样，xml 由 ANT 而非 jUnit 处理

[这](http://junitpdfreport.sourceforge.net/managedcontent/PdfTranslation)是我见过的最好的规格。从[这个](http://www.junit.org/node/399)帖子

* * *

## 回答 #5

> 赞同：-6
> 
> 时间：2009-01-19T11:15:08.070

I can only give you an general information.

In the [sourcecode of JUnit](http://sourceforge.net/project/showfiles.php?group_id=15278&package_id=12472), you will find your information. If you provide some more information, I can help you further. My personal hint for finding your specification would be `junit.framework.TestResult`.

Good luck!

# wpf - 混合 WPF、LinqToSql 和多线程是个坏主意吗？

> ID：442560
> 
> 赞同：1
> 
> 时间：2009-01-14T10:36:33.840
> 
> 标签：wpf, multithreading, linq-to-sql

[我的情况与这个人](http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=3227644&SiteID=1)大致相似，只是我现在不需要更改通知

我有一个显示层次结构的 WPF 应用程序。使用 LinqToSql 查询检索每个节点的子节点。当有一个线程时，该应用程序可以完美运行。

现在我想让事情变得更快......通过异步加载孩子。触发一个线程，进行数据库提取，完成后为子节点创建相应的树节点。

```
<HierarchicalDataTemplate DataType="{x:Type viewmodels:NodeDM}" ItemsSource="{Binding Path=Children}"> 
```

经过昨天的一番折腾，我发现 WPF 数据绑定通过绑定上的`IsAsync`属性允许这样做。所以我做了以下更改

```
<HierarchicalDataTemplate .. ItemsSource="{Binding Path=Children, IsAsync=True}"> 
```

现在它的混乱，在异常发生骚乱之前，最初的一堆节点通过了火。在这里粘贴第一个...

```
System.Windows.Data Error: 16 : Cannot get 'Children' value (type 'ObservableCollection`1') from '' (type 'NodeDM'). BindingExpression:Path=Children; DataItem='NodeDM' (HashCode=29677729); target element is 'TreeViewItem' (Name=''); target property is 'ItemsSource' (type 'IEnumerable') TargetInvocationException:'System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation. ---> System.InvalidCastException: Specified cast is not valid.
   at System.Data.SqlClient.SqlBuffer.get_Int32()
   at System.Data.SqlClient.SqlBuffer.get_Value()
   at System.Data.SqlClient.SqlDataReader.GetValueInternal(Int32 i)
   <snipped around 20-30 lines>
   at System.Data.Linq.Table`1.GetEnumerator()
   at System.Data.Linq.Table`1.System.Collections.Generic.IEnumerable<TEntity>.GetEnumerator()
   at System.Linq.Lookup`2.CreateForJoin(IEnumerable`1 source, Func`2 keySelector, IEqualityComparer`1 comparer)
   at System.Linq.Enumerable.<JoinIterator>d__61`4.MoveNext()
   at System.Linq.Enumerable.WhereSelectEnumerableIterator`2.MoveNext()
   at ICTemplates.Models.NodeDM.Load_Children()
   at ICTemplates.Models.NodeDM.get_Children() 
```

其他包括

```
System.InvalidOperationException: There is already an open DataReader associated with this Command which must be closed first. 
```

我有一棵变形的树，其中一些节点无法加载。我有一个强大的 LinqToSql DataContext 类的**单例实例，它与数据库对话。**所以我尝试设置一个锁，以便多个工作线程不会同时访问它......但没有运气。

```
partial class Node
{
  public IEnumerable<Segment> Children
  {
    lock (MyDatabaseDataContext.m_lockObject)
    {
      return // LINQ Query to join 2 tables and return a result
    }
  } 
```

恢复 IsAsync 更改会使一切恢复正常。为什么 IsAsync 属性会弄乱 LinqToSql ？WPF Treeview 足以让正常人拔头发。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-14T10:46:06.350

您的问题似乎来自使用相同的连接对象进行读取。当你有同步数据访问时，如果你记得在读取之间打开/关闭，一个连接通常就足够了。您可以更改您的 GetChildren 代码以在每次调用时创建新的连接（和命令/数据读取器等），这样多个线程就不会互相踩踏。此外，如果结果以某种结构缓存在内存中，请尝试使用锁同步对该结构的访问。您不希望一个线程尝试枚举您的元素，而另一个线程尝试添加新元素。

# .net - 本地化 WinForms 时如何为 VS2008 创建翻译库？

> ID：442562
> 
> 赞同：4
> 
> 时间：2009-01-14T10:37:09.143
> 
> 标签：.net, visual-studio-2008, localization, repository

当我在VS2008中将翻译后的字符串写入表单**`resx`**文件时，有没有类似翻译库的东西？这在我以前的 C++ Builder 时代非常有帮助。这就是我当时所做的，也是我想在 VS2008 中完成的：

*   将一种形式的“取消”翻译成德语“ **`Abbrechnen`**”

*   将此翻译添加到存储库，因为该词在大多数形式中重复

*   当我开始翻译另一种形式时，我只是从存储库中读取所有本地化字符串，因此“取消”等常见文本会自动翻译。

*   我仅手动更改存储库中未找到的那些字符串

VS2008有类似的吗？

# java - 在 Java 中避免同步（this）？

> ID：442564
> 
> 赞同：394
> 
> 时间：2009-01-14T10:37:54.120
> 
> 标签：java, multithreading, synchronization, synchronized

每当 SO 上出现关于 Java 同步的问题时，有些人非常急切地指出`synchronized(this)`应该避免这种情况。相反，他们声称，锁定私人参考是首选。

一些给定的原因是：

*   [一些*邪恶的代码*可能会偷走你的锁](https://stackoverflow.com/questions/416183/in-java-critical-sections-what-should-i-synchronize-on#416198)（这个很流行，也有一个“意外”变体）
*   [同一个类中的所有同步方法都使用完全相同的锁，这会降低吞吐量](https://stackoverflow.com/questions/309631/what-cases-require-synchronized-method-access-in-java#309677)
*   [你（不必要地）暴露了太多信息](https://stackoverflow.com/questions/439302/allowing-a-method-to-lock-its-parent-object-in-java#439317)

包括我在内的其他人认为，这`synchronized(this)`是一个经常使用的习语（也在 Java 库中），它是安全且易于理解的。不应该避免它，因为您有一个错误并且您不知道多线程程序中发生了什么。换句话说：如果它适用，那么就使用它。

我有兴趣看到一些现实世界的例子（没有 foobar 的东西），在这些例子中，避免锁定在也能完成这项工作`this`时更可取。`synchronized(this)`

因此：**您是否应该始终避免`synchronized(this)`并用锁定私人参考来代替它？**

* * *

一些进一步的信息（在给出答案时更新）：

*   我们正在谈论实例同步
*   隐式（`synchronized`方法）和显式形式`synchronized(this)`都被考虑
*   如果您引用 Bloch 或其他有关该主题的权威，请不要遗漏您不喜欢的部分（例如 Effective Java，关于线程安全的项目：*通常是实例本身的锁，但也有例外。）*
*   如果您需要除`synchronized(this)`提供之外的锁定粒度，`synchronized(this)`则不适用，因此这不是问题

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2009-01-14T11:05:41.177

我将分别介绍每一点。

1.  > 一些邪恶的代码可能会偷走你的锁（这个很流行，也有一个“意外”变体）

    我更担心*不小心*。它的意思是，这种使用`this`是你的类公开接口的一部分，应该记录在案。有时需要其他代码使用您的锁的能力。这对于诸如`Collections.synchronizedMap`（参见 javadoc）之类的事情是正确的。

2.  > 同一类中的所有同步方法都使用完全相同的锁，这会降低吞吐量

    这是过于简单化的想法；仅仅摆脱`synchronized(this)`并不能解决问题。吞吐量的适当同步需要更多考虑。

3.  > 您（不必要地）暴露了太多信息

    这是#1 的变体。使用`synchronized(this)`是您界面的一部分。如果你不想/不需要这个暴露，不要这样做。

* * *

## 回答 #2

> 赞同：89
> 
> 时间：2009-01-14T10:42:57.277

嗯，首先应该指出的是：

```
public void blah() {
  synchronized (this) {
    // do stuff
  }
} 
```

在语义上等价于：

```
public synchronized void blah() {
  // do stuff
} 
```

这是不使用的原因之一`synchronized(this)`。`synchronized(this)`你可能会争辩说你可以在街区周围做些事情。通常的原因是尽量避免进行同步检查，这会导致各种并发问题，特别是[双重检查锁定问题](http://en.wikipedia.org/wiki/Double-checked_locking)，这只是说明进行相对简单的检查是多么困难线程安全。

私有锁是一种防御机制，这绝不是一个坏主意。

此外，正如您所提到的，私有锁可以控制粒度。对一个对象的一组操作可能与另一组完全无关，但`synchronized(this)`会相互排斥对所有对象的访问。

`synchronized(this)`只是真的没有给你任何东西。

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2009-01-14T11:23:27.273

当您使用 synchronized(this) 时，您将类实例用作锁本身。这意味着当*线程 1*获取锁时，*线程 2*应该等待。

假设以下代码：

```
public void method1() {
    // do something ...
    synchronized(this) {
        a ++;      
    }
    // ................
}

public void method2() {
    // do something ...
    synchronized(this) {
        b ++;      
    }
    // ................
} 
```

方法一修改变量*a*和方法二修改变量*b*，应该避免两个线程同时修改同一个变量，确实如此。但是当*thread1*修改*a*和*thread2*修改*b*时，它可以在没有任何竞争条件的情况下执行。

不幸的是，上面的代码不允许这样做，因为我们对锁使用相同的引用；这意味着即使线程不处于竞争状态也应该等待，显然代码会牺牲程序的并发性。

*解决方案是对两个*不同的变量使用*2 个*不同的锁：

 *```
public class Test {

    private Object lockA = new Object();
    private Object lockB = new Object();

    public void method1() {
        // do something ...
        synchronized(lockA) {
            a ++;      
        }
        // ................
    }

    public void method2() {
        // do something ...
        synchronized(lockB) {
            b ++;      
        }
        // ................
    }

} 
```

上面的示例使用了更细粒度的锁（2 个锁而不是一个（变量*a*和*b分别为**lockA* 和*lockB*），因此允许更好的并发性，另一方面它变得比第一个示例更复杂......

 *** * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-01-14T12:27:35.660

虽然我同意不要盲目遵守教条规则，但“偷锁”场景对你来说是否如此古怪？一个线程确实可以“从外部”（`synchronized(theObject) {...}`）获取对象上的锁，从而阻塞等待同步实例方法的其他线程。

如果您不相信恶意代码，请考虑此代码可能来自第三方（例如，如果您开发某种应用程序服务器）。

“意外”版本似乎不太可能，但正如他们所说，“做出一些防白痴的东西，有人会发明一个更好的白痴”。

所以我同意这取决于班级做什么学派的思想。

* * *

**编辑以下 eljenso 的前 3 条评论：**

我从来没有遇到过锁盗问题，但这是一个想象的场景：

假设您的系统是一个 servlet 容器，而我们正在考虑的对象是`ServletContext`实现。它的`getAttribute`方法必须是线程安全的，因为上下文属性是共享数据；所以你将它声明为`synchronized`. 我们还假设您基于容器实现提供公共托管服务。

我是您的客户，在您的站点上部署我的“好”servlet。碰巧我的代码包含对`getAttribute`.

伪装成另一个客户的黑客在您的站点上部署了他的恶意 servlet。它在方法中包含以下代码`init`：

```
同步 (this.getServletConfig().getServletContext()) {
   而（真）{}
}

```

假设我们共享相同的 servlet 上下文（只要两个 servlet 位于同一虚拟主机上，规范就允许），我的调用`getAttribute`将永远锁定。黑客在我的 servlet 上实现了 DoS。

如果在私有锁上同步，这种攻击是不可能`getAttribute`的，因为第 3 方代码无法获取此锁。

我承认这个例子是人为的，并且对 servlet 容器如何工作的看法过于简单，但恕我直言，它证明了这一点。

所以我会根据安全考虑做出我的设计选择：我是否可以完全控制可以访问实例的代码？线程无限期地持有一个实例的锁会产生什么后果？

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2016-09-11T17:26:49.993

这取决于实际情况。
如果只有一个或多个共享实体。

**[在此处](https://github.com/rohitksingh/Multi-Threading)**查看完整的工作示例****

 **一个小小的介绍。

**线程和可共享实体**
多个线程可以访问同一个实体，例如多个连接线程共享一个消息队列。由于线程同时运行，因此可能有机会覆盖另一个数据，这可能是一个混乱的情况。
因此，我们需要某种方法来确保一次只能由一个线程访问可共享实体。（并发）。

**同步块**
synchronized() 块是一种保证可共享实体并发访问的方法。
首先，一个小类
比假设有两个人P1，P2（线程）一个洗脸盆（共享实体）在洗手间内，并且有一个门（锁）。
现在我们希望一个人一次使用洗脸盆。
一种方法是在门被锁时由 P1 锁门 P2 等到 p1 完成他的工作
P1 解锁门
然后只有 p1 可以使用洗脸盆。

句法。

```
synchronized(this)
{
  SHARED_ENTITY.....
} 
```

“this”提供了与类关联的内在锁（Java 开发人员以这样一种方式设计了 Object 类，即每个对象都可以用作监视器）。当只有一个共享实体和多个线程（1：N）时，上述方法可以正常工作。**N 个可共享实体-M 个线程** 现在想一个情况，一个洗手间里有两个洗脸盆，只有一个门。如果我们使用前面的方法，那么一次只有 p1 可以使用一个脸盆，而 p2 将在外面等待。这是资源的浪费，因为没有人使用 B2（洗脸盆）。 更明智的方法是在洗手间内创建一个较小的房间，并为每个洗脸盆提供一扇门。这样，P1 可以访问 B1，P2 可以访问 B2，反之亦然。
[![在此处输入图像描述](https://i.stack.imgur.com/jrbvI.png)](https://i.stack.imgur.com/jrbvI.png)

 **```
washbasin1;  
washbasin2;

Object lock1=new Object();
Object lock2=new Object();

  synchronized(lock1)
  {
    washbasin1;
  }

  synchronized(lock2)
  {
    washbasin2;
  } 
```

[![在此处输入图像描述](https://i.stack.imgur.com/jqavZ.png)](https://i.stack.imgur.com/jqavZ.png)
[![在此处输入图像描述](https://i.stack.imgur.com/Xeydw.png)](https://i.stack.imgur.com/Xeydw.png)

**在线程上查看更多信息**---->[在这里](https://github.com/rohitksingh/Multi-Threading/wiki)

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2009-01-14T12:31:42.237

**C# 和 Java 阵营对此似乎有不同的共识。** 我见过的大多数 Java 代码都使用：

```
// apply mutex to this instance
synchronized(this) {
    // do work here
} 
```

而大多数 C# 代码选择更安全的：

```
// instance level lock object
private readonly object _syncObj = new object();

...

// apply mutex to private instance level field (a System.Object usually)
lock(_syncObj)
{
    // do work here
} 
```

C# 习惯用法当然更安全。如前所述，不能从实例外部对锁进行恶意/意外访问。Java 代码也有这种风险，**但随着时间的推移，Java 社区似乎已经倾向于安全性稍差但更简洁的版本。**

这并不是对 Java 的挖掘，只是反映了我在这两种语言上工作的经验。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-01-14T14:34:47.823

该`java.util.concurrent`软件包大大降低了我的线程安全代码的复杂性。我只有轶事证据可以继续，但我见过的大多数工作`synchronized(x)`似乎是重新实现锁、信号量或锁存器，但使用较低级别的监视器。

考虑到这一点，使用这些机制中的任何一种进行同步都类似于在内部对象上进行同步，而不是泄漏锁。这是有益的，因为您可以绝对确定您通过两个或更多线程控制进入监视器。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2016-04-18T11:05:24.450

1.  如果可能，使您的数据不可变（`final`变量）
2.  如果您无法避免跨多个线程共享数据的突变，请使用高级编程结构 [例如粒度 `Lock`API]

> 锁提供对共享资源的独占访问：一次只有一个线程可以获取锁，并且对共享资源的所有访问都需要先获取锁。

`ReentrantLock`实现`Lock`接口的示例代码

```
 class X {
   private final ReentrantLock lock = new ReentrantLock();
   // ...

   public void m() {
     lock.lock();  // block until condition holds
     try {
       // ... method body
     } finally {
       lock.unlock()
     }
   }
 } 
```

**Lock over Synchronized 的优点（this）**

1.  同步方法或语句的使用强制所有锁的获取和释放以块结构的方式发生。

2.  Lock 实现提供了比使用同步方法和语句的附加功能

    1.  获取锁的非阻塞尝试 ( `tryLock()`)
    2.  尝试获取可被中断的锁 ( `lockInterruptibly()`)
    3.  尝试获取可以超时的锁 ( `tryLock(long, TimeUnit)`)。
3.  Lock 类还可以提供与隐式监视器锁完全不同的行为和语义，例如

    1.  保证订购
    2.  不可重入使用
    3.  死锁检测

看看这个关于各种类型的 SE 问题`Locks`：

[同步与锁定](https://stackoverflow.com/questions/4201713/synchronization-vs-lock)

您可以通过使用高级并发 API 而不是同步块来实现线程安全。该文档[页面](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Lock.html)提供了良好的编程结构来实现线程安全。

[***锁定对象***](https://docs.oracle.com/javase/tutorial/essential/concurrency/newlocks.html)支持简化许多并发应用程序的锁定习惯用法。

[**执行器**](https://docs.oracle.com/javase/tutorial/essential/concurrency/executors.html)定义了一个用于启动和管理线程的高级 API。java.util.concurrent 提供的执行器实现提供了适合大规模应用的线程池管理。

[**并发集合**](https://docs.oracle.com/javase/tutorial/essential/concurrency/collections.html)使管理大型数据集合变得更加容易，并且可以大大减少同步的需要。

[**原子变量**](https://docs.oracle.com/javase/tutorial/essential/concurrency/atomicvars.html)具有最小化同步并有助于避免内存一致性错误的功能。

***[ThreadLocalRandom](https://docs.oracle.com/javase/tutorial/essential/concurrency/threadlocalrandom.html)***（在 JDK 7 中）提供了从多个线程高效地生成伪随机数。

有关其他编程结构，请参阅[java.util.concurrent](https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/package-summary.html)和[java.util.concurrent.atomic](https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/atomic/package-summary.html)包。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-01-14T14:59:48.193

如果您已经决定：

*   您需要做的是锁定当前对象；和
*   您想以小于整个方法的粒度锁定它；

然后我看不到 synchronizezd(this) 的禁忌。

有些人故意在方法的全部内容中使用 synchronized(this)（而不是将方法标记为已同步），因为他们认为“读者更清楚”实际上正在同步哪个对象。只要人们做出明智的选择（例如，了解这样做实际上是在方法中插入了额外的字节码，这可能会对潜在的优化产生连锁反应），我并不认为这有什么问题. 你应该总是记录你的程序的并发行为，所以我不认为“'同步'发布行为”论点如此引人注目。

**至于你应该使用哪个对象的锁的问题，我认为如果你正在做的事情的逻辑以及你的类通常如何使用是可以预期的，那么**在当前对象上进行同步是没有错的。例如，对于集合，您在逻辑上期望锁定的对象通常是集合本身。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2014-11-04T09:11:07.387

我认为在 Brian Goetz 所著的《Java Concurrency In Practice》一书中，有一个很好的解释为什么这些技术都是你掌握的重要技术。他非常清楚地说明了一点——你必须使用相同的锁“EVERYWHERE”来保护你的对象的状态。同步方法和对象上的同步通常是齐头并进的。例如，Vector 同步它的所有方法。如果您有一个向量对象的句柄并且要执行“如果不存在则放置”，那么仅仅 Vector 同步它自己的各个方法并不能保护您免受状态损坏。您需要使用 synchronized (vectorHandle) 进行同步。这将导致每个拥有向量句柄的线程都获取相同的锁，并将保护向量的整体状态。这称为客户端锁定。事实上，我们知道向量确实同步（this）/同步其所有方法，因此在对象 vectorHandle 上同步将导致向量对象状态的正确同步。仅仅因为您使用线程安全集合就相信您是线程安全的，这是愚蠢的。这正是 ConcurrentHashMap 显式引入 putIfAbsent 方法的原因——使此类操作具有原子性。

总之

1.  在方法级别同步允许客户端锁定。
2.  如果您有一个私有锁定对象 - 它会使客户端锁定成为不可能。如果您知道您的课程没有“如果不存在则放置”类型的功能，这很好。
3.  如果您正在设计一个库 - 那么在此同步或同步该方法通常更明智。因为你很少能够决定如何使用你的类。
4.  如果 Vector 使用了私有锁对象 - 就不可能正确地“放置如果不存在”。客户端代码永远不会获得私有锁的句柄，从而破坏了使用 EXACT SAME LOCK 保护其状态的基本规则。
5.  正如其他人指出的那样，在此或同步方法上同步确实存在问题 - 有人可能会获得锁而永远不会释放它。所有其他线程将继续等待锁被释放。
6.  所以知道你在做什么，并采用正确的那个。
7.  有人争辩说，拥有私有锁对象可以为您提供更好的粒度 - 例如，如果两个操作不相关 - 它们可以由不同的锁保护，从而提高吞吐量。但我认为这是设计气味而不是代码气味 - 如果两个操作完全不相关，为什么它们是 SAME 类的一部分？一个班级俱乐部为什么要完全不相关的功能？可能是实用程序类？嗯 - 一些通过同一实例提供字符串操作和日历日期格式的工具？……至少对我没有任何意义！！

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-01-14T10:50:44.640

不，你不应该*总是*。但是，当对特定对象有多个关注点时，我倾向于避免它，而这些关注点只需要相对于它们自身是线程安全的。例如，您可能有一个具有“标签”和“父”字段的可变数据对象；这些需要是线程安全的，但更改一个不需要阻止另一个被写入/读取。（实际上，我会通过声明字段 volatile 和/或使用 java.util.concurrent 的 AtomicFoo 包装器来避免这种情况）。

一般来说，同步有点笨拙，因为它会锁定一个大锁，而不是准确地考虑如何允许线程相互工作。使用`synchronized(this)`更加笨拙和反社会，因为它是在说“当我持有锁时，没有人可以改变这门课上的*任何东西”。*您实际上需要多久执行一次？

我宁愿拥有更细粒度的锁；即使您确实想阻止一切更改（也许您正在序列化对象），您也可以获取所有锁来实现相同的目的，而且这种方式更加明确。当您使用`synchronized(this)`时，不清楚您要同步的确切原因，或者可能有什么副作用。如果您使用`synchronized(labelMonitor)`，甚至更好`labelLock.getWriteLock().lock()`，很清楚您在做什么以及您的关键部分的影响仅限于什么。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-01-14T11:04:53.893

**简短回答**：您必须了解差异并根据代码做出选择。

**长答案**：一般来说，我宁愿尽量避免*synchronize(this)*以减少争用，但私有锁会增加您必须注意的复杂性。因此，为正确的工作使用正确的同步。如果您对多线程编程没有那么丰富的经验，我宁愿坚持实例锁定并阅读该主题。（也就是说：仅使用*synchronize(this)*并不会自动使您的类完全线程安全。）这不是一个简单的话题，但是一旦您习惯了它，是否使用*synchronize(this)*的答案就很自然了.

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-11-20T07:43:42.890

锁用于*可见性*或保护某些数据免受可能导致竞争的*并发修改。*

当您只需要使原始类型操作成为原子操作时，可以使用诸如此类`AtomicInteger`的选项。

但是假设您有两个彼此相关的整数，`x`它们`y`相互关联，并且应该以原子方式更改。然后，您将使用相同的锁保护它们。

锁应该只保护彼此相关的状态。不多也不少。如果`synchronized(this)`在每个方法中使用，那么即使类的状态不相关，即使更新不相关的状态，所有线程也将面临争用。

```
class Point{
   private int x;
   private int y;

   public Point(int x, int y){
       this.x = x;
       this.y = y;
   }

   //mutating methods should be guarded by same lock
   public synchronized void changeCoordinates(int x, int y){
       this.x = x;
       this.y = y;
   }
} 
```

在上面的示例中，我只有一种方法可以同时改变两种不同的方法`x`，`y`而不是两种不同的方法，`x`并且`y`如果我分别给出了两种不同的变异方法，`x`那么`y`它就不是线程安全的。

这个例子只是为了演示而不一定是它应该实现的方式。最好的方法是使它成为***IMMUTABLE***。

现在与示例相反，@Andreas 已经提供了`Point`一个示例，`TwoCounters`其中状态受两个不同的锁保护，因为状态彼此无关。

使用不同锁保护不相关状态的过程称为*Lock Striping 或 Lock Splitting*

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-02-20T06:26:52.887

不同步的原因*是*有时您需要多个锁（第二个锁通常在经过一些额外思考后被移除，但您仍然需要它处于中间状态）。如果你锁上*这个*，你总是要记住这两个锁中的哪*一个*；如果你锁定一个私有对象，变量名会告诉你。

从读者的角度来看，如果您看到锁定*this*，您总是必须回答两个问题：

1.  什么样的访问*受此*保护？
2.  一把锁真的够用吗，不是有人介绍bug吗？

一个例子：

```
class BadObject {
    private Something mStuff;
    synchronized setStuff(Something stuff) {
        mStuff = stuff;
    }
    synchronized getStuff(Something stuff) {
        return mStuff;
    }
    private MyListener myListener = new MyListener() {
        public void onMyEvent(...) {
            setStuff(...);
        }
    }
    synchronized void longOperation(MyListener l) {
        ...
        l.onMyEvent(...);
        ...
    }
} 
```

如果两个线程`longOperation()`在 的两个不同实例上开始`BadObject`，它们将获取它们的锁；当调用的时候`l.onMyEvent(...)`，我们有一个死锁，因为两个线程都不能获取另一个对象的锁。

在这个例子中，我们可以通过使用两个锁来消除死锁，一个用于短操作，一个用于长操作。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-07-16T08:50:32.087

正如这里已经说过的，同步块可以使用用户定义的变量作为锁对象，当同步函数只使用“this”时。当然，您可以使用应该同步的功能区域等进行操作。

但是每个人都说同步函数和使用“this”作为锁定对象覆盖整个函数的块之间没有区别。这不是真的，区别在于两种情况下都会生成的字节码。在同步块使用的情况下，应分配局部变量，该变量包含对“this”的引用。结果，我们将拥有更大的函数大小（如果您只有少数函数，则不相关）。

您可以在此处找到有关差异的更详细说明： [http ://www.artima.com/insidejvm/ed2/threadsynchP.html](http://www.artima.com/insidejvm/ed2/threadsynchP.html)

由于以下观点，同步块的使用也不好：

> synchronized 关键字在一个方面非常有限：退出同步块时，所有等待该锁的线程必须解除阻塞，但只有其中一个线程获得锁；所有其他人都看到锁定已被占用并返回阻塞状态。这不仅仅是浪费了大量的处理周期：通常，解除阻塞线程的上下文切换还涉及从磁盘分页内存，这是非常非常昂贵的。

有关这方面的更多详细信息，我建议您阅读这篇文章：http: [//java.dzone.com/articles/synchronized-considered](http://java.dzone.com/articles/synchronized-considered)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2018-10-29T08:38:01.853

这实际上只是对其他答案的补充，但是如果您对使用私有对象进行锁定的主要反对意见是它使您的类与与业务逻辑无关的字段变得混乱，那么 Project Lombok 必须[`@Synchronized`](https://projectlombok.org/features/Synchronized)在编译时生成样板：

```
@Synchronized
public int foo() {
    return 0;
} 
```

编译为

```
private final Object $lock = new Object[0];

public int foo() {
    synchronized($lock) {
        return 0;
    }
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-14T11:16:20.093

这取决于您要执行的任务，但我不会使用它。另外，首先检查您想要完成的线程保存是否无法通过 synchronize(this) 完成？API中还有一些不错的[锁](http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/package-summary.html)可能会对您有所帮助:)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-07-13T12:38:54.900

使用 synchronized(this) 的一个很好的例子。

```
// add listener
public final synchronized void addListener(IListener l) {listeners.add(l);}
// remove listener
public final synchronized void removeListener(IListener l) {listeners.remove(l);}
// routine that raise events
public void run() {
   // some code here...
   Set ls;
   synchronized(this) {
      ls = listeners.clone();
   }
   for (IListener l : ls) { l.processEvent(event); }
   // some code here...
} 
```

正如您在此处看到的，我们在此使用 synchronize 以轻松地与那里的一些同步方法进行长时间（可能是 run 方法的无限循环）的协作。

当然，在私有字段上使用同步可以很容易地重写它。但有时，当我们已经设计了一些带有同步方法的设计（即，我们派生自遗留类时，synchronized(this) 可能是唯一的解决方案）。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-11-18T09:17:06.277

我只想提一个可能的解决方案，用于在没有依赖关系的代码的原子部分中实现唯一私有引用。您可以使用带锁的静态 Hashmap 和名为 atomic() 的简单静态方法，该方法使用堆栈信息（完整的类名和行号）自动创建所需的引用。然后您可以在同步语句中使用此方法，而无需编写新的锁定对象。

```
// Synchronization objects (locks)
private static HashMap<String, Object> locks = new HashMap<String, Object>();
// Simple method
private static Object atomic() {
    StackTraceElement [] stack = Thread.currentThread().getStackTrace(); // get execution point 
    StackTraceElement exepoint = stack[2];
    // creates unique key from class name and line number using execution point
    String key = String.format("%s#%d", exepoint.getClassName(), exepoint.getLineNumber()); 
    Object lock = locks.get(key); // use old or create new lock
    if (lock == null) {
        lock = new Object();
        locks.put(key, lock);
    }
    return lock; // return reference to lock
}
// Synchronized code
void dosomething1() {
    // start commands
    synchronized (atomic()) {
        // atomic commands 1
        ...
    }
    // other command
}
// Synchronized code
void dosomething2() {
    // start commands
    synchronized (atomic()) {
        // atomic commands 2
        ...
    }
    // other command
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-02-26T00:20:03.457

避免`synchronized(this)`用作锁定机制：这会锁定整个类实例并可能导致死锁。在这种情况下，重构代码以仅锁定特定的方法或变量，这样整个类就不会被锁定。`Synchronised`可以在方法级别使用。
下面的代码没有使用`synchronized(this)`，而是显示了如何锁定一个方法。

```
 public void foo() {
if(operation = null) {
    synchronized(foo) { 
if (operation == null) {
 // enter your code that this method has to handle...
          }
        }
      }
    } 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-07-17T06:21:31.103

尽管这个问题本可以解决，但我在 2019 年的两分钱。

如果您知道自己在做什么，那么锁定“this”还不错，但是在幕后锁定“this”是（不幸的是，方法定义中的同步关键字允许这样做）。

如果您确实希望您的类的用户能够“窃取”您的锁（即阻止其他线程处理它），您实际上希望所有同步方法在另一个同步方法运行时等待，等等。它应该是有意的和深思熟虑的（因此记录在案以帮助您的用户理解它）。

更详细地说，相反，如果您锁定不可访问的锁（没有人可以“偷”您的锁，您完全可以控制等等，那么您必须知道您正在“获得”（或“失去”）什么。 ..)。

对我来说，问题是方法定义签名中的 synchronized 关键字让程序员很容易**不去考虑**要锁定什么，如果你不想在 multi -线程程序。

不能说“通常”您不希望您班级的用户能够做这些事情，或者“通常”您想要......这取决于您正在编码的功能。您无法制定拇指规则，因为您无法预测所有用例。

例如，考虑使用内部锁的 printwriter，但是如果他们不希望他们的输出交错，那么人们很难从多个线程中使用它。

您的锁是否可以在类之外访问是您作为程序员的决定，具体取决于类具有什么功能。它是 api 的一部分。例如，您不能从 synchronized(this) 移到 synchronized(provateObjet) 而不冒破坏使用它的代码更改的风险。

注意 1：我知道您可以通过使用显式锁定对象并公开它来实现任何同步（this）“实现”，但我认为如果您的行为有据可查并且您实际上知道锁定“this”的含义，则没有必要。

注意 2：我不同意如果某些代码不小心窃取了您的锁，这是一个错误，您必须解决它的论点。这在某种程度上与说我可以将所有方法公开，即使它们不打算公开也是一样的论点。如果有人“不小心”称我打算成为私有方法，则它是一个错误。为什么首先要启用这个事故！！！如果窃取你的锁的能力对你的班级来说是一个问题，那就不要允许它。就如此容易。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-06-07T19:40:06.143

同步包括 3 个部分：原子性、可见性和排序

同步块是非常粗略的同步级别。它按照您的预期强制执行可见性和排序。但是对于原子性，它并没有提供太多的保护。原子性需要程序的全球知识而不是本地知识。（这使得多线程编程非常困难）

假设我们有一个`Account`具有方法`deposit`和的类`withdraw`。它们都是基于这样的私有锁同步的：

```
class Account {
    private Object lock = new Object();

    void withdraw(int amount) {
        synchronized(lock) {
            // ...
        }
    }

    void deposit(int amount) {
        synchronized(lock) {
            // ...
        }
    }
} 
```

考虑到我们需要实现一个处理传输的更高级别的类，如下所示：

```
class AccountManager {
    void transfer(Account fromAcc, Account toAcc, int amount) {
        if (fromAcc.getBalance() > amount) {
            fromAcc.setBalance(fromAcc.getBalance() - amount);
            toAcc.setBalance(toAcc.getBalance + amount);
        }
    }
} 
```

假设我们现在有 2 个帐户，

```
Account john;
Account marry; 
```

如果`Account.deposit()`和`Account.withdraw()`仅使用内部锁锁定。当我们有 2 个线程工作时，这将导致问题：

```
// Some thread
void threadA() {
    john.withdraw(500);
}

// Another thread
void threadB() {
    accountManager.transfer(john, marry, 100);
} 
```

因为两者都可以同时`threadA`运行`threadB`。并且线程B完成条件检查，线程A退出，线程B再次退出。这意味着即使他的账户没有足够的钱，我们也可以从约翰那里提取 100 美元。这将破坏原子性。

您可能会建议：为什么不添加`withdraw()`and`deposit()`呢`AccountManager`？但是根据这个提议，我们需要创建一个多线程保险箱`Map`，将不同帐户映射到它们的锁。我们需要在执行后删除锁（否则会泄漏内存）。我们还需要确保没有其他人`Account.withdraw()`直接访问。这将引入许多微妙的错误。

正确和最惯用的方法是在`Account`. 并让`AccountManager`使用锁。但是在这种情况下，为什么不直接使用对象本身呢？

```
class Account {
    synchronized void withdraw(int amount) {
        // ...
    }

    synchronized void deposit(int amount) {
        // ...
    }
}

class AccountManager {
    void transfer(Account fromAcc, Account toAcc, int amount) {
        // Ensure locking order to prevent deadlock
        Account firstLock = fromAcc.hashCode() < toAcc.hashCode() ? fromAcc : toAcc;
        Account secondLock = fromAcc.hashCode() < toAcc.hashCode() ? toAcc : fromAcc;

        synchronized(firstLock) {
            synchronized(secondLock) {
                if (fromAcc.getBalance() > amount) {
                    fromAcc.setBalance(fromAcc.getBalance() - amount);
                    toAcc.setBalance(toAcc.getBalance + amount);
                }
            }
        }
    }
} 
```

简而言之，私有锁不适用于稍微复杂的多线程程序。

（转自[https://stackoverflow.com/a/67877650/474197](https://stackoverflow.com/a/67877650/474197)）

* * *

## 回答 #23

> 赞同：-3
> 
> 时间：2009-01-14T10:43:12.517

我认为第一点（其他人使用您的锁）和第二点（所有方法都不必要地使用相同的锁）可能发生在任何相当大的应用程序中。特别是当开发人员之间没有良好的沟通时。

它不是一成不变的，它主要是一个良好实践和防止错误的问题。

# asp.net - 在 div 中加载 aspx 或调整 iframe 的大小

> ID：442577
> 
> 赞同：1
> 
> 时间：2009-01-14T10:47:54.287
> 
> 标签：asp.net, javascript, iframe, html

我有一个`htm`带有一个`iframe`和一个菜单结构的文件。菜单可以加载一个`htm` 文件`iframe`或一个`aspx`文件。完全没有问题。

但是......现在他们想要`iframe`获取其内容的大小。（因此 中不会有滚动条`iframe`，但您必须滚动整个`htm`文件。）

我没有让这个工作，所以我想我会用 a`div`来解决这个问题。但我无法让`aspx`文件加载到`div`.

所以我被困住了。要么我必须找到一种方法让我的`iframe`成长，要么我必须找到一种方法将`aspx`文件加载到`div`.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-14T11:15:34.993

将远程内容直接放在 div 中将是最简单的，否则您将不得不尝试在页面加载后自动调整 iframe 的大小，之后它甚至可能会改变高度。

要将 HTML 内容从远程源加载到 div 中，您需要查看通过 javascript 向浏览器公开的 XML HTTP 对象。

听起来您对这个概念并不熟悉，所以我建议您使用[jQuery](http://docs.jquery.com/Ajax/jQuery.get#urldatacallbacktype)之类的 Javascript 库来帮助您。

# stored-procedures - 数据访问层的命名约定，尤其是在存储过程的情况下

> ID：442581
> 
> 赞同：0
> 
> 时间：2009-01-14T10:50:56.980
> 
> 标签：stored-procedures, naming-conventions, data-access-layer

假设，我们创建了一个存储过程，它应该检索客户详细信息，并将在某种仪表板视图中使用。由于还有一些与仪表板相关的其他存储过程，人们可能会考虑通过相应地命名来对 SP 进行可视化分组：

*   DASH_GetCustomerDetails
*   短跑_...

现在，如果您使用 .NET 2.0 创建标准 DAL，您肯定会添加强类型数据集并添加一些表适配器。默认情况下，上述 SP 的 TA 将命名为 DASH_GetCustomerDetailsTableAdapter，数据表为 DASH_GetCustomerDetailsDataTable，依此类推。

通常，您将拥有某种高于它们的业务逻辑。它可能被称为类似于 Customer 的东西，它具有一个实例化表适配器的受保护属性和一个 GetDetails 方法，可能最终检索详细信息。或者，您甚至可以将该方法本身设为属性，将其称为 Details，以便表示层可以只说类似 cust.Details 之类的内容。

但是，...我对所有这些命名的东西并不满意。是否有必要能够区分在后台工作的存储过程，以便命名应该反映......是否有任何最佳实践？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T13:01:14.750

我很想从程序的前面删除 DASH。一般来说，程序名称应该反映程序的作用，而不是谁在使用它。

考虑极端情况：

*   `get_all_customers`

对比

*   `get_all_customers_for_dashboard`
*   `get_all_customers_for_invoice_background_job`
*   `get_all_customers_for_ad_hoc_report`
*   ...

您的存储过程被仪表板应用程序的后台部分使用这一事实*与过程本身无关*，并且这样命名它们违反了封装。

如果您编写了另一个需要相同逻辑查询的应用程序，您会编写以 APPNAME 为前缀的新过程吗？

# java - Java Web Service 框架/库，哪个更好，为什么？

> ID：442582
> 
> 赞同：25
> 
> 时间：2009-01-14T10:51:15.183
> 
> 标签：java, web-services, spring, jakarta-ee, frameworks

目前我正在评估 Java 中的 Web 服务框架的数量。我需要 Web 服务框架来帮助我公开在 JBoss 上运行的现有应用程序的一些功能，该应用程序主要使用 Spring 和 POJO（无 EJB）开发。

我需要的是一个具有以下属性的框架：

1.  它应该提供自动生成样板代码的工具，并通过消除重复性任务来节省时间，例如从 Java (java2wsdl) 生成 WSDL 的工具、生成端点的工具等。
2.  应用程序应该很容易部署在现有的 J2EE 平台（JBoss）上，这意味着它应该包含尽可能少的配置文件（如axis2框架中的axis2.xml）。
    *   此外，最好能够在 现有应用程序的*.war存档中部署 Web 服务。*（似乎 Axis2 需要为 Web 服务应用程序单独存档。）
    *   *结合使用POJO*和*Spring*将非常酷。
    *   通常，该框架应该具有清晰的结构和设计（例如 Spring-WS 缺少它）、良好的文档以及任何其他表征一个好的软件的特征。
    *   框架最好包含一些标准特性，如*JAX-WS*等，而不是供应商特定的方法。

我已经简要检查了

*   轴 2
*   阿帕奇 CXF
*   和太阳的地铁
*   弹簧WS

但是仍然很难决定在我的情况下使用什么：

*   Axis2 似乎太低级了，它需要单独的应用程序存档和大量配置
*   Spring WS 似乎太不透明并且“为了印象目的而复杂（？）”
*   Apache CXF 和 Metro 可能是我更喜欢选择的两个框架，但仍然

我需要您对其中一些在实际应用程序中的使用的意见和经验。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-14T11:06:08.557

我已经使用 CXF 的前身 XFire 有一段时间了，感觉还不错。当时，我们从 Axis 迁移的主要原因有两个：性能和易于开发。在当时（不知道现在是不是这样），XFire 的性能比市面上的任何东西都要好得多，并且通过注释驱动的开发，不必运行存根生成，添加新的真的很容易网页服务。

CXF 似乎更相同但更好 - 由于开发时间的限制以及没有紧迫的理由这样做（加上 6-12 个月前相对缺乏文档），我们还没有迁移鼓励）。此外，我最近还没有真正评估过市场，所以我无法告诉你 CXF 如何与当代竞争对手抗衡。

关于你的观点：

1.  无需生成样板代码，WSDL 由服务类的注释自动创建并由服务器发布。
2.  在 Tomcat 中部署相对简单。只需在 web.xml 中定义另一个 servlet 并将 URL 模式映射到该 servlet。
3.  我们的 Web 服务部署在 WAR 文件中，我不确定实际上有哪些替代方案，但这似乎是默认且显而易见的方式。
4.  POJO 最初工作正常；我们现在已经将大部分 Web 服务对象的创建移到 Spring 中，以便将更复杂的条件依赖连接到其中，并且对此没有任何问题。
5.  文档最初是 CXF 的一个弱点，尽管现在看起来更好。总体设计和架构似乎相对健全。插入自己的过滤器来修改传输细节并不是很痛苦，并且通常考虑扩展现有的类（例如，明智的方法被标记为受保护而不是私有）。
6.  CXF 完全支持 JAX-WS。

所以我可能有点不偏不倚，因为我没有尝试过其他的，但我会竖起大拇指看看 CXF。如果您需要调整它，它非常快，相对简单并且相当强大。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-21T19:07:01.357

我们尝试了 Metro 和 CXF 并保留了 CXF，因为 Metro 在其 jar 文件中包含了太多的依赖项，例如 Sun 的 API，这使得它难以集成到 Glassfish 之外的其他应用程序服务器中。CXF 具有更清晰的封装，具有显式的外部依赖项。我们也未能在 Metro 中启用 Gzip 压缩，而它在 CXF 中的作用就像一个魅力。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-14T15:30:37.087

我会先使用 Spring WS，然后再使用 XFire。我是 Spring 用户，所以我习惯了不透明性。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-14T15:58:43.830

XFire 现在 Apache CXF 比 Axis 更容易使用。在 Axis 看起来过于复杂的情况下，我使用它很快就完成了一些事情。我没有看Spring WS。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-26T19:35:37.820

我将使用 CXF。它比 Axis2 易于使用

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T18:36:54.143

我只使用了 Spring WS，因为这是我被告知要使用的，但它是一个非常容易使用的框架。如果您必须使用其他东西，由于 JAX-WS 支持，我会使用 XFire。

# linq - 将 LINQ 与每行返回同一实体的多个实例的存储过程一起使用

> ID：442585
> 
> 赞同：2
> 
> 时间：2009-01-14T10:53:00.860
> 
> 标签：linq, stored-procedures

我们的开发策略规定所有数据库访问都是通过存储过程进行的，这在使用 LINQ 时会产生问题。

为了使解释更容易，下面讨论的场景已经有所简化。

考虑一个有 2 个表的数据库。

*   订单（OrderID (PK)、InvoiceAddressID (FK)、DeliveryAddressID (FK)）
*   地址（AddresID (PK)、街道、邮政编码）

存储过程返回的结果集必须重命名地址相关的列，以便发票和交货地址彼此不同。

```
OrderID InvAddrID DelAddrID InvStreet DelStreet InvZipCode DelZipCode
1       27        46        Main St   Back St   abc123     xyz789 
```

然而，这意味着 LINQ 不知道如何处理结果集中的这些列，因为它们不再与 Address 实体中的属性名称匹配。

令人沮丧的是，似乎无法定义哪些结果集列映射到哪些实体属性，即使可以（在一定程度上）将实体属性映射到用于插入/更新操作的存储过程参数。

有没有其他人有同样的问题？

从模式的角度来看，我想这将是一个相对常见的场景，但存储过程似乎是这里的关键因素。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T11:03:38.967

您是否考虑过为存储过程创建如下视图以供选择？它会增加复杂性，但允许 LINQ 以您想要的方式查看实体。

```
Create view OrderAddress as 
Select o.OrderID 
,i.AddressID as InvID
,d.AddressID as DelID
...
from Orders o
left join Addresses  i
on o.InvAddressID= i.AddressID
left join Addresses d
on o.DelAddressID = i.AddressID 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-21T09:55:52.330

LINQ 在查询数据方面有点挑剔；它希望架构匹配。我怀疑您将不得不将其恢复为自动生成的类型，然后**在 LINQ 中将您的实体类型映射到对象**（即在 AsEnumerable() 或类似之后） - 因为它不喜欢您创建实例在查询中手动映射实体。

实际上，我建议从一个方面挑战这个要求：考虑使用 UDF 来查询数据，而不是 SP；它们在由数据库拥有方面类似地工作，但它们在服务器上是可组合的（分页、排序、可连接等）。

（这有点随机 - 加一点盐）

如果架构匹配，UDF 可以与实体类型相关联，因此另一种选择（我没有尝试过）是拥有一个 GetAddress(id) udf 和一个“主”udf，然后加入它们：

```
var qry = from row in ctx.MainUdf(id)
          select new {
             Order = ctx.GetOrder(row.OrderId),
             InvoiceAddress = ctx.GetAddress(row.InvoiceAddressId),
             DeliveryAddress = ctx.GetAddress(row.DeliveryAddressId)) }; 
```

（udf 只返回 ids - 实际上，您可能会**加入**到其他 udfs 中，这会使情况变得更糟）。

或其他东西 - 但是可能太混乱而无法认真考虑。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T15:31:41.537

如果您确切知道结果集中将包含哪些列，您应该能够创建一个新的实体类型，该实体类型具有结果集中每一列的属性。`Order`例如，与其尝试将数据打包到 中，不如将其打包到`OrderWithAddresses`中，它具有您的存储过程所期望的结构。如果您使用 LINQ to Entities，您甚至应该能够在 .edmx 文件中指出 OrderWithAddresses 是具有两个附加属性的订单。在 LINQ to SQL 中，您必须指定所有列，就好像它是完全不相关的数据类型一样。

如果您的列是由存储过程动态生成的，您将需要尝试不同的方法：创建一个仅从 Orders 表中提取数据的新存储过程，以及一个仅从地址表中提取数据的存储过程。设置您的 LINQ 映射以改为使用这些存储过程。（当然，您使用存储过程的唯一原因是遵守您的公司政策）。然后，使用 LINQ 连接这些数据。它应该只是效率稍低一些，但它会更恰当地反映数据的实际结构，我认为这是更好的编程实践。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-19T17:26:13.550

我想我明白你在追求什么，但我可以发狂...

如果您在与源表结构相同的 DBML 中模拟类（右键单击 -> 新建 -> 类），则可以简单地根据从存储过程中读取的内容创建新对象。使用 LINQ to 对象，您仍然可以查询您的选择。这是更多的代码，但它并不难做到。例如，像这样模拟您的 DBML：

[注意关联 http://geeksharp.com/screens/orders-dbml.png](http://geeksharp.com/screens/orders-dbml.png)

确保您注意我添加的关联。您可以展开“父属性”并将这些关联的名称更改为“InvoiceAddress”和“DeliveryAddress”。我还将子属性名称分别更改为“InvoiceOrders”和“DeliveryOrders”。注意顶部称为“usp_GetOrders”的存储过程。现在，通过一些代码，您可以手动映射列。我知道这并不理想，特别是如果存储过程没有公开每个表的每个成员，但它可以让你接近：

```
public List<Order> GetOrders()
{
    // our DBML classes
    List<Order> dbOrders = new List<Order>();

    using (OrderSystemDataContext db = new OrderSystemDataContext())
    {
        // call stored proc
        var spOrders = db.usp_GetOrders();

        foreach (var spOrder in spOrders)
        {
            Order ord = new Order();
            Address invAddr = new Address();
            Address delAddr = new Address();

            // set all the properties
            ord.OrderID = spOrder.OrderID;

            // add the invoice address
            invAddr.AddressID = spOrder.InvAddrID;
            invAddr.Street = spOrder.InvStreet;
            invAddr.ZipCode = spOrder.InvZipCode;
            ord.InvoiceAddress = invAddr;

            // add the delivery address
            delAddr.AddressID = spOrder.DelAddrID;
            delAddr.Street = spOrder.DelStreet;
            delAddr.ZipCode = spOrder.DelZipCode;
            ord.DeliveryAddress = delAddr;

            // add to the collection
            dbOrders.Add(ord);
        }
    }

    // at this point I have a List of orders I can query...
    return dbOrders;
} 
```

再一次，我意识到这看起来很麻烦，但我认为最终结果值得多写几行代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-17T21:32:47.903

这根本不是很有效，但是如果所有其他方法都失败了，您可以尝试从应用程序调用两个程序，一个来获取发票地址，然后另一个来获取送货地址。

# visual-studio-2008 - 打开每个新的 VS 实例时创建的 Visual Studio 2008\Backup Files 文件夹

> ID：442586
> 
> 赞同：14
> 
> 时间：2009-01-14T10:53:28.097
> 
> 标签：visual-studio-2008, backup, registry, autosave

我想我在 VS 2008 保存备份文件的路径上有些问题。几天以来，它在我的 .sln 文件所在的同一文件夹中创建了一个新的“Visual Studio 2008”目录。然后，在第一次自动保存的时间到期后，备份文件将保存到此文件夹中。

我浏览了工具选项对话框，但我还没有找到通过静态设置目录的方法：C:\documents and settings\\My Documents\Visual Studio 2008\Backup Files。

任何人都可以为我指出这个问题的正确解决方案（可能是正确的注册表项 - 我猜）？谢谢

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-02T07:01:00.700

在这里检查：

HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\9.0

修复那里的路径应该可以解决问题，特别注意**VisualStudioLocation**，它默认指向*%USERPROFILE%\Documents\Visual Studio 2008*

# sql - 您可以在 SQLServer 2k5 中的链接服务器表的视图上使用外键吗？

> ID：442587
> 
> 赞同：5
> 
> 时间：2009-01-14T10:55:07.610
> 
> 标签：sql, sql-server, sql-server-2005, foreign-keys, linked-server

我有一个带有链接服务器的 SQLServer，它连接到其他地方的另一个数据库。我在该链接服务器上创建了一个视图

```
create view vw_foo as
select
[id],
[name]
from LINKEDSERVER.RemoteDatabase.dbo.tbl_bar 
```

我想以下

```
alter table [baz] 
add foo_id int not null
go

alter table [baz] with check 
add constraint [fk1_baz_to_foo] 
  foreign key([foo_id]) 
  references [dbo].[vw_foo] ([id])
go 
```

但这会产生错误：“外键 'fk1_baz_to_foo' 引用了不是用户表的对象 'dbo.vw_foo'。”

如果我尝试使用以下方法将外键直接放在表上

```
alter table [baz] with check 
add constraint [fk1_baz_to_bar] 
  foreign key([foo_id]) 
  references LINKEDSERVER.RemoteDatabase.dbo.tbl_bar ([id]) 
```

然后我收到以下错误：

> 对象名称“LINKEDSERVER.RemoteDatabase.dbo.tbl_bar”包含的前缀数量超过了最大数量。最大值为 2。

有什么办法可以达到同样的效果吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-14T14:47:16.813

外键不能连接到非本地对象——它们必须引用本地表。您收到“最大前缀数”错误，因为您使用 4 部分名称 (LinkedServer.Database.Schema.Object) 引用表，而本地对象只有 3 部分名称。

其他解决方案：

1.  将数据从源（视图的位置）复制到与您尝试添加键的表相同的服务器。您可以每小时、每天或其他方式执行此操作，具体取决于源数据更改的频率。
2.  在源表上添加触发器以将任何更改推送到本地副本。这基本上与 #1 相同，但会立即进行更改
3.  向您的表添加一个 INSTEAD OF" 触发器，该触发器通过从链接服务器中选择并比较您尝试插入/更新的值来手动检查外键约束。如果不匹配，您可以拒绝更改。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-04T02:28:11.090

你可以，但你必须使用一些动态的 SQL 技巧来实现它。

```
declare @cmd VARCHAR(4000)
SET @cmd = 'Use YourDatabase
ALTER TABLE YourTable
DROP CONSTRAINT YourConstraint'

exec YourServer.master.dbo.sp_executesql @SQL 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T11:10:11.247

不，必须针对用户表创建外键。你试过下面的吗？

```
alter table [baz] with check 
add constraint [fk1_baz_to_foo] 
FOREIGN KEY([foo_id]) 
references 
   LINKEDSERVER.RemoteDatabase.dbo.tbl_bar([id])
go 
```

# java - 在 Java 中通过单元测试覆盖进行惰性“运行一次”初始化的方法

> ID：442589
> 
> 赞同：0
> 
> 时间：2009-01-14T10:58:06.230
> 
> 标签：java, multithreading, singleton, lazy-evaluation

我正在寻找一段代码，它的行为有点像单例但不是（因为单例很糟糕:) 我正在寻找的必须满足这些目标：

1.  线程安全
2.  简单（理解和使用，即几行代码。库调用是可以的）
3.  快速地
4.  不是单身；对于测试，必须可以覆盖该值（并在测试后将其重置）。
5.  本地（所有必要信息必须在一个地方）
6.  惰性（仅在实际需要该值时运行）。
7.  运行一次（RHS 上的代码必须执行一次且仅一次）

示例代码：

```
private int i = runOnce(5); // Set i to 5
// Create the connection once and cache the result
private Connection db = runOnce(createDBConnection("DB_NAME"));

public void m() {
    String greet = runOnce("World");
    System.out.println("Hello, "+greet+"!");
} 
```

请注意，这些字段*不是*静态的；只有表达式的 RHS（右手边）是……在某种程度上是“静态的”。测试应该能够临时注入新`i`值`greet`。

另请注意，这段代码概述了我打算如何使用这个新代码。随意用任何东西替换 runOnce() 或将其移动到其他地方（构造函数，也许，或 init() 方法或 getter）。但是 LOC 越少越好。

一些背景资料：

我不是在寻找 Spring，而是在寻找一段可用于最常见情况的代码：您需要实现一个接口，除了您想要的测试之外，永远不会有第二个实现传入模拟对象。此外，Spring 失败了 #2、#3 和 #5：您需要学习配置语言，您必须在某处设置应用程序上下文，它需要 XML 解析器并且它不是本地的（信息遍布各处）。

由于#5，全局配置对象或工厂不符合要求。

`static final`因为#4而出局（不能改变决赛）。`static`由于类加载器问题而有异味，但您可能需要在里面使用它`runOnce()`。我只是希望能够在表达式的 LHS 中避免它。

一种可能的解决方案可能是将[ehcache](http://ehcache.sourceforge.net/)与默认设置一起使用，该设置将返回相同的对象。由于我可以将内容放入缓存中，因此这也允许随时覆盖该值。但也许有比 ehcache 更紧凑/简单的解决方案（它再次需要 XML 配置文件等）。

[编辑] 我想知道为什么这么多人不赞成这个。这是一个有效的问题，用例很常见（至少在我的代码中）。因此，如果您不理解问题（或其背后的原因），或者您没有答案或不在乎，为什么要投反对票？：/

[EDIT2] 如果您查看 Spring 的应用程序上下文，您会发现超过 99% 的所有 bean 都只有一个实现。你可以拥有更多，但在实践中，你根本没有。因此，我没有分离接口、实现和配置，而是在寻找只有一个实现（在最简单的情况下）、一个 current() 方法和一两行聪明的代码来初始化 current() 的结果的东西一次（第一次调用时）但同时允许覆盖结果（如果可能，线程安全）。把它想象成一个原子的“if(o==null) o = new O(); return o”，你可以在其中覆盖 o。也许 AtomicRunOnceReference 类是解决方案。

现在，我只是觉得我们每天都拥有和使用的并不是最佳的，有一个莫名其妙的解决方案会让我们都拍脑袋说“就是这样”。就像我们几年前 Spring 出现时的感觉一样，我们意识到我们所有的单例问题来自哪里以及如何解决它们。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-14T11:06:03.203

线程安全初始化代码（imho）的最佳习惯用法是惰性内部类。经典版本是

```
class Outer {
  class Inner {
    private final static SomeInterface SINGLETON;

    static {
      // create the SINGLETON
    }
  }

  public SomeInterface getMyObject() {
    return Inner.SINGLETON;
  }
} 
```

因为它是线程安全的、延迟加载和（恕我直言）优雅的。

现在您需要可测试性和可替换性。在不知道它到底是什么的情况下很难给出建议，但最明显的解决方案是使用依赖注入，特别是如果您使用的是 Spring 并且无论如何都有应用程序上下文。

这样，您的“单例”行为由一个接口表示，您只需将其中一个注入您的相关类（或生产一个工厂），然后您当然可以用您喜欢的任何东西替换它以进行测试。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-03-17T16:46:39.977

这是一个满足我所有要求的解决方案：

```
/** Lazy initialization of a field value based on the (correct)
* double checked locking idiom by Joschua Bloch
*
* <p>See "Effective Java, Second Edition", p. 283
*/
public abstract class LazyInit<T>
{
    private volatile T field;

    /** Return the value.
    *
    *  <p>If the value is still <code>null</code>, the method will block and
    *  invoke <code>computeValue()</code>. Calls from other threads will wait
    *  until the call from the first thread will complete.
    */
    @edu.umd.cs.findbugs.annotations.SuppressWarnings("UG_SYNC_SET_UNSYNC_GET")
    public T get ()
    {
        T result = field;
        if (result == null) // First check (no locking)
        {
            synchronized (this)
            {
                result = field;
                if (result == null) // Second check (with locking)
                {
                    field = result = computeValue ();
                }
            }
        }
        return result;
    }

    protected abstract T computeValue ();

    /** Setter for tests */
    public synchronized void set (T value)
    {
        field = value;
    }

    public boolean hasValue()
    {
        return field != null;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-14T13:39:01.790

即使您不使用 IoC 框架（Spring/Guice/...），您也可以使用 IoC 技术。在我看来，这是避免单例的唯一干净方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T11:09:53.790

我认为您可以使用的一种解决方案是提供一种可以在测试中覆盖的受保护方法（我以前用于测试遗留代码的解决方案）。

所以像：

```
private SomeObject object;

protected SomeObject getObject() {
   if (object == null) {
       object = new SomeObject();
   }
   return object;
} 
```

然后在您的测试课中，您可以执行以下操作：

```
public void setUp() {
   MyClassUnderTest cut = new MyClassUserTest() {
      @Override
      protected SomeObject getObject() }
         return mockSomeObject;
      }
   };
} 
```

我不得不说我并不太热衷于这种模式，因为它暴露了你可能并不真正想要的受保护字段，但它对于让你摆脱某些无法选择注入的情况很有用

# c++ - 使用 Qt 将 Windows 库移植到 MacOSX、事件循环

> ID：442593
> 
> 赞同：0
> 
> 时间：2009-01-14T11:00:09.580
> 
> 标签：c++, objective-c, qt, events

我在 MFC 消息循环中插入了一个钩子，以便处理 Qt 事件，而不在 qApp 上运行 ->exec() （因为它是阻塞的）：

```
LRESULT CALLBACK myHookFn(int ncode, WPARAM wparam, LPARAM lparam) {
    if (qApp) qApp->sendPostedEvents();
    return CallNextHookEx(0, ncode, wparam, lparam);
} 
```

和

```
int argc = 0;
new QApplication(argc, NULL);
SetWindowsHookEx(WH_GETMESSAGE, myHookFn, 0, threadId); 
```

我的问题是：

可以在 MacOSX 下使用的与 MFC 挂钩插入等效的机制是什么，以便也可以调用 sendPostedEvents？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T11:44:14.237

这应该在 Qt Mac 4.5（Carbon 和 Cocoa 端口）中自动发生 - 因为 Qt 在 CFRunLoop 中注册为 CFRunLoopSource 并且回调将调用 sendPostedEvents。另请参阅 Qt 4.5 的 src/gui/kernel 中的 qeventdispatcher_mac.mm

# svn - 如何测试我是否以正确的方式配置了基于 Subversion 路径的授权？

> ID：442594
> 
> 赞同：0
> 
> 时间：2009-01-14T11:00:20.063
> 
> 标签：svn, security, audit, apache

问题在于通过 Apache Web 服务器提供的 Subversion 存储库的安全设置。

我使用基于路径的身份验证来保护一些公司信息免受外部合作者的侵害。我需要一些东西来测试授权给了我想要的人，即我需要检查我没有在配置中犯错误。

有一个简单的测试方法：使用用户的用户名和密码模拟对资源的访问。但是这种方法需要知道用户的密码。

例如，下面的 BASH 脚本在指定路径 ($url) 上测试每个用户的授权。注意：users-files.txt 包含用户的用户名和密码，格式为“username:password”。

```
url="http://my.company.com/svn/repo1/private-data/"
while read line; do
  username="${line%:*}"
  password="${line#*:}"
  if wget --quiet --user="$username" --password="$password" -- "$url"; then
    echo -e "$username:\tgranted"
  else
    echo -e "$username:\tdenied"
  fi
done < users-list.txt 
```

有一种方法可以在不知道用户密码而只知道用户名的情况下进行此检查？我是运行 HTTPD 和 Subversion 的机器的根。HTTPD 是否提供了一些审计工具？

身份验证配置如下：

```
<Location /svn/>
   DAV svn
   SVNParentPath /var/svn/
   AuthType Basic
   AuthBasicProvider ldap
   AuthName "Subversion repository"
   AuthLDAPURL ldap://127.0.0.1:389/ou=People,o=mycompany.com?uid?sub?(objectClass=*)
   Require valid-user
   AuthzSVNAccessFile /var/svn/svn-access-file.conf
   Options Indexes
   SVNListParentPath on
</Location> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T11:37:35.467

如果通过“检查”，您的意思是查看定义是什么 - 那么您可以检查服务器上的安全配置文件（特别是[文档](http://svnbook.red-bean.com/en/1.4/svn.serverconfig.pathbasedauthz.html)中称为“规则文件”的内容）以找出允许的人访问什么路径。

如果“检查”是指测试，例如通过 HTTP 连接来验证用户在实践中实际允许的规则——那么不，你不能。在您的示例中，您尝试以给定的用户（名称）实际连接到 Subversion。如果您能够在没有密码的情况下执行此操作，那将是对整个安全系统的嘲弄。

# python - 使用任何 Pythonic 框架在 Django/else 中级联表单

> ID：442596
> 
> 赞同：3
> 
> 时间：2009-01-14T11:04:04.533
> 
> 标签：python, django

谁能指出一个用 ajax 编写的 Python 示例（首选 django）用于级联表单？级联表单基本上是其字段值在另一个字段值更改时更改的表单。示例选择国家，然后国家将改变......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T11:37:39.507

这是（*主要是*）前端的东西。

您可能已经注意到 Django 试图将所有 AJAX 的东西留给您，所以我认为您不会找到任何内置的东西来做到这一点。

然而，使用 JS（这是你必须做的，以便在不手动提交十亿个表单的情况下执行此操作），你可以轻松地拥有一个 django-base 视图，你的 JS 可以与之通信：

```
def get_states(request, country):
    # work out which states are available
    #import simplesjon as sj
    return sj.... 
```

然后将您的 AJAX 请求绑定到`onchange`事件`select`（我不记得这是否适用于选择框）并根据 JSON 查询的返回填充下一个字段。

jquery 和 simplejson 的 10 分钟工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T14:33:55.907

我还建议考虑一次获取所有数据的映射，而不是一个一个地请求子字段值。除非子字段选择经常变化（州/城市变化？）或数量巨大（> 1000），否则这应该提供最佳性能并且它不那么复杂。

您甚至不需要创建单独的视图，只需在包含表单的响应中包含一段 JavaScript（更准确地说是 JSON 映射）。

# azure - 云服务是否适合此应用程序？

> ID：442606
> 
> 赞同：0
> 
> 时间：2009-01-14T11:07:20.487
> 
> 标签：azure, amazon-s3, amazon-web-services, cloud

我正在寻找弹出的云服务（例如 Amazon/Azure）的详细信息，并且想知道它们是否适合我的应用程序。

我的应用程序基本上有一个大约 500GB 的单表数据库。它以 3-5 GB/天的速度增长。我需要从中提取文本数据，一次大约 100 万行，过滤大约 5 列。提取的数据通常约为 1-5 GB，压缩后可达 100-500MB，然后在网络上可用。

这里有我现有实现的一些细节 [一个 400GB 表，一个查询 - 需要调整想法 (SQL2005)](https://stackoverflow.com/questions/350318)

所以，我的问题是：现有的云服务是否适合托管这种类型的应用程序？存储这么多数据和带宽的成本是多少（带宽使用量约为 2GB/天）？

持久性系统是否适合存储这样的大型平面表，它们是否提供在多个列上进行搜索的能力？

我当前的实现在低于 10k 美元的硬件上运行，因此如果成本远高于 5k 美元/年，那么迁移是没有意义的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-04T07:21:41.877

鉴于海量数据及其增长速度，我认为亚马逊不是一个好的选择。我假设您希望将数据存储在持久存储中。但是使用 EC2，您需要分配给定数量的存储并将其作为磁盘附加。除非您想分配大量空间（然后为未使用的磁盘空间付费），否则您将不得不不断添加更多磁盘。我快速回顾了包络计算，我估计托管费用每年在 2,500 到 10,000 美元之间。由于亚马逊收取的所有可变因素（实例正常运行时间、存储空间、带宽、磁盘 io 等），我很难准确估计。这是[EC2 定价](http://aws.amazon.com/ec2/#pricing)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-04-30T02:46:30.917

假设这是非关系数据（不能在单个表上处理关系数据），您可以考虑使用 Azure 表存储，这是一种专为非关系结构化数据设计的存储机制。

您将在此处遇到的问题是 Azure 表只有一个主索引，因此无法按您的需要按 5 列进行索引。除非您将数据存储 5 次，否则每次都按您希望过滤的列进行索引。不确定这是否会非常划算。

Azure 表存储的成本低至每月每 Gig 8c USD，具体取决于您存储的数据量。每笔交易和出口数据也有费用。有关定价的更多信息，请点击此处；[http://www.windowsazure.com/en-us/pricing/calculator/advanced/](http://www.windowsazure.com/en-us/pricing/calculator/advanced/)

您需要从哪里访问这些数据？它是如何写入的？

基于此，还可以考虑其他选项，例如 Azure Drives 等。

# jquery - jQuery：当我在 FF3 和 Chrome 中测量它们的高度时，为什么隐藏的表格单元格会再次显示（有点）

> ID：442612
> 
> 赞同：1
> 
> 时间：2009-01-14T11:10:26.627
> 
> 标签：jquery, google-chrome, firefox-3

我可以使用 jQuery 成功隐藏一些表格单元格。然后当我测量隐藏单元格的高度时，如果不隐藏单元格将占据的空间显示为空白空间，将该行中的所有剩余单元格推过一列。就好像单元格被重新插入到表格流中，但它的内容是隐藏的。下面的示例演示了该问题。单击“隐藏第 2 列”，然后单击“测量第 1 行第 2 列”以查看它的发生。示例代码是独立的 - 只需将其保存为 HTML 文件即可。

这会影响 FF3 和 Chrome，但不会影响 IE7。

```
<html>
<head>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("a.clickToHide").click(function() { 
                $(".col2").hide(); 
            });
            $("a.clickToMeasure").click(function() { 
                $("span.result").text($("tr.row1 td.col2").height()); 
            });
        });
    </script>
</head>
<body>
    <table>
        <thead>
            <tr>
                <th class="col1"> Column 1 </th>
                <th class="col2"> Column 2 </th>
                <th class="col3"> Column 3 </th>
            </tr>
        </thead>
        <tbody>
            <tr class="row1">
                <td class="col1"> Column 1 </th>
                <td class="col2"> Column 2 </th>
                <td class="col3"> Column 3 </th>
            </tr>
            <tr class="row2">
                <td class="col1"> Column 1 </th>
                <td class="col2"> Column 2 </th>
                <td class="col3"> Column 3 </th>
            </tr>
        </tbody>
    </table>
    <a class="clickToHide" href="#">Click to hide column 2</a> <br />
    <a class="clickToMeasure" href="#">Click to measure row 1 column 2</a> <br />
    <span class="result"></span>
</body> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T16:24:08.100

研究这个的有趣的结果。首先，您可以通过优化选择器来完成您想要的。

其次，我决定深入研究 jquery 源代码以了解您的选择器导致问题的原因。我发现表格单元格可见“显示：块；” 在“交换”功能中。这样做似乎确实得到了正确的计算（评论）。在使其可见并正确执行计算后，该函数会尝试将可见状态恢复回来。但是反转不会生效。我认为这绝对是浏览器问题，因为对象值是准确的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-06-09T02:02:31.920

我今天也发现了这个问题（Chrome 12.0.742.91。）这是我可以制作的最简单的有效代码来演示这个问题：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <title>Chrome table cell bug</title>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
        <script type="text/javascript">
            $(function() {
                $(document.body).click(function() {
                    $('tr:first>td:last').css('width');
                });
            });
        </script>
        <style type="text/css">
            thead td { padding-bottom: 100px; background-color: red; }
        </style>
    </head>
    <body>
        <table style="width: 100%;">
            <thead>
                <tr>
                    <td></td>
                    <td style="display: none;"></td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td></td>
                    <td style="display: none;"></td>
                </tr>
            </tbody>
        </table>
    </body>
</html> 
```

当页面加载时，点击红色条上的某处（所有 TD 都有红色 BG），只需测量隐藏单元格的宽度，红色条就会被压缩。

我可能会将此报告给 jQuery 和/或 Google，但目前我所做的解决方法是替换`$el.width()`为`$el.is(':visible') ? $el.width() : 0`可能隐藏的表格单元格。

# asp.net - 如何以编程方式设置 ASP.NET 页面的 AsynchMode？

> ID：442614
> 
> 赞同：0
> 
> 时间：2009-01-14T11:12:08.637
> 
> 标签：asp.net

我有一个没有 .aspx 文件的页面基类，因此我无法设置页面指令 Asynch="true" - 但我希望从这个基类继承的页面异步操作 - 有没有办法以编程方式设置 AsynchMode我的基类？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T11:24:50.937

我相信设置 Asynch="true" 基本上告诉 ASP.NET 页面应该继承 IHttpAsyncHandler 接口，因此可以直接在你的类中继承这个接口但是我没有这样做的经验所以不能保证这是解决您的问题。

一个快速的谷歌草草了这篇文章：

[.NET 2.0 中的异步页面](http://msdn.microsoft.com/en-us/magazine/cc163725.aspx)

# xml - 您如何在 C# (ASP.net) 中使用 SessionStateItemCollection

> ID：442615
> 
> 赞同：0
> 
> 时间：2009-01-14T11:12:25.437
> 
> 标签：xml, session, asp.net-2.0, c#-2.0

如果我将 xml 文件（名称-> 值）的内容存储在会话集合中，那么在另一个页面上访问它的最佳方式是什么（即不是运行以下脚本的页面）。

它只是在我要访问集合的每个页面上创建一个新的 SessionStateItemCollection 实例的工作吗？

```
System.Xml.XmlDocument oXmlDoc = new System.Xml.XmlDocument();

            oXmlDoc.Load(Server.MapPath("xml.xml")); //load XML file

            XmlNode root = oXmlDoc.DocumentElement;

            SessionStateItemCollection PSess = new SessionStateItemCollection(); //session collection

            for (int x = 0; x < root.ChildNodes.Count; x++) //loop through children and add to session
            {
                PSess[root.ChildNodes.Item(x).Name] = root.ChildNodes.Item(x).InnerText;  //add xml values to session 

            } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-14T11:42:31.510

如果这是在 ASP.NET 中，那么我不明白为什么要创建一个新的 SessionStateItemCollection 对象。在这种情况下，您需要自己处理页面之间的持久化。

ASP.NET 通过 Page 的 Session 对象或 HttpContext.Current 对象提供对 SessionStateItemCollection 对象的访问，如果您想从一个类中使用它。您可以通过 Session 对象将键值对存储在其中，并从后续页面上的 Session 对象中检索它们。

我会重写你的代码如下

```
System.Xml.XmlDocument oXmlDoc = new System.Xml.XmlDocument();

oXmlDoc.Load(Server.MapPath("xml.xml")); //load XML file

XmlNode root = oXmlDoc.DocumentElement;

for (int x = 0; x < root.ChildNodes.Count; x++) //loop through children and add to session
{
    Session[root.ChildNodes.Item(x).Name] = root.ChildNodes.Item(x).InnerText;  //add xml values to session 
} 
```

您现在可以使用 Session 对象从另一个页面访问内容（以下代码将通过会话中存储的所有内容进行交互）：

```
for (int i = 0; i < Session.Count; i++)
{
    Response.Write(Session.Keys[i] + "-" + Session[i].ToString());
} 
```

# .net - OID 密钥 Blob 存储的程序员中有市场吗？

> ID：442617
> 
> 赞同：1
> 
> 时间：2009-01-14T11:13:21.053
> 
> 标签：.net, c++, serialization, storage, blob

一个朋友开发了一个非常棒的 blob 商店，我认为它需要被使用，但我想知道人们是否认为这样的东西有市场，以及程序员是否会做出这样的决定。它支持使用增量进行在线备份，并且比我所知道的任何东西都快得多，它经过了严格的测试并被用于一些非常小众的应用程序中。我认为任何具有二进制文件格式的人都希望将其用作替代方案。它有一个 C++ 接口，并已适应 .NET 序列化。

它绝对将 SQL blob 表从水中吹走。

想法？

编辑：更好，因为：

*   它非常快。
*   它是事务性的，具有完整的恢复扫描，比平面文件要好得多。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T13:54:25.253

有市场，但不是很大。还有长期存在的竞争，请参见[BerkleyDB](http://www.oracle.com/technology/products/berkeley-db/index.html)（这是一个独立销售的产品（公司名称：SleepyCat），但它们不久前被甲骨文收购。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T19:11:15.753

根据许可和成本，我当然会考虑它。几周前我[问过这样的事情，最后暂时使用了一个 SQLite 数据库文件，我怀疑这不是最佳的。](https://stackoverflow.com/questions/399304/store-huge-stdmap-mostly-on-disk)

（而且我经营自己的软件开发公司，所以我*会*做出购买决定。:-)）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T11:23:02.267

想法？你还没有说它*有多*好......（或者它比平面 BLOB/数据库/文件解决方案更好）。

此外，常规的 .NET（二进制）序列化并不适合长期存储（在数据库中），因为它是特定于实现的（并且与程序集相关联）。对于序列化，您可能希望查看与平台无关的解决方案，例如 Google 的协议缓冲区（它具有[C++、java](http://code.google.com/p/protobuf/)、[C# 和其他](http://code.google.com/p/protobuf/wiki/OtherLanguages)的实现- 包括[我自己的一个](http://code.google.com/p/protobuf-net/)）。

# unit-testing - 由 QA 工程师进行的单元测试

> ID：442619
> 
> 赞同：11
> 
> 时间：2009-01-14T11:14:29.443
> 
> 标签：unit-testing, qa

正如我从一些问答环节中了解到的（参见[this](https://stackoverflow.com/questions/14040/developer-testing-vs-qa-team-testing-what-is-the-right-division-of-work)和[this](https://stackoverflow.com/questions/362157/who-should-do-the-testing-of-software-its-the-developerwho-wrote-it-or-the-tes)），单元测试应该由开发人员编写。

在我以前的工作场所，我们试图将这项任务交给 QA 工程师，但没有奏效。可能是因为它已经是一个项目的中间，他没有机会进行重要的代码覆盖，或者可能是因为其他原因。

您认为以这种方式将开发人员从编写单元测试中解放出来是一个坏主意吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-14T11:18:40.417

一般来说，我认为这是一个坏主意。单元测试指导开发人员编写模块化（因此是有用的、可重用的）代码，因为他们的代码需要与生产系统和测试代码一起使用。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-14T11:40:18.860

单元测试和 QA 测试的意图之间有一个微妙但重要的区别：*QA 测试验证功能；单元测试验证设计*。也就是说，外观与产品的内部视图形成对比。

QA人员不熟悉产品的内部设计，这是故意的，因为他们必须模仿用户的观点。另一方面，开发人员非常了解内部工作原理，并且对他们来说，验证设计的机制将是有意义的，如果有的话。

因此，开发人员而不是 QA 人员编写单元测试是绝对自然的。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-14T11:32:23.917

这取决于您计划如何实施测试工作流程。

**坏的：**

开发人员编写他的代码，然后其他人尝试添加单元测试来测试此代码。这里的问题是开发人员不会关心编写易于测试的代码。可能会花费大量时间来尝试使单元测试适应可测试性差的代码，或者浪费时间重构原始代码以使其更好地进行测试。

**好的：**

开发人员之外的另一个人编写单元测试，然后开发人员编写他的代码，试图让所有这些测试都变成绿色。起初这可能有点尴尬，因为必须存在一些基本接口才能实现测试，但基本接口应该在设计文档中定义，以便开发人员可以为测试开发人员准备接口。优点是，测试开发人员尝试编写尽可能多的独立于实际实现的测试，而原始开发人员将根据其代码的内部结构编写测试，而不是想象其他问题。否则，他会在他的实施中防范它们。

“好的”方法在我的两个项目中运行良好，但我们使用了一种无类型语言（Smalltalk），我们只需要就类名达成一致就可以运行测试。在 Java 中，您必须至少实现一个接口来调用函数。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-14T11:18:12.057

是的。

开发人员编写单元测试以确保“单元”完成它应该做的事情。QA 人员测试整个应用程序。

此外，单元测试是代码，开发人员编写代码。大多数时候 QA 工程师不编写代码。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-14T11:23:39.050

开发人员必须编写单元测试。否则就像开发人员不必关心质量一样。此外，单元测试有助于开发人员编写更好的代码。

也许您听说过[TDD](http://en.wikipedia.org/wiki/Test-driven_development)？“测试驱动开发”确实是一种很好的开发实践。它的主要目的是在编写实际代码之前开发单元测试（这很奇怪，当我们开始使用 TDD 时，我承认）......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-14T13:25:39.583

乍一看，在团队中有一个专门从事单元测试的人似乎很有趣；因为他将审查所有代码。这也将减轻一名开发人员在生产代码和单元测试中犯同样错误的风险。

但是，为了进行单元测试，代码必须是可测试的；当它收到的代码无法测试时，他能做什么？重写吗？重构它？没有单元测试？

简而言之，我认为**这不是一个好主意**。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-14T14:34:41.053

在我工作的地方，我们都进行单元测试，但不是基于您自己的代码。您仍然会编写可测试的代码，并且仍将关注质量。开发人员对他们不从事的软件领域变得更加熟悉。每个人都知道代码库，并且可以从其他开发人员那里接手。

对于编写单元测试的非软件开发人员，我同意所有其他答案。这是个坏主意。

在您的问题中，您说您有一个人进行单元测试。良好的单元测试需要付出很多努力，具体取决于所需的测试覆盖率。它是开发团队工作量的 50% 到 100%。一个测试大量开发人员代码的人会完全不知所措。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-14T14:45:11.313

我不认为这会很糟糕，我只是不认为这是可能的。如果代码没有首先编写测试，它可能是不可测试的。

QA 人员是否正在重构代码以使其可测试？

如果是这样，那很好，我不在乎他们的头衔是什么。如果他们不是，那么我怀疑他们会成功。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-15T15:56:33.350

我认为 QA 编写单元测试通常是不好的。单元测试是代码，它们与开发代码的构造方式密切相关。出于这个原因，开发人员最清楚哪些测试最有意义。

另一方面，我认为 QA 应该尽可能接近单元测试。QA 需要与开发人员建立良好的关系，并尝试理解代码设计。为什么？当开发人员编写单元测试时，重点仍然是开发，而不是测试。你不能相信（不是坏意义上的）开发人员能够提出最好的测试用例并且她有很好的覆盖范围。由于 QA 专门从事测试，因此在单元测试期间让 QA 和开发人员尽可能接近可能是一个好主意。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-07-07T11:04:59.570

开发人员或其他开发人员（代码审查员）应该记录单元测试用例，这些用例应该基于开发的代码或技术设计。但是，QA 测试用例应该由基于功能设计的功能测试人员编写。

这里的根本区别在于，UT 涵盖了逻辑、内部流程、性能、优化，而 QA 涵盖了模仿用户体验的功能流程。

# sql - 如何在不访问源代码的情况下确定 Oracle 查询？

> ID：442634
> 
> 赞同：2
> 
> 时间：2009-01-14T11:21:28.273
> 
> 标签：sql, oracle, networking

我们有一个系统，它有一个我们可以访问的 Oracle 后端（尽管可能不是管理访问）和一个我们没有源代码的前端。数据库很大，不容易理解——我们没有文档。总的来说，我对 Oracle 也不是特别了解。

前端的一个方面是在数据库中查询一组特定的数据并将其显示出来。我们需要确定正在进行什么查询，以便我们可以在没有前端的情况下复制和自动化它（例如，通过定期生成 csv 文件）。

您将使用哪些方法来确定检索这组数据所需的 SQL？

目前我倾向于使用 EeePC、Wireshark 和集线器（在客户端机器上安装 Wireshark 可能是不可能的），但我很想听听任何其他想法以及是否有人能想到这个特定的任何陷阱方法。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-14T13:53:56.347

显然有很多方法。我发现最简单的一个是：

(1) 以 SYS 或 SYSTEM 连接数据库

(2) 查询 V$SESSION 以识别您感兴趣的数据库会话。记录 SID 和 SERIAL# 值。

(3) 执行以下命令激活会话跟踪：

```
exec sys.dbms_system.set_bool_param_in_session( *sid*, *serial#*, 'timed_statistics', true )
exec sys.dbms_system.set_int_param_in_session( *sid*, *serial#*, 'max_dump_file_size', 2000000000 )
exec sys.dbms_system.set_ev( *sid*, *serial#*, 10046, 5, '' ) 
```

(4) 在客户端应用中执行一些动作

(5) 终止数据库会话（例如通过关闭客户端）或停用跟踪（ exec sys.dbms_system.set_ev( *sid* , *serial#* , 10046, 0, '' ) ）

(6) 在数据库服务器上找到 udump 文件夹。数据库会话将有一个跟踪文件，显示执行的语句和每次执行中使用的绑定值。

此方法不需要对客户端计算机进行任何访问，这可能是一个好处。它确实需要访问数据库服务器，如果您不是 DBA 并且他们不允许您进入机器，这可能会出现问题。此外，如果您有许多客户端或客户端应用程序打开多个会话，则识别要跟踪的正确会话可能很困难。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-14T11:30:41.360

从查询 Oracle 系统视图开始，例如 V$SQL、v$sqlarea 和 v$sqltext。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-14T13:00:21.743

[Wireshark](http://www.wireshark.org/)确实是一个好主意，它有 Oracle 支持并且很好地显示了整个对话。

如果您没有对数据库服务器的管理员访问权限但您可以访问网络（例如，因为以太网交换机上有端口镜像），那么像 Wireshark 这样的数据包嗅探器会特别有趣。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-14T13:24:14.173

哪个版本的甲骨文？如果它是 10+ 并且您具有管理权限 (sysdba)，那么您可以通过 Oracle 企业管理器相对容易地找到执行的查询。

对于旧版本，您需要访问 tuinstoel 在他的回答中提到的视图。

您可以通过[TOAD for oracle](http://www.quest.com/toad-for-oracle/)获得相同的数据，这是一款功能强大的软件，但价格昂贵。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-14T16:14:21.350

我已经多次成功使用这些说明： [http ://www.orafaq.com/wiki/SQL_Trace#Tracing_a_SQL_session](http://www.orafaq.com/wiki/SQL_Trace#Tracing_a_SQL_session)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-14T22:10:58.900

“虽然可能不是管理访问”。有人应该具有管理权限，可能是负责备份的人。至少，我希望您有一个对运行 oracle 数据库的机器具有 root/Administrator 访问权限的用户。管理员应该能够使用“SQLPLUS / AS SYSDBA”语法登录，这将提供完全访问权限（这可能非常危险）。root 可以向 oracle 用户“su”并执行相同操作。

如果您确实无法获得管理员访问权限，那么作为wireshark 的替代方案，如果您的前端通过Oracle 客户端连接到数据库，请查找文件sqlnet.ora。您可以设置 trace_level_client、trace_file_client 和 trace_directory_client 并让它记录客户端和数据库服务器之间的 Oracle 网络流量。

但是，客户端可能会调用存储过程并将数据作为输出参数或引用游标检索，这意味着您可能看不到通过该机制执行的查询。如果是这样，您将需要对数据库服务器的管理员访问权限，并按照 Dave Costa 的回答进行跟踪

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-14T21:50:42.403

如果您可以在行为中捕获 SQL 语句，那么一种快速而肮脏的方法是在 SQL*Plus 中运行它：-

```
set verify off lines 140 head on pagesize 300

column sql_text format a65
column username format a12
column osuser format a15

break on username on sid on osuser

select S.USERNAME, s.sid, s.osuser,sql_text
from v$sqltext_with_newlines t,V$SESSION s
where t.address =s.sql_address
and t.hash_value = s.sql_hash_value 
order by s.sid,t.piece
/ 
```

您需要访问这些 v$ 视图才能使其正常工作。通常这意味着作为系统连接。

# regex - Vim 正则表达式删除除最后两位数字之外的所有数字

> ID：442650
> 
> 赞同：8
> 
> 时间：2009-01-14T11:32:09.157
> 
> 标签：regex, vim

我在文件中有以下文本

```
23456789 
```

当我尝试使用命令替换上述文本时

```
1,$s/\(\d\)\(\d\d\d\)\(\d\d\)*\>/\3\g 
```

我越来越`89`。不应该`6789`吗？谁能告诉我为什么会这样`89`。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-14T11:58:29.947

如所写，您的正则表达式捕获一位数字，然后是三位数字，然后是任意数量的两位数组。因此，如果存在，第三个匹配项将始终为两位数。在您的特定测试用例中，“89”在 \4，而不是 \3。

将正则表达式更改为

```
 1,$s/\(\d\)\(\d\d\d\)\(\d\d\+\)\>/\3\g 
```

结果会给你'6789'，因为它会在第三组中捕获两个或更多数字（最多与那里一样多）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-14T12:32:58.660

你想在这里使用一个非捕获组，像这样

```
1,$s/\(\d\)\(\d\d\d\)\(\%(\d\d\)*\)\>/\3/g 
```

这里给出`6789`的结果，如果输入更改为

```
2345678 
```

会将行更改为`278`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-14T11:38:44.760

第 3 组定义为 2 位长。如果你想匹配你想要的最后 4 位数字，最后`\(\d\d\d\d\)`没有`*`。如果您只想匹配除前 4 位之外的所有数字，请将您的`*`放在组匹配内部而不是外部。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T12:35:34.973

你可能想要（需要一个额外的包装组）：

```
%s/\(\d\)\(\d\d\d\)\(\(\d\d\)*\)\>/\3\g 
```

虽然我不确定你为什么要捕获前两组。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-31T10:59:19.083

我已经在 nvi 中尝试过这个，但它不起作用。在 vim 中它可以工作，只是你必须更正 g 之前的最后一个倒破折号，用于破折号，如下所示：

`1,$s/\(\d\)\(\d\d\d\)\(\d\d\)*\>/\3/g`

它被替换为 89。原因是你用 * 说最后一个 \d\d​​ 可以重复零次、一次或多次，而用 > 你说的是结束词边界。对于第 3 组，您是说您想要 las 组，但由于 * 的 las 两位数 (\d\d) 是 89。取出 *> 可以得到 6789。像这样：

`1,$s/\(\d\)\(\d\d\d\)\(\d\d\)/\3/g`

当心 > 谁在扮演一个棘手的角色，因为这样: :`1,$s/\(\d\)\(\d\d\d\)\(\d\d\)\>/\3` 你会得到 2389 LOL！因为从字边界的角度来看，dddddd 匹配 456789，它被最后两个 dd 替换，即 89。所以你得到 23+89 令人震惊！哈哈

# perl - 如何使用 Perl 从 LDAP 服务器下载用户列表？

> ID：442653
> 
> 赞同：4
> 
> 时间：2009-01-14T11:33:03.743
> 
> 标签：perl, ldap, wiki

我想从我工作的 LDAP 服务器上传用户列表，以作为公司目录上传到我们的 wiki。如何使用 Perl 从 LDAP 服务器下载用户列表？

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-14T12:06:38.963

使用[NET::LDAP](http://ldap.perl.org/)模块。

[POD](http://search.cpan.org/~gbarr/perl-ldap/lib/Net/LDAP.pod)的一个小例子：

```
use Net::LDAP;

$ldap = Net::LDAP->new( 'ldap.bigfoot.com' ) or die "$@";

$mesg = $ldap->bind ;    # an anonymous bind

$mesg = $ldap->search( # perform a search
                       base   => "c=US",
                       filter => "(&(sn=Barr) (o=Texas Instruments))"
                     );
$mesg->code && die $mesg->error;

foreach $entry ($mesg->entries) { $entry->dump; }

$mesg = $ldap->unbind;   # take down session 
```

# silverlight - 如何将 XAML 中的资源字符串绑定到同一控件中的多个属性？

> ID：442655
> 
> 赞同：1
> 
> 时间：2009-01-14T11:35:36.983
> 
> 标签：silverlight, xaml, resources

是否可以将附加资源字符串绑定到控件中的另一个属性。我已经将一个属性绑定到资源，但还需要另一个。我看不到这样做的方法，因为我需要一个额外的 DataContext 但显然只能有一个。

我需要绑定的附加属性是超链接控件中的内容。

xaml 文件如下：-

```
<UserControl x:Class="SilverlightApplication1.Page"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
    xmlns:mystuff="clr-namespace:my.assembly.name;assembly=my.assembly.name"
    Width="100" Height="100">

    <UserControl.Resources>
        <mystuff:TxtResConv x:Key="TxtResConv" />
        <mystuff:TxtResPar x:Key="LabelTitle" ResourceUri="LabelTitle" DefaultValue="default label title" />
        <mystuff:TxtResPar x:Key="LinkURL" ResourceUri="LinkURL"  DefaultValue="default label title" />
    </UserControl.Resources>

   <Grid x:Name="LayoutRoot" Background="White">
            <HyperlinkButton DataContext="{StaticResource LinkURL}" x:Name="HyperLink1" Content="NEED TO ADD RESOURCE STRING LABELTITLE HERE !!" NavigateUri="{Binding Mode=OneWay,Converter={StaticResource TxtResConv}}"></HyperlinkButton>             
   </Grid>
</UserControl> 
```

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T17:20:13.387

使用绑定语法绑定到 Content 属性的方式与绑定到 NavigateUri 属性的方式相同。如果它来自与 LinkUri 不同的来源，那么您在绑定语法**Source**属性中指定：

```
Content="{Binding Source={StaticResource LabelTitle}, 
                  Converter={StaticResource TxtResConv}}" 
```

# c# - m_safeCertContext 是无效句柄

> ID：442658
> 
> 赞同：18
> 
> 时间：2009-01-14T11:37:39.333
> 
> 标签：c#, digital-signature, digital-certificate

我一直在努力解决一个问题，也许你们可以指出我正确的方向。

我正在尝试通过 https 连接在网络服务器上对 pdf 进行数字签名。

在页面加载时，我这样做：

```
HttpClientCertificate cs = Request.ClientCertificate;
X509Certificate card = new X509Certificate(cs.Certificate);
Org.BouncyCastle.X509.X509CertificateParser cp = new Org.BouncyCastle.X509.X509CertificateParser();
 Org.BouncyCastle.X509.X509Certificate[] chain = new Org.BouncyCastle.X509.X509Certificate[] { cp.ReadCertificate(card.GetRawCertData())}; 
```

我在最后一行代码中收到错误“m_safeCertContext 是无效句柄”。

请注意：

*   我使用 2 个完全不同的证书时遇到了同样的错误。
*   证书正在检索到“卡”变量 ok。
*   我曾经将卡转换为 X509Certificate2，但我昨天在某处读到，我无法通过转换为 X509Certificate 然后向下转换为 X509Certificate2 来解决该错误。这是那些“嗯……这没有任何意义，但我还没有尝试过”的时刻之一。
*   我试图向`[System.Security.SecurityCritical, System.Security.SecurityTreatAsSafe]`所有方法甚至类添加属性，以查看它是否可以工作......没有这样的运气。

谁能给我一个提示？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2013-11-21T19:45:39.547

每当您访问密码学中未初始化的字段时，都可能发生这种情况。

在您的代码中，如果返回一个没有原始证书数据的对象，那么您将在第四行`Request.ClientCertificate`调用时看到错误。`card.GetRawCertData()`

作为一个简单的测试，请尝试以下操作：

```
var cert = new System.Security.Cryptography.X509Certificates.X509Certificate2();
Console.WriteLine(cert.Thumbprint); 
```

这将引发以下异常，因为没有可用的指纹：

```
m_safeCertContext is an invalid handle. 
```

使用给定的堆栈跟踪：

```
at System.Security.Cryptography.X509Certificates.X509Certificate.ThrowIfContextInvalid()
at System.Security.Cryptography.X509Certificates.X509Certificate.SetThumbprint()
at System.Security.Cryptography.X509Certificates.X509Certificate.GetCertHashString()
at System.Security.Cryptography.X509Certificates.X509Certificate2.get_Thumbprint()
at MyEncryptionUtility.EncryptionUtilityForm.button1_Click(Object sender, EventArgs e) in C:\MyEncryptionUtility\EncryptionUtilityForm.cs:line 2864 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-12-12T14:58:11.040

看起来这不是您的问题，但对其他人而言：确保在尝试访问任何与证书相关的属性或方法之前不要调用 X509Certificate2.Reset() 。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-12-16T15:22:19.000

```
 public bool ReadCertFromSignedFile(X509Certificate2 cert, string filename)
    {
        if (!string.IsNullOrWhiteSpace(filename) && File.Exists(filename))
        {
            var cert509 = X509Certificate.CreateFromSignedFile(filename);
            cert = new X509Certificate2(cert509.GetRawCertData());

            return CheckSertificate(cert);
        }
        else
        { throw new Exception("Сертификат не заполнен"); }
    } 
```

从这样的另一个代码调用方法

```
 if (_digitalSignatureService.ReadCertFromSignedFile(fileCert, file.SignFilePath))
                 {
                    if (!cert.Equals(fileCert))
                    { 
```

等于 - 调用错误“m_safeCertContext 是无效句柄”。因为 X509Certificate 不存在

决定

```
 public bool ReadCertFromSignedFile(X509Certificate2 cert, string filename)
    {
        if (!string.IsNullOrWhiteSpace(filename) && File.Exists(filename))
        {
            var cert509 = X509Certificate.CreateFromSignedFile(filename);

            cert.Import(cert509.GetRawCertData()); 
```

此代码有效！

# sql-server-2008 - ADOMD.NET 9.0 可再发行？

> ID：442664
> 
> 赞同：1
> 
> 时间：2009-01-14T11:40:52.197
> 
> 标签：sql-server-2008, olap, redistributable, adomd.net

ADOMD.NET 8.0、SQL2008 和我们的应用程序出现问题。它没有给我们正确的元数据。

我找不到任何地方下载 ADOMD.NET 9.0 可再发行组件。我能得到它的唯一方法是安装 2008 并获取 DLL。

有什么线索吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T11:49:33.617

包含 ADOMD.NET 的 SQL 2008 功能包[在此处](http://www.microsoft.com/downloads/details.aspx?familyid=228de03f-3b5a-428a-923f-58a033d316e1&displaylang=en&tm)，其中包含指向各个 MSI 的链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-09T17:55:52.683

嗯，这是针对 v10 (2008) 而不是 v9 (2005) Microsoft ADOMD.NET

> ADOMD.NET 是一个 Microsoft .NET Framework 对象模型，使软件开发人员能够创建客户端应用程序来浏览存储在 Microsoft SQL Server 2008 Analysis Services 中的元数据和查询数据。ADOMD.NET 是一个 Microsoft ADO.NET 提供程序，具有在线分析处理 (OLAP) 和数据挖掘的增强功能。
> 
> 注意：英语 ADOMD.NET 安装包安装对所有 SQL Server 2008 语言的支持。
> 
> 受众：客户、合作伙伴、开发人员
> 
> ```
>  X86 Package(SQLSERVER2008_ASADOMD10.msi) - 4312 KB
>     X64 Package (SQLSERVER2008_ASADOMD10.msi) - 9263 KB
>     IA64 Package(SQLSERVER2008_ASADOMD10.msi) - 6776 KB 
> ```

有关2005 v9 版本，请参阅链接 [http://www.microsoft.com/download/en/details.aspx?id=15748](http://www.microsoft.com/download/en/details.aspx?id=15748)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-03-04T04:47:53.123

您也可以从[NuGet](http://Install-Package%20Microsoft.AnalysisServices.AdomdClient)安装它。

在包管理器控制台中运行以下命令：

```
Install-Package Microsoft.AnalysisServices.AdomdClient 
```

# workflow-foundation - WF 通过加载和卸载访问工作流实例变量

> ID：442666
> 
> 赞同：0
> 
> 时间：2009-01-14T11:40:57.033
> 
> 标签：workflow-foundation

在 workflowRuntime_WorkflowUnloaded 和 Loaded 等中。我能得到的唯一没用的是 workflowinstanceId。我希望能够访问根活动上的一些 DP，每当我执行 GetWorkFlowDefintion() 并转换为根活动时，我传入的所有属性都是空的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T11:45:29.613

您必须使用 TrackingServices 获得的不仅仅是基本信息。请参阅[http://msdn.microsoft.com/en-us/library/ms735887(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms735887(VS.85).aspx)

我们使用默认的 sqlTrackingService，将工作流托管在 Windows 服务中，它使用 wcf 公开，它是一个状态机工作流。

以下是我们在一种情况下使用它的方式：

```
SqlTrackingWorkflowInstance instance = null;
//wfServiceHost is an instance of WorkflowServiceHost
WorkflowRuntimeBehavior workflowRuntimeBehaviour = wfServiceHost.Description.Behaviors.Find<WorkflowRuntimeBehavior>();
WorkflowRuntime wfRuntime = workflowRuntimeBehaviour.WorkflowRuntime;

if (wfRuntime != null)
{
        SqlTrackingService trackingService = (SqlTrackingService)wfRuntime.GetService(typeof(SqlTrackingService));
        SqlTrackingQuery sqlTrackingQuery = new SqlTrackingQuery(trackingService.ConnectionString);

         sqlTrackingQuery.TryGetWorkflow(instanceId, out instance);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-30T22:46:43.933

好的，我已经设法使用上面的方法来检索工作流中的业务数据（即 ID），但我必须添加一个

```
this.TrackData("name", myObject) 
```

进入我在工作流程中的初始活动。

那时，我可以通过以下代码从`myObject`( ) 中获取 ID。`Job`伊皮！

```
foreach (UserTrackingRecord userTrackingRecord in
    sqlTrackingWorkflowInstance.UserEvents)
{
    Console.WriteLine("Key : {0}  Data : {1}",
        userTrackingRecord.UserDataKey,
        userTrackingRecord.UserData.ToString());
    if (userTrackingRecord.UserDataKey == "Job")
    {
        OrderRequest request = userTrackingRecord.UserData as OrderRequest;
        if (request != null)
        {
            Console.WriteLine("\nJob ID: {0}", request.JobID);
        }
    }
} 
```

# wpf - WPF vs WinForms 还是 Rich UI vs Stable Applications？您如何看待 Windows 窗体平台的未来？

> ID：442667
> 
> 赞同：12
> 
> 时间：2009-01-14T11:41:20.903
> 
> 标签：wpf, winforms

WPF 与 WinForms。您如何看待 Windows 窗体平台的未来？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-14T11:47:29.003

计算在一天的 WPF UI 开发过程中 VS.NET 2008 崩溃的次数以及在 winforms 开发期间它崩溃的次数。（在这里几乎不可能进行认真的 wpf 开发，即使在 sp1 之后它也会崩溃很多）。Winforms也有很多成熟的控件。当然它没有 wpf 的花哨闪亮的 3d 东西，但是对于 LoB 应用程序，无论如何你都不需要这些。再加上wpf的文字模糊问题，你就会明白wpf要成熟到可以替代winforms还有很长的路要走。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-14T13:36:08.033

我目前正在与我的第三个客户一起部署开发 WPF 应用程序。第一个是针对美国三大航运提供商之一的 LOB 申请，另外两个针对较小的公司。

我发现 Visual Studio 非常稳定，但我也从未在 Visual Studio 中使用设计器。Expression Blend 非常稳定，即使没有缺少设计师期望的许多功能。

WPF 的吸收肯定比 Visual Studio 和 .Net 中引入的语言功能慢，但它在许多方面都远优于 WinForms，并且将是未来。

去学习[WPF 的心态](http://cromwellhaus.com/blogs/ryanc/archive/2008/11/03/the-wpf-mindset.aspx)，你永远不会回去。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-14T13:28:27.037

Windows窗体是**本田**。

WPF 是**橙县直升机**。

与本田工厂的工人相比，制造定制的手工切碎机成本更高，手工完成所有这些组件需要更多的技能，需要艺术感、奉献精神和分配的工作量。 3个按钮和一辆自行车出来。

结果？

Orange County Chopper 独特、漂亮、与众不同，并成为拥有者的宠儿，但它也更难制造，成本更高，需要更多的建造者才能，而且不是每个人都能做到。

而这个咆哮的重点是？

如果您想在人群中脱颖而出并且您的客户负担得起，请使用 WPF ;-)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-14T13:37:17.533

我放弃了 WPF，因为 VStudio 2008 中的可视化编辑器速度太慢了！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-14T11:46:41.297

我自己的看法是，目前 WPF 的采用速度相当缓慢。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-14T11:52:53.390

我必须同意上面的两个帖子。此外，在微软开始真正在自己的产品中推动 WPF 之前，它不会真正起飞。在我看来，Microsoft dogfooding WPF 将导致他们真正解决阻碍它的问题：崩溃、文本问题和缺乏预建控件。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-14T20:54:17.743

我认为 WPF 的目标是一群不倾向于采用它的开发人员。我不相信 WPF 是为 CRUD 应用程序设计的。WPF 中的 CRUD 比 WinForms 更难。我已经看到了我不喜欢的数据绑定示例。您必须通过中间技术（如 CSLA）才能使其正常工作。

不，我认为 WPF 是为想要向公众发布超级流畅、超级精美的媒体 IDE 的开发人员设计的。不幸的是，这正是最受困于 C/C++ 并且最不接受托管代码的群体。为此，你不得不质疑微软的市场思维。

另一方面，微软吃自己的狗粮，新口味的小狗食物通常是对内部强烈要求更好东西的压力的回应。您可以看到为什么 Windows Media 组和 Zune 组都想要和想要 WPF。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-14T21:07:31.027

我曾在几个应用程序（一个 LOB，一个控制器 UI）上使用 WPF，我发现它非常优雅并且是一个高效的工具。数据绑定和嵌套控制元素容器模型非常强大。

它*与*Winforms 非常不同，并且有很大的学习曲线。但是，一旦您在学习曲线上取得了一些进展，您将永远不会再回到 WinForms ——当我想到使用 WinForms 时，我想，“*啊*！”

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-14T12:13:59.603

我已经使用过 WinForms 和 WPF，我必须同意 WPF 仍然需要大量工作才能成为 LoB 应用程序的首选 UI 平台。目前 WPF 对于创建具有丰富效果和动画的 UI 很有用，但即使这样也存在问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-14T13:17:48.367

I've seen MS's demo of a healthcare app using Silverlight and it is *gorgeous*. I would say that without a doubt it is the future as it builds upon the experiences of WinForm and restructures things to get around the problems of WinForm.

That said, at present WinForm is obviously more mature and probably has a shorter time to market due to the stability of the platform and wealth of resources, tools and knowledge.

I would expect that WinForm apps will slowly peter out within another decade but for now it is still a very viable platform.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-14T12:11:19.407

我想您必须查看 WPF 通过 Webforms 提供的功能。唯一想到的是 GUI 方面的更多可能性，但这又使 WPF 更加复杂。大多数 Webforms 应用程序的外观并不好，它们旨在以一种简单易懂的方式执行某些操作，而 WPF 并没有真正为您提供比 Webforms 更多的功能。

也许silverlight可以推动wpf。全屏 silverlight 应用程序（照片应用程序、办公应用程序、报告应用程序......）有很多有趣的可能性，它们当然可以轻松移植到 WPF 应用程序。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-14T11:58:07.547

虽然 WPF 的学习曲线有点长，但我认为人们已经开始认真考虑构建新应用程序。但是我们仍然需要一个认真的动机来从 Winforms 迁移到 WPF。

# post - 防止双重 HTTP POST

> ID：442678
> 
> 赞同：23
> 
> 时间：2009-01-14T11:47:06.290
> 
> 标签：post

我制作了一个用于注册活动的小应用程序。用户输入他们的数据并单击“登录”。

现在有时人们在数据库中是双重的，完全相同的数据在彼此之后非常快速地插入了 2 次。这只能意味着有人点击了两次按钮，这导致了两个帖子的发生。

这是常见的网络问题，因为信用卡应用程序和论坛应用程序经常说：“点击一次就够了！”。

我想您可以通过检查完全相同的数据以查看帖子是否唯一来解决它，但我想知道是否还有其他方法。

这当然不计入 ASP.NET 网络表单，因为 POST 并不重要。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-14T12:06:00.353

虽然 JavaScript 解决方案可以在单击提交按钮后禁用它，但这对禁用 JavaScript 的人没有影响。在添加 JavaScript 之前，您应该始终在没有 JavaScript 的情况下使其正常工作，否则没有意义，因为用户仍然可以通过禁用 JavaScript 来绕过检查。

如果表单出现的页面是动态生成的，您可以添加一个隐藏字段，其中包含某种序列号、散列或任何唯一内容。然后，您将进行一些服务器端验证，以检查具有该唯一值的请求是否已经进入。当用户提交表单时，将根据“使用”值列表检查唯一值。如果它存在于列表中，则它是一个欺骗请求并且可以被丢弃。如果它不存在，则将其添加到列表中并正常处理。只要确保该值是唯一的，这就保证了同一个表单不会被提交两次。

当然，如果表单所在的页面不是动态生成的，那么您需要在服务器端进行艰难的检查，以检查是否尚未提交相同的信息。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-01-14T12:00:19.773

到目前为止，大多数答案都是客户端的。在服务器端，您可以在第一次生成表单时生成带有 GUID 的隐藏字段，然后在收到帖子时将该 GUID 记录为提交的表单。在进行更多处理之前检查它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-14T11:49:44.863

用户端的解决方案是在第一次单击后通过 Javascript 禁用提交按钮。

它有缺点，但我看到它经常在电子商务网站上使用。

但是，它永远不会取代真正的服务器端验证。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-09-20T07:16:46.050

每当从服务器请求页面时，生成一个唯一的 requestToken ，将其保存在服务器端，将状态标记为未处理并将其与当前请求的页面一起传递。现在，每当页面提交发生时，从“POST”数据中获取 requestToken 并检查状态并保存数据或采取替代操作。

大多数银行应用程序都使用这种技术来防止重复“POST”。因此，这是一种经过时间验证且可靠的防止重复提交的方法。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-14T12:02:06.320

客户端技术很有用，但您可能希望将它与一些服务器端技术结合使用。

一种方法是在表单中包含一个唯一的令牌（例如[GUID](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)或类似的），以便在处理表单时可以检查该令牌是否已被使用，从而防止重复提交。

在您的情况下，如果您有一个包含活动访问者的表格，您可能会将此标记作为一列包含在内。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-14T20:40:20.800

正如这里的许多答案所述，仅客户端的解决方案是不够的。您需要使用服务器端故障保护。

禁用提交按钮不起作用的一个经常被忽视的原因是，用户可以简单地刷新提交目标（然后在“您确定要重新提交 POST 数据吗？”对话框上单击确定）。甚至，当您尝试将页面保存到磁盘时（例如，您尝试保存订单确认的硬拷贝），某些浏览器可能会隐式重新加载提交的页面。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-12-21T13:07:54.510

这些解决方案都没有解决负载平衡服务器。

如果您有一些负载均衡器，发送一个 UUID（或任何类型的唯一编号）到服务器以存储和再次读取将无法正常工作，如果服务器不知道其他服务器，因为每个请求可能由不同的服务器处理在无状态的环境中。这些服务器需要读/写到同一个地方。

如果您有多个服务器，您将需要在服务器之间有一些共享缓存（如 Redis），以便在同一位置读取/写入唯一值（这可能是一个过度设计的解决方案，但有效）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-12-11T16:58:25.567

几乎没有人禁用 js。考虑为双击每个链接和按钮的 70 岁女性编写您的电子商务网站。您要做的就是添加一个 javascript 以防止她单击“立即订购”两次。是的 - 在服务器端检查这个也是“防御性的” - 但不要为这种情况编写代码。但是为了更好的用户界面，也可以在客户端进行。

以下是我找到的一些脚本：

```
//
// prevent double-click on submit
//
  jQuery('input[type=submit]').click(function(){
    if(jQuery.data(this, 'clicked')){
      return false;
    }
    else{
      jQuery.data(this, 'clicked', true);
      return true;
    }
  }); 
```

和

```
// Find ALL <form> tags on your page
$('form').submit(function(){
    // On submit disable its submit button
    $('input[type=submit]', this).attr('disabled', 'disabled');
}); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-14T11:55:10.047

客户端更改是一种常用技术：

*   禁用提交按钮
*   将屏幕更改为“请稍候”屏幕
*   如果表单是模态的，将屏幕更改回它们通常的过程（这样做的好处是让事情看起来非常流畅）

但这并不完美。这一切都依赖于可用的 JS，如果不是这样，没有后端重复检测，你仍然会得到重复。

所以我的建议是在幕后开发某种检测*，然后*改进你的表单以阻止 JS 的人能够重复提交。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-14T11:55:38.393

您可以跟踪表单的提交次数，并将其与会话中带有表单的页面的唯一访问次数进行比较。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-14T20:33:41.250

除了已经提到的许多好的技术之外，另一种简单的服务器端方法，具有需要会话的缺点，是在第一次提交时关闭会话变量。

# c# - 与命令行应用程序交互的最佳方式

> ID：442680
> 
> 赞同：7
> 
> 时间：2009-01-14T11:47:57.723
> 
> 标签：c#, windows, .net-3.5

我需要为与命令行应用程序紧密交互的应用程序编写一个组件。命令行应用程序提出一系列问题，执行一些计算，然后终止（我需要检测）。本质上，我想将这种交互包装在一个包装类中。

过去有没有人取得过类似的成绩？如果是这样，你是怎么做的？你有没有注意到一种模式，或者可能有一些好的内置类可以使用？干杯!

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-14T11:49:45.957

您需要使用`Process`;重定向输入和输出流。处理两者都稍微棘手一些，因为您需要小心不要在缓冲区中丢失东西（导致死锁）。

*   MSDN：[重定向输入](http://msdn.microsoft.com/en-us/library/system.diagnostics.processstartinfo.redirectstandardinput.aspx)
*   MSDN：[重定向输出](http://msdn.microsoft.com/en-us/library/system.diagnostics.processstartinfo.redirectstandardoutput.aspx)
*   [这是](http://www.c-sharpcorner.com/UploadFile/edwinlima/SystemDiagnosticProcess12052005035444AM/SystemDiagnosticProcess.aspx)一个基本的替代示例。

您可能还想查看[OutputDataReceived](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.outputdatareceived.aspx)以获取基于事件的响应。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T12:38:50.350

如果所有应用程序都是在 dotnet 中开发的，则可以使用[Assembly 类](https://stackoverflow.com/questions/415620/redirect-console-output-to-textbox-in-separate-program-c#416293)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-01-15T02:52:48.010

当我的回答只是指向其他地方的链接时，我会感到厌烦。我看不出 C# Corner 文章的链接有多大帮助。

这个问题今天已经有 10 年了，但应该已经澄清了。该问题没有指定每个问题的末尾是否有行尾（CrLf）。假设有，如下所示：

```
string Answer;
Console.Out.WriteLine("First question: ");
Answer = Console.In.ReadLine();
Console.Out.WriteLine("Another question: ");
Answer = Console.In.ReadLine();
Console.Out.WriteLine("Final question: ");
Answer = Console.In.ReadLine(); 
```

然后可以使用以下内容对其进行响应：

```
class Program
{
    const string FirstQuestion = "First question: ";
    const string SecondQuestion = "Another question: ";
    const string FinalQuestion = "Final question: ";
    static AutoResetEvent Done = new AutoResetEvent(false);

    static void Main(string[] args)
    {
        const string TheProgram = @" ... ";
        Process p = new Process();
        ProcessStartInfo psi = new ProcessStartInfo(TheProgram);
        psi.UseShellExecute = false;
        psi.CreateNoWindow = true;
        psi.RedirectStandardInput = true;
        psi.RedirectStandardOutput = true;
        p.StartInfo = psi;
        Console.WriteLine("Executing " + TheProgram);
        p.Start();
        DoPromptsAsync(p);
        Done.WaitOne();
    }

    private static async Task DoPromptsAsync(Process p)
    {
        StreamWriter sw = p.StandardInput;
        StreamReader sr = p.StandardOutput;
        string Question;
        Question = await sr.ReadLineAsync();
        if (Question != FirstQuestion)
            return;
        sw.WriteLine("First answer");
        Console.WriteLine(Question + "answered");
        Question = await sr.ReadLineAsync();
        if (Question != SecondQuestion)
            return;
        sw.WriteLine("Second answer");
        Console.WriteLine(Question + "answered");
        Question = await sr.ReadLineAsync();
        if (Question != FinalQuestion)
            return;
        sw.WriteLine("Final answer");
        Console.WriteLine(Question + "answered");
        Done.Set();
    }
} 
```

以下适用于 WPF 应用程序；我使用双击事件进行测试，但这可以用于其他 WPF 事件。

```
const string TheProgram = @" ... ";
Process p = new Process();
ProcessStartInfo psi = new ProcessStartInfo(TheProgram);
psi.UseShellExecute = false;
//psi.CreateNoWindow = true;
psi.RedirectStandardInput = true;
psi.RedirectStandardOutput = true;
p.StartInfo = psi;
p.Start();
const string FirstQuestion = "First question: ";
const string SecondQuestion = "Another question: ";
const string FinalQuestion = "Final question: ";
StreamWriter sw = p.StandardInput;
StreamReader sr = p.StandardOutput;
string Question;
StringBuilder sb = new StringBuilder("Executing " + TheProgram + "\r\n");
Question = await sr.ReadLineAsync();
if (Question != FirstQuestion)
    return;
sw.WriteLine("First answer");
sb.Append(Question + "answered\r\n");
Question = await sr.ReadLineAsync();
if (Question != SecondQuestion)
    return;
sw.WriteLine("Second answer");
sb.Append(Question + "answered\r\n");
Question = await sr.ReadLineAsync();
if (Question != FinalQuestion)
    return;
sw.WriteLine("Final answer");
sb.Append(Question + "answered\r\n");
ResultBox.Text = sb.ToString(); 
```

我认为如果每个问题后没有行尾，情况会更复杂。

# json - 从jsp中的unicode转换为JSON的eval函数

> ID：442691
> 
> 赞同：0
> 
> 时间：2009-01-14T11:53:34.403
> 
> 标签：json, jsp, unicode

我从后端得到一个字符串（简化），应该是：

```
{ "menu": "Reallocate:"} 
```

然而对于jsp来说：

```
{ &amp;#034;menu&amp;#034;: &amp;#034;Reallocate:&amp;#034;} 
```

我不能把它传递给：

```
var data=eval("(" + src + ")"); 
```

因为它只是不喜欢它.. 我怎样才能转换这种可用的格式？

我知道：

```
src = '{ "menu": "Reallocate:"}';
var data=eval("(" + src + ")"); 
```

作品。

干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T12:04:44.957

也许您可以在传递给 eval 之前对其进行解码。Prototype Javascript 库在字符串类中有内置函数：http: [//prototypejs.org/api/string/unescapeHTML](http://prototypejs.org/api/string/unescapeHTML)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T12:39:09.583

用以下方法解决了这个问题：

```
src = '{ "menu": "Reallocate:"}';
fname = fname.replace(/&#034;/g,'"');   
document.getElementById("testout").value = fname; 
```

您也可以添加其他位来替换其他东西。:)

# oracle - com.ibm.websphere.jtaextensions.NotSupportedException 在负载下抛出

> ID：442697
> 
> 赞同：0
> 
> 时间：2009-01-14T11:56:58.860
> 
> 标签：oracle, hibernate, transactions, websphere, deadlock

我有一个包含 4 个 MDB 的应用程序，每个 MDB 通过 JMS 从 MQ 接收 SOAP 消息。收到消息后，我们将 XML 处理为对象模型并进行相应的处理，这始终涉及通过 Hibernate 将消息加载或保存到 Oracle 数据库。

此外，我们有一个石英进程，每分钟触发一次，可能会触发也可能不会触发这些动作，这些动作也可以使用 Hibernate 读取或写入数据库。

当系统处于高负载下时，即处理大量 1k + 并可能执行由我们的石英进程触发的一些数据库读/写，我们不断看到在我们的日志中抛出以下异常。

==================================================== ============================= 在 com.integrasp.iatrade.logic.MessageContextRouting.lookup(MessageContextRouting.java:150) 在 com .integrasp.iatrade.logic.RequestResponseManager.findRequestDestination(Reque stResponseManager.java:153) 在 com.integrasp.iatrade.logic.RequestResponseManager.findRequestDestination(请求 stResponseManager.java:174) 在 com.integrasp.iatrade.logic.IOLogic.processResponse (IOLogic.java:411)< br /> 在 com.integrasp.iatrade.logic.FxOrderQuoteManager.requestQuote(FxOrderQuoteManage r.java:119) 在 com.integrasp.iatrade.logic.FxOrderQuoteManager.processRequest(FxOrderQuoteMana ger.java:682) ) 在 com.integrasp.iatrade.eo.SubmitOrderRequest.process(SubmitOrderRequest.java:60) 在 com.integrasp.iatrade.ejb.BusinessLogicRegister.perform(BusinessLogicRegister.j ava:85) 在 com.integrasp.iatrade.ejb.mdb.OrderSubmissionBean.onMessage(OrderSubmissionBean .java:147) 在 com.ibm.ejs。 jms.listener.MDBWrapper$PriviledgedOnMessage.run(MDBWrapper.java:30 2) 在 com.ibm.ws.security.util.AccessController.doPrivileged(AccessController.java:63) 在 com.ibm.ejs.jms.listener.MDBWrapper .callOnMessage(MDBWrapper.java:271) 在 com.ibm.ejs.jms.listener.MDBWrapper.onMessage(MDBWrapper.java:240) 在 com.ibm.mq.jms.MQSession.run(MQSession.java:1593) 在com.ibm.ejs.jms.JMSSessionHandle.run(JMSSessionHandle.java:970) 在 com.ibm.ejs.jms.listener.ServerSession.connectionConsumerOnMessage(ServerSessio n.java:891) 在 com.ibm.ejs.jms.listener .ServerSession.onMessage(ServerSession.java:656) 在 com.ibm.ejs.jms.listener.ServerSession.dispatch(ServerSession.java:623) 在 sun.reflect.GeneratedMethodAccessor79.invoke(Unknown Source) 在 sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.ja va:43) 在 java.lang.reflect.Method.invoke(Method.java:615) 在com.ibm.ejs.jms.listener.ServerSessionDispatcher.dispatch(ServerSessionDispatch er.java:37) 在 com.ibm.ejs.container.MDBWrapper.onMessage(MDBWrapper.java:96) 在 com.ibm.ejs.container.MDBWrapper .onMessage(MDBWrapper.java:132) 在 com.ibm.ejs.jms.listener.ServerSession.run(ServerSession.java:481) 在 com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:1473 ) 引起：java.lang.reflect.Method.invoke( Method.java:615) 在 org.hibernate。transaction.WebSphereExtendedJTATransactionLookup$TransactionMana gerAdapter$TransactionAdapter.registerSynchronization(WebSphereExtendedJTATransa ctionLookup.java:225) ... 30 更多原因：com.ibm.websphere.jtaextensions.NotSupportedException at com.ibm.ws.jtaextensions.ExtendedJTATransactionImpl.registerSynchronizationCall backForCurrentTran(ExtendedJTATransactionI .java:247)

# ... 34 更多

任何机构都可以帮助阐明 com.ibm.websphere.jtaextensions.NotSupportedException 的含义。IBM 文档说

“如果尝试在环境中注册 SynchronizationCallback 或在此功能不可用时，事务管理器会抛出异常。”

对我来说，这听起来像是容器拒绝休眠调用以启动事务。如果有人对容器为什么会抛出消息有任何想法，请告诉我。

提前致谢

卡尔

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-14T16:58:18.283

如果你真的需要高负载，我会删除你的应用程序和数据库之间的 Hibernate 层。如果没有 Hibernate，您将拥有更少的移动部件和更多的控制权。

这是我能给你的唯一建议。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T20:47:09.067

如果有人感兴趣，那是在事务超时时尝试同步事务的线程。

我曾假设如果事务超时，那么线程将被杀死，但事实并非如此。

卡尔

# c# - 将可变大小的双精度数组从 C++ 返回到 C# - 一种更简单的方法？

> ID：442699
> 
> 赞同：3
> 
> 时间：2009-01-14T11:57:13.100
> 
> 标签：c#, c++, arrays, pinvoke

我有以下 C++ 方法：

__declspec(dllexport) void __stdcall getDoubles(int *count, double **values); 该方法分配并填充一个 double 数组并将 *count 设置为数组的大小。

我设法通过pinvoke让它工作的唯一方法是：

```
[System.Runtime.InteropServices.DllImportAttribute("xx.dll")]
 public static extern void getDoubles(ref int count, ref System.IntPtr values); 
```

用法是：

```
int count = 0;
IntPtr doubles = new IntPtr();
Nappy.getDoubles(ref count, ref doubles);
double[] dvs = new double[count];
for(int i = 0;i < count;++{
    dvs[i] = (double)Marshal.PtrToStructure(doubles, typeof(System.Double));
    doubles = new IntPtr(doubles.ToInt64()+Marshal.SizeOf(typeof(System.Double)));
} 
```

这些值最终出现在 dvs 数组中。有没有更好的方法来做到这一点而不涉及托管语言中的指针算术......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T12:32:38.163

我认为你可以使用

```
Marshal.Copy( source, destination, 0, size ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T12:56:21.873

您需要更改非托管方法签名，使其如下所示：

```
__declspec(dllexport) void __stdcall getDoubles(SAFEARRAY *array); 
```

然后您应该能够使用该功能的以下托管版本：

```
[System.Runtime.InteropServices.DllImportAttribute("xx.dll")]
public static extern void getDoubles(
              [MarshalAs(UnmanagedType.SafeArray, SafeArraySubType=VT_R8)]
              double[] array
); 
```

当然，您还必须重写非托管代码才能使用 SAFEARRAY。[可以在 MSDN 上找到](http://msdn.microsoft.com/en-us/library/z6cfh6e6.aspx)有关此主题的更多信息。

但是有一个问题，我记得在 C# 中使用 ZLib，它能够在没有任何包装器的情况下使用 byte[] 而非托管对应物是 BYTE*，您是否尝试过直接使用 double* / double[] ？

# javascript - 在 DOM 元素上查找使用 jQuery 添加的回调函数

> ID：442701
> 
> 赞同：2
> 
> 时间：2009-01-14T11:58:03.553
> 
> 标签：javascript, jquery, events, callback

我目前正在使用 FireBug 1.3.0 和 jQuery 1.2.6 在 Mozilla FireFox 3.0.5 中对此进行测试。

## 第一次尝试

```
document.getElementById("x").onfocus = function ()
{
    var helloWorld = "Hello World";
}; 
```

**FireBug 控制台：**

document.getElementById("helloworld").onfocus.toString() **= 函数体作为字符串**

$("#helloworld").get(0).onfocus.toString() **= 函数体作为字符串**

* * *

## 第二次尝试

```
$("#helloworld").focus(function ()
{
    var helloWorld = "Hello World";
}); 
```

**FireBug 控制台：**

document.getElementById("helloworld").onfocus.toString() **= FireBug 什么都不返回**

$("#helloworld").get(0).onfocus.toString() **= FireBug 什么也不返回**

* * *

我在这里想念什么？为什么在使用 jQuery 附加回调时找不到回调？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-14T12:51:53.037

要查看 jQuery 绑定的事件，请使用：

```
$("#helloworld").data('events'); 
```

如果您根据示例绑定焦点并在 firebug 控制台中运行上述内容，它将返回

```
Object focus=Object 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-14T12:25:50.797

jQuery 不直接附加回调，而是将它们内部存储在注册表中。每当触发事件时，jQuery 都会查看注册表并调用您之前要求的回调。

这为您提供了能够将多个回调叠加到单个元素的事件上的优势，但它的缺点是您**必须**使用 jQuery 的事件处理程序例程来设置、获取和删除回调。

# c# - 如何处理 ASP.NET MVC 框架中的多个提交按钮？

> ID：442704
> 
> 赞同：762
> 
> 时间：2009-01-14T11:58:36.140
> 
> 标签：c#, html, asp.net-mvc, http-post, form-submit

是否有一些简单的方法可以处理来自同一表单的多个提交按钮？例如：

```
<% Html.BeginForm("MyAction", "MyController", FormMethod.Post); %>
<input type="submit" value="Send" />
<input type="submit" value="Cancel" />
<% Html.EndForm(); %> 
```

知道如何在 ASP.NET Framework Beta 中执行此操作吗？我搜索过的所有示例中都有单个按钮。

* * *

## 回答 #1

> 赞同：656
> 
> 时间：2011-08-18T17:00:22.800

这是一个非常干净的基于属性的解决方案，主要基于[Maarten Balliauw](http://blog.maartenballiauw.be/post/2009/11/26/supporting-multiple-submit-buttons-on-an-aspnet-mvc-view.aspx)的帖子和评论。

```
[AttributeUsage(AttributeTargets.Method, AllowMultiple = false, Inherited = true)]
public class MultipleButtonAttribute : ActionNameSelectorAttribute
{
    public string Name { get; set; }
    public string Argument { get; set; }

    public override bool IsValidName(ControllerContext controllerContext, string actionName, MethodInfo methodInfo)
    {
        var isValidName = false;
        var keyValue = string.Format("{0}:{1}", Name, Argument);
        var value = controllerContext.Controller.ValueProvider.GetValue(keyValue);

        if (value != null)
        {
            controllerContext.Controller.ControllerContext.RouteData.Values[Name] = Argument;
            isValidName = true;
        }

        return isValidName;
    }
} 
```

剃刀：

```
<form action="" method="post">
 <input type="submit" value="Save" name="action:Save" />
 <input type="submit" value="Cancel" name="action:Cancel" />
</form> 
```

和控制器：

```
[HttpPost]
[MultipleButton(Name = "action", Argument = "Save")]
public ActionResult Save(MessageModel mm) { ... }

[HttpPost]
[MultipleButton(Name = "action", Argument = "Cancel")]
public ActionResult Cancel(MessageModel mm) { ... } 
```

*更新：* [Razor 页面](https://docs.microsoft.com/en-us/aspnet/core/mvc/razor-pages/#using-multiple-handlers)看起来提供了开箱即用的相同功能。对于新的发展，它可能是可取的。

* * *

## 回答 #2

> 赞同：483
> 
> 时间：2009-01-14T14:02:36.110

为提交按钮命名，然后在控制器方法中检查提交的值：

```
<% Html.BeginForm("MyAction", "MyController", FormMethod.Post); %>
<input type="submit" name="submitButton" value="Send" />
<input type="submit" name="submitButton" value="Cancel" />
<% Html.EndForm(); %> 
```

张贴到

```
public class MyController : Controller {
    public ActionResult MyAction(string submitButton) {
        switch(submitButton) {
            case "Send":
                // delegate sending to another controller action
                return(Send());
            case "Cancel":
                // call another action to perform the cancellation
                return(Cancel());
            default:
                // If they've submitted the form without a submitButton, 
                // just return the view again.
                return(View());
        }
    }

    private ActionResult Cancel() {
        // process the cancellation request here.
        return(View("Cancelled"));
    }

    private ActionResult Send() {
        // perform the actual send operation here.
        return(View("SendConfirmed"));
    }

} 
```

编辑：

要将此方法扩展为使用本地化站点，请将您的消息隔离在其他地方（例如，将资源文件编译为强类型资源类）

然后修改代码，使其工作如下：

```
<% Html.BeginForm("MyAction", "MyController", FormMethod.Post); %>
<input type="submit" name="submitButton" value="<%= Html.Encode(Resources.Messages.Send)%>" />
<input type="submit" name="submitButton" value="<%=Html.Encode(Resources.Messages.Cancel)%>" />
<% Html.EndForm(); %> 
```

你的控制器应该是这样的：

```
// Note that the localized resources aren't constants, so 
// we can't use a switch statement.

if (submitButton == Resources.Messages.Send) { 
    // delegate sending to another controller action
    return(Send());

} else if (submitButton == Resources.Messages.Cancel) {
     // call another action to perform the cancellation
     return(Cancel());
} 
```

* * *

## 回答 #3

> 赞同：122
> 
> 时间：2009-01-14T12:26:26.130

如前所述，您可以检查操作中的名称，但您可能会考虑这是否是好的设计。考虑动作的责任而不是将这种设计过多地与按钮名称等 UI 方面结合起来是一个好主意。所以考虑使用 2 个表格和 2 个动作：

```
<% Html.BeginForm("Send", "MyController", FormMethod.Post); %>
<input type="submit" name="button" value="Send" />
<% Html.EndForm(); %>

<% Html.BeginForm("Cancel", "MyController", FormMethod.Post); %>
<input type="submit" name="button" value="Cancel" />
<% Html.EndForm(); %> 
```

此外，在“取消”的情况下，您通常只是不处理表单，而是转到新的 URL。在这种情况下，您根本不需要提交表单，只需要一个链接：

```
<%=Html.ActionLink("Cancel", "List", "MyController") %> 
```

* * *

## 回答 #4

> 赞同：105
> 
> 时间：2009-01-20T21:30:38.437

Eilon 建议您可以这样做：

> 如果您有多个按钮，您可以通过为每个按钮命名来区分它们：
> 
> ```
> <input type="submit" name="SaveButton" value="Save data" />
> <input type="submit" name="CancelButton" value="Cancel and go back to main page" /> 
> ```
> 
> 在您的控制器操作方法中，您可以添加以 HTML 输入标记名称命名的参数：
> 
> ```
> public ActionResult DoSomeStuff(string saveButton, string
> cancelButton, ... other parameters ...)
> { ... } 
> ```
> 
> 如果任何值被发布到这些参数之一，这意味着该按钮是被点击的那个。Web 浏览器只会发布一个被点击的*按钮*的值。所有其他值都将为空。
> 
> ```
> if (saveButton != null) { /* do save logic */ }
> if (cancelButton != null) { /* do cancel logic */ } 
> ```

我喜欢这种方法，因为它不依赖于提交按钮的 value 属性，它比分配的名称更有可能改变，并且不需要启用 javascript

见： [http ://forums.asp.net/p/1369617/2865166.aspx#2865166](http://forums.asp.net/p/1369617/2865166.aspx#2865166)

* * *

## 回答 #5

> 赞同：46
> 
> 时间：2010-03-15T19:03:12.883

刚刚写了一篇关于这个的帖子： [Multiple submit buttons with ASP.NET MVC](http://blog.ashmind.com/index.php/2010/03/15/multiple-submit-buttons-with-asp-net-mvc-final-solution/)：

基本上，我使用的是 ，而不是`ActionMethodSelectorAttribute`using `ActionNameSelectorAttribute`，这让我可以假装动作名称是我想要的任何名称。幸运的是，`ActionNameSelectorAttribute`不仅让我指定动作名称，而且我可以选择当前动作是否匹配请求。

所以有我的课（顺便说一句，我不太喜欢这个名字）：

```
public class HttpParamActionAttribute : ActionNameSelectorAttribute {
    public override bool IsValidName(ControllerContext controllerContext, string actionName, MethodInfo methodInfo) {
        if (actionName.Equals(methodInfo.Name, StringComparison.InvariantCultureIgnoreCase))
            return true;

        if (!actionName.Equals("Action", StringComparison.InvariantCultureIgnoreCase))
            return false;

        var request = controllerContext.RequestContext.HttpContext.Request;
        return request[methodInfo.Name] != null;
    }
} 
```

要使用只需定义这样的表单：

```
<% using (Html.BeginForm("Action", "Post")) { %>
  <!— …form fields… -->
  <input type="submit" name="saveDraft" value="Save Draft" />
  <input type="submit" name="publish" value="Publish" />
<% } %> 
```

和控制器有两种方法

```
public class PostController : Controller {
    [HttpParamAction]
    [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult SaveDraft(…) {
        //…
    }

    [HttpParamAction]
    [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult Publish(…) {
        //…
    } 
} 
```

如您所见，该属性根本不需要您指定任何内容。此外，按钮的名称直接转换为方法名称。此外（我没有尝试过）这些也应该像正常操作一样工作，因此您可以直接发布到其中任何一个。

* * *

## 回答 #6

> 赞同：38
> 
> 时间：2016-05-28T09:41:50.990

它很短且套件：

> [Jeroen Dop](https://stackoverflow.com/a/19652874/3021180)回答了这个问题

```
<input type="submit" name="submitbutton1" value="submit1" />
<input type="submit" name="submitbutton2" value="submit2" /> 
```

并在后面的代码中这样做

```
 if( Request.Form["submitbutton1"] != null)
{
    // Code for function 1
}
else if(Request.Form["submitButton2"] != null )
{
       // code for function 2
} 
```

祝你好运。

* * *

## 回答 #7

> 赞同：35
> 
> 时间：2010-04-22T15:36:36.670

我建议有兴趣[的人看看 Maarten Balliauw 的解决方案](https://blog.maartenballiauw.be/post/2009/11/26/supporting-multiple-submit-buttons-on-an-aspnet-mvc-view.html)。我认为它非常优雅。

如果链接消失，它会使用`MultiButton`应用于控制器操作的属性来指示该操作应该与哪个按钮单击相关。

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2009-01-14T12:07:05.703

您应该能够命名按钮并给它们一个值；然后将此名称作为参数映射到操作。或者，使用 2 个单独的操作链接或 2 个表单。

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2009-01-14T12:11:58.827

你可以写：

```
<% Html.BeginForm("MyAction", "MyController", FormMethod.Post); %>
<input type="submit" name="button" value="Send" />
<input type="submit" name="button" value="Cancel" />
<% Html.EndForm(); %> 
```

然后在页面中检查名称==“发送”或名称==“取消”...

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2013-12-15T11:53:27.580

我不喜欢 ActionSelectName 的一点是，控制器中的每个操作方法都会调用 IsValidName。我不知道为什么它会这样工作。我喜欢这样一种解决方案，其中每个按钮根据其功能具有不同的名称，但我不喜欢动作方法中的参数必须与表单中的按钮一样多的事实。我为所有按钮类型创建了一个枚举：

```
public enum ButtonType
{
    Submit,
    Cancel,
    Delete
} 
```

我使用 ActionFilter 而不是 ActionSelectName：

```
public class MultipleButtonsEnumAttribute : ActionFilterAttribute
{
    public Type EnumType { get; set; }

    public MultipleButtonsEnumAttribute(Type enumType)
    {
        EnumType = enumType;
    }

    public override void OnActionExecuting(ActionExecutingContext filterContext)
    {
        foreach (var key in filterContext.HttpContext.Request.Form.AllKeys)
        {
            if (Enum.IsDefined(EnumType, key))
            {
                var pDesc = filterContext.ActionDescriptor.GetParameters()
                    .FirstOrDefault(x => x.ParameterType == EnumType);
                filterContext.ActionParameters[pDesc.ParameterName] = Enum.Parse(EnumType, key);
                break;
            }
        }
    }
} 
```

过滤器将在表单数据中找到按钮名称，如果按钮名称与枚举中定义的任何按钮类型匹配，它将在动作参数中找到 ButtonType 参数：

```
[MultipleButtonsEnumAttribute(typeof(ButtonType))]
public ActionResult Manage(ButtonType buttonPressed, ManageViewModel model)
{
    if (button == ButtonType.Cancel)
    {
        return RedirectToAction("Index", "Home");
    }
    //and so on
    return View(model)
} 
```

然后在视图中，我可以使用：

```
<input type="submit" value="Button Cancel" name="@ButtonType.Cancel" />
<input type="submit" value="Button Submit" name="@ButtonType.Submit" /> 
```

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2011-12-22T00:46:25.770

以下是最适合我的方法：

```
<input type="submit" value="Delete" name="onDelete" />
<input type="submit" value="Save" name="onSave" />

public ActionResult Practice(MyModel model, string onSave, string onDelete)
{
    if (onDelete != null)
    {
        // Delete the object
        ...
        return EmptyResult();
    }

    // Save the object
    ...
    return EmptyResult();
} 
```

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2014-02-27T15:44:12.993

如果您的浏览器支持输入按钮的属性formaction（IE 10+，不确定其他浏览器），那么以下应该可以工作：

```
@using (Html.BeginForm()){
    //put form inputs here

<input id="sendBtn" value="Send" type="submit" formaction="@Url.Action("Name Of Send Action")" />

<input id="cancelBtn" value="Cancel" type="submit" formaction="@Url.Action("Name of Cancel Action") />

} 
```

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2014-04-30T11:48:12.260

我也遇到了这个“问题”，但通过添加`name`属性找到了一个相当合乎逻辑的解决方案。我不记得在其他语言中有这个问题。

[http://www.w3.org/TR/html401/interact/forms.html#h-17.13.2](http://www.w3.org/TR/html401/interact/forms.html#h-17.13.2)

*   ...
*   如果一个表单包含多个提交按钮，只有激活的提交按钮是成功的。
*   ...

`value`这意味着可以更改、本地化、国际化以下代码属性，而*无需*额外的代码检查强类型资源文件或常量。

```
<% Html.BeginForm("MyAction", "MyController", FormMethod.Post); %>
<input type="submit" name="send" value="Send" />
<input type="submit" name="cancel" value="Cancel" />
<input type="submit" name="draft" value="Save as draft" />
<% Html.EndForm(); %>` 
```

在接收端，您只需要检查是否有任何已知的提交类型`null`

```
public ActionResult YourAction(YourModel model) {

    if(Request["send"] != null) {

        // we got a send

    }else if(Request["cancel"]) {

        // we got a cancel, but would you really want to post data for this?

    }else if(Request["draft"]) {

        // we got a draft

    }

} 
```

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2011-11-08T10:43:34.660

如果对 HTML 5 的使用没有限制，可以使用带有Attribute的`<button>`标签：`formaction`

```
<form action="demo_form.asp" method="get">
   First name: <input type="text" name="fname" /><br />
   Last name: <input type="text" name="lname" /><br />
   <button type="submit">Submit</button><br />
   <button type="submit" formaction="demo_admin.asp">Submit as admin</button>
</form> 
```

参考：[http ://www.w3schools.com/html5/att_button_formaction.asp](http://www.w3schools.com/html5/att_button_formaction.asp)

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2015-05-20T14:37:15.160

您可以通过三种方式解决上述问题

1.  HTML方式
2.  jQuery方式
3.  “ActionNameSelectorAttribute”方式

下面是一个视频，它以演示的方式总结了所有三种方法。

[https://www.facebook.com/shivprasad.koirala/videos/vb.100002224977742/809335512483940](https://www.facebook.com/shivprasad.koirala/videos/vb.100002224977742/809335512483940)

**HTML方式：-**

在 HTML 方式中，我们需要创建两个表单并在每个表单中放置“提交”按钮。并且每个表单的动作都将指向不同/各自的动作。您可以看到下面的代码，第一个表单发布到“Action1”，第二个表单将发布到“Action2”，具体取决于单击了哪个“提交”按钮。

```
<form action="Action1" method=post>
<input type=”submit” name=”Submit1”/>
</form>

<form action="Action2" method=post>
<input type=”submit” name=”Submit2”&gt;
</form> 
```

**阿贾克斯方式：-**

如果您是 Ajax 爱好者，那么第二个选项会让您更加兴奋。在 Ajax 方式中，我们可以创建两个不同的函数“Fun1”和“Fun1”，见下面的代码。这些函数将使用 JQUERY 或任何其他框架进行 Ajax 调用。这些函数中的每一个都与“提交”按钮的“OnClick”事件绑定。这些函数中的每一个都调用相应的操作名称。

```
<Script language="javascript">
function Fun1()
{
$.post(“/Action1”,null,CallBack1);
}
function Fun2()
{
$.post(“/Action2”,null,CallBack2);
}
</Script>

<form action="/Action1" method=post>
<input type=submit name=sub1 onclick=”Fun2()”/>
</form>
<form action="/Action2" method=post>
<input type=submit name=sub2 onclick=”Fun1()”/>
</form> 
```

**使用“ActionNameSelectorAttribute”：-**

这是一个很棒而且很干净的选择。“ActionNameSelectorAttribute”是一个简单的属性类，我们可以在其中编写决策逻辑来决定可以执行哪些操作。

所以第一件事是在 HTML 中，我们需要将正确的名称放在提交按钮上，以便在服务器上识别它们。

您可以看到我们在按钮名称中添加了“保存”和“删除”。您还可以注意到在操作中我们刚刚输入了控制器名称“客户”而不是特定的操作名称。我们期望动作名称将由“ActionNameSelectorAttribute”决定。

```
<form action=”Customer” method=post>
<input type=submit value="Save" name="Save" /> <br />
<input type=submit value="Delete" name="Delete"/>
</form> 
```

因此，当单击提交按钮时，它首先会点击“ActionNameSelector”属性，然后根据触发的提交，它会调用适当的操作。

![在此处输入图像描述](https://i.stack.imgur.com/mrw4H.png)

所以第一步是创建一个继承自“ActionNameSelectorAttribute”类的类。在这个类中，我们创建了一个简单的属性“Name”。

我们还需要重写返回 true 或 flase 的“IsValidName”函数。这个函数是我们编写一个动作是否必须执行的逻辑的地方。因此，如果此函数返回 true，则执行该操作，否则不执行。

```
public class SubmitButtonSelector : ActionNameSelectorAttribute
    {
        public string Name { get; set; }
        public override bool IsValidName(ControllerContext controllerContext, string actionName, System.Reflection.MethodInfo methodInfo)
        {
            // Try to find out if the name exists in the data sent from form
var value = controllerContext.Controller.ValueProvider.GetValue(Name);
            if (value != null)
            {
                return true;
            }
            return false;

        }
    } 
```

上述函数的主要核心在下面的代码中。“ValueProvider”集合包含表单中发布的所有数据。因此它首先查找“Name”值，如果在 HTTP 请求中找到它，则返回 true，否则返回 false。

```
var value = controllerContext.Controller.ValueProvider.GetValue(Name);
if (value != null)
      {
        return true;
      }
      return false; 
```

然后可以在相应的操作上装饰此属性类，并可以提供相应的“名称”值。因此，如果提交正在点击此操作并且如果名称与 HTML 提交按钮名称匹配，则它会进一步执行该操作，否则它不会执行。

```
public class CustomerController : Controller
{
        [SubmitButtonSelector(Name="Save")]
        public ActionResult Save()
        {
            return Content("Save Called");
        }
        [SubmitButtonSelector(Name = "Delete")]
        public ActionResult Delete()
        {
            return Content("Delete Called");
        }
} 
```

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2009-06-26T09:35:26.447

David Findley 在他的 ASP.Net 博客上写了关于执行此操作的 3 个不同选项。

阅读文章[多个按钮以相同的形式](http://weblogs.asp.net/dfindley/archive/2009/05/31/asp-net-mvc-multiple-buttons-in-the-same-form.aspx)查看他的解决方案，以及每个按钮的优缺点。恕我直言，他提供了一个非常优雅的解决方案，它利用了您装饰动作的属性。

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2010-11-01T21:20:29.300

这是我将使用的技术，我还没有在这里看到它。启发此解决方案的链接（由 Saajid Ismail 发布）是[http://weblogs.asp.net/dfindley/archive/2009/05/31/asp-net-mvc-multiple-buttons-in-the-same-form .aspx](http://weblogs.asp.net/dfindley/archive/2009/05/31/asp-net-mvc-multiple-buttons-in-the-same-form.aspx)）。它适应了 Dylan Beattie 的回答，可以毫无问题地进行本地化。

在视图中：

```
<% Html.BeginForm("MyAction", "MyController", FormMethod.Post); %>
<button name="button" value="send"><%: Resources.Messages.Send %></button>
<button name="button" value="cancel"><%: Resources.Messages.Cancel %></button>
<% Html.EndForm(); %> 
```

在控制器中：

```
public class MyController : Controller 
{
    public ActionResult MyAction(string button)
    {
         switch(button)
         {
             case "send":
                 this.DoSend();
                 break;
             case "cancel":
                 this.DoCancel();
                 break;
         }
    }
} 
```

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2012-02-26T06:39:56.757

此脚本允许指定一个 data-form-action 属性，该属性将在所有浏览器中用作 HTML5 formaction 属性（以一种不显眼的方式）：

```
$(document).on('click', '[type="submit"][data-form-action]', function(event) {
    var $this = $(this),
    var formAction = $this.attr('data-form-action'),
    $form = $($this.closest('form'));
    $form.attr('action', formAction);             
}); 
```

包含按钮的表单将发布到 data-form-action 属性中指定的 URL：

```
<button type="submit" data-form-action="different/url">Submit</button> 
```

这需要 jQuery 1.7。对于以前的版本，您应该使用`live()`而不是`on()`.

* * *

## 回答 #19

> 赞同：7
> 
> 时间：2018-01-30T14:50:07.730

```
[HttpPost]
public ActionResult ConfirmMobile(string nameValueResend, string nameValueSubmit, RegisterModel model)
    {
        var button = nameValueResend ?? nameValueSubmit;
        if (button == "Resend")
        {

        }
        else
        {

        }
    }

    Razor file Content:
    @using (Html.BeginForm()
    {
        <div class="page registration-result-page">

            <div class="page-title">
                <h1> Confirm Mobile Number</h1>
            </div>

            <div class="result">
                @Html.EditorFor(model => model.VefificationCode)
                @Html.LabelFor(model => model.VefificationCode, new { })
                @Html.ValidationMessageFor(model => model.VefificationCode)
            </div>
            <div class="buttons">
                <button type="submit" class="btn" name="nameValueResend" value="Resend">
                    Resend
                </button>
                <button type="submit" class="btn" name="nameValueSubmit" value="Verify">
                    Submit
                </button>

            </div>
            </div>

    } 
```

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2011-02-19T00:49:47.963

这是我编写的用于处理多个图像和/或文本按钮的扩展方法。

这是图像按钮的 HTML：

```
<input id="btnJoin" name="Join" src="/content/images/buttons/btnJoin.png" 
       type="image"> 
```

或文本提交按钮：

```
<input type="submit" class="ui-button green" name="Submit_Join" value="Add to cart"  />
<input type="submit" class="ui-button red" name="Submit_Skip" value="Not today"  /> 
```

这是您从控制器调用的扩展方法`form.GetSubmitButtonName()`。对于图像按钮，它会查找带有`.x`（表示单击图像按钮）的表单参数并提取名称。对于常规`input`按钮，它会查找以开头的名称`Submit_`并从中提取命令。因为我正在抽象出确定“命令”的逻辑，所以您可以在客户端上的图像+文本按钮之间切换，而无需更改服务器端代码。

```
public static class FormCollectionExtensions
{
    public static string GetSubmitButtonName(this FormCollection formCollection)
    {
        return GetSubmitButtonName(formCollection, true);
    }

    public static string GetSubmitButtonName(this FormCollection formCollection, bool throwOnError)
    {
        var imageButton = formCollection.Keys.OfType<string>().Where(x => x.EndsWith(".x")).SingleOrDefault();
        var textButton = formCollection.Keys.OfType<string>().Where(x => x.StartsWith("Submit_")).SingleOrDefault();

        if (textButton != null)
        {
            return textButton.Substring("Submit_".Length);
        }

        // we got something like AddToCart.x
        if (imageButton != null)
        {
            return imageButton.Substring(0, imageButton.Length - 2);
        }

        if (throwOnError)
        {
            throw new ApplicationException("No button found");
        }
        else
        {
            return null;
        }
    }
} 
```

**注意：**对于文本按钮，您必须在名称前加上`Submit_`. 我更喜欢这种方式，因为这意味着您可以更改文本（显示）值而无需更改代码。与`SELECT`元素不同，`INPUT`按钮只有一个“值”，没有单独的“文本”属性。我的按钮在不同的上下文中说不同的东西 - 但映射到相同的“命令”。我更喜欢以这种方式提取名称，而不是必须为`== "Add to cart"`.

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2012-12-14T15:50:50.943

我没有足够的代表在正确的地方发表评论，但我花了一整天的时间在这上面，所以想分享。

在尝试实施“MultipleButtonAttribute”解决方案时`ValueProvider.GetValue(keyValue)`会错误地返回`null`。

原来我引用的是 System.Web.MVC 版本 3.0，而它应该是 4.0（其他程序集是 4.0）。我不知道为什么我的项目没有正确升级并且我没有其他明显的问题。

所以如果你`ActionNameSelectorAttribute`不工作......检查一下。

* * *

## 回答 #22

> 赞同：6
> 
> 时间：2015-11-12T02:22:12.730

我参加聚会已经很晚了，但是这里……我的实现借鉴了@mkozicki，但需要较少的硬编码字符串才能出错。 **需要框架 4.5+**。本质上，控制器方法名称应该是路由的关键。

**标记**。按钮名称必须键入`"action:[controllerMethodName]"`

（注意 C#6 [nameof](https://msdn.microsoft.com/en-us/library/dn986596.aspx) API 的使用，它为您希望调用的控制器方法的名称提供特定类型的引用。

```
<form>
    ... form fields ....
    <button name="action:@nameof(MyApp.Controllers.MyController.FundDeathStar)" type="submit" formmethod="post">Fund Death Star</button>
    <button name="action:@nameof(MyApp.Controllers.MyController.HireBoba)" type="submit" formmethod="post">Hire Boba Fett</button>
</form> 
```

**控制器**：

```
namespace MyApp.Controllers
{
    class MyController
    {    
        [SubmitActionToThisMethod]
        public async Task<ActionResult> FundDeathStar(ImperialModel model)
        {
            await TrainStormTroopers();
            return View();
        }

        [SubmitActionToThisMethod]
        public async Task<ActionResult> HireBoba(ImperialModel model)
        {
            await RepairSlave1();
            return View();
        }
    }
} 
```

**属性魔法**。注意[`CallerMemberName`](https://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.callermembernameattribute(v=vs.110).aspx)善的使用。

```
[AttributeUsage(AttributeTargets.Method, AllowMultiple = false, Inherited = true)]
public class SubmitActionToThisMethodAttribute : ActionNameSelectorAttribute
{        
    public SubmitActionToThisMethodAttribute([CallerMemberName]string ControllerMethodName = "")
    {
        controllerMethod = ControllerMethodName;
        actionFormat = string.Concat(actionConstant, ":", controllerMethod);
    }
    const string actionConstant = "action";
    readonly string actionFormat;
    readonly string controllerMethod;

    public override bool IsValidName(ControllerContext controllerContext, string actionName, MethodInfo methodInfo)
    {
        var isValidName = false;
        var value = controllerContext.Controller.ValueProvider.GetValue(actionFormat);

        if (value != null)
        {
            controllerContext.Controller.ControllerContext.RouteData.Values[actionConstant] = controllerMethod;
            isValidName = true;
        }
        return isValidName;
    }
} 
```

* * *

## 回答 #23

> 赞同：5
> 
> 时间：2011-11-24T11:49:43.560

这是我发现的最好方法：

[http://iwayneo.blogspot.co.uk/2013/10/aspnet-mvc-action-selector-with-list.html](http://iwayneo.blogspot.co.uk/2013/10/aspnet-mvc-action-selector-with-list.html)

这是代码：

```
 /// <summary>
    /// ActionMethodSelector to enable submit buttons to execute specific action methods.
    /// </summary>
    public class AcceptParameterAttribute : ActionMethodSelectorAttribute
   {
        /// <summary>
        /// Gets or sets the value to use to inject the index into
        /// </summary>
       public string TargetArgument { get; set; }

       /// <summary>
       /// Gets or sets the value to use in submit button to identify which method to select. This must be unique in each controller.
       /// </summary>
       public string Action { get; set; }

       /// <summary>
       /// Gets or sets the regular expression to match the action.
       /// </summary>
       public string ActionRegex { get; set; }

       /// <summary>
       /// Determines whether the action method selection is valid for the specified controller context.
       /// </summary>
       /// <param name="controllerContext">The controller context.</param>
       /// <param name="methodInfo">Information about the action method.</param>
       /// <returns>true if the action method selection is valid for the specified controller context; otherwise, false.</returns>
       public override bool IsValidForRequest(ControllerContext controllerContext, MethodInfo methodInfo)
       {

           if (controllerContext == null)
           {
               throw new ArgumentNullException("controllerContext");
           }

           Func<NameValueCollection> formGetter;
           Func<NameValueCollection> queryStringGetter;

           ValidationUtility.GetUnvalidatedCollections(HttpContext.Current, out formGetter, out queryStringGetter);

           var form = formGetter();
           var queryString = queryStringGetter();

           var req = form.AllKeys.Any() ? form : queryString;

           if (!string.IsNullOrEmpty(this.ActionRegex))
           {
               foreach (var key in req.AllKeys.Where(k => k.StartsWith(Action, true, System.Threading.Thread.CurrentThread.CurrentCulture)))
               {
                   if (key.Contains(":"))
                   {
                       if (key.Split(':').Count() == this.ActionRegex.Split(':').Count())
                       {
                           bool match = false;
                           for (int i = 0; i < key.Split(':').Count(); i++)
                           {
                               if (Regex.IsMatch(key.Split(':')[0], this.ActionRegex.Split(':')[0]))
                               {
                                   match = true;
                               }
                               else
                               {
                                   match = false;
                                   break;
                               }
                           }

                           if (match)
                           {
                               return !string.IsNullOrEmpty(req[key]);
                           }
                       }
                   }
                   else
                   {
                       if (Regex.IsMatch(key, this.Action + this.ActionRegex))
                       {
                           return !string.IsNullOrEmpty(req[key]);
                       }
                   }

               }
               return false;
           }
           else
           {
               return req.AllKeys.Contains(this.Action);
           }
       }
   } 
```

享受无代码气味的多提交按钮的未来。

谢谢你

* * *

## 回答 #24

> 赞同：5
> 
> 时间：2012-09-26T16:34:26.540

我尝试综合所有解决方案并创建了一个 [ButtenHandler] 属性，可以轻松处理表单上的多个按钮。

我已经[在 ASP.NET MVC 中的 CodeProject Multiple parameterized (localizable) form buttons 中](http://www.codeproject.com/Articles/464178/Multiple-parameterized-localizable-form-buttons-in)描述了它。

要处理此按钮的简单情况：

```
<button type="submit" name="AddDepartment">Add Department</button> 
```

您将拥有类似于以下操作方法的内容：

```
[ButtonHandler()]
public ActionResult AddDepartment(Company model)
{
    model.Departments.Add(new Department());
    return View(model);
} 
```

请注意按钮的名称如何与操作方法的名称匹配。本文还介绍了如何使按钮具有值和具有索引的按钮。

* * *

## 回答 #25

> 赞同：5
> 
> 时间：2013-02-26T05:33:10.937

```
//model
    public class input_element
        {
         public string Btn { get; set; }
        }   

//views--submit btn can be input type also...
    @using (Html.BeginForm())
    {
            <button type="submit" name="btn" value="verify">
             Verify data</button>
            <button type="submit" name="btn" value="save">
             Save data</button>    
            <button type="submit" name="btn" value="redirect">
                 Redirect</button>
    }

//controller

    public ActionResult About()
        {
            ViewBag.Message = "Your app description page.";
            return View();
        }

        [HttpPost]
        public ActionResult About(input_element model)
        {
                if (model.Btn == "verify")
                {
                // the Verify button was clicked
                }
                else if (model.Btn == "save")
                {
                // the Save button was clicked
                } 
                else if (model.Btn == "redirect")
                {
                // the Redirect button was clicked
                } 
                return View();
        } 
```

* * *

## 回答 #26

> 赞同：4
> 
> 时间：2013-10-17T18:19:00.113

方法的修改版本，`HttpParamActionAttribute`但修复了在过期/无效会话回发时不会导致错误的错误。要查看这是否是您当前站点的问题，请在窗口中打开您的表单，然后在您单击`Save`或之前`Publish`，打开一个重复的窗口，然后注销。现在回到您的第一个窗口并尝试使用任一按钮提交您的表单。对我来说，我遇到了一个错误，所以这个更改为我解决了这个问题。为了简洁起见，我省略了一堆东西，但你应该明白这一点。关键部分是包含`ActionName`在属性上，并确保传入的名称是显示表单的视图的名称

**属性类**

```
[AttributeUsage(AttributeTargets.Method, AllowMultiple = false, Inherited = true)]
public class HttpParamActionAttribute : ActionNameSelectorAttribute
{
    private readonly string actionName;

    public HttpParamActionAttribute(string actionName)
    {
        this.actionName = actionName;
    }

    public override bool IsValidName(ControllerContext controllerContext, string actionName, MethodInfo methodInfo)
    {
        if (actionName.Equals(methodInfo.Name, StringComparison.InvariantCultureIgnoreCase))
            return true;

        if (!actionName.Equals(this.actionName, StringComparison.InvariantCultureIgnoreCase))
            return false;

        var request = controllerContext.RequestContext.HttpContext.Request;
        return request[methodInfo.Name] != null;
    }
} 
```

**控制器**

```
[Authorize(Roles="CanAddContent")]
public ActionResult CreateContent(Guid contentOwnerId)
{
    var viewModel = new ContentViewModel
    {
        ContentOwnerId = contentOwnerId
        //populate rest of view model
    }
    return View("CreateContent", viewModel);
}

[Authorize(Roles="CanAddContent"), HttpPost, HttpParamAction("CreateContent"), ValidateAntiForgeryToken]
public ActionResult SaveDraft(ContentFormModel model)
{
    //Save as draft
    return RedirectToAction("CreateContent");
}

[Authorize(Roles="CanAddContent"), HttpPost, HttpParamAction("CreateContent"), ValidateAntiForgeryToken]
public ActionResult Publish(ContentFormModel model)
{
    //publish content
    return RedirectToAction("CreateContent");
} 
```

**看法**

```
@using (Ajax.BeginForm("CreateContent", "MyController", new { contentOwnerId = Model.ContentOwnerId }))
{
    @Html.AntiForgeryToken()
    @Html.HiddenFor(x => x.ContentOwnerId)

    <!-- Rest of your form controls -->
    <input name="SaveDraft" type="submit" value="SaveDraft" />
    <input name="Publish" type="submit" value="Publish" />
} 
```

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2011-10-19T15:19:54.030

我使用扩展方法的 JQuery 方法：

```
public static MvcHtmlString SubmitButtonFor<TController>(this HtmlHelper helper, Expression<Action<TController>> action, string value) where TController : Controller
{
    RouteValueDictionary routingValues = Microsoft.Web.Mvc.Internal.ExpressionHelper.GetRouteValuesFromExpression(action);

    var onclick = string.Format("$('form').first().attr('action', '/{0}')", string.Join("/", routingValues.Values.ToArray().Where(x => x != null).Select(x => x.ToString()).ToArray()));
    var html = "<input type=\"submit\" value=\"" + value + "\" onclick=\"" + onclick + "\" />";

    return MvcHtmlString.Create(html);
} 
```

你可以像这样使用它：

```
@(Html.SubmitButtonFor<FooController>(c => c.Save(null), "Save")) 
```

它呈现如下：

```
<input type="submit" value="Save" onclick="$('form').first().attr('action', '/Foo/Save')" > 
```

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2012-07-24T17:23:39.747

对于每个提交按钮，只需添加：

```
$('#btnSelector').click(function () {

    $('form').attr('action', "/Your/Action/);
    $('form').submit();

}); 
```

* * *

## 回答 #29

> 赞同：3
> 
> 时间：2013-09-26T05:35:04.437

根据 mkozicki 的回答，我想出了一些不同的解决方案。我仍然使用`ActionNameSelectorAttribute`但我需要处理两个按钮“保存”和“同步”。他们做的几乎一样，所以我不想有两个动作。

**属性**：

```
public class MultipleButtonActionAttribute : ActionNameSelectorAttribute
{        
    private readonly List<string> AcceptedButtonNames;

    public MultipleButtonActionAttribute(params string[] acceptedButtonNames)
    {
        AcceptedButtonNames = acceptedButtonNames.ToList();
    }

    public override bool IsValidName(ControllerContext controllerContext, string actionName, MethodInfo methodInfo)
    {            
        foreach (var acceptedButtonName in AcceptedButtonNames)
        {
            var button = controllerContext.Controller.ValueProvider.GetValue(acceptedButtonName);
            if (button == null)
            {
                continue;
            }                
            controllerContext.Controller.ControllerContext.RouteData.Values.Add("ButtonName", acceptedButtonName);
            return true;
        }
        return false;
    }
} 
```

**看法**

```
<input type="submit" value="Save" name="Save" />
<input type="submit" value="Save and Sync" name="Sync" /> 
```

**控制器**

```
 [MultipleButtonAction("Save", "Sync")]
 public ActionResult Sync(OrgSynchronizationEditModel model)
 {
     var btn = this.RouteData.Values["ButtonName"]; 
```

我还想指出，如果行动做不同的事情，我可能会关注 mkozicki 的帖子。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2015-10-16T10:48:10.407

我为**HtmlHelper创建了一个****ActionButton**方法。它将在**OnClick 事件中生成带有一点****javascript**的普通输入按钮，该按钮会将表单提交到指定的 Controller/Action。

 ******你像这样使用助手

```
@Html.ActionButton("MyControllerName", "MyActionName", "button text") 
```

这将生成以下 HTML

```
<input type="button" value="button text" onclick="this.form.action = '/MyWebsiteFolder/MyControllerName/MyActionName'; this.form.submit();"> 
```

这是扩展方法代码：

**VB.Net**

```
<System.Runtime.CompilerServices.Extension()>
Function ActionButton(pHtml As HtmlHelper, pAction As String, pController As String, pRouteValues As Object, pBtnValue As String, pBtnName As String, pBtnID As String) As MvcHtmlString
    Dim urlHelperForActionLink As UrlHelper
    Dim btnTagBuilder As TagBuilder

    Dim actionLink As String
    Dim onClickEventJavascript As String

    urlHelperForActionLink = New UrlHelper(pHtml.ViewContext.RequestContext)
    If pController <> "" Then
        actionLink = urlHelperForActionLink.Action(pAction, pController, pRouteValues)
    Else
        actionLink = urlHelperForActionLink.Action(pAction, pRouteValues)
    End If
    onClickEventJavascript = "this.form.action = '" & actionLink & "'; this.form.submit();"

    btnTagBuilder = New TagBuilder("input")
    btnTagBuilder.MergeAttribute("type", "button")

    btnTagBuilder.MergeAttribute("onClick", onClickEventJavascript)

    If pBtnValue <> "" Then btnTagBuilder.MergeAttribute("value", pBtnValue)
    If pBtnName <> "" Then btnTagBuilder.MergeAttribute("name", pBtnName)
    If pBtnID <> "" Then btnTagBuilder.MergeAttribute("id", pBtnID)

    Return MvcHtmlString.Create(btnTagBuilder.ToString(TagRenderMode.Normal))
End Function 
```

**C#**（C#代码只是从VB DLL反编译出来的，所以可以得到一些美化......但是时间太短了:-)）

```
public static MvcHtmlString ActionButton(this HtmlHelper pHtml, string pAction, string pController, object pRouteValues, string pBtnValue, string pBtnName, string pBtnID)
{
    UrlHelper urlHelperForActionLink = new UrlHelper(pHtml.ViewContext.RequestContext);
    bool flag = Operators.CompareString(pController, "", true) != 0;
    string actionLink;
    if (flag)
    {
        actionLink = urlHelperForActionLink.Action(pAction, pController, System.Runtime.CompilerServices.RuntimeHelpers.GetObjectValue(pRouteValues));
    }
    else
    {
        actionLink = urlHelperForActionLink.Action(pAction, System.Runtime.CompilerServices.RuntimeHelpers.GetObjectValue(pRouteValues));
    }
    string onClickEventJavascript = "this.form.action = '" + actionLink + "'; this.form.submit();";
    TagBuilder btnTagBuilder = new TagBuilder("input");
    btnTagBuilder.MergeAttribute("type", "button");
    btnTagBuilder.MergeAttribute("onClick", onClickEventJavascript);
    flag = (Operators.CompareString(pBtnValue, "", true) != 0);
    if (flag)
    {
        btnTagBuilder.MergeAttribute("value", pBtnValue);
    }
    flag = (Operators.CompareString(pBtnName, "", true) != 0);
    if (flag)
    {
        btnTagBuilder.MergeAttribute("name", pBtnName);
    }
    flag = (Operators.CompareString(pBtnID, "", true) != 0);
    if (flag)
    {
        btnTagBuilder.MergeAttribute("id", pBtnID);
    }
    return MvcHtmlString.Create(btnTagBuilder.ToString(TagRenderMode.Normal));
} 
```

这些方法具有各种参数，但为了便于使用，您可以创建一些仅采用您需要的参数的重载。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2015-05-07T16:50:39.083

使用 ajax 表单时，我们可以将 ActionLinks 与 POST HttpMethod 一起使用，并在 AjaxOptions.OnBegin 事件中序列化表单。

假设您有两个操作，InsertAction 和 UpdateAction：

```
<form>
    @Html.Hidden("SomeField", "SomeValue")

    @Ajax.ActionLink(
        "Insert",
        "InsertAction",
        null,
        new AjaxOptions { 
            OnBegin = "OnBegin", 
            UpdateTargetId = "yourDiv", 
            HttpMethod = "POST" })
    @Ajax.ActionLink(
        "Update",
        "UpdateAction",
        null,
        new AjaxOptions { 
            OnBegin = "OnBegin", 
            UpdateTargetId = "yourDiv", 
            HttpMethod = "POST" })
</form> 
```

Javascript

```
function OnBegin(xhr, settings) {
    settings.data = $("form").serialize();
} 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2015-12-15T13:35:47.540

使用自定义帮助程序（在项目根目录的 App_Code 文件夹中创建文件“Helpers.cshtml”）和 javascript 将表单的“action”属性（在“onclick”事件中）重写为您想要的内容，然后提交它。

助手可能是这样的：

```
@helper SubmitButton(string text, string controller,string action)
{   
    var uh = new System.Web.Mvc.UrlHelper(Context.Request.RequestContext);
    string url = @uh.Action(action, controller, null);   
    <input type=button  onclick="(
                                       function(e)
                                                 {
                                                   $(e).parent().attr('action', '@url'); //rewrite action url
                                                   //create a submit button to be clicked and removed, so that onsubmit is triggered
                                                   var form = document.getElementById($(e).parent().attr('id'));
                                                   var button = form.ownerDocument.createElement('input');
                                                   button.style.display = 'none';
                                                   button.type = 'submit';
                                                   form.appendChild(button).click(); 
                                                   form.removeChild(button);              
                                                  }
                                      )(this)" value="@text"/>
} 
```

然后将其用作：

```
@Helpers.SubmitButton("Text for 1st button","ControllerForButton1","ActionForButton1")
@Helpers.SubmitButton("Text for 2nd button","ControllerForButton2","ActionForButton2")
... 
```

在你的表格里面。

* * *

## 回答 #33

> 赞同：-1
> 
> 时间：2011-05-31T00:38:33.190

在查看代码是：

```
<script language="javascript" type="text/javascript">
    function SubmeterForm(id)
    {
        if (id=='btnOk')
            document.forms[0].submit(id);
        else
            document.forms[1].submit(id);
    }
</script>

<% Html.BeginForm("ObterNomeBotaoClicado/1", "Teste01", FormMethod.Post); %>
<input id="btnOk" type="button" value="Ok" onclick="javascript:SubmeterForm('btnOk')" />
<% Html.EndForm(); %>
<% Html.BeginForm("ObterNomeBotaoClicado/2", "Teste01", FormMethod.Post); %>
<input id="btnCancelar" type="button" value="Cancelar" onclick="javascript:SubmeterForm('btnCancelar')" />
<% Html.EndForm(); %> 
```

在控制器中，代码是：

```
public ActionResult ObterNomeBotaoClicado(string id)
{
    if (id=="1")
        btnOkFunction(...);
    else
        btnCancelarFunction(...);
    return View();
} 
```

* * *

## 回答 #34

> 赞同：-3
> 
> 时间：2012-02-09T17:43:36.170

我的解决方案是使用 2 个 asp 面板：

`<asp:Panel ID=”..” DefaultButton=”ID_OF_SHIPPING_SUBMIT_BUTTON”….></asp:Panel>`

* * *

## 回答 #35

> 赞同：-3
> 
> 时间：2015-03-05T00:57:13.823

> 索引.cshtml
> 
> @using (Html.BeginForm("Index", "Home", FormMethod.Post, new { id = "submitForm" }))
> 
> {
> 
> button type="submit" id="btnApprove" name="Command" value="Approve"> 批准
> 
> button type="submit" id="btnReject" name="Command" value="Reject"> 拒绝
> 
> }

```
public class HomeController : Controller
{
    public ActionResult Index()
    {
        return View();
    }

    [HttpPost]
    public ActionResult Index(FormCollection frm, string Command)
    {
        if (Command == "Approve")
        {

        }
        else if (Command == "Reject")
        {

        }

        return View();
    }

} 
```

# perl - 如何使用仅在运行时已知的 Perl 包？

> ID：442710
> 
> 赞同：16
> 
> 时间：2009-01-14T12:02:49.487
> 
> 标签：perl, runtime, packages, require

我有一个 Perl 程序，它需要使用包（我也写）。其中一些包仅在运行时选择（基于某些环境变量）。当然，我不想在我的代码中为所有这些包添加一个“使用”行，但只有一个“使用”行，基于这个变量，比如：

```
use $ENV{a}; 
```

不幸的是，这当然行不通。关于如何做到这一点的任何想法？

在此先感谢，奥伦

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-14T12:14:22.507

```
eval "require $ENV{a}"; 
```

" `use`" 在这里不能很好地工作，因为它只在`eval`.

正如@Manni 所说，实际上，最好使用require。引自`man perlfunc`：

```
如果 EXPR 是一个裸字，则 require 假定为“.pm”扩展名，并且
将文件名中的“::”替换为“/”，以便于
加载标准模块。这种形式的模块加载不
冒着改变你的命名空间的风险。

换句话说，如果你试试这个：

        需要 Foo::Bar；# 一个精彩的裸词

require 函数实际上会寻找“Foo/Bar.pm”文件
在@INC 数组中指定的目录中。

但如果你试试这个：

        $class = 'Foo::Bar';
        需要$类；# $class 不是裸词
    ＃或者
        需要“Foo::Bar”；# 因为“”而不是一个裸词

require 函数将在@INC 中查找“Foo::Bar”文件
数组，并会抱怨在那里找不到“Foo::Bar”。在这个
你可以这样做：

        eval "需要 $class";

```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-14T12:29:12.537

"use" 语句在编译时运行，而不是在运行时。您将需要 require 您的模块：

```
my $module = "Foo::Bar";
eval "require $module"; 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-14T14:06:12.310

我会使用[UNIVERSAL::require](http://search.cpan.org/dist/UNIVERSAL-require/)。它同时具有使用包的*require*和*use*方法。*use*方法还将调用包的*导入*。

```
use UNIVERSAL::require;
$ENV{a}->use or die 'Could not import package:  ' . $@; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-14T12:29:04.177

如果您不希望它在编译时发生，您可能想要使用`require`而不是，然后手动导入您可能需要的任何符号。`use`请参阅[指向 Perl Cookbook](http://books.google.com/books?pg=PA453&lpg=PA453&dq=%22delaying+use+until+runtime%22&sig=JJzoHtGvRtTTJym6uML3BZh3g3M&ct=result&id=IzdJIax6J5oC&ots=z6zefrdaeP&output=html)（来自 Google 图书）的链接，以很好地讨论可用于实现所需目标的方法。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-14T16:20:19.543

我认为在运行时加载的模块可以是插件。我有这种问题，某些情况下的特定模块在运行时作为带有[Module::Pluggable](http://search.cpan.org/~simonw/Module-Pluggable-3.8/lib/Module/Pluggable.pm)的插件加载。

也许您需要更改模块的逻辑，但它可以很好地工作和扩展（我的应用程序从四个模块开始，现在有二十个，并且还在增长）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-11-05T15:19:22.600

如何使用核心模块[Module::Load](http://perldoc.perl.org/Module/Load.html)

用你的例子：

```
use Module::Load;
load $ENV{a}; 
```

“Module::Load - 模块和文件的运行时要求”

“加载消除了了解您是否尝试要求文件或模块的需要。”

如果它失败了，它会以类似*"Can't locate xxx in @INC (@INC contains: ..."*之类的东西而死。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-08-18T16:57:15.890

许多年后，`eval "use $mod_name";`似乎工作得很好（至少从 5.8.8 开始）。

优点`eval "require $mod_name";`是加载模块的默认导出是*自动*导入的；换句话说：

`eval "use $mod_name";`

是较短的等价物

`eval "require $mod_name"; $mod_name->import();`

这是一个测试命令，它通过 env 传递模块的名称。variable `mod_name`，加载并导入模块，然后使用导入的函数（假设是类似 POSIX 的 shell）：

```
 $ mod_name='Data::Dumper' perl -e 'eval "use $ENV{mod_name}"; print Dumper("hi!")'
 $VAR1 = 'hi!'; 
```

^(我可能遗漏了细微之处；如果是这样，请告诉我。)

# wcf - 如何在大型 wcf 服务中使用单一职责原则？

> ID：442713
> 
> 赞同：5
> 
> 时间：2009-01-14T12:05:03.490
> 
> 标签：wcf, single-responsibility-principle

我们目前正在使用大约 7 项服务。那里相当大。

有人对单一责任原则和 WCF 服务有任何经验吗？这是否意味着你最终会得到很多小合同？如果是这样，您如何在应用程序中管理这些？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-25T15:05:32.040

我认为您将单一职责与接口隔离混淆了。

从客户端/服务接口的角度来看，你应该保持你的合同精益求精。请参阅下面的示例。

在 SRP 方面，这应该完全在服务实现内部，客户端不应该意识到这一点。如果您的服务代码太大，请将其拆分为类。然后让您的服务代码，至少在最初，充当外观并将所有调用转发到相关对象。稍后，您可以选择将服务拆分为多个服务。但是请注意，SOA 和面向对象的设计虽然重叠，但它们是分开的并且有不同的要求。

接口隔离示例：我们这里有一个服务在工作，我们用它来对一些业务对象执行各种功能。原来的服务只有一个接口。随着它的发展，我们意识到我们拥有三个方法系列：数据对象持久化、业务更新、业务分析。我们分成三份合同。我们的客户端/服务实现了所有 3 个，所以我们唯一要做的就是将合同分成三个并在我们的 WCF 配置中设置两个额外的端点。非常简单。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T12:12:19.140

我建议你在 hanselminutes 上收听这个播客：

[Bob 叔叔的 SOLID 原则 - Robert C. Martin](http://www.hanselminutes.com/default.aspx?showID=163)

这将有助于更好地理解事物。. .

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-12-13T03:06:29.990

您可以为与客户端交互的 Web 服务应用外观模式，并且在您的实现代码中，您可以应用单一职责以使其可维护。

# silverlight - 如何更改按钮的背景颜色

> ID：442722
> 
> 赞同：3
> 
> 时间：2009-01-14T12:07:33.207
> 
> 标签：silverlight

无论我在按钮中将背景属性更改为什么，它几乎都不会改变，如果我想要一个完全不同颜色的按钮，我应该怎么做？

我知道我可以通过编辑按钮模板来做到这一点，但这似乎有点矫枉过正。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-08T21:59:09.427

这看起来像是 SilverLight 2.0 和按钮的默认 ContentTemplate 的问题。我看了一下源码：

```
<ControlTemplate TargetType="controls:Button"> 
<Grid>
    <!-- snipped the 36 lines of VisualStatManager here -->
    <Border x:Name="Background" CornerRadius="3" Background="White" BorderThickness="{TemplateBinding BorderThickness}" BorderBrush="{TemplateBinding BorderBrush}">
        <Grid Background="{TemplateBinding Background}"  Margin="1"> 
            <Border Opacity="0"  x:Name="BackgroundAnimation" Background="#FF448DCA" />
            <Rectangle x:Name="BackgroundGradient" >
                <Rectangle.Fill> 
                    <LinearGradientBrush StartPoint=".7,0" EndPoint=".7,1">
                        <GradientStop Color="#FFFFFFFF" Offset="0" />
                        <GradientStop Color="#F9FFFFFF" Offset="0.375" /> 
                        <GradientStop Color="#E5FFFFFF" Offset="0.625" /> 
                        <GradientStop Color="#C6FFFFFF" Offset="1" />
                    </LinearGradientBrush> 
                </Rectangle.Fill>
            </Rectangle>
        </Grid> 
    </Border>
    <ContentPresenter
            x:Name="contentPresenter" 
            Content="{TemplateBinding Content}" 
            ContentTemplate="{TemplateBinding ContentTemplate}"
            VerticalAlignment="{TemplateBinding VerticalContentAlignment}" 
            HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
            Margin="{TemplateBinding Padding}"/>
    <Rectangle x:Name="DisabledVisualElement" RadiusX="3" RadiusY="3" Fill="#FFFFFFFF" Opacity="0" IsHitTestVisible="false" /> 
    <Rectangle x:Name="FocusVisualElement" RadiusX="2" RadiusY="2" Margin="1" Stroke="#FF6DBDD1" StrokeThickness="1" Opacity="0" IsHitTestVisible="false" />
</Grid> 
```

问题是具有自己背景的矩形位于具有您设置的背景的网格之上。（此外，边框被硬编码为白色）。我们可以使用我们自己的 ContentTemplate 来解决这个问题，但这意味着还要添加所有 VisualStatManager 的东西来获得所有与 Button 一起出现的动画。

第二种方法是继承 Button，并在 OnApplyTemplate 覆盖中修改模板。这是一个降低股票按钮不透明度的示例，以便背景显示：

```
public class BKButton : Button {

public override void OnApplyTemplate() {
    base.OnApplyTemplate();

    Border border = GetTemplateChild("Background") as Border;
    Rectangle rect = GetTemplateChild("BackgroundGradient") as Rectangle;

    if(border != null) {
        border.Background = this.Background;
        border.Opacity = .6;
    }
    if (rect != null) {
        LinearGradientBrush lbrush = rect.Fill as LinearGradientBrush;
        if (lbrush != null) {
            lbrush.Opacity = .6;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-14T13:16:36.390

I am not quite sure what do you mean by "button hardly changes" but when I write `<Button x:Name="button" Background="Gold" Foreground="Red" Content="Hello!" />` I get a golden button with red text. If you want to edit the button even more (change how it looks when you click on it etc.) then you still have to use templates and visual state manager. I found two pretty good tutorials that specifically concentrate on the visual aspects of a Silverlight button: [http://mattberseth.com/blog/2008/03/creating_a_custom_skin_for_sil.html](http://mattberseth.com/blog/2008/03/creating_a_custom_skin_for_sil.html) and [http://weblogs.asp.net/dwahlin/archive/2008/11/23/using-the-visual-state-manager-in-silverlight-templates.aspx](http://weblogs.asp.net/dwahlin/archive/2008/11/23/using-the-visual-state-manager-in-silverlight-templates.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-11T21:01:49.950

我有同样的问题。但我做了解决方法。我没有更改按钮背景颜色，而是将按钮的边框宽度设置为 100，然后设置边框颜色，例如灰色。

所以你会有灰色的按钮。我知道这不是好方法，但它对我有用。希望能帮助到你

这是代码示例：

```
 Dim btn As New Button
    btn.Width = 75
    btn.Height = 35
    btn.BorderThickness = New Thickness(0, 0, 0, 100)
    btn.BorderBrush = New SolidColorBrush(Colors.LightGray)
    AddHandler btn.Click, AddressOf btn_Click
    AddHandler btn.MouseEnter, AddressOf btn_MouseEnter
    AddHandler btn.MouseLeave, AddressOf btn_MouseLeave

    LayoutRoot.Children.Add(btn)

Private Sub btn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
    MessageBox.Show("pressed")
End Sub
Private Sub btn_MouseEnter(ByVal sender As System.Object, ByVal e As System.EventArgs)
    DirectCast(sender, Button).BorderBrush = New SolidColorBrush(Colors.Gray)
End Sub
Private Sub btn_MouseLeave(ByVal sender As System.Object, ByVal e As System.EventArgs)
    DirectCast(sender, Button).BorderBrush = New SolidColorBrush(Colors.LightGray)
End Sub 
```

# sql - 需要跨表查询 SQL 2000

> ID：442723
> 
> 赞同：1
> 
> 时间：2009-01-14T12:07:44.470
> 
> 标签：sql, crosstab

我已经用谷歌搜索过了

```
  I have a Table with following structure in SQL 2000

 ID ContactName Designation
 1  A           CEO
 2  B           ABC
 3  C           DEF
 4  D           GHI 
```

我需要输出如下

```
 ContactName1 Contactname2 ContactName3 ContactName4
 A CEO        B ABC         C DEF         D GHI 
```

有什么建议么 ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T12:13:53.787

您需要使用[数据透视表](http://msdn.microsoft.com/en-us/library/aa172756.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T12:20:59.480

这也适用于 2000 - wg。没有枢轴

[http://www.sqlteam.com/item.asp?ItemID=2955](http://www.sqlteam.com/item.asp?ItemID=2955)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-14T12:23:27.853

另一个 SQL Cross Tab proc [http://johnmacintyre.ca/codespct.asp](http://johnmacintyre.ca/codespct.asp)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-14T13:09:09.557

在我看来，很多示例都是针对涉及聚合的交叉表查询，而您的似乎不需要。虽然我不一定宽恕动态 SQL，但下面应该会给你你想要的结果。

```
Create table #Contacts (id int)
Declare @ContactTypes int
Declare @CAD varchar(100)
Declare @I int
Declare @sql nvarchar(4000)
Set @i = 1
Select @ContactTypes =   
Sum(sub.Types) 
from ( Select Count(1) as Types from contacts
group by ContactName, Designation) as sub
Print @ContactTypes
While @i <= @ContactTypes
Begin
    set @sql = 'alter table #Contacts Add  ContactName' + 
    Cast(@I as varchar(10)) + ' varchar(100)'
    exec sp_executesql @sql
    Set @I = @i + 1
End
Insert into #Contacts (id) values (1)
Set @i = 1
Declare crsPivot  cursor 
for Select ContactName + ' ' + Designation
from contacts
open crsPivot
Fetch next from crsPivot into @CAD
While (@@Fetch_Status = 0)
Begin   
    Set @sql = 'Update  #Contacts  set ContactName' 
    + Cast(@I as varchar(10)) +' = ' + quotename(@CAD,'''')
    exec sp_executesql @sql
    Set @i = @i + 1
    Fetch next from crsPivot into @CAD
End
close crsPivot
Deallocate crsPivot
select * From #Contacts 
```

# c - 用函数调用覆盖变量赋值的 C 宏

> ID：442729
> 
> 赞同：2
> 
> 时间：2009-01-14T12:11:30.047
> 
> 标签：c, macros

呼叫所有 C 宏大师...

有什么方法可以编写一个 C 宏来代替这样的东西：

```
my_var = 5; 
```

有了这个：

```
setVar(&my_var, 5); 
```

换句话说，我是否可以编写一个 C 宏来覆盖特定变量（在上面的示例中为 my_var）的赋值，并将其传递给一个函数，该函数的工作是设置该变量？如果可能的话，我希望能够挂钩特定变量的分配。

* * *

**编辑：**在考虑了更多之后，我不确定它是否可以完成。即使你能想出一个宏来做到这一点，setVar 也不一定知道它设置的变量的类型，那么它的第二个参数的类型是什么？

* * *

**编辑：**我想挂钩特定变量的赋值的原因是为了在一些专门的嵌入式 C 代码的原始调试器中使用。能够拥有一个“监视列表”会很好，就像您在 IDE 中一样。我的第一直觉是尝试用 C 宏挂钩变量赋值，这样您就可以将宏放入代码中并“监视”该变量，但话说回来，我以前从未真正编写过调试器，所以也许我要去关于这一切都错了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T12:45:36.060

不使用标准预处理器。它不能更改文件的解析，只能用一段代码替换专有名称（并且“=”在名称中无效）。

如果您喜欢冒险，可以尝试将可执行文件“cpp”替换为预处理源代码的小脚本。但这可能会破坏调试信息（文件名，如果你用几行代码替换一行代码，还有行号信息）。该脚本将调用“sed”`：

```
sed -e 's/my_var\s*=\s*([^;]+);/MY_VAR(my_var, $1);/' file.c > file_tmp.c 
```

但是你最好的选择可能是把它放到一个脚本中，然后简单地在你所有的源上运行它。这将更改代码，您将看到调试器中发生了什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-07-30T16:43:24.330

```
#define setVar(_left_, _right_)    *(_left_) = _right_ 
```

# etag - 单个 Web 服务器和 ETag

> ID：442730
> 
> 赞同：2
> 
> 时间：2009-01-14T12:11:33.523
> 
> 标签：etag

有谁知道是否值得在托管在单个 Web 服务器上的 Web 应用程序上禁用 ETags？目前我们没有在我们的应用程序中使用 ETags。

如果值得禁用它们 - 为什么？

非常感谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-14T12:14:28.667

我不知道这是否有帮助，但您可以在这里阅读有关 etags 的信息：http: [//developer.yahoo.net/blog/archives/2007/07/high_performanc_11.html](http://developer.yahoo.net/blog/archives/2007/07/high_performanc_11.html)

以下是[Jeff Atwood](http://www.codinghorror.com/blog/archives/000932.html)对 ETags 的看法：

> ETag 是每个服务器文件提供的校验和字段，因此客户端可以判断服务器资源是否与客户端在本地保存的缓存版本不同。雅虎建议关闭 ETag，因为它们是使用特定于机器的标记生成的，因此会导致服务器场出现问题。因此，除非您运行服务器场，否则您应该忽略此指南。它只会让您的网站性能更差，因为客户端将更难以确定其缓存是陈旧的还是新鲜的。客户端可以使用现有的 last-modified 日期字段来确定缓存是否过时，但 last-modified 是一个弱验证器，而 Entity Tag (ETag) 是一个强验证器。为什么要以强换弱？

还[采访](http://www.dotnetrocks.com/default.aspx?showNum=390).NET Rocks 的 Steve Souders 可能会有所帮助：

> **史蒂夫·苏德斯**: ... IIS 和 Apache 的默认实现，他们放置了这两个服务器，在 e-tag 中放置了一些东西，如果用户必须检查该资源的有效性，浏览器就会运行被错误地告知资源不再有效。因此，在 Apache 的情况下，他们在电子标签中放入的是该 Web 服务器上文件的 INO 编号，因此，如果您有多个 Web 服务器托管您的网站，而大多数大型网站都有，那么该 INO 编号永远不会跨两台服务器匹配，所以如果昨天用户去服务器一，今天他们试图验证该资源，他们去服务器 2，电子标签将不匹配，电子标签覆盖上次修改日期，而不是仅仅返回一个 200 字节的 304 响应，

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-11-08T19:21:38.330

“如果您在一台服务器上托管您的网站，则无需删除 ETag。每次都将使用相同的 ETag，并且验证检查将有效且正确地进行。”

资料来源：[迪恩休谟](http://deanhume.com/Home/Index)

# cocoa - 如何使 NSTokenField 的值绑定提供 NSString？

> ID：442733
> 
> 赞同：2
> 
> 时间：2009-01-14T12:13:48.183
> 
> 标签：cocoa, cocoa-bindings, key-value-coding

我已经用 an 替换了`NSTextField`an`NSTokenField`以便我可以执行一些自动完成。的值`NSTextField`绑定到`NSString`控制器类的属性。现在我已将 更改`NSTextField`为 an`NSTokenField`值已更改为`NSArray`。

如何使`NSTokenField`值绑定成为一个`NSString`？

将值从 an 更改`NSString`为 an`NSArray`似乎是糟糕的 OO 设计。我认为子类应该能够在不修改子类的情况下替换超类。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-20T23:45:43.670

如果你想要的只是自动完成，而不是标记化，你可以通过使用普通的 NSTextField 并实现委托方法来实现这一点：

```
- (NSArray *)control:(NSControl *)control textView:(NSTextView *)textView completions:(NSArray *)words forPartialWordRange:(NSRange)charRange indexOfSelectedItem:(NSInteger *)index 
```

（这个方法实际上是在 NSTextField 的超类 NSControl 中声明的。）

如果您确实想要进行标记化，那么您必须提供一个 NSArray 以使对象值显示在标记字段中。正如[NSTokenField 编程指南中所解释的](http://developer.apple.com/documentation/Cocoa/Conceptual/TokenField_Guide/TokenFieldArchitecture/TokenFieldArchitecture.html#//apple_ref/doc/uid/TP40006555-CH4-SW4)，您提供的数组将是字符串和对象的混合。字符串将按原样显示，任何非字符串对象都将在令牌字段中显示为令牌。您需要实现各种 NSTokenField 委托方法来为数组中的每个表示对象提供要显示的字符串。

看起来[Cocoa Bindings Reference](http://developer.apple.com/documentation/Cocoa/Reference/CocoaBindingsRef/BindingsText/NSTokenField.html#//apple_ref/doc/uid/NSTokenField-DontLinkElementID_697)声明绑定到 NSTokenField 值的对象应该是字符串或数字，但根据我的经验，这是不正确的，并且令牌字段应该绑定到 NSArray，就像使用时一样设置对象值：

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-23T08:55:11.780

您可以子类化您自己的[NSValueTransformer](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/Foundation/Classes/NSValueTransformer_Class/Reference/Reference.html)并将其设置在您的绑定中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-17T06:38:25.237

NSTokenField 的值绑定接受 NSString 或 NSNumber 绑定，而不是 NSArray。你如何确定它需要一个 NSArray？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-02-18T18:16:35.707

最好的方法（正如 Cocoafan 指出的那样）是使用[Value Transformers](https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/ValueTransformers/Concepts/TransformersRole.html)。值转换器允许您将模型使用的对象类型转换为适合视图的类型。这是一个非常简单的字符串/数组转换器，它允许您将数据存储为逗号分隔的字符串，但会将其来回转换为字符串数组。

```
@interface StringArrayTransformer: NSValueTransformer {}
@end

@implementation StringArrayTransformer

+ (Class)transformedValueClass { return [NSString class]; }

+ (BOOL)allowsReverseTransformation { return YES; }

- (id)transformedValue:(id)value {
    NSString *string = (NSString*) value;
    return [string componentsSeparatedByString:@", "];
}

-(id)reverseTransformedValue:(id)value {
    NSArray *array = (NSArray*)value;
    return [array componentsJoinedByString:@", "];
}
@end 
```

如果您为 NSTokenField 使用绑定，那么要使用此转换器，只需在 Interface Builder 中选择 NSTokenField，然后在右侧的 Bindings Inspector 中，对于 Value 绑定，将“Value Transformer”设置`StringArrayTransformer`为如下所示。

[![为 NSTokenField 设置值转换器绑定](https://i.stack.imgur.com/qiVeZ.png)](https://i.stack.imgur.com/qiVeZ.png)

# c++ - 如何在源文件中嵌入 unicode 字符串常量？

> ID：442735
> 
> 赞同：10
> 
> 时间：2009-01-14T12:13:55.377
> 
> 标签：c++, unit-testing, string, unicode, constants

我正在编写一些单元测试，这些测试将验证我们对使用除普通拉丁字母之外的其他字符集的各种资源的处理：西里尔文、希伯来文等。

我遇到的问题是我找不到将期望嵌入到测试源文件中的方法：这是我正在尝试做的一个示例...

```
///
/// Protected: TestGetHebrewConfigString
///  
void CPrIniFileReaderTest::TestGetHebrewConfigString()
{
    prwstring strHebrewTestFilePath = GetTestFilePath( strHebrewTestFileName );
    CPrIniFileReader prIniListReader( strHebrewTestFilePath.c_str() );
    prIniListReader.SetCurrentSection( strHebrewSubSection );   

    CPPUNIT_ASSERT( prIniListReader.GetConfigString( L"דונדארןמע" ) == L"דונהשךוק") );
} 
```

这根本行不通。以前我使用一个宏来解决这个问题，该宏调用一个将窄字符串转换为宽字符串的例程（我们在应用程序中到处都使用拖字符串，所以它是现有代码）

```
#define UNICODE_CONSTANT( CONSTANT ) towstring( CONSTANT )

wstring towstring( LPCSTR lpszValue )
{
    wostringstream os;
    os << lpszValue;
    return os.str();
} 
```

上面测试中的断言变成了：

```
CPPUNIT_ASSERT( prIniListReader.GetConfigString( UNICODE_CONSTANT( "דונדארןמע" ) ) == UNICODE_CONSTANT( "דונהשךוק" ) ); 
```

这在 OS X 上运行良好，但现在我正在移植到 linux，我发现测试都失败了：这一切都让人感觉很不自然。谁能告诉我他们是否有更好的解决方案来解决这个问题？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-14T13:39:13.863

一种乏味但可移植的方法是使用数字转义码构建字符串。例如：

```
wchar_t *string = L"דונדארןמע"; 
```

变成：

```
wchar_t *string = "\x05d3\x05d5\x05e0\x05d3\x05d0\x05e8\x05df\x05de\x05e2"; 
```

您必须将所有 Unicode 字符转换为数字转义符。这样你的源代码就变得独立于编码了。

您可以使用在线工具进行转换，例如[这个](http://rishida.net/tools/conversion/). 它输出 JavaScript 转义格式`\uXXXX`，因此只需搜索和替换`\u`即可`\x`获得 C 格式。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-14T12:26:08.673

您必须告诉 GCC 您的文件使用哪种编码将这些字符编码到文件中。

`-finput-charset=charset`例如，使用该选项`-finput-charset=UTF-8`。然后你需要告诉它在运行时用于这些字符串文字的编码。这将确定字符串中 wchar_t 项的值。`-fwide-exec-charset=charset`例如，您可以使用 设置该编码`-fwide-exec-charset=UTF-32`。注意编码的大小（utf-32 需要 32 位，utf-16 需要 16 位）不能超过`wchar_t`gcc 使用的大小。

你可以调整它。该选项主要用于编译程序`wine`，旨在与 Windows 兼容。该选项称为`-fshort-wchar`，并且很可能是 16 位而不是 32 位，这是 linux 上 gcc 的通常宽度。

`man gcc`这些选项在 gcc 手册页中有更详细的描述。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-06-29T01:05:05.583

```
#define UNICODE_CONSTANT( CONSTANT ) towstring( CONSTANT )

wstring towstring( LPCSTR lpszValue ) {
    wostringstream os;
    os << lpszValue;
    return os.str(); 
} 
```

这实际上根本不会在 Unicode 编码之间进行转换，这需要专门的例程。您需要保持源代码和数据编码统一——大多数人使用 UTF-8——然后在必要时将其转换为特定于操作系统的编码（例如 Winders 上的 UTF-16）。

# svn - 用于 Web 开发的颠覆

> ID：442737
> 
> 赞同：4
> 
> 时间：2009-01-14T12:14:15.017
> 
> 标签：svn, apache, htdocs

我已经阅读了很多关于 Subversion 并将信息推送到 Web 服务器的文章，但我仍然遇到了困难。

我可以了解有关创建存储库和签出等的基础知识，但我需要有关 Web 服务器部分的帮助。

我正在运行 Apache，而 Subverion 正在我正在处理的开发服务器上运行。

现在我是在`**htdocs**`文件夹中创建我的存储库以及我的实时 Web 文档还是在我的`htdocs`文件夹之外创建它。

一旦我有了我的存储库，我将新创建的存储库导入到我的实时 Web 文件夹中，这允许我将文件调用到我的本地计算机上编辑它们，然后将它们提交到开发服务器。

我首先想知道正确的方法，其次，如何自动将文件从新更新的存储库移动到实时 Web 文件夹？

请任何我一直在寻找的建议。谢谢

**编辑**

无论如何你可以帮助我处理提交后的脚本，我想如果我能让它工作，我就能实现我所需要的。

我希望能够在本地对我的代码进行更改，然后在我完成提交后将其发送到存储库，然后自动发送到`htdocs`文件夹。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-14T12:20:49.030

您的存储库有一个标准的文件夹结构，通常至少包含一个“主干”和“分支”文件夹。这是因为 Subversion 允许您创建一个分支（它从主干复制并允许并发提交），因此您可以使用您网站的“版本 2”。

就个人而言，我不会在 htdocs 文件夹中创建您的 repo，我会在此之外进行。我认为一个好的结构可能是

```
repo
  - trunk
    - htdocs
  - branch
    - htdocs 
```

这样您就可以控制存在于 htdocs 文件夹之外的库，这在主要的 Web 系统中很常见，可以阻止对私有库的公共访问。例如，Smarty 通过将库放置在 htdocs 文件夹上方的一个目录来采用这种方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-14T16:01:37.773

这个 Stack Overflow 问题接缝涵盖了您正在尝试做的事情：[如何使用 post-commit 挂钩将提交的文件从 SVN 复制到 web 目录？](https://stackoverflow.com/questions/140614/how-can-i-use-post-commit-hooks-to-copy-committed-files-to-a-web-directory-from-s)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-14T12:26:53.930

我不确定您要做什么，但 SVN（源代码控制系统）和持续集成系统（如 Cruise Control 或 Team City）之间存在分离。

您可以使用 apache 通过 HTTP 设置 SVN，但这与将 Web 解决方案部署到实时服务器不同。

SVN 中没有任何东西可以自动将您的解决方案部署到 Web 服务器。这需要通过自动构建和部署方案来完成，最好使用 CI 系统来完成。

因此，您可以在每次提交时手动签出对部署文件夹的更改，也可以设置 CI 系统，每次提交时为您签出、运行测试并将它们部署到 Web 服务器.

我已经使用[CC.NET](http://ccnet.thoughtworks.com/)和[Team City](http://www.jetbrains.com/teamcity/)来做到这一点；他们都可以在某些设置下正常工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-14T12:29:20.913

我们已经将提交后脚本挂在提交操作上，该操作在每次提交时将 SVN 的内容导出到 Apache 目录。放置代码的默认位置是我们的开发和测试站点。

通过提交中的可选注释，我们导出到生产服务器。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-14T12:19:16.490

[我发现TortoiseSVN](http://tortoisesvn.net/downloads)帮助（TSVN-PDF 文件）中的大部分问题都有很好的文档。这是我所有问题以及如何使用 SVN 设置一切的起点。即使它是为 Windows 编写的，它也描述了如何使用 Apache 配置 SVN 等等......

也许您不想在每次将某些内容签入存储库时更新您的实时网站。对于更新存储库和实时网站，您可以使用构建脚本（如果您使用 ASP.NET 编写网站，则可能使用[NAnt ）。](http://nant.sourceforge.net/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-14T14:47:11.167

您需要开始将您的网络服务器和 SVN 存储库视为两个完全不同的东西。SVN 只是存储文件，您可以决定将存储库中的哪个文件版本以及何时放置在您的网站目录中。

最传统的方法是在您的存储库中保留稳定版本（称为标签），可选择为这些标签提供版本号，然后确保始终将最新的标签导出并复制到您的网站目录。通过这种方式，执行回滚到早期版本非常容易。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-14T12:26:26.490

只是另一个注释...

您可以签出最新版本以更新服务器或进行导出。如果您结帐，您的所有 Web 可访问目录都会散布着 .svn 目录，因此请确保使用适合您的 Web 服务器的方法（例如 Apache 的 .htaccess）隐藏这些目录，或者进行导出，以免到处都有 .svn 目录。

# .net - 如何/在哪里托管基于 UDP 的组件？

> ID：442740
> 
> 赞同：1
> 
> 时间：2009-01-14T12:15:25.047
> 
> 标签：.net, hosting, udp

我正在开展一个项目，该项目基本上将显示通过**UDP**协议从硬件设备收集的一些数据。如何做到这一点的第一个想法：实现一个winService（监听和持久化消息）和一个wepApp来管理数据，基于.NET平台。

我对是否存在租用“Windows 服务”托管、部署“udp 侦听器”组件的可能性感到困惑。

谢谢！戈尔什

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T05:43:46.430

共享主机设置不允许您拥有运行服务、在云上寻找托管主机服务或 VPS 所需的权限。Amazon EC2 或 GoGrid 目前拥有 Microsoft Windows 云产品。

# apache-flex - Base64Encoder 的 adobe flex 问题

> ID：442742
> 
> 赞同：1
> 
> 时间：2009-01-14T12:17:38.707
> 
> 标签：apache-flex, adobe, base64

在以下代码中：

```
var benq:Base64Encoder = new Base64Encoder();
benq.encode("force",0,5);
var tmp:String = benq.toString(); 
```

'tmp' 结果是一个空字符串，即长度为 0。为什么？如何使用 base64encoder 对字符串进行编码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T12:41:30.140

你确定你的代码不工作。我只是将它复制并粘贴到一个测试应用程序中，它返回 tmp 为 'Zm9yY2U='

你对 var tmp 做了什么别的吗？如果调试确保它在检查输出时已处理 var tmp:String.... 行

```
<?xml version="1.0" encoding="utf-8"?><mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"
    layout="vertical"
    verticalAlign="middle"
    backgroundColor="white"
    creationComplete="but1.label = encodeit()">

<mx:Script>
    <![CDATA[
        import mx.utils.Base64Encoder;

        private function encodeit(): String {
            var benq:Base64Encoder = new Base64Encoder();
            benq.encode("force",0,5);
            var tmp:String = benq.toString();
            return tmp;
        }
    ]]>
</mx:Script>

<mx:Button 
    id="but1" 
    width="100"
    height="100"
    /></mx:Application> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T12:31:25.590

您是否使用 Flex 3，因为它似乎是一项新功能？还可以尝试使用 encodeBytes 和使用 encodeUTFBytes 编码成字节数组，也许这些效果更好。

[Adobe](http://livedocs.adobe.com/flex/3/langref/mx/utils/Base64Encoder.html)提供了在线参考，但我想你知道这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T13:06:11.997

好的，它正在工作。我发布的代码与我实际使用的代码不同。我跳过了为 Base64Encoder 调用 toString() 会清除其内部缓冲区的事实。因此，下次调用它会返回一个空字符串。抱歉，添麻烦了。

# regex - BNF 到正则表达式

> ID：442744
> 
> 赞同：2
> 
> 时间：2009-01-14T12:18:52.543
> 
> 标签：regex, bnf

我该如何描述语言

```
A → AA | ( A ) | ε 
```

使用正则表达式生成？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-14T13:06:19.873

Regular expressions accept strings from regular languages. Regular languages can also be accepted by an FSM.

There's an potentially infinite number of brackets in your language that you have to match up. That means you need an infinite state, obviously impossible in any *Finite* State Machine. Therefore, your language isn't regular and can't be matched with a regex.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-14T12:29:56.280

正则表达式不能匹配嵌套括号。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-14T13:22:30.980

我不确定您如何标记该语言，但该语言不是常规语言，正如使用常规语言的泵引理可以显示的那样（因此，它不能被正则表达式记录）。一个直观的解释是，接受该语言中的单词将要求 FDA “记住”每次开始读取右括号时它刚刚读取的左括号的数量，而这对他们来说是不可能的，因为他们没有“记忆” '。另一方面，下推式自动机...

对于任何 n，该语言可以记为 {( ^n ) ^n } ^(*吗？)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T13:34:14.340

你不能——正则表达式只能识别一小部分可能的语言。特别是，非正式地，任何需要无限量内存才能识别的语言都是不可识别的。

在这里，您需要无限量的内存来记住您看到了多少个左括号，以确保右括号的数量相同。

您将需要一些能够解析上下文无关语法的机制，以便能够识别一般由 BNF 描述的语言。现代解析器非常擅长这一点！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T13:38:06.627

正如其他人所说，您不能使用单个正则表达式来执行此操作，但是您可以使用两个“\(”和“\)”对其进行标记。看到您的语言中只能有括号，但我不确定这是否非常有用。

**注意：**您还需要一名传球手来确保支架正确配对。所以“（（）（）”将标记但不会解析。

# java - 获取当前执行方法的名称

> ID：442747
> 
> 赞同：511
> 
> 时间：2009-01-14T12:20:39.497
> 
> 标签：java, reflection, methods

有没有办法在 Java 中获取当前正在执行的方法的名称？

* * *

## 回答 #1

> 赞同：343
> 
> 时间：2011-05-05T00:20:50.927

从技术上讲，这将起作用...

```
String name = new Object(){}.getClass().getEnclosingMethod().getName(); 
```

但是，在编译期间将创建一个新的匿名内部类（例如`YourClass$1.class`）。因此，这将为`.class`部署此技巧的每个方法创建一个文件。此外，在运行时每次调用时都会创建一个未使用的对象实例。所以这可能是一个可以接受的调试技巧，但它确实带来了巨大的开销。

此技巧的一个优点是`getEnclosingMethod()`返回`java.lang.reflect.Method`可用于检索方法的所有其他信息，包括注释和参数名称。这使得区分具有相同名称的特定方法成为可能（方法重载）。

请注意，根据`getEnclosingMethod()`此技巧的 JavaDoc 不应抛出 a `SecurityException`，因为应使用相同的类加载器加载内部类。因此，即使有安全管理员，也无需检查访问条件。

**请注意**：它需要`getEnclosingConstructor()`用于构造函数。在（命名的）方法之外的块期间，`getEnclosingMethod()`返回`null`.

* * *

## 回答 #2

> 赞同：191
> 
> 时间：2009-01-14T12:29:03.863

`[Thread](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html).[currentThread()](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html#currentThread()).[getStackTrace()](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html#getStackTrace())`通常将包含您从中调用它的方法，但存在缺陷（请参阅[Javadoc](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html#getStackTrace())）：

> 在某些情况下，某些虚拟机可能会从堆栈跟踪中省略一个或多个堆栈帧。在极端情况下，允许没有关于该线程的堆栈跟踪信息的虚拟机从该方法返回一个长度为零的数组。

* * *

## 回答 #3

> 赞同：139
> 
> 时间：2009-01-14T12:33:28.550

2009 年 1 月：
完整的代码将是（使用[@Bombe 的警告](https://stackoverflow.com/questions/442747#442773)）：

```
/**
 * Get the method name for a depth in call stack. <br />
 * Utility function
 * @param depth depth in the call stack (0 means current method, 1 means call method, ...)
 * @return method name
 */
public static String getMethodName(final int depth)
{
  final StackTraceElement[] ste = Thread.currentThread().getStackTrace();

  //System. out.println(ste[ste.length-depth].getClassName()+"#"+ste[ste.length-depth].getMethodName());
  // return ste[ste.length - depth].getMethodName();  //Wrong, fails for depth = 0
  return ste[ste.length - 1 - depth].getMethodName(); //Thank you Tom Tresansky
} 
```

更多在[这个问题](https://stackoverflow.com/questions/421280)。

2011 年 12 月更新：

[蓝色](https://stackoverflow.com/users/505893/bluish)评论：

> 我使用 JRE 6 并给了我不正确的方法名称。
> 如果我写它会起作用`ste[2 + depth].getMethodName().`
> 
> *   `0`是`getStackTrace()`，
> *   `1`是`getMethodName(int depth)`和
> *   `2`正在调用方法。

[virgo47](https://stackoverflow.com/users/658826/virgo47)的[答案](https://stackoverflow.com/a/8592871/6309)（赞成）实际上计算了要应用的正确索引，以便取回方法名称。

* * *

## 回答 #4

> 赞同：90
> 
> 时间：2011-12-21T16:13:03.287

我们使用此代码来减轻堆栈跟踪索引的潜在可变性 - 现在只需调用 methodName util：

```
public class MethodNameTest {
    private static final int CLIENT_CODE_STACK_INDEX;

    static {
        // Finds out the index of "this code" in the returned stack trace - funny but it differs in JDK 1.5 and 1.6
        int i = 0;
        for (StackTraceElement ste : Thread.currentThread().getStackTrace()) {
            i++;
            if (ste.getClassName().equals(MethodNameTest.class.getName())) {
                break;
            }
        }
        CLIENT_CODE_STACK_INDEX = i;
    }

    public static void main(String[] args) {
        System.out.println("methodName() = " + methodName());
        System.out.println("CLIENT_CODE_STACK_INDEX = " + CLIENT_CODE_STACK_INDEX);
    }

    public static String methodName() {
        return Thread.currentThread().getStackTrace()[CLIENT_CODE_STACK_INDEX].getMethodName();
    }
} 
```

看起来设计过度了，但我们有一些 JDK 1.5 的固定数字，当我们迁移到 JDK 1.6 时它发生了变化，有点惊讶。现在它在 Java 6/7 中是一样的，但你永远不知道。这并不能证明该索引在运行时发生了变化——但希望 HotSpot 不会做得那么糟糕。:-)

* * *

## 回答 #5

> 赞同：47
> 
> 时间：2013-03-13T05:21:06.773

```
 public class SomeClass {
   public void foo(){
      class Local {};
      String name = Local.class.getEnclosingMethod().getName();
   }
 } 
```

名称将具有值 foo。

* * *

## 回答 #6

> 赞同：44
> 
> 时间：2015-09-01T10:21:59.757

这两个选项都适用于 Java：

```
new Object(){}.getClass().getEnclosingMethod().getName() 
```

或者：

```
Thread.currentThread().getStackTrace()[1].getMethodName() 
```

* * *

## 回答 #7

> 赞同：34
> 
> 时间：2012-07-30T17:40:37.900

**我发现最快的方法**是：

```
import java.lang.reflect.Method;

public class TraceHelper {
    // save it static to have it available on every call
    private static Method m;

    static {
        try {
            m = Throwable.class.getDeclaredMethod("getStackTraceElement",
                    int.class);
            m.setAccessible(true);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public static String getMethodName(final int depth) {
        try {
            StackTraceElement element = (StackTraceElement) m.invoke(
                    new Throwable(), depth + 1);
            return element.getMethodName();
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }
} 
```

它直接访问本机方法 getStackTraceElement(int depth)。并将可访问的方法存储在静态变量中。

* * *

## 回答 #8

> 赞同：26
> 
> 时间：2012-06-12T07:44:19.940

使用以下代码：

```
 StackTraceElement[] stacktrace = Thread.currentThread().getStackTrace();
    StackTraceElement e = stacktrace[1];//coz 0th will be getStackTrace so 1st
    String methodName = e.getMethodName();
    System.out.println(methodName); 
```

* * *

## 回答 #9

> 赞同：25
> 
> 时间：2018-09-14T15:45:13.150

这可以[`StackWalker`](https://docs.oracle.com/javase/10/docs/api/java/lang/StackWalker.html)从 Java 9 开始使用。

```
public static String getCurrentMethodName() {
    return StackWalker.getInstance()
                      .walk(s -> s.skip(1).findFirst())
                      .get()
                      .getMethodName();
}

public static String getCallerMethodName() {
    return StackWalker.getInstance()
                      .walk(s -> s.skip(2).findFirst())
                      .get()
                      .getMethodName();
} 
```

`StackWalker`被设计成惰性的，所以它可能比`Thread.getStackTrace`急切地为整个调用堆栈创建一个数组更有效。[另请参阅 JEP 了解更多信息。](http://openjdk.java.net/jeps/259)

* * *

## 回答 #10

> 赞同：20
> 
> 时间：2014-02-19T07:13:45.557

```
public static String getCurrentMethodName() {
        return Thread.currentThread().getStackTrace()[2].getClassName() + "." + Thread.currentThread().getStackTrace()[2].getMethodName();
    } 
```

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2012-09-29T14:55:45.697

这是对[virgo47 答案](https://stackoverflow.com/questions/442747/getting-the-name-of-the-current-executing-method/8592871#8592871)的扩展（上图）。

它提供了一些静态方法来获取当前和调用的类/方法名称。

```
/* Utility class: Getting the name of the current executing method 
 * https://stackoverflow.com/questions/442747/getting-the-name-of-the-current-executing-method
 * 
 * Provides: 
 * 
 *      getCurrentClassName()
 *      getCurrentMethodName()
 *      getCurrentFileName()
 * 
 *      getInvokingClassName()
 *      getInvokingMethodName()
 *      getInvokingFileName()
 *
 * Nb. Using StackTrace's to get this info is expensive. There are more optimised ways to obtain
 * method names. See other stackoverflow posts eg. https://stackoverflow.com/questions/421280/in-java-how-do-i-find-the-caller-of-a-method-using-stacktrace-or-reflection/2924426#2924426
 *
 * 29/09/2012 (lem) - added methods to return (1) fully qualified names and (2) invoking class/method names
 */
package com.stackoverflow.util;

public class StackTraceInfo
{
    /* (Lifted from virgo47's stackoverflow answer) */
    private static final int CLIENT_CODE_STACK_INDEX;

    static {
        // Finds out the index of "this code" in the returned stack trace - funny but it differs in JDK 1.5 and 1.6
        int i = 0;
        for (StackTraceElement ste: Thread.currentThread().getStackTrace())
        {
            i++;
            if (ste.getClassName().equals(StackTraceInfo.class.getName()))
            {
                break;
            }
        }
        CLIENT_CODE_STACK_INDEX = i;
    }

    public static String getCurrentMethodName()
    {
        return getCurrentMethodName(1);     // making additional overloaded method call requires +1 offset
    }

    private static String getCurrentMethodName(int offset)
    {
        return Thread.currentThread().getStackTrace()[CLIENT_CODE_STACK_INDEX + offset].getMethodName();
    }

    public static String getCurrentClassName()
    {
        return getCurrentClassName(1);      // making additional overloaded method call requires +1 offset
    }

    private static String getCurrentClassName(int offset)
    {
    return Thread.currentThread().getStackTrace()[CLIENT_CODE_STACK_INDEX + offset].getClassName();
    }

    public static String getCurrentFileName()
    {
        return getCurrentFileName(1);     // making additional overloaded method call requires +1 offset
    }

    private static String getCurrentFileName(int offset)
    {
        String filename = Thread.currentThread().getStackTrace()[CLIENT_CODE_STACK_INDEX + offset].getFileName();
        int lineNumber = Thread.currentThread().getStackTrace()[CLIENT_CODE_STACK_INDEX + offset].getLineNumber();

        return filename + ":" + lineNumber;
    }

    public static String getInvokingMethodName()
    {
        return getInvokingMethodName(2); 
    }

    private static String getInvokingMethodName(int offset)
    {
        return getCurrentMethodName(offset + 1);    // re-uses getCurrentMethodName() with desired index
    }

    public static String getInvokingClassName()
    {
        return getInvokingClassName(2); 
    }

    private static String getInvokingClassName(int offset)
    {
        return getCurrentClassName(offset + 1);     // re-uses getCurrentClassName() with desired index
    }

    public static String getInvokingFileName()
    {
        return getInvokingFileName(2); 
    }

    private static String getInvokingFileName(int offset)
    {
        return getCurrentFileName(offset + 1);     // re-uses getCurrentFileName() with desired index
    }

    public static String getCurrentMethodNameFqn()
    {
        return getCurrentMethodNameFqn(1);
    }

    private static String getCurrentMethodNameFqn(int offset)
    {
        String currentClassName = getCurrentClassName(offset + 1);
        String currentMethodName = getCurrentMethodName(offset + 1);

        return currentClassName + "." + currentMethodName ;
    }

    public static String getCurrentFileNameFqn()
    {
        String CurrentMethodNameFqn = getCurrentMethodNameFqn(1);
        String currentFileName = getCurrentFileName(1);

        return CurrentMethodNameFqn + "(" + currentFileName + ")";
    }

    public static String getInvokingMethodNameFqn()
    {
        return getInvokingMethodNameFqn(2);
    }

    private static String getInvokingMethodNameFqn(int offset)
    {
        String invokingClassName = getInvokingClassName(offset + 1);
        String invokingMethodName = getInvokingMethodName(offset + 1);

        return invokingClassName + "." + invokingMethodName;
    }

    public static String getInvokingFileNameFqn()
    {
        String invokingMethodNameFqn = getInvokingMethodNameFqn(2);
        String invokingFileName = getInvokingFileName(2);

        return invokingMethodNameFqn + "(" + invokingFileName + ")";
    }
} 
```

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2015-09-22T10:39:30.280

要获取调用当前方法的方法的名称，您可以使用：

```
new Exception("is not thrown").getStackTrace()[1].getMethodName() 
```

这适用于我的 MacBook 以及我的 Android 手机

我也试过：

```
Thread.currentThread().getStackTrace()[1] 
```

但 Android 将返回“getStackTrace”我可以为 Android 修复此问题

```
Thread.currentThread().getStackTrace()[2] 
```

但后来我在我的 MacBook 上得到了错误的答案

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2015-11-02T08:21:09.290

实用程序.java：

```
public static String getCurrentClassAndMethodNames() {
    final StackTraceElement e = Thread.currentThread().getStackTrace()[2];
    final String s = e.getClassName();
    return s.substring(s.lastIndexOf('.') + 1, s.length()) + "." + e.getMethodName();
} 
```

SomeClass.java：

```
public class SomeClass {
    public static void main(String[] args) {
        System.out.println(Util.getCurrentClassAndMethodNames()); // output: SomeClass.main
    }
} 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2014-12-15T11:48:42.207

另一种方法是创建但不抛出异常，并使用该对象从中获取堆栈跟踪数据，因为封闭方法***通常***位于索引 0 - 只要 JVM 存储该信息，就像其他人一样上文提到的。然而，这不是最便宜的方法。

从[Throwable.getStackTrace()](http://docs.oracle.com/javase/7/docs/api/java/lang/Throwable.html#getStackTrace%28%29 "Throwable.getStackTrace()")（至少从 Java 5 开始就是这样）：

> 数组的第零个元素（假设数组的长度不为零）表示堆栈的顶部，这是序列中的最后一个方法调用。***通常***，这是这个 throwable 被创建和抛出的点。

下面的代码片段假定该类是非静态的（因为 getClass()），但这是一个旁白。

```
System.out.printf("Class %s.%s\n", getClass().getName(), new Exception("is not thrown").getStackTrace()[0].getMethodName()); 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2013-06-03T11:46:39.170

```
String methodName =Thread.currentThread().getStackTrace()[1].getMethodName();
System.out.println("methodName = " + methodName); 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2016-03-03T06:53:00.543

我有使用这个的解决方案（在 Android 中）

```
/**
 * @param className       fully qualified className
 *                        <br/>
 *                        <code>YourClassName.class.getName();</code>
 *                        <br/><br/>
 * @param classSimpleName simpleClassName
 *                        <br/>
 *                        <code>YourClassName.class.getSimpleName();</code>
 *                        <br/><br/>
 */
public static void getStackTrace(final String className, final String classSimpleName) {
    final StackTraceElement[] steArray = Thread.currentThread().getStackTrace();
    int index = 0;
    for (StackTraceElement ste : steArray) {
        if (ste.getClassName().equals(className)) {
            break;
        }
        index++;
    }
    if (index >= steArray.length) {
        // Little Hacky
        Log.w(classSimpleName, Arrays.toString(new String[]{steArray[3].getMethodName(), String.valueOf(steArray[3].getLineNumber())}));
    } else {
        // Legitimate
        Log.w(classSimpleName, Arrays.toString(new String[]{steArray[index].getMethodName(), String.valueOf(steArray[index].getLineNumber())}));
    }
} 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2016-11-08T02:04:26.123

我不知道获取当前执行的方法名称的意图是什么，但如果这只是为了调试目的，那么像“logback”这样的日志框架可以在这里提供帮助。例如，在 logback 中，您需要做的就是[在日志配置中使用模式“%M”](https://stackoverflow.com/questions/31914337/logback-print-out-method-name-that-called-the-log-method)。但是，应谨慎使用，因为这可能会降低性能。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2018-02-20T14:08:44.237

万一您想知道名称的方法是junit测试方法，则可以使用junit TestName规则：[https ://stackoverflow.com/a/1426730/3076107](https://stackoverflow.com/a/1426730/3076107)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-09-20T18:30:19.430

我改写了一点[马克莱门茨的回答](https://stackoverflow.com/a/11726687/1763602)：

```
private static Method m;

static {
    try {
        m = Throwable.class.getDeclaredMethod(
            "getStackTraceElement",
            int.class
        );
    }
    catch (final NoSuchMethodException e) {
        throw new NoSuchMethodUncheckedException(e);
    }
    catch (final SecurityException e) {
        throw new SecurityUncheckedException(e);
    }
}

public static String getMethodName(int depth) {
    StackTraceElement element;

    final boolean accessible = m.isAccessible();
    m.setAccessible(true);

    try {
        element = (StackTraceElement) m.invoke(new Throwable(), 1 + depth);
    }
    catch (final IllegalAccessException e) {
        throw new IllegalAccessUncheckedException(e);
    }
    catch (final InvocationTargetException e) {
        throw new InvocationTargetUncheckedException(e);
    }
    finally {
        m.setAccessible(accessible);
    }

    return element.getMethodName();
}

public static String getMethodName() {
    return getMethodName(1);
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-03-29T15:50:23.230

这里的大多数答案似乎都是错误的。

```
 public static String getCurrentMethod() {
            return getCurrentMethod(1);
    }
    public static String getCurrentMethod(int skip) {
            return Thread.currentThread().getStackTrace()[1 + 1 + skip].getMethodName();
    } 
```

例子：

```
 public static void main(String[] args) {
            aaa();
    }

    public static void aaa() {
            System.out.println("aaa  -> "  + getCurrentMethod( ) );
            System.out.println("aaa  -> "  + getCurrentMethod(0) );
            System.out.println("main -> "  + getCurrentMethod(1) );
    } 
```

输出：

```
aaa  -> aaa
aaa  -> aaa
main -> main 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-06-14T13:42:46.270

我将此代码片段与带有最新 Java 更新的最新 Android Studio 一起使用。它可以从任何 Activity、Fragment 等中调用。

```
public static void logPoint() {
    String[] splitPath = Thread.currentThread().getStackTrace()[3]
        .toString().split("\\.");

    Log.d("my-log", MessageFormat.format("{0} {1}.{2}",
        splitPath[splitPath.length - 3],
        splitPath[splitPath.length - 2],
        splitPath[splitPath.length - 1]
    ));
} 
```

像这样称呼它

```
logPoint(); 
```

输出

```
... D/my-log: MainActivity onCreate[(MainActivity.java:44)] 
```

* * *

## 回答 #22

> 赞同：-3
> 
> 时间：2016-09-27T10:20:09.557

```
MethodHandles.lookup().lookupClass().getEnclosingMethod().getName(); 
```

* * *

## 回答 #23

> 赞同：-6
> 
> 时间：2014-08-25T05:03:24.217

这种方法有什么问题：

```
class Example {
    FileOutputStream fileOutputStream;

    public Example() {
        //System.out.println("Example.Example()");

        debug("Example.Example()",false); // toggle

        try {
            fileOutputStream = new FileOutputStream("debug.txt");
        } catch (Exception exception) {
             debug(exception + Calendar.getInstance().getTime());
        }
    }

    private boolean was911AnInsideJob() {
        System.out.println("Example.was911AnInsideJob()");
        return true;
    }

    public boolean shouldGWBushBeImpeached(){
        System.out.println("Example.shouldGWBushBeImpeached()");
        return true;
    }

    public void setPunishment(int yearsInJail){
        debug("Server.setPunishment(int yearsInJail=" + yearsInJail + ")",true);
    }
} 
```

在人们疯狂使用`System.out.println(...)`你之前，你总是可以而且应该创建一些方法来重定向输出，例如：

```
 private void debug (Object object) {
        debug(object,true);
    }

    private void dedub(Object object, boolean debug) {
        if (debug) {
            System.out.println(object);

            // you can also write to a file but make sure the output stream
            // ISN'T opened every time debug(Object object) is called

            fileOutputStream.write(object.toString().getBytes());
        }
    } 
```

# silverlight - 全面的silverlight应用的可能性

> ID：442751
> 
> 赞同：4
> 
> 时间：2009-01-14T12:22:39.243
> 
> 标签：silverlight

自从 Silverlight 2 发布以来，我一直期待着大量成熟的 Silverlight 应用程序出现，但似乎仍然没有这方面的证据。有没有人知道野外有这样的应用程序。还有什么是您将在 Silverlight 中开发的明显应用程序。我会说邮件客户端是不好的例子，因为它们也可以写成 web/ajax 应用程序。由于 Silverlight 比 web+ajax 强大得多，因此可能的候选者应该不可能/不公平地实现为 web/ajax 应用程序。

我想到的是

*   照片和图像编辑应用程序
*   报告应用程序
*   办公应用程序、Word/Excel...

编辑：从帖子中添加

*   游戏

关键不是应用程序需要填满整个屏幕，只是它不仅仅是网页的一小部分，或者您可以将其称为在网络浏览器内运行的完整应用程序，仅使用网络浏览器作为主机。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T12:48:09.113

我认为微软自己开发的医疗应用程序很好地展示了 Silverlight 可以实现的目标[http://www.mscui.net/PatientJourneyDemonstrator/](http://www.mscui.net/PatientJourneyDemonstrator/)

至于图像编辑，据我所知，这有点困难，因为 Silverlight 缺乏能够进行每像素图像编辑的位图 API……

编辑：

我注意到您在问题中添加了 Word/Excel，并且出现了 Silverlight 没有内置富文本编辑器的问题，并且没有真正好的自定义实现示例。有一个[http://www.codeplex.com/richtextedit](http://www.codeplex.com/richtextedit)但我还没有看到任何实际使用它的应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-14T13:44:55.053

我正在研究医学领域的一个。

这开始是作为 Mac 经典应用程序的更新，但由于涉及的工作量，扩大到考虑其他工具包。我说服他们选择最初的 WPF 桌面端口，然后是 Silverlight 版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T12:29:31.757

到目前为止我还不知道，但我可以想象它可以用于 youtube 上的全屏视频播放。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T12:33:29.143

有多少全屏桌面应用程序？大多数应用程序不需要整个屏幕。如果您不想被菜单和任务栏分心，那么您可以全屏显示。另一种可以使用全屏的应用程序是游戏。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T12:38:57.137

您只能在全屏模式下使用某些按键，例如箭头键、制表符、回车键和空格键，因此这排除了其中一些类型的应用程序。他们出于安全原因这样做，因此应用程序无法劫持屏幕并记录按键，但我希望他们能提出一个方案来充分警告用户，然后在他们同意的情况下允许它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-14T12:53:38.620

微软似乎喜欢展示的一个应用程序是完全用 Silverlight 编写的[AOL 邮件客户端。](http://archive.visitmix.com/blogs/News/Keynote-AOL/)

就我个人而言，我遵循的规则是，如果您不会在 flash 中编写它，那么在大多数情况下，您不会在 silverlight 中编写它，更喜欢 AJAX。过去，大多数大型 Flash 应用程序都失败了，例如 Flash 文字处理器（不记得名称），而支持 AJAX 的应用程序（例如 google 文档）已经起飞。

最后，我相信在[moonlight](http://www.mono-project.com/Moonlight)（Linux 和mac 支持）发布并且更多普通用户下载silverlight 之前，开发人员将不愿意广泛使用它，即使是对于较小的应用程序和小工具。

# cocoa-touch - 在 NSTextView 中格式化文本

> ID：442755
> 
> 赞同：0
> 
> 时间：2009-01-14T12:23:28.493
> 
> 标签：cocoa-touch

我有一个案例，我得到带有`<a href ...>`, `<em>`, `<br>`, `&quot;`, 等标签的格式化文本，并且我在文本视图中显示它。我如何应用这些格式？如果我不能，删除所有这些标签的最通用方法是什么？

谢谢，穆斯塔法

* * *

不，我只想在不可编辑的 NSTextView 中显示格式化文本。或者可能是 UIWebView，它会自动处理像这样的标签`<em>`吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T13:19:31.453

如果你想要可编辑的文本，你将不得不使用像[Tidy](http://tidy.sourceforge.net/)这样的库来解析它以获得一个 NSString，然后将它传递给 UITextView 的`-setText:`方法

如果需要显示 HTML，请使用 UIWebView。

如果您想将 HTML 编辑为格式化文本，您将不得不自己滚动或使用私有 API。

# java - 哪个 java 库计算累积标准正态分布函数？

> ID：442758
> 
> 赞同：10
> 
> 时间：2009-01-14T12:24:51.313
> 
> 标签：java, statistics, probability, computation

对于一个项目，我有一个带有公式的规范，我必须实施。在这些公式中，存在累积标准正态分布函数，它采用浮点数并输出概率。该函数用 Φ 表示。是否存在计算此函数的 Java 库？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-14T12:33:41.157

[Apache Commons - Math](http://commons.apache.org/math/)有你正在寻找的东西。

更具体地说，查看[`NormalDistribution`](http://commons.apache.org/proper/commons-math/apidocs/org/apache/commons/math3/distribution/NormalDistribution.html)课程。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-12-04T19:23:27.377

如果您想要确切的代码，这似乎与 OpenOffice Calc 中使用的函数相同（我已经对其进行了一些更改以使其在 java 中工作）：

```
// returns the cumulative normal distribution function (CNDF)
// for a standard normal: N(0,1)
double CNDF(double x)
{
    int neg = (x < 0d) ? 1 : 0;
    if ( neg == 1) 
        x *= -1d;

    double k = (1d / ( 1d + 0.2316419 * x));
    double y = (((( 1.330274429 * k - 1.821255978) * k + 1.781477937) *
                   k - 0.356563782) * k + 0.319381530) * k;
    y = 1.0 - 0.398942280401 * Math.exp(-0.5 * x * x) * y;

    return (1d - neg) * y + neg * (1d - y);
} 
```

在这里找到它：http: [//www.codeproject.com/Messages/2622967/Re-NORMSDIST-function.aspx](http://www.codeproject.com/Messages/2622967/Re-NORMSDIST-function.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-14T15:24:58.330

一位同事建议使用[colt](http://acs.lbl.gov/~hoschek/colt/)，因为他以前使用过。此[函数](http://acs.lbl.gov/~hoschek/colt/api/cern/jet/random/Normal.html#cdf(double))的结果与参考文档中的示例完全相同。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-06-24T16:59:24.300

SuanShu 是[一个 Java 数值分析库](https://nm.dev)，用于计算正态分布和许多其他统计分布。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-11-18T22:54:57.430

您可以使用幂级数公式，它只占用大约 10 行代码......例如参见[http://introcs.cs.princeton.edu/java/22library/Gaussian.java.html](http://introcs.cs.princeton.edu/java/22library/Gaussian.java.html)（函数`Phi`）

# ruby - 直接在 2 个不同的浏览器中运行脚本

> ID：442770
> 
> 赞同：1
> 
> 时间：2009-01-14T12:27:08.703
> 
> 标签：ruby

我创建了 Ruby 测试脚本，它使用 Selenium RC 在 2 个浏览器（IE、Firefox）中直接测试我的 Web 应用程序。我的脚本运行 - 首先在 IE 上然后在 Firefox 上继续，然后应该在已经打开的 IE 浏览器中继续并完成。我的问题是：我无法继续（重新连接）在已打开的 IE 浏览器中运行我的脚本。我用：

```
@browser = RSpecSeleniumHelper.connect_browser("URL") 
```

但它以新会话打开（它需要保留上一个会话）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T19:11:28.357

我也不确定为什么您需要在浏览器中来回切换。

无论如何，我正在做类似的事情，但我使用了不同的库。我正在使用“硒”宝石。(gem install selenium) 这就是我在你的情况下会做的事情。

```
@ie_driver = Selenium::SeleniumDriver.new(rc_host, port, "*iexplore", url, 1000)
@ie_driver.start 
@ie_driver.whatever //Test code
@ff_driver = Selenium::SeleniumDriver.new(rc_host, port, "*firefox", url, 1000)
@ff_driver.start  
@ff_driver.whatever //Test code
@ff_driver.stop
@ie_driver.whatever //Continue test code with IE
@ie_driver.stop 
```

总之，虽然我对您的 selenium 库并不十分熟悉，但通常我会创建 2 个 R/C 驱动程序实例，这样我就不必中断会话。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T13:03:37.087

Is there a particular reason you need to switch between browsers half way through?

I have no idea how you'd fix the problem, but it seems like it would be best solved by running the tests in one browser at a time.

# functional-programming - 这种功能性“模式”叫什么？

> ID：442772
> 
> 赞同：6
> 
> 时间：2009-01-14T12:28:36.330
> 
> 标签：functional-programming, naming-conventions, nomenclature

当我遇到对这个函数的需求时，我正在玩一些函数式编程，但是我不知道在标准命名法中这种东西是什么。有人认得吗？

```
function WhatAmIDoing(args...)
   return function()
       return args
   end
end 
```

**编辑：**概括该函数，它接受可变数量的参数（或者可能是一个隐式列表）并返回一个函数，该函数在调用时返回所有参数，例如咖喱或泡菜，但似乎也不是。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-14T13:33:53.797

WhatAmIDoing 是一个[高阶函数](http://en.wikipedia.org/wiki/Higher_order_function)，因为它是一个返回另一个函数的函数。

它返回的是一个[thunk——](http://en.wikipedia.org/wiki/Thunk)一个为延迟计算实际值而创建的闭包。通常创建 thunk 是为了懒惰地评估一个表达式（并且可能记住它），但在其他情况下，只需要一个函数来代替一个裸值，如 " `constantly 5`" 的情况，在某些语言中返回一个总是返回 5。

后者可能适用于给定的示例，因为假设语言以应用顺序进行评估（即在调用函数之前评估参数），该函数除了将值转换为返回它们的函数之外没有其他用途。

WhatAmIDoing 实际上是我所描述的“不断”功能的实现。但一般来说，您不必只`args`在内部函数中返回。您可以返回“ `ackermann(args)`”，这可能需要很长时间，例如...

```
function WhatAmIDoing2(args...)
   return function()
       return ackermann(args)
   end
end 
```

但是 WhatAmIDoing2 会立即返回，因为对 ackermann 函数的评估将在[闭包](http://en.wikipedia.org/wiki/Closure_(computer_science))中暂停。（是的，即使是按值调用的语言。）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-14T12:43:49.093

在函数式编程中，将另一个函数作为参数或返回另一个函数的函数称为[高阶函数](http://en.wikipedia.org/wiki/Higher_order_function)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-14T12:34:53.510

我会说 XXXX 返回绑定在 x、y 和 z 值上的未命名函数的*闭包。*

这篇[维基百科](http://en.wikipedia.org/wiki/Closure_(computer_science))文章可能会有所启发

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-14T13:43:32.497

[柯里](http://en.wikipedia.org/wiki/Currying)化是将一个函数转换为一系列函数，每个函数只接受一个参数并返回另一个这样的函数。所以，这个例子与柯里化无关。

酸洗是一个通常用来表示某种序列化的术语。也许用于存储由多个值构建的对象。

如果您感兴趣的方面是返回的函数可以访问 XXXX 函数的参数，那么我会选择 Remo.D。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-14T14:19:36.870

正如其他人所说，它是一个[高阶函数](http://en.wikipedia.org/wiki/Higher-order_function)。由于您的问题中有“模式”，我想我要补充一点，功能语言的这一特性通常是使用没有高阶函数的语言中的[策略模式来建模的。](http://en.wikipedia.org/wiki/Strategy_pattern)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-12T17:55:34.090

`constantly`Clojure中调用了非常相似的东西：

[http://github.com/richhickey/clojure/blob/ab6fc90d56bfb3b969ed84058e1b3a4b30faa400/src/clj/clojure/core.clj#L1096](http://github.com/richhickey/clojure/blob/ab6fc90d56bfb3b969ed84058e1b3a4b30faa400/src/clj/clojure/core.clj#L1096)

只有`constantly`返回的函数采用任意数量的参数，使其比您的模式更通用（和灵活）。

我不知道这个模式是否有名字，但会在通常需要函数的情况下使用它，但我只关心返回某个值：

```
(map (constantly 9) [1 2 3])
=> (9 9 9) 
```

只是想知道，你用这个做什么？

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-01-14T12:33:10.267

代表？

基本上你正在返回一个函数？还是函数的输出？

没看懂，抱歉。。。

# php - 如何从 PHP 中包含的类中获取文件名

> ID：442780
> 
> 赞同：2
> 
> 时间：2009-01-14T12:30:44.390
> 
> 标签：php, include, filenames

我知道这个问题很难理解，我不知道如何更好地问它，所以我将使用这个代码示例让事情更清楚：
如果我有以下文件：

测试.php：

```
<?php
 include('include.php');
 echo myClass::myStaticFunction();
?> 
```

包含.php

```
<?php
 __autoload($classname){
  include_once("class/".$classname.".php"); //normally checking of included file would happen
 }
?> 
```

类/myClass.php

```
<?php
 class myClass{
  public static function myStaticFunction(){
   //I want this to return test.php, or whatever the filename is of the file that is using this class
   return SOMETHING;
  }
?> 
```

神奇的 FILE 常量不正确，它返回 path/to/myClass.php

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-14T12:37:41.227

如果您需要获取“test.php”，请参阅`$_SERVER['SCRIPT_NAME']`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-14T15:23:08.473

我最终使用：

```
$file = basename(strtolower($_SERVER['SCRIPT_NAME'])); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-26T21:53:22.847

我在用

```
$arr = @debug_backtrace(false);
if (isset($arr))
foreach ($arr as $data)
{
 if (isset($data['file']))
 echo $data['file'];
 // change it to needed depth
} 
```

这样您就不需要修改包含您的文件的文件。debug_backtrace 可能有一些速度方面的问题。

# c++ - 析构函数：琐碎与隐式定义

> ID：442784
> 
> 赞同：4
> 
> 时间：2009-01-14T12:32:32.360
> 
> 标签：c++, destructor

据我理解的标准，一个平凡的析构函数是隐式声明的，其类只有基和非静态成员和平凡的析构函数。鉴于此定义的递归性，在我看来，唯一的“递归停止”条件是找到具有非隐式声明的析构函数（即用户声明）的基本或非静态成员。如果这是正确的，那应该意味着微不足道的析构函数是“不需要做任何事情”的析构函数，因此它将被声明（隐式）但未定义。以另一种方式说：根据标准定义，隐式*定义*的析构函数（即“它做某事”）不能是微不足道的说法是否正确？

对于那种愚蠢的问题，我很抱歉，但我想澄清一下我脑海中的一些事情......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-14T12:37:23.393

不。一个隐式定义的，平凡的析构函数是微不足道的 :) 声明和定义之间的区别是，为了让编译器甚至可以*看到*析构函数可用，必须始终有一个声明。因此，如果您不提供一个，它将隐式提供一个。

但是现在，如果需要（如果该类类型的对象被销毁），它也会定义一个。无论如何，它必须做一些事情：它需要调用其所有成员和基类的析构函数。一个简单的例子说明了隐式定义析构函数的效果：

```
struct a {
private:
    ~a();
};

struct bug {
    // note: can't be destructed
    a a_;
}; 
```

一旦你试图创建一个 bug 的本地对象，编译器就会发出一个错误信号，因为它产生了一个 bug 的析构函数的定义，它试图调用 a 的不可访问的析构函数。

现在，我认为析构函数/构造函数的琐碎性主要用于对您的程序施加约束。例如，具有非平凡版本的对象不能放在联合中。另一方面，您可以删除具有不完整类型的对象，前提是它具有微不足道的析构函数。请注意，如果您的程序无法确定是否实际定义了普通析构函数，则允许编译器省略定义它。这就是所谓的`as-if`规则。编译器必须表现得好像它符合标准 - 只要不改变程序的含义，优化就无关紧要。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-14T12:59:25.393

你的措辞有点不幸。例如，当您用完成员和基类时，当然递归也会结束。这些措辞问题似乎也让你更加困惑。

无论如何，所有隐式声明的析构函数，无论它们是否微不足道，当且仅当它们被使用时才被定义。*使用*在这里是一个特定的术语。每当 T 对象的生命周期结束时，都会*使用*T 类型的析构函数。

存在微不足道的析构函数是因为 C 程序员将结构放在联合中。这段代码在 C++ 中应该是合法的，因此为 C++ 发明了普通析构函数的概念。当编译为 C++ 时，所有 C 结构都有微不足道的析构函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T12:46:01.350

考虑这两个类：

```
class A {
};

class B {
private:
     A obj;
}; 
```

这两个类的析构函数都是隐式定义的。然而，与此同时，按照标准定义，它们都是微不足道的。

# html - 可以嵌套 HTML 注释吗？

> ID：442786
> 
> 赞同：106
> 
> 时间：2009-01-14T12:32:38.163
> 
> 标签：html, validation, comments

根据标题；是否可以在有效的 HTML 中包含嵌套注释？请参阅下面的示例...

```
<p>some text</p>

  <!-- comment 1

    <p>commented out html</p>

    <!-- comment 2

      // are nested html comment allowed?

    end of comment 2 -->

    <p>more commented out html</p>

  end of comment 1 -->

<p>some more text</p> 
```

似乎没有，有人知道我如何让嵌套评论起作用吗？

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2009-01-14T12:35:30.590

嵌套注释时，将“--”替换为“- -”。取消嵌套时，反转该过程。不是`<!--`禁止的，而是禁止的`--`。

例子：

```
<!-- some stuff
<!- - some inner stuff - ->
<!- - a sibling - ->
the footer --> 
```

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2012-08-24T01:26:11.333

**TL;DR**：不幸的是，不，这是不可能的（而且永远不会）。

**简短的回答：**

HTML 注释并不像许多人认为的那样。HTML 是 SGML 的一种形式，其中注释由成对的双破折号 ( `--`… <kbd>--) 分隔。

`<!` `--`因此，一对尖括号内的任何一对双破折号在左括号 ( ⋯ )后带有一个感叹号`--` `>`是注释。规范说得比我好：[http ://www.w3.org/TR/html4/intro/sgmltut.html#h-3.2.4](http://www.w3.org/TR/html4/intro/sgmltut.html#h-3.2.4)

这就是为什么像这样的评论（我们***都***可能曾经做过一次）是一个***坏***主意：

```
<!-- ------------------ 标题从这里开始 -------------------- -->
```

*真相：我懒得告诉你上面的标签污染代表了多少评论，但至少有10条。*

> 我变得不那么懒惰了：这个所谓的“评论”实际上由 10 条评论、任何评论之外的三个词（即，只是糟糕的 SGML）和未终止的评论的开头组成。真是一团糟：
> 
> ```
> <!--1 ----2 ----3 ----4 ----5--
> 标题从这里开始
> --6 ----7 ----8 ----9 ----10-- -->
> ```

当然，由于每个浏览器选择解释规范的方式不同，它并不是那么简单*。*

这是一篇很好的文章来解释它：

    [http://weblog.200ok.com.au/2008/01/dashing-into-trouble-why-html-comments.html](http://weblog.200ok.com.au/2008/01/dashing-into-trouble-why-html-comments.html)

**长答案：为什么我们弄错了**

我们大多数在 HTML 中长大的人（没有深入研究它背后的 SGML））已经开始相信字符串`<!--`开始注释，字符串`-->`结束注释。

实际上，`<!`在`>`您的 HTML 文档中定义一个 SGML 声明，例如我们在页面顶部看到的 DOCTYPE 声明。*在*SGML 声明中，注释由双破折号分隔。因此，HTML 注释

```
<!-- 这是一条评论 -->
```

我们大多数人会认为是这样解析`<!--` `this is a comment` `-->`的，实际上是这样解析的：
`<!``--` `this is a comment` `--``>`. 它是一个除注释外为空的 SGML 声明。

因为 HTML 是 SGML 的一种形式，所以这个“comment-within-a-declaration”起到 HTML 注释的作用。

出于兴趣，这里有一块纯 SGML，它显示了在 SGML 中的预期功能：这个属性列表定义在每一行都包含一个注释：

```
<!ATTLIST 链接
  %attrs; -- %coreattrs, %i18n, %events --
  字符集 %字符集；#IMPLIED -- 链接资源的字符编码 --
  参考 %URI；#IMPLIED -- 链接资源的 URI --
  hreflang %语言代码；#IMPLIED -- 语言代码 --
  类型%内容类型；#IMPLIED -- 咨询内容类型 --
  相对 %LinkTypes; #IMPLIED -- 前向链接类型 --
  转 %LinkTypes; #IMPLIED -- 反向链接类型 --
  媒体 %MediaDesc; #IMPLIED -- 用于在这些媒体上渲染 --
>
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2017-05-10T20:25:20.747

如果你真的被一些 HTML 卡住了——在一些无法控制的源上预渲染——其中包含注释，并且你需要确保它没有在你的页面上呈现，你总是可以用`script`下面的标签来包装它，唯一的问题是，您不能以这种方式注释掉`script`标签。

```
<p>some text</p>

<!-- multiline "comment" below using script type="text/html" -->
<script type="text/html">

  <p>commented out html</p>

  <!-- comment 2

      // are nested html comment allowed?

    end of comment 2 -->

  <p>more commented out html</p>

</script>

<p>some more text</p>
```

如果你需要注释掉`script`标签，你可以使用`textarea`as 包装器，当然这样做，你不能注释掉`textarea`标签。

```
<p>some text</p>

<!-- multiline "comment" below using textarea style="display:none;" -->
<textarea style="display:none;">

  <script>  

    alert("which won't show up..");  

  </script>

  <p>commented out html</p>

  <!-- comment 2

      // are nested html comment allowed?

    end of comment 2 -->

  <p>more commented out html</p>

</textarea>

<p>some more text</p>
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2018-05-03T12:32:25.813

使用`template`标签。阻止所有评论和其他 html 显示的最快方法。

```
<template>
    <!-- first paragraph-->
    Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.

    <!-- second paragraph-->
    Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
</template>

    <!-- third paragraph-->
    Ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.sunt in culpa qui officia deserunt mollit. 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-01-14T12:34:43.837

这是不可能的。`-->`将始终结束现有的 HTML 注释。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2021-09-03T14:09:28.810

`<!-- comment1 <!-- comment2--> -->`不允许嵌套 HTML 注释。

但是您可以通过使用`<script>`标签和`/* */`（Hacky 解决方案）来实现：

```
<script>
/*
  HTML code you want to comment on goes between the Javascript comment section
*/
</script> 
```

**注意：**您也可以`<script>...</script>`在同一个 HTML 文件中包含多对用于注释代码的不同部分。

**示例：**下面的注释`"Some Statement 2, 3, 4, 5 and 6"`

```
<p> Some Statement 1 </p>

<script>
/*
<p> Some Statement 2 </p>

<!-- explanation about below statement 3 by the comment tag -->
<p> Some Statement 3 </p>

<!-- 
<p> Some Statement 4 </p> 
<p> Some Statement 5 </p>
-->

<p> Some Statement 6 </p>
*/
</script>

<p> Some Statement 7 </p> 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-04-24T21:12:28.493

一个 VS 插件，它通过自动转换`<!--...-->`为`<!~~...~~>`然后注释掉整个部分来伪造嵌套评论。它可以让您打开和关闭它。

[嵌套评论](https://marketplace.visualstudio.com/items?itemName=philsinatra.nested-comments)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-14T12:39:27.837

一些编辑器具有注释/取消注释命令，可以自动处理文本块中的现有注释。例如，当您按下 Ctrl+KC 和 Ctrl+KU 时，Visual Studio 就会这样做。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-08-11T06:48:17.090

尝试使用这个

```
<!-- 
```

这是评论的开始

```
<%-- this is another comment --%>

<%-- this is another one --%> 
```

`-->`评论结束。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-11-02T15:03:39.650

试试这个

```
<p>some text</p>
<comment> comment 1
<p>commented out html</p>
<!-- comment 2
  // are nested html comment allowed?
end of comment 2 -->
<p>more commented out html</p>
end of comment 1 </comment>
<p>some more text</p> 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-01-30T18:14:28.343

我认为这是不允许的，但据我所知，它适用于除 Firefox 之外的大多数主要浏览器。

# c# - SSIS - 将数据重定向到不同的输出

> ID：442807
> 
> 赞同：0
> 
> 时间：2009-01-14T12:40:23.670
> 
> 标签：c#, sql-server-2005, ssis

我正在开发一个从 SSIS 中的 PipelineComponent 继承的自定义组件。

这是“ProvideComponentProperties”代码片段：

```
IDTSOutput90 output = ComponentMetaData.OutputCollection.New();
output.Name = "Output";
output.SynchronousInputID = input.ID;
output.ExclusionGroup =0;
m_DefaultOutputId = output.ID;

IDTSOutput90 discardedOutput = ComponentMetaData.OutputCollection.New();
discardedOutput.Name = "Discarded Output";
discardedOutput.SynchronousInputID = output.SynchronousInputID;
discardedOutput.ExclusionGroup = 1;
//I don't want it to be an output
//discardedOutput.IsErrorOut = true; 
m_DiscardedOutputId = discardedOutput.ID; 
```

然后在过程输入中我有这个：

```
while (buffer.NextRow())
{
    bool discarded = true;
    if  (//Discard condition)
    {
        for (int columnIndex = 0; columnIndex < input.InputColumnCollection.Count; columnIndex++)
        {
            //Write to buffer
        }
        discarded = false;
    }
    if (discarded)
    {
        buffer.DirectRow(discardedOutput.ID);
    }
    rowIndex++;
} 
```

我遇到的问题不是重定向行。该行将其流量保留在“输出”输出中，而不是通过“丢弃的输出”。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-08-10T14:40:35.007

我认为两个输出的 ExclusionGroup 需要相同（使 output.ExclusionGroup=1 而不是 0）。

# objective-c - Techniques for implementing -hash on mutable Cocoa objects

> ID：442808
> 
> 赞同：12
> 
> 时间：2009-01-14T12:40:27.773
> 
> 标签：objective-c, cocoa, cocoa-touch, hash

The documentation for `-hash` says it must not change while a mutable object is stored in a collection, and similarly the documentation for `-isEqual:` says the `-hash` value must be the same for equal objects.

Given this, does anybody have any suggestions for the best way to implement `-hash` such that it meets both these conditions and yet is actually calculated intelligently (i.e. doesn't just return `0`)? Does anybody know how the mutable versions of framework-provided classes do this?

The simplest thing to do is of course just forget the first condition (about it not changing) and just make sure I never accidentally mutate an object while it's in a collection, but I'm wondering if there's any solution that's more flexible.

*EDIT:* I'm wondering here whether it's possible to maintain the 2 contracts (where equal objects have equal hashes, and hashes don't change while the object is in a collection) when I'm mutating the internal state of the object. My inclination is to say "no", unless I do something stupid like always return 0 for the hash, but that's why I'm asking this question.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T16:11:25.880

Interesting question, but I think what you want is logically impossible. Say you start with 2 objects, A and B. They're both different, and they start with different hash codes. You add both to some hash table. Now, you want to mutate A, but you can't change the hash code because it's already in the table. However, it's possible to change A in such a way that it .equals() B.

In this case, you have 2 choices, neither of which works:

1.  Change the hashcode of A to equal B.hashcode, which violates the constraint of not changing hash codes while in a hash table.
2.  Don't change the hashcode, in which case A.equals(B) but they don't have the same hashcodes.

It seems to me that there's no possible way to do this without using a constant as a hashcode.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-14T14:02:33.130

My reading of the documentation is that a mutable object's value for `hash` *can* (and probably should) change when it is mutated, but *should not* change when the object hasn't been mutated. The portion of the documentation to which to refer, therefore, is saying, "Don't mutate objects that are stored in a collection, because that will cause their `hash` value to change."

To quote directly from the [NSObject documentation for `hash`](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Protocols/NSObject_Protocol/Reference/NSObject.html#//apple_ref/occ/intfm/NSObject/hash):

> If a mutable object is added to a collection that uses hash values to determine the object’s position in the collection, the value returned by the hash method of the object must not change while the object is in the collection. *Therefore, either the hash method must not rely on any of the object’s internal state information or you must make sure the object’s internal state information does not change while the object is in the collection*.

(Emphasis mine.)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-18T03:14:56.660

The question here isn't how to meet both of these requirements, but rather which one you *should* meet. In Apple's documentation, it is clearly stated that:

> a mutable dictionary can be put in a hash table but you must not change it while it is in there.

This being said, it seems more important that you meet the equality requirement of hashes. The hash of an object should always be a way to check if an object is equal to another. If this is ever not the case, it is not a true hash function.

Just to finish up my answer, I'll give an example of a good hash implementation. Let's say you are writing the implementation of `-hash` on a collection that you have created. This collection stores an array of NSObjects as pointers. Since all NSObjects implement the hash function, you can use their hashes in calculating the collection's hash:

```
- (NSUInteger)hash {
    NSUInteger theHash = 0;
    for (NSObject * aPtr in self) { // fast enumeration
        theHash ^= [aPtr hash];
    }
    return theHash;
} 
```

This way, two collection objects containing the same pointers (in the same order) will have the same hash.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T08:53:03.923

Since you are already overriding -isEqual: to do a value-based comparison, are you sure you really need to bother with -hash?

I can't guess what exactly you need this for of course, but if you want to do value-based comparison without deviating from the expected implementation of -isEqual: to only return YES when hashes are identical, a better approach might be to mimick NSString's -isEqualToString:, so to create your own -isEqualToFoo: method instead of using or overriding -isEqual:.

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2018-11-09T16:01:57.487

The answer to this question and the key to avoiding many cocoa-bugs is this:

Read the documentation carefully. Place every word and punctuation on a golden scale and weight it as it was the world's last grain of wheat.

Let's read the documentation again:

> If a mutable object is added to a collection that uses hash values to determine the ***object’s position*** in the collection, [...]

(emphasis mine).

What the writer of the docs, in his/hers eternal wisdom, mean by this is that when you are implementing a collection, like a dictionary, you shouldn't use the hash for positioning since that can change. In other words it has little to do with implementing -hash on mutable Cocoa objects (which all of us thought it had, assuming the documentation has not changed in the last ~10 years since the question was asked).

That is why dictionaries always copy their keys - so they can guarantee that the hash value won't change.

You will then ask the question: But, good sir, how does NSMapTable and similar handle this?

The answer to this is according to the documentation:

> "Its keys or values ***may*** be copied on input or ***may*** use pointer identity for equality and hashing."

(emphasis mine again).

Since we were so easily fooled by the documentation last time, let's run a little experiment to see for ourselves how stuff actually work:

```
NSMutableString *string = [NSMutableString stringWithString:@"so lets mutate this"];
NSString *originalString = string.copy;
NSMapTable *mutableStrings = [NSMapTable strongToStrongObjectsMapTable];
[mutableStrings setObject:originalString forKey:string];

[string appendString:@" into a larger string"];
if ([mutableStrings objectForKey:string] == nil)
    NSLog(@"not found!");

if ([mutableStrings objectForKey:originalString] == nil)
    NSLog(@"Not even the original string is found?");

for (NSString *inCollection in mutableStrings)
{
    NSLog(@"key '%@' : is '%@' (null)", inCollection, [mutableStrings objectForKey:inCollection]);
}
for (NSString *value in NSAllMapTableValues(mutableStrings))
{
    NSLog(@"value exists: %@", value);
} 
```

Surprise!

So, instead of using pointer equality, they focus on the words "may" here which in this case mean "may not", and simply copy the hash value when adding stuff to the collection.

(All this is actually good, since it would be quite difficult to implement NSHashMap, or -hash, otherwise).

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-01-14T12:47:03.203

In Java, most mutable classes simply don’t override [Object.hashCode()](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html#hashCode()) so that the default implementation returns a value that is based on the address of the object and doesn’t change. It might just be the same with Objective C.

# php - 您如何将 sql 查询嵌入 php 脚本（编码风格）？

> ID：442811
> 
> 赞同：10
> 
> 时间：2009-01-14T12:41:51.263
> 
> 标签：php, sql, coding-style

你如何在 php 中嵌入你的 sql 脚本？你只是把它们写在一个字符串或一个heredoc中，还是你把它们外包给一个sql文件？外包时是否有最佳实践？有没有一种优雅的方式来组织这个？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-14T12:54:31.457

Use a framework with an ORM (Object-Relational Mapping) layer. That way you don't have to put straight SQL anywhere. Embedded SQL sucks for readability, maintenance and everything.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-14T13:09:28.713

Always remember to escape input. Don't do it manually, use prepared statements. Here is an example method from my reporting class.

```
public function getTasksReport($rmId, $stage, $mmcName) {
    $rmCondition = $rmId ? 'mud.manager_id = :rmId' : 'TRUE';
    $stageCondition = $stage ? 't.stage_id = :stageId' : 'TRUE';
    $mmcCondition = $mmcName ? 'mmcs.username = :mmcName' : 'TRUE';
    $sql = "
            SELECT
                    mmcs.id AS mmc_id,
                    mmcs.username AS mmcname,
                    mud.band_name AS mmc_name,
                    t.id AS task_id,
                    t.name AS task, 
                    t.stage_id AS stage,
                    t.role_id,
                    tl.id AS task_log_id,
                    mr.role,
                    u.id AS user_id,
                    u.username AS username,
                    COALESCE(cud.full_name, bud.band_name) AS user_name,
                    DATE_FORMAT(tl.completed_on, '%d-%m-%Y %T') AS completed_on,
                    tl.url AS url,
                    mud.manager_id AS rm_id
            FROM users AS mmcs
            INNER JOIN banduserdetails AS mud ON mud.user_id = mmcs.id
            LEFT JOIN tasks AS t ON 1
            LEFT JOIN task_log AS tl ON tl.task_id = t.id AND tl.mmc_id = mmcs.id
            LEFT JOIN mmc_roles AS mr ON mr.id = t.role_id
            LEFT JOIN users AS u ON u.id = tl.user_id
            LEFT JOIN communityuserdetails AS cud ON cud.user_id = u.id
            LEFT JOIN banduserdetails AS bud ON bud.user_id = u.id
            WHERE mmcs.user_type = 'mmc'
                    AND $rmCondition
                    AND $stageCondition
                    AND $mmcCondition
            ORDER BY mmcs.id, t.stage_id, t.role_id, t.task_order
    ";
    $pdo = new PDO(.....);
    $stmt = $pdo->prepare($sql);
    $rmId and $stmt->bindValue('rmId', $rmId); // (1)
    $stage and $stmt->bindValue('stageId', $stage); // (2)
    $mmcName and $stmt->bindValue('mmcName', $mmcName); // (3)
    $stmt->execute();
    return $stmt->fetchAll();
} 
```

In lines marked (1), (2), and (3) you will see a way for conditional binding.

For simple queries I use ORM framework to reduce the need for building SQL manually.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-14T12:54:30.583

It depends on a query size and difficulty.

I personally like heredocs. But I don't use it for a simple queries. That is not important. The main thing is **"Never forget to escape values"**

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-14T12:59:44.550

You should always really really ALWAYS use prepare statements with place holders for your variables.

Its slightly more code, but it runs more efficiently on most DBs and protects you against SQL injection attacks.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-10T23:02:29.610

我更喜欢这样：

```
$sql = "SELECT tbl1.col1, tbl1.col2, tbl2.col1, tbl2.col2"
        . " FROM Table1 tbl1"
        . " INNER JOIN Table2 tbl2 ON tbl1.id = tbl2.other_id"
        . " WHERE tbl2.id = ?"
        . " ORDER BY tbl2.col1, tbl2.col2"
        . " LIMIT 10, 0"; 
```

连接所有字符串可能需要 PHP 稍长一点的时间，但我认为它看起来更好并且更容易编辑。

当然，对于极长且专门的查询，读取 .sql 文件或使用存储过程是有意义的。根据您的框架，这可能很简单：

```
$sql = (string) View::factory('sql/myfile'); 
```

（如有必要，您可以选择在视图/模板中分配变量）。如果没有模板引擎或框架的帮助，您将使用：

```
$sql = file_get_contents("myfile.sql"); 
```

希望这可以帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-14T12:52:31.960

我通常将它们写为函数参数：

```
db_exec ("SELECT ..."); 
```

除了 sql 会非常大的情况，我将它作为变量传递：

```
$SQL = "SELECT ...";
$result = db_exec ($SQL); 
```

（我使用包装函数或对象进行数据库操作）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-11T00:59:00.110

我喜欢这种格式。它在之前的评论中提到过，但对我来说，这种对齐方式似乎不对劲。

```
$query = "SELECT "
       . " foo, "
       . " bar "
       . "FROM "
       . " mytable "
       . "WHERE "
       . " id = $userid"; 
```

很容易阅读和理解。点与等号对齐，使所有内容保持整洁。

我也喜欢将 SQL 保存在单独文件中的想法，尽管我不确定在上面的示例中如何使用 $userid 等变量。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-14T19:04:42.177

一旦达到一定的水平，您就会意识到您编写的 99% 的 SQL 都可以自动化。如果您编写的查询太多以至于您想到了属性文件，那么您可能正在做一些更简单的事情：

我们程序员做的大部分事情都是 CRUD：创建读取更新删除

作为我自己的工具，我构建了 Pork.dbObject。2个简单类中的对象关系映射器+活动记录（数据库抽象+ dbObject类）

我网站上的几个例子：

创建一个博客：

```
 $weblog = new Weblog(); // create an empty object to work with. 
    $weblog->Author = 'SchizoDuckie'; // mapped internally to strAuthor. 
    $weblog->Title = 'A test weblog';  
    $weblog->Story = 'This is a test weblog!'; 
    $weblog->Posted = date("Y-m-d H:i:s"); 
    $weblog->Save(); // Checks for any changed values and inserts or updates into DB. 
    echo ($weblog->ID) // outputs: 1 
```

一个回复：

```
 $reply = new Reply(); 
    $reply->Author = 'Some random guy'; 
    $reply->Reply = 'w000t'; 
    $reply->Posted = date("Y-m-d H:i:s"); 
    $reply->IP = '127.0.0.1'; 
    $reply->Connect($weblog); // auto-saves $reply and connects it to $weblog->ID 
```

并且，获取并显示博客 + 所有回复：

```
 $weblog = new Weblog(1); //Fetches the row with primary key 1 from table weblogs and hooks it's values into $weblog;

    echo("<h1>{$weblog->Title}</h1> 
    <h3>Posted by {$weblog->Author} @ {$weblog->Posted}</h3> 
    <div class='weblogpost'>{$weblog->Story}</div>"); 

    // now fetch the connected posts. this is the real magic: 
    $replies = $weblog->Find("Reply"); // fetches a pre-filled array of Reply objects. 
    if ($replies != false) 
    { 
        foreach($replies as $reply) 
        { 
            echo("<div class='weblogreply'><h4>By {$reply->Author} @ {$reply->Posted}</h4> {$reply->Reply}</div>"); 
        } 
    } 
```

weblog 对象如下所示：

```
class Weblog extends dbObject 
{ 
    function __construct($ID=false) 
    { 
        $this->__setupDatabase('blogs', // database table 
        array('ID_Blog' => 'ID',    // database field => mapped object property 
            'strPost' => 'Story',    // as you can see, database field strPost is mapped to $this->Story 
            'datPosted' => 'Posted', 
            'strPoster' => 'Author', 
            'strTitle'  => 'Title',
            'ipAddress'  => 'IpAddress', 
            'ID_Blog',    // primary table key  
            $ID);    // value of primary key to init with (can be false for new empty object / row) 
        $this->addRelation('Reaction'); // define a 1:many relation to Reaction 

    }
} 
```

看，无需手动编写 SQL :) 链接 + 更多示例：[Pork.dbObject](http://www.schizofreend.nl/Pork.dbObject/)

哦，是的，我还为我的脚手架工具创建了一个基本的 GUI：[Pork.Generator](http://www.schizofreend.nl/Pork.Generator/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-14T12:56:30.860

```
$sql = sprintf("SELECT * FROM users WHERE id = %d", mysql_real_escape_string($_GET["id"])); 
```

Safe from MySQL injection

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-14T19:00:29.517

您可以使用 ORM 或 sql 字符串构建器，但一些复杂的查询需要编写 sql。在编写 sql 时，如 Michał Słaby 所示，使用查询绑定。查询绑定可防止 sql 注入并保持可读性。至于将查询放在哪里：使用模型类。

# project-management - 如何遵守新的联邦桌面核心配置 (FDCC)，它将删除所有用户的本地管理员访问权限？

> ID：442814
> 
> 赞同：8
> 
> 时间：2009-01-14T12:43:02.307
> 
> 标签：project-management, sysadmin, administration

作为开发人员，我们认为没有本地管理权限会严重影响我们的生产力。我们将被限制运行 IIS（我们是一家 Web 开发商店）、安装应用程序、运行 Microsoft 电动工具等。如果您现在正在经历 FDCC 流程，很高兴听到您如何应对这些变化。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-14T13:44:30.700

作为一个使用 AF 标准桌面的基地的合同开发人员，我可以告诉你一些事情。

1：也是最重要的。不要与之抗争，也不要按照第一个人的建议去做“让他们窒息”。这绝对是错误的态度。军方/政府正在与缺乏资金、过度紧张的资源和他们不了解的蓬勃发展的技术足迹作斗争。他们采取的步骤可能并不完美，但他们正受到攻击，我们需要提供帮助，而不是阻碍。

好吧，那是我的胸膛。

2：你需要考虑创建一个本地开发实验室（我知道以这种方式资助很难）。我工作过的每个基地都有一个隔离的网络段，你可以访问它，它具有外部访问权限，与主要的 gov 网络隔离。您基本上拥有用于电子邮件、报告等的工作 PC，位于受保护的网络上。但是，你在你的小实验室里开发。我有一个实验室，有两台电脑藏在我的桌子下面，这些电脑将在技术更新期间归还。换句话说，创造性地使自己成为不受限制的开发机器+服务器。这些机器只是不允许连接到主局域网段。

3：获取桌面配置的分布。您的部分测试需要在这些配置上部署/运行。同样，这些配置不适用于开发盒。它们旨在成为人们用于日常政府工作的机器。

4：如果您正在开发 Web 解决方案，请非常注意添加受信任站点、ActiveX 组件、证书、配置不允许的某些类型的脚本执行的限制。特别是如果您尝试嵌入需要在已部署应用程序域之外进行通信的小部件/portlet/utils。

5：最重要的是，请记住，您为之工作的人中，很少有人了解他们要求您实施的技术。他们知道他们想要功能 X，但他们希望您在实现它的同时遵循严格的安全规则 Y。这通常意味着“获取一些开源库或插件并开始”不是一种选择。但是，这正是您的经理认为您将要做的事情，因为围绕着快速发展的嗡嗡声。

总而言之，那里是一团糟。尝试帮助解决问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-14T13:14:24.367

While I've never been through the FDCC process, I once worked for a U.S. defense contractor who's policy was that no one had local administrative access to their machines. In addition, flash drives and CD-ROMs were disabled (if you wanted to listen to music on CDs, you had to have a personal CD player with headphones).

If you needed software installed you had to put in a work order. Someone would show up at your desk with the install media, login to a local admin account, and let you install the software (the reasoning being that you knew what to install better than they did). Surprisingly, the turnaround was pretty quick, usually around 1/2 an hour.

While an inconvenience, this policy didn't really cripple us. We were doing a combination of Java, C++ (MS Visual C++ and GNU/C++), VB 6.0 and some web development. For what little web development we did, we had a remote dev box we would RDP into for testing. Again, a bit of an inconvenience, but it didn't stop us from getting our jobs done.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-14T12:46:55.310

从来没有遇到过问题，今天我可能会尝试使用虚拟化解决方案来运行这些工具。

或者，正如我的一个朋友曾经认为的那样：“遵循这个过程，直到他们窒息。” 在这种情况下，这可能意味着每次您需要对本地 IIS 配置进行修改或者您需要启动其中一个 powertools 时都需要调用帮助台。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-14T13:26:11.987

这在金融机构中很常见。我个人将其视为一个游戏，看看我可以在我的 PC 上运行多少软件而无需任何管理员权限或向支持组发送请求。

到目前为止，我做得很好，我只发送了一个针对“Rational Software Architect”的软件安装请求（因为我需要来自“官方”版本的插件）。除此之外，我已经启动并运行了 perl、php、python、apache。此外，我的桌面上运行着相当愉快的 jetty server、maven、winscp、putty、vim 和其他几个工具。

因此，它不应该真正打扰您，即使在安装非官方软件方面我是最严重的违规者之一，我也会向任何对保护其应用程序和网络非常感兴趣的商店推荐“无管理员权限”。

一种常见的做法是为开发人员提供一台“官方”锁定的 PC，他们可以在其上运行官方应用程序并进行电子邮件管理等，以及他们拥有管理员权限的基本开发工作站。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-14T13:32:00.180

据我所知，FDCC 只是作为推荐的安全基线。我会对您需要的特权进行一些回击，看看他们能想出什么来满足您的要求。我不会说我需要成为本地管理员，而是列出您需要能够做的事情，并让他们提出一个可行的解决方案（这可能是让您管理您的机器或虚拟机）。您需要能够在 Visual Studio 中运行调试器，运行本地 Web 服务器 (Cassini)，按计划为您的开发工具安装补丁/更新，...

我最近搬到了一个带有 SCCM 的“半托管”环境，该环境会定期从本地更新存储库中安装补丁。我自己在做这件事，但这对企业来说效率略高，而且让安全办公室很高兴。我确实让他们把我和其他开发人员放在一个特殊的集合中，以便我们可以在需要时阻止重大更改（IE7 怎么可能是安全更新？）。除了现在我需要手动更新 Windows Defender 之外，并没有太大的问题，因为我更新它的频率比托管集合中的更新频率更高！显然，它没有你的情况那么极端，但我认为这部分是因为我能够就我的工作需要做的需要更多本地控制的事情提出案例。

来自 NIST 关于保护 WinXP 的常见问题解答。

> 12.  我应该更改基线设置吗？鉴于运营任何大型企业的运营和技术考虑因素存在很大差异，因此需要对基线和相关设置（具有数百个设置、无数应用程序和各种业务）进行一些本地更改是适当的Windows XP 系统支持的功能，这应该是意料之中的）。当然，在更改安全设置时要谨慎并做出良好的判断。始终首先在精心挑选的测试机器上测试设置并记录实施的设置。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-14T13:18:08.057

Not having local administrative access to your workstation is a pain in the rear for sure. I had to deal with that while I was working for my university as a web developer in one of the academic departments. Every time I needed something installed such as Visual Studio or Dreamweaver I had to make a request to Computing Services.

# oop - 面向服务与面向对象——它们可以共存吗？

> ID：442815
> 
> 赞同：43
> 
> 时间：2009-01-14T12:43:35.537
> 
> 标签：oop, soa, service-tier

[最近，我的公司对面向服务的架构](http://en.wikipedia.org/wiki/Service-oriented_architecture)(SOA)产生了浓厚的兴趣。每当我试图看看我们如何使用它时，我总是遇到一个心理障碍。粗略地说：

*   面向对象说：“将数据和操纵数据（业务流程）的方法保持在一起”；

*   面向服务说：“将业务流程保留在服务中，并将数据传递给它”。

以前开发 SOA 的尝试最终将面向对象的代码转换为数据结构和操作它们的单独过程（服务），这似乎是倒退了一步。

我的问题是：**什么模式、架构、策略等允许 SOA 和 OO 一起工作？**

* * *

**编辑：** “面向内部的 OO，面向系统边界的 SOA”的答案非常有用，但这并不是我想要的。

假设您有一个`Account`对象，它有一个名为的业务操作`Merge`，它将它与另一个帐户结合起来。典型的 OO 方法如下所示：

```
Account mainAccount = database.loadAccount(mainId);
Account lesserAccount = database.loadAccount(lesserId);

mainAccount.mergeWith(lesserAccount);

mainAccount.save();
lesserAccount.delete(); 
```

而我见过的 SOA 等价物看起来像这样：

```
Account mainAccount = accountService.loadAccount(mainId);
Account lesserAccount = accountService.loadAccount(lesserId);

accountService.merge(mainAccount, lesserAccount);
// save and delete handled by the service 
```

在 OO 案例中，业务逻辑（以及由于 ActiveRecord 模式的实体意识）被嵌入到`Account`类中。在 SOA 案例中，`Account`对象实际上只是一个结构，因为所有业务规则都隐藏在服务中。

**我可以同时拥有丰富的功能类和可重用的服务吗？**

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-14T13:08:04.427

我的观点是 SOA 在宏观层面上是有用的，但每个服务可能仍然大到需要几个内部组件。内部组件可能会受益于 OO 架构。

SOA API 应该比内部 API 更仔细地定义，因为它是一个外部 API。在这一层传递的数据类型应该尽可能简单，没有内部逻辑。如果有一些属于数据类型的逻辑（例如验证），最好应该有一个服务负责在数据类型上运行逻辑。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-14T13:14:23.600

SOA 是用于在系统或应用程序之间进行通信的良好架构。

每个应用程序都定义了一个“服务”接口，该接口由它将处理的请求和预期的响应组成。

这里的关键点是定义良好的服务，具有良好定义的界面。就 SOA 而言，您的服务如何实际实现是无关紧要的。

因此，您可以使用所有最新最好的 OO 技术或任何其他适合您的方法自由地实施您的服务。（我见过一些极端情况，即“服务”是由实际的人在屏幕上输入数据来实现的——但一切仍然是 SOA 教科书！）。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-14T12:55:07.617

我真的认为 SOA 只对外部接口有用（一般来说，对您公司外部的接口），即使那样，只有在性能并不重要的情况下，您才不需要有序传递消息。

鉴于此，我认为它们可以共存。使用 OO 理念保持您的应用程序工作和通信，并且仅当需要外部接口（对第三方）时，才通过 SOA 公开它们（这不是必需的，但它是一种方式）。

我真的觉得 SOA 被过度使用了，或者至少 SOA 架构被提出得太频繁了。我真的不知道有任何内部使用 SOA 的大型系统，我怀疑他们可以。它看起来更像是你可能只是用来做混搭或简单的天气预报类型请求的东西，而不是在上面构建严肃的系统。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-14T13:32:44.407

我认为这是对面向对象的误解。即使在 Java 中，方法通常也不是*对象*的一部分，而是它们的*类*的一部分（甚至这种“成员资格”对于面向对象来说也不是必需的，但这是一个不同的主题）。一个类只是一个类型的描述，所以这实际上是程序的一部分，而不是数据。

SOA 和 OO 并不矛盾。服务可以接受数据，在内部将它们组织成对象，对它们进行处理，最后以所需的任何格式返回它们。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-14T13:35:26.913

我听说 James Gosling 说可以在 COBOL 中实现 SOA。

如果您阅读 Alan Kay 自己对 OOP 起源的描述，它描述了一堆小型计算机进行交互以执行一些有用的事情。

考虑这个描述：

> 你的 X 应该由 Ys 组成。每个 Y 应该负责一个单一的概念，并且应该根据其接口完全可描述。一个 Y 可以通过消息交换（根据他们指定的接口）要求另一个 Y 做某事。
> 
> 在某些情况下，一个 X 可能由一个 Z 实现，它根据其接口进行管理。不允许 X 直接访问另一个 X 的 Z。

我认为以下替换是可能的：

```
Term      Programing       Architecture
----    ---------------    ------------
  X         Program           System
  Y         Objects          Services
  Z      Data structure      Database
----    ---------------    ------------
result        OOP              SOA 
```

如果您主要从封装、信息隐藏、松散耦合和黑盒接口方面考虑，则有相当多的相似之处。如果您陷入多态性、继承等问题，那么您正在考虑编程/实现而不是架构，恕我直言。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-14T14:01:10.557

如果您允许您的服务记住状态，那么它们可以被认为是调用时间可能很慢的大对象。

如果不允许它们保留状态，那么它们就像您所说的那样-数据运算符。

听起来您可能将系统划分为太多服务。你有书面的、共同商定的划分标准吗？

采用 SOA 并不**意味着**丢弃*所有对象*，而是将系统划分为可重用的大块。

# c# - 时间：2019-05-10 标签：c#flickering Listview on update

> ID：442817
> 
> 赞同：55
> 
> 时间：2009-01-14T12:44:05.767
> 
> 标签：c#, listview, flicker

我有一个定期更新的列表视图（每 60 秒）。每次更新时我都会闪烁，这让我很恼火。使用的方法是清除所有项目，然后重新创建它们。我决定不清除项目，而是直接将新文本写入单元格。这是更好的方法还是有人有更好的解决方案。

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2009-01-14T12:47:52.920

ListView 控件存在闪烁问题。问题似乎是控件的更新重载未正确实现，因此它的行为类似于刷新。更新应使控件仅重绘其无效区域，而刷新则重绘控件的整个客户区。因此，如果您要更改列表中一项的背景颜色，那么只需重新绘制该特定项。不幸的是，ListView 控件似乎有不同的看法，并且每当您弄乱单个项目时都希望重新绘制其整个表面……即使该项目当前未显示。因此，无论如何，您可以通过滚动自己的方式轻松抑制闪烁，如下所示：

```
class ListViewNF : System.Windows.Forms.ListView
{
    public ListViewNF()
    {
        //Activate double buffering
        this.SetStyle(ControlStyles.OptimizedDoubleBuffer | ControlStyles.AllPaintingInWmPaint, true);

        //Enable the OnNotifyMessage event so we get a chance to filter out 
        // Windows messages before they get to the form's WndProc
        this.SetStyle(ControlStyles.EnableNotifyMessage, true);
    }

    protected override void OnNotifyMessage(Message m)
    {
        //Filter out the WM_ERASEBKGND message
        if(m.Msg != 0x14)
        {
            base.OnNotifyMessage(m);
        }
    }
} 
```

来自：[Geekswithblogs.net](http://geekswithblogs.net/CPound/archive/2006/02/27/70834.aspx)

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-01-14T12:54:34.360

除了其他回复之外，许多控件都有一种`[Begin|End]Update()`方法可以用来减少编辑内容时的闪烁 - 例如：

```
 listView.BeginUpdate();
    try {
        // listView.Items... (lots of editing)
    } finally {
        listView.EndUpdate();
    } 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2017-02-22T11:10:28.843

这是我对不需要子类化列表视图等的 C# 实现的快速修复。

在表单构造函数中使用反射将 DoubleBuffered 属性设置为 true。

```
 lvMessages
        .GetType()
        .GetProperty("DoubleBuffered", System.Reflection.BindingFlags.Instance | System.Reflection.BindingFlags.NonPublic)
        .SetValue(lvMessages, true, null); 
```

2021 年更新：我在这篇旧帖子上收到了一条评论，我现在会以不同的方式编写这段代码。下面是一个扩展方法，它将向 ListView 添加一个新方法，以便能够根据需要将双缓冲属性设置为 true/false。然后，这将扩展所有列表视图并使其更容易按要求调用。

```
/// <summary>
/// Extension methods for List Views
/// </summary>
public static class ListViewExtensions
{
    /// <summary>
    /// Sets the double buffered property of a list view to the specified value
    /// </summary>
    /// <param name="listView">The List view</param>
    /// <param name="doubleBuffered">Double Buffered or not</param>
    public static void SetDoubleBuffered(this System.Windows.Forms.ListView listView, bool doubleBuffered = true)
    {
        listView
            .GetType()
            .GetProperty("DoubleBuffered", System.Reflection.BindingFlags.Instance | System.Reflection.BindingFlags.NonPublic)
            .SetValue(listView, doubleBuffered, null);
    }
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-12-17T12:20:16.510

如果这有帮助，以下组件解决了我的 .NET 3.5 的 ListView 闪烁问题

```
[ToolboxItem(true)]
[ToolboxBitmap(typeof(ListView))]
public class ListViewDoubleBuffered : ListView
{
    public ListViewDoubleBuffered()
    {
        this.DoubleBuffered = true;
    }
} 
```

我将它与我进行 ListView.Items 操作的 .BeginUpdate() 和 .EndUpdate() 方法结合使用。

我不明白为什么这个属性是受保护的......即使在 .NET 4.5 中（可能是安全问题）

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-14T12:48:56.303

是的，让它双缓冲。它将减少闪烁；) [http://msdn.microsoft.com/en-us/library/system.windows.forms.listview.doublebuffered.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.listview.doublebuffered.aspx)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-07-15T14:14:11.880

很好的问题，Stormenent 的回答很到位。这是他的代码的 C++ 端口，供其他可能正在处理 C++/CLI 实现的人使用。

```
#pragma once

#include "Windows.h" // For WM_ERASEBKGND

using namespace System;
using namespace System::Windows::Forms;
using namespace System::Data;
using namespace System::Drawing;

public ref class FlickerFreeListView : public ListView
{
public:
    FlickerFreeListView()
    {
        //Activate double buffering
        SetStyle(ControlStyles::OptimizedDoubleBuffer | ControlStyles::AllPaintingInWmPaint, true);

        //Enable the OnNotifyMessage event so we get a chance to filter out 
        // Windows messages before they get to the form's WndProc
        SetStyle(ControlStyles::EnableNotifyMessage, true);
    }

protected:
    virtual  void OnNotifyMessage(Message m) override
    {
        //Filter out the WM_ERASEBKGND message
        if(m.Msg != WM_ERASEBKGND)
        {
            ListView::OnNotifyMessage(m);
        }
    }

}; 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2018-04-27T13:26:47.857

您可以使用以下扩展类将`DoubleBuffered`属性设置为`true`：

```
using System.Reflection;

public static class ListViewExtensions
{
    public static void SetDoubleBuffered(this ListView listView, bool value)
    {
        listView.GetType()
            .GetProperty("DoubleBuffered", BindingFlags.Instance | BindingFlags.NonPublic)
            .SetValue(listView, value);
    }
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-05-08T18:22:20.717

最简单的解决方案可能是使用

```
 listView.Items.AddRange(listViewItems.ToArray()); 
```

代替

```
 foreach (ListViewItem listViewItem in listViewItems)
       {
           listView.Items.Add(listViewItem);
       } 
```

这效果更好。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-08-20T10:06:17.777

**简单的解决方案**

```
yourlistview.BeginUpdate()

//Do your update of adding and removing item from the list

yourlistview.EndUpdate() 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-10-27T19:42:44.103

我知道这是一个*非常*古老的问题和答案。但是，这是搜索“C++/cli listview flicker”时的最高结果——尽管这甚至不是在谈论 C++。所以这里是这个的 C++ 版本：

我把它放在我的主表单的头文件中，你可以选择把它放在其他地方......

```
static void DoubleBuffer(Control^ control, bool enable) {
    System::Reflection::PropertyInfo^ info = control->GetType()->
        GetProperty("DoubleBuffered", System::Reflection::BindingFlags::Instance 
            | System::Reflection::BindingFlags::NonPublic);
    info->SetValue(control, enable, nullptr);
} 
```

如果您碰巧在这里为托管 C++ 寻找类似的答案，那对我有用。:)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-07-31T15:44:44.297

这对我来说效果最好。
由于您正在直接编辑单元格，因此在您的情况下，最好的解决方案是简单地刷新/重新加载该特定单元格/行而不是整个表格。
您可以使用`RedrawItems(...)`基本上只重绘列表视图的指定范围的项目/行的方法。

```
public void RedrawItems(int startIndex, int endIndex, bool invalidateOnly); 
```

[参考](https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.listview.redrawitems?view=netframework-4.8)

这完全摆脱了我的*完整列表视图闪烁*。
更新时只有相关的项目/记录闪烁。

干杯!

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-14T12:53:30.243

尝试将双缓冲属性设置为 true。

你也可以使用：

```
this.SuspendLayout();

//update control

this.ResumeLayout(False);

this.PerformLayout(); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-11-28T05:41:38.303

在 Winrt Windows phone 8.1 中，您可以设置以下代码来解决此问题。

```
<ListView.ItemContainerTransitions>
    <TransitionCollection/>      
</ListView.ItemContainerTransitions> 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-04-28T17:56:36.567

对于它的价值，就我而言，我只需要添加一个调用

> Application.EnableVisualStyles()

在运行应用程序之前，像这样：

```
 private static void Main()
    {
        Application.EnableVisualStyles();
        Application.Run(new Form1());
    } 
```

否则，双缓冲是不够的。也许这是一个非常古老的项目，而新项目默认具有该设置...

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-12-17T22:19:22.537

如果有人仍然会为此寻找答案，我使用了一个计时器稍微延迟，它很好地解决了这个问题。我想在鼠标移动事件上突出显示（更改颜色）整行，但我认为它适用于项目替换等。对我来说 listView.BeginUpdate() 和 listView.EndUpdate() 不起作用，DoubleBuffered 属性也没有不工作，我用谷歌搜索了很多，但没有任何工作。

```
private int currentViewItemIndex;
private int lastViewItemIndex;

    private void listView_MouseMove(object sender, MouseEventArgs e)
    {            
        ListViewItem lvi = listView.GetItemAt(e.X, e.Y);

        if (lvi != null && lastViewItemIndex == -1)
        {
            listView.Items[lvi.Index].BackColor = Color.Green;
            lastViewItemIndex = lvi.Index;
        }

        if (lvi != null && lastViewItemIndex != -1)
        {
            currentViewItemIndex = lvi.Index;
            listViewTimer.Start(); 
        } 
    }

    private void listViewTimer_Tick(object sender, EventArgs e)
    {
        listView.BeginUpdate();
        listView.Items[lastViewItemIndex].BackColor = Colour.Transparent;
        listView.Items[currentViewItemIndex].BackColor = Colour.Green;
        listView.EndUpdate();
        lastViewItemIndex = currentViewItemIndex;
        listViewTimer.Stop();
    } 
```

# linux - 强制驱动程序与设备匹配

> ID：442833
> 
> 赞同：27
> 
> 时间：2009-01-14T12:50:30.560
> 
> 标签：linux, usb, kernel

我有一块 USB 硬件，我知道它的驱动程序。但是，vendor id 和 product id 与驱动程序中注册的 VID、PID 对不匹配。linux中有没有办法强制驱动程序与已知设备相关联，不涉及内核模块重新编译以添加PID / VID对？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-14T13:07:08.530

在 sysfs 树中找到该模块。在这种情况下，它在

> `/sys/bus/usb-serial/drivers/cp2101`

在此目录中，有一个`new_id`文件条目可用于动态添加 VID PID 对，如下所示：

> `echo VID PID >new_id`

这是有关此功能的[LWN 条目](http://lwn.net/Articles/160944/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2018-10-23T07:46:42.483

如果您想永久更改此更改并将特定驱动程序分配给设备（VID、PID），您可能会发现[此](https://unix.stackexchange.com/a/165845/156466)答案很有用。

例如创建`/etc/udev/rules.d/98-joystick.rules`包含内容的新文件：

> ACTION=="add", ATTRS{idVendor}=="1345", ATTRS{idProduct}=="6005", RUN+="/sbin/modprobe xpad" RUN+="/bin/sh -c 'echo 1345 6005 > /sys/bus/usb/drivers/xpad/new_id'"

替换`1345`为您的 VID 和`6005`您的 PID。

更换`xpad`合适的驱动程序。

运行以下命令：

> $ sudo udevadm control --reload

拔下并重新插入设备并检查是否加载了新驱动程序。

此处显示的示例用于修复驱动程序问题`Speedlink Strike FX Gamepad (SL-6537-BK)`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-14T13:48:26.997

您实际上不需要重新编译整个内核，仅使用更新的匹配表重新编译相关的内核模块就足够了，以防[这个](https://stackoverflow.com/questions/442833/forcing-driver-to-device-match#442867)答案不适用于您的内核。

# search - 使用 Boost 的图 breadth_first_search() 在未加权的无向图中查找路径

> ID：442834
> 
> 赞同：1
> 
> 时间：2009-01-14T12:51:39.700
> 
> 标签：search, boost, shortest-path, boost-graph

我正在使用带有无向和未加权边的 adjacency_list 图。我需要找到顶点 u 和顶点 v 之间的最短路径。我应该从 u 开始使用 breadth_first_search() 吗？到达v时，如何获取路径，如何停止搜索？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-06-24T10:20:07.153

是的，从你开始做breadth_first_search()。

```
FOR every vertex i meet
  IF i==v: BREAK
  record predecessor of i as i.p 
```

要找到最短路径，请从 v 开始：

```
PRINT_PATH(u, v)
  IF v==u
    print u
  ELSEIF v.p==NIL
    print 'no path from u to v exists'
  ELSE PRINT_PATH(u, v.p)
    print v 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-25T14:46:44.597

您应该使用最短路径算法之一，[Dijkstra Shortest Path](http://www.boost.org/doc/libs/1_38_0/libs/graph/doc/dijkstra_shortest_paths.html)是最合适的，因为您只需要找到两个顶点之间的路径。在 boost 发行版中有一个使用[示例](http://www.boost.org/doc/libs/1_38_0/libs/graph/example/dijkstra-example.cpp)。从该函数获取输出有多种选择：通过提供距离属性图或构建前驱图或编写自定义访问者。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-01-14T13:03:17.010

您需要使用[最小生成树](http://en.wikipedia.org/wiki/Minimum_spanning_tree)：搜索算法。这是一个非常简单直接的贪心算法。

# language-agnostic - When asked "How do I make a website?" how do you answer?

> ID：442848
> 
> 赞同：14
> 
> 时间：2009-01-14T12:57:58.253
> 
> 标签：language-agnostic

A (non-technical) friend of mine has asked me how to make a website. I get this question all the time. After a few questions I found out that she has an idea that could turn into a commercial site. I described three options to her:

a) Get a book/enroll in a class/follow some online tutorials and learn how to do it. She's pretty smart and her personality seems like a good match for this sort of thing so I'm sure she could learn but she doesn't have a lot of time spare. Maybe if she started with one of those WYSIWYG editors at first? I stressed that this would take a longer than a couple of weekends of playing around.

b) Hire someone to build it. Ranges from ultra cheap to ultra expensive, crappy to good and everything in between. I didn't mention sites like Rentacoder because she hasn't worked on a project like this before and doesn't know what to ask for. At this stage she'd likely ask for a Youtube-MySpace-Google for a few hundred bucks because she doesn't yet understand just how much is involved.

c) Find someone technical and partner up with them. I explained that this can either work really well or be a disaster because she'd have to give up some of her ownership of the idea.

How do you respond in these situations?

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-14T13:01:18.417

Depending on the nature of the required website (ie whether she needs shopping carts etc) I often recommend first creating a blog, although it's often not the best format, it can be used to quite good effect at times. I've seen a number of small retailers for example, using a blog to advertise their wares.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-14T13:01:27.340

It depends on the person and their motivation. Your friend sounds like she should take option b) or c). She's probably not so much interested in the technical aspects of making a web site as she is in seeing her idea come to life, or maybe running her own company based on the idea.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-14T13:04:11.843

Well in general there are several steps:

1.  Determine the subject of the website.
2.  Determine the target audience.
3.  Decide on a general layout and look and feel.
4.  Decide which techniques to use.
5.  Design the overall structure of the site.
6.  Collect content and images.
7.  Implement the site.

Most of the times, these steps are carried out by more than a single person. Because they all require their own specialization.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-14T13:33:39.817

我认为唯一现实的选择是 B 和 C。非技术人员几乎永远不会掌握真正的网站开发。恕我直言，那些提倡 ASP.NET 或 PHP 之类的技术的人 - 它是行不通的。事实上，您可能会连续数周提出问题，以解决为什么事情不起作用。你必须忍受这些问题，直到那个人失败了，放弃了。

如果他们有资源，那么我强烈推荐“聘请专家”路线。在任何一种现实情况下，他们都必须达成法律协议。如果她确实聘请了专家，请**确保**协议明确规定这是*“受雇工作”。*如果您的朋友不要求雇佣工作条款，那么她将没有法律手段来阻止开发人员使用她刚刚支付的完全相同的代码来创建竞争网站（至少在美国）。只是要强调一下：*如果没有雇用工作条款，他们将没有法律手段阻止开发商开设自己的竞争网站 - 法院甚至不会审理诉讼。*

* * *

现在，如果它真的只是一个小册子网站或类似的东西，他们仍然需要你的建议，那么这取决于他们使用的是 Mac 还是其他东西。

如果他们是 Mac 用户，我会告诉他们尝试启动 iWeb 并使用它来提供 .me 帐户。只需插入一些图片和一些文字，上传到您的 .me 帐户即可。

如果他们是 Windows 用户，我会将他们引导至 Register.com 或类似的基于模板的在线网站构建器。

看在你的份上，除非你真的确定你有时间为他们建造整个东西，否则不要自愿提供帮助！你可以这样破坏友谊：朋友和家人，不知道网站建设的真正内容，几乎总是认为它对你来说是“微不足道的”。如果您延迟或未能足够快地完成工作，他们几乎总是会认为您在吹嘘他们，他们会因此而怨恨您（您能告诉我我去过那里吗？）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-14T13:05:14.603

It depends on how confident she is that this thing will succeed or, alternatively, how unwilling she is to share ownership. I'd definitely not recommend (a) for something that has commercial value. Beyond the time-to-market factor, initial impressions are something that is very hard to overcome. If she has the cash and is possessive of ownership, then (b) could work well. It's a bigger financial risk, though.

I'd probably go with (c), but then again I'm on the other side of the equation. There are lots of ways of structuring a partnership that would help her maintain ownership, though probably not complete ownership since no one wants to work for nothing. Some combination of b/c is probably best - some less pay in exchange for a small stake in the business. I'd definitely see a lawyer before doing (c) and maybe even before doing (b) just to make sure any agreement she has with the developer precludes them taking the code and running.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-14T13:22:33.087

这里真的有两个问题：她*是否应该*学习如何编写网站，如果是，*如何*学习。

如果她有商业想法，只想学习如何编写网站进行营销，我建议她不要打扰。而是外包。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-14T14:09:25.143

有点话题，但它就在这里......

我们公司有一个网页设计师（我们大约有10个程序员），我们通常会开玩笑说：“你不工作，你整天坐在那里画画”（只是为了记录，她非常能干，她的工作做得很好）。

所以有一次她盯着我的显示器看了大约 2 分钟，而我正在开发一个 Web 应用程序，在某个时候她说：“这就是你的工作？公式和其他东西？”。

从那天起，当被问及我们在工作中做什么时，我们都会说“我做公式和东西”，对于大多数人来说，这样说和说你开发 Web 应用程序是完全一样的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-18T01:36:16.297

我总是给出相同的答案，HTML。我说它是做什么的，然后告诉他们去拿一本书。如果他们*明白*了，他们将遵循自己的行动方针。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-18T01:50:08.763

除非您是网页设计师，否则“我如何制作网站”与“我如何制作电视”是一个类似的问题。没有，你买一个。所以这个问题可能是“我如何采购网站？”。

这分解为：

1.  找出你想要的：

    *   你想要什么用户功能
    *   您希望 UI 看起来像什么？
    *   您需要哪些管理功能？
    *   您是否已经有图形设计/徽标/配色方案等？
2.  找人为你做

    *   你是怎么找到他们的？推荐人？本地网络开发公司？朋友们？
    *   你在乎他们使用哪种技术吗？
    *   你打算项目管理吗？
    *   你怎么知道他们做得很好？
    *   您是否清楚扩展、支持、维护等问题？

理想情况下，找一家愿意帮助您解决所有问题的公司。不太理想但也很好，找一个顾问或公司来帮助你做顶级的东西，并协助你制作技术规格，然后你可以把这些规格带到开发公司来生产。

（编辑格式化）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-14T13:01:35.623

Buy her a book for her birthday on ASP.NET or PHP.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-14T13:01:52.083

If you have someone who to trust then only 3rd option is realistic. first one takes years to give out good result and with second one you never know what you get.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-14T14:47:14.520

开发一个网站并不像 GeoCities 或 Google Pages 这样的地方看起来那么简单。

[以下是您在发布网站时需要了解或考虑的事项列表。](https://stackoverflow.com/questions/72394/what-should-a-developer-know-before-building-a-public-web-site)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-14T15:34:33.803

如果她拥有一台 Mac 或不介意购买一台，我建议她看看 iWeb。否则，对于非技术人员来说，在博客等平台上创建博客将是一个不错的第一步。

# java - 如何保护 MySQL 用户名和密码不被反编译？

> ID：442862
> 
> 赞同：88
> 
> 时间：2009-01-14T13:04:39.907
> 
> 标签：java, mysql, security, reverse-engineering, decompiling

Java`.class`文件可以很容易地被反编译。如果我必须在代码中使用登录数据，如何保护我的数据库？

* * *

## 回答 #1

> 赞同：125
> 
> 时间：2009-01-14T13:08:42.410

切勿将密码硬编码到您的代码中。最近在[25 个最危险的编程错误](http://blog.codinghorror.com/top-25-most-dangerous-programming-mistakes/)中提到了这一点：

> 将秘密帐户和密码硬编码到您的软件中非常方便——对于熟练的逆向工程师而言。如果所有软件的密码都相同，那么当密码不可避免地为人所知时，每个客户都会变得容易受到攻击。而且因为它是硬编码的，所以修复起来非常痛苦。

您应该将配置信息（包括密码）存储在应用程序启动时读取的单独文件中。这是防止密码因反编译而泄漏的唯一真正方法（从一开始就不要将其编译成二进制文件）。

有关此常见错误的更多信息，您可以阅读[CWE-259 文章](http://cwe.mitre.org/data/definitions/259.html)。本文包含更全面的定义、示例以及有关该问题的许多其他信息。

在 Java 中，最简单的方法之一是使用 Preferences 类。它旨在存储各种程序设置，其中一些可能包括用户名和密码。

```
import java.util.prefs.Preferences;

public class DemoApplication {
  Preferences preferences = 
      Preferences.userNodeForPackage(DemoApplication.class);

  public void setCredentials(String username, String password) {
    preferences.put("db_username", username);
    preferences.put("db_password", password);
  }

  public String getUsername() {
    return preferences.get("db_username", null);
  }

  public String getPassword() {
    return preferences.get("db_password", null);
  }

  // your code here
} 
```

在上面的代码中，您可以`setCredentials`在显示询问用户名和密码的对话框后调用该方法。当您需要连接到数据库时，您只需使用`getUsername`和`getPassword`方法来检索存储的值。登录凭据不会被硬编码到您的二进制文件中，因此反编译不会造成安全风险。

**重要提示：**首选项文件只是纯文本 XML 文件。确保采取适当的步骤来防止未经授权的用户查看原始文件（UNIX 权限、Windows 权限等）。至少在 Linux 中，这不是问题，因为调用`Preferences.userNodeForPackage`将在当前用户的主目录中创建 XML 文件，无论如何其他用户都无法读取该文件。在 Windows 中，情况可能会有所不同。

**更重要的说明：**在这个答案和其他人的评论中有很多关于这种情况下正确架构的讨论。最初的问题并没有真正提到应用程序正在使用的上下文，所以我将谈谈我能想到的两种情况。第一种情况是使用该程序的人已经知道（并且被授权知道）数据库凭据。第二种情况是开发人员试图对使用该程序的人保密数据库凭据。

**第一种情况：用户被授权知道数据库登录凭据**

在这种情况下，我上面提到的解决方案将起作用。Java`Preference`类将以纯文本形式存储用户名和密码，但首选项文件只能由授权用户读取。用户可以简单地打开首选项 XML 文件并读取登录凭据，但这不是安全风险，因为用户知道开始时的凭据。

**第二种情况：试图向用户隐藏登录凭据**

这是更复杂的情况：用户不应该知道登录凭据，但仍需要访问数据库。在这种情况下，运行应用程序的用户可以直接访问数据库，这意味着程序需要提前知道登录凭据。我上面提到的解决方案不适用于这种情况。您可以将数据库登录凭据存储在首选项文件中，但他的用户将能够读取该文件，因为他们将是所有者。事实上，确实没有什么好的方法可以安全地使用这种情况。

**正确案例：使用多层架构**

正确的做法是在数据库服务器和客户端应用程序之间有一个中间层，它对单个用户进行身份验证并允许执行一组有限的操作。每个用户都有自己的登录凭据，但数据库服务器没有。凭据将允许访问中间层（业务逻辑层），并且对于每个用户来说都是不同的。

每个用户都有自己的用户名和密码，这些用户名和密码可以本地存储在首选项文件中，没有任何安全风险。这称为[三层架构](http://en.wikipedia.org/wiki/Three-tier_(computing))（这些层是您的数据库服务器、业务逻辑服务器和客户端应用程序）。它更复杂，但它确实是做这类事情的最安全的方法。

操作的基本顺序是：

1.  客户端使用用户的个人用户名/密码向业务逻辑层进行身份验证。用户名和密码是用户已知的，并且与数据库登录凭据没有任何关系。
2.  如果身份验证成功，客户端会向业务逻辑层发出请求，从数据库中获取一些信息。例如，产品库存。注意客户端的请求不是SQL查询；它是一个远程过程调用，例如`getInventoryList`.
3.  业务逻辑层连接到数据库并检索请求的信息。业务逻辑层负责根据用户的请求形成安全的 SQL 查询。应该对 SQL 查询的任何参数进行清理，以防止 SQL 注入攻击。
4.  业务逻辑层将清单列表发送回客户端应用程序。
5.  客户端向用户显示库存列表。

请注意，在整个过程中，**客户端应用程序从不直接连接到数据库**。业务逻辑层接收来自经过身份验证的用户的请求，处理客户端对库存列表的请求，然后才执行 SQL 查询。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-14T13:07:38.013

将密码放入应用程序将读取的文件中。切勿在源文件中嵌入密码。时期。

Ruby 有一个鲜为人知的模块[DBI::DBRC](https://rubygems.org/gems/dbi-dbrc)用于这种用途。我毫不怀疑Java有一个等价物。反正写一个也不难。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-14T13:28:15.447

您正在编写 Web 应用程序吗？如果是这样，请使用 JNDI 在应用程序外部对其进行配置。[此处](http://java.sun.com/j2se/1.4.2/docs/guide/jdbc/getstart/datasource.html)提供概述：

> JNDI 为应用程序提供了一种通过网络查找和访问远程服务的统一方式。远程服务可以是任何企业服务，包括消息传递服务或特定于应用程序的服务，但当然，JDBC 应用程序主要对数据库服务感兴趣。一旦创建了 DataSource 对象并将其注册到 JNDI 命名服务，应用程序就可以使用 JNDI API 访问该 DataSource 对象，然后可以使用该对象连接到它所代表的数据源。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-10-19T11:48:02.710

无论您做什么，敏感信息都将存储在某个文件中的某个地方。你的目标是让它尽可能难以获得。您可以实现多少取决于您的项目、需求和公司钱包的厚度。

最好的方法是不要在任何地方存储任何密码。这是通过使用散列函数来生成和存储密码散列来实现的：

```
hash("hello") = 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824
hash("hbllo") = 58756879c05c68dfac9866712fad6a93f8146f337a69afe7dd238f3364946366 
```

> 哈希算法是单向函数。它们将任意数量的数据转换为无法反转的固定长度“指纹”。它们还具有这样的特性，即如果输入发生一点点变化，生成的哈希值就会完全不同（参见上面的示例）。这对于保护密码非常有用，因为我们希望以一种即使密码文件本身被泄露也能保护密码的形式存储密码，但同时，我们需要能够验证用户的密码是否正确。

***无关说明：****在互联网的旧时代，当您单击“忘记密码”链接时，网站会通过电子邮件将您的纯文本密码发送给您。他们可能将这些存储在某个数据库中。当黑客获得对其数据库的访问权限时，他们将获得对所有密码的访问权限。由于许多用户会在多个网站上使用相同的密码，这是一个巨大的安全问题。幸运的是，现在这不是常见的做法。*

现在问题来了：存储密码的最佳方式是什么？我认为[这个（身份验证和用户管理服务stormpath的）](https://stormpath.com/blog/password-security-right-way)解决方案非常理想：

1.  您的用户输入凭据，并根据密码哈希进行验证
2.  生成和存储密码哈希，而不是密码
3.  哈希执行多次
4.  使用随机生成的盐生成哈希
5.  哈希使用私钥加密
6.  私钥存储在与哈希不同的物理位置
7.  私钥按时间更新
8.  加密的哈希被分成块
9.  这些块存储在物理上独立的位置

显然你不是谷歌或银行，所以这对你来说是一个矫枉过正的解决方案。但随之而来的问题是：您的项目需要多少安全性，您有多少时间和金钱？

对于许多应用程序，尽管不推荐，但在代码中存储硬编码密码可能是一个足够好的解决方案。但是，通过从上面的列表中轻松添加几个额外的安全步骤，您可以使您的应用程序更加安全。

例如，假设第 1 步不是您项目可接受的解决方案。您不希望用户每次都输入密码，或者您甚至不希望/不需要用户知道密码。您仍然在某处拥有敏感信息，并且您想保护它。你有一个简单的应用程序，没有服务器来存储你的文件，或者这对你的项目来说太麻烦了。您的应用程序在无法安全存储文件的环境中运行。这是最坏的情况之一，但仍然有一些额外的安全措施，您可以获得更安全的解决方案。例如，您可以将敏感信息存储在文件中，并且可以对文件进行加密。您可以在代码中硬编码加密私钥。你可以混淆代码，这样你就很难有人破解它。[这个链接](http://java-source.net/open-source/obfuscators)。（我想再次警告您，这不是 100% 安全的。具有正确知识和工具的聪明黑客可以破解此问题。但根据您的要求和需要，这可能对您来说是一个足够好的解决方案）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-10-08T07:31:28.540

这个问题显示了如何在加密文件中存储密码和其他数据：[Java 256-bit AES Password-Based Encryption](https://stackoverflow.com/questions/992019/java-256-bit-aes-password-based-encryption)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-14T13:29:32.120

MD5是散列算法，不是加密算法，总之你不能取回你的散列，你只能比较。理想情况下，它应该在存储用户身份验证信息而不是数据库用户名和密码时使用。db username 和 pwd 应该被加密并保存在一个配置文件中，至少这样做。

# c# - WCF REST 服务可以支持具有任意元素顺序的 XML 消息的反序列化吗？

> ID：442869
> 
> 赞同：5
> 
> 时间：2009-01-14T13:07:55.767
> 
> 标签：c#, wcf, rest

我有一个 C# WCF REST 服务，它允许添加书签，方法是发送一个带有 XML 序列化书签的 HTTP POST 请求。我已经为服务指定了操作契约，它会提取 xml 并自动为我反序列化对象。我的问题是反序列化只有在请求中的 XML 元素按字母顺序给出时才能正常工作，并且不填充任何乱序元素的值。

[这种行为已在其他地方报告过](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/8ad43a3f-affd-45e9-91fb-fe8a8d9c66f7/)。

我觉得这很不令人满意；我认为以特定顺序构造 XML 的要求是不必要的，而且是一个令人头疼的问题。这是添加到服务的所有客户端的主要要求，也是调试潜在困难问题的来源。

***是否可以将 WCF 指示为与 XML 元素顺序无关？***

* * *

**用于澄清目的的一些进一步细节：**

我的运营合同是这样的：

```
[OperationContract]
[WebInvoke(Method="POST", UriTemplate = "/{username}/bookmarks", ResponseFormat = WebMessageFormat.Xml)]
public void PostBookmark(string username, RestBookmark newBookmark); 
```

RestMessage 如下所示：

```
[DataContract(Name = "Bookmark", Namespace = "")]
public class RestBookmark
{   
    [DataMember]
    public string BookmarkMd5 { get; set; }

    [DataMember]
    public string Url { get; set; }

    [DataMember]
    public string UserName { get; set; }

    [DataMember]
    public string Title { get; set; }

    [DataMember]
    public string Description { get; set; }
} 
```

如果我发送以下 XML 消息，则在调用 PostBookmark() 时只会填充 RestMessage 对象的 UserName 属性：

```
<?xml version="1.0"?><Bookmark><UserName>nick.street</UserName><Url>http://www.stackoverflow.com</Url><BookmarkMd5>f184eb3347cf94f6ce5f5fc2844e3bdd</BookmarkMd5><Description>Developer Forum</Description><Title>Stack Overflow</Title></Bookmark> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T01:14:21.027

The DataContractSerializer requires strict ordering of elements for both versioning and performance reasons.

There are some options I can think of,

1.  write a message inspector to re-order the raw XML elements in AfterReceivedRequest before it's deserialized by dataContractSerializer.

2.  using the XmlSerializer for your services.

3.  develop HTTP raw XML message process service instead.

4.  pass the object as a dictionary (not recommended)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T18:25:35.360

我自己没有尝试过这样做，但我会猜测一下。

Would it help to create a [OnDeserializing] event on your DataContract that would fire just before deserialization? At that point maybe you could reorder the xml however it needs to be ordered so that deserialization would work properly.

If you have Juval Lowy's Programming WCF Services 2nd Edition, that's covered starting on page 107.

[Here's the MSDN help page](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.ondeserializingattribute.aspx).

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T01:17:54.000

If you are not going to specify `Order` in your `DataMember` attribute to reflect the order of the nodes then you must alphabetize the nodes in your xml.

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-14T13:33:00.647

尝试在 DataMember 属性中将 Order 设置为 0（对于所有成员）：

[DataMember(Name = "Title", Order = 0)]

# apache-flex - How can I change the size of icons in the Tree control in Flex?

> ID：442878
> 
> 赞同：0
> 
> 时间：2009-01-14T13:12:27.693
> 
> 标签：apache-flex, tree, icons

I embed SVG graphics in my Flex application using

```
package MyUI
{
    public class Assets
    {
        [Embed(source="/assets/pic.svg"]
        [Bindable]
        public static var svgPic:Class;
    }
} 
```

and then extending the Tree class with some of my own code, setting the icon upon adding a node to the data provider:

```
public class MyTree extends Tree
{
    public function MyTree()
    {
        // ...
        this.iconField = "svgIcon";
        // ...
        this.dataProvider = new ArrayCollection;
        this.dataProvider.addItem({ /* ... */ svgIcon: MyUI.Assets.svgPic /* ... */ });
        // ...
    }
} 
```

Now I have two things I want to do:

*   use the SVG graphics in multiple places in the app, scaling them to the appropriate size for each appearance, i. e. scale them to a proper icon size when using them in the tree
*   change the size of the icon at runtime, e. g. display a slightly larger icon for selected items or let an icon "pulse" as a response to some event

I read the Flex documentation on the 9-slice scaling properties in the Embed tag, but I think that's not what I want.

* * *

Edit:

I unsuccessfully checked the "similar questions" suggested by SO, among others this one:

[Flex: Modify an embedded icon and use it in a button?](https://stackoverflow.com/questions/160250/flex-modify-an-embedded-icon-and-use-it-in-a-button)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T19:24:37.207

子类[mx.controls.treeClasses.TreeItemRenderer](http://livedocs.adobe.com/flex/3/langref/mx/controls/treeClasses/TreeItemRenderer.html)并使其将图标大小调整为所需的尺寸，或者使用与 TreeItemRenderer 相同的接口创建自己的项目渲染器实现。使用以下属性设置自定义项目渲染器`itemRenderer`：

```
exampleTree.itemRenderer = new ClassFactory( ExampleCustomItemRendererClass ); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T15:25:48.080

这个问题的答案可能会为您指明正确的方向，而无需更多地了解您遇到的麻烦：

[Flex：修改嵌入式图标并在按钮中使用它？](https://stackoverflow.com/questions/160250/flex-modify-an-embedded-icon-and-use-it-in-a-button)

希望能帮助到你！

# mysql - 如何在 MySQL 4.1 上加快这个 SQL 查询？

> ID：442883
> 
> 赞同：0
> 
> 时间：2009-01-14T13:15:56.577
> 
> 标签：mysql, indexing, performance

我有一个 SQL 查询需要很长时间才能在 MySQL 上运行（需要几分钟）。该查询是针对具有超过 1 亿行的表运行的，所以我并不感到惊讶它的速度很慢。不过，理论上，应该可以加快速度，因为我真的只想从大表（我们称之为 A）中取回在另一个表 B 中有引用的行。

所以我的查询是：

```
SELECT id FROM A, B where A.ref = B.ref; 
```

（A 有超过 1 亿行；B 只有几千行）。

我添加了索引：

```
alter table A add index(ref);
alter table B add index(ref); 
```

但它仍然很慢（几分钟——我会很高兴一分钟）。

不幸的是，我坚持使用 MySQL 4.1.22，所以我不能使用视图。

我宁愿不要将所有相关行从 A 复制到一个单独的较小的表中，因为我需要的行会不时更改。另一方面，目前这是我能想到的唯一解决方案。

欢迎任何建议！

编辑：这是在我的查询上运行 EXPLAIN 的输出：

```
+----+-------------+------------------------+------+------------------------------------------+-------------------------+---------+------------------------------------------------+-------+-------------+
| id | select_type | table                  | type | possible_keys                            | key                     | key_len | ref                                            | rows  | Extra       |
+----+-------------+------------------------+------+------------------------------------------+-------------------------+---------+------------------------------------------------+-------+-------------+
|  1 | SIMPLE      | B                      | ALL  | B_ref,ref                                | NULL                    |    NULL | NULL                                           | 16718 | Using where |
|  1 | SIMPLE      | A                      | ref  | A_REF,ref                                | A_ref                   |       4 | DATABASE.B.ref                                 |  5655 |             |
+----+-------------+------------------------+------+------------------------------------------+-------------------------+---------+------------------------------------------------+-------+-------------+ 
```

（在编辑我的原始查询示例时，我选择使用“ref”作为我的列名，这恰好与其中一种类型相同，但希望这不会太令人困惑......）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T13:24:39.430

查询优化器可能已经尽其所能，但万一它首先读取巨型表 (A)，您可以使用以下`STRAIGHT_JOIN`语法明确告诉它首先读取 B：

```
SELECT STRAIGHT_JOIN id FROM B, A where B.ref = A.ref; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T13:45:55.473

从答案来看，您似乎正在使用 SQL 做最有效的事情。A 表似乎是个大问题，把它分成三个单独的表怎么样，有点像本地版本的分片？或者，假设 B 没有太多列，是否值得将 B 表非规范化为 A 表？

最后，您可能只需要购买一个更快的盒子来运行它 - 没有什么可以替代马力！

祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T13:23:15.127

从 A.ref = B.ref 上的 A JOIN B 中选择 id

您可以通过使用适当类型的连接来进一步优化，例如 LEFT JOIN

[http://en.wikipedia.org/wiki/Join_(SQL)](http://en.wikipedia.org/wiki/Join_(SQL))

# javascript - Function to convert GridView and Repeater in a JSON string

> ID：442885
> 
> 赞同：0
> 
> 时间：2009-01-14T13:16:39.150
> 
> 标签：javascript, asp.net, json, gridview, repeater

I need a JavaScript function which will take the `ASP.NET` Repeater as input. The function must then parse through the object and return the data in the rows of the object as `JSON`.

Then, I can send the `JSON` back to the server to be `interpreted/parsed` and saved to the DB.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-10-27T20:49:28.573

您最好的选择可能是遍历由 呈现的元素`Repeater`并将值收集到一个 javascript 对象中。当您拥有它时，您可以使用 json2`stringify()`或 jquery`serialize()`或类似的东西来生成 json 表示。

# powershell - Powershell cmdlet 开发最佳实践

> ID：442893
> 
> 赞同：11
> 
> 时间：2009-01-14T13:20:01.110
> 
> 标签：powershell, cmdlets

我目前正在整理一些 Powershell cmdlet。构建它们很容易，但我不知道我是否以可接受的方式构建它们（可以这么说）。

将数据传递到 Powershell 管道时是否应遵循任何准则/最佳实践？目前，我实际上输出了一个 DataSet 类型的对象 - 如果任何 cmdlet 想要在下游使用它，那么他们将不得不遍历该 DataSet 中的 DataTables，然后遍历每个 DataTable 中的 DataRows。

我想问题是....我会这样做吗？或者我应该输出本质上是一堆行的数据？

提前谢谢大家

-JT

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-14T15:50:59.370

输出最适合用来表示您正在写的内容的任何类型的对象都是可以接受的——DataSet 绝对没问题。唯一可能需要注意的是，PowerShell v2 可能会发现自己运行在 .NET Framework 的简化版本上（例如在 Server Core 上），因此如果您的 cmdlet 可能出现这种情况，您需要谨慎以确保您输出的对象存在于可能使用您的 cmdlet 的每个系统上。

话虽如此，管道在包含对象集合时效果最佳；DataSet 本身不是一个集合。换句话说，您希望下游 cmdlet 能够通过管道一次接收一个对象，这样这些 cmdlet 就不必手动枚举对象。我不太了解您在做什么-很可能是 DataSet 是完全合适的-但我通常更喜欢在内部查看通过 DataSet 的 cmdlet 循环，创建自己的自定义对象（这样表中的每一列都成为一个属性），并将这些对象输出到管道。这只会增加下游 cmdlet 的数量，这些 cmdlet 可以消耗您所发布的内容。

一个简单的测试是将 cmdlet 的输出通过管道传输到 Export-CSV。如果它有效（并且它可能不会与 DataSet 一起使用），那么您*通常*是在做正确的事情。现在，您可能需要创建一个输出 DataSet 的 cmdlet，并且您只*打算*让您编写的某些其他 cmdlet（使用 DataSet）来针对该输出进行操作。没有错。但是，最大的灵活性是单个对象，因为它使 PowerShell 的所有核心 cmdlet 都可以处理您的输出。

希望有帮助。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-08-20T00:11:53.850

MSDN 有一组令人惊叹的[Cmdlet 开发指南](http://msdn.microsoft.com/en-us/library/ms714657(VS.85).aspx)，我发现在开发自己的 Cmdlet 开发指南时非常有用。它们分为三个不同的部分：

*   [所需的开发指南](http://msdn.microsoft.com/en-us/library/dd878238(VS.85).aspx)
*   [大力鼓励发展指南](http://msdn.microsoft.com/en-us/library/dd878270(VS.85).aspx)
*   [咨询开发指南](http://msdn.microsoft.com/en-us/library/dd878291(VS.85).aspx)

# jquery - 在 Google 托管 jQuery 有什么问题/缺点吗？

> ID：442894
> 
> 赞同：15
> 
> 时间：2009-01-14T13:20:24.713
> 
> 标签：jquery

我听说有些人在访问从 Google 获取 jQuery 的网站时遇到问题，因为他们的公司防火墙不喜欢网站从其他网站获取代码，即跨站点脚本？

有没有人遇到过这样的问题？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-14T14:06:58.083

一个问题是**谷歌的服务器**在最坏的时候可能而且确实会宕机。在我对“[您最不舒服的编程经历是什么？](https://stackoverflow.com/questions/418876/what-was-your-most-uncomfortable-programming-experience) ”这个问题的回答中，我回答：

> 我正在向一组潜在用户展示我的团队的新 Web 应用程序。我花了几分钟时间谈论了 Google Visualization API 可以做的所有很酷的事情，因为我们在我们的应用程序中大量使用了它。为了演示，我决定绘制我们之前收集的几组数据。它旨在传达这样的信息：“看看它是多么容易！普通人可以使用我们的产品制作好看的图表。”
> 
> 幸运**的是，托管使用 Visualization API 所需的 Javascript 文件的 Google 服务器决定在我的演示过程中停止工作**。我坐在椅子上，盯着屏幕，喃喃自语“但是……但他们是谷歌……他们的服务器不能宕机”。团队试图一笑置之，但在那一刻，每个人都意识到在真正重要的时候依赖任何第三方（甚至像谷歌这样大的第三方）是多么危险。

我知道这似乎不太可能，但除非您真的别无选择，否则我建议您不要在第三方服务器上托管关键文件，即使它们是 Google 的服务器。**让客户抱怨停电是不好的。让客户抱怨不是您的错并且您无法解决的中断更糟糕**。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-14T14:26:04.033

我认为在 Google 托管是指[AJAX 库 API](http://code.google.com/apis/ajaxlibs/ "AJAX 库 API")？我能看到的优点是：

1.  由于 JS 来自 Google 的 CDN，因此您将节省网站的带宽
2.  您可能会看到更好的响应速度和速度，因为内容来自 Google 的分布式 CDN，而不是您的服务器。
3.  如果用户之前访问过另一个使用 Google 托管其 JS 库的站点，则用户的浏览器可能已经缓存了它们。
4.  Google 会为您正在运行的库版本应用最新的错误修复和安全补丁。与其他人声称的相反，他们*不会*自动将您升级到最新版本。例如，如果你指定你想要 Mootools 1.11，你不会得到 1.2 或任何更高版本，除非你特别改变你的脚本包括调用来请求它。但他们将应用特定于该版本的修复。

以及缺点：

1.  就像您提到的那样，一些更热心的安全工具和产品可能会在包含来自不同主机的脚本时遇到问题。我不知道这是一个多么普遍的问题，但值得调查。
2.  它可能会向页面加载添加另一个 DNS 查找。
3.  Google 已承诺“无限期”托管每个版本的库，您希望他们是认真的。但是命运和政策会发生变化，如果托管服务停止，您可能会发现自己不得不重新访问许多站点来修复它们的 JS。
4.  您依赖第三方来托管您的某些内容。显然，您希望 Google 的正常运行时间非常好，但如果他们确实有问题，您可能必须向您的客户解释为什么他们的网站无法运行，只是因为 Google 遇到了网络问题。
5.  Google 托管每个库的完整版本，但像 Mootools 之类的库允许您创建仅包含所需组件的自定义版本。所以谷歌版本可能比你需要的更全脂。
6.  您无法自定义或更改库。对库进行下游更改是一项艰巨的任务，但如果您遇到困难，这可能是最简单的选择。将库托管在外部会增加额外的复杂性，因为您必须切换到内部副本。
7.  错误修复确实适用于您选择的版本，因此如果您以某种方式依赖错误行为，这可能会导致问题。大概图书馆作者会非常小心潜在的重大变化，但墨菲定律会在某处出现问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-14T13:29:43.587

最近才开始使用 jQuery，并且只使用本地副本，我无法评论跨站点问题。

由于您的问题标题询问在 Google 上托管它是否有*任何*缺点，因此想到的最明显的答案是他们可能随时升级他们的版本，可能会破坏您的代码或导致意外的副作用。更新：Guillaume 评论说，当您托管时，您总是链接到特定版本的 jQuery。我不知道这个 - 谢谢。

最后，如果您所在的国家/地区的国际互联网链接偶尔会掉线，或者您开发了内部网并且互联网链接会掉线，您可能会发现本地用户因为无法访问 Google 而出现错误。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-14T14:18:36.280

一个巨大的优势是离线使用。我在没有移动数据的情况下在火车上编写了大量代码 - 所以在我的 Web 项目中使用 js**非常**有用。它还使我能够对变更管理拥有完全的控制权和信心。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-14T13:28:02.670

我不知道，但我喜欢控制自己:)，我总是将 js 上传到网络服务器

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-14T14:31:18.190

您网站的重度用户通常是重复访问者，无论如何他们都会缓存您本地托管的 .js 文件，因此他们只会在第一次访问该网站时占用该带宽。

1.  我网站的访问者通常是重复访问者吗？（相对于第一次来访者）
2.  我网站的访问者是否可能拥有快速的网络连接？
3.  我在我的站点分配的带宽容量内是否舒适？

每个“是”的答案都是避免依赖 Google 外部托管的 Javascript 的一个理由。

例如：如果您正在运行像 StackOverflow 这样的网站，您的访问者通常是精通技术的人，具有快速连接和缓存，从他们今天早上检查 StackOverflow 的其他 50 次中完全填充，那么在其他地方托管您的 Javascript 的好处是将是非常小的。

但是，如果您在地下室的 256kbps DSL 线路上为吉隆坡的老年人运营一个网站，如果您将这些 JS 文件卸载到 Google，您的访问者将会看到一些不错的收益！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-12-12T17:07:18.973

某些国家/地区可能会通过其 DNS 服务器阻止全国范围内的 google 域访问。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-14T14:21:43.200

让 Google 托管您的 jQuery 有很多缺点。就像其他用户指出的那样：

*   谷歌可以升级他们的副本
*   谷歌可能会倒闭
*   最终用户可能无法访问 Google

回答这个问题的更好方法可能是问：让 Google 托管您的 jQuery 有什么好处？只有在特定情况下，我才会对依赖项使用跨站点托管。即：

*   Google 的服务器可能比您的服务器更靠近您的最终用户
*   与您相比，用户更有可能在本地缓存 Google 的版本（除非他们定期访问）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-05-27T20:41:30.793

所有这些关于带宽的评论，甚至没有人涉及缓存。在托管网站时，如果您没有正确地告诉最终用户缓存文件以及缓存文件的时间，那么您就是在要求过度使用带宽以及导致的问题。

我的回答很简单。自己托管它，将其检入您的源存储库并使用非常长的到期标头正确地提供它。这样每个人都可以一次性下载这些东西。此外，我真的无法忍受不真正拥有我的服务器通过网络发送的每个文件或告诉客户端下载的想法。

# asp.net - 空白密码难题

> ID：442898
> 
> 赞同：2
> 
> 时间：2009-01-14T13:21:11.917
> 
> 标签：asp.net, security

我在这里打了一个空白，希望能有一个开始。

我在一个页面上有两个密码文本框，在加载时我将它们的值属性默认为字符串“*”，因为我不想显示正确的密码，甚至不想提示它的长度。现在我不想让用户编辑这些空白字符串来混淆用户，所以我在焦点上清除了文本框。现在我的代码认为密码已更改并将保存空白值，这是允许的，但不是有意的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-14T13:31:15.237

在我看来，您不应该首先加载密码并仅在密码包含一些文本时才保存密码。

PS：出于安全原因，您应该考虑不要将密码保存为明文，而是作为**哈希值**（加盐）。[在这里](http://www.codinghorror.com/blog/archives/000953.html)和[这里](http://www.codinghorror.com/blog/archives/000949.html)阅读。只是一个提示。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-14T13:29:41.323

我不知道密码为空的原因（我猜它可能会允许有限的访问？），但具有讽刺意味的是，为了安全起见，添加一个“无密码”复选框，然后禁用密码输入字段（如果已选中）。这样一来，密码将为空，如果有任何后果（受限访问、验证码要求等），用户希望知道选中此框也有这些含义。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-14T13:25:19.303

保持其他所有内容相同，我可能会特别处理空白密码的情况并不允许没有密码。

在无密码情况的实际用例的不寻常情况下，我会添加一个特殊按钮“清除密码”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T13:25:55.277

更改保存密码的代码，使其不保存空白密码？！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T13:58:52.293

无论您这样做，您都必须在保存过程中检查值，并且总是有可能出错（即用户希望将他们的密码设置为您的“假装”字符串）。

如果您使用并输入 type="password" 而不是 type="text"，则添加什么文本并不重要，因为浏览器会为您隐藏它，因此只需添加一个已知但不太可能使用过的字符串（即，如果您有无效字符，请使用它们，或者以#0# 或其他方式开始）。

接下来，我将使用 JavaScript 设置此默认值 - 这样，如果用户禁用了 JavaScript，并且您的 onFocus 事件没有运行，那没关系，因为没有什么要清除的。

最后，在您的 Save 方法中，检查密码框中是否存在已知字符串，如果存在，您知道忽略该值，如果字段为空，并且当前密码也为空，则不会已经变化。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T10:40:26.453

我发现 IIS 不允许 FTP 使用空白密码，所以问题是，虽然很有趣，但现在没有实际意义。

# vb.net - How to overlay or watermark a picture in windows media player

> ID：442902
> 
> 赞同：2
> 
> 时间：2009-01-14T13:22:14.287
> 
> 标签：vb.net, winforms, video, overlay, wmf

I working on a distributed mediaplayer that uses the windows media player component. Now the customer asks me if its possible to have their logo overlayed on the media played instead of them having to render every movie with the logotype.

I have google it and it seems like I can use a directshow filter to do this, but I havent found any good information on how to do it yet.

If anyone here know If I can do this programatically, with a plugin, filter or some other way it would be nice to know. Its fine if its a plugin that costs money too.

What I want is to be able to use a jpg/png as watermark/overlay to the running movie in Windows Media Player 11

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T14:07:27.113

It is possible to do this by forcing your own custom [DirectShow](http://msdn.microsoft.com/en-us/library/ms783323(VS.85).aspx) filter into WMP's filter graph. This involves setting the filter's [merit](http://msdn.microsoft.com/en-us/library/ms787275(VS.85).aspx) to be very high so that DirectShow's automatic graph building will insert your filter in the WMP chain. However, I would not recommend this approach because a) it's possible that the filter will not always get inserted with certain filter graph chains and b) it will also be added to the filter graphs of any other installed third party DirectShow apps. This second issue is likely to be a major problem.

It should be possible to create a [WMP DSP plugin](http://msdn.microsoft.com/en-us/library/bb249677(VS.85).aspx) to do this. These are implemented as DirectX Media Objects ([DMO](http://msdn.microsoft.com/en-us/library/ms783356(VS.85).aspx)s), which are similar to, but simpler than, DirectShow filters. This approach may well be your best bet.

A final approach would be to rewrite the entire media playback portion of your app in DirectShow instead of using the WMP control. This would take a lot more effort but if you plan to do a lot of custom media stream processing either now or in the future then it may be a good option to take.

# .net - 从 XML 到对象

> ID：442910
> 
> 赞同：1
> 
> 时间：2009-01-14T13:23:26.813
> 
> 标签：.net, asp.net, xml, parsing

我想从 xml 定义一个 asp.net 页面，然后通过调用命令名称来解析/呈现它。就像他们在 Flex 中所做的一样。有人知道怎么做吗？

例如，来自 XML：

```
<button onClick="DoJavascript()" text="Submit"/>
<gridview ......./> 
```

解析：

```

`<asp:button runat="server" onClick="DoJavascript()" text="Submit"/>
<asp:gridview runat="server" ......./>` 

            回答 #1

赞同：1

时间：2009-01-14T14:11:05.453

您可以尝试 XSLT，它通常用于转换 XML。

            回答 #2

赞同：0

时间：2009-01-14T14:31:25.350

在您的情况下，数据和对象是同义词。基本上，您正在获取顶级 XML 并将其吐出到 ASP.Net 页面中。我没有足够的 ASP.Net 经验来告诉您如何继续，现在以编程方式将代码解析为 Page 对象，但是，如果您想做转换并让 ASP.Net 解析/渲染 aspx，这个是你所需要的全部。

        mysql - 在 MS Access 和 MySQL 之间同步数据的最佳方式是什么？

ID：442915

赞同：5

时间：2009-01-14T13:24:54.080

标签：mysql, database, ms-access, odbc

我在 Windows 机器上有一个访问数据库，我必须将它导入到 linux 网络服务器上的 mysql 中。目前access dabatbase表导出为文本文件，用ftp自动复制，然后加载到mysql中。

有没有更好的方法来做到这一点，也许使用 ODBC 连接或其他方式？

限制复制已经存在的信息的最佳方法是什么，即仅传输在 access 数据库中但尚未在 mysql 中的记录。

访问数据库由另一个程序处理，如果我不必对其进行更改甚至打开它，那将是最好的。不可能需要从访问数据库中导入更新的记录。mysql数据库将是主要来源，一些记录将被删除或更改。我只想导入从未在 mysql 数据库中的记录，而不是恢复那些故意删除的记录。

            回答 #1

赞同：3

时间：2009-01-14T13:47:28.107

为什么不按照 Keltia 的建议通过 ODBC 链接表，然后使用一系列查询来添加丢失的记录并更新更改的记录。查询可以通过 VBA 运行。ADO 也可以很好地与 MySQL 和 Access 配合使用。

关于 Access 中使用的代码的一些说明：

```
 Set db = CurrentDb
   strSQL = "Insert INTO [ODBC;DSN=DSNName;].NameOfMySQLTable " _
   & "Select AnyField As NameOfMySQLField FROM AnyAccessTable;"

   db.Execute strSQL, dbFailOnError
   End Sub 
```

-- [http://forum.lessthandot.com/viewtopic.php?f=95&t=3862](http://forum.lessthandot.com/viewtopic.php?f=95&t=3862)

            回答 #2

赞同：1

时间：2009-01-14T13:29:56.503

如果您确实需要增量更新，那么执行此操作的方法是编写一个连接到两个数据库的脚本（至少在 Access 端通过 ODBC）并比较所有表。复制整个东西的好处是你肯定不会忘记任何东西，缺点可能是大小和mysql在重新加载期间将不可用的事实。

            回答 #3

赞同：0

时间：2009-01-14T13:46:52.850

为了帮助仅传输更改，我建议您在 Access 数据库中添加一个名为 RecordChanges 的新表。

表结构如下：

```
RecordChangeID (int) - Primary Key (Autonumber)
TableName (varchar(250)) - Name of table that changed
RecordID (int) - ID of the record in that table that was added / modified
RecordAction (char(1)) - 'A' if add, 'M' if modified or 'D' if deleted 
```

注意 - 通过向其中添加用户 ID 和其他详细信息，您可以获得很好的审计跟踪。

这是最痛苦的部分——但我会在您的应用程序中创建一个子例程，以便在您想要与 MySQL 数据库同步的表中每次更改记录时向该表添加一条记录。

完成此操作后，我将创建另一个只有一条记录的表，称为 ExportStatus，其结构如下：

```
LastRecordChangeID (int) - ID of the last Record Change 
                           you exported in the Record Changes table 
```

然后创建一个子例程来检查自上次导出以来的所有记录更改（您从 ExportStatus 表中检索它）并生成 SQL 语句来更新您的 MySQL 数据库，确保在完成后更新您的 ExportStatus 表。您可以删除所有已成功导出的 RecordChange 记录，或将它们保留为审计跟踪。

在实现此之前，您需要按照当前的方式进行初始同步。

            回答 #4

赞同：0

时间：2009-01-14T13:50:27.477

请参阅我的答案

[自动访问 DB5 到 MySQL](https://stackoverflow.com/questions/242975/access-db5-to-mysql-automatically)

            回答 #5

赞同：-1

时间：2009-01-14T13:40:03.160

我会做以下事情：

将所有 Access 数据转储到 MySQL 中的临时表中，该表将暂时成为您的“主”数据源。您应该能够通过设置指向 MySQL 的 ODBC 数据源、右键单击 Access 表并单击“导出”来执行此操作。

1.  在 MySql 中运行 UPDATE 脚本以更新匹配记录
2.  在 MySql 中运行 INSERT 脚本以插入新记录
3.  （可选，取决于这是否是您想要的）：在 MySql 中运行 DELETE 脚本以删除在新导入的 Access 表中找不到的记录。
4.  删除 MySql 中的临时表。

可以通过链接表从 MS Access 内部完成所有这些操作。但是性能不会那么好，并且当/如果您的 MySql 表发生更改时，它将需要更改 Access 语句。

[这个答案也可能对你有帮助](https://stackoverflow.com/questions/418898/sqlite-upsert-not-insert-or-replace#418920)。

        asp.net - 依赖注入一个 HTTPModule

ID：442918

赞同：3

时间：2009-01-14T13:25:34.313

标签：asp.net, dependency-injection, httpmodule

Google/MyBrain 让我失望了。如果不使用框架（我永远无法超越我的同事），鉴于您（程序员）无法控制创建实例，您如何将依赖项注入 HTTPModule？

我们是在破解自定义 web.config 部分 + 反射，还是有一些我没有看到的更干净的东西？

例如，使用 Karl Seguin 的[示例](http://codebetter.com/blogs/karlseguin/archive/2006/06/12/146356.aspx)模块作为基础，并假设实现了 ILogger。.Net 2.0 固件

```
public class ErrorModule : IHttpModule
{
    private ILogger injectedLogger; //how to set this?

    public void Init(HttpApplication application)
    {
        application.Error += (new EventHandler(this.application_Error));
    }

    public void Dispose() { /* required by IHttpModule */ }

    private void application_Error(object sender, EventArgs e)
    {
        this.injectedLogger.doStuff(e.ExceptionObject as Exception);
    }
} 
```

*正是这样的事情让我意识到我是多么鄙视 MSDN。*

            回答 #1

赞同：5

时间：2009-01-14T14:45:13.073

我偶然发现了一个程序化解决方案。完全消除 web.config 引用，如果您小心生命周期，您可以将模块添加到 global.asax。

在 global.asax 中添加：

```
public static ErrorModule myErrorModule;

public override void Init()
{
    base.Init();
    myErrorModule = new ErrorModule(new LogImplementer());
    myErrorModule.Init(this);
} 
```

其中“LogImplementer”实现了 ILogger，只需在 httpmodule 中添加一个构造函数：

```
public ErrorModule(ILogger injected)
{
    this.Logger = injected;
} 
```

有一些健康警告。您必须非常小心在 global.asax 中执行此操作的位置（我很确定 Init() 是正确的，但我不确定）并且该模块未添加到只读 HttpApplication.Modules 集合中. 除此之外，工作精美。

            回答 #2

赞同：0

时间：2009-01-14T13:58:57.333

你可以在 15 分钟 33 行中使用一个非常简单的一类 ioc[一个 IoC 容器](http://www.kenegozi.com/Blog/2008/01/17/its-my-turn-to-build-an-ioc-container-in-15-minutes-and-33-lines.aspx)

            回答 #3

赞同：0

时间：2009-11-09T08:46:22.720

请在此处查看我对类似问题的回答：

[将 IoC 依赖注入自定义 HTTP 模块 - 如何？(ASP.NET)](https://stackoverflow.com/questions/1657473/ioc-dependancy-injection-into-custom-http-module-how-asp-net/1699792#1699792)

        windows - Windows 相当于 OS X 钥匙串？

ID：442923

赞同：74

时间：2009-01-14T13:26:25.060

标签：windows, security, passwords

在 Windows 中是否有用于存储用户密码的 OS X 钥匙串的等价物？我会用它来保存我的（桌面）软件使用的网络服务的用户密码。

从这个相关问题的答案（[Protecting user passwords in desktop applications (Rev 2)](https://stackoverflow.com/questions/225838/protecting-user-passwords-in-desktop-applications-rev-2)）和[大量可用的第三方密码存储工具](https://stackoverflow.com/questions/11362/what-is-your-favorite-password-storage-tool)，我认为这样的事情不存在——我是否坚持要求每次访问 Web 服务时的密码，还是只是将其混淆存储？

            回答 #1

赞同：29

时间：2018-10-16T12:29:10.797

现在是 2018 年，Windows 10 有一个“凭据管理器”，可以在“控制面板”中找到

            回答 #2

赞同：19

时间：2009-01-14T13:47:55.170

“传统的”Windows 等效项是受保护的存储子系统，由 IE（IE 7 之前）、Outlook Express 和一些其他程序使用。我相信它是用您的登录密码加密的，这可以防止一些离线攻击，但是一旦您登录，任何想要读取它的程序都可以读取它。（例如，参见 NirSoft 的[Protected Storage PassView](http://www.nirsoft.net/utils/pspv.html)。）

Windows 还提供了可能有所帮助的 CryptoAPI 和数据保护 API。不过，我不认为 Windows 会采取任何措施来防止在同一帐户下运行的进程看到彼此的密码。

看起来[*用户识别和认证机制*](http://books.google.com/books?id=eIPA4v0u05EC&pg=PA200&lpg=PA200&dq=%22protected+storage%22+api&source=bl&ots=guQUDgVMbh&sig=snQujtDYA9Qo8iCcGQQ5hR_klAU&hl=en&sa=X&oi=book_result&resnum=5&ct=result)一书提供了所有这些的更多细节。

如果您有兴趣了解其他软件是如何做到的，Eclipse（通过其[安全](http://help.eclipse.org/juno/index.jsp?topic=%2Forg.eclipse.platform.doc.user%2Freference%2Fref-securestorage-start.htm) [存储功能）实现了类似的功能。](http://help.eclipse.org/juno/index.jsp?topic=%2Forg.eclipse.platform.doc.isv%2Fguide%2Fsecure_storage_dev.htm)

            回答 #3

赞同：18

时间：2015-03-30T08:22:45.100

Windows 8 有一个名为 Password Vault 的钥匙串概念。Windows 运行时应用程序（现代/Metro）以及托管桌面应用程序可以使用它。根据文档：

应用程序和服务无权访问与其他应用程序或服务关联的凭据。

请参阅[如何](https://msdn.microsoft.com/en-us/library/windows/apps/xaml/hh465069.aspx)在 MSDN 上存储用户凭据。

在 Windows 8 之前，[数据保护 API](https://msdn.microsoft.com/en-us/library/ms995355.aspx) (DPAPI) 是最接近钥匙串的等价物。可以使用此 API 加密任意数据，但存储加密数据取决于开发人员。数据最终使用当前用户的密码进行加密，但是可以包含用户或开发人员提供的“可选熵”以进一步保护数据免受其他软件或用户的影响。数据也可以在域中的不同计算机上解密。

DPAPI 可以通过对 Crypt32.dll 的[CryptProtectData](https://msdn.microsoft.com/en-us/library/windows/desktop/aa380261%28v=vs.85%29.aspx)和[CryptUnprotectData](https://msdn.microsoft.com/en-us/library/windows/desktop/aa380882%28v=vs.85%29.aspx)函数的本机调用或通过 .NET Framework 的[ProtectedData](https://msdn.microsoft.com/en-us/library/system.security.cryptography.protecteddata%28v=vs.110%29.aspx)类来访问，后者是前函数的有限功能包装器。

[Passcape 的文章DPAPI Secrets](http://passcape.com/index.php?section=blog&cmd=details&id=20)中提供了比您需要了解的更多关于 DPAPI 的信息。[DPAPI中的安全分析和数据恢复](http://passcape.com/index.php?section=blog&cmd=details&id=20)。

            回答 #4

赞同：14

时间：2010-12-05T04:32:42.500

实际上，通过 MSDN，他们推荐使用的功能（而不是受保护的存储）是：

*   `CryptProtectData`
*   `CryptUnprotectData`

的链接`CryptProtectData`位于[CryptProtectData function](http://msdn.microsoft.com/en-us/library/aa380261(v=VS.85).aspx)。

            回答 #5

赞同：5

时间：2020-03-03T05:53:47.233

OS X 钥匙串等价物是Windows 中的[凭据管理器](https://www.digitalcitizen.life/credential-manager-where-windows-stores-passwords-other-login-details)。

            回答 #6

赞同：2

时间：2020-08-19T06:14:59.500

一个免费的开源密码管理器可以将您的所有密码安全地保存在一个地方，它是“KeePass”，是 Windows 凭据管理器的替代品。

            回答 #7

赞同：1

时间：2020-08-31T12:32:54.727

如果您在 Windows 上，则必须**控制面板 -> windows Credentials**

            回答 #8

赞同：0

时间：2021-01-15T21:13:49.720

[Windows 上的凭据转储](https://attack.mitre.org/techniques/T1003/)，即使使用“凭据管理器”仍然是一个问题，我认为在特殊硬件之外没有任何方法可以防止它。MacOS 钥匙串没有这个问题，所以我认为没有完全等价的。

            回答 #9

赞同：0

时间：2022-01-26T22:12:57.907

是的。答案是[凭证储物柜](https://docs.microsoft.com/en-us/windows/uwp/security/credential-locker)
它有特定的 UWP API，我相信您可以从 WinUI 3 访问相同的 API

        unit-testing - 生产和测试代码常量之间的 DRY

ID：442924

赞同：13

时间：2009-01-14T13:27:43.527

标签：unit-testing, constants, dry

我通常会尽量避免重复并遵守 DRY 原则。但是，我想知道这样的案例：

```
public class Feature {
    final static String FEATURE_LABEL = "blah";

    public void doSomething() { ... }
    ...
}

public class FeatureTest {
    ...
    @Test
    public void doSomethingShouldMakeSomethingHappen() {
         assertEquals(Feature.FEATURE_LABEL, 
             feature.getSomethingHappens().getLabel());
    } 
```

如果要求标签为“blah”并且有人将 FEATURE_LABEL 更改为“bleh”，则即使不再满足要求，测试也会通过。这是违反 DRY 的有效场所吗？

            回答 #1

赞同：16

时间：2009-01-14T13:36:07.427

是的，在这里使用文字。

[从一个关于文字的问题中](https://stackoverflow.com/questions/401919/is-hard-coding-literals-ever-acceptable#437811)引用我自己的话：

*硬编码文字应该出现在测试值的单元测试中，除非在单个测试类中重复使用太多值以至于局部常量很有用。*

*单元测试是对预期值的描述，没有任何抽象或重定向。想象一下你自己正在阅读测试——你想要将信息直接呈现在你面前。*

            回答 #2

赞同：5

时间：2009-01-14T13:36:23.777

要测试一些东西——任何东西——一个重要的考虑因素是你的测试条件独立于你正在测试的东西。否则，您的测试就没有单一、可靠的意义。每次检查对象发生变化时，它们都会变成其他测试。

不是很好的事情。

同样的想法也适用于单元测试。在上面的上下文中，您正在测试的字符串应该绝对独立于测试类中的内容。换句话说，是的，你可以而且*应该*在这里违反 DRY 原则。

            回答 #3

赞同：2

时间：2009-01-14T13:49:09.647

表达其他人已经说过的话的另一种方式：如果测试永远不会失败，那么保留它是没有意义的。所以这没有意义：

```
assertEquals(Feature.FEATURE_LABEL, Feature.FEATURE_LABEL); 
```

比如说，你有一个列表的限制。测试limit == limit是没有意义的，测试应该尝试将超过limit的元素放入列表中。

OTOH，如果您想确保在正确的位置使用常量（即它应该用作某些 UI 元素的标签），使用字符串常量（而不是新的文字）使用测试是有意义的）。

也就是说，对于我自己的 UI 测试，我使用抓取工具收集所有可见的字符串，并将生成的（长）字符串与文件的内容进行比较。这是一个非常简单的针对 UI 中的意外更改的全面测试，并且最适用于 HTML 中的 UI（我下载了 HTML 并进行了比较），但相同的模式可以应用于任何 UI。

            回答 #4

赞同：1

时间：2009-01-14T13:35:19.410

我暂时坚持参考。

问题是，如果需求发生变化，*应该*会触发某人更改测试。可以说，更改测试的正确方法是将其更改为文字的新值，看到它失败，更改生产静态，看到它通过，然后更改测试以再次使用生产静态并看到它仍然通过。

这有任何意义吗？

            回答 #5

赞同：0

时间：2009-01-14T14:42:48.837

我认为你所拥有的东西很好，是的，它是 DRY 的有效使用：如果这个值最终会出现在几个测试中，你不想在值发生变化时改变几个。但是您还应该添加一个额外的测试，即验证 Feature.FEATURE_LABEL 值的测试。

这是应用“一次且仅两次”的好地方：如果您只有一个测试 FEATURE_LABEL 的值的测试，那么我只使用文字字符串。只有当您使用它进行多个测试时，我才会开始使用引用（并为该值添加测试）。

        storage - 您的应用程序使用什么文件格式，为什么？

ID：442932

赞同：0

时间：2009-01-14T13:28:37.630

标签：storage, desktop-application, blob, file-format

我最感兴趣的是针对大量变异的面向对象数据的进程内（单用户）解决方案，其中数据的任何部分都可能发生变化。此类系统通常存在以下问题：

*   从头开始写大文件效率低下
*   xml 太冗长
*   SQL blob 不是很好的匹配项

你是怎么做到的？

            回答 #1

赞同：2

时间：2009-01-14T13:42:10.627

或使用几个可用的开箱即用解决方案之一进行映射。

            回答 #2

赞同：1

时间：2009-01-14T13:35:43.823

这取决于您的要求。你会诚实地使用 XML 或 SQL blob 来处理高分辨率图片或音频吗？

我再次阅读您的问题：如果您有一堆任意对象要存储在文件图像中，那么将它们放入/取出的方法是复制和重定位。out-copy 可以得到 GC 的帮助。in-copy 非常简单，主要取决于重定位例程。

如果需要处理非常大的文件，我会在该系统中提供一些方法来标记对象“脏”，以及标记它们在文件图像中的实际位置。

除非您从不删除任何东西，否则还需要在已删除的对象中进行标记。

            回答 #3

赞同：0

时间：2009-01-14T13:53:50.777

您可以尝试序列化为 XAML，而不是 XML。这可以创建更小的文件，并且读写速度更快（序列化/反序列化）。

显然，依赖于 XAML 是一种选择。

            回答 #4

赞同：0

时间：2009-01-14T14:07:46.100

您需要 O/R 映射或像 db4o 这样的对象数据库。

如果是一组相对独立的对象的集合，也可以将每个对象存储到自己的文件中，并且只在对象脏时写入。但显然，在更复杂的情况下，保持引用的正确性和避免不直观的目录结构可能需要大量工作，而这正是 O/R 映射器和对象数据库带来的真正意义。

至于 XML 过于冗长，通常可以通过压缩来解决（例如 zip 中的 xml）。

            回答 #5

赞同：0

时间：2009-01-14T13:37:16.440

我们主要使用二进制数据。除非它必须是人类可读的（如设置和用户偏好）。

如果您认为 xml 过于冗长，请查看 JSON。我认为这是一个非常好的选择。

            回答 #6

赞同：0

时间：2009-01-15T05:51:54.803

对于大型数据集，我使用结构化的二进制文件，没有什么比空间和时间更有效了。

对于结构化文本数据，我将使用 s 表达式（即[LAML](http://www.cs.aau.dk/~normark/laml/)）或减少用 i 表达式实现的括号 LAML。

            回答 #7

赞同：0

时间：2009-01-14T13:38:25.893

“从头开始写大文件效率低下” 什么？很少有东西像文件 I/O 一样快。请提供一些示例或数据来支持您对文件 I/O 效率低下的断言。

大多数 OO 系统可以将对象序列化或腌制到文件中。这大约是最快的 I/O。

此外，大多数 OO 系统可以将对象转换为标准表示形式，如 XML、JSON 或 YAML。

JSON/YAML 比 XML 更简洁，更容易解析。

            回答 #8

赞同：0

时间：2009-01-14T13:44:05.617

我将 YAML 用于中小型文件，非常易于解析和保存。JSON 是一个有价值的选择。

        c# - 为控件快捷方式创建事件方法 - Visual Studio

ID：442933

赞同：3

时间：2009-01-14T13:28:53.010

标签：c#, visual-studio-2008

是否有为控件添加事件方法的快捷方式？如果我有一个按钮，我想添加 Click 方法而无需键入它或切换到设计视图。

编辑：说真的！当我在 VB 中执行此操作时，我有一个所有控件及其事件的下拉列表。这对 C# 来说有那么难吗？

            回答 #1

赞同：10

时间：2009-01-14T13:35:17.863

窗体？网络表格？什么？

一种选择是（在初始化之后）挂钩您自己的事件 - 智能感知提供事件名称，然后 [Tab][Tab] 创建方法存根 - 即

```
public MyForm()
{
    InitializeComponent()
    someButton.Click += (press [tab][tab] now)
} 
```

它会完成其余的工作......同样在适当的位置以网络形式出现。

这给了你：

```
public MyForm()
{
    InitializeComponent();
    someButton.Click += new EventHandler(someButton_Click);
}

void someButton_Click(object sender, EventArgs e)
{
    throw new NotImplementedException(); // your code here ;-p
} 
```

            回答 #2

赞同：3

时间：2009-01-14T13:39:25.750

您是否考虑过创建一个片段？这是我用来创建连接到事件的匿名方法的片段。

```
<?xml version="1.0" encoding="utf-8" ?>
<CodeSnippets  xmlns="http://schemas.microsoft.com/VisualStudio/2005/CodeSnippet">
    <CodeSnippet Format="1.0.0">
        <Header>
            <Title>anonymous</Title>
            <Shortcut>__anonymous</Shortcut>
            <Description>Code snippet for an anonymous method</Description>
            <Author>Andrew</Author>
            <SnippetTypes>
                <SnippetType>Expansion</SnippetType>
            </SnippetTypes>
        </Header>
        <Snippet>
            <Declarations>
                <Literal>
                    <ID>event</ID>
                    <Default>base.Init</Default>
                    <ToolTip>Event to attach</ToolTip>
                </Literal>
                <Literal>
                    <ID>args</ID>
                    <Default>EventArgs</Default>
                    <ToolTip>Event argument type</ToolTip>
                </Literal>
                <Literal>
                    <ID>name</ID>
                    <Default>args</Default>
                    <ToolTip>Event arg instance name</ToolTip>
                </Literal>
            </Declarations>
            <Code Language="csharp"><![CDATA[$event$ += delegate(Object sender, $args$ $name$) {
                $end$
            };]]>
            </Code>
        </Snippet>
    </CodeSnippet>
</CodeSnippets> 
```

这里还有[一篇文章](http://msdn.microsoft.com/en-us/library/ms165392(VS.80).aspx)解释了如何创建它们以及它们是如何工作的。

            回答 #3

赞同：1

时间：2009-01-14T13:36:54.960

```
public partial class MyUserControl : System.Web.UI.UserControl
{

public delegate void ButtonClickEventHandler(object sender,EventArgs e);
public Event ButtonClickEventHandler Button_Click;

 protected void btnLogin_Click(object sender, EventArgs e)
        {
            if (Button_Click!= null)
                Button_Click(sender,e);
        }
} 
```

默认.aspx

```
protected override void OnInit(EventArgs e)
        {
            base.OnInit(e);
            MyUserControl.Button_Click+= MyUserControl_Button_Click;
        }

 void MyUserControl_Button_Click(object sender,EventArgs e)
        { } 
```

        c# - 以编程方式显示的 Word 对话框不响应鼠标单击

ID：442941

赞同：0

时间：2009-01-14T13:30:11.120

标签：c#, interop, ms-word, ms-office

以下代码显示了一个*插入表格*对话框：

```
Dialog d = WordApp.Dialogs[WdWordDialog.wdDialogTableInsertTable];
int result = d.Show(ref missing);
if (result == -1)  // if user pressed OK
{
    d.Execute();
} 
```

问题是对话框**不响应**鼠标点击。不过，它会**响应**键盘输入。

此外，如果我按 Alt+Tab（切换到其他正在运行的应用程序）然后再次按 Alt+Tab（切换回我的应用程序），它会**同时**响应鼠标和键盘输入。

我的猜测是我的应用程序不“知道”显示了一个对话框（因为它不会以常规的*Form.ShownDialog*方式发生）并且它保持焦点。

我怎么解决这个问题？

            回答 #1

赞同：1

时间：2009-01-14T14:34:15.047

我解决了。

我不确定为什么，但这会有所帮助：**在**显示对话框之前，我**禁用**了主应用程序表单，然后**在**显示对话框之后，我将其重新**启用**。  

```
Dialog d = WordApp.Dialogs[WdWordDialog.wdDialogTableInsertTable];

MainApplicationFormInstance.Enabled = false;
int result = d.Display(ref missing);
MainApplicationFormInstance.Enabled = true;

if (result == -1)  // user pressed OK
{
    d.Execute();
} 
```

        visual-studio-2008 - 为什么使用 Firefox 时 Visual Studio 2008 会变慢？

ID：442948

赞同：2

时间：2009-01-14T13:33:31.003

标签：visual-studio-2008, firefox, visual-studio-express

*   我正在使用 Microsoft Visual Web Developer 2008 Express。
*   我制作了一个 ASP.NET MVC 站点，它在 Site.Master 文件的 HEAD 元素中有 6 个 CSS 文件和 6 个 Javascript 文件。
*   当我在 Explorer 或 Opera 中按 F5 或 CTRL-F5 时，站点会立即显示。
*   当我在 Firefox 中运行我的网站时，LOCALHOST 上的每个 CSS 和每个 Javascript 文件都需要一秒钟，即在 localhost 上加载需要 12 秒。

我可以在 Firefox 设置中进行哪些更改，使其与 Opera 和 Explorer 一样快？

新信息：完全卸载 Firebug，没有 yslow，没有其他附加组件。当我取出 CSS 和 Javascript 文件时，Firefox 和其他浏览器一样快。什么可能在本地连接上花费这么长时间？

            回答 #1

赞同：5

时间：2009-01-14T13:42:08.880

[如本博客](http://weblogs.asp.net/dwahlin/archive/2007/06/17/fixing-firefox-slowness-with-localhost-on-vista.aspx)所述，它可能与 IPv6 有关。

            回答 #2

赞同：4

时间：2009-11-18T09:09:04.223

将*localhost*设置为仅使用 IPv4（或对所有站点禁用 IPv6）：

1.  *`about:config`*在地址栏中输入
2.  查找*`ipv4`*部分
3.  放*`network.dns.ipv4OnlyDomains =`*****`localhost`**** * * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-01-14T13:35:26.257

这听起来像是一个附加组件。你在运行 YSlow 或 Firebug 之类的东西吗？

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-04-30T11:17:18.260

我的 Firefox 行为方式相同，在 OLD VS 中，他们将调试内容放在控制面板的服务中，但现在我无法在任何地方找到它。

# javascript - 封闭外部范围时如何取消引用 JavaScript 变量

> ID：442985
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2009-01-14T13:43:15.447
> 
>         
> 
> 标签：javascript, scope

好的，这是一个问题脚本。

```
var links = [ 'one', 'two', 'three' ];

for( var i = 0; i < links.length; i++ ) {
    var a = document.createElement( 'div' );
    a.innerHTML = links[i];
    a.onclick = function() { alert( i ) }
    document.body.appendChild( a );
} 
```

此脚本使用数组生成三个 div：一、二和三。

我在每个 div 上设置了一个（为简单起见是 Dom0）单击处理程序，它会提醒其在数组中的位置索引。- 除了它没有！它总是提醒 3，数组的最后一个索引。

这是因为 'alert(i)' 中的 'i' 是对外部范围（在本例中为全局）的实时引用，并且在循环结束时其值为 3。它需要的是一种在循环中取消引用 i 的方法。

这是一种解决方案，我倾向于使用它。

```
var links = [ 'one', 'two', 'three' ];

for( var i = 0; i < links.length; i++ ) {
    var a = document.createElement( 'div' );
    a.innerHTML = links[i];
    a.i = i; //set a property of the current element with the current value of i
    a.onclick = function() { alert( this.i ) }
    document.body.appendChild( a );
} 
```

其他人有什么不同的吗？

有没有真正聪明的方法？

有谁知道图书馆是如何做到这一点的？

* * *

## 回答 #1

> 赞同：20
> 
>             
> 
> 时间：2009-01-14T13:46:11.883

您需要使用这个小闭包技巧 - 创建并执行一个返回事件处理函数的函数。

```
var links = [ 'one', 'two', 'three' ];

for( var i = 0; i < links.length; i++ ) {
    var a = document.createElement( 'div' );
    a.innerHTML = links[i];
    a.onclick = (function(i) { return function() { alert( i ) } })(i);
    document.body.appendChild( a );
} 
```

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-01-14T13:57:46.807

我会保留您自己的解决方案，但可以通过以下方式对其进行修改：

```
var links = [ 'one', 'two', 'three' ];

function handler() {
    alert( this.i );
}

for( var i = 0; i < links.length; i++ ) {
    var a = document.createElement( 'div' );
    a.innerHTML = links[i];
    a.i = i; //set a property of the current element with the current value of i
    a.onclick = handler;
    document.body.appendChild( a );
} 
```

这样，只会创建一个函数对象 - 否则，函数字面量将在每个迭代步骤中进行评估！

通过闭包的解决方案在性能方面比您的原始代码更差。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-01-14T14:15:53.557

我推荐使用[Christoph](https://stackoverflow.com/users/48015/)的一种方法[，](https://stackoverflow.com/questions/442985/#443035)因为它使用的资源更少。

下面是另一种将值存储在函数上的方法（这是可能的，因为函数是一个对象）和用户*argument.callee*以获取对函数内部函数的引用。在这种情况下，它没有多大意义，但我展示了该技术，因为它可以在其他方面有用：

```
var links = [ 'one', 'two', 'three' ];

for( var i = 0; i < links.length; i++ ) {
    var a = document.createElement( 'div' );
    a.innerHTML = links[i];
    a.onclick = function() { alert( arguments.callee.i ) }
    a.onclick.i = i;
    document.body.appendChild( a );
} 
```

当您的函数需要在调用之间存储持久信息时，该技术很有用。用这个替换上面的部分：

```
a.id="div"+i;
a.onclick = function() {
    var me = arguments.callee;
    me.count=(me.count|0) + 1;
    alert( me.i );
} 
```

并且您可以稍后检索它被调用的次数：

```
for( var i = 0; i < links.length; i++ ){
    alert(document.getElementById("div"+i).onclick.count);
} 
```

它还可以用于在调用之间缓存信息。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-01-15T00:29:13.957

RoBorg 的方法绝对是要走的路，但我喜欢稍微不同的语法。两者都完成了创建保留“i”的闭包的相同操作，这种语法对我来说更清楚，并且需要对现有代码的修改更少：

var links = ['一'，'二'，'三'];

```
for( var i = 0; i < links.length; i++ ) (function(i) {
    var a = document.createElement( 'div' );
    a.innerHTML = links[i];
    a.onclick = function() { alert( i ) }
    document.body.appendChild( a );
})(i); 
```

# c# - C#、IAsyncResult 和线程池

> ID：442991
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2009-01-14T13:44:51.667
> 
>         
> 
> 标签：c#, threadpool, iasyncresult

我用的`Action<object>.BeginInvoke()`方法，这个是用线程池还是不用线程池？

我有以下 C# 代码：

```
 List<FileHash> hashList1 = hashList.Where((x, ind) => ind % 2 == 0).ToList();
    List<FileHash> hashList2 = hashList.Where((x, ind) => ind % 2 == 1).ToList();

    Action<object> oddWork = CalcHash;
    Action<object> evenWork = CalcHash;

    IAsyncResult evenHandle = evenWork.BeginInvoke(hashList1, null, null);
    IAsyncResult oddHandle = oddWork.BeginInvoke(hashList2, null, null);

    evenWork.EndInvoke(evenHandle); 
    oddWork.EndInvoke(oddHandle); 
```

线程池是否在幕后使用？还是系统创建正常线程？

* * *

## 回答 #1

> 赞同：9
> 
>             
> 
> 时间：2009-01-14T13:55:46.450

是的，这项工作将发生在线程池中。MSDN 中的此页面深入介绍了 BeginInvoke 的工作原理：  

[http://msdn.microsoft.com/en-us/library/2e08f6yc.aspx](http://msdn.microsoft.com/en-us/library/2e08f6yc.aspx)

# c# - 如何在 WSE 3.0 中使用 DIME？

> ID：442994
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-01-14T13:45:03.103
> 
>         
> 
> 标签：c#, wcf, web-services, soap, mtom

我需要调用仅支持[DIME](http://msdn.microsoft.com/en-us/magazine/cc188797.aspx)的旧 SOAP API ，但 WSE 3.0 不支持 DIME。

不幸的是，支持 DIME 的 WSE 2.0 不支持与 Visual Studio 2005 结合使用。

[我理解迁移到MTOM](http://en.wikipedia.org/wiki/MTOM)的原因，但与遗留服务通信的需求并没有因为新标准的发布而消失。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-10-25T00:18:04.000

虽然您没有 VS 2005 支持，但您仍然可以完成这项工作。请记住，VS 是一个非常简单的工具，但您总是可以绕过它。我的建议是您下载 WSE 2.0 并找到包含 DIME 和您需要的其他库的程序集。然后从您的客户端添加对该程序集的引用，并将名称空间包含在您的文件中。下面的文章展示了如何编写客户端代码，而不是谈论 VS 支持：

[http://msdn.microsoft.com/en-us/library/ms996944.aspx](http://msdn.microsoft.com/en-us/library/ms996944.aspx)

请注意将配置文件设置为引用正确程序集的示例。您可能不得不尝试获得正确的参考资料和一些手动工作，但我相信这是可能的。

我第一次使用 DIME 是使用 MS 发布到 GotDotNet 的预览副本，该副本现已消失。我有上面类似的源代码和文章，但没有 IDE 支持并且让它工作得很好。

乔

# java - 如何配置 ActiveMQ 以将“匿名”用户和角色分配给未经身份验证的用户

> ID：442995
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-01-14T13:45:33.943
> 
>         
> 
> 标签：java, security, activemq, stomp

我希望设置一个 ActiveMQ 实例（主要作为 STOMP 服务器），它将为来自两种类型的客户端的请求提供服务：

1.  可以读取和写入主题的经过身份验证的用户

2.  只能从主题中读取的未经身份验证的用户

到目前为止，我一直在使用 SimpleAuthenticationBroker，无论如何我都看不到配置上述情况，也看不到代码中识别通配符以供用户通过身份验证的任何位。

如果我将服务器配置为使用身份验证代理，它将期望所有连接都进行身份验证，这是我不想要的。

我认为我能看到的唯一解决方案是提供我自己的实现来支持我需要的功能，但我很想找到一些内置到服务器中的方法。

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2010-12-14T12:18:14.967

此功能现在从 ActiveMQ 5.4 开始可用，正如我刚刚在搜索相同功能时发现的那样：http: [//activemq.apache.org/security.html](http://activemq.apache.org/security.html)

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-01-16T08:44:20.400

ActiveMQ 安全实现当前不支持此功能，但您始终可以定义一个无需密码即可连接且具有只读权限的用户。

您可以针对此未经身份验证的用户功能提出 Jira 增强请求 ( [https://issues.apache.org/activemq/browse/AMQ](https://issues.apache.org/activemq/browse/AMQ) )，并更好地为当前插件提供补丁。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2016-10-09T09:12:53.287

从 ActiveMQ 5.4 开始，您可以通过以下方式进行设置。找出

```
<plugins>
    ...
</plugins> 
```

文件中的部分`etc/activemq.xml`并对其进行编辑以包含 simpleAuthenticationPlugin，如下所示：

```
<simpleAuthenticationPlugin anonymousAccessAllowed="true" /> 
```

来源：[http ://activemq.apache.org/security.html](http://activemq.apache.org/security.html) 
```********************