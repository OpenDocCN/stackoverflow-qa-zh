# StackOverflow 问答 000380000-000380999

# delphi - 德尔福日期比较

> ID：380002
> 
> 赞同：3
> 
> 时间：2008-12-19T03:09:08.977
> 
> 标签：delphi, date

Delphi DateUtils 库中的“IsSameDay”和“SameDate”这两个函数有什么区别？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-19T04:10:55.577

第零天前一天的开始是`TDateTime(-1.0)`。那天中午是`TDateTime(-1.5)`。

```
IsSameDay(-1.5, -1); // False
SameDate(-1.5, -1); // True 
```

对于正日期，函数是等效的。

# c# - 子父控件中的绘制顺序（OnPaint / OnPaintBackground 事件）是什么？

> ID：380008
> 
> 赞同：2
> 
> 时间：2008-12-19T03:15:22.553
> 
> 标签：c#, .net, user-interface

使用 C# .NET Compact Framework 我正在创建一个 GUI 控件，其中包含和控制也是自定义控件的子项（即 System.Windows.Forms.UserControl）。孩子和父母都有自定义绘图例程（OnPaint）。为了更好地理解和优化绘图例程，我想澄清一下 .NET 下的绘图顺序。

(1) 当整个事物第一次显示时，以下事件的正确顺序是什么：

*   parent.OnPaintBackground

*   child.OnPaintBackground

*   父.OnPaint

*   child.OnPaint

(2) Control.Invalidate() 调用的顺序是否会影响 OnPaint / OnPaintBackground 事件的顺序？

(3) 如果子控件调用自己的child.Invalidate()，父控件是否也得到OnPaint / OnPaintBackground 事件？

(4) 系统如何确定哪个控件是哪个子控件的父控件，反之亦然？Control.Parent 是这种关系的唯一指示吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T03:49:50.127

这不是一个真正的答案，但您可以使用一些`Debug.Print()`语句并编写一个快速程序来自己测试 1-3。将订阅者添加到您感兴趣的事件并查看它们何时发生。然后按照您在 2-3 中的建议进行操作并更改`Invalidate()`调用顺序并观察。

就像我说的，不是答案，但肯定是发现答案的一种方式。

至于＃4，就像你暗示的那样，这种关系是双向的。您已经与`Control.Parent`(child->parent) 建立了一半的关系。另一半是`Control.Controls`集合（父->子）。根据我的理解，将关系视为一棵无序的大树。

# javascript - 浏览 OLAP 多维数据集

> ID：380011
> 
> 赞同：13
> 
> 时间：2008-12-19T03:16:30.320
> 
> 标签：javascript, database, widget, olap, cube

有人知道任何优秀的开源立方体浏览器吗？

理想情况下，它应该是用纯 JavaScript 构建的。

它甚至存在吗？

我打算将它与经典的 asp 和 SQL 数据库一起使用。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-19T03:50:22.280

您可以查看[Pentaho Mondrian](http://mondrian.pentaho.org/)（包括[JPivot](http://jpivot.sourceforge.net)）或[Eclipse BIRT](http://eclipse.org/birt)

有了这些，您可以在最流行的数据库上获得某种灵活的报告工具，它还包括浏览 OLAP 多维数据集的功能。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-10-19T19:34:38.953

如果你正在寻找轻量级的东西，试试[CubesViewer](https://github.com/jjmontesl/cubesviewer)：

它主要是 Javascript，由 Cubes OLAP 服务器支持。

*（免责声明，我是主要开发者:-)）*

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-05-04T02:58:25.770

查看[js-hypercube](http://code.google.com/p/js-hypercube/)以获取仅限 javascript 的 OLAP 库。API 非常简单。您可以将 json 反序列化为多维数据集对象、查询维度名称、切片多维数据集并对事实求和。从[文档](https://github.com/thesmart/js-hypercube/blob/master/README.md)中：

```
var data = [{"time":1331773202,"facts":{"name":"Super Mario Bros. 2","platform":"Nintendo","staring":"Mario"},"measures":{"rentals":73,"sales":9,"revenue":359.91}}, {"time":1331841602,"facts":{"name":"Metroid","platform":"Nintendo","staring":"Samus"},"measures":{"rentals":43,"sales":6,"revenue":239.94}}]; // ... etc
var cube = ps.Cube.deserialize(data, ['rentals', 'sales', 'revenue'])
console.info('Total Rentals', cube.sum().rentals);
console.info('Revenue at 6pm for Super Nintendo games', '$' + cube.slice({hour: 18, platform: 'Super Nintendo'}).sum(2).revenue);
console.info('Avg rentals per hour for games staring Mario', cube.slice({staring: 'Mario'}).avg(24, 2).rentals + ' units'); 
```

这是我使用它与backbone.js一起构建的一个示例：http: [//jsbin.com/rejekij/edit ?html,js,output](http://jsbin.com/rejekij/edit?html,js,output)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T12:57:27.800

还可以看看 PAT，它是 pentaho 对 JPivot 的替代品。（实际上是由社区开发的——而不是 pentaho 自己！）

JPivot 虽然可以完成这项工作，但有点笨拙。PAT 很新，所以不能保证它的稳定性和功能！

[http://code.google.com/p/pentahoanalysistool/](http://code.google.com/p/pentahoanalysistool/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-19T03:36:48.047

Adobe Flex 包含一个您可以使用的控件。您可以使用 javascript 作为语言（Flex 原生支持 Actionscript，而 javascript 是 Actionscrpt 的子集，也可以使用。）

[这是一个关于OLAPDataGrid](http://livedocs.adobe.com/flex/3/html/help.html?content=olapdatagrid_2.html)控件的网页。

这是[另一个链接](http://labs.adobe.com/wiki/index.php/Flex_3:Feature_Introductions:OLAP_API_and_OLAP_Data_Grid)。

Flex 应用程序可以托管在安装了 Flash 的浏览器中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-07T16:50:08.073

您可以在 flexmonster.com 上查看数据透视表组件。它通过 xmla 与 olap 多维数据集对话，并且与 olapdatagrid 不同，它不需要额外的数据准备。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-09-28T00:17:11.233

[WebPivotTable](http://webpivottable.com)是一个纯 javascript 数据透视表和数据透视图组件，可用于透视 csv 文件和各种 OLAP 立方体，如 Mondrian、SSAS、iccube。这是[演示](http://webpivottable.com/demo)和[文档](http://webpivottable.com/documents)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-19T05:15:31.360

如果可以的话，找到sql server 2000 Resource Kit，里面有一个项目是一个javascript cube browser。我不确定它的许可，但它位于资源工具包内的 TOOLSANDSAMPLES\ANALYSISSERVICESTHINWEBCLIENT。此资源工具包应在 msdn 订阅下载中提供。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-06-18T07:13:24.543

[Ranet Olap 组件库](https://galaktikasoft.com/ranet-olap/)已开放版本。虽然它不能完全满足您的要求（需要 Silverlight），但您应该检查一下。

# javascript - IE 中的 Ajax 异步 - 错误“完成此操作所需的数据尚不可用”

> ID：380014
> 
> 赞同：2
> 
> 时间：2008-12-19T03:20:34.943
> 
> 标签：javascript, ajax, internet-explorer, asynchronous, xmlhttprequest

我有一个用 Javascript 编写的 100% 有效的 Ajax 模型，其中包含我使用的一些输入，Get 或 Post 方法、要与之通信的页面、要发送到该页面的字符串以及我自己页面上的什么元素我可能会在什么时候摆弄我收到我的回复。问题是，如果我将请求设置为异步（因此是 Ajax），IE 在 onreadystatechange 事件中返回错误“完成此操作所需的数据尚不可用”，我所做的只是检查 readystate 是否为 4 和状态为 200。在 Firefox 或 Chrome 中不会出现错误，因为 Ajax 是异步的。

这是 Post 方法的一个片段

```
xmlhttp.open("POST", commPage, true);
xmlhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");
xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        j = xmlhttp.responseText;
        i.innerHTML = j;
    }
}
xmlhttp.send(str); 
```

编辑：我应该指出，在 IE 中，我使用的是 ActiveX Control -> Msxml2.XMLHTTP 或 Microsoft.XMLHTTP 或先返回 true 的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T03:34:46.087

嗬嗬

在 onreadystatechange 函数之外，我调用了 responsetext 来检查它是否存在，但是如果它还不存在，显然你不能这样做，所以我只需要重组一些东西。一切都很好，但这是导致问题的脚本

```
ajaxRequest(){
    [...]
}
if(xmlhttp.responseText){
    myFunc();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-12T14:27:47.617

Once I had that error, and i solve it configuring the timeouts! maybe you could try the same thing!

Cheers

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-10-06T22:25:20.423

不知道这是否是你的情况，但我一直在努力解决这个错误三个小时，直到我发现问题。Web 服务类没有用允许从客户端脚本调用方法的 ScriptService 属性装饰！我不会责怪 IE，因为 IE 对错误非常严格，并且会报告其他浏览器忽略的所有内容。IE 很适合调试。希望这可以帮助。嗯......可能不是你，因为你的帖子现在很老了。

# iphone - 赋值从没有强制转换的整数中生成指针

> ID：380024
> 
> 赞同：3
> 
> 时间：2008-12-19T03:26:40.020
> 
> 标签：iphone, c, objective-c, cocoa, cocoa-touch

我有一个与此类似的 Obj-C 方法：

```
-(void)getUserDefaults:(BOOL *)refreshDefaults
{
    PostAppDelegate *appDelegate = [[UIApplication sharedApplication] delegate];

    if (refreshDefaults) {
        [appDelegate retrieveDefaults];
    }
} 
```

当我这样称呼它时，我没有收到任何警告：

```
[self getUserDefaults:NO]; 
```

当我这样称呼它时，我会收到警告：

```
[self getUserDefaults:YES]; 
```

警告：传递 'getUserDefaults:' 的参数 1 使指针从整数而不进行强制转换

注意：我总是先调用传递 NO 的方法，然后稍后再传递 YES

谁能告诉我这里的问题是什么？谢谢。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-19T03:38:53.193

`BOOL`是原始类型，而不是类，因此您的方法声明应该是

```
-(void)getUserDefaults:(BOOL)refreshDefaults; 
```

反而。您收到警告的原因是`0`（`NO`定义为）是没有强制转换的有效指针值，相当于`NULL`，但`1`（`YES`定义为）不是有效的指针值没有演员表。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-19T03:39:26.203

getUserDefaults 采用 BOOL*。传递 NO 时不会收到警告，因为 NO 为 0，0 为 NULL，这是一个合法的 BOOL*。YES 为 1，相同的转换不会自动安全。

您应该让 getUserDefaults 采用普通的 BOOL，而不是指针。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-19T03:37:08.733

我以前从未见过 Obj-C 代码，但我很确定这是因为“refreshDefaults”是一个指向 BOOL 的指针，而它应该是一个 BOOL。

我不知道 Obj-C 中的打字规则，但看起来 NO 被定义为 0 并且编译器将其转换为指针值（NULL 指针）没有问题。整数不会出现这种情况1'。（另请注意“if (refreshDefaults)”是检查指针 refreshDefaults 与 NULL 指针的有效代码）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-19T03:44:46.910

酷谢谢！这是有道理的，并修复它！以下是更新的代码供参考：

```
-(void)getUserDefaults:(BOOL)refreshDefaults
{
PostAppDelegate *appDelegate = [[UIApplication sharedApplication] delegate];

if (refreshDefaults) {
    [appDelegate retrieveDefaults];
}
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-19T03:38:40.027

在第一种情况下，NO 可能默认为 0 - 空指针。这是一个有效的 Bool*。Yes 将默认为 1，因此当它转换为 Bool* 时，您将传入整数 1 - 然后将其转换为 Bool*。

# http - 使用 HttpWebRequest 部署 ClickOnce 应用程序

> ID：380030
> 
> 赞同：1
> 
> 时间：2008-12-19T03:31:07.247
> 
> 标签：http, clickonce, webrequest

我正在尝试使用带有 HttpWebRequest 类的 C# 代码启动我的 ClickOnce 应用程序。该应用程序可以使用 IE 很好地部署。但是当使用我的代码进行部署时，似乎只有 .application 文件被下载到客户端。

我的代码如下。

```
 HttpWebRequest getRequest = (HttpWebRequest)WebRequest.Create("http://localhost/test/test.application");
        getRequest.Method = "GET";
        getRequest.Timeout = 500000;                   //default is 100 seconds  

        HttpWebResponse getResponse = (HttpWebResponse)getRequest.GetResponse();
        string loginUrl = getResponse.ResponseUri.AbsoluteUri;
        StreamReader responseReader = new StreamReader(getResponse.GetResponseStream());
        string responseData = responseReader.ReadToEnd();
        responseReader.Close(); 
```

我的代码有什么问题吗？

谢谢！- 布鲁斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T03:48:39.803

我相信 IE 在看到 .application 文件时会做一些特别的事情。这就是为什么 ClickOnce 部署在 .NET 3.5 SP1 为其添加处理程序之前无法从 FireFox 工作的原因。所以你看到的是正确的行为——你的应用程序纯粹是把文件作为字节流拉下来——它不知道如何处理它。

如果您想以编程方式启动应用程序，我建议您这样做：

```
System.Diagnostics.Process.Start("http://localhost/test/test.application"); 
```

**更新**

[这里](http://blogs.msdn.com/saurabh/archive/2006/03/02/541988.aspx)有关于整个 ClickOnce/FireFox 的更多信息。显然，为 IE 安装了一个 MIME 类型的处理程序，它可以识别 application/-ms-application 类型并使用 ClickOnce 安装程序运行文件。可能值得查看一些在 .NET 3.5 SP1 之前启用此功能的旧 FireFox 附加组件，看看他们如何以编程方式启动 .application 文件。

# c# - 通过 SID 解析显示用户名的最佳方法？

> ID：380031
> 
> 赞同：11
> 
> 时间：2008-12-19T03:32:31.817
> 
> 标签：c#, windows, sid

我从注册表中读取了一个 SID 列表，`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList`.

给定 C# 中的 SID 字符串，如何解析显示用户名（例如`DOMAIN\user`， ）？`BUILT-IN\user`

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-12-19T05:59:02.240

刚刚在[pinvoke.net](http://www.pinvoke.net/default.aspx/advapi32.LookupAccountSid)上找到它。

替代托管 API：在 .Net 2.0 中可用：

```
using System.Security.Principal;

// convert the user sid to a domain\name
string account = new SecurityIdentifier(stringSid).Translate(typeof(NTAccount)).ToString(); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-19T03:46:04.597

Win32 API 函数[`LookupAccountSid()`](http://msdn.microsoft.com/en-us/library/windows/desktop/aa379166%28v=vs.85%29.aspx)用于查找与 SID 对应的名称。

`LookupAccountSid()`具有以下签名：

```
BOOL LookupAccountSid(LPCTSTR lpSystemName, PSID Sid,LPTSTR Name, LPDWORD cbName,
                       LPTSTR ReferencedDomainName, LPDWORD cbReferencedDomainName,
                       PSID_NAME_USE peUse); 
```

MSDN[参考](http://msdn.microsoft.com/en-us/library/aa379166(VS.85).aspx)。

这是 P/Invoke 参考（带有示例代码）：[http ://www.pinvoke.net/default.aspx/advapi32.LookupAccountSid](http://www.pinvoke.net/default.aspx/advapi32.LookupAccountSid)

```
[DllImport("advapi32.dll", CharSet=CharSet.Auto, SetLastError = true)]
static extern bool LookupAccountSid (
  string lpSystemName,
  [MarshalAs(UnmanagedType.LPArray)] byte[] Sid,
  StringBuilder lpName,
  ref uint cchName,
  StringBuilder ReferencedDomainName,
  ref uint cchReferencedDomainName,
  out SID_NAME_USE peUse); 
```

# css - 选择元素上的 IE6/IE7 CSS 边框

> ID：380037
> 
> 赞同：31
> 
> 时间：2008-12-19T03:38:29.993
> 
> 标签：css, internet-explorer, internet-explorer-6, internet-explorer-7, cross-browser

有没有人有一个解决方案来使用 CSS 在 Internet Explorer 中设置“选择”元素的边框？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-12-19T03:58:42.433

据我所知，这在 IE 中是不可能的，因为它使用了操作系统组件。

这是替换控件的[链接](http://v2.easy-designs.net/articles/replaceSelect/)，但我不知道这是否是您想要做的。

## **编辑：链接已损坏，我正在转储内容**

# `<select>`新事物，第 1 部分

### 亚伦·古斯塔夫森

因此，您已经利用最新最好的 CSS 技术构建了一个美观、符合标准的网站。你已经掌握了对每个元素的样式的控制，但在你的脑海里，一个小声音在唠叨你的 `<select>`s 有多丑。好吧，今天我们将探索一种方法来消除这种微小的声音并真正完成我们的设计。使用一点 DOM 脚本和一些创造性的 CSS，您也可以使您`<select>`的 s 变得漂亮……而且您不必牺牲可访问性、可用性或优雅的降级。

## 问题

我们都知道这`<select>`只是简单的丑陋。事实上，许多人试图限制它的使用以避免其经典的 web 大约 1994 插图边框。我们不应该避免使用`<select>`虽然——它是当前表单工具集的重要组成部分；我们应该接受它。也就是说，一些创造性的思维可以改善它。

## 这`<select>`

我们将使用一个简单的示例：

```
<select id="something" name="something">
  <option value="1">This is option 1</option>
  <option value="2">This is option 2</option>
  <option value="3">This is option 3</option>
  <option value="4">This is option 4</option>
  <option value="5">This is option 5</option>
</select> 
```

[注：暗示这`<select>`是在完整表格的上下文中。]

所以我们`<option>`在 a 中有五个 s `<select>`。这`<select>`具有唯一分配`id`的“某物”。根据您正在查看的浏览器/平台，您`<select>`可能看起来大致如下：

[![在 Windows XP/Firefox 1.0.2 中呈现的 <select>。](https://i.stack.imgur.com/1e0UO.png)](https://i.stack.imgur.com/1e0UO.png)
[（来源：[easy-designs.net](http://v2.easy-designs.net/articles/replaceSelect/images/ffSelect.png)）]

或这个

[![在 Mac OSX/Safari 1.2 中呈现的 <select>。](https://i.stack.imgur.com/ztXwS.png)](https://i.stack.imgur.com/ztXwS.png)
[（来源：[easy-designs.net](http://v2.easy-designs.net/articles/replaceSelect/images/safariSelect.png)）]

假设我们想让它看起来更现代一点，可能是这样的：

[![我们对样式精美的 <select> 的概念。](https://i.stack.imgur.com/PItFf.png)](https://i.stack.imgur.com/PItFf.png)
[（来源：[easy-designs.net](http://v2.easy-designs.net/articles/replaceSelect/images/desiredSelect.png)）]

那么我们该怎么做呢？保持基本`<select>`不是一种选择。除了基本的背景颜色、字体和颜色调整之外，您对 .

`<select>`但是，我们可以在不牺牲语义、可用性或可访问性的情况下模仿新表单控件的卓越功能。为了做到这一点，我们需要检查 a 的性质`<select>`。

A`<select>`本质上是一个无序列表的选项，您可以在其中选择一个值与表单的其余部分一起提交。所以，从本质上讲，它是一种`<ul>`类固醇。继续这种思路，我们可以用`<select>`无序列表替换 ，只要我们给它一些增强的功能。由于`<ul>`s 可以有多种不同的样式，我们几乎可以自由自在了。现在问题变成了“如何确保我们`<select>`在使用时保持功能`<ul>`？” 换句话说，如果我们不再使用表单控件，我们如何将正确的值与表单一起提交？

## 解决方案

输入 DOM。这个过程的最后一步是让`<ul>` 函数/感觉像一个`<select>`，我们可以使用 JavaScript/ECMA 脚本和一些聪明的 CSS 来完成。以下是我们需要具有功能性人造物的基本要求列表`<select>`：

*   点击列表打开它，
*   单击列表项以更改分配的值并关闭列表，
*   未选择任何内容时显示默认值，并且
*   选择某些内容时显示所选列表项。

有了这个计划，我们就可以开始依次处理每个部分。

### 建立清单

所以首先我们需要收集所有的属性和 s 并将其重建为 . 我们通过运行以下 JS 来实现这一点：

```
function selectReplacement(obj) {
  var ul = document.createElement('ul');
  ul.className = 'selectReplacement';
  // collect our object's options
  var opts = obj.options;
  // iterate through them, creating <li>s
  for (var i=0; i<opts.length; i++) {
    var li = document.createElement('li');
    var txt = document.createTextNode(opts[i].text);
    li.appendChild(txt);
    ul.appendChild(li);
  }
  // add the ul to the form
  obj.parentNode.appendChild(ul);
} 
```

您可能会想“现在如果`<option>` 已经选择了会发生什么？” 我们可以通过在创建 `<li>`s 以查找 selected之前添加另一个循环来解决此问题`<option>`，然后将该值存储为`class`我们 selected`<li>`为“selected”：

```
…
  var opts = obj.options;
  // check for the selected option (default to the first option)
  for (var i=0; i<opts.length; i++) {
    var selectedOpt;
    if (opts[i].selected) {
      selectedOpt = i;
      break; // we found the selected option, leave the loop
    } else {
      selectedOpt = 0;
    }
  }
  for (var i=0; i<opts.length; i++) {
    var li = document.createElement('li');
    var txt = document.createTextNode(opts[i].text);
    li.appendChild(txt);
    if (i == selectedOpt) {
      li.className = 'selected';
    }
    ul.appendChild(li);
… 
```

[注意：从这里开始，将选择选项 5，以演示此功能。]

现在，我们可以`<select>`在页面上的每个（在我们的例子中，一个）上运行这个函数，如下所示：

```
function setForm() {
  var s = document.getElementsByTagName('select');
  for (var i=0; i<s.length; i++) {
    selectReplacement(s[i]);
  }
}
window.onload = function() {
  setForm();
} 
```

我们快到了；让我们添加一些样式。

### 一些聪明的 CSS

我不了解你，但我是 CSS 下拉菜单的忠实粉丝（尤其是 [Suckerfish](http://htmldog.com/articles/suckerfish/)种类）。我已经和他们一起工作了一段时间，我终于意识到 a `<select>`很像一个下拉菜单，尽管在引擎盖下还有更多的事情要做。为什么不对我们的仿制品应用同样的风格理论`<select>`呢？基本风格是这样的：

```
ul.selectReplacement {
  margin: 0;
  padding: 0;
  height: 1.65em;
  width: 300px;
}
ul.selectReplacement li {
  background: #cf5a5a;
  color: #fff;
  cursor: pointer;
  display: none;
  font-size: 11px;
  line-height: 1.7em;
  list-style: none;
  margin: 0;
  padding: 1px 12px;
  width: 276px;
}
ul.selectOpen li {
  display: block;
}
ul.selectOpen li:hover {
  background: #9e0000;
  color: #fff;
} 
```

现在，要处理“选定”列表项，我们需要更巧妙一些：

```
ul.selectOpen li {
  display: block;
}
ul.selectReplacement li.selected {
  color: #fff;
  display: block;
}
ul.selectOpen li.selected {
  background: #9e0000;
  display: block;
}
ul.selectOpen li:hover,
ul.selectOpen li.selected:hover {
  background: #9e0000;
  color: #fff;
} 
```

请注意，我们没有使用 :hover 伪类`<ul>`来使其打开，而是将`class`其作为“selectOpen”。这样做的原因有两个：

1.  CSS 是为了展示，而不是行为；和
2.  我们希望我们的虚假`<select>`行为像真实的一样`<select>`，我们需要在`onclick`事件中打开列表，而不是在简单的鼠标悬停时打开。

为了实现这一点，我们可以将我们从 Suckerfish 中学到的知识应用到我们自己的 JavaScript中，方法是`class`在“onclick onclick `events for the list items. To do this right, we will need the ability to change the`”事件中为每个列表项动态分配和删除它，以便在以下两个操作之间切换：

1.  `<select>`在列表折叠时单击选定/默认选项时显示完整的仿制品；和
2.  单击并折叠虚假时“选择”列表项`<select>`。

我们将创建一个调用函数`selectMe()`来处理“选定”的`class`重新分配、`onclick`列表项的事件的重新分配以及 faux- 的折叠`<select>`：

正如最初的 Suckerfish 告诉我们的那样，IE 不会识别除 之外的任何东西上的悬停状态`<a>`，因此我们需要通过使用我们从它们中学到的东西来扩充我们的一些代码来解决这个问题。我们可以将 onmouseover 和 onmouseout 事件附加到“selectReplacement” `class`-ed`<ul>`及其 `<li>`s：

```
function selectReplacement(obj) {
  …
  // create list for styling
  var ul = document.createElement('ul');
  ul.className = 'selectReplacement';
  if (window.attachEvent) {
    ul.onmouseover = function() {
      ul.className += ' selHover';
    }
    ul.onmouseout = function() {
      ul.className = 
        ul.className.replace(new RegExp(" selHover\\b"), '');
    }
  }
  …
  for (var i=0; i<opts.length; i++) {
    …
    if (i == selectedOpt) {
      li.className = 'selected';
    }
    if (window.attachEvent) {
      li.onmouseover = function() {
        this.className += ' selHover';
      }
      li.onmouseout = function() {
        this.className = 
          this.className.replace(new RegExp(" selHover\\b"), '');
      }
    }
  ul.appendChild(li);
} 
```

然后，我们可以修改 CSS 中的一些选择器，来处理 IE 的悬停：

```
ul.selectReplacement:hover li,
ul.selectOpen li {
  display: block;
}
ul.selectReplacement li.selected {
  color: #fff;
  display: block;
}
ul.selectReplacement:hover li.selected**,
ul.selectOpen li.selected** {
  background: #9e0000;
  display: block;
}
ul.selectReplacement li:hover,
ul.selectReplacement li.selectOpen,
ul.selectReplacement li.selected:hover {
  background: #9e0000;
  color: #fff;
  cursor: pointer;
} 
```

现在我们有一个列表，其行为类似于`<select>`; 但是我们仍然需要一种方法来更改选定的列表项并更新相关表单元素的值。

### JavaScript 富

我们已经有一个“选择的” `class`，我们可以将其应用到我们选择的列表项，但是我们需要一种方法来在`<li>`单击它时将其应用到 a 并将其从任何先前“选择”的兄弟姐妹中删除。这是完成此操作的 JS：

```
function selectMe(obj) {
  // get the <li>'s siblings
  var lis = obj.parentNode.getElementsByTagName('li');
  // loop through
  for (var i=0; i<lis.length; i++) {
    // not the selected <li>, remove selected class
    if (lis[i] != obj) {
      lis[i].className='';
    } else { // our selected <li>, add selected class
      lis[i].className='selected';
    }
  }
} 
```

[注意：我们可以使用简单的`className`赋值和清空，因为我们完全控制了`<li>`s. 如果您（出于某种原因）需要为列表项分配其他类，我建议修改代码以将“选定”类附加和删除到您的`className`属性中。]

最后，我们添加一个小函数来设置单击an时原始值`<select>` （将与表单一起提交）`<li>`：

```
function setVal(objID, selIndex) {
  var obj = document.getElementById(objID);
  obj.selectedIndex = selIndex;
} 
```

然后我们可以将这些函数添加到 s 的`onclick`事件中`<li>`：

```
…
  for (var i=0; i<opts.length; i++) {
    var li = document.createElement('li');
    var txt = document.createTextNode(opts[i].text);
    li.appendChild(txt);
    li.selIndex = opts[i].index;
    li.selectID = obj.id;
    li.onclick = function() {
      setVal(this.selectID, this.selIndex);
      selectMe(this);
    }
    if (i == selectedOpt) {
      li.className = 'selected';
    }
    ul.appendChild(li);
  }
… 
```

你有它。我们创建了我们的函数式仿`. As we have not hidden the original``yet, we can [watch how it behaves](files/4.html) as we choose different options from our faux-``. Of course, in the final version, we don't want the original` `to show, so we can hide it by`类，将其“替换”为“替换”，将其添加到此处的 JS 中：

```
function selectReplacement(obj) {
  // append a class to the select
  obj.className += ' replaced';
  // create list for styling
  var ul = document.createElement('ul');
… 
```

然后，添加一个新的 CSS 规则来隐藏

```
select.replaced {
  display: none;
} 
```

应用几张图片来完成设计（链接不可用），我们很高兴！

* * *

这是另一个[链接](http://csscreator.com/node/25166)到有人说它无法完成。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2010-07-16T14:38:28.893

推断它！:)

```
 filter: 
    progid:DXImageTransform.Microsoft.dropshadow(OffX=-1, OffY=0,color=#FF0000)
    progid:DXImageTransform.Microsoft.dropshadow(OffX=1, OffY=0,color=#FF0000)
    progid:DXImageTransform.Microsoft.dropshadow(OffX=0, OffY=-1,color=#FF0000)
    progid:DXImageTransform.Microsoft.dropshadow(OffX=0, OffY=1,color=#FF0000); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-19T21:11:29.147

从我的个人体验中，我们在选择无效的条目时，我们尝试将边框红色放置在哪里，因此无法在IE中将边框红色放在IE中。

如前所述，Internet Explorer 中的 ocntrols 使用 WindowsAPI 进行绘制和渲染，而您没有什么可以解决的。

我们的解决方案是将选择元素的背景颜色设置为浅红色（以便文本可读）。背景颜色在每个浏览器中都有效，但在 IE 中我们有一个副作用，即元素的背景颜色与选择相同。

所以总结一下我们提出的解决方案：

```
select
{
  background-color:light-red;
  border: 2px solid red;
}
option
{
  background-color:white;
} 
```

请注意，颜色是用十六进制代码设置的，我只是不记得是哪个。

除了 IE 中的红色边框外，该解决方案在每个浏览器中都为我们提供了想要的效果。

祝你好运

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-04-05T23:40:38.120

我在使用 ie 时遇到了同样的问题，然后我插入了这个元标记，它允许我在 ie 中编辑边框

```
<meta http-equiv="X-UA-Compatible" content="IE=100" > 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-19T20:47:05.873

仅使用 css 是不可能的。事实上，仅使用 css 无法自定义所有表单元素以在所有浏览器上以相同的方式查看。你可以试试[niceforms](http://www.emblematiq.com/projects/niceforms/) ;)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-16T13:11:35.413

看看这段代码......希望你开心:)

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>Untitled Document</title>
<style type="text/css">
<style type="text/css">
*{margin:0;padding:0;}
select {font: normal 13px Arial, SansSerif, Verdana; color: black;}
.wrapper{width:198px; position: relative;  height: 20px; overflow: hidden; border-top:1px solid #dddddd; border-left:1px solid #dddddd;}
.Select{color: black; background: #fff;position: absolute; width: 200px; top: -2px; left: -2px;}
optgroup{background-color:#0099CC;color:#ffffff;}
</style>
</head>

<body>
<div class="wrapper">
<select class="Select">
<optgroup label="WebDevelopment"></optgroup>
<option>ASP</option>
<option>PHP</option>
<option>ColdFusion</option>
<optgroup label="Web Design"></optgroup>
<option>Adobe Photoshop</option>
<option>DreamWeaver</option>
<option>CSS</option>
<option>Adobe Flash</option>
</select>
</div>
</body>
</html> 
```

萨杰

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-16T13:15:58.290

IE < 8 不会呈现下拉列表本身，它只是使用无法以这种方式设置样式的 windows 控件。从 IE 8 开始，这种情况发生了变化，现在应用了样式。当然，它的市场份额还微不足道。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-16T14:52:28.687

我已经解决了无法在 IE7 中的选择上放置边框的问题（兼容模式下的 IE8）

通过给它一个边框和一个填充，它看起来像......

不是一切，但它的开始......

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-05-09T08:09:43.467

border-style 属性是一个简写命令，用于定义 html 元素所有边的边框样式。每一面都可以有不同的风格。

[http://www.handycss.com/tips/styling-borders-with-css/](http://www.handycss.com/tips/styling-borders-with-css/)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-19T04:02:14.003

您需要使用 CSS 和 JavaScript 定制设计的选择框。如果用户禁用了 JavaScript，您需要绝对确保它完全降级为标准选择元素。

IMO，这不值得努力。坚持选择中的字体样式，使其接近您网站的设计；将边框等留给盒子元素。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-02-27T18:08:23.330

出于我的目的，它为我解决了：

```
.select-container {
  position:relative;
  width:200px;
  height:18px;
  overflow:hidden;
  border:1px solid white !important
}
.select-container select {
  position:relative;
  left:-2px;
  top:-2px
} 
```

要放置更多样式，则需要使用嵌套 div。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-05-18T22:11:46.577

要在 IE 中沿选择的一侧设置边框，请使用 IE 的过滤器：

select.required { 左边框：2px 纯红色；过滤器： progid:DXImageTransform.Microsoft.dropshadow(OffX=-2, OffY=0,color=#FF0000) }

我只在我所有输入的一侧设置了所需状态的边框。

可能有一种效果可以更好地实现全方位边界...

[http://msdn.microsoft.com/en-us/library/ms532853(v=VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms532853(v=VS.85).aspx)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-01-16T22:10:38.270

只需在 html 标签之前添加一个 doctype 声明

前任。：`<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/strict.dtd">`

它也可以在 JSP 文件中工作。欲了解更多信息： [HTML Doctype 声明](http://www.w3schools.com/tags/tag_doctype.asp)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-03-09T16:38:53.670

有用！！！使用以下代码：

```
<style>
div.select-container{
   border: 1px black;width:200px;
}
</style>

<div id="status" class="select-container">
    <select name="status">
        <option value="" >Please Select...</option>
        <option value="option1">Option 1</option>
        <option value="option2">Option 2</option>
    </select>
</div> 
```

# asp.net - 停止执行 ASP.NET 应用程序

> ID：380043
> 
> 赞同：3
> 
> 时间：2008-12-19T03:41:42.390
> 
> 标签：asp.net, application-start

在我的 Application_Start() 方法中，当某些条件不满足时，如何停止 ASP.NET 应用程序的执行？

抛出异常似乎不起作用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T03:54:27.200

我认为这是不可能的；即使您可以“中止”启动，下次尝试从该站点访问 URL 也会尝试再次启动它

也许可以使用静态变量来表示 go/no-go，而 begin_request 可以重定向到占位符页面？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T04:44:17.693

似乎有一个可用于 IIS 管理的[COM API 。](http://msdn.microsoft.com/en-us/library/ms524713.aspx)不过，我想我会先尝试 Environment.Exit() 。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T03:49:22.453

做一些引发未处理错误的事情。也许抛出异常就足够了。

# java - 如何将 OOP 原则最好地应用于游戏和其他输入驱动的 GUI 应用程序？

> ID：380046
> 
> 赞同：2
> 
> 时间：2008-12-19T03:45:53.973
> 
> 标签：java, model-view-controller, language-agnostic, oop

每当我尝试编写图形程序（无论是游戏还是任何 GUI 应用程序）时，我总是会遇到一个或两个具有太多方法（以及长方法）的上帝类，并且每个类都有太多的责任。我在计算和逻辑的同时完成了图形，我觉得这是组织代码的一种非常糟糕的方式。我想更好地组织我的代码并将职责抽象到不同的类。这是我想从哪里开始的一个例子——我想写一个扫雷克隆，只是作为一种练习，并试图提高我的软件工程技能。我将如何做这个漂亮和面向对象的？为了便于讨论，假设我正在使用 Java（因为我可能会使用 Java 或 C#）。这里'

*   每个图块都应该从 JButton 或 JComponent 继承并自己处理绘图吗？
*   还是应该将图块存储为一些非图形 MinesweeperTile 对象和其他一些类处理绘制它们？
*   8 段显示倒数计时器（至少在 Vista 之前）是一个单独的类来处理绘图本身吗？
*   当用户单击时，图块是否具有鼠标事件侦听器，或者其他一些碰撞检测方法是否循环通过图块并检查每个以查看它是否被击中？

我意识到编写 GUI 应用程序的方法不止一种，我可以开始做哪些非常基本的事情来使我的代码更有条理、更易于管理、面向对象，并且总的来说可以编写更好的程序？

* * *

编辑：我想我应该补充一点，我对 MVC 很熟悉，我原本打算将其纳入我的问题中，但我想如果这不一定是我需要的，我不想将自己硬塞进 MVC 中。我确实使用 GUI 应用程序搜索了有关 MVC 的主题，但并没有真正找到任何可以回答我的特定问题的内容。

* * *

编辑2：感谢所有回答的人。我希望我能接受多个答案..

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-19T04:31:25.380

这是一个简单（但有效）的 OO 设计，可以帮助您入门：

首先创建一个纯 Java/C# 代码的游戏对象。没有 UI 或任何其他特定于平台的东西。Game 对象处理一个 Board 对象和一个 Player 对象。Board 对象管理许多 Tile 对象（地雷所在的位置）。Player 对象跟踪“回合数”、“分数”等。您还需要一个 Timer 对象来跟踪游戏时间。

然后创建一个单独的 UI 对象，它对 Game 对象一无所知。它完全独立且完全依赖于平台。它有自己的 UIBoard、UITile、UITimer 等，并且可以被告知如何更改其状态。UI 对象负责用户界面（输出到屏幕/声音和来自用户的输入）。

最后，添加从 UI 对象读取输入的顶级 Application 对象，根据输入告诉 Game 要做什么，由 Game 通知状态更改，然后转身告诉 UI 如何更新自身。

这（顺便说一句）是对 MVP（模型、视图、演示者）模式的改编。而且（顺便说一句）MVP 模式实际上只是 Mediator 模式的一个特化。而且（顺便说一句）MVP 模式基本上是 MVC（模型、视图、控制）模式，其中视图无法访问模型。恕我直言，这是一个很大的改进。

玩得开心！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-19T03:49:33.700

使用 MVC 框架为您处理所有艰苦的组织工作。SO上有大量的MVC框架主题。

使用别人写的高质量的东西可能会更快地教你——你会走得更远，看到更多的模式，而头痛更少。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-19T04:17:22.023

我并不是说这是唯一的方法，但我建议如下。其他人，请随时对此发表评论并进行更正。

*   每个图块都应该从某些东西继承并自己处理绘图。按钮似乎是最好的解决方案，因为它已经内置了按钮绘制功能（按下、未按下等）。
*   每个图块也应该知道它的邻居。您将有八个指向其八个邻居中的每一个的指针，如果没有邻居，当然将它们设置为 null。当它开始绘图时，它会查询每个邻居的`IsMine()`函数并显示计数。
*   如果它的邻居都不是地雷，那么它将递归到每个邻居的`Reveal()`方法中。
*   对于 7 段显示，每个数字都是它自己的处理绘图的类。然后我会创建一个`CountdownSegmentDigit`继承自该类但具有附加功能的类，即`CountDown()`、`Set()`和`Reset()`方法，以及一个`HitZero`事件。然后显示计时器本身就是这些数字的集合，连接起来向左传播零。然后`Timer`在计时器类中有一个每秒滴答一次并倒计时最右边的数字。
*   当用户点击时，见上图。tile 本身将处理鼠标单击（毕竟它是一个按钮）并调用它的`Reveal()`方法。如果它是一个地雷，它将触发`MineExploded`您的主窗体将监听的事件。

对我来说，当我想到如何封装对象时，将其想象为物理部件的制造过程会有所帮助。问问自己，“我如何设计这个系统，以便最有效地构建和重用它？” 还要考虑未来重用的可能性。请记住，组装过程需要小块并将它们构建成越来越大的块，直到构建整个对象。每个位应尽可能独立并处理自己的逻辑，但在必要时能够与外界对话。

拿 7 段显示位来说，你以后可以有另一个用途，它不会倒计时。假设您想要在汽车或其他东西上安装车速表。您已经有了可以连接在一起的数字。（想想硬件：库存的 7 段显示器，除了点亮之外什么都不做。然后你将控制器连接到它们上，它们就会获得功能。）

事实上，如果你足够努力地思考，你可能会发现你也想要`CountUp()`功能。还有一个事件参数`HitZero`来判断是向上还是向下计数。但是您可以等到稍后在需要时添加此功能。这就是继承的亮点：为您继承`CountDownDigit`并制作`CountUpOrDownDigit`.

考虑我如何在硬件中设计它，您可能想要设计每个数字，以便它了解其邻居并在适当时向上或向下计数。让他们记住一个最大值（记住，60 秒到一分钟，而不是 100），所以当他们翻到 0 时，他们会适当地重置。有一个充满可能性的世界。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-19T13:46:14.240

图形用户界面的核心关注点是处理事件。用户执行 X 并且您需要响应或不响应它。游戏具有额外的复杂性，因为它需要实时更改状态。在很多情况下，它通过将当前状态转换为新状态并告诉 UI 显示结果来实现这一点。它在很短的时间内完成此操作。

你从一个模型开始。代表用户想要操作的数据的类的集合。这可能代表一个企业的帐户或一个未知世界的广阔边界。

UI 从定义一系列表单或屏幕开始。这个想法是为每个表单或屏幕创建一个界面，定义 UI 控制器将如何与之交互。通常，每个表单或屏幕都有一个 UI 控制器类。

表单将事件传递给 UI 控制器。UI 控制器然后决定执行哪个命令。这最好通过命令设计模式来完成，其中每个命令都是它自己的类。

然后执行命令并操作模型。该命令然后告诉 UI 控制器屏幕或屏幕的一部分需要重绘。UI 控件然后查看模型中的数据并使用屏幕界面重绘屏幕。

通过将所有表单和屏幕放在界面后面，您可以删除您拥有的内容并放入不同的内容。这包括甚至根本没有任何表单，而是模拟对象。这有利于自动化测试。只要某些东西正确地实现了屏幕界面，软件的其余部分就会很高兴。

最后，一个必须实时运行的游戏将有一个（或多个）循环运行，它将不断改变游戏的状态。它将使用 UI 控制器重绘它更新的内容。命令将在模型中插入或更改信息。下次循环出现时，将使用新信息。例如，改变在空中传播的物体的矢量。

我不喜欢 MVC 架构，因为我觉得它不能很好地处理 GUI 的问题。我更喜欢使用监督控制器，您可以在[此处](http://martinfowler.com/eaaDev/SupervisingPresenter.html)阅读。原因是我相信自动化测试是你拥有的最重要的工具之一。您可以自动化的越多，您的生活就越好。监督演示者模式使表单成为一个薄壳，因此很少有不能自动测试的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T03:57:10.020

很抱歉这么说，但你似乎脑子里一团糟，试图一步一步改进你的编码。

没有办法这样回答你的问题，但我们开始吧。

首先从 OOP 开始，想想你的游戏/GUI 需要哪些对象，然后开始一点一点地实现它们，看看是否有机会进一步分解这些对象，或者可能重新组合一些本身没有意义的对象，然后尝试弄清楚您的对象之间是否有重复的功能，如果有，请弄清楚这个重复的功能是否是一个（或多个）基类。

现在这将需要你几天或几周的时间才能真正理解它，然后担心划分你的逻辑和渲染。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-19T06:23:41.550

我有一些用 C# 编写的教程。它讨论了同样的话题。这是 RogueLike 游戏的起点。

[C# 中的面向对象设计转换传统游戏](https://web.archive.org/web/20090530080356/http://www.cgempire.com/forum/tutorials-101/object-oriented-design-c-converting-legacy-game-4081.html)

[面向对象设计：领域类型对象](https://web.archive.org/web/20090530102916/http://www.cgempire.com/forum/tutorials-101/object-oriented-design-domain-type-objects-4084.html)

[面向对象设计：重新思考设计问题](https://web.archive.org/web/20090530102937/http://www.cgempire.com/forum/tutorials-101/object-oriented-design-rethinking-design-issues-4085.html)

[BROKEN LINK - 面向对象设计：验收测试中的小步骤](http://www.cgempire.com/forum/tutorials-101/object-oriented-design-baby-steps-acceptance-testing-4096.html)

# php - 如何让 SSL+mod_rewrite+Zend Framework MVC 一起工作？

> ID：380050
> 
> 赞同：2
> 
> 时间：2008-12-19T03:47:07.840
> 
> 标签：php, zend-framework, mod-rewrite, ssl

因此，我获得了 ZF MVC 站点，并希望在 /checkout/ 下的所有内容上强制 SSL 连接，我尝试为此使用 mod_rewrite，所以我的 .htaccess 看起来像这样：

```
RewriteEngine on
RewriteRule (\/checkout.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R] 
RewriteRule !\.(js|ico|gif|jpg|png|css|swf|xml|avi|flv|mov|mp3|wav)$ index.php [L] 
```

果然，它确实启动了 SSL，但第二条规则是 ZF 特定的，并将所有内容重定向到 index.php 排序擦除协议规范。

不幸的是，我对 mod_rewrite 的熟练程度非常糟糕。也许有人可以帮我解决这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-03T05:02:31.267

蒂姆莱特尔的答案大多在那里。

我会在检查 HTTPS 时将其更改为更严格一些，并且标志需要一个分隔符。

```
RewriteCond %{HTTPS} !^on$
RewriteRule ^/checkout/? https://%{HTTP_HOST}%{REQUEST_URI} [R,L] 

RewriteRule !\.(js|ico|gif|jpg|png|css|swf|xml|avi|flv|mov|mp3|wav)$ index.php [L] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T17:31:19.590

这可能会对您有所帮助，添加 RewriteCond 以仅在连接不是 SSL 时应用，然后将“L”选项添加到您的重定向规则中，以便重写处理在该点停止（因此最后一条规则不会覆盖 SSL 重定向）。

```
RewriteCond %{HTTPS} !on
RewriteRule (\/checkout.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [RL] 

RewriteRule !\.(js|ico|gif|jpg|png|css|swf|xml|avi|flv|mov|mp3|wav)$ index.php [L] 
```

# sql - MSMQ v 数据库表

> ID：380052
> 
> 赞同：23
> 
> 时间：2008-12-19T03:48:52.360
> 
> 标签：sql, msmq, message-queue

现有流程响应用户输入更改表中预订记录的状态字段。

我还有另一个进程要编写，它将为具有特定状态的记录异步运行。它将读取表记录，执行一些操作（包括调用第三方 Web 服务），并更新记录的状态字段以指示处理已完成（或 In Error，带有错误计数）。

这个操作听起来很像队列。在这种情况下，使用 MSMQ 而不是 SQL 表的好处和权衡是什么，我为什么要选择一个而不是另一个？

是我们的软件在表中添加和更新记录。

这是一项将执行异步处理的新工作（Windows 服务）。这需要“永远在线”。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-19T04:07:32.713

有几个原因，在 Fog Creek 论坛上进行了讨论：http: [//discuss.fogcreek.com/joelonsoftware5/default.asp ?cmd=show&ixPost=173704&ixReplies=5](http://discuss.fogcreek.com/joelonsoftware5/default.asp?cmd=show&ixPost=173704&ixReplies=5)

主要好处是，当计算机之间存在间歇性连接时（使用本地计算机上的存储和转发机制），仍然可以使用 MSMQ。就应用程序而言，它会将消息传递给 MSMQ，即使 MSMQ 稍后可能会传递消息。

只有当您可以连接到数据库时，您才能将记录插入到表中。

当需要工作流方法时，表方法更好，并且流程将经过各个阶段，并且这些阶段需要在数据库中持久化。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-21T20:14:42.863

如果创建预订记录的速度很低，我会让第二个过程定期检查表中是否有新预订。

除非您已经在使用 MSMQ，否则引入它只会为您提供额外的平台组件来支持。

如果数据库负载很重，或者您在两个进程读取和写入预订表的同一区域时遇到大量锁争用，那么请考虑引入 MSMQ。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-21T19:57:28.470

我也喜欢[之前讨论中](https://stackoverflow.com/questions/255794/queues-against-tables-in-messaging-systems)[le dorfier](https://stackoverflow.com/users/31641/le-dorfier)的回答：

> 我首先使用了表，然后在（如果）有原因时重构为一个成熟的 msg 队列 - 如果您的设计合理，这将是微不足道的。

谢谢大家，所有的答案。最有帮助。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-19T05:30:56.007

使用 MSMQ，您还可以通过将队列的位置更改到另一台机器而不是 db 服务器来轻松地将工作卸载到另一台服务器。

顺便说一句，从 SQL Server 2005 开始，数据库中内置了队列。它称为 SQL 服务器服务代理。请参阅：http: [//msdn.microsoft.com/en-us/library/ms345108.aspx](http://msdn.microsoft.com/en-us/library/ms345108.aspx)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-19T04:30:51.090

另见[前面的讨论](https://stackoverflow.com/questions/255794/queues-against-tables-in-messaging-systems)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-19T06:10:49.017

如果您有 MSMQ 专业知识，这是一个不错的选择。如果您了解数据库但不了解 MSMQ，请问自己是否想成为另一项技术的专家；您的申请是否是关键申请；当出现问题时，您更愿意调试它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-10-03T10:57:21.830

我最近一直在自己调查这个问题，所以想提一下我的发现。与您的应用程序相比，数据库的位置是决定哪个选项更快的一个重要因素。

我测试了插入插入 100 个数据库条目所花费的时间与将完全相同的数据记录到本地 MSMQ 消息中的时间。然后我取了几次执行这个测试的结果的平均值。

我发现当数据库在本地网络上时，插入一行比登录到 MSMQ 快 4 倍。

当通过良好的 Internet 连接访问数据库时，向数据库中插入一行比登录到 MSMQ 慢 6 倍。

所以：

本地数据库 - DB 更快，否则 MSMQ 更快。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-19T04:24:58.980

如果您将服务实现为排队的 COM+ 组件并从客户端应用程序进行排队的函数调用，而不是进行原始 MSMQ 调用，这可能会更容易。最后，异步服务还是在后台使用MSMQ，但是你的代码会更清晰，更容易使用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-19T05:56:52.353

我自己可能会选择 MSMQ 或 ActiveMQ。我建议（假设您正在考虑使用 MSMQ，您正在使用带有 MS 技术的 windows）查看 WCF，或者如果您使用的 MS-SQL 2005+ 具有调用 .net 代码来运行您的处理的触发器。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-19T19:23:43.187

Service Broker 是在 SQL 2005 中引入的，它的设计目的是非常快速地处理消息，因为该过程相对简单（我相信它的根源在于触发器）。如果您担心可伸缩性，他们在 SQL 2008 中发布了一个独立的处理可执行文件，以将处理与 SQL Server 分开（在标准 Service Broker 中，一切都由 SQL Server 实例控制）。

我肯定会考虑在 MSMQ 上使用 Service Broker，但这取决于您的 SQL 开发/DBA 资源及其知识。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-06-03T12:44:49.210

除了 Mitch 的回答之外，还有其他一些场景： 1\. 您的每条消息都有自己的到期日期来触发操作，这也可以通过 MQ 完成，但在这种情况下，我更喜欢将其存储到 db 中，因为它更可控; 2.订阅者需要过滤消息然后处理其中的一部分，这也可以通过LINQ完成，取决于过滤器的复杂程度，db方法更好，因为我可以使用linq to EF轻松进行复杂查询；3\. 对于部署，我想要完全自动化的部署过程，这样 DB 对我来说是一个更好的选择。我不是手动配置的忠实粉丝。

# mysql - 外键在 MySQL 中不起作用：为什么我可以插入一个不在外列中的值？

> ID：380057
> 
> 赞同：24
> 
> 时间：2008-12-19T03:51:04.913
> 
> 标签：mysql, foreign-keys, innodb, mysql-error-1005

我在 MySQL 中创建了一个表：

```
CREATE TABLE actions ( A_id int NOT NULL AUTO_INCREMENT,
type ENUM('rate','report','submit','edit','delete') NOT NULL,
Q_id int NOT NULL,
U_id int NOT NULL,
date DATE NOT NULL,
time TIME NOT NULL,
rate tinyint(1),
PRIMARY KEY (A_id),
CONSTRAINT fk_Question FOREIGN KEY (Q_id) REFERENCES questions(P_id),
CONSTRAINT fk_User FOREIGN KEY (U_id) REFERENCES users(P_id)); 
```

这创建了我想要的表（尽管“DESCRIBE actions;”命令显示外键是 MUL 类型的键，我不确定这意味着什么）。但是，当我尝试输入 questions 或 users 表中不存在的 Q_id 或 U_id 时，**MySQL 仍然允许这些值。**

我做错了什么？如何防止具有外键的表接受无效数据？

## 更新 1

如果我添加`TYPE=InnoDB`到最后，我会收到一个错误：

> 错误 1005 (HY000): 无法创建表 './quotes/actions.frm' (errno: 150)

为什么会发生这种情况？

## 更新 2

有人告诉我，用功能外键强制数据完整性很重要，而且 InnoDB 不应该与 MySQL 一起使用。你有什么建议吗？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-12-19T04:02:23.723

我猜你的默认存储引擎是 MyISAM，它忽略了外键约束。它默默地接受外键的声明，但不存储约束或随后强制执行它。

但是，它确实在您为外键声明的列上隐式创建索引。在 MySQL 中，“ `KEY`”是“”的同义词`INDEX`。这就是 DESCRIBE 输出中显示的内容：索引，但不是约束。

您现在可以向表中插入无效值，因为没有约束。要获得强制引用完整性的约束，您必须使用 InnoDB 存储引擎：

```
CREATE TABLE actions (
  A_id int NOT NULL AUTO_INCREMENT,
  ...
  CONSTRAINT fk_Question FOREIGN KEY (Q_id) REFERENCES questions(P_id),
  CONSTRAINT fk_User FOREIGN KEY (U_id) REFERENCES users(P_id)
) ENGINE=InnoDB; 
```

我一直认为 MySQL*默默地*忽略外键约束声明是一个大错误。没有错误或警告存储引擎不支持它们。

CHECK 约束也是如此。顺便说一句，没有与 MySQL 一起使用的存储引擎支持 CHECK 约束，但 SQL 解析器毫无怨言地接受它们。

* * *

当它无法创建 InnoDB 表时会出现 errno 150 问题，因为它无法理解外键约束。您可以通过以下方式获得更多信息：

```
SHOW ENGINE INNODB STATUS; 
```

InnoDB 外键的一些要求：

*   引用的表也必须是 InnoDB。
*   被引用的表必须有一个索引和一个主键。
*   FK 列和引用的 PK 列的 SQL 数据类型必须相同。例如，INT 与 BIGINT 或 INT UNSIGNED 不匹配。

* * *

您可以更改其中包含数据的表的存储引擎：

```
ALTER TABLE actions ENGINE=InnoDB; 
```

这有效地将整个 MyISAM 表复制到 InnoDB 表，然后一旦成功，它将删除 MyISAM 表并将新的 InnoDB 表重命名为以前的 MyISAM 表的名称。这称为“表重组”，它可能很耗时，具体取决于表中的数据量。在 ALTER TABLE 期间会发生表重组，即使在某些看起来没有必要的情况下也是如此。

* * *

重新更新您的更新 2：

> 有人告诉我，用功能外键强制数据完整性很重要，而且 InnoDB 不应该与 MySQL 一起使用。你有什么建议吗？

谁告诉你的？这是绝对错误的。 [InnoDB 比 MyISAM 具有更好的性能](http://www.mysqlperformanceblog.com/2007/01/08/innodb-vs-myisam-vs-falcon-benchmarks-part-1/)（尽管 InnoDB 需要更多注意[调整配置](http://www.mysqlperformanceblog.com/2006/09/29/what-to-tune-in-mysql-server-after-installation/)），InnoDB 支持原子更改、事务、外键，并且 InnoDB 在崩溃时更能抵抗损坏数据。

除非您运行的是旧的、不受支持的 MySQL 版本（5.0 或更早版本），否则您应该使用 InnoDB 作为您的*默认*存储引擎选择，并且只有在您可以展示从 MyISAM 中受益的特定工作负载时才使用 MyISAM。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-10-20T22:47:21.113

只是为了节省其他人的头痛时间-正如长颈鹿所涉及的那样，确保@FOREIGN_KEY_CHECKS 设置为1。

选择@@FOREIGN_KEY_CHECKS

设置 FOREIGN_KEY_CHECKS=1

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-04-01T15:58:51.177

我知道这个帖子很久以前就打开了，但我将这条消息发布给未来寻找答案的用户。我在mysql中的外键有同样的问题。以下事情对我有用。

父表：

```
CREATE TABLE NameSubject (
  Autonumber INT NOT NULL AUTO_INCREMENT,
  NameorSubject nvarchar(255),
  PRIMARY KEY (Autonumber)
 ) ENGINE=InnoDB; 
```

子表：

```
CREATE TABLE Volumes (
  Autonumber INT NOT NULL,
  Volume INT,
  Pages nvarchar(50),
  Reel int,
  Illustrations bit,
  SSMA_TimeStamp timestamp,
  Foreign KEY (Autonumber) references NameSubject(Autonumber)
  ON  update cascade 
)engine=innodb; 
```

“ON update cascade”为我创造了魔力。

我希望这对其他人有用。祝你好运。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-06-30T10:18:40.387

对于那些忽略外键约束的 mysql 仍然存在问题的人，以及以上或任何其他相关问题的答案没有解决问题的人，这就是我发现的问题。

如果你这样声明你的外键

```
id  INTEGER UNSIGNED    REFERENCES    A_Table(id) 
```

然后外键似乎被忽略了，要强制执行约束而不（显然）必须使用任何 SET 命令，请使用以下声明。

```
id  INTEGER UNSIGNED,
CONSTRAINT fk_id  FOREIGN KEY (id)  REFERENCES A_Table(id) 
```

这种方式为我解决了问题。不知道为什么，因为许多人说第一个声明只是第二个变体的简写。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-19T04:20:00.067

我找到了以下文章。目前我没有时间测试它，但它可能会有所帮助：

[http://forums.mysql.com/read.php?22,19755,43805](http://forums.mysql.com/read.php?22,19755,43805)

作者 Edwin Dando 说：

> 两个表都必须是 INNODB。外键字段上必须有索引。外键字段和被引用的字段必须是同一类型（我只使用整数），并且经过数小时的痛苦，它们必须是 UNSIGNED。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-06-01T09:01:20.763

如果我先看到这个答案，我会节省很多时间。尝试以下三个步骤，我按照新手错误的频率排序：

(1) 通过将“ENGINE=InnoDB”附加到“CREATE TABLE”语句中，将表更改为 InnoDB。

其他引擎（可能是默认引擎）不支持外键约束，但它们也不会抛出错误或警告，告诉您它们不受支持。

(2) 确保通过执行“SET foreign_key_checks = 'ON'”来检查外键约束

(3) 将“ON UPDATE CASCADE”附加到您的外键声明中。

注意：确保级联是您想要的行为。还有其他选择...

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-19T14:59:23.610

问题很可能是 questions.p_id 和 users.p_id 未定义为 INT NOT NULL。为了使外键起作用，外键两侧的列定义必须完全匹配，但 auto_increment 和 default 除外。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-19T04:27:51.220

如前所述，您的表必须是 InnoDB 才能强制执行 FK 约束。

在我尝试创建外键约束的情况下，我只遇到了“无法创建表”，而我的本地列与外列的类型不同。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-09-17T11:25:00.720

好吧，我的猜测是以某种方式检查了“跳过创建 FORIEN KEYS”选项，它可能发生在“正向工程”过程的“选项”部分。

![正向工程 - 选项部分](https://i.stack.imgur.com/lAt4k.png)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-09-20T20:50:01.333

我认为一些有这个问题的人可能是从 ORACLE 网站上为 MYSQL 提供的一些示例数据库开始的（例如 sakila DB）。不要忘记在脚本末尾“重新打开外键约束”（例如，在 sakila DB 脚本的开头，它们被关闭）

```
SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL'; 
```

在此处创建您的表格

然后不要忘记这一点：

```
SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS; 
```

# iphone - iPhone 设备与 iPhone 模拟器

> ID：380062
> 
> 赞同：37
> 
> 时间：2008-12-19T03:55:19.243
> 
> 标签：iphone

我听说应用程序在模拟器上无法正常运行，但在实际 iPhone 设备上运行正常。有没有人体验过可以在模拟器中完美运行但不能在实际 iPhone 设备上运行的应用程序？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-11-11T15:10:10.480

文件名在 iPhone 上区分大小写，但在模拟器中不区分大小写。

因此，例如，如果您尝试使用 加载图像`UIImage *iconImage = [UIImage imageNamed:"MyIcon.png"]`，但您的资源实际上名为“myicon.png”，那么它将在模拟器上工作，但在设备上不工作。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-12-19T04:34:16.840

如果您的应用程序是图形密集型的，例如游戏，则模拟器的性能与硬件的性能完全不同。您的应用程序可能会很流畅并且在模拟器上运行良好，但在硬件上它可能会在爬行时呈现，除非您知道自己在做什么。您可以轻松地在模拟器和硬件之间从 60fps 到 3fps。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-02-19T18:43:38.407

评估函数/构造函数参数的顺序不同：

```
int i = 0;

int f() { return ++i; }

int a, b;

int test(int p1, int p2) {

    a = p1;

    b = p2;

}

test( f(), f() );

//simulator: a = 2, b = 1

//device: a = 1, b = 2 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-03-19T17:32:43.493

三角函数可能返回不同的结果：

```
float a = cosf( 0.108271248639 );   
printf("%.12f", a);

//simulator: 0.994144439697
//device:    0.994144380093 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-19T05:15:39.410

我知道设备和模拟器之间的 OpenGL ES 实现存在一些差异。据我了解，这主要是因为 iPhone (PowerVR MBX) 上的图形芯片与其他 mac 机器有很大不同的功能。模拟器中没有强制执行许多硬件限制，因此完全有可能在模拟器中运行一些会在设备上完全崩溃的东西。

还有一些模拟器不支持的 iPhone 硬件支持的 OpenGL ES 扩展。我相信主要的是 PowerVR 纹理压缩 (PVRTC)。

另一个问题区域可能是内存占用。有趣的是，我还没有看到模拟器自动强制执行设备的内存限制。因此，有可能让某些东西在模拟器中运行良好，愉快地消耗大量 RAM，并且从不费心释放任何内存，只是在设备上运行时这种行为的短暂持续后被迅速终止。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-19T04:21:22.793

有些代码在模拟器上无法运行（例如，使用 iPhone 钥匙串），但对于几乎所有应用程序，模拟器都可以像 iPhone 一样运行。

也就是说，在真实设备上进行测试绝对没有替代品。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-24T22:35:58.053

另请注意，在为模拟器构建时，您将针对 OS X 框架（如果适用）进行编译，因此您可以使用 iPhone 版本的框架上不可用的方法和类。

我能想到的一个例子是 NSPredicate。我能够在模拟器中使用 NSPredicate 编译和运行应用程序，但由于该类不可用，因此无法为设备编译。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-19T06:20:21.383

我在运行一个相对简单的 1/30 秒计时器来更新游戏时遇到了问题。它在模拟器中运行良好，并冻结了设备上的输入。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-08-16T16:29:29.580

指尖大于鼠标光标的 1 个像素端点。要进行适当的，甚至是最小的可用性测试，您应该将您的应用程序部署到设备上。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-27T23:00:46.107

有很多琐碎的例子。例如，您可以在模拟器上分配比在真实手机上更多的内存。如果您没有视网膜 Mac，则无法在模拟器上收到推送通知，显示点间距不同。

在更基础的层面上，模拟器就是这样，它使用 Mac OS X 模拟 iPhone OS X。模拟器上的文件系统可能不区分大小写，但在手机上它会区分大小写。更微妙的是，它不模拟硬件，因此位置等内容将无法正常工作，并且 3D 将非常不同 - 特别是如果您使用的是 Metal。

您应该始终在真实硬件上进行测试。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-08-09T07:24:06.590

如果您启用 GCC_ENABLE_FLOATING_POINT_LIBRARY_CALLS，您的应用程序将在模拟器中到处崩溃，但在 iPhone 上可以正常工作。

iPhone 模拟器中的 Quartz 图形调用比同一台计算机上的 Java2D 调用更快——速度极快。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-08-09T08:06:11.700

我在需要大量内存的应用程序中遇到问题，模拟器可以正常工作（因为它会假设 iPhone/iPod Touch 的内存都是你可以玩的），而设备会崩溃（因为其他应用程序已经泄露和 Apple 背景服务已经消耗了一些内存）并且我没有实现正确的内存管理或对`didReceiveMemoryWarning`选择器的响应。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-07-25T17:59:41.233

我花了一段时间才发现的一件大事是模拟器不支持设备令牌，因此任何涉及这些的代码都不会在模拟器上运行。

我有一个错误，该应用程序可以在模拟器上正常运行，但是当我在设备上运行它时会崩溃，因为设备令牌代码中存在错误。我想了很久都想不通！

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-03-27T19:22:03.653

关于声音，我遇到了同样的问题。问题是模拟器支持的声音编码是一组与设备不同的声音。我希望这会有所帮助。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-19T04:42:33.343

在不考虑两者之间的性能差异的情况下，模拟器曾经有一些事情没有正确执行 - 即在某些情况下它会弄乱音频（参见[这个问题](https://stackoverflow.com/questions/302399/sound-not-working-in-iphone-simulator#303102)）。然而，自从 2.2 SDK 以来，这个问题已经得到解决，并且模拟器中的声音似乎很好。这并不是说那里潜伏着其他一些不兼容性！（我没有遇到过）

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-04-05T12:38:06.890

电影文件（m4v 类型），因为我的经验是第一次正常播放

但在第二次它闪烁模拟器的屏幕......

而在 iPhone 设备中它可以正常工作......

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-12-19T13:26:06.310

我有一些音效在模拟器中可以正常播放，但在设备上却不行。我不得不将格式更改为设备可以处理的格式。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-04-26T21:22:42.787

从模拟器转移到设备时，我在库和框架方面遇到了很多问题。尤其是它们似乎有不同的架构！

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-05-11T21:28:16.393

我已经看到对象的定位，例如模拟器上的工具栏与手机上的不同。很烦人。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-05-13T12:07:43.173

是的....

为 2.x 编译的应用程序在 3.0 设备上可以正常工作，但在 3.0Simulator 上会崩溃

注意： 1\. 如果您为 3.0 编译，应用程序也可以在 3.0 模拟器上正常工作... 2\. a) 为 2.x 编译并在模拟器中启动应用程序。b) 现在将 iPhone 模拟器硬件更改为“3.0”。c) 然后启动我们之前在步骤 a) 中安装的应用程序。碰撞 ！！！！！！！！

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2010-05-18T04:04:08.697

如果应用程序的状态栏被隐藏，在模拟器的情况下它仍然会消耗触摸事件。但在设备中它表现完美。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2010-10-07T17:39:09.900

是的 - 前几天发生在我身上。我是 iphone 的新手，所以删除了 MainWindow.xib 认为它没有被使用。该应用程序在模拟器上运行良好 - 但在手机上安装时崩溃。

我们遇到的另一个问题是我们的 three20 依赖项，它们被设置为 ios 3.2 而不是 4.1。在模拟器中完美运行，但在设备上被轰炸（因为文件被编译为错误的拱门）。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2011-02-19T19:07:33.620

> iphone 视频库在模拟器中无法访问，但代码在实际设备上工作正常

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2011-02-04T17:16:06.693

模拟器中的资源加载比设备中的快得多。例如，加载和显示一系列全屏`UIImages`（如基本视频）在模拟器中看起来非常流畅，而在设备上则显得断断续续。

事实上，请记住，不同设备之间存在巨大的速度差异。最初的 iPhone 和 iPhone 3G 比 iPod touch 2nd Gen 慢，后者也比 iPhone 3GS 慢得多，以此类推。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2015-02-27T00:06:00.660

当尝试访问 UIDevice.currentDevice() 时，它返回 iOS Simulator 而不是您正在测试的实际设备。这很糟糕，因为你不能在模拟器上做某些事情。

# c# - 将 DataTable 替换为集合的最佳 C# 泛型类？

> ID：380067
> 
> 赞同：4
> 
> 时间：2008-12-19T03:58:04.667
> 
> 标签：c#, .net, generics, datatable

我正在尝试将遗留的 C# .NET 1.1 应用程序带入现代时代。我们使用 DataTables 来收集可能是业务对象的内容。

鉴于大多数代码都认为它正在与 DataRow 的接口通信，那么什么样的泛型集合才能实现最不痛苦的转换？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-19T04:31:15.833

如果我正确地阅读了您的问题，那么您正在询问哪个容器将只存储您的业务对象列表，然后允许您仅枚举集合，或通过索引进行选择。

好吧，我会考虑查看 List<>

您的方法将接受 IList<> （访问索引）或 IEnumerable<> （在集合上使用 foreach 循环）

例如

```
private void PrintAll<T>(IEnumerable<T> items)
{
    foreach(T item in items)
        Console.WriteLine(item.ToString());
} 
```

现在我可以传入任何使用 IEnumerable<> 接口的容器，包括 List<> 和普通数组

例子

```
List<Person> people = new List<Person>();
//add some people to the list
PrintAll<Person>(people); 
```

[带有业务对象的示例 n 层应用程序](http://www.dofactory.com/Framework/Framework.aspx)

高温高压

骨头

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-19T04:27:12.627

与其放弃 DataSet/DataTable API，为什么不将 DataTable 和 DataRow 子类化为适合您的业务逻辑的类型呢？

对子类 DataRow 和 DataTable 对象的支持非常出色。您将在新代码中获得所需的强类型，以及旧代码的向后兼容性。此外，您可以在需要/想要的任何地方注入业务逻辑。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-19T08:37:37.300

如果你习惯了`DataTable`，想必你习惯了适配器（etc）带来的变化跟踪和持久性支持。在这种情况下，您是否考虑过 LINQ-to-SQL 和/或实体框架？它们都支持丰富的变更跟踪和自动持久性，同时提供各种其他 DAL 用例，例如可组合查询和所有其他 LINQ 优点。

绝对值得调查。

请注意，更改为类型化的 POCO 实体（即不是`DataRow`其子类）仍然是一个很大的偏差，因此它不会是一个简单的更改。如果您没有时间进行重大更改，那么坚持下去`DataTable`（也许是打字）将是务实的。

这将为您提供`EntitySet<T>`,`IQueryable<T>`等，或者您可以只使用`List<T>`,`Collection<T>`等来临时使用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-09T16:49:14.653

将您的“应用程序带入现代时代”的最简单方法是将代码从 Visual Studio 2003 升级到 2005 或 2008。如果您希望向您的类添加行为（“可能是业务对象”）事实上，DataSet、DataTable 和 DataRow 是作为部分类实现的。

上面提到的解决方案会为您失去很多东西，包括更改跟踪，除非那是您正在寻找的东西——在很大程度上偏离。LINQ to SQL、实体框架等都提供了更改跟踪，但在连接到数据库的工作单元机制内，而不是像 DataRow 那样将工作单元跟踪直接放在您的对象上。

希望你不是简单地改变以将你的“应用程序带入现代时代”，并且你有一些你试图为你放弃的功能和你付出的努力而获得的好处？

顺便说一句，这一切都假设您使用的是类型化数据集……在我看来，对于大多数用途来说，非类型化数据集对象有点傻。

# javascript - 将 jquery 包含添加到 DotNetNuke 4.8 皮肤没有任何作用

> ID：380069
> 
> 赞同：1
> 
> 时间：2008-12-19T03:59:51.980
> 
> 标签：javascript, jquery, dotnetnuke, skinning

我试图通过在我的 DNN 皮肤顶部添加这两行代码来将 JQuery 包含在我的 DotNetNuke 皮肤中：

```
<%                              
Page.ClientScript.RegisterClientScriptInclude("jquery", "http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js")
Page.ClientScript.RegisterStartupScript(Me.GetType(), "jQueryNoConflict", "jQuery.noConflict()", True) 
%> 
```

可悲的是，当我在我的页面上查看源代码时，我在任何地方都看不到引用 jquery.min.js 的适当标签。DotNetNuke 是否以某种方式清除了我在此处向我的页面添加脚本的请求？我错过了什么？我有点像 DNN 新手。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-20T12:48:14.513

叹。解决方案是确保将其放在 Page_Load() 方法中，而不是页面呈现代码本身。我想我在页面生命周期中为时已晚，无法做我想做的事情。

```
<script runat="server">
    Private Sub Page_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        Page.ClientScript.RegisterClientScriptInclude("jquery", "http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js")
        Page.ClientScript.RegisterStartupScript(Me.GetType(), "jQueryNoConflict", "jQuery.noConflict();", True)
    End Sub
</script> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T05:26:59.247

你使用的是什么版本的 DNN？除非您使用的是 DNN 版本 5，否则 DNN 不支持包含 jQuery。 [有关更多信息，请参见此处](http://blog.theaccidentalgeek.com/post/2008/10/02/DotNetNuke-50-Now-with-jQuery.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-25T05:50:25.873

这样做可能会遇到问题，具体取决于您的代码所针对的版本，以及您的模块是否会在一个页面上多次使用。

我开发了一组方法来更好地处理这个问题，它们是版本独立的，所以你可以像这样进行单行调用：

```
InjectjQueryLibary(this.Page, false, false, false); 
```

布尔值是 'include jQuery UI'、'use uncompressed version' 和 'include noConflict()'。

完整的代码清单可在此博客文章中找到：[在 DotNetNuke 模块中包含 jQuery，并带有版本无关代码](http://www.ifinity.com.au/Blog/Technical_Blog/EntryId/75/Include-jQuery-in-a-DotNetNuke-Module-with-version-independent-code)

# perl - 如何在 Perl 中获取 PDF 文件的页数？

> ID：380070
> 
> 赞同：5
> 
> 时间：2008-12-19T04:00:33.867
> 
> 标签：perl, pdf, pdflib

是否有任何 Perl 脚本可以读取多个 PDF 文件并获取其中的页数？

通过使用 PDFlib 或 pdftet。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-19T04:55:03.897

将 Perl 与 PDF::API2 一起使用怎么样？

```
#!/usr/bin/perl

use PDF::API2;

foreach $doc (@ARGV)
{
    $pdf = PDF::API2->open($doc);
    $pages = $pdf->pages;
    $totalpages += $pages;

    print "$doc contains $pages pages\n";
}

print "Total pages of pdf pages = $totalpages\n"; 
```

# development-environment - 解决客户政策中的发展限制

> ID：380075
> 
> 赞同：1
> 
> 时间：2008-12-19T04:03:06.357
> 
> 标签：development-environment, infrastructure, security-policy

如前所述，[我从事 IT 咨询工作，并在各种客户环境中工作](https://stackoverflow.com/questions/30824/book-on-system-archaeology)。遇到各种安全策略是很自然的，在大多数环境中，我们必须通过安全检查表才能授权我们的笔记本电脑 - 我们的移动开发工作站 - 连接到他们的网络（大部分时间只是开发网络）。

有这个客户不允许外部计算机连接到他们的网络，所以我们的笔记本电脑是......带有移动 GSM 调制解调器的昂贵通信计算机。我们被迫使用他们的台式电脑进行开发，而这些工作站都是相当老的型号，具有低 RAM 和单核 Pentium 4 CPU 和古怪的磁盘。不用说，开发工作不是最理想的，尤其是在使用范围为 100 到 400 个项目的 Visual Studio 解决方案时。

对于可以隔离的小案例，我们在自己的笔记本电脑上进行开发和测试。但对于更大的情况，鉴于某些开发服务器（如 SeeBeyond 和大型机 DB2 数据库）仅在网络上，并且在机器之间来回复制数百个项目的前景非常可怕，这在技术上似乎不是一个合理的想法。

我并不是在寻求违反客户政策的技巧（例如，将笔记本电脑插入伪装桌面 MAC 地址）。我只是想知道在这样的环境中工作时，其他人试图通过自己的硬件保留一些优势和效率。每当我可以尝试在我自己的笔记本电脑上使用虚拟服务器复制环境时，它只适用于仅限 Microsoft 的服务器解决方案。虚拟化非 Microsoft 服务器和软件是一项挑战。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T04:31:54.397

这很难。这里的根本原因是管理层不了解他们选择的环境会产生真正的成本影响。

您的问题是，虽然您可能按小时计费，但您可能没有以这种方式获得报酬，因此您的客户浪费的时间进入了您老板的口袋，而不是您。很多时候，这会带来轻微的利益冲突。您的公司加快工作速度的动力几乎为零，而您的客户不想在他们认为是临时参与的情况下进行基础设施投资。

我只能说，您必须通过管理层将其推向旗杆。您必须向他们表明，这会占用项目的实时时间，这可能会使您的交付日期面临风险，或者更糟糕的是，这些机器的可靠性使得最终产品的交付也面临风险。你有责任让你的管理层成为一个信徒。

Crucial 的 RAM 演出是 30 美元。如果没有人愿意为你的盒子花 90 个大的 3GB 内存，那么你的管理层正在积极反对你或不尊重你。如果涉及到这一点，你就会遇到更大的问题，需要寻找下一个雇主。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-19T04:56:34.580

当我升级当前的开发环境时，我做的一件事是找到生产力研究的链接，这些研究表明当开发环境得到增强时，生产力提高了多少。在我的特殊情况下，它在我的桌面上从 2 台显示器变为 3 台显示器。我能够找到 3-4 篇文章，这些文章描述了通过额外的显示器获得了多少。对我来说，您需要一个更新的、配置良好的系统供开发人员使用，这似乎是不言而喻的，尤其是因为这些天硬件成本相对于人员成本是如此之小，但 bean 计数器通常会有不同的想法。如果您可以参加一些显示生产力提高的行业研究，我认为将您的担忧仅仅视为对环境的抱怨将更难消除。

FWIW，我很失望必须为升级进行研究，其成本低于部门在一个月内在纸上花费的成本，但有时你必须做一些对你来说没有意义的事情，因为这对其他人来说是有意义的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T11:15:17.883

给你的经理写一个体面的建议，这就是你可以做的所有纠正解决方案的事情。如果他不愿意或无法解决问题，或者不愿意/无法将提案传递给可以解决的人，那么我会说目前的情况是他们决定使用的。

在这种情况下，要么忍受它，要么不忍受，即。继续。

提案应包含：

1.  你想做的事的提议
2.  为什么应该这样做
3.  这样做的后果
4.  最重要的是，不这样做的后果

列出诸如更长的开发时间、更少的测试或更少的编写高质量代码的时间。基本上，不花费太多成本的小升级将极大地提高产品的质量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T04:19:46.760

我刚刚经历了这个并找到了一个很好的解决方案：找一份不同的工作

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T11:15:35.417

只是增量同步。您没有输入那么多代码/秒，gsm 连接无法跟上它？确保您的项目设置为尽可能使用模拟/存根。

设置这个可能超出了您客户的系统管理员的能力。

应该减少对大型数据库的依赖，因此您只需要运行每日回归测试。

# macos - 没有“文档已更改”警告的手动核心数据模式迁移？

> ID：380076
> 
> 赞同：4
> 
> 时间：2008-12-19T04:04:36.650
> 
> 标签：macos, core-data, migration, mapping-model, datamodel

我的基于 Core Data 文档的应用程序（仅限 10.5）的数据模型位于框架中，因此使用 Core Data 映射模型的自动模式升级似乎不起作用。当 Core Data 机器不在应用程序的主包中时，它们似乎找不到合适的数据模型或映射模型。因此，我没有使用自动迁移，而是 `configurePersistentStoreCoordinatorForURL:ofType:...`在我的 `NSPersistenDocument`子类（下面的代码）。我将持久存储迁移到一个临时文件，然后在迁移成功时覆盖现有文件。然后该文档显示错误消息“自从您打开或保存此文档的文件已被另一个应用程序更改”。当我尝试保存时。正如此列表中的其他人所指出的，这是由于我在“背后”修改了文档的文件。我尝试更新文档的文件修改日期，如下所示，但随后出现错误对话框，显示消息“无法确定文档“test.ovproj”的位置。” 当我尝试保存时。我不太确定这个错误的原因，但是将一个不必要的消息（在这种情况下）换成另一个并不是我想要的。

任何人都可以提供一些指导吗？有没有办法手动升级文档持久存储的架构而不触发其中一个（在*这种*情况下是不必要的）警告？

用于升级我的子类中的数据存储的代码 `-configurePersistentStoreCoordinatorForURL:ofType:...`：

```
if(upgradeNeeded) {
           NSManagedObjectModel *sourceModel = [NSManagedObjectModel mergedModelFromBundles:VUIModelBundles() orStoreMetadata:meta];

           if(sourceModel == nil) {
               *error = [NSError errorWithDomain:VUIErrorDomainn ode:VUICoreDataErrorCode localizedReason:BWLocalizedString(@"Unable to find original data model for project.")];
               return NO;
           }

           NSManagedObjectModel *destinationModel = [self managedObjectModel];

           NSMigrationManager *migrationManager = [[NSMigrationManager alloc] initWithSourceModel:sourceModel destinationModel:destinationModel];
           NSMappingModel *mappingModel = [NSMappingModel mappingModelFromBundles:VUIModelBundles() forSourceModel:sourceModel destinationModel:destinationModel];
           if(mappingModel == nil) {
               *error = [NSError errorWithDomain:VUIErrorDomain code:VUICoreDataErrorCode localizedReason:BWLocalizedString(@"Unable to find mapping model to convert project to most recent project format.")];
               return NO;
           }

           @try {
               //move file to backup
               NSAssert([url isFileURL], @"store url is not a file URL");

               NSString *tmpPath = [NSString tempFilePath];
               id storeType = [meta objectForKey:NSStoreTypeKey];
               if(![migrationManager migrateStoreFromURL:url
                                                    type:storeType
                                                 options:storeOptions
                                        withMappingModel:mappingModel
                                       toDestinationURL:[NSURLfileURLWithPath:tmpPath]
                                         destinationType:storeType
                                      destinationOptions:storeOptions
                                                   error:error]) {

                   return NO;
               } else {
                   //replace old with new
                   if(![[NSFileManager defaultManager] removeItemAtPath:[url path] error:error] ||
                      ![[NSFileManager defaultManager] moveItemAtPath:tmpPath toPath:[url path] error:error]) {
                       return NO;
                   }

                   // update document file modification date to prevent warning (#292)
                   NSDate *newModificationDate = [[[NSFileManager defaultManager] fileAttributesAtPath:[url path] traverseLink:NO] bjectForKey:NSFileModificationDate];
                   [self setFileModificationDate:newModificationDate];
               }
           }
           @finally {
               [migrationManager release];
           }
       }
   }

   return [super configurePersistentStoreCoordinatorForURL:url ofType:fileType modelConfiguration:configuration storeOptions:storeOptions error:error]; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T16:43:11.980

我没有遇到过这种特殊情况，但我有一些猜测。首先，当您想要切换文件时，不要使用 -removeItemAtPath: 和 -moveItemAtPath: ，而是使用 FSExchangeObjects() 函数。NSDocument 使用 FSRefs 来跟踪文件，除非您使用 FSExchangeObjects()，否则它会意识到它正在查看一个完全不同的文件。

其次，您可以通过覆盖 -managedObjectModel 手动设置文档的托管对象模型，特别是使用 +mergedModelFromBundles: 方法从框架加载模型。根据文档，默认情况下它应该合并主包和所有链接框架中的任何模型，因此这只对动态加载的包是必需的。不知道为什么这对你不起作用，但我没有尝试过。要找出要搜索的捆绑包，NSBundle 的 +bundleForClass: 方法是您的朋友。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-19T00:27:40.073

当心 FSExchangeObjects()！它不支持所有卷类型，请参阅 bSupportsFSExchangeObjects。我正在寻找自己的替代品。选项似乎是 MoreFilesX 的 FSExchangeObjectsCompat 或 10.5 的 FSReplaceObjects()。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-02-22T15:24:50.547

10 年后...我遇到了同样的问题，并且使用 NSDocument 的新 API，您可以在迁移后使用更新文件的新日期更新文档的 fileModificationDate

```
migrate()
if let newModificationDate = try? NSFileManager.defaultManager().attributesOfItemAtPath(url.path!)[NSFileModificationDate] as? NSDate {
    self.fileModificationDate = newModificationDate
} 
```

之后你可以打电话`super.configurePersistentStoreCoordinatorForURL...`

`readFromURL:ofType` 这是因为 NSDocument 甚至在调用See [Document Initialization Message Flow](https://developer.apple.com/library/content/documentation/DataManagement/Conceptual/DocBasedAppProgrammingGuideForOSX/AdvancedTopics/AdvancedTopics.html#//apple_ref/doc/uid/TP40011179-CH7-SW15)之前就设置了文件修改日期

# java - 值得信赖的开发人员同时撰写有关 Java 和 .NET 的文章？

> ID：380081
> 
> 赞同：3
> 
> 时间：2008-12-19T04:05:47.553
> 
> 标签：java, .net

首先让我说我对什么更好的火焰战争不感兴趣：.NET 或 Java...如果你想告诉我 .NET 是多么杀手或微软是多么邪恶，请不要发帖帝国，所以有灵魂的开发人员不可能编写 .NET 或其他任何东西。我们以前都听过太多了。

我感兴趣的是业内谁能真正准确、公正地比较和对比这两个平台的细节。我正在寻找在这两个平台上都是专家的稀有行业名人，并以合理的方式讨论这两个平台。我在这个领域唯一知道的家伙是 Ted Neward，如果这能让你知道我在寻找什么。最终，我对他们对两个平台如何相互影响以及一侧发生的新事物运作良好的看法感兴趣（这可能让我了解另一个平台可能如何发展）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-19T08:34:35.450

I'm no Ted Neward, but I'm reasonably experienced in both Java and C#.

Despite Microsoft's early draft of the C# spec claiming that it is a mixture of C++ and VB, clearly Java was a *massive* influence. Since C# 1.0, however, I would argue that C# has been the language driving innovation. (Okay, a lot of the new features have already been present in other languages, but not Java...)

A lot of the *proposed* features from Java 7 look very much like they've been influenced by C#, but I wouldn't be surprised if they were under consideration before C# got them (just like generics in Java were being developed for years, and in the other direction there were research projects with generics in .NET before .NET 1.0 was even released).

What does the future hold? Well, personally I'd like to see a *true* Java 2.0 which ditches backward compatibility in order to clean up some of the messes of the past - and largely make it like C#, but with the existing platform independence. Nothing in the *language* of C# is tied to Windows. From that side of things, it's a real shame that Mono hasn't gone further (or been supported by Microsoft, other than Moonlight).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-19T04:13:26.740

[Martin Fowler](http://martinfowler.com/)写过关于这两个方面的文章。
[Ron Jeffries](http://www.xprogramming.com/)将是另一位写过很多关于 java 并且最近写过一些关于 C# 的文章的人

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-19T05:04:02.973

自 .NET 创建以来，我一直在使用这两个平台，主要是在双语言项目中。

Java 是语言的“西班牙语”（过去几百年左右，书面西班牙语几乎没有变化），C# 是英语（我们大多数人无法阅读 200 年前的英国文学）

C# 将“所有的花里胡哨”添加到语言中，既美观又干净。相比之下，Java 相当原始。

Java 有大量的竞争库和不同的编码方式/风格可供选择，.NET 更像是“单一选择”；微软经常为你做了一个不错的选择。这些论点在客观上尤其是毫无根据的；有些人可能认为有很多选择是好的，有些人可能认为这是不必要的开支。我当前的 java 项目没有使用我 5 年前在类似项目中使用的库；因此，尽管语言相同，但编程环境（库、IDE）已经有了惊人的改进。

因此，作为开发人员，我更喜欢 C#。尽管如此，出于选择，我现在使用 Java 工作，并且在可预见的未来将继续这样做——仍然是出于选择。尽管 java 这门语言的发展非常缓慢，但在 java 中发生了很多非常有趣的事情。我剩下的选择是基于你特别不想谈论的所有事情；开放，黑暗的一面等等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T05:40:46.283

我工作的公司大约有一半是用 Java（内部应用程序）开发的，一半是用 .Net（面向公众的应用程序）开发的。你想知道什么？我工作的公司有几个人可以对比和比较。我承认我对 Java 不太了解。您是否在寻找特定的文章、博主或书籍？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T05:48:26.627

如果您正在寻找一个比较过 Java 和 .Net 两种框架的人，那么我没有名字，但是有一个关键短语我想让您非常清楚

类型擦除

[Java 中的泛型](http://en.wikipedia.org/wiki/Generics_in_Java)<- 这里提到了，我是通过一个工作朋友的话来了解这个的。（我不确定什么时候会解决这个问题）

这意味着java将永远是装箱和拆箱。

参考克罗森沃尔德

> Java 有大量的库和不同的编码方式可供选择，.NET 更像是“单一选择”。这有好有坏。

我不太清楚他的意思是什么。如果我第二次猜到这个，你是在引用 .Net 的 DataTable。以及.Net（使用）如何以数据为中心而不是域驱动？

如果是这样，我想提一下 .Net 有一个名为“Alt.Net”又名“NHibernate Mafia”的运动，其中有许多开源库允许 .net 开发人员执行 ORM/DI/MVC/TDD 等。许多库都源于 Java 世界（spring、hibernate），但这并不是 .Net 甚至 Java 框架的核心。

我建议考虑您要比较的内容。例如

*   框架（包括社区/开源框架）
*   限制（Java 是一种语言，但适用于多操作系统，.Net 是多语言，但“官方”支持 Windows 平台，使用 Mono）
*   可用的 IDE

这里有一些链接可以帮助您入门。

[Java 和 .Net 平台的比较](http://en.wikipedia.org/wiki/Comparison_of_the_Java_and_.Net_platforms)

[Csharp 和 Java 的比较](http://en.wikipedia.org/wiki/Comparison_of_C_Sharp_and_Java)（例如，它们处理枚举的方式不同）

高温高压

骨头

# javascript - 通过javascript（activexobject）创建excel单元格时如何自定义日期格式？

> ID：380100
> 
> 赞同：1
> 
> 时间：2008-12-19T04:26:03.690
> 
> 标签：javascript, excel, date, activex, format

我正在尝试使用 new 将 HTML 表格转换为 Javascript 中的 Excel `ActiveXObject("Excel.application")`。基本上，我遍历表格单元格并将值插入到 excel 中的相应单元格中：

```
//for each table cell
oSheet.Cells(x,y).value = cell.innerText; 
```

问题是当单元格的日期格式为“dd-mm-yyyy”（例如 10-09-2008）时，excel 将读取为“mm-dd-yyyy”（即 2008 年 10 月 9 日）。我试图指定`NumberFormat`如下：

```
oSheet.Cells(x,y).NumberFormat = 'dd-mm-yyyy'; 
```

但是，它没有效果。似乎这只影响 excel 如何**显示值，而不是 parse**。我现在唯一的解决方案是交换日期，如：

```
var txt = cell.innerText;
if(/^(\d\d)-(\d\d)-\d\d\d\d$/.test(txt)) txt = txt.replace(/^(\d\d)-(\d\d)/,'$2-$1'); 
```

但是，我担心它不是通用的，不同的机器设置会失败。

有没有办法具体说明excel如何**解析**输入值？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-19T05:08:46.053

在 Vbscript 中，我们用来解决这个问题

```
 If IsDate ( Cell.Value ) Then
         Cell.Value = DateValue ( Cell.Value )
    End If 
```

也许，在 java 脚本中，您也需要使用相同的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T16:16:55.217

您可以通过使用其本机“序列”日期格式输入数据来避免 Excel 的日期解析。例如 '22nd Dec 08' 是 39804 作为 Excel 序列日期。（有关这些的详细说明，请参见[此处）](http://www.cpearson.com/excel/datetime.htm)

然后像以前一样格式化单元格。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-27T17:06:51.583

1.  确定 excel 支持哪些文化中立的日期格式

2.  使用 javascript 解析您的日期字符串并以适当的格式输出

我不知道 excel 支持哪些格式，但您会想要[.net 的往返或可排序格式之](http://msdn.microsoft.com/en-us/library/az4se3k1.aspx)类的东西，它总是会被一致地读取。

对于＃2，如果您可以信任 javascript 从您提供的任何字符串构造一个适当的日期，那很好。如果您不确定，您可能会查看像[datejs](http://www.datejs.com/)这样的库，您可以在其中更具体地了解您想要发生的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-07-20T20:05:40.070

代替

```
oSheet.Cells(x,y).NumberFormat = 'dd-mm-yyyy'; 
```

设置这个：

```
oSheet.Cells(x,y).NumberFormat = 14; 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2010-10-29T13:43:35.830

我已经尝试过您的代码，但在流程结束时，我将格式重新应用于包含日期的列。无论您的机器配置了哪种本地语言，它都可以正常工作。

作为定义为“模板”的我的 excel 对象，一旦我填充了数据，我就申请了（仅举例）：

```
template.ActiveSheet.Range("D10:F99").NumberFormat = "dd/MMM/yyyy;@"; 
```

此致

# java - 不产生任何声音的简单 Java MIDI 示例

> ID：380103
> 
> 赞同：10
> 
> 时间：2008-12-19T04:28:10.393
> 
> 标签：java, midi

这个简单的代码在我用来测试它的几台机器上没有产生任何声音。我在 Eclipse 中运行代码，但我也尝试使用命令行无济于事。

```
public static void main(String[] args)
{
    try {
        Synthesizer synthesizer = MidiSystem.getSynthesizer();
        synthesizer.open();

        MidiChannel[] channels = synthesizer.getChannels();

        channels[0].noteOn(60, 60);
        Thread.sleep(200);
        channels[0].noteOff(60);

        synthesizer.close();
    } catch (Exception e)
    {
        e.printStackTrace();
    }
}
```

我可以通过获取音序器、将 MIDI 事件添加到音序并播放音序来成功获得声音，但我正在尝试做一些音序器不支持的实时音乐效果。

有任何想法吗？

**使用解决方案编辑：**事实证明，问题在于，默认情况下，JRE 不附带音库（有趣的是，使用 Sequencer 有效，但使用 Synthesizer 没有）。谢谢，[jmc](https://stackoverflow.com/users/54787/thejmc)！

为了解决这个问题，我[从 java.sun.com 下载了一个音库](http://java.sun.com/products/java-media/sound/soundbanks.html)并将其放在（在 WinXP 上）C:\Program Files\jre1.6.0_07\lib\audio（必须制作音频文件夹）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-13T21:57:40.957

JRE 的某些安装不包括 JavaSound soundbank.gm（为了节省空间），因此您的代码不会在这些机器上触发声源。

检查不工作的机器上是否存在音库。您还可以将音库与 .class 文件放在同一目录中，它会找到它。

可以在这些机器上添加音库或升级 Java 安装 - 我知道不一致的痛苦 :)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T07:42:12.560

您是否尝试过使用不同的频道？可能[这个讨论](http://forums.sun.com/thread.jspa?threadID=5237086)会让你更接近解决方案......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T08:24:48.623

我已经在我的机器（Windows XP、JRE 1.6）上测试了你的代码，它确实会播放音符。也许只有一个音符太少听不见。尝试添加更多注释。另外，尝试将音量设置得更大一些。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T00:27:16.423

在关闭合成器之前只需要 1 个睡眠动作：

```
public static void main(String[] args)
{
    try {
        Synthesizer synthesizer = MidiSystem.getSynthesizer();
        synthesizer.open();

        MidiChannel[] channels = synthesizer.getChannels();

        channels[0].noteOn(60, 60);
        Thread.sleep(200);
        channels[0].noteOff(60);
        Thread.sleep(200);

        synthesizer.close();
    } catch (Exception e)
    {
        e.printStackTrace();
    }
} 
```

# mysql - 如何在不连接数据库的情况下检查用户和密码是否有效

> ID：380114
> 
> 赞同：2
> 
> 时间：2008-12-19T04:32:39.213
> 
> 标签：mysql, authentication

如何在没有实际连接到数据库的情况下检查用户/密码对是否有效？有问题的 DBMS 是 MySQL。

那是我最初的问题。由于大多数人都错误地回答了这个问题，那么我应该将其改写为：如何检查 MySQL 用户名/密码是否有效，而不以该用户身份连接到 MySQL？（感谢德罗伯特）

我实际上找到了解决方案，请在下面查看我的答案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-19T05:38:21.593

如果您想检查*MySQL 用户名/密码*是否有效，而不以*该*用户身份连接到 MySQL，那么您应该查看 mysql 数据库中的 users 表。

但我建议不要这样做；这实际上是一个内部 MySQL 实现细节，你真的不应该依赖它。（例如，如果有一天 MySQL 获得 LDAP 身份验证会怎样？）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T07:56:15.327

Login as someone who has access to "mysql" database (schema), and do: SELECT COUNT(*) FROM MYSQL.USER WHERE USERNAME=? AND PASSWORD=PASSWORD(?)

If the count > 0 then the username/password is correct.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T05:18:58.293

我认为这个问题可以解释。大多数人会跳进去说“你不能。”，但如果你真正问的是“我如何使用 MySQL 来验证用户而不实际使用数据库？” 那么这是一个完全不同的球类游戏。看看[mod_auth_mysql](http://modauthmysql.sourceforge.net/)，这是一个 Apache 模块，它就是这样做的。如果我们有更多关于你到底想要做什么的细节，人们可能会更乐于接受。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T04:37:22.823

如果用户名和密码存储在数据库中，那么除了首先连接之外，显然没有其他方法可以检查它们。

您可以做的最好的事情可能是仅在他们登录时连接到数据库。一旦他们通过身份验证，您可以在磁盘上存储某种形式的会话信息，但这不是一个很好的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T04:48:55.813

简而言之 - 如果用户名/密码存储在数据库中，则不可能。

身份验证基本上意味着您将响应与已知值的质询进行比较。如果您没有要与之比较的值，则无法进行身份验证。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-19T05:14:55.947

一种可能的解决方案是设计某种方案，其中用户名/密码是加密/解密密钥对。显然，这在分配的用户名世界中更可行，但如果这是主要目标，这样的策略将允许您不访问数据库。

# wpf - How do I get the native "look and feel" using WPF?

> ID：380116
> 
> 赞同：9
> 
> 时间：2008-12-19T04:33:13.770
> 
> 标签：wpf, user-interface

I've just started developing a WPF application. This is not my first WPF app, but it will be the first that needs some polish. I know quite a bit about the "plumbing" of WPF such as binding, etc., but very little about how to polish it up. I don't need a snazzy UI. I just need something that looks like a native Windows app. For instance, if the app runs on XP, I want it to look like an XP app and pick up the user's UI theme. Same thing on Vista, etc.

How can I do this?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-19T04:56:32.613

You should be able to put this into the application's OnLoad event to use the Vista theme, for example:

```
Uri uri = new Uri("PresentationFramework.Aero;V3.0.0.0;31bf3856ad364e35;component\\themes/aero.normalcolor.xaml", UriKind.Relative); 

Resources.MergedDictionaries.Add(Application.LoadComponent(uri) as ResourceDictionary); 
```

or for the Windows XP theme: themes/Royale.normalcolor.xaml

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T13:22:40.543

You don't have to do anything - WPF does it for you.

EDIT: It does. Run it with Aero/Luna and then Classic.

# .net - What extra steps do you take when creating MSI installers for Vista?

> ID：380124
> 
> 赞同：6
> 
> 时间：2008-12-19T04:44:29.957
> 
> 标签：.net, windows-vista, installation, gac

I have a very simple Setup project that copies three dlls into the GAC. That's all it has to do. It works fine in XP, but on a Vista machine, it errors out stating that it cannot write to the file and to check permissions. I'm sure this has to do with some impersonation nonsense in Vista, but I'm not sure how to address it.

Has anyone else encountered this, and how did you overcome it if so?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T08:22:46.787

You use the gacutil.exe to install the dlls? Or do you just copy the files?

Anyway, GAC should be avoided for custom dlls unless they're used by many applications. Keep the dlls close/local to the application: it will only cost you some diskspace, and it enables you to use simple Xcopy deployment.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T12:56:14.827

If you're using Windows Installer, are you putting your assemblies into the special **Global Assembly Cache** folder? That has always worked for me on Vista and Windows 7\. There is no need to use GACUtil or anything else, just put the assemblies in the right folder in the installer project.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T15:12:46.747

I have had some (3rd party) MSI's which won't install correctly unless I force elevated mode from the start, even if they show a UAC prompt later in the process.

Troubleshooting... I assume you are installing from an administrator account. But, is UAC enabled? If it is, are you getting the UAC elevation prompt? Try running the MSI package in elevated mode to see if it works. From an elevated command prompt:

```
msiexec /i setup.msi 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T15:15:31.873

What compiler are you using to make the MSI's? After last weekends fun I may be an expert at MSI vs. Vista issues :)

If using VC2003 or VC2005 there are different issues depending on the compiler version.

If 2005, be sure to have installed the service pack and the Vista service pack. That may solve your problem.

If that fails, you can put them in the GAC with a custom action, but beware there is a bug in 2005 where the no_impersonate bit is incorrectly set. You will have to set this bit yourself using either a script or orca.exe.

# sql-server - MSSQL——用PK创建视图

> ID：380128
> 
> 赞同：2
> 
> 时间：2008-12-19T04:51:54.777
> 
> 标签：sql-server, full-text-search, view

我的创建视图代码是这样的

```
create VIEW [dbo].[vw_test]
AS
SELECT     'B' AS rtype, ID FROM TB_A
UNION ALL
SELECT     'V' AS rtype, ID FROM TB_B
GO 
```

如何创建一个PK。我需要进行全文搜索。Tks

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-19T05:09:14.633

通常，您可以在视图上创建唯一聚集索引，但不能创建实际的主键约束。[文章在这里](http://msdn.microsoft.com/en-us/library/ms187864.aspx)。

但是，[视图中的 SQL 包含一个 UNION](http://msdn.microsoft.com/en-us/library/ms191432.aspx)，因此您不能这样做。

# html - 以编程方式从 DOM 元素执行 SPAN 的类？

> ID：380130
> 
> 赞同：0
> 
> 时间：2008-12-19T04:53:01.793
> 
> 标签：html, .net, dhtml

这是一个 .NET 程序，我正在`HTMLElements`单独访问。在 SPAN 标记中有一些具有“更多...”/“更少...”的标记，单击时将显示更多/更少的前面内容，

一段代码：

```
<dd>
Product Manager, Business Analysis & Web Design Manager, Global Portals at Dun & Bradstreet
<span class="toggle-show-more"> less...</span>
</dd> 
```

“less..”是可点击的，然后调用一些东西来显示更少的文本。我想以编程方式从 HtmlElement 做同样的事情。

并且，来自 Visual Studio 的一些命令窗口输出：

外部HTML：“

```
<DD collapsed="False">Product Manager, Business Analysis &amp; Web Design Manager, Global Portals at Dun &amp; Bradstreet "
OuterText: "Product Manager, Business Analysis & Web Design Manager, Global Portals at Dun & Bradstreet " 
```

我试过：`elem.RaiseEvent("onlick")`并切换“折叠”属性。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-05T22:38:27.213

向消失 dd 的 span 添加 onclick 怎么样？就像是：

```
onclick="this.parentNode.style.display='none'" 
```

# iphone - 我应该使用哪个 iPhone“Active SDK”版本？

> ID：380138
> 
> 赞同：7
> 
> 时间：2008-12-19T04:59:20.457
> 
> 标签：iphone, xcode

当前（截至 2008 年 12 月）iPhone SDK 允许我在构建应用程序时选择 3 个版本：2.0、2.1、2.2。- 我将忽略下面的 2.1。

我的假设：

*   2.2 提供了比 2.0 更多的 API 功能，
*   2.2 修复了自 2.0 以来的错误，
*   2.2 向后兼容 2.0（用于构建和运行），
*   如果我使用 SDK 2.0 构建，我的应用程序将在 iPhone 2.2 上运行，
*   如果我使用 SDK 2.2 构建，我的应用程序将无法在 iPhone 2.0 上运行。

我认为使用可以构建应用程序的最早版本是最好的，这样它就可以在运行旧操作系统的 iPhone 上运行。

但是，如果我使用 2.0 构建我的应用程序是否存在丢失某些内容的风险？也许一些速度或更好的 UI 元素。但也许 2.0 和 2.2 之间并没有那么大的区别，甚至担心它？

所以我的问题是：我应该选择哪个 SDK？

1.  我可以构建的最早的 SDK，以扩大我的目标市场。
2.  始终使用最新的 SDK，以便我的应用程序从改进中受益——但可能会减少我的市场。

（如果答案很明显，我为什么要选择？！）

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-21T23:02:57.610

您可以使用 iPhone OS 2.2 SDK 并仍然为 iPhone OS 2.0 编译；您执行此操作的方式与 Mac OS X 相同。您使用的**SDK**确定您要*使用 API的操作系统的**最新*版本，而您使用的**部署目标**确定您想要使用的操作系统的*最新*版本*继续运行*。这两个通常都应该在 Xcode 的项目级别设置。

 *****因此，您可以针对 iPhone OS 2.2 SDK 构建您的软件，并在安装了 2.2 或更高版本的设备上运行时，使用 2.2 功能。但是您可以将其部署目标设置为 2.0，并且在安装了 2.2 之前的操作系统的设备上运行时*不使用 2.2 功能，并且您的应用程序应该可以正常工作。*

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-19T05:13:53.093

我会选择选项 #1 - 将其编译为 2.0。这就是我们为我们的应用程序所做的。仍然有很多人在运行旧的 2.0 O/S，如果您编译到 2.2，您的应用程序将无法在他们的设备上运行。

也就是说，如果您开发应用程序并遇到错误并发现它已在更高的固件版本中得到修复，那么除非有解决方法，否则您可能没有太多选择。每个新版本还添加了新功能，尽管我不知道这些功能的完整列表（在 API 级别）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-30T22:21:01.093

在我的测试中，如果您使用 2.0，则无法使用 2.1 中出现的应用程序徽章功能（因此您可能至少需要使用该级别）

蒂姆

# xml - 如何将 docx 或 wordml xml 文件转换为 xsl-fo？

> ID：380139
> 
> 赞同：2
> 
> 时间：2008-12-19T04:59:22.123
> 
> 标签：xml, pdf, xslt, xsl-fo, wordml

我一直在寻找一种将 docx 或 wordml xml 转换为 xsl-fo 的方法。

我读了这篇文章：

[Perl 最好的 XSLT 引擎是什么？](https://stackoverflow.com/questions/156683/what-is-the-best-xslt-engine-for-perl)

但我在让 apache-fop 运行时遇到了异常问题。

我能够下载垃圾箱并在本地运行它，但格式有点不对，它没有维护页眉和页脚或第 1 节或第 3 节（17 页文档 3 节）。

它还将文本重叠在大纲数字上，并且不保留使用的字体。

尝试更简单的测试导致 fop 完全失败。

我想找到一种方法来创建至少接近 100% 准确复制原始文档的 PDF。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-19T05:38:10.393

我不确定 xsl.fo，但我在 Windows 上使用[PDFCreator](http://sourceforge.net/projects/pdfcreator/)将 Microsoft 文档转换为 PDF 方面有很好的经验。它充当打印机驱动程序，所以我猜如果您在 Windows 上托管您的网络服务器（或者可能使用 Wine？），那么我想有一种方法可以使用 Perl 的 COM 桥自动调用它。

# iphone - Cocoa、Stomp、ActiveMQ、iPhone、SSL 和 AsyncSocket 需要帮助

> ID：380145
> 
> 赞同：2
> 
> 时间：2008-12-19T05:07:30.267
> 
> 标签：iphone, ssl, activemq, stomp, asyncsocket

好吧，也许不是所有 4 件事，但这是我的情况：

我有一个 ActiveMQ 后端（在我的桌面 Mac 上运行）。这是我拥有的库存 Apache ActiveMQ 服务器，我基本上将其用作回显服务器来跟踪日志并调试我的客户端。客户端是一个 iPhone 项目，它使用 AsyncSocket 进行了破解 Stomp.framework 实现。

我需要使用 AsyncSocket Cocoa 库与我或多或少工作的 Stomp 服务器对话。我可以将消息发送到队列，并将它们读回，所以我认为我在那里很好。

但是，当我尝试将所有内容设置为使用 SSL（也是一项要求）时，我从 NSError 对象中得到以下错误描述：

```
kCFStreamErrorDomainSSL error -9812. 
```

我一生都无法弄清楚这个错误代码是什么。有人有线索吗？

这是我为 AsyncSocket 设置 SSL 的方法：

编辑：在此处添加了正确的代码。注意自签名证书。

```
//- (BOOL)onSocketWillConnect:(AsyncSocket *)sock
{
// Connecting to a secure server
NSMutableDictionary * settings = [NSMutableDictionary dictionaryWithCapacity:2];

// Use the highest possible security
[settings setObject:(NSString *)kCFStreamSocketSecurityLevelNegotiatedSSL
             forKey:(NSString *)kCFStreamSSLLevel];

// Allow self-signed certificates
[settings setObject:[NSNumber numberWithBool:YES]
             forKey:(NSString *)kCFStreamSSLAllowsAnyRoot];

CFReadStreamSetProperty([sock getCFReadStream],
                        kCFStreamPropertySSLSettings, (CFDictionaryRef)settings);
CFWriteStreamSetProperty([sock getCFWriteStream],
                         kCFStreamPropertySSLSettings, (CFDictionaryRef)settings);

return YES; 
```

}

有人有想法么？我*想*我正确设置了流属性。也许这与 ActiveMQ 设置有关？除了在 ActiveMQ 中启用 SSL over Stomp 协议外，我没有进行任何配置。我没有证书或类似的东西。也许这就是问题所在？

任何见解表示赞赏！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T11:57:13.230

不知道错误代码的具体细节，但我可以告诉你，与 activemq 一起提供的证书是 noddy，仅用于测试。它们是自签名证书（本质上是无效的），它可以抛出一个客户端 ssl 库来尝试验证它们的链长度。在[ssl 代理测试](https://github.com/apache/activemq/blob/master/activemq-unit-tests/src/test/java/org/apache/activemq/transport/tcp/SslBrokerServiceTest.java)中，证书被显式添加到信任存储中，以便客户端可以接受它而不是尝试验证它。一个好的开始是为代理生成有效证书，或者想办法将现有证书添加到 AsyncSocket 使用的信任库中（虽然不知道如何配置，可能链接的 java 测试代码会有所帮助）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-05T20:16:17.240

[Mac 上的安全传输参考](http://file:///Developer/Documentation/DocSets/com.apple.ADC_Reference_Library.CoreReference.docset/Contents/Resources/Documents/documentation/Security/Reference/secureTransportRef/Reference/reference.html)

向下滚动到结果代码以查看错误代码。你得到的是`"errSSLUnknownRootCert"`. （似乎证实了 gtully 的回答。）

# c++ - 错误 LNK2001 和错误 LNK2019 (C++) -- 请求了解这些错误

> ID：380153
> 
> 赞同：2
> 
> 时间：2008-12-19T05:12:21.567
> 
> 标签：c++, linker-errors, lnk2019

好的，所以我刚刚完成了最后一个编译器错误（所以我想）并且出现了这些错误：

```
1>GameEngine.obj : error LNK2001: unresolved external symbol "public: static double WeaponsDB::PI" (?PI@WeaponsDB@@2NA)
1>Component.obj : error LNK2001: unresolved external symbol "public: static double WeaponsDB::PI" (?PI@WeaponsDB@@2NA)
1>Coordinate.obj : error LNK2019: unresolved external symbol "public: static double WeaponsDB::PI" (?PI@WeaponsDB@@2NA) referenced in function "public: double __thiscall Coordinate::distanceFrom(class Coordinate *)" (?distanceFrom@Coordinate@@QAENPAV1@@Z)
1>Driver.obj : error LNK2001: unresolved external symbol "public: static double WeaponsDB::PI" (?PI@WeaponsDB@@2NA)
1>Environment.obj : error LNK2001: unresolved external symbol "public: static double WeaponsDB::PI" (?PI@WeaponsDB@@2NA)
1>Environment.obj : error LNK2001: unresolved external symbol "public: static bool Environment::spyFlag" (?spyFlag@Environment@@2_NA)
1>Environment.obj : error LNK2001: unresolved external symbol "private: static class Environment * Environment::instance_" (?instance_@Environment@@0PAV1@A)
1>Environment.obj : error LNK2019: unresolved external symbol "public: static void __cdecl Environment::spyAlertOver(void)" (?spyAlertOver@Environment@@SAXXZ) referenced in function "public: void __thiscall Environment::notificationOfSpySuccess(void)" (?notificationOfSpySuccess@Environment@@QAEXXZ)
1>GameDriver.obj : error LNK2019: unresolved external symbol "public: static void __cdecl MainMenu::gameOver(int)" (?gameOver@MainMenu@@SAXH@Z) referenced in function "public: static void __cdecl GameDriver::run(void)" (?run@GameDriver@@SAXXZ)
1>GameDriver.obj : error LNK2019: unresolved external symbol "public: static void __cdecl GameDriver::gatherInput(void)" (?gatherInput@GameDriver@@SAXXZ) referenced in function "public: static void __cdecl GameDriver::run(void)" (?run@GameDriver@@SAXXZ)
1>GameDriver.obj : error LNK2019: unresolved external symbol "public: static void __cdecl GameDriver::ticker(void)" (?ticker@GameDriver@@SAXXZ) referenced in function "public: static void __cdecl GameDriver::run(void)" (?run@GameDriver@@SAXXZ)
1>GameDriver.obj : error LNK2001: unresolved external symbol "public: static int GameDriver::ticks" (?ticks@GameDriver@@2HA)
1>GameDriver.obj : error LNK2001: unresolved external symbol "public: static bool GameDriver::evaluatingInputFlag" (?evaluatingInputFlag@GameDriver@@2_NA)
1>GameDriver.obj : error LNK2001: unresolved external symbol "public: static bool GameDriver::keyQuitFlag" (?keyQuitFlag@GameDriver@@2_NA)
1>GameDriver.obj : error LNK2001: unresolved external symbol "public: static bool GameDriver::keyToggleWeaponRightFlag" (?keyToggleWeaponRightFlag@GameDriver@@2_NA)
1>GameDriver.obj : error LNK2001: unresolved external symbol "public: static bool GameDriver::keyToggleWeaponLeftFlag" (?keyToggleWeaponLeftFlag@GameDriver@@2_NA)
1>GameDriver.obj : error LNK2001: unresolved external symbol "public: static bool GameDriver::keyFireFlag" (?keyFireFlag@GameDriver@@2_NA)
1>GameDriver.obj : error LNK2001: unresolved external symbol "public: static bool GameDriver::keyLeftFlag" (?keyLeftFlag@GameDriver@@2_NA)
1>GameDriver.obj : error LNK2001: unresolved external symbol "public: static bool GameDriver::keyRightFlag" (?keyRightFlag@GameDriver@@2_NA)
1>GameDriver.obj : error LNK2001: unresolved external symbol "public: static bool GameDriver::keyUpFlag" (?keyUpFlag@GameDriver@@2_NA)
1>GameDriver.obj : error LNK2001: unresolved external symbol "public: static bool GameDriver::keyDownFlag" (?keyDownFlag@GameDriver@@2_NA)
1>GUI_Env.obj : error LNK2001: unresolved external symbol "private: static struct BITMAP * GUI_Env::buffer" (?buffer@GUI_Env@@0PAUBITMAP@@A)
1>GUI_Info.obj : error LNK2001: unresolved external symbol "private: static struct BITMAP * GUI_Info::buffer" (?buffer@GUI_Info@@0PAUBITMAP@@A)
1>MenuDriver.obj : error LNK2019: unresolved external symbol "public: static void __cdecl MainMenu::displayMenu(void)" (?displayMenu@MainMenu@@SAXXZ) referenced in function "public: static void __cdecl MenuDriver::start(void)" (?start@MenuDriver@@SAXXZ)
1>SpaceObjectFactory.obj : error LNK2001: unresolved external symbol "private: static class SpaceObjectFactory * SpaceObjectFactory::_instance" (?_instance@SpaceObjectFactory@@0PAV1@A)
1>Spy.obj : error LNK2019: unresolved external symbol "public: virtual bool __thiscall UnFormationable::sameTypeOfSpaceObjectAs(class SpaceObject *)" (?sameTypeOfSpaceObjectAs@UnFormationable@@UAE_NPAVSpaceObject@@@Z) referenced in function "public: virtual bool __thiscall Spy::sameTypeOfSpaceObjectAs(class SpaceObject *)" (?sameTypeOfSpaceObjectAs@Spy@@UAE_NPAVSpaceObject@@@Z)
1>WeaponsDB.obj : error LNK2001: unresolved external symbol "private: static class WeaponsDB * WeaponsDB::_instance" (?_instance@WeaponsDB@@0PAV1@A)
1>C:\Users\Owner\Desktop\Bosconian\code\Bosconian\Debug\Bosconian.exe : fatal error LNK1120: 23 unresolved externals 
```

好的，这是一个简短的概述。

PI 是 WeaponsDB 中的静态常量，其他类使用 Wea​​ponsDB::PI 和适当的#include 引用（这有什么问题？）

大多数其他错误源于 allegro 游戏库中计时器的静态变量和静态方法。

是什么导致了这些错误，我该如何摆脱它们？

提前致谢

----------------编辑-------------------

根据要求，在哪里声明和定义了 WeaponsDB::PI。它在 WeaponsDB.h 中声明：

```
public:
    static double PI; 
```

但它是在另一个类 Driver.cpp 中定义的：

```
WeaponsDB::PI = 4*atan(1.0); 
```

如果这是我的代码的问题之一，我很想知道为什么会导致错误。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-19T07:15:19.823

大多数情况下，当链接器无法检测到静态成员时，这是因为您忘记在某处真正定义它，正如之前指出的那样：

```
// header
class X {
   static const int y;
};

// cpp
const int X::y = 1; 
```

但是在您的情况下，因为您不仅缺少静态变量，而且还缺少所有其他成员，所以我敢打赌，您没有链接项目中的实现文件（.cpp）。您必须提供一个编译单元来定义在标头中声明的符号，并使环境编译并将其链接在一起。如果符号属于外部库（来自当前项目）中的编译单元，那么您必须记住与库链接。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-19T05:34:47.717

这

```
WeaponsDB::PI = 4*atan(1.0); 
```

为 PI 赋值。它不会为它创造空间（没有定义它）。

这为（定义）PI 创造了空间，并为它分配了一个值（初始化）。

```
double WeaponsDB::PI = 4*atan(1.0); 
```

您可能还应该将 PI 标记为“静态常量”，而不仅仅是“静态”。static 使其归类而不是实例所有。const 使其不可变（并启用各种优化）。

您也可以考虑使用 math.h 中的 M_PI 而不是重新创建常量。

**编辑**：括号中添加了更精确的术语：由于 WP 的评论而定义、初始化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T05:35:17.967

在一个地方声明一个变量并在另一个地方给它赋值应该不会导致任何错误。确保在引用其中定义的对象的所有文件的顶部包含 WeaponsDB.h。

例如：在 Driver.cpp 的顶部，确保出现“#include WeaponsDB.h”。

希望这可以帮助！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T18:37:44.823

通过阅读您在其他人的答案中的评论，您似乎正在为它分配一个函数内部的值。你需要有：

```
double WeaponsDB::PI = 4*atan(1.0); 
```

.. 在你的实现文件的全局范围内（意味着不在函数内部），大概是 WeaponsDB.cpp。在那种情况下，“const”它是合适的。事实上，您可以跳过将其放入 .cpp 的部分，直接在 WeaponsDB.h 中进行：

```
public:
    static const double PI = 4*atan(1.0); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T18:41:09.403

大量的静态成员丢失了。是否将静态成员定义集中在一个文件中，然后不链接该文件？

# .net - 关于在 .NET 中分离项目的建议

> ID：380162
> 
> 赞同：1
> 
> 时间：2008-12-19T05:18:33.803
> 
> 标签：.net, architecture

我正在寻找一些关于在 .NET 中分离项目的建议。我正在构建一个大型 Windows 窗体应用程序（80 个表），但我只有几个项目。它们变得相当大。当我前几天看到参考列表时，我注意到了这个问题。这是我第一次创建这么大的应用程序，所以项目的命名和它们的分离变得有点混乱。

这是我所拥有的，以及每个项目的关注点。

ProjectName.Dal（数据访问，这是为我自动生成的，我不碰它。）

ProjectName.Bll（存储库、与 Web 服务通信、生成电子邮件、生成 excel 和 word 文档）

ProjectName.Model（域对象）

ProjectName.UI（Windows 窗体和用户控件）

ProjectName.UI.Web（系统的小Web界面的一些网页）

ProjectName.UI.Controls（通用自定义窗体控件）

ProjectName.UI.Presenters（MVP 表单的几个演示者）

ProjectName.Reminder（用于提醒人们做事的应用程序的 Web 服务）

ProjectName.Tests（处理所有单元测试） - 我不确定每个项目是否应该有一个测试项目，例如 ProjectName.UI.Presenters.Tests

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T05:36:09.897

我喜欢从你已经提到的那些中分离出来作为一个单独的程序集的一件事是一个“代理”项目。

假设您正在表示层中使用您的 Web 服务之一。我不想在表示层直接引用服务（wcf/.asmx），而是有一个单独的项目专门用于封装该服务的代理。我通常在代理本身周围有一个包装器类，以帮助管理故障并确保代理始终可用于表示层（如果没有，则提供良好的异常），并在代理之外提供良好的表示层对象。例如，我可能想将 Widget[] 而不是小部件的 DataTable 从我的服务传递给我的代理，以使其一切都很好并且兼容（显然我们不想将 DataTables 从服务中传递出去，因为它们都是但无法理解。xsd 级别）但是 DataTables 很适合在表示层中绑定，因此我将获取该小部件 [] 的实际代理包装为“managedProxy”，该代理执行从数组到 DataTable 的转换以及管理代理调用。在类级别将代理与表示层分离，然后通过将其推入它自己的项目中更进一步。这使得它更便于移动到当下的下一个 pres 层。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T05:39:15.663

就我而言，这太过分了。

我认为最好的结构是这样的：

*   项目名称.Dal
*   项目名称.Bll
*   项目名称.模型
*   项目名称.UI
*   项目名称.提醒

测试*可以*包含在它所针对的每个项目中，在一个单独的文件夹/命名空间中，但这还有待于另一场辩论。

说真的，在一个解决方案中拥有太多项目不仅会减慢您的机器速度，而且会损害您对仍然可以协同工作的耦合对象的理智。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T06:55:58.693

使用项目中的文件夹根据域进一步将您的类彼此分开。此外，您可以在 Visual Studio 中创建解决方案文件夹，这些是可用于对解决方案中的项目进行分组的虚拟文件夹。右键单击解决方案资源管理器中的解决方案，并创建一个测试文件夹，例如，您可以将测试项目放在那里，将项目设置到另一个项目中，等等......您可能还想分解其他域.

# networking - 二层逻辑链路层的主要工作是什么

> ID：380163
> 
> 赞同：0
> 
> 时间：2008-12-19T05:18:45.690
> 
> 标签：networking, osi, data-link-layer

我很想知道逻辑链路层的作用。它的主要意义是什么？它是软件的一部分吗？

我正在寻找 LLC 的一些详细信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T05:40:58.687

LLC 子层主要关注：

```
* Multiplexing protocols transmitted over the MAC layer (when transmitting) and demultiplexing them (when receiving).
* Providing flow and error control 
```

IEEE 802 网络和某些非 IEEE 802 网络（如 FDDI）中用于 LLC 的协议由[IEEE 802.2 标准](http://standards.ieee.org/getieee802/download/802.2-1998.pdf)指定。

一些非 IEEE 802 协议可以被认为被分为 MAC 和 LLC 层。例如，虽然 HDLC 指定 MAC 功能（数据包的成帧）和 LLC 功能（协议多路复用、流控制、检测和通过在指示时重传丢弃的数据包来控制错误），但某些协议（如 Cisco HDLC）可以使用类似 HDLC数据包成帧和他们自己的 LLC 协议。

LLC 报头告诉数据链路层在接收到帧后如何处理数据包。它的工作原理是这样的：主机将接收一个帧并查看 LLC 报头以找出数据包的目的地——例如，网络层的 IP 协议或 IPX。

LLC 还对 SN-PDU (SNDCP) 数据包进行加密和解密。

以上详细信息可在 Wikipedia 上找到。 [http://en.wikipedia.org/wiki/Logical_Link_Control](http://en.wikipedia.org/wiki/Logical_Link_Control)

# matrix - 如何计算矩阵的逆？

> ID：380165
> 
> 赞同：0
> 
> 时间：2008-12-19T05:20:58.353
> 
> 标签：matrix, visual-c++-6, matrix-inverse

有人可以告诉我如何计算矩阵的逆吗？我正在使用 VC++ 6.0

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T06:05:39.387

MFC 不是数值方法的工具。

* * *

计算 nxn 矩阵的逆矩阵很简单。我给你算法：

```
/*  I took this from my implementation of CMatrix
 *  It works, but I'm not sure if it's the most efficient algorithm.
 *
 *  1\. Start with Q = Identity, whose inverse is R = Identity.
 *  2\. Set i = 0
 *  3\. Replace the i-th column (zero-based count) vector of Q with the i-th
 *     column of the input matrix. This is an update of rank 1, so...
 *  4\. Using the Sherman-Morrison formula, update R (the inverse of Q).
 *  5\. The Sherman-Morrison formula also updates the determinant of the matrix.
 *     If it's zero, then the original matrix was not invertible.
 *  6\. Increment i
 *  7\. If i = n, stop
 *
 *  NOTES:
 *
 *  This algorithm has the advantage of calculating the determinant of the original
 *  matrix in the process.
 *
 *  My CMatrix class allows for general m*n matrices, it has these members:
 *  ldouble** x;    // there's a typedef long double ldouble; in the header
 *  UINT row, col;  // row count, column count
 *
 *  My CMatTmp class is similar to CMatrix (it has the same members),
 *  but it represents a temporal matrix used in internal calculations
 *
 *  My CVector class allows for n-dimensional vectors, it has these members:
 *  ldouble* x;
 *  UINT dim;
 */

CMatTmp CMatrix::DetInv(ldouble& det) const
{
    // The matrix must be square.
    if (row != col) throw 0;

    CMatTmp Rc(row), Rn(row);  // Start with identity row*row matrices
    CVector cc(row), lf(row);
    det = 1;

    for (UINT j = 0; j < col; ++j)
    {
        // Get the j-th column vector and subtract one from its j-th component.
        for (UINT i = 0; i < row; ++i)
            cc.x[i] = x[i][j];
        cc.x[j] -= 1;

        // Test whether the Sherman-Morrison corrector can be applied.
        lf = Rc * cc;
        ldouble den = 1 + lf.x[j];
        if (!abs(den))
        {
            det = 0;
            return CMatTmp(row,col);
        }

        // Update the determinant.
        det *= den;

        // Apply the Sherman-Morrison corrector.
        for (UINT i = 0; i < row; ++i)
            for (UINT k = 0; k <= j; ++k)
                Rn.x[i][k] -= lf.x[i] * Rc.x[j][k] / den;

        // Copy all relevant data from Rn to Rc.
        for (UINT i = 0; i < row; ++i)
            for (UINT k = 0; k <= j; ++k)
                Rc.x[i][k] = Rn.x[i][k];
    }

    return Rc;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T06:00:04.170

另一个很好的来源是[Numerical Recipes](http://www.nr.com/)，尽管这可能有点矫枉过正。

# asp.net - 限制访问 asp.net 网站的用户数量

> ID：380167
> 
> 赞同：4
> 
> 时间：2008-12-19T05:23:08.410
> 
> 标签：asp.net

限制访问 Web 应用程序的（并发）用户数量的最佳方法是什么，任何人都可以引入以向客户销售网站/应用程序，以及如何增加远程访问它的用户数量？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-19T07:38:55.033

如果您使用进程内会话状态管理，您可以使用[HttpApplicationState](http://msdn.microsoft.com/en-us/library/system.web.httpapplicationstate.aspx)类，方法是引入 Global.asax 文件并将类似这样的内容放在后面的代码中：

```
void Application_Start(object sender, EventArgs e)
{
    Application["ActiveSessions"] = 0;
}

void Session_Start(object sender, EventArgs e)
{
    try
    {
        Application.Lock();

        int activeSessions = (int) Application["ActiveSessions"] + 1;
        int allowedSessions = 10; // retrieve the threshold here instead

        Application["ActiveSessions"] = activeSessions;

        if (activeSessions > allowedSessions)
            System.Web.HttpContext.Current.Response.Redirect("~/UserLimitReached.aspx", false);
    }
    finally
    {
        Application.UnLock();
    }
}

void Session_End(object sender, EventArgs e)
{
    Application.Lock();
    Application["ActiveSessions"] = (int)Application["ActiveSessions"] - 1;
    Application.UnLock();
} 
```

然后，在 UserLimitReached.aspx 中，您将调用 HttpSession.Abandon() 来有效地终止当前会话，使其不计入限制。其余的你必须自己弄清楚。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T05:39:55.833

一种方法是跟踪数据库中的活动会话，每次用户登录时，检查活动会话的数量。如果它低于阈值，让他们进来，如果不是，反弹他们。

要远程管理这个号码，一个简单的管理表单可以让您更新数据库中的阈值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T07:49:03.950

除了前面的答案之外，我认为您还需要引入自己的超时时间，这样会话就不会拖延和锁定。如果您有登录名，而不是使用会话，您可以根据登录名对其进行监控，并通过在字典/数组中记录每个用户的最新活动来保持它们处于活动状态。这应该可以很容易地查看哪些用户正在使用该站点，以及哪些是最近活跃的用户。如果您将其与会话绑定，您可能会使最近最少活动用户使用的会话过期。这样做的效果是，如果超过指定数量的用户尝试使用该网站，一些（最不活跃的）将继续需要登录。鉴于网络应用程序的断开连接性质，我认为您可能必须允许一定百分比的宽限，以便当限制为 20 个用户时，您实际上可能允许 22 个同时活动。

# c# - 用于在另一个字符串中查找部分字符串的正则表达式

> ID：380171
> 
> 赞同：3
> 
> 时间：2008-12-19T05:32:38.657
> 
> 标签：c#, regex

我有两个字符串：第一个是“catdog”，第二个是“got”。

我试图找到一个正则表达式来告诉我“got”的字母是否在“catdog”中。我特别希望避免出现重复字母的情况。例如，我知道“got”是一个匹配项，但是“gott”不是一个匹配项，因为“catdog”中没有两个“t”。

编辑：

根据 Adam 在下面的回复，这是我在解决方案中必须使用的 C# 代码。感谢所有回复的人。

注意：我必须将 char 转换为 int 并减去 97 以获得数组的适当索引。在我的情况下，字母*总是*小写。

```
 private bool CompareParts(string a, string b)
    {

        int[] count1 = new int[26];
        int[] count2 = new int[26];

        foreach (var item in a.ToCharArray())
            count1[(int)item - 97]++;

        foreach (var item in b.ToCharArray())
            count2[(int)item - 97]++;

        for (int i = 0; i < count1.Length; i++)
            if(count2[i] > count1[i])
                return false;

        return true;
    } 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-19T06:01:24.823

您为这项工作使用了错误的工具。这不是正则表达式能够轻松处理的事情。幸运的是，没有正则表达式相对容易做到这一点。您只需计算两个字符串中每个字母的出现次数，然后比较两个字符串之间的计数 - 如果对于字母表中的每个字母，第一个字符串中的计数至少与第二个字符串中的计数一样大，那么你的条件就满足了。由于您没有指定语言，因此这里有一个伪代码答案，应该很容易翻译成您的语言：

```
bool containsParts(string1, string2)
{
    count1 = array of 26 0's
    count2 = array of 26 0's

    // Note: be sure to check for an ignore non-alphabetic characters,
    // and do case conversion if you want to do it case-insensitively
    for each character c in string1:
        count1[c]++
    for each character c in string2:
        count2[c]++

    for each character c in 'a'...'z':
        if count1[c] < count2[c]:
            return false

    return true
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-19T20:40:04.797

以前的建议已经提出，也许正则表达式不是最好的方法，我同意，但是，考虑到你想要达到的目标，你接受的答案有点冗长，那就是测试是否有一组字母是另一组字母的子集。

考虑以下代码，它在一行代码中实现了这一点：

```
MatchString.ToList().ForEach(Item => Input.Remove(Item)); 
```

可以按如下方式使用：

```
public bool IsSubSetOf(string InputString, string MatchString) 
{
  var InputChars = InputString.ToList(); 
  MatchString.ToList().ForEach(Item => InputChars.Remove(Item)); 
  return InputChars.Count == 0;
} 
```

然后，您可以调用此方法来验证它是否是子集。

这里有趣的是“got”将返回一个没有项目的列表，因为匹配字符串中的每个项目只出现一次，但“gott”将返回一个包含单个项目的列表，因为只有一个调用来删除列表中的“t”。因此，您将在列表中留下一个项目。也就是说，“gott”不是“catdog”的子集，但“got”是。

您可以更进一步，将该方法放入静态类中：

```
using System;
using System.Linq;
using System.Runtime.CompilerServices;

static class extensions
{
    public static bool IsSubSetOf(this string InputString, string MatchString)
    {
        var InputChars = InputString.ToList();
        MatchString.ToList().ForEach(Item => InputChars.Remove(Item));
        return InputChars.Count == 0;
    }
} 
```

这使您的方法成为字符串对象的扩展，从长远来看实际上使变薄变得容易得多，因为您现在可以像这样进行调用：

```
Console.WriteLine("gott".IsSubSetOf("catdog")); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T05:52:20.660

您想要一个与这些字母完全匹配的字符串，只匹配一次。这取决于你用什么写正则表达式，但它会是这样的

```
^[^got]*(g|o|t)[^got]$ 
```

如果您有一个“完全匹配”的运算符，那将有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T05:57:04.613

我不认为有一种理智的方法可以用正则表达式来做到这一点。疯狂的方法是写出所有排列：

```
/^(c?a?t?d?o?g?|c?a?t?d?g?o?| ... )$/ 
```

现在，通过一些技巧，您可以使用一些正则表达式来做到这一点（Perl 中的示例，未经测试）：

```
$foo = 'got';
$foo =~ s/c//;
$foo =~ s/a//;
...
$foo =~ s/d//;
# if $foo is now empty, it passes the test. 
```

当然，理智的人会使用循环：

```
$foo = 'got'
foreach $l (split(//, 'catdog') {
    $foo =~ s/$l//;
}
# if $foo is now empty, it passes the test. 
```

当然，有更好的方法来实现这一点，但它们不使用正则表达式。毫无疑问，如果您可以使用 Perl 的扩展正则表达式功能（如嵌入式代码），则可以使用这些方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T08:05:25.243

查理马丁几乎是正确的，但你必须为每封信做一个完整的传递。您可以使用一个正则表达式来做到这一点，方法是对除最后一遍之外的所有内容使用前瞻：

```
/^
 (?=[^got]*g[^got]*$)
 (?=[^got]*o[^got]*$)
 [^got]*t[^got]*
$/x 
```

这对于磨练你的正则表达式技能是一个很好的练习，但如果我必须在现实生活中这样做，我不会这样做。非正则表达式方法将需要更多的输入，但任何能力最低的程序员都能够理解和维护它。如果您使用正则表达式，那么假设的维护者也必须在正则表达式方面具有超乎寻常的能力。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-19T09:05:02.347

@Adam Rosenfield 在 Python 中的解决方案：

```
from collections import defaultdict

def count(iterable):
    c = defaultdict(int)
    for hashable in iterable:
        c[hashable] += 1
    return c

def can_spell(word, astring):
    """Whether `word` can be spelled using `astring`'s characters."""

    count_string = count(astring)
    count_word   = count(word)

    return all(count_string[c] >= count_word[c] for c in word) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-19T22:44:53.063

使用正则表达式的最佳方法是，IMO：

A. 对大字符串中的字符进行排序（搜索空间） 因此：把“catdog”变成“acdgot”

B.

1.  对搜索字符的字符串执行相同操作：“gott”变成，嗯，“gott”......

2.  `.*`在每个字符之间插入“ ”

3.  使用后者作为正则表达式在前者中搜索。

例如，一些 Perl 代码（如果你不介意的话）：

```
$main = "catdog"; $search = "gott";
# break into individual characters, sort, and reconcatenate
$main = join '', sort split //, $main;
$regexp = join ".*", sort split //, $search;
print "Debug info: search in '$main' for /$regexp/ \n";
if($main =~ /$regexp/) {
    print "Found a match!\n";
} else {
    print "Sorry, no match...\n";
} 
```

这打印：

```
Debug info: search in 'acdgot' for /g.*o.*t.*t/
Sorry, no match... 
```

放下一个“t”，你会得到一个匹配。

# macos - 在 Mac 上读取 syslog 输出

> ID：380172
> 
> 赞同：67
> 
> 时间：2008-12-19T05:34:07.750
> 
> 标签：macos, syslog

我有一个为 linux 编写的程序，我正在尝试在我的 MacOS 10.5 机器上构建和运行它。该程序可以毫无问题地构建和运行，但是它会多次调用 syslog。我知道 syslogd 正在我的 mac 上运行，但是我似乎无法找到我的 syslog 调用的输出位置。

syslog 调用的形式为

```
syslog (LOG_WARNING, "Log message"); 
```

知道在哪里可以找到我的日志输出吗？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2013-01-24T16:14:50.150

`/var/log/system.log`

You can monitor it easily using `tail -f /var/log/system.log`

See also the "logger" (`man logger`) and "syslog" (`man syslog`).

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2008-12-19T05:56:17.143

您可能应该使用 Console.app 来查看日志文件。它是珀迪。

在左侧选择您的设备并在右侧过滤消息：

[![在此处输入图像描述](https://i.stack.imgur.com/ui8BD.png)](https://i.stack.imgur.com/ui8BD.png)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2017-10-19T11:45:50.870

可能值得注意的是：Apple 过去使用的是真实`syslogd`的，但同时所有这些都已切换到 ASL（Apple 系统日志）。该`syslog`命令仍然可用，但它只会访问这一个日志。如果要访问配置的所有日志文件中的所有 ASL 日志消息，请使用该`log`命令。

例如，以下显示了 Safari 在过去两天内生成的所有日志消息（请耐心等待，可能需要一段时间）：

```
log show --predicate 'process == "Safari"' --last 2d 
```

查看`man log`您可以执行的所有操作、它知道的所有参数以及您可以过滤的属性。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-12-19T05:46:17.523

有疑问时，总会有`man syslog`。

您可以在 中找到您的消息`/var/log/syslog`；我的机器开箱即用，仅包含高级消息，因此您可能需要进行设置。

您还可以通过*syslog(1)*阅读消息，或使用类似的命令创建测试消息

```
$ syslog -s -l INFO "Hello, world." 
```

使用 P（“恐慌”）的严重性，您将立即在控制台上收到令人兴奋的消息。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2010-01-03T13:29:39.413

Mac OS X 实现[了 syslog 功能的超集](http://boredzo.org/blog/archives/2008-01-19/next-week-apple-system-logger)。所有的系统日志都在那里，但作为 ASL 的一部分。

Matthew Schinckel 在他的回答中提到的控制台是 ASL 上的 GUI。它将向您显示数据库中存在的任何消息，这些消息由侧栏中列出的查询获取。默认有两个查询；一个只显示使用控制台工具发送的消息（`NSLog`除其他外，由 使用），而另一个显示*所有*日志消息。检查所有消息查询；你可能会在那里找到你的信息。

这个“全部”确实带有星号。如果你查看 /etc/asl.conf，你会看到这一行：

```
# save everything from emergency to notice
? [<= Level notice] store 
```

幸运的是，在您的情况下，消息将通过此检查，因为警告高于（小于）通知。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-19T06:22:35.983

在查理的回答的基础上，我想补充一点，您应该查看手册页`syslog.conf(5)`并查看文件`/etc/syslog.conf`（这是默认定义系统日志配置的位置，而且，正如我所见，在 OS X 10.5.x)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-03T13:30:39.367

检查`openlog`程序中某处的调用。调用`openlog`,后`syslog`会将其输出保存到该日志文件而不是默认位置。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2022-02-05T21:51:12.347

如果您需要复杂`syslog`的分析（在终端中逐小时导航、正则表达式、实时比较 w\ 其他文件，甚至运行 SQL `syslog`） ， [lnav](https://github.com/tstack/lnav)将为您无缝提供。

安装：

```
brew install lnav 
```

用法：

```
lnav /var/log/system.log 
```

用户界面本身：

[![在此处输入图像描述](https://i.stack.imgur.com/ogLLR.png)](https://i.stack.imgur.com/ogLLR.png)

# linq-to-sql - 使用 Linq to SQL 的下一个和上一个链接

> ID：380182
> 
> 赞同：0
> 
> 时间：2008-12-19T05:39:53.103
> 
> 标签：linq-to-sql

我需要将“下一个”和“上一个”链接添加到按日期顺序显示消息的网页。SQL 表包含 MessageNumber、Subject 和 Date。目前我正在使用一个使用 ROW_NUMBER 函数的存储过程：

```
使用 MessageList AS
(
选择 msg_num，
row_number() over (order by msg_date) as rownum
来自 tblHeaders)

选择

        nextrow.msg_num AS NextMsg
从
        消息列表currow
LEFT JOIN MessageList nextrow
        ON currow.rownum = nextrow.rownum - 1
LEFT JOIN MessageList prevrow
        ON currow.rownum = prevrow.rownum + 1
其中 currow.msg_num = @msgnum

```

使用 Linq to SQL 如何在给定当前消息编号以及表格按日期顺序排序的位置生成指向“下一个”和“上一个”消息编号的链接？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T08:47:29.700

Skip() and Take() can be used for paging functionality.

For example:

```
Queryable<Customer> custQuery3 =
    (from custs in db.Customers
     where custs.City == "London"
     orderby custs.CustomerID
     select custs)
    .Skip(1).Take(1); 
```

[http://msdn.microsoft.com/en-us/library/bb386988.aspx](http://msdn.microsoft.com/en-us/library/bb386988.aspx)

# css - 使用 CSS 将文本环绕在 div 周围

> ID：380184
> 
> 赞同：27
> 
> 时间：2008-12-19T05:40:12.603
> 
> 标签：css, xhtml

`div`我试图在我的 XHTML中获得一个环绕 a 的文本。我的 XHTML 看起来像这样......

```
<div id="cont-content">

<p>content</p>

<p>more content</p>

<div id="content-sidebar">

 BLALALALALLAAL

 </div>

  </div> 
```

我的CSS看起来像......

```
#content-sidebar {
    display: block;
    float: right;
    width: 270px;
    height: 400px;
    border: 1px solid red;
} 
```

你能看出为什么文本不会环绕这个 Div 的任何原因吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-27T06:08:49.870

是的，你明白了。#content-sidebar 应该在所有应该包装它的文本之前。像这样：

```
<div id="cont-content">

<div id="content-sidebar">

 BLALALALALLAAL

 </div>

<p>content</p>

<p>more content</p>

  </div> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-24T13:40:02.040

1.  将您的图像切成相关的切片并裁剪掉您希望文本流动的部分。你做的切片越多，你的包裹就会越漂亮。

2.  将这些切片放入您的 HTML 中。给他们一个名为“wrap”的类，如下所示：

    ```
    <img src="slice1.png" width="181" class="wrap">
    <img src="slice2.png" width="287" class="wrap">
    <img src="slice3.png" width="217" class="wrap"> 
    ```

3.  放入你的CSS：

    ```
    .wrap {
        float: left; 
        clear: left; 
        margin: 0  0.9em 0 0;
    } 
    ```

这会将您的切片浮动到左侧并将它们保持在一起作为一个图像，让您的文本在右侧流动。边距设置将在图像和文本之间创建边距。

如果您希望图像漂浮在右侧，请裁剪掉切片的另一侧并使用：

```
.wrap {
    float: right; 
    clear: right; 
    margin: 0 0 0 0.9em ;
} 
```

# c# - 如何在 C# 中将函数作为参数传递？

> ID：380198
> 
> 赞同：55
> 
> 时间：2008-12-19T05:53:53.200
> 
> 标签：c#, reflection

是否可以在 C# 中将函数作为参数传递？我可以使用 Func 或 Action 类来做到这一点，但这迫使我一次声明整个函数签名。当我尝试使用 Delegate 时，我收到一个编译错误，说它无法将方法组转换为 Delegate。

我正在研究[Axial](http://www.codeplex.com/axial)，并试图让用户调用 Web 服务。我想要的是创建 Visual Studio 代理类然后传入生成的函数的能力。函数签名无关紧要，因为生成的代码只使用函数名。但是，我想传入函数而不是名称，原因有两个：使用代理的 Url 属性的能力以及如果 Web 服务不存在或在 Visual Studio 中更新时出现编译器错误。

```
 public void AlertIt(object o) {
    Axial.DOM.Window.Alert(o.ToString());
}
public void CallAddService() {
    object[] param = new object[] { int.Parse(txtA.Text), int.Parse(txtB.Text) };
    Axial.ServerScript.CallWebService(new WSProxy.WS().Add, param, AlertIt, AlertIt);
}

class Axial.ServerScript {
    public void CallWebService(Delegate method, object[] param, Action<object> successCallback, Action<object> failureCallback) {
        // translate to javascript (already working)
    }
} 
```

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-12-19T06:27:50.527

我想你想要的是：

```
static object InvokeMethod(Delegate method, params object[] args){
    return method.DynamicInvoke(args);
}

static int Add(int a, int b){
    return a + b;
}

static void Test(){
    Console.WriteLine(InvokeMethod(new Func<int, int, int>(Add), 5, 4));
} 
```

打印“9”。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2008-12-19T08:17:07.327

将方法组、匿名方法或 lambda 表达式转换为委托需要编译器知道确切的委托类型。但是，您可能会使用 lambda 表达式和捕获的变量来简化此操作：

```
public void InvokeMethod(Action action)
{
    action();
}

public int Add(int a, int b)
{
    return a + b;
}

public void Test()
{    
    InvokeMethod(() => Add(2, 3));
} 
```

这基本上以正常方式延迟了调用，但是通过将实际调用包装`Add`在一个普通的`Action`委托中。

如果这不能满足您的要求，也许您可​​以告诉我们更多关于您真正想要实现的目标。

编辑：如果这是生成的代码，您可以`Func<...>`使用正确的类型参数转换为 a - 假设没有太多。除此之外，没有真正的方法只是传递一个方法组。偶尔会调用“infoof(...)”运算符（如 typeof，但用于成员），它会为您提供 MemberInfo，但实际上并不存在。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-19T06:22:43.983

你应该先有一个代表

```
delegate int Operation(int a, int b) 
```

然后它变成：

```
public void InvokeMethod(Operation method, object target, object param)
{
    method((int) target, (int) param);
} 
```

无需调用 Invoke。

与 dbone 一样，我不确定您为什么需要一个 params[] 数组。你能澄清一下参数的扩展用法吗？

另外，我必须纠正你的问题，因为它会导致编译错误：p

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-19T06:14:44.047

请看看在这里使用代表是一个很好的例子

[委托示例](http://www.c-sharpcorner.com/UploadFile/Ashush/Delegates02152008155757PM/Delegates.aspx)

你为什么要使用反射？会有不同数量的参数吗？或者您知道方法签名将保持不变（还记得 C# 支持 params[] 关键字）

[参数 c#](http://msdn.microsoft.com/en-us/library/w5zay9db(VS.71).aspx)

高温高压

骨头

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-19T14:38:13.933

查看 Justin Etheredge 的[函数式编程系列](http://web.archive.org/web/20110720022241/https://www.codethinked.com/category/functional-programming-series)。您应该在那里找到解决问题的方法。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-07-26T09:19:14.517

对于已经熟悉 ( **C/C++/VB.NET/Python ) 风格的****指针/引用**传递函数（使用**C# 委托**）的程序员来说，这是一个非常简单的示例：

```
 delegate void CALLBACK(String s);
        static void Main(string[] args)
        {

            Get("some string", testfunc);

            Util.pause();
        }

        static void Get(String s, CALLBACK x)
        {
            x(s);
        }

        static void testfunc(String s)
        {
            Console.WriteLine(s);
        } 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-06-23T18:53:42.460

假设您需要将方法作为参数传递，并且需要捕获返回值以进行进一步处理。那么上面的例子就可以正常工作了。但是如果你需要传递一个返回类型为 void 的方法，那么你需要创建一个 InvokeMethod 函数的另一个版本。检查下面的示例。

```
private static T retry<T>(Delegate method, params object[] args)
{
    for (int i = 0; i <= 3; i++)
    {
        try
        {
            return (T)method.DynamicInvoke(args);
        }
        catch (Exception ex)
        {
            if (i == 3)
            {
                logMessage(ex.Message);
            }
            Console.WriteLine("Retry count " + i);
            Thread.Sleep(10);
        }
    }
    return default(T);
}

private static void retry2(Delegate method, params object[] args)
{
    for (int i = 0; i <= 3; i++)
    {
        try
        {
            method.DynamicInvoke(args);
            break;
        }
        catch (Exception ex)
        {
            if (i == 3)
            {
                logMessage(ex.Message);
                //return default(T);
            }
            Console.WriteLine("Retry count " + i);
            Thread.Sleep(10);
        }
    }
}
static bool isSuccess = true;
static void logMessage(string msg)
{
    isSuccess = false;
    Console.WriteLine(msg);
}

static int Add(int a, int b)
{
    return a + b;
}

static void Add2(int a, int b)
{
    int c = a + b;
    Console.WriteLine(c);
}

static void Main(string[] args)
{
    int d = retry<int>(new Func<int, int, int>(Add), 6, 7.7);
    Console.Write("  " + d + "\n"+isSuccess);

    retry2(new Action<int, int>(Add2), 45, 60);

    Console.ReadKey();
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-19T06:23:53.780

像这样的东西应该适合你：

```
delegate int MyDelegate(int a, int b);
public int Add(int a, int b) {
    return a + b;
}
public void InvokeMethod(Delegate method, object[] param) {
    Console.WriteLine(method.DynamicInvoke(param));
}
public Form1() {       
    InitializeComponent();
    InvokeMethod(new MyDelegate(Add), new object[] { 1, 2 });
} 
```

祝你好运！

# perl - 是否有不能在 CGI 中使用的 Perl 模块？

> ID：380203
> 
> 赞同：3
> 
> 时间：2008-12-19T05:57:12.117
> 
> 标签：perl, module, cgi

我最近遇到了一个问题，Tie::File 证明了我可以为 Perl 程序使用的最佳答案。我已经准备好使用 CGI，我需要问：是否有不能在 CGI 中使用的 Perl 模块，尤其是 Tie::File？如果有任何并发​​症，有没有办法调和它们？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-19T06:04:43.430

CGI 基本上只是一个程序，它读取 STDIN 上的请求并在 STDOUT 上喷出标头 + HTML。它并不是很特别：如果你足够努力，没有任何模块是你不能使用的。

你甚至可以得到足够痛苦的图形（例如，GTK）。不是你想要的。除非您是第三方供应商，否则我对为其工作感到不快。

但是请记住，您的程序的多个副本可能同时运行（每个同时的 Web 请求一个），因此如果您使用的是平面文件，则必须处理锁定问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-10T19:02:14.587

确保您的数据文件可被 CGI*进程*读写。我添加这个答案是因为它导致了一个非常奇怪的错误。我有一个不能从 CGI 运行的脚本。事实上，CGI 可以很好地读取数据的内容，但是 Tie::File 失败了（即使我从命令行调用它也可以正常工作）。事实证明，权限设置为 -rw-rw-r-- 这意味着世界可读，但只有我的用户和组可以写入它。由于 CGI 进程没有写入权限，因此 Tie::File 在 CGI 中失败。

# c# - WPF问题刷新绑定到console.stdout的文本块

> ID：380215
> 
> 赞同：1
> 
> 时间：2008-12-19T06:06:48.760
> 
> 标签：c#, wpf, user-interface, console, refresh

我正在用 C# 构建一个小型 wpf 应用程序。当单击按钮时，第三方 dll 函数会构造一个树状对象。此对象绑定到树视图。这工作正常，但需要一些时间来加载。当 dll 函数构造对象时，它将进度信息打印到控制台。我想将此重定向到 TextBlock 以便用户看到进度消息。

我的窗口 ctor 看起来像这样：

```
初始化组件（）；
StringRedir s = new StringRedir(ref ProgressTextBlock);
Console.SetOut(s);
Console.SetError(s);
this.DataContext = s;

```

xml:

```
<TextBlock 文本="{绑定路径=文本}" 宽度="244"
x:Name="ProgressTextBlock" TextWrapping="Wrap" />
<树视图 >... </树视图 > 

```

StringRedir 类如下所示。问题是 TextBlock 出于某种原因在加载 TreeView 之前不会更新消息。单步执行我看到 Text 属性正在更新，但 TextBlock 没有得到刷新。我在 Text 被更新的地方添加了一个 MessageBox.Show () ，这似乎导致窗口每次都刷新并且我能够看到每条消息。所以我想我需要一些方法来显式刷新屏幕......但这没有意义我认为当属性更改时数据绑定会导致视觉刷新。我在这里想念什么？如何让它刷新？任何建议表示赞赏！

```
public class StringRedir : StringWriter , INotifyPropertyChanged 
{ 
    private string text; 
    private TextBlock local; 

    public string Text { 
        get{ return text;} 
        set{ 
            text = text + value; 
            OnPropertyChanged("Text"); 
        } 
    } 

    public event PropertyChangedEventHandler PropertyChanged; 
    protected void OnPropertyChanged(string name) 
    { 
        PropertyChangedEventHandler handler = PropertyChanged; 
        if (handler != null) 
        { 
            handler(this, new PropertyChangedEventArgs(name)); 
        } 
    } 

    public StringRedir(ref TextBlock t) 
    { 
        local = t; 
        Text = ""; 
    } 

    public override void WriteLine(string x) 
    { 
        Text = x +"\n"; 
        //MessageBox.Show("hello"); 
    } 

} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T09:27:34.393

您没有包含为 加载数据的代码`TreeView`，但我猜它是在 UI 线程上完成的。如果是这样，这将阻止任何 UI 更新（包括对 的更改`TextBlock`），直到它完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T09:42:21.130

因此，在阅读了 WPF 线程模型 ( [http://msdn.microsoft.com/en-us/library/ms741870.aspx](http://msdn.microsoft.com/en-us/library/ms741870.aspx) ) 之后，我终于通过调用 Dispatcher Invoke() 并将 Dispatch 优先级设置为 Render 来刷新它。正如上面 Kent 建议的那样，调度程序队列中的 UI 更新可能是低优先级的。我最终做了这样的事情。

XAML

```
<TextBox VerticalScrollBarVisibility="Auto"  
         Text="{Binding Path=Text, NotifyOnTargetUpdated=True}"
         x:Name="test" TextWrapping="Wrap" AcceptsReturn="True" 
         TargetUpdated="test_TargetUpdated"/> 
```

C# 目标更新的处理程序代码

```
private void test_TargetUpdated(对象发送者，DataTransferEventArgs e)
{
    文本框 t = 作为文本框的发件人；
    t.ScrollToEnd();
    t.Dispatcher.Invoke(new EmptyDelegate(() => { }), System.Windows.Threading.DispatcherPriority.Render);
}

```

注意：之前我使用的是 TextBlock，但我更改为 TextBox，因为它带有滚动功能

不过，我仍然对整个流程感到不安。有一个更好的方法吗？感谢马特和肯特的评论。如果我有积分会将他们的答案标记为有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T06:50:43.103

我相信问题出在 StringRedir 类的构造函数中。您正在传入 ProgessTextBlock，并且正在对它执行以下操作：

```
local.Text = ""; 
```

这有效地*覆盖*了之前为 ProgressTextBlock.Text 设置的值，即：

```
{Binding Text} 
```

明白了吗？通过显式设置 TextBlock 的 Text 属性的值，您已经取消了绑定。

如果我没看错，看起来将 TextBlock 传递给 StringRedir 的 ctor 的想法是在您尝试直接绑定之前的遗留问题。我会放弃它并坚持绑定的想法，因为它更多地体现在 WPF 的“精神”中。

# delphi - 在delphi中最大化表单的正确方法（无标题）

> ID：380217
> 
> 赞同：5
> 
> 时间：2008-12-19T06:07:59.600
> 
> 标签：delphi, winapi

我有一个没有标题的表单，使用双击最大化：代码如下所示：

```
procedure xxxxxx; 
begin
    if Form1.WindowState=wsNormal then
       begin
        Form1.WindowState:=wsMaximized;
        Form1.SetBounds(0,0,screen.Width,screen.Height-getHeightOfTaskBar);
       end
       else
       begin
         Form1.WindowState:=wsNormal;
       end;

       ShowTrayWindow;
end;
function getHeightOfTaskBar : integer;
var hTaskBar:HWND;
    rect : TRect;
begin
     hTaskbar := FindWindow('Shell_TrayWnd', Nil );
     if hTaskBar<>0 then
        GetWindowRect(hTaskBar, rect);

     Result:=rect.bottom - rect.top;
end; 
```

这很好用，除了我必须弄清楚任务栏在哪里重置 SetBounds ...

这样做的正确方法是什么？

谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-19T07:14:23.430

听起来不错，但就像 Drejc 指出的那样，任务栏可以出现在任何地方，谷歌桌面、Winamp 等附加的停靠侧边栏也可以出现。

相反，也许使用 Screen.WorkAreaRect 之类的东西来获取屏幕的客户区。例如

```
with Screen.WorkAreaRect do
  Form1.SetBounds(Left, Top, Right - Left, Bottom - Top); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T07:00:18.417

一个额外的提示。任务栏也可以位于屏幕的右侧或左侧（不仅是顶部和底部）。所以你必须另外弄清楚任务栏在哪里。

我建议你研究一下 SetWidnowState 的 Delphi 实现。在 Delphi7 中，它是这部分代码：

```
procedure TCustomForm.SetWindowState(Value: TWindowState);
const
  ShowCommands: array[TWindowState] of Integer =
    (SW_SHOWNORMAL, SW_MINIMIZE, SW_SHOWMAXIMIZED);
begin
  if FWindowState <> Value then
  begin
    FWindowState := Value;
    if not (csDesigning in ComponentState) and Showing then
      ShowWindow(Handle, ShowCommands[Value]);
  end;
end; 
```

ShowWindow 是一个 Win32 库调用：

```
function ShowWindow; external user32 name 'ShowWindow'; 
```

其中 ***user32 = 'user32.dll';*** 如果我没记错的话。所以深入这个库，也许某处有一些TaskBar的信息。

# asp.net - 如何在 URL 中隐藏控制器名称？

> ID：380221
> 
> 赞同：1
> 
> 时间：2008-12-19T06:12:00.340
> 
> 标签：asp.net, asp.net-mvc

如何在 URL 中隐藏控制器名称？

我使用 ASP.NET MVC。

原网址为： http: [//www.sample.com/Users.mvc/UserDetail/9615](http://www.sample.com/Users.mvc/UserDetail/9615)

“Users”是控制器名称，“UserDetail”是动作名称，“9615”是 UserId。

如何在 url 中隐藏控制器名称和操作名称。

就像这样： http: [//www.sample.com/9615](http://www.sample.com/9615)

我在 Global.ascx.cs 中编写了以下代码来隐藏操作名称：

```
routes.MapRoute(
             "UserDetail",             // Route name
             "Users.mvc/{UserId}",              // URL with parameters
             new { controller = "Users", action = "UserDetail", UserId = "" }  // Parameter defaults
            ); 
```

使用上面的代码我隐藏了动作名称并得到了这个网址： http: [//www.sample.com/Users.mvc/9615](http://www.sample.com/Users.mvc/9615)

但我怎样才能隐藏控制器名称并获取此网址： http: [//www.sample.com/9615](http://www.sample.com/9615)

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-19T07:36:06.723

这个想法是一样的。你只做你对行动所做的事情。但是，您的问题源于 IIS 可能没有将 www.xyz.com/1234 映射到 ASP.NET 运行时。为此，在 IIS7 中启用集成模式，在 IIS6 中，在将所有内容映射到 ASP.NET 的处理程序映射中添加通配符映射。

要添加通配符映射，请参阅[http://haacked.com/archive/2008/11/26/asp.net-mvc-on-iis-6-walkthrough.aspx](http://haacked.com/archive/2008/11/26/asp.net-mvc-on-iis-6-walkthrough.aspx)（在其中搜索“IIS6 Extension-less URLs”页）

之后，只需添加一条路线：

```
routes.MapRoute("UserDetails", "{UserID}/{*name}", 
    new { controller = "Users", action = "UserDetail" , UserID=""}); 
```

这应该可以解决问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-07-21T02:42:59.963

MVC recognizes the difference between "{UserID}" and "{id}" so if you are going to have a route with only "{UserID}" in the Url you need to place it first in the list other wise it never gets hit. And make sure the default includes "id" since it will continually loop over "UserDetails" unless the default references id as apposed to UserID. I found this format works for me:

```
routes.MapRoute("UserDetails",
       "{UserID}",
       new { controller = "Users", action = "UserDetail", id = "" }
);
routes.MapRoute(
       "Default", // Route name
       "{controller}/{action}/{id}", // URL with parameters               
       new { controller = "Account", action = "LogOn", id = "" } // Parameter defaults   
); 
```

# sql - 基于链接字段的 SQL 选择

> ID：380226
> 
> 赞同：0
> 
> 时间：2008-12-19T06:16:03.220
> 
> 标签：sql, select, join

问这个我感觉像个白痴...

```
表 1：用户
身份证号
人整数
用户名字符（32）

表2：人
身份证号
名称字符（16）

```

我可以通过在 users 中提供用户名来运行返回 person 中的 name 字段的查询吗？

```
用户
1 | 1 | 拉里123

人
1 | 拉里
2 | 卷曲

```

SQL？

```
select name from persons where users.person=persons.id and users.username='larry123'; 
```

与期望的回报

```
拉里

```

到目前为止，我一直在通过两次传递来完成它，并且认为使用连接的嵌套选择可能是我需要的

```
1 | 拉里

```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-19T06:28:27.593

*听起来*您在问如何在 SQL 中进行联接：

```
SELECT
    name
  FROM
    users JOIN persons ON (users.person = persons.id)
  WHERE
    users.username = 'larry123'; 
```

这几乎就是你写的查询。你所缺少的只是连接子句。你也可以这样加入：

```
SELECT name
FROM users, persons
WHERE
      users.person = persons.id
  AND users.username = 'larry123'; 
```

我建议找到一篇写得很好的 SQL 介绍。

# ruby-on-rails - 如何使用布尔逻辑验证_presence_of？

> ID：380227
> 
> 赞同：2
> 
> 时间：2008-12-19T06:16:50.097
> 
> 标签：ruby-on-rails

假设我将验证代码输入到我的多语言出版物数据库模型中。数据库需要特定期刊的英文或日文标题。所以我需要 validate_presence_of 至少两者之一。现在我可以很容易地检查两者是否存在，但我对“至少一个”的情况感到困惑：

```
class Article < ActiveRecord::Base
  belongs_to :publication
  validate_presence_of :journal_title
  validate_presence_of :journal_title_ja
end 
```

我认为这可能需要这样的声明：

```
:if => :jornal_title_ja is nil 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-19T06:44:03.833

```
class Article < ActiveRecord::Base  
  belongs_to :publication  
  validate_presence_of :journal_title, :if => :check_japanese  
  validate_presence_of :journal_title_ja, :if => :check_english

  def check_japanese
    journal_title_ja.nil?
  end

  def check_english
    journal_title.nil?
  end
end 
```

这应该有效。希望我把问题弄清楚了。

看[剧集没有。41 on railscasts](http://railscasts.com/episodes/41)为了更好地理解

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T07:29:39.450

我之前没有写过一行 Ruby，但我今天在我的 Rails 书中偶然发现了这一点——如果它根本没有帮助而且完全错误，请见谅！语法几乎肯定会是：

```
class Article < ActiveRecord::Base
 belongs_to :publication

 if journal_title.nil? && journal_title_ja.nil?
  flunk("must have a japanese or english title") 
 end
end 
```

堆栈上的第一篇文章！:D

# unit-testing - 究竟什么是单 元测试？

> ID：380237
> 
> 赞同：0
> 
> 时间：2008-12-19T06:27:50.073
> 
> 标签：unit-testing, debugging

和标题一样！

*编辑：几乎完全一样，并且在上下文中等于[什么是单元测试？](https://stackoverflow.com/questions/1383/)*

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-19T06:40:07.570

复制和粘贴：

> 单元测试 来自维基百科，免费的百科全书（重定向自单元测试） 跳转到：导航、搜索
> 
> 在计算机编程中，单元测试是一种验证源代码的各个单元是否正常工作的测试方法。单元是应用程序的最小可测试部分。在过程编程中，一个单元可以是一个单独的程序、函数、过程等，而在面向对象编程中，最小的单元是一个方法，它可能属于基类/超类、抽象类或派生/子类。
> 
> 理想情况下，每个测试用例都独立于其他测试用例；存根、模拟或假对象[1] 等双重对象以及测试工具可用于帮助单独测试模块。单元测试通常由软件开发人员完成，以确保其他开发人员编写的代码满足软件要求并按照开发人员的预期运行。

# c# - 更改文本框文本时如何将下拉列表的选定索引设置为0？

> ID：380240
> 
> 赞同：4
> 
> 时间：2008-12-19T06:28:24.223
> 
> 标签：c#, javascript, textbox, drop-down-menu

我正在使用下拉列表来填充文本框。但是，如果下拉列表中不存在首选值，则用户直接在该文本框中输入值。

如果用户首先从下拉列表中选择值，然后他不想要该值并且他在该文本框中键入另一个文本，那么此时下拉列表应设置为索引 0，因为用户正在输入另一个值。

我使用了文本框的 textchanged 事件，但它不起作用。谁能告诉我如何为此编写javascript？提前致谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-19T06:41:22.060

这应该适合你：

```
function ResetDropDown(id) {
    document.getElementById(id).selectedIndex = 0;
}
function ResetTextBox(id) {
    document.getElementById(id).value = '';
}
<select id="MyDropDown" onchange="ResetTextBox('MyTextBox');">
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2">2</option>
</select>
<input id="MyTextBox" type="text" onkeypress="ResetDropDown('MyDropDown');"/> 
```

# javascript - javascript动态浮动窗口

> ID：380244
> 
> 赞同：5
> 
> 时间：2008-12-19T06:30:53.017
> 
> 标签：javascript, html

我想在角落建立一个带有关闭按钮的动态浮动窗口。是否有可能，而且我想在该窗口中动态添加一些内容。

请帮助我..它应该在javascript中..没有AJAX更好..

提前致谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-28T04:37:07.377

jQuery UI 有一个很棒的浮动窗口。jQuery UI 版本的酷之处在于，您还可以将其与 UI 主题管理器一起打包，这意味着更少的时间造型。

在这里查看：[jQuery UI 对话框示例](https://jqueryui.com/resources/demos/dialog/modal-form.html "jQuery UI 模态")

只需要创建一个容器（可能是一个 div）和一行代码。像这样的东西：

```
<div id="example">I'm in a dialog!</div>
$("#example").dialog(); 
```

这是文档：[jQuery UI 对话框文档](https://jqueryui.com/dialog/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-26T06:25:37.253

您正在寻找的东西称为“灯箱”技术。这是[许多灯箱技术的比较](http://planetozh.com/projects/lightbox-clones/)。

许多存在于网络上，这里有一些用于 jquery 和原型库：

*   Jquery：[Thickbox](http://jquery.com/demo/thickbox/)，[灯箱插件](http://leandrovieira.com/projects/jquery/lightbox/)

*   原型：[Lightbox 2](http://www.lokeshdhakar.com/projects/lightbox2/)、 [Lightbox](http://www.eight.nl/static/files/leightbox/)

另外，请查看 有关灯箱的[维基百科文章。](http://en.wikipedia.org/wiki/Lightbox_(JavaScript))

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T06:54:25.560

我最喜欢的一直是[Scriptaculous](http://script.aculo.us/)，它可以让你做各种有趣的视觉事情。街区的新孩子使用[jquery](http://jquery.com/)。这两个中的一个应该为您解决问题。

两个站点上都有很多示例可以满足您的需求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-04T06:19:49.317

有很多不同的库可以用来制作窗户。我发现 Livepipes 有一个非常全面和可定制的 javascript 库，其中包括一个窗口控件以及其他各种控件。[http://livepipe.net/control](http://livepipe.net/control) 我没有使用过但看起来很有希望的一个是[prototypeui](http://prototype-ui.com/)。它基于原型和 scriptaculous javascript 库。[jqModal](http://dev.iceburg.net/jquery/jqModal/)是我使用过的另一个基于 JQuery 的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T09:40:15.787

好吧，最基本的只是创建一个 div 并通过将 innerHTML 设置为 HTML 字符串来注入内容。定位它可能很棘手，因为您必须担心滚动，并且不同的浏览器有不同的控制方式。您可能还希望相对于页面中的某些原始元素进行定位，您可以通过挖掘元素来完成，并且它在单击原始元素时您的 javascript 函数接收到的事件对象中的位置。

谷歌悬停弹出窗口 - 第一个链接是[http://www.calcaria.net/javascript/2006/09/javascript-hover-over-html-popup.html](http://www.calcaria.net/javascript/2006/09/javascript-hover-over-html-popup.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-20T06:32:52.780

看看fancybox [http://fancybox.net/](http://fancybox.net/)

# visual-c++ - VC++中的串口通信

> ID：380257
> 
> 赞同：1
> 
> 时间：2008-12-19T06:52:35.500
> 
> 标签：visual-c++, com, types, serial-port

通过串口读取数据时

```
VARIANT data;
BSTR k;
if(m_mscom.GetCommEvent() == 2)
{
    data = m_mscom.GetInput();      
    k = data.bstrVal;
    } 
```

什么是`BSTR k;`，你是什么意思`k=data.bstrVal`？是什么`bstrVal`？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T07:31:02.287

[BSTR](http://msdn.microsoft.com/en-us/library/ms221069.aspx)和[VARIANT](http://msdn.microsoft.com/en-us/library/ms221627.aspx)是 COM 中使用的数据类型。实际上，VARIANT 是一个可以容纳任何 COM 数据类型的容器。

在您的情况下， GetInput() 返回包含缓冲区作为 BSTR 的 VARIANT，因此必须使用 bstrVal 来检索它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T07:30:01.913

BSTR 是指向 unicode 字符的指针（只是可以保存 unicode 字符的字符类型）。data.bstrVal 将变体转换为 BSTR。

# php - 我应该将论坛主题放入我的站点地图吗？

> ID：380258
> 
> 赞同：0
> 
> 时间：2008-12-19T06:52:35.500
> 
> 标签：php, seo, sitemap

我有一个带有论坛设施的网站即将启动。我应该将每个线程都放入我的`sitemap.xml`文件中，还是 Google 会通过论坛本身找到每个线程的链接？别担心：阅读论坛不需要注册。

如果是，如何最好地保持最新状态？对于这么多的数据，手工操作显然不是一种选择。

我考虑过的一种方法是编写一个 Apache `mod_rewrite`，它将请求重定向`sitemap.xml`到去`sitemap.php`，然后动态生成整个事情。

我能想到的另一种方法是设置一个 cron 作业来生成地图并将其转储到文件中，每天一次。这些是不错的选择，我还能做什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-19T06:58:53.227

如果您有一个良好的结构，Google 可能会找到您的线程，但是将您的所有页面放入 XML 站点地图总是好的，因为 Google 在大多数情况下会更频繁地抓取您的站点。

关于生成方法，我会建议一个 PHP 脚本，它只获取所有线程，然后根据服务器负载将其缓存 X 分钟。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T09:56:07.830

取决于网站的数量。sitemap.xml 中的条目过多可能会适得其反。

如果您有一个巨大的论坛，最好进行选择并动态构建您的 sitemap.xml。将 .xml 重写为 .php 并让脚本决定在站点地图中列出的内容听起来像是处理它的好方法。

应列出活跃度高的主题或包含所需关键字的主题，其他主题（例如新主题、空主题或不提供重要内容的主题）可以省略。对于 sitemap.xml，有时少即是多。

# content-management-system - CMS 最重要的功能

> ID：380259
> 
> 赞同：23
> 
> 时间：2008-12-19T06:53:22.940
> 
> 标签：content-management-system

假设有人从头开始为您构建 CMS（内容管理系统）。要包括哪些最重要的功能，为什么？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-03-01T16:45:56.273

*   安全 - [OWASP 前 10 名](http://www.owasp.org/index.php/Top_10_2007)
*   用户管理和用户角色
*   操作和查看权限
*   内容版本控制和审计
*   某种形式的工作流程和通知
*   i18n 对文字和对象版本的支持
*   规范化数据库模式设计
*   某种形式的内容导入导出
*   用于上传的资产管理和缩略图生成
*   有效的 XHTML（使用 GZIP 压缩）
*   生成可访问标记的富文本编辑（例如 FCKeditor）
*   有效且缩小的 CSS 和 javascript（例如使用 YUI）
*   自动生成的 sitemaps.org 文档
*   与谷歌分析集成
*   自动 RSS 提要
*   打开搜索支持
*   打印 css 和/或打印内容的版本
*   重复内容的 SEO 考虑（例如使用规范标签）

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-19T07:13:12.807

我认为从开发人员的角度来看，这将是一个**开放的模块化架构**。恕我直言，总有一些内容要添加，CMS 平台没有提供开箱即用的功能。此外，它应该是**基于数据库的**。

**现有模块**应涵盖最重要的任务：新闻、联系人、文档、论坛、商店、调查、活动、图片库、导航、链接、全文搜索、登录、时事通讯等。

从用户的角度来看，我认为**内容编辑器**（[所见即所得](https://stackoverflow.com/questions/tagged/wysiwyg)）是最重要的部分。在“实时”页面内进行编辑的能力是一项很棒的功能。自动调整大小的图像上传和文件上传应该很容易。

当您开始使用 CMS 时，页面/控件和网站**模板的存在也非常有用。****文档/页面的版本控制**也是一项经常需要的功能和**工作流引擎**，其中有创建内容的作者和允许解锁内容的编辑。

**RSS 联合**是现代 CMS 中应该提供的另一个重要功能。

对于国际站点，CMS 具有某种内置的**多语言支持**非常重要。

然后我认为现在一个好的CMS必须提供搜索引擎优化的工具，例如必须有一种方法来定义和插入**搜索引擎友好的URL**。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-19T08:03:15.123

Not mentioned already: A CMS system should easily integrate into an existing software infrastucture, so interoparability is a strong requirement.

Example: If your CMS supported [WebDav](http://en.wikipedia.org/wiki/WebDAV), you win Microsoft Office as editing tools without any extra expenses.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-07-17T08:11:38.097

选择 CMS 系统时，我的首要要求是能够轻松地对其进行皮肤和控制标记。

用户可能对完全按照他们想要的方式获取布局非常挑剔。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-19T06:57:35.787

1）所见即所得编辑器。能够像在 Microsoft Word 中一样编辑 HTML 内容。这包括上传您自己的图像的能力。

2）创建没有查询字符串的新页面，即）不是“pages.aspx?pageid=5”而是“contact.aspx”

3) 新闻、图片库、博客、用户管理等附加功能...

就我个人而言，我真的很喜欢微软在 codeplex 上提供的[CMS 入门工具包。](http://www.codeplex.com/MyWebPagesStarterKit)它做得很好，使用 XML 文件存储，所以它*不需要数据库*！

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-01T17:35:54.140

除了其他人提到的事情：

**缓存**

如果您的页面包含许多“片段”——例如横幅窗格、左窗格、主窗格、右窗格和页脚窗格，并且每个页面中可能都有多个“小部件”，那么构建页面的工作就变得很重要（无论是在数据库调用中，还是在 Web 服务器上的渲染中）。拥有一些能够检测到任何底层内容块何时发生变化的智能缓存将对性能产生重大影响

[CMS Matrix](http://cmsmatrix.org/)可能是现有 CMS 产品的有用比较资源

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-19T07:29:47.517

您最需要的功能自然取决于 CMS 的使用方式以及由谁使用。对于某些人来说，许可将是最大的问题，而对于其他人来说，一些模糊的要求（例如支持 TIFF 文件）可能是问题所在。

如果您想要完整的 CMS 功能列表，请查看[CMS 功能列表](http://www.cmsreview.com/Features/Lists.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-05-09T16:08:24.307

在与客户合作时，我经常听到一些要求，在我看来，这些要求与现代 CMS 的真正需求无关。过于强调模板设计师应该拥有的功能，例如支持响应式设计（无论这意味着什么），添加品牌元素的能力等。

[我在http://www.simoahava.com/content-management/modern-cms-top-5-features/](http://www.simoahava.com/content-management/modern-cms-top-5-features/)上编制了现代 CMS 需要的 5 大功能列表

从技术角度来看，模块化架构和强大的安全性是最重要的特性。对内容、源代码和软件解决方案本身的完全控制对于任何 CMS 来说都是巨大的优势。

西莫阿哈瓦

# asp.net-mvc - asp.net mvc - 静态构造函数

> ID：380267
> 
> 赞同：1
> 
> 时间：2008-12-19T07:00:50.007
> 
> 标签：asp.net-mvc, static, constructor

我想问一些关于asp.net mvc的问题

1.  静态构造函数会初始化每个用户请求吗？
2.  每个用户都共享静态数据吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-19T07:08:21.273

这个答案是完全通用的，不仅适用于 ASP.NET MVC。

1.  每个应用程序域最多运行一次静态构造函数。保证它在该类的任何静态或实例成员访问之前运行。所以不，不会为每个请求调用它。

2.  是的，静态数据在整个应用程序域中共享。每个应用程序域都会有不同的静态数据。因此，除非您在 Web 园或 Web 场方案中运行，否则它会为所有用户共享。*旁注：如果将静态字段声明为`ThreadStatic`，它们将仅可用于单个线程，这在 ASP.NET 应用程序中可能没有多大意义。*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T07:10:56.757

如果我正确理解您的问题：

1.  是的，您有一个 global.aspx，其中包含您正在寻找的事件处理程序。
2.  应用程序缓存将为您提供所需的内容。Application.Cache 或我无法从内存中输入的内容...

干杯和圣诞快乐（如果适用）

# c# - C# 优于 VB

> ID：380274
> 
> 赞同：11
> 
> 时间：2008-12-19T07:12:57.083
> 
> 标签：c#, .net, vb.net

**C#.NET 中的什么使它**比 VB.NET 更适合某些项目？

性能？，能力？，库/组件？，声誉？，可靠性？可维护性？，容易吗？

* * *

基本上**C# 可以做的任何事情，使用 VB 是不可能的，**反之亦然。为项目选择 C#/VB 时**必须考虑**的事项。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-12-19T07:18:31.250

C# 和 VB 基本相同，但有一些细微差别。除了明显的语法差异之外，您还有以下差异：

1.  C# 可以调用不安全的代码
2.  VB 有可选参数（来自 C#4.0）
3.  VB 在进行后期绑定调用时更易于使用（来自 C# 4.0） 这和数字使 2 使使用 VB 进行办公自动化更加清洁。
4.  VB 有一堆“帮助”函数和类，比如 My 命名空间；但是，C# 可以访问所有这些
5.  VB 不区分大小写

C# 的语法遵循与 c 和 java 类似的语法，这使得它从这些语言的过渡更加舒适，而 VB 对 VB 用户来说更舒适。就性能和库或组件而言，它们几乎相同。

至于选择哪一种，除非你需要做不安全的操作，否则选择对你来说最自然的语言。在成为 VB 开发人员多年后，我喜欢不必编写 If yadada then.....End If (yadaya){....} 为我的腕管节省了一些额外的击键（然后可以用于回答 SO问题）

# 编辑

刚刚了解到 C# 和 VB 的另一个区别是 VB 支持过滤异常，所以你可以像这样伪：

```
try
{
   //do something that fails
}
catch(Exception ex when ArgumentException, 
      ArgumentNullException, FormatException)
{
  //Only handle these three types
} 
```

这不应与执行以下操作的能力相混淆：

```
try
{ 
    //something that fails
}
catch(ArgumentException)
{ 
    //Log Error
}
catch(ArgumentNullException)
{
    //Log Error
} 
```

在这种情况下，您将在 VB 世界中以不同的方式处理异常，您可以定义一段代码来处理多种类型的异常。

# 编辑

还有一些区别。

7.  VB 的 Is 运算符比较两个对象以确定它们是否相同，它编译为 CEQ IL 指令，而 C# 编译为 isinst IL。所以以下是等价的陈述

C＃ `if (foo is FooObject){}`

VB `If TypeOf foo is FooObject then`

8.  也正如评论中提到的，我希望我能看到他们给你荣誉，但 C# 没有 like 参数。您需要使用 RegEx 类。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-12-19T07:50:01.843

我认为 Kathleen Dollard 的这篇博客文章很好地概述了这个问题：

[**C# 程序员在编写 VB 之前应该知道什么**](http://msmvps.com/blogs/kathleen/archive/2008/07/25/what-a-c-coder-should-know-before-they-write-vb-updated.aspx)

她的第一个建议是：

> 1）在你开始之前克服尊重或退出。VB 是一门很棒的语言。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-12-19T07:43:16.333

极客中的街头信誉。

*（不要假装这不重要！）*

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-12-19T08:26:25.780

其他人已经涵盖了很多差异 - 正如多次说过的那样，它们*几乎*是等效的语言。据我所见，一些尚未涵盖的差异：

VB9 有：

*   XML 文字
*   可变匿名类型 (urgh)
*   *语言*中更多的 LINQ 支持（C# 仅涵盖少数运算符）
*   语言中的一大堆额外位被编译为对 Microsoft.VisualBasic 程序集的调用。（C# 更喜欢成为一种小型语言，其背后有 .NET 框架的重要性。）
*   日期时间文字

C# 3 有：

*   更好地支持 lambda 表达式：IIRC，您不能在 VB 中编写带有块体的 lambda 表达式。
*   迭代器块。
*   扩展方法的语法（而不是用属性装饰方法）

我怀疑还有更多，但我想我会把它们混在一起。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-12-19T16:20:48.983

当您遇到问题时，您通常可以在 Google 上搜索代码示例，展示如何在几分钟内解决问题。这是提高生产力的一个重要因素。当我使用 Delphi 时，我必须将代码示例从 C 转换为 Object Pascal——可行，但很乏味，即很多摩擦。所以不要小看这个事实...

**绝大多数 .Net 代码示例都在 C# 中！**

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-12-19T07:18:14.683

在 VB.NET 的早期版本中，差异更为明显，但与当前版本相比，没有显着差异。

VB 直接在代码中支持 XML 文字，而 C# 不支持。C# 支持不安全代码，而 VB 不支持。从技术上讲，这两者是最大的区别。有许多小的变化，但它们并不重要。我更喜欢 C#，因为我认为语法不那么臃肿。识别代码块很容易，而不是看到一堆关键字，但这纯粹是个人喜好。

选择您和您的团队更熟悉的那个。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-19T08:03:26.170

VB.Net 有一个根命名空间，而 C# 有一个不同的默认命名空间。因为当您在 VB.Net 中有一个根命名空间时，它总是会在命名空间之前添加它。

例如：如果您在 VB.Net 中有一个名为 namespace1 的 rootnamepsace，然后您将其添加到您的文件中。

```
Namespace namespace1
  Public Class class1
  End Class
End Namespace 
```

那么您必须将其称为 namespace1.namespace1.class1

在 C# 中，如果您有一个名为 namespace1 的默认命名空间，并且您在文件中使用了 this。

```
namespace namespace1{
  public class class1{}
} 
```

然后您仍然可以将其称为 namespace1.class1

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-19T07:38:16.140

我最喜欢的 VB 没有的 C# 特性是 yield 语句。它使您可以轻松地从方法返回一个惰性求值的 IEnumerable。

这是一篇涵盖它的文章：http: [//msdn.microsoft.com/en-us/magazine/cc163970.aspx](http://msdn.microsoft.com/en-us/magazine/cc163970.aspx)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-19T07:57:26.337

VB 对错误有更好的反馈。在 C# 中，您必须更频繁地编译以获取语法中的所有错误。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-19T11:20:00.203

我看到 C# 的最大优势是绝大多数开源项目、示例代码和博客片段都是用 C# 编写的。尽管使用工具（或您的头脑）很容易将这些转换为 VB.NET，但对于 VB 开发人员（如我）来说仍然是一项单调的任务。

即使您每天使用 VB.NET 编写代码，您仍然需要能够阅读 C#

从技术上讲，它们共享相同的框架，具有相同的性能和内存特性以及相同的类型系统，因此我发现很难将两者分开。

大多数优秀的开发人员应该能够在几天的调整时间内在两者之间转换。

我的核心挫败感在于我写了数百次：

```
String lastName as String 
```

并想知道为什么它永远不会编译！

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-19T08:26:57.947

在 C# 中，您可以对事件/委托进行更精细的控制。但你很少需要这个。

C# 有更多的代码示例。

在 VB.Net 中，使用后期绑定（很多）更容易。例如对于 COM 对象（在 C# 中从 4.0 版开始）。

*   我在我的项目中使用了 90% 的 C#
*   我使用 VB.Net 与 Excel 等进行互操作

一旦我对 F# 有了更好的了解，我可能会将它用于 F# 更适合的部分。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-19T08:29:08.940

> 表现？

没有区别，尽管 VB 历史上在循环中使用了一个奇怪的索引，这意味着你必须在大多数时间从最高索引中减去 1：

```
For i = 0 To someArrayOrString.Length - 1 … 
```

尽管我怀疑这会以*任何*可衡量的方式影响性能。

另一方面，由于后台编译，VB实际上编译起来似乎*更快*。有人声称这会使 IDE 反应迟缓，但我自己从未注意到这一点。

> 能力？

在少数情况下，C# 的`yield`语句非常有用。VB 在这里需要更多的手工工作。此外，lambda 在 C# 中的实现要好得多，尤其是在语法上。考虑以下两个陈述：

```
Parallel.For(1, 10000, i => {
    // Do something
}); 
```

相对

```
Parallel.For(1, 10000, Sub() _
    ' Do something '
End Sub) 
```

除了 VB 还不能做到这一点，并且禁止在这个地方发表评论的事实之外，它只是更加混乱而且通常是不可行的。

> 库/组件？

完全相同的。

> 名声？

不重要。“街头威望”？对不起。不是一个因素。克服它，尼克。

> 可靠性？可维护性？舒适？

或多或少相同。我声称 VB 更容易，但这可能是有偏见的，无论如何，它只是微不足道的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-19T07:18:41.533

据我了解，尽管语言之间的差异很小，但它们之间存在差异。我建议使用您/您的开发人员最熟悉的语言。如果他们已经有 VB 经验，那么我建议 VB.Net/vice-versa。

虽然我个人更喜欢 C# 的简洁语法。:)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-19T07:19:01.220

由于 C# 和 VB.Net 都编译为 MSIL，因此两者具有几乎相同的性能、功能、库和组件。反射可以将 MSIL 代码反汇编为 C# 或 VB.NET（或许多其他语言）

这基本上给我们留下了，C# 看起来很像 Java 和 C++，这给了它更多的可信度。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-19T07:53:00.027

我认为 Josh 对语言差异做了很好的总结。

**工具支持**

然而，Visual Studio 处理这些语言的方式也存在差异。代码片段在 C# 编辑器中更易于使用，重构也更好。

VB 编辑器通过不始终显示所有选项来简化智能感知。

我敢肯定还有更多的东西，但那些是我作为 C#'er（做很少的 VB）注意到的。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-12-29T11:18:44.500

*这是此路径中尚未涵盖的另一点：*

**更高的就业能力 + 更好（更多）的开发资源**

但是现在我不同意这个观点：

VB 商店有更多的 C# 开发商店

如果您使用 VB 更强大，一些落后的 c# 雇主会让您处于严重的劣势。所以也许 C# 是这里更好的选择。

另一方面，当您为您的 C# 项目招聘人员时，您将能够吸引更多候选人参加 iterview 并因此获得更好的技能——我认为不应忽视细节。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-02-06T16:41:36.140

我不得不说，在使用 Google 搜索示例或文档时，我的经验是 C# 示例比 VB 示例质量更好。这并不是说没有糟糕的 C# 示例，但是如果您搜索“字典下拉菜单”之类的内容，添加 C# 将在列表中提供更高质量的答案。

这不适用于并排显示 C# 和 VB 代码的示例。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-12-19T07:53:58.870

目前 VB.Net 对 lambda 表达式的实现很差。这意味着你不能做你在 C# 中可以做的整洁的事情。好吧，你可以，但在大多数情况下，它需要一个非常丑陋的解决方法。

这在 VB.Net 10.0 中得到了解决。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-02-06T17:09:36.877

摆脱了旧的麻烦，C# 中的数组声明没有用额外的元素填充。VB.NET 数组填充了额外的元素，因此旧版 VB6 代码迁移更容易。

C# 比 VB.NET 更一致

```
Button1.Color() = Color.Red
Button1.Color = Color.Red 
```

当一位学生问我何时在 VB.NET 的属性上使用括号时，我无法给出答案。对于这种错误特征，很难给出有见地的推理。

与实例和静态成员保持一致。VB.NET 允许访问实例上的静态成员，例如 yarn.Sleep(1000)，这是一个错误功能。[https://stackoverflow.com/questions/312419/language-features-you-should-never-use](https://stackoverflow.com/questions/312419/language-features-you-should-never-use)

# vb6 - 如何在不使用已安装的播放器的情况下从 VB6 播放 .mp3 文件？

> ID：380287
> 
> 赞同：2
> 
> 时间：2008-12-19T07:21:14.240
> 
> 标签：vb6

我想从 vb6 应用程序播放 mp3 文件（b/c 它们压缩比 .wav 小），但不需要安装任何其他播放器。

有什么建议么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T19:58:44.283

在 VB6 中播放 MP3 的最简单方法是在 windowsmultimedia (winmm) 函数中使用 MCI。这些在所有可以在 windows 媒体播放器中播放 MP3 的 windows 版本中都可用（默认情况下，在 2000、XP 和我相信 98 中，需要为 NT4 和 95 安装 Windows 媒体播放器）。将以下内容添加到您的标题中：

```
Declare Function mciSendString Lib "winmm" Alias "mciSendStringA" (ByVal _
    lpstrCommand As String, ByVal lpstrReturnString As String, _
    ByVal uReturnLength As Long, ByVal hwndCallback As Long) As Long 
```

然后在您的子程序中添加以下内容：

```
CommandString = "open """ & FileName & """ type mpegvideo alias " & FileName
RetVal = mciSendString(CommandString, vbNullString, 0, 0) 
```

文件类型应该是 mpegvideo 而不是 wavfile 或音序器，我猜是因为它使用 mpegvideo 编解码器来播放文件。如果您计划分发您的应用程序，则有关使用 MP3 编解码器以及是否使用 Windows 播放它的法律问题由您的法律部门决定。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T07:48:34.390

使用 DLL，例如[FMOD](http://www.fmod.org/index.php/download)来播放 mp3 文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T07:30:31.197

不确定您是否会将其视为“正在安装”，因为它随操作系统一起提供，但您可以从 vb6 控制 windows 媒体播放器。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-20T13:45:51.603

添加对 ActiveMovie 控件类型库的引用并使用[FilgraphManager.RenderFile](http://msdn.microsoft.com/en-us/library/ms787569(VS.85).aspx)。查看[VbAmp Player](http://www.planet-source-code.com/vb/scripts/ShowCode.asp?txtCodeId=37779&lngWId=1)的 docPlayer.pvLoadMediaFile 以获取示例，并查看 IBasicAudio 的用法虽然源 - 音量控制等。

# javascript - 用 JavaScript 进行 3D 渲染的最佳在线资源是什么？

> ID：380316
> 
> 赞同：12
> 
> 时间：2008-12-19T07:55:06.670
> 
> 标签：javascript, 3d, rendering

先做一点介绍：

去年我写了这个[http://dragan.yourtree.org/code/canvas-3d-graph/](http://dragan.yourtree.org/code/canvas-3d-graph/)

现在，我想完全重写它，因为旧版本有一些限制，例如：有时会发生条不可见，因为它们是一个接一个地绘制的。

在这个旧版本中，没有真正的 3D，只有一堆 2D 线，它们模拟 3D。

现在，我想要进入完整的 3D 场景，我想将所有对象保存在内存中，并添加某种 3D 导航按钮，使用户能够在所有 3 轴上旋转整个场景，并放大相机和出去。

我已经决定将[http://sylvester.jcoglan.com/](http://sylvester.jcoglan.com/)用于矢量/矩阵的东西，但我仍然无法找到好的 3D 教程。互联网上有大量文本，其中大部分是 90 年代的，不完整或写得非常糟糕。

所以，我的问题是：什么是最好的在线资源/教程，可以让我从头开始编写自己的 JS 3D 引擎。

它应涵盖所有相关主题：

*   矢量图
*   矩阵
*   对象
*   相机
*   场景渲染
*   灯光
*   旋转场景中的物体
*   移动相机

等等..（我对前两个相当熟悉）

感谢您的时间。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-19T08:13:33.153

如果这是专门针对与 JavaScript 相关的项目，那么我理解，但如果您只是为了掌握 3d 渲染的基础知识而这样做，那么可能会有更成熟的平台适合您。

任何状况之下..

可能对您的学习有用的链接：

*   [用 JavaScript 制作一个简单的 3d 渲染器原型](http://hem.spray.se/vilius/js3Dtutor.html)
*   [3D 基础 - 入门](http://www.gamedev.net/reference/articles/article673.asp)
*   [JavaScript 光线追踪器](http://www.slimeland.com/raytrace/help.html)
*   [JavaScript 3D 渲染器](http://www.nihilogic.dk/labs/canvas3dtexture_0.2/)

此外，还有一些有趣的 JavaScript 3d 示例：

*   [在 JavaScript 中旋转 3D 立方体](http://maettig.com/code/javascript/3d_dots.html)
*   [JavaScript 中的德军总部 3D](http://blog.nihilogic.dk/2008/04/javascript-wolfenstein-3d.html)
*   这个 SO 问题中的其他内容：[使用 JavaScript 实现令人惊叹的图形效果？](https://stackoverflow.com/questions/254535/stunning-graphic-effects-with-javascript)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T08:09:32.583

只是一些建议，但可能不完全是您想要的：

我建议您在 nihilogic.dk 上查看 Jacob Seidelin 的画布示例：[http://blog.nihilogic.dk/search/label/canvas](http://blog.nihilogic.dk/search/label/canvas)。

如果您愿意放弃画布并使用现有的 Flash 库，请查看 Sandy3D：[http](http://www.flashsandy.org/demos) ://www.flashsandy.org/demos 。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T08:10:19.150

透视投影： [http ://www.cse.unr.edu/~bebis/CS791E/Notes/PerspectiveProjection.pdf](http://www.cse.unr.edu/~bebis/CS791E/Notes/PerspectiveProjection.pdf)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T08:11:56.650

[http://www.gamedev.net/](http://www.gamedev.net/)

自从上次我尝试用图形/游戏/3D 做任何事情以来已经有一段时间了，但我确实记得这个网站是最广为人知的资源之一。

[http://www.gamedev.net/reference/](http://www.gamedev.net/reference/)

当然，它是非常通用的，涵盖的内容比您要求的要多，但它包含数学和物理方面的好东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T08:47:43.880

可悲的事实是 JavaScript 中仍然没有对 3D 图形的真正支持。
因此，您所做的任何事情都必须涉及完全实现 3D 渲染器（或使用其他人已经实现的渲染器）
因为这些东西通常是在硬件中实现的，并且您正在编写 JavaScript，所以对于任何比琐碎的场景来说自然会非常慢。

使用 Java、C# 或 C++ 等语言为您的 3D 图形提供更好的服务。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-18T18:19:24.673

Firefox有一种称为[“Canvas 3D”的技术。](https://addons.mozilla.org/en-US/firefox/addon/7171)还有一个名为[C3DL](http://www.c3dl.org/)的实用程序，可以更轻松地使用该技术。

不幸的是，据我所知，没有等效的 Opera/Internet Explorer/WebKit - 此插件仅适用于 Firefox 3（不支持 Firefox 2 和 Firefox 3.1 beta）...

# java - Mercurial API for Java?

> ID：380321
> 
> 赞同：29
> 
> 时间：2008-12-19T08:00:17.610
> 
> 标签：java, api, mercurial, javahg

Is there a plain API to access Mercurial repositories from Java?

There are plugins for Netbeans and Eclipse, but unlike their Subversion counterparts, they do not use a common lower-level library but bring their own wrappers to call out to the Mercurial binary. Calling the binary would be okay (for now), but it seems very difficult to use those plugins in standalone applications (outside of the IDE they were built for).

There is also HgKit, but that is very pre-alpha.

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2011-11-02T13:47:03.400

一个新选项是[**JavaHg**](http://javahg.aragost.com/)，它为您提供高级 Java API。[单元测试](https://bitbucket.org/aragost/javahg/src/tip/src/test/java/com/aragost/javahg/commands/)给出了如何使用它进行编程的一个很好的例子（从 JavaHg 0.1 开始）：

```
public void commitTest() throws IOException {
    Repository repo = getTestRepository();
    writeFile("x", "abc");

    CommitCommand commit = CommitCommand.on(repo);
    StatusCommand status = StatusCommand.on(repo);

    List<StatusLine> statusLines = status.lines();
    Assert.assertEquals(1, statusLines.size());
    Assert.assertEquals(StatusLine.Type.UNKNOWN, statusLines.get(0).getType());

    AddCommand.on(repo).execute();
    statusLines = status.lines();
    Assert.assertEquals(1, statusLines.size());
    Assert.assertEquals(StatusLine.Type.ADDED, statusLines.get(0).getType());

    commit.message("Add a file").user("Martin Geisler");
    Changeset cset = commit.execute();
    Assert.assertEquals("Martin Geisler", cset.getUser());
    statusLines = status.lines();
    Assert.assertEquals(0, statusLines.size());
} 
```

它与1.9 及更高版本中的[Mercurial 命令服务器交互。](https://www.mercurial-scm.org/wiki/CommandServer)这意味着将有一个持续的 Mercurial 进程接受多个命令，因此您**可以避免**通常与启动 Mercurial 相关的启动开销。我们预计它将在即将发布的 MercurialEclipse 版本中使用。（我是 JavaHg 的作者之一。）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-11-01T14:27:30.010

[hg4j](http://code.google.com/p/hg4j/)现在有更多（即克隆）功能并且似乎正在实际开发中

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-19T08:49:51.723

Have you looked at Jython? As far as I can see [here](http://jython.org/), it should help using the python mercurial modules from within a Java environment, just like [JRuby](http://en.wikipedia.org/wiki/JRuby) does for Ruby.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-10T23:07:14.607

[Maven SCM 插件](http://maven.apache.org/scm/)似乎有一个Mercurial[提供程序可用](http://maven.apache.org/scm/maven-scm-providers/maven-scm-provider-hg/index.html)。但是，我不知道该提供程序在您的情况下的适用性（即它与 Maven 架构的关联程度和/或它如何与 hg 交互）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-08-06T22:10:27.577

还有一个[hg4j](http://hg4j.com/)，但目前它只允许读取存储库。

# c# - 编辑 LINQ to SQL 对象模型

> ID：380324
> 
> 赞同：3
> 
> 时间：2008-12-19T08:03:57.837
> 
> 标签：c#, linq

我使用 vs2008 并且我还使用从 linq 到 sql (.dbml) 的自动生成的对象模型/实体类。

是否可以/建议更改自动生成的 .cs 文件。例如改变 Equals 的行为（在部分课程中）？

我知道 Equals 应该是自反的、对称的、传递的、一致的和“Equals(null)== false”

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-19T08:07:20.047

不建议直接更改生成的文件，因为如果您编辑 DBML，它将重新生成并覆盖您的更改。生成的类将被声明为，`partial`因此您可以通过创建另一个文件并声明`partial`具有相同名称的类并在那里添加您的更改来更改它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-19T08:37:57.207

您还可以为实现自定义代码的实体添加通用基类，但 Linq to Sql 可视化编辑器不支持它，因此您必须手动编辑 .dbml 文件。

在 Visual Studio 中，您可以在解决方案资源管理器中右键单击 .dbml 文件，选择打开方式，然后选择 Xml 编辑器。

现在您可以将`EntityBase`属性添加到`<Database>`标签中。EntityBase 属性应包含您的公共基类的名称。

最后，您应该在解决方案资源管理器中右键单击 .dbml 文件并选择运行自定义工具。这将使用公共基类重新创建您的实体类。

# c# - ASP.NET：权限/身份验证架构

> ID：380336
> 
> 赞同：8
> 
> 时间：2008-12-19T08:17:01.837
> 
> 标签：c#, asp.net, security, forms-authentication

我正在考虑在我的 ASP.NET 应用程序中构建具有以下要求的**身份验证。**

*   一个用户只有一个角色（即 Admin、SalesManager、Sales ......）
*   角色具有一组权限，可以 CRUD 访问现有对象的子集。即“销售对对象类型“产品”具有 CREAD、READ、WRITE 权限，但没有 DELETE 权限”
*   不知何故，我喜欢将权限置于具有继承的层次结构中，这样我即管理员不需要指定所有可用对象。
*   系统必须能够快速回答“用户 X 是否有权对对象 Z 执行 Y”的问题
*   所有数据库托管 (MSSQL)，在 C#/ASP.NET 中实现

我想获得有关这些要求的反馈？任何想法如何使用 ASP.NET 框架（尽可能）实现这一点？（但是，我也很想知道如何在没有会员资格的情况下实现这一目标）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-19T22:00:01.373

我认为您在这里需要做的是在您的业务对象或控制器中实现一组权限查询方法。示例：CanRead()、CanEdit()、CanDelete()

页面呈现时，需要查询业务对象，确定用户授权的能力，并根据这些信息启用或禁用功能。反过来，业务对象可以使用角色或其他数据库查询来确定活动用户的权限。

我想不出一种方法来集中声明地定义这些权限。它们需要分发到功能的实现中。但是，如果您想改进设计，您可以使用依赖注入将授权者插入到您的业务对象中，从而使实现保持独立。

Rocky Lhotka 的书中有一些代码使用了这个模型。新版本尚未在[Google](http://books.google.com/books?id=AS7zAQaKt-oC&pg=PA303&lpg=PA303&dq=ApplyAuthorizationRules()&source=web&ots=KAM2jFW5DR&sig=CH2iXpBw1K5i5zSnyA8sEJWjKlM&hl=en&sa=X&oi=book_result&resnum=7&ct=result)中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-16T13:13:19.370

我认为我认为可以满足您的要求的最佳实现之一记录[在此处](http://www.codeproject.com/KB/web-security/objectlevelsecurity.aspx)。唯一的问题是它与 NHibernate 挂钩，但您可以将其用作模板来创建自己的权限实现，并简单地挂钩到您自己的事件模型而不是 NHibernates 拦截器。

我自己正在开发这样一个系统，一旦我对它感到满意，我就会写博客。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T08:19:42.237

从 ASP.NET 2.0 开始提供的会员 API 应该可以很好地满足您的要求。恐怕它唯一不直接支持的是分层角色。但是，您可以轻松地使用基于角色的普通安全性和另一个手动编写的分层角色表来实现所需的事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-19T08:21:37.163

您可以在此处阅读有关如何设置 ASP.NET 成员资格的信息：http: [//msdn.microsoft.com/en-us/library/yh26yfzy.aspx](http://msdn.microsoft.com/en-us/library/yh26yfzy.aspx)

它允许您将文件夹/页面等分组到组/用户中。我想你会发现这已经足够了！

通过扩展生成的数据库和过程可以轻松管理层次结构。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-12T14:07:27.720

我将建立用户/角色关系，以便用户可以拥有多个角色。我看到了 1-1 关系，我很紧张，因为我知道即使我们现在看不到它的需要，总有一天有人会希望某人既是销售用户又是客户服务用户。

在我们的客户系统中，我们使用角色对诸如“delinquentCustomer”之类的内容进行分层。这样，原始权限仍然有效——只要他们支付账单。值得考虑这种方法。

# sql - Determining the length of a user's visit based on SQL timestamps

> ID：380338
> 
> 赞同：2
> 
> 时间：2008-12-19T08:18:50.193
> 
> 标签：sql, duration, intervals

I am divided between using a C# implementation and a pure SQL 2005/2008 implementation. I need to determine the length of usage based on timestamps of their last actions. My table contains "friendID" (uniqueIdentifier) and "lastAction" datetime. Here is an example:

```
Bob, 1:00 PM 
Bob, 1:01 PM 
Bob, 1:20 PM 
Bob, 1:25 PM 
Jack, 5:00 PM
Bob, 11:20 PM

```

I want to "time out" a user if they had 60 minutes of inactivity. If your suggestion works correctly, there should be 3 separate sessions from the data above. There is a long break between Bob's session that started at 1 PM and the one that started at 11:20 PM.

Correct results should be: Bob (duration 25 minutes), Jack (duration 0 minutes), Bob (duration 0 minutes)

**How would you return those 3 rows using pure SQL or C#?**

Thank you very much for your help, it is really needed here.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T02:36:09.663

这是一个纯 SQL 示例：

如果您只需要会话的开始时间：

```
    选择你，t       
    从测试 a        
    不存在的地方（
      选择 1
      从测试 b
      其中 au = bu
      和 bt >= at - '60 分钟'::interval
      和BT
```

如果您确实需要会话持续时间：

```
    选择 au, at, ct
    从测试 a，测试 c
    不存在的地方（
      选择 1
      从测试 b
      其中 au = bu
      和 bt >= at - '60 分钟'::interval
      和BT CT）
    和 au = cu
    并且在
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T19:30:05.690

这听起来像一个简单的问题，除非我误解了这个问题：

```
select friendId, max(lastAction) 'lastAction'
  from myTable
  where lastAction >= dateadd(day, -1, getdate())
      -- don't analyze data over 24 hours old
  group by friendId
  having max(lastAction) < dateadd(minute, -60, getdate()) 
```

这将返回在过去 24 小时内（但不是在过去 60 分钟内）有活动的所有朋友。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T10:16:58.740

记录会话中第一个动作的开始时间。记录会话中的最后时间。查看 te Globals.asax 事件。应该有类似 OnSessionEnd 的东西（如果有人知道确切的事件，请发表评论）。发生这种情况时，记录开始时间和上次之间的持续时间。如果您不使用 ASP.Net，那么 WinForms 中应该有等效的事件。

现在，处理 60 分钟超时的最简单方法就是在 web.config 中设置它。如果您不想这样做，那么当您保存当前日期以处理此问题时，您将必须有一些逻辑。比如，如果新的当前日期距离旧日期超过 60 分钟，则记录旧的持续时间，然后将开始日期和当前日期重置为现在。

# ssh - 通过 wget 从 ssh 上的 bash 文件下载超过 100,000 个文件有多可靠？

> ID：380341
> 
> 赞同：0
> 
> 时间：2008-12-19T08:20:15.167
> 
> 标签：ssh, wget

我有一个 bash 文件，其中包含 wget 命令来下载超过 100,000 个文件，总计大约 20gb 的数据。

bash 文件类似于：

wget [http://something.com/path/to/file.data](http://something.com/path/to/file.data)

wget [http://something.com/path/to/file2.data](http://something.com/path/to/file2.data)

wget [http://something.com/path/to/file3.data](http://something.com/path/to/file3.data)

wget [http://something.com/path/to/file4.data](http://something.com/path/to/file4.data)

这正好有 114,770 行。SSH 进入我有帐户的服务器并运行它有多可靠？我的 ssh 会话最终会超时吗？我是否必须一直被 ssh'ed？如果我的本地计算机崩溃/关闭怎么办？

另外，有人知道这需要多少资源吗？我想在共享服务器上这样做是不是很疯狂？

我知道这是一个奇怪的问题，只是想知道是否有人有任何想法。谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-19T08:29:40.173

**采用**

**#nohup ./scriptname &>logname.log**

这将确保

*   即使 ssh 会话中断，该过程仍将继续
*   您可以监控它，因为它正在运行

Will also recommend, that you can have some prompt at regular intervals, will be good for log analysis. e.g. `#echo "1000 files copied"`

* * *

As far as resource utilisation is concerned, it entirely depends on the system and majorly on network characteristics. Theoretically you can callculate the time with just Data Size & Bandwidth. But in real life, delays, latencies, and data-losses come into picture.

So make some assuptions, do some mathematics and you'll get the answer :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T08:23:28.093

取决于通信介质、硬件、...的可靠性！

`screen`当您与远程计算机断开连接时，您可以使用它来保持它运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T08:23:33.727

开始它

```
nohup ./scriptname & 
```

你应该没事。另外，我建议您记录进度，以便您能够找出它停止的位置。

```
wget url >>logfile.log 
```

可能就足够了。

要实时监控进度，您可以：

```
tail -f logfile.log 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T08:27:21.597

您想断开脚本与 shell 的连接并让它在后台运行（使用 nohup），以便在您注销时它继续运行。

您还希望有某种进度指示器，例如记录每个下载文件的日志文件，以及所有错误消息。Nohup 将 stderr 和 stdout 发送到文件中。使用这样的文件，您可以在以后获取损坏的下载和中止的运行。

首先用一小组文件对其进行测试运行，看看你是否得到了命令并喜欢输出。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T08:28:41.547

我建议你用`nohup`.

```
$ nohup myLongRunningScript.sh > script.stdout 2>script.stderr &
$ exit 
```

该脚本将运行完成 - 您无需始终登录。

请检查您可以为 wget 提供的任何选项，以使其在失败时重试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-19T08:30:00.123

If it is possible, generate MD5 checksums for all of the files and use it to check if they all were transferred correctly.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-02T15:29:39.613

It may be worth it to look at an alternate technology, like [rsync](http://rsync.samba.org/). I've used it on many projects and it works very, very well.

# vim - 如何将行添加到vim寄存器而不覆盖它

> ID：380379
> 
> 赞同：93
> 
> 时间：2008-12-19T08:38:51.947
> 
> 标签：vim, keyboard-shortcuts

我想在寄存器中拉出一行：`"{register}y`但不覆盖寄存器中以前的内容。我经常需要在寄存器中复制不连续的行，有时我想像堆栈一样使用寄存器。

例子：

```
line1
line2
line3 
```

我想复制`line1`，把光标放在上面并输入`"ay`，然后继续`line3`做`"ay`。然后，当我会做的时候`"ap`， BOTH `line1`AND`line3`将被粘贴。

没有插件这可能吗？用插件？

* * *

## 回答 #1

> 赞同：137
> 
> 时间：2008-12-19T12:38:16.360

如果要附加到命名寄存器，请使用它对应的大写字符。即在你的例子中：

```
“哎呀
“哎呀
“AP

```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-19T20:58:34.930

只是为了扩展 MarkB 的响应，您是否知道您也可以使用标记来为您的 yank 选择一个文本块？

在选择一个字母作为标记后，转到您要抽出的块的第一行并输入标记命令，例如

```
ma  (entered in command mode, i.e. no colon) 
```

然后转到要拉出的块的底部并输入命令：

```
:'a,.ya A 
```

此命令意味着从包含我的标记 a 的行中取出文本块，直到当前行并将其拉入缓冲区 a。与 MarkB 提到的规则相同，使用小写的缓冲区名称来覆盖缓冲区。使用大写的缓冲区名称附加到缓冲区。所以在这种情况下，这将附加到缓冲区 a 的内容中。

注意 用于标记的“a”与用于选择寄存器的“a”无关。（AFAIK 但 YMMV）

BTW 'a（撇号 a）指的是包含标记 a 的行。`a（反引号a）是指输入ma时光标下的字符。

```
d`a (also entered in command mode) 
```

很有用，因为它会删除用标记 a 标记的字符到光标当前所在字符**之前的字符之间的文本。**

# c# - How to force a redraw of my application's entry in the taskbar?

> ID：380380
> 
> 赞同：3
> 
> 时间：2008-12-19T08:38:59.093
> 
> 标签：c#, .net, taskbar

I have a Windows form application written in C#. I update the title of the form frequently, but there's a substantial lag between the title changing and the title dislayed in the taskbar being updated.

What's a clean way to force an update / redraw of the task bar's entry for my program? Failing that, how can I force a redraw of the entire task bar?

Elaboration: It turns out that the delay in updating the taskbar is fixed at about 100ms, however this seems to be a delay based on when the Form.Text was last modified. If you modify the text faster then that - say, every 10ms, the taskbar is not updated until the Form.Text has been left unchanged for at least ~100ms.

OS: Vista 32.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T08:51:37.680

Did you try to call Form.Refresh() after updating the title?

Edit:

If you are doing the title updates in a loop you might have to do something along the line of:

```
 this.Invalidate();
        this.Update();
        Application.DoEvents(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T10:54:58.730

超过每 100 毫秒的任务栏更新将太快，用户无论如何都无法解决。大概您正在向用户显示某种进度或状态指示器？

如果是这样，您会在不必要地进行如此多的 UI 更新时削弱应用程序。处理时间最好用于完成客户的工作。

我认为您需要重新审视您正在尝试做的事情的 UI 设计方面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T11:04:16.217

您是否在表单中使用与此类似的代码？：

```
 private void Form1_Load(object sender, EventArgs e)
    {
        Timer t = new Timer();
        t.Interval = 10;
        t.Tick += new EventHandler(t_Tick);
        t.Start();
    }

    int aa = 0;

    void t_Tick(object sender, EventArgs e)
    {
        this.Text = aa++.ToString();
    } 
```

对我来说效果很好 - 表单和任务栏之间完全没有滞后。

您确定您没有锁定 GUI 线程并且没有在循环中调用 Application.DoEvents 吗？

我正在使用新的 Windows 7 测试版，因此它的行为不同的可能性很小。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-19T09:57:44.770

我只是做了一个简单的测试。变化是相当瞬间的。从外观上看，肯定是不到500ms。如果您需要以更高的速度更新标题，我不会真正推荐它。一般来说，我见过每秒两次的最快更新率。

编辑：我使用按键事件进行了测试。当我按住键快速重复时，它不会更新，直到我释放我的键。因此，与您的设置相同的场景。

顺便说一句，为什么你需要每 10 毫秒更新一次？请记住，`Thread.Sleep(timeout)`超时时间小于 50 毫秒是不准确的。此外，10ms 超时将等于 100Hz，除非您使用高端显示器，否则您会错过几帧。大多数普通 LCD 的刷新率为 60Hz。我们的眼睛无法区分任何比 25Hz 更快的东西。因此，如果您想制作动画，40 毫秒的延迟就绰绰有余了。一般来说，我会推荐 15Hz (67ms) 用于简单的动画。如果只是想滚动一些文本，2Hz 绰绰有余。任何更快的东西都会让用户头晕目眩。

# sql-server - 什么会导致渲染时 Reportserver 上的 SSRS 报告失败？

> ID：380381
> 
> 赞同：1
> 
> 时间：2008-12-19T08:39:41.913
> 
> 标签：sql-server, debugging, sql-server-2008, reporting-services

详情如下：

环境：

SSRS 2008 Server, SQL Server 2008 for database, SQL Server Business Intelligence Devlopment Studio 中开发的报表 - 报表项目

错误信息：

“客户端渲染期间发生错误。” “报告处理过程中发生错误。” “数据集 'DataSource1' 的查询执行失败。” “有关此错误的更多信息，请导航到本地服务器计算机上的报告服务器，或启用远程错误”

我已经做到了（导航和所有这些），结果是需要声明标量变量的参数。有趣的是，这些变量已在数据源和报告源中正确声明。此报告/数据源在 SSRS 2005 上也没有问题。在开发环境中，报告运行完美。在服务器上，报告仅在执行时和接受参数后才会失败。我们不使用存储过程。

任何帮助/想法将不胜感激。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T15:34:05.023

在开发环境中运行时，您使用的是 Windows 凭据。通过 SSRS 运行时，您是否还使用 Windows 凭据？还是您使用不同的凭据？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-19T08:08:58.810

我在 SSRS 2005 中遇到了问题，即部署对报告的更改没有正确更新对参数的更改，尤其是新添加的参数。修复方法是使用报告管理器删除现有报告，然后上传修改后的版本。

希望这可以帮助，

账单

# asp.net - ASP.Net：是否可以缓存脚本管理器生成的 js 代理？

> ID：380384
> 
> 赞同：1
> 
> 时间：2008-12-19T08:40:29.323
> 
> 标签：asp.net, wcf, caching, scriptmanager

我们有以下代码：

```
 <asp:ScriptManager runat="server">
       ...

    <Services>
        <asp:ServiceReference Path="~/JSONServices/ProfileService.svc" />
    </Services>
        ... 
```

这会导致在 /JSONServices/ProfileService.svc/js 中找到一个 Javascript 代理。此 Javascript 的内容到期时间设置为与调用它的时间相同（因此它永远不会缓存在客户端上）。是否可以让客户端缓存这些代理一段时间？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-30T07:27:31.410

所以我们终于有时间再看看这个，我们最终得到了以下结果：

*   创建了一个新的 httphandler，它为格式为 *.cachedsvc 的所有请求启动 inn
*   在模块中，将请求转发到路径 *.svc（真正的代理所在的位置），并将内置 .svc 处理程序的结果缓存一段时间。

似乎可以解决问题。

然后我们需要做的就是在我们的脚本管理器中指定可缓存的路径，而不是 .svc 的真实路径（编辑器自然地将其标记为错误，但它就像一个魅力）

# asp.net-mvc - Sys.ArgumentUndefinedException: Value cannot be undefined

> ID：380389
> 
> 赞同：2
> 
> 时间：2008-12-19T08:43:25.027
> 
> 标签：asp.net-mvc, asp.net-ajax

I am developing some ajax stuff on asp.net mvc framework beta.

but,I got exception as following. Anyone has problem like me?

Sys.ArgumentUndefinedException: Value cannot be undefined.

and my source code is like this.

```
<asp:Content ID="indexContent" ContentPlaceHolderID="MainContent" runat="server">

<script src="../../Scripts/jquery-1.2.6.js" type="text/javascript"></script>
<script src="../../Scripts/MicrosoftAjax.debug.js" type="text/javascript"></script>
<script src="../../Scripts/MicrosoftMvcAjax.debug.js" type="text/javascript"></script>

<script type="text/javascript">
    var myView;

    $(pageLoad);

    function pageLoad() {
        myView = $create(Sys.UI.DataView, {}, {}, {}, $get("ajaxResult"));
        $("#callAjaxButton").click(callActionMethod);
    }

    function callActionMethod() {
        $.getJSON("/Home/GetCategories", bindData);
    }

    function bindData(data) {
        myView.set_data(data);
    }

</script>

<input type="button" id="callAjaxButton" value="ajaxCall" />

<div id="ajaxResult"></div>    

</asp:Content> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T15:49:52.353

从您提供的代码段中，有几件事需要考虑：

*   您缺少[对 Visual Studio 2008 的 Microsoft ASP.NET 2.0 AJAX 模板](http://www.microsoft.com/Downloads/details.aspx?FamilyID=5c7df430-1c34-40d2-b6ec-81353b5fcf2e&displaylang=en)的脚本引用。

*   您正在使用 jquery 的[document.ready](http://docs.jquery.com/Events/ready)函数（在准备好遍历和操作 DOM 时引发）而不是[System.Application.init](http://www.asp.net/AJAX/Documentation/Live/ClientReference/Sys/ApplicationClass/SysApplicationInitEvent.aspx)事件（在加载所有脚本之后但在创建对象之前引发）。

你可以试试这个看看它是否适合你：

```
<script src="../../Scripts/jquery-1.2.6.js" type="text/javascript"></script>
<script src="../../Scripts/MicrosoftAjax.debug.js" type="text/javascript"></script>
<script src="../../Scripts/MicrosoftMvcAjax.debug.js" type="text/javascript"></script>
<script src="../../Scripts/MicrosoftAjaxTemplates.debug.js" type="text/javascript"></script>

<script type="text/javascript">
    var myView;

    Sys.Application.add_init(pageLoad);

    function pageLoad() {
        myView = $create(Sys.UI.DataView, {}, {}, {}, $get("ajaxResult"));
        $("#callAjaxButton").click(callActionMethod);
    }

    function callActionMethod() {
        $.getJSON("/Home/GetCategories", bindData);
    }

    function bindData(data) {
        myView.set_data(data);
    }

</script>

<input type="button" id="callAjaxButton" value="ajaxCall" />
<div id="ajaxResult"></div> 
```

[Scott Hanselman](http://www.hanselman.com/blog/)写了一篇关于这个主题的好[文章。](http://www.hanselman.com/blog/jQueryToShipWithASPNETMVCAndVisualStudio.aspx)

# c# - c#的xml序列化中是否有跳过空数组的属性？

> ID：380398
> 
> 赞同：8
> 
> 时间：2008-12-19T08:49:02.567
> 
> 标签：c#, xml, arrays, serialization, xml-serialization

c#的xml序列化中是否有跳过空数组的属性？这将增加 xml 输出的可读性。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-19T08:52:01.780

好吧，您也许可以添加一个`ShouldSerializeFoo()`方法：

```
using System;
using System.ComponentModel;
using System.Xml.Serialization;
[Serializable]
public class MyEntity
{
    public string Key { get; set; }

    public string[] Items { get; set; }

    [EditorBrowsable(EditorBrowsableState.Never), Browsable(false)]
    public bool ShouldSerializeItems()
    {
        return Items != null && Items.Length > 0;
    }
}

static class Program
{
    static void Main()
    {
        MyEntity obj = new MyEntity { Key = "abc", Items = new string[0] };
        XmlSerializer ser = new XmlSerializer(typeof(MyEntity));
        ser.Serialize(Console.Out, obj);
    }
} 
```

`ShouldSerialize{name}`模式被识别，并调用方法查看是否在序列化中包含该属性。还有一种替代`{name}Specified`模式允许您在反序列化时也检测事物（通过设置器）：

```
[EditorBrowsable(EditorBrowsableState.Never), Browsable(false)]
[XmlIgnore]
public bool ItemsSpecified
{
    get { return Items != null && Items.Length > 0; }
    set { } // could set the default array here if we want
} 
```

# ruby - 如何重构这段 Ruby 代码以消除重复？

> ID：380403
> 
> 赞同：1
> 
> 时间：2008-12-19T08:50:18.570
> 
> 标签：ruby, optimization

我没有这样的问题，但我对 Ruby 很陌生。我在一种方法中有以下 3 段可重复的代码，我想知道真正的 Rubyist 如何首先删除重复项，然后使其更可重用。

这是有问题的代码：

```
file = File.new( destination)
doc = REXML::Document.new file

doc.elements.each("configuration/continuity2/plans") do |element| 
  element.attributes["storebasedir"]  =  "#{TEST_OUTPUT_DIRECTORY}"
end

doc.elements.each("configuration/add").each do |database|
  database.raw_attributes = database.attributes.merge("connectionstring" => "#{TEST_CONNECTION_STRING}")
end

doc.elements.each("configuration/connectionStrings/plans") do |connectionString|
  connectionString.raw_attributes = connectionString.attributes.merge("connectionString" => "#{TEST_CONNECTION_STRING}")
end 
```

任何建议表示赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-19T13:03:46.153

最后两个块可以替换为

```
["add", "connectionStrings/plans"].each do |elt_name|
  doc.elements.each("configuration/#{elt_name}").do |elt|
    elt.raw_attributes = elt.attributes.merge("connectionString" => "#{TEST_CONNECTION_STRING}")
  end
end 
```

我认为“connectionstring”和“connectionString”之间的大小写差异是偶然的。如果是这样，那正好说明了消除重复的好处。

此外，您可能可以替换`"#{TEST_CONNECTION_STRING}"`为`TEST_CONNECTION_STRING`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-19T08:52:55.413

您可以尝试添加一个尽可能通用的方法来避免这种情况，但它们对我来说有很大不同......您可能会冒着复杂的代码，只是为了能够将这些行包装成一个方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-19T10:23:42.610

我没有看到重复。您正在迭代的集合和显着不同的集合以及您对每个元素执行的操作也非常不同。我同意 Olivier 的观点，即任何删除重复的尝试都只会导致更复杂的代码。

# java - 为什么带有内部类的 Java 代码会生成第三个 SomeClass$1.class 文件？

> ID：380406
> 
> 赞同：18
> 
> 时间：2008-12-19T08:51:16.040
> 
> 标签：java, compiler-construction

如果我有一个内部类，像这样：

```
public class Test
{
    public class Inner
    {
        // code ...
    }

    public static void main(String[] args)
    {
        // code ...
    }
} 
```

当我编译它时，我希望它应该生成两个文件：

```
Test.class
Test$Inner.class 
```

那么为什么我有时会看到像 SomeClass$1.class 这样的类文件，即使 SomeClass 不包含名为“1”的内部类？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-12-19T08:54:35.583

SomeClass$1.class 代表匿名内部类

看看[这里的匿名内部类部分](http://java.sun.com/docs/books/tutorial/java/javaOO/innerclasses.html)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-04-16T16:44:18.743

`SomeClass$1.class`如果您的类包含私有内部类（非匿名），但您在父类中的某个位置实例化它，您还会得到类似的东西。

例如：

```
public class Person {

    private class Brain{
        void ponderLife() {
            System.out.println("The meaning of life is...");
        }
    }

    Person() {
        Brain b = new Brain();
        b.ponderLife();
    }
} 
```

这将产生：

```
Person.class
Person$Brain.class
Person$1.class 
```

就我个人而言，我认为这比典型的匿名类更容易阅读，尤其是在实现一个简单的接口或只用于传递给另一个本地对象的抽象类时。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-19T09:18:07.970

建立在 hhafez 上： SomeClass$1.class 代表匿名内部类。这种类的一个例子是

```
public class Foo{
  public void printMe(){
    System.out.println("redefine me!");
  }
}

public class Bar {
    public void printMe() {
    Foo f = new Foo() {
        public void printMe() {
        System.out.println("defined");
        }
    };
    f.printMe();
    }
} 
```

在普通 Main 中，如果您调用 new Bar().printMe，它将打印“已定义”，并且在编译目录中您会找到 Bar1.class

上述代码中的这一部分：

```
 Foo f = new Foo() {
        public void printMe() {
        System.out.println("defined");
        }
    }; 
```

称为匿名内部类。

# jar - 类路径和认可目录之间的区别

> ID：380411
> 
> 赞同：16
> 
> 时间：2008-12-19T08:52:40.220
> 
> 标签：jar, classpath, java, endorsed

有谁知道将适当的 JAR 文件（例如 Apache XALAN）添加到 JRE 的认可目录和将其添加到应用程序的类路径之间有什么区别？

是否可以采用可以添加到认可库中的 jar 文件并将其添加到类路径中？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-19T09:12:26.187

从技术上讲，您可能可以做到这一点，但不同之处在于认可目录中的 jar 文件由引导类加载器加载，该类加载器可能与从类路径加载 jar 的类加载器不同。

Xerces 和 Xalan XML 实现存在一个典型的 XML 问题，这些实现在 endorsed 目录中。因为较新的应用程序有时需要两个库的较新版本，并且类具有相同的名称，所以存在类路径问题。

您可以替换背书目录中的 Xerces 和 Xalan 库（备份您的旧库！），但这可能会破坏使用相同 JRE 安装的其他应用程序。

我什至在 1 个应用程序中看到了这个问题，其中一个库依赖于一个版本，另一个库依赖于另一个版本的 xerces。非常麻烦，并且对此没有“通用方法”，或者至少我没有找到。

谷歌很容易找到一些有趣的文章，尝试找到最符合您的情况或问题的文章。

# svn - 如何找出我的工作副本来自哪个版本控制系统？

> ID：380414
> 
> 赞同：4
> 
> 时间：2008-12-19T08:53:11.233
> 
> 标签：svn, directory, diff, cvs

如果您有一些来自不同版本控制系统（cvs、svn...）的目录，您如何找出每个目录来自什么类型的存储库？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-19T09:03:33.363

“svn info”是你想要的命令。

/一些/随机/目录/在/项目/空间/

```
$ svn info

Path: .
URL: https://example.org/svn/project/space/
Repository Root: https://example.org/svn/project/
Repository UUID: aaaaaaaa-bbbb-cccc-dddd-333333333333
Revision: 295
Node Kind: directory
Schedule: normal
Last Changed Author: kurt
Last Changed Rev: 295
Last Changed Date: 2008-12-14 01:43:24 -0500 (Thu, 18 Dec 2008) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-19T09:33:35.440

有`.svn`文件夹吗？-> **SVN**

有`CVS`文件夹吗？-> **CVS**

是否有以`.scc`and结尾的文件`.vssscc`（可能取决于 VSS 版本）？-> **Microsoft Visual SourceSafe**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T09:15:22.560

正如库尔特所说，svn info 会给你很多信息。如果您只想知道该目录是否处于修订控制之下，您可以查找其中包含所有数据的文件夹——对于 svn，它被称为“.svn”（您可能需要打开查看隐藏目录） darcs它的'_darcs'。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T09:18:50.963

TortoiseSVN 在 Windows 资源管理器中显示图标覆盖（当然是在 Windows 上）。您可以右键单击（此时存储库使用 TortoiseSVN 的事实很明显）并在上下文菜单中获取信息、帮助和许多 SVN 功能。

如果任何版本控制系统也使用图标覆盖，如果您使用多个系统，您仍然可能会遇到同样的问题，如上所述。

正如 Greg 所说，SVN 下的每个目录中还有一个 .svn 文件夹。

# java - 用于查询数据库并通过 HTTPS 将结果作为文件发送的应用程序

> ID：380415
> 
> 赞同：0
> 
> 时间：2008-12-19T08:53:30.827
> 
> 标签：java, jdbc, extract, data-transfer

我目前有一个工具，它允许我配置数据库连接（使用 JDBC）并指定一组查询以针对数据库运行。这计划在一天中的特定时间运行（当前使用 cron 或 windows 调度程序）。然后该工具将结果导出到文件 (xml) 并通过 HTTPS 将此文件发送到我的服务器。该工具安装在客户计算机上，以便我可以从他们那里获取一些数据供以后处理。

我想为此编写一个前端，使客户可以轻松地自己设置数据提取。但是，我对富客户端前端开发（作为集成软件开发人员）并不是很熟悉，并且想知道是否有一个现有的工具可以完成所有这些工作，或者是否值得学习一点 Swing 说这样我可以敲一个前端。你们中有人知道合适的工具吗？（我正在寻找一种功能单一的东西，而不是可能会吓跑一些客户的完整数据提取和转换套件）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T09:06:14.747

如果您的工具已经存在并且正在运行，我认为最好的方法是阅读一些有关 GUI 事件编程的知识（一旦掌握它并拥有一个不错的 GUI Builder，这将相当容易）并使用GUI 生成器。

对于 Java，我可以推荐 Netbeans IDE 及其 GUI Builder。

最简单的方法是 GUI 通过 Runtime.exec() 或类似方法将接收到的参数传递给现有工具。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T09:09:18.173

在我看来，通过 Swing 制作一个像样的 UI 非常容易和快速。[Swing 教程](http://java.sun.com/docs/books/tutorial/uiswing/)可能是一个好的开始。

# python - 如何在 PyGame 中响应鼠标点击精灵？

> ID：380420
> 
> 赞同：4
> 
> 时间：2008-12-19T08:54:57.330
> 
> 标签：python, pygame

使您的精灵响应 PyGame 中的鼠标点击的规范方法是什么？

在我的事件循环中，这是一些简单的事情：

```
for event in pygame.event.get():
    if event.type == pygame.QUIT:
        exit_game()
    [...]
    elif (  event.type == pygame.MOUSEBUTTONDOWN and
            pygame.mouse.get_pressed()[0]):
        for sprite in sprites:
            sprite.mouse_click(pygame.mouse.get_pos()) 
```

关于它的一些问题：

1.  这是响应鼠标点击的最佳方式吗？
2.  如果鼠标在精灵上持续按下一段时间怎么办？我如何从中制作单个事件？
3.  这是通知我所有精灵点击的合理方式吗？

提前致谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-25T22:46:33.913

我通常给我的可点击对象一个点击功能，就像你的例子一样。我将所有这些对象放在一个列表中，以便在调用单击函数时进行迭代。

在检查您按下的鼠标按钮时，请使用事件的按钮属性。

```
import pygame
from pygame.locals import * #This lets you use pygame's constants directly.

for event in pygame.event.get():
    if event.type == MOUSEBUTTONDOWN:  #Better to seperate to a new if statement aswell, since there's more buttons that can be clicked and makes for cleaner code.
        if event.button == 1:
            for object in clickableObjectsList:
                object.clickCheck(event.pos) 
```

我会说这是推荐的方法。点击只注册一次，所以它不会告诉你的精灵，如果用户正在用按钮“拖动”。这可以通过一个布尔值轻松完成，该布尔值在 MOUSEBUTTONDOWN 事件中设置为 true，在 MOUSEBUTTONUP 事件中设置为 false。具有迭代的“可拖动”对象以激活它们的功能......等等。

但是，如果您不想使用事件处理程序，则可以让更新函数检查输入：

```
pygame.mouse.get_pos() 
pygame.mouse.get_pressed(). 
```

这对于大型项目来说是个坏主意，因为它会产生难以发现的错误。最好将事件保存在一个地方。不过，较小的游戏，例如简单的街机游戏，使用探测风格可能更有意义。

# javascript - Rails active_resource 需要 JS 通过 link_to 来删除？

> ID：380423
> 
> 赞同：1
> 
> 时间：2008-12-19T08:58:50.893
> 
> 标签：javascript, ruby-on-rails, ruby, activeresource

当我使用 link_to :method=>:delete 时，rails 生成的是一个 javascript 点击，如果您确实遇到客户端禁用 javascript 的情况，这并不好。这对我来说似乎是个坏主意。有机会解决这个问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T17:55:03.583

您唯一的其他选择是手动进行。

假设您要删除的对象在 @item 中，只需执行以下操作：

```
form_for @item, :method => :delete do |f|
  f.submit "Delete this item"
end 
```

然后，您可以根据需要设置提交按钮的样式，使其看起来像一个普通链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T09:13:03.237

它生成的是一个带有method="delete"的表单，最好的办法是自己制作表单，唯一的问题是提交按钮不会是一个链接，而是一个按钮。

无论如何，您都不应该尝试使用 basic 来执行此`<a href="">`操作，因为不应该对`GET`请求进行破坏性操作（创建、更新、删除）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-09-12T16:16:23.360

如果您需要它在没有 JavaScript 的情况下工作，请使用`button_to`：

`<%= button_to 'Delete', @item, :method => :delete %>`

从文档：

> 生成一个包含单个按钮的表单，该按钮提交到由 +options+ 集创建的 URL。这是确保导致数据更改的链接不会被搜索机器人或加速器触发的最安全方法。

# c# - C#编译数值表达式

> ID：380424
> 
> 赞同：2
> 
> 时间：2008-12-19T09:00:34.493
> 
> 标签：c#, compilation

假设我允许用户输入允许使用显式函数集和预定义变量的任意数值表达式。

解释这一点很简单，但如果性能是一个关键因素呢？

我需要一种方法来（在运行时）将带有表达式的字符串编译成可以在变量上使用不同值执行 20K 次的东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T09:03:57.607

所以你真的想把字符串解析成（最终）一个类型化的委托。

一个选项，然后将字符串解析为`Expression`，然后您可以将其编译为 lambda。这是相当复杂的，但我有一些代码可以完成大部分工作——但可能有现有的解析器已经完全完成了这项工作。

作为一个简单的`Expression`例子：

```
 var x = Expression.Parameter(typeof(double), "x");
    var y = Expression.Parameter(typeof(double), "y");
    var body = Expression.Multiply(x, y);
    var func = Expression.Lambda<Func<double, double,double>>(body, x, y).Compile();

    double z = func(123.45, 678.90); 
```

问题是其余的解析代码；-p

上周我写了一个`string`解析器，但它的代码比我通常在这里发布的要多......超过 300 行（不包括识别定制的外部函数或命名参数（它目前使用匿名“？”占位符） `Expression`）。

但是如果（如您所说）解释很容易，那么也许使用类似的代码来编写`Expression`可以编译的代码？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-19T10:12:54.193

Microsoft 的 Linq 示例已经包含可扩展 Linq 解析器的实现。

```
sealed class Order
{
  public double SubTotal { get; set; }
  public double Shipping { get; set; }
}
static void Main()
{
  var calculateTotal = DynamicExpression
    .ParseLambda<Order, double>("SubTotal*@0+Shipping", 0.12)
    .Compile();

  var order = new Order
  {
    SubTotal = 124.99,
    Shipping = 7.99
  };
  Console.WriteLine(calculateTotal(order));
  Console.ReadLine();
} 
```

您可以查看[DbLinq 项目](http://code.google.com/p/dblinq2007/)的源代码或这篇文章了解更多详细信息：[Dynamic Linq and Expression Parsing in .NET as a hint of C# compiler extensibility](http://rabdullin.com/journal/2008/12/7/dynamic-linq-and-expression-parsing-in-net-as-a-hint-of-c-co.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T09:03:11.197

在 C# 4.0 中，它会变得非常简单直接。但是，在 C# 4.0 之前，我建议您使用`Microsoft.JScript`库来完成它。

这就是你想要的：[http ://www.odetocode.com/Articles/80.aspx](http://www.odetocode.com/Articles/80.aspx)

# c++ - Visual Studio 2005 (C++) 默认警告级别

> ID：380427
> 
> 赞同：2
> 
> 时间：2008-12-19T09:01:01.873
> 
> 标签：c++, visual-studio-2005, compiler-warnings, visual-c++-2005

我正在使用 MS Visual Studio 2005 进行 C++ 的新开发。为此，我需要在我的解决方案中添加几个新项目。我总是将警告级别设置为 4，并打开“将警告视为错误”（项目 -> 属性 -> C++ -> 常规）。

有没有办法告诉 Visual Studio 这是我的默认设置，所以我不必为我创建的每个新项目都这样做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T09:15:56.710

据我所知，唯一的方法是修改向导。这并不像听起来那么难。

转到您的 Visual Studio 目录。打开VC\VCWizards\1033目录，打开common.js文件。现在，搜索函数 AddCommonConfig。

现在，要将默认警告级别设置为 4，请找到“CLTool.WarningLevel = WarningLevel_3;”行 并将其更改为“CLTool.WarningLevel = WarningLevel_4;” （注意：它为调试和发布配置设置了两次，因此请确保为两者都更改它。）

现在，要将警告视为错误，请添加一行（对于两种配置）“CLTool.WarnAsError = true;”

但是请注意，这将更改所有默认 VC 向导的这些设置（但无论如何您可能都希望这样做。）

# firefox - 服务器会话

> ID：380430
> 
> 赞同：0
> 
> 时间：2008-12-19T09:02:22.417
> 
> 标签：firefox, session

如果我从 Firefox 浏览器打开与服务器的连接，然后在同一浏览器实例中打开一个新选项卡以与服务器建立连接，它是被视为一个服务器会话还是被视为两个差异会话？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T09:05:37.930

这是同一个会话（您可以自己轻松测试）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T09:35:15.967

这似乎是同一个会话。但是，如果我使用 diff 用户登录，两者似乎都归类在同一个会话下？这是正确的行为吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T09:56:00.857

如果您单击当前会话上的链接以在新选项卡中打开它，那么它就是同一个会话。如果您只是打开一个空白窗口并再次登录，那么据我所知，这是一个新会话。

# data-structures - 什么是 Zipper 数据结构，我应该使用它吗？

> ID：380438
> 
> 赞同：53
> 
> 时间：2008-12-19T09:05:14.017
> 
> 标签：data-structures, functional-programming, theory, zipper

问题很简单：我无法理解[Zipper](http://en.wikipedia.org/wiki/Zipper_(data_structure))数据结构。

我的问题与它与树的使用有关。

我想了解如何使用 zipper 更改树节点。以及如何不复制整个树（或大部分）。

请澄清我是否对拉链有误。也许它无法帮助更新树？
或者，也许，可以更新树而我只是看不到路？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-12-19T09:28:36.793

让我们从列表的拉链模拟开始。如果您想修改列表的第 n 个元素，则需要 O(n)，因为您必须复制 n-1 个第一个元素。相反，您可以将列表保留为结构（（前 n-1 个元素反转）第 n 个元素（其余元素））。例如，`(1 2 3 4 5 6)`可在 3 处修改的列表将表示为`((2 1) 3 (4 5 6))`。现在，您可以轻松地将 3 更改为其他内容。您还可以轻松地左右移动`((1) 2 (3 4 5 6))`焦点`((3 2 1) 4 (5 6))`。

拉链与应用于树木的想法相同。您代表树中的某个焦点加上一个上下文（上至父级，下至子级），它以一种形式为您提供整个树，它可以在焦点处轻松修改，并且可以轻松上下移动焦点。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-19T09:29:08.743

这是一篇非常好的文章，解释[了在 Haskell 中使用 zipper 作为平铺窗口管理器](https://donsbot.wordpress.com/2007/05/17/roll-your-own-window-manager-tracking-focus-with-a-zipper/)。维基百科的文章不是一个很好的参考。

简而言之，拉链是指向树或列表结构中特定节点的指针或句柄。zipper 提供了一种自然的方式来获取树结构并将其视为树被聚焦节点“拾取” - 实际上，您获得第二棵树而无需从原始树制作额外副本或影响其他用户那个树。

给出的示例显示了如何使窗口最初按屏幕上的位置排序，然后使用指向焦点窗口的拉链来模拟焦点。您可以获得一组不错的 O(1) 操作，例如插入和删除，而无需对焦点窗口进行特殊处理或编写额外的代码。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-08-09T22:01:29.533

Learn You a Haskell 也有[关于拉链的精彩章节](http://learnyouahaskell.com/zippers)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-20T15:34:21.183

[这篇文章](http://en.wikibooks.org/wiki/Haskell/Zippers)与 Haskell 相关，但它也很好地解释了 zippers，并且应该很容易从 Haskell-specifics 中抽象出来。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2022-01-23T03:36:15.283

代码集中在如图所示的单元格上。有上方、下方、左侧和右侧的区域。我们在这个网格上移动。焦点是绿色方块。

[![在此处输入图像描述](https://i.stack.imgur.com/cCPWm.png)](https://i.stack.imgur.com/cCPWm.png)

> 基本的 Haskell

```
type cell = { alive : bool ; column : int ; row : int }
;;

type grid = {gamegrid : cell list list}
;;

type gridzipper  =
             { above : grid
             ; below : grid
             ; left  : cell list
             ; right : cell list
             ; focus : cell }

let left g =
match g.left with
 [] -> None 
| hd::tl ->  let newgridzipper = { g  with focus = hd; left = tl; right = g.right @ [g.focus] } in
             Some(newgridzipper)
;; 
```

left 函数将焦点移到左侧。类似地，其他功能将焦点转移到其他网格单元。

[![在此处输入图像描述](https://i.stack.imgur.com/FCybb.png)](https://i.stack.imgur.com/FCybb.png)

# c++ - C++ 中指针类型的意义何在？

> ID：380442
> 
> 赞同：3
> 
> 时间：2008-12-19T09:07:22.653
> 
> 标签：c++, pointers, memcpy

假设我有一些指针称为：

```
char * pChar;
int * pInt; 
```

我知道它们都只是保存指向其他位置的内存地址，并且类型声明了特定指针指向的内存位置有多大。例如，一个 char 可能是系统上一个字节的大小，而一个 int 可能是 4 个字节。所以当我这样做时：

```
pChar++; // I am actually incrementing the address pointed to by pChar by 1 byte;
pInt++; // I am actually incrementing the address pointed to by pInt by 4 bytes; 
```

但是，如果我这样做：

```
pChar+2; // increment the address pointed to by pChar by 2 bytes?
pInt+2; // increment the address pointed to by pInt by 2 bytes? what happens to the other two bytes? 
```

谢谢..希望在这里得到任何澄清..指针类型是否仅用于 ++ 操作？

编辑：所以 avp 恰当地回答了我的问题，但我有一个后续问题，当我这样做时会发生什么：

```
memcpy(pChar,pInt,2); 
```

它会复制2个字节吗？还是4个字节？我会有访问冲突吗？

编辑：根据 Ryan Fox 的说法，答案是 2 个字节，因为它们被强制转换为 (void*)。谢谢！关闭！

编辑：只是为了让未来的搜索者可以找到这个..我发现的另一条信息..

```
memcpy(pChar+5,pInt+5,2); 
```

不会将 pInt+5bytelocations 指向的内存块的 2 个字节复制到 pChar+5bytelocations .. 发生的情况是 2 个字节从 pInt(4*5)bytelocations 复制到 pChar+5bytelocations .. 难怪我遇到访问冲突，我试图在我不应该阅读的地方阅读.. :)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-19T09:11:13.223

"++" 只是 X = X + 1 的另一个名称；

对于指针，递增 1 或递增 N 无关紧要。无论如何，使用 sizeof(type)*N。在 1 的情况下，它只是 sizeof(type)。

因此，当您增加 2 时（您的第二种情况）：
对于 char 是 2*sizeof(char)=2*1=2 字节，
对于 int 将是 2*sizeof(int)=2*4=8 字节。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-19T09:16:15.570

啊，现在我明白了。您应该问过 - **“指针具有类型有什么意义？”**

其实有两点：

*   指针算法；
*   取消引用（取回存储在指针指向的地址中的值）。

如果不知道指针的类型，两者都是不可能的。

**补充：**阅读 memcpy 的文档。最后一个参数是字节数，因为 memcpy 不知道指针的类型。它的两个参数都是空指针。

**添加 2：**访问冲突 - 视情况而定。如果您没有超出为这些指针分配的内存，则不会发生访问冲突。复制操作将逐字节复制所有内容，您将获得与预期一样的结果（尽管它可能没有多大意义）。

如果您超出分配的内存范围，那么您**可能会**遇到访问冲突，但您也可能只是越过为另一个变量分配的内存。当你的程序被执行时，几乎不可能知道什么会到达哪里，所以这样做会导致非常不可预测的结果。

* * *

~~指针的三个主要优点：~~

 ~~1.  您可以“通过引用”将参数传递给函数。这在 C 中更多是一个问题，它没有像 C++ 这样的真正引用，但在许多情况下它仍然非常有用，比如当您必须与外部库合作时。另请注意，通过引用传递不仅在您希望函数修改您传递的变量时有用。它也非常适合将大型数据结构作为参数传递。
2.  用于构建各种漂亮的动态数据结构，如树、链表等。如果没有指针，这将是不可能的。
3.  为了能够根据需要将数组重新分配给更大/更小的数组。~~ 

~~PS我知道问题是关于为什么指针很好，仅以算术为例，对吧？~~

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-19T09:12:01.380

指针算术不能以这种方式精确地工作。你的第一个例子是正确的，第二个不是。

```
pChar+2; // increment the address pointed to by pChar by 2 bytes
pInt+2; // increment the address pointed to by pInt by 8 bytes 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-19T13:57:31.457

对于这部分：

> memcpy(pChar+5,pInt+5,2);

首先，评估“+”，然后进行类型转换。

所以以字节为单位：

pChar+5 这里的“5”是 5 个字节，
pInt+5 这里的“5”是 5 个整数，所以 5 * 4 = 20 个字节。
然后将所有内容都转换为 void* 并复制两个字节。

如果您使用计数器而不是“5”，如下所示：

```
for (int i = 0; i<100; i++)
    memcpy(pChar+i, pInt+i, 2); 
```

然后对于 pChar，您将使用下一个复制命令覆盖一个复制的字节（第二个）。而对于 pInt 你将每一步跳跃 4 个字节（虽然这对于整数数组来说是可以的）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T10:23:48.507

我会说**C++**中指针类型的意义在于考虑 vtable 偏移量。

# iis-7 - vista上如何重新安装iis 7.0 CLEAN？

> ID：380444
> 
> 赞同：4
> 
> 时间：2008-12-19T09:08:47.393
> 
> 标签：iis-7, windows-vista, installation

由于一些未解决的配置问题，我需要在 Vista 上重新安装 IIS 7.0。

我认为这很容易：我在程序/功能中卸载了所有与 IIS 相关的东西，重新启动系统，再次安装所有 IIS 模块（不需要安装 cd），嗯.. 一切看起来都一样 - 我的意思是错误的。我看到所有已配置的网站、模块、池等。

有什么聪明的方法可以使用 CLEAN 数据库/元数据库/配置文件/全新安装文件进行 CLEAN 安装？重新安装整个操作系统不是一个好的解决方案。

最好的祝福，

托梅克

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T10:55:21.530

我遇到了同样的问题，格式化我的硬盘驱动器不是一种选择。

答案已在评论中提供，即在重新安装 IIS*之前***卸载**Windows 组件中的**Windows 激活服务。**

 *我希望这对那里的一些人有所帮助，因为我注意到在谷歌搜索问题时我们并不是唯一的人......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T09:26:55.767

据我了解，IIS7 中的所有配置都是在不同的 web.config 文件中完成的。因此，保留它们将在重新安装后保留您的（错过）配置。

# c# - 如何遍历列表框中的项目，然后删除这些项目？

> ID：380451
> 
> 赞同：22
> 
> 时间：2008-12-19T09:12:57.543
> 
> 标签：c#, listbox

尝试遍历列表框然后删除该项目时，出现以下错误。

> 此枚举器绑定到的列表已被修改。仅当列表不变时才能使用枚举器。

```
foreach (string s in listBox1.Items)
{
    MessageBox.Show(s);
    //do stuff with (s);
    listBox1.Items.Remove(s);
} 
```

如何删除该项目并仍然循环浏览内容？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-12-19T09:15:37.647

是否要删除所有项目？如果是这样，`foreach`请先执行，然后再使用`Items.Clear()`删除所有这些。

否则，可能会通过索引器向后循环：

```
listBox1.BeginUpdate();
try {
  for(int i = listBox1.Items.Count - 1; i >= 0 ; i--) {
    // do with listBox1.Items[i]

    listBox1.Items.RemoveAt(i);
  }
} finally {
  listBox1.EndUpdate();
} 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-12-19T09:31:59.937

其他人都发布了“倒退”的答案，所以我会给出另一种选择：创建一个要删除的项目列表，然后在最后删除它们：

```
List<string> removals = new List<string>();
foreach (string s in listBox1.Items)
{
    MessageBox.Show(s);
    //do stuff with (s);
    removals.Add(s);
}

foreach (string s in removals)
{
    listBox1.Items.Remove(s);
} 
```

有时“向后工作”方法更好，有时上述方法更好 - 特别是如果您正在处理具有`RemoveAll(collection)`方法的类型。不过都值得知道。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-19T10:12:12.103

这是我的解决方案，没有后退也没有临时列表

```
while (listBox1.Items.Count > 0)
{
  string s = listBox1.Items[0] as string;
  // do something with s
  listBox1.Items.RemoveAt(0);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-19T09:18:37.313

您必须从最后一个项目到第一个项目来遍历集合。此代码在 vb 中

```
for i as integer= list.items.count-1 to 0 step -1
....
list.items.removeat(i)
next 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-19T09:20:55.637

杰斐逊是对的，你必须倒退。

这是 c# 等价物：

```
for (var i == list.Items.Count - 1; i >= 0; i--)
{
    list.Items.RemoveAt(i);
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-19T10:12:27.283

怎么样：

```
foreach(var s in listBox1.Items.ToArray())
{
    MessageBox.Show(s);
    //do stuff with (s);
    listBox1.Items.Remove(s);
} 
```

ToArray 会生成列表的副本，因此您无需担心在处理列表时它会更改列表。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-10-07T09:09:18.187

`while(listbox.Items.Remove(s)) ;`也应该工作。但是，我认为向后的解决方案是*最快*的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-01-11T09:54:24.133

您不能对 ForEach 块中迭代的集合进行修改。

一个快速的解决方法是遍历集合的副本。制作此副本的一种简单方法是通过 ArrayList 构造函数。复制集合中的 DataRowView 对象将引用并能够修改与您的代码相同的基础数据。

```
For Each item As DataRowView In New System.Collections.ArrayList(lbOrdersNeedToBeVoided.Items) 
```

请阅读[http://social.msdn.microsoft.com/Forums/en-AU/vbgeneral/thread/b4d1f649-d78a-4e5b-8ad8-1940e3379bed](http://social.msdn.microsoft.com/Forums/en-AU/vbgeneral/thread/b4d1f649-d78a-4e5b-8ad8-1940e3379bed)

# operating-system - 确定分区属于哪个文件系统

> ID：380454
> 
> 赞同：4
> 
> 时间：2008-12-19T09:13:50.550
> 
> 标签：operating-system, filesystems

操作系统如何知道分区正在使用什么文件系统？换言之，FAT16/32、NTFS、ext2/3等如何区分？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-19T09:34:34.487

如果您在 Windows 上使用 Win32 API，则可以调用 GetVolumeInformation ( [http://msdn.microsoft.com/en-us/library/aa364993.aspx](http://msdn.microsoft.com/en-us/library/aa364993.aspx) ) 来确定给定安装卷上存在的文件系统类型。

例如，如果您尝试检测 D: 上存在的文件系统，那么您可以调用：

```
WCHAR FSType[512];    

if (GetVolumeInformationW(L"D:\\", NULL, 0, NULL, NULL, NULL, FSType, ARRAYSIZE(FSType))) {
    wprintf(L"FS type = %s\n", FSType);    
} 
```

但是，这仅在文件系统被正在运行的操作系统“识别”和“可挂载”时才有效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-19T09:24:15.833

几乎每个文件系统都有一些头信息，称为“超级块”。超级块包含幻数或有关文件系统类型的其他信息。

MBR 分区表还存储了一个 8 位的值，表示分区类型。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-19T09:58:26.873

有几种方法，具体取决于硬件类型。

硬盘有一个*主引导记录*，后跟一个*分区表*。[PT](http://www.ntfs.com/partition-table.htm)包含此驱动器上的分区列表。该列表中的每个条目都包含（除其他外）一个指定分区文件系统的数字[系统 ID字段。](http://www.ntfs.com/partition-table.htm#sec1)

软盘和大多数 U 盘没有 PT。在这里，您必须查看分区本身。第一个分区扇区（称为[引导扇区](http://www.ntfs.com/fat-partition-sector.htm)）通常包含*与 PT 中的系统 ID 格式完全不同的系统 ID。*此外，扇区内 ID 的位置可能因文件系统而异。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-19T09:23:14.480

首先，分区表中有一个指定分区类型的字节。其次，每个分区都有不同的标题和结构，因此通过一些分析可以非常精确地确定它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-19T09:26:13.413

假设你有一个[MBR](http://en.wikipedia.org/wiki/Master_boot_record)，那么关于 4 个主分区的详细信息可以在 0x01BE 找到。描述分区的十六个字节之一是类型标识符。

0x06 的 id 是[fat16](http://en.wikipedia.org/wiki/File_Allocation_Table)， 0x0B 是 FAT32 ， 0x07 是[NTFS](http://en.wikipedia.org/wiki/Ntfs)， 0x82 是 Linux 分区。

除此之外，文件系统在分区内的特定位置具有可以检测到的结构。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-10-10T07:13:19.563

处理设置文件系统或挂载它们的操作系统工具将使用各种启发式方法来尝试检测文件系统，例如查找它们具有的功能。例如，当“挂载”工具没有被告知要挂载的分区的文件系统类型时，它会按照“手册”页面的描述进行操作：

```
If no -t option is given, or if the auto type is  specified,  mount  will
try to guess the desired type.  Mount uses the blkid library for guessing
the filesystem type; if that does not turn up anything that looks  familiar,
mount  will try to read the file /etc/filesystems, or, if that does
not exist, /proc/filesystems.  All of the filesystem types  listed  there
will  be  tried, except for those that are labeled "nodev" (e.g., devpts,
proc and nfs).  If /etc/filesystems ends in a line with a single *  only,
mount will read /proc/filesystems afterwards. 
```

blkid 库和 'disktype' 工具将，如果你给它一个磁盘块设备（如 /dev/sda）或分区块设备（如 /dev/sda1），使用启发式和有根据的猜测来确定其中的内容设备。非常有用的工具，尤其是在没有磁盘只有虚拟分区的xen环境中，因此你不能只查询主引导记录。

在设置新的基于 Linux 的系统（如 Ubuntu）时，会使用类似的工具来检测文件系统。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-19T09:25:51.790

在 linux 上，当您挂载文件系统时，您可以传递 -t ext3/ext3 等 - 如果您查看 /etc/fstab（或等效项），每个驱动器可能都列出了其 fs 类型。

然后为了自动执行它，有超级块/等效项（认为 Windows 类型将其称为其他东西）......

看到这个：

超级块

> 每个文件系统都是不同的，它们有 ext2、ext3 等类型。此外，每个文件系统的大小有 5 GB、10 GB 和挂载状态等状态。简而言之，每个文件系统都有一个超级块，其中包含有关文件系统的信息，例如：
> 
> ```
> * File system type
> * Size
> * Status
> * Information about other metadata structures 
> ```

取自：

[http://www.cyberciti.biz/tips/understanding-unixlinux-filesystem-superblock.html](http://www.cyberciti.biz/tips/understanding-unixlinux-filesystem-superblock.html)

# parsing - 寻找“标记器”、“解析器”和“词法分析器”是什么以及它们如何相互关联和使用的明确定义？

> ID：380455
> 
> 赞同：173
> 
> 时间：2008-12-19T09:14:50.720
> 
> 标签：parsing, lexer, tokenize

我正在寻找关于什么是“分词器”、“解析器”和“词法分析器”以及它们如何相互关联的明确定义（例如，解析器是否使用分词器，反之亦然）？我需要创建一个程序，将通过 c/h 源文件来提取数据声明和定义。

我一直在寻找示例并且可以找到一些信息，但我真的很难掌握语法规则、解析树和抽象语法树等基本概念以及它们如何相互关联。最终这些概念需要存储在一个实际的程序中，但是 1）它们看起来像什么，2）有没有共同的实现。

我一直在查看有关 Lex 和 Yacc 等主题和程序的 Wikipedia，但从未学习过编译器类（EE 专业），我发现很难完全理解发生了什么。

* * *

## 回答 #1

> 赞同：200
> 
> 时间：2008-12-19T09:25:14.193

标记器将文本流分解为标记，通常通过查找空格（制表符、空格、换行符）。

词法分析器基本上是一个标记器，但它通常为标记附加额外的上下文——这个标记是一个数字，那个标记是一个字符串文字，这个另一个标记是一个相等运算符。

解析器从词法分析器中获取标记流，并将其转换为表示（通常）由原始文本表示的程序的抽象语法树。

上次我查了一下，关于这个主题的最好的书是[“编译器：原理、技术和工具”，](http://en.wikipedia.org/wiki/Compilers:_Principles,_Techniques,_and_Tools)通常被称为“龙之书”。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-26T17:37:37.983

例子：

```
int x = 1; 
```

词法分析器或标记器会将其拆分为标记“int”、“x”、“=”、“1”、“;”。

解析器将获取这些标记并以某种方式使用它们来理解：

*   我们有一个声明
*   这是一个整数的定义
*   整数称为“x”
*   'x' 应该用值 1 初始化

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-19T09:25:41.900

我会说词法分析器和标记器基本上是同一件事，它们将文本分解成其组成部分（“标记”）。然后解析器使用语法解释标记。

不过，我不会太拘泥于精确的术语用法——人们经常使用“解析”来描述解释一段文本的任何动作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-03-09T12:09:28.500

（*添加到给定的答案*）

*   Tokenizer 还将*删除*所有评论，并且只将**标记**返回给 Lexer。
*   Lexer 还将*定义*这些标记（变量/函数）的范围
*   然后解析器将构建代码/程序结构

# coding-style - 在函数注释中标记参数名称

> ID：380458
> 
> 赞同：0
> 
> 时间：2008-12-19T09:15:20.657
> 
> 标签：coding-style, comments

我在注释代码时遇到的最常见的难题之一是如何标记参数名称。我将解释我的意思：

```
def foo(vector, widht, n=0):
  """ Transmogrify vector to fit into width. No more than n 
      elements will be transmogrified at a time
  """ 
```

现在，我的问题是参数名称`vector`,`width`和`n`在该注释中没有以任何方式区分，并且可能与简单文本混淆。其他一些选项：

> 变形“矢量”以适应“宽度”。不超过'n'

或许：

> 变形 -vector- 以适应 -width-。不超过-n-

甚至：

> 变形 :vector: 以适应 :width:。不超过:n:

你明白了。像 Doxygen 这样的工具会强制执行此操作，但是如果我不使用工具怎么办？这种语言依赖吗？

你**喜欢**用什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-19T09:20:27.653

我个人更喜欢单引号——你的第一个例子。当下划线和斜体均不可用时，它似乎最接近在英文文本中引用某些标题/命名实体的方式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T09:40:02.963

我同意鲁本的观点：第一个例子是最易读的。

当然，这取决于您个人的阅读习惯——如果您习惯于阅读第三个示例的风格的评论，您可能会发现这种风格最易读。

但第一种风格最接近我们在日常生活中阅读和书写文本的方式（报纸、书籍）。因此，对于没有阅读您评论的经验的人来说，这是最容易阅读的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T09:42:43.037

有点不使用，只是将变量的名称放在文本中。或者我以这样的方式编写整个文本，它解释了函数的作用，但没有提及其中的参数。在这种情况下，当您了解函数的作用时，参数的含义应该自己清楚。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T10:11:08.487

我最喜欢的选择是写：

```
def foo(vector, width, n=0):
  """ Transmogrify 'vector' to fit into 'width'. No more than 'n' 
      elements will be transmogrified at a time

      @param vector: list of something
      @param width:  int
      @keyword n:      int (default 0)
  """ 
```

 `Epydoc recognizes @param (see [Epydoc manual](http://epydoc.sourceforge.net/manual-fields.html)), and you can use some fancy regexp to find and print parameters of your function, and hopefully Eclipse will start to show parameters description for Python functions in quick assist some day, and I'm pretty sure that it would follow pattern` 

```
@ <keyword> <paramName> <colon>  
```

无论如何，当那一天到来时，用@anythingElse 替换@param 会很容易。

# java - 如何专注于表格中的 JTextField

> ID：380482
> 
> 赞同：3
> 
> 时间：2008-12-19T09:24:08.440
> 
> 标签：java, swing, jtable, jtextfield

我正在一种电子表格程序中编写搜索和替换功能。我想要的是，如果您搜索一个字符串，程序会显示一个包含已找到元素的表格。

到目前为止一切顺利，但我无法让元素获得焦点，光标在其中，因此您可以立即开始输入。

我正在使用定制的`JTable`，也是定制的`TableCellEditor`. 以下技巧似乎不起作用：（在自定义中`TableCellEditor`）：

```
SwingUtilities.invokeLater(new Runnable() { 
    public void run() { 
        my_textfield.requestFocus(); 
    } 
}); 
```

或者：

```
my_jtable.editCellAt(0, 3);
my_jtable.requestFocus(); 
```

或者

```
my_jtable.getEditorComponent().requestFocusInWindow(); 
```

我错过了什么吗？是否有一个很好的描述（漂亮的流程图）来显示事件是如何发生的？或者可能做类似事情的示例代码？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T07:46:57.070

通过一些谷歌搜索，我找到了一个论坛主题：以[编程方式开始编辑 JTable 中的单元格，并](http://coding.derkeiler.com/Archive/Java/comp.lang.java.gui/2006-06/msg00188.html)回答了以下想法：

（在 JTable 的子类中）

```
editCellAt(row,column);

requestFocus();
DefaultCellEditor ed = (DefaultCellEditor)
getCellEditor(row,column);

ed.shouldSelectCell(new ListSelectionEvent(this,row,row,true)); 
```

它会起作用吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T10:11:23.633

您是否尝试过没有 requestfocus 的 editcellat ？

还要确保您覆盖/实施以返回 true

```
 /**
     * Returns true.
     * @param anEvent  an event object
     * @return true
     */
    public boolean shouldSelectCell(EventObject anEvent) { 
    return true; 
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-05-04T11:31:26.563

检查您是否在自定义表实例上启用了选择，如下所示：

```
table.setColumnSelectionAllowed(true);
table.setRowSelectionAllowed(true); 
```

设置好后，通常调用`table.editCellAt(row, col);`开始编辑。例子 ：

```
JTable myTable = new JTable(rows, cols);
myTable.setColumnSelectionAllowed(true);
myTable.setRowSelectionAllowed(true); 
```

和其他地方..需要编辑的地方，

```
boolean wasEditStarted = table.editCellAt(row, col);
if (wasEditStarted) {
  table.changeSelection(row, col, false, false);
} 
```

# windows - 为控制台加速 Windows 上的文本输出

> ID：380490
> 
> 赞同：1
> 
> 时间：2008-12-19T09:25:52.430
> 
> 标签：windows, optimization, graphics, console

我们有一个应用程序，它有一个或多个文本控制台窗口，它们基本上都代表串行端口（文本输入和输出，逐个字符）。这些窗口在它们当前的代码方式中已经变成了一个主要的性能问题……我们设法在其中花费了大量的时间。

当前代码的结构是让窗口过着自己的小生命，主应用程序线程通过“SendMessage()”调用驱动它。这种消息传递似乎是令人难以置信的开销的原因。基本上，绕道操作系统感觉是错误的做法。

请注意，我们确实在适当的地方将文本行作为一个整体绘制，因此已经完成了简单的优化。

我不是 Windows 编码方面的专家，所以我需要询问社区是否有其他架构来驱动窗口中的文本显示而不是发送这样的消息？看起来很重量级。

请注意，这是使用 C++ 或纯 C 语言编写的，因为主应用程序是可移植的 C/C++/其他一些语言程序，也可以在 Linux 和 Solaris 上运行。

我们做了更多的调查，似乎一半的开销是使用 SendMessage 准备和发送每条消息，另一半是实际的屏幕绘制。SendMessage 在同一文件中的函数之间完成...

所以我想下面给出的所有建议都是正确的：

*   看重画了多少东西
*   直接画东西
*   及时分块绘制操作，不要将每个字符都发送到屏幕上，以串行控制台的 10 到 20 Hz 更新速率为目标。

你能接受所有的答案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T09:35:16.733

您应该尝试正确地进行分析，但作为替代，我将不再担心 SendMessage，这几乎肯定不是您的问题，而是考虑重绘窗口本身。

您将这些描述为“文本控制台窗口”，然后说您有多个 - 它们实际上是 Windows 控制台吗？或者它们是您的应用程序正在绘制的东西？

如果是后者，那么我将考虑测量我的绘制代码，以及我是否在每次更新时使太多的窗口无效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T09:46:41.950

输出窗口是同一应用程序的一部分吗？几乎听起来他们不是...

如果是，您应该研究[观察者设计模式](http://en.wikipedia.org/wiki/Observer_pattern)以摆脱 SendMessage()。我已经将它用于相同类型的用例，并且对我来说效果很好。

如果你不能做出这样的改变，也许你可以将你的输出缓冲 100 毫秒，这样你就不会每秒有太多的传出消息，但它也应该以舒适的速度更新。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T10:51:37.093

我同意 Will Dean 的观点，即控制台窗口或文本框中的绘图本身就是性能瓶颈。您首先需要确定这不是您的问题。你说你把每条线画成一个整体，但如果数据吞吐量太高，即使这样也可能是个问题。

我建议您不要使用 SendMessage 将数据从主应用程序传递到文本窗口。相反，请使用其他一些沟通方式。这些是在同一个过程中吗？如果没有，您可以使用共享内存。在某些情况下，甚至磁盘中的文件也可以。让主应用程序写入该文件，文本控制台从中读取。您可以向文本控制台发送 SendMessage 通知，以通知它更新视图。但是不要在有新线路到达时发送消息。定义两个后续更新之间的最小间隔。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T11:04:53.573

> 输出窗口是同一应用程序的一部分吗？几乎听起来他们不是...

是的，它们都在同一个过程中。

我没有编写这段代码......但似乎 SendMessage 对这一切都在一个应用程序案例中有点沉重。

> 您将这些描述为“文本控制台窗口”，然后说您有多个 - 它们实际上是 Windows 控制台吗？或者它们是您的应用程序正在绘制的东西？

我们的应用程序正在绘制它们，它们不是常规的 Windows 控制台。

请注意，我们还需要在用户输入控制台时取回数据，因为我们经常有交互式串行会话。可以将其想象为与您在串行终端程序中看到的非常相似——但使用外部应用程序显然比我们现在拥有的更昂贵。

> 如果你不能做出这样的改变，也许你可以将你的输出缓冲 100 毫秒，这样你就不会每秒有太多的传出消息，但它也应该以舒适的速度更新。

好点子。现在，每个字符输出都会导致发送一条消息。

当我们在换行符出现时向上滚动窗口时，我们会逐行重绘它。

请注意，我们还有一个任意大小的回滚缓冲区，但回滚是一种交互式情况，性能要求要低得多。

# iphone - 横向模式下 UINavigationBar 的自定义背景

> ID：380507
> 
> 赞同：7
> 
> 时间：2008-12-19T09:33:36.737
> 
> 标签：iphone, uinavigationbar

我正在为我的 UINavigationBar 添加自定义背景。只要手机处于纵向模式，它就可以正常工作。一旦我切换到横向模式，一半的栏显示为蓝色（默认导航栏颜色），一半有我的图像

如何在横向模式下拉伸图像并在纵向模式下再次变小？

谢谢

***解决方案***
万一有人在寻找如何将图像添加到导航栏的答案 - 这里有

```
UIImageView *imgView = [[UIImageView alloc] initWithFrame:CGRectMake(0.0, 0.0, 480.0, 44.0)];
[imgView setImage:[UIImage imageWithContentsOfFile:[[NSBundle mainBundle] pathForResource:@"navbar_landscape" ofType:@"png"]]];
[navigationController.navigationBar addSubview:imgView];
[imgView release]; 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-28T05:52:35.627

在两种屏幕方向模式下，使用起来要好得多

```
[navigationController.navigationBar insertSubview:imgView atIndex:0]; 
```

这会将图像视图置于所有其他视图之下，并且所有默认导航栏元素（标题、标准按钮）都可以正常工作。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-01-10T21:54:33.443

经过一番研究和反复试验，我找到了一种解决方法，当您进入电影播放模式时，它不会取代导航栏。希望这不会导致应用程序批准出现问题，但根据这篇文章，我认为应该没问题：

[http://developer.apple.com/iphone/library/qa/qa2009/qa1637.html](http://developer.apple.com/iphone/library/qa/qa2009/qa1637.html)

```
@implementation UINavigationBar (UINavigationBarCategory)

- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx
{
    if([self isMemberOfClass: [UINavigationBar class]]){
        UIImage *image = [UIImage imageNamed:@"navBarBackground.png"];
        CGContextClip(ctx);
        CGContextTranslateCTM(ctx, 0, image.size.height);
        CGContextScaleCTM(ctx, 1.0, -1.0);
        CGContextDrawImage(ctx, CGRectMake(0, 0, self.frame.size.width, self.frame.size.height), image.CGImage);
    }else{
        [super drawLayer:layer inContext:ctx];
    }
}

@end 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-19T14:15:42.683

您可能需要设置背景图像视图的 autoresizingMask；尝试使用`UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-24T14:34:16.823

Ben给出的解决方案确实解决了这个问题，但它在横向模式下拉伸了图像。我最终创建了两张图像 - 一张用于横向模式，另一张用于纵向模式。然后我在 shouldAutoRotate 中添加了代码以根据方向更改导航栏图像

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-02-13T10:04:57.487

您可以通过检查 UINavigation 栏实例的帧大小为不同的方向提供不同的图像来更改纵向和横向的图像：

```
- (void) drawLayer:(CALayer *)layer inContext:(CGContextRef)context
{
    if ([self isMemberOfClass:[UINavigationBar class]] == NO) {
        return;
    }

    UIImage *image = (self.frame.size.width > 320) ?
                        [UINavigationBar bgImageLandscape] : [UINavigationBar bgImagePortrait];
    CGContextClip(context);
    CGContextTranslateCTM(context, 0, image.size.height);
    CGContextScaleCTM(context, 1.0, -1.0);
    CGContextDrawImage(context, CGRectMake(0, 0, self.frame.size.width, self.frame.size.height), image.CGImage);
} 
```

这个关于自定义UINavigationBar外观的[完整演示 Xcode 项目](http://www.ardalahmet.com/2011/02/11/ios-development/customizing-the-appearance-of-uinavigationbar/)可能会有所帮助。它还包括@2x 版本的背景图像，以支持 iPhone 4 设备上的视网膜显示。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-20T16:31:42.860

尝试更简单的方法，`[UIImage imageNamed:@"navbar_landscape.png"]`因为 UI 元素正是**imageNamed:**的用途，如 ljonesATL 所示。

# vb.net - 运行时检查失败 #0 vb.net 来自 C dll 的回调

> ID：380509
> 
> 赞同：1
> 
> 时间：2008-12-19T09:35:06.000
> 
> 标签：vb.net, dll, callback, runtime

我正在用 VB.Net 编写插件应用程序 A，用 C 语言编写 DLL B。应用程序 A 将回调方法传递给 dll B。当某些事件发生时，dll 会从 A 调用回调。整个在我的 PC 上工作正常，但是当我将它移动到笔记本时出现错误：

*运行时检查失败 #0 - ESP 的值未在函数调用中正确保存。这通常是调用使用一种调用约定声明的函数和使用另一种调用约定声明的函数指针的结果。*

这是 C 代码的一部分：

```
typedef void (__cdecl * OFFICE_PTR)();
void  TAPIClient::tapiCallBack(
DWORD hDevice,
DWORD dwMessage,
DWORD dwInstance,
DWORD dwParam1,
DWORD dwParam2,
DWORD dwParam3){
switch (dwMessage)
{
    case LINE_CALLSTATE:
        switch (dwParam1)
        {
            case LINECALLSTATE_OFFERING:
                                    if(dwInstance!=NULL)
                {
                    try
                    {   
                        OFFICE_PTR vbFunc =(OFFICE_PTR)dwInstance;
                        vbFunc( );//Critical moment
                    }
                    catch(...)
                    {
                        MessageBox (NULL, L"( (OFFICE_PTR)dwInstance )(&sCallNr)",L"ERROR",MB_OK);
                    }
                }
            break;
        };
    break;
} 
```

}

其中 dwInstance 是应用的地址 一个回调方法

这是 VB.Net 代码的一部分：

```
Public Class TapiPlugin

Public Delegate Sub P_Fun()

Private Declare Function startSpy _
    Lib "TAPIClient.dll" _
    (ByVal pFun As P_Fun) As IntPtr

Public Shared Sub simpleTest()
    MsgBox("Plugin sub simpleTest")
End Sub

Public Sub onStart()
    Dim pBSTR As IntPtr
    pBSTR = startSpy(AddressOf simpleTest)
    MsgBox(Marshal.PtrToStringAuto(pBSTR))
    Marshal.FreeBSTR(pBSTR)
End Sub

End Class 
```

当我尝试调用“vbFunc()”时发生错误。如果有任何帮助，我将不胜感激。:D

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-10T23:44:01.523

If the calling convention is `cdecl`, then you need to declare your delegate like this:

```
<UnmanagedFunctionPointer(CallingConvention.Cdecl)>
Public Delegate Sub P_Fun() 
```

You can only do this in .NET 2.0 and after, as the attribute was not introduced before then (and the interop layer was not changed to acknowledge it before that).

If the calling convention is indeed `stdcall` then the delegate can remain as is. You said it is `stdcall`, but I have doubts, since the exception is explicitly telling you that there might be a mismatch in calling conventions.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T09:43:56.933

两台计算机的指针大小可能不同吗？也许一台是 64 位机器而另一台只有 32 位？

```
typedef void (__cdecl * OFFICE_PTR)();
void  TAPIClient::tapiCallBack(
DWORD hDevice,
DWORD dwMessage,
DWORD dwInstance,
...){
...
        OFFICE_PTR vbFunc =(OFFICE_PTR)dwInstance;
        vbFunc( );//Critical moment 
```

DWORD 类型对于传递指针类型并不真正有效。我猜你应该使用 INT_PTR 。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T09:56:56.330

我认为这不是检查它的理由，我将回调作为 OFFICE_PTR 类型的全局指针传递，我得到了相同的结果。在PC上它在笔记本上工作正常它崩溃:(

必须为我写的 def 看起来像的错误道歉：

```
typedef void (__cdecl * OFFICE_PTR)(); 
```

但实际上它看起来像

```
typedef void (__stdcall * OFFICE_PTR)(); 
```

# c# - 查找对对象的引用

> ID：380512
> 
> 赞同：6
> 
> 时间：2008-12-19T09:36:20.817
> 
> 标签：c#, debugging

有没有办法在调试时找到对对象的所有引用？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-19T09:37:44.137

据我所知，并非不使用分析/调试器 API。（即使使用 API，我也不知道该怎么做。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-19T09:39:33.713

如果您愿意深入研究 WinDbg，则很容易找到对特定对象的引用。然而，WinDbg 并不是最容易使用的工具。

这个[博客](http://blogs.msdn.com/tess/)有很多关于使用 WinDbg 的信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T09:39:05.897

不适用于 Visual Studio 为您提供的默认工具。那里有第 3 方“内存分析器”，可让您执行此操作。我自己用过一个来寻找 .NET 程序中的“内存泄漏”。

# c++ - 多重继承

> ID：380529
> 
> 赞同：0
> 
> 时间：2008-12-19T09:44:14.610
> 
> 标签：c++, inheritance, multiple-inheritance

```
#include<iostream>
using namespace std;

class A

{
   int a;
   int b;
   public:
   void eat()
   {
      cout<<"A::eat()"<<endl;
   }
};

class B: public A
{
   public:
   void eat()
   {

      cout<<"B::eat()"<<endl;

   }

};

class C: public A
{

   public:
   void eat()

   {

      cout<<"C::eat()"<<endl;

   }

};

class D: public B, C
{

};

int foo(A *ptr)
{

ptr->eat();

}
main()
{

D obj;
foo(&(obj.B)); //error. How do i call with D's B part.

} 
```

上面的 foo 调用是编译时错误。我想用obj的B部分调用foo而不使用虚拟继承。我怎么做。

另外，在虚拟继承的情况下，为什么需要将偏移信息存储在vtable中。这可以在编译时确定。在上述情况下，如果我们将 foo 与 D 的对象一起传递，则只有在编译时我们才能计算 D 的 A 部分的偏移量。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-19T09:57:34.207

## 继承两次

对于双重继承，您会产生歧义-编译器无法知道您要使用两个 A 基中的哪一个。如果您想拥有两个 A 基础（有时您可能想要这样做），您可以通过转换为 B 或 C 在它们之间进行选择。这里默认转换中最合适的是`static_cast`（作为最弱的可用），但它不是确实需要（它仍然比您的案例需要更强），因为您没有转换为派生类型。自定义`safe_cast`模板应该可以完成这项工作：

```
/// cast using implicit conversions only
template <class To,class From>
inline To safe_cast( const From &from ) {return from;}

main()
{

  D obj;
  foo(safe_cast<B *>(&obj)); //error. How do i call with D's B part.

} 
```

## 编译时间类型 - 使用模板

> 另外，在虚拟继承的情况下，为什么需要将偏移信息存储在vtable中。这可以在编译时确定。在上述情况下，如果我们将 foo 与 D 的对象一起传递，则只有在编译时我们才能计算 D 的 A 部分的偏移量。

这是一种误解。现在编写的 foo 函数除了 A * 之外没有关于 ptr 类型的编译类型信息，即使您传递 B * 或 C* 也是如此。如果您希望 foo 能够根据传递的编译时间的类型进行操作，则需要使用模板：

```
template <class TypeDerivedFromA>
int foo(TypeDerivedFromA *ptr)
{
  ptr->eat();
} 
```

## 虚拟继承

您的问题提到了虚拟继承。如果要使用虚拟继承，则需要指定：

```
class B: public virtual A ...

class C: public virtual A ... 
```

有了这个代码就可以编译，但是有了这个解决方案，你无法在 B::A 或 C::A 之间进行选择（只有一个 A），因此这可能不是你想要的。

## 虚函数

此外，您的问题似乎混淆了两个不同的概念，虚拟继承（这意味着在两个中间基类之间共享一个基类）和虚拟函数（这意味着允许通过基类指针调用派生类函数）。如果您希望 B::eat 使用 A 指针调用，您可以在没有虚拟继承的情况下执行此操作（实际上虚拟继承会阻止您这样做，如上所述），使用虚拟函数：

```
class A
{
   int a;
   int b;

   public:
   virtual void eat()
   {
      cout<<"A::eat()"<<endl;
   }
}; 
```

如果您不接受虚函数，则其编译时机制是模板，如上所述。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-19T09:52:41.753

使用演员`static_cast`表 - 此处需要转换层次结构。

```
main()
{
  D obj;
  foo(static_cast<B*>(&obj));
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T09:54:08.893

首先，`obj`没有一个名为B的成员。它继承自B，也就是说它继承了B的所有成员作为自己的成员。

您可以致电：

```
foo(static_cast<B*>(&obj));
```

让它工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-19T10:05:29.527

我不认为 static_cast 会起作用。

当您使用 foo 函数时，编译器只知道您有一个指向 A 的指针，无论您作为参数传递的类型是什么。

如果不使用虚拟继承，那么我认为没有办法从指向 A 的指针调用 B 函数。

# c# - 导出为二进制时不正确的文本数据 - 文本模式

> ID：380532
> 
> 赞同：0
> 
> 时间：2008-12-19T09:46:50.937
> 
> 标签：c#, text, binary

我正在生成一个包含这样的数据的文件。

```
78,45,New things,200, Number of columns,2.00,5 
```

当我在 textpad 中使用 textformat 二进制类型打开文件时。

```
0: FF FE 33 00 36 00 2C 80 00 20 30 10 4F 7.8.4.5,4.5, 
```

在数据部分，它在两个连续数字之间有 (.)。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T11:17:02.330

您的十六进制查看器正在显示文件中每个字节的 ASCII 值。但是，该文件似乎保存为 Unicode（它以 FF FE 开头，它是一个 unicode BOM）。通常文本编辑器会正确识别此 BOM（记事本和 Notepad++ 一样，我不熟悉 Textpad）。

请注意，十六进制查看器几乎普遍使用 . 字符来表示不能呈现为 ASCII 字符（或来自用户 OEM 集的字符）的字节值。

实际编码看起来像 unicode，例如 33 00 和 36 00 是数字，尽管它们代表 36 而不是 78，所以问题右侧的 ASCII 表示实际上与左侧的字节值不匹配。

字符串：- "78,45,N" 当保存为 Litte-endian unicode 文件时，在十六进制视图中看起来像这样：-

FF FE 37 00 38 00 2C 00 34 00 35 00 2C 00 4E 00 ..7.8.,.4.5.,.N.

因此，要么保存内容的方法非常奇怪并且弄乱了编码，要么 Textpad 没有正确处理它（或者您没有正确使用 Textpad）。用记事本打开文件，看起来没问题吗？

# .net - 如何从 IIS 上发布的 Web 服务连接到 Oracle 数据库

> ID：380540
> 
> 赞同：0
> 
> 时间：2008-12-19T09:50:11.320
> 
> 标签：.net, oracle, web-services, iis

情况是这样的：
1\. 一台服务器上的Oracle 数据库10g。配置为接受连接。
2\. 不同服务器（IIS）上的Web服务，连接到数据库。这行不通。
3\. 在VS 2005 Web 服务器上运行相同的Web 服务，工作没有问题，可以连接到数据库。

问题：当在 VS 2005 Web 服务器上运行的相同服务没有问题时，不知道在 IIS 上发布的 Web 服务连接到 Oracle 10g 有什么问题。

返回错误：Oracleclient 连接超时。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-19T13:59:22.233

所以数据库在机器 A 上，而无法连接的 Web 服务器在机器 B 上。

可以连接的网络服务器在哪里？如果它不在机器 B 上，那么这两台机器之间的网络位置/配置有什么区别？

在机器 B 上，您可以通过 Oracle 的侦听器端口远程登录到 Oracle 服务器吗？

# sql - sql server 图标是什么意思？

> ID：380544
> 
> 赞同：2
> 
> 时间：2008-12-19T09:53:07.430
> 
> 标签：sql, sql-server-2005, sql-server-2008, icons

我正在使用 SQL Server 2008 Management Studio 查看 2005 服务器，并且刚刚添加了 2 个用户。出于某种原因，它们的图标都略有不同，我不知道为什么。

任何人都有图标及其含义的明确列表或指向微软文档的链接，因为我在任何地方都找不到任何东西。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-12-03T16:12:00.070

如果用户图标带有红色向下箭头，则表示关联的登录已禁用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T10:02:01.343

一个图标用于用户帐户，另一个图标用于组帐户。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-02T08:06:17.793

已撤销连接权限和已拒绝连接权限都是正确的。我发现导致红色箭头的唯一方法是让用户没有对数据库的连接访问权限。

源 SQL Server QOTD - 2014 年 7 月 2 日 (Andy Warren)

# .net - 如何从另一个项目中引用 APP_Data

> ID：380549
> 
> 赞同：2
> 
> 时间：2008-12-19T09:56:06.160
> 
> 标签：.net, asp.net, connection-string, mdf

我有以下项目解决方案：

*   有一个 ASP.NET MVC Web 应用程序，其中我在 App_Data 目录中有一个 SQL 数据库（mdf 文件）。

*   有一个类库，我从 [migratordotnet](http://code.google.com/p/migratordotnet/)进行了一些迁移。在我的构建文件中，我必须指定 SQL 数据库的位置，以便它可以运行迁移。

目前在迁移项目中，我使用***硬编码路径***来访问连接字符串中的 SQL 数据库。它看起来像这样：

```
connectionString="Data Source=.\SQLExpress; Integrated Security=true; AttachDbFilename=C:\MySolution\MyMVCProject\App_Data\MyDatabase.mdf" 
```

这不是我想做的。我也不能使用相对路径（例如`..\MyMVCPProject\AppData\MyDatabase.mdf`因为 migratordotnet 中使用的 SQL 类无法正确翻译它）但我想使用某种替代路径，就像你`|DataDirectory|`在`Web.Config`在这样的网络项目中：

```
connectionString="Data Source=.\SQLEXPRESS;AttachDbFilename=|DataDirectory|\MyDatabase.mdf;Integrated Security=True;User Instance=True" 
```

我该如何做到这一点？我无法在迁移项目中使用该连接字符串。因为`|DataDirectory|`将转到 .NET Framework 安装路径并在那里查找数据库文件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T10:47:24.670

您是否考虑过在 SQL Express 中永久附加数据库？这样，您可以在两个项目中使用相同的连接字符串，并且两者都不会绑定到文件系统路径。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-01T19:40:31.963

你想要这样的东西（VB .NET 代码）：

```
connectionString="Data Source=.\SQLExpress; Integrated Security=true; AttachDbFilename=" & Server.MapPath("~\App_Data\MyDatabase.mdf") 
```

Server.MapPath() 将在运行时将您的相对路径转换为完全限定的路径。

# c# - 使用原生 C++ 中的 .NET 类，使用 C++/CLI 作为“中间件”

> ID：380559
> 
> 赞同：3
> 
> 时间：2008-12-19T10:01:22.077
> 
> 标签：c#, c++, interop, c++-cli

我必须使用从本地 C++ 应用程序用 C# .NET 制作的类/程序集。我想我需要在 C++/CLI 中创建一个包装类，它将在头文件中公开本机方法，但根据需要使用 .NET 类。我不清楚的是如何将数据类型从 .NET 转换为标准 C++ 类型。

有人有一些示例代码可以学习吗？

我发现的唯一文字是：http: [//msdn.microsoft.com/en-us/magazine/cc300632.aspx](http://msdn.microsoft.com/en-us/magazine/cc300632.aspx)

但是文本很旧（使用托管 C++，而不是 C++/CLI），而且很多事情还不清楚

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-19T13:50:54.513

是的，您需要使用 C++/CLI 围绕您的托管程序集构建一个包装器。

对于混合本机和托管类型，您可能需要查看[本文](http://weblogs.asp.net/kennykerr/archive/2005/07/12/Mixing-Native-and-Managed-Types-in-C_2B002B00_.aspx)以获取示例代码。

原始类型有 int、float、byte 为您转换。但是其他类型有String必须自己做。例如，如果您在 char* 上有一个本机指针，那么您的 C++/CLI 类必须将其转换为字符串才能传递给您的托管 C# 程序集。

# nhibernate - 使用 ActiveRecord 在 nHibernate 中急切加载延迟加载的实体

> ID：380568
> 
> 赞同：4
> 
> 时间：2008-12-19T10:05:30.243
> 
> 标签：nhibernate, activerecord, lazy-loading, castle-activerecord, aggregateroot

我正在开发一个项目，该项目具有丰富的对象模型和各种聚合根集。

我们正在使用**Castle**堆栈（通过 ActiveRecord 到 nHibernate 的 Monorail）。

我们已将聚合根标记为惰性`[ActiveRecord(Lazy = true)]`，并在我们的存储库上自定义了“渴望”例程以渴望获取对象图。我们使用 HQL 从我们的根的子集合中定义渴望获取，

例如，如果`Account`是聚合根（并标记为延迟加载），我们将急切地获取`Account .. Order .. Product`实体以获得完整的图形。

所以到目前为止没有任何意外（希望如此）。

现在，如果在上面的示例中， Product 也被标记`[ActiveRecord(Lazy = true)]`，这似乎停止了 HQL 中的 Eager fetch 指令。

**有谁知道强制急切获取延迟加载的子对象的方法**？

干杯伊恩

**更新**：

好的，这里有一些示例 hql，使用下面 'me.yahoo.com/../1' 中的示例，我们在获取多对多关系时使用 IMuliQuery 来解决 N+1 依赖关系。我们还明确地使用了多对多映射类。因此，我们的 hql 是：

```
from Account a 'm eager loading the graph
inner join fetch a.AccountsOrders ao 
inner join fetch ao.Order
from Account a 'm eager loading the graph
inner join fetch a.AccountAddresses aa
inner join fetch aa.Address ad
where a.ID = ? 
```

...所以这会执行 2 条 sql 语句并返回所需的最小行集，我们可以将其解析为单个对象图。好的。

但是...如果，比如说，`Address`被标记为延迟加载（并且`Order`没有），访问`Order`不会触发进一步的 sql 语句，但访问`Address`会触发，尽管事实上两者都是急切加载的。

那么为什么上面的延迟加载的实体没有`Address`被上面的语句急切地获取呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T19:55:41.717

对 Account.Order.Product 实体执行“内部连接提取”。所以不要像这样（这可能是你已经拥有的）：

```
"from Account a inner join fetch a.Order where a.ID = ?" 
```

告诉它也获取 Order.Product：

```
"from Account a inner join fetch a.Order inner join fetch a.Order.Product where a.ID = ?" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T20:41:55.910

你为什么想要急切的行为？

ActiveRecord 中的所有关系属性都有一个“Lazy=”参数来告诉 ActiveRecord 延迟加载相关对象。除了 BelongsTo 之外的所有内容。BelongsTo 检查依赖对象的 ActiveRecord 属性中是否有 Lazy=true，然后为该对象创建一个代理，而不是执行选择或连接。

为了使延迟加载起作用，类实例的所有方法和属性都需要标记为虚拟。这允许 ActiveRecord 构造一个动态代理类。

现在，获取完整的性能图表可能听起来是个好主意，但实际上它可能会更慢。我有 3 个很好的理由：

1.) BelongsTo 有一个 Fetch 选项来定义如何拉取相关对象。FetchEnum.Join 强制 AR 使用 Join。获取枚举。Select 强制 AR 对每个对象使用单独的 select 语句。连接很慢，我们看到从切换到单个选择的性能提高了 10 倍。Lazy=true + FetchEnum.Select 和 eager 之间的客户端代码没有有效的区别。

2.) NHibernate 进行缓存。如果对象已经缓存在会话中或二级缓存中，则可以从那里加载它并避免额外的工作。

3.) 如果您没有引用对象图的一部分，您将错过延迟加载的任何好处。同样，您会做比必要更多的工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-17T12:45:49.483

来自“NHibernate in Action”，第 225 页：

> NHibernate 当前限制您只急切地获取一个集合。

这可能解释了获取地址的第二个查询。

# iphone - 如何在不越狱的情况下使用 PhotoLibrary

> ID：380570
> 
> 赞同：0
> 
> 时间：2008-12-19T10:07:29.943
> 
> 标签：iphone, jailbreak, photolibrary

这是你所做的好事。您能否解释一下：如何在不越狱的情况下使用 PhotoLibrary 的 CameraController。实际上，我已经下载了 class-dump 并尝试转储 PhotoLibrary，但效果不佳。它正在给：

```
/*
 *     Generated by class-dump 3.1.2.
 *
 *     class-dump is Copyright (C) 1997-1998, 2000-2001, 2004-2007 by Steve Nygard.
 */ 
```

该文件不包含任何 Objective-C 运行时信息。

所以，我想知道如何转储它并在 xcode 中使用它。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-28T18:38:24.240

a) 您不能直接使用 PhotoLibrary，因为它不是 iPhone SDK 的一部分。这大概就是您所说的“没有越狱”的意思

b) 马克是谁？他做了什么？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-28T13:03:15.277

`PhotoLibrary`是一个 C 框架（不包含 ObjC 代码），所以 class-dump 什么也没提供。（不，您不能在符合 SDK 的代码中使用 PL。）

# css - 整个网站的一页有不可见的元素，直到在 IE 中调整大小或滚动

> ID：380574
> 
> 赞同：0
> 
> 时间：2008-12-19T10:11:07.237
> 
> 标签：css, internet-explorer-6

我网站的一个页面在 IE6 中表现得非常奇怪。
一个元素忽略了它的背景颜色和边框。
另一个元素是不可见的（文本颜色与前景色相同？）

元素并不总是表现出这种行为，但大约 50% 的负载没有任何模式。当浏览器窗口被调整大小或滚动，或者元素被选中时，布局会突然显示得很好。

呜呜呜……

有人知道我什至可以开始调试吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T10:25:31.297

听起来您可能已经受到 IE6 中的 hasLayout 问题/错误的影响。查看[http://www.satzansatz.de/cssd/onhavelayout.html](http://www.satzansatz.de/cssd/onhavinglayout.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T10:32:20.877

听起来可能是[peekaboo 错误](http://www.positioniseverything.net/explorer/peekaboo.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T14:39:51.637

在你做任何事情之前，你应该做以下两件事：

1.  确保你有一个文档类型
2.  验证您的 HTML 和 CSS

完成这两件事后，您将能够更好地区分您的错误和 IE 的错误。

# sql - 在关系数据库中存储静态（类）属性

> ID：380588
> 
> 赞同：1
> 
> 时间：2008-12-19T10:22:31.317
> 
> 标签：sql, orm

假设您将类的实例存储在关系表中。您将如何保留该类的静态属性？例如：

```
class WebSiteUser {
    private static $common_homepage_content;
    private $username;
    private $password_hash;
    ...
} 
```

对应：

```
CREATE TABLE web_site_users
(
  username character varying(100) NOT NULL,
  password_hash character varying(40) NOT NULL,
  ... 
```

那去哪里`$common_homepage_content`呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T10:35:07.843

由于静态变量对类有意义，但在实例级别上没有意义，因此它不能进入​​具有实例变量的表中。在您创建的表中，可以有多个用户名字符和相应的密码哈希，但将 common_homepage_content 放在每条记录中将是重复数据。您可以将 common_homepage_content 放在单独的表中，并从第一个表中的每条记录中引用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T10:38:52.907

好吧，如果您要保留的变量只是`static`我必须假设会有很多用户（`WebSiteUser`）具有相同的`$common_homepage_content`. 在这种情况下，您应该在数据库中为该属性创建一个新表，因为它是 1->N 关系。

# c# - .NET 中的多图

> ID：380595
> 
> 赞同：52
> 
> 时间：2008-12-19T10:27:00.623
> 
> 标签：c#, multimap

我需要一个等效`std::multimap<K, V, Comp, Alloc>`于 C-sharp 中的 c++ 的东西。它是否存在于标准库中？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-12-19T10:32:32.217

因为快过圣诞节了：）

```
//////////////////////////////////////////////////////////////////////
// Algorithmia is (c) 2008 Solutions Design. All rights reserved.
// http://www.sd.nl
//////////////////////////////////////////////////////////////////////
// COPYRIGHTS:
// Copyright (c) 2008 Solutions Design. All rights reserved.
// 
// The Algorithmia library sourcecode and its accompanying tools, tests and support code
// are released under the following license: (BSD2)
// ----------------------------------------------------------------------
// Redistribution and use in source and binary forms, with or without modification, 
// are permitted provided that the following conditions are met: 
//
// 1) Redistributions of source code must retain the above copyright notice, this list of 
//    conditions and the following disclaimer. 
// 2) Redistributions in binary form must reproduce the above copyright notice, this list of 
//    conditions and the following disclaimer in the documentation and/or other materials 
//    provided with the distribution. 
// 
// THIS SOFTWARE IS PROVIDED BY SOLUTIONS DESIGN ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, 
// INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A 
// PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL SOLUTIONS DESIGN OR CONTRIBUTORS BE LIABLE FOR 
// ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT 
// NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR 
// BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, 
// STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE 
// USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. 
//
// The views and conclusions contained in the software and documentation are those of the authors 
// and should not be interpreted as representing official policies, either expressed or implied, 
// of Solutions Design. 
//
//////////////////////////////////////////////////////////////////////
// Contributers to the code:
//      - Frans  Bouma [FB]
//////////////////////////////////////////////////////////////////////
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using SD.Tools.Algorithmia.UtilityClasses;

namespace SD.Tools.Algorithmia.GeneralDataStructures
{
    /// <summary>
    /// Extension to the normal Dictionary. This class can store more than one value for every key. It keeps a HashSet for every Key value.
    /// Calling Add with the same Key and multiple values will store each value under the same Key in the Dictionary. Obtaining the values
    /// for a Key will return the HashSet with the Values of the Key. 
    /// </summary>
    /// <typeparam name="TKey">The type of the key.</typeparam>
    /// <typeparam name="TValue">The type of the value.</typeparam>
    public class MultiValueDictionary<TKey, TValue> : Dictionary<TKey, HashSet<TValue>>
    {
        /// <summary>
        /// Initializes a new instance of the <see cref="MultiValueDictionary&lt;TKey, TValue&gt;"/> class.
        /// </summary>
        public MultiValueDictionary()
            : base()
        {
        }

        /// <summary>
        /// Adds the specified value under the specified key
        /// </summary>
        /// <param name="key">The key.</param>
        /// <param name="value">The value.</param>
        public void Add(TKey key, TValue value)
        {
            ArgumentVerifier.CantBeNull(key, "key");

            HashSet<TValue> container = null;
            if(!this.TryGetValue(key, out container))
            {
                container = new HashSet<TValue>();
                base.Add(key, container);
            }
            container.Add(value);
        }

        /// <summary>
        /// Determines whether this dictionary contains the specified value for the specified key 
        /// </summary>
        /// <param name="key">The key.</param>
        /// <param name="value">The value.</param>
        /// <returns>true if the value is stored for the specified key in this dictionary, false otherwise</returns>
        public bool ContainsValue(TKey key, TValue value)
        {
            ArgumentVerifier.CantBeNull(key, "key");
            bool toReturn = false;
            HashSet<TValue> values = null;
            if(this.TryGetValue(key, out values))
            {
                toReturn = values.Contains(value);
            }
            return toReturn;
        }

        /// <summary>
        /// Removes the specified value for the specified key. It will leave the key in the dictionary.
        /// </summary>
        /// <param name="key">The key.</param>
        /// <param name="value">The value.</param>
        public void Remove(TKey key, TValue value)
        {
            ArgumentVerifier.CantBeNull(key, "key");

            HashSet<TValue> container = null;
            if(this.TryGetValue(key, out container))
            {
                container.Remove(value);
                if(container.Count <= 0)
                {
                    this.Remove(key);
                }
            }
        }

        /// <summary>
        /// Merges the specified multivaluedictionary into this instance.
        /// </summary>
        /// <param name="toMergeWith">To merge with.</param>
        public void Merge(MultiValueDictionary<TKey, TValue> toMergeWith)
        { 
            if(toMergeWith==null)
            {
                return;
            }

            foreach(KeyValuePair<TKey, HashSet<TValue>> pair in toMergeWith)
            {
                foreach(TValue value in pair.Value)
                {
                    this.Add(pair.Key, value);
                }
            }
        }

        /// <summary>
        /// Gets the values for the key specified. This method is useful if you want to avoid an exception for key value retrieval and you can't use TryGetValue
        /// (e.g. in lambdas)
        /// </summary>
        /// <param name="key">The key.</param>
        /// <param name="returnEmptySet">if set to true and the key isn't found, an empty hashset is returned, otherwise, if the key isn't found, null is returned</param>
        /// <returns>
        /// This method will return null (or an empty set if returnEmptySet is true) if the key wasn't found, or
        /// the values if key was found.
        /// </returns>
        public HashSet<TValue> GetValues(TKey key, bool returnEmptySet)
        {
            HashSet<TValue> toReturn = null;
            if(!base.TryGetValue(key, out toReturn) && returnEmptySet)
            {
                toReturn = new HashSet<TValue>();
            }
            return toReturn;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-12-19T10:46:20.443

[ILookup](http://msdn.microsoft.com/en-us/library/bb534291.aspx)可能对你来说已经足够好了——但不幸的是没有公开的实现。据我所知，您基本上必须通过[Enumerable.ToLookup 。](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.tolookup.aspx)这意味着它是一种“构建一次”的地图 - 您以后无法添加。但是，如果这就是您所需要的，那么能够只使用内置的东西就很方便了。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-19T11:09:27.197

在 .NET 3.5 中，有一个`ILookup<,>`代表这一点。常规实现 ( `Lookup<,>`) 是不可变的，但我`EditableLookup<,>`在[MiscUtil](http://www.pobox.com/~skeet/csharp/miscutil/)中有一个应该可以很好地完成这项工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-04-06T11:53:59.183

你可以试试这个

C# MultiMap 泛型类

[http://dotnetperls.com/multimap](http://dotnetperls.com/multimap)

非常简单的多地图实现。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-07-25T00:03:29.563

你可以找到 ac# multimap collection @ [http://code.google.com/p/self-balancing-avl-tree/](http://code.google.com/p/self-balancing-avl-tree/)。它基于代码中也包含的自平衡 avl 树。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-01-25T18:58:00.303

[`BMultiMap<K,V>`](http://www.codeproject.com/Articles/612301/The-List-Trifecta-Part-2)如果您的收藏整体很大，请考虑使用。与 相比，它节省了大量内存`Dictionary<K,List<V>>`，尤其是在与每个键关联的值的数量通常很小的情况下。

# python - 如何使用 ElementTree 获取元素的完整 XML 或 HTML 内容？

> ID：380603
> 
> 赞同：11
> 
> 时间：2008-12-19T10:33:52.183
> 
> 标签：python, xml, api, elementtree

也就是说，所有文本和子标签，没有元素本身的标签？

有

```
<p>blah <b>bleh</b> blih</p> 
```

我想

```
blah <b>bleh</b> blih 
```

element.text 返回“blah”并且 etree.tostring(element) 返回：

```
<p>blah <b>bleh</b> blih</p> 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-19T11:21:52.900

ElementTree 完美运行，您必须自己组装答案。像这样的东西...

```
"".join( [ "" if t.text is None else t.text ] + [ xml.tostring(e) for e in t.getchildren() ] ) 
```

感谢 JV amd PEZ 指出错误。

* * *

编辑。

```
>>> import xml.etree.ElementTree as xml
>>> s= '<p>blah <b>bleh</b> blih</p>\n'
>>> t=xml.fromstring(s)
>>> "".join( [ t.text ] + [ xml.tostring(e) for e in t.getchildren() ] )
'blah <b>bleh</b> blih'
>>> 
```

不需要尾巴。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-19T17:27:09.257

这是我最终使用的解决方案：

```
def element_to_string(element):
    s = element.text or ""
    for sub_element in element:
        s += etree.tostring(sub_element)
    s += element.tail
    return s 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-12-04T09:29:26.607

这些是很好的答案，可以回答 OP 的问题，特别是如果问题仅限于 HTML。但是文档本质上是杂乱无章的，元素嵌套的深度通常是无法预测的。

要模拟 DOM 的 getTextContent()，您必须使用（非常）简单的递归机制。

要获取纯文本：

```
def get_deep_text( element ):
    text = element.text or ''
    for subelement in element:
        text += get_deep_text( subelement )
    text += element.tail or ''
    return text
print( get_deep_text( element_of_interest )) 
```

要获取有关原始文本之间边界的所有详细信息：

```
class holder: pass # this is just a way of creating a holder object
holder.element_count = 0
def get_deep_text_w_boundaries(element, depth = 0):
    holder.element_count += 1
    element_no = holder.element_count 
    indent = depth * '  '
    text1 = f'{indent}(el {element_no} tag {element.tag}: text |{element.text or ""}| - attribs: {element.attrib})' 
    print(text1)
    for subelement in element:
        get_deep_text_w_boundaries(subelement, depth + 1)
    text2 = f'{indent}(el {element_no} tag {element.tag} - tail: |{element.tail or ""}|)' 
    print(text2)
get_deep_text_w_boundaries(etree_element) 
```

示例输出：

```
(el 1 tag source: text |DEVANT LE | - attribs: {})
  (el 2 tag g: text |TRIBUNAL JUDICIAIRE| - attribs: {'style_no': '3'})
  (el 2 tag g - tail: ||)
(el 1 tag source - tail: | DE VERSAILLES|) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-19T11:56:30.373

我怀疑 ElementTree 是用来做这个的。但是假设您有充分的理由使用它，也许您可​​以尝试从片段中剥离根标签：

```
 re.sub(r'(^<%s\b.*?>|</%s\b.*?>$)' % (element.tag, element.tag), '', ElementTree.tostring(element)) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-02-21T01:32:18.073

这里的大部分答案都是基于 XML parser的`ElementTree`，即使[PEZ 的基于正则表达式的答案](https://stackoverflow.com/a/380783/728675)仍然部分依赖于 ElementTree。

所有这些都很好并且适用于大多数用例，但为了完整起见，值得注意的是，它`ElementTree.tostring(...)`会给你一个等效的片段，但并不总是与原始有效负载相同。如果出于某种非常罕见的原因，您想按原样提取内容，则必须使用纯正则表达式解决方案。[这个例子](https://github.com/AzureAD/azure-activedirectory-library-for-python/pull/120/files)是我如何使用基于正则表达式的解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-07-21T00:06:21.657

这个答案稍微修改了***Pupeno 的***回复。在这里，我将编码类型添加到“tostring”中。这个问题花了我好几个小时。我希望这个小修正能帮助其他人。

```
def element_to_string(element):
        s = element.text or ""
        for sub_element in element:
            s += ElementTree.tostring(sub_element, encoding='unicode')
        s += element.tail
        return s 
```

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2008-12-19T11:23:59.523

不知道是否可以选择外部库，但无论如何——假设`<p>`页面上有一个带有此文本的库，则 jQuery 解决方案将是：

```
alert($('p').html()); // returns blah <b>bleh</b> blih 
```

# c# - C# .NET 将 JPEG 图像转换为位图结构

> ID：380604
> 
> 赞同：5
> 
> 时间：2008-12-19T10:34:33.463
> 
> 标签：c#, .net, jpeg

我有一个 JPEG“图像”（实际上是数据库中的 BLOB），我想将其导入/转换为内存中的“位图”结构。原因是我使用了无法处理 JPEG 图像的第三方库，我需要传递未压缩的位图（作为指针）。到目前为止，我发现的只是在磁盘上的不同格式之间进行转换的方法，但是首先将图像保存为位图并重新导入它会花费太长时间。

我对 .NET 了解不多，但我认为 System.Drawing.Bitmap 应该能够保存未压缩的数据。我正在使用 C# 和 Visual Studio 2008。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-19T10:37:33.800

```
// blob is a byte[] retrieved from DB
Bitmap bmp = new Bitmap(new MemoryStream(blob)); 
```

# asp.net - 使用查询字符串作为启动参数在vs2008中调试起始页？

> ID：380607
> 
> 赞同：2
> 
> 时间：2008-12-19T10:36:17.420
> 
> 标签：asp.net, visual-studio-2008, query-string

有谁知道如何为设置为启动页面的 asp.net 网络表单设置默认查询字符串？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-19T11:13:22.433

您可以为项目设置起始页。

在解决方案资源管理器中，右键单击您的 Web 项目节点并选择属性。找到 Web 选项卡并选择特定页面并输入您要测试的页面的名称并在此处添加您的查询字符串。

# c# - C#/.Net 2.0：在用户控件中时，Repeater 控件和复选框出现问题！

> ID：380608
> 
> 赞同：1
> 
> 时间：2008-12-19T10:36:42.520
> 
> 标签：c#, .net, asp.net, visual-studio-2005

我有一个带有复选框的转发器控件，如果我选中该框，那么我的删除功能将删除基础表中的一个项目。

当我在带有页面后面代码的 aspx 页面上测试删除功能时，一切正常。万岁！

但是，当我将转发器放入用户控件时，删除功能认为我的转发器控件没有项目。

代码如下，我试图去掉不必要的代码。我在asp.net 论坛上问过这个问题，但没有人回答！

asxc:

```
<%@ Control  AutoEventWireup="true" Inherits="Moto.Web.UI.UserControls.Messages.MessageListForm" Language="C#" %>

<asp:button id="btnDelete" runat="server" text="Delete" OnClick="btnDelete_Click" ></asp:button>

<asp:Repeater ID="RepeaterMessageList"  runat="server" EnableViewState="true" >
    <ItemTemplate >
        <div class="messageContainer item" >
            <div class="messageListLeft">
                <div class="messageList">  
                    <asp:Image ID="imgUser" runat="server" CssClass="" />
                    <asp:CheckBox ID="chkDeleteMe" runat="server" Text="test" />
                </div>
            </div>
        </div>
    </ItemTemplate>

</asp:Repeater> 
```

代码文件：

```
using System;
using System.Data;
using System.Configuration;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;
using System.Collections;
using System.Collections.Generic;
using System.IO;

namespace Moto.Web.UI.UserControls.Messages
{
    public class MessageListForm : Moto.Web.UI.UserControls.UserControl//System.Web.UI.UserControl
    {
        private string userGUID;
        private MembershipUser MembershipUser;
        private Moto.Business.UserComponent userComponent;
        private Moto.Business.User user;
        private Button cmdPrev;
        private Button cmdNext;
        private Button cmdNewest;
        private Button cmdOldest;
        private Label lblCurrentPage;
        private Label lblMessage;
        private HyperLink hypPageRedirect;
        private Repeater RepeaterMessageList;
        private MessageView DisplayMessages = MessageView.Inbox;//default setting

        private Button btnDelete;
        private Label lblConfirmDelete;
        protected Button btnConfirmDelete;
        protected Button btnCancelDelete;

        enum MessageView
        {
            Inbox,  //0
            Sent    //1
        }

        protected override void OnInit(EventArgs e)
        {
            base.OnInit(e);
            this.InitializePage();
        }

        protected void InitializePage()
        {
            this.cmdNext = (Button)FindControl("cmdNext");
            this.cmdPrev = (Button)FindControl("cmdPrev");
            this.cmdOldest = (Button)FindControl("cmdOldest");
            this.cmdNewest = (Button)FindControl("cmdNewest");
            this.lblCurrentPage = (Label)FindControl("lblCurrentPage");
 //           this.RepeaterMessageList = (Repeater)FindControl("RepeaterMessageList");

            this.RepeaterMessageList = (Repeater)FindControlRecursive(this, "RepeaterMessageList");

            this.hypPageRedirect = (HyperLink)FindControl("hypPageRedirect");
            this.lblMessage = (Label)FindControl("lblMessage");
            //delete functionality
            this.btnDelete = (Button)FindControl("btnDelete");
            this.lblConfirmDelete = (Label)FindControl("lblConfirmDelete");
            this.btnConfirmDelete = (Button)FindControl("btnConfirmDelete");
            this.btnCancelDelete = (Button)FindControl("btnCancelDelete");

            //where are we coming from - are we the Logged in user or just a voyeur?
            if (Page.User.Identity.IsAuthenticated)
            {
                this.userComponent = new Moto.Business.UserComponent();

                this.MembershipUser = Membership.GetUser();//user logged in
                this.userGUID = this.MembershipUser.ProviderUserKey.ToString();//signed in user
                this.user = this.userComponent.GetByUserGUID(this.userGUID);
            }
            else
            {
                Response.Redirect("~/default.aspx");
            }

            if (null != this.Page.Request.QueryString["viewing"])
            {
                //reset the enum value
                DisplayMessages = this.Page.Request.QueryString["viewing"].ToLower() == "sent" ? MessageView.Sent : MessageView.Inbox;
                CurrentPage = 0;//if it's a redirect then reset the Current Page
            }
        }

        void Page_Load(object sender, EventArgs e)
        {
            if (!IsPostBack)
            {
                ItemsGet();//on post back we'll call it elsewhere
            }

            switch (DisplayMessages)
            {
                case MessageView.Sent:
                    this.hypPageRedirect.Text += "Inbox";
                    this.hypPageRedirect.NavigateUrl += "?viewing=Inbox";
                    break;
                case MessageView.Inbox:
                    this.hypPageRedirect.Text += "Sent Items";
                    this.hypPageRedirect.NavigateUrl += "?viewing=Sent";
                    break;

            }
        }

        protected void cmdPrev_Click(object sender, EventArgs e)
        {
            // Set viewstate variable to the previous page
            CurrentPage -= 1;

            // Reload control
            ItemsGet();
        }

        protected void cmdNext_Click(object sender, EventArgs e)
        {
            // Set viewstate variable to the next page
            CurrentPage += 1;

            // Reload control
            ItemsGet();
        }

        protected void cmdNewest_Click(object sender, EventArgs e)
        {
            // Set viewstate variable to the previous page
            CurrentPage = 0;

            // Reload control
            ItemsGet();
        }

        protected void cmdOldest_Click(object sender, EventArgs e)
        {
        }

        public void RepeaterMessageList_ItemDataBound(object sender, RepeaterItemEventArgs e)
        {

            // Execute the following logic for Items and Alternating Items.
            if (e.Item.ItemType == ListItemType.Item || e.Item.ItemType == ListItemType.AlternatingItem)
            {

                //Are we vieing the Inbox or Sent items?
                if (DisplayMessages == MessageView.Inbox)
                {
                    .........Do stuff
                }
                else
                {
                    .........Do stuff
                }
            }
        }

        private void ItemsGet()
        {
//            this.RepeaterMessageList = (Repeater)FindControl("RepeaterMessageList");
            this.RepeaterMessageList.ItemDataBound += new RepeaterItemEventHandler(RepeaterMessageList_ItemDataBound);

            // Populate the repeater control with the Items DataSet
            PagedDataSource objPds = new PagedDataSource();

            if (DisplayMessages == MessageView.Inbox)//which table are we getting data from?
            {
                List<Moto.Business.MessageReceived> messages;
                Moto.Business.MessageReceivedComponent messageComponent =
                    new Moto.Business.MessageReceivedComponent();
                messages = messageComponent.GetByReceiverGUID(this.user.UserGUID);

                objPds.DataSource = messages;
            }
            else
            {
                List<Moto.Business.MessageSent> messages;
                Moto.Business.MessageSentComponent messageComponent =
                    new Moto.Business.MessageSentComponent();
                messages = messageComponent.GetBySenderGUID(this.user.UserGUID);

                objPds.DataSource = messages; //Items.Tables[0].DefaultView;
            }

            // Indicate that the data should be paged
            objPds.AllowPaging = true;

            // Set the number of items you wish to display per page
            objPds.PageSize = 25;

            // Set the PagedDataSource's current page
            objPds.CurrentPageIndex = CurrentPage;

            this.lblCurrentPage.Text = "Page " + (CurrentPage + 1).ToString() + " of "
                + objPds.PageCount.ToString();

            // Disable Prev or Next buttons if necessary
            this.cmdPrev.Enabled = !objPds.IsFirstPage;
            this.cmdNext.Enabled = !objPds.IsLastPage;
            this.cmdOldest.Enabled = !objPds.IsLastPage;
            this.cmdNewest.Enabled = !objPds.IsFirstPage;

            this.RepeaterMessageList.DataSource = objPds;
            this.RepeaterMessageList.DataBind();
        }

        public int CurrentPage
        {
            get
            {
                // look for current page in ViewState
                object o = this.ViewState["_messagesCurrentPage"];
                if (o == null)
                    return 0; // default page index of 0
                else
                    return (int)o;
            }

            set
            {
                this.ViewState["_messagesCurrentPage"] = value;
            }
        }
        protected void btnDelete_Click(object sender, EventArgs e)
        {

            foreach (RepeaterItem item in this.RepeaterMessageList.Items)
            {
                CheckBox chkDeleteMe = item.FindControl("chkDeleteMe") as CheckBox;
                TextBox test = item.FindControl("test") as TextBox;
                if (chkDeleteMe.Checked)
                {
                    if (DisplayMessages == MessageView.Inbox)//which table are we getting data from?
                    {
                    .........Do stuff

                    }
                    else
                    {
                    .........Do stuff

                    }
                }
            }          
            // Reload control
            ItemsGet();
        }

        protected Control FindControlRecursive(Control root, string id)
        {
            if (root.ID == id)
            {
                return root;
            }

            foreach (Control c in root.Controls)
            {
                Control t = FindControlRecursive(c, id);
                if (t != null)
                {
                    return t;
                }
            }
            return null;
        }

} 
```

非常感谢任何帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-29T13:08:48.537

我认为问题在于，当单击删除按钮时，再次触发 Page_Load，并且由于它是回发，因此它不执行 ItemsGet 方法，因此中继器没有数据。

尝试将 ItemsGet 方法调用放在 OnPreRender 事件中而不是 Page_Load 中。

约米特

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T10:54:43.547

所以它绑定到转发器并正确显示所有项目，但是在回发项目列表中重复时，什么也没找到？

删除事件肯定会被触发吗？点击删除按钮后可以看到什么？（例如，表格是空的还是仍然显示所有项目）

更新：

注释掉 GetItems 方法并查看表在回发时是否为空。听起来您的转发器视图状态没有再次填充控件或其他内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T11:11:16.430

Delete 事件触发，但在 fornext...循环中，中继器认为它没有项目。

循环后调用 ItemsGet() 方法，该方法返回表中的所有数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-29T10:09:10.303

尝试将 InitializePage() 方法移动到另一个地方。我不知道为什么，但我遇到了同样的问题，问题是当我尝试访问 OnInit 事件中的某些控件时。我转移到事件 OnPreLoad() 并工作。

我希望能帮助你...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T15:07:20.553

PreRender 解决方案也适用于我们的案例，我们在应用程序的两个页面中都有这样的代码。这在 .Net 1.1 中运行良好，但是当我们将此代码移植到 .Net 2.0 时出现故障。

不知道为什么它在没有对代码库进行任何重大更改的情况下就崩溃了。

感谢 OnPreRender 提示！

-甘夏姆

# web-applications - 如何为 Web 应用程序提供合法的许可或“使用条款”

> ID：380611
> 
> 赞同：6
> 
> 时间：2008-12-19T10:39:49.957
> 
> 标签：web-applications

我正在寻找有关为 Web 应用程序提供许可证或“使用条款”的信息。维基[百科的文章](http://en.wikipedia.org/wiki/Terms_of_Use)非常有限，而且似乎不像“可下载”软件（或者可能是“可安装”软件，因为没有更好的术语），其中有[更多信息](http://en.wikipedia.org/wiki/Software_license)，没有那么多专门为许可编写的网络应用程序。

您会说聘请律师为您的 Web 应用程序构建一个合法的“使用条款”或免责声明是绝对必要的吗？

有人问：哪个辖区？我的回答是：全世界。我想这会引发另一个话题，即您应该考虑哪些管辖范围限制。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T12:21:53.133

聘请律师。看起来不受欢迎（而且代价高昂），让你的 TOS 出错可能会让你付出更多的代价。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T10:43:29.683

以下是[一些以英国为中心的](http://www.website-law.co.uk/documents.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-28T21:33:24.417

在您聘请律师之前，请确定您的网络服务所在的国家/地区（司法管辖区）。您可以在服务条款中声明适用 X 国家/地区的法律。没有“国际互联网法”之类的东西，所以选择一个国家。

美国法律没有明确规定，因此您可以指定条款。欧盟法律规定了更多关于可以放入 ToS 的内容。美国律师不太了解欧盟消费者保护法，反之亦然:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T10:43:48.873

你希望涵盖什么？您是否担心您的代码被盗或有人在他们在您的网站上看到的内容背后做一些愚蠢的事情？（或完全不同的东西。）

您能否编辑以扩大您希望免责声明或条款希望涵盖的内容？

聘请律师可能是最合理的建议，但被问到错误问题的错误律师可能会以灾难告终……

# browser - 如何从小程序中获取浏览器类型和版本？

> ID：380612
> 
> 赞同：2
> 
> 时间：2008-12-19T10:40:47.070
> 
> 标签：browser, applet

是否可以从小程序中查询当前浏览器？

我想知道当前浏览器是IE6还是IE7。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-19T10:41:45.333

这是给你的东西：[http ://www.rgagnon.com/javadetails/java-0160.html](http://www.rgagnon.com/javadetails/java-0160.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T13:36:11.937

[User-Agent 检测](http://nerds.palmdrive.net/useragent/code.html "用户代理检测：代码")代码很旧（在 IE6 上停止），但应该很容易扩展。应与 Filip 指出的 R. Gagnon 代码结合使用，以便更好地检测真实浏览器（某些浏览器允许随意更改用户代理字符串）。
您可能也对[用户代理字符串列表](http://www.useragentstring.com/pages/useragentstring.php "UserAgentString.com - 用户代理字符串列表")感兴趣。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T09:44:37.860

有关信息，用户代理检测代码已使用最新的浏览器进行了更新。

# sql-server - 如何在 MDX 查询中使用第三维（ON PAGES 语法）

> ID：380616
> 
> 赞同：2
> 
> 时间：2008-12-19T10:43:02.680
> 
> 标签：sql-server, sql-server-2005, ssas, olap, mdx

我在 MDX 查询（在 MS SQL Server 2005 上）中遇到第三维问题。我可以在 Visual Basic 中使用第三维（我在那里有一个立方体，使用浏览器我可以进行 3 个暗淡的查询——由于 ON PAGES）。我通过 MS SQL Profiler 窥探了它（它记录了数据库查询）。但是当我尝试将查询放入 MS SQL SERVER 时，我收到的唯一信息是：

执行查询... 获得的对象类型：Microsoft.AnalysisServices.AdomdClient.CellSet 格式化。不能为具有两个以上轴的单元集显示结果。执行完成

我尝试了几种不同的方法来实现查询，但是这个^答案是来自服务器的唯一答案。

问题是：我需要做什么才能在我的 OLAP 中使用第三个暗淡？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-20T11:22:49.273

当您使用 SQL Server Management Studio (SSMS) 查询 Analysis Services 时，您将获得一个 ADOMD.NET Cellset 对象。该对象以多维方式表示您的查询结果，在多个轴中布置信息：轴 0 表示列，轴 1 表示行，轴 2 表示页面等。

尽管您的查询可能在三个轴上是正确的，但 SSMS 只能呈现二维结果，因此您会收到错误消息。您需要使用 ADOMD.NET 构建应用程序来使用 cellset，或者使用第三方工具。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T11:31:35.400

您说您“将查询放入 MS SQL SERVER”-您到底是什么意思？您是否尝试过 Analysis Services 附带的多维数据集浏览器？这很垃圾。

我认为问题就像您收到的错误消息一样简单 - “无法显示结果”。换句话说，查看软件可以显示表格（即 2D 信息），但没有显示 3D 信息的方式（无论是在多个表格中，还是其他）。

您需要找到可以更精细地呈现立方体数据的软件。

# java - 如何将 ISO 8601 日期（字符串）转换为日期？

> ID：380626
> 
> 赞同：2
> 
> 时间：2008-12-19T10:46:08.603
> 
> 标签：java, date, parsing, iso8601

我正在解析 XML 文件。在这个文件中有一个包含日期字符串的标签`"2008-11-10T05:51:33Z"`，我想将此字符串转换为`java.util.Date object.`

如何才能做到这一点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-19T10:49:17.893

使用[java.text.DateFormat](http://java.sun.com/javase/6/docs/api/java/text/DateFormat.html) - 或更可能是[SimpleDateFormat](http://java.sun.com/javase/6/docs/api/java/text/SimpleDateFormat.html)。

或者，使用[Joda Time](http://joda-time.sourceforge.net/)及其无限更好的 API。小心使用 Java 内置 API - DateFormats 不是线程安全的。（它们在 Joda Time 中，几乎在所有地方都使用不可变类型。）

Joda Time API的（未经测试 - 除了*可能*的时区位之外应该没问题）示例：

```
DateTimeFormatter fmt = DateTimeFormat.forPattern("yyyyMMdd'T'HH:mm:ssZ");
DateTime dt = fmt.parse("2008-11-10T05:51:33Z"); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2017-05-22T15:50:22.637

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T10:53:05.937

```
DateTime dateToGetFromString;

dateToGetFromString = DateTime.Parse(stringContainingDate); 
```

您也可以使用 DateTime 类的 TryParse 函数，查看文档。

# sql - 惊人的 SQL 速度提升

> ID：380628
> 
> 赞同：13
> 
> 时间：2008-12-19T10:46:30.147
> 
> 标签：sql, performance

我刚刚发现以下两个 select 语句之间的执行计划性能有很大不同：

```
select * from your_large_table
where LEFT(some_string_field, 4) = '2505'

select * from your_large_table
where some_string_field like '2505%' 
```

执行计划分别为 98% 和 2%。那么速度上的差异。当我看到它时，我真的很震惊。

我一直这样做 LEFT(xxx) = 'yyy' 因为它读起来很好。实际上，我通过对照我手工制作的 SQL 检查 LINQ 生成的 SQL 发现了这一点。我假设 LIKE 命令会更慢，但实际上要快得多。

我的问题是为什么 LEFT() 比 LIKE '%..' 慢。他们到底是一样的吗？

另外，使用 LEFT() 是否会影响 CPU？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-19T17:01:45.890

更一般地说，您不应该在查询中的 WHERE 子句的 LEFT 侧使用函数。如果这样做，SQL 将不会使用索引——它必须为表的每一行评估函数。目标是确保您的 where 子句是“ [Sargable](http://en.wikipedia.org/wiki/Sargable) ”

其他一些例子：

```
Bad: Select ... WHERE isNull(FullName,'') = 'Ed Jones'
Fixed: Select ... WHERE ((FullName = 'Ed Jones') OR (FullName IS NULL))

Bad: Select ... WHERE SUBSTRING(DealerName,4) = 'Ford'
Fixed: Select ... WHERE DealerName Like 'Ford%'

Bad: Select ... WHERE DateDiff(mm,OrderDate,GetDate()) >= 30
Fixed: Select ... WHERE OrderDate < DateAdd(mm,-30,GetDate()) 

Bad: Select ... WHERE Year(OrderDate) = 2003
Fixed: Select ... WHERE OrderDate >= '2003-1-1' AND OrderDate < '2004-1-1' 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-19T10:58:07.550

看起来表达式 LEFT(some_string_field, 4) 是针对全表扫描的每一行计算的，而“like”表达式将使用索引。

如果它是前锚模式，则优化“like”以使用索引比分析涉及字符串函数的任意表达式更容易优化。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-19T10:51:30.650

在 where 子句中使用函数调用会产生巨大影响，因为 SQL Server 必须计算每一行的结果。另一方面，`like`是高度优化的内置语言功能。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-19T10:52:07.280

如果您在具有索引的列上使用函数，则数据库不再使用索引（至少使用 Oracle）
所以我猜您的示例字段“ `some_string_field`”上有一个索引，它不会用于查询用“左”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-19T12:12:11.187

为什么说它们是一样的？他们可能解决同样的问题，但他们的方法不同。至少看起来是这样的……

使用 LEFT 的查询优化了测试，因为它已经知道前缀的长度等，所以在 C/C++/... 程序或没有索引的情况下，使用 LEFT 实现某种 LIKE 行为的算法将是最快的。但与大多数非声明性语言相比，在 SQL 数据库上，为您完成了很多操作优化。例如，LIKE 可能是通过首先查找 % 符号来实现的，如果注意到 % 是字符串中的最后一个字符，则可以像使用 LEFT 一样优化查询，但直接使用索引.

所以，确实我认为你*是*对的，他们的方法可能是相同的。唯一的区别是数据库服务器可以使用 LIKE 在查询中使用索引，因为在 WHERE 子句中没有将列值转换为未知值的函数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-19T17:24:31.197

这里发生的情况要么是 RDBMS 不能在 LEFT() 谓词上使用索引而能够在 LIKE 上使用它，要么它只是进行了错误的调用，这将是更合适的访问方法。

首先，对于某些 RDBMS 来说，将函数应用于列可能会阻止使用基于索引的访问方法，但这不是普遍的事实，也没有任何逻辑理由需要这样做。基于索引的访问方法（例如 Oracle 的全索引扫描或快速全索引扫描）可能是有益的，但在某些情况下，RDBMS 无法在基于函数的谓词的上下文中进行操作。

其次，优化器在估计不同可用访问方法的好处时可能只是算术错误。假设系统可以执行基于索引的访问方法，它首先必须通过在解析时对数据进行采样，从表的统计信息、列的统计信息来估计将匹配谓词的行数，或使用启发式规则（例如“假设 5% 的行将匹配”）。然后它必须评估全表扫描的相对成本或可用的基于索引的方法。有时它会计算错误，有时统计数据会误导或不准确，有时启发式规则不适用于数据集。

关键是要注意几个问题：

1.  您的 RDBMS 可以支持哪些操作？
2.  在您使用的情况下，最合适的操作是什么？
3.  系统的选择是否正确？
4.  可以做些什么来让系统执行更高效的操作（例如，添加缺失的非空约束、更新统计信息等）？

以我的经验，这不是一项微不足道的任务，通常最好留给专家。或者另一方面，只需将问题发布到 Stackoverflow ——我们中的一些人觉得这些东西很有趣，狗帮助我们。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-02-25T06:36:07.567

正如@BradC 提到的，如果您有索引并希望利用它们，则不应在 WHERE 子句中使用函数。

[如果您从这些 SQL 性能提示](http://cc.davelozinski.com/sql/optimizing-sql-strategies)中阅读了标题为“在存在索引时在 WHERE 子句中使用 LIKE 而不是 LEFT() 或 SUBSTRING()”的部分，还有更多示例。

如果您也有兴趣参加[MCSE SQL Server 2012 考试](https://www.microsoft.com/learning/en-au/sql-certification.aspx)，它还会提示您会遇到的问题。:-)

# java - 在 Java 中为 Array 中的元素分配引用时究竟会发生什么？

> ID：380632
> 
> 赞同：5
> 
> 时间：2008-12-19T10:48:08.770
> 
> 标签：java, arrays

我在 Java 中执行以下语句，

```
Obj t[] = new Obj[10];

Obj a = new Obj("a");
t[0] = a;

a = new Obj("b");
t[1] = a; 
```

为什么在 java 中，当我访问 t[0] 时，它返回我“a”，而不是“b”？这是因为GC吗？我能相信做这样的手术是安全的吗

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-19T11:04:10.673

这正是正在发生的事情。

```
Obj t[] = new Obj[10];  // 1

Obj a = new Obj("a");   // 2
t[0] = a;

a = new Obj("b");       // 3
t[1] = a;               // 4 
```

1.  您创建一个可以容纳 10 个对`Obj`. 打电话给这个`obj01`。您将其分配给`t`. 请注意，变量`t`和实际对象`obj01`的关系非常随意。

2.  你创建一个实例`Obj`，调用它`obj02`。您将此对象的引用分配给变量`a`。请注意，变量`a`和实际对象`obj02`的关系非常随意。

    您还将此引用放入`t[0]`. 你在两个地方有一个已知的对象。对象`obj02`（值为`"a"`）称为`a`并且也称为`t[0]`。

3.  你创建一个实例`Obj`，调用它`obj03`。您将这个新对象的引用分配给旧变量`a`。请注意，变量`a`和实际对象`obj03`的关系非常随意。 `a`曾经引用`obj02`，但现在不再引用。

    所以，`obj01`（一个数组）被`t`;引用 `obj02`（和`Obj`）的实例被称为`t[0]`; `obj03`( 的一个实例`Obj`) 被称为`a`。

4.  您将参考`a`放入`t[1]`. 因此，`t[1]`获取对`obj03`.

此时，所有对象都被范围内的变量引用。由于所有对象都有引用，因此它们不能被垃圾收集。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-19T10:53:17.853

问题是，Java 没有指针。

当您将一个对象变量分配给另一个对象变量时，它会更改该变量指向的内容，但不会更改您可能拥有的任何其他引用。

所以：

```
Object a = new Object("a");
Object b = new Object("b");

a = b;
b = new Object("c");

// At this point, a = "b"
// and b = "c" 
```

如您所见，虽然您首先设置了 a = b，但当您将 b 设置为新对象时，a 仍然保留对旧对象的引用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-19T10:56:24.713

数组中的值只是一个参考。就像这样做：

```
Obj a = new Obj("a"); 
Obj t0 = a;
a = new Obj("b"); 
```

最后，`t0`变量具有在第 2 行给出的值 - 即对第 1`Obj`行创建的第一个的引用。更改`a`变量的值不会更改 t0 的值。

一旦您理解了上述内容，只需将数组视为变量的集合，例如

```
Obj[] t = new Obj[10]; 
```

大致*就像*声明：

```
Obj t0, t1, t2, t3, t4, t5, t6, t7, t8, t9; 
```

（有很多差异，但在这个问题的背景下，它们是相似的。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-19T10:52:37.077

当你做 t[0] = a; 您在数组中分配由 new Object("a") 创建的对象的地址，无论您重新使用 a 变量，都不会更改数组中包含的值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-23T23:08:39.080

> *为什么在 java 中，当我访问 t[0] 时，它返回我“a”，而不是“b”？*

因为你告诉他用“a”持有对对象的引用。

Java 不直接操作对象。相反，我使用了对象引用。但是这个引用保存了引用的**值**（不是引用）所以当你给 t[0] 分配 a 的值时，它们都引用了同一个对象。

让我们看看这张图片是否能更好地解释它：

[替代文字 http://img520.imageshack.us/img520/8857/referencesq4.png](http://img520.imageshack.us/img520/8857/referencesq4.png)

首先，a 和 t[0] 引用同一个对象。

后来下降了那个参考，但 t[0] 没有。

最后 a 和 t [1](http://img520.imageshack.us/img520/8857/referencesq4.png)引用同一个对象并且 t[0] 保持不变。

> *这是因为GC吗？*

不

> *我能相信做这样的手术是安全的吗*

是的

# java - 用java创建xml

> ID：380639
> 
> 赞同：1
> 
> 时间：2008-12-19T10:51:21.463
> 
> 标签：java, xml

我再次需要你的专业知识。我有一个 java 类，它在目录中搜索 xml 文件（显示它在 eclipse 控制台窗口中找到的文件），将指定的 xslt 应用于这些文件并将输出发送到目录。

我现在要做的是创建一个包含文件名和文件格式类型的 xml。格式应该是这样的；

```
<file>
      <fileName>         </fileName>
      <fileType>       </fileType>
</file>

<file>
     <fileName>         </fileName>
     <fileType>       </fileType>
</file> 
```

对于它在目录中找到的每个文件，它都会创建一个新的`<file>`.

任何帮助都非常感谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-19T11:04:34.133

使用 XML 库。周围有很多，而且第三方的几乎都比 Java 中内置的 DOM API 更容易使用。上次我用它时，[JDom](http://jdom.org/)还不错。（我最近不需要做太多 XML。）

就像是：

```
Element rootElement = new Element("root"); // You didn't show what this should be
Document document = new Document(rootElement);

for (Whatever file : files)
{
    Element fileElement = new Element("file");
    fileElement.addContent(new Element("fileName").addContent(file.getName());
    fileElement.addContent(new Element("fileType").addContent(file.getType());
}

String xml = XMLOutputter.outputString(document); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-19T11:05:05.913

看看 DOM 和 ECS。以下示例已根据您的要求进行[了](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-1044810.html#)调整：

```
XMLDocument document = new XMLDocument();
for (File f : files) {
    document.addElement( new XML("file")
        .addXMLAttribute("fileName", file.getName())
        .addXMLAttribute("fileType", file.getType())
      )
    );
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T11:09:20.193

您可以使用 Vinze 建议的 StringBuilder 方法，但需要注意的是，您需要确保您的文件名不包含特殊的 XML 字符，如果包含则转义它们（例如，将 < 替换为 <，并适当地处理引号） .

在这种情况下，它可能不会出现，没有它你就可以逃脱，但是如果你曾经移植此代码以在另一种情况下重用，你可能会被它咬住。因此，您可能想查看一个 XMLWriter 类，它将为您完成所有转义工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T10:56:07.520

好吧，只需使用 StringBuilder ：

```
StringBuilder builder = new StringBuilder();
for(File f : files) {
    builder.append("<file>\n\t<fileName>").append(f.getName).append("</fileName>\n)";
    [...]
}
System.out.println(builder.toString()); 
```

# asp.net - 如何获取当前在 iframe 中加载的页面的 url

> ID：380653
> 
> 赞同：0
> 
> 时间：2008-12-19T10:56:13.590
> 
> 标签：asp.net

我有一个要求，在我的应用程序中单击一个按钮时，我必须使用与我的应用程序相同的模板加载另一个应用程序。

因此，在单击应用程序中的按钮时，我使用了一个中间页面，其中使用 iframe 我传递了外部应用程序的 URL。它工作正常。

但问题出在外部应用程序中，我无法控制单击它移动到下一页的按钮。在那个页面中，我想隐藏一个按钮。

我也使用 div 标签颜色为白色并设置位置。

但问题出在影响相同位置的所有页面中。所以我想在外部应用程序的第二次或第三次单击时获取在 iframe 中加载的页面的 URL，以便我可以使用某些条件来隐藏控件。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-29T15:39:28.250

You can use Javascript. Give the iframe an ID

```
var iframe = document.getElementById(id); 
```

The url is accessible via the "src" attribute:

```
iframe.src 
```

[more info](http://www.quirksmode.org/js/iframe.html)

# asp.net - 需要知道我的 web.config 文件中的连接字符串应该为 SQL Server 2005 设置什么

> ID：380658
> 
> 赞同：0
> 
> 时间：2008-12-19T10:57:32.090
> 
> 标签：asp.net, sql-server, hosting

我创建了一个连接到 SQL 服务器数据库的 asp.net 网站。目前在我的开发机器上，我已将连接设置为 SQL server express 数据库，文件位于网站的 App_Data 文件中。

我现在需要将站点上传到我设置了 SQL 服务器数据库的主机。他们为我提供了 SQL 服务器数据库的名称 - **mssql.mydomain.com** - 但我不确定如何在 web.config 文件中设置连接字符串以指向它。

任何帮助将非常感激。- 提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T10:59:25.877

```
Server=mssql.mydomain.com;uid=user_id_goes_here;pwd=password_goes_here 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T11:02:32.733

www.connectionstrings.com

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T11:00:29.370

初始目录=MyDatabase；数据源=mssql.mydomain.com；用户ID=MyUser；密码=MyPassword

这行得通吗？

# vb.net - 正则表达式和从右到左的匹配代码

> ID：380660
> 
> 赞同：0
> 
> 时间：2008-12-19T10:58:40.217
> 
> 标签：vb.net, regex, matching

与正则表达式有点纠结，我在一个字符串中有 4 个代码

CODE4:CODE3:CODE2:CODE1

除 CODE1 外，每个代码都是可选的

所以我可以有 ab:bc:de:fg

或者

公元前::fg

的

ab:::fg

在上述 CODE1 = fg dnd 的每种情况下，为了我亲爱的生活，我无法计算出 RegEX

作为标准字符串解析很容易，但不幸的是，因为需要通过正则表达式完成商业对象:-(并通过 vb.net RegEX.matche,groups("Code1") fg 返回（我希望这使得感觉）

提前感谢您的帮助

最后得到了一些可以完成工作的正则表达式，有点乱但它有效

```
(^(?<code1>[\w]*)$)|(^(?<code2>[\w]*):(?<code1>[\w]*)$)|(^(?<code3>[\w]*):(?<code2>[\w]*):(?<code1>[\w]*)$)|(^(?<code4>[\w]*):(?<code3>[\w]*):(?<code2>[\w]*):(?<code1>[\w]*)$) 
```

塔都

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-19T11:06:01.823

这里不需要使用正则表达式。

我不知道您使用的是什么语言，但是将字符串拆分为“：”，您将获得一组代码。

如果您真的只是想验证一个字符串是否对此有效，那么

```
/(\w*:){0,3}\w+/ 
```

符合你的描述和你给出的几个例子。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T11:07:27.483

我不确定为什么你必须从右到左匹配代码。只需使用正则表达式来分离字符串：

```
/(.*):(.*):(.*):(.+)/ 
```

然后你在 4 美元中有 CODE1，在 3 美元中有 CODE2，在 2 美元中有 CODE3，在 1 美元中有 CODE4。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T11:28:12.760

`(CODE1)?:(CODE2)?:(CODE3)?:CODE4`会工作 - 如果领先：没关系。否则，如果您不能有前导冒号，请枚举：

`(CODE1:(CODE2)?:(CODE3)?:|CODE2:(CODE3)?:|CODE3)?CODE4`

最右边的部分是强制性的，而最左边的部分不是，这一点并没有什么特别之处。

# asp.net - System.Web.Cache，会话级别或应用程序级别

> ID：380662
> 
> 赞同：6
> 
> 时间：2008-12-19T10:59:38.170
> 
> 标签：asp.net, caching

随机快速问题。

System.Web.Cache 类，信息存储在什么级别？在每个会话级别还是整个应用程序级别？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-19T11:04:18.237

AFAIK 在应用程序级别。

[http://msdn.microsoft.com/en-us/library/system.web.caching.cache.aspx](http://msdn.microsoft.com/en-us/library/system.web.caching.cache.aspx)

从页面：

> 每个应用程序域创建一个此类的实例，只要应用程序域保持活动状态，它就保持有效。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-19T11:03:14.917

每个应用程序域都有一个缓存实例

# interface - 空接口是做什么用的

> ID：380665
> 
> 赞同：47
> 
> 时间：2008-12-19T11:00:34.377
> 
> 标签：interface

我正在查看 nServiceBus 并通过了这个界面

```
namespace NServiceBus
{
    public interface IMessage
    {
    }
} 
```

空接口有什么用？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-12-19T11:10:27.493

通常它是为了表示一个类的使用。您可以实现 IMessage 以表明您的类是消息。然后其他代码可以使用反射来查看您的对象是否打算用作消息并采取相应的行动。

这是在 Java 中有很多注释之前使用的东西。在 .Net 中，为此使用属性更简洁。

* * *

@Stimpy77 谢谢！我没有那样想。我希望您允许我以更笼统的方式重新表述您的评论。

必须在运行时使用反射检查注释和属性。可以在编译时使用编译器中的类型系统检查空接口。这在运行时根本不会带来任何开销，因此速度更快。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-12-19T11:15:55.203

也称为标记接口：

[http://en.wikipedia.org/wiki/Marker_interface_pattern](http://en.wikipedia.org/wiki/Marker_interface_pattern)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-12-19T11:13:13.743

在 java`Serializable`中就是一个完美的例子。它没有定义任何方法，但它必须确保“实现”每个类，它确实是可序列化的，并且不包含对无法序列化的事物的引用，例如数据库连接、打开的文件等。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-12-19T11:09:50.770

在 Java 中，空接口通常用于“标记”类——现在通常使用注释。

`<this>`这只是在类中添加一些元数据的一种方式，即使不涉及普通成员，也可以说“这个类适合某种用途”。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-19T11:16:15.797

通常它类似于属性。使用属性比空接口更受欢迎（至少在 FxCop 所知道的范围内）。但是 .NET 本身使用其中一些接口，例如`IRequiresSessionState`和`IReadOnlySessionState`. 我认为当您使用使它们使用接口的属性时，元数据查找会出现性能损失。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-07-09T16:08:57.023

空接口仅充当其接口行为中没有更好指定的数据类型的占位符。

在 Java 中，接口扩展机制代表了一个很好的使用示例。例如，假设我们有以下

```
interface one {}
interface two {}

interface three extends one, two {} 
```

接口三会继承‘一’和‘二’的行为，以此类推

```
class four implements three { ... } 
```

必须指定两种方法，类型为“三”。

如您所见，从上面的示例中，空接口也可以看作是多重继承的一个点（在 Java 中是不允许的）。

希望这有助于澄清进一步的观点。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-19T11:16:32.020

它们被称为“标记接口”，旨在发出标记类的实例。

例如...在 C++ 中，将对象标记为“ICollectible”是一种常见做法，因此它们可以存储在通用的非类型化集合中。

所以就像有人说的那样，他们要发出一些对象支持的行为的信号，比如被收集、序列化等的能力。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-19T11:35:32.340

过去一年一直在与**NServiceBus合作。**虽然我不会代表**Udi Dahan**，但我的理解是这个界面确实主要用作**标记**。

虽然我建议你问问这个人自己，他是否考虑过将这个留作未来的扩展。我的赌注是不，因为口头禅似乎是让消息非常简单，或者至少实际上与平台无关。

其他人对空接口的更一般原因回答得很好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-19T11:04:41.590

我会说它用于“未来”参考，或者如果你想共享一些对象，这意味着你可以有 10 个类，每个类都实现这个接口。

并将它们发送到一个函数进行处理，但如果接口为空，我会说它只是“预”工作。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-19T11:34:57.350

空接口用于记录实现给定接口的类具有某种行为

例如在 java 中`Cloneable`，Java 中的接口是一个空接口。当一个类实现了`Cloneable`接口时，你知道你可以`clone()`在它上面调用 run 。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-05-26T06:07:39.547

空接口用于标记类，在运行时可以使用接口进行类型检查。

例如，来自 Java 编程语言的标记接口应用程序是 Serializable 接口。类实现此接口以指示其非瞬态数据成员可以写入 ObjectOutputStream。ObjectOutputStream 私有方法 writeObject() 包含一系列用于确定可写性的 instanceof 测试，其中一个用于查找 Serializable 接口。如果这些测试中的任何一个失败，该方法将引发 NotSerializableException。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-04-19T11:32:48.887

空接口可用于根据特定目的对类进行分类。（**标记界面**）

**示例：数据库实体**

```
public interface IEntity {

}

public class Question implements IEntity {
   // Implementation Goes Here
}

public class Answer implements IEntity {
   // Implementation Goes Here
} 
```

例如，如果您将使用通用存储库（例如**IEntityRepository**），使用通用约束，您可以防止开发人员发送未实现 IEntity 接口的类。

# c++ - Borland 5.0 项目文件的格式是什么？

> ID：380673
> 
> 赞同：1
> 
> 时间：2008-12-19T11:03:55.837
> 
> 标签：c++, ide, borland-c++, project-files

我有一个旧的 Borland 项目，我想将它移植到[Visual Studio 2008](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2008)。有没有办法以人类可读的格式从 .ide 文件中转储源文件、编译选项和依赖信息？

我想要比“生成 Makefile”选项更全面的东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T23:18:30.170

如果这是一个[VCL应用程序，选项和设置是您最不关心的问题，因为 VCL API 与](https://en.wikipedia.org/wiki/Visual_Component_Library)[MFC](http://en.wikipedia.org/wiki/Microsoft_Foundation_Class_Library)完全不同。许多 Borland 编译器选项实际上是为了提供与 MFC 的兼容性。除此之外，编译器选项实际上并没有太多重叠。

我偶尔会向同事提供我的 Borland 项目的 Visual Studio“解决方案”版本，通常只需选择解决方案中的 .cpp 文件并设置任何全局定义（请注意，这些是控制台模式程序，没有 GUI）。

更大的问题是流类、values.h 和 Microsoft 已弃用的函数中的细微不一致。即_stricmp()、_chdir()、_mkdir() _getcwd() 代替stricmp() chdir() mkdir() getcwd() 等...

我通常没有发现各种 Borland 生成的 makefile 与任何其他编译器（或者甚至与 Borland 编译器）非常兼容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T13:10:00.503

我认为在 Visual Studio 中创建一个新项目然后将所有源文件和库添加到其中会更容易。

我认为 Visual Studio 不支持[OWL](https://en.wikipedia.org/wiki/Object_Windows_Library)（或任何 Borland 库）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T23:01:40.797

I don't know about Borland 5, 6 or latest compilers (latest version I've used is Borland C++ 3.1 back in 1994/95 ...), but if you have the chance to generate a Makefile maybe the best solution is to use that Borland makefile to write a NMAKE compatible makefile by hand, if it's not too large.

Another option is to manually import the header, source files and edit the project (compatibilize source and compilation settings) until the build is successful. I think this can be achieved in a short time.

To what dependencies is your project tied to? VCL? MFC? Just standard libs?

# java - 如何在 Java 中设置 icc 颜色配置文件并更改颜色空间

> ID：380678
> 
> 赞同：3
> 
> 时间：2008-12-19T11:04:46.567
> 
> 标签：java, jai, icc, color-space, jmagick

首先，我想说我不是图像处理专家。

我想将图像色彩空间从一个转换到另一个，并同时更改 icc 颜色配置文件。我设法使用 JMagick（ImageMagick Java 端口）来做到这一点，但在纯 Java 中没有办法（即使使用 JAI）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-05-10T16:22:45.177

使用[`ColorConvertOp`](http://java.sun.com/javase/6/docs/api/java/awt/image/ColorConvertOp.html)，这将进行色彩空间转换。您有几个选项来设置 icc 颜色配置文件。您可以通过使用正确的色彩空间常数来使用预定义的配置`getInstance`文件，也可以指定一个包含配置文件的文件。这是一个例子：

```
ICC_Profile ip = ICC_Profile.getInstance( ColorSpace.CS_sRGB );
ICC_ColorSpace ics = new ICC_ColorSpace( ip );
ColorConvertOp cco = new ColorConvertOp( ics, null );
BufferedImage result = cco.filter( sourceImage, null ); 
```

将`result`包含具有`sRGB`颜色空间的图像。

# oracle - oracle物化视图刷新时间

> ID：380694
> 
> 赞同：5
> 
> 时间：2008-12-19T11:12:10.843
> 
> 标签：oracle, materialized-views

谁能告诉我使用以下设置刷新物化视图的频率？

REFRESH FORCE ON DEMAND START WITH sysdate+0 NEXT (round(sysdate) + 1/24) + 1

我想我每小时都读一次，但我不确定

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-19T11:19:04.980

```
SQL> alter session set nls_date_format = 'yyyy-mm-dd :hh24:mi:ss';

Session changed.

SQL> select sysdate from dual;

SYSDATE
--------------------
2008-12-19 :12:18:28

SQL> select (round(sysdate) + 1/24) + 1  from dual;

(ROUND(SYSDATE)+1/24
--------------------
2008-12-21 :01:00:00 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-02T19:13:44.887

要回答您的第一个问题（这会每小时运行一次吗？）：

不，由于这个子句，这将在您创建它时运行一次：

```
START WITH sysdate+0 
```

就个人而言，我认为“+0”是无关紧要的，就像现在一样。

然后它将在明天凌晨 1 点运行，因为以下子句：

```
NEXT (round(sysdate) + 1/24) + 1 
```

“1/24”部分计算凌晨 1 点的时间，因为 Oracle 日期实际上存储为数字，小数部分表示小时、分钟等。语法很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T14:03:24.910

我不是 100% 确定它在物化视图调度语句中是否合法，但您可能想尝试（可以说）更直观的 INTERVAL 规范：

```
round(sysdate) + interval '1 1' day to hour 
```

此处的其他示例：http: [//download.oracle.com/docs/cd/B19306_01/server.102/b14200/sql_elements003.htm#SQLRF00221](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/sql_elements003.htm#SQLRF00221)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-04-26T12:37:11.813

我认为使用

```
NEXT (trunc(sysdate) + 1/24) + 1 
```

更准确

# c# - 在 c#/LINQ 中将数组转换为字符串的最短方法

> ID：380708
> 
> 赞同：57
> 
> 时间：2008-12-19T11:17:19.537
> 
> 标签：c#, linq, arrays

关闭为[这个问题](https://stackoverflow.com/questions/145856)的完全相同的副本。

我有一个元素数组/列表。我想将其转换为字符串，由自定义分隔符分隔。例如：

```
[1,2,3,4,5] => "1,2,3,4,5" 
```

在 c# 中执行此操作的最短/最简单的方法是什么？

我总是通过循环列表并在添加分隔符之前检查当前元素是否不是最后一个来做到这一点。

```
for(int i=0; i<arr.Length; ++i)
{
    str += arr[i].ToString();
    if(i<arr.Length)
        str += ",";
} 
```

有没有可以帮助我编写更少代码的 LINQ 函数？

* * *

## 回答 #1

> 赞同：156
> 
> 时间：2008-12-19T11:19:12.577

```
String.Join(",", arr.Select(p=>p.ToString()).ToArray()) 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-12-19T11:19:41.797

```
String.Join(",", array.Select(o => o.ToString()).ToArray()); 
```

# c# - 帮我重构泛型集合的迭代

> ID：380709
> 
> 赞同：2
> 
> 时间：2008-12-19T11:18:21.500
> 
> 标签：c#, refactoring, generics

我正在使用通用数据结构，比如`MyGeneric<Type>`. 有一种情况，我必须遍历它持有的所有值

我正在尝试做的代码。

```
for ( all the keys in myGeneric ) {
    // do lot of stuff here 
} 
```

现在泛型可以保存基本类型为 double 和 string，它也可以保存一些用户定义的类型。在一种特殊情况下，我必须根据泛型的类型进行一些特定的工作。

所以最终的代码块看起来像这样

```
for( all the keys in myGeneric ) {
    if key is type foo then 
        //do foo foo 
    else if key is of type bar 
        //do bar bar 
} 
```

现在，像我一样对复杂性敏感，我不喜欢在 for 循环中有 if 条件。所以我做的下一个解决方案是

```
if myGeneric is of type foo 
    call fooIterator(myGeneric) 
if myGenric is of type bar 
    call barItetrator(myGeneric)

function FooIterator() {
    // .....
    // foo work 
    //......
}

function BarItetrator() {
    // .....
    // bar work 
    //......
} 
```

再一次，当有人看到我的代码时，我很确定他们会大喊“重构”在哪里。

在这种情况下，理想的做法是什么？

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-19T11:26:25.073

那么，您可以使用 Linq`OfType<T>`方法和多个循环吗？

```
foreach(Foo foo in list.OfType<Foo>()) {
  //
}
foreach(Bar bar in list.OfType<Bar>()) {
  //
} 
```

除此之外，您还使用条件语句。我确实在[这里看到](https://stackoverflow.com/questions/156467/switch-pattern-matching-idea)了与 F# 相关的这个，它更干净地做到了这一点。

作为旁白; 如果这是使用 PushLINQ （在[MiscUtil](http://www.pobox.com/~skeet/csharp/miscutil/)中），您可以通过将不同类型推送到不同的分支来在一次迭代中执行此操作 - 不过，不确定它是否值得这样做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T11:31:08.963

我认为您的第二个选项读起来更好一些。特别是如果 foo/bar 工作包含大量代码。在性能方面，我预计在调用方法时会略有损失，但我认为它不会影响你。

# c# - Linq2Sql：管理数据上下文

> ID：380720
> 
> 赞同：4
> 
> 时间：2008-12-19T11:24:17.933
> 
> 标签：c#, asp.net, linq-to-sql

在以下代码中不起作用

```
public void Foo()
{
   CompanyDataContext db = new CompanyDataContext();
   Client client = (select c from db.Clients ....).Single();
   Bar(client);
}

public void Bar(Client client)
{
   CompanyDataContext db = new CompanyDataContext();
   db.Client.Attach(client);
   client.SomeValue = "foo";
   db.SubmitChanges();
} 
```

这不起作用，我收到错误消息。“已尝试附加或添加一个不是新的实体，可能是从另一个 DataContext 加载的。不支持。”

您如何在整个应用程序中使用 DataContexts，这样您就不需要传递引用？

什么

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-19T11:43:48.280

他们真正的意思是“不支持”。未实现附加到从另一个数据上下文中获取的对象。

该问题有多种解决方法，推荐的方法是序列化对象，但这并不容易，也不是一种干净的方法。

我发现最简单的方法是使用只读 DataContext 来获取这样的对象：

```
 MyDataContext dataContext = new MyDataContext() 
        { 
            DeferredLoadingEnabled = false, 
            ObjectTrackingEnabled = false 
        }; 
```

从这个上下文获得的对象可以附加到另一个上下文，但只适用于某些场景。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-29T14:47:01.073

PLINQO框架为所有实体生成分离，[从而](http://plinqo.com)可以轻松分离和重新附加对象而不会收到该错误。

```
public void Foo()
{
   CompanyDataContext db = new CompanyDataContext();
   Client client = (select c from db.Clients ....).Single();
   // makes it possible to call detach here
   client.Detach();
   Bar(client);
}

public void Bar(Client client)
{
   CompanyDataContext db = new CompanyDataContext();
   db.Client.Attach(client);
   client.SomeValue = "foo";
   db.SubmitChanges();
} 
```

这是描述如何实现分离的文章。 [http://www.codeproject.com/KB/linq/linq-to-sql-detach.aspx](http://www.codeproject.com/KB/linq/linq-to-sql-detach.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T11:39:35.640

是的。这就是它的工作原理。

你已经标记了这个 asp.net，所以我猜它是一个网络应用程序。也许您想要每个请求一个数据上下文？

[http://blogs.vertigo.com/personal/keithc/Blog/archive/2007/06/28/linq-to-sql-and-the-quote-request-scoped-datacontext-quote-pattern.aspx](http://blogs.vertigo.com/personal/keithc/Blog/archive/2007/06/28/linq-to-sql-and-the-quote-request-scoped-datacontext-quote-pattern.aspx)

（PS 在 WinForms 中更难！）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T11:39:29.493

我创建了封装所有与 Linq2Sql 通信的数据访问类。这些类有它们自己的数据上下文，它们用于它们的对象。

```
public class ClientDataLogic
{
    private DataContext _db = new DataContext();

    public Client GetClient(int id) 
    { 
        return _db.Clients.SingleOrDefault(c => c.Id == id); 
    }

    public void SaveClient(Client c) 
    { 
        if (ChangeSetOnlyIncludesClient(c))
            _db.SubmitChanges(); 
    }
} 
```

当然，只要您需要对象，您就需要保持该对象的实例化。

检查是否只有 rigth 对象已更改也有些麻烦，您可以制作类似的方法

```
void ChangeClientValue(int clientId, int value); 
```

但这可能会变成很多代码。

附加和分离是 Linq2Sql 中缺少的一个功能，如果你需要经常使用它，你可能会使用 Linq2Entities。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T11:44:34.830

您需要处理对象版本控制。

如果实体声明了版本成员或没有更新检查策略，则实体只能在没有原始状态的情况下附加为已修改。

因此，如果没有提供时间戳成员或其他“版本控制”机制，则 LINQ 无法确定该数据是否已更改 - 因此您会看到错误。

我通过在我的表中添加时间戳列解决了这个问题，但还有其他方法可以解决这个问题。Rick Strahl 写了一些关于这个问题的不错的[文章。](http://www.west-wind.com/weblog/posts/135659.aspx)

另外，请参阅[此](http://www.nablasoft.com/alkampfer/index.php/2008/03/01/linq-to-sqlworking-with-detatched-object/)和[此](http://visualstudiomagazine.net/features/article.aspx?editorialsid=1340)以获取更多信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-19T12:53:50.477

我看了一下，发现只要原始 DataContext 已被处理，它似乎就可以正常工作。

尝试使用 using() 包装 DataContext 并确保在附加到第二个 DataContext 之后发生更改？它对我有用..

```
 public static void CreateEntity()
        {
            User user = null;
            using (DataClassesDataContext dc = new DataClassesDataContext())
            {
                user = (from u in dc.Users
                        select u).FirstOrDefault();               
            }
            UpdateObject(user);
        }

        public static void UpdateObject(User user)
        {
            using (DataClassesDataContext dc = new DataClassesDataContext())
            {
                dc.Users.Attach(user);
                user.LastName = "Test B";
                dc.SubmitChanges();
            }
        } 
```

# ruby-on-rails - 正确了解 Rails 框架的最佳方法是什么？

> ID：380721
> 
> 赞同：5
> 
> 时间：2008-12-19T11:25:22.813
> 
> 标签：ruby-on-rails, ruby, frameworks

我在 Rails 上做了两个项目，效果很好，但在这个过程中重新发明了轮子，运行（和热水）水和止痛药，正如我了解到的那样，这些项目随后已经存在于框架中。

所以基本上，正确了解框架中所有聪明部分的最佳方法是什么，可以节省时间，而不是自己构建已经实现的功能？从第 1 页开始阅读文档？是否有一个特定的示例应用程序可以公开所有内容？一个特定的开源项目？所有的铁路广播？还是完全不同的东西？

很多人推荐了一系列书籍，但我可能对我要找的东西不够清楚。我已经有许多 Rails（和一本 Ruby）书籍，它们在不同程度上解释了 Rails 框架，但这并不是我真正想要的。例子：

我编写了自己的函数来将数字漂亮地打印为货币（实际上我扩展了 Object 来为我做这件事），因为我不知道 number_to_currency 存在。现在这在时间上并不是什么大问题，但我确信我已经多次使用自己的方法，因为我不知道存在类似的 rails 函数。

再说一遍，我如何找出 number_to_currency （以及无数其他函数）存在？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-19T11:30:20.103

这有点主观。但是如果你还没有读过*使用 Rails 进行敏捷 Web 开发*，我肯定会推荐它，因为从那时起已经添加了相当多的新内容，并且很快就会出现第 3 版来反映这一点. 此外，如果您还不熟悉 Ruby ， *Ruby for Rails也很棒。*

除此之外，一定要选择一个 Rails 博客并关注它（也许是[Railscasts](http://railscasts.com/)）；回去阅读档案。

最后但并非最不重要的一点是，在您开始发明某些东西之前，请彻底搜索它和/或在[Rails 论坛](http://www.ruby-forum.com/forum/3)上发帖，以确保它不存在。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-19T11:38:32.460

我第二次推荐*使用 Rails 进行敏捷 Web 开发*，我有第 3 版的 beta/PDF，它确实很有帮助。您还可以在[此站点](http://guides.rubyonrails.org/)上找到许多指南。不要忘记像[Bort](http://github.com/fudgestudios/bort/tree/master)和它的叉子这样的[东西](http://matthall.wordpress.com/2008/09/09/a-bort-fork-rails-base-application/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-19T17:37:16.117

时间。

真的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-19T18:11:33.003

查看 Bort、Caboose 示例应用程序，以及其他一些应用程序，然后编写自己的

[http://jimneath.org/2008/09/09/bort-base-rails-application/](http://jimneath.org/2008/09/09/bort-base-rails-application/)

[http://www.railsinside.com/elsewhere/100-7-barebones-rails-apps-to-kick-start-your-development-process.html](http://www.railsinside.com/elsewhere/100-7-barebones-rails-apps-to-kick-start-your-development-process.html)

* * *

我还会看诸如 Ediger：高级 Rails、Rappin：Professional Rails、“Art of Rails”（Wrox，不记得作者）Chak/oreilly：Enterprise Rails 之类的教程后书籍。在亚马逊上阅读评论，选择 1 或 2。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-20T13:05:12.933

以前的答案几乎涵盖了学习 Rails 的最佳资源。但我个人最喜欢的是 Ryan Bates 出色的[Railscast](http://railscasts.com)系列。此外，[Peepcode](http://peepcode.com)有一些优秀的 Rails 截屏视频

他几乎涵盖了人们在任何 Rails 项目中需要的每一件小事。

就书籍而言，Simply Rails 2 非常有帮助

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-19T20:01:55.667

“使用源，卢克。” 我只是在阅读一篇关于阅读 Rails 源代码的文章，以此来真正了解正在发生的事情。当然，在看到这个问题之前，我关闭了该选项卡....

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-21T21:17:58.463

在我看来，有一个示例项目是最好的开始方式之一。选择一些有趣的东西（不是你梦寐以求的大创意，而是一些小而有趣的东西）并开始努力！

[Ruby On Rails](http://www.rubyonrails.org)网站上的一些示例视频以及敏捷 Web 开发书籍确实有助于了解基础知识。当您尝试解决特定问题时，[Railscasts](http://www.railscasts.com)或[Peepcode 之](http://www.peepcode.com)类的东西真的很有帮助。

当有这么多使用 Rails 做某事的方法时，有时很难第一次把事情“正确”。“The Rails Way”一书是了解其中一些内容的好方法，但 Railscasts 也涵盖了 Rails 方式的内容。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-20T15:30:16.747

我不确定为什么另一张海报被否决。实际编写代码是无可替代的。很多。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-19T13:10:02.350

了解 Rails 的第一个好方法是在其中实际*制作*一些东西——任何东西，甚至只是一个简单的博客或类似的东西。这样做将向您展示*构建*一个好的 Rails 应用程序需要了解和查找的内容。

我还有两本书用来学习 Rails：David Thomas 和 David Heinemeier Hansson 的*Agile Web Development with Rails* ，以及Jeffrey Allan Hardy 和 Cloves Carneiro Jr. 的《 *Beginning Rails: From Novice to Professional 》。*

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-15T15:58:28.727

我最喜欢的方式是观看 Railscast：

[http://www.railscasts.com](http://www.railscasts.com)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-07-13T16:56:22.687

Rails 不是微不足道的，它隐藏了很多魔法。

我建议选择一个你将要做的项目。不要选择“创建博客”之类的，选择一个你想看到的真实项目。然后阅读像[Agile Web Dev with Rails](http://www.pragprog.com/titles/rails2/agile-web-development-with-rails)这样的书，并尝试按照示例和教程编写代码。

不要犹豫，花时间完全重构您的代码以改进您所做的事情。你会发现你做错了所有事情并且不得不重做 50% 的代码。第一次就完全正确是不可能的。

# design-patterns - 什么是动作设计模式？

> ID：380724
> 
> 赞同：11
> 
> 时间：2008-12-19T11:28:08.987
> 
> 标签：design-patterns, command-pattern

什么是动作设计模式，我之前没听说过？我怀疑它与[命令设计模式](http://en.wikipedia.org/wiki/Command_pattern)[wikipedia] 相同，但我找不到任何资源。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-19T11:48:43.183

你是对的，动作模式==命令模式。您在 GUI 设计中经常听到它称为动作模式，其形式为“按下某个按钮，执行此动作”。在代码中，按钮将与某种动作对象连接起来。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2016-03-03T20:21:25.290

我现在正在 MSDN 上阅读“[动作/执行器模式](https://msdn.microsoft.com/en-us/library/cc984279.aspx)”，我不同意命令和动作/执行器模式相同的前提。

SourceMaking.com上对[命令模式](https://sourcemaking.com/design_patterns/command)的描述：

> *   将请求封装为对象，从而让您可以参数化具有不同请求、队列或日志请求的客户端，并支持可撤消的操作。
> *   将“在对象上调用方法”提升为完整对象状态
> *   面向对象的回调

来自关于动作/执行器模式的 MSDN 文章：

> Action/Executor 模式确定了将用例映射到代码的策略，从而实现更好的可见性和敏捷性。此外，它还解决了污染实体和跳过正确使用事务的问题。

不同之处似乎在于“动作”封装了一个或多个步骤，当这些步骤成功执行时，将控制权委托给另一个负责了解如何将这些更改持久化到数据库、Web 服务或文件存储的对象。动作与其执行/持久化的方式是分离的。

“命令”感觉像是动作/执行者模式的一半——“动作”似乎是“命令”的同义词。Action/Executor 模式更进一步，描述了另一个关注点，其职责是接受“操作”或“命令”产生的更改并将它们保存在某个地方。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-11-05T07:38:34.810

动作设计模式与命令设计模式相同。Action 是一个关键实体，它自身封装了有关其行为、必须对其 do() 方法进行哪些处理、如何撤消操作等信息。当一个应用程序或其任何组件按照Action设计模式进行设计时，应用程序中的一切活动都可以用动作的形式来表示，每件事都可以重做/撤消几次。例如。excel中的宏，文本编辑器中的撤消/重做等。

作为此设计模式中的构建块的动作类可以设计如下：-

```
public interface Action{
  public void do();
  public void undo();
  public void do(int iNoOfTimes);
}

public class FileCopyAction implements Action{
  private int iActionId;
  public void do(){}
  public void undo(){}
  public void do(int iNoOfItems){}
} 
```

希望能帮助到你。

# python - 在 mingw/cygwin 上构建时如何让 PIL 工作？

> ID：380731
> 
> 赞同：3
> 
> 时间：2008-12-19T11:31:12.990
> 
> 标签：python, windows, cygwin, python-imaging-library

我正在尝试针对 cygwin 或 mingw 构建 PIL 1.1.6，同时针对 Windows 安装的 python 运行。当我执行任一构建工作时，但在尝试保存文件时出现以下失败。

```
$蟒蛇25
Python 2.5.2 (r252:60911, Feb 21 2008, 13:11:45) [MSC v.1310 32 bit (Intel)] on
win32
输入“帮助”、“版权”、“信用”或“许可”以获取更多信息。
>>> 从 PIL.Image 导入打开
>>> im = open('test.gif')
>>> im.save('output1.gif')
回溯（最近一次通话最后）：
  文件“”，第 1 行，在
  文件“c:\Python25\Lib\site-packages\PIL\Image.py”，第 1405 行，保存
    save_handler(self, fp, 文件名)
  _save 中的文件“c:\Python25\Lib\site-packages\PIL\GifImagePlugin.py”，第 291 行

    ImageFile._save(imOut, fp, [("gif", (0,0)+im.size, 0, rawmode)])
  _save 中的文件“c:\Python25\Lib\site-packages\PIL\ImageFile.py”，第 491 行
    s = e.encode_to_file(fh, bufsize)
IOError：[Errno 0] 错误
>>>

```

我没有使用支持 jpeg 或 zip 的库进行编译，但我认为这在这里不应该相关。

失败的行似乎是在 encode.c 中的 encode_to_file 中写入。

我怀疑发生这种情况是因为文件描述符正在从 Python（在 Visual Studio 2003 下构建）传递到 _imaging.pyd 但文件描述符不匹配，因为在 Windows 上，文件描述符是和抽象之上的操作系统。有人对这个有了解吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T02:29:23.590

据我从一些粗略的谷歌搜索中可以看出，您需要在构建 PIL 之后重新设置 DLL 以便它在 Cygwin 上正常工作。

参考：

*   **[http://jetfar.com/cygwin-install-python-imaging-library/](http://jetfar.com/cygwin-install-python-imaging-library/)**

*   **[http://www.cygwin.com/ml/cygwin/2003-06/msg01121.html](http://www.cygwin.com/ml/cygwin/2003-06/msg01121.html)**

# performance - 单声道性能

> ID：380733
> 
> 赞同：23
> 
> 时间：2008-12-19T11:32:43.657
> 
> 标签：performance, mono, runtime

与 GNU/Linux 中的 Java 相比，Mono 是否有任何性能基准？

你有没有测试过 Mono 的性能？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2012-02-04T03:39:54.577

可以在[此处](http://benchmarksgame.alioth.debian.org/u32/csharp.php)找到此枪战的最新版本。

简而言之，与 Java 相比，Mono 使用的内存少得多，运行速度也慢一些。

为了使事情保持正确，它们在总体规划中的运行速度大致相同。它们运行这些测试的速度都比 Ruby、LUA、Python、PHP 和 Perl 等语言快几个数量级。它们都与 Pascal、OCaml、Haskell 和 LISP 在同一个球场，这使得它们的速度大约是 C 和 C++ 的一半。点击[这里](http://benchmarksgame.alioth.debian.org/u32/which-programming-languages-are-fastest.php)了解更多详情。

为了挑剔，我们应该清楚我们的答案是比较 Java 和 Mono C#。Mono 和 JVM 都是各种语言的目标环境，语言的选择很重要。例如，如果我们将 Mono 上的 F# 与 JVM 上的 Clojure 进行比较，我们会得到完全不同的结果，突然“Mono”变得“[更快](http://benchmarksgame.alioth.debian.org/u32/benchmark.php?test=all&lang=fsharp&lang2=clojure)”。

虽然这些比较很有趣且内容丰富，但您必须对它们持保留态度。首先，虽然有些人会这样做，但大多数编写 Java 和 C# 代码的人并不是什么都不运行，而是在紧密循环中运行数值算法。其次，在其中一些语言中，经过测试的算法可能只是调用了用 C 编写的库，而不是目标语言。最后，其他基准（和实现）可能会产生不同的结果。

尽管如此，可以合理地推断出 Go 比 Ruby 快得多，C++ 比 Go 快，而且 Java 和 C# 的性能都相当合理，因为它们的生产力很高（恕我直言）。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-19T11:35:42.497

Miguel 对此发表了一篇有趣的文章。

> “Alvaro 指出，在 Language Shootout Benchmark 中，Mono 排在第 18 位，而 Java 排在第 10 位。
> 
> 我们知道 Sun 的专有 Java 版本（不是开源版本，因为还没有找到那个版本）比 Mono 快，但我很惊讶我们落后这么多。所以我查看了 Java6 和 Mono 之间的比较。”

[![比较 - Java 和 Mono](https://i.stack.imgur.com/2ITZS.png)](https://i.stack.imgur.com/2ITZS.png)
[（来源：[tirania.org](http://tirania.org/pictures/javavsmono.png)）]

[在此处查看详细信息](http://tirania.org/blog/archive/2007/Dec-28.html)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-12-19T19:05:09.637

amazedsaint > *Miguel 对此发表了一篇有趣的文章。*

那个图表已经过时了！

这是[当前的 Mono C# 4.0 比较](http://benchmarksgame.alioth.debian.org/u64q/csharp.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-15T16:29:20.853

我[将 Mono 2.2 与其他各种虚拟机（包括 OCaml、LLVM、.NET 和 Java）进行了基准测试](http://flyingfrogblog.blogspot.com/2009/01/mono-22.html)：

[Mono 2.2 vs OCaml vs .NET vs LLVM vs JDK http://2.bp.blogspot.com/_NMRkpon4Ps0/SYNY8YtzTCI/AAAAAAAAACg/Bkjli4JV-NU/s1600-h/scimark2_individual.gif](http://2.bp.blogspot.com/_NMRkpon4Ps0/SYNY8YtzTCI/AAAAAAAAACg/Bkjli4JV-NU/s1600-h/scimark2_individual.gif)

总之，Mono 2.2 比 Mono 2.0 好，但通常仍然比几乎所有其他版本慢*很多。*

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-02-26T20:17:11.127

我的基准测试（使用复杂的数学问题和内存操作（使用原始字符串））：

MonoDevelop Windows（使用 .net 3.5 在控制台上运行）：Realizando cálculos em 1.000.000 itens... 535 Realizando Operações com strings longas... 2.038 Realizando cálculos em 1.000.000 itens... 530 Realizando operações com strings longas... . 1.962 Realizando cálculos em 1.000.000 itens... 530 Realizando Operações com strings longas... 1.963

在 Windows 上使用 mono.exe： Realizando cálculos em 1.000.000 itens... 6.875 Realizando operações com strings longas... 6.206 Realizando cálculos em 1.000.000 itens... 6.840 Realizando operações com strings longas... 6.114 Realizando cálculos em 1.000.000 itens... 6.857 Realizando Operações com strings longas... 6.116

在 Linux Ubuntu 上使用单声道： Realizando cálculos em 1.000.000 itens... 5,934 Realizando opações com strings longas... 6,915 Realizando cálculos em 1.000.000 itens... 6,034 Realizando operações com strings longas... 7,489 Realizando cálculos em 1.000 .000 itens... 5,740 Realizando Operações com strings longas... 6,731

相同的源代码，但在 Visual Studio 2008 上： Realizando cálculos em 1.000.000 itens... 588 Realizando operações com strings longas... 1.289 Realizando cálculos em 1.000.000 itens... 566 Realizando operações com strings longas... 1.320 Realizando cálculos em 1.000.000 itens... 702 Realizando Operações com strings longas... 1.393

VS 2008 使用 NGEN 生成的 exe（本机可执行文件）： Realizando cálculos em 1.000.000 itens... 567 Realizando operações com strings longas... 1.255 Realizando cálculos em 1.000.000 itens... 563 Realizando operações com strings longas... 1.269 Realizando cálculos em 1.000.000 itens... 562 Realizando Operações com strings longas... 1.263

在这些测试中，单声道比 .net 3.5 SP 1 慢 10 倍 =(

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-12-20T16:21:42.693

C++、C#（单声道）、C 和 Vala：http: [//jpaflacerda.wordpress.com/2011/11/08/vala-benchmarking/](http://jpaflacerda.wordpress.com/2011/11/08/vala-benchmarking/)

多种语言：[http ://attractivechaos.github.com/plb/](http://attractivechaos.github.com/plb/)

结论：Mono 发展了很多，但与其他可用语言相比仍然很慢。我对 Vala 很感兴趣，它具有与 C# 几乎相同的语法，但在某些情况下比普通 C 更快。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-10-09T07:57:59.933

大多数基准测试都基于紧密循环的大量计算。时间在循环之前开始计数并在之后停止。如果您的应用程序正在执行繁重的数据处理，请避免同时使用 C# 和 Java，只需选择 C/C++。

您的应用程序更有可能是服务器端的。它必须接受查询、获取数据并将其发回。在这种情况下，与其他参数相比，生成代码的原始速度无关紧要。

你最好看看底层框架的效率如何，代码执行前的初始化阶段有多快，实现非阻塞 I/O 等高效技术有多容易，内存释放和进程回收之后的效率如何代码执行。部署代码有多容易，让它扩大规模......

人的参数比这一切都更重要。写得不好的 Java 比好的 C# 慢，反之亦然。所以你必须检查你的开发人员。他们掌握哪种语言，他们更喜欢哪种工具？他们是 VS/resharper 上瘾者还是可以使用 Java IDE？花在学习新语言或 IDE 上的时间不会花在编写更好、更优化的代码上。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-19T11:35:54.493

我看过一个[http://shootout.alioth.debian.org/gp4/csharp.php](http://shootout.alioth.debian.org/gp4/csharp.php)

# python - 如何遍历和搜索 python 字典？

> ID：380734
> 
> 赞同：12
> 
> 时间：2008-12-19T11:33:06.650
> 
> 标签：python, parsing, dictionary, struct, nested

我有嵌套字典：

```
{'key0': {'attrs': {'entity': 'p', 'hash': '34nj3h43b4n3', 'id': '4130'},
          u'key1': {'attrs': {'entity': 'r',
                              'hash': '34njasd3h43b4n3',
                              'id': '4130-1'},
                    u'key2': {'attrs': {'entity': 'c',
                                        'hash': '34njasd3h43bdsfsd4n3',
                                        'id': '4130-1-1'}}},
          u'key3': {'attrs': {'entity': 'r',
                              'hash': '34njasasasd3h43b4n3',
                              'id': '4130-2'},
                    u'key4': {'attrs': {'entity': 'c',
                                        'hash': '34njawersd3h43bdsfsd4n3',
                                        'id': '4130-2-1'}},
                    u'key5': {'attrs': {'entity': 'c',
                                        'hash': '34njawersd3h43bdsfsd4n3',
                                        'id': '4130-2-2'}}}},
 'someohterthing': 'someothervalue',
 'something': 'somevalue'} 
```

给定一个`id` - 之一。 导航到正确字典的最简单方法是什么？`ids``4130``4130-2-2`

如果给定`id`的是，`4130-2-1`那么它应该到达字典`key=key5`。

请不要使用 XML 方法。

**编辑（1）：**嵌套在`1`级别之间`4`，但我在解析之前知道嵌套。

**编辑（2）**：修复了代码。

**编辑（3）**：再次修复了字符串值的代码`ids`。请原谅造成的混乱。我希望这是最终的:)

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-19T12:45:28.827

你的结构非常不规则。这是一个带有遍历子字典的**访问者**函数的版本。`attrs`

```
def walkDict( aDict, visitor, path=() ):
    for  k in aDict:
        if k == 'attrs':
            visitor( path, aDict[k] )
        elif type(aDict[k]) != dict:
            pass
        else:
            walkDict( aDict[k], visitor, path+(k,) )

def printMe( path, element ):
    print path, element

def filterFor( path, element ):
    if element['id'] == '4130-2-2':
        print path, element 
```

你会像这样使用它。

```
walkDict( myDict, filterFor ) 
```

这可以变成生成器而不是**访问者**；它不会`yield path, aDict[k]`调用访问者函数。

你会在 for 循环中使用它。

```
for path, attrDict in walkDictIter( aDict ):
    # process attrDict... 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-12-19T11:44:56.887

如果您想以一般方式解决问题，无论您的 dict 中有多少级嵌套，都可以创建一个遍历树的递归函数：

```
def traverse_tree(dictionary, id=None):
    for key, value in dictionary.items():
        if key == 'id':
            if value == id:
                print dictionary
        else:
             traverse_tree(value, id)
    return

>>> traverse_tree({1: {'id': 2}, 2: {'id': 3}}, id=2)
{'id': 2} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-19T13:37:03.527

这类问题通常通过适当的类定义而不是通用字典更好地解决。

```
class ProperObject( object ):
    """A proper class definition for each "attr" dictionary."""
    def __init__( self, path, attrDict ):
        self.path= path
        self.__dict__.update( attrDict )
    def __str__( self ):
        return "path %r, entity %r, hash %r, id %r" % (
            self.path, self.entity, self.hash, self.id )

masterDict= {} 
def builder( path, element ):
    masterDict[path]= ProperObject( path, element )

# Use the Visitor to build ProperObjects for each "attr"
walkDict( myDict, builder )

# Now that we have a simple dictionary of Proper Objects, things are simple
for k,v in masterDict.items():
    if v.id == '4130-2-2':
        print v 
```

此外，既然您有正确的对象定义，您可以执行以下操作

```
# Create an "index" of your ProperObjects
import collections
byId= collections.defaultdict(list)
for k in masterDict:
    byId[masterDict[k].id].append( masterDict[k] )

# Look up a particular item in the index
print map( str, byId['4130-2-2'] ) 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-05-12T13:46:28.663

这是一个老问题，但仍然是谷歌的顶级结果，所以我会更新：

我和一个朋友发布了一个库来解决（非常接近）这个确切的问题。dpath-python（与执行类似操作的 perl dpath 模块无关）。

[http://github.com/akesterson/dpath-python](http://github.com/akesterson/dpath-python)

您需要做的就是这样的：

```
$ easy_install dpath
>>> import dpath.util
>>> results = []
>>> for (path, value) in dpath.util.search(my_dictionary, "*/attrs/entity/4130*", yielded=True):
>>> ... parent = dpath.util.search("/".join(path.split("/")[:-2])
>>> ... results.append(parent) 
```

...这将为您提供与您的搜索匹配的所有字典对象的列表，即所有具有 (key = 4130*) 的对象。父位有点笨拙，但它会起作用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-05-09T15:41:51.130

由于已知递归在 python 中是有限的（请参阅 [Python 中的最大递归深度是多少，以及如何增加它？](https://stackoverflow.com/questions/3323001/maximum-recursion-depth)）我宁愿对这个问题有一个基于循环的答案，所以答案可以适应任何深度级别在字典里。为此，函数

```
def walkDict( aDict, visitor, path=() ):
    for  k in aDict:
        if k == 'attrs':
            visitor( path, aDict[k] )
        elif type(aDict[k]) != dict:
            pass
        else:
            walkDict( aDict[k], visitor, path+(k,) ) 
```

可以替换为：

```
def walkDictLoop(aDict, visitor, path=()):
    toProcess = [(aDict, path)]
    while toProcess:
        dictNode, pathNode = toProcess.pop(0)
        for k in dictNode:
            if k == 'attrs':
                visitor(pathNode, dictNode[k])
            if isinstance(dictNode[k], dict):
                toProcess.append( (dictNode[k], pathNode+(k,)) ) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-19T11:43:22.210

好吧，如果你只需要做几次，你可以使用嵌套的 dict.iteritems() 来找到你要找的东西。

如果你打算做几次，性能很快就会成为一个问题。在这种情况下，您可以：

*   将您的数据返回给您的方式更改为更合适的方式。

*   如果不能，将数据转换为 id 和键之间的字典（使用 iteritems）。然后使用它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-01-16T11:30:55.030

我相信 pydash 会给你最有效的方法来实现这一点。

例如：

```
data = {'a': {'b': {'c': [0, 0, {'d': [0, {1: 2}]}]}}, 'names': {'first': 'gus', 'second': 'parvez'}}

pydash.get(data, 'a.b.c.2.d.1.[1]')

# output: 2 
```

您可以在此处找到详细文档： [https ://pydash.readthedocs.io/en/latest/quickstart.html](https://pydash.readthedocs.io/en/latest/quickstart.html)

# ruby - 如何强制 Ruby 显示完整的堆栈跟踪？

> ID：380744
> 
> 赞同：48
> 
> 时间：2008-12-19T11:36:22.527
> 
> 标签：ruby, stack-trace

我刚刚收到此错误消息：

```
...
from c:/ruby/lib/ruby/gems/1.8/gems/...
 ... 10 levels...
from c:/ruby/lib/ruby/gems/1.8/gems/...
... 
```

并且错误（当然）隐藏在`... 10 levels...`.

如何强制 Ruby 显示完整的堆栈跟踪？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-12-19T11:37:17.143

```
begin
  # Code that raises exception
rescue StandardError => e
  puts e.backtrace
end 
```

# c# - 一个通用的单例

> ID：380755
> 
> 赞同：19
> 
> 时间：2008-12-19T11:41:03.153
> 
> 标签：c#, singleton, generics

对于普通的单身人士，你们怎么看？

```
using System;
using System.Reflection;

// Use like this
/*
public class Highlander : Singleton<Highlander>
{
    private Highlander()
    {
        Console.WriteLine("There can be only one...");
    }
}
*/

public class Singleton<T> where T : class
{
    private static T instance;
    private static object initLock = new object();

    public static T GetInstance()
    {
        if (instance == null)
        {
            CreateInstance();
        }

        return instance;
    }

    private static void CreateInstance()
    {
        lock (initLock)
        {
            if (instance == null)
            {
                Type t = typeof(T);

                // Ensure there are no public constructors...
                ConstructorInfo[] ctors = t.GetConstructors();
                if (ctors.Length > 0)
                {
                   throw new InvalidOperationException(String.Format("{0} has at least one accesible ctor making it impossible to enforce singleton behaviour", t.Name));
                }

                // Create an instance via the private constructor
                instance = (T)Activator.CreateInstance(t, true);
            }
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-19T11:45:13.627

创建一个单例类只需要几行代码，并且很难制作一个通用的单例，我总是编写这些代码行。

```
public class Singleton
{
    private Singleton() {}
    static Singleton() {}
    private static Singleton _instance = new Singleton();
    public static Singleton Instance { get { return _instance; }}
} 
```

这

```
private static Singleton _instance = new Singleton(); 
```

行消除了对锁定的需要，因为静态构造函数是线程安全的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-19T11:43:31.617

好吧，它并不是真正的单例——因为你无法控制`T`，所以可以有尽可能多的`T`实例。

（删除了线程竞争；注意了双重检查的用法）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-19T11:50:39.763

我已经删除了我之前的答案，因为我没有注意到检查非公共构造函数的代码。但是，这是仅在执行时执行的检查 - 没有*编译时*检查，这是对它的打击。它还依赖于有足够的访问权限来调用非公共构造函数，这增加了一些限制。

此外，它不禁止*内部*构造函数——所以你最终可以得到非单例。

为了简单的线程安全，我个人也会在静态构造函数中创建实例。

基本上我不是很喜欢——创建单例类很容易，而且你不应该经常这样做。单例对于测试、解耦等来说是一种痛苦。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-10-25T15:57:16.527

这是我使用 .NET 4 的观点

```
public class Singleton<T> where T : class, new()
    {
        Singleton (){}

        private static readonly Lazy<T> instance = new Lazy<T>(()=> new T());

        public static T Instance { get { return instance.Value; } } 
    } 
```

它的使用如下：

```
 public class Adaptor
   {
     public static Adaptor Instance { get { return Singleton<Adaptor>.Instance;}}
   } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-03-20T02:17:29.997

合并 AndreasN 答案和 Jon Skeet 的“[第四版 - 不那么懒惰，但不使用锁的线程安全](http://csharpindepth.com/Articles/General/Singleton.aspx#nested-cctor)”的 Singleton c# 实现，为什么不使用代码片段来完成所有艰苦的工作：

```
<CodeSnippets xmlns="http://schemas.microsoft.com/VisualStudio/2005/CodeSnippet">
    <CodeSnippet Format="1.0.0">
        <Header>
            <Title>Singleton Class</Title>
            <Author>TWSoft</Author>
            <Description>Generates a singleton class</Description>
            <SnippetTypes>
                <SnippetType>Expansion</SnippetType>
            </SnippetTypes>
            <Keywords>
                <Keyword>Singleton</Keyword>
            </Keywords>
            <Shortcut>singleton</Shortcut>
        </Header>
        <Snippet>
            <Declarations>
                <Literal>
                    <ID>ClassName</ID>
                    <ToolTip>Replace with class name</ToolTip>
                    <Default>MySingletonClass</Default>
                </Literal>
            </Declarations>

            <Code Language="CSharp">
                <![CDATA[
                public class $ClassName$
                {
                    #region Singleton
                    static readonly $ClassName$ mInstance = new $ClassName$();

                    // Explicit static constructor to tell C# compiler
                    // not to mark type as beforefieldinit
                    static $ClassName$()
                    {
                    }

                    private $ClassName$()
                    {
                    }

                    public static $ClassName$ Instance
                    {
                        get { return mInstance; }
                    }
                #endregion
                }
                ]]>
            </Code>
        </Snippet>
    </CodeSnippet>
</CodeSnippets> 
```

然后您可以将其保存到 .snippt 文件中，并将其添加到 VS IDE（工具->代码片段管理器）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-08-17T09:57:16.190

使用泛型对单例没有用。因为您始终可以创建类型参数 T 的多个实例，然后根据定义它**不是**单例。

看这个：

```
public sealed class Singleton<T> where T : class, new()
{
    private static readonly Lazy<T> instance = new Lazy<T>(() => new T());
    public static T Instance => instance.Value;
    private Singleton() { }
} 
```

当你像这样使用它时

```
public class Adapter
{
    public static Adapter Instance => Singleton<Adapter>.Instance; 
    // private Adapter(){ } // doesn't compile.
} 
```

您仍然可以自己创建适配器，只需调用

```
new Adapter(); 
```

将私有构造函数添加到 Adapter 会破坏代码。请注意，此适配器使用组合而不是继承。即它不是一个单例它有一个单例。如果某物是单例，它应该派生自或实现一个接口。

```
public abstract class Singleton<T> 
{
    protected static Lazy<T> instance;
    public static T Instance => instance.Value;
}

public sealed class Adapter : Singleton<Adapter>
{
    static Adapter()
    {
        instance = new Lazy<Adapter>(() => new Adapter());
    }

    private Adapter() { }
} 
```

基本上这只会将静态字段移动到通用基类中，而它不再是只读的，因此可以在初始化后进行更改。它还要求您记住添加私有构造函数，将其标记为密封并执行一些初始化，因此它仍然没有很好地封装并且容易出错。

我们可以通过在基本构造函数中添加检查来改进这一点。

```
public abstract class Singleton<T> where T : Singleton<T>, new()
{
    private static bool instantiated;
    private static readonly Lazy<T> instance = new Lazy<T>(() => new T());
    public static T Instance => instance.Value;
    protected Singleton()
    {
        if (instantiated)
            throw new Exception();
        instantiated = true;
    }
}

public /* sealed */ class Adapter : Singleton<Adapter>
{
} 
```

由于 Singleton 是惰性的，模式仍然被破坏。

```
 new Adapter(); // this works
  Adapter.Instance; // this throws an error. 
```

还

```
 Adapter.Instance; // this works
  // just running in production someone decided to call:
  new Adapter(); // this throws an error 
```

此类错误只能在测试期间检测到。

我仍然更喜欢直接使用该模式，它基本上只有 3 行代码，并且在编译时是安全的。此外，当您需要不同的基类但仍需要惰性单例并要求它是真正的单例时，存在一个简单的解决方案：（请参阅：[http](http://csharpindepth.com/Articles/General/Singleton.aspx) ://csharpindepth.com/Articles/General/Singleton.aspx ）

```
public sealed class Adapter
{
    private static readonly Lazy<Adapter> instance = new Lazy<Adapter>(() => new Adapter());
    public static Adapter Instance { get { return instance.Value; } }
    private Adapter() { }
} 
```

您不能将其正确地重构为不能像上面研究的方法那样被滥用的通用单例。

# vb.net - Microsoft Office PIA 以及如何从 WebApp 正确引用和构建

> ID：380766
> 
> 赞同：2
> 
> 时间：2008-12-19T11:44:21.070
> 
> 标签：vb.net, msbuild, teamcity, office-pia

我目前正在尝试在使用 Microsoft.Office.Interop dll 的 TeamCity 上进行构建。当我安装了 Office 时，这将在本地构建和工作正常，但是当尝试在 TeamCity 上构建它时它会失败，因为它没有参考。

我无法安装 PIA 可分发软件，因为我收到一条错误消息，指出需要安装 Office 2003。我不想在服务器上安装 Office。

有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-19T19:53:25.467

如果 teamcity 服务器所做的只是构建，则将 Microsoft.Office.Interop DLL 添加到项目的 References 文件夹中，然后将项目配置为在该引用文件夹中查找。

但是，如果 TeamCity 服务器也在运行使用 Office Interop 的测试，那么除非您在运行测试的计算机上安装了 Office，否则您将遇到问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T12:48:40.363

并非如此 - Interop dll 只是您的 .NET 代码和实际 (COM) Office 代码之间的一个 thunk 层。如果您有 Interop dll 而没有基础 Office dll，那么对 Interop 的任何调用都将失败，因为 Interop 将要调用它使可互操作的 COM 对象。

这些 COM 对象是 Office 对象，因此您需要安装 Office 的某些部分。

# encryption - 使用可导出的密钥提供程序加密外部存储的应用程序块

> ID：380772
> 
> 赞同：0
> 
> 时间：2008-12-19T11:46:43.313
> 
> 标签：encryption, enterprise-library, aspnet-regiis.exe

我已经尝试了很长一段时间来弄清楚如何加密存储在名为 dev_entlib.config 的外部文件中的应用程序块

我可以在 entlib (4.1) 中看到可以使用默认保护提供程序来加密块，但是，我确实需要在不同的服务器上部署这个应用程序，因此我需要将用于加密应用程序块的 keyProvider 导出到那些服务器。

到目前为止，我所做的是将自定义受保护的配置提供程序添加到 .net v2.0* 任何文件夹（以及所有目标服务器）中的 machine.config 文件中

自定义提供者是这样的

```
<add name="MyCompanyProvider" 
    type="System.Configuration.RsaProtectedConfigurationProvider, 
          System.Configuration, Version=2.0.0.0, Culture=neutral, 
          PublicKeyToken=b03f5f7f11d50a3a,
         processorArchitecture=MSIL"
    keyContainerName="MyKey" 
    useMachineContainer="true" /> 
```

它很好地位于其他默认提供程序旁边，甚至在 Entlib 配置工具中具有设计时支持。然后，我为要加密的每个块选择保护提供程序。

查看 dev_entlib.config，表明该块确实是用我的提供者加密的。我的提供者使用我的密钥容器。因此，应该使用我的密钥容器对块进行加密。然后我使用以下方法将“MyKey”导出到 xml 文件：

```
c:\Windows\Microsoft.NET\Framework\v2.0.50727>aspnet_regiis.exe -px "MyKey" "C:\keys.xml" -pri
Exporting RSA Keys to file...
Succeeded! 
```

然后将此密钥文件复制到我的 sysTest 服务器，并在该服务器中导入并授予“NT Authority\Network Services”和“ASPNET”访问权限

然后我复制我的加密 web.config 和 dev_entlib.config 并尝试在一个小页面中显示连接字符串，该页面使用 .net ConfigurationManager 获取 ConnectionStrings 集合并将它们显示在页面上。此页面在 IIS 下运行，进程标识为“NT Authority\Network Services”。

问题是，它不起作用！存在错误数据错误或“无法使用提供程序 MyCompanyProvider 解密”。

这种方法对我来说似乎合乎逻辑，但它仍然失败。

有人有其他建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-11-09T00:22:58.443

## 使用企业库配置工具，使用您的自定义 RSA 密钥容器加密外部企业库配置文件。

*   EntLib (4.1) 使用默认保护提供程序*RsaProtectedConfigurationProvider*。但是可以在您的配置文件中删除此提供程序并将其替换为您自己的同名提供程序，然后可以指向您的自定义密钥提供程序：“ *MyKey* ”。
*   您应该将这个*configProtectedData*部分添加到具有您要加密的区域的配置文件中（例如，您的外部文件：*dev_entlib.config*）。您根本不需要修改*machine.config*文件。
*   然后，您可以从企业库配置应用程序中为*数据访问应用程序块*保护提供程序选择*RsaProtectedConfigurationProvider 。*
**   如果您使用的是 Vista、Windows 7、Windows 2008，则必须 使用*以管理员身份运行*打开此*EntLibConfig.exe 。* **   否则会报错：
        *   `Failed to encrypt the section 'connectionStrings' using provider 'RsaProtectedConfigurationProvider'. Error message from the provider: Object already exists.`* **   然后，您可以将此加密的 *dev_entlib.config* 与*web.config*配置文件一起复制到您的*sysTest*服务器。*在该sysTest*服务器上使用 Enterprise Library Configuration 工具打开*web.config文件***不应**出现错误： ****   `Failed to decrypt using provider 'RsaProtectedConfigurationProvider'. Error message from the provider: Bad Data.`***** 

 *****### 网络配置

这个文件几乎是空的，只是指向外部数据配置文件：

```
<!-- web.config -->
<configuration>
  <configSections>
    <section name="enterpriseLibrary.ConfigurationSource" type="Microsoft.Practices.EnterpriseLibrary.Common.Configuration.ConfigurationSourceSection, Microsoft.Practices.EnterpriseLibrary.Common, Version=4.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
  </configSections>
  <enterpriseLibrary.ConfigurationSource selectedSource="External Data Configuration File Source">
    <sources>
      <add name="External Data Configuration File Source" type="Microsoft.Practices.EnterpriseLibrary.Common.Configuration.FileConfigurationSource, Microsoft.Practices.EnterpriseLibrary.Common, Version=4.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
        filePath="dev_entlib.config" />
    </sources>
  </enterpriseLibrary.ConfigurationSource>
</configuration> 
```

### dev_entlib.config

此文件具有连接字符串和应使用以下加密的保护提供程序：

```
<!-- dev_entlib.config -->
<configuration>
    <configSections>
        <section name="dataConfiguration" type="Microsoft.Practices.EnterpriseLibrary.Data.Configuration.DatabaseSettings, Microsoft.Practices.EnterpriseLibrary.Data, Version=4.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
 </configSections>
    <dataConfiguration defaultDatabase="MyConnectionStringName" />
 <connectionStrings>
  <add name="cnHnicMediaLibrary" connectionString="Server=MyDbServer; Database=MyDbName; Integrated Security=SSPI"
   providerName="System.Data.SqlClient" />
 </connectionStrings>
  <configProtectedData>
    <providers>
      <remove name="RsaProtectedConfigurationProvider" />
      <add    name="RsaProtectedConfigurationProvider"
        keyContainerName="MyKey"
        useMachineContainer="true"
        description="Uses our own encryption key container so that it will work in a Web Farm setting. We need to trick Enterprise Library, which wants to use the default RsaCryptoServiceProvider to encrypt and decrypt, by replacing this default provider with our own while this configuration is processed!"
        type="System.Configuration.RsaProtectedConfigurationProvider, System.Configuration, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
    </providers>
  </configProtectedData>
</configuration> 
```

### 基于：

*   [http://entlib.codeplex.com/discussions/237555（AvanadeSupport，2010](http://entlib.codeplex.com/discussions/237555)年 12 月 8 日晚上 11:37）
*   [http://entlib.codeplex.com/discussions/10300（shane2007，2007](http://entlib.codeplex.com/discussions/10300)年 7 月 9 日下午 1:15）
*   [http://entlib.codeplex.com/discussions/213998](http://entlib.codeplex.com/discussions/213998)（需要将版本改回2.0.0.0）

我希望这描述了您收到的错误消息以及如何修复它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T12:03:50.963

这似乎还不可能。我的解决方案是将块加密为 web.config 的一部分，然后将这些块复制并粘贴到外部 entLib.config 文件中。然后应该能够使用导出的密钥在目标服务器上解密这些块。

# php - PHP正则表达式用链接替换单词

> ID：380773
> 
> 赞同：0
> 
> 时间：2008-12-19T11:46:47.510
> 
> 标签：php, regex

我有一种情况，我解析一段文本并用链接替换某些短语。然后我需要重新解析字符串以用链接替换第二组短语。问题出现在这一点上，第二组中的某些单词或短语可能是第一遍中已经替换的短语的子串。

**示例**：字符串“blah blah grand canyon blah `<a href="#">grand canyon</a>`”在第一次传递后将变为“blah blah blah”。第二遍可能会尝试用链接替换单词“canyon”，因此生成的破碎文本将显示为：“blah blah `<a href="#">`grand `<a href="#">`canyon `</a></a>`blah”。

所以我一直在尝试使用 preg_replace 和正则表达式来防止嵌套`<a>`标签的出现——只替换链接中没有的文本。我试图根据文本中是否还有`</a>`标签来检查正则表达式，但无法使它们起作用。

也许需要另一种方法？

提前谢谢了！戴夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T12:27:26.757

这可能适用于所有通行证：

```
$string = preg_replace('/([^>]|^)grand canyon\b/','$1<a href=#>grand canyon</a>',$string); 
```

编辑：假设当文本包含“amazonas>grand canyon”之类的内容时，您可以承受丢失

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T13:42:21.753

对于第二遍，您可以使用正则表达式，例如：

```
(<a[^>]*>.*?</a>)|grand 
```

此正则表达式匹配链接或单词“grand”。如果链接匹配，则将其捕获到第一个（也是唯一的）捕获组中。如果组匹配，只需重新插入现有链接。如果grand 这个词匹配，你知道它在一个链接之外，你可以把它变成一个链接。

在 PHP 中，您可以使用 preg_replace_callback 执行此操作：

```
$result = preg_replace_callback('%(<a[^>]*>.*?</a>)|grand%', compute_replacement, $subject);

function compute_replacement($groups) {
    // You can vary the replacement text for each match on-the-fly
    // $groups[0] holds the regex match
    // $groups[n] holds the match for capturing group n
    if ($groups[1]) {
        return $groups[1];
    } else {
        return "<a href='#'>$groups[0]</a>";
} 
```

# c# - 如何限制 NHibernate 的 GetByCriteria 拉回的结果集？

> ID：380775
> 
> 赞同：3
> 
> 时间：2008-12-19T11:49:31.090
> 
> 标签：c#, nhibernate, criteria, resultset, restriction

我有一个 NHibernate Dao..let 称它为 MyClassDao，因为需要一个更好的名字。

我正在编写以下代码。

```
MyClassDao myDao = new MyClassDao();

var values = myDao.GetByCriteria(Restrictions.Eq("Status", someStatusValue)); 
```

我在单元测试中使用它来从数据库中提取值。但是，运行测试需要 30 多秒，这在我看来太长了……所以我想做的是将被拉回的结果集限制为……比如说大约 5 个值。

在 sql 我会做类似下面的事情来实现这样的事情

```
set rowcount 5
select * from whatever_table
set rowcount 0 
```

有没有办法...不使用 NHibernate 查询语言来限制结果集的大小？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-19T11:57:21.420

使用 ICriteria.SetMaxResults()

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-19T11:57:48.000

您可以在 IQuery（如果您使用 HQL）或 ICriteria（如果您使用标准 API）上使用 SetMaxResults 方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-02-21T04:37:14.623

我的存储库中有类似的东西来帮助处理未绑定的结果集

```
public IQueryable<T> SelectWithLimit<T>(int maxResults) where T : class
    {
        ICriteria criteria = SessionWrapper.Session.CreateCriteria(typeof (T)).SetMaxResults(maxResults);
        return criteria.List<T>().AsQueryable();

    } 
```

# php - 使用 Doctrine (DQL) 在 Self 上加入表

> ID：380776
> 
> 赞同：2
> 
> 时间：2008-12-19T11:49:39.127
> 
> 标签：php, mysql, doctrine, dql

我正在尝试使用教义的 DQL 加入自己的表。场景是：

我有一个产品属性值表，它通过参考表链接到产品表。产品属性值将用作产品的过滤器，因此，产品属性值表需要连接回自身以过滤多个属性。

我的方法如下：

```
public static function getProductsByCategoryCode($productCategoryCode, $currencyCode, Zend_Session_Namespace $filters = null)
{
    $products = Doctrine_Query::create()
        ->from('Products p')
        ->leftJoin('p.ProductCategories pc')
        ->leftJoin('p.ProductPrices pp')
        ->leftJoin('pp.Currencies c')
        ->where('pc.product_category_code = '. $productCategoryCode)
        ->addWhere('c.currency_code = "'. $currencyCode . '"');

    if($filters !== null)
    {   
        $i = 0;

        foreach($filters as $index => $value)
        {
            $alias = 'pav_' . (string)$i;

            $products
                ->leftJoin('p.ProductAttributeValues ' . $alias)
                ->addWhere($alias . '.product_attribute_code = "'. $index . '"')
                ->addWhere($alias . '.value = "'. $value . '"');

            $i++;
        }
    }

    die($products->getSql());

    return $products->execute();
} 
```

问题是从`getSql()`调用中获得的结果 SQL 对产品属性值链接表有重复的别名（MySQL 错误：）`#1066 - Not unique table/alias: 'p6'`。据推测，这是由于产品和产品属性值之间的引用关系（产品属性值链接）被重用。

生成的 SQL 为：

```
SELECT 
p.product_code AS p__product_code, 
p.name AS p__name, 
p.description AS p__description, 
p2.product_category_code AS p2__product_category_code, 
p2.name AS p2__name, 
p2.category_route AS p2__category_route, 
p2.parent_product_category_code AS p2__parent_product_category_code, 
p2.lft AS p2__lft, 
p2.rgt AS p2__rgt, 
p2.level AS p2__level, 
p4.currency_code AS p4__currency_code, 
p4.product_code AS p4__product_code, 
p4.net_value AS p4__net_value, 
c.currency_code AS c__currency_code, 
p5.product_attribute_value_id AS p5__product_attribute_value_id, 
p5.product_attribute_code AS p5__product_attribute_code, 
p5.value AS p5__value, 
p7.product_attribute_value_id AS p7__product_attribute_value_id,
p7.product_attribute_code AS p7__product_attribute_code, 
p7.value AS p7__value 
FROM 
products p 
LEFT JOIN 
product_category_links p3 ON p.product_code = p3.product_code 
LEFT JOIN 
product_categories p2 ON p2.product_category_code = p3.product_category_code 
LEFT JOIN 
product_prices p4 ON p.product_code = p4.product_code 
LEFT JOIN 
currencies c ON p4.currency_code = c.currency_code 
LEFT JOIN 
product_attribute_value_links p6 ON p.product_code = p6.product_code 
LEFT JOIN 
product_attribute_values p5 ON 
p5.product_attribute_value_id = p6.product_attribute_value_id 
LEFT JOIN 
product_attribute_value_links p6 ON p.product_code = p6.product_code 
LEFT JOIN 
product_attribute_values p7 ON 
p7.product_attribute_value_id = p6.product_attribute_value_id 
WHERE 
p2.product_category_code = 10100 
AND 
c.currency_code = "GBP" 
AND 
p5.product_attribute_code = "BRAND" 
AND 
p5.value = "Advanced Hair Gear" 
AND 
p7.product_attribute_code = "SIZE" AND p7.value = "238 ml" 
```

如您所见，P6 作为别名出现了两次。

有人知道使用 DQL 实现此目的的正确方法吗？

提前谢谢了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-14T03:28:25.217

我不知道是否有更简单的解决方案，但您应该能够自己指定连接：

```
 ->leftJoin('p.ProductAttributeValuesLinks ' . $alias1)
        ->leftJoin($alias1 '.ProductAttributeValue ' . $alias2) 
```

如果您在链接表上设置如下内容：

```
 relations:
    Product:
      class: Products
      foreignType: many
    ProductAttributeValue:
      class: ProductAttributeValues
      foreignType: many 
```

# visual-c++ - 遍历 MFC CComboBox 的项目

> ID：380784
> 
> 赞同：4
> 
> 时间：2008-12-19T11:57:08.453
> 
> 标签：visual-c++, mfc

我需要遍历 CComboBox 中的项目（字符串）以检查哪个字符串最长。如何获取列表中的每个项目？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-19T12:00:48.277

试试 GetLBTextLen() 函数

这是[来自 MSDN 的示例](http://msdn.microsoft.com/en-us/library/zcy9kze7(VS.80).aspx)：

```
// Dump all of the items in the combo box.
   CString str, str2;
   int n;
   for (int i=0;i < pmyComboBox->GetCount();i++)
   {
      n = pmyComboBox->GetLBTextLen( i );
      pmyComboBox->GetLBText( i, str.GetBuffer(n) );
      str.ReleaseBuffer();

      str2.Format(_T("item %d: %s\r\n"), i, str.GetBuffer(0));
      afxDump << str2;
   } 
```

# asp.net - 架构评论：将 SQL Server FOR XML 转换为 XSLT 以实现富 HTML 接口

> ID：380789
> 
> 赞同：0
> 
> 时间：2008-12-19T11:57:53.867
> 
> 标签：asp.net, sql-server, xslt, architecture, for-xml

我能得到一些关于以下架构的建设性反馈吗？

**简化架构总结：**

*从 SQL Server 返回 XML（使用 FOR XML）并将其直接传递到 XSL 转换中以生成丰富的 HTML 网站。*

与传统的 3 层 ASP.NET 体系结构相比，这种系统的优缺点是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-19T12:23:05.220

我们已经做过这样的事情。它适用于非常简单的页面。但是，一旦您想包含一些客户端 javascript 和类似内容，您就注定要失败。

生成的输出隐藏在 XSLT 样式表中，很难阅读、维护和修复错误。

可以进行测试，但也比以前付出了更多的努力。

MVC 模式和类似模式更适合这种情况。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T12:12:44.367

两个缺点。

1.  使用 C# 或 VB.net 进行数据操作变得更加困难，因为您没有具有属性的类（代码智能感知）而是 xml 文档。

2.  有用于数据输入验证的内置 asp.net 控件（客户端和服务器端）。如果您使用 XSLT 生成 HTML 页面，则不能使用它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-20T11:30:30.817

我在一个项目中做过类似的事情。我发现该架构非常干净且可扩展，但我建议您仅在您碰巧在内部拥有大量 XSLT 专业知识时才使用它。

我们有一些 XSLT 模板和一个使用 XSLT 参数执行转换的通用 c# 类。我们获得了非常好的性能，但对于新开发人员来说，该应用程序可能难以维护。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T14:13:34.513

一位专业人士：

1.  您可以制作为浏览器生成 HTML 或为 WPF/Silverlight 生成 XAML 的 XSLT 模板。

# asp.net-mvc - 使用 ModelBinder 通过 ID 获取对象

> ID：380792
> 
> 赞同：0
> 
> 时间：2008-12-19T11:59:57.263
> 
> 标签：asp.net-mvc

我有多个需要 id 的控制器操作

```
public ActionResult Get(int? id) {
...
}

public ActionResult Delete(int id) {
...
}

public JsonResult GetJson(int? id) {
...
} 
```

我正在考虑在每个操作上使用 ModelBinder (SomeObjectFromIDModelBinder) 的最佳实践，因此对象的获取与控制器分离，并使操作方法更小。

我不希望它被称为 SomeObjectModelBinder 的原因是因为我还需要从 JSON 重新创建模型，所以有一个 SomeObjectFromJsonModelBinder 来处理从 JSON 字符串重新创建“SomeObject”。

我认为这是 ModelBinders （命名约定）的合适用法，但只是想澄清一下。想法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-19T21:41:03.097

您无需执行任何操作即可获取 ID。MVC 处理程序将在表单数据、查询字符串和路由中查找与方法参数同名的简单值。所以你可以有一个路由/{controller}/{action}/{id}，默认为action="Get"，id=1。那么 id 可以在 URL 中指定为 /Home/Get/3 或 /Home/Delete?id=6。

或者，您可以有一个 id 为“id”的文本框和一个提交到“/Home/Get”的表单中的提交按钮。

ModelBinders 旨在允许您通过创建实例并从表单数据、查询字符串或路由数据填充属性来拥有作为类的操作方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T12:47:32.813

我已经决定按照我的要求去做，并且拥有多个将不同数据绑定到模型的 ModelBinders 是可以接受的。

# c++ - Dev C++编译的exe信息

> ID：380796
> 
> 赞同：0
> 
> 时间：2008-12-19T12:01:01.847
> 
> 标签：c++, ide

当我在 Dev C++ 中编译我的项目时，如何获取显示在 windows 中 exe 属性的摘要页面上的信息？

我尝试在项目属性中使用“版本信息”选项卡，但没有成功。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T12:16:14.033

您需要将资源与其中具有 VERSION 信息结构的 .exe 相关联。这也是用于将图标与应用程序关联的相同机制。

# windows - x86：当一个特定的指向字符串的指针被压入堆栈时可能调试中断？

> ID：380798
> 
> 赞同：1
> 
> 时间：2008-12-19T12:02:15.217
> 
> 标签：windows, debugging, x86, windbg, disassembly

我正在调试一个我没有源代码的第三方 DLL。此 DLL 维护一个字符串池。我想捕获这些字符串之一被传递给函数的最早出现......任何函数......

换句话说，我想检测具有某种格式的指向空终止字符串的指针何时被任何人推入堆栈......并且我想在发生这种情况时执行调试中断。

我知道您可以设置一个“访问中断”断点，该断点将在 CPU 读取/写入/执行特定地址时触发。我想要的是类似于这样：对于每个压入堆栈的字符串，我想针对某种格式对其进行测试，如果匹配，则执行中断。

使用 WinDbg、OllyDb、VS2008 等等……有什么想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T14:12:54.733

我会说这对您的要求是不可能的：

> 我想检测一个指向空终止字符串的指针何时具有某种格式

**正如前面的答案所说，一旦断点命中**，您就可以将字符串与任何内容匹配

 **> 我想捕获这些字符串之一被传递给函数的最早出现......任何函数......我想要的类似于：对于推入堆栈的每个字符串，我想对其进行测试某种格式，如果匹配，则执行中断。

因此，您需要的是检测何时使用堆栈上的特定指针参数调用任何函数 - 这是“不可能”的部分。理论上有多种方法可以做到这一点，但它们会很慢而且很复杂......如果函数获得一个指向具有您正在跟踪的值的指针的指针，或者包含该指针的数组......

你想达到什么目的？为什么你需要首先将字符串传递给函数的地方？字符串的使用是最重要的，正如您所知，您可以使用简单的内存访问断点来打破它（如果曾经复制过字符串，请添加另一个断点）。

我建议您采用另一种方法，使用反汇编程序并通过一些调试进行更多静态分析，以获得您需要的内容......

# c# - 我如何知道您已登录 Sharepoint 网页？

> ID：380804
> 
> 赞同：3
> 
> 时间：2008-12-19T12:05:08.627
> 
> 标签：c#, .net, sharepoint, sharepoint-2007, moss

我们在工作中使用 Sharepoint 作为我们网页的 CMS。我知道如何创建只有在您使用以下方式登录 SharePoint 时才能看到的控件：

<Sharepoint:SPSecurityTrimmedControl ID="SPSecurityTrimmedControl1" runat="server" PermissionsString="AddAndCustomizePages"><br />
<Sharepoint:CssLink ID="CssLink1" runat="server"/><br />
</Sharepoint:SPSecurityTrimmedControl>

但我想知道如何根据权限以编程方式使控件可见（或其他）。

我不能使用 .NET windows 表单身份验证的方法，例如：

```
 if (!(HttpContext.Current.User == null) && HttpContext.Current.User.Identity.IsAuthenticated){} 
```

因为我们将它用于具有另一种登录类型的匿名用户。

你能提供一些代码吗？我知道它必须类似于验证 SPContext.Current.FormContext。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-19T17:48:03.443

用户是如何认证的？使用表单身份验证或 Windows/活动目录？

如果是活动目录，那么我认为在这种情况下您可能需要获取对当前 SPWeb 的引用，然后执行 web.CurrentUser.ID。当您匿名时，这可能会为空。如果没有，试试 web.SiteUsers.GetByID(web.CurrentUser.ID) 看看你得到了什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-28T16:03:11.540

[用户是否有权限](http://msdn.microsoft.com/en-us/library/ms456041.aspx)

您可以在当前网络上使用此方法来检查当前用户是否具有特定权限。

我假设您的经过身份验证的用户有一些权限来检查匿名人群是否被拒绝。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T02:25:20.447

虽然我没有测试过，但我想 SPUser 对象的 LoginName 属性会是空白的，或者抛出异常。

...当然，在与 SharePoint OM 打交道时假设任何事情都不安全 :(

# vb.net - msaccess.exe 在尝试释放对象时打开

> ID：380805
> 
> 赞同：0
> 
> 时间：2008-12-19T12:05:11.620
> 
> 标签：vb.net, ms-access

我正在使用以下代码打开一个在 vb.net 中受密码保护的 MS Access 数据库：

```
Try
   oDB = oDBEngine.OpenDatabase(Name:=strFullFileName, Options:=False, _
                               ReadOnly:=False, Connect:="")

Catch ex As Exception

   strError = "File is password protected."
   Exit Function

End Try 
```

但是在释放对象时 msaccess.exe 会自动打开。

```
 **System.Runtime.InteropServices.Marshal.ReleaseComObject(object)** 
```

谁能帮帮我，如何解决这个问题......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-19T12:24:17.853

与其使用 OpenDatabase 来获取错误，不如使用连接字符串？

```
cn.Open "Provider=Microsoft.Jet.OLEDB.4.0;" & _
       "Data Source=" & strFile & ";" & _
       "Persist Security Info=False" 
```

如果未提供密码，这也会出错。

# java - Java中的向下转型

> ID：380813
> 
> 赞同：196
> 
> 时间：2008-12-19T12:11:44.010
> 
> 标签：java, casting

Java 中允许向上转换，但是向下转换会产生编译错误。

编译错误可以通过添加强制转换来消除，但无论如何都会在运行时中断。

在这种情况下，如果 Java 不能在运行时执行，为什么它允许向下转换？
这个概念有什么实际用途吗？

```
public class demo {
  public static void main(String a[]) {
      B b = (B) new A(); // compiles with the cast, 
                         // but runtime exception - java.lang.ClassCastException
  }
}

class A {
  public void draw() {
    System.out.println("1");
  }

  public void draw1() {
    System.out.println("2");
  }
}

class B extends A {
  public void draw() {
    System.out.println("3");
  }
  public void draw2() {
    System.out.println("4");
  }
} 
```

* * *

## 回答 #1

> 赞同：320
> 
> 时间：2008-12-19T12:20:13.573

当有可能在运行时成功时，允许向下转换：

```
Object o = getSomeObject(),
String s = (String) o; // this is allowed because o could reference a String 
```

在某些情况下，这不会成功：

```
Object o = new Object();
String s = (String) o; // this will fail at runtime, because o doesn't reference a String 
```

当强制转换（例如最后一个）在运行时失败时，[`ClassCastException`](https://docs.oracle.com/javase/10/docs/api/java/lang/ClassCastException.html)将抛出 a。

在其他情况下，它将起作用：

```
Object o = "a String";
String s = (String) o; // this will work, since o references a String 
```

请注意，某些强制转换在编译时将被禁止，因为它们永远不会成功：

```
Integer i = getSomeInteger();
String s = (String) i; // the compiler will not allow this, since i can never reference a String. 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-19T13:08:04.350

使用您的示例，您可以执行以下操作：

```
public void doit(A a) {
    if(a instanceof B) {
        // needs to cast to B to access draw2 which isn't present in A
        // note that this is probably not a good OO-design, but that would
        // be out-of-scope for this discussion :)
        ((B)a).draw2();
    }
    a.draw();
} 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-12-19T12:21:46.503

我相信这适用于所有静态类型的语言：

```
String s = "some string";
Object o = s; // ok
String x = o; // gives compile-time error, o is not neccessarily a string
String x = (String)o; // ok compile-time, but might give a runtime exception if o is not infact a String 
```

类型转换有效地表示：假设这是对转换类的引用并按原样使用它。现在，让我们说 o**真的**是一个整数，假设这是一个字符串没有意义并且会给出意想不到的结果，因此需要进行运行时检查和异常来通知运行时环境出现问题。

在实际使用中，您可以编写代码处理更通用的类，但如果您知道它是什么子类并且需要将其视为子类，则将其转换为子类。一个典型的例子是重写 Object.equals()。假设我们有一个 Car 类：

```
@Override
boolean equals(Object o) {
    if(!(o instanceof Car)) return false;
    Car other = (Car)o;
    // compare this to other and return
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-19T15:41:19.220

我们都可以看到您提供的代码在运行时不起作用。那是因为我们知道表达式`new A()`永远*不可能*是 type 的对象`B`。

但这不是编译器所看到的。当编译器检查是否允许强制转换时，它只会看到：

```
variable_of_type_B = (B)expression_of_type_A; 
```

正如其他人所证明的那样，这种演员阵容是完全合法的。右边的表达式可以很好地计算为 type 的对象`B`。编译器看到它`A`并`B`具有子类型关系，因此使用代码的“表达式”视图，强制转换可能会起作用。

*当编译器确切地*知道什么对象类型`expression_of_type_A`将真正具有时，它不会考虑特殊情况。它只是将静态类型视为`A`并认为动态类型可以是`A`或 的任何后代`A`，包括`B`.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-19T14:17:45.613

> 在这种情况下，如果 Java 不能在运行时执行，为什么它允许向下转换？

我相信这是因为编译器无法在编译时知道强制转换是否成功。对于您的示例，很容易看出演员阵容会失败，但在其他时候并不那么清楚。

例如，假设类型 B、C 和 D 都扩展了类型 A，然后一个方法`public A getSomeA()`根据随机生成的数字返回 B、C 或 D 的实例。编译器无法知道此方法将返回哪个确切的运行时类型，因此如果您稍后将结果转换为`B`，则无法知道转换是否会成功（或失败）。因此编译器必须假设强制转换会成功。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-03-16T11:25:48.893

@原始海报 - 见内嵌评论。

```
public class demo 
{
    public static void main(String a[]) 
    {
        B b = (B) new A(); // compiles with the cast, but runtime exception - java.lang.ClassCastException 
        //- A subclass variable cannot hold a reference to a superclass  variable. so, the above statement will not work.

        //For downcast, what you need is a superclass ref containing a subclass object.
        A superClassRef = new B();//just for the sake of illustration
        B subClassRef = (B)superClassRef; // Valid downcast. 
    }
}

class A 
{
    public void draw() 
    {
        System.out.println("1");
    }

    public void draw1() 
    {
        System.out.println("2");
    }
}

class B extends A 
{
    public void draw() 
    {
        System.out.println("3");
    }

    public void draw2() 
    {
        System.out.println("4");
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-07-01T06:11:14.063

当我们处理一个向上转换的对象时，向下转换起作用。向上转换：

```
int intValue = 10;
Object objValue = (Object) intvalue; 
```

所以现在这个`objValue`变量总是可以被向下转换为，`int`因为被转换的对象是一个`Integer`，

```
int oldIntValue = (Integer) objValue;
// can be done 
```

但是因为`objValue`它是一个对象，所以它不能被转换为，`String`因为`int`不能被转换为`String`。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-10-13T04:57:29.570

在我一直使用的以下代码片段中，向下转换非常有用。从而证明向下转换是有用的。

```
private static String printAll(LinkedList c)
{
    Object arr[]=c.toArray();
    String list_string="";
    for(int i=0;i<c.size();i++)
    {
        String mn=(String)arr[i];
        list_string+=(mn);
    }
    return list_string;
} 
```

我将字符串存储在链接列表中。当我检索链接列表的元素时，会返回对象。要将元素作为字符串（或任何其他类对象）访问，向下转换对我有帮助。

Java 允许我们编译向下转换的代码，相信我们在做错事。尽管如此，如果人类犯了错误，它会在运行时被捕获。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-06-08T04:59:04.740

考虑下面的例子

```
public class ClastingDemo {

/**
 * @param args
 */
public static void main(String[] args) {
    AOne obj = new Bone();
    ((Bone) obj).method2();
}
}

class AOne {
public void method1() {
    System.out.println("this is superclass");
}
}

 class Bone extends AOne {

public void method2() {
    System.out.println("this is subclass");
}
} 
```

这里我们创建子类 Bone 的对象并将其分配给超类 AOne 引用，现在超类引用在编译时不知道子类中的方法 method2 即 Bone。因此我们需要将此超类的引用向下转换为子类引用，以便结果引用可以知道子类中方法的存在，即 Bone

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-07-30T09:24:29.927

对象的向下转换是不可能的。仅有的

```
DownCasting1 _downCasting1 = (DownCasting1)((DownCasting2)downCasting1); 
```

是可能的

```
class DownCasting0 {
    public int qwe() {
        System.out.println("DownCasting0");
        return -0;
    }
}

class DownCasting1 extends DownCasting0 {
    public int qwe1() {
        System.out.println("DownCasting1");
        return -1;
    }
}

class DownCasting2 extends DownCasting1 {
    public int qwe2() {
        System.out.println("DownCasting2");
        return -2;
    }
}

public class DownCasting {

    public static void main(String[] args) {

        try {
            DownCasting0 downCasting0 = new DownCasting0();
            DownCasting1 downCasting1 = new DownCasting1();
            DownCasting2 downCasting2 = new DownCasting2();

            DownCasting0 a1 = (DownCasting0) downCasting2;
            a1.qwe(); //good

            System.out.println(downCasting0 instanceof  DownCasting2);  //false
            System.out.println(downCasting1 instanceof  DownCasting2);  //false
            System.out.println(downCasting0 instanceof  DownCasting1);  //false

            DownCasting2 _downCasting1= (DownCasting2)downCasting1;     //good
            DownCasting1 __downCasting1 = (DownCasting1)_downCasting1;  //good
            DownCasting2 a3 = (DownCasting2) downCasting0; // java.lang.ClassCastException

            if(downCasting0 instanceof  DownCasting2){ //false
                DownCasting2 a2 = (DownCasting2) downCasting0;
                a2.qwe(); //error
            }

            byte b1 = 127;
            short b2 =32_767;
            int b3 = 2_147_483_647;
//          long _b4 = 9_223_372_036_854_775_807; //int large number max 2_147_483_647
            long b4 = 9_223_372_036_854_775_807L;
//          float _b5 = 3.4e+038; //double default
            float b5 = 3.4e+038F; //Sufficient for storing 6 to 7 decimal digits
            double b6 = 1.7e+038;
            double b7 = 1.7e+038D; //Sufficient for storing 15 decimal digits

            long c1 = b3;
            int c2 = (int)b4;

            //int       4 bytes     Stores whole numbers from -2_147_483_648 to 2_147_483_647
            //float     4 bytes     Stores fractional numbers from 3.4e−038 to 3.4e+038\. Sufficient for storing 6 to 7 decimal digits
            float c3 = b3; //logic error
            double c4 = b4; //logic error

        } catch (Throwable e) {
            e.printStackTrace();
        }
    }

} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-09-06T10:59:10.220

要在 Java 中进行向下转换并避免运行时异常，请参考以下代码：

```
if (animal instanceof Dog) {
  Dog dogObject = (Dog) animal;
} 
```

这里，Animal 是父类，Dog 是子类。
**instanceof**是一个关键字，用于检查引用变量是否包含给定类型的对象引用。

# bash - 从bash模拟“分组依据”的最佳方法？

> ID：380817
> 
> 赞同：270
> 
> 时间：2008-12-19T12:13:58.327
> 
> 标签：bash, scripting

假设您有一个包含 IP 地址的文件，每行一个地址：

```
10.0.10.1
10.0.10.1
10.0.10.3
10.0.10.2
10.0.10.1 
```

您需要一个 shell 脚本来计算每个 IP 地址在文件中出现的次数。对于先前的输入，您需要以下输出：

```
10.0.10.1 3
10.0.10.2 1
10.0.10.3 1 
```

一种方法是：

```
cat ip_addresses |uniq |while read ip
do
    echo -n $ip" "
    grep -c $ip ip_addresses
done 
```

然而，它真的远非高效。

您将如何使用 bash 更有效地解决这个问题？

（要补充一点：我知道它可以从 perl 或 awk 中解决，我对 bash 中的更好解决方案感兴趣，而不是那些语言。）

附加信息：

假设源文件为 5GB，运行算法的机器有 4GB。所以 sort 不是一个有效的解决方案，也不是多次读取文件。

我喜欢类似哈希表的解决方案——任何人都可以提供对该解决方案的改进吗？

附加信息 #2：

有些人问我为什么要在 bash 中做这件事，而在 perl 中它更容易。原因是在我必须执行此操作的机器上，我无法使用 perl。这是一个定制的 linux 机器，没有我习惯的大部分工具。我认为这是一个有趣的问题。

所以请不要责怪这个问题，如果你不喜欢它，请忽略它。:-)

* * *

## 回答 #1

> 赞同：478
> 
> 时间：2008-12-19T12:22:35.237

```
sort ip_addresses | uniq -c 
```

这将首先打印计数，但除此之外，它应该正是您想要的。

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2008-12-19T12:18:32.313

又快又脏的方法如下：

`cat ip_addresses | sort -n | uniq -c`

如果您需要使用 bash 中的值，您可以将整个命令分配给 bash 变量，然后遍历结果。

附言

如果省略 sort 命令，您将不会得到正确的结果，因为 uniq 只查看连续的相同行。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2010-04-10T10:42:40.233

要根据一组现有字段汇总多个字段，请使用以下示例：（根据您的要求替换 $1、$2、$3、$4）

```
cat file

US|A|1000|2000
US|B|1000|2000
US|C|1000|2000
UK|1|1000|2000
UK|1|1000|2000
UK|1|1000|2000

awk 'BEGIN { FS=OFS=SUBSEP="|"}{arr[$1,$2]+=$3+$4 }END {for (i in arr) print i,arr[i]}' file

US|A|3000
US|B|3000
US|C|3000
UK|1|9000 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-12-20T16:02:55.400

规范的解决方案是另一位受访者提到的解决方案：

```
sort | uniq -c 
```

它比用 Perl 或 awk 编写的更短更简洁。

你写你不想使用排序，因为数据的大小大于机器的主内存大小。不要低估 Unix 排序命令的执行质量。排序用于处理具有 128k（即 131,072 字节）内存 (PDP-11) 的机器上的大量数据（想想原始 AT&T 的计费数据）。当 sort 遇到超过预设限制的数据（通常调整到接近机器主内存的大小）时，它会对它在主内存中读取的数据进行排序并将其写入临时文件。然后它使用下一个数据块重复该操作。最后，它对这些中间文件执行合并排序。这允许 sort 处理比机器主内存大许多倍的数据。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2014-07-25T22:28:45.307

```
cat ip_addresses | sort | uniq -c | sort -nr | awk '{print $2 " " $1}' 
```

这个命令会给你想要的输出

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2014-02-14T09:08:38.613

解决方案（group by like mysql）

```
grep -ioh "facebook\|xing\|linkedin\|googleplus" access-log.txt | sort | uniq -c | sort -n 
```

结果

```
3249  googleplus
4211 linkedin
5212 xing
7928 facebook 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-19T12:33:18.257

似乎您必须使用大量代码来模拟 bash 中的哈希以获得线性行为，或者坚持使用~~二次~~超线性版本。

在这些版本中，[saua](https://stackoverflow.com/questions/380817/best-way-to-simulate-group-by-from-bash#380832)的解决方案是最好的（也是最简单的）：

```
sort -n ip_addresses.txt | uniq -c 
```

我找到了[http://unix.derkeiler.com/Newsgroups/comp.unix.shell/2005-11/0118.html](http://unix.derkeiler.com/Newsgroups/comp.unix.shell/2005-11/0118.html)。但是丑得要死。。。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-20T15:30:34.733

您可能可以将文件系统本身用作哈希表。伪代码如下：

```
for every entry in the ip address file; do
  let addr denote the ip address;

  if file "addr" does not exist; then
    create file "addr";
    write a number "0" in the file;
  else 
    read the number from "addr";
    increase the number by 1 and write it back;
  fi
done 
```

最后，您需要做的就是遍历所有文件并打印其中的文件名和编号。或者，您可以每次在文件中附加一个空格或换行符，而不是保持计数，最后只需查看文件大小（以字节为单位）。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-21T15:06:35.357

我觉得 awk 关联数组在这种情况下也很方便

```
$ awk '{count[$1]++}END{for(j in count) print j,count[j]}' ips.txt 
```

一个群发帖[在这里](http://unstableme.blogspot.com/2008/09/group-by-clause-functionality-in-awk.html)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-11-11T21:02:38.267

大多数其他解决方案都会计算重复项。如果您确实需要对键值对进行分组，请尝试以下操作：

这是我的示例数据：

```
find . | xargs md5sum
fe4ab8e15432161f452e345ff30c68b0 a.txt
30c68b02161e15435ff52e34f4fe4ab8 b.txt
30c68b02161e15435ff52e34f4fe4ab8 c.txt
fe4ab8e15432161f452e345ff30c68b0 d.txt
fe4ab8e15432161f452e345ff30c68b0 e.txt 
```

这将打印按 md5 校验和分组的键值对。

```
cat table.txt | awk '{print $1}' | sort | uniq  | xargs -i grep {} table.txt
30c68b02161e15435ff52e34f4fe4ab8 b.txt
30c68b02161e15435ff52e34f4fe4ab8 c.txt
fe4ab8e15432161f452e345ff30c68b0 a.txt
fe4ab8e15432161f452e345ff30c68b0 d.txt
fe4ab8e15432161f452e345ff30c68b0 e.txt 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-19T16:52:49.980

我会这样做：

```
perl -e 'while (<>) {chop; $h{$_}++;} for $k (keys %h) {print "$k $h{$k}\n";}' ip_addresses 
```

但 uniq 可能对你有用。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-02-18T12:31:58.437

### 纯[bash](/questions/tagged/bash "显示标记为“bash”的问题")（没有分叉！）

有一种方法，使用*[bash](/questions/tagged/bash "显示标记为“bash”的问题")函数*。这种方式非常快，因为没有叉子！...

...虽然一堆*IP地址*保持*小*！

```
countIp () { 
    local -a _ips=(); local _a
    while IFS=. read -a _a ;do
        ((_ips[_a<<24|${_a[1]}<<16|${_a[2]}<<8|${_a[3]}]++))
    done
    for _a in ${!_ips[@]} ;do
        printf "%.16s %4d\n" \
          $(($_a>>24)).$(($_a>>16&255)).$(($_a>>8&255)).$(($_a&255)) ${_ips[_a]}
    done
} 
```

注意：IP 地址转换为 32 位无符号整数值，用作*数组*的索引。这使用简单的***bash 数组***，而不是***关联数组***（这更贵）！

```
time countIp < ip_addresses 
10.0.10.1    3
10.0.10.2    1
10.0.10.3    1
real    0m0.001s
user    0m0.004s
sys     0m0.000s

time sort ip_addresses | uniq -c
      3 10.0.10.1
      1 10.0.10.2
      1 10.0.10.3
real    0m0.010s
user    0m0.000s
sys     0m0.000s 
```

在我的主机上，这样做比使用分叉要快得多，最多大约 1'000 个地址，但是当我尝试对 10'000 个地址进行排序时，大约需要 1*秒*。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-20T15:10:58.530

我了解您正在寻找 Bash 中的内容，但如果其他人可能正在寻找 Python 中的内容，您可能需要考虑以下问题：

```
mySet = set()
for line in open("ip_address_file.txt"):
     line = line.rstrip()
     mySet.add(line) 
```

由于默认情况下集合中的值是唯一的，而 Python 在这方面非常擅长，你可能会在这里赢得一些东西。我还没有测试过代码，所以它可能有问题，但这可能会让你到达那里。如果你想计算出现次数，使用 dict 而不是 set 很容易实现。

编辑：我是一个糟糕的读者，所以我回答错了。这是一个带有字典的片段，可以计算出现次数。

```
mydict = {}
for line in open("ip_address_file.txt"):
    line = line.rstrip()
    if line in mydict:
        mydict[line] += 1
    else:
        mydict[line] = 1 
```

字典 mydict 现在包含一个唯一 IP 列表作为键，它们出现的次数作为它们的值。

* * *

## 回答 #14

> 赞同：-9
> 
> 时间：2008-12-19T12:28:01.340

如果顺序不重要，可以省略排序

```
uniq -c <source_file> 
```

或者

```
echo "$list" | uniq -c 
```

如果源列表是变量

# html - 从网页下载和上传文件的更好界面？

> ID：380835
> 
> 赞同：3
> 
> 时间：2008-12-19T12:22:51.430
> 
> 标签：html, forms, user-interface, upload

我有一个典型的用户从网页下载、编辑和上传文档的使用场景。

1.  用户单击链接以下载文档
2.  用户编辑下载的文件
3.  用户保存文件
4.  用户返回网页并上传带有更改的新文件

问题是下载的文件通常保存在临时目录中，因此保存后可能很难找到文件。该应用程序适用于非技术用户，我已经可以想象保存文件丢失或上传错误版本的问题。

有没有更好的办法？我想过的事情：

1.  使用 Google Docs 或类似的东西。问题：强制用户使用功能较少的新应用程序，导入旧内容，为每个人设置帐户以编辑文件。
2.  使用 WebDAV 提供文件。不确定这将如何工作，但似乎应该是可能的
3.  某种管理下载和上传的 Flash 或 Java 应用程序。不确定这些是否存在。
4.  用户教育:)

如果重要的话，这些文件将主要是 Word 和 Powerpoint 文档。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T13:39:46.733

实际上，尽管您在开发应用程序时使用 AJAX 具有更大的灵活性，但上传多个文件的问题还没有解决。

对于您在问题中提到的想法：

1.  **谷歌文档：** 像谷歌文档这样的在线应用程序肯定对某些用例很有吸引力。但是，如果您想上传 Word 和 Powerpoint 幻灯片，您不希望在上传文档后更改内容。问题在于 Google Docs 使用自己的数据格式，因此会更改某些格式。如果您选择在线应用程序，我会选择文档管理解决方案。我敢肯定那里有很多（甚至是免费的）。但是，我还没有在他们身上使用任何东西。

2.  **WebDAV**这是可能的，在我看来是最好的解决方案。您可以像任何目录一样嵌入 WebDav。文档被锁定，直到用户释放文档。不幸的是，您没有 Web 前端来管理文件或管理访问限制。它

3.  **Flash 或 Java 应用程序**它们确实存在，这是肯定的。我更喜欢 Flash 而不是 Java，因为 Flash 应用程序在浏览器中仍然运行更流畅。我绝对不会使用富应用程序，即使它是可以下载并在单独窗口中打开的 Java Web Start 应用程序。越来越多的用户似乎接受了基于浏览器的 Web 应用程序。这让我想到了第 4 点：

4.  **用户教育**当然，您可以教育他们。但最终你希望他们*想要*使用这个系统。大多数情况下，用户很容易习惯一种工具。但是，如果他们不喜欢这个工具，他们就不会使用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T13:15:18.813

将清晰的说明保存到他们的桌面是一个开始。然后清除指示转到桌面重新启动它。我没有遇到过在线 MSWord 查看器/编辑器或文件的任何格式，但我确信它们存在，现在 Google Docs 和一些其他在线版本的 MSOffice 存在。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T13:21:37.847

我会确保有易于遵循的说明，以及其他地方的教程（可能还有视频）来指导用户完成整个过程。

# javascript - 如何在 Dojo StackContainer 中禁用热键

> ID：380846
> 
> 赞同：2
> 
> 时间：2008-12-19T12:28:06.893
> 
> 标签：javascript, dojo

我正在使用 Dojo 1.2 在我客户的网页上实现一些功能。我使用的小部件之一是`dijit.layout.TabContainer`，它继承了`StackContainer`. 订阅键盘事件并创建一些热键，例如向左箭头将`StackContainer`一个选项卡向左移动等等。

现在问题来了：我想在我的`TabContainer`. 是否有我可以设置的配置选项（在 API 中找不到）来实现这一点，或者必须破解 Dojo 代码或者创建我自己的版本，`StackContainer`以便`TabContainer`摆脱热键？我当然不希望弄乱 Dojo 代码。

最好的问候/弗雷德里克

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T15:27:36.057

只需用空主体覆盖 _onKeyPress：

```
<div dojoType='dijit.layout.TabContainer'>
<script type='dojo/method' event='_onKeyPress'></script>
...
<div>

```

奇迹般有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T15:11:40.473

我只是在这里随意编码，我根本没有测试它。我正在把这个维基化，所以如果有任何问题，请发布正确的来源。

在名为的文件中使用以下 javascript `com/stackoverflow/KeyPresslessTabContainer.js`：

```
dojo.provide("com.stackoverflow. KeyPresslessTabContainer");

dojo.require("dijit.layout. TabContainer");

dojo.declare("com.stackoverflow.KeyPresslessTabContainer", dijit.layout. TabContainer, {
    _controllerWidget: "com.stackoverflow.KeyPresslessTabController"
});

dojo.declare("com.stackoverflow.KeyPresslessTabController", dijit.layout.TabController, {
  /*
   *  this is the important part.  The original code was:
   *  templateString: "<div wairole='tablist' dojoAttachEvent='onkeypress:onkeypress'></div>"
   *  In the template below, we remove the onkeypress listener,
   *  and thus key presses should be ignored.
   */
  templateString: "<div wairole='tablist'></div>"
}); 
```

# sql - 在 SQLServer 中，为什么不授予对象权限将用户正确添加到数据库？

> ID：380848
> 
> 赞同：1
> 
> 时间：2008-12-19T12:28:42.620
> 
> 标签：sql, sql-server, sql-server-2005, permissions

这是我的设置：

*   SQL 服务器 2005
*   用户 A 已在服务器上设置为用户，但未在数据库 A 上设置。
*   GRANT 执行 [GetOrders] TO [UserA] AS [dbo]

如您所见，我错过了一步。我还没有将 UserA 添加到数据库中。这不会失败，并允许我在对象上执行。

我相信在 2000 年它会抛出一个错误并且不允许我这样做。

现在，我将所有这些对象都设置了正确的权限，但用户看不到数据库。要解决此问题，我必须从数据库中删除用户，正确重新添加它们，然后授予权限。

为什么这是允许的，有没有办法阻止它或让它在新用户被授予对象权限时自动创建数据库登录。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T08:15:43.373

这是让你失望的部分。

> 到 [UserA] 作为 [dbo]

抛弃“as dbo”部分。它授予 dbo 用户的权利。如果没有“AS [dbo]”部分，它将引发错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T12:51:44.740

当数据库未连接到生产服务器时，可能允许 DBA 灵活地修改用户和权限。我不相信你必须重新添加用户。看看这个人的脚本：[http ://www.lazycoder.com/weblog/2007/06/04/re-associate-sql-users-with-logins/](http://www.lazycoder.com/weblog/2007/06/04/re-associate-sql-users-with-logins/)

# silverlight - Silverlight 中的像素级 2D 图形

> ID：380850
> 
> 赞同：4
> 
> 时间：2008-12-19T12:29:48.280
> 
> 标签：silverlight

我正在尝试将 WebForms 应用程序移植到 Silverlight，该应用程序使用 GDI Graphics 类将多边形绘制到内存位图，然后它将进行逐像素比较，因此我需要访问像素缓冲区。

例子：

```
    图形 g = Graphics.FromImage(bmp);
    g.FillClosedCurve（画笔，点，FillMode.Winding）；

```

我做了一些严肃的谷歌搜索，试图弄清楚如何绘制多边形，然后能够访问画布表面的像素缓冲区。我的发现表明 WPF silverlight 图形无法做到这一点，因此我需要使用自定义图形库，但只找到了一些 3D 库。是否有一个用于 silverlight 的简单 2D 库，或者我应该自己动手编写一个多边形渲染算法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T12:46:41.867

如果您为 Silverlight 编写多边形渲染算法，它必须是所有托管代码，我还没有看到任何这样的示例，但是如果您编写一个让我知道，我一直在寻找类似 for XNA 的东西。

Silverlight 3 应该添加一些你需要的东西来使它更容易，比如渲染到纹理和访问像素级别的位图。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T13:24:51.897

你能从服务器上抓取图像并进行处理吗？您可以动态生成图像，并且可以访问 Silverlight 之外所需的任何内容。

# javascript - 属性名称的 JSON 语法

> ID：380855
> 
> 赞同：30
> 
> 时间：2008-12-19T12:33:22.267
> 
> 标签：javascript, json, syntax

在 javascript 中创建适用于大多数 Web 浏览器的对象的正确语法是什么（我的意思是：IE 6+、Firefox 2+、Opera 9+）

这有效吗

```
var a = {
  "class": "Person",
  "name": "William Shakespeare",
  "birthday": -12802392000000,
  "nickname": "Bill"
}; 
```

或者是这样的：

```
var a = {
  class: "Person",
  name: "William Shakespeare",
  birthday: -12802392000000,
  nickname: "Bill"
}; 
```

两者有什么区别？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-12-19T14:49:16.983

[@AndreasN 是正确](https://stackoverflow.com/questions/380855/json-syntax-for-property-names#380860)的：[JSON 规范](http://www.json.org/)规定使用引号以使其实际上是 JSON。如果不使用引号，它可能是 Javascript 中的有效对象文字，但不是 JSON。除了浏览器端 Javascript 之外的其他服务使用 JSON（例如，使用 php、Java 等的 web 服务），如果您构造一个缺少引号的字符串，则无法保证它会被正确解析——尽管我怀疑大多数实现会是足够强大，可以这样做。

仅供参考，在 Javascript 中直接对来自无法防止恶意攻击的源的 JSON 字符串使用 eval() 是很危险的。同样，请参阅[JSON 站点](http://www.json.org/js.html)，该站点提供了更多解释以及一个非常短的 javascript 文件，该文件可以安全地将 JSON 字符串解析为 Javascript 对象。

**编辑：**我想从技术上讲，您最初的问题不是关于 JSON，而是关于 Javascript 的**object literals**语法。不同之处在于，可从 JSON 字符串构造的对象将排除许多其他可能的对象字面量，例如：

```
var a = {cat: "meow", dog: "woof"};
var aname = {cat: "Garfield", dog: "Odie"};
var b = {
  counter: 0,
  pow: function(x) { return x+1; },
  zap: function(y) { return (counter += y); }
};
var c = {
  all: [a,aname],
  animals: a,
  names: aname,
}; 
```

对象文字“a”和“aname”可以用 JSON 表示（通过在属性名称中添加引号）。但是对象文字“b”和“c”不能。对象文字“b”包含函数（JSON 中不允许）。上面的对象文字“c”包含对其他变量的引用，这种引用在 JSON 中无法表示，因为其中一些引用是共享的。如果您对其进行更改，`c.names`它也会更改`c.all[1]`，因为它们共享对同一变量的引用。JSON 只能表达具有树结构的对象（例如，整个对象的每个子元素都是独立的）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-19T12:35:24.570

[规范](http://www.json.org/)说使用“” 。

Firefox 不接受，但 IE 不接受。

对定义为

```
string : value 
```

值可以是字符串 字符串定义为

```
" chars " 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-19T13:04:00.847

如果 IE 在您的第二个示例中失败，那是因为“类”是保留字（仅在 IE 中）。一般来说，最好用引号将您的属性名称括起来 - 这样做意味着它总是可以工作，无论在什么情况下。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-19T12:41:36.960

您必须在包含单词字符以外的任何内容的属性周围使用“引号”

```
{foo-bar: 3} // invalid
{"foo-bar": 3} // valid 
```

除此之外，两者之间没有区别，我想这两种方式都适用于所有浏览器

# python - 确保只有一个程序实例正在运行

> ID：380870
> 
> 赞同：142
> 
> 时间：2008-12-19T12:42:52.620
> 
> 标签：python, process, locking, mutual-exclusion

是否有一种 Pythonic 方式可以只运行一个程序实例？

我想出的唯一合理的解决方案是尝试在某个端口上将其作为服务器运行，然后第二个程序尝试绑定到同一端口 - 失败。但这并不是一个好主意，也许还有比这更轻量级的东西？

（考虑到程序有时会失败，即段错误 - 所以像“锁定文件”这样的东西不会起作用）

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2009-08-12T10:45:24.760

以下代码应该可以完成这项工作，它是跨平台的并且在 Python 2.4-3.2 上运行。我在 Windows、OS X 和 Linux 上对其进行了测试。

```
from tendo import singleton
me = singleton.SingleInstance() # will sys.exit(-1) if other instance is running 
```

最新的代码版本可用[singleton.py](https://github.com/pycontribs/tendo/blob/master/tendo/singleton.py)。请[在此处提交错误](https://github.com/pycontribs/tendo/issues)。

您可以使用以下方法之一安装tend：

*   `easy_install tendo`
*   `pip install tendo`
*   [通过从http://pypi.python.org/pypi/tendo](http://pypi.python.org/pypi/tendo)手动获取

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-12-21T14:02:47.203

简单的~~跨平台~~解决方案，在[zgoda的](https://stackoverflow.com/users/12138/zgoda)**[另一个问题](https://stackoverflow.com/questions/220525/ensuring-a-single-instance-of-an-application-in-linux#221159)**中找到：

```
import fcntl
import os
import sys

def instance_already_running(label="default"):
    """
    Detect if an an instance with the label is already running, globally
    at the operating system level.

    Using `os.open` ensures that the file pointer won't be closed
    by Python's garbage collector after the function's scope is exited.

    The lock will be released when the program exits, or could be
    released if the file pointer were closed.
    """

    lock_file_pointer = os.open(f"/tmp/instance_{label}.lock", os.O_WRONLY)

    try:
        fcntl.lockf(lock_file_pointer, fcntl.LOCK_EX | fcntl.LOCK_NB)
        already_running = False
    except IOError:
        already_running = True

    return already_running 
```

很像 S.Lott 的建议，但带有代码。

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2009-11-02T17:10:48.470

此代码是特定于 Linux 的。它使用“抽象”的 UNIX 域套接字，但它很简单，不会留下陈旧的锁定文件。我更喜欢上面的解决方案，因为它不需要专门保留的 TCP 端口。

```
try:
    import socket
    s = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
    ## Create an abstract socket, by prefixing it with null. 
    s.bind( '\0postconnect_gateway_notify_lock') 
except socket.error as e:
    error_code = e.args[0]
    error_string = e.args[1]
    print "Process already running (%d:%s ). Exiting" % ( error_code, error_string) 
    sys.exit (0) 
```

`postconnect_gateway_notify_lock`可以更改唯一字符串以允许需要强制执行单个实例的多个程序。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2008-12-19T12:46:38.463

我不知道它是否足够 Pythonic，但在 Java 世界中，在定义的端口上侦听是一种非常广泛使用的解决方案，因为它适用于所有主要平台，并且在程序崩溃时没有任何问题。

侦听端口的另一个优点是您可以向正在运行的实例发送命令。例如，当用户第二次启动程序时，您可以向正在运行的实例发送一个命令，告诉它打开另一个窗口（例如，Firefox 就是这样做的。我不知道他们是否使用 TCP 端口或命名管道或类似的东西，'虽然）。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2011-08-31T14:02:54.870

以前从未写过python，但这是我刚刚在mycheckpoint中实现的，以防止它被crond启动两次或更多次：

```
import os
import sys
import fcntl
fh=0
def run_once():
    global fh
    fh=open(os.path.realpath(__file__),'r')
    try:
        fcntl.flock(fh,fcntl.LOCK_EX|fcntl.LOCK_NB)
    except:
        os._exit(0)

run_once() 
```

在另一个问题 (http://stackoverflow.com/questions/2959474) 中发布后发现了 Slava-N 的建议。这被称为函数，锁定正在执行的脚本文件（不是 pid 文件）并保持锁定直到脚本结束（正常或错误）。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-12-19T13:16:39.403

使用 pid 文件。你有一些已知的位置，“/path/to/pidfile”，并且在启动时你会做这样的事情（部分伪代码，因为我是咖啡前，不想那么努力地工作）：

```
import os, os.path
pidfilePath = """/path/to/pidfile"""
if os.path.exists(pidfilePath):
   pidfile = open(pidfilePath,"r")
   pidString = pidfile.read()
   if <pidString is equal to os.getpid()>:
      # something is real weird
      Sys.exit(BADCODE)
   else:
      <use ps or pidof to see if the process with pid pidString is still running>
      if  <process with pid == 'pidString' is still running>:
          Sys.exit(ALREADAYRUNNING)
      else:
          # the previous server must have crashed
          <log server had crashed>
          <reopen pidfilePath for writing>
          pidfile.write(os.getpid())
else:
    <open pidfilePath for writing>
    pidfile.write(os.getpid()) 
```

因此，换句话说，您正在检查 pidfile 是否存在；如果没有，请将您的 pid 写入该文件。如果 pidfile 确实存在，则检查 pid 是否是正在运行的进程的 pid；如果是这样，那么你有另一个正在运行的进程，所以只需关闭。如果不是，那么前一个进程崩溃了，所以记录它，然后将你自己的 pid 写入文件来代替旧的。然后继续。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2019-02-18T11:36:57.723

在 Windows 上解决此问题的最佳解决方案是使用 @zgoda 建议的互斥锁。

```
import win32event
import win32api
from winerror import ERROR_ALREADY_EXISTS

mutex = win32event.CreateMutex(None, False, 'name')
last_error = win32api.GetLastError()

if last_error == ERROR_ALREADY_EXISTS:
   print("App instance already running") 
```

一些答案使用`fctnl`（也包含在@sorin tendo 包中）在 Windows 上不可用，如果您尝试使用像`pyinstaller`静态导入这样的包来冻结您的 python 应用程序，它会引发错误。

此外，使用锁定文件方法，会导致`read-only`数据库文件出现问题（经历过这种情况`sqlite3`）。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-12-19T12:56:55.447

这可能有效。

1.  尝试在已知位置创建 PID 文件。如果你失败了，有人锁定了文件，你就完成了。

2.  正常完成后，关闭并删除 PID 文件，以便其他人可以覆盖它。

您可以将您的程序包装在一个 shell 脚本中，即使您的程序崩溃，该脚本也会删除 PID 文件。

如果程序挂起，您也可以使用 PID 文件终止程序。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2016-09-23T16:04:05.980

这是我最终的仅限 Windows 的解决方案。将以下内容放入一个模块中，可能称为“onlyone.py”或其他。将该模块直接包含到您的 __ main __ python 脚本文件中。

```
import win32event, win32api, winerror, time, sys, os
main_path = os.path.abspath(sys.modules['__main__'].__file__).replace("\\", "/")

first = True
while True:
        mutex = win32event.CreateMutex(None, False, main_path + "_{<paste YOUR GUID HERE>}")
        if win32api.GetLastError() == 0:
            break
        win32api.CloseHandle(mutex)
        if first:
            print "Another instance of %s running, please wait for completion" % main_path
            first = False
        time.sleep(1) 
```

## 解释

该代码尝试创建一个互斥锁，其名称源自脚本的完整路径。我们使用正斜杠来避免与真实文件系统的潜在混淆。

## 好处

*   不需要配置或“魔术”标识符，根据需要在尽可能多的不同脚本中使用它。
*   周围没有陈旧的文件，互斥锁与您一起消亡。
*   等待时打印有用的消息

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-19T13:01:54.783

在 unix 上使用锁定文件是一种非常常见的方法。如果它崩溃，您必须手动清理。您可以将 PID 存储在文件中，并在启动时检查是否存在具有此 PID 的进程，如果没有则覆盖锁定文件。（但是，您还需要锁定 read-file-check-pid-rewrite-file）。您将在[os](http://docs.python.org/library/os.html) -package 中找到获取和检查 pid 所需的内容。检查是否存在具有给定 pid 的进程的常用方法是向其发送非致命信号。

其他替代方案可以将其与flock 或posix 信号量相结合。

正如 saua 建议的那样，打开一个网络套接字可能是最简单和最便携的。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2016-04-08T00:34:12.890

对于将**wxPython用于其应用程序的任何人，您都可以使用**`wx.SingleInstanceChecker` [此处记录](https://wxpython.org/Phoenix/docs/html/wx.SingleInstanceChecker.html)的函数 。

我个人使用一个子类，如果有一个现有的应用程序实例已经在执行`wx.App`，则使用`wx.SingleInstanceChecker`并返回：`False``OnInit()`

```
import wx

class SingleApp(wx.App):
    """
    class that extends wx.App and only permits a single running instance.
    """

    def OnInit(self):
        """
        wx.App init function that returns False if the app is already running.
        """
        self.name = "SingleApp-%s".format(wx.GetUserId())
        self.instance = wx.SingleInstanceChecker(self.name)
        if self.instance.IsAnotherRunning():
            wx.MessageBox(
                "An instance of the application is already running", 
                "Error", 
                 wx.OK | wx.ICON_WARNING
            )
            return False
        return True 
```

这是一个简单的替代品，用于`wx.App`禁止多个实例。要使用它，只需在您的代码中替换`wx.App`为：`SingleApp`

```
app = SingleApp(redirect=False)
frame = wx.Frame(None, wx.ID_ANY, "Hello World")
frame.Show(True)
app.MainLoop() 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-12-02T16:29:22.320

我将其发布为答案，因为我是新用户，而 Stack Overflow 还不让我投票。

Sorin Sbarnea 的解决方案适用于我在 OS X、Linux 和 Windows 下，对此我深表感谢。

但是， tempfile.gettempdir() 在 OS X 和 Windows 下以一种方式运行，而在其他 some/many/all(?) *nixes 下以另一种方式运行（忽略 OS X 也是 Unix 的事实！）。区别对这段代码很重要。

OS X 和 Windows 具有特定于用户的临时目录，因此一个用户创建的临时文件对另一个用户不可见。相比之下，在许多版本的 *nix 下（我测试了 Ubuntu 9、RHEL 5、OpenSolaris 2008 和 FreeBSD 8），所有用户的临时目录都是 /tmp。

这意味着当在多用户计算机上创建锁定文件时，它会在 /tmp 中创建，并且只有第一次创建锁定文件的用户才能运行该应用程序。

一种可能的解决方案是将当前用户名嵌入到锁定文件的名称中。

值得注意的是，OP 的抓取端口的解决方案在多用户机器上也会出现异常。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-04-24T07:31:24.053

我`single_process`在我的gentoo上使用；

```
pip install single_process 
```

**示例**：

```
from single_process import single_process

@single_process
def main():
    print 1

if __name__ == "__main__":
    main() 
```

参考：[https ://pypi.python.org/pypi/single_process/](https://pypi.python.org/pypi/single_process/)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2019-12-24T08:09:16.817

基于罗伯托·罗萨里奥的回答，我提出了以下功能：

```
SOCKET = None
def run_single_instance(uniq_name):
    try:
        import socket
        global SOCKET
        SOCKET = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
        ## Create an abstract socket, by prefixing it with null.
        # this relies on a feature only in linux, when current process quits, the
        # socket will be deleted.
        SOCKET.bind('\0' + uniq_name)
        return True
    except socket.error as e:
        return False 
```

我们需要定义全局`SOCKET`变量，因为它只会在整个进程退出时被垃圾收集。如果我们在函数中声明一个局部变量，函数退出后它会超出作用域，从而删除套接字。

所有的功劳都应该归功于 Roberto Rosario，因为我只澄清和详细说明了他的代码。并且此代码仅适用于 Linux，正如以下来自[https://troydhanson.github.io/network/Unix_domain_sockets.html](https://troydhanson.github.io/network/Unix_domain_sockets.html)的引用文本所述：

> Linux 有一个特殊功能：如果 UNIX 域套接字的路径名以空字节 \0 开头，则其名称不会映射到文件系统中。因此它不会与文件系统中的其他名称冲突。此外，当服务器关闭抽象命名空间中的 UNIX 域侦听套接字时，它的文件将被删除；使用常规的 UNIX 域套接字，文件在服务器关闭后仍然存在。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2020-12-30T03:23:45.653

迟到的答案，但对于 Windows，您可以使用：

```
from win32event import CreateMutex
from win32api import CloseHandle, GetLastError
from winerror import ERROR_ALREADY_EXISTS
import sys

class singleinstance:
    """ Limits application to single instance """

    def __init__(self):
        self.mutexname = "testmutex_{D0E858DF-985E-4907-B7FB-8D732C3FC3B9}"
        self.mutex = CreateMutex(None, False, self.mutexname)
        self.lasterror = GetLastError()

    def alreadyrunning(self):
        return (self.lasterror == ERROR_ALREADY_EXISTS)

    def __del__(self):
        if self.mutex:
            CloseHandle(self.mutex) 
```

* * *

用法

```
# do this at beginnig of your application
myapp = singleinstance()

# check is another instance of same program running
if myapp.alreadyrunning():
    print ("Another instance of this program is already running")
    sys.exit(1) 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-07-24T15:44:41.740

我一直怀疑应该有一个使用进程组的好的 POSIXy 解决方案，而不必访问文件系统，但我不能完全确定。就像是：

启动时，您的进程会向特定组中的所有进程发送“kill -0”。如果存在任何此类进程，则退出。然后它加入了这个组。没有其他进程使用该组。

但是，这有一个竞争条件 - 多个进程都可以同时执行此操作，并且最终都会加入组并同时运行。当您添加某种互斥锁以使其无懈可击时，您不再需要进程组。

如果您的进程仅由 cron 启动，每分钟或每小时一次，这可能是可以接受的，但是这让我有点紧张，因为它会在您不希望它发生的那一天出错。

我想这毕竟不是一个很好的解决方案，除非有人可以改进它？

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2015-01-28T06:51:51.433

上周我遇到了这个确切的问题，虽然我确实找到了一些好的解决方案，但我决定制作一个非常简单干净的 python 包并将其上传到 PyPI。它与tendo 的不同之处在于它可以锁定任何字符串资源名称。虽然你当然可以锁定`__file__`来达到同样的效果。

安装：`pip install quicklock`

使用它非常简单：

```
[nate@Nates-MacBook-Pro-3 ~/live] python
Python 2.7.6 (default, Sep  9 2014, 15:04:36)
[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.39)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from quicklock import singleton
>>> # Let's create a lock so that only one instance of a script will run
...
>>> singleton('hello world')
>>>
>>> # Let's try to do that again, this should fail
...
>>> singleton('hello world')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/Users/nate/live/gallery/env/lib/python2.7/site-packages/quicklock/quicklock.py", line 47, in singleton
    raise RuntimeError('Resource <{}> is currently locked by <Process {}: "{}">'.format(resource, other_process.pid, other_process.name()))
RuntimeError: Resource <hello world> is currently locked by <Process 24801: "python">
>>>
>>> # But if we quit this process, we release the lock automatically
...
>>> ^D
[nate@Nates-MacBook-Pro-3 ~/live] python
Python 2.7.6 (default, Sep  9 2014, 15:04:36)
[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.39)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> from quicklock import singleton
>>> singleton('hello world')
>>>
>>> # No exception was thrown, we own 'hello world'! 
```

看看：[https ://pypi.python.org/pypi/quicklock](https://pypi.python.org/pypi/quicklock)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2021-02-02T00:38:08.253

这是我使用 Python 3.7.9 在 Windows Server 2016 和 Ubuntu 20.04 上测试过的[跨平台示例：](https://gist.github.com/JavaScriptDude/b436bfda31e765ef7a9916890c786138)

```
import os

class SingleInstanceChecker:
    def __init__(self, id):
        if isWin():
            ensure_win32api()
            self.mutexname = id
            self.lock = win32event.CreateMutex(None, False, self.mutexname)
            self.running = (win32api.GetLastError() == winerror.ERROR_ALREADY_EXISTS)

        else:
            ensure_fcntl()
            self.lock = open(f"/tmp/isnstance_{id}.lock", 'wb')
            try:
                fcntl.lockf(self.lock, fcntl.LOCK_EX | fcntl.LOCK_NB)
                self.running = False
            except IOError:
                self.running = True

    def already_running(self):
        return self.running

    def __del__(self):
        if self.lock:
            try:
                if isWin():
                    win32api.CloseHandle(self.lock)
                else:
                    os.close(self.lock)
            except Exception as ex:
                pass

# ---------------------------------------
# Utility Functions
# Dynamically load win32api on demand
# Install with: pip install pywin32
win32api=winerror=win32event=None
def ensure_win32api():
    global win32api,winerror,win32event
    if win32api is None:
        import win32api
        import winerror
        import win32event

# Dynamically load fcntl on demand
# Install with: pip install fcntl
fcntl=None
def ensure_fcntl():
    global fcntl
    if fcntl is None:
        import fcntl

def isWin():
    return (os.name == 'nt')
# --------------------------------------- 
```

这是它的使用：

```
import time, sys

def main(argv):
    _timeout = 10
    print("main() called. sleeping for %s seconds" % _timeout)
    time.sleep(_timeout)
    print("DONE")

if __name__ == '__main__':
    SCR_NAME = "my_script"
    sic = SingleInstanceChecker(SCR_NAME)
    if sic.already_running():
        print("An instance of {} is already running.".format(SCR_NAME))
        sys.exit(1)
    else:
        main(sys.argv[1:]) 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-10-14T13:44:47.757

linux例子

此方法基于创建一个临时文件，在您关闭应用程序后自动删除。程序启动我们验证文件的存在；如果文件存在（有待执行），则程序关闭；否则它会创建文件并继续执行程序。

```
from tempfile import *
import time
import os
import sys

f = NamedTemporaryFile( prefix='lock01_', delete=True) if not [f  for f in     os.listdir('/tmp') if f.find('lock01_')!=-1] else sys.exit()

YOUR CODE COMES HERE 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-01-17T16:12:56.547

在 Linux 系统上，还可以询问 `pgrep -a`实例的数量，脚本位于进程列表中（选项 -a 显示完整的命令行字符串）。例如

```
import os
import sys
import subprocess

procOut = subprocess.check_output( "/bin/pgrep -u $UID -a python", shell=True, 
                                   executable="/bin/bash", universal_newlines=True)

if procOut.count( os.path.basename(__file__)) > 1 :        
    sys.exit( ("found another instance of >{}<, quitting."
              ).format( os.path.basename(__file__))) 
```

`-u $UID`如果限制应适用于*所有*用户，请删除。免责声明：a）假定脚本的（基本）名称是唯一的，b）可能存在竞争条件。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-02-28T16:52:17.270

这是带有 contextmanager 和 memcached 的 django 的一个很好的例子： [https ://docs.celeryproject.org/en/latest/tutorials/task-cookbook.html](https://docs.celeryproject.org/en/latest/tutorials/task-cookbook.html)

可用于保护不同主机上的同时操作。可用于管理多个任务。也可以更改为简单的 python 脚本。

我对上面代码的修改在这里：

```
import time
from contextlib import contextmanager
from django.core.cache import cache

@contextmanager
def memcache_lock(lock_key, lock_value, lock_expire):
    timeout_at = time.monotonic() + lock_expire - 3

    # cache.add fails if the key already exists
    status = cache.add(lock_key, lock_value, lock_expire)
    try:
        yield status
    finally:
        # memcache delete is very slow, but we have to use it to take
        # advantage of using add() for atomic locking
        if time.monotonic() < timeout_at and status:
            # don't release the lock if we exceeded the timeout
            # to lessen the chance of releasing an expired lock owned by someone else
            # also don't release the lock if we didn't acquire it
            cache.delete(lock_key)

LOCK_EXPIRE = 60 * 10  # Lock expires in 10 minutes

def main():
    lock_name, lock_value = "lock_1", "locked"
    with memcache_lock(lock_name, lock_value, LOCK_EXPIRE) as acquired:
        if acquired:
            # single instance code here:
            pass

if __name__ == "__main__":
    main() 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-02-28T18:20:35.237

这是一个跨平台的实现，使用上下文管理器创建一个临时锁定文件。

可用于管理多个任务。

```
import os
from contextlib import contextmanager
from time import sleep

class ExceptionTaskInProgress(Exception):
    pass

# Context manager for suppressing exceptions
class SuppressException:
    def __init__(self):
        pass

    def __enter__(self):
        return self

    def __exit__(self, *exc):
        return True

# Context manager for task
class TaskSingleInstance:
    def __init__(self, task_name, lock_path):
        self.task_name = task_name
        self.lock_path = lock_path
        self.lock_filename = os.path.join(self.lock_path, self.task_name + ".lock")

        if os.path.exists(self.lock_filename):
            raise ExceptionTaskInProgress("Resource already in use")

    def __enter__(self):
        self.fl = open(self.lock_filename, "w")
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        self.fl.close()
        os.unlink(self.lock_filename)

# Here the task is silently interrupted
# if it is already running on another instance.
def main1():
    task_name = "task1"
    tmp_filename_path = "."
    with SuppressException():
        with TaskSingleInstance(task_name, tmp_filename_path):
            print("The task `{}` has started.".format(task_name))
            # The single task instance code is here.
            sleep(5)
            print("The task `{}` has completed.".format(task_name))

# Here the task is interrupted with a message
# if it is already running in another instance.
def main2():
    task_name = "task1"
    tmp_filename_path = "."
    try:
        with TaskSingleInstance(task_name, tmp_filename_path):
            print("The task `{}` has started.".format(task_name))
            # The single task instance code is here.
            sleep(5)
            print("Task `{}` completed.".format(task_name))
    except ExceptionTaskInProgress as ex:
        print("The task `{}` is already running.".format(task_name))

if __name__ == "__main__":
    main1()
    main2() 
```

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2018-10-22T19:57:44.057

```
import sys,os

# start program
try:  # (1)
    os.unlink('lock')  # (2)
    fd=os.open("lock", os.O_CREAT|os.O_EXCL) # (3)  
except: 
    try: fd=os.open("lock", os.O_CREAT|os.O_EXCL) # (4) 
    except:  
        print "Another Program running !.."  # (5)
        sys.exit()  

# your program  ...
# ...

# exit program
try: os.close(fd)  # (6)
except: pass
try: os.unlink('lock')  
except: pass
sys.exit() 
```

# objective-c - 寻找有关界面组件（Cocoa）的自定义绘图的信息

> ID：380875
> 
> 赞同：13
> 
> 时间：2008-12-19T12:46:17.280
> 
> 标签：objective-c, cocoa, macos, interface-builder

现在似乎越来越多的 OS X 应用程序正在为自定义控件做各种花哨的绘图工作。Twitterific、Things、EventBox、Versions 等应用程序仅举几例......

所以基本上我正在寻找有关如何开始做这种事情的任何信息。不确定它是否只是通过子类化控件和使用自定义绘图来完成，或者它是否完全不同。

任何帮助是极大的赞赏。谢谢！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-19T13:46:25.537

这完全取决于你想做什么。

例如，版本中的“显示原始属性”按钮是一个 NSButton 子类，因为基本上我们需要的是具有我们自己外观的标准按钮行为。将按钮子类化的一种方法是在 NSButton 子类中简单地实现您自己的 -drawRect:(NSRect)rect 方法，但我们决定坚持在 Cocoa 中实现 NSButton 的方式，这意味着大多数绘图是由按钮的单元格完成的，所以实现如下所示：

在 NSButton 子类中：

```
+ (Class) cellClass
{
    return [OurButtonCell class];
}

- (void)drawRect:(NSRect)rect 
{
    // first get the cell to draw inside our bounds
    // then draw a focus ring if that's appropriate
} 
```

在 NSButtonCell 子类（OurButtonCell）中：

```
- (void)drawInteriorWithFrame: (NSRect) rect inView: (NSView *) controlView
{
    // a bunch of drawing code
} 
```

Versions 中的 Timeline 视图实际上是一个 WebView，您在其中看到的页面使用 javascript 折叠您单击的标题。

我用于从哪里开始使用自定义控件的经验法则是：

*   要自定义标准 Cocoa 控件的外观：
    *   子类化适当的控件（例如 NSButton 和 NSButtonCell）
    *   尽可能接近默认控件的实现方式（例如，在按钮单元中，从现有的属性标题实例方法开始绘制按钮标题，除非您总是希望使用相同的属性进行绘制，而不管在 IB 中设置了什么或者如果您需要根据状态使用不同的属性进行绘制，例如使用版本主窗口中的试用到期按钮）
*   创建一个全新的 UI 元素：
    *   继承 NSView 并实现几乎所有鼠标和按键事件处理（在视图中，无需重做“hitTest：”）并自己绘制代码。
*   呈现复杂的、任意高度但不是表格的东西：
    *   看看你是否可以用 HTML、CSS 和 JS 来做，并在 WebView 中呈现。网络非常擅长布置文本，所以如果你可以把这个责任转移到你的 WebView 上，那可以大大减轻你的痛苦。

学习如何在自定义视图的绘制方法中绘制东西的推荐阅读：[Cocoa 绘图指南](http://developer.apple.com/documentation/Cocoa/Conceptual/CocoaDrawingGuide/DrawingEnviron/chapter_2_section_1.html#//apple_ref/doc/uid/TP40003290-CH202-BBCJDGHJ)

例如，自定义 NSTableView 的外观完全是另一回事，由于 tableview 的复杂性，这种情况可能随处可见。您将为您想要在表格中执行的某些操作实现自己的自定义单元格，但必须更改在实际 NSTableView 对象本身的子类中突出显示行的方式。[例如，请参阅Matt Gemmell 网站](http://mattgemmell.com/source)上的 iTableView 的源代码，了解在哪里绘制什么的清晰示例。

最后，我认为 Abizer 建议去查看 BWToolkit 的代码是个好主意。一开始可能有点不知所措，但如果您能够阅读并理解该代码，那么您在实现自己的自定义视图和控件时就不会遇到麻烦。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-19T12:52:50.433

看看一些优秀的示例代码：[BWToolkit](http://www.bitbucket.org/bwalkin/bwtoolkit/)

# algorithm - 你能简化这个算法吗？

> ID：380885
> 
> 赞同：25
> 
> 时间：2008-12-19T12:52:19.497
> 
> 标签：algorithm, refactoring

一个给数学家。这已经在办公室里流传了，我们想看看谁能拿出更好的优化版本。

```
(((a+p) <= b) && (a == 0 || a > 1) && (b >= p)) && 
    ((b - (a + p) == 0) || (b - (a + p) > 1)) 
```

**编辑**：所有数据都是正整数

**编辑**：更好==为简单而重构

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-12-19T13:40:04.970

```
(a + p <= b) && (a != 1) && (b - a - p != 1); 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-19T13:22:27.410

如果公式有效并且来自您的业务规则，则没有真正需要简化它。编译器可能比我们更了解如何优化公式。

您唯一应该做的就是使用更好的变量名称来反映业务逻辑。

在对它们进行单元测试之前，请注意应用任何建议的解决方案。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-19T12:59:29.857

通过引入更多表示每个表达式含义的局部变量来简化重构。如果不知道 a、b 和 p 的含义，我们很难做到这一点。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-19T13:10:42.970

```
b >= p && b != p+1 
```

**编辑：**好的，那没有用，但是这个可以：

```
a != 1 && b >= a+p && b-a-p != 1 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-19T15:13:36.420

```
(a!=1) && ((b==a+p) || (b>1+a+p)) 
```

它可能不是最简单的，但应该是最易读的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-19T12:57:13.670

我不会在那个表达式中做所有的数学运算。比如 b - ( a + p ) 被计算两次。如果可能，请将它们拆分为变量。

此外，编写波兰符号树可能会帮助您优化它，您看到两次的所有内容都可以重复使用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-19T13:21:57.487

由于它们都是正整数，因此可以删除很多重复：

所以作为第一步，

```
(((a+p) <= b) && (a == 0 || a > 1) && (b >= p)) && ((b - (a + p) == 0) || (b - (a + p) > 1)) 
```

变成

```
((a+p) <= b) && (a != 1) && (b >= p)) && ((b - (a + p) != 1) 
```

为清楚起见，这只是将`(foo == 0 || foo > 1)`模式替换为`foo != 1`

该模式在上面出现了两次，一次使用 foo = a，一次使用`foo = (b - (a+p))`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-19T12:59:12.213

由于整数是无符号的，因此 (a==0 || a>1) 可以代替 (a !=1)。

通过第一遍，您可以将其简化为：

```
uint sum = a + p;
return ((sum <= b) && (a != 1) && (b >= p)) && (b - sum != 1); 
```

此外，如果您能够为变量赋予更有意义的名称，它将更具可读性。例如，如果 a 和 p 是压力，则 a+p 可以替换为 PressureSum。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-19T13:29:40.313

```
bap = b - (a + p)
bap >= 0 && bap != 1 && a != 1 
```

编辑：现在我得到了-2，因为我诚实地尝试提供帮助，而且在我看来这是一个有效的答案。对于会使用 Python 的你，这里有两个函数，一个是问题，一个是我的答案：

```
def question(a, b, p):
    return (((a+p) <= b) and (a == 0 or a > 1) and (b >= p)) or ((b - (a + p) == 0) or (b - (a + p) > 1))

def answer(a, b, p):
    bap = b - (a + p)
    return bap >= 0 and bap != 1 and a != 1 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-19T14:01:58.373

```
s = a + p
b >= s && a != 1 && b - s - 1 > 0 
```

**选中，返回与问题相同的布尔值。**

我曾经检查过的程序：（写得很开心）

```
#include <iostream>
using namespace std;

typedef unsigned int uint;

bool condition(uint a, uint b, uint p)
{
        uint s = a + p;
        return uint(    b >= s && a != 1 && b - s - 1 > 0    )
        == uint(    (((a+p) <= b) && (a == 0 || a > 1) && (b >= p))
                 && ((b - (a + p) == 0) || (b - (a + p) > 1))    );
}

void main()
{
    uint i = 0;
    uint j = 0;
    uint k = 0;

    const uint max = 50;

    for (uint i = 0; i <= max; ++i)
        for (uint j = 0; j <= max; ++j)
            for (uint k = 0; k <= max; ++k)
                if (condition(i, j, k) == false)
                {
                    cout << "Fails on a = " << i << ", b = " << j;
                    cout << ", p = " << k << endl;

                    int wait = 0;
                    cin >> wait;
                }
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-19T15:28:39.527

这就像我能得到的一样简单。

```
def calc(a, b, p):
    if (a != 1):
        temp = a - b + p
        if temp == 0 or temp < -1:
            return True
    return False 
```

也可以写成：

```
def calc(a, b, p):
    temp = a - b + p
    return a != 1 and (temp == 0 or temp < -1) 
```

或者作为：

```
def calc(a, b, p):
    temp = a - b + p
    return a != 1 and temp <= 0 and temp != -1 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-19T16:17:26.353

使用从 0 到 10000 的 a,b,p 进行测试：

```
a != 1 && a != (b-p-1) && a <= (b-p); 
```

我认为它可以进一步简化。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-19T19:43:53.880

对于原始推导中的错误，我深表歉意。当您在重构后不费心进行*单元测试时，就会发生这种情况！*

更正后的推导以测试程序的形式出现。

简短的回答是：

```
((a > 1) && (skeet == 0)) || ((a > 1) && (jon > 0) && (skeet < -1)); 
```

在哪里

```
jon = (b - p)
skeet = (a - jon); 
```

* * *

```
class Program
{
    static void Main(string[] args)
    {
        bool ok = true;
        for (int a = 1; a < 100; a++)
        {
            Console.Write(a.ToString());
            Console.Write("...");

            for (int b = 1; b < 100; b++)
            {
                for (int p = 1; p < 100; p++)
                {
                    bool[] results = testFunctions(a, b, p);
                    if (!allSame(results))
                    {
                        Console.WriteLine(string.Format(
                            "Fails for {0},{1},{2}", a, b, p));
                        for (int i = 1; i <= results.Length; i++)
                        {
                            Console.WriteLine(i.ToString() + ": " + 
                                results[i-1].ToString());
                        }

                        ok = false;
                        break;
                    }
                }
                if (!ok) { break; }
            }
            if (!ok) { break; }
        }
        if (ok) { Console.WriteLine("Success"); }
        else { Console.WriteLine("Failed!"); }
        Console.ReadKey();
    }

    public static bool allSame(bool[] vals)
    {
        bool firstValue = vals[0];
        for (int i = 1; i < vals.Length; i++)
        {
            if (vals[i] != firstValue)
            {
                return false;
            }
        }
        return true;
    }

    public static bool[] testFunctions(int a, int b, int p)
    {
        bool [] results = new bool[16];

        //given: all values are positive integers
        if (a<=0 || b<=0 || p<=0)
        {
            throw new Exception("All inputs must be positive integers!");
        }

        //[1] original expression
        results[0] = (((a+p) <= b) && (a == 0 || a > 1) && (b >= p)) && 
            ((b - (a + p) == 0) || (b - (a + p) > 1));

        //[2] a==0 cannot be true since a is a positive integer
        results[1] = (((a+p) <= b) && (a > 1) && (b >= p)) && 
            ((b - (a + p) == 0) || (b - (a + p) > 1));

        //[3] rewrite (b >= p) && ((a+p) <= b) 
        results[2] = (b >= p) && (b >= (a+p)) && (a > 1) && 
            ((b - (a + p) == 0) || (b - (a + p) > 1));

        //[4] since a is positive, (b>=p) guarantees (b>=(p+a)) so we 
        //can drop the latter term
        results[3] = (b >= p) && (a > 1) && 
            ((b - (a + p) == 0) || (b - (a + p) > 1));

        //[5] separate the two cases b>=p and b=p
        results[4] = ((b==p) && (a > 1) && ((b - (a + p) == 0) || 
            (b - (a + p) > 1))) || ((b > p) && (a > 1) && 
            ((b - (a + p) == 0) || (b - (a + p) > 1)));

        //[6] rewrite the first case to eliminate p (since b=p 
        //in that case)
        results[5] = ((b==p) && (a > 1) && ((-a == 0) || 
            (-a > 1))) || ((b > p) && (a > 1) && 
            (((b - a - p) == 0) || ((b - a - p) > 1)));

        //[7] since a>0, neither (-a=0) nor (-a>1) can be true, 
        //so the case when b=p is always false
        results[6] = (b > p) && (a > 1) && (((b - a - p) == 0) || 
            ((b - a - p) > 1));

        //[8] rewrite (b>p) as ((b-p)>0) and reorder the subtractions
        results[7] = ((b - p) > 0) && (a > 1) && (((b - p - a) == 0) || 
            ((b - p - a) > 1));

        //[9] define (b - p) as N temporarily
        int N = (b - p);
        results[8] = (N > 0) && (a > 1) && (((N - a) == 0) || ((N - a) > 1));

        //[10] rewrite the disjunction to isolate a
        results[9] = (N > 0) && (a > 1) && ((a == N) || (a < (N - 1)));

        //[11] expand the disjunction
        results[10] = ((N > 0) && (a > 1) && (a == N)) ||
            ((N > 0) && (a > 1) && (a < (N - 1)));

        //[12] since (a = N) in the first subexpression we can simplify to
        results[11] = ((a == N) && (a > 1)) || 
            ((N > 0) && (a > 1) && (a < (N - 1)));

        //[13] extract common term (a > 1) and replace N with (b - p)
        results[12] = (a > 1) && ((a == (b - p)) || 
            (((b - p) > 0) && (a < (b - p - 1))));

        //[14] extract common term (a > 1) and replace N with (b - p)
        results[13] = (a > 1) && (((a - b + p) == 0) || 
            (((b - p) > 0) && ((a - b + p) < -1)));

        //[15] replace redundant subterms with intermediate 
        //variables (to make Jon Skeet happy)
        int jon = (b - p);
        int skeet = (a - jon);   //(a - b + p) = (a - (b - p))
        results[14] = (a > 1) && ((skeet == 0) || 
            ((jon > 0) && (skeet < -1)));

        //[16] rewrite in disjunctive normal form
        results[15] = ((a > 1) && (skeet == 0)) || 
            ((a > 1) && (jon > 0) && (skeet < -1));

        return results;
    }
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-20T03:04:46.640

```
// In one line:
return (a != 1) && ((b-a-p == 0) || (b-a-p > 1))

// Expanded for the compiler:
if(a == 1)
    return false;

int bap = b - a - p;

return (bap == 0) || (bap > 1); 
```

如果您发布您正在使用的处理器，我可以优化组装。=]

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-20T11:18:15.443

jjngy 在这里是对的。这是一个证明，他的简化公式等同于使用[Coq Proof Assistant](http://coq.inria.fr)的原始公式。

```
Require Import Arith.
Require Import Omega.

Lemma eq : forall (a b p:nat),
(((a+p) <= b) /\ ((a = 0) \/ (a > 1)) /\ (b >= p)) /\ 
    ((b - (a + p) = 0) \/ (b - (a + p) > 1)) <-> 
((a + p <= b) /\ ~ (a= 1) /\ ~ (b - a - p = 1)).
Proof. intros; omega. Qed. 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-19T13:06:25.383

好

```
((b - (a + p) == 0) || (b - (a + p) > 1))

Would be better writen as:
(b - (a + p) >= 0)  

Applying this to the whole string you get:

((a+p) <= b) && (a > 1) && (b >= p)) && (b - (a + p) >= 0) 

(a + p) <= b is the same thing as b - (a + p) >= 0 
```

所以你可以摆脱那个离开：

```
((a+p) <= b) && (a > 1) && (b >= p)) 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-12-19T13:08:01.197

**第一次迭代：**

```
bool bool1 = ((a+p) <= b) && (a == 0 || a > 1) && (b >= p);
bool bool2 = (b - (a + p) == 0) || (b - (a + p) > 1);

return bool1 && bool2; 
```

**第二次迭代：**

```
int value1 = b - (a + p);
bool bool1 = (value1 >= 0) && (a == 0 || a > 1) && (b >= p);
bool bool2 = (value1 == 0) || (value1 > 1);

return bool1 && bool2; 
```

**第三次迭代（所有积极因素）**

```
int value1 = b - (a + p);
bool bool1 = (value1 >= 0) && (a != 1) && (b >= p);
bool bool2 = (value1 == 0) || (value1 > 1);

return bool1 && bool2; 
```

**第 4 次迭代（所有积极因素）**

```
int value2 = b - p;
int value1 = value2 - a;
bool bool1 = (value1 >= 0) && (a != 1) && (b - p >= 0);
bool bool2 = (value1 == 0) || (value1 > 1);

return bool1 && bool2; 
```

**第 5 次迭代：**

```
int value2 = b - p;
int value1 = value2 - a;
bool bool1 = (value1 >= 0) && (a != 1) && (value2 >= 0);
bool bool2 = (value1 == 0) || (value1 > 1);

return bool1 && bool2; 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-12-19T14:28:49.663

好吧，我希望我在这里做了我的数学，但如果我是对的，那么这会简化很多。当然，它最终看起来并不相同，但核心逻辑应该是相同的。

```
// Initial equation
(((a + p) <= b) && (a == 0 || a > 1) && (b >= p)) && ((b - (a + p) == 0) || (b - (a + p) > 1))

// ((a + p) <= b) iif a = 0 && p = b; therefore, b = p and a = 0 for this to work
(b == p) && ((b - (a + p) == 0) || (b - (a + p) > 1))

// Simplification, assuming that b = p and a = 0
(b == p) && (a == 0) 
```

[但是，如果我们在零既不是正数也不是负数](http://mathforum.org/library/drmath/view/58735.html)的假设下进行操作，那么这意味着提供给方程的任何值都将大于或等于一。这反过来意味着由于以下事实，该等式将*始终评估为假：*

```
(a == 0 || a > 1) 
```

只有当 a >= 2 时才会评估为真；但是，如果以下情况也成立：

```
(b >= p) 
```

那么这意味着 p 至少等于 b，因此：

```
((a + p) <= b) 
```

通过替换变为：

```
((2 + b) <= b) 
```

这显然永远无法评估为真。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-12-19T15:45:33.907

我将此添加为对 nickf 答案的评论，但我认为我会自己提供它作为答案。好的答案似乎都是他的变体，包括我的。但是由于我们不依赖于编译器进行优化（如果 OP 是，我们甚至不会这样做）然后将其从 3 个 AND 归结为以下意味着将有 3 个部分中只有 2 个的值将需要评估。如果这是在脚本中完成的，与编译代码相比，它会有所不同。

```
(a != 1) && ((b > (a + p + 1)) || (b == (a + p)))) 
```

根据评论，我将添加这个比 AND 版本更好的内容：

我想这取决于您的真实结果数据集是否大于输入集的 50%。输入越频繁，我的变化就会越好。因此，使用这个等式，看起来 AND 样式会更好（至少对于我的输入数据集 0-500）。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-12-19T17:38:07.627

如果 a、b 和 p 是正整数（假设正范围包括 0 值），则表达式**(((a+p) <= b) && (a == 0 || a > 1) && (b > = p)) && ((b - (a + p) == 0) || (b - (a + p) > 1))** 可以简化为**((a+p)<=b) && (a! =1)** && **((b-(a+p))!=1)**

让我演示一下：在表达式的第一部分有一个条件**((a+p)<=b)**，如果评估为 true，则第二部分为 true： **((b - (a + p) == 0 ) || (b - (a + p) > 1))**。如果**(b >=(a+p))**那么**(b - (a+p)) 必须大于或等于 0**是真的，我们需要确保**(b-(a+p))!= 1** . 把这个术语放在一边，然后继续。

现在我们可以集中精力处理第一部分 **(((a+p) <= b) && (a == 0 || a > 1) && (b >= p))** && ((b-(a+ p))!=1)

如果**a**为正，则它始终 >=0，因此如果支持 (a!=1)，我们可以放弃测试**(a == 0 || a > 1)**，并将表达式的第一部分简化为**(((a +p) <= b) && (b >= p) && (a!=1))**。

对于简化的下一步，您可以考虑如果**b >= (a+p)**那么，显然**b>=p**（**a**为正）并且表达式可以简化为

**((a+p)<=b) && (a!=1)** && **((b-(a+p))!=1)**

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-12-19T19:04:09.980

```
b >= (a+p) && a>=1 
```

even`b >= p`是多余的，因为对于`a >= 1`

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-12-19T20:31:41.177

以下逻辑如何，请评论：

```
((a == 0 || a > 1) && ((b-p) > 1) ) 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-12-20T01:46:16.050

> (((a+p) <= b) && (a == 0 || a > 1) && (b >= p)) && ((b - (a + p) == 0) || (b - (a + p) > 1))

1) (a == 0 || a > 1) 是 (a != 1)

2) (b >= p) 是 (b - p >= 0)

(a + p <= b) 是 (b - p >= a)，比 (b - p >= 0) 强。

第一个条件简化为**(a != 1) && (b - p >= a)**。

3) (b - (a + p) == 0) 是 (b - a - p == 0) 是 (b - p == a)。

(b - (a + p) > 1) 是 (b - a - p > 1) 是 (b - p > 1 + a)。

由于我们有 (b - p >= a) 并且我们正在使用 && 操作，我们可以说**(b - p >= a)**覆盖 (b - p == a && b - p > 1 + a)。

因此，整个条件将简化为

**(a != 1 && (b - p >= a))**

有一种将它进一步减少到 (b >= p) 的诱惑，但这种减少不包括禁止 b = p + 1，因此 (a != 1 && (b - p >= a)) 是条件。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-12-20T07:34:07.847

这个问题已经在实践中得到了很好的回答，但是我在下面提到了一点，我还没有看到其他人提出过。

由于我们被告知假设 a >= 0，并且第一个条件确保 b - (a + p) >= 0，所以括号中的 || 测试可以转化为针对 1 的不等式测试：

(a + p <= b) && (a != 1) && (b >= p) && (b - a - p != 1)

删除检查 (b >= p) 是很诱人的，这将给出 nickf 的表达式。这几乎可以肯定是正确的实际解决方案。不幸的是，我们需要更多地了解问题域，然后才能确定这样做是否安全。

例如，如果对 a、b 和 p 的类型使用 C 和 32 位无符号整数，请考虑 a = 2^31 + 7, p = 2^31 + 5, b = 13 的情况。我们有> 0，(a + p) = 12 < b，但 b < p。（我使用 '^' 表示求幂，而不是 C 位异或。）

可能您的值不会接近这种溢出成为问题的范围，但您应该检查这个假设。如果事实证明这是一种可能性，请添加一个带有该表达式的注释来解释这一点，这样一些热心的未来优化器就不会粗心地删除 (b >= p) 测试。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-02-05T05:51:48.433

我觉得 (a != 1) && (a + p <= b) && (a + p != b - 1) 稍微清楚一点。另一种选择是：

诠释 t = bp; (a != 1 && a <= t && a != t-1)

基本上 a 是 0、t 或介于 2 和 t-2 之间。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2011-08-29T10:20:32.787

a!=1 && ((b == a + p) || (b - p > a + 1))

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2008-12-19T19:35:50.150

```
(((a+p) <= b) && (a == 0 || a > 1) && (b >= p)) && ((b - (a + p) == 0) || (b - (a + p) > 1)) 
```

由于 a >=0（正整数），项 (a == 0 || a > 1) 始终为真

if ((a+p) <= b) then (b >= p) 当 a,b,p >=0 时为真

因此 ((a+p) <= b) && (a == 0 || a > 1) && (b >= p)) && ((b - (a + p) == 0) 减少到

```
b>=(a+p) 
```

(b - (a + p) == 0) || (b - (a + p) > 1) 等价于 b>=(a+p)

因此整个方程简化为

```
**b>= (a+p)** 
```

# sql - T-SQL 存储过程 NULL 输入值导致 select 语句失败

> ID：380889
> 
> 赞同：6
> 
> 时间：2008-12-19T12:53:27.407
> 
> 标签：sql, tsql, stored-procedures, parameters, null

下面是一个存储过程，用于根据单独检查所有字段来检查数据库中是否存在重复条目（不要问我为什么要这样做，它只是必须这样）。

这听起来非常简单，但 SP 失败了。问题是传递给 SP 的某些参数可能具有 null 值，因此 sql 应该读取“is null”而不是“= null”。我用 exec() 和 sp_executesql 尝试了 isnull()、case 语句、coalesce() 和动态 sql，但未能实现其中任何一个。这是代码...

```
CREATE PROCEDURE sp_myDuplicateCheck
 @userId int,
 @noteType char(1),
 @aCode char(3),
 @bCode char(3), 
 @cCode char(3),
 @outDuplicateFound int OUT
AS
BEGIN
SET @outDuplicateFound = (SELECT Top 1 id FROM codeTable 
                          WHERE userId = @userId
                          AND noteType = @noteType
                          AND aCode = @aCode
                          AND bCode = @bCode
                          AND cCode = @cCode 
                          )
-- Now set the duplicate output flag to a 1 or a 0
IF (@outDuplicateFound IS NULL) OR (@outDuplicateFound = '') OR (@outDuplicateFound = 0)
 SET @outDuplicateFound = 0
ELSE 
 SET @outDuplicateFound = 1
END 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-19T12:59:50.200

我认为每个可能为空的参数都需要这样的东西：

```
AND (aCode = @aCode OR (aCode IS NULL AND @aCode IS NULL)) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-19T13:38:02.590

如果我正确理解了您的问题，那么我鼓励您对以下内容进行一些研究：

```
SET ANSI_NULLS OFF 
```

如果在存储过程中使用此命令，则可以在比较中使用 = NULL。查看以下示例代码以了解其工作原理。

```
Declare @Temp Table(Data Int)

Insert Into @Temp Values(1)
Insert Into @Temp Values(NULL)

-- No rows from the following query
select * From @Temp Where Data = NULL

SET ANSI_NULLS OFF

-- This returns the rows where data is null
select * From @Temp Where Data = NULL

SET ANSI_NULLS ON 
```

每当您设置 ANSI_NULLS Off 时，最好尽快将其设置回 ON，因为这可能会影响您稍后运行的其他查询。所有 SET 命令仅影响当前会话，但根据您的应用程序，这可能跨越多个查询，这就是为什么我建议您在此查询后立即重新打开 ansi nulls。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T13:32:07.547

我认为这应该与 COALESCE 功能一起使用。试试这个：

```
CREATE PROCEDURE sp_myDuplicateCheck
 @userId int,
 @noteType char(1),
 @aCode char(3),
 @bCode char(3), 
 @cCode char(3),
 @outDuplicateFound int OUT
AS
BEGIN

SET @outDuplicateFound = (SELECT Top 1 id FROM codeTable 
                          WHERE userId = @userId
                          AND noteType = @noteType
                          AND COALESCE(aCode,'NUL') = COALESCE(@aCode,'NUL')
                          AND COALESCE(bCode,'NUL') = COALESCE(@bCode,'NUL')
                          AND COALESCE(cCode,'NUL') = COALESCE(@cCode,'NUL')
                          )
-- Now set the duplicate output flag to a 1 or a 0
IF (@outDuplicateFound IS NULL) OR (@outDuplicateFound = '') OR (@outDuplicateFound = 0)
 SET @outDuplicateFound = 0
ELSE 
 SET @outDuplicateFound = 1
END 
```

祝你好运！

杰森

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T13:22:55.787

我将首先添加一个检查以查看所有参数在运行时是否为空，即

```
IF(COALESCE(@userId, @noteType, @aCode, @bCode, @cCode) IS NULL)
   BEGIN
       -- do something here, log, print, return, etc.
   END 
```

然后在您验证用户传递了某些内容之后，您可以在 WHERE 子句中使用类似的内容

```
WHERE userId = COALESCE(@userId, userId)
AND noteType = COALESCE(@noteType, noteType)
AND aCode    = COALESCE(@aCode, aCode)
AND bCode    = COALESCE(@bCode, bCode)
AND cCode    = COALESCE(@cCode, cCode) 
```

编辑：我可能错过了如果参数作为 null 传入的意图，这意味着您明确想要测试该列是否为 null。我上面的 where 子句假设 null 参数意味着“跳过此列的测试”。

或者，我相信您可以使用原始查询并在存储过程创建时添加 ANSI_NULLS 设置选项。例如，

```
SET ANSI_NULLS OFF
GO
CREATE PROC sp_myDuplicateCheck.... 
```

实际上，这应该允许您的代码评估 column=null 而不是 column is null。我认为 Kalen Delaney 曾经将 ANSI *_NULLS 和 QUOTED_IDENTIFIER*选项创造为“粘性选项”，因为如果它们是在过程创建时设置的，它们会在运行时与过程保持一致，而不管当时的连接是如何设置的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T13:31:02.947

试试这个 ：

```
CREATE PROCEDURE sp_myDuplicateCheck
     @userId int = 0,
     @noteType char(1) = "",
     @aCode char(3) = "", 
     @bCode char(3) = "", 
     @cCode char(3) = "",
     @outDuplicateFound int OUT
    AS
    BEGIN
    SET @outDuplicateFound = (SELECT Top 1 id FROM codeTable 
                              WHERE @userId in (userId ,0)
                              AND @noteType in (noteType,"")
                              AND @aCode in (aCode , "")
                              AND @bCode in (bCode , "")
                              AND @cCode in (cCode ,"")
                              )
    -- Now set the duplicate output flag to a 1 or a 0
    IF (@outDuplicateFound IS NULL) OR (@outDuplicateFound = '') OR (@outDuplicateFound = 0)
     SET @outDuplicateFound = 0
    ELSE 
     SET @outDuplicateFound = 1
    END 
```

这基本上是在 null 的情况下为输入参数提供默认值，然后在 where 条件下*仅*在值不等于默认值时检查。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-18T15:34:36.543

`SET ANSI_NULLS OFF/On`

这样你就可以做到`colName = null`

# asp.net - 在 ASP.net 中以 ANSI 字符格式输出响应

> ID：380893
> 
> 赞同：0
> 
> 时间：2008-12-19T12:55:05.483
> 
> 标签：asp.net

我正在使用 Response.write(some byte arrary) 将数据写入输出浏览器

```
 Response.ContentType = "application/ms-excel";
        Response.ContentEncoding = System.Text.Encoding.Default;
        Response.OutputStream.Write(report, 0, report.Length);
        Response.Flush();
        Response.Close(); 
```

在我的文件中，我有 ANSI 字符，当我打开我的 excel 文件时，我需要以 ANSI 格式写入信息。我们是否需要添加任何东西。

我已将其编码为 ANSI，但它不起作用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T13:16:14.847

您说您正在编写一个字节数组，但没有“ANSI”字节之类的东西。一个字节就是一个字节。如果您正在编写字符串或字符，则只需要 ANSI 或任何其他编码。

因此，如果您的报告是代表 ANSI 文本的 byte[]，您是如何对其进行编码的？

# sql-server - 当服务器不受您的控制时，存储过程是个好主意吗？

> ID：380895
> 
> 赞同：4
> 
> 时间：2008-12-19T12:57:05.557
> 
> 标签：sql-server, security, stored-procedures

有什么方法可以在软件级别确保存储过程的一致性，以确保他们会做他们期望做的事情？

我不愿意使用存储过程，因为只要您对计算机具有管理访问权限和 Management Studio Express 的副本，就可以轻松读取和修改它们。这是客户端拥有服务器的许多安装中的常见环境，并且以前的经验告诉我，不能信任客户端（或竞争对手）来保持他们肮脏的手离开数据库。

如果可以修改存储过程来做任何事情，除非软件进行不断的检查，否则它可以默默地做它不应该做的事情，而且不会更明智。这让我感到非常不舒服——知道我无法控制软件的功能。

这是一个有效的担忧吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-19T13:13:26.553

[可以使用WITH ENCRYPTION](http://msdn.microsoft.com/en-us/library/aa258259(SQL.80).aspx)提示加密存储过程- 存在一些缺点，例如存储过程非常难以解密。

另一种选择是使用动态生成 SQL 代码的 ORM 工具（或类似工具），例如 Linq to SQL/Entities、NHibernate 等

或者您可以确保客户知道如果在数据库级别进行了任何修改，系统将不再受支持 - 这可能足以激励他们不干预。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-19T13:15:02.667

老实说，如果他们有管理员权限，存储过程只是他们搞砸软件的众多方式之一。您为什么不向客户明确表示，如果他们使用存储过程来处理它们，那么它们是不受支持的。如果他们提出问题，让他们运行您的脚本，将您的存储过程转储到文件中并让他们将其发送给您。

任何更改都意味着您将修复它，但要使用他们的一角钱，而不是您的一角钱，因为它们会导致问题。

在检查方面，我唯一能想到的就是使用已知数据运行存储过程并确保它返回您认为应该返回的内容。但这在他们的数据库上可能很难实现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T13:14:50.373

“这是一个合理的担忧吗？”

是的。存储过程是维护的噩梦，即使在本地管理的服务器上也是如此。

你真的不需要它们。设计您的应用程序，就好像您要使用存储过程一样。设计紧凑、简短的过程元素，就好像它们将作为存储过程实现一样。然后用您选择的目标语言实现它们——它将像存储过程一样快速运行。（在某些情况下，速度更快。）

有些人有轶事声称存储过程很快。这些轶事从来都不是数据库外部的焦点事务和存储过程之间的直接比较。轶事总是将一些庞大的垃圾程序与使用存储过程的修订进行比较。

它正在创建可提高性能的集中事务。这也可以在您的应用程序中完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T13:15:55.487

我不太明白你的情况。为什么你的竞争对手可以直接访问你的数据库，这样他们就可以搞砸了？

如果用户在没有咨询您的情况下手动修改您的数据库，您怎么可能支持您的应用程序？

好吧，除了正确设置存储过程权限之外，您应该将所有存储过程置于源代码管理中，并编写一个简单的脚本来删除所有（用户创建的）存储过程并用正确的存储过程填充数据库。每次您觉得有人弄乱了您的存储过程时，您只需运行脚本即可。您甚至可以将其作为计划作业运行。

但坦率地说，您不应该授予任何人直接访问数据库的权限。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T15:48:08.347

当然，这是一个合理的担忧。如果您担心存储过程被更改，您可能还应该担心数据库的其他部分！

对于存储过程，您当然应该比平时更具防御性地进行编程。当您完全控制内容时，总有一种将其视为可信媒体的诱惑。例如：在调用参数之前检查参数是否符合预期，检查字段长度是否符合预期等。

我同意上述 Pax 的观点，最好通过联系方式解决；如果客户通过“摆弄”来破坏数据库，那么他们之后将不得不支付修复费用。

您始终可以在启动时或其他任何情况下检查存储过程长度的代表性样本 - 如果事情不匹配，您可以唠叨用户。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-19T17:38:12.090

如果您授予他们管理员权限（通用），那么您无法阻止他们。但是，有一些很棒的工具，比如 RedGate SQL Compare，它可以让你比较 2 个数据库模式（比如它应该是什么与现在的快照），它会立即告诉你是否有任何变化，并且它们是什么。

如果您知道用户要添加他们自己的东西，请告诉他们一些基本规则，例如，如果他们要添加表格，请在表格名称中添加某种前缀，将其指定为他们的。同样的事情适用于存储的过程......如果他们添加新的，添加它们并带有某种前缀来指定它们。

如果您想让他们能够修改存储过程的功能，或者向表中添加列，那么您必须预先进行一些设计。您可以获取每个表，例如 TableA，并添加一个名为 TableA_User 的具有一对一关系的子表。此表包含您可能希望允许他们访问与该主表相关的任何用户数据。你也可以给他们预定义的钩子来修改你的业务逻辑的功能。例如，每次添加新的某某行时，您可以调用一个存储过程存根来传入新的行数据，并且他们可以在您将其保存到数据库之前对其进行修改。显然，这会很快变得复杂。

处理它的最佳方法是与您的客户保持响应。如果他们想要改变，请快速实施并获得报酬。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-19T13:17:53.207

我使用存储过程作为“接口”。除了性能优势（存储过程几乎总是优于即席查询）之外，它还允许我的数据库和 UI 代码之间的松散耦合。

# c# - 如何将 XPathExpression 结果保存到具有祖先结构的分隔 XML？

> ID：380911
> 
> 赞同：0
> 
> 时间：2008-12-19T13:07:19.467
> 
> 标签：c#, linq, xpath, linq-to-xml

我正在为存在于不同深度级别的某些节点解析带有 XPathExpression 选择的大型 XML 文件。

将选定节点导出到单独的 XML 文件，保留所有直接祖先节点（及其属性）的最简单方法是什么？首选 C#。

示例源 XML：

```
<a>
  <x>
  <b>
    <c/>
    <z/>
  </b>
  <c/>
</a>
<c/>
<d><e/></d> 
```

用于过滤“c”节点的预期目标 XML

```
<a>
  <b>
    <c/>
  </b>
  <c/>
</a>
<c/> 
```

编辑：我使用 XPathExpression 和 XPathNodeIterator 因为有额外的逻辑来测试给定的节点是否应该包含在结果 XML 中，仅 XPathExpression 是不够的。所以基本上我有一组匹配的 XPathNavigator 元素，我想用祖先结构将它们保存到 XML。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-19T13:20:59.253

```
string xml = @"<xml>
 <a>
  <x/>
  <b>
    <c/>
    <z/>
  </b>
  <c/>
</a>
<c/>
<d><e/></d></xml>";
    XmlDocument doc = new XmlDocument();
    doc.LoadXml(xml);
    XmlDocument results = new XmlDocument();
    XmlNode root = results.AppendChild(results.CreateElement("xml"));
    foreach (XmlNode node in doc.SelectNodes("/*/*[descendant-or-self::c]"))
    {
        root.AppendChild(results.ImportNode(node, true));
    }
    results.Save("out.xml"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T14:14:24.340

我使用了基于上述 Marc 的解决方案，并进行了少量修改：我没有使用“descendant-or-self”开关，但对于选定（和验证）的节点，我正在使用以下遍历：

```
 private void appendToOut(XmlNode node, XmlNode parameter)
    {
        if (node.ParentNode != null && node.ParentNode.NodeType != XmlNodeType.Document)
        {
            appendToOut(node.ParentNode, node);
        }
        diffRoot.AppendChild(diffDoc.ImportNode(node, node==parameter));
    } 
```

# programming-languages - 发明新语言，语法检查？

> ID：380916
> 
> 赞同：1
> 
> 时间：2008-12-19T13:08:12.163
> 
> 标签：programming-languages, code-generation

我一直在考虑一种新的编程语言。在尝试实现它之前，我想检查代码的语法，看看是否有很多歧义。（我觉得它可能对一个类做 var++++ 很有趣）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-19T13:13:40.063

以正确的格式写下语法并使用[Antlr](http://www.antlr.org/)或任何其他解析器生成器来生成解析器。这些通常会警告您注意歧义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T13:35:39.940

请记住，对于一种风格的解析器来说，有歧义的语法对于另一种风格的解析器来说不会有歧义。

如果您希望该语言为您工作，请使用您计划使用的解析器生成器进行测试。如果您希望其他人更容易实现，请使用几个不同的解析器生成器进行测试并研究它们的错误/警告，直到您确切了解它们所看到的歧义。

# apache-flex - 可调整大小的应用程序中的 Flex 工具提示定位

> ID：380917
> 
> 赞同：3
> 
> 时间：2008-12-19T13:08:47.437
> 
> 标签：apache-flex, tooltip

我们的 Flex 应用程序会随着浏览器窗口自动调整大小，我们已经非常轻松地解决了一大堆缩放问题，但剩下的一个是工具提示。它们显示在屏幕上的错误位置，未根据窗口大小正确缩放。由于工具提示是自动定位的，我们如何解决这个问题？

为了澄清我正在使用内置的 flex 工具提示。问题不在于工具提示在显示时不会随着应用程序调整大小而移动。如果我调整应用程序的大小，工具提示现在将全部显示在错误的位置，即使其他所有内容都会自动正确更新。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-31T18:52:06.597

不确定您是否找到了解决方案，但有一种更简单的方法。此代码在捕获阶段（在它显示之前）挂钩到 tooltip-show 事件，以根据包含元素的比例适当地缩放和定位它——在“这种”情况下是`parentApplication`文档。它还包括一些代码，就我而言，这些代码有助于防止工具提示在缩放时偏离舞台（因此您可能只需要前几行 -`t.scaleX`和`t.scaleY`）：

```
import mx.events.ToolTipEvent;

addEventListener(ToolTipEvent.TOOL_TIP_SHOW, handleToolTipShow, true, 0, true);

private function handleToolTipShow(event:ToolTipEvent):void
{
    if (event && event.toolTip)
    {
        var t:IToolTip = event.toolTip;

        // Scale the tip itself
        t.scaleX = this.scaleX;
        t.scaleY = this.scaleY;

        // Scale the offsets
        var xOffset:int = 10 * this.scaleX;
        var yOffset:int = 10 * this.scaleY;

        // Set the default positioning 
        t.x = parent.mouseX + xOffset;
        t.y = parent.mouseY + yOffset;

        // Set the adjusted height and width
        var th:Number = t.height * this.scaleX;
        var tw:Number = t.width * this.scaleY;

        var rightEdge:int = t.x + tw + xOffset;
        var playerRightEdge:int = parent.width;
        var bottomEdge:int = t.y + th + yOffset;
        var playerBottomEdge:int = parent.height;

        // Offscreen right
        if (rightEdge > playerRightEdge)
        {
            t.move(parent.mouseX - xOffset - tw, parent.mouseY + yOffset);
        }

        // Offscreen bottom
        if (bottomEdge > playerBottomEdge)
        {
            t.move(parent.mouseX + xOffset, parent.mouseY - yOffset - th);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-17T06:46:34.377

尝试使用 contentToGlobal() 将坐标转换为 Global

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T05:11:26.200

我认为这个问题没有很好的解决方案，因为`ToolTipManager`不知道`currentTarget`for a何时`ToolTip`更改舞台上的位置。修复几乎必须进入 Flex 框架本身。我已经将一些似乎可行但需要对 Flex 框架进行猴子修补的东西组合在一起。

1.  复制`mx.managers.ToolTipManager.as`到您`mx.managers`创建的包中的项目中。

2.  将此方法添加到文件的底部。

    ```
    public static function positionToolTip() : void {
        ToolTipManagerImpl(impl).positionTip();
    } 
    ```

3.  在应用程序的调整大小事件上调用此方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-29T03:50:51.893

[http://strutsforflex.blogspot.com/2008/03/how-to-set-custom-tooltipmanager.html](http://strutsforflex.blogspot.com/2008/03/how-to-set-custom-tooltipmanager.html) 更简单

# c# - 测量函数执行时间的最佳方法是什么？

> ID：380919
> 
> 赞同：86
> 
> 时间：2008-12-19T13:10:21.363
> 
> 标签：c#, performance, benchmarking, execution-time

显然我可以做到并且`DateTime.Now.After`-`DateTime.Now.Before`但必须有更复杂的东西。

任何提示表示赞赏。

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2008-12-19T13:12:49.723

[System.Environment.TickCount](http://msdn.microsoft.com/en-us/library/system.environment.tickcount.aspx)和[System.Diagnostics.Stopwatch](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx)类是两个适用于更精细的分辨率和直接使用的类。

也可以看看：

*   [DateTime.Now 是衡量函数性能的最佳方法吗？](https://stackoverflow.com/questions/28637/is-datetimenow-the-best-way-to-measure-a-functions-performance)
*   [.NET 中的高分辨率计时器](https://stackoverflow.com/questions/163022/high-resolution-timer-in-net)
*   [Environment.TickCount 与 DateTime.Now](https://stackoverflow.com/questions/243351/environmenttickcount-vs-datetimenow)
*   [在 Windows 中对程序进行基准测试的最佳方法是什么？](https://stackoverflow.com/questions/145103/whats-the-best-way-to-benchmark-programs-in-windows)

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-12-19T13:14:26.553

我肯定会建议你看看`System.Diagnostics.Stopwatch`

当我四处寻找有关秒表的更多信息时，我发现了这个网站；

[小心秒表](http://kristofverbiest.blogspot.com/2008/10/beware-of-stopwatch.html)

还有提到另一种可能

> Process.TotalProcessorTime

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-19T13:18:02.067

**使用探查器**

您的方法仍然有效，但如果您正在寻找更复杂的方法。我建议使用[C# Profiler](http://dotnet.jku.at/projects/Prof-It/)。

他们拥有的优势是：

*   您甚至可以获得语句级别的拆分
*   您的代码库无需更改
*   仪器通常具有非常少的开销，因此可以获得非常准确的结果。

也有许多可用[的开源](http://csharp-source.net/open-source/profilers)软件。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-19T13:16:19.200

Tickcount 很好，但我建议运行 100 或 1000 次，然后计算平均值。不仅使它更可测量 - 在真正快速/短功能的情况下，而且有助于处理由开销引起的一些一次性影响。

# zend-framework - Zend Zend_File_Transfer_Adapter_Http 重命名问题

> ID：380921
> 
> 赞同：5
> 
> 时间：2008-12-19T13:10:48.900
> 
> 标签：zend-framework, zend-file

我有一个关于在 Zend 中上传文件后重命名文件的问题。我不知道在哪里放置重命名过滤器。这就是我所拥有的。我试过移动东西，但我迷路了。目前它确实将文件上传到我的照片文件夹，但它不会重命名它。谢谢你的帮助！

```
if($this->_request->isPost()) 
{
    $formData = $this->_request->getPost();

    if ($form->isValid($formData)) 
    {
        $adapter = new Zend_File_Transfer_Adapter_Http();
        $adapter->setDestination(WWW_ROOT . '/photos');

        $photo = $adapter->getFileInfo('Photo');

        $adapter->addFilter('Rename', array(
            $photo['Photo']['tmp_name'], 
            WWW_ROOT . '/photos/' . $this->memberId . '.jpg', 
            true
        )); 

        if ($adapter->receive()) 
        {
            echo 'renamed';
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-10-28T23:25:09.380

实际上，有一种更简单的方法可以做到这一点。您需要做的就是传递 false 作为 Zend_File_Transfer_Adapter_Http 对象的 getFileName 方法的第二个参数。然后，您可以通过向文件附加用户 ID 来重命名文件，或者解析文件名以获取扩展名（如果您也喜欢的话）。

```
// upload a file called myimage.jpg from the formfield named "image".

$uploaded_file = new Zend_File_Transfer_Adapter_Http();
$uploaded_file->setDestination('/your/path/');
    try {
        // upload the file
        $uploaded_file->receive();
    } catch (Zend_File_Transfer_Exception $e) {
        $e->getMessage();
    }
$file_name = $uploaded_file->getFileName('image', false);
// this outputs "myimage.jpg"

$file_path = $uploaded_file->getFileName('image');
// this outputs "/your/path/myimage.jpg"

// now use the above information to rename the file 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T09:49:18.453

我设法通过设置过滤器来做到这一点。请注意，我没有设置目标路径。

```
$adapter= new Zend_File_Transfer_Adapter_Http();
$adapter->addFilter('Rename',array('target' => WWW_ROOT . '/photos/' . $this->memberId . '.jpg'));

$adapter->receive(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T10:35:23.750

根据文档，您不应该将路径放在目的地

[链接文本](http://framework.zend.com/manual/en/zend.file.transfer.filters.html#zend.file.transfer.filters.rename)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-24T16:07:24.440

Zend 框架有一种更好、更安全的方法......

创建帮助类来检索文件扩展名。.

类图像上传 {

```
public function getExtension ($name)
{
    if($name){
    foreach ($name as $val){
        $fname=$val['name'];
      }
    $exts = split("[/\\.]", $fname) ;
    $n = count($exts)-1;
    $exts = $exts[$n];
    return $exts; 
    }

} 
```

}

在控制器中：

类 ProfileController 扩展 Zend_Controller_Action { function indexAction() { $this->view->title = "Profile"; $this->view->bodyCopy = "

请填写此表格。

";

```
 $form = new ImgForm();

    if ($this->_request->isPost()) {
        $formData = $this->_request->getPost();
        if ($form->isValid($formData)) {
                $adapter = new Zend_File_Transfer_Adapter_Http();
                $adapter->setDestination('images/users/big');

                // getting extension

                $filename = $adapter->getFileInfo();
                $uhelper = new ImageUpload;  // cals for help to get file extension
                $extension = $uhelper->getExtension($filename); // got extension   

                 // success -- file handled

                 //rename
                 $auth = Zend_Auth::getInstance();
                 $identity = $auth->getIdentity();

                 $adapter->addFilter('Rename', array('target' => 'images/users/big/'.$identity->id.'.'.$extension,
                     'overwrite' => true));

                if (!$adapter->receive()) {
                 $form->addError($adapter->getMessages());

                }

        } else {
            $form->populate($formData);
        }
    }

    $this->view->form = $form;

} 
```

当你的表格应该是：

```
 parent::__construct($options);
    $this->setName('upload');
    $this->setAttrib('enctype', 'multipart/form-data');

    $file = new Zend_Form_Element_File('file');
    $file->setLabel('File')
          ->addValidator('Count', false, 1)     // ensure only 1 file
          ->addValidator('Size', false, 102400) // limit to 100K
          ->addValidator('Extension' ,false, 'jpg,png,gif') // only JPEG, PNG, and GIFs

          ->setRequired(true);          

    $submit = new Zend_Form_Element_Submit('submit');
    $submit->setLabel('Upload');

    $this->addElements(array($file, $submit));

} 
```

}

玩得开心

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-23T05:55:46.487

```
public function getExtension($name){
    $names= explode(".", $name);
    return $names[count($names)-1];
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T23:21:44.633

在调用适配器之前，我必须拦截 $_FILES 并进行更改

```
if(isset($_FILES['file1'])){
  $ext = pathinfo($_FILES['file1']['name']);
  $_FILES['file1']['name'] = 'image_'. $userid .'.'.$ext['extension'];
}
$adapter = new Zend_File_Transfer_Adapter_Http(); 
```

我确定有更好的方法，但我不知道为什么过滤器不起作用我已经尝试了一切以使其正常工作。我有一个截止日期，所以上面的代码开始生产 LOL

希望它可以帮助某人

埃里克

# php - 使用 PHP 将 Base64 字符串作为二进制文件保存到磁盘

> ID：380922
> 
> 赞同：14
> 
> 时间：2008-12-19T13:10:49.367
> 
> 标签：php, binary, base64

作为我自己的“幕后研究”教程，我正在构建一个 PHP 脚本来从 POP3 邮箱收集电子邮件。在尝试使用二进制附件时，我一直在试图弄清楚如何处理附件信息。

给定一个从电子邮件中收集的字符串：

> ------=_Part_16735_17392833.1229653992102 内容类型：图像/jpeg；name=trans2.jpg 内容传输编码：base64 X-附件 ID：f_fow87t5j0 内容处置：附件；文件名=trans2.jpg
> 
> /9j/4AAQSkZJRgABAgEASABIAAD/4QxrRXhpZgAATU0AKgAAAAgABwESAAMAAAABAAEAAAEaAAAUA AAABAAAAYgEbAAUAAAABAAAAagEoAAMAAAABAAIAAAExAAIAAAAUAAAAcgEyAAIAAAAUAAAAhodp
> 
> (...)
> 
> EAgEAgEAgEAgEAg8IBQRL/Lbe/tJrScHqZ2lkmE4XUP2XcSDZZ2VvZ28dtbsDIYmhkbRxAIJCAQC AQCAQf/ScyAQCAQCAQCAQCAQCAQCAQCAQCAQCAQf/9k= ------=_Part_16735_17392833.1229653992102--

有没有办法将数据保存到磁盘，使其成为可用的格式？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-12-19T13:28:36.163

将数据传递给[base64_decode()](http://php.net/base64_decode)以获取二进制数据，使用[file_put_contents()将其写入文件](http://php.net/file_put_contents)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-20T03:51:33.320

如果您有大量数据需要在写入之前进行解码，我建议您使用流过滤器，以便在写入数据时解码数据......

```
$fh = fopen('where_you_are_writing', 'wb');
stream_filter_append($fh, 'convert.base64-decode');

// Do a lot of writing here. It will be automatically decoded from base64.

fclose($h); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-05-16T22:01:18.137

我尝试了以下但对我不起作用，正在生成一个空图像文件。

```
file_put_contents('img.png', base64_decode($base64string)); 
```

这就是它对我的工作方式：

```
$data = 'data:image/png;base64,AAAFBfj42Pj4';

list($type, $data) = explode(';', $data);
list(, $data)      = explode(',', $data);
$data = base64_decode($data);

file_put_contents('/tmp/image.png', $data); 
```

我的代码来自： [如何从 base64 数据字符串中保存 PNG 图像服务器端](https://stackoverflow.com/questions/11511511/how-to-save-a-png-image-server-side-from-a-base64-data-string)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-04-26T07:31:38.603

```
function base64_decode_file($data)
{
    if(preg_match('/^data\:([a-zA-Z]+\/[a-zA-Z]+);base64\,([a-zA-Z0-9\+\/]+\=*)$/', $data, $matches)) {
        return [
                'mime' => $matches[1],
                'data' => base64_decode($matches[2]),
        ];
    }
    return false;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T13:20:11.797

切掉第一行和最后一行，**base64decode**并保存在给定的文件名下。

完毕。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-19T19:11:18.000

虽然重新发明轮子具有一定的娱乐和教育价值，但我会尽量抵制诱惑：[Mailparse](http://pecl.php.net/package/mailparse)、[Mail_mimeDecode](http://pear.php.net/package/Mail_mimeDecode)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-21T21:20:30.773

我有类似的情况，这就是我所做的。如前所述，请确保删除 base64 字符串前后的多余行。

```
<?php
$INPUT = "inputfile_base64_encoded.txt";
$OUTPUT = "output_decoded.zip";
$contents = file_get_contents($INPUT);
$bin = base64_decode($contents);
file_put_contents($OUTPUT, $bin);
?> 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2017-09-13T16:10:24.150

对于来自数据库的大 base64 字符串，您需要使用 load()

```
$imgdata = $FromDB['BASE64']->load();
$imgdata =  base64_decode($imgdata);
file_put_contents($fileName, $imgdata); 
```

# .net - .NET 是否有任何时间范围选择器 Web 控件？

> ID：380923
> 
> 赞同：1
> 
> 时间：2008-12-19T13:10:54.657
> 
> 标签：.net, iphone

我想在网页中使用时间范围选择器，该选择器针对触摸屏使用进行了优化。（例如大按钮）。我实际上正在寻找一个模仿 iPhone UI 的控件来选择时间范围或时间间隔，比如从上午 10:30 到下午 15:00。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-19T14:10:16.283

我不知道 iPhone UI - 我没有 - 但这[是](http://sourceforge.net/projects/recurrence-net/)一个非常好的时间框架/重复库。它可能会有所帮助:)

# postgresql - 如何使用 sql 或 phpPgAdmin 更改 PostgreSQL 数据库的数据库编码？

> ID：380924
> 
> 赞同：28
> 
> 时间：2008-12-19T13:11:55.417
> 
> 标签：postgresql, phppgadmin

如何使用 sql 或 phpPgAdmin 更改 PostgreSQL 数据库的数据库编码？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-12-19T13:21:37.160

简而言之，您不能只使用 phpPgAdmin 或 SQL 来执行此操作而不会冒**现有数据损坏**的风险。您必须导出所有数据，使用正确编码创建数据库并恢复导出的数据。

这是你应该如何继续：

1.  **创建数据库转储**：

    `pg_dump your_database > your_database.sql`

    这将以 sql 格式保存您的数据库，使用您当前拥有的编码。

2.  **删除数据库**（或重命名）：

    `DROP DATABASE your_database`

    如果您有足够的存储空间，我建议您保留旧数据库，直到您确定新数据库一切正常，**重命名**它：

    `ALTER DATABASE your_database RENAME TO your_database_backup;`

3.  **使用新编码创建数据库**：

    `CREATE DATABASE your_database WITH ENCODING 'UNICODE' TEMPLATE=template0;`

4.  **从之前创建的转储导入数据**：

    `PGCLIENTENCODING=YOUR_OLD_ENCODING psql -f your_database.sql your_database`

    您需要将 psql 客户端编码设置为旧数据库中的编码。

即时更改编码是不可能的，因为它需要重写大部分内部数据库数据，这几乎等于我描述的重新创建数据库的方式。

可以仅更改有关数据库的内部 postgres 信息，并且此更改后的任何新数据都将正确保存，但是您现有的数据**可能会损坏**。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2015-08-15T06:32:53.673

您可以在不转储/恢复的情况下即时更改编码：

```
update pg_database set encoding = pg_char_to_encoding('UTF8') where datname = 'database_name' 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-08-20T18:25:35.953

要扩展给出的答案，您可以使用这些命令来完成您的任务。

```
// Backup the database to outfile
pg_dump dbname > outfile

// Terminate all connections to the database
psql -c "SELECT pg_terminate_backend(pid) FROM pg_stat_activity WHERE datname='dbname';"

// Delete the database
psql -c "DROP DATABASE dbname;"

//Re-create the database using the encoding keyword
psql -c "CREATE DATABASE dbname ENCODING='UTF8';"

//Import the saved data
psql -f outfile 
```

转储数据库：[http ://www.postgresql.org/docs/9.4/static/backup-dump.html](http://www.postgresql.org/docs/9.4/static/backup-dump.html)

创建数据库：[http ://www.postgresql.org/docs/9.4/static/sql-createdatabase.html](http://www.postgresql.org/docs/9.4/static/sql-createdatabase.html)

这是 9.4 版可用的所有编码的列表： [http ://www.postgresql.org/docs/9.4/static/multibyte.html#MULTIBYTE-CHARSET-SUPPORTED](http://www.postgresql.org/docs/9.4/static/multibyte.html#MULTIBYTE-CHARSET-SUPPORTED)

# asp.net - 拥有本地化提供程序还是在 ASP.NET 中的 ResourceProvider 之上构建？

> ID：380937
> 
> 赞同：1
> 
> 时间：2008-12-19T13:15:37.673
> 
> 标签：asp.net, localization

要在 ASP.NET 中使用内置的本地化（资源提供程序），如果我正确阅读了文档，则只能处理翻译后的字符串（请参阅没有用户定义参数的 GetString("key", locale)）。

最好的方法是构建一个可以处理 GetString("key", locale, parameters) 等参数的自定义资源提供程序？为了使用它，我更改了不好的 API，因为 ResourceProvider 对开发人员来说总是应该是相同的，唯一可以/应该不同的是后端。

我看到的第二种选择是构建从 ProviderBase 派生的新提供者，或者可能创建一个不派生自任何东西的类。

你怎么看？我应该向资源提供者添加方法还是构建新的东西？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T13:41:52.550

你可以：

a) 使用占位符存储本地化字符串，{0}、{1}、...、{n}，然后将使用 string.Format() 或

b) 使用您自己的占位符（{FirstName}、{LastName}、{JobTitle} 等），然后在您自己的方法中将它们替换为实际值。翻译人员可以移动占位符（因为句子的构建方式因语言而异）。

我不确定你想要这些参数做什么，但我想这是关于上面 b) 中的场景。

# .net - .NET方法将一个数字四舍五入到另一个数字的最接近的倍数？

> ID：380944
> 
> 赞同：13
> 
> 时间：2008-12-19T13:17:35.563
> 
> 标签：.net, rounding

我正在寻找一种可以将一个数字四舍五入*到*另一个最接近的倍数的方法。这是类似的量化。

例如。如果我想将 81 舍入到最接近的 20 的倍数，它应该返回 100。

.NET 框架中是否有内置方法可以用于此目的？

我要求内置方法的原因是因为它很有可能已经被优化了。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-19T13:21:55.227

是的，整数算术。

要将 m 向上舍入为 n 的下一个倍数，请使用 ((m+n-1)/n)*n

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-19T13:22:38.283

```
public static int RoundUp(int num, int multiple)
{
  if (multiple == 0)
    return 0;
  int add = multiple / Math.Abs(multiple);
  return ((num + multiple - add) / multiple)*multiple;
}

static void Main()
{
  Console.WriteLine(RoundUp(5, -2));
  Console.WriteLine(RoundUp(5, 2));
}

/* Output
 * 4
 * 6
*/ 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-07-28T12:04:44.003

李的回答很好，但应该是：

```
t = m + n - 1; return (t - (t % m)); 
```

注意从`N`到的变化`M`。模运算应该用乘数`(m)`而不是数字来完成`(n)`。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-26T00:47:10.883

如果您在相对较慢的平台上使用其中的很多，您可以通过使用以下变体来消除乘法：

t = m + n - 1；返回 (t - (t % n));

当然，如果您可以将倍数限制为 2^n 的值，那么模数运算也可能会被弃用，取而代之的是它的逻辑等价物（通常是“&”）。

顺便说一句，上面说明的“RoundUp”函数存在严重缺陷，只有在 {(m % n) == (n - 1)}; 时才能正确向下舍入。向下舍入对于整数除法是隐含的，因此不需要补偿。

# active-directory - 微软活动目录端口

> ID：380951
> 
> 赞同：3
> 
> 时间：2008-12-19T13:18:57.433
> 
> 标签：active-directory, port, firewall, ports

您需要在防火墙中打开哪些端口才能将远程 Windows 计算机连接到防火墙后面的 Microsoft Active Directory 服务器域？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-19T13:35:51.703

1.  TCP 135：MS-RPC
2.  TCP 1025 & 1026 : AD 登录 & 复制
3.  TCP 389：LDAP
4.  TCP & UDP 53：DNS
5.  TCP 445：SMB，微软-ds
6.  TCP 139：中小企业
7.  UDP 137 & 138 : NetBIOS 相关
8.  UDP 88：Kerberos v5

请参阅： http: [//msmvps.com/blogs/rexiology/archive/2006/04/05/89389.aspx](http://msmvps.com/blogs/rexiology/archive/2006/04/05/89389.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-19T13:38:36.503

我认为您应该为此使用VPN，而不是打开防火墙。考虑使用路由和远程访问或专用 VPN 硬件解决方案设置防火墙。

# java - 转换为在运行时确定的类

> ID：380952
> 
> 赞同：5
> 
> 时间：2008-12-19T13:20:01.190
> 
> 标签：java, generics, reflection, casting, reification

我有一个方法`fetchObjects(String)`可以返回一个`Contract`业务对象数组。`className`参数告诉我应该返回什么样的业务对象（当然这在这种解释的情况下没有意义，因为我已经说过我会返回s `Contract`，但这基本上是我在真实场景中的情况）。因此，我从某处获取条目集并加载集合条目的类（其类型由 指定`className`）。

现在我需要构造要返回的数组，所以我使用`Set`'s`toArray(T[])`方法。使用反射，我为自己构建了一个空的 Contracts 数组。*但是，*这给了我一个静态类型的值`Object`！所以接下来我需要将它转换为适当的类型，在这种情况下是`Contract[]`（参见下面清单中的“星号下划线”部分）。

我的问题是：有没有办法以及如何`Contract[]`像我在清单中那样转换，但*只能通过*（或）*确定数组元素（）的类型`Contract``className`*`entriesType`？换句话说，我想做的基本上是这样的：`(entriesType[]) valueWithStaticTypeObject`，其中 entriesType 被通过`classname`参数指定的类替换，即`Contract`。

这在某种程度上是不可能的，还是可以以某种方式完成？也许使用泛型？

```
package xx.testcode;

import java.util.HashSet;
import java.util.Set;

class TypedArrayReflection {

    public static void main(String[] args) {
        try {
            Contract[] contracts = fetchObjects("Contract");
            System.out.println(contracts.length);
        } catch (ClassNotFoundException e) {}
    }

    static Contract[] fetchObjects(String className) throws ClassNotFoundException {
        Class<?> entriesType = Class.forName("xx.testcode."+className);
        Set<?> entries = ObjectManager.getEntrySet(className); 
        return entries.toArray( 
                (Contract[]) java.lang.reflect.Array.newInstance(
                /********/          entriesType, entries.size()) );
    }
}

class Contract { } // business object

class ObjectManager {
    static Set<?> getEntrySet(String className) {
        if (className.equals("Contract"))
            return new HashSet<Contract>();
        return null; // Error
    }
} 
```

谢谢。

* * *

**更新：**`toArray`使用来自[CodeIdol](http://codeidol.com/java/javagenerics/Reification/The-Principle-of-Truth-in-Advertising/)的类型安全方法，我更新了我的`fetchObjects`方法：

```
static Contract[] fetchObjects(String className) throws ClassNotFoundException {
    Class<?> entriesType = Class.forName("xx.testcode."+className);
    Set<?> entries = ObjectManager.getEntrySet(className);
    return toArray(entries, entriesType); // compile error
    // -> "method not applicable for (Set<capture#3-of ?>, Class<capture#4-of ?>)"
}

public static <T> T[] toArray(Collection<T> c, Class<T> k) {
    T[] a = (T[]) java.lang.reflect.Array.newInstance(k, c.size());
    int i = 0;
    for (T x : c)
        a[i++] = x;
    return a;
} 
```

我需要做什么才能摆脱评论中引用的编译器错误？我是否必须`Set<Contract>`在我的方法的返回类型中指定`getEntrySet`才能使它起作用？感谢您的任何指示。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-19T13:29:19.127

您可以使用类作为参数而不是类名。

```
 static <T extends Contract> T[] buildArray(Class<T> clazz){
     ArrayList<T> l=new ArrayList<T>();
     return l.toArray((T[]) java.lang.reflect.Array.newInstance(clazz, l.size()));
   } 
```

编辑：（阅读杨评论后）

不，您不能将泛型类型与变量的值一起使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T14:44:51.190

那么为什么不使用

```
static <T> T[] buildArray(Class<T> clazz){
ArrayList<T> l=new ArrayList<T>();
return l.toArray((T[]) java.lang.reflect.Array.newInstance(clazz, l.size()));
} 
```

笔记。修改了上面的代码。

# unit-testing - 包含条件条件的单元测试方法的最佳实践

> ID：380962
> 
> 赞同：1
> 
> 时间：2008-12-19T13:22:55.053
> 
> 标签：unit-testing, conditional

我是单元测试的新手，目前在寻找一种体面的方法来测试包含分支的方法时遇到了问题。

我创建了一个小演示方法，希望可以用来解释问题。

```
public void ExportAccounts()
{
     int emptyAccounts = 0;
     int nonEmptyAccounts = 0;
     int errorous = 0;
     string outputPath = this.GetOutputPath();
     Account[] accounts = this.MyWebserviceAdapter.GetAccounts();
     foreach(Account account in accounts)
     {
        try 
        {
          if(account.Amount > 0)
          {
               this.ExportNonEmpty(outputPath, account);
               nonEmptyAccounts++;
          } else {
               this.ExportEmptyAccount(outputPath, account);
               emptyAccounts++;
          }
        } catch(Exception e) {
          logger.error(e);
          errorous++;
        }
     }
     logger.debug(string.Format("{0} empty / {1} non empty / {2} errorous", emptyAccounts, nonEmptyAccounts, errorous));
} 
```

我可以模拟 MyWebserviceAdapter 以返回预定义的帐户列表。我应该在同一个测试中输入一个空的和非空的帐户列表，还是应该有单独的测试？

我的 ExportNonEmpty() 和 ExportEmpty() 方法也是私有的，但确实将文件写入文件系统。我应该提供一个模拟 FileProvider 以便不触及文件系统吗？

我应该公开 ExportNonEmpty() 和 ExportEmpty() 以便能够单独测试它们吗？这些方法还包含一些 if-then-else 语句，并且可以抛出异常等等。

我发现如果我为每个代码路径创建一个测试，我将代码从一个测试复制到另一个测试 - 生成模拟等..这不是有点奇怪吗？

我应该将计数器变量公开为输出变量，以便在调用方法后能够验证它们吗？

this.GetOUTputPath() 通过静态的 ConfigurationManager 从配置文件中获取值。我应该 a) 通过为 testt 下的类创建部分模拟并覆盖 GetOutputPath 方法来模拟它，还是 b) 创建我自己的可以模拟的 ConfigurationAdapter？

我正在使用 nunit 和 Rhino Mocks。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T13:33:28.637

我将使用几个测试向量对此进行测试：全空、全非空以及以空和非空开始和结束的混合。

至于验证结果：暴露和测试计数器将给出一个“白盒”测试，该测试知道对象的内部状态，这给出了更彻底的测试，但使得以后更改实现更加困难. （如果您更改实现，即使效果相同，测试也可能会失败）。

我的偏好通常是测试«黑匣子»，并且只测试操作的外部可观察结果。然后，如果公开的功能仍然相同，您可以更改内部结构和回归测试。但是，这可能需要更多的模拟编码。

对于java，有很多库可以帮助您构建模拟对象，我不了解.net，但我认为情况也是如此。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-19T13:35:03.967

对每个条件进行单独的测试。我假设您相信 foreach 会遍历包含两者的循环。我会。大概您正在测试您在其他地方模拟的方法，以确保它在存在时正确返回两种类型的帐户。

您可以通过将通用代码提取到测试类的方法中，甚至提取到 TestHelper 类中来重构，而不是复制代码。如果需要，请对它们进行参数化以使它们普遍可用。

您应该能够通过为被测类添加访问器来测试您的私有方法。如果您在私有方法中使用“创建单元测试”右键单击菜单项，或者在为整个类添加时简单地将私有方法添加为一个以创建单元测试，则会自动添加一个。对于测试 ExportAccounts，只需使用您知道会引发和不会引发异常的数据，以便您可以测试直线逻辑和异常处理。

我不会公开方法变量。在方法之外不需要它们。但是，您应该模拟记录器以确保使用预期的参数调用它。

创建 ConfigurationAdapter（或 Wrapper）并将其注入您的类以消除对静态类的依赖。模拟适配器或提供虚假的实现，由您选择。无论如何，删除依赖项是一个很好的模式。我不喜欢在被测类中模拟或存根任何东西。

**编辑：**对于单元测试的基本阅读，我会推荐[实用单元测试](http://www.pragprog.com/titles/utc2/pragmatic-unit-testing-in-c-with-nunit)（C# 版本）和[代码完成](http://cc2e.com)中的单元测试一章。您可能还想[学习 .Net 中的测试驱动开发](http://www.microsoft.com/learning/en/us/books/6778.aspx)，但其他更通用。

# windows - Windows Vista 是用什么编程语言编写的？

> ID：380988
> 
> 赞同：2
> 
> 时间：2008-12-19T13:37:07.300
> 
> 标签：windows, windows-vista, operating-system

使用哪种编程语言对 Windows Vista 进行编码？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-19T13:40:12.507

好吧，Windows 内核仍然几乎完全是 C。但是，有不同的方面使用 C++，比如 shell 的某些部分等等。核心是 C。其他语言，甚至可能在某些应用程序的某些角落使用 .NET，但 C 是 Windows 中选择的操作系统语言。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-19T14:25:04.413

从使用 Windows CE 操作系统开始，我会说它混合了用于老式代码和接口的 C，以及用于驱动程序和其他代码的大量 C++。它（WinCE）在系统其余部分的 C 接口后面的驱动程序中使用 C++。

现在我要猜测并说现在其中也有很多 C# 和其他代码。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-19T13:40:56.640

将使用多种语言来创建 Vista。

对于低级部分，C 和汇编语言。

大多数是 C/C++。

一些更高级别的应用程序可能是用托管代码编写的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-19T13:40:12.663

我会想象 C/C++ 和 Assembly 的组合（用于设备交互）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-19T13:43:19.503

据我所知，[Windows Research Kernel](http://www.microsoft.com/resources/sharedsource/windowsacademic/researchkernelkit.mspx)（即 afaik，基于 XP）是用 C 编写的。我认为其余部分也是。但是，仅仅因为内核是用 C 编写的，并不意味着整个操作系统都是。还有一些库、工具和应用程序，如果没有这些，Windows 将毫无用处。其中，我*假设*大多数是用 C、C++ 或 C# 编写的，尽管这只是一个假设。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T21:31:55.673

Garry 永远是对的，如果微软否认 C 被替换，他们真的应该在继续之前与他核实一下。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-03-28T21:01:23.600

Windows vista 以多种语言编程用于不同的事物。整个内核是用 C 编写的，而其他部分使用 C++，可能也是 .NET。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2010-12-10T16:55:51.877

如 Vista 使用规则及其定义中所述，Vista 操作系统有多种变体可供在英格兰和坎多哈等地使用。有些被编码为用于家庭计算的 RCODE，而另一些可能已被编码为 COMAL、VBAS 或 ICODE，用于基于某些计算机基本单元中使用的 Commodore (CBM) 63 的计算机。高级语言编译成的内容是保密的，由英国的作者保留，该团队支持微软为其他国家/地区创建的版本，安装在计算机上以供在工作场所使用的版本具有不同的内部保护政策遵守隐私规则的业务数据。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2011-08-11T16:18:12.977

好吧，看了大部分评论，这里有很多好人只用 C 来做这件事，是的，世界上大多数内核都是用强大的编程语言 C 编写的，当然还有汇编用于磁盘和视频接口以及一些内存 (DMA)。

# c++ - 嵌入式 Windows XP 中的网络接口设置

> ID：380990
> 
> 赞同：3
> 
> 时间：2008-12-19T13:38:03.213
> 
> 标签：c++, c, winapi, networking, windows-xp-embedded

给定设备描述（即出现在“设备属性 -> 连接方式：”文本框中的字符串），我们如何获得网络接口名称（即出现在“网络连接”对话框中的名称）？

我们必须使用纯 C/C++ 语言或通过一些标准命令行工具（例如 netsh、ipconfig...）或两者的组合来完成。

我们不能使用 .NET API，因为部署问题（应用程序必须在没有 .NET Framework 的嵌入式 XP 上运行）。

SDK API GetIfTable 和 GetIfEntry 看起来很有希望，但在我们的系统上，所有 MIB_IFROW 字段都已正确填写，除了 "wszName" 字段未初始化。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-07T00:04:55.600

我能够通过注册表做到这一点。使用提供 IP_ADAPTER_INFO 输出的 GetAdaptersInfo()，获取 AdapterName 字符串。这应该是适配器的 GUID。对于（至少为 ipv4），在 HKLM\SYSTEM\CurrentControlSet\Control\Network{4D36E972-E325-11CE-BFC1-08002BE10318}\{ *INSERT GUID HERE* }\Connection 下，值*Name*应包含“友好”网络名称。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T20:32:41.440

最好的办法是使用统称为“ [IP Helper](http://msdn.microsoft.com/en-us/library/aa366073(VS.85).aspx) ”的 Win32 API 调用。这将为您提供从 CLI 调用“ipconfig”可以获得的所有相同信息。

特别是，我将首先查看“ [GetAdaptersInfo](http://msdn.microsoft.com/en-us/library/aa365917(VS.85).aspx) ”函数。

当然，由于 Win32 API 的这一部分，您可以使用纯 C/C++ 而无需解析来自外部实用程序的输出。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T15:27:52.570

我将不得不仔细检查，但我认为这可能在某个地方的注册表中......我会回到这个。

hklm/系统/currentcontrolset/控制/网络

可能有帮助。

我没有找到我想的，对不起

编辑这也可能有帮助：

[http://www.java2s.com/Tutorial/CSharp/0520__Windows/Getthenetworkdevicenamedeviceservicename.htm](http://www.java2s.com/Tutorial/CSharp/0520__Windows/Getthenetworkdevicenamedeviceservicename.htm)

特别是：HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkCards\

我不知道这是否可以保证未来，或者不是“批准”的方法，但它似乎有你需要的信息。*************