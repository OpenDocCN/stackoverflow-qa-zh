# StackOverflow 问答 000367000-000367999

# cocoa - 导致大幅减速的临时文本属性

> ID：367001
> 
> 赞同：2
> 
> 时间：2008-12-14T21:17:41.497
> 
> 标签：cocoa, macos, optimization

我正在使用我发布的作为[此问题](https://stackoverflow.com/questions/300086/display-hidden-characters-in-nstextview)答案的代码将 NSTextView 中的隐藏字符显示为项目符号。

我使用 NSLayoutManager 的 addTemporaryAttributes:forCharacterRange: 方法将项目符号着色为灰色。每个范围的长度为 1，并为单个项目符号着色。（我使用的大多数相同文本的相邻隐藏字符相对较少，尽管这是我计划在未来进行的优化。）

这种变化有很多不利影响。滚动文本视图变得缓慢而生涩，尤其是对于具有许多隐藏字符的文本。如何在不影响性能的情况下为部分文本着色？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-14T21:38:36.057

滚动时最大的打击是因为每次滚动视图滚动时，它都会重新绘制视图，并且通过扩展重新着色整个文档。因为，在单次滚动操作期间，滚动视图滚动了几个像素，只需`n`向上或向下滚动像素就会重新着色*整个*文档`n`时间！

我建议确保您只对屏幕上的文本进行着色。您要做的最后一件事*是*为已滚动到视野之外的角色添加属性，因为此时它基本上是浪费循环。

您可以从文本视图中获取可见文本的范围：

```
- (NSRange)visibleRange
{
    NSRect visibleRect = [textView visibleRect];

    NSRange glyphVisibleRange = [[textView layoutManager] glyphRangeForBoundingRect:visibleRect inTextContainer:[textView textContainer]];
    NSRange charVisibleRange = [[textView layoutManager] characterRangeForGlyphRange:glyphVisibleRange  actualGlyphRange:nil];
    return charVisibleRange;
} 
```

因此，当您进行着色时，仅对落在此范围内的字形进行着色。这应该可以将您的滚动性能提高几个数量级。

# css - 浮动元素之前不显示标题

> ID：367007
> 
> 赞同：0
> 
> 时间：2008-12-14T21:23:56.523
> 
> 标签：css, internet-explorer-7, css-float

在[http://tesselaar.com/gallery/](http://tesselaar.com/gallery/)页面上，我在“照片库”页面顶部有一个标题（1 级），它在 IE7 中不显示，我不知道为什么。

它遵循与网站其余部分相同的 CSS 和页面结构，唯一的区别是元素在之后立即浮动到右侧。

任何见解将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T08:46:59.390

对我来说，它确实出现了故障，但是在这里只安装了 IE 开发工具，我可以说它本身不是 HTML，它绝对是一个 IE CSS 错误。很多 IE 令人不安的事情之一就是浮动，所以在此基础上，我建议你尝试两件事。

第一个是将文档类型更改为严格 - 这是一个更坚实的基础，并且会改变 IE 的行为方式。可能会自己修复。

第二个建议是从 div 中删除浮动和宽度，而不是依赖于`text-align: right;`您已应用于表单的。这将为您提供与现在 FF 中相同的布局，而无需使用浮动。但是，*您*可能想要实现的是直接在标题旁边和右侧的浮动下拉菜单？如果你想保持一个居中的标题，那将会非常混乱。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T23:13:26.520

我怀疑这个问题与浮动和斜体内容有关。IE 讨厌在浮点数周围加上斜体内容。

我怀疑当您收紧其他一些 CSS 时，您在其中隐藏了一些溢出并无意中修复了两个问题......

这是一篇关于它的不错的小文章：[http ://www.positioniseverything.net/explorer/italicbug-ie.html](http://www.positioniseverything.net/explorer/italicbug-ie.html)

# asp.net - ASP.NET 组织结构图

> ID：367009
> 
> 赞同：0
> 
> 时间：2008-12-14T21:26:01.747
> 
> 标签：asp.net

我想在 ASP.NET 中创建一个组织结构图。有没有人对组件有任何建议来做到这一点。大多数第三方图表包不处理组织结构图。该图表还应该像大多数组织结构图那样从左到右而不是从上到下绘制。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-14T22:04:10.313

它不是 ASP.NET 组件，但您可以创建 Web 服务或动态呈现 JavaScript。[谷歌可视化 API - 组织结构图](http://code.google.com/intl/en-US/apis/visualization/documentation/gallery/orgchart.html)。

我不知道它是否有从左到右的选项。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-29T11:08:41.030

你可以看看[http://www.orgchartcomponent.com](http://www.orgchartcomponent.com)

它有一个演示站点：[http ://demo.orgchartcomponent.com](http://demo.orgchartcomponent.com)

您可以下载该组件的演示版本进行试用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-07-14T05:33:31.633

Chart4.NET 组织结构图控件（ASP.NET 和桌面控件）具有从下到上/从左到右等方向。

从左到右图表的在线演示在这里：

[http://organization.unifosys.com/organization-chart-component-horizo​​ntal-orientation.aspx](http://organization.unifosys.com/organization-chart-component-horizontal-orientation.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-14T21:44:00.010

如果您不介意为第三方组件付费，那么有一些可用的。.NET Charting 还不错，我认为 Dundas 在其出色的图表套件中具有此功能。这两个都提供评估。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-14T21:59:11.647

而不是一个组织结构图，只是一个树视图怎么样？如果是这样，使用树视图控件应该很容易。这是codeproject.com 上显示组织结构图的[另一个示例。](http://www.codeproject.com/KB/webforms/SquaredRomiss.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T00:33:17.780

也许[Microsoft Automatic Graph Layout](http://research.microsoft.com/en-us/downloads/f1303e46-965f-401a-87c3-34e1331d32c5/default.aspx) 会解决您的问题。我还没有使用它，所以..不能保证。

# axapta - Axapta/Dynamics Ax 中的主/明细表

> ID：367017
> 
> 赞同：4
> 
> 时间：2008-12-14T21:34:57.563
> 
> 标签：axapta, microsoft-dynamics, ax

如何在 Axapta/Dynamics Ax 中创建具有主网格和明细网格的主/明细表单，在主网格中选择记录会相应地更改明细网格的内容？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-15T02:32:27.213

[http://daxdave.blogspot.com/2006/10/creating-headerdetail-based-linkage-on.html](http://daxdave.blogspot.com/2006/10/creating-headerdetail-based-linkage-on.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-02-13T16:18:34.940

只是为了给 James 的回答添加一点内容，您通常可以通过查看现有表单来找到您尝试执行的操作的示例。您没有指定是否使用 Dynamics AX 2012 或更早版本，但如果是 2012，您可能希望构建 ListPage 和 Detail 表单。例如，查看 EcoResProductListPage 和 EcoResProductDetails 表单并查看他们如何连接。

# javascript - 动画背景图像向左滑动的最简单方法？

> ID：367020
> 
> 赞同：0
> 
> 时间：2008-12-14T21:39:14.527
> 
> 标签：javascript, jquery, css, jquery-animate

使背景图像向左滑动并循环播放的最佳方法是什么？假设我有一个带有背景的进度条，我想在它处于活动状态时进行动画处理（例如在 Gnome 或 OS X 中）。

我一直在使用该`$(...).animate()`函数并尝试修改相关的 CSS 属性，但是在尝试弄清楚如何修改该属性时，我一直碰壁`background-position`。我不能只是增加它的价值，而且我不确定这是否是最好的方法。

任何帮助表示赞赏！

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-14T21:44:41.083

我一发布这个我就明白了。如果它对其他人有帮助，这是我想出的功能：

```
function animateBar(self) {
    // Setup
    var bar = self.element.find('.ui-progress-bar');

    bar.css('background-position', '0px 0px');

    bar.animate({
        backgroundPosition: '-20px 0px'
    }, 1000, 'linear', function() {
        animateBar(self);
    });
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-05-25T00:42:59.763

只是一个建议，但与其使用标准函数并将元素作为参数传递，不如使用 fn.extend。

```
$.fn.extend({
    animateBar: function(){
       $(this).find('.ui-progress-bar').css('background-position', '0px 0px');
       $(this).find('.ui-progress-bar').animate({
            backgroundPosition: '-20px 0px'
       }, 1000, 'linear', function() {
            animateBar(self);
       });
    }
}); 
```

然后你会这样调用函数：

```
$(this).animateBar(); 
```

对比

```
 animateBar( $(this) ); 
```

只是我的2美分。但是@Markus 的 Gif 解决方案绝对是优越的，除非您有特定的理由使用由 jQuery 动画制作的图像。此外，您的解决方案不会自行循环。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-16T23:22:08.663

在您的情况下，我想说一个更好的解决方案（动画进度条）是使用动画 .gif 作为进度条的背景图像。

此外，要从静态进度条切换到动画进度条，只需使用以下内容：

```
$("#progress").css("background-image", "progress.gif"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-07-26T10:28:16.600

您可以使用[Spritely](http://www.spritely.net/documentation/) 插件，对于动画滑动背景并重复它的情况，您可以使用 pan() 方法使背景图像连续向左或向右平移，然后重复。

# python - 在 AppEngine 中删除错误的 ReferenceProperty 属性

> ID：367029
> 
> 赞同：0
> 
> 时间：2008-12-14T21:45:21.100
> 
> 标签：python, google-app-engine, model, referenceproperty

大多数情况下，您从模型属性中获得的错误会在您保存数据时发生。例如，如果您尝试将字符串保存为 IntegerProperty，则会导致错误。

一个例外（没有双关语）是 ReferenceProperty。如果你有很多引用并且你没有完全小心留下错误的引用，那么通常会遇到类似“TemplateSyntaxError: Caught an exception while rendering: ReferenceProperty failed to be resolved”之类的错误。

这是如果视图中只有一个错误的参考。哦。

我可以编写一个 try/except 块来尝试访问所有引用属性并在引发异常时删除它们，但是如果有比我更通用的方法，这个功能肯定对许多其他开发人员有用能写。我想它会采用模型类型列表并尝试访问每个模型中每个实体的每个引用属性，如果引发异常，则将该属性设置为 None 。

我会看看我自己是否可以做到这一点，但有一些建议/片段让我开始肯定会有所帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T02:18:47.723

我的项目也有类似的困难。当我编写我的应用程序的 beta 版本时，我确实创建了很多死链接，之后理清事情真的很痛苦。理想情况下，该工具还必须报告有问题的引用，以便您可以查明代码中的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-28T03:51:19.057

该异常实际上是一个等待修复一段时间的错误（请参阅[http://code.google.com/p/googleappengine/issues/detail?id=426](http://code.google.com/p/googleappengine/issues/detail?id=426)）。理想情况下，您应该能够像这样测试引用是否有效（来自应用引擎文档）：

```
obj1 = db.get(obj2.reference)

if not obj1:
  # Referenced entity was deleted. 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-17T11:07:12.273

您可以扩展和自定义 ReferenceProperty 以不引发此异常，但随后它需要返回一些东西 - 大概是 None - 在这种情况下，当您的模板尝试访问返回对象的属性时，它只会抛出一个异常。

更好的方法是在渲染模板之前获取引用属性并检查它是否有效。ReferenceProperties 缓存它们的引用，因此预取不会导致额外的数据存储调用。

# objective-c - Objective-C 中的后代枚举

> ID：367030
> 
> 赞同：2
> 
> 时间：2008-12-14T21:46:17.430
> 
> 标签：objective-c, inheritance, runtime, metaprogramming

是否可以在objective-c中获取特定类的所有后代类的列表？

就像是：

```
 @interface A : NSObject
  @end

  @interface B : A
  @end

  @interface C : A
  @end

  NSArray *descendants = [A allDescendants];  // descendants = [B, C] 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-14T22:29:09.420

我能想到的唯一方法是枚举运行时中的整个类列表（使用 获得`objc_getClassList`）并测试每个类的`isKindOfClass:A`.

这可能是唯一的解决方案，因为类不维护与其后代的链接（仅与其超类）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T10:29:26.080

例如，我将 Ken Ferry 的解决方案链接到[Wil](http://homepage.mac.com/kenferry/) [Shipley](http://homepage.mac.com/kenferry/temp/WilShipleyInitChallenge.html)博客[文章](http://www.wilshipley.com/blog/2005/07/self-stupid-init.html)。

本质上，走路上课。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T00:03:15.127

你能以某种方式使用班级成员吗？调用返回self 的超类的类`[[A class] superclass]`的实例。`Class`我认为你可以从中获得一个类的名称`Class`- 这会做你想要的吗？

这根本不能真正处理协议，但也许这至少会为您指明正确的方向。

# matlab - 使用 Matlab，如何在以下根轨迹中找到值 K？

> ID：367040
> 
> 赞同：1
> 
> 时间：2008-12-14T21:59:41.913
> 
> 标签：matlab

在 Matlab 中，如何在有振荡的系统中找到 K 的值？

> （系统的 tf，如果需要： (K * (s + 25))/(s^3 + 24 s^2 + 100 s) ）

PS。我正在使用根轨迹。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-08T18:58:26.867

我假设这是仅具有增益补偿的闭环系统的工厂（即 K）。在这种情况下，我会将其表示为传递函数，然后使用 root-locus 命令查看它在 x 轴上的位置：

```
num = [1 25];
den = [1 24 100 0];

sys=tf(num,den)
rlocus(sys) 
```

不幸的是，对于所有 K 值，您的系统似乎都是稳定的！嗬！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T00:41:33.800

该`dcgain`功能是否满足您的需求？

# wpf - 数据绑定 ListView 包括它的列

> ID：367042
> 
> 赞同：0
> 
> 时间：2008-12-14T22:00:48.947
> 
> 标签：wpf, data-binding, listview

我有一个对象列表，其中每个对象都包含任意数量的参数（名称、值对）。现在我想将对象列表绑定到列表视图。每列应该代表一个参数（列标题是参数的名称），每一行代表一个带有参数值列表的对象。如何通过基于参数名称的数据绑定创建包含其标题名称的列？请注意，参数的数量可能因对象而异，因此列项有时必须为空白。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-15T13:12:20.400

参数是指属性吗？

如果是，那么这可能会有所帮助：
我认为数据绑定引擎将采用第一个对象并将其用作所有其他对象的代表。
因此，您的列表将包含所有列，例如第一个对象的属性。

为了达到你想要的结果，你应该

1.  创建一个具有所有可能属性的虚拟对象
2.  将其作为列表中的第一项插入

这应该工作......使用反射，当你使用 c# :-)

# macos - 苹果自动机视频教程

> ID：367043
> 
> 赞同：2
> 
> 时间：2008-12-14T22:01:32.407
> 
> 标签：macos, automator

我在哪里可以找到一些 Automator 视频教程？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-14T22:17:37.103

在谷歌上进行了一些深入搜索后，我发现了这个：

[http://automator.us/leopard/video/index.html](http://automator.us/leopard/video/index.html)

我希望它有所帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-14T22:29:45.923

在寻找教程视频时，YouTube 始终是我的首选。

[http://www.youtube.com/results?search_query=Automator+tutorials&search_type=](http://www.youtube.com/results?search_query=Automator+tutorials&search_type=)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-21T06:49:10.953

与 Sal Soghoian的[MacBreak Dev](http://www.pixelcorps.tv/macbreak_dev)有一些出色的表现。这是数字 5、7 和 9-12。13 还包含一些 Automator 的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-16T14:26:59.187

来自 peachpit 的非常好的播客系列。“Mac 自动化变得简单”

[http://macautomation.pearson.libsynpro.com/rss](http://macautomation.pearson.libsynpro.com/rss)

现在已经有20多集了。

# visual-studio - 在 Visual Studio 中保留大小写查找/替换

> ID：367052
> 
> 赞同：39
> 
> 时间：2008-12-14T22:07:38.480
> 
> 标签：visual-studio, visual-studio-2008, visual-studio-addins

VisualStudio 中似乎没有对保留大小写的查找/替换的内置支持（另请参见相应的[功能请求](https://developercommunity.visualstudio.com/t/case-preserving-search-replace/580810)）。

我的意思是：搜索“BadJob”并替换为“GoodJob”将执行以下替换

```
'badjob' -> 'goodjob'  
'BadJob' -> 'GoodJob'  
'badJob' -> 'goodJob'  
'BADJOB' -> 'GOODJOB' 
```

所以我正在寻找一个宏/加载项，它实现了保留大小写的查找/替换。如果不存在，那么编写我自己的一个好的起点是什么（最好基于内置的查找/替换功能）。

更新：
我知道我可以进行 4 次手动替换来完成这项工作，但我正在寻找一种在 VS 中自动执行此操作的方法（例如 Emacs 就是这样做的）。一个常见的场景：一个名为 'foo' 的变量和一些函数 DoFoo(), GetFoo(), ... 以及一些包含 'foo' 'Foo' 等的附加注释。现在将 'foo' 重命名为 bar' 产生变量 'bar' , 函数 DoBar(), GetBar() 等由一个查找/替换。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2015-07-28T11:40:22.690

目前在 Visual Studio 中是**不可能的。**

您可以为此功能投票：

[https://developercommunity.visualstudio.com/content/idea/580810/case-preserving-search-replace.html](https://developercommunity.visualstudio.com/content/idea/580810/case-preserving-search-replace.html)

我通常最终打开 Sublime Text，在那里复制和粘贴代码，在那里执行保留大小写的替换，然后复制并粘贴回 Visual Studio。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-14T22:37:11.417

进行查找/替换时打开查找选项。检查区分大小写的选项。除非您执行以下操作，否则您将不得不手动进行口味：[http](http://www.aaronlerch.com/blog/2007/03/28/visual-studio-find-and-replace-regular-expressions/) ://www.aaronlerch.com/blog/2007/03/28/visual-studio-find-and-replace-regular-expressions/或使用某些东西喜欢： http: [//www.download3k.com/MP3-Audio-Video/Utilities-Plug-Ins/Download-Find-Replace.html](http://www.download3k.com/MP3-Audio-Video/Utilities-Plug-Ins/Download-Find-Replace.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2019-09-03T04:13:45.677

**现在可以进行保留大小写的 find 和 replace**，尽管仅适用于所有大写、所有小写或标题大小写（因此它不适用于您的特定示例）。

详细信息可以在[这里找到](https://code.visualstudio.com/updates/v1_37#_preserve-case-in-find-and-replace)（复制如下）：

> # 在查找和替换中保留大小写
> 
> 您现在可以在编辑器的 Find 小部件中进行替换时保留大小写。当在编辑器的替换输入框中打开保留大小写选项（AB 按钮）时，该功能将打开。
> 
> [![按钮](https://i.stack.imgur.com/crMad.png)](https://i.stack.imgur.com/crMad.png)
> 
> 目前 VS Code 仅支持保留**Full Upper Case**、**Full Lower Case**和**Title Case**。
> 
> [![例子](https://i.stack.imgur.com/GmXoL.gif)](https://i.stack.imgur.com/GmXoL.gif)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-11-30T14:26:36.147

这就是我应对（出）它的方式：

在 Notepad++ 中打开文件，并运行一个执行大小写替换的 python 脚本（就像我们以前能够用 Visual Studio 宏做的那样......啊，损失）

安装[Notepad++](https://notepad-plus-plus.org/)
安装[npp python 脚本](http://npppythonscript.sourceforge.net/download.shtml)
这样创建一个新脚本：

```
from Npp import *

#Use capitalizeFirst because .capitalize will make the remaining string lower, but in CamelCase examples 
#we will want to preserve the user-typed casing. e.g. YourMonkeyMagic -> MyMonkieMagik 
def capitalizeFirst(str):
    return '%s%s' % (str[:1].upper(), str[1:])

#***  Ask user what to find and replace ***
find_str=notepad.prompt(notepad, 'Find (keeping case)', '')
replace_str=notepad.prompt(notepad, 'Replace (keeping case)', '')

#*** Do a case-sensitive replacement on each type ***
editor.replace(find_str.upper(), replace_str.upper())
editor.replace(find_str.lower(), replace_str.lower())
editor.replace(capitalizeFirst(find_str), capitalizeFirst(replace_str))
editor.replace(find_str, replace_str) 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-12-16T05:27:07.703

我知道这并不能完全按照您的要求回答您的问题，但是对于重命名变量和方法名称，您可以通过右键单击标识符并使​​用快捷菜单上的重命名选项来避免整个问题。这将更新对该变量或方法名称的任何引用。

警告：
它仅适用于当前解决方案的范围。
它只更新托管代码中的引用。
它不会更新诸如“badcode”之类的文字字符串
它不会更新您的评论。

这是 VS2005/2008 中我最喜欢的功能之一。

# python - 子 multiprocessing.Process 没有打印输出，除非程序崩溃

> ID：367053
> 
> 赞同：17
> 
> 时间：2008-12-14T22:07:56.497
> 
> 标签：python, multithreading, io, multiprocessing

我在使用 Python 多处理模块时遇到问题。我正在使用`Process`该类来生成一个新进程以利用我的第二个核心。第二个过程将一堆数据加载到 RAM 中，然后耐心等待而不是消耗。

我想看看这个过程用`print`命令打印了什么，但是，我没有看到它打印的任何东西。我只看到父进程打印的内容。现在这对我来说很有意义，因为他们生活在两个不同的过程中。第二个进程不会产生自己的 shell/标准输出窗口，也不会将其输出发送到父进程。然而，当这个进程崩溃时，它会打印我的脚本告诉它打印的所有内容，以及堆栈跟踪和错误。

我想知道是否有一种简单的方法可以将子进程的打印输出发送到第一个进程，或者让它产生一个 shell/标准输出，以便我可以调试它。我知道我可以创建一个`multiprocessing.Queue`专用于将打印传输到父级，以便它可以将这些打印到标准输出，但如果存在更简单的解决方案，我不想这样做。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-14T22:18:22.873

您是否尝试过刷新标准输出？

```
import sys
print "foo"
sys.stdout.flush() 
```

# asp.net-mvc - 受版本控制的可浏览网站？

> ID：367058
> 
> 赞同：3
> 
> 时间：2008-12-14T22:12:52.963
> 
> 标签：asp.net-mvc, visual-studio, svn, visualsvn, visualsvn-server

我在 Stackoverflow 上浏览并找到了这个主题：[https ://stackoverflow.com/questions/279/aspnet-visual-studio-and-subversion-how-to-integrate](https://stackoverflow.com/questions/279/aspnet-visual-studio-and-subversion-how-to-integrate)

然而，在我的情况下，这对我没有帮助，或者我可能只是有点愚蠢。

所以我的问题！

在很远的服务器上安装了 VisualSVN，虽然效果很好，但我可以添加我的项目并拥有一个很好的源代码控制，我不想在完成后“手动”将我的网站移动到正确的位置，我想映射一个 IIS网站到 SVN repo 上的目录。我的网站存储在哪里。

现在这是我的问题，我不知道这是否可能？该项目当然在我的电脑+ repo上。并且 repo-server 和 iis-server 是同一台机器，所以我想将它们映射在一起，但我知道 SVN 在文件上使用了一些 berkly-db-stuff..

建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-14T22:18:06.773

您需要的是一个提交后挂钩，它们是位于存储库文件夹中的小批处理文件（挂钩子文件夹中应该有占位符文件）

您设置了提交后挂钩以将存储库签出到服务器上的文件夹，并将您的网络服务器指向同一文件夹。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-14T22:17:23.903

这是可能的。Berkeley DB 用于存储库端，但它并不真正影响客户端。Subversion 会在任何地方创建 .svn 文件夹，所以如果你不喜欢，请使用[rsync](http://samba.anu.edu.au/rsync/)。

编辑：我错过了您已经拥有的部分[VisualSVN Server](http://www.visualsvn.com/server/)。您只需要一个 Subversion 客户端，如[TortoiseSVN](http://tortoisesvn.tigris.org/)或您网站上的命令行 svn 即可查看该网站。

# asp.net - Visual Studio 2005 - 为安全的 Web 服务添加 Web 引用失败

> ID：367061
> 
> 赞同：0
> 
> 时间：2008-12-14T22:17:06.837
> 
> 标签：asp.net, web-services, forms-authentication

我在需要表单身份验证的目录中有一个 web 服务（asmx 文件）

当我尝试通过 VS2005 添加 WebReference 时 - 我收到以下错误：

```
The request failed with the error message:
--
<html><head><title>Object moved</title></head><body>
<h2>Object moved to <a href="/webchat/login.aspx?ReturnUrl=%2fwebchat%WebService.asmx">here</a>.</h2>
</body></html> 
```

当我删除该目录中的 web.config （并且基本上删除了对表单身份验证的要求）时，一切正常。我可以添加 WebReference。

任何的想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-14T22:24:46.307

将以下代码放在您的 web.config 中：

```
<location path="path/to/your/service.asmx">
    <system.web>
        <authorization>
            <allow users="*"/>
        </authorization>
    </system.web>
</location> 
```

ASP.Net 允许覆盖特定位置的应用程序范围的设置。

# c# - C# 事件/订阅 .... 监听未引用的项目

> ID：367066
> 
> 赞同：1
> 
> 时间：2008-12-14T22:19:23.247
> 
> 标签：c#, events, delegates, subscription

我正在开发一个尝试使用观察者模式的应用程序。基本上我有一个基本表单，可以从中加载各种组件（表单）。

基本形式引用每个组件，并且一些组件相互引用。

如果我希望其中一个组件监听由基本表单引发的事件（可能来自菜单等），我似乎无法在不需要在组件中添加对基本表单的引用的情况下实现这一点。这会导致“循环引用”。

是否可以收听/订阅未引用项目中的事件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-14T22:33:02.937

您可以通过多种方式解决此问题。一种简单的方法是有一个特殊的类，它知道基本形式和各种组件。这个类负责创建表单和组件。由于它知道它们，它可以将事件处理程序附加到适当的事件。它本质上只是将组件上的事件处理程序方法“插入”到基本表单上的事件中。

另一种方法是定义一个带有将由主窗体实现的事件的接口。组件可以在其构造函数中传递此接口的实例。然后它们可以附加到事件处理程序。因此组件只知道接口，而不知道基本形式。这是“依赖于抽象，而不是实现”原则的应用。在这种情况下，基本形式将实现接口并了解组件，并在构造它们时将其自身传递给它们。因此依赖是单向的。

然而，最终的解决方案是使用依赖注入容器，例如[StructureMap](http://structuremap.sourceforge.net/Default.htm)。您将有一个配置方法，它将基表单类注册为接口的默认实现者，以及各种组件类。然后，StructureMap 可以根据需要创建类的实例，自动将接口注入到构造函数中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-14T22:51:00.607

Microsoft 正在开发可能对您有用的“托管可扩展性框架 (MEF)”。从 MEF 概述：

> MEF 为宿主应用程序提供了一种公开自身和使用外部扩展的标准方式。扩展，就其性质而言，可以在不同的应用程序中重用。但是，扩展仍然可以以特定于应用程序的方式实现。扩展本身可以相互依赖，MEF 将确保它们以正确的顺序连接在一起（另一件事您不必担心）。

MEF 的概述和下载位于[http://www.codeplex.com/MEF/Wiki/View.aspx?title=Overview&referringTitle=Home](http://www.codeplex.com/MEF/Wiki/View.aspx?title=Overview&referringTitle=Home)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-14T23:33:36.747

您的框架应该定义用于连接事物的接口（请注意，事件可以在接口中定义，因此您可以将事件提升到接口）。Mike Scott 的“依赖于抽象，而不是实现”的建议是正确的，但我在这里要强一点——你应该**按合同编程**并使用**分层设计**。

或者，您可以使用像 INotifyPropertyChanged 这样的接口，它提供了一个可用于通过反射检索信息的字符串，但这是一种脆弱的工作方式，应该是最后的手段。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T16:36:46.167

您是否担心循环引用或循环依赖？使用观察者模式时很难避免循环引用（运行时问题）。循环依赖（设计时问题）总是可以摆脱的。

c# 中观察者模式的典型用法是让观察者拥有对发布者对象的引用，并使用以下方式将自己注册到事件中：

```
publisherObject.SomeEvent += MyEventHandler(); 
```

所以观察者已经有了对 publisherObject 的引用，而在后台发生的事情是 publisherObject 被发送（并存储）了对观察者事件处理程序的引用。因此，除非您要立即删除对 publisherObject 的引用，否则您将陷入循环引用。

当您希望垃圾收集器清理未使用的对象时，这通常只是一个问题。在 publisherObject 中对观察者事件处理程序的“隐藏”引用足以防止观察者被垃圾收集。这有时被称为失效的侦听器问题。最简单的方法是将事件取消订阅放在观察者的 Dispose() 方法中（并记住在摆脱观察者时调用它）。

你可以解决这个问题，但它通常会增加很多复杂性，这在小型应用程序中可能不会得到保证。以前的海报已经建议了 EventBroker、MEF 和依赖注入路由。

如果您更关心循环依赖关系，那么最简单的答案是 Quarrelsome 建议的严格的父子层次结构。父母（观察者）总是知道它的孩子，所以如果需要的话可以直接调用他们的属性和方法。孩子（出版商）应该对他们的父母一无所知。它们纯粹通过事件和函数返回值向上通信。然后通过共同的父级路由子级之间的通信（向上的事件，向下的方法调用）。

请注意，由于事件机制的工作方式，您仍然有循环引用（因此要小心处理），但您没有循环依赖关系。子组件甚至可以在完全不同的组件中，没有设计时引用包含父组件的组件。

请注意，您可以对您认为父母的内容和孩子的内容有点灵活。仅仅因为您的主表单创建了一个子表单并不意味着您必须在该方向上定义父子通信。典型的插件风格架构可能具有创建插件实例的主要形式。但是一旦创建，通信可能会将插件视为父/观察者，将主窗体视为发布者/事件源。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-18T10:01:55.573

只需为 Event 创建一个包含类的项目：

```
public class BaseFormEventClass
{
    public EventHandler<EventArgs> BaseFormDidSomething;
} 
```

然后从 baseform 项目和 components 项目中引用这个项目。让 baseform 创建 eventclass 的实例并将其提供给他加载的所有组件：

```
public class MyComponent
{
    public MyComponent(BaseFormEventClass eventClass)
    {
        eventClass.BaseFormDidSomething += this.EventClass_BaseFormDidSometing;
    }
    // ...
}

public class BaseForm
{
    private BaseFormEventClass eventClass = new BaseFormEventClass();

    private void LoadComponents()
    {
        MyComponent component1 = new MyComponent(this.eventClass);
    }

    private void RaiseBaseFormDidSomething()
    {
        EventHandler<EventArgs> handler = eventClass.BaseFormDidSomething;
        if (handler != null) handler(this, EventArgs.Empty);
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-14T22:25:38.273

[您可以使用Microsoft 的 Patterns and Practices](http://msdn.microsoft.com/en-us/library/cc540687.aspx) Library中的 EventBroker 模式。

但是我不确定这是否是一种很好的模式，我个人更喜欢创建对象不相互引用的架构（始终是父->子场景）并处理依赖问题而不是忽略它们。

# python - 用 Python 列出计算机上运行的进程

> ID：367068
> 
> 赞同：3
> 
> 时间：2008-12-14T22:20:34.053
> 
> 标签：python, cross-platform, process

是否有一种跨平台的方法可以通过 python 脚本列出计算机上运行的进程？对于基于 Unix 的系统，“ps -ef”有效，但我是 Python 新手，不知道如何编写可以在任何平台上运行的东西。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-14T22:30:57.903

Python 本身不提供任何此类功能。在 PyPI 上，有[enumprocess](http://pypi.python.org/pypi/enumprocess/0.1)包，据说有帮助；还有[PSI](http://www.psychofx.com/psi/trac/wiki/)包。我个人没有使用过它们中的任何一个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-30T09:10:07.593

虽然[PSI](https://bitbucket.org/chrismiles/psi/wiki/Home)页面列出了一些替代方案，但您需要的是[psutil](http://code.google.com/p/psutil/)。它是唯一支持 Windows 的，或者如主页上所述：

> Linux、Windows、OSX 和 FreeBSD 32 位和 64 位，Python 版本从 2.4 到 3.2。

# shell - 如何否定进程的返回值？

> ID：367069
> 
> 赞同：124
> 
> 时间：2008-12-14T22:20:36.550
> 
> 标签：shell, cross-platform, negate

我正在寻找一个简单但跨平台的*否定*进程，它否定进程返回的值。它应该将 0 映射到某个值 != 0 和任何值 != 0 到 0，即以下命令应该返回“是的，不存在的路径不存在”：

```
 ls nonexistingpath | negate && echo "yes, nonexistingpath doesn't exist." 
```

这 ！- 操作员很棒，但不幸的是不是独立于外壳的。

* * *

## 回答 #1

> 赞同：147
> 
> 时间：2008-12-14T23:40:01.133

^(*以前，答案是以现在的第一部分作为最后一部分给出的。*)

### POSIX Shell 包括一个`!`运算符

围绕 shell 规范寻找其他问题，我最近（2015 年 9 月）注意到 POSIX shell 支持`!`运算符。例如，它被列为[保留字](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_04)，可以出现在[管道](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_09_02)的开头——其中一个简单的命令是“管道”的特例。因此，它也可以在`if`语句和`while`/或`until`循环中使用——在符合 POSIX 的 shell 中。因此，尽管我有所保留，但它可能比我在 2008 年意识到的更广泛可用。对 POSIX 2004 和 SUS/POSIX 1997 的快速检查表明这`!`两个版本都存在。

注意`!`操作符必须出现在流水线的*开头*并且否定整个流水线的状态码（即*最后一条*命令）。这里有些例子。

```
# Simple commands, pipes, and redirects work fine.
$ ! some-command succeed; echo $?
1
$ ! some-command fail | some-other-command fail; echo $?
0
$ ! some-command < succeed.txt; echo $?
1

# Environment variables also work, but must come after the !.
$ ! RESULT=fail some-command; echo $?
0

# A more complex example.
$ if ! some-command < input.txt | grep Success > /dev/null; then echo 'Failure!'; recover-command; mv input.txt input-failed.txt; fi
Failure!
$ ls *.txt
input-failed.txt 
```

### 便携式答案 - 与古董贝壳一起使用

在 Bourne (Korn, POSIX, Bash) 脚本中，我使用：

```
if ...command and arguments...
then : it succeeded
else : it failed
fi 
```

这是最便携的。“命令和参数”可以是管道或其他复合命令序列。

### 一个`not`命令

这 '！' 运算符，无论是内置在您的 shell 中还是由 o/s 提供，都不是普遍可用的。不过，写起来并不难——下面的代码至少可以追溯到 1991 年（尽管我认为我在更早之前写了一个以前的版本）。不过，我不倾向于在我的脚本中使用它，因为它不可靠。

```
/*
@(#)File:           $RCSfile: not.c,v $
@(#)Version:        $Revision: 4.2 $
@(#)Last changed:   $Date: 2005/06/22 19:44:07 $
@(#)Purpose:        Invert success/failure status of command
@(#)Author:         J Leffler
@(#)Copyright:      (C) JLSS 1991,1997,2005
*/

#include <stdlib.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>
#include "stderr.h"

#ifndef lint
static const char sccs[] = "@(#)$Id: not.c,v 4.2 2005/06/22 19:44:07 jleffler Exp $";
#endif

int main(int argc, char **argv)
{
    int             pid;
    int             corpse;
    int             status;

    err_setarg0(argv[0]);

    if (argc <= 1)
    {
            /* Nothing to execute. Nothing executed successfully. */
            /* Inverted exit condition is non-zero */
            exit(1);
    }

    if ((pid = fork()) < 0)
            err_syserr("failed to fork\n");

    if (pid == 0)
    {
            /* Child: execute command using PATH etc. */
            execvp(argv[1], &argv[1]);
            err_syserr("failed to execute command %s\n", argv[1]);
            /* NOTREACHED */
    }

    /* Parent */
    while ((corpse = wait(&status)) > 0)
    {
            if (corpse == pid)
            {
                    /* Status contains exit status of child. */
                    /* If exit status of child is zero, it succeeded, and we should
                       exit with a non-zero status */
                    /* If exit status of child is non-zero, if failed and we should
                       exit with zero status */
                    exit(status == 0);
                    /* NOTREACHED */
            }
    }

    /* Failed to receive notification of child's death -- assume it failed */
    return (0);
} 
```

当它无法执行命令时，这将返回“成功”，与失败相反。我们可以争论“什么都不做成功”选项是否正确；当它不被要求做任何事情时，它可能应该报告一个错误。' ' 中的代码`"stderr.h"`提供了简单的错误报告工具——我在任何地方都使用它。应要求提供源代码 - 请参阅我的个人资料页面与我联系。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2008-12-14T22:25:43.437

在 Bash 中，使用 ! 命令前的运算符。例如：

```
! ls nonexistingpath && echo "yes, nonexistingpath doesn't exist" 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-12-14T22:26:47.740

你可以试试：

```
ls nonexistingpath || echo "yes, nonexistingpath doesn't exist." 
```

要不就：

```
! ls nonexistingpath 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2013-03-30T15:16:08.047

如果您没有以某种方式使用 Bash 作为您的 shell（例如：Git 脚本或[Puppet](https://en.wikipedia.org/wiki/Puppet_%28software%29)执行测试），您可以运行：

`echo '! ls notexisting' | bash`

-> 重新编码：0

`echo '! ls /' | bash`

-> 重新编码：1

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2020-11-06T01:58:38.403

没有！，没有 subshel​​l，没有 if 的解决方案，并且至少应该在 Bash 中工作：

```
ls nonexistingpath; test $? -eq 2 && echo "yes, nonexistingpath doesn't exist."

# Alternatively without an error message and handling of any error code > 0
ls nonexistingpath 2>/dev/null; test $? -gt 0 && echo "yes, nonexistingpath doesn't exist." 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-14T22:27:21.200

```
! ls nonexistingpath && echo "yes, nonexistingpath doesn't exist." 
```

或者

```
ls nonexistingpath || echo "yes, nonexistingpath doesn't exist." 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-04-26T21:19:01.120

注意：有时您会看到`!(command || other command)`.
这里`! ls nonexistingpath && echo "yes, nonexistingpath doesn't exist."`就足够了。
不需要子外壳。

Git 2.22（2019 年第二季度）通过以下方式说明了更好的形式：

[提交 74ec8cf](https://github.com/git/git/commit/74ec8cf6747a60885e15d4c36e6b47bc37764748)，[提交 3fae7ad](https://github.com/git/git/commit/3fae7ad96d89e670a75b1335824c8ad3a92c8db0)，[提交 0e67c32](https://github.com/git/git/commit/0e67c32955cee24c5ff534dd3f5f0de58ba91d02)，[提交 07353d9](https://github.com/git/git/commit/07353d9042f19fec749ec8413ff7e6824460ee59)，[提交 3bc2702](https://github.com/git/git/commit/3bc2702b883030b138a8c7585d7bc9adb4b4a399)，[提交 8c3b9f7](https://github.com/git/git/commit/8c3b9f7faa4f39ddb89be229b706d4a9f9c659a4)，[提交 80a539a](https://github.com/git/git/commit/80a539acf6663ec97bfbf552faa32105bd7f599f)，[提交 c5c39f4](https://github.com/git/git/commit/c5c39f4e348dc4759638927343a36e79f2da7bb5)（2019 年 3 月 13 日） by [SZEDER Gábor ( `szeder`)](https://github.com/szeder)。
请参阅[Johannes Schindelin ( ) 的](https://github.com/dscho)[commit 99e37c2](https://github.com/git/git/commit/99e37c2560ecb1cc44bb743a2e4aaaedb5da1a90)、[commit 9f82b2a](https://github.com/git/git/commit/9f82b2a6a754c7cec37282d954208b4b429a3a05)、[commit 900721e](https://github.com/git/git/commit/900721e15c43742955878dbbdb24c5a2ce262630)（2019 年 3 月 13 日[）](https://github.com/dscho)。^(（由)^([Junio C Hamano 合并 --](https://github.com/gitster)) ^([--](https://github.com/gitster))^在^([提交 579b75a](https://github.com/git/git/commit/579b75ad9530827fe00740b8551963f16f279c40))^(中，2019 年 4 月 25 日）)[`dscho`](https://github.com/dscho)
^([`gitster`](https://github.com/gitster))

> ## `t9811-git-p4-label-import`：修复管道否定
> 
> 在“ `t9811-git-p4-label-import.sh`”中，测试“ `tag that cannot be exported`”运行：
> 
> ```
> !(p4 labels | grep GIT_TAG_ON_A_BRANCH) 
> ```
> 
> 检查给定的字符串不是由' `p4 labels`'打印的。
> 这是有问题的，[因为根据**POSIX**](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_09_02)：
> 
> > “如果管道以保留字开头`!`并且`command1`是子shell命令，则应用程序应确保`(`开头的运算符与运算符`command1`分开`!`一个或多个`<blank>`字符。**紧跟在运算符后面**
> > **的保留字的行为是未指定的。`!``(`** "
> 
> 虽然大多数常见的 shell 仍然将此 ' `!`' 解释为“否定管道中最后一个命令的退出代码”，但 ' `mksh/lksh`' 不会并将其解释为负文件名模式。
> 结果，他们尝试运行由当前目录中的路径名组成的命令（它包含一个名为 ' `main`' 的目录），当然，这会导致测试失败。
> 
> `!`我们可以简单地通过在 ' ' 和 ' '之间添加一个空格来`(`修复它，但我们可以通过删除不必要的 subshel​​l 来修复它。特别是，[提交 74ec8cf](https://github.com/git/git/commit/74ec8cf6747a60885e15d4c36e6b47bc37764748)

# ruby - RSA Data Security, Inc. MD5 消息摘要算法的 Ruby 实现

> ID：367079
> 
> 赞同：5
> 
> 时间：2008-12-14T22:29:10.357
> 
> 标签：ruby, md5, rsa

有人知道 RSA Data Security, Inc. 的 ruby​​ 实现吗？ MD5 消息摘要算法定义在[https://www.rfc-editor.org/rfc/rfc1321](https://www.rfc-editor.org/rfc/rfc1321)

[我在https://developer.openx.org/fisheye/browse/openads/branches/2.0/branches/openads-2.0.11/admin/md5.js?r=16584](http://developer.openx.org/fisheye/browse/openads/branches/2.0/branches/openads-2.0.11/admin/md5.js?r=16584)找到了一个 javascript 实现...它有一个功能MD5 进行编码。红宝石上有类似的东西吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-14T22:34:10.453

[这里](http://www.google.com/search?hl=en&safe=off&q=ruby+md5&btnG=Search)有很多

事实上，您可能会找到一个使用：

```
require 'digest/md5' 
```

# asp.net - 标题（在 ASP.NET @ Page 指令中）不在网页中呈现

> ID：367090
> 
> 赞同：2
> 
> 时间：2008-12-14T22:36:42.510
> 
> 标签：asp.net, html, validation

我打算使用 @Page 指令中的 Title 属性来自定义每个页面的标题，但它似乎没有做任何事情。

该网站使用母版页 - 我不知道这是否是一个考虑因素。

母版页片段：

```
<%@ Master Language="VB" CodeFile="brightnorth.master.vb" Inherits="brightnorth" %>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
</head>
<body>
etc.... 
```

页面片段（来自[http://www.brightnorth.com/about/aboutus.aspx](http://www.brightnorth.com/about/aboutus.aspx)）：

```
<%@ Page Language="VB" MasterPageFile="~/brightnorth.master" AutoEventWireup="false" CodeFile="aboutus.aspx.vb" Inherits="about_aboutus" Title="Brightnorth.com: About Us" %> 
```

更重要的是，如果我通过[验证器](http://validator.w3.org/check?verbose=1&uri=http%3A%2F%2Fwww.brightnorth.com%2Fabout%2Faboutus.aspx)运行页面，它会抱怨......

> 未完成的“头”的结束标签

..而标签*存在*于源代码中。

我已经有一个解决方法，但这让我很烦，所以我决心找到一个解决方案！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-14T22:51:11.043

糟糕...一个基本错误！【他们不是一直都这样吗？】

`runat="server"`有人发现元素中缺少什么吗？

哎呀。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-14T22:40:22.173

您还必须使用 HTML 标签 :)

在您的母版页中，您应该在 head 标签内：

```
<title><%=Title%></title> 
```

[http://www.w3schools.com/TAGS/tag_title.asp](http://www.w3schools.com/TAGS/tag_title.asp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-11T21:43:20.790

如果标题来自页面指令，这就是您需要在母版页中拥有的内容：

```
<head runat="server">
<title><%=Page.Title%></title>
</head> 
```

# java - 在 Java 中是否应该始终使用枚举而不是常量

> ID：367104
> 
> 赞同：12
> 
> 时间：2008-12-14T22:44:44.490
> 
> 标签：java, coding-style, enums

在 java <1.5 中，常量会这样实现

```
public class MyClass {
    public static int VERTICAL = 0;
    public static int HORIZONTAL = 1;

    private int orientation;

    public MyClass(int orientation) {
        this.orientation = orientation;
    }
... 
```

你会像这样使用它：

```
MyClass myClass = new MyClass(MyClass.VERTICAL); 
```

现在，在 1.5 中，您显然应该使用枚举：

```
public class MyClass {
    public static enum Orientation {
        VERTICAL, HORIZONTAL;
    }

    private Orientation orientation;

    public MyClass(Orientation orientation) {
        this.orientation = orientation;
    }
... 
```

现在你会像这样使用它：

```
MyClass myClass = new MyClass(MyClass.Orientation.VERTICAL); 
```

我觉得有点难看。现在我可以轻松添加几个静态变量：

```
public class MyClass {
    public static Orientation VERTICAL = Orientation.VERTICAL;
    public static Orientation HORIZONTAL = Orientation.HORIZONTAL;

    public static enum Orientation {
        VERTICAL, HORIZONTAL;
    }

    private Orientation orientation;

    public MyClass(Orientation orientation) {
        this.orientation = orientation;
    }
... 
```

现在我可以再次这样做：

```
MyClass myClass = new MyClass(MyClass.VERTICAL); 
```

具有枚举的所有类型安全优点。

这是好风格，坏风格还是两者都不是。你能想出更好的解决方案吗？

**更新**

Vilx- 是第一个强调我觉得我缺少什么的人 - 枚举应该是一等公民。在 java 中，这意味着它在包中拥有自己的文件——我们没有命名空间。我原以为这会有点重量级，但实际上这样做了，感觉肯定是对的。

Yuval 的回答很好，但它并没有真正强调非嵌套枚举。此外，至于 1.4 - JDK 中有很多地方使用整数，我真的在寻找一种方法来发展这种代码。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-14T23:01:20.057

你太复杂了。让我们把它放在一起。

在 Java 1.5 之后，您应该使用 Java Enum 类：

```
public enum Color
{
    BLACK, WHITE;
} 
```

在 Java 1.5 之前，您应该使用类型安全的 Enum 模式：

```
public class Color
{
    public static Color WHITE = new Color("white");
    public static Color BLACK = new Color("black");

    private String color;

    private Color(String s)
    {
        color = s;
    }
} 
```

在这两种方式中，您都这样称呼它：

```
drawBackground(Color.WHITE); 
```

具体来说，关于你的问题。这是代码风格的问题，但我认为首选方法是将枚举保留在单独的类中。尤其是一旦他们开始获得自己的方法，例如`getName()`，`getId()`等等......将其视为与常规类与匿名类相同的困境，一旦类开始变得混乱，是时候将其移出到自己的文件中了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-14T22:47:55.903

你知道你可以导入方向并说

```
MyClass myClass = new MyClass(Orientation.VERTICAL); 
```

?

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-14T22:52:40.730

不了解 Java，但在 .NET 中，好的做法是将枚举与使用它们的类并行放置，即使它仅由一个类使用。也就是说，你会写：

```
namespace Whatever
{
    enum MyEnum
    {
    }
    class MyClass
    {
    }
} 
```

因此，您可以使用：

```
MyClass c = new MyClass(MyEnum.MyValue); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-07-02T07:07:12.833

有一类重要的情况应该使用常量而不是`enum`s。这是您想要使用常量进行算术运算或将它们与数值进行比较的时候。那么你真的需要这个东西是`int`,`long`或`double`。

Conversely, if it would never make sense to do arithmetic or numerical comparisons using a thing, that thing should be an object rather than a primitive numeric, so an `enum` would be more appropriate.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-14T23:03:18.790

您还可以在 MyClass 上使用两个静态方法：

```
MyClass.Vertical() : MyClass
MyClass.Horizontal() : MyClass 
```

这些将返回一个具有正确枚举集的新实例。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-14T23:03:36.480

我同意你很有创意，但我认为这不是一个实用的解决方案，我认为你只是将“丑陋”转移到代码的不同部分。如果除了 VERTICAL 和 HORIZONTAL 之外，还有 DIAGONAL、AA、BB、CC 等，会发生什么？您是否必须通过键入每个静态常量来进行复制？您认为 MyClass.Orientation.VERTICAL 丑陋的品味可能是个人的？

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-14T22:59:34.163

这取决于枚举可以取多少值。在您的示例中，只有两个，我只会使用布尔值。如果枚举仅由您编写的代码使用并且不必与许多其他代码交互，那么您可能不需要类型安全。但如果它采用“公共”方法，我肯定会选择枚举，并将枚举放在自己的文件中。

# python - 是否有相当于`perl -pi -e`的Python？

> ID：367115
> 
> 赞同：17
> 
> 时间：2008-12-14T22:57:33.200
> 
> 标签：python, perl, command-line, language-features

我知道`python -c '<code>'`，但我想知道是否有更优雅的 python 等效于`perl -pi -e '<code>'`. `perl -pi -e s/foo/bar/g *`我仍然将它用于在整个目录（甚至`find . | xargs perl -pi -e s/foo/bar/g`子目录）中查找和替换之类的事情。

实际上，我觉得 Perl Perl（自由形式的 Tim Toady-ness）是让`perl -pi -e`工作如此出色的原因，而使用 Python，您必须按照导入 re 模块、创建 re 实例然后捕获标准输入，但也许有一个 Python 快捷方式可以完成所有这些工作，我错过了它（非常想念它）......

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-14T23:53:48.453

' ' 中的命令行用法`python -h`肯定强烈表明没有这样的等价物。Perl 倾向于广泛使用 ' `$_`' （您的示例隐含使用它），我认为 Python 不支持任何类似的概念，从而使 Perl 单行的 Python 等价物更加困难。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-15T00:58:30.693

等价于 -pi 在 Python 中编写起来并不难。

1.  使用您真正喜欢的 -p 和 -i 功能为自己编写一个方便的模块。让我们称之为`pypi.py`。

2.  采用`python -c 'import pypi; pypi.subs("this","that")'`

[您可以使用fileinput](http://docs.python.org/library/fileinput.html)模块实现基本的 -p 循环。

您将拥有一个函数，`subs`它实现了打开文件、保存备份副本以及在每一行上进行替换的基本“-i”算法。

有一些像这样的 activestate 食谱。这里有一些：

*   [http://code.activestate.com/recipes/437932/](http://code.activestate.com/recipes/437932/)
*   [http://code.activestate.com/recipes/435904/](http://code.activestate.com/recipes/435904/)
*   [http://code.activestate.com/recipes/576537/](http://code.activestate.com/recipes/576537/)

不是内置的。但不难写。并且一旦编写就易于定制。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-01-20T21:45:29.777

我知道这已经晚了几年，但我最近发现了一个非常好的工具，叫做[pyp](http://code.google.com/p/pyp/ "pyp")，它完全可以满足您的要求。

我认为你的命令应该是：

```
pyp "p.replace('foo','bar')" 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-15T01:23:27.493

我认为 perl 更适合这种动态脚本。如果您想要快速运行一次性脚本功能，我建议您坚持使用 perl、awk、sed 和标准 unix 命令行工具。

但是如果你对使用 python 感兴趣，我使用[optparse](http://docs.python.org/library/optparse.html)编写我自己的命令行工具并推荐它。optparse 提供了一个干净且易于使用的命令行选项解析器，内置帮助生成。

这是一个示例：

```
def myfunc(filename, use_versbose):
   # function code

if __name__ == '__main__':
    from optparse import OptionParser

    parser = OptionParser()
    parser.add_option("-f", "--file", dest="filename",
                      help="write report to FILE", metavar="FILE")
    parser.add_option("-q", "--quiet",
                      action="store_false", dest="verbose", default=True,
                      help="don't print status messages to stdout")

    (options, args) = parser.parse_args()

    if options.filename:
        myfunc(options.filename, options.verbose)

    else:
        print 'ERROR -- Necessary command line options not given!'
        print parser.print_help() 
```

parser.print_help() 生成以下输出，并在命令行中给出 -h 或 --help 时自动显示：

```
usage: <yourscript> [options]

options:
  -h, --help            show this help message and exit
  -f FILE, --file=FILE  write report to FILE
  -q, --quiet           don't print status messages to stdout 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-03-08T01:05:00.130

fileinput 模块具有就地编辑的能力。但是，您不能免除备份。以下是如何将其用于单线：

```
python -c 'import fileinput, sys; for line in fileinput.input(inplace=True): sys.stdout.write(line, "foo", "bar")' 
```

就个人而言，当我需要做这样的事情时，我通常只使用 Perl。这是我使用 Perl 的少数几次之一。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-07-15T13:00:01.920

以上可能适用于标准输入，但看起来不适用于文件。

也许是这样的：

--

```
import fileinput 
import sys
for line in fileinput.input("./poop", inplace=True):
    line = line.replace("foo", "bar")
    sys.stdout.write(line) 
```

-- "./poop" 可以替换为你的文件所在的位置，并且 line.replace 应该支持 line.replace("{}".format(variablehere),"newtext")

# google-analytics - Web统计跟踪和RSS

> ID：367116
> 
> 赞同：0
> 
> 时间：2008-12-14T22:58:13.293
> 
> 标签：google-analytics, web-statistics

使用 RSS 提要，您如何设置谷歌分析（或任何其他统计跟踪器）来跟踪订阅提要的人？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T03:58:34.277

看起来你有两个选择。使用[FeedBurner](http://www.feedburner.com/fb/a/home)（由 Google 拥有）为您的提要提供大量统计信息（甚至比您想要的更多），或者您可以使用此处找到的方法：[http ://www.gospelrhys.co.uk/2007/09 /how-to-track-new-rss-subscribers-google-analytics-in-3-easy-steps.html](http://www.gospelrhys.co.uk/2007/09/how-to-track-new-rss-subscribers-google-analytics-in-3-easy-steps.html)创建一个转发页面，该页面捕获 Analytics 中的点击，然后将用户转发到您的提要。这有点麻烦，但如果您必须使用 Analytics，这似乎是一种方法。

# nhibernate - NHibernate 子对象更新

> ID：367119
> 
> 赞同：3
> 
> 时间：2008-12-14T22:59:56.753
> 
> 标签：nhibernate, refresh, children, bag

我有一个名为“类别”的对象，表格看起来像这样。

```
CATEGORY
-------------------------------------------------
ID                 int  
ParentCatalogID    int  
ParentCategoryID   int << This is the ID of this table 
Position           int  
Title              nvarchar(128)    
Description        nvarchar(1024)   
LastUpdated        datetime 
DateCreated        datetime 
IsActive           bit 
```

插入，更新，删除等时一切正常......映射很好。

该表中的数据被呈现为“嵌套”的 html 列表（因此是自引用）。这一切都呈现得很漂亮。

当`Position`更新（上移 || 下移）时，更新后的列表会反映更改，并且相关列表项会移动其在列表中的位置。

问题是当 ParentCatalogID 更改时（向左 || 向右移动成为上述列表条目的子项）。传递给列表渲染方法的数据没有反映更改，直到通过按 F5 刷新页面，单击刷新（重新加载页面）。

这将使您对如何：

```
foreach (nc_Category category in root.nc_Categorys)
{
  HtmlControl listItem = BuildListItemFromCategory(category);
  if (category.nc_Categorys.Count > 0)
      {
        listItem.Controls.Add(BuildListFromCategorys(category.nc_Categorys));
      }
  mainList.Controls.Add(listItem);
} 
```

这一切都很好。问题是在 >> 行`foreach (nc_Category category in root.nc_Categorys)`中`root.nc_Categorys`（当前对象的子项）在页面刷新之前不会反映所做的更改。我可以在调试中看到这一点。所以 NHibernate 在延迟加载时不会得​​到更新。

更改已提交、刷新并在数据库中可见。NHibernate 不会检索它们。

我已经在对象上尝试了 Refresh() 方法，这不起作用。需要刷新的是对象的子对象。

我曾尝试清除会话和许多其他事情无济于事。这仅在更改`ParentCategoryID`. 更改时，`Position`它们会立即显示。

这似乎相似但不确定：http: [//jira.nhibernate.org/browse/NH-1604](http://jira.nhibernate.org/browse/NH-1604)

我正在响应。重定向到同一页面（yuk）。它工作正常，但它不应该需要它。非常感谢您的回应。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-23T08:28:31.417

它是否与在您的应用程序的不同点使用的不同会话有关，我知道 java hibernate 选项有一个概念，即对后端 servlet 以及 jsp 前端的东西使用相同的休眠会话。

# cross-platform - 跨平台桌面应用程序——一种方法？

> ID：367121
> 
> 赞同：11
> 
> 时间：2008-12-14T23:00:29.903
> 
> 标签：cross-platform

我有一个我认为是应用程序的杀手锏。根据定义，这将是一个桌面应用程序，它与我编写它的平台（Windows 搜索服务、Mac OS X Spotlight 服务器）提供的一些相当低级的服务相关联。

我的意图是 Mac OS X 和 Windows 版本。绝对意图实际上是不共享代码——主要是因为它很少（如果有的话）可以通用。正因为如此，我打算使用完全不同的框架（Mac 上的 Cocoa/Obj-C，Windows 上的 C#/WPF/PInvoke）并让两者都感觉“原生”到他们的平台，如果你愿意的话，它们是一流的应用程序公民。

我的问题是：尝试“同时”构建它们是否更好，也就是说，即使在整个开发周期中也尽量保持它们的功能相同；还是让一个“正确”然后跟进另一个更好？

保持平价的优点似乎是：

*   更容易使算法保持一致，因为我用一种语言实现，我只是移植到另一种语言
*   更容易确保在发布时，两个应用程序都立即可用

保持平价的缺点似乎是：

*   更难做；不断的语言切换可能会让我的头脑爆炸（每当我工作 C# 4 天时，我已经在工作中经历过这个，然后突然不得不维护我们旧的 VB.NET 解决方案之一）

一个的优点，然后另一个，似乎是：

*   没有不断的语言切换
*   一个平台可以在测试中，而另一个平台正在构建中

一个的缺点，然后另一个，似乎是：

*   回到“旧”代码来移植算法
*   可能对“重做”我已经做过的事情失去兴趣

诚然，这是非常雄心勃勃的......而且我只是一个人，在“空闲”时间做这件事（哈哈）。如果您在同一条船上，并且熟悉这两种技术，您将如何处理？

**更新**

回答下面的一些问题：

是的，一个通用的 API 是可行的，但是调用约定不会——或者至少，不容易。我确实打算定义相同的类，但使用特定于平台的代码。（这似乎相当关键，因为 Windows Search Service 和 Spotlight 的工作方式完全不同。）

我可以使用 Java 之类的东西，但我选择不这样做有几个原因：（1）我没有*永远*使用 Java ，现在很危险地不合格。:) (2) 其中一部分是通过在我熟悉的技术中“基本上”使用相同的应用程序来学习 Objective-C 的练习；(3) 虽然 Swing 可以在 OS X 上提供大部分原生外观，但它的 Windows UI 感觉并不完全正确，我真的希望这两个应用程序都感觉它们属于各自的系统。

上市时间不是一个重要的考虑因素。我觉得应用程序的想法本身将是相当安全的。比 TTM 更重要的是让应用程序感觉正确并提供功能......

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-14T23:09:29.883

我会首先为拥有最大目标受众的平台（如你的杀手级应用程序）进行开发，然后使用我在此过程中学到的不可避免的课程来改进我为其他人开发的方式。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-15T00:24:20.590

尽管我一直在狂热地寻找适用于这两个平台的桌面解决方案，但我认为两次构建应用程序没有任何问题......可能是有道理的。

也就是说，我不认为您应该先构建一个然后再构建另一个，而是尝试做一些非常困难的事情，比如**为两者使用相同的 UML 类图。**这将迫使您将应用程序划分为**相同**的部分和根据定义特定于平台的部分。

这个想法不是共享代码库，而是共享软件设计。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-15T01:40:16.460

您最初应该专注于为一个平台编写应用程序，然后再考虑移植它。如果你不完成它，你的项目肯定会失败，并且尝试同时为两个平台编写它肯定会增加整体开发时间。你能说出一个因为不支持多平台而失败的商业软件吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-14T23:28:58.363

你提到的优点和缺点都是绝对有效的。就个人而言，我讨厌回去重新做一些事情，即使是在不同的语言中，也不愿意在精神上不断地转换语言的思维方式。我已经每天都在这样做，我在 Python 中进行服务器开发，在 JavaScript 中进行客户端开发。

话虽如此，如何将低级内容与高级 UI 内容分开。在每个平台上构建低级别的东西，这样它们就可以拥有完全相同的 API。底层内部实现可以完全不同，没关系，只要它们都暴露相同的接口即可。我想你会觉得这样做很有趣。您还说过您希望 UI 在每个平台上都感觉是原生的，那么为什么不考虑使用 Java 中的 SWT 之类的东西。如果 SWT 和 Java 不是一个选项，那么我猜你将不得不使用 WPF 和 Cocoa 构建高级的东西。但是到了这个时候，你的工作会更容易，因为你将调用之前在低级库中构建的相同 API。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-14T23:15:27.390

如果我是你，我会使用跨平台框架和/或编程语言，现在你有很多跨平台的语言/框架，例如 Java、QT（使用 Java 和 C++ 语言来使用工具包）， C# 与 MONO，GTK+ 与 C（gtkmm 与 C++，gtk# 和 Mono 用于 C#）。因此，如果你使用一种语言/框架比同时使用两种语言/框架更简单，因为如果你用两种不同的语言/框架编写同一个应用程序，它将花费你额外的开发时间，其中一半的时间你可以得到新的框架和语言，因为您从一开始就知道您的目标平台是多平台的。如果现在您的主要平台是 e。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-14T23:32:54.453

你确定你不能将低级服务抽象成一个通用接口，并且仍然有足够的应用程序（例如 UI）来让跨平台开发更经济吗？如果您想缩短上市时间，那么计划将所有事情都做两次听起来很浪费。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-14T23:37:07.190

使用第三种语言作为本地调用的粘合剂怎么样？

我听说 python 或 ruby​​ 具有很好的本地库集成功能。可以通过内部 API 抽象出差异。

这样，所有逻辑都可以设置在第三个语言中，而特定部分则设置在另一个中。

Java 可能也是如此，但我认为集成看起来有点困难。

顺便说一句，这就是 java.io.File 等类的工作方式（或者是？）。

告诉我们进展如何。

*编辑*

我认为大公司的做法是使用 C++ 并使用 fork 来处理特定于平台的代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-15T01:08:13.687

如果您无论如何都必须学习一项新技术（Objective-C），我会再看一下Java。尝试为两个不同的平台开发两次相同的程序并一次学习太多东西可能意味着您最终会得到一个程序无法很好地工作 - 如果您被引诱使用一个平台上可用但没有的功能，则会出现无法支持的混乱在另一。

如果您使用 Java，您只需要处理每个平台上的一些 UI 和安装怪癖——您的大部分应用程序（重要的是，您所做的任何错误修复）都将立即移植。Java UI 现在看起来相当成熟，并且有很多可重用的 UI 代码（例如 JIDE 组件很好）。如果你的应用创意真的是杀手锏，你可以在赚了几百万后雇佣员工来做“一流的公民应用”。

您还可以查看其他跨平台应用程序是如何成功交付的——例如查看 firefox、thunderbird、openoffice，并查看可以重用的内容。我也知道一些用 Java 完成的跨平台应用程序——例如，我使用 PersonalBrain 和 crashplan，它们似乎都是基于 Java 的，而且根本没有侵入性。（有趣的是，PersonalBrain 最初只提供 Windows，然后他们进行了 Java 重写。一些功能仍然只是 Windows，但我很高兴在 Mac 上使用它。）

它确实在某种程度上取决于您要编写的应用程序 - 例如，您是否想在某个时候支持 iPhone？如果是这样，目前除了使用目标 C 之外别无选择，如果您提前计划，您可能会看到 MacOSX 工作中的一些重用。

无论你做什么，我肯定会建议将 UI 与程序的主逻辑分开 - 并使该主逻辑尽可能直接可移植。否则，您将在每个平台上重新发明每个轮子。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-08-14T18:13:20.197

正如我通常提到的这样的问题，您至少还应该看看[Real Studio](http://www.realsoftware.com)，它允许您从相同的代码库创建本地桌面应用程序。它还允许您使用声明或插件连接到低级服务。

# delphi - 我想为 TStringList.Objects 分配一条记录

> ID：367130
> 
> 赞同：8
> 
> 时间：2008-12-14T23:06:29.577
> 
> 标签：delphi

我想创建一个播放列表控件。我有很多信息要显示到 TStringList 中。我想将记录分配给 TStringGrid.Objects 而不是对象，因为创建/销毁这么多对象可能需要一段时间。它也需要大量的RAM。

一个记录会更快更苗条。我怎样才能做到这一点？

```
TYPE
 AMyRec= packed record
        FullName     : string[255];    
        RelativePath : boolean;        
        IsInvalid    : boolean;        
        InCache      : boolean;        
        etc
       end; 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-14T23:32:54.127

您可以使用 TList 指向记录的指针。

例如：

```
Type    
PMyrec = ^AMyRec; 
```

用法

```
var
   MyRec : PMyRec;
new(MyRec);
MyRec^.Fullname := 'test';
MyRec^.RelativePath := false; 
```

ETC

{ MyList 是您在其他地方创建的列表 }

```
MyList.Add(MyRec); 
```

您必须处理列表中的项目，例如

`Dispose(PMyRec(MyList[Index]));`

要使用列表中的项目：

```
var
  MyRec : PMyRec;

PMyRec := MyList.Items[i];
txtBox.Text = PMyRec^.Fullname; 
```

ETC

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-14T23:21:41.200

您可以使用记录指针。

```
List.AddObject(MyRecord.FullName, @MyRecord); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-14T23:38:56.813

**解决**
了我现在尝试过这样的事情（基于 KiwiBastard 的例子）：

```
Type
 AMyRec= packed record
        FullName     : string[255];
        RelativePath : boolean;
        IsInvalid    : boolean;
       end;
 PMyrec = ^AMyRec;

procedure TPlaylst.Button1Click(Sender: TObject);
VAR MyRec1: PMyRec;
    PlaylistCtrl: TStringGrid;
begin
 {SET}
 new(MyRec1);
 MyRec1^.Fullname := 'test';
 MyRec1^.RelativePath := false;
 PlaylistCtrl.Objects[1,1]:= Pointer(MyRec1); 

 {GET}
 ...
end; 
```

* * *

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T20:47:26.927

你确定你愿意分配所有这些对象吗？通过查看记录结构，您似乎想要每行一个对象 - 而不是每个单元格。为此，您至少有 2 个选项：

1.  （我最喜欢它，因为它提供了自由）您改用 TDrawGrid 并手动绘制单元格的内容。真的没那么难！
2.  您制作了一个封装此记录的对象。这也很简单，例如：

```
 type
  TMyRec= packed record
    FullName     : string[255];
    RelativePath : boolean;
    IsInvalid    : boolean;
  end;
  TMyData = object (TObject)
  private
    FData: TMRec;
  public
    constructor Create(AData: TMyRec);
    property FullName: String read FData.FullName write FData.FullName;
    property RelativePath: Boolean read FData.RelativePath write FData.RelativePath;
    property IsInvalid: Boolean read FData.IsInvalid write FData.IsInvalid;
  end;

...

constructor TMyData.Create(AData: TMyRec);
begin
  FData := AData;
end; 
```

现在，每当您想将数据连接到网格时，您只需将其打包到该对象中，然后您就可以使用 Objects 集合。

现在，无需经历所有麻烦，只需为 TDrawGrid.DrawCell 创建一个事件处理程序，例如

```
procedure TMainForm.GrdPathsDrawCell(Sender: Object; ...);
```

将 GrdPaths.Canvas.Handle 与 DrawText 一起使用，或者如果需要 Unicode，请使用 DrawTextW（两者都来自 Windows API，因此有大量如何使用它的示例），您和您的客户将节省很多挫败感、内存，最重要的是- 时间。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-14T23:23:07.250

为记录分配内存也需要时间。

创建您的记录并将指针指向字符串列表中的对象。

# windows - 如何要求Windows根据文件关联打开外部文件？

> ID：367141
> 
> 赞同：4
> 
> 时间：2008-12-14T23:14:53.460
> 
> 标签：windows, winapi, file-association

使用 Win32 特定的 API，是否有一种简单的方法来启动外部应用程序以打开文件，只需传入文件的路径/名称？

例如，假设我有一个名为 C:\tmp\image.jpg 的文件。我可以调用一个 API 来告诉 Windows 打开与 .jpg 文件关联的应用程序吗？无需进行大量注册表查找？

我想我记得很多年前做过这个，但我找不到它。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-14T23:18:17.980

[外壳执行](http://msdn.microsoft.com/en-us/library/bb762153(VS.85).aspx)

> 对指定文件执行操作。
> 
> ### 句法
> 
> C++
> 
> ```
> HINSTANCE ShellExecute(
>   _In_opt_ HWND    hwnd,
>   _In_opt_ LPCTSTR lpOperation,
>   _In_     LPCTSTR lpFile,
>   _In_opt_ LPCTSTR lpParameters,
>   _In_opt_ LPCTSTR lpDirectory,
>   _In_     INT     nShowCmd
> ); 
> ```
> 
> ### 参数
> 
> ...
> 
> *nShowCmd* [输入]
> 
> 类型：**INT**
> 
> 指定应用程序打开时如何显示的标志。如果*lpFile*指定了一个文档文件，则该标志被简单地传递给相关的应用程序。由应用程序决定如何处理它。这些值在 Winuser.h 中定义...

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-15T00:44:22.190

ShellExecute 是您正在寻找的功能。它可以处理可执行类型和已注册的文件类型，**并对**文件执行各种操作（动词），具体取决于它支持的内容。

语法是：

```
HINSTANCE ShellExecute(
    HWND hwnd,            // handle to owner window.
    LPCTSTR lpOperation,  // verb to do, e.g., edit, open, print.
    LPCTSTR lpFile,       // file to perform verb on.
    LPCTSTR lpParameters, // parameters if lpFile is executable, else NULL.
    LPCTSTR lpDirectory,  // working directory or NULL for current directory.
    INT nShowCmd          // window mode e.g., SW_HIDE, SW_SHOWNORMAL.
); 
```

有关更多详细信息，请参阅您友好的社区 MSDN 文档。

# ruby - Ruby/Rack 中的多部分响应

> ID：367151
> 
> 赞同：3
> 
> 时间：2008-12-14T23:27:14.357
> 
> 标签：ruby, sinatra, response, rack, multipart

我希望我的服务器发送一个多部分响应（multipart/x-mixed-replace）。我更喜欢使用 Sinatra 框架或通用 Rack 应用程序的某种解决方案，但 ruby​​ 中的任何示例都会很好。这相当于我在 PHP 中尝试做的事情：

```
<?php
  header('Content-type: multipart/x-mixed-replace;boundary="rn9012"');

  print "--rn9012\n";
  print "Content-type: application/xml\n\n";
  print "<?xml version='1.0'?>\n";
  print "<content>First Part</content>\n";
  print "--rn9012\n";
  flush();

  sleep(5);
  print "Content-type: application/xml\n\n";
  print "<?xml version='1.0'?>\n";
  print "<content>Second Part</content>\n";
  print "--rn9012--\n";

?> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-04T13:06:18.497

您可能可以为此使用 out.flush 方法：

```
class TestController < ApplicationController
  def index
    render :text => lambda { |resp, out|
      out.puts 'start'
      out.flush
      10.times do
        out.puts '.'
        out.flush
        sleep 1
      end
      out.puts 'done'
    }
  end
end 
```

但是，请记住，如果您使用 Mongrel 为您的 Ruby 代码提供服务（正如许多使用 RoR 的人所做的那样），您将根本无法进行流式传输。

# python - 将字符串拆分为单词和标点符号

> ID：367155
> 
> 赞同：70
> 
> 时间：2008-12-14T23:30:33.820
> 
> 标签：python, string, split

我正在尝试将字符串拆分为单词和标点符号，并将标点符号添加到拆分生成的列表中。

例如：

```
>>> c = "help, me"
>>> print c.split()
['help,', 'me'] 
```

我真正希望列表看起来像：

```
['help', ',', 'me'] 
```

所以，我希望字符串在空格处拆分，标点符号从单词中拆分出来。

我尝试先解析字符串，然后运行拆分：

```
>>> for character in c:
...     if character in ".,;!?":
...             outputCharacter = " %s" % character
...     else:
...             outputCharacter = character
...     separatedPunctuation += outputCharacter
>>> print separatedPunctuation
help , me
>>> print separatedPunctuation.split()
['help', ',', 'me'] 
```

这会产生我想要的结果，但在大文件上速度很慢。

有没有办法更有效地做到这一点？

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2008-12-15T01:53:18.617

这或多或少是这样做的：

```
>>> import re
>>> re.findall(r"[\w']+|[.,!?;]", "Hello, I'm a string!")
['Hello', ',', "I'm", 'a', 'string', '!'] 
```

诀窍是，不要考虑在哪里拆分字符串，而是要在标记中包含什么。

注意事项：

*   下划线 (_) 被视为内部单词字符。替换 \w，如果你不想要。
*   这不适用于字符串中的（单）引号。
*   将要使用的任何其他标点符号放在正则表达式的右半部分。
*   re 中未明确提及的任何内容都会被默默地删除。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2012-01-19T17:58:09.097

这是一个支持 Unicode 的版本：

```
re.findall(r"\w+|[^\w\s]", text, re.UNICODE) 
```

第一个替代方案捕获单词字符序列（由 unicode 定义，因此“ressumé”不会变成`['r', 'sum']`）；第二个捕获单个非单词字符，忽略空格。

请注意，与最佳答案不同，这将单引号视为单独的标点符号（例如 "I'm" -> `['I', "'", 'm']`）。这似乎是 NLP 中的标准，所以我认为它是一个特性。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2018-11-08T16:16:01.587

如果您打算使用英语（或其他一些常用语言）工作，您可以使用[NLTK](https://www.nltk.org/)（还有许多其他工具可以做到这一点，例如[FreeLing](http://nlp.lsi.upc.edu/freeling/node/1)）。

```
import nltk
nltk.download('punkt')
sentence = "help, me"
nltk.word_tokenize(sentence) 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-15T01:30:32.690

这是我的条目。

我怀疑这在效率方面的效果如何，或者它是否能涵盖所有情况（注意“!!!”组合在一起；这可能是也可能不是一件好事）。

```
>>> import re
>>> import string
>>> s = "Helo, my name is Joe! and i live!!! in a button; factory:"
>>> l = [item for item in map(string.strip, re.split("(\W+)", s)) if len(item) > 0]
>>> l
['Helo', ',', 'my', 'name', 'is', 'Joe', '!', 'and', 'i', 'live', '!!!', 'in', 'a', 'button', ';', 'factory', ':']
>>> 
```

如果您要逐行执行此操作，则一项明显的优化是事先编译正则表达式（使用 re.compile）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-15T01:05:11.197

这是对您的实施的一个小更新。如果您尝试做任何更详细的事情，我建议您查看 le dorfier 建议的 NLTK。

这可能只会快一点，因为使用 ''.join() 代替 +=，后者[已知更快](http://www.skymind.com/~ocrow/python_string/)。

```
import string

d = "Hello, I'm a string!"

result = []
word = ''

for char in d:
    if char not in string.whitespace:
        if char not in string.ascii_letters + "'":
            if word:
                    result.append(word)
            result.append(char)
            word = ''
        else:
            word = ''.join([word,char])

    else:
        if word:
            result.append(word)
            word = ''
print result
['Hello', ',', "I'm", 'a', 'string', '!'] 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-04-21T08:41:57.840

这对我有用

```
import re

i = 'Sandra went to the hallway.!!'
l = re.split('(\W+?)', i)
print(l)

empty = ['', ' ']
l = [el for el in l if el not in empty]
print(l)

Output:
['Sandra', ' ', 'went', ' ', 'to', ' ', 'the', ' ', 'hallway', '.', '', '!', '', '!', '']
['Sandra', 'went', 'to', 'the', 'hallway', '.', '!', '!'] 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-15T00:34:08.840

[我认为您可以在NLTK](http://nltk.org)中找到您能想象到的所有帮助，特别是因为您使用的是 python。本教程中对此问题进行了很好的全面讨论。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-04-15T19:11:22.487

我想出了一种方法来标记所有不需要硬编码的单词和`\W+`模式：`\b`

```
>>> import re
>>> sentence = 'Hello, world!'
>>> tokens = [t.strip() for t in re.findall(r'\b.*?\S.*?(?:\b|$)', sentence)]
['Hello', ',', 'world', '!'] 
```

这`.*?\S.*?`是一个匹配任何非空格的模式，`$`如果它是标点符号，则添加它以匹配字符串中的最后一个标记。

但请注意以下内容——这会将包含多个符号的标点符号分组：

```
>>> print [t.strip() for t in re.findall(r'\b.*?\S.*?(?:\b|$)', '"Oh no", she said')]
['Oh', 'no', '",', 'she', 'said'] 
```

当然，您可以使用以下方法查找和拆分此类组：

```
>>> for token in [t.strip() for t in re.findall(r'\b.*?\S.*?(?:\b|$)', '"You can", she said')]:
...     print re.findall(r'(?:\w+|\W)', token)

['You']
['can']
['"', ',']
['she']
['said'] 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-04-18T09:03:02.423

试试这个：

```
string_big = "One of Python's coolest features is the string format operator  This operator is unique to strings"
my_list =[]
x = len(string_big)
poistion_ofspace = 0
while poistion_ofspace < x:
    for i in range(poistion_ofspace,x):
        if string_big[i] == ' ':
            break
        else:
            continue
    print string_big[poistion_ofspace:(i+1)]
    my_list.append(string_big[poistion_ofspace:(i+1)])
    poistion_ofspace = i+1

print my_list 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-12-14T23:34:49.973

您是否尝试过使用正则表达式？

[http://docs.python.org/library/re.html#re-syntax](http://docs.python.org/library/re.html#re-syntax)

* * *

顺便一提。为什么你需要第二个“，”？你会知道，在写完每个文本之后，即

[0]

","

[1]

","

因此，如果您想添加“，”，您可以在使用数组时在每次迭代后添加。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2019-11-27T09:14:42.863

如果您不允许导入任何东西，请使用它！

```
word = "Hello,there"
word = word.replace("," , " ," )
word = word.replace("." , " .")
return word.split() 
```

# c# - IoC 容器的使用；特别是温莎

> ID：367178
> 
> 赞同：28
> 
> 时间：2008-12-14T23:52:08.720
> 
> 标签：c#, inversion-of-control, castle-windsor

我认为这个问题的答案是如此明显，以至于没有人费心写这个，但已经晚了，我真的无法理解这个问题。

我一直在阅读 IoC 容器（在本例中为温莎），但我想念您如何从代码的各个部分与容器对话。

我得到了 DI，我一直在做可怜的人 DI（空构造函数调用具有默认参数实现的重载注入构造函数）一段时间，我完全可以看到容器的好处。但是，我错过了一条重要信息；每次需要从容器中获取服务时，您应该如何引用容器？

我是否创建了一个传递的全局实例？肯定不是！

我知道我应该这样称呼：

```
WindsorContainer container = new WindsorContainer(new XmlInterpreter()); 
```

（例如）当我想加载我的 XML 配置时，我该如何处理容器？之后每次创建一个新容器是否通过一些内部静态majicks或其他方式持久化加载的配置，或者我是否每次都必须重新加载配置（我猜不是，或者生命周期无法工作）。

未能理解这一点使我无法弄清楚生命周期是如何工作的，并继续使用一些 IoC 可怕的东西

谢谢，

安德鲁

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-15T03:10:40.490

99% 的情况是每个应用程序一个容器实例。通常你在 Application_Start 中初始化它（对于一个网络应用程序），[像这样](https://github.com/castleproject/Castle.MonoRail-READONLY/blob/45ac205867396b1b7ad287a872e5b20afd0af837/src/TempWeb/Global.asax.cs)。

在那之后，这真的取决于容器的消费者。例如，一些框架，如[Monorail](http://www.castleproject.org/MonoRail/)和[ASP.NET MVC](http://www.codeplex.com/aspnet)允许您拦截实例（在本例中为控制器）的创建，因此您只需在容器中注册控制器及其依赖项即可，只要您获得request 容器负责注入每个控制器及其依赖项。参见例如[这个 ASP.NET MVC 控制器](http://mvccontrib.codeplex.com/SourceControl/changeset/view/6aa25407de83#src%2fSamples%2fMvcContrib.Samples.WindsorControllerFactory%2fControllers%2fHomeController.cs)。在这些框架中，您几乎不需要在类中调用甚至引用容器，这是推荐的用法。

其他框架不允许您轻松进入创建过程（例如 Webforms），因此您必须求助于像[这样](http://ayende.com/Blog/archive/2007/09/03/Rhino-Igloo-ndash-MVC-Framework-for-Web-Forms.aspx)的 hack ，或者*提取*所需的依赖项（即显式调用容器）。要拉取依赖项，请使用一个静态网关到容器，例如[这个或](https://rhino-tools.svn.sourceforge.net/svnroot/rhino-tools/trunk/commons/Rhino.Commons/RhinoContainer/IoC.cs)[maxnk](https://stackoverflow.com/questions/367178/usage-of-ioc-containers-specifically-windsor#367190)描述的那个。请注意，通过这样做，您实际上将容器用作服务定位器，它不会解耦事物以及控制反转。（见[这里](http://martinfowler.com/articles/injection.html#ServiceLocatorVsDependencyInjection)和[这里](http://blog.ploeh.dk/2010/02/03/ServiceLocatorIsAnAntiPattern.aspx)的区别）

希望这能消除您的疑虑。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T22:15:15.337

通常，您希望在整个应用程序的生命周期内只保留一个实例。我大部分时间做的是在应用程序启动时初始化容器，然后我使用类型化工厂进行容器不感知的对象拉取。

其他流行的方法是用静态类包装容器实例并使用该静态类来访问您的（单例）容器。[您可以在此处](https://svn.sourceforge.net/svnroot/rhino-tools/trunk/rhino-commons/Rhino.Commons/RhinoContainer/IoC.cs)的 Ayende 的 Rhino.Commons 库中找到一个示例。然而，这种方法有严重的缺点，应该避免。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T14:19:55.663

我使用 Michael Puleio 的博客中关于使用 HttpModule 处理使用 Unity 构建我的依赖项的示例。[http://blogs.msdn.com/mpuleio/archive/2008/07/17/proof-of-concept-a-simple-di-solution-for-asp-net-webforms.aspx](http://blogs.msdn.com/mpuleio/archive/2008/07/17/proof-of-concept-a-simple-di-solution-for-asp-net-webforms.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-23T14:18:09.453

正如这里的其他答案所说，有很多选择，我们再次留给自己找出在我们的情况下最好的选择。

也就是说，IMO 拥有一个可以在整个应用程序中访问的全局容器，这在某种程度上打破了隔离，因为现在很多代码都依赖于一个全局类。此外，对于拆分为多个程序集的应用程序，必须使所有这些程序集都可以访问全局容器。

使用[Unity](http://msdn.microsoft.com/en-us/library/dd203101.aspx)，您实际上可以在构造函数中使用 IUnityContainer 参数，当您解析类时，容器会自动将自身注入到实例中。这样，对于需要解析其他服务的服务，您可以在容器中传递，而不是强制类引用外部类。

不确定其他框架如何支持这种情况（Windsor 将注入`IKernel`）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T00:05:56.947

我正在使用这个接口的实现：

```
public interface IResolver
{
    object Resolve(Type type);
    object Resolve(string name);

    T Resolve<T>() where T : class;
    T Resolve<T>(string name) where T : class;
} 
```

它实际上包装在全局静态类中，例如：

```
public static class Resolver // : IResolver
{
    private static IResolver _current;

    public static object Resolve(Type type)
    {
        return Current.Resolve(type);
    }

    public static object Resolve(string name)
    {
        return Current.Resolve(name);
    }

    public static T Resolve<T>() where T : class
    {
        return Current.Resolve<T>();
    }

    public static T Resolve<T>(string name) where T : class
    {
        return Current.Resolve<T>(name);
    }

    private static IResolver Current
    {
        get
        {
            if (_current == null)
            {
                _current = new SpringResolver();
            }

            return _current;
        }
    }
} 
```

此外，我正在尝试遵循简单的规则 - 尽可能少地使用 Resolver 类，而是在需要这些服务的对象中注入服务。

# user-interface - 有什么好的网站可以查看实际 Web 应用程序的屏幕截图吗？

> ID：367179
> 
> 赞同：11
> 
> 时间：2008-12-14T23:53:06.053
> 
> 标签：user-interface, screenshot

我正在寻找一些具有Web 应用程序**实际**屏幕截图的网站，以及登录屏幕、网格/表格、编辑表单、CSS 示例等内容。

我发现在设计和设计自己的应用程序时 ，**查看其他应用程序有助于创作过程。**

我可以通过谷歌搜索图像来获得很多，但想看看我可能缺少哪些其他网站。

**例子**

我只是在寻找一站式网站……例如，我正在向数据表添加分页……很想去一个地方看看其他网站/应用程序是如何做到的。

**到目前为止，这是一个已编译的链接列表：**

*   [http://www.gooeytemplates.com/](http://www.gooeytemplates.com/)
*   [http://uipatternfactory.com/](http://uipatternfactory.com/)
*   [http://ui-patterns.com/](http://ui-patterns.com/)
*   [http://www.welie.com/patterns/index.php](http://www.welie.com/patterns/index.php)
*   [http://www.smileycat.com/design_elements/](http://www.smileycat.com/design_elements/)
*   [http://cssremix.com/](http://cssremix.com/)
*   [http://www.smashingmagazine.com/](http://www.smashingmagazine.com/)
*   [http://miniajax.com/](http://miniajax.com/)
*   [http://patterntap.com/](http://patterntap.com/)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-15T00:01:57.563

这个可以帮助： http: [//patterntap.com](http://patterntap.com/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T00:36:57.243

[MiniAjax](http://miniajax.com/)是可嵌入 web_apps 的 ajax 片段/解决方案的陈列室。它归 John Reisig（创建 JQuery 的人）所有，但他正在出售它。我想这比静态屏幕截图要好，因为您可以看到正在运行的功能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T01:45:48.523

如果您正在寻找造型技巧，那么您可以查看[Smashing Magazine](http://www.smashingmagazine.com/)。

具体来说，您可以在该站点上搜索分页。这是我这样做时得到的链接：

[http://www.smashingmagazine.com/2007/11/16/pagination-gallery-examples-and-good-practices/](http://www.smashingmagazine.com/2007/11/16/pagination-gallery-examples-and-good-practices/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T02:59:14.723

如果您正在寻找灵感，请查看[CSSRemix](http://www.cssremix.com)（类似于[TheFWA](http://www.thefwa.com)，但使用的是 HTML/CSS 而不是 Flash）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-21T01:07:49.793

找到了这个非常酷的网站[http://www.smileycat.com/design_elements/](http://www.smileycat.com/design_elements/)。他们有登录表单、页脚、页眉等的屏幕截图！好东西！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-15T15:47:07.017

我发现了更多网站：

*   [http://www.gooeytemplates.com/](http://www.gooeytemplates.com/)
*   [http://uipatternfactory.com/](http://uipatternfactory.com/)
*   [http://ui-patterns.com/](http://ui-patterns.com/)
*   [http://www.welie.com/patterns/index.php](http://www.welie.com/patterns/index.php)

我想我将开始在我原来的问题中编制一份清单。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-14T23:56:23.987

什么类型的“网络应用程序”？

因为您可以使用很多在线应用程序。想想你今天使用的那些。你在网上读过你的电子邮件吗？有任何社交应用帐户吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-08T11:48:43.217

Infragistics 刚刚创建了一个专门用于用户界面设计模式的网站，该网站具有一些特定功能的精美图像。您可以在[http://quince.infragistics.com/](http://quince.infragistics.com/)找到它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-14T23:56:26.933

确实有！[http://browsershots.org/](http://browsershots.org/)

玩得开心！:)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-15T01:18:07.567

我发现[www.themeforest.net](http://themeforest.net/category/site-templates/admin-skins)具有可用于用户界面设计的管理皮肤。

# asp.net - 在 NT AUTHORITY\NETWORK SERVICE 下运行池是否安全？

> ID：367180
> 
> 赞同：12
> 
> 时间：2008-12-14T23:53:31.933
> 
> 标签：asp.net, security, iis, iis-7, windows-server-2008

我通常会创建一个受限权限用户并在其下运行该进程，但 2008 年在 IIS7 下自动创建的池使用此帐户这一事实让我认为这是非常安全的，而且可能比我创建的更安全？来自 Redmond 的整个 Secure By Default 推动将让我相信情况就是如此。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-15T00:14:03.327

是的，它是安全的。[服务和服务帐户安全规划指南](http://technet.microsoft.com/en-us/library/cc170953.aspx)

还有一件事。最好使用本地服务帐户（不要与本地系统帐户混淆！）。它在本地服务器上与网络服务具有相同的权限。但没有网络权限。网络服务可以通过计算机帐户（如认证用户）的权限访问网络资源。

**更新1**（回复评论）：

据我所理解。这两个选项都可以。您的应用程序代码未在应用程序池标识下运行（默认情况下）。但是在对您的站点进行身份验证的用户的身份下。或者，如果允许匿名用户，则为 iuser_computername 帐户。应用程序池身份之所以重要，是因为您可以通过代码，因此注入他的代码的攻击者也可以将您的应用程序的身份更改为应用程序池身份。

也就是说，还有更多的复杂情况无法发布。

# c# - 为什么 Property Set 会抛出 StackOverflow 异常？

> ID：367192
> 
> 赞同：63
> 
> 时间：2008-12-15T00:09:57.860
> 
> 标签：c#

我知道 java 并且通常会使用 getter/setter 方法。我有兴趣使用以下代码在 C# 中执行此操作，但它会引发 StackOverflow 异常。我究竟做错了什么？

调用代码

```
c.firstName = "a"; 
```

物业代码

```
public String firstName;
{
    get
    {
        return firstName;
    }
    set
    {
        firstName = value;
    }
} 
```

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-12-15T00:14:10.033

这是因为您正在递归调用该属性 - 在`set`您再次设置该属性时，它会无限期地继续*下去*，直到您破坏堆栈。

您需要一个私有支持字段来保存该值，例如

```
private string firstName;

public string FirstName
{
    get
    {
        return this.firstName;
    }
    set
    {
        this.firstName = value;
    }
} 
```

或者，如果您使用 C# 3.0，您可以使用自动属性，它会为您创建一个隐藏的支持字段，例如

```
public string FirstName { get; set; } 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-15T00:14:42.153

您在属性中设置属性名称 - 而不是字段名称。这会更好：

```
private string m_firstName;

public String firstName;
{
    get
    {
        return m_firstName;
    }
    set
    {
        m_firstName = value;
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-08-19T07:48:22.253

StackOverflowExeption 在您的代码段中是不可避免的，这就是原因。

要理解这一点，我们必须知道什么是属性以及我们为什么使用它们。基本上，属性是一组方法，它不是一个字段。通过“属性”，我们指的是 set 方法（设置某物的值）和 get 方法（返回某物的值）的集合。

在使用上述方法为私有字段分配值时，属性为我们提供了一定程度的灵活性。

您的代码不起作用，因为您通过一次又一次调用 get 方法溢出堆栈，它就像一个没有任何退出条件的递归函数（当我们尝试获取 FirstName 的值时，该属性调用它的 get 方法，该方法返回它的值，再次调用 get ，再次调用 get ，再一次，再一次，再一次，你的堆栈被这些东西填满了）。

如果您的类中有一个私有字段，您可以使用该字段周围的属性公开它，我们可以为 get 和 set 方法添加额外的处理，这里是一个示例：假设我们想要获取一个数字的 ascii 代码 ( 0到9），我们可以为此使用一个属性（这不是最好的例子，它只是为了说明一些属性的使用）：

```
// this is the private field that we do not want to expose (aka to make
// it accessible for everyone
private int digit;

// But we want somehow to allow users of our class to interact 
// with the digit field, so we create a property.
// Note: fields' name start with lowercase, properties' name with Uppercase
public int Digit
{
   get 
   {
       // this is the method that gets calls whenever the user calls Digit,
       // Example: Console.WriteLine(object.Digit);

       // let's add here the logic of getting digit's ascii code
       return Char.Parse(digit.ToString());
   }

   set
   {
       // this method gets called when someone assigns a value for Digit
       // Example: Digit = 3;

       // here we can add the validation logic ( 0 <= value <=9)
       if(value < 0 || value > 9)
          throw new Exception("Please provide a number between 0 and 9");

       digit = value;
    }
} 
```

我们使用 Digit 属性在有人访问时将数字转换为 ASCII，并验证尝试分配给我们的数字字段的值。

在您的情况下，您可以像这样编写 FirstName 属性：

```
public string FirstName{  get; set; } 
```

在引擎盖下，这条线将被视为相同：

```
private string firstName;
public string FirstName
{
   get { return firstName; }
   set { firstName= value }
} 
```

* * *

更详细地说明堆栈溢出的原因。

有许多语言没有像 C# 那样的属性，所以人们只需添加单独的 get 和 set 方法。有了这个模型，就更容易发现溢出发生的位置。假设 C# 中没有属性，因此我们创建了一个私有字段和两个方法 - 一个用于设置，另一个用于获取私有字段的值。

```
private string firstName;

public string GetFirstName()
{
    return firstName;
}

public void SetFirstName(string value)
{
   firstName = value;
} 
```

现在他有一个 setter 和 getter，它们没有包含在属性中。要查看问题示例中发生溢出的位置，让我们将其调整到我们没有属性的新环境；

```
public string GetFirstName()
{
   return GetFirstName();
}

public void SetFirstName(string value)
{
   GetFirstName() = value; 
} 
```

这就是你的代码所做的。没有私人场地可以玩，物业自己玩^^

当我们写这个：

```
object.SetFirstName("Rick Astley"); 
```

我们进入 SetFirstName 方法，该方法调用 GetFirstName() 和 voala，死路一条。将“=>”视为“调用”：

> SetFirstName("Rick Astley") => GetFirstName() => GetFirstName() => ...

# javascript - JavaScript：给定图像 URL 列表，如何显示第一个未损坏的图像？

> ID：367197
> 
> 赞同：3
> 
> 时间：2008-12-15T00:16:18.080
> 
> 标签：javascript, image, dhtml, onerror

我收到一个图像 URL 列表，目前我的页面上有几个隐藏的 img 元素（列表中的每个 URL 一个）。页面加载完成后，我使用 JavaScript 检查图像并显示（即设置 myImage.style.display="inline"）第一个未损坏的图像。这很简单。但是，它要求我请求所有图像。

我想做的是一次加载每个图像并确定它是否损坏。如果图像损坏，请尝试加载下一张。如果它很好，则显示它并忽略其余部分。（这将节省一些不必要的请求。）

该算法很简单，但诀窍在于图像加载时间。问题是在 isBroken 检查发生之前图像可能尚未加载，因此可能会忽略良好的图像。然后的方法是将 img 的 onload 和 onerror 事件纳入解决方案。

我在这里发帖看看是否有人遇到过类似的问题以及他们的解决方案可能是什么。

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-15T00:49:53.083

看来您的想法是正确的。我会编写一个函数来尝试加载第一个 URL 并设置 onerror 属性以再次调用该函数。您可以将 onload 函数设置为实际显示图像，因为您知道它成功了。

您可能希望摆脱全局变量，但想法如下：

```
var images = ["bad.jpg", "error.jpg", "good.jpg", "not-tried.jpg"];

function tryNextImage() {
    var url = images.shift();
    if (url) {
        var img = new Image();

        img.onload = function() {
            document.body.appendChild(img);
        };
        img.onerror = tryNextImage;

        img.src = url;
    }
    else {
        // Handle the case where none of the images loaded
    }
} 
```

# .net-2.0 - 如何确保获取和设置操作的原子性以重定向 Console.Out 以记录控制台输出？

> ID：367201
> 
> 赞同：3
> 
> 时间：2008-12-15T00:23:08.923
> 
> 标签：.net-2.0, console, locking, atomic, console.setout

我需要拦截控制台输出流以便将其捕获为日志，但仍将内容传递给原始流，以便应用程序正常工作。这显然意味着在将原始`Console.Out`TextWriter 更改为`Console.SetOut(new MyTextWriterClass(originalOut))`.

我假设获取 Out 属性和调用 SetOut() 方法的各个操作`Console`是以线程安全的方式实现的。但我想确保其他一些线程（例如，运行我无法控制且无法更改的客户端应用程序代码，因此我不能依赖我自己的自定义锁定方案）不能在我的 get 和 set 之间意外更改它，最终被我对它的更改覆盖（破坏了他们的应用程序的行为！）。由于其他代码可能只是调用 SetOut()，因此我的代码理想情况下应该获得内部使用的相同锁`Console`（假设有一个）。

不幸的是，`Console`是一个（静态）类，而不是一个实例，所以你不能只是`lock (Console)`. 在类文档中查看似乎没有提到锁定。这不是这些 Console 方法的通常预期用法，但应该有一些安全的方法来作为原子操作执行此操作。

如果标准锁定方案失败，是否有其他方法可以确保这一点？对于如此短的关键部分（并且只完成一次），即使是暂时阻塞所有其他线程也是可以接受的，如果这是唯一的方法的话。我们正在使用 C# 和 .NET2.0。

*如果这*甚至不可能（不中断客户端应用程序），那么我们将不得不依赖它，客户端应用程序不太可能重定向其控制台输出*并*碰巧在我们的 get 和 set 操作之间进行。我只想覆盖所有的基础，以防万一。

**编辑**：现在我们有了示例代码的具体答案，我已经改写了问题标题，以更普遍地反映答案可以提供帮助的用例，更清楚。此外，还为“原子”添加了一个标签。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T14:46:56.467

如果您查看 SetOut 的实现，它对我来说看起来是线程安全的：

```
[HostProtection(SecurityAction.LinkDemand, UI=true)]
public static void SetOut(TextWriter newOut)
{
    if (newOut == null)
    {
        throw new ArgumentNullException("newOut");
    }
    new SecurityPermission(SecurityPermissionFlag.UnmanagedCode).Demand();
    _wasOutRedirected = true;
    newOut = TextWriter.Synchronized(newOut);
    lock (InternalSyncObject)
    {
        _out = newOut;
    }
} 
```

# 编辑

我能想出的最接近解决方案的方法是使用反射来获取它们的 InternalSyncObject，然后锁定它。

请注意，这是一个非常糟糕的主意，只有在没有其他选项存在时才应使用。您可能会导致框架出现意外行为并导致进程崩溃。

您还需要注意任何服务包和主要版本，以确保仍然使用内部变量。由于它是内部的，因此无法保证它会在下一个版本中出现。如果您不是具有反射的对象，请编写您的代码防御性并尝试很好地降低用户体验。

祝你好运：-）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-11T20:28:01.623

好的，现在我有一些时间来实际研究 Josh 建议的反射方法的实现。基本代码（在我的`ConsoleIntercepter`类中，继承自`TextWriter`）是：

```
private static object GetConsoleLockObject()
{
    object lockObject;
    try
    {
        const BindingFlags bindingFlags = BindingFlags.GetProperty |
            BindingFlags.Static | BindingFlags.NonPublic | BindingFlags.Public;
        // It's currently private, but we'd be happy if it were public, too.
        Type consoleType = typeof(Console);

        lockObject = consoleType.InvokeMember("InternalSyncObject", bindingFlags,
                                              null, null, null);
    }
    catch
    {
        lockObject = null; // Return null on any failure.
    }
    return lockObject;
}
public static void RegisterConsoleIntercepter()
{
    object lockObject = GetConsoleLockObject();
    if (lockObject != null)
    {
        // Great!  We can make sure any other changes happen before we read
        // or after we've written, making this an atomic replacement operation.
        lock (lockObject)
        {
            DoIntercepterRegistration();
        }
    }
    else
    {
        // Couldn't get the lock object, but we still need to work, so
        // just do it without an outer lock, and keep your fingers crossed.
        DoIntercepterRegistration();
    }
} 
```

然后`DoIntercepterRegistration()`会是这样的：

```
private static void DoIntercepterRegistration()
{
    Console.SetOut(new ConsoleIntercepter(Console.Out));
    Console.SetError(new ConsoleIntercepter(Console.Error));
} 
```

这只是为了对 Out 和 Error 进行锁定保护的原子替换；显然，实际的拦截、处理和传递给前一个`TextWriter`s 需要额外的代码，但这不是这个问题的一部分。

Note that (in the source code provided for .NET2.0) the Console class uses InternalSyncObject to protect initialization of Out and Error and to protect SetOut() and SetError(), but it does not use the lock around reads of Out and Error once they have been previously initialized. This is sufficient for my particular case, but could have atomicitiy violations if you did something more complex (and crazy); I can't think of any useful scenarios with that problem, but deliberately pathological ones can be imagined.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T03:50:03.843

如果您能尽早做到这一点，`Main()`您将有更好的机会避免任何竞争条件，特别是如果您可以在创建工作线程之前做到这一点。或者在某个类的静态构造函数中。

如果`Main()`标有该`[STAThread]`属性，它将在单线程单元中运行，因此这也应该有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T18:54:14.633

一般来说，我会使用安全模型来防止客户端代码在您不查看时重定向控制台。我确定这需要完全信任，因此如果客户端代码以部分信任运行，它将无法调用 SetOut()。

# tsql - 如何在 Sybase 中杀死不守规矩的 spid？

> ID：367210
> 
> 赞同：2
> 
> 时间：2008-12-15T00:36:14.873
> 
> 标签：tsql, sybase, kill, spid

我的数据库中有几个流氓 spid，当我以 as 登录`sa`并使用时，我可以看到它们正在休眠`sp_who`，但是尝试使用`kill <spid>`它们来消除它们失败了，我实际上无权访问服务器本身来反弹它. 有没有其他方法可以杀死这些东西？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-18T07:27:11.750

系统进程不能被杀死。例如，在 cmd 为 NETWORK HANDLER 的 sp_who 的输出中，不能终止 MIRROR HANDLER 和 CHECKPOINT SLEEP（或很少使用 CHECKPOINT）和 AUDIT PROCESS。如果它们的状态为“recv sleep”、“send sleep”、“alarm sleep”和“lock sleep”，它们可以被杀死。

在 sp_who 输出中，您无法判断状态为“recv sleep”的进程是否属于正在使用 SQL Server 的用户，但可能正在暂停以检查命令的结果，或者该进程是否指示用户已重新启动PC 或其他终端，并留下了一个搁浅的进程。您可以通过查询 sysprocesses 表的信息来了解有关有问题的进程的更多信息。例如：

从 spid = 8 的 sysprocesses 中选择 hostprocess、program_name

如果 program_name 是 isql 你知道这个 spid 可以被杀死。（等等......）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T22:47:06.573

我有一个有时会做类似事情的客户端应用程序。客户端通常处于选择的中间，但不再检索行。（这可能是客户端光标，但我不确定）。这些蜘蛛似乎无法杀死。我必须找到用户并要求他们注销。

我遇到这些的另一种情况是在服务器上出现错误或堆栈跟踪之后。检查您的错误日志，看看那里是否有任何可疑的条目。如果有，那么重新启动将是您唯一的选择。

# .net - 查找 Silverlight 控件所在的 HTML 元素

> ID：367213
> 
> 赞同：1
> 
> 时间：2008-12-15T00:39:17.067
> 
> 标签：.net, silverlight

有没有办法从 Silverlight 中找到托管 Silverlight 控件的页面上的 HTML 元素？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T06:58:54.710

用这个：

```
System.Windows.Browser.HtmlElement plugin = System.Windows.Browser.HtmlPage.Plugin; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T03:48:46.263

使用 firefox 并安装[FireBug](https://addons.mozilla.org/en-US/firefox/addon/1843)

然后使用“检查”按钮并突出显示页面的 Silverlight 部分。这应该会自动向您显示页面该部分的 HTML，并向您显示包含 silverlight 控件的元素。为下面的 flash 执行此操作的示例 - 或直接链接到此处： http: [//mikesingleton.net/images/firebug_ex.png](http://mikesingleton.net/images/firebug_ex.png)因为嵌入似乎不起作用

[http://mikesingleton.net/images/firebug_ex.png](http://mikesingleton.net/images/firebug_ex.png)

# javascript - document.write() 与插入 DOM 节点：保留表单信息？

> ID：367214
> 
> 赞同：6
> 
> 时间：2008-12-15T00:40:10.933
> 
> 标签：javascript, firefox, usability

考虑分别在正文中包含以下内容的两个网页：

```
<body>
<script>
document.writeln('<textarea></textarea>')
</script>
</body> 
```

和

```
<body>
<script>
var t = document.createElement('textarea');
document.body.appendChild(t);
</script>
</body> 
```

（将它们视为更大的东西的一部分，其中文本区域*必须*从 JavaScript 生成，并且不能硬编码到页面中）。它们都产生相同的输出，但前者被认为是“坏”的，而后者被认为是“正确”的做法。（对？）

另一方面，如果您在页面中键入内容然后刷新它，或者转到其他地方并点击返回，那么在前一种情况下，您在 textarea 中键入的内容会被保留，而在后面的情况下则会丢失。（至少在 Firefox 上。）

有没有办法使用后一种方法，并且仍然具有有用的功能，即使用户不小心点击刷新或通过“后退”按钮返回（至少在 Firefox 上），用户在表单中键入的内容也会被保存？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-15T02:42:15.227

我相信 document.write 版本实际上会破坏页面上的现有内容。即，body 和 script 标签将不再存在。这就是人们通常使用 appendChild 的原因。

是否保留文本是非常特定于浏览器的。我也不敢打赌 Firefox 在未来的版本中也不会改变它的行为。当用户尝试离开页面并且编辑字段中有未保存的内容时，我建议实施一个警报对话框。通常你会用一个卸载事件来做到这一点。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-21T19:42:25.270

只要在呈现页面时内联执行 document.write() ，它就不会删除页面内容。在线广告广泛使用 document.write() 在页面加载时将广告动态写入页面。

但是，如果您稍后在页面历史记录中执行 document.write() 方法（在正文完全呈现后），那么正如 Chase 所说，它将吹走现有正文并将参数显示给 document.write() .

除此之外，我同意保留表单行为确实是特定于浏览器的，在很多情况下你不应该依赖它。这是一个帮助用户的功能，而不是开发人员需要了解或尝试使用的功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T10:40:21.673

您是否可以添加一个可以用来将新文本区域定位到的钩子？例如。一个 <div>

```
<div id="addtextarea"></div>

var e = document.getElementByID('addtextarea');
e.innerHTML = '<textarea></textarea>'; 
```

然后，如果您需要记住内容，您可以使用 innerHTML 值来包含 HTML，或者只使用 textarea 的文本节点值来提取文本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-27T16:07:37.433

通常，我更喜欢创建一个 DOM 元素并插入它——尤其是因为我可以将它准确地插入到页面中我想要的位置（即使用 object.appendChild 或 body.appendChild）。插入是在页面加载期间还是稍后插入也没有关系，因此我可以使用通用插入函数并在整个页面加载期间或之后随时使用它。

但是，在加载过程中，如果您要插入包含 javascript 的内容（即 SCRIPT type="text/javascvript"......./SCRIPT 序列），则必须使用 document.write 才能获得脚本执行。

*   使用 document.body.appendChild(theInsertionObject) 将在加载过程的当前点正确添加插入，包括 SCRIPT 标记序列，但它不会执行 javascript。

*   如果使用 document.write(theInsertionCode)，代码将在加载过程的当前点插入，并且任何嵌入的 SCRIPT 标记序列将在加载页面的其余部分之前执行。

# c++ - 使用 STL 会显着增加占用空间吗？

> ID：367216
> 
> 赞同：13
> 
> 时间：2008-12-15T00:42:12.787
> 
> 标签：c++, stl

使用 STL 会显着增加占用空间吗？各位大神能分享一下这方面的经验吗？构建小型库的最佳实践是什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-15T01:02:14.743

由于 STL 是一组模板，因此没有一个答案。就其本质而言，模板仅在使用时才被编译。因此，您可以包含所有 STL，如果没有实际使用，则 STL 添加的占用空间将为零。如果您有一个非常小的应用程序，它设法使用许多具有不同专业的不同模板，那么占用空间可能会很大。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-15T01:57:52.337

关于 STL 的事情，因为它是所有模板，它只会在您实际使用时增加大小。如果您不使用方法，则不会实例化该方法。

但是你使用的东西总会有成本。

但你必须问的真正问题。大小会比您自己的实现更大还是更小？如果你不使用 STL，你用什么？您可以自己手写，但这有其自身的成本。它不是零空间，它不会经过很好的测试，你也不会遵循既定的最佳实践。

所以实际上不，它不会使您的代码膨胀。
因为通过其他方法添加等效功能将添加同样多的代码，它只是不会被很好地测试。

其他帖子指出模板代码必须内联或具有多个定义。
这是绝对**错误**的。

这些方法被标记为内联。但是，如果方法实际上是内联的，则取决于编译器。编译器内联足够复杂，只有在这将有助于使用的优化策略时才内联。

如果不是内联的，那么将在每个使用该方法的编译单元中生成该方法的副本。但是 C++ 链接器的一个要求是，当应用程序链接到可执行文件时，它必须删除这些方法的所有副本，但只有一个副本。如果编译器没有删除额外的副本，则必须生成多定义链接器错误。

这很容易证明：
以下说明：

*   _M_insert_aux() 方法不是内联的。
*   它被放置在两个编译单元中。
*   最终的可执行文件中只有该方法的一个副本。

### a.cpp

```
#include <vector>

void a(std::vector<int>& l)
{
    l.push_back(1);
    l.at(0) = 2;
} 
```

### b.cpp

```
#include <vector>

void b(std::vector<int>& l)
{
    l.push_back(1);
    l.at(0) = 2;
} 
```

### 主文件

```
#include <vector>

void a(std::vector<int>&);
void b(std::vector<int>&);

int main()
{
    std::vector<int>    x;
    a(x);
    b(x);
} 
```

### 检查

```
>g++ -c a.cpp
>g++ -c b.cpp

>nm a.o
<removed other stuff>
000000a0 S __ZNSt6vectorIiSaIiEE13_M_insert_auxEN9__gnu_cxx17__normal_iteratorIPiS1_EERKi
<removed other stuff>

>nm b.o
<removed other stuff>
000000a0 S __ZNSt6vectorIiSaIiEE13_M_insert_auxEN9__gnu_cxx17__normal_iteratorIPiS1_EERKi
<removed other stuff>

>c++filt __ZNSt6vectorIiSaIiEE13_M_insert_auxEN9__gnu_cxx17__normal_iteratorIPiS1_EERKi
std::vector<int, std::allocator<int> >::_M_insert_aux(__gnu_cxx::__normal_iterator<int*, std::vector<int, std::allocator<int> > >, int const&)

>g++ a.o b.o main.cpp
nm a.out | grep __ZNSt6vectorIiSaIiEE13_M_insert_auxEN9__gnu_cxx17__normal_iteratorIPiS1_EERKi
00001700 T __ZNSt6vectorIiSaIiEE13_M_insert_auxEN9__gnu_cxx17__normal_iteratorIPiS1_EERKi 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-15T01:55:56.960

使用 STL 会增加二进制文件的大小，有两个基本原因：

### 内联

默认情况下，编译器将模板代码视为内联。因此，如果您`std::list<int>`在几个不同*的编译单元中使用，并且编译器内联该代码*，它们每个都有自己的本地内联`std::list<int>`函数定义（这可能没什么大不了的，因为编译器只会内联非常小的定义默认）。

请注意（正如 Martin 在其他地方指出的那样）多重定义的符号被大型平台上的所有现代 C++ 链接器剥离，如[GCC 文档](http://gcc.gnu.org/onlinedocs/gcc-4.3.2/gcc/Template-Instantiation.html#Template-Instantiation)中所述。因此，如果编译器使模板代码脱机，链接器将删除重复项。

### 专业化

由于 C++ 模板的本质，`std::list<int>`它可能与`std::list<double>`. 事实上，标准要求`std::vector<bool>`定义为位向量，因此大多数操作与默认的*完全*不同`std::vector<T>`。

只有库维护者可以处理这个问题。一种解决方案是采用核心功能并将其“取消模板化”。`void*`把它变成一个随处可见的 C 风格的数据结构。那么，下游开发者看到的模板接口就是一个瘦包装器。这减少了重复代码的数量，因为模板专业化都有一个共同的基础。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-15T06:00:02.410

虽然它不涉及 STL 模板，但 GCC 的文档有一小节关于在使用模板模板时最大限度地减少代码膨胀。

链接是 [http://gcc.gnu.org/onlinedocs/gcc-4.3.2/gcc/Template-Instantiation.html#Template-Instantiation](http://gcc.gnu.org/onlinedocs/gcc-4.3.2/gcc/Template-Instantiation.html#Template-Instantiation)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-15T01:57:33.553

我假设您的意思是运行时**内存**占用，因此是 STL**容器**。

STL 容器对于它们是有效的......通用容器。如果您正在决定是编写自己的双向链表还是使用 std::list，请...使用 STL。如果您正在考虑为每个特定需求编写非常特定于域的位压缩容器，请先使用 STL，然后在所有代码正常工作后选择您的战斗。

一些好的做法：

*   **如果您的库要通过 API 公开这些容器，您可能必须在将 STL 代码放入库头文件或不使用 STL 之间做出选择。问题是我的编译器不必像你的那样实​​现 STL。**
*   阅读 STL 容器如何以及何时分配内存。当您可以可视化双端队列与向量相比如何增长和收缩时，您将更好地准备决定使用哪个。
*   如果您需要对每个字节进行微观管理，请考虑编写自定义分配器。这在嵌入式系统之外很少需要。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-15T06:06:09.653

基于指针的 STL 特化可以共享相同的实现。这是因为 (void *) 与 (int *) 或 (foo *) 具有相同的大小。所以虽然：

vector⟨int⟩ 和 vector⟨foo⟩ 是不同的实现。

vector⟨int *⟩ 和 vector⟨foo *⟩ 可以共享大部分相同的实现。许多 STL 实现这样做是为了节省内存占用。

如果整个模板是在头文件中定义的，所以它是完全定义的，像 g++ 这样的编译器将使用该类在每个编译单元中自动创建一个副本。正如其他人所说，链接器将删除多个定义。

它们还将自动内联类定义中的方法，以实现更高的优化级别。但这可以通过编译器选项来控制。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-15T02:29:00.200

暂时忽略 STL 的讨论，构建低空间占用的静态库有一个不明显的重要实践。将您的库分区为尽可能多的不同编译单元。例如，如果您查看`libpthread.a`，您会发现每个函数都有自己的编译单元。许多链接器会丢弃基于整个编译单元的死代码，但没有比这更细粒度的了。如果我只使用 pthreads 库中的几个函数，我的链接器将只引入这些定义，而不会引入其他任何东西。另一方面，如果将整个库编译为单个目标文件，我的链接器将不得不将整个库作为单个“单元”引入。

这取决于您使用的工具链，并且仅在您构建静态库时适用。但我已经看到它对于构建次优的大型库产生了非常可衡量的差异。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-15T01:33:59.653

在我曾经做过的一个 64kb 限制的嵌入式项目中，我什至无法链接标准 C 库。所以这取决于你需要做什么

# c++ - 什么时候在 OOP 中使用友谊是谨慎的？

> ID：367219
> 
> 赞同：4
> 
> 时间：2008-12-15T00:44:34.887
> 
> 标签：c++, oop, inheritance, friend, access-control

我目前正在阅读[http://www.cplusplus.com](http://www.cplusplus.com)教程，我在这里遇到了这个部分：[http](http://www.cplusplus.com/doc/tutorial/inheritance.html) ://www.cplusplus.com/doc/tutorial/inheritance.html 处理*朋友功能*的主题和C++ 中的*朋友类*。

我的问题是，什么时候在创建程序时谨慎使用友谊？

我得到的唯一线索是在文章中的一个示例中，该示例演示了一个“复制”对象的友元函数。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-15T00:49:52.833

[Marshall Cline 的C++ FAQ Lite](http://yosefk.com/c++fqa/friend.html)中有一些非常好的经验法则。

整个事情都很好，但特别是[“朋友违反封装吗？”](http://yosefk.com/c++fqa/friend.html#fqa-14.2) 有关正确使用它们的示例以及何时最好拆分类并将它们声明为朋友。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-15T02:07:09.353

友元函数的存在是为了将自由函数呈现为类接口的连续部分。在某些地方，自由函数是类接口的一部分。示例：假设您有一个任意精度的类`BigNum`。以下是友元函数的一些明显候选者：

```
// binary operators where BigNum isn't the left-hand operand
BigNum operator+ (int, BigNum);
BigNum operator- (int, BigNum);

// stream operators
std::ostream &operator<< (std::ostream &os, const BigNum &num);
std::istream &operator>> (std::istream &is, BigNum &num); 
```

现在，鉴于这两个示例，在许多情况下，二元运算符不需要成为朋友（例如，我可以`int + BigNum`通过委托 to 来实现`BigNum + int`，它是一个成员函数，因此已经具有完全访问权限）。但这一切都取决于您对性能的需求，以及您愿意通过类的公共成员函数公开什么。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-15T03:15:19.327

朋友类的一个很好的应用是[Memento](http://sourcemaking.com/design_patterns/memento)设计模式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T07:13:54.117

由于朋友通常会违反数据隐藏机制，因此只能在真正需要时使用。如果您的设计严重依赖朋友，那么它可能在某种程度上是错误的。

一个不能没有朋友的例子是重写 << 和 >> 流操作符。此外，友元类经常用于一些设计模式的实现——我想到了“迭代器”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T18:41:44.900

I only used friend methods and properties for use within the class itself for clone itself or assigning another object to itself. That was largely superseded we refactored the design to implement of the Memento Design pattern in our design.

The Memento is created by the same mechanisms used to save and load the object. i.e. the Memento creates a stream, the object writes to it, and the memento can be passed to any other object of the same class to make it an exact duplicate of the object creating the memento.

Sometimes there are cases when objects need to work really close together in which case I simplify their interaction by aggregating them behind another object. Variables that would be "friend" variables and only visible to the other objects are private to the class doing the aggregating.

# ruby-on-rails - 测试邮件列表软件的最佳方法是什么？

> ID：367222
> 
> 赞同：4
> 
> 时间：2008-12-15T00:49:47.093
> 
> 标签：ruby-on-rails, ruby, email, testing, mailing-list

我最近用 Ruby On Rails 编写了邮件列表软件。我想就测试它的最佳方法获得一些专家建议。例如，如果我可以编写一个脚本来生成 10,000 个电子邮件地址，使用该软件向这 10,000 个地址发送电子邮件，然后编写一个脚本来确保电子邮件能够通过，那就太棒了。我不确定这有多容易/可能。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T03:02:24.453

如果您碰巧在使用 Postfix MTA 运行的系统上有一个电子邮件地址，那么您可以随意使用大量的电子邮件地址。比如我的常规邮箱是nr@cs.tufts.edu，但是发到nr+xxx@cs.tufts.edu的邮件会按照~nr/.forward+xxx的内容转发。当我需要收集 120 个不同的电子邮件地址时，我曾经使用过这个工具，因为我充当了一群其他人之间匿名通信的可信第三方。

在 Postfix 的默认配置中，手册说

> name+foo 的邮件被传递到别名 name+foo 或别名，到 ~name/.forward+foo 或 ~name/.forward 中列出的目的地，到用户名拥有的邮箱，或者它因无法送达而被退回。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T01:01:40.610

只要你拥有所有 10,000 个电子邮件地址，你就可以做到

简单的解决方案是使用“包罗万象”的电子邮件地址设置电子邮件服务，即接收所有传入电子邮件到该地址不存在的同一域的电子邮件服务。然后，您可以为收件人地址生成随机废话，但都在同一个域中，并且在它们发送后，您可以从万能帐户中收集它们，去掉预期的收件人电子邮件地址列表，并将其与生成的收件人列表

不过，最好在自己的电子邮件服务器/系统上执行此操作，以避免被列为垃圾邮件发送者！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T09:02:08.283

我想您的 ML 管理器有一个命令界面，可以是 Web 界面，也可以是邮件界面（或希望两者兼有）？您还需要测试这些。Web UI 有点难测试，但邮件应该很简单。如果我要编写这样一个 ML 管理器，我可能会添加一个 XML-RPC/SOAP Web 服务来访问管理功能。如果您的 ML 管理器也支持按域（所有 *@aol.com 等）对邮件进行分组，那么也可以对此进行测试。在这种情况下，最好遵循 TDD 方法。MLM 中的许多功能都可以通过单元测试进行测试。

# .net - SqlDataReader 抛出 NullReferenceException！什么可能导致这种情况，我该如何调试？

> ID：367225
> 
> 赞同：5
> 
> 时间：2008-12-15T00:50:09.213
> 
> 标签：.net, multithreading, debugging, exception

我在错误日志中发现了这一点，并试图找出它是如何可能的。NullReferenceException 并非每天都会出现在 .net 基类的深处！

```
1) Exception Information
*********************************************
Exception Type: System.NullReferenceException
Message: Object reference not set to an instance of an object.
Data: System.Collections.ListDictionaryInternal
TargetSite: Void Bind(System.Data.SqlClient.TdsParserStateObject)
HelpLink: NULL
Source: System.Data

StackTrace Information
*********************************************
   at System.Data.SqlClient.SqlDataReader.Bind(TdsParserStateObject stateObj)
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult esult)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)
   at System.Data.Common.DbCommand.System.Data.IDbCommand.ExecuteReader(CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)
   at MyCode.Shared.Data.DataSocket.GetTable(String SPString)
   at <rest of stack trace> 
```

我唯一能想到的是有一个（很小的）机会有两个线程同时执行相同的方法，一个清除或修改了传递给 Fill() 的 DataSet。所以我的问题是：

*   这个异常怎么会被抛出
*   多线程场景是否会导致此异常
*   我怎么能确定，例如，有没有办法可以逐步通过 System.Data 方法来复制问题？

顺便说一句，我发现了这个问题的其他几个案例，一个在[这个](http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/31f3e2d3-7e79-4a5e-8ac5-98a10479be41/)线程中，另一个在某人页面的[这个](http://216.239.59.132/search?q=cache:IXoOnmhgFnAJ:www.hotel-ubytovani.com/5585-ubytovani-Hrabisin.htm+System.NullReferenceException+%22at+System.Data.SqlClient.SqlDataReader.Bind(TdsParserStateObject+stateObj)%22&hl=en&ct=clnk&cd=2&gl=uk&client=firefox-a)谷歌缓存中。不过，两者似乎都没有任何帮助。

我正在执行的 GetTable() 方法如下所示：

```
public DataTable GetTable(string SPString)
{
    //Setup the data objects by calling helper
    prepareDataAdaptor(SPString,CommandType.Text);

    dataAdaptor.Fill(dataSet);
    dataAdaptor.SelectCommand.Connection.Close();
    DataTable dt;
    //ensure we dispose okay
    using(dataSet)
    {   

        if(dataSet.Tables.Count==0)
        {
            dataSet.Tables.Add(new DataTable("EmptyTable"));
        }

        dt=dataSet.Tables[0];
        //because we are disposing we need to remove the table from the dataset
        dataSet.Tables.Clear();

    }
    return dt;
}

private void prepareDataAdaptor(string SPString,CommandType Type)
{
    checkForConnection();
    dataSet=new DataSet();
    dbCommand.CommandText=SPString;
    dbCommand.CommandTimeout = MySettings.CommandTimeout;
    dataAdaptor.SelectCommand=dbCommand;
    dataAdaptor.SelectCommand.CommandType=Type;
    dataAdaptor.SelectCommand.Connection=dbConnection;
    dataAdaptor.SelectCommand.Parameters.Clear();
} 
```

dataAdaptor (sic) 是一个声明为 IDbDataAdapter 的实例变量，其中填充了 SqlDataAdapter。dataSet 是 DataSet 类型的实例变量。

我的理论认为线程 A 贯穿并进入 SqlDataAdapter.Fill() 方法。与此同时，线程 B 也在执行，并做了一些弄乱线程 A 的事情，比如这一行：

```
dataAdaptor.SelectCommand.Connection.Close(); 
```

我可以看到我的这段代码不是线程安全的，但我怎么能确定这是导致上述异常的问题？

非常感谢您的任何建议！

罗里

编辑：固定拼写糟糕的情况。没有在代码中更新它，因为它就是这样。

更新：我同意这段代码有几个问题应该修复，但我的主要兴趣是是否有任何方法可以验证是这个线程问题导致了这个错误。鉴于我的应用程序，它有点牵强，但我唯一能想到的。在我修改代码以使其更好之前，我想确定我已经找到了异常的原因，以便我可以确定我已经修复了它。

例如，有什么方法可以进入 .net 代码？我正在使用 VS 2005 / .net 2.0 但我认为在 VS 2008 中您可以查看 .NET 框架源代码？如果是这种情况，我可以创建一个 2 线程场景并逐步重新创建这个问题吗？或者有没有不需要我安装 VS 2008 的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T01:23:11.173

您的数据集不应该是类级别的变量。在这两个调用之间或在填充操作期间，它可能正在被另一个线程处理或访问。

准备数据适配器（SPString，CommandType.Text）；

数据适配器。填充（数据集）；

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T11:28:24.587

> 多线程场景是否会导致此异常

ADO.NET 类的实例方法（例如 SqlCommand）通常不是线程安全的。因此，如果您从多个线程中使用此类实例，您可能会遇到您所描述的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T01:22:47.430

我会在 dataAdaptor.Fill(dataSet) 周围添加一些日志代码，以显示 ThreadID 和其他信息。你可以使用 Console.Writeline，但我强烈推荐 log4net。此外，使您的代码线程安全。每个线程都应该有自己的 DataSet 和 DataAdapter，或者使用互斥锁。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T00:58:28.993

我猜想处理数据集会使它包含的表无效！

顺便说一句，您不需要数据集，您可以直接填充数据表 - 或调用为您创建数据表的其他数据适配器函数（获取，我认为）

它的拼写是“适配器”而不是“适配器”；-)

# c# - 洪水填充算法

> ID：367226
> 
> 赞同：7
> 
> 时间：2008-12-15T00:52:20.597
> 
> 标签：c#, algorithm, flood-fill

又是周末了，这意味着我可以玩我的[爱好项目](https://stackoverflow.com/questions/332585/2d-platformer-physics)。

我已经厌倦了手动创建测试关卡，所以我想我会从引擎开发中休息一下，并在关卡编辑器上工作：

[关卡编辑器 http://gfilter.net/junk/Editor.JPG](http://gfilter.net/junk/Editor.JPG)

我想在编辑器中实现一个洪水填充算法，它就像在绘画程序中一样工作。有没有人知道什么技术在这里对我有用？

关卡只是一个二维数组，因此可以认为它实际上与位图相同。

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-15T02:54:40.087

维基百科的文章非常好。只要您的网格很小，几乎任何东西都可以工作。

今年秋天早些时候，我对 10 兆像素的扫描图像进行了一些填充。（问题是从在复印机上扫描的书页上去除黑边。）在那种情况下，只有两种颜色，所以我基本上把这个问题当作在无向图中进行搜索，每个像素都连接到它的邻居四个罗盘方向。我维护了一个**单独的位图来跟踪哪些像素被访问过**。

主要发现是

*   **不要尝试递归深度优先搜索**。你真的想要一个显式的数据结构。

*   辅助**队列使用的空间比堆栈少得多**。大约**少了四十倍的空间**。换句话说，比起深度优先搜索，更喜欢广度优先搜索。

同样，**这些发现仅适用于具有数百万像素的网格**。在像您的问题中显示的那样漂亮的小网格上，任何简单的算法都应该有效。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-15T01:18:38.673

我们必须为学校编程：

```
1: stuff the start pixel into a queue, note its color. note it as added.
2: begin picking a pixel off the queue. If it's similar to the start pixel:
   2: put all its neighbours into the queue
      for each added pixel, note it's added. if already noted for a pixel, don't 
      add it anymore.
   3: color it with the destination color.
3: nonempty => jump back to 2
4: empty => we are finished 
```

根据我们是做 8-neighbour 还是 4-neighbour，我们检查所有 8 个相邻像素，或者仅检查左/右或某个像素上方/下方的像素。这是代码（使用 ImageJ。我删除了一些不相关的代码）。我希望它有意义，它是 Java。只是问问题：

```
public class Uebung1_2 implements PlugInFilter, MouseListener {
    private ImageProcessor ip;
    boolean[] state;
    int[] pixels;
    Queue<Integer> nextPixels;
    int threshould;

    /**
     * adds one pixel to the next-pixel queue only if it's not
     * already added.
     */
    void addNextPixel(int p) {
        if(!state[p]) {
            nextPixels.add(p);
            state[p] = true;
        }
    }

    boolean pixelsSimilar(int color1, int color2) {
        int dr = Math.abs(((color1 >> 16) & 0xff) -
                          ((color2 >> 16) & 0xff));
        int dg = Math.abs(((color1 >>  8) & 0xff) -
                          ((color2 >>  8) & 0xff));
        int db = Math.abs(((color1 >>  0) & 0xff) -
                          ((color2 >>  0) & 0xff));
        return ((double)(dr + dg + db) / 3.0) <= threshould;
    }

    /**
     * actually does the hard work :)
     * @param x the x position from which to start filling
     * @param y the y position from which to start filling
     */
    private void doFill(int x, int y, boolean connect8) {
        // first, add the start pixel
        int width = ip.getWidth(),
            height = ip.getHeight();
        /* for 8bit, we just gonna take the median of rgb */
        Color colorC = ij.gui.Toolbar.getForegroundColor();
        int color = colorC.getRGB();
        int firstPixel = ip.get(x, y);

        // go on with the mainloop
        addNextPixel(y * width + x);
        while(!nextPixels.isEmpty()) {
            int nextPixel = nextPixels.remove();
            int pixel = pixels[nextPixel];
            if(pixelsSimilar(pixel, firstPixel)) {
                // yay it matches. put the neighbours.
                int xN = nextPixel % width,
                    yN = nextPixel / width;
                /* the three pixels above */
                if(yN - 1 >= 0) {
                    if(connect8) {
                        if(xN + 1 < width) { 
                            addNextPixel(nextPixel - width + 1);
                        }
                        if(xN - 1 >= 0) {
                            addNextPixel(nextPixel - width - 1);
                        }
                    }
                    addNextPixel(nextPixel - width);
                }

                /* pixels left and right from the current one */
                if(xN > 0) {
                    addNextPixel(nextPixel - 1);
                }
                if(xN + 1 < width) {
                    addNextPixel(nextPixel + 1);
                }

                /* three pixels below */
                if(yN + 1 < height) {
                    if(connect8) {
                        if(xN + 1 < width) { 
                            addNextPixel(nextPixel + width + 1);
                        }
                        if(xN - 1 >= 0) {
                            addNextPixel(nextPixel + width - 1);
                        }
                    }
                    addNextPixel(nextPixel + width);
                }

                /* color it finally */
                pixels[nextPixel] = color;
            }
        }
    }

    @Override
    public void run(ImageProcessor ip) {
        ij.WindowManager.getCurrentImage().getCanvas().addMouseListener(this);
        this.ip = ip;
        this.pixels = (int[])ip.getPixels();
        this.state = new boolean[ip.getPixelCount()];
        this.nextPixels = new LinkedList<Integer>();
    }

    @Override
    public int setup(String arg0, ImagePlus arg1) {
        return DOES_RGB;
    }

    @Override
    public void mouseClicked(MouseEvent e) {
        ij.WindowManager.getCurrentWindow().getCanvas().removeMouseListener(this);
        ij.gui.GenericDialog g = new GenericDialog("Please enter parameters");
        g.addChoice("connection", new String[]{"4-connect", "8-connect"}, "8-connect");
        g.addNumericField("Threshould (0..255)", 0.0, 3);
        g.showDialog();

        boolean connect8 = g.getNextChoice().equals("8-connect");
        threshould = (int) g.getNextNumber();
        doFill(e.getX(), e.getY(), connect8);
        ij.WindowManager.getCurrentImage().draw();
    }
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-15T00:54:03.933

[一般参考](http://en.wikipedia.org/wiki/Flood_fill)

[C#中的优化算法](http://www.codeproject.com/KB/GDI-plus/queuelinearfloodfill.aspx)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-15T00:54:36.973

[维基百科在他们的洪水填充](http://en.wikipedia.org/wiki/Flood_fill)文章中提供了一些不同洪水填充技术的伪代码示例。您选择哪种技术取决于应用程序。

请记住，洪水填充很容易被线程化（类似于快速排序的方式）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-07-08T13:24:08.467

无需检查颜色容差的简单功能

使用：

```
var img = Image.FromFile("test.png");
img = img.FloodFill(new Point(0, 0), Color.Red);
img.Save("testcomplete.png", ImageFormat.Png); 
```

主功能：

```
 public static Image FloodFill(this Image img, Point pt, Color color)
    {
        Stack<Point> pixels = new Stack<Point>();
        var targetColor = ((Bitmap)img).GetPixel(pt.X, pt.Y);
        pixels.Push(pt);

        while (pixels.Count > 0)
        {
            Point a = pixels.Pop();
            if (a.X < img.Width && a.X > -1 && a.Y < img.Height && a.Y > -1)
            {
                if (((Bitmap)img).GetPixel(a.X, a.Y) == targetColor)
                {
                    ((Bitmap)img).SetPixel(a.X, a.Y, color);
                    pixels.Push(new Point(a.X - 1, a.Y));
                    pixels.Push(new Point(a.X + 1, a.Y));
                    pixels.Push(new Point(a.X, a.Y - 1));
                    pixels.Push(new Point(a.X, a.Y + 1));
                }
            }
        }
        return img;
    } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-15T00:57:46.827

平心而论，它应该很简单。因为无论如何你都有基本的瓦片结构，所以算法会相当简单：

```
Select Tile To Fill:    
Fill Till    
Check neighbouring Tiles - If Empty Then Fill    
Repeat, for all filled tiles. 
```

免责声明：以上是非常基本的描述。网上有很多参考资料，比我能解释得更好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-05-20T11:34:46.340

下面是如何在 C# 程序中使用 GDI+ 例程的示例。

（[https://www.pinvoke.net/default.aspx/gdi32.extfloodfill](https://www.pinvoke.net/default.aspx/gdi32.extfloodfill)）

```
using System.Runtime.InteropServices;
//insert by Zswang(wjhu111#21cn.com) at 2007-05-22
[DllImport("gdi32.dll")]
public static extern IntPtr SelectObject(IntPtr hdc, IntPtr hgdiobj);
[DllImport("gdi32.dll")]
public static extern IntPtr CreateSolidBrush(int crColor);
[DllImport("gdi32.dll")]
public static extern bool ExtFloodFill(IntPtr hdc, int nXStart, int nYStart, 
    int crColor, uint fuFillType);
[DllImport("gdi32.dll")]
public static extern bool DeleteObject(IntPtr hObject);
[DllImport("gdi32.dll")]
public static extern int GetPixel(IntPtr hdc, int x, int y);
public static uint FLOODFILLBORDER = 0;
public static uint FLOODFILLSURFACE = 1;

private void button1_Click(object sender, EventArgs e)
{
    Graphics vGraphics = Graphics.FromHwnd(Handle);
    vGraphics.DrawRectangle(Pens.Blue, new Rectangle(0, 0, 300, 300));
    vGraphics.DrawRectangle(Pens.Blue, new Rectangle(50, 70, 300, 300));
    IntPtr vDC = vGraphics.GetHdc();
    IntPtr vBrush = CreateSolidBrush(ColorTranslator.ToWin32(Color.Red));
    IntPtr vPreviouseBrush = SelectObject(vDC, vBrush);
    ExtFloodFill(vDC, 10, 10, GetPixel(vDC, 10, 10), FLOODFILLSURFACE);
    SelectObject(vDC, vPreviouseBrush);
    DeleteObject(vBrush);
    vGraphics.ReleaseHdc(vDC);
} 
```

如果您在 OnPaint 事件处理程序中调用它，而不是使用`Graphics vGraphics = Graphics.FromHwnd(Handle);`，您可以使用`e.Graphics`. 为我工作得很好。

有时最好不要重新发明算法并使用现有例程，尽管在移植到 Mono 时可能会遇到一些问题。

# php - 自动重新格式化继承的 PHP 意大利面条代码

> ID：367257
> 
> 赞同：9
> 
> 时间：2008-12-15T01:23:06.510
> 
> 标签：php, code-formatting

我接手了一个混合的 PHP4/PHP5 项目，该项目已从开发人员传给开发人员，每一个都使事情变得更糟。在我花太多时间之前，我想开发一个基本标准，至少具有一致的格式。

谁能推荐一个可以重新格式化代码的实用程序（最好是 Linux 或 Mac OS X）？

如果我可以设置影响输出的参数（如制表符缩进、大括号/括号放置、何时将数组值拆分到新行等），那么这是一个好处，尽管并不重要。

偏好去开源工具，虽然我也想知道你购买软件的经验。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-15T01:33:39.797

您可以使用[Netbeans](http://netbeans.org)或[Eclipse PDT](http://www.eclipse.org/pdt/)来做到这一点，它们都是出色的 PHP 编辑器。每个都有一个格式代码选项，它将根据您的代码样式偏好重新格式化选定的文件。也可以选择批量格式化代码。

我确实建议如果你这样做，请执行格式并立即用一个大胖子“重新格式化！”重新检查代码。评论。尝试将其他错误修复与重新格式化相结合会导致看起来令人讨厌的差异文件试图破译。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-08-26T17:11:09.570

我使用 phptidy：~~[http](http://cmr.cx/phptidy/)~~ [://cmr.cx/phptidy/ https://github.com/cmrcx/phptidy](https://github.com/cmrcx/phptidy)

按照设计，它不像 perltidy 那样具有攻击性，但它仍然非常有用。它可以进行配置，并将您项目中的所有 php 文件作为批处理。

更新：对于更积极的、基于标准的工具，请考虑 PHP CS Fixer：[https ://github.com/FriendsOfPhp/PHP-CS-Fixer](https://github.com/FriendsOfPhp/PHP-CS-Fixer)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T01:47:10.550

我使用了[http://www.phpformatter.com/](http://www.phpformatter.com/)，这是一个在线工具。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-09T04:24:08.583

我最近发现的东西，我现在一直喜欢和使用。在 vim 中：

```
gg=G 
```

这需要以下配置选项，您可以在 中设置`~/.vimrc`：

```
filetype plugin indent on 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T02:18:33.060

结帐[CodeSniffer](http://pear.php.net/package/PHP_CodeSniffer)。我也用过这个[脚本](http://pastebin.com/f19c5df99)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T04:38:53.277

在我自己的搜索中，我发现[了关于 Pretty Print 的 Wikipedia 文章](http://en.wikipedia.org/wiki/Prettyprint "漂亮的印刷品")，我认为它会很有用。

# git - git commit - 将时间戳设置到未来

> ID：367262
> 
> 赞同：45
> 
> 时间：2008-12-15T01:24:11.453
> 
> 标签：git

我需要使用 Git 进行一些提交，但我希望 git-log 中的时间戳在未来。

如何在 git 中进行提交，导致将来的时间戳记在 git-log 中？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-12-15T04:30:00.063

你应该稍等一下。

或者你可以这样做：

```
/tmp/x 604% env GIT_AUTHOR_DATE='Wed Dec 19 15:14:05 2029 -0800' git commit -m 'future!'
[master]: created 6348548: "Future!"
 1 files changed, 1 insertions(+), 0 deletions(-)

/tmp/x 605% git log 

Author: Dustin Sallings <dustin@spy.net>
Date:   Wed Dec 19 15:14:05 2029 -0800

    Future! 
```

**请注意**，同时存在作者日期和提交者日期，因此请务必设置正确的日期（或两者都设置）。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2011-02-16T13:56:55.693

您可以修改提交，以 2037 年为例：

```
git commit --amend --date="Wed Feb 16 14:00 2037 +0100" 
```

我也尝试了 2038 年，但后来我得到了一个*空*值作为日期。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-09-24T21:13:24.363

如果您想在将项目添加到 git 时保留实际的更改日期，可以使用

```
env GIT_AUTHOR_DATE="`ls -rt *.cpp|tail -1|xargs date -u -r`" git commit -m "Old sources retaining old change-dates of last changed
 file: `ls -rt *.cpp|tail -1`, actual commit date: `date`" 
```

这将提交最后更改的 *.cpp 文件的更改日期，以及实际提交日期的一个很好的解释消息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-01-13T04:13:40.620

通过将 Hugo 的答案 ( [1](https://stackoverflow.com/a/1474183/1973492) ) 与在此处找到的信息 ( [2](https://askubuntu.com/a/61182) ) 结合起来，并折腾一些`sed`，我得到了这个：

```
alias newest="find . -path ./.git -prune -o -type f -exec stat -c \"%y %n\" '{}' + | sort -r | head -1 | sed s#'.*\./'##"
GIT_AUTHOR_DATE="$(newest | xargs date -u -r)" GIT_COMMITTER_DATE="$(newest | xargs date -u -r)" git commit -m "Old sources retaining old change-dates of last changed file: $(newest), actual commit date: $(date)" 
```

主要区别在于此版本执行递归搜索，因此您可以在树中的任何位置获取最新文件 - 尽管它确实跳过了 .git 目录，这是故意的。

当然，您可能想在此处删除一个日期变量，而我使用的是相当新的 bash 版本（4.2.37(1)-release），因此 $() 符号可能不适合您（只是用反引号 (`) 替换它）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-08-28T21:17:22.753

如果您想修改日期为“未来”的提交，如[本答案所示](https://stackoverflow.com/a/5017325/6309)：

```
git commit --amend --date="Wed Feb 16 14:00 2037 +0100" 
```

*   不使用 2016 年之后的日期（Git 2.18 或更低版本）
*   使用 Git 2.19（2018 年第三季度）

请参阅[Derrick Stolee ( ) 的](https://github.com/derrickstolee)[提交 1820703](https://github.com/git/git/commit/1820703045f8974bc5320d08a3611f4e29c83bf9)（2018 年 8 月 21 日[）](https://github.com/derrickstolee)。^(（由)^([Junio C Hamano 合并](https://github.com/gitster))^([——](https://github.com/gitster))^在^([提交 1392c5d](https://github.com/git/git/commit/1392c5d28935a3aa25367df52adf4ca1e3c5724e))^(中，2018 年 8 月 27 日）)[`derrickstolee`](https://github.com/derrickstolee)
^([`gitster`](https://github.com/gitster))

> ## `commit`:`timestamp_t`用于`author_date_slab`
> 
> 用于在 rev-list 或 log 中使用标志`author_date_slab`行走时存储提交的作者日期。 这在[81c6b38](https://github.com/git/git/commit/81c6b38b67019eff48e8e5c324bb77f6c796c0b5)中添加为“无符号长整数”（“ ：”，2013 年 6 月，Git 1.8.4-rc0）`--author-date`
> `log``--author-date-order`
> 
> 由于 ' `unsigned long`' 跨平台的位数不明确（例如，Linux 中的 64 位，Windows 中的 32 位），因此大多数对作者日期的引用`commit.c`都转换为`timestamp_t`dddbad7 [（](https://github.com/git/git/commit/dddbad728c93280fe54ef86699b6d70e2aab44d1) “timestamp_t：一种新的数据类型时间戳”，2017 年 4 月，Git 2.14.0-rc0）
> 
> 但是，slab 定义被遗漏了，导致 Windows 中的数据类型不匹配。**除非有人在 February 2106 之后提交提交，否则**
> 这不会显示为错误，但提交可以存储任何内容作为其作者日期。

 *** * *

## 回答 #6

> 赞同：-5
> 
> 时间：2008-12-15T03:41:01.740

请问您为什么要这样做？

如果您不想更改时钟，我建议您创建一个脚本来执行提交并使用 Windows 调度程序（或您的操作系统的任何等效项）在您希望提交的时间运行脚本。

# database - 在提交中保存数据库数据更改（如果不是 sqlite）

> ID：367273
> 
> 赞同：1
> 
> 时间：2008-12-15T01:33:29.280
> 
> 标签：database, version-control

我们有一个使用 PostgreSQL 特定查询的 Rails 项目，因此即使在开发模式下使用 sqlite 也很不舒服。问题是，我喜欢跟踪数据库中的架构更改并根据请求省略运行迁移，我也喜欢使用 git 跟踪 db-data 更改，这样我就不需要转储数据库并加载它在我的机器上。所以基本上我只想做'git pull'并看到应用程序使用新的模式和数据。

这里有哪些可能的策略？我唯一想到的是使用一个简单的包装器，它接受一个 sql-query，检查它是否有任何特定于 db 的部分并为开发环境重写它，这样我们仍然可以使用 sqlite。还有什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T06:32:49.397

我不确定我是否理解您问题的所有细微差别——尤其是关于使用 SQLite 与 PostgreSQL 的评论。如果是多DBMS系统，多系统测试就好；如果它是一个单一的 DBMS 系统，那么使用多个 DBMS 会使生活变得毫无意义。

此外，您谈到跟踪数据库中的架构更改......这是将有关架构更改的信息与 DBMS 自己的系统目录分开存储，还是您真的是说您想要跟踪数据库架构更改（使用数据库外部的东西 -例如VCS）？

您还谈到了跟踪“数据库数据更改”，我将其理解为“数据库中表中的数据”。同样，我不清楚您是否正在考虑从数据库中转储某种数据，以涵盖一天前的数据与现在的数据之间的差异，或者其他什么。

这些问题可能是您超过 4 小时没有得到回复的原因。

当您谈论“简单包装器”时，您并不是在谈论我称之为简单的东西。它必须解析任意 SQL，确定其中是否是特定于 DBMS 的，然后应用重写规则。这是一项不平凡的工作。在正确的位置调用包装器也并非易事——这取决于您用于访问 DBMS 的 API 集等。

还有什么？

*   在生产和开发中使用相同的 DBMS？
*   仅跟踪架构更改并非易事。您需要跟踪架构的本质（例如表名、列名等）而不是意外（是的，我之前正在重读 Brooks 的“No Silver Bullet”），例如 TabID（如果没有架构，它可能会有所不同本质上不同）。但是，分析会告诉您架构是否不同。
*   跟踪数据更改，独立于模式更改，也很重要。一般而言，此类数据量很大。您可能能够处理数据库的完整存档或完整卸载或导出 - 但确保数据每次都以相同的顺序呈现可能需要您小心谨慎。如果您不能确保正确的排序，VCS 将记录由于排序差异而导致的巨大变化。

以上所有内容都是可怕的“*取决于*”答案。这取决于：

*   您的数据库管理系统
*   您的数据库大小
*   架构的易变性
*   数据的波动性

幸运的是，它仅在一定程度上取决于您的 VCS 或平台。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-11-15T11:54:38.643

如果我理解正确，您希望能够同时跟踪架构和数据更改。

事实上，这是两件截然不同的事情——

*   **架构更改**- 这在其他几个问题（[此处](https://stackoverflow.com/questions/1294758/how-do-you-maintain-revision-control-of-your-database-structure)、[此处](https://stackoverflow.com/questions/308/is-there-a-version-control-system-for-database-structure-changes)和[此处](https://stackoverflow.com/questions/1607/mechanisms-for-tracking-db-schema-changes)）中进行了讨论。这些问题的答案的主要内容是，您可以将架构转储到 SQL 文件并使用常规源代码控制（git、svn 等）跟踪它们，或者您可以使用数据库特定的软件（red-gate、dbmaestro ）。但是，这不允许您在另一台服务器上完全重新创建数据库的相同副本。这让我 -
*   **数据更改**- 这更难，因为（就像@jonathan 写的那样）很难跟踪数据库对其文件所做的更改。我建议您[查看 OffScale DataGrove](http://off-scale.com)。DataGrove 跟踪整个数据库（结构+数据）的变化。您可以在任何时间点标记版本，并使用简单的命令返回数据库的旧状态。它还允许您创建同一数据库的虚拟、单独的副本，因此每个团队成员都可以拥有自己的单独数据库。所有虚拟副本都被跟踪到同一个存储库中，因此将您的数据库恢复到其他人的版本（您称之为“git-pull”）非常容易。

*免责声明 - 我在 OffScale 工作:-)*

# oop - 抽象和多态有什么区别

> ID：367276
> 
> 赞同：39
> 
> 时间：2008-12-15T01:37:43.923
> 
> 标签：oop, polymorphism, abstraction

我似乎不太了解两个 OOP 概念。你能解释一下**抽象**和**多态**是什么，最好用真实的例子和代码吗？

谢谢你。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-15T01:51:40.320

## 抽象

想象一个分数类：

```
class fraction:
    int denominator
    int numerator 
```

现在有两个对象：

```
fraction(obj1): denominator=-1 numerator=-1
fraction(obj2): denominator=1  numerator=1 
```

两个对象的值都是 1: `(1/1) == (-1)/(-1)`。你不会期望他们的行为与外界有任何不同。那是抽象。您将对象保存的数据抽象为逻辑视图，即使在幕后，还有其他事情。从理论上讲，您有一个等价关系，具有不同的等价组：

```
[1]=(1, 1), (-1, -1), (5, 5), ...
[2]=(2, 4), (-2, -4), ...
... 
```

并且有一个抽象函数将内部细节抽象到外部：

```
f((1, 1)) = [1]
f((-1, -1)) = [1] 
```

*它从具体*值映射到对象的*抽象*值。例如，您可以通过编写一个构造函数映射 (-1, -1) 到 (1, 1) 并为您的类编写一个 equals 函数来做到这一点。

## 多态性

想象一支笔和两个派生类：

```
class pen:
    void draw(int x, int y)

class pen_thin extends pen:
    void draw(int x, int y) { color(x, y) = green; }

class pen_thick extends pen:
    void draw(int x, int y) { color(x, y) = green; 
                              color(x, y+1) = green; }
and two objects:
    pen_thin(p1)
    pen_thick(p2) 
```

两支笔都可以画画。您的一般“笔”无法自行绘制。它只是 pen_thin、pen_thick 和许多其他笔的接口。你说：obj1.draw(1, 0); obj1 是粗笔还是细笔对于您作为用户来说并不重要，对于编译时的编译器也不重要。该调用具有多态性。它是*动态多态性*（发生在运行时），这就是人们通常的意思。*静态多态*发生在编译时：

```
class colorizer:
    void colorize(shirt s)
    void colorize(pants p) 
```

这叫做重载。你打电话`obj.colorize(something)`。如果你用衬衫引用来调用它，它会调用衬衫的版本。如果你用裤子引用来调用它，它将调用裤子版本。这里所做的选择是*在 compile-time*。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-15T03:17:18.400

抽象和多态性是关键概念，绝不仅限于 OO。更令人困惑的是，“抽象”这个词有多种使用方式。这是一个带有一个示例的快速备忘单：

*   **数据抽象**意味着**信息隐藏**。通常隐藏的是数据结构的表示。示例：我实现了集合，但我没有告诉您集合是表示为列表、平衡二叉树还是不平衡二叉树。做得对，**我可以在不破坏您的代码的情况下更改表示**。

*   **多态**意味着**不同类型的重用**。因此，在我的设置示例中，您可以创建一组社会安全号码、一组全名或一组果蝠，所有这些都使用相同的代码。

显然，您可以定义一个既抽象又多态的类。

多态性更加令人困惑，因为**有两种方法可以实现多态性**。在**参数多态中，您可以使用****任何**类型的值或任何满足某些约束的类型重用该集合。最**明显的例子**是**C++ 模板**；如果你写

```
class Set <T> { ... } 
```

然后`T`是集合中包含的对象的类型（符号`<T>`表示所谓的“类型参数”，这就是使其成为*参数*多态性的原因）。

在**子类型多态**中，您只能对类型是特定类型的子类型的对象重用集合。例如，您可能只能创建提供小于或等于方法的对象集。在像 Smalltalk 或 Ruby 这样真正的面向对象语言中，它们提供所谓的**鸭子类型**（我们头脑敏锐的理论家有时称之为*行为子类型*），该方法的存在就足够了。在像 Java 或 C++ 这样*将子类型与继承混为一谈*的语言中，您对多态性的使用可能**仅限于特定类的子类**。（Java 通过对类使用一种形式的子类型，在接口上使用另一种形式，进一步混淆了这个问题。）

最后，像我这样的老屁谈论**过程抽象**，这只是意味着能够将一堆经常一起使用的语句放入一个过程或方法中，然后您可以重用它们。这可能与您的问题无关。

那么，你对困惑感觉更好吗？

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-12-15T05:21:26.403

这两个是面向对象范式最重要的特征之一。

## 抽象。

面向对象将软件建模为真实世界的对象。但是，对 Customer 可能拥有的所有属性或 Employee 拥有的所有属性进行建模会太难（而且没用）。

通过仅列出对象的有趣属性，OO 可以有效地将该对象用于特定域。那是抽象。

例如，人力资源系统中的员工可能具有与在线书店非常不同的属性。我们抽象出的细节是有用的。

## 多态性。

在保持相同界面的同时，对象的行为可能会因“类型”而异。

这是什么意思？

例如，在线商店系统可能有两个 Employee 子类

A) 内部员工。

B) 承包商

以及一种计算内部购买折扣的方法

内部员工的折扣计算为：10% + 公司每个工作年的 2% + 每个.. mmhh 孩子的 2%

承包商的折扣是 10%

以下代码用于计算要支付的金额：

```
 public Amount getAmountToPay( Product product, Employee internalCustomer ) { 
      Amount amount = product.getPrice();
      amount.applyDiscount( internalCustomer.getDiscount() );
      return amount;
 } 
```

会为两种不同的 Employee 产生不同的结果

```
class Employee { 
    public int getDiscount();
}

class InternalEmployee extends Employee { 
     public int getDiscount() { 
        return 10 + 2 * getWorkedYears() + 2 * getNumberOfChilds();
     }
 }

 class Contractor extends Employee { 
      public int getDiscount() { 
          return 10;
     }
 } 
```

这就是多态性的作用。而不是有类似的东西

```
 Amount amount = product.getPrice();

 if( employee.isContractor() ) { 
      amount.applyDiscount( 10 );
 } else if( employee.isSomthingElse() ) {
      amount.applyDiscount( 10 * 2 * getYrs() + 2 * getChilds() );
 } else if ( employee.contidions, condigions, conditions ) {
      amount.applyDiscount( getSomeStrageRuleHere() );
 } 
```

我们让运行时选择计算哪一个。就像程序的行为因类型而异：

```
 Amount amount = product.getPrice();
      amount.applyDiscount( internalCustomer.getDiscount() );
      return amount; 
```

顺便说一句，在这个例子中，“金额”是现实生活概念的抽象，也可以表示为双精度或整数，但也许我们内部有一些有趣的方法，如果设置在它自己的类中会更好。

我希望这有帮助。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-15T01:58:55.393

抽象是指在不包括背景细节或解释的情况下表示基本特征的行为。类使用抽象的概念，并被定义为抽象属性的列表。

软件抽象的一个例子是 Java 的`Object.equals(Object o)`方法。您知道它将将此对象与作为参数传入的对象进行比较，但您不知道，也不需要知道它的具体实现方式（除非您是该类的实现者）。

多态性意味着能够采用一种以上的形式。一个方法在不同的实例中可能有不同的行为。行为取决于操作中使用的数据类型。

多态性的经典示例之一使用植根于 Animal 类的继承树。所有 Animal 都有一个`makeNoise()`方法，但是 Dog 类和 Cat 类实现它的方式不同。这允许您使用 Animal 引用类型来引用任何 Dog's 和 Cat's。

```
Animal a = new Dog();
Animal b = new Cat(); 
```

现在您可以调用`makeNoise()`任一 Animal 实例并知道它会发出适当的噪音。如果您有一个动物集合，并且您在运行时不知道每个动物到底是什么类型，这将特别有用。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-15T04:27:46.077

这两个术语在面向对象编程中大量使用，但它们并不特别限于该上下文。

抽象是对其他事物的概括；视野更上一层楼。例如，层次结构可以看作是对公司组织结构的抽象。通常，它用于底层事物（例如它们的基本类型）的上下文中。抽象的目的是编写更少的代码，而这些代码本质上更通用，这样您就可以运行它来解决更大的问题集。例如，电子表格是一种抽象，它允许特定类型的信息存储。[更多的？](http://theprogrammersparadox.blogspot.com/2008/01/abstraction-and-encapsulation.html)

多态性也是一种概括，但它发生在运行时上下文中。如果有某种方法可以在它们彼此无法区分的情况下访问它们，那么一堆不同的对象类型是多态的。也就是说，所有对象的外观和感觉都相同，即使它们不同。这样做的目的是显着减少代码；您可以编写一个通用的解决方案来避免为每种不同类型编写所有不同的排列。如果你写一个图形库，你宁愿只写一些抽象代码来处理“形状”，然后必须为每种不同的类型编写代码，比如圆形、正方形等。

这两个术语都以代码中的属性为中心，使程序员能够事半功倍。更少的代码有更少的错误，更稳定，更容易维护。另一种方法是使用“蛮力”来破解数百万行非常具体（并且非常脆弱）的代码。更多的代码更难修复，更难保持最新。

保罗。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-15T05:09:39.907

简短的回答：抽象是*概念性*的，多态性是*行为性的*

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-06-02T22:01:33.883

在面向对象的上下文中，关于抽象的实际含义的混淆是可以理解的：它对继承、封装甚至多态的概念几乎没有增加什么。如果掌握了这三个概念，一旦“抽象”自然嵌入其中（尤其是继承），就无需过多关注。

首先，请注意术语“抽象”有多种含义，并且声明并不正确，例如，*封装需要抽象*：当您使用访问修饰符来保护类的属性同时公开处理它们的方法时（即封装是什么），类的用户不再需要担心如何自己处理它们。所以，从某种意义上说，当你设计一个类时，你通过适当地封装方法和属性进行*抽象*——类的用户需要做的就是通过调用正确的方法来使用它，这是一种抽象形式。

此外，如果您直截了当地思考，*多态性也是一种抽象形式*：您的代码调用某个类提供的方法，并且在确定实际类类型（在运行时）之前，您不知道它将如何作用。所以，说多态行为是一种抽象是正确的。

然而，当作为一个独立的术语来描述 OOP 的特性时，抽象必须被理解为以合适的类层次结构的形式对正在讨论的系统进行适当的表示。因此，抽象是设计者的心理过程的结果，最终为将在程序中使用的类进行适当的设计。[引用可以在 javarevisited 博客上找到](https://javarevisited.blogspot.com/2017/04/difference-between-abstraction-and-encapsulation-in-java-oop.html?m=1)的（优秀的！）帖子：

> ...抽象在设计级别隐藏细节，而封装在实现级别隐藏细节。

虽然上面的陈述是正确的，但我发现“隐藏细节”部分被错误地陈述了——我会将它改写为

> *抽象关注设计细节，决定类层次结构的外观，封装隐藏细节实现*。

公平地说，这个想法在他的文章中很漂亮。[具有这种含义的“抽象”一词在Head First Object-Oriented Analysis and Design](https://www.amazon.com.br/dp/B006JTIZT4/ref=dp-kindle-redirect?_encoding=UTF8&btkr=1)等好书中也可以看到，我从那里引用了一个声明：

> 每当您在两个或更多地方发现共同行为时，请将该行为抽象为一个类，然后在公共类中重用该行为

请注意此处抽象的用法：“*将行为抽象为一个类*”。现在，如果*抽象*意味着如上所述*正确设计类层次结构，则可以**利用继承和封装的概念，方便地使用类将抽象定义为域的表示*。

在 Java 的特殊情况下，抽象是通过使用[接口](https://docs.oracle.com/javase/tutorial/java/concepts/interface.html)和[抽象类](https://docs.oracle.com/javase/tutorial/java/IandI/abstract.html)来实现的，而封装是通过[private、protected 和 package 访问修饰符](https://docs.oracle.com/javase/tutorial/java/javaOO/accesscontrol.html)来实现的。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2019-01-23T23:00:46.447

简单来说，抽象是概念性的，Poly 是行为性的。为了在 OOP 中实现抽象，您需要 Poly。

面向对象编程中的抽象我可以说是一种概念或设计模式，它可以实现更好的隔离、松散耦合、可测试性、可重用性和可扩展性。为了实现所有，我们需要poly、继承/扩展等。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-09-08T13:53:13.450

抽象和多态在本质上是相似的，但目的不同。

例如。

**驾驶执照**：您会获得一张执照，上面注明您可以驾驶的车辆类别。许可证提到了当局允许的车辆类别，但没有定义或提及您应该驾驶的特定汽车或品牌。这是抽象。

这里的**许可证**是一个**抽象类**及其方法，**允许的车辆**是它的**抽象方法**。

现在，在这里，多态性是当局将个人许可证分配给不同的人的不同方式，根据不同的要求，有些是为轻型车辆颁发的，有些是为重型车辆颁发的，有些是为商用车颁发的。在这里，**License 是一个基类**，**其他种类的**license 是它的子类，也遵循**is-a 关系**。商业许可证是许可证。

因此，抽象是一种通用准则，它赋予后续类实现独立性，而多态是差异化方法，它覆盖父类设置的方法/规则。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-11-26T06:41:01.163

PS：最近开始学习java答案是基于我的观察，如果我错了请纠正我。

抽象和多态基本上在编程中做几乎相同的工作。

让我们以汽车为例..

无论是福特小型货车、法拉利异国情调、路虎 SUV 还是宝马轿车，它们都遵循汽车的基本设计，即发动机、方向盘、变速箱、灯、指示灯和名单还在继续。使它们不同的是它们的具体实现，例如法拉利可能具有比小型货车更强大的发动机，suv 可能具有不同的变速箱，因此汽车（此处为超类）已由子类（轿车，suv，小型货车）实现, 异国情调）这是**多态性**，通过添加其他规范来继承或实现的基本思想。以各种形式（子类）实施的四轮车辆（超类）

现在，**抽象**，根据定义，它意味着隐藏细节并让用户看到他需要的东西。

让我们再次以汽车为例..您使用齿轮，但您不确切知道齿轮的工作原理以及改变速度的机制等等。

现在转到编码部分。

抽象类是不完整的类，顾名思义，抽象类需要有一个不完整的方法，该方法需要由继承超类的子类完成，如果它们不完成抽象方法，它们也将保持不完整.

```
abstract class car {
  abstract void gear();
}

class sedan extends car {
 public void gear()
 {
  //complete the method
 }
} 
```

你也不能创建抽象类的对象，因为类不完整。然而，这些抽象类可以具有静态方法、参数、具体方法，但要使其成为抽象类，它们需要一个抽象方法。因此，一个基本的抽象超类在其他子类中实现，它们在其中完成它。通过查看方法声明，我们可以估计该方法正在做什么，它将返回什么。但是我们不知道抽象方法将如何实现。

通过使用抽象类或接口，我们可以在 Java 中实现抽象。众所周知，抽象类、接口包含抽象方法

我们只能估计它们将如何工作。一旦我们在实现相应抽象类或接口的类中提供了方法实现，我们就会了解它们是如何工作的。

因此，抽象基本上有助于多态性。

* * *

## 回答 #11

> 赞同：-5
> 
> 时间：2008-12-15T01:47:18.723

很容易。

1.  抽象就是抽象。“学生”类是对真实学生的抽象。

2.  多态性是当一个类代表另一个类时，用户不会注意到。当类实现相同的接口或一个类从另一个类派生时，可能会发生这种情况。“HighSchoolStudent”类派生自“Student”类。当“教师”类在对象上调用#attendance 方法时，它可能不知道该对象是“学生”类还是“HighSchoolStudent”类。

# version-control - “本地”版本控制存储库有哪些选项？

> ID：367278
> 
> 赞同：3
> 
> 时间：2008-12-15T01:41:22.543
> 
> 标签：version-control

我是 SVN 的粉丝，我很乐意建立自己的 svn 存储库，但我想知道是否有比创建单独的存储库更好的选择。

基本上，我只是在寻找一种在我的代码被审查并签入主存储库（SourceSafe）之前跟踪或回滚更改的方法。

注意：我无法控制我们使用哪个版本控制系统（更喜欢 svn 或 svk），所以在主存储库中坚持使用 SourceSafe。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-15T01:57:46.940

大多数分布式版本控制系统统一了*工作副本*和*存储库*的概念。换句话说：工作副本*是*存储库。

如果您想将源代码树置于版本控制之下，在大多数 DVCS 中它就像

1.  `cd $PROJECT`
2.  `git init # Create the repository`
3.  `git add . # Recursively add all files in the directory to the repository`
4.  `git commit # Make the initial commit`

我相信 Mercurial 的命令完全相同（用`hg`代替`git`），而 Bazaar、Darcs、Monotone、Codeville、Arch 和大多数其他 DVCS 的命令非常相似。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T01:45:05.747

[Git](http://git.or.cz/)是一个很好的源代码控制系统，本质上是分布式的，因此您可以在您的开发盒上拥有一个可以与服务器副本合并的版本。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-15T04:04:51.130

如果您正在寻找设置时间最短的解决方案，我建议您查看分布式版本控制系统。

这将允许您将代码签入本地存储库，而无需设置服务器等。

分布式版本控制系统的示例包括：

*   市场
*   水银
*   吉特

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T03:40:27.357

检查这篇文章：

[使用 TortoiseSVN 创建本地 Subversion 存储库](http://thinkinging.com/2007/04/12/creating-a-local-subversion-repository-with-tortoisesvn/)

使用 TortoiseSVN 在本地文件系统上创建本地存储库非常容易和轻松。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T04:04:51.583

Perforce 对两个用户免费 [http://www.perforce.com/perforce/evaldemo.html](http://www.perforce.com/perforce/evaldemo.html)

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-12-15T03:50:09.240

我正在开发一种可能非常适合您的产品。

它被称为“交易代码代理”。它旨在自动维护本地源代码历史记录。

您将它指向保存代码的文件夹，它会在您每次更改文件时自动进行备份。您可以区分版本、回滚更改，甚至可以创建命名的“快照”（修复错误 1234、实施功能 y 等），以便更轻松地恢复到特定时间点。

因为它是自动的，所以您不必担心手动提交本地更改。

一切正常。

我在这篇文章中放了一些关于它的详细信息：

[有史以来最简单的源代码控制 - 你用什么？](https://stackoverflow.com/questions/348272/simplest-source-control-ever-what-do-you-use#348385)

它应该在 2 月的某个时候发布。我正在寻找 beta 测试人员。测试版应该在一月份的某个时候开放。如果你感兴趣，请告诉我。

# asp.net - 禁用 web.config 继承？

> ID：367282
> 
> 赞同：39
> 
> 时间：2008-12-15T01:46:12.050
> 
> 标签：asp.net

我的网站根目录中有一个内容管理应用程序，我正在尝试在子文件夹下使用不同的应用程序（计费应用程序）。不幸的是，根站点的 web.config 正在干扰子应用程序。

有没有办法只禁用子文件夹的 web.config 继承？

**更新：** 由[Stephen Burris](https://stackoverflow.com/users/31474/stephen-b-burris-jr)链接，使用`<location>`标签可以防止部分 web 配置的继承，如下所示：

```
<?xml version="1.0"?>
<configuration>
<configSections>
    ....
</configSections>
<location path="." inheritInChildApplications="false">
    <appSettings>
        ....
    </appSettings>
    <connectionStrings/>
    <system.web>
        ....
    </system.web>
    <system.codedom>
        ....
    </system.codedom>
    <system.webServer>
        ....
    </system.webServer>
</location>
<runtime>
    ....
</runtime>
</configuration> 
```

`<configSections>`and`<runtime>`部分不接受包含在标签中......所以我想这只能完成大部分工作。有人知道如何做得更好吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-15T03:25:35.747

您可以在根 web.config 文件中使用一个属性，使其内容不会被子应用程序继承。

继承InChildApplications

[关于 inheritInChildApplications 的博客](http://www.kowitz.net/archive/2007/05/16/stopping-asp.net-web.config-inheritance.aspx)

[关于 ASP.NET 配置文件层次结构和继承的 MSDN 文章](http://msdn.microsoft.com/en-us/library/ms178685.aspx)

将配置中不用于继承的部分放在里面

```
<location inheritInChildApplications="false">
     <NotInheritedConfigPart/>
</location> 
```

配置部分似乎不可能不继承，但配置的其他部分可以像这样“注释”掉并且不会被继承。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2014-10-15T11:16:53.980

如果您可以使用 2 个单独的应用程序池，则可以通过`enableConfigurationOverride="false"`在 applicationHost.config 文件中使用属性来完全停止继承，正如我在这个问题中所描述的那样：[“Entry has been added” - 两个单独的应用程序池](https://stackoverflow.com/questions/23367347/entry-has-already-been-added-two-separate-app-pools/24260655#24260655)

```
<add name="MyAppPool" enableConfigurationOverride="false" autoStart="true" managedRuntimeVersion="v4.0" managedPipelineMode="Integrated" >
    <processModel identityType="NetworkService" />
</add> 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2014-02-24T08:45:02.090

在我看来，每次我为此而苦苦挣扎时，答案最终都是“否”——我把这个留在这里，让我未来的自己去寻找，这样他就不会再浪费时间了。

当您只想在现有站点中添加一些内容作为虚拟目录时，我发现这是一个大问题。对于复杂的 web.config 文件，我总是最终放弃并将其完全转移到不同的应用程序中。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-15T02:58:47.860

我会明确定义所需的所有设置 - 永远不要假设任何设置仍设置为默认值。

例如，如果您要定义一个 connectionString，则在等`<clear />`之前包含一个标签`<add name=... />`。对于 Membership 定义所有属性，包括 cookie 名称。等等。

它可能会使文件更大一些，但它肯定会帮助您避免“但它也适用于我的盒子”的情况:-)

# eclipse - 如何让 Eclipse 为 Hivemind 配置文件提供更多帮助？

> ID：367295
> 
> 赞同：2
> 
> 时间：2008-12-15T01:55:42.403
> 
> 标签：eclipse, hivemind

我从事的一个项目使用 Apache Hivemind 为我们的应用程序进行依赖注入。我们有各种定义服务点、配置点等的 Hivemind 配置文件。如果开发人员错误地编辑了这些 Hivemind 配置文件之一，则只会在运行时显示错误。

在 Eclipse 中，hivemind 配置文件被简单地视为 xml 文件。我们不会向 Eclipse 提供有关这些文件或我们在服务点定义中引用的类的任何见解。

有没有办法让 Eclipse 更有帮助（即给它更多关于 Hivemind 配置文件中正确内容的线索），以便它可以在运行前向程序员揭示这些错误？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-02T20:58:18.187

目前没有一个 Eclipse 插件可以提供您正在寻找的信息类型。您可能会做的最好的事情是使用一个 XML 插件，这将有助于识别一些错误。

# c# - 在测试之外使用模拟对象，不好的做法？

> ID：367308
> 
> 赞同：5
> 
> 时间：2008-12-15T02:00:50.583
> 
> 标签：c#, tdd, dependency-injection, mocking, dependencies

我正在从事一个有很多外部服务消息传递的项目。用稍微“双曲线”的方式来描述它的一个好方法是系统必须向 Flicker API、Facebook API 和 Netflix API 发送消息的应用程序。

为了支持断开连接的场景、日志记录、开发人员可用性、配置等……我尝试了一种大量使用泛型和表达式树的方法。最终结果如下所示：

```
Messenger<NetflixApi>.SendCustom( netflix => netflix.RecommendMovie("my message")); 
```

总的来说，我对最终结果很满意，但我觉得我犯了一个错误，或者在测试和断开连接的场景方面忽略了某个地方的设计原则。

在测试期间，无论是自动化的、单元的还是基于人的，我都实现了一个对象工厂，它最初使用 DI 在“实时模式”中执行正确的操作，并使用 Mocks 提供一种不做任何事情的无菌信使所有在测试模式下。

我只看到或读过 Mocks 在纯 TDD 模式下使用，而不是被用作某种愚蠢的对象。我看到的方法将围绕着对我使用的所有 API 所依赖的 HTTP 通信功能进行存根或模拟。

我主要担心的是，我希望连接的所有不同服务最终将不得不做很多细粒度的工作来替换特定的 HTTP 实现，如果我使用存根方法，我将为这些服务中的每一个提供 3 个类（ IService、ConcreteService、StubService ）并在实现新方法或更改任何内容时维护它们将是真正的 PITA。

在当前的实现中，我使用 Mocks 来免费获得“无菌模式”，几乎无需为了符合某个测试主体而实现任何额外的东西。

问题是我错过了什么吗？我是否以更方便的方式使用 Mocks 违反了设计原则？

任何人都可以就如何从许多不同的外部服务中获得无菌模式提供任何建议，而无需跳过很多圈子？

这个问题有意义吗？

感谢所有的答案。

编辑＃1：

我最初的问题并不清楚。任何空对象或模拟对象都将纯粹用于开发/调试/测试环境。在生产中，发送这些消息的代码将是它们的实际实现。

我对每个人都投了赞成票，因为对于这个问题似乎有很多不同的解决方案，我将探索每一个。

请不要认为这个问题已经得到回答，我会尽可能多地获得建议。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T05:25:30.623

有一种设计模式称为 Null Object。空对象是实现接口的对象，因此可以在像您这样的场景中使用。

关于 Null 对象的重要一点是，不要在可能破坏系统的地方返回 null。

Null Object 的目的是对某些东西进行无效和简单的实现，就像 Mock 一样，但要在生产环境中使用。

最简单的例子是这样的：

```
class Logger{
 private static ILogger _Logger;

 static Logger(){
  //DI injection here
  _Logger = new NullLogger(); //or
  _Logger = new TraceLogger();
 }
}

interface ILogger{
 void Log(string Message);
}

internal class TraceLogger:ILooger{
 public void Log(string Message){
  //Code here
 }
}

internal class NullLogger{
 public void Log(string Message){
  //Don't don anything, in purporse
 }
} 
```

我希望这可以帮助你

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-15T04:10:01.947

我认为您可能需要澄清您的问题。我不清楚您是在谈论在没有存根或测试期望的情况下在测试中使用测试替身（因此将它们用作假货来满足所需的接口），还是在谈论在生产场景中使用模拟来填充服务不可用（您的断开连接的场景）。

如果您在测试情况下谈论：模拟是测试替身。与模拟或存根相比，使用假货进行测试没有任何问题。如果您不需要在特定测试中使用该服务，并且它只是提供给定接口，被测对象依赖于该接口，那么它就可以了。这并没有破坏任何测试主体。

好的模拟库正在模糊模拟、存根和伪造之间的界限。

看看 Martin Fowler 提供的关于不同类型的测试替身的一些信息。[模拟不是存根](http://martinfowler.com/articles/mocksArentStubs.html)，[TestDoubles](http://www.martinfowler.com/bliki/TestDouble.html)。

我真的很喜欢起订量允许虚拟对象、假对象、存根对象和模拟对象之间的连续统一体的方式，而您无需跳过箍来获得特定的行为。[检查出来](http://www.clariusconsulting.net/blogs/kzu/archive/2007/12/21/47152.aspx)。

如果您正在谈论在断开连接的场景中使用模拟进行生产使用......我会担心。假货将为您进行的任何调用返回空对象或默认值。这会将复杂性泄漏到使用这些服务的所有代码中（它们需要处理检查空返回值和空数组......）。我认为将您的断开连接/无菌场景编码以处理依赖项本身不可用而不是接受它们的模拟实现并继续，就好像一切正​​常一样会更有意义。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-15T05:57:51.090

在我看来，您可能想看看代理模式。即使与实际服务断开连接，您也想要一些像各种服务一样的东西。因此，您的代码最好与代理而不是真实的东西交谈。然后代理可以根据当前的连接状态做它需要做的任何事情。

# c++ - 动态内存分配故障恢复

> ID：367310
> 
> 赞同：6
> 
> 时间：2008-12-15T02:02:48.443
> 
> 标签：c++, embedded, windows-ce, new-operator, viper

我正在研究嵌入式处理器（400 MHz Intel PXA255 XScale），我想我看到了一个没有足够内存来满足“新”操作的案例。程序没有崩溃，所以我认为其他线程已经释放了它们的内存，这只是暂时的。这是一些非常关键的代码，因此不能退出，并且需要将某种错误返回给远程用户。

以下小修复是否足以解决问题，还是有更好的方法？在用以下代码替换每个“新”之前，我想我会问。

```
char someArr[];
do{ 
    someArr = new char[10]; 
    Sleep(100); // no justification for choosing 100 ms
} while ( someArr == NULL ); 
```

睡眠有帮助吗？我应该设置一些最大重试次数吗？是否可以在任何地方使用静态初始化？

**最后更新：**非常感谢您提供的有用回复，但事实证明在检查内存分配失败的代码中存在错误。不过，我会牢记所有这些答案，并尽可能多地替换 malloc 和 new （尤其是在错误处理代码中）。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-15T02:44:28.717

你正试图通过局部推理来解决一个全球性问题。全球问题是整个设备为操作系统和所有应用程序提供有限数量的 RAM（可能还有后备存储）。为确保不超过此 RAM 量，您有以下几种选择：

*   每个进程在启动时确定每个进程在固定数量的 RAM 中运行；程序员进行推理以确保一切都合适。所以，**是的，可以静态分配所有内容**。只是工作量很大，**每次更改系统配置时，都必须重新考虑分配**。

*   进程知道他们自己的内存使用和需求，并不断地相互告知他们需要多少内存。他们**合作，所以他们不会耗尽内存**。这假设系统中至少有一些进程可以调整它们自己的内存需求（例如，通过改变内部高速缓存的大小）。Alonso 和 Appel 写了[一篇关于这种方法](http://portal.acm.org/citation.cfm?id=98753)的论文。

*   每个进程都知道内存可能会耗尽，并且可以**故障转移到消耗最少内存的状态**。通常，此策略是通过内存不足异常来实现的。异常在 main() 中或附近处理，内存不足事件实质上是从头开始重新启动程序。如果内存响应用户请求而增长，则此故障转移模式可以工作；如果程序的内存需求增长独立于用户所做的事情，**它可能会导致抖动。**

**您上面的建议与任何情况都不匹配。** 相反，您希望**其他一些过程可以解决问题**，并且最终会出现您需要的内存。你可能会走运。你可能不会。

如果您希望您的系统可靠地工作，您最好**重新考虑系统上运行的每个进程的设计，**因为需要共享有限的内存。这可能比您预期的要大，但是如果您了解问题所在，则可以这样做。祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T03:31:16.377

其他答案中有很多好东西，但我确实认为值得补充的是，如果所有线程都进入类似的循环，那么程序将陷入僵局。

这种情况的“正确”答案可能是对程序的不同部分有严格的限制，以确保它们不会过度消耗内存。这可能需要重写程序所有部分的主要部分。

下一个最佳解决方案是进行一些回调，其中失败的分配尝试可以告诉程序的其余部分需要更多内存。也许程序的其他部分可以比通常更积极地释放一些缓冲区，或者释放用于缓存搜索结果的内存，等等。这将需要为程序的其他部分编写新代码。但是，这可以逐步完成，而不需要在整个程序中重写。

另一种解决方案是让程序使用互斥锁保护大型（临时）内存请求。听起来您很有信心，如果您稍后再试一次，内存将很快被释放。我建议您对可能会消耗大量内存的操作使用互斥锁，这将允许在另一个线程释放所需内存时立即唤醒该线程。否则即使内存立即释放，您的线程也会休眠十分之一秒。

您也可以尝试 sleep(0)，它将简单地将控制权交给任何其他准备运行的线程。如果所有其他线程进入睡眠状态，这将允许您的线程立即重新获得控制权，而不必等待其 100 毫秒的语句。但是如果至少有一个线程还想运行，你仍然需要等到它放弃控制权。在 Linux 机器上，这通常是 10 毫秒，我上次检查过。我不知道其他平台。如果您的线程自愿进入睡眠状态，它在调度程序中的优先级也可能较低。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T02:16:43.813

根据您的问题，我假设您的堆在多个线程之间共享。

如果不是，那么上面的代码将不起作用，因为在循环运行时不会从堆中释放任何内容。

如果堆是共享的，那么上面的方法可能会起作用。但是，如果您有一个共享堆，那么调用“new”可能会导致自旋锁（与您拥有的类似的循环，但使用 CAS 指令），或者它会基于某些内核资源而阻塞。

在这两种情况下，您拥有的循环都会降低系统的吞吐量。这是因为您将需要更多的上下文切换，或者需要更长的时间来响应“内存现在可用”事件。

我会考虑覆盖“新”和“删除”运算符。当 new 失败时，您可以阻塞（或在某种计数器变量上自旋锁定）等待另一个线程释放内存，然后 delete 可以向阻塞的“新”线程发出信号或使用 CAS 增加计数器变量。

这应该会给你更好的吞吐量并且更有效率

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T02:21:11.947

几点：

*   嵌入式程序通常在启动时分配所有内存或仅使用静态内存以避免此类情况。
*   除非设备上运行其他东西定期释放内存，否则您的解决方案可能不会有效。
*   我拥有的 Viper 有 64MB RAM，我认为它们的内存不会少于 32MB，您的应用程序使用了多少内存？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-17T08:36:48.460

我认为最明智的做法是使用静态分配内存，这样您就知道发生了什么。动态内存分配是桌面编程的一个坏习惯，不适合资源受限的机器（除非您花费相当多的时间和精力来创建一个良好的托管和受控内存管理系统）。

此外，检查您设备中的操作系统（假设它有一个像这样的高端 ARM 设备倾向于运行操作系统）具有哪些功能来处理内存。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-28T07:28:30.457

您使用 C++。因此，您可以使用一些 C++ 实用程序来让您的生活更轻松。例如，为什么不使用 new_handler？

```
void my_new_handler() {
    // make room for memory, then return, or throw bad_alloc if
    // nothing can be freed.
}

int main() {
    std::set_new_handler(&my_new_handler);

    // every allocation done will ask my_new_handler if there is
    // no memory for use anymore. This answer tells you what the
    // standard allocator function does: 
    // https://stackoverflow.com/questions/377178
} 
```

在 new_handler 中，您可以向所有应用程序发送一个信号，让它们知道某个应用程序需要内存，然后稍等片刻，让其他应用程序有时间来完成对内存的请求。重要的是您**做某事**而不是**默默地希望**可用内存。如果仍然没有足够的内存可用，新的运算符将再次调用您的处理程序，因此您不必担心是否所有应用程序都已经释放了所需的内存。如果您需要知道 new_handler 中所需的内存大小，也可以**重载 operator new 。**有关如何做到这一点，请参阅我的[其他答案。](https://stackoverflow.com/questions/365887/how-do-malloc-and-new-work-how-are-they-different-implementation-wise#365891)这样，您就有**了一个中心位置**处理内存问题，而不是很多地方都关心这个。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-28T08:00:56.320

有几种不同的方法来解决这个问题 - 请注意，工具说明会有所不同，具体取决于您使用的 Windows CE / Windows Mobile 版本。

需要回答的一些问题：

**1.您的应用程序是否存在内存泄漏，导致这种低内存情况？**

**2\. 您的应用程序是否只是在某些阶段使用了过多的内存，从而导致了这种内存不足的情况？**

1 和 2 可以使用 Windows CE AppVerifier 工具进行调查，该工具可以为您的产品提供详细的内存记录工具。其他堆包装工具也可以提供类似的信息（并且可能具有更高的性能），具体取决于您的产品设计。

[http://msdn.microsoft.com/en-us/library/aa446904.aspx](http://msdn.microsoft.com/en-us/library/aa446904.aspx)

**3、你在这个过程中分配和释放内存是否非常频繁？**

Windows CE，在操作系统版本 6.0 之前（不要与 Windows Mobile 6.x 混淆）有 32MB/进程的虚拟内存限制，这往往会导致很多有趣的碎片问题。在这种情况下，即使您有足够的可用物理内存，也可能会用完虚拟内存。使用自定义块分配器通常可以缓解此问题。

**4\. 您是否分配了非常大的内存块？(> 2MB)**

与 3 相关，您可能只是在耗尽进程虚拟内存空间。有一些技巧，在某种程度上取决于操作系统版本，可以在进程空间之外的共享 VM 空间中分配内存。如果您用完了 VM，但没有物理 RAM，这可能会有所帮助。

**5\. 您是否使用了大量的 DLL？**

也与 3 相关，根据操作系统版本，DLL 也可能很快减少可用 VM 的总数。

**进一步的出发点：**

CE 内存工具概述

[http://blogs.msdn.com/ce_base/archive/2006/01/11/511883.aspx](http://blogs.msdn.com/ce_base/archive/2006/01/11/511883.aspx)

目标控制窗口“mi”工具

[http://msdn.microsoft.com/en-us/library/aa450013.aspx](http://msdn.microsoft.com/en-us/library/aa450013.aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-29T11:46:31.887

正如其他人所提到的，理想情况下，您可以通过前期设计和软件架构来避免这个问题，但我假设此时这确实不是一个选择。

正如另一篇文章所提到的，将逻辑包装在一些实用程序函数中会很好，这样您最终就不会在所有地方都编写内存不足的代码。

要解决真正的问题，您尝试使用共享资源内存，但由于该共享资源正在被系统中的另一个线程使用，所以无法使用。理想情况下，您想要做的是等待系统中的其他线程之一释放您需要的资源，然后获取该资源。如果你有办法拦截所有分配和释放调用，你可以设置一些东西，以便分配线程阻塞直到内存可用，并且当内存可用时释放信号通知分配线程。但我会假设这只是太多的工作。

鉴于无法完全重新架构系统或重新编写内存分配器的限制，那么我认为您的解决方案是最实用的，只要您（和您团队中的其他人）了解这些限制，以及它将导致的问题。

现在为了改进您的特定方法，您可能需要测量工作负载以查看分配和释放内存的频率。这将使您更好地计算重试间隔应该是多少。

其次，您希望尝试增加每次迭代的超时时间以减少系统上该线程的负载。

最后，如果线程在经过一定次数的迭代后无法取得进展，您肯定会遇到一些错误/恐慌情况。如果所有线程都在等待系统中的另一个线程释放内存，这将至少让您看到可能遇到的潜在活锁情况。您可以简单地根据经验证明有效的方式选择一些迭代，或者您可以更聪明地了解它并跟踪有多少线程被卡住等待内存，以及是否最终导致所有线程恐慌。

*注意*：这显然不是一个完美的解决方案，正如其他发帖者所提到的，需要对整个应用程序进行更全面的了解才能正确解决问题，但以上是一种实用的技术，应该在短期内发挥作用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-15T02:06:41.163

当然，这取决于您是否对在 100（毫秒？）睡眠中可用的内存有合理的期望？当然，您应该限制它尝试的次数。

对我来说，这里没有什么味道。嗯……

嵌入式系统通常需要具有极高的确定性——也许您应该审查整个系统并提前了解其失败的可能性；然后努力失败，它实际上在实践中发生。

# c - _dl_close 断言失败

> ID：367323
> 
> 赞同：6
> 
> 时间：2008-12-15T02:11:50.077
> 
> 标签：c, apache, debugging, dlopen

我在我正在编写的 Apache 模块中使用 dlopen() 以便我可以为我的模块提供一个插件系统。我发现，如果我编译我的模块，编译我的插件，然后启动 Apache，一切正常。

但是，如果在我完成所有这些之后，我重新编译我的插件（对插件代码进行一两个小的更改），我的下一个页面加载将导致 Apache 出现段错误。每个后续请求再次正常工作。因此，只有在编译后立即加载第一页才会导致段错误。

几天来我一直在尝试解决这个问题（我不擅长 C 调试），今天，我在我的 apache 错误日志中注意到了这一点：

```
Inconsistency detected by ld.so: dl-close.c: 719: _dl_close: Assertion `map->l_init_called' failed! 
```

有人知道发生了什么吗？这是否意味着这不是我的代码并且我一直在寻找一个幻影错误？我相当有信心每次调用 dlopen() 时都会调用 dlcose()。但是，当我在单进程模式下运行 apache 并开始快速刷新页面时，似乎会发生这种特殊的错误/段错误。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T05:51:44.080

一些想法：

1.  可能你打电话`dlopen()`不止一次？`dl`库维护引用计数器，每次递增，`dlopen()`因此`dlclose()`仅当计数器 == 0 时才会卸载库。

2.  您是否指定了`RTLD_NODELETE`标志`dlopen()`（假设您在 Linux 上）？如果是，`dlclose()`则不会卸载您的库。

您是否尝试使用 调试系统调用`strace`？启动 Apache，找到它的 pid 并跟踪 Apache 通过调用`strace -p<pid>`. 可能它会让你知道发生了什么。

# vb.net - 'If' 语句和冒号

> ID：367325
> 
> 赞同：12
> 
> 时间：2008-12-15T02:15:04.907
> 
> 标签：vb.net, if-statement, colon

这是一段有趣的代码，我的团队成员刚刚就...

```
 Dim fred As Integer

  If True Then fred = 5 : fred = 3 : fred = 6 Else fred = 4 : fred = 2 : fred = 1 
```

执行上述代码片段后，*fred*的值是多少？

尽量不要欺骗和调试代码。

这是一个高度人为的代码示例，最初是作为使用冒号和 If 语句的示例，但后来有人决定自己为*fred*提供结果。

**更新**：我通常不会写这样的代码，这个片段只是作为一个例子。碰巧，这个问题源于一次涉及为我们团队创建编码标准文档的讨论。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-15T02:25:46.523

我假设你的意思是 VB.Net。

根据 VB 语言规范中的语法，您可以在此处阅读：

[http://www.microsoft.com/Downloads/thankyou.aspx?familyId=39de1dd0-f775-40bf-a191-09f5a95ef500&displayLang=en](http://www.microsoft.com/Downloads/thankyou.aspx?familyId=39de1dd0-f775-40bf-a191-09f5a95ef500&displayLang=en)

结果应该是“6”。

这是因为“line if 语句”的语法是：

```
If  BooleanExpression  Then  Statements  [  Else  Statements  ]  StatementTerminator 
```

并且“语句”被定义为

```
Statements  ::=
[  Statement  ]  |
Statements  :  [  Statement  ] 
```

**编辑：** 我想指出调试代码不是“作弊”。

我曾经在微软的 VB 编译器团队工作。

有时规格不明确，或者与我们实际发货的不匹配。在其中一些情况下，解决方案（我们为修复它所做的工作）总是基于“嗯......编译器现在做什么”。

有时我们会更改编译器，有时我们会更改规范。

但是，在我们做出决定之前，我们总是会运行编译器来查看它实际上做了什么。

所以......调试代码是弄清楚它的作用的重要组成部分......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T02:25:50.800

我有一段时间没有广泛使用 BASIC，所以这只是一个猜测，但我认为`fred`是`6`.

坦率地说，代码不是很可读。我觉得通过不在一行中包含所有内容并使用缩进，代码会更具可读性：

```
Dim fred As Integer

If True Then
    fred = 5
    fred = 3
    fred = 6
Else
    fred = 4
    fred = 2
    fred = 1
End If 
```

如果我没记错的话，我相信这是等效的代码。

但是，如果代码不等价，这就引出了另一点：原始代码在某种程度上是“棘手的”，它看起来所说的并不是真正发生的事情。类似于 C 风格语言中的陷阱：

```
if (condition)
    do_something();
    do_other_thing(); 
```

代码似乎暗示`do_something`并且`do_other_thing`在`condition`为真时执行，但实际上`do_other_thing`总是执行。

最好尝试遵守编码风格，使代码的意图更明显，不那么模棱两可。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T04:39:42.587

最终结果是 6。
现在真正的问题是：你是如何进入我的 repo 的？
:-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T02:23:23.847

只是猜测

fred = 6，因为您可以在同一行上使用冒号分隔多个语句。

不确定“else”是否合法（即可编译）

恕我直言，应该选择更好的编码风格：

```
 if (condition) then
  statement
  statement
else
  statement
  statement
end if 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-04T21:18:54.740

在真正古老的 BASIC 方言中，唯一可以跟在“THEN”后面的是行号。许多方言通过允许代码跟随“THEN”来改进这一点；在解析过去“THEN”之后，如果指示的条件为假，他们将跳到下一行，否则继续当前行。其他方言增加了跳过直到行尾或“ELSE”的能力，以先到者为准；尝试执行“ELSE”语句会跳到行尾。

引入 QuickBasic 后，它增加了对多行 if/then/else 块的支持，但保留了对旧式方法的支持。Visual Basic 紧随其后，而 vb.net 则延续了这一传统。

# svn - 加载了颠覆转储，但无法访问

> ID：367328
> 
> 赞同：1
> 
> 时间：2008-12-15T02:17:17.850
> 
> 标签：svn, tortoisesvn

我收到了一个 SVN 存储库的转储文件，我将其移至我的服务器。我们称它为 myserver.com/svn。load 语句打印出一长串加载的文件并且没有报告错误。但是，一旦我尝试访问存储库进行结帐，或重新定位我现有的结帐，我被告知：

```
Repository moved temporarily to 'http://www.myserver.com/svn'; please relocate 
```

换句话说，我的新存储库报告它已暂时移至自身。我该如何克服呢？我在有关 svnadmin load 命令的文档中找不到有关此消息的任何信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T21:39:10.657

subversion 在创建存储库时会生成一个 UUID（通用唯一 ID）。我相信为了使用原始存储库中的 UUID，您需要在 svnadmin load 命令中添加“--force-uuid”。

[http://svnbook.red-bean.com/en/1.5/svn.ref.svnadmin.c.load.html](http://svnbook.red-bean.com/en/1.5/svn.ref.svnadmin.c.load.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-13T09:07:11.943

可能是您的服务器配置为将所有错误重定向到某个地方（即主页）。您应该查找的行将被称为

```
ErrorDocument 404 http://www.myserver.com/svn 
```

SVN 显然使用 404（未找到）错误来添加新资源。你必须允许这个通过而不是进行重定向，否则svn会混淆。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T02:31:11.613

我认为有人添加了一个挂钩脚本来通知您您的存储库现在位于另一个 URL。

如果这不是预期的，则可能表明存在安全问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T10:25:37.477

我听说过一些情况，这是由于在 apache 配置中的 <Location 指令的路径末尾添加“/”引起的。

如果您添加了一个，请删除“/”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-12-13T21:58:27.647

如果您有任何机会使用并且在 VirtualHost 的 DocumentRoot 目录周围有一个 .htaccess 文件，请尝试删除它并查看它是否有帮助。:)

# asp.net-mvc - MSFT 报告查看器 (rdlc) 是否可以与 MVC 一起使用

> ID：367332
> 
> 赞同：9
> 
> 时间：2008-12-15T02:18:24.980
> 
> 标签：asp.net-mvc, model-view-controller

我对学习 MVC 很感兴趣，并尝试了几个示例应用程序。作为一个项目，我想将我自己的部分或全部办公应用程序移至 MVC。这个应用程序以及我为客户提供的所有应用程序的一个重要部分是打印发票、采购订单、库存清单等。事实上，他们判断我们所做工作的主要标准之一是这些文档的外观以及它们以实用、直观的方式整合到应用程序中。

没有报告作者，我是不可能过日子的。用于生成 rdlc 报告的 MSFT 报告查看器已经足够，甚至在几个关键领域比竞争对手更好。

此控件是否适用于 ASP.NET MVC 应用程序？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-30T16:09:33.663

“ASP.NET ViewState 已被禁用。报表查看器控件要求启用 ViewState。” 如果您从视图运行报表查看器。

但是您可以在同一个项目中运行 Web 表单页面。丑陋，但它的工作原理。

你也可以试试这个：[http ://weblogs.asp.net/rajbk/archive/2006/03/02/How-to-render-client-report-definition-files-_28002E00_rdlc_2900_-directly-to-the-Response -stream-without-preview.aspx](http://weblogs.asp.net/rajbk/archive/2006/03/02/How-to-render-client-report-definition-files-_28002E00_rdlc_2900_-directly-to-the-Response-stream-without-preview.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T14:57:13.917

假设控制**不起作用**，直到你能证明不是这样。

在 MVC 中，没有服务器端的表单，没有回发，没有视图状态。如果控件依赖于这些东西中的任何一个——而且大多数都依赖于这些东西——那么它就不会在 MVC 中正常工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-21T21:07:54.577

是的，它会的

并行运行 ASP.NET Webforms 和 ASP.NET MVC

[http://weblogs.asp.net/rajbk/archive/2010/05/11/running-asp-net-webforms-and-asp-net-mvc-side-by-side.aspx](http://weblogs.asp.net/rajbk/archive/2010/05/11/running-asp-net-webforms-and-asp-net-mvc-side-by-side.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T17:27:37.283

它应该运行得很好。ASP.NET MVC 和 webform 应用程序可以并存。

[http://www.chadmyers.com/Blog/archive/2007/11/30/asp.net-webforms-and-mvc-in-the-same-project.aspx](http://www.chadmyers.com/Blog/archive/2007/11/30/asp.net-webforms-and-mvc-in-the-same-project.aspx) [http://talk.robertmao.com/2008 /01/13/co-exist-of-aspnet-mvc-and-web-forms/](http://talk.robertmao.com/2008/01/13/co-exist-of-aspnet-mvc-and-web-forms/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T04:41:19.463

我看不出有什么理由不起作用。ASP.Net 的工作方式与您使用 Web 窗体的方式相同。您唯一没有得到的是回发，如果您只是在页面中呈现报告，我认为没有必要。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-14T20:26:39.467

如果您一心只在项目中使用 MVC，请查看使用 SRS Web 服务来呈现您的报告。

# php - PHP 可以做一件相当琐碎的继承事情吗？

> ID：367343
> 
> 赞同：2
> 
> 时间：2008-12-15T02:25:30.910
> 
> 标签：php, late-static-binding

我有以下代码：

```
abstract class AbstractParent {
 function __construct($param) { print_r($param); }
 public static function test() { return new self(1234); }
}

class SpecificClass extends AbstractParent {} 
```

当我调用`SpecificClass::test()`时，我收到一个错误：

```
致命错误：无法实例化抽象类 AbstractParent
```

所以我基本上想要的只是让我们`AbstractParent`实例`test()`化`test()`调用它的类（所以，在我的例子中，实例化`SpecificClass`）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T02:37:51.570

5.3 之前的版本仅具有以下解决方法：

```
abstract class AbstractParent {
 function __construct($param) { print_r($param); }
 abstract public static function test();
 private static function test2($classname) { return new $classname(1234); }
}

class SpecificClass extends AbstractParent {
 public static function test() {return self::test2(__CLASS__);}
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T02:29:52.757

您可以在仍处于 alpha 阶段的 PHP 5.3 中执行此操作。您正在寻找的是所谓的后期静态绑定。您希望父类在静态方法中引用子类。你还做不到，但它来了……

编辑：您可以在此处找到更多信息 - [http://www.php.net/manual/en/language.oop5.late-static-bindings.php](http://www.php.net/manual/en/language.oop5.late-static-bindings.php)

# asp.net-mvc - 你如何从 Ajax 表单提交 asp.net mvc 中的下拉列表

> ID：367349
> 
> 赞同：22
> 
> 时间：2008-12-15T02:29:29.653
> 
> 标签：asp.net-mvc, drop-down-menu, ajax.beginform

您如何从 ajax 表单内部的下拉列表“onchange”事件提交？

根据以下问题：[How do you submit a dropdownlist in asp.net mvc](https://stackoverflow.com/questions/364505/how-do-you-submit-a-dropdownlist-in-aspnet-mvc)，从 Html.BeginFrom 内部您可以设置 onchange="this.form.submit" 并更改下拉帖子。

但是，使用以下代码（在 Ajax.BeginFrom 内）：

```
<% using (Ajax.BeginForm("UpdateForm", new AjaxOptions() { UpdateTargetId = "updateText" })) { %>
    <h2>Top Authors</h2>

    Sort by:&nbsp;<%=Html.DropDownList("sortByList", new SelectList(ViewData["SortOptions"], new { onchange = "this.form.submit()" })%>

    <%= Html.TextBox("updateText")%>
<% } %> 
```

回传到控制器操作，但整个页面被替换为“updateText”文本的内容，而不仅仅是“updateText”文本框中的内容。

因此，不是只替换 Ajax.BeginForm 内的区域，而是替换整个页面。

下拉列表调用 this.form.submit 的正确方法是什么，只有 Ajax.BeginForm 内的区域？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2010-12-01T15:50:20.703

好吧，将近 2 年后，你可能不再关心了。谁知道：也许其他人（比如我 ;-) 会。

所以这是（非常简单的）解决方案：

在您的`Html.DropDownList(...)`通话中，更改

```
new { onchange = "this.form.submit()" } 
```

至

```
new { onchange = "this.form.onsubmit()" } 
```

您看得出来差别吗？;-)

原因是`Ajax.BeginForm()`创建一个带有`onsubmit()`处理程序的表单以异步提交表单。通过调用`submit()`，您可以绕过此`onsubmit()`自定义处理程序。打电话`onsubmit()`对我有用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-06-25T14:48:43.850

在您的下拉列表中替换

```
this.form.submit() 
```

至

```
$(this.form).submit(); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-15T03:25:10.350

你可以尝试这样做（需要jQuery）：

```
$("#yourDropdown").change(function() {
  var f = $("#yourForm");
  var action = f.attr("action");
  var serializedForm = f.serialize();
  $.post(action, serializedForm,
    function () { alert("Finished! Can do something here!") });
}); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-09T16:55:59.767

我也有同样的问题。我在部分视图中有几个下拉列表，因此它们可以独立刷新，但设置“onchange”属性会保持刷新整个页面。

我注意到“this.form.submit()”总是指部分视图之外的主表单。因此，我在 AJAX 表单中添加了一个提交按钮，并提到：

```
<%=Html.DropDownList("data", ViewData["data"] as SelectList
, new { onchange = "$(\"#button" + Model.IdIndex + "\").click();" })%>

<input type="submit" id="button<%=Model.IdIndex %>" style="display: none"  /><br /> 
```

我的“Model.IdIdex”只是一个访问同一页面中不同控件的变量。希望能帮助到你。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-18T03:02:35.180

我的 AJAX.BeginForm 中有一个像这样的按钮

```
 <button id="submitButton" type="submit"  class="btn" style="vertical-align: top"><i class="icon"></i> replace</button> 
```

并且 onsubmit 或来自弗朗西斯科的解决方案不起作用（我仍然不知道为什么）

所以我创建了一个替代方案：

```
 new { onchange = "document.getElementById('submitButton').click()" } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-12-16T12:24:01.620

如果您使用的是 MVC，那么最好的方法可能是使用 jQuery ...

```
<%= Html.DropDownList("sortByList", new SelectList(ViewData["SortOptions"]) %> 
<%= Html.TextBox("updateText") %>

<script>
$("#sortByList").change(function() {
    $.ajax({
        url: <%= Url.Action("UpdateForm")%>,
        type: "POST",
        data: { 'sortBy': $(this).val() },
        dataType: "json",
        success: function(result) { $('#updateText').text(result); },
        error: function(error) { alert(error); }
    })

});
</script> 
```

您的控制器将类似于：

```
public JsonResult UpdateForm(string sortBy)
{
    string result = "Your result here";
    return Json(result);
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-21T03:00:58.940

我们可以看到您的控制器代码吗？如果它是 Ajax 请求而不是整个视图，则可以在控制器中使用 Request.IsMvcAjaxRequest() 仅返回部分数据。在您的视图中将您的表单移动到 PartialView 并调用
 `Html.RenderPartial("viewname");`

在您的控制器中：

`if (Request.IsMvcAjaxRequest())
{
return PartialView("viewname");
}
else
{ //Non Ajax code here. }`

# delphi - 如何编写自定义操作 DLL 以在 MSI 中使用？

> ID：367365
> 
> 赞同：6
> 
> 时间：2008-12-15T02:47:55.543
> 
> 标签：delphi, windows-installer, custom-action

这是我打算自己回答的问题，但请随时添加其他方法来完成此任务。

我正在打包一个应用程序以用于各种配置，并且我确定在我的 MSI 中执行自定义逻辑的最可靠方法是编写我自己的自定义操作 DLL，该 DLL 将能够从 PROPERTY 表中读取/写入，杀死一个进程，确定一个应用程序是否需要升级（然后将答案记录在 PROPERTY 表中），并写入标准 MSI 日志。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-15T03:10:37.573

我的解决方案在 Delphi 中，需要开源 JEDI API 翻译，您可以[在此处下载](http://sourceforge.net/project/platformdownload.php?group_id=121894)。我发现的一个问题是使用 JwaMSI 标头的示例很少而且相差甚远。希望有人会发现这是一个有用的例子。

这是主要单元，后面是第二个支持单元（您可以将其包含在同一个 DLL 项目中）。只需在 Delphi 中创建一个新的 DLL（库），然后复制/粘贴此代码。该单元导出 2 个可从 MSI 调用的函数。他们是：

1.  CheckIfUpgradeable
2.  KillRunningApp

这两个函数都从属性表中读取一个 PROPERTY 值，并在完成时设置一个值。这个想法是，然后第二个自定义操作可以读取此属性并引发错误，或将其用作安装条件。

此代码更多用于示例，在下面的示例中，它正在检查“notepad.exe”的版本是否需要升级（这意味着存储在属性表值“NOTEPAD_VERSON”中的版本大于版本系统上的 notepad.exe）。如果不是，则将“UPGRADEABLE_VERSION”的属性设置为“NO”（该属性默认设置为“YES”）。

此代码还在 PROPERTY 表中查找“PROGRAM_TO_KILL”，如果该程序正在运行，它将终止该程序。它需要包含要杀死的程序的文件扩展名，例如“Notepad.exe”

```
library MsiHelper;

uses
  Windows,
  SysUtils,
  Classes,
  StrUtils,
  jwaMSI,
  jwaMSIDefs,
  jwaMSIQuery,
  JclSysInfo,
  PsApi,
  MSILogging in 'MSILogging.pas';

{$R *.res}

function CompareVersionNumbers(AVersion1, AVersion2: string): Integer;
var
  N1, N2: Integer;
//Returns 1 if AVersion1 < AVersion2
//Returns -1 if AVersion1 > AVersion2
//Returns 0 if values are equal
  function GetNextNumber(var Version: string): Integer;
  var
    P: Integer;
    S: string;
  begin
    P := Pos('.', Version);
    if P > 0 then
    begin
      S := Copy(Version, 1, P - 1);
      Version := Copy(Version, P + 1, Length(Version) - P);
    end
    else
    begin
      S := Version;
      Version := '';
    end;
    if S = '' then
      Result := -1
    else
    try
      Result := StrToInt(S);
    except
      Result := -1;
    end;
  end;

begin
  Result := 0;
  repeat
    N1 := GetNextNumber(AVersion1);
    N2 := GetNextNumber(AVersion2);
    if N2 > N1 then
    begin
      Result := 1;
      Exit;
    end
    else
    if N2 < N1 then
    begin
      Result := -1;
      Exit;
    end
  until (AVersion1 = '') and (AVersion2 = '');
end;

function GetFmtFileVersion(const FileName: String = ''; const Fmt: String = '%d.%d.%d.%d'): String;
var
  sFileName: String;
  iBufferSize: DWORD;
  iDummy: DWORD;
  pBuffer: Pointer;
  pFileInfo: Pointer;
  iVer: array[1..4] of Word;
begin
  // set default value
  Result := '';
  // get filename of exe/dll if no filename is specified
  sFileName := FileName;
  if (sFileName = '') then
  begin
    // prepare buffer for path and terminating #0
    SetLength(sFileName, MAX_PATH + 1);
    SetLength(sFileName,
      GetModuleFileName(hInstance, PChar(sFileName), MAX_PATH + 1));
  end;
  // get size of version info (0 if no version info exists)
  iBufferSize := GetFileVersionInfoSize(PChar(sFileName), iDummy);
  if (iBufferSize > 0) then
  begin
    GetMem(pBuffer, iBufferSize);
    try
    // get fixed file info (language independent)
    GetFileVersionInfo(PChar(sFileName), 0, iBufferSize, pBuffer);
    VerQueryValue(pBuffer, '\', pFileInfo, iDummy);
    // read version blocks
    iVer[1] := HiWord(PVSFixedFileInfo(pFileInfo)^.dwFileVersionMS);
    iVer[2] := LoWord(PVSFixedFileInfo(pFileInfo)^.dwFileVersionMS);
    iVer[3] := HiWord(PVSFixedFileInfo(pFileInfo)^.dwFileVersionLS);
    iVer[4] := LoWord(PVSFixedFileInfo(pFileInfo)^.dwFileVersionLS);
    finally
      FreeMem(pBuffer);
    end;
    // format result string
    Result := Format(Fmt, [iVer[1], iVer[2], iVer[3], iVer[4]]);
  end;
end;

function KillRunningApp(hInstall: MSIHandle): Integer; stdcall;
var
  aProcesses: array[0..1023] of DWORD;
  cbNeeded: DWORD;
  cProcesses: DWORD;
  i:    integer;
  szProcessName: array[0..MAX_PATH - 1] of char;
  hProcess: THandle;
  hMod: HModule;
  sProcessName : PChar;
  iProcessNameLength : Cardinal;
begin
  iProcessNameLength := MAX_PATH;
  sProcessName := StrAlloc(MAX_PATH);

  try
    //reads the value from "PROGRAM_TO_KILL" that is stored in the PROPERTY table
    MsiGetProperty(hInstall, 'PROGRAM_TO_KILL', sProcessName, iProcessNameLength);

    if not EnumProcesses(@aProcesses, sizeof(aProcesses), cbNeeded) then
    begin
      Exit;
    end;
    cProcesses := cbNeeded div sizeof(DWORD);

    for i := 0 to cProcesses - 1 do
    begin
      hProcess := OpenProcess(PROCESS_QUERY_INFORMATION or PROCESS_VM_READ or PROCESS_TERMINATE, False, aProcesses[i]);
      try
      if hProcess <> 0 then
      begin
        if EnumProcessModules(hProcess, @hMod, sizeof(hMod), cbNeeded) then
        begin
          GetModuleBaseName(hProcess, hMod, szProcessName, sizeof(szProcessName));
          if UpperCase(szProcessName) = UpperCase(sProcessName) then
          begin
            TerminateProcess(hProcess, 0);
          end;
        end;
      end;
      finally
        CloseHandle(hProcess);
      end;                      
    end;
  finally
    StrDispose(sProcessName);
  end;

  Result:= ERROR_SUCCESS; //return success regardless of actual outcome
end;

function CheckIfUpgradeable(hInstall: MSIHandle): Integer; stdcall;
var
  Current_Notepad_version : PChar;
  Current_Notepad_version_Length  : Cardinal;
  sWinDir, sProgramFiles : string;
  bUpgradeableVersion : boolean;
  iNotepad_compare  : integer;
  sNotepad_version  : string;
  sNotepad_Location  : string;
  iResult : Cardinal;
begin
  bUpgradeableVersion := False;
  sWinDir := ExcludeTrailingBackslash(JclSysInfo.GetWindowsFolder);
  sProgramFiles := ExcludeTrailingBackslash(JclSysInfo.GetProgramFilesFolder);

  Current_Notepad_version_Length := MAX_PATH;
  Current_Notepad_version := StrAlloc(MAX_PATH);

  sNotepad_Location := sWinDir+'\system32\Notepad.exe';

  iResult := ERROR_SUCCESS;

  try
    //reads the value from "NOTEPAD_VERSION" that is stored in the PROPERTY table
    MsiGetProperty(hInstall, 'NOTEPAD_VERSION', Current_Notepad_version, Current_Notepad_version_Length);

    if Not (FileExists(sNotepad_Location)) then
    begin
      bUpgradeableVersion := True;
      LogString(hInstall,'Notepad.exe was not found at: "'+sNotepad_Location+'"');
      LogString(hInstall,'This version will be upgraded.');
      iResult := ERROR_SUCCESS;
      Exit;
    end;

    sNotepad_version := GetFmtFileVersion(sNotepad_Location);
    LogString(hInstall,'Found Notepad version="'+sNotepad_version+'"');  
    iNotepad_compare := CompareVersionNumbers(sNotepad_version,StrPas(Current_Notepad_version));

    if (iNotepad_compare < 0) then
    begin
      bUpgradeableVersion := False;
    end
    else
    begin
      bUpgradeableVersion := True;
    end;

    if bUpgradeableVersion then
    begin
      LogString(hInstall,'This version will be upgraded.');
      iResult := ERROR_SUCCESS;
    end
    else
    begin
      MsiSetProperty(hInstall,'UPGRADEABLE_VERSION','NO'); //this indicates failure -- this value is read by another custom action executed after this action
      LogString(hInstall,'ERROR: A newer version of this software is already installed. Setup cannot continue!');
      iResult := ERROR_SUCCESS;
    end;
  finally
    StrDispose(Current_Notepad_version);
  end;

  Result:= iResult; //this function always returns success, however it could return any of the values listed below
//
//Custom Action Return Values
//================================
//
//Return value                        Description
//
//ERROR_FUNCTION_NOT_CALLED           Action not executed.
//ERROR_SUCCESS                       Completed actions successfully.
//ERROR_INSTALL_USEREXIT              User terminated prematurely.
//ERROR_INSTALL_FAILURE               Unrecoverable error occurred.
//ERROR_NO_MORE_ITEMS                 Skip remaining actions, not an error.
//
end;

exports CheckIfUpgradeable;
exports KillRunningApp;

begin
end. 
```

这里是支持单元“MSILogging.pas”。该单元可以在其他 MSI DLL 项目中按原样使用。

```
unit MSILogging;

interface

uses
  Windows,
  SysUtils,
  JwaMsi,
  JwaMsiQuery,
  JwaMSIDefs;

procedure LogString(hInstall: MSIHandle; sMsgString : string);
function MsiMessageBox(hInstall: MSIHandle; sMsgString : string; dwDlgFlags : integer): integer; 

implementation

procedure LogString(hInstall: MSIHandle; sMsgString : string);
var
  hNewMsiHandle : MSIHandle;
begin
  try
    hNewMsiHandle := MsiCreateRecord(2);

    sMsgString := '-- MSI_LOGGING -- ' + sMsgString;
    MsiRecordSetString(hNewMsiHandle, 0, PChar(sMsgString) );
    MsiProcessMessage(hInstall, INSTALLMESSAGE(INSTALLMESSAGE_INFO), hNewMsiHandle);
  finally
    MsiCloseHandle(hNewMsiHandle);
  end;
end;

function MsiMessageBox(hInstall: MSIHandle; sMsgString : string; dwDlgFlags : integer): integer;
var
  hNewMsiHandle : MSIHandle;
begin
  try
    hNewMsiHandle := MsiCreateRecord(2);
    MsiRecordSetString(hNewMsiHandle, 0, PChar(sMsgString) );
  finally
    MsiCloseHandle(hNewMsiHandle);
  end;

  //Result := (MsiProcessMessage(hInstall, INSTALLMESSAGE(dwDlgFlags), hNewMsiHandle));
    Result := (MsiProcessMessage(hInstall, INSTALLMESSAGE(INSTALLMESSAGE_USER + dwDlgFlags), hNewMsiHandle));
end;

end. 
```

# objective-c - 如何在 Xcode 中定义预处理器符号

> ID：367368
> 
> 赞同：104
> 
> 时间：2008-12-15T02:52:04.317
> 
> 标签：objective-c, xcode, c-preprocessor

是否可以通过在 Xcode 项目中设置属性来设置条件编译的符号？

我的目标是创建一个可用于所有文件的符号，而不必使用导入/包含，以便一组通用类在某些项目中具有特殊行为。如下所示，但带有我自己的符号。

```
#if TARGET_IPHONE_SIMULATOR
    ...
#endif 
```

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2008-12-15T03:50:21.907

转到您的目标或项目设置，单击左下角的齿轮图标，然后选择“添加用户定义的设置”。新设置名称应为`GCC_PREPROCESSOR_DEFINITIONS`，您可以在右侧字段中键入您的定义。

根据斯蒂芬的评论，完整的语法是：

```
constant_1=VALUE constant_2=VALUE 
```

请注意，如果您只想#define 一个符号而不是给它一个值（对于语句） ，则*不需要'='*`#ifdef`

* * *

## 回答 #2

> 赞同：86
> 
> 时间：2009-01-26T05:36:57.133

您不需要创建用户定义的设置。内置设置“预处理器宏”工作得很好。 [替代文字 http://idisk.mac.com/cdespinosa/Public/Picture%204.png](http://idisk.mac.com/cdespinosa/Public/Picture%204.png)

如果您有多个使用相同前缀文件的目标或项目，请改用 Preprocessor Macros Not Used In Precompiled Headers，这样您的宏定义的差异不会触发一组不必要的额外预编译头文件。

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2012-01-09T18:34:07.720

作为附录，如果您使用这种技术在目标中定义字符串，这就是我必须定义和使用它们的方式：

在 Build Settings -> Preprocessor Macros 中，是的反斜杠在定义中很重要：

```
APPURL_NSString=\@\"www.foobar.org\" 
```

在源代码中：

```
objectManager.client.baseURL = APPURL_NSString; 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-01-20T23:51:54.213

您可以使用该`*_Prefix.pch`文件来声明项目范围的宏。该文件通常在您的**其他来源**组中。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-09-06T01:27:52.533

它在“GCC 4.2 Preprocessing”下（或者只是在搜索框中输入“prepro”）......

...但是，对于我的一生，我无法让它发挥作用。

我有标准的调试和发布配置，我想在调试配置中定义 DEBUG=1。但是在将其添加为值之后：

（在设置窗口中）> 预处理器宏：DEBUG=1

```
#if DEBUG
    printf("DEBUG is set!");
#endif 
```

...从不打印/被调用。这让我疯狂...

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-07-31T09:21:19.137

对于 Xcode 9.4.1 和 C++ 项目。将`const char*`预处理器宏添加到*调试*和*发布*版本。

1.  选择您的项目

    [![选择项目](https://i.stack.imgur.com/rlafn.png)](https://i.stack.imgur.com/rlafn.png)

2.  选择*构建设置*

    [![选择构建设置](https://i.stack.imgur.com/eSaGE.png)](https://i.stack.imgur.com/eSaGE.png)

3.  搜索“*预处理器宏*”

    [![搜索1](https://i.stack.imgur.com/41SRJ.png)](https://i.stack.imgur.com/41SRJ.png) [![搜索2](https://i.stack.imgur.com/dNzxq.png)](https://i.stack.imgur.com/dNzxq.png)

4.  打开互动列表

    [![打开互动列表](https://i.stack.imgur.com/eg6SZ.png)](https://i.stack.imgur.com/eg6SZ.png)

5.  添加您的宏，不要忘记转义引号

    [![添加路径](https://i.stack.imgur.com/LAQHP.png)](https://i.stack.imgur.com/LAQHP.png)

6.  在源代码中通用`const char*`

    ```
    ...
    #ifndef JSON_DEFINITIONS_FILE_PATH
    static constexpr auto JSON_DEFINITIONS_FILE_PATH = "definitions.json";
    #endif
    ...
    FILE *pFileIn = fopen(JSON_DEFINITIONS_FILE_PATH, "r");
    ... 
    ```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-04-22T16:50:25.707

为了回应 Kevin Laity 的评论（请参阅 cdespinosa 的回答），关于 GCC Preprocessing 部分未显示在您的构建设置中，请将 Active SDK 设置为在它之后显示（Base SDK）的那个，这部分将出现。您可以通过选择菜单 Project > Set Active Target > XXX (Base SDK) 来执行此操作。在不同版本的 XCode（Base SDK）中可能会有所不同，例如（项目设置或项目默认）。

出现此部分后，您可以将定义添加到处理器宏，而不是创建用户定义的设置。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-09-08T03:49:42.947

您可以复制具有预处理部分的目标，将其重命名为您想要的任何名称，然后更改您的预处理器宏值。

# ruby - 如何使 Ruby gem 包将文件复制到任意位置？

> ID：367377
> 
> 赞同：4
> 
> 时间：2008-12-15T03:03:22.300
> 
> 标签：ruby, rubygems, gem

假设您有一个软件包。你想让它成为一个 gem，因为 gems 是在 Ruby 世界中分发任何东西的事实上的标准方式。宝石很棒——对于图书馆来说。但对于真正的应用程序，Rubygems 系统似乎有所欠缺。只是“最近”他们才引入了一种方法来标记可执行文件以放置在系统范围的可执行文件 PATH 中的某个位置。不幸的是，Ruby gems 似乎仍然需要在软件打包的其他方面，即将配置文件放在 /etc 等位置，或 /usr/share/doc 下的文档。或者是吗？我的问题是：

我可以在 gemspec 中放入说明或代码，以便将配置安装到 /etc 中，并将文档放在一些合理的标准化位置（如 /usr/share/doc）下吗？或者，作为一种解决方法，是否可以运行安装后脚本来执行这些操作？

供参考：[GemSpec 规范](http://www.rubygems.org/read/book/4)。

请注意，在撰写本文时 ruby​​gems.org 已关闭。这是该页面的 Google 缓存：http://74.125.95.132/search?q=cache: [JwJO6slR4BwJ :www.rubygems.org/read/chapter/20+http://www.rubygems.org/read/chapter/ 20%23page85&hl=en&ct=clnk&cd=1](http://74.125.95.132/search?q=cache:JwJO6slR4BwJ:www.rubygems.org/read/chapter/20+http://www.rubygems.org/read/chapter/20%23page85&hl=en&ct=clnk&cd=1)

如果您检查[repo 中的 specification.rb 文件](http://rubygems.rubyforge.org/svn/trunk/lib/rubygems/specification.rb)，并向下滚动到最后（搜索“:section:Required gemspec attributes”），您可以看到当前支持的属性。我在那里看不到我想要的东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T14:43:17.173

> 您不应该/不需要这样做... gems 被设计为用作库...而不是作为应用程序本身（调查您的发行版应用程序包系统以获取该类型的东西）。

你知道的。我知道这一点。但“他们”不知道这一点。对于许多卫星，常规查询和评论是：“有宝石吗？” “这可以作为宝石安装吗？” “你为什么不做宝石？” “我没有安装它，因为它不是宝石。”

对与否，可取与否，Joe Rubyist 期望一切都被宝石化。只有老学生熟悉并且似乎可以容忍“ruby setup.rb”类型的交易。

无论如何，我的应用程序确实是一个独立的应用程序；我很难想象任何人都像图书馆一样包括这个。也许作为应用程序集合的一部分，但是......作为一个库的使用似乎很牵强，但如果那一天真的到来，我会在我到达时跨过那座桥（帮助有任何冲突的人包容可能会带来）。

并且没有“开发/测试/阶段/产品”的区别。这是一个普通的旧应用程序，您可以从命令行运行它。

无论如何，感谢您的评论，至少我的假设是肯定的，因为 Rubygems 系统没有提供这样做的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T10:00:35.687

简短的回答：没有

长答案：你不应该/不需要这样做...... gems 被设计为用作库......而不是作为应用程序本身（调查你的发行版应用程序包系统）。另外，你不能假设你的 gem 只会被使用“一次”......理论上，几个项目/应用程序可能包括你的 gem，虽然你的 gem 可能有一些细节将它排除在可以全局配置的东西......由于其他架构问题，例如开发/配置您的应用程序以在不同阶段环境（开发/测试/阶段/生产）中工作，您仍然不想这样做。您最终可能遇到的最好情况就是注意如何在 README 中创建 /etc/ 配置文件，并包含一个实用程序应用程序来提示用户输入值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-11-09T17:48:58.597

2015-11-11 情况如下：RubyGems 支持 pre 和 post install/uninstall 钩子作为`gem`命令的扩展。换句话说，这些钩子适用于所有已安装的 gem，并不意味着在特定 gem 中进行自定义。`operating_system.rb`它们在通常位于的文件中调用`/usr/lib64/ruby/2.2.0/rubygems`；或安装任何位置和版本的 Ruby。钩子是这样使用的：

```
# /usr/lib/ruby/x.y.z./rubygems/operating_system.rb
Gem.pre_install do | installer |
  # do whatever
end

Gem.pre_uninstall do | installer |
  # do whatever
end

Gem.post_install do | installer |
  # do whatever
end
. . . 
```

深入了解 API 文档，似乎使用特定于 gem 的外部活动有可用的插件。请参阅： http: [//guides.rubygems.org/plugins/#executablehooks](http://guides.rubygems.org/plugins/#executablehooks)和[https://github.com/rvm/executable-hooks](https://github.com/rvm/executable-hooks)作为示例。然而，这些似乎都影响了 RubyGem 应用程序，而不是专门影响一个 gem。并且此类插件需要作为 gem 本身安装才能生效。

在我看来，特定于 gem 的安装前和安装后挂钩是一个安全问题。安装系统级 Gem 的人根据定义具有 root 特权，并允许 RubyGem 在简单地安装库之外执行任意操作具有明显的安全隐患。

我正在与 Ruby 人员核实此问题（2015 年 11 月 10 日）。可能这些钩子仅供在不同平台上安装 RubyGem 本身的人使用。

RubyGems 现在（2015）支持`pre_install()`和`post_install()`钩子作为以 &block 作为参数的方法。假设您不`false`从其中任何一个返回，您可以在其中任何一个中做任何您想做的事情。返回`nil`是可以的，但`false`返回将中止 gem 安装。

# c# - 返回一个默认值。（C＃）

> ID：367378
> 
> 赞同：16
> 
> 时间：2008-12-15T03:04:54.353
> 
> 标签：c#, generics, default-value

我正在创建自己的字典，但在实现[TryGetValue](http://msdn.microsoft.com/en-us/library/ms132143(VS.85).aspx)函数时遇到了麻烦。当找不到密钥时，我没有任何东西可以分配给 out 参数，所以我保持原样。这会导致以下错误：“必须在控制离开当前方法之前分配输出参数‘值’”

所以，基本上，我需要一种方法来获取默认值（0、false 或 nullptr，具体取决于类型）。我的代码类似于以下内容：

```
class MyEmptyDictionary<K, V> : IDictionary<K, V>
{
    bool IDictionary<K, V>.TryGetValue (K key, out V value)
    {
        return false;
    }

    ....

} 
```

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-12-15T03:07:07.487

您正在寻找[`default`](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/statements-expressions-operators/default-value-expressions)关键字。

例如，在您给出的示例中，您需要以下内容：

```
class MyEmptyDictionary<K, V> : IDictionary<K, V>
{
    bool IDictionary<K, V>.TryGetValue (K key, out V value)
    {
        value = default(V);
        return false;
    }

    ....

} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-15T23:13:16.723

```
default(T) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-15T03:06:47.563

```
return default(int);

return default(bool);

return default(MyObject); 
```

所以在你的情况下你会写：

```
class MyEmptyDictionary<K, V> : IDictionary<K, V>
{
    bool IDictionary<K, V>.TryGetValue (K key, out V value)
    {
        ... get your value ...
        if (notFound) {
          value = default(V);
          return false;
        }
    }

.... 
```

}

# asp.net - 存储过程不使用 LINQ 执行

> ID：367379
> 
> 赞同：1
> 
> 时间：2008-12-15T03:05:59.610
> 
> 标签：asp.net, vb.net, linq

这个问题快把我逼疯了。

我定义了几个表，并为这些表存储了 CRUD 过程。我已经使用 dbml 映射器将存储的过程连接到 Visual Studio 中的表。

一切正常，除了一张桌子。我的历史记录表没有命中插入存储过程。

dbml 映射器中表中的 insert 属性为：

```
usp_HistoryInsert (ByRef historyID As System.Int32, changeRequestID As System.Int32, statusID As System.Int32, userID As System.Int32, emailSent As System.Boolean, historyDate As System.DateTime, remarks As System.String, statusChanged As System.Boolean) 
```

我正在尝试使用以下代码来实现它：

```
 ' create new history entry
    h1.ChangeRequestID = ChangeID
    h1.UserID = Session("UserID")
    h1.HistoryDate = DateTime.Now
    h1.StatusChanged = ActionID
    h1.Remarks = RichTextEditor1.Text
    h1.EmailSent = True
    h1.StatusID = ActionID

    db.Histories.InsertOnSubmit(h1)
    db.SubmitChanges() 
```

使用分析器，我可以看到存储的过程没有被击中。我重命名了数据库中的存储过程（试图生成异常），只是为了仔细检查。

如果我尝试手动点击存储过程（如下），它工作正常！

```
db.usp_HistoryInsert(0, h1.ChangeRequestID, h1.StatusID, h1.UserID, h1.EmailSent, h1.HistoryDate, h1.Remarks, h1.StatusChanged) 
```

有没有人遇到过这个问题？

固定的！请参阅下面的答案。有人可以关闭这个吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T05:03:44.397

好的，这令人难以置信，但是……该应用程序已经有一个名为 history.aspx 的页面。VB 默认使用该页面的历史类，而不是 LinQ 使用的 db.History 类。

一旦我重命名history.aspx，一切正常！:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T04:32:19.263

您是否手动将 sproc 连接到 .dbml 文件中的表？如果您在属性网格中选择表 a，您可能会看到插入行为。如果它说使用运行时，那么您的 SPROC 将不会被调用，并且您已从使用运行时更改该设置，以手动配置它以在插入时调用您的 SPROC。

# php - 后期静态绑定：web开发常用的语言有哪些支持呢？

> ID：367400
> 
> 赞同：2
> 
> 时间：2008-12-15T03:24:08.950
> 
> 标签：php, oop, binding

最近我看到很多关于 PHP 在 5.3 之前缺乏后期静态绑定的讨论。

从我读过的内容来看，在该语言具有此功能之前，ActiveRecord 之类的东西的正确实现是不可能的。

所以，我很好奇：

*   哪些语言支持它，特别是那些通常与 Web 开发相关的语言，例如 Python、Ruby、Perl、Java、C#（JavaScript？）。
*   哪个实际上定期使用它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T05:43:16.250

如果你想解决这个问题，虽然这确实有点费时，但是当 php 5.3 可用并成为主流时很容易被删除，你可以试试下面的代码。

```
class Specific_Model extends Model{

    public static function GetAll($options = null){

        parent::GetAll($options, get_class());

    }

}

class Model{

    public static function GetAll($options = null, $class = null){

       if(is_null($class)) $class = get_class();  

       /* Do stuff here */

    }

} 
```

然后你可以使用下面的代码...

```
Specific_Model::GetAll($options); 
```

并在迁移到 php 5.3 时轻松去除多余的代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T12:54:02.120

“后期静态绑定”的概念是对 PHP 静态声明类这一事实的修补。大多数动态语言都有一个对象系统，其中一个类就是一个对象。另一方面，PHP 将代码和运行时完全分开（如 C/C++）。这有各种奇怪的含义，如果没有我们会更好。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-18T05:28:40.257

如果没有后期静态绑定，当程序员清楚地在 B 类上表达函数时，PHP 解释器会将函数 hello() 绑定到 A 类。缺少后期静态绑定会导致打印“hello”，而不是打印“bye”，尽管 hello () 在 B 类上被调用。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-12-15T03:31:49.403

我完全误解了后期静态绑定是什么。这是[维基百科](http://en.wikipedia.org/wiki/Name_binding)所说的。

> 后期静态绑定是 [name] 绑定的变体，介于静态和动态绑定之间。考虑以下 PHP 示例：

```
class A {
    static $word = "hello";
    static function hello() {print self::$word;}
}

class B extends A {
    static $word = "bye";
}

B::hello(); 
```

> 如果没有后期静态绑定，PHP 解释器`hello()` 会在程序员清楚地在 `class B`. 没有后期静态绑定会导致打印“hello”，而不是“bye”，尽管`hello()` 被调用`class B`。
> 
> 解释器中的后期静态绑定意味着 `$word`在运行时确定。在这种情况下，它将引用`B::$word` if`B::hello()`被调用和`A::$word` if`A::hello()`被调用。这确实需要将关键字从 `self`to更改为`static`（可能从 PHP 5.3 开始可用）`A::hello()`

```
class A {
    static $word = "Welcome";
    static function hello() {print static::$word;}
}

class B extends A {
    static $word = "bye";
}

B::hello(); 
```

# smalltalk - 早期绑定与后期绑定：比较优缺点是什么？

> ID：367411
> 
> 赞同：20
> 
> 时间：2008-12-15T03:32:03.160
> 
> 标签：smalltalk, late-binding, early-binding

在讨论计算机语言的演变时，Alan Kay 说他的 Smalltalk 的一个最重要的属性是后期绑定。它赋予语言可塑性和可扩展性，并允许随着时间的推移重构不适当的耦合。你同意？早期绑定是否有补偿优势来解释为什么它似乎是两种范式中可以使用的域的主导？

我个人的经验（不够广泛或不够权威），基于使用 javascript、jQuery、jsext、actionscript、php、java、RoR 和 asp.net 实现 Web 应用程序，似乎表明后期绑定和膨胀之间存在正相关关系减少。我确信早期绑定有助于检测和防止一些类型安全错误，但自动完成和良好的 IDE 以及一般的良好编程实践也是如此。因此，在我的风险规避方面恢复我的理性观点之前，我倾向于让自己支持后期绑定方面。

但是我真的对如何平衡权衡没有很好的理解。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-19T20:13:13.367

根据我对高性能软件（例如游戏、数字运算）和性能中立软件（网站、大多数其他软件）的经验，后期绑定有一个*巨大*的优势：您提到的延展性/可维护性/可扩展性。

早期绑定有两个主要好处。首先：

*   运行时性能

被普遍接受，但通常无关紧要，因为在大多数情况下，将硬件投入到问题上是可行的，这更便宜。当然，也有例外（例如，如果您不拥有正在运行的硬件）。

早期绑定的第二个好处：

*   易于开发

似乎被低估了。在开发人员与其他人的组件一起工作的大型项目中，IDE 可以读取早期绑定并使用它们来通知开发人员（通过自动完成、文档等）。这对于后期绑定不太实用，因为绑定是在运行时创建的。如果 IDE 可以从代码中推断结构定义，那么后期绑定语言仍然是可能的，但是由于结构总是可以在运行时更改，所以它不是那么可靠。

易于开发是一件大事。它最大限度地减少了昂贵的程序员时间——而且你的开发团队越大，它就变得越重要。您需要在这与使用后期绑定语言获得的灵活性之间取得平衡。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-15T04:02:48.950

传统上，早期绑定的最大优势在于性能：后期绑定语言必须在运行时携带有关其所有数据的类型信息，并且失去了在编译时进行一些优化的机会。然而，随着计算机变得更快，并且随着虚拟机在动态优化方面变得更加智能，这种差异已经变得不那么重要了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-10-14T23:14:04.977

Late-binging 允许正在运行的系统扩展自身。例如，系统启动时会知道 Wolves。随着时间的推移，evolveDometicate() 方法在 Wolf(?) 中旋转了一个名为 Dog 的新类并将其实例化，现在我们有了 Dogs。Smalltalk 将保存整个 SYSTEM 映像，因此如果您将其关闭并重新启动，Dogs 将在重新启动后仍然存在。一旦你发展到在特定硬件上运行并连接到网状网络中的对象，整个生态系统就不会真正关闭（直到 Sun 爆炸）。我想这就是艾伦凯所说的后期绑定的优势，成为神。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-06T00:55:12.543

早期绑定与晚期绑定实际上是语言架构的一个功能。早期绑定意味着可以在机器指令跳转到某个地址并从那里开始执行的地方构建代码（可能通过查找表）。后期绑定需要为每次访问查找符号和类型引用（通常是哈希表查找），这会减慢语言速度。

而一些基于 VM 的语言，如 Java 是早期绑定的本地机器代码，只能真正直接进行早期绑定。要进行后期绑定，它必须进行与动态语言解释器相同的哈希查找。然后，后期绑定需要执行一段代码来获取地址（这就是 OLE 自动化的工作方式）。它不能直接由 CPU 完成 - 必须执行代码。

请注意，执行后期绑定的代码实际上将在哈希查找函数等中有自己的早期绑定分支目标。因此，从这个角度来看，任何要由 CPU 直接执行的代码都需要早期绑定。后期绑定必须在软件中完成。

对于相当广泛的代码优化，早期绑定也是必要的。

可以说，像 C 这样的架构在编写接近金属的代码方面有一个甜蜜点。在您想要执行此操作的地方，早期绑定方面几乎是语言体系结构所固有的。在 Python 等后期绑定语言中，后期绑定也是固有的。有些语言两者都提供，但使用的特定类型将与正在执行的特定构造相关联。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-15T12:54:40.793

我认为有更好的方法/模式来避免不适当的耦合，比如控制反转、依赖注入、工厂......

但是，我喜欢后期绑定的“易于使用”的版本独立性
只需使用

```
var excel = CreateObject("Excel.Application"); 
```

和后期绑定会弄清楚，什么样的 Excel.Application，以及从哪里得到它......

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2011-10-16T06:14:04.470

在编译期间执行链接的编译时绑定称为早期绑定

动态绑定，其中在调用函数时执行期间执行的函数链接称为后期绑定

# formatting - 格式化内联项目？一般代码是什么样的？

> ID：367426
> 
> 赞同：0
> 
> 时间：2008-12-15T03:47:56.653
> 
> 标签：formatting, html

这是一个新手问题，所以提前谢谢。我试图弄清楚 div 和 span 之间的区别，以及何时以及如何使用它们。

例如，我想让一个图像左对齐，并且我希望文本在右边的图像周围流动，同时保持对齐。如果文本流过图像，我希望它环绕图像的底部......就像我们在布局世界中所说的“环绕”。

我正在寻找一个参考的例子，所以在你的回答中你能提供一个标记的例子吗？

非常感谢！！！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-15T03:59:56.193

SPAN 标签不打算成为其他标签的容器。这在与类结合时特别有用。

使用 div 来定义页面的各个部分，并使用 span 来包围和设置文本或文本类的样式。

[http://www.learnwebdesignonline.com/htmlcourse/span-div.htm](http://www.learnwebdesignonline.com/htmlcourse/span-div.htm)展示了如何使用它们的一个很好的例子。对于包装文本的示例，浮动图像并将其全部包装在 DIV 中 - 如下所示：

```
<div>
test test test test <img src="" alt="" style="float:left;margin:8px 0 0 8px; display:inline" /> test test test test test test test test test test test test 
</div> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T03:54:07.517

块级基本上意味着默认情况下它从自己的行开始，而内联位于其他元素旁边。

[堵塞]

[堵塞]

相对

[内联][内联]

然而，两者都没有被包裹。如果您要在图像周围包裹文字，您会将图像浮动到一边。这方面的一个例子如下

```
<img src="picture.jpg" alt="An image" style="float: left" />
Lorem ipsum dolor sit amet, consectetur adipiscing elit. In eros. Curabitur posuere. Cras sodales leo quis mauris. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Vestibulum adipiscing nunc vel arcu. Ut sed quam non est molestie commodo. Suspendisse metus erat, cursus fermentum, faucibus nec, pulvinar et, lorem. Praesent odio. In interdum imperdiet enim. 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T02:19:17.607

Divs 和 spans 有点像没有语义意义的通配符标签。当没有其他合适的标签（如表格、列表或标题）时，您可以使用它们对元素进行分组或标识。他们的区别是：

**div**

*   这是一个块级元素
*   默认显示属性是块，这意味着：

    *   它和它的容器一样宽
    *   总是在前后换行
*   可以包含其他块级元素，如`p`, `h1`, `table`, `ul`, `blockquote`,`div`
*   可以包含其他内联元素，如`img`, `strong`, `em`, `input`, `a`,`span`

**跨度**

*   是一个内联元素
*   默认显示属性是内联的，这意味着：

    *   和它的内容一样狭窄
    *   如果没有必要，不进行任何换行）
    *   `vertical-align`你可以使用它的 css 属性
*   不能**包含**块级元素
*   可以包含其他内联元素，如`img`, `strong`, `em`, `input`, `a`,`span`

您始终可以使用 css 更改它们的默认显示属性，但您无法更改它们可以包含的元素类型，无论显示属性值如何。例如：

```
<span style="display:block">
    this will be displayed like a div,
    but still cannnot contain block level elements
</span> 
```

因为它们是“通用”标签，所以它们通常与类一起用于[微格式。](http://microformats.org)例如：`<span class="tel">555-5555</span>`，因为没有`<tel>`标签。

至于图像换行，如果图像与文本直接相关，则可以使用：

```
<p><img src="image.jpg" style="float: right" alt="my image" />Long paragraph.</p> 
```

并且不需要 div 或 span。但是，如果不是，那么您可以使用：

```
<p>unrelated to the image</p>
<div>
<img src="image.jpg" style="float: right" alt="my image" />
<p>Long paragraph.</p>
</div> 
```

这里`div`是必要的，因为`p`是块级元素。

最后，有关更多信息，您可以查看有关 div 和 span[的官方 W3C 规范主题。](http://www.w3.org/TR/REC-html40/struct/global.html#h-7.5.4)

# java - 如何在 Maven 中创建一个减去一些包的发行版？

> ID：367431
> 
> 赞同：1
> 
> 时间：2008-12-15T03:51:41.937
> 
> 标签：java, maven-2

我有一个包含以下包的 Maven 项目（仅用于说明）：

根：`src/main/java`

*   `/com/foo`
*   `/com/foo/api`
*   `/com/foo/impl`

现在我想创建一个只包含 和 中的代码的`/com/foo/api`jar `/com/foo/impl`。

如何破解 pom.xml 来做到这一点？谢谢大家。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T04:19:49.773

很简单，使用`<includes>`jar 插件上的标签：

```
<plugin>
  <groupId>org.apache.maven.plugins</groupId>
  <artifactId>maven-jar-plugin</artifactId>
  <configuration>
    <includes>
      <include>/com/foo/api/*</include>
      <include>/com/foo/impl/*</include>
    </includes>
  </configuration>
</plugin> 
```

在插件文档的[使用](http://maven.apache.org/plugins/maven-jar-plugin/usage.html)部分中有一个关于包含/排除的部分。

# javascript - Associative array without toString, etc

> ID：367440
> 
> 赞同：3
> 
> 时间：2008-12-15T03:58:41.673
> 
> 标签：javascript, object, maps, associative-array

I want to create an associative array:

```
var aa = {} // Equivalent to Object(), new Object(), etc... 
```

And I want to be sure that any key I access is going to be a number:

```
aa['hey'] = 4.3;
aa['btar'] = 43.1; 
```

I know JavaScript doesn't have typing, so I can't automatically check this, but I can ensure in my own code that I only assign strings to this `aa`.

Now I'm taking keys from the user. I want to display the value for that key. However, if the user gives me something like "toString", the user gets back a function, not an int! Is there a way to make sure any string the user gives me is only something I define?

Is the only solution something like the following?

```
delete aa['toString'];
delete aa['hasOwnProperty']; 
```

etc...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T04:10:56.047

One possibility would be to use hasOwnProperty to check that the key is something you explicitly added to the array. So instead of:

```
function findNumber(userEnteredKey) {
    return aa[userEnteredKey];
} 
```

you'd say:

```
function findNumber(userEnteredKey) {
    if (Object.prototype.hasOwnProperty.call(aa, userEnteredKey))
        return aa[userEnteredKey];
} 
```

Alternately, you could use typeof to check that anything is a number before returning it. But I like the hasOwnProperty approach, because it'll keep you from returning anything that you didn't intentionally put in the array.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-15T04:12:08.383

This may work for you:

```
function getValue(id){
  return (!isNaN(aa[id])) ? aa[id] : undefined;
} 
```

Alternatively, I recommend this generic solution:

```
function getValue(hash,key) {
    return Object.prototype.hasOwnProperty.call(hash,key) ? hash[key] : undefined;
} 
```

Note the following: The key will internally be converted to a string because the key is actually a name of an attribute.

```
var test = {
  2: "Defined as numeric",
  "2": "Defined as string"
}

alert(test[2]); // Alerts "Defined as string" 
```

If trying to use an object:

```
var test = {}, test2 = {};
test[test2] = "message"; // Using an object as a key.

alert(test[test2]); // Alerts "message". It looks like it works...

alert(test[test2.toString()]);
// If it really was an object this would not have worked,
// but it also alerts "message". 
```

Now that you know that it is always a string, let’s use it:

```
var test = {};

var test2 = {
    toString:function(){return "some_unique_value";}
    // Note that the attribute name (toString) don't need quotes.
}

test[test2] = "message";
alert(test["some_unique_value"]); // Alerts "message". 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T13:02:27.050

When you create a new key, prepend it with some string constant of your own:

```
var a = {};
var k = 'MYAPP.COLLECTIONFOO.KEY.';

function setkey(userstring)
{
  a[k + userstring] = 42;
}

function getkey(userstring)
{
  return a[k + userstring];
} 
```

# shell - 让 Emacs ansi-term 和 Zsh 玩得很好

> ID：367442
> 
> 赞同：17
> 
> 时间：2008-12-15T04:01:59.420
> 
> 标签：shell, emacs, zsh

我一直在尝试在我的 emacs 会话中使用 Zsh，而没有 emacs 重新映射所有 Zsh 键。我发现 ansi-term 对此非常有效，但是我仍然遇到一些问题。我输出了很多垃圾字符，我可以通过以下方式修复它：

```
## Setup proper term information for emacs ansi-term mode
[[ $TERM == eterm-color ]] && export TERM=xterm 
```

但一切仍然无法完美运行。现在我在将输出绘制到屏幕外时遇到问题，尤其是在使用 Cr 之类的东西进行搜索时。

我发现如果您不调整窗口大小，它可以正常工作。我可以像这样复制它：

1.  启动一个干净的`emacs -q`
2.  启动`ansi-term`和使用`zsh`
3.  使窗口全屏
4.  输出填满屏幕的东西
5.  类型`C-r`
6.  提示将离开屏幕

也许有某种方法可以使输出和迷你缓冲区之间的空间更大以补偿过冲？

其他人有 Zsh + Ansi-term 正常工作吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2012-04-06T22:46:52.417

试试[MultiTerm](http://www.emacswiki.org/emacs/MultiTerm)。

它是唯一一个似乎与 zsh 配合得很好的 Emacs 终端模式。它允许您轻松设置要由 emacs 捕获的命令以及要路由到终端的命令。到目前为止，默认设置对我来说已经足够好了。

此外，将以下内容添加到您的 .zshrc 以允许 emacs 在您 cd 时跟踪您的当前目录。

```
if [ -n "$INSIDE_EMACS" ]; then
  chpwd() { print -P "\033AnSiTc %d" }
  print -P "\033AnSiTu %n"
  print -P "\033AnSiTc %d"
fi 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T04:13:40.627

嗯。我不认为我曾在 ansi-term 中看到过任何花哨的编辑工作，尽管我可能已经有 20 年没有尝试过了。顺便问一下，如果您尝试过 shell 模式（Mx shell），因为无论如何使用 EMACS 更自然。

也就是说，通读 term.el 文件，看起来 ansi-term 自己做了很多管理工作。您可能想查看术语原始模式代码，从第 1230 行开始，至少在 EMACS 22.3 中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-21T01:42:17.067

我也一直在寻找这个。对我来说，添加以下内容

```
;; ansi-term

(global-set-key "\C-x\C-a" '(lambda ()(interactive)(ansi-term "/bin/zsh")))
(global-set-key "\C-x\ a" '(lambda ()(interactive)(ansi-term "/bin/zsh"))) 
```

作品。我从 [http://svn.assembla.com/svn/id774/scripts/dot_files/dot_emacs.d/elisp/global-set-key.el](http://svn.assembla.com/svn/id774/scripts/dot_files/dot_emacs.d/elisp/global-set-key.el)中挑选了这个。

我确信该脚本中还有其他好东西。作为一个额外的奖励屏幕，对我来说似乎与 emacs 配合得很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T22:36:35.753

我想到了。这是一个emacs配置问题。我的 .emacs 中的这一点 elisp 导致了它：

```
(custom-set-variables
 '(fringe-mode nil nil (fringe))
 '(fringes-outside-margins t t)) 
```

谢谢您的帮助。

# .net - 只读 PropertyGrid

> ID：367444
> 
> 赞同：2
> 
> 时间：2008-12-15T04:03:28.590
> 
> 标签：.net, reflection, propertygrid, propertydescriptor, readonly-attribute

我需要在 PropertyGrid 中显示一个具有以下要求的对象：该对象及其子对象必须是只读的，能够激活 PropertyGrid 的 CollectionEditors。

我找到了一个与我需要的非常匹配的样本，但是有一个我无法弄清楚的意外行为。对于不同的对象，我有多个 PropertyGrids。在 SetBrowsablePropertiesAsReadOnly 中，我循环了一个对象，但令人惊讶的是，我项目中的所有 PropertyGrids 都变成了只读的。谁能帮帮我。这是代码：

```
 Imports System.Reflection
Imports System.ComponentModel

Public Class PropertyGridEx
    Inherits PropertyGrid

    Private isReadOnly As Boolean
    Public Property [ReadOnly]() As Boolean
        Get
            Return Me.isReadOnly
        End Get
        Set(ByVal value As Boolean)
            Me.isReadOnly = value
            Me.SetBrowsablePropertiesAsReadOnly(Me.SelectedObject, value)
        End Set
    End Property

    Protected Overloads Sub OnSelectedObjectsChanged(ByVal e As EventArgs)
        Me.SetBrowsablePropertiesAsReadOnly(Me.SelectedObject, Me.isReadOnly)
        MyBase.OnSelectedObjectsChanged(e)
    End Sub

    Private Sub SetBrowsablePropertiesAsReadOnly(ByRef selectedObject As Object, ByVal isReadOnly As Boolean)
        If selectedObject IsNot Nothing Then
            Dim props As PropertyDescriptorCollection = TypeDescriptor.GetProperties(selectedObject)
            For Each propDescript As PropertyDescriptor In props
                If propDescript.IsBrowsable AndAlso propDescript.PropertyType.GetInterface("ICollection", True) Is Nothing Then
                    Dim attr As ReadOnlyAttribute = TryCast(propDescript.Attributes(GetType(ReadOnlyAttribute)), ReadOnlyAttribute)
                    If attr IsNot Nothing Then
                        Dim field As FieldInfo = attr.[GetType]().GetField("isReadOnly", BindingFlags.NonPublic Or BindingFlags.Instance)
                        field.SetValue(attr, isReadOnly, BindingFlags.NonPublic Or BindingFlags.Instance, Nothing, Nothing)
                    End If
                End If
            Next
        End If
    End Sub
End Class 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T11:05:38.047

该`ReadOnly`属性是在类定义上设置的，而不是在对象的实例上设置的。因此，这将对该类的所有实例产生影响。

要实现您想要的，请创建一个自定义`PropertyDescriptor`，在其中覆盖该`IsReadOnly`属性，并将其应用于您的对象实例的属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-01-04T05:39:13.233

我确定这不是正确的 vb 语法，但这可以通过添加属性来完成：

```
Private Sub SetBrowsablePropertiesAsReadOnly(ByRef selectedObject As Object, ByVal isReadOnly As Boolean)
  If selectedObject IsNot Nothing Then
    TypeDescriptor.AddAttributes(selectedObject, New Attribute[] { New ReadOnlyAttribute(isReadOnly) });
  End If
End Sub 
```

# cocoa-touch - 印象笔记应用“提示”图片覆盖 UITableView

> ID：367447
> 
> 赞同：1
> 
> 时间：2008-12-15T04:06:29.817
> 
> 标签：cocoa-touch, core-animation, image-manipulation

Evernote 应用程序有一个提示窗格，它挂在初始窗口的 UITableView 上。当您单击提示时，会出现一个简单的动画，提示窗格会向上滑入视图。

我的问题是，从某种意义上说，提示窗格是如何实现的，您绝对必须单击突出的选项卡才能使其动画化。它左侧的任何像素确实会击中 UITableViewCell。这是 Core Graphics/Quartz 技巧还是只是一个透明图像？很难清楚地表达我想在这里问什么，但我希望有人能理解。

这是印象笔记应用程序主屏幕底部提示窗格的屏幕截图：http: [//dl-client.getdropbox.com/u/57676/evernote.jpg](http://dl-client.getdropbox.com/u/57676/evernote.jpg)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T08:57:03.037

它可能使用透明图像并覆盖`-hitTest:withEvent:`以将图像的透明部分声明为不属于视图的一部分。

另一种可能性是它有两个视图，一个用于选项卡，一个用于窗格的其余部分，但这似乎需要更多工作来保持所有内容同步。

# winapi - VB 6.0 系统托盘应用程序在 Windows 关闭时不会正常关闭

> ID：367448
> 
> 赞同：3
> 
> 时间：2008-12-15T04:07:10.563
> 
> 标签：winapi, vb6

我在 VB 6.0 应用程序中使用以下代码，以允许为应用程序提供系统托盘图标：

```
Option Explicit

'user defined type required by Shell_NotifyIcon API call
Public Type NOTIFYICONDATA
   cbSize As Long
   hwnd As Long
   uId As Long
   uFlags As Long
   uCallBackMessage As Long
   hIcon As Long
   szTip As String * 64
End Type

'constants required by Shell_NotifyIcon API call:
Public Const NIM_ADD = &H0
Public Const NIM_MODIFY = &H1
Public Const NIM_DELETE = &H2
Public Const NIF_MESSAGE = &H1
Public Const NIF_ICON = &H2
Public Const NIF_TIP = &H4
Public Const WM_MOUSEMOVE = &H200
Public Const WM_LBUTTONDOWN = &H201     'Button down
Public Const WM_LBUTTONUP = &H202       'Button up
Public Const WM_LBUTTONDBLCLK = &H203   'Double-click
Public Const WM_RBUTTONDOWN = &H204     'Button down
Public Const WM_RBUTTONUP = &H205       'Button up
Public Const WM_RBUTTONDBLCLK = &H206   'Double-click

Public Declare Function SetForegroundWindow Lib "user32" (ByVal hwnd As Long) As Long
Public Declare Function Shell_NotifyIcon Lib "shell32" Alias "Shell_NotifyIconA" (ByVal dwMessage As Long, pnid As NOTIFYICONDATA) As Boolean

Public nid As NOTIFYICONDATA 
```

当您单击窗口的 X 将其关闭时，我希望应用程序最小化到系统托盘。我在表单的 QueryUnload 事件中使用以下代码完成此操作：

```
Me.WindowState = vbMinimized
Me.Hide 
```

在表单的 Unload 事件中，我执行以下操作：

```
Shell_NotifyIcon NIM_DELETE, nid 
```

问题是当我关闭操作系统并且 Windows 向应用程序发送 WM_CLOSE 消息时，QueryUnload 被触发但显然不是 Unload 事件，因为 Windows 提示我它想要结束我的任务。

关于如何让应用程序在 Windows 关闭时正常关闭的任何想法？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-15T04:18:05.127

这是我在关闭 Query_Unload 程序时使用的：

```
Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer)
    Select Case UnloadMode
        Case 1, 2, 3 'If the program is being terminated by Code, Windows shutting down, or Task Manager
            Cancel = False 'Allow the program termination
            Unload Me
        Case Else
            Cancel = True 'Else disallow the termination
    End Select
End Sub 
```

如果情况 2（Windows 关闭），我继续让程序终止。

让我知道这是否有帮助！联合部队

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T04:37:24.870

[这是来自 vbnet http://vbnet.mvps.org/index.html?code/subclass/shellnotifybasic.htm](http://vbnet.mvps.org/index.html?code/subclass/shellnotifybasic.htm)的示例实现

# colors - BGR色彩空间到底是什么？

> ID：367449
> 
> 赞同：44
> 
> 时间：2008-12-15T04:09:20.170
> 
> 标签：colors, opencv, color-space

RGB 颜色由三个分量组成：红色 (0-255)、绿色 (0-255) 和蓝色 (0-255)。

BGR色彩空间到底是什么？它与 RGB 颜色空间有何不同？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-12-15T22:43:52.103

它关于*字节序*。

RGB 是一个字节顺序。但是大多数普通图形库的一个故意实现选择是它们在内部将颜色视为无符号的 32 位整数，将三个（或四个，通常包括 alpha）分量打包到整数中。

在 little-endian 机器（例如 x86）上，整数 0x01020304 实际上将作为 0x04030201 存储在内存中。因此 0x00BBGGRR 将被存储为 0xRRGGBB00！

因此，术语 BGR（和 BGRA 等）是一个泄漏抽象，其中图形库解释整数如何在逻辑上排序，以便使您的代码直接访问单独的颜色组件更具可读性。

请记住，位图通常由比处理器更多的硬件部分访问，并且由传统显示适配器指定的字节序不一定与 CPU 的字节序相同。在操作像素中的通道的级别上，CPU 可以提取任意顺序的字段。它纯粹是一个了解标签事物的程序员。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-12-15T04:44:09.367

RGB 代表红绿蓝。大多数情况下，RGB 颜色存储在结构或无符号整数中，蓝色占据最低有效“区域”（32 位和 24 位格式的字节），绿色第二少，红色第三少。

BGR 是相同的，只是区域的顺序相反。红色占据最不重要的区域，绿色第二（仍然），蓝色第三。

在某些平台（例如[Gamegear](http://en.wikipedia.org/wiki/Gamegear)）上，使用了 BGR 模型。但是，通常可能会使用 RGB（尽管许多图形 API 都支持 BGR 以实现兼容性）。我不确定*为什么要*使用它。大概是历史的。

示例：#FF0000 在读取为 RGB 十六进制颜色 (#rrggbb) 时为纯红色，因为第三个区域（数字从右到左读取！）为 FF（最大值，全色），其他两个区域为 00（最小值价值，没有颜色）。如果 #FF0000 被读取为 BGR 十六进制颜色，它将是纯蓝色。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-09-09T01:14:03.233

这是关于颜色分量在内存中的布局方式。对于 BGR，顺序是 BGRBGRBGRBGR...，对于 RGB，顺序是 RGBRGBRGB... 对于 BGR，OpenCV 的默认顺序是这样的：

![在此处输入图像描述](https://i.stack.imgur.com/Lc7Yv.png) （请参阅 OpenCV 文档了解[图像矩阵是如何存储在内存中的？](http://docs.opencv.org/doc/tutorials/core/how_to_scan_images/how_to_scan_images.html#how-the-image-matrix-is-stored-in-the-memory)）

请注意，其他答案提到某些颜色最不重要或最重要，但这实际上取决于您机器的字节序。例如，无符号整数中组件的打包顺序实际上取决于您的软件或您正在使用的库。但是，无论您的库或机器的字节序如何，对于 BGR 像素，B 颜色分量的字节地址将比 G 少一个，比 R 少两个（而对于 RGB，情况正好相反）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T04:14:35.883

它只是以更严格控制的顺序排列的 RGB，与字节序无关。一旦您知道环境的字节序，它们之间的转换就很简单了。

BGR 是 24 位表示，其中低地址 8 位为蓝色，下一个地址 8 为绿色，高地址 8 为红色。

RGB 值倾向于写为 RGB(r,g,b)，其中 r/g/b 值介于 0 和 255 之间，或者写为 #rrggbb，其中 rr/gg/bb 是 8 位十六进制值。我见过的所有 BGR 值往往是`0`和`16777215`( `0xffffff`) 之间的简单整数。

# c# - 接口中的内部成员

> ID：367457
> 
> 赞同：43
> 
> 时间：2008-12-15T04:13:49.457
> 
> 标签：c#, interface, concreteclass

我有一个实现接口的对象列表，以及该接口的列表：

```
public interface IAM
{
    int ID { get; set; }
    void Save();
}

public class concreteIAM : IAM
{
     public int ID { get; set; }
     internal void Save(){
     //save the object
     }

    //other staff for this particular class
}

public class MyList : List<IAM>
{
    public void Save()
    {
        foreach (IAM iam in this)
        {
            iam.Save();
        }
    }

    //other staff for this particular class
} 
```

前面的代码无法编译，因为编译器要求所有接口成员都是公共的。

```
internal void Save(){ 
```

但我不想让我的 DLL 外部`ConcreteIAM`的`MyList`.

有什么办法可以做到这一点？

**更新＃1**：大家好，感谢到目前为止的答案，但它们都不是我所需要的：

该接口需要是公共的，因为它是来自 dll 外部的客户端将使用的签名，以及`ID`我在示例中不费心编写的其他属性以保持简单。

安德鲁，我不认为解决方案是创建一个工厂来创建另一个包含`IAM`成员+保存的对象。我还在想……还有其他的想法吗？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-12-15T09:55:49.673

我认为您不了解接口的用途。接口是一个**契约**。它指定对象以某种方式运行。如果一个对象实现了一个接口，这意味着你可以依赖它，它实现了接口的所有方法。

现在，考虑一下如果有一个像您要求的界面会发生什么 - 公开，但只有一个内部成员。那意味着什么？外部对象只能实现公共方法，而不能实现内部方法。当您获得这样一个外部对象时，您将只能调用公共方法，而不能调用内部方法，因为该对象无法实现它。换句话说 -**合同**不会被履行。并不是所有的方法都会被实现。

我认为这种情况下的解决方案是将您的界面一分为二。一个接口将是公共的，这就是您的外部对象将实现的。另一个接口将是内部的，将包含您的`Save()`和其他内部方法。也许这第二个接口甚至可以从第一个继承。然后，您自己的内部对象将实现这两​​个接口。这样，您甚至可以区分外部对象（没有内部接口的对象）和内部对象。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-12-15T10:23:37.933

创建另一个内部接口，并为该方法使用显式实现。

```
internal interface InternalIAM
{
    void Save();
}

public class concreteIAM : InternalIAM
{
    void InternalIAM.Save()
    {
    }
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-15T14:15:10.883

我认为最好的办法是将内部成员和公共成员分成两个独立的接口。如果您继承接口，您仍然可以公开声明成员，但内部成员的可见性将由接口本身的可见性决定。

```
using System;

public interface IPublic
{
    void Public();
}

internal interface IInternal : IPublic
{
    void Internal();
}

public class Concrete : IInternal
{
    public void Internal() { }

    public void Public() { }
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-15T04:18:05.860

我认为您不应该在这里使用界面。也许您应该使用抽象基础，例如：

```
public abstract class AM
{
    public int ID { get; set; }
    internal abstract void Save();
}

public class concreteIAM : AM
{
    internal override void Save()
    {
        //Do some save stuff
    }
} 
```

仍然允许您这样做：

```
public class AMList : List<AM>
{
    public void SaveItems()
    {
        foreach (var item in this)
        {
            item.Save();
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-06-21T19:35:21.627

这正是我在我的文章[Friends and internal interface members at no cost with coding to interfaces](http://www.codeproject.com/Articles/403679/Friends-and-internal-interface-members-at-no-cost)中所说的。

文章的精华

```
public class Internal
{
    internal Internal() { }
}

public interface IAM
{
    int ID { get; set; }
    void Save(Internal access);
} 
```

从现在开始，只有您的程序集可以调用该`Save()`方法，因为`Internal`类的实例只能由您的程序集创建。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-15T05:01:57.800

如果您不希望外部调用者能够调用您的 Save() 方法，为什么不将整个具体IAM 类设为内部？

或者，如果您希望类公开，而不是接口，则将整个接口设为内部。我认为可以将内部接口添加到公共类中（但我没有尝试过...）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-15T05:16:31.470

也许您想将项目的保存分离到您的程序集内部的一组不同的类中：

```
internal interface IAMSaver { void Save(IAM item); }

internal class AMSaverFactory {
  IAMSaver GetSaver(Type itemType) { ... }
}

public class MyList : List<IAM>
{
  public void Save()
  {
    foreach (IAM itemin this)
    {
      IAMSaver saver = SaverFactory.GetSaver(item.GetType());
      saver.Save(item)
    }
  }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-15T05:31:25.900

接口成员应该是公开的......其他任何东西，你应该考虑是否需要其他东西。在这种情况下，您

*   希望保存成为界面成员
*   希望 Save 仅允许通过位于同一程序集中的另一个名为 MyList 的类
*   禁止 Save 被外部调用（从父程序集之外的其他类）

抛开设计思想，您可以通过显式接口实现来做到这一点。

```
 internal interface IPersist
    {
        void Save();
    }
    public class Concrete : IPersist
    {
        void IPersist.Save()
        {
            Console.WriteLine("Yeah!");
        }
    }

// Mylist.cs in the same assembly can still call save like
public void SaveItems()
    {
        foreach (IPersist item in this)
        {
            item.Save();
        }
    } 
```

IPersist 是内部的，在父程序集之外不可用，并且由于它是显式实现的，因此如果没有 IPersist 引用就无法调用它。

```
new Concrete().Save();     // doesn't compile. 'Concrete' does not contain a definition for 'Save' 
```

**更新**根据您的最新回复，我们有更多限制。接口必须是公共的，它应该包含 Save 方法，它不应该是公开的。我会说回到绘图板......似乎有些不对劲。恕我直言，您不能使用单个界面执行此操作。拆分成两个接口，公共接口和内部接口怎么样？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-15T10:04:10.700

使用两个接口：

```
public interface IAM
{
        int ID { get; set; }
}

internal interface IAMSavable
{
        void Save();
}

public class concreteIAM : IAM, IAMSavable
{
         public int ID{get;set;}
         public void IAMSavable.Save(){
         //save the object
         }

        //other staff for this particular class
}

public class MyList : List<IAM>
{
        public void Save()
        {
                foreach (IAM iam in this)
                {
                        ((IAMSavable)iam).Save();
                }
        }

        //other staff for this particular class
} 
```

Save() 的实现必须明确以防止客户端调用它。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-15T10:07:39.930

为什么不使用内部类来控制方法的可访问性？

例子：

**您的主要装配体**

```
public abstract class Item
{
    public int ID { get; set; }
    protected abstract void Save();

    public class ItemCollection : List<Item>
    {
        public void Save()
        {
            foreach (Item item in this) item.Save();
        }
    }
} 
```

**您的二次装配**

```
public sealed class NiceItem : Item
{
    protected override void Save()
    {
        // do something
    }
} 
```

这种模式仍然允许您`Save()`在其他程序集中实现方法，但只有`ItemCollection`内部类`Item`可以调用它。很棒，不是吗？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-06-28T17:15:37.870

那这个呢？

```
public interface IAM
{
    int ID { get; set; }
    internal void Save();
}

public class concreteIAM : IAM
{
     public int ID { get; set; }
     void IAMSavable.Save() {
         //save the object
     }
} 
```

您可以将接口的成员声明为内部的，但是当您在类中实现它时，您只有两个选择：将其声明为公共或显式接口实现。通过将其实现为显式接口实现，如示例代码中所做的那样，`Save()`只能通过强制转换`concreteIAM`为访问`IAM`，因此`Save()`变为有效`internal`。

[这在概念上与此答案](https://stackoverflow.com/a/367913/4313030)中提出的解决方案非常相似，但是无需声明第二个接口。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-10-22T17:24:43.663

我有类似的情况，并认为这会有所帮助。（不确定此时是否不需要）

这对我来说是一个合法的案例：假设有一个接口具有一些在 DLL 内部的 API，并且可以从 DLL 外部访问一些 API。由于接口是一个抽象类，因此您可以定义为抽象类，而不是定义为接口。

```
using System.Collections.Generic;

public abstract class IAM
{
    int ID { get; set; }
    internal abstract void Save();
}

public class concreteIAM : IAM
{
    public int ID { get; set; }
    internal override void Save()
    {
        //save the object
    }

    //other staff for this particular class
}

public class MyList : List<IAM>
{
     internal void Save()
    {
        foreach (IAM iam in this)
        {
            iam.Save();
        }
    }

    //other staff for this particular class
} 
```

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2012-01-11T17:12:44.730

我在这里想知道同样的问题，偶然发现了这个问题......

当我想到这一点时，我明白我首先不需要接口中的*内部*方法。

我可以通过我的具体类访问它，并将合同留给外部代码。

在您的示例中：

```
 public interface IAM
    {
            int ID { get; set; }
    }

    public class concreteIAM : IAM
    {
             public int ID{get;set;}
             internal void Save(){
             //save the object
             }

            //other staff for this particular class
    }

    public class MyList : List<IAM>
    {
            public void Save()
            {
                    foreach (concreteIAM iam in this)
                    {
                            iam.Save();
                    }
            }
            //other staff for this particular class
    } 
```

# javascript - 在服务尚不存在时测试 REST Web 服务客户端

> ID：367459
> 
> 赞同：2
> 
> 时间：2008-12-15T04:15:16.990
> 
> 标签：javascript, rest

我已经阅读了帖子[链接文本](https://stackoverflow.com/questions/203495/testing-rest-webservices "这里")和[链接文本](https://stackoverflow.com/questions/303911/rest-tools-support-for-development-and-testing "这里")，但这些内容涵盖了在服务器上构建 REST 服务并需要快速客户端来测试这些服务的用例。

我们遇到了相反的问题，我们正在构建一个 Web 客户端，它将通过 REST 与服务器通信，但是已经决定让客户端驱动服务器上的服务格式，这意味着首先实现客户端，然后服务器上的服务第二。

我正在尝试寻找一种工具，它可以让我非常快速地启动 REST Web 服务，然后可以对客户端进行测试。有效地模拟服务器。

有人知道这样的工具吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T06:56:52.000

取决于您的 REST 服务将如何实际返回数据。您应该能够抽象所有服务调用，然后模拟 JSON 响应 - 随机旋转响应应该非常简单。

您可以做的另一件事是将几个结果文档放在服务器上（如上），并通过随机更改请求的服务 URL 从客户端轮换它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T14:13:52.587

[Charles](http://www.charlesproxy.com/)是一个用 Java 编写的多平台代理，它可以代理浏览器或您拥有的任何网络客户端。

如果需要，您可以将 URL 分配给文件甚至目录，或者您可以将会话记录到磁盘并稍后播放——我们一直使用它来模拟不完整或无法访问（例如，防火墙严重）的服务器。

它也是一个非常好的调试工具，因为它允许检查 HTTP 的所有细节。

PS：不隶属于他们，只是一个快乐的用户。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-10T16:18:18.820

您可以使用 jQuery.fixture 插件，它是 JavascriptMVC 框架的一部分，但也可以用作独立组件。它提供了一种非常强大的方法，通过拦截 ajax 请求来模拟尚未实现的 REST 服务。

要了解更多信息，请访问：[http ://www.javascriptmvc.com/docs.html#!jQuery.fixture](http://www.javascriptmvc.com/docs.html#!jQuery.fixture)

享受 ：）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-16T22:24:18.020

如果您在 Microsoft 世界，那么我会看看 WCF REST 入门工具包中的 Microsoft.Http 库。有一个 Microsoft.Http.Test 项目，其中有很多关于如何通过在 HttpClient 处理管道中添加存根阶段或在 HttpListener 之上构建虚拟服务器来存根 http 请求的示例。

HttpListener 是一个很棒的 .Net 框架类，它允许您用几行代码构建一个正在运行的 Web 服务器。与 Microsoft.Http 库一起，您可以生成一个很容易返回虚假结果的服务器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-21T15:42:48.300

简单 - 使用 Eviware 的 SoapUI（免费）来模拟您的服务。

它具有“模拟”服务的内置概念，您可以在其中定义端点并让该端点以逼真的数据响应请求。一旦定义了模拟服务，就可以启动并愉快地坐在那里响应来自客户的请求。您甚至可以以编程方式控制它，并让它根据请求发回不同的响应。

服务模拟的在线教程在[这里](http://www.soapui.org/Getting-Started/mock-services.html)非常好。

如果您的应用程序有 WADL 或 WSDL 可以使用会更容易，但没有这些只是意味着您必须付出一些额外的努力来创建您的初始 Mock 服务。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T04:41:55.440

您可以创建一个结果文档并将其放在 Web 服务器上。然后将 REST URL 指向该文档。无论您输入什么，输出始终是预先格式化的结果。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-16T22:14:55.927

考虑使用外观设计模式，然后简单地为“模拟模式”添加配置值。然后，您可以使用模拟模式创建整个客户端。然后，当服务器准备就绪时，更新 Facade 以使用新服务器。

我已经用几个项目做到了这一点，并且取得了巨大的成功。特别是在大型企业应用程序中，一些小服务可能会出现故障，但系统的其余部分应该继续运行。只需让外观向用户发出“模拟模式”警告，以便他们知道结果可能不是真实的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-03-30T02:50:49.067

我一直在处理同样的问题。我还没有找到一个下降工具来做到这一点。我真的希望 SoapUI 能够成功，但是在广泛使用它之后，我发现他们的 REST 支持，尤其是在 Mock REST 服务方面，非常缺乏。

我能想到的最好的办法是构建一个简单的网络服务器并使用过滤器根据 url 将用户发送到不同的资源。这对于静态响应来说很好而且很花哨，但是如果我希望调用出错或显示一些不同的响应数据怎么办。我想要类似于 SoapUI 对模拟 SOAP 服务所做的事情，您可以在其中运行一个查看数据并依赖于数据的脚本，使用不同的 SOAP 响应。有人知道这样的工具吗？SoapUI 的路线图中计划对 REST 提供更多支持，但我猜在不久的将来不会。

# python - 使用 Django 为抽象基类设置外键

> ID：367461
> 
> 赞同：32
> 
> 时间：2008-12-15T04:16:33.227
> 
> 标签：python, django, inheritance, django-models

我已经将两个类的公共属性分解为一个抽象基类，但是我有另一个模型需要引用这些类中的任何一个。不可能引用 ABC，因为它实际上没有数据库表。

以下示例应说明我的问题：

```
class Answer(models.Model):
    ovramt = models.ForeignKey("Ovramt")
    question = models.ForeignKey("Question")
    answer = models.CharField(max_length=3, choices=(("yes","yes"),("no","no") ("NA","N/A"))
    likelihood = models.IntegerField(choices=LIKELY_CHOICES)
    consequence = models.IntegerField(choices=CONSEQUENCE_CHOICES)

    class Meta:
        abstract = True

class Answer_A(Answer):
    resident = models.ForeignKey("Resident")
    def __unicode__(self):
        return u"%s - %s - %s" %(self.ovramt.ssa.name, self.resident, self.question)    

class Answer_B(Answer):
    def __unicode__(self):
        return u"%s - %s" %(self.ovramt.ssa.name, self.question)    

class Answer_Risk(models.Model):
    answer = models.ForeignKey("Answer")
    risk = models.CharField(max_length=200)

    def __unicode__(self):
        return self.risk 
```

Answer_A 和 Answer_B 略有不同，因为 Answer_A 还需要与另一个表的 FK 关系。Answer_B 以后可能还需要一些特定的属性。如果我让 Answer_B 成为超类 - 并且拥有 Answer_A 子类或组合它，问题仍然存在。

无论是 Answer_A 还是 Answer_B，“风险”都是相同的。我还有其他模型需要引用“答案”，无论其子类型如何。如何才能做到这一点？不管它的子类型如何，你如何引用一个类型？

更新：
我试图避免加入操作，但我认为我做不到。是否值得在所有“答案”中引用“居民”并在需要时将其取消？或者这被认为是非常糟糕的做法？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-15T08:24:54.443

通用[关系](https://docs.djangoproject.com/en/dev/ref/contrib/contenttypes/#generic-relations)似乎是解决方案。但这会使事情变得更加复杂。

在我看来; 您的模型结构已经比必要的复杂。我会简单地将所有三个`Answer`模型合并为一个。这边走：

*   `Answer_Risk`无需修改即可工作。
*   `resident`在`Answer_A`. _
*   您可以根据`resident == None`. （换句话说；相同的功能）

还有一件事; 你的答案可能有不止一种风险吗？如果他们没有风险或只有一种风险，您应该考虑以下替代实现：

*   使用[一对一的关系](http://docs.djangoproject.com/en/dev/topics/db/models/#one-to-one-relationships)
*   将风险降级为类内的一个字段（或任意数量的字段）`Answer`。

我主要关心的既不是数据库结构也不是性能（尽管这些更改应该会提高性能），而是*代码的可维护性*。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-15T04:33:46.470

我的直觉是建议删除基类上的抽象修饰符。您将获得相同的模型结构，但答案将是它自己的表。这样做的缺点是，如果这些表是大表和/或您的查询很复杂，则针对它的查询可能会明显变慢。

或者，您可以保持模型不变，但将 ForeignKey to Answer 替换为[GenericForeignKey](https://docs.djangoproject.com/en/dev/ref/contrib/contenttypes/#generic-relations)。你在模型继承的语法糖中失去了什么，你在查询速度上获得了一点。

我不相信可以通过 ForeignKey （或任何功能相同的东西）引用抽象基础模型。

# .net - 如何获取对象及其子对象的所有属性

> ID：367462
> 
> 赞同：0
> 
> 时间：2008-12-15T04:16:55.253
> 
> 标签：.net, reflection, propertydescriptor, customtypedescriptor

我有一个与此类似的问题，[除了](https://stackoverflow.com/questions/245055/how-do-you-get-the-all-properties-of-a-class-and-its-base-classes-up-the-hierar)我需要循环所有子对象并将属性更改为只读

请在下面检查我的代码。这一个循环仅主要对象。当我试图循环它的子对象时，我得到了溢出。

谢谢。

```
 Public Class ReadOnlyTypeDescriptor 
    Inherits CustomTypeDescriptor 
    Private mComponent As Object 

    Public Sub New(ByVal component As Object) 
        MyBase.New(TypeDescriptor.GetProvider(component).GetTypeDescriptor(component)) 
        mComponent = component 
    End Sub 

    Public Overloads Overrides Function GetProperties(ByVal attributes As Attribute()) As PropertyDescriptorCollection 
        Dim inPdc As PropertyDescriptorCollection = MyBase.GetProperties(attributes) 

        Dim pdcs As PropertyDescriptor() = New PropertyDescriptor(inPdc.Count - 1) {} 
        For i As Integer = 0 To pdcs.Length - 1 
            If inPdc(i).IsReadOnly Then 
                pdcs(i) = inPdc(i) 
            Else 
                pdcs(i) = New ReadOnlyPropertyDescriptor(inPdc(i)) 
            End If 
        Next 

        Return New PropertyDescriptorCollection(pdcs, True) 
    End Function 

    Public Overloads Overrides Function GetProperties() As PropertyDescriptorCollection 
        Return GetProperties(Nothing) 
    End Function 

    Private Class ReadOnlyPropertyDescriptor 
        Inherits PropertyDescriptor 
        Private mParent As PropertyDescriptor 

        Public Sub New(ByVal parent As PropertyDescriptor) 
            MyBase.New(parent, New Attribute() {ReadOnlyAttribute.Yes}) 
            mParent = parent 
        End Sub 

        Public Overloads Overrides Function CanResetValue(ByVal component As Object) As Boolean 
            Return False 
            ' Read Only 
        End Function 

        Public Overloads Overrides ReadOnly Property ComponentType() As Type 
            Get 
                Return mParent.ComponentType 
            End Get 
        End Property 

        Public Overloads Overrides Function GetValue(ByVal component As Object) As Object 
            Return mParent.GetValue(component) 
        End Function 

        Public Overloads Overrides ReadOnly Property IsReadOnly() As Boolean 
            Get 
                Return True 
            End Get 
        End Property 

        Public Overloads Overrides ReadOnly Property PropertyType() As Type 
            Get 
                Return mParent.PropertyType 
            End Get 
        End Property 

        Public Overloads Overrides Sub ResetValue(ByVal component As Object) 
            ' Read Only 
        End Sub 

        Public Overloads Overrides Sub SetValue(ByVal component As Object, ByVal value As Object) 
            ' Read Only 
        End Sub 

        Public Overloads Overrides Function ShouldSerializeValue(ByVal component As Object) As Boolean 
            Return mParent.ShouldSerializeValue(component) 
        End Function 
    End Class 
End Class 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T05:44:41.037

如果您有具有循环引用的对象，您可能会多次访问属性。

在这种情况下，我总是想办法“标记”我以前访问过的项目，这是遍历图形时常用的想法。

# java - 如何直接读取 JRE 发行版中包含的时区文件？

> ID：367467
> 
> 赞同：2
> 
> 时间：2008-12-15T04:21:50.767
> 
> 标签：java, timezone

Java 的时区信息保存在名为“zi”的文件夹中。例如。C:\Program Files\Java\jdk6\jre\lib\zi

此文件夹中的文件为二进制格式。但对我来说，确切地看到他们所说的话非常重要。

任何人都可以分享一种方法来阅读这些文件，还是它们是 Sun 专有的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T04:51:46.213

像几乎所有当前的操作系统和其他软件环境一样。Java 使用 zoneinfo 格式来获取时区信息。您可以从[Wikipedia](http://en.wikipedia.org/wiki/Zoneinfo)页面开始，或者只使用 Google 搜索 zoneinfo。

有许多工具可以处理 zoneinfo 文件，您应该能够提取您要查找的信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T07:33:48.837

您将在此处找到使用[tzupdater](http://java.sun.com/javase/tzupdater_README.html)工具的[zoneinfo 更新过程的一个很好的示例。](http://seer.entsupport.symantec.com/docs/301500.htm)

注意不同版本的jdk包含[不同版本](http://java.sun.com/javase/timezones/tzdata_versions.html)的Olson时区数据，涉及到不同版本的[tzupdater工具](http://java.sun.com/javase/downloads/index.jsp#timezone)。

Java 有自己的时区[格式](http://www.velocityreviews.com/forums/t149712-java-time-zones.html)。

# iphone - 修复了 UIPickerView 选择栏中的标签

> ID：367471
> 
> 赞同：34
> 
> 时间：2008-12-15T04:26:16.703
> 
> 标签：iphone, cocoa-touch, uipickerview

在时钟应用程序中，计时器屏幕显示一个选择器（可能是`UIPicker`在`UIDatePickerModeCountDownTimer`模式下），在选择栏中带有一些文本（在本例中为“小时”和“分钟”）。

(edit) Note that these labels are **fixed** : They don't move when the picker wheel is rolling.

有没有办法在标准`UIPickerView`组件的选择栏中显示这样的固定标签？

我没有找到任何有助于解决此问题的 API。一个建议是添加 a`UILabel`作为选择器的子视图，但这不起作用。

* * *

**回答**

我听从了 Ed Marty 的建议（下面的答案），它奏效了！不完美，但它应该愚弄人们。作为参考，这是我的实现，请随时改进...

```
- (void)viewDidLoad {
    // Add pickerView
    self.pickerView = [[UIPickerView alloc] initWithFrame:CGRectZero];
    [pickerView release];
    CGSize pickerSize = [pickerView sizeThatFits:CGSizeZero];
    CGRect screenRect = [[UIScreen mainScreen] applicationFrame];
    #define toolbarHeight           40.0
    CGFloat pickerTop = screenRect.size.height - toolbarHeight - pickerSize.height;
    CGRect pickerRect = CGRectMake(0.0, pickerTop, pickerSize.width, pickerSize.height);
    pickerView.frame = pickerRect;

    // Add label on top of pickerView
    CGFloat top = pickerTop + 2;
    CGFloat height = pickerSize.height - 2;
    [self addPickerLabel:@"x" rightX:123.0 top:top height:height];
    [self addPickerLabel:@"y" rightX:183.0 top:top height:height];
    //...
}

- (void)addPickerLabel:(NSString *)labelString rightX:(CGFloat)rightX top:(CGFloat)top height:(CGFloat)height {
#define PICKER_LABEL_FONT_SIZE 18
#define PICKER_LABEL_ALPHA 0.7
    UIFont *font = [UIFont boldSystemFontOfSize:PICKER_LABEL_FONT_SIZE];
    CGFloat x = rightX - [labelString sizeWithFont:font].width;

    // White label 1 pixel below, to simulate embossing.
    UILabel *label = [[UILabel alloc] initWithFrame:CGRectMake(x, top + 1, rightX, height)];
    label.text = labelString;
    label.font = font;
    label.textColor = [UIColor whiteColor];
    label.backgroundColor = [UIColor clearColor];
    label.opaque = NO;
    label.alpha = PICKER_LABEL_ALPHA;
    [self.view addSubview:label];
    [label release];

    // Actual label.
    label = [[UILabel alloc] initWithFrame:CGRectMake(x, top, rightX, height)];
    label.text = labelString;
    label.font = font;
    label.backgroundColor = [UIColor clearColor];
    label.opaque = NO;
    label.alpha = PICKER_LABEL_ALPHA;
    [self.view addSubview:label];
    [label release];
} 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-05T20:38:12.127

创建您的选择器，创建一个带有阴影的标签，然后将其推送到 selectionIndicator 视图下方的选择器子视图。

它看起来像这样

```
 UILabel *label = [[[UILabel alloc] initWithFrame:CGRectMake(135, 93, 80, 30)] autorelease];
label.text = @"Label";
label.font = [UIFont boldSystemFontOfSize:20];
label.backgroundColor = [UIColor clearColor];
label.shadowColor = [UIColor whiteColor];
label.shadowOffset = CGSizeMake (0,1);
[picker insertSubview:label aboveSubview:[picker.subviews objectAtIndex:5]]; 
//When you have multiple components (sections)...
//you will need to find which subview you need to actually get under
//so experiment with that 'objectAtIndex:5'
//
//you can do something like the following to find the view to get on top of
// define @class UIPickerTable;
// NSMutableArray *tables = [[NSMutableArray alloc] init];
// for (id i in picker.subviews) if([i isKindOfClass:[UIPickerTable class]]) [tables addObject:i];
// etc... 
```

-- 提前付款

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-05-29T18:43:34.010

`UIPickerView`几年前，我已经将 dizy 的答案变成了一个类别。刚刚验证它仍然适用于 iOS SDK 4.3，并在此处发布。它允许您添加一个标签（XX 小时）并对这个标签进行动画更改（例如 1 小时 -> 3 小时），就像这样`UIDatePicker`做一样。

```
// UIPickerView_SelectionBarLabelSupport.h
//
// This file adds a new API to UIPickerView that allows to easily recreate
// the look and feel of UIDatePicker labeled components.
//
// Copyright (c) 2009, Andrey Tarantsov <andreyvit@gmail.com>
//
// Permission to use, copy, modify, and/or distribute this software for any
// purpose with or without fee is hereby granted, provided that the above
// copyright notice and this permission notice appear in all copies.
//
// THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
// WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
// ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
// WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
// ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
// OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

#import <Foundation/Foundation.h>

// useful constants for your font size-related code
#define kPickerViewDefaultTitleFontSize 20.0f
#define kDatePickerTitleFontSize 25.0f
#define kDatePickerLabelFontSize 21.0f

@interface UIPickerView (SelectionBarLabelSupport)

// The primary API to add a label to the given component.
// If you want to match the look of UIDatePicker, use 21pt as pointSize and 25pt as the font size of your content views (titlePointSize).
// (Note that UIPickerView defaults to 20pt items, so you need to use custom views. See a helper method below.)
// Repeated calls will change the label with an animation effect similar to UIDatePicker's one.
//
// To call this method on viewDidLoad, please call [pickerView layoutSubviews] first so that all subviews
// get created.
- (void)addLabel:(NSString *)label ofSize:(CGFloat)pointSize toComponent:(NSInteger)component leftAlignedAt:(CGFloat)offset baselineAlignedWithFontOfSize:(CGFloat)titlePointSize;

// A helper method for your delegate's "pickerView:viewForRow:forComponent:reusingView:".
// Creates a propertly positioned right-aligned label of the given size, and also handles reuse.
// The actual UILabel is a child of the returned view, use [returnedView viewWithTag:1] to retrieve the label.
- (UIView *)viewForShadedLabelWithText:(NSString *)label ofSize:(CGFloat)pointSize forComponent:(NSInteger)component rightAlignedAt:(CGFloat)offset reusingView:(UIView *)view;

// Creates a shaded label of the given size, looking similar to the labels used by UIPickerView/UIDatePicker.
- (UILabel *)shadedLabelWithText:(NSString *)label ofSize:(CGFloat)pointSize;

@end 
```

和实施：

```
// UIPickerView_SelectionBarLabelSupport.m
//
// This file adds a new API to UIPickerView that allows to easily recreate
// the look and feel of UIDatePicker labeled components.
//
// Copyright (c) 2009, Andrey Tarantsov <andreyvit@gmail.com>
//
// Permission to use, copy, modify, and/or distribute this software for any
// purpose with or without fee is hereby granted, provided that the above
// copyright notice and this permission notice appear in all copies.
//
// THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
// WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
// ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
// WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
// ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
// OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

#import "UIPickerView_SelectionBarLabelSupport.h"

// used to find existing component labels among UIPicker's children
#define kMagicTag 89464534
// a private UIKit implementation detail, but we do degrade gracefully in case it stops working
#define kSelectionBarClassName @"_UIPickerViewSelectionBar"

// used to sort per-component selection bars in a left-to-right order
static NSInteger compareViews(UIView *a, UIView *b, void *context) {
    CGFloat ax = a.frame.origin.x, bx = b.frame.origin.x;
    if (ax < bx)
        return -1;
    else if (ax > bx)
        return 1;
    else
        return 0;
}

@implementation UIPickerView (SelectionBarLabelSupport)

- (UILabel *)shadedLabelWithText:(NSString *)label ofSize:(CGFloat)pointSize {
    UIFont *font = [UIFont boldSystemFontOfSize:pointSize];
    CGSize size = [label sizeWithFont:font];
    UILabel *labelView = [[[UILabel alloc] initWithFrame:CGRectMake(0, 0, size.width, size.height)] autorelease];
    labelView.font = font;
    labelView.adjustsFontSizeToFitWidth = NO;
    labelView.shadowOffset = CGSizeMake(1, 1);
    labelView.textColor = [UIColor blackColor];
    labelView.shadowColor = [UIColor whiteColor];
    labelView.opaque = NO;
    labelView.backgroundColor = [UIColor clearColor];
    labelView.text = label;
    labelView.userInteractionEnabled = NO;
    return labelView;
}

- (UIView *)viewForShadedLabelWithText:(NSString *)title ofSize:(CGFloat)pointSize forComponent:(NSInteger)component rightAlignedAt:(CGFloat)offset reusingView:(UIView *)view {
    UILabel *label;
    UIView *wrapper;
    if (view != nil) {
        wrapper = view;
        label = (UILabel *)[wrapper viewWithTag:1];
    } else {
        CGFloat width = [self.delegate pickerView:self widthForComponent:component];

        label = [self shadedLabelWithText:title ofSize:pointSize];
        CGSize size = label.frame.size;
        label.frame = CGRectMake(0, 0, offset, size.height);
        label.tag = 1;
        label.textAlignment = UITextAlignmentRight;
        label.autoresizingMask = UIViewAutoresizingFlexibleHeight;

        wrapper = [[[UIView alloc] initWithFrame:CGRectMake(0, 0, width, size.height)] autorelease];
        wrapper.autoresizesSubviews = NO;
        wrapper.userInteractionEnabled = NO;
        [wrapper addSubview:label];
    }
    label.text = title;
    return wrapper;
}

- (void)addLabel:(NSString *)label ofSize:(CGFloat)pointSize toComponent:(NSInteger)component leftAlignedAt:(CGFloat)offset baselineAlignedWithFontOfSize:(CGFloat)titlePointSize {
    NSParameterAssert(component < [self numberOfComponents]);

    NSInteger tag = kMagicTag + component;
    UILabel *oldLabel = (UILabel *) [self viewWithTag:tag];
    if (oldLabel != nil && [oldLabel.text isEqualToString:label])
        return;

    NSInteger n = [self numberOfComponents];
    CGFloat total = 0.0;
    for (int c = 0; c < component; c++)
        offset += [self.delegate pickerView:self widthForComponent:c];
    for (int c = 0; c < n; c++)
        total += [self.delegate pickerView:self widthForComponent:c];
    offset += (self.bounds.size.width - total) / 2;

    offset += 2 * component; // internal UIPicker metrics, measured on a screenshot
    offset += 4; // add a gap

    CGFloat baselineHeight = [@"X" sizeWithFont:[UIFont boldSystemFontOfSize:titlePointSize]].height;
    CGFloat labelHeight = [@"X" sizeWithFont:[UIFont boldSystemFontOfSize:pointSize]].height;

    UILabel *labelView = [self shadedLabelWithText:label ofSize:pointSize];
    labelView.frame = CGRectMake(offset,
                                 (self.bounds.size.height - baselineHeight) / 2 + (baselineHeight - labelHeight) - 1,
                                 labelView.frame.size.width,
                                 labelView.frame.size.height);
    labelView.tag = tag;

    UIView *selectionBarView = nil;
    NSMutableArray *selectionBars = [NSMutableArray array];
    for (UIView *subview in self.subviews) {
        if ([[[subview class] description] isEqualToString:kSelectionBarClassName])
            [selectionBars addObject:subview];
    }
    if ([selectionBars count] == n) {
        [selectionBars sortUsingFunction:compareViews context:NULL];
        selectionBarView = [selectionBars objectAtIndex:component];
    }
    if (oldLabel != nil) {
        [UIView beginAnimations:nil context:oldLabel];
        [UIView setAnimationDuration:0.25];
        [UIView setAnimationDelegate:self];
        [UIView setAnimationDidStopSelector:@selector(YS_barLabelHideAnimationDidStop:finished:context:)];
        oldLabel.alpha = 0.0f;
        [UIView commitAnimations];
    }
    // if the selection bar hack stops working, degrade to using 60% alpha
    CGFloat normalAlpha = (selectionBarView == nil ? 0.6f : 1.0f);
    if (selectionBarView != nil)
        [self insertSubview:labelView aboveSubview:selectionBarView];
    else
        [self addSubview:labelView];
    if (oldLabel != nil) {
        labelView.alpha = 0.0f;
        [UIView beginAnimations:nil context:oldLabel];
        [UIView setAnimationDuration:0.25];
        [UIView setAnimationDelay:0.25];
        labelView.alpha = normalAlpha;
        [UIView commitAnimations];
    } else {
        labelView.alpha = normalAlpha;
    }
}

- (void)YS_barLabelHideAnimationDidStop:(NSString *)animationID finished:(NSNumber *)finished context:(UIView *)oldLabel {
    [oldLabel removeFromSuperview];
}

@end 
```

使用示例（在视图控制器中）：

```
- (void)updateFloorLabel {
    NSInteger floor = [self.pickerView numberOfRowsInComponent:0] - [self.pickerView selectedRowInComponent:0];
    NSString *suffix = @"th";
    if (((floor % 100) / 10) != 1) {
        switch (floor % 10) {
            case 1:  suffix = @"st"; break;
            case 2:  suffix = @"nd"; break;
            case 3:  suffix = @"rd"; break;
        }
    }
    [self.pickerView addLabel:[NSString stringWithFormat:@"%@ Floor", suffix]
                       ofSize:21
                  toComponent:0
                leftAlignedAt:50
baselineAlignedWithFontOfSize:25];    
}

- (void)viewDidLoad {
  ...
  [self.pickerView layoutSubviews];
  [self updateFloorLabel];
  ...
}

- (UIView *)pickerView:(UIPickerView *)pickerView viewForRow:(NSInteger)row forComponent:(NSInteger)component reusingView:(UIView *)view {
    NSString *s = [NSString stringWithFormat:@"%d", [pickerView numberOfRowsInComponent:0] - row];
    return [pickerView viewForShadedLabelWithText:s ofSize:25 forComponent:0 rightAlignedAt:46 reusingView:view];
}

- (void)pickerView:(UIPickerView *)pickerView didSelectRow:(NSInteger)row inComponent:(NSInteger)component {
    [self updateFloorLabel];
} 
```

享受！

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-04-13T21:20:00.783

假设我们要实现一个选择距离的选择器视图，有2列，一列距离，一列单位，即km。然后我们希望修复第二列。我们可以通过一些委托方法来实现。

```
- (NSString*)pickerView:(UIPickerView *)pickerView titleForRow:(NSInteger)row forComponent:(NSInteger)component
{
    if (component == 0) {
        return self.distanceItems[row];
    }
    else {
        return @"km";
    }
}

-(NSInteger)numberOfComponentsInPickerView:(UIPickerView *)pickerView{
    return 2;
}

-(NSInteger)pickerView:(UIPickerView *)pickerView numberOfRowsInComponent:(NSInteger)component{
    if (component == 0) {
        return [self.distanceItems count];
    }
    else {
    // when it comes to the second column, only one row.
        return 1;
    }
} 
```

现在我们有了这个： ![在此处输入图像描述](https://i.stack.imgur.com/Ksjhk.png)

我想这是最简单的方法。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-15T08:23:31.077

你可以做两件事：

如果每一行和每一行中的组件都是一个简单的文本，那么您可以简单地使用默认的 UIPickerView 实现，并在您的控制器中实现以下`UIPickerViewDelegate`方法：

*   `- (void)pickerView:(UIPickerView *)pickerView didSelectRow:(NSInteger)row inComponent:(NSInteger)component`跟踪选择了哪一行

*   并在您的实施中为所选行返回不同的文本`- (NSString *)pickerView:(UIPickerView *)pickerView titleForRow:(NSInteger)row forComponent:(NSInteger)component`

如果您需要将文本以外的其他内容作为所选行的差异化因素，那么您基本上需要创建自己`CustomPickerView`的内容`UIPickerView`，然后

*   首先实现`- (void)selectRow:(NSInteger)row inComponent:(NSInteger)component animated:(BOOL)animated`并跟踪选择了哪一行。

*   然后实现`- (UIView *)viewForRow:(NSInteger)row forComponent:(NSInteger)component`为所选行生成不同的视图。

SDK 中提供了使用 UIPickerView 或实现自定义 UIPickerView 的示例，称为 UICatalog。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-11-07T18:31:54.250

我收到了一个在 iOS 7 中对我的问题运行良好的答案[，](https://stackoverflow.com/questions/19825688/ios7-uipickerview-non-selected-row-curvature-modification-multiple-components)这是一个非常酷的[技巧](https://stackoverflow.com/a/19826463/463059)。

这个想法是创建多个组件，并且对于那些标签组件，指定它是单行。对于某些人的浮雕外观，您可以使用委托方法返回 NSAttributedStrings：

`- (NSAttributedString *)pickerView:(UIPickerView *)pickerView attributedTitleForRow:(NSInteger)row forComponent:(NSInteger)component`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-06T20:29:53.483

与其在 UIPickerView 中添加标签，不如将其粘贴在其顶部，作为与其重叠的兄弟。唯一有问题的是如何获得相同的字体。我不知道如何获得那种浮雕外观，但也许其他人会这样做，在这种情况下，这根本不是问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-06T11:11:03.040

要重新创建标签的浮雕外观...只需使用文本创建图像，以便您可以轻松地将非常相似的效果应用于文本...然后使用 UIImageViews 而不是标签

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-09-03T12:59:49.553

我也面临同样的问题。您可以在我在 GitHub 上发布的自定义时间选择器中看到工作示例：
[https](https://github.com/kgadzinowski/iOSSecondsTimerPicker)
://github.com/kgadzinowski/iOSSecondsTimerPicker 它完全符合您的要求。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-13T23:30:36.943

你能展示你定义pickerTop和pickerSize的地方吗？

```
 CGFloat pickerTop = timePicker.bounds.origin.y;
CGSize pickerSize = timePicker.bounds.size; 
```

这就是我所拥有的，但 pickerTop 似乎是错误的。

麦克风

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-03-29T11:17:10.117

这里解释了浮雕：[Adding Emboss to a UILabel in a navigationItem.titleView (as seen with navigationItem.title)](https://stackoverflow.com/questions/753822/adding-emboss-to-a-uilabel-in-a-navigationitem-titleview-as-seen-with-navigation)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-05-27T00:51:29.787

请注意，xib 编辑器也允许添加子视图，因此您可以避免使用过多的编码和尺寸猜测。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-02-22T16:10:38.963

水平对齐多个选择器，它们之间没有空格，并关闭静态列的用户交互。

在每个选取器上设置一个标签，以确定哪个是数据源调用中的选取器视图。静态列的行数显然为 1。

这也可以更好地控制宽度和位置。

# c++ - 在 switch 语句中使用常量数组的元素作为 case

> ID：367494
> 
> 赞同：6
> 
> 时间：2008-12-15T04:42:05.593
> 
> 标签：c++, arrays, syntax, constants, switch-statement

我正在尝试将一组按键映射到一组命令。因为我从多个地方处理命令，所以我想在键和命令之间设置一个抽象层，这样如果我更改底层键映射，我就不必更改太多代码。我目前的尝试如下所示：

```
// input.h
enum LOGICAL_KEYS {
    DO_SOMETHING_KEY,
    DO_SOMETHING_ELSE_KEY,
    ...
    countof_LOGICAL_KEYS
};

static const SDLKey LogicalMappings[countof_LOGICAL_KEYS] = {
    SDLK_RETURN,    // Do Something
    SDLK_ESCAPE,    // Do Something Else
    ...
};

// some_other_file.cpp
...
switch( event.key.keysym.key ) {
    case LogicalMappings[ DO_SOMETHING_KEY ]:
        doSomething();
        break;
    case LogicalMappings[ DO_SOMETHING_ELSE_KEY ]:
        doSomethingElse();
        break;
    ...
} 
```

当我尝试编译它（gcc 4.3.2）时，我收到错误消息：

> 错误：“LogicalMappings”不能出现在常量表达式中

我不明白为什么编译器有这个问题。我理解为什么不允许在 case 语句中包含变量，但我的印象是您可以使用常量，因为它们可以在编译时进行评估。常量数组不能与 switch 语句一起使用吗？如果是这样，我想我可以用类似的东西替换数组：

```
static const SDLKey LOGICAL_MAPPING_DO_SOMETHING      = SDLK_RETURN;
static const SDLKey LOGICAL_MAPPING_DO_SOMETHING_ELSE = SDLK_ESCAPE;
... 
```

但这似乎不那么优雅。有人知道为什么你不能在这里使用常量数组吗？

编辑：我已经看到 C++ 标准中声称“一个整数常量表达式只能涉及文字（2.13）、枚举器、常量变量或整数或枚举类型的静态数据成员用常量表达式初始化（​​8.5） ……”。我仍然不明白为什么常量数组不能算作“用常量表达式初始化的枚举类型”。可能只是我的问题的答案是“因为它就是这样”，我将不得不解决它。但如果是这样的话，那就有点令人失望了，因为编译器确实*可以*在编译时确定这些值。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T05:14:03.860

参考 C++ 标准的部分：6.4.2 要求 case 表达式计算为整数或枚举常量。5.19 定义了什么是：

> 一个整型常量表达式只能包含字面量 (2.13)、枚举数、常量变量或使用常量表达式初始化的整型或枚举类型的静态数据成员 (8.5)、整型或枚举类型的非类型模板参数，以及 sizeof 表达式。浮动文字 (2.13.3) 只有在转换为整数或枚举类型时才能出现。只能使用到整数或枚举类型的类型转换。特别是，除了 sizeof 表达式，不得使用函数、类对象、指针或引用，不得使用赋值、递增、递减、函数调用或逗号运算符。

因此，如果您的问题是“为什么编译器会拒绝这个”，那么一个答案是“因为标准是这样说的”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T05:12:57.357

无论如何，数组引用都不够“恒定”。

您只需要稍微不同地进行映射。您希望在按下逻辑键时发生相同的操作，因此在语句的`case`子句中使用逻辑键代码`switch`。然后将实际的关键代码映射到逻辑代码，可能在其`switch`本身中，或者可能在之前。您仍然可以使用 LogicalMappings 数组或类似的构造。而且，作为对 G11N（全球化）的辅助，您甚至可以使映射数组不恒定，以便不同的人可以重新映射键以满足他们的需要。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T05:11:49.403

我会在这里冒险，因为没有其他人对此做出回应，而且我最近大部分时间都在做 Java，而不是 C++，但据我记得，数组查找不被视为常量整数，即使结果查找可以在编译时确定。这甚至可能是语法中的一个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T06:03:02.780

boost 中有一个名为[signal](http://www.boost.org/doc/libs/1_37_0/doc/html/signals.html)的库，可以帮助您创建事件映射抽象。如果您有时间，这应该是更好的方法

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T14:33:12.763

您还可以使用函数指针或函子数组（我想函子地址），以完全避免 switch 语句，直接从数组索引-> 函数指针/函子开始。

例如（警告，未经测试的代码如下）

```
class Event // you probably have this defined already
{
}

class EventHandler // abstract base class
{
public:
  virtual void operator()(Event& e) = 0;
};

class EventHandler1
{
  virtual void operator()(Event& e){
    // do something here 
  }
};
class EventHandler2
{
  virtual void operator()(Event& e){
    // do something here 
  }
};

EventHandler1 ev1;
EventHandler2 ev2;
EventHandler *LogicalMappings[countof_LOGICAL_KEYS] = {
  &ev1,
  &ev2,
  // more here...

};

// time to use code:
Event event;
if (event.key.keysym.key < countof_LOGICAL_KEYS)
{
   EventHandler *p = LogicalMappings[event.key.keysym.key];
   if (p != NULL)
      (*p)(event);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T05:09:07.443

是否为“LogicalMappings”定义了比较运算符？如果不是，那就是错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-17T05:57:59.183

工作中的编译器大师向我解释了这一点。问题是数组本身是常量，但它的索引不一定是常量。因此，表达式 LogicalMappings[some_variable] 无法在编译时进行评估，因此该数组最终还是被存储在内存中，而不是被编译出来。编译器仍然没有理由不能使用 const 或文字索引静态评估数组引用，所以我想做的理论上应该是可能的，但它比我想象的要复杂一些，所以我可以理解为什么 gcc 不不要这样做。

# castle-activerecord - 为什么与 Ruby on Rails 相比，城堡 activerecord 中没有 hasOne 关系？

> ID：367495
> 
> 赞同：1
> 
> 时间：2008-12-15T04:42:33.957
> 
> 标签：castle-activerecord

或者我如何表示地址到国家/地区的映射，其中地址在城堡活动记录中只有一个国家？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T11:30:05.410

该`[BelongsTo]`属性用于一对一的关系。

[http://api.castleproject.org/html/T_Castle_ActiveRecord_BelongsToAttribute.htm](http://docs.castleproject.org/Active%20Record.Relations%20Mapping.ashx#BelongsTo_2)

# cocoa-touch - UIViewController 没有加载我的自定义 UIView

> ID：367518
> 
> 赞同：4
> 
> 时间：2008-12-15T05:07:05.730
> 
> 标签：cocoa-touch

对于大师来说，这应该是直截了当的。我没有真正写出任何代码，只有几个控制器和一个自定义 UIView。全部通过笔尖连接。该应用程序加载时不会崩溃，但我无法从自定义 UIView 中看到我的 NSLog() 命中。

我的应用程序委托有默认模板代码，它调用我的一个名为 TabAnimationController 的类。TabAnimationViewController 将其视图设置为 TabView。我确保在 TabAnimationViewController 的 NIB 中，文件的所有者设置为 TabAnimationViewController，并且我的 UIView 实例的类设置为 TabView。

在 TabView.m 中，我试图查看 NSLog 将如何命中，但它根本没有出现。

```
- (void)loadView {
 NSLog(@"calling loadView");
}

- (id)initWithFrame:(CGRect)frame {
NSLog(@"Calling initWithFrame:");
    return self;
} 
```

奇怪的。我不确定为什么即使在正确的 IB 连接之后我的 NSLog 也不会显示。只有任何放入 drawRect: 的东西才会调用。为什么 initWithFrame 或 loadView 没有被击中？如果我想以编程方式自定义此视图怎么办？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-15T07:20:01.920

首先，当视图从 nib 文件中脱水时`initWithFrame`，`initWithCoder`会调用 , 而不是 。所以你也需要实现你的初始化`initWithCoder`。`initWithFrame`（如果您期望以编程方式创建 TabView 而不是连接到 IB 中，那么保持初始化也是一个好主意。只需将您的初始化重构为另一个方法并从两个实现中调用它。）

同样在上面的初始化代码中，您必须始终调用超类的初始化。`init`所有自定义类在其实现中都使用了一个样板模式：

```
if (self = [super initXXX]) { do your initialization } 
return self; 
```

其次，`loadView`它实际上是一个`UIViewController`方法而不是一个方法，只有当控制器的出口为 nil 时`UIView`才会被调用。`view`

除非您使用控制器以编程方式自己编写视图，否则您不需要覆盖`loadView`. 相反，您应该`viewDidLoad`在视图加载后调用 override 来进行额外的初始化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T08:39:14.227

启动和运行它的最简单方法是在创建新项目时使用“基于视图的应用程序”模板。它设置了您开始所需的一切。

但是，简而言之，您正在寻找错误的方法。首先，除非您以编程方式创建视图，否则不应覆盖*loadView 。*如果它是从 XIB 文件加载的，请查看*initWithNibName*方法。

您可能还想查看被触发的*viewDidLoad*、*viewWillAppear*和*viewDidAppear*方法，好吧，什么时候触发是相当明显的！

# c# - 如何确保一个事件只订阅一次

> ID：367523
> 
> 赞同：50
> 
> 时间：2008-12-15T05:10:02.073
> 
> 标签：c#, events, event-handling, subscription

我想确保我只在特定类中为实例上的事件订阅一次。

例如，我希望能够执行以下操作：

```
if (*not already subscribed*)
{
    member.Event += new MemeberClass.Delegate(handler);
} 
```

我将如何实施这样的警卫？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2011-08-15T14:01:30.170

我在所有重复的问题中都添加了这个，只是为了记录。这种模式对我有用：

```
myClass.MyEvent -= MyHandler;
myClass.MyEvent += MyHandler; 
```

请注意，每次注册处理程序时都这样做将确保您的处理程序只注册一次。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-12-15T05:24:29.457

如果您正在谈论您有权访问其源的类上的事件，那么您可以将警卫放在事件定义中。

```
private bool _eventHasSubscribers = false;
private EventHandler<MyDelegateType> _myEvent;

public event EventHandler<MyDelegateType> MyEvent
{
   add 
   {
      if (_myEvent == null)
      {
         _myEvent += value;
      }
   }
   remove
   {
      _myEvent -= value;
   }
} 
```

这将确保只有一个订阅者可以订阅提供事件的类的这个实例上的事件。

**编辑**请查看为什么上面的代码是一个坏主意而不是线程安全的评论。

如果您的问题是客户端的单个实例多次订阅（并且您需要多个订阅者），那么客户端代码将需要处理该问题。所以更换

> *尚未订阅*

当您第一次订阅事件时，客户端类的 bool 成员会被设置。

**编辑（接受后）：**根据@Glen T（问题的提交者）的评论，他接受的解决方案的代码在客户端类中：

```
if (alreadySubscribedFlag)
{
    member.Event += new MemeberClass.Delegate(handler);
} 
```

其中 alreadySubscribedFlag 是客户端类中的一个成员变量，用于跟踪对特定事件的首次订阅。在这里查看第一个代码片段的人，请注意@Rune 的评论 - 以不明显的方式更改订阅事件的行为不是一个好主意。

**编辑 31/7/2009：**请参阅@Sam Saffron 的评论。正如我已经说过的，Sam 同意这里介绍的第一种方法不是修改事件订阅行为的明智方法。类的消费者需要了解其内部实现以了解其行为。不大好。
@Sam Saffron 还评论了线程安全。我假设他指的是可能的竞争条件，其中两个订阅者（接近）同时尝试订阅并且他们最终都可能订阅。可以使用锁来改善这一点。如果您打算更改事件订阅的工作方式，那么我建议您[阅读有关如何使订阅添加/删除属性线程安全](https://stackoverflow.com/questions/1037811/c-thread-safe-events)的信息。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-15T05:44:41.147

正如其他人所展示的，您可以覆盖事件的添加/删除属性。或者，您可能希望放弃该事件并简单地让该类在其构造函数（或其他方法）中将委托作为参数，而不是触发事件，而是调用提供的委托。

事件意味着任何人都可以订阅它们，而委托是您可以传递给类的*一种方法。*如果您只在真正想要它通常提供的一对多语义时才使用事件，那么对于您的库的用户来说可能就不那么令人惊讶了。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-04-20T16:40:27.703

您可以使用 Postsharper 只编写一个属性并在正常事件上使用它。重用代码。代码示例如下。

```
[Serializable]
public class PreventEventHookedTwiceAttribute: EventInterceptionAspect
{
    private readonly object _lockObject = new object();
    readonly List<Delegate> _delegates = new List<Delegate>();

    public override void OnAddHandler(EventInterceptionArgs args)
    {
        lock(_lockObject)
        {
            if(!_delegates.Contains(args.Handler))
            {
                _delegates.Add(args.Handler);
                args.ProceedAddHandler();
            }
        }
    }

    public override void OnRemoveHandler(EventInterceptionArgs args)
    {
        lock(_lockObject)
        {
            if(_delegates.Contains(args.Handler))
            {
                _delegates.Remove(args.Handler);
                args.ProceedRemoveHandler();
            }
        }
    }
} 
```

像这样使用它。

```
[PreventEventHookedTwice]
public static event Action<string> GoodEvent; 
```

有关详细信息，请查看[实现 Postsharp EventInterceptionAspect 以防止事件处理程序被钩住两次](https://stackoverflow.com/questions/10188203/implement-postsharp-eventinterceptionaspect-to-prevent-an-event-handler-hooked-t)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-15T05:23:48.600

您需要存储一个单独的标志来指示您是否订阅，或者，如果您可以控制 MemberClass，请提供事件的 add 和 remove 方法的实现：

```
class MemberClass
{
        private EventHandler _event;

        public event EventHandler Event
        {
            add
            {
                if( /* handler not already added */ )
                {
                    _event+= value;
                }
            }
            remove
            {
                _event-= value;
            }
        }
} 
```

要确定是否添加了处理程序，您需要比较 GetInvocationList() 返回的 _event 和 value 的 Delegates。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-07-30T19:17:19.980

我知道这是一个老问题，但当前的答案对我不起作用。

查看[C# 模式以防止事件处理程序被挂钩两次](https://stackoverflow.com/questions/937181/c-sharp-pattern-to-prevent-an-event-handler-hooked-twice)（标记为该问题的副本），给出更接近但仍然不起作用的答案，可能是因为多线程导致新事件对象不同，或者可能因为我使用的是自定义事件类。我最终得到了与上述问题的已接受答案类似的解决方案。

```
private EventHandler<bar> foo;
public event EventHandler<bar> Foo
{
    add
    {
        if (foo == null || 
            !foo.GetInvocationList().Select(il => il.Method).Contains(value.Method))
        {
            foo += value;
        }
    }

    remove
    {
        if (foo != null)
        {
            EventHandler<bar> eventMethod = (EventHandler<bar>)foo .GetInvocationList().FirstOrDefault(il => il.Method == value.Method);

            if (eventMethod != null)
            {
                foo -= eventMethod;
            }
        }
    }
} 
```

有了这个，您还必须使用`foo.Invoke(...)`而不是触发您的事件`Foo.Invoke(...)`。`System.Linq`如果您还没有使用它，您还需要包含它。

这个解决方案并不完全漂亮，但它确实有效。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-02-24T09:43:09.100

我最近这样做了，我就把它放在这里，这样它就可以保留：

```
private bool subscribed;

if(!subscribed)
{
    myClass.MyEvent += MyHandler;
    subscribed = true;
} 

private void MyHandler()
{
    // Do stuff
    myClass.MyEvent -= MyHandler;
    subscribed = false;
} 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2021-07-01T16:13:36.960

在 raise 时只调用不同的元素`GetInvocationList`：

```
using System.Linq;
....
public event HandlerType SomeEvent;
....
//Raising code
foreach (HandlerType d in (SomeEvent?.GetInvocationList().Distinct() ?? Enumerable.Empty<Delegate>()).ToArray())
     d.Invoke(sender, arg); 
```

示例单元测试：

```
class CA 
{
    public CA()
    { }
    public void Inc()
        => count++;
    public int count;
}
[TestMethod]
public void TestDistinctDelegates()
{
    var a = new CA();
    Action d0 = () => a.Inc();
    var d = d0;
    d += () => a.Inc();
    d += d0;
    d.Invoke();
    Assert.AreEqual(3, a.count);
    var l = d.GetInvocationList();
    Assert.AreEqual(3, l.Length);
    var distinct = l.Distinct().ToArray();
    Assert.AreEqual(2, distinct.Length);
    foreach (Action di in distinct)
        di.Invoke();
    Assert.AreEqual(3 + distinct.Length, a.count);
}
[TestMethod]
public void TestDistinctDelegates2()
{
    var a = new CA();
    Action d = a.Inc;
    d += a.Inc;
    d.Invoke();
    Assert.AreEqual(2, a.count);
    var distinct = d.GetInvocationList().Distinct().ToArray();
    Assert.AreEqual(1, distinct.Length);
    foreach (Action di in distinct)
        di.Invoke();
    Assert.AreEqual(3, a.count);
} 
```

# java - 在 Java 中：如何使用 Keystore 和 Truststore 证书握手安全连接？

> ID：367530
> 
> 赞同：2
> 
> 时间：2008-12-15T05:16:33.713
> 
> 标签：java, security, keystore, truststore

如果我有 2 个端子 A 和 B。TA 通过安全套接字连接连接 TB。我需要编写代码来实现两个终端之间的连接。

如何使用 Keystore 和 Truststore 握手这样的连接。换句话说，我在哪里放置密钥库/信任库证书文件？（TA或TB）

非常感谢任何好的建议或好的例子。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-15T05:53:53.530

[这是题为“使用 JSSE 进行安全套接字通信](https://www6.software.ibm.com/developerworks/education/j-jsse/j-jsse-ltr.pdf)”的 PDF 白皮书，它可能有助于回答您的问题，包括您的密钥库文件的配置。

# php - 获取对象的所有定义函数

> ID：367545
> 
> 赞同：6
> 
> 时间：2008-12-15T05:26:10.763
> 
> 标签：php, reflection, function

是否有[`get_defined_functions()`](http://www.php.net/manual/en/function.get-defined-functions.php)仅显示给定对象的功能的等效项？

示例用法和输出：

```
class A {
    function foo() { }
    function bar() { }
}
class B extends A {
    function foobar() { }
}
$b = new B();
print_r(get_object_functions($b));

// Array (
//  0 => "foo",
//  1 => "bar",
//  2 => "foobar"
//) 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-15T05:27:22.493

啊，我找到了：

[`get_class_methods()`](http://www.php.net/manual/en/function.get-class-methods.php)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T05:28:00.867

你可以用[`ReflectionClass`](https://php.net/manual/en/class.reflectionclass.php)...

# orm - VB6 的 ORM/MDA/UML 工具

> ID：367552
> 
> 赞同：1
> 
> 时间：2008-12-15T05:30:08.213
> 
> 标签：orm, vb6, uml, reverse-engineering, mda

我知道 Rational Rose，我们有 Rational Rose 6。

但是我正在寻找其他一些更有用的工具，它们不会抱怨它们没有在 Windows 98/2000 中运行（在 WinXP 中安装和运行时），并且与 Rational Rose 6 相比具有更好的功能。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T21:16:01.017

查看[Enterprise Architect](http://www.sparxsystems.com.au/products/ea/index.html)。它并不昂贵，而且很多事情都做得很好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T14:04:53.040

[这](http://www.sparxsystems.com.au/products/ea/features.html)列出了受支持的 Visual Basic（与 VB.Net 不同）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-26T22:29:13.930

Enterprise Architect 为 VB6 进行逆向工程和代码生成

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-16T13:01:09.970

我确实在 SpareX 的网站上查看了 Enterprise Architect，但找不到任何说明它处理 VB6 的逆向工程或代码生成的参考资料。

# c# - C# 通用设置向导

> ID：367556
> 
> 赞同：0
> 
> 时间：2008-12-15T05:35:27.217
> 
> 标签：c#, windows-installer

我的任务是创建一个程序，该程序将在指定文件夹中创建文件并基于这些文件创建安装程序。

例如，有一个文件夹用于“所有用户的桌面”、“开始菜单”、“应用程序数据”和“程序文件”

我的老板想将文件放入每个文件夹，然后单击一个按钮，它会自动构建安装程序。

我仅限于 VS2005 的默认安装中的内容。

我已经查看了设置项目/设置向导项目模板，但看起来它们必须专门为要用于安装它们的每个项目创建。

这在VS2005下可能吗？

**编辑：**

我喜欢这些建议，但我忘了说我们无法安装其他产品来提供帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-15T06:03:01.047

好吧，单独使用 C# 和 VS2005 会很困难。

但是您可以使用[WiX](http://wix.sourceforge.net/)，使用 c# 完成安装程序的 XML，并使用 wix-toolkit 中的蜡烛和光从您的工具构建它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T06:15:02.163

您可以看看 nant ( [http://nant.sourceforge.net/](http://nant.sourceforge.net/) ) 并考虑使用一些自定义任务： http: [//www.atalasoft.com/cs/blogs/jake/archive/2008/05/07/写作-自定义-nant-tasks.aspx](http://www.atalasoft.com/cs/blogs/jake/archive/2008/05/07/writing-custom-nant-tasks.aspx)。“自定义 nant 任务”的 google 获得了大约 800 次点击。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T09:52:07.357

我知道这完全违背了您的要求，但是根据您的使用情况，购买创建 Windows 安装程序的产品可能会效率高很多倍。安装程序软件做得更多，如果您现在构建功能有限的东西，那么您的老板可能会想要功能 X，然后是功能 Y，等等，您最终会以更大的成本和挫败感重新发明轮子。

# winforms - 很好的 DataGridView 教程

> ID：367559
> 
> 赞同：24
> 
> 时间：2008-12-15T05:38:25.950
> 
> 标签：winforms, datagridview

我正在编写一个 Windows C# 应用程序，我希望使用数据网格视图，但找不到一个很好的教程来完全控制数据网格，例如：添加列、添加数据等。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-04T00:20:41.927

我喜欢[这里提供的一些提示](http://www.dotnetperls.com/datagridview)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-04T00:16:17.067

你可以看看这里：http: [//msdn2.microsoft.com/en-us/library/k39d6s23.aspx](http://msdn2.microsoft.com/en-us/library/k39d6s23.aspx)

但最好的可能是： http: [//www.macoratti.net/08/08/c_pdgv1.htm](http://www.macoratti.net/08/08/c_pdgv1.htm) 我想你可以从代码中得到这个想法，因为评论是葡萄牙语（你可以尝试谷歌翻译）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T00:27:11.377

我强烈建议使用 MVC/P 模式在 Winforms 中实现 DataGridView - 从长远来看，它使生活变得更加轻松，尽管它可能看起来有很多工作要做。

[为 Winforms 项目选择 MVC/MVP 实现](http://rdn-consulting.com/blog/2008/02/01/selecting-a-mvcmvp-implementation-for-a-winforms-project/)

# python - 我应该对我的 python 函数/方法进行多少输入验证？

> ID：367560
> 
> 赞同：15
> 
> 时间：2008-12-15T05:39:52.467
> 
> 标签：python, validation

我感兴趣的是人们在他们编写的 Python 中做了多少预先验证。

以下是一些简单函数的示例：

```
def factorial(num):
    """Computes the factorial of num."""

def isPalindrome(inputStr):
    """Tests to see if inputStr is the same backwards and forwards."""

def sum(nums):
    """Same as the built-in sum()... computes the sum of all the numbers passed in.""" 
```

在开始计算之前，您检查输入值的程度如何？如何进行检查？如果输入错误（例如，在同一模块中定义的 BadInputException），您是否会抛出某种专有异常？您是否刚开始计算并认为如果传入了错误数据（例如“asd”到阶乘），它会在某个时候抛出异常？

当传入的值应该是容器时，您是否不仅检查容器，还检查容器中的所有值？

像阶乘这样的情况呢，传入的内容可能会转换为 int（例如浮点数），但这样做时您可能会失去精度？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-15T11:18:12.160

我`assert`什么是绝对必要的。

重要：什么是*绝对*必要的。有些人过度测试事物。

```
def factorial(num):
    assert int(num)
    assert num > 0 
```

不完全正确。long 也是一种合法的可能性。

```
def factorial(num):
    assert type(num) in ( int, long )
    assert num > 0 
```

更好，但仍然不完美。许多 Python 类型（如有理数或类似数字的对象）也可以在良好的阶乘函数中工作。很难断言一个对象具有基本的类似整数的属性，而不会过于具体并从考虑中排除未来未考虑的类。

我从不为个别功能定义独特的例外。我为重要的模块或包定义了一个独特的例外。然而，通常只是一个`Error`类或类似的东西。这样，应用程序`except somelibrary.Error,e:`就说明了您需要知道的所有内容。细粒度的异常变得挑剔和愚蠢。

我从来没有这样做过，但我可以看到可能需要的地方。

```
assert all( type(i) in (int,long) for i in someList ) 
```

然而，一般来说，普通的 Python 内置类型检查工作正常。他们发现几乎所有时间都重要的几乎所有异常情况。当某些东西不是正确的类型时，Python 会引发一个始终指向正确代码行的 TypeError。

顺便提一句。如果我绝对确定该功能会被滥用，我只会在设计时添加断言。当我有一个单元测试以一种模糊的方式失败时，我有时会添加断言。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-15T11:28:48.410

对于总和、阶乘等计算，python 内置的类型检查就可以了。计算最终会为这些类型调用**add**、**mul**等，如果它们中断，它们无论如何都会抛出正确的异常。通过执行您自己的检查，您可能会使其他工作输入无效。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-15T10:03:36.863

我正在尝试编写文档字符串来说明预期和接受的参数类型，并且我没有在我的函数中明确检查它。

如果有人想将我的功能与任何其他类型一起使用，他有责任检查他的类型是否模仿了我接受的足够好的类型。也许您的阶乘可以与一些自定义的 long-like 类型一起使用以获得您不会想到的东西？或者也许你的总和可以用来连接字符串？为什么要通过类型检查来禁止它？反正不是C。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-15T05:45:11.037

我基本上尝试将变量转换为应有的值，如果失败则传递或抛出适当的异常。

```
def factorial(num):
    """Computes the factorial of num."""
    try:
        num = int(num)
    except ValueError, e:
        print e
    else:
        ... 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-15T07:42:11.190

这取决于我在写什么，以及输出如何到达那里。Python 没有其他面向对象语言的公共/私人保护。取而代之的是约定。例如，外部代码应该只调用不带下划线前缀的对象方法。

因此，如果我正在编写一个模块，我会验证不是由我自己的代码生成的任何内容，即对可公开访问的方法/函数的任何调用。有时，如果我知道验证很昂贵，我会用一个 kwarg 来切换它：

```
def publicly_accessible_function(arg1, validate=False):
  if validate:
    do_validation(arg1)
   do_work 
```

内部方法可以通过[assert](http://docs.python.org/reference/simple_stmts.html#assert)语句进行验证，当代码退出开发并投入生产时，可以完全禁用该语句。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-15T15:29:09.767

我几乎从不强制执行任何形式的检查，除非我认为有人可能认为他们可以通过一些会产生完全疯狂的结果的 X。

我检查的另一次是当我接受参数的多种类型时，例如一个接受列表的函数，可能接受任意对象并将其包装在一个列表中（如果它还不是一个列表）。因此，在这种情况下，我检查类型——而不是强制执行任何事情——只是因为我希望该函数在使用方式上具有灵活性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-10-14T10:54:00.647

只需检查您是否有一个失败的单元测试迫使您这样做。

还要考虑“ [EAFP](http://docs.python.org/glossary.html#term-eafp) ”......这是Python方式！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-09-30T10:16:01.737

对另一种语言如何处理它的一些看法可能会增加一些价值。对于 Perl，我记得使用过这个模块 - [http://search.cpan.org/dist/Params-Validate/](http://search.cpan.org/dist/Params-Validate/)它从开发人员那里卸载了很多参数验证。我在 python 中搜索类似的东西并遇到了这个：[http](http://www.voidspace.org.uk/python/validate.html) ://www.voidspace.org.uk/python/validate.html我还没有尝试过。但我猜想以一种标准方式在整个代码库中验证参数会导致整个团队预先设置参数验证期望。

# mono - 从哪里下载编译并准备在 Windows 下使用 MonoDev for Mono 2？

> ID：367561
> 
> 赞同：3
> 
> 时间：2008-12-15T05:42:32.290
> 
> 标签：mono

与 .NET 及其跨平台支持相比，我听说过很多关于 Mono 及其可用性的信息。

我试图找到一个可用的 MonoDev 版本，它会给我一种使用 Mono 2.x 的可视化方式（如 MS Visual Studio）。

我们是从代码编译它还是有人提供了一个链接来下载在 Win 2000 及更高版本中工作的 MonoDev 的工作和预编译版本？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-16T17:04:57.607

You don't need MonoDevelop to build applications that run on Mono. The main feature of Mono is that it runs .NET assemblies without need for re-compilation. You can build in Visual Studio (including any of the free versions of Visual Studio Express) and run your applications under Mono without change, providing Mono supports the API's you're using.

You can use the Mono Migration Analyzer (MOMA) to test your assemblies to see if Mono will support them. It inspects the MSIL code directly, so it's very quick to test them.

I believe it is possible to run MonoDevelop on Win32: [http://www.monodevelop.com/MonoDevelopWin32](http://www.monodevelop.com/MonoDevelopWin32)

You can run MonoDevelop on Windows using [AndLinux](http://www.andlinux.org/).

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T17:11:15.863

Like others said, the point of Mono is to work the same as MS's .NET. You can develop in VS, then run it on Mono. That being said, if you really want to run MonoDevelop on Windows, don't let anyone tell you it can't be done. If you're curious about it, with a little bit of Cygwin hackery, I've been able to get MonoDevelop to compile cleanly on Windows, and run in an acceptable way. [http://monodevelop.com/MonoDevelopWin32](http://monodevelop.com/MonoDevelopWin32) has some instructions on how to get it working, but they are out of date. The current SVN trunk for MonoDevelop has better support for Windows, so try compiling with Cygwin if you're feeling daring.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-16T16:49:03.037

您可以：

下载完全免费的 Visual Studio Express 版本之一：http: [//www.microsoft.com/express/product/default.aspx](http://www.microsoft.com/express/product/default.aspx)

使用 SharpDevelop。无需“支持” Mono，只需像往常一样进行开发，然后复制您的二进制文件，Mono 就会运行它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T22:58:35.567

MonoDevelop 目前不在 Windows 上运行。它目前在 Linux 和 OSX 上运行。

在 Windows 上，您可以使用 Visual Studio 或 SharpDevelop 并将您的二进制文件复制到 Linux 或 OSX 以运行它们。

# python - Python的Ruby超时？

> ID：367562
> 
> 赞同：2
> 
> 时间：2008-12-15T05:42:55.830
> 
> 标签：python, ruby, timeout

有谁知道在 Python 中实现类似于 Ruby 超时的函数的好解决方案？我用谷歌搜索了它，并没有真正看到任何很好的东西。谢谢您的帮助。

这是 Ruby 文档的链接 [http://www.ruby-doc.org/stdlib/libdoc/timeout/rdoc/index.html](http://www.ruby-doc.org/stdlib/libdoc/timeout/rdoc/index.html)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T05:46:32.047

```
def timeout(func, args=(), kwargs={}, timeout_duration=1, default=None):
    import threading
    class InterruptableThread(threading.Thread):
        def __init__(self):
            threading.Thread.__init__(self)
            self.result = None

        def run(self):
            try:
                self.result = func(*args, **kwargs)
            except:
                self.result = default

    it = InterruptableThread()
    it.start()
    it.join(timeout_duration)
    if it.isAlive():
        return default
    else:
        return it.result 
```

从：

[http://code.activestate.com/recipes/473878/](http://code.activestate.com/recipes/473878/)

# python - 如何从生成器构建 numpy 数组？

> ID：367565
> 
> 赞同：193
> 
> 时间：2008-12-15T05:44:31.740
> 
> 标签：python, numpy, generator

如何从生成器对象中构建一个 numpy 数组？

让我来说明问题：

```
>>> import numpy
>>> def gimme():
...   for x in xrange(10):
...     yield x
...
>>> gimme()
<generator object at 0x28a1758>
>>> list(gimme())
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
>>> numpy.array(xrange(10))
array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
>>> numpy.array(gimme())
array(<generator object at 0x28a1758>, dtype=object)
>>> numpy.array(list(gimme()))
array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]) 
```

在这种情况下，`gimme()`是我想将其输出转换为数组的生成器。但是，数组构造函数不会遍历生成器，它只是存储生成器本身。我想要的行为是 from `numpy.array(list(gimme()))`，但我不想支付同时在内存中拥有中间列表和最终数组的内存开销。有没有更节省空间的方法？

* * *

## 回答 #1

> 赞同：232
> 
> 时间：2009-02-24T03:53:18.183

在这个 stackoverflow 结果后面的一个谷歌，我发现有一个[`numpy.fromiter(data, dtype, count)`](http://docs.scipy.org/doc/numpy/reference/generated/numpy.fromiter.html). 默认`count=-1`从可迭代对象中获取所有元素。它需要`dtype`明确设置。就我而言，这有效：

`numpy.fromiter(something.generate(from_this_input), float)`

* * *

## 回答 #2

> 赞同：147
> 
> 时间：2008-12-15T06:31:12.347

Numpy 数组需要在创建时明确设置它们的长度，这与 python 列表不同。这是必要的，以便可以在内存中连续分配每个项目的空间。连续分配是 numpy 数组的关键特性：这与本机代码实现相结合，让对它们的操作执行得比常规列表快得多。

牢记这一点，在技术上不可能将生成器对象转换为数组，除非您：

1.  可以预测运行时会产生多少元素：

    ```
    my_array = numpy.empty(predict_length())
    for i, el in enumerate(gimme()): my_array[i] = el 
    ```

2.  愿意将其元素存储在中间列表中：

    ```
    my_array = numpy.array(list(gimme())) 
    ```

3.  可以制作两个相同的生成器，遍历第一个找到总长度，初始化数组，然后再次遍历生成器找到每个元素：

    ```
    length = sum(1 for el in gimme())
    my_array = numpy.empty(length)
    for i, el in enumerate(gimme()): my_array[i] = el 
    ```

**1**可能是您正在寻找的。**2**空间效率低，**3**时间效率低（您必须通过生成器两次）。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2017-08-31T11:33:39.720

虽然您可以使用 生成器创建一维数组`numpy.fromiter()`，但您可以使用 生成器创建 ND 数组`numpy.stack`：

```
>>> mygen = (np.ones((5, 3)) for _ in range(10))
>>> x = numpy.stack(mygen)
>>> x.shape
(10, 5, 3) 
```

它也适用于一维数组：

```
>>> numpy.stack(2*i for i in range(10))
array([ 0,  2,  4,  6,  8, 10, 12, 14, 16, 18]) 
```

请注意，这`numpy.stack`是在内部使用生成器并使用`arrays = [asanyarray(arr) for arr in arrays]`. 可以在[这里](https://github.com/numpy/numpy/blob/master/numpy/core/shape_base.py)找到实现。

**[警告]** 正如@Joseh Seedy 所指出的，Numpy 1.16 提出了一个警告，该警告使生成器无法使用此类功能。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-12T20:33:33.277

有点切线，但如果你的生成器是一个列表理解，你可以`numpy.where`更有效地得到你的结果（我在看到这篇文章后在我自己的代码中发现了这一点）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-11-14T20:27:17.427

vstack 、[hstack](https://docs.scipy.org/doc/numpy-1.15.0/reference/generated/numpy.vstack.html)和[dstack函数可以作为](https://docs.scipy.org/doc/numpy-1.15.0/reference/generated/numpy.hstack.html)[产生](https://docs.scipy.org/doc/numpy-1.15.0/reference/generated/numpy.dstack.html)多维数组的输入生成器。

# winforms - Windows 窗体上的甘特图控件

> ID：367570
> 
> 赞同：2
> 
> 时间：2008-12-15T05:48:24.320
> 
> 标签：winforms, controls, gantt-chart

我们正在评估甘特图控件（在 Windows 窗体上）的选项，而不是自己开发一个。您使用过哪些甘特图控件？优点和缺点？

从头开始开发这样的控件是否可行（假设控件在这种情况下不是主要产品）？

**更新：**因为我只有一个答案，所以再次提出这个问题。我将非常感谢更多的投入。（希望这是合法的。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-17T15:48:22.707

我没有使用 Telerik 的甘特图，但很多人对 Telerik 感到非常满意。除非我从事销售用户控件的业务，否则我永远不会考虑创建自己的甘特图

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-17T18:14:16.950

看看这家公司：

[http://dlhsoft.com/Home.aspx](http://dlhsoft.com/Home.aspx)

我在 Winforms 和 WPF 应用程序中都使用了他们的甘特图控件。

科尔比非洲

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-29T11:02:44.877

您还可以查看 NETRONIC 的 VARCHART XGantt 控件。这种控件在市场上已经存在很长时间了，它在关键任务应用程序中得到了证明，并且功能非常丰富。当我为 NETRONIC 工作时，我的回答是有偏见的。我还公开分享，我们以高于上述所有工具的价格出售；这是有原因的。

看看我们的[甘特图](http://www.netronic.com/gantt/gantt-software.html/ "甘特图")产品。如果您喜欢您所看到的，请给我们发送电子邮件至 mailto:sales@netronic.com。请参阅 stackoverflow 并要求将此电子邮件转发给 Martin。他将与您联系以评估创建互补快速原型的潜力。

顺便说一句 - 甘特图通常比许多人想象的要复杂。通过与我们的许多客户（软件开发人员和最终用户）的交谈，我知道使用经过验证的控件可以转化为切实的上市时间优势。

尽管这是供应商的答案，但这对您有帮助吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-10T09:51:55.087

[http://www.dlsc.com](http://www.dlsc.com)上的FlexGantt是一个 Java 控件，但据我所知，您可以使用 J++ 左右将它移植到 .NET。再说一次，我不是那个领域的专家。

短剑

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-12-07T15:46:42.560

另外，请注意我们非常丰富的交互式甘特图控件，它是在 Silverlight 和 WPF 上原生编写的：

[http://www.radiantq.com](http://www.radiantq.com)

谢谢

# algorithm - 在brainfuck程序中检测无限循环

> ID：367571
> 
> 赞同：24
> 
> 时间：2008-12-15T05:49:53.477
> 
> 标签：algorithm, interpreter, infinite-loop, halting-problem, brainfuck

我用MATLAB 脚本语言编写了一个简单的[脑筋急转弯解释器。](http://en.wikipedia.org/wiki/Brainfuck)它被提供随机 bf 程序来执行（作为遗传算法项目的一部分）。我面临的问题是，程序在相当多的情况下都会出现无限循环，因此 GA 会卡在这一点上。
因此，我需要一种机制来检测无限循环并避免在 bf 中执行该代码。
一个明显的（微不足道的）案例是当我有

```
[] 
```

我可以检测到这一点并拒绝运行该程序。
对于非平凡的情况，我发现基本思想是：确定循环的一次迭代如何改变当前单元格。如果变化是负的，我们最终会达到 0，所以这是一个有限循环。否则，如果更改为非负数，则为无限循环。
在单个循环的情况下实现这一点很容易，但是对于嵌套循环，它变得非常复杂。例如，（以下（1）指的是单元格1的内容等）

```
++++ Put 4 in 1st cell (1)
>+++ Put 3 in (2)
<[   While( (1) is non zero)
    --   Decrease (1) by 2
    >[   While( (2) is non zero)
        -    Decrement (2)
        <+   Increment (1) 
    >]   
    (2) would be 0 at this point
    +++  Increase (2) by 3 making (2) = 3
<]   (1) was decreased by 2 and then increased by 3, so net effect is increment 
```

因此代码不断运行。然而，在单元格 1 上对 + 和 - 的数量进行简单检查会说 - 的数量更多，因此不会检测到无限循环。
给定 bf 中任意数量的循环的任意嵌套，谁能想到一个检测无限循环的好算法？

编辑：我确实知道停止问题通常是无法解决的，但我不确定是否不存在特殊情况例外。就像，也许 Matlab 可以充当超级图灵机，能够确定 bf 程序的停止。我可能大错特错，但如果是这样，我想确切地知道如何以及为什么。

第二次编辑：我写了我声称的无限循环检测器。它可能会遗漏一些边缘情况（或者不太可能，以某种方式逃脱图灵先生的魔掌），但到目前为止似乎对我有用。以伪代码形式，这里是：

```
subroutine bfexec(bfprogram)
begin
    Looping through the bfprogram,
        If(current character is '[')
            Find the corresponding ']'
            Store the code between the two brackets in, say, 'subprog'
            Save the value of the current cell in oldval
            Call bfexec recursively with subprog
            Save the value of the current cell in newval
            If(newval >= oldval)
                Raise an 'infinite loop' error and exit
            EndIf
        /* Do other character's processings */
        EndIf
    EndLoop
end 
```

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2008-12-15T05:52:01.787

艾伦·图灵想和你谈谈。

[http://en.wikipedia.org/wiki/Halting_problem](http://en.wikipedia.org/wiki/Halting_problem)

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-12-15T10:21:26.080

当我使用线性遗传编程时，我只是使用了单个程序在其生命周期中允许执行的指令数量的上限。我认为这在两个方面是明智的：无论如何我都无法真正解决停机问题，而且计算时间过长的程序也不值得花更多时间。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-12-15T06:04:31.373

假设您确实编写了一个程序，可以检测该程序是否会在无限循环中运行。为简单起见，假设这个程序是用brainfuck 编写的，用于分析brainfuck 程序（尽管这不是以下证明的前提，因为任何语言都可以模拟brainfuck，而brainfuck 可以模拟任何语言）。

现在假设您扩展检查程序以创建一个新程序。这个新程序在其输入无限循环时立即退出，并在其输入在某个时刻退出时永远循环。

如果你把这个新程序输入到自己里面，结果会是什么？

如果这个程序在运行时永远循环，那么根据它自己的定义，它应该在以自身作为输入运行时立即退出。反之亦然。检查程序不可能存在，因为它的存在本身就意味着矛盾。

如前所述，您实际上是在重申著名的停止问题： [http ://en.wikipedia.org/wiki/Halting_problem](http://en.wikipedia.org/wiki/Halting_problem)

埃德。我想澄清一下，上述反证不是我自己的，而本质上是艾伦·图灵在 1936 年给出的著名反证。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-15T08:36:51.377

bf 中的状态是单个字符数组。

如果我是你，我会在每个“]”（或一次在 rand(1, 100)“]”s* 中）对 bf 解释器状态进行哈希处理，并断言哈希集是唯一的。

第二次（或更多次）我看到某个哈希值时，我将整个状态放在一边。

第三次（或更多）我看到某个哈希值时，我将整个状态与保存的状态进行比较，如果匹配，我退出。

在每个输入命令（'.'，IIRC）上，我都会重置我保存的状态和哈希列表。

一种优化是只对被触及的状态部分进行哈希处理。

我还没有解决停止问题 - 我*在运行*程序时检测到无限循环。

* rand 是为了使检查独立于循环周期

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-15T08:22:03.263

无法检测到无限循环，但您可以检测程序是否占用了太多时间。

每次运行命令（例如，、、、）时，通过递增计数器`<`来实现`>`超时。当计数器达到您通过观察设置的某个大数字时，您可以说执行程序需要很长时间。出于您的目的，“非常长”和无限是一个足够好的近似值。`+``-`

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-15T06:52:10.917

如前所述，这是停机问题。但在您的情况下，可能有一个解决方案：正在考虑的停机问题是关于具有无限内存的图灵机。

如果你知道你有一个内存上限（例如你知道你不使用超过 10 个内存单元），你可以执行你的程序并停止它。这个想法是计算空间限制了计算时间（因为您不能一次编写多个单元格）。在您执行尽可能多的步骤后，您可以拥有不同的内存配置，您可以中断。例如，如果您有 3 个单元格，有 256 个条件，则最多可以有 3^256 个不同的状态，因此您可以在执行那么多步骤后停止。但要小心，有隐含的单元格，比如指令指针和寄存器。如果您保存每个状态配置，并且一旦检测到您已经拥有的状态配置，那么您会做得更短，您将拥有一个无限循环。这种方法在运行时肯定要好得多，

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-11-04T17:03:24.720

这不是停机问题，但是，即使在像 1000 单元 BF 机器这样有限的机器中，尝试检测停机仍然是不合理的。

考虑这个程序：

```
+[->[>]+<[-<]+] 
```

这个程序不会重复，直到它填满整个内存，仅 1000 个单元将需要大约 10^300 年。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-03-10T10:25:07.470

如果我没记错的话，停止问题的证明只适用于一些涉及自我引用的极端情况。然而，展示一个为什么你不能制作无限循环检测器的实际例子仍然是微不足道的。

考虑[费马大定理](https://en.wikipedia.org/wiki/Fermat%27s_Last_Theorem)。很容易创建一个遍历每个数字（或在本例中为 3 个数字）的程序，并检测它是否是定理的反例。如果是，则停止，否则继续。

因此，如果您有一个无限循环检测器，它应该能够证明这个定理，以及许多其他定理（也许所有其他定理，如果它们可以简化为寻找反例。）

通常，任何涉及迭代数字并仅在某些条件下停止的程序都需要通用定理证明器来证明是否可以满足该条件。这是最简单的循环情况。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-15T05:57:45.300

在我的脑海中（我可能是错的），我认为在不实际执行程序本身的情况下检测程序是否具有无限循环会有点困难。

由于程序部分的条件执行取决于程序的执行状态，如果不实际执行程序，将很难知道程序的特定状态。

如果您不需要*执行*具有无限循环的程序，您可以尝试使用“执行指令”计数器，并且只执行有限数量的指令。这样，如果程序确实存在无限循环，解释器可以终止陷入无限循环的程序。

# c# - 为什么 c# 编译器在使用带有 new() 约束的泛型类型调用 new 时会发出 Activator.CreateInstance？

> ID：367577
> 
> 赞同：18
> 
> 时间：2008-12-15T05:56:35.193
> 
> 标签：c#, performance, generics, constructor

当您有如下代码时：

```
static T GenericConstruct<T>() where T : new()
{
    return new T();
} 
```

C# 编译器坚持发出对 Activator.CreateInstance 的调用，这比本机构造函数慢得多。

我有以下解决方法：

```
public static class ParameterlessConstructor<T>
    where T : new()
{
    public static T Create()
    {
        return _func();
    }

    private static Func<T> CreateFunc()
    {
        return Expression.Lambda<Func<T>>( Expression.New( typeof( T ) ) ).Compile();
    }

    private static Func<T> _func = CreateFunc();
}

// Example:
// Foo foo = ParameterlessConstructor<Foo>.Create(); 
```

但对我来说，为什么需要这种解决方法是没有意义的。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-15T07:00:57.873

我*怀疑*这是一个 JITting 问题。目前，JIT 为所有引用类型参数重用相同的生成代码——因此 a`List<string>`的 vtable 指向与`List<Stream>`. `new T()`如果每个调用都必须在 JITted 代码中解决，那将无法正常工作。

只是一个猜测，但它有*一定*的意义。

一个有趣的小点：在*这两种*情况下，值类型的无参数构造函数都不会被调用，如果有的话（这非常罕见）。有关详细信息，请参阅[我最近的博客文章](http://blogs.msmvps.com/jonskeet/2008/12/10/value-types-and-parameterless-constructors/)。我不知道是否有任何方法可以在表达式树中强制它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-15T07:04:51.657

这可能是因为不清楚 T 是值类型还是引用类型。在非通用场景中创建这两种类型会产生非常不同的 IL。面对这种歧义，C# 被迫使用通用的类型创建方法。Activator.CreateInstance 符合要求。

快速实验似乎支持这个想法。如果您键入以下代码并检查 IL，它将使用 initobj 而不是 CreateInstance，因为类型没有歧义。

```
static void Create<T>()
    where T : struct
{
    var x = new T();
    Console.WriteLine(x.ToString());
} 
```

将其切换到类和 new() 约束仍然会强制使用 Activator.CreateInstance。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-10T19:12:26.360

为什么需要这种解决方法？

因为 new() 泛型约束已添加到 .NET 2.0 中的 C# 2.0。

同时，Expression<T> 和朋友被添加到 .NET 3.5。

所以你的解决方法是必要的，因为它在 .NET 2.0 中是不可能的。同时，(1) 使用 Activator.CreateInstance() 是可能的，并且 (2) IL 缺乏实现“new T()”的方法，因此使用 Activator.CreateInstance() 来实现该行为。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-08-15T00:38:22.827

这有点快，因为表达式只编译一次：

```
public class Foo<T> where T : new()
{
    static Expression<Func<T>> x = () => new T();
    static Func<T> f = x.Compile();

    public static T build()
    {
        return f();
    }
} 
```

分析性能，这种方法与更详细的编译表达式一样快，并且比`new T()`（在我的测试 PC 上快 160 倍）快得多。

为了获得更好的性能，可以消除 build 方法调用，而可以返回 functor，客户端可以缓存并直接调用它。

```
public static Func<T> BuildFn { get { return f; } } 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-15T07:17:14.643

有趣的观察:)

这是您的解决方案的一个更简单的变体：

```
static T Create<T>() where T : new()
{
  Expression<Func<T>> e = () => new T();
  return e.Compile()();
} 
```

显然天真（可能很慢）:)

# c# - 关于使用母版页的页面的图像路径

> ID：367578
> 
> 赞同：0
> 
> 时间：2008-12-15T05:57:03.413
> 
> 标签：c#, .net-2.0

如果 Master Page 和子 aspx 页面在不同的文件夹中，那么在提供 aspx 页面时，图片路径是相对于子页面的位置还是相对于 Master 页面的位置？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T06:05:37.640

子页面。

考虑在指向应用程序根目录的路径中使用“~/”，这样您就可以将母版页中的图像设置为“~/images/image_name.png”之类的内容，而无需担心子页面的存储位置。

# python - 生成给定模式的随机文本字符串

> ID：367586
> 
> 赞同：27
> 
> 时间：2008-12-15T06:03:40.920
> 
> 标签：python, string, random

我需要生成特定格式的随机文本字符串。想要一些想法，以便我可以用 Python 对其进行编码。格式为<8 位数字><15 字符串>。

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2008-12-15T06:19:22.450

```
#!/usr/bin/python

import random
import string

digits = "".join( [random.choice(string.digits) for i in xrange(8)] )
chars = "".join( [random.choice(string.letters) for i in xrange(15)] )
print digits + chars 
```

编辑：喜欢使用 random.choice 比 randint() 更好的想法，所以我更新了代码以反映这一点。

注意：这假设需要小写和大写字符。如果仅小写，则将第二个列表理解更改为：

```
chars = "".join( [random.choice(string.letters[:26]) for i in xrange(15)] ) 
```

显然，只有大写字母你可以翻转它，所以切片是 [26:] 而不是相反。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-15T06:18:07.740

查看示例 -[配方 59873：随机密码生成](http://code.activestate.com/recipes/59873/)。

在配方的基础上，这是您问题的解决方案：

```
from random import choice
import string

def GenPasswd2(length=8, chars=string.letters + string.digits):
    return ''.join([choice(chars) for i in range(length)])

>>> GenPasswd2(8,string.digits) + GenPasswd2(15,string.ascii_letters)
'28605495YHlCJfMKpRPGyAw'
>>> 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2013-01-07T11:56:05.980

`random.sample`是另一种选择。可以在[python.org 文档](http://docs.python.org/2/library/random.html)中找到不同之处在于`random.sample`没有替换的示例。因此，`random.sample(string.letters, 53)`将导致`ValueError`. 然后，如果您想生成由八位数字和十五个字符组成的随机字符串，您可以编写

```
import random, string

digits = ''.join(random.sample(string.digits, 8))
chars = ''.join(random.sample(string.letters, 15)) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2020-08-22T14:43:26.023

**自 python 3.6.2 以来的**较短版本**`random.choices`，具有over random.choice 不需要 for 循环，而是只传递**k**，所需的随机字符串的长度。**

 **```
import random
import string
x = ''.join(random.choices(string.ascii_letters + string.digits, k=16))
print(x) 
```

`string.punctuation`如果您需要带有标点字符的字符串，您也可以添加。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-05-03T04:36:47.833

这是一个更简单的版本：

```
import random
import string

digits = "".join( [random.choice(string.digits+string.letters) for i in   xrange(10)] )
print digits 
```

# jquery - Jquery：我的课程在第二次通话期间不起作用

> ID：367597
> 
> 赞同：0
> 
> 时间：2008-12-15T06:23:06.967
> 
> 标签：jquery, class

我是 jQuery 的新手。到现在为止只需学习和使用 3 周。我写了一个类来组织东西。我用超过 2 个事件调用我的方法，但在触发第二个事件期间该事件不起作用。选择器没有问题。我觉得我的课上少了点什么。我不知道。请帮忙！这是片段：

```
$("#btnPersonalNext, #btnDocListBack, #pDocList").livequery('click',function()
{
  var docListContent = 'loadDocumentList.php';
  $("#contentpaper").addContent(
  {
    _tag:'div',
    _id: 'contentDocList',
    _class: 'content',
    _content: docListContent,
    _heading: 'Document List'
  });
  //store personal info in session:
}); 
```

`addContent()`是函数。当我单击时`#btnPersonalNext`，这有效，但是对于`#btnDocListBack`，不再有效。

这是我的课（`jquery.content.js`）。它所做的是将 html 加载到具有`_tag`特定`_id`.

```
(function($)
{
  $.fn.addContent = function(options)
  {
    var defaults = {
      _tag: 'div',
      _id: '',
      _class: '',
      _content: '',
      _heading: '',
      _clearExisting:'yes',
      _insertAfterID:'',
      _deleteBeforeInsert:'no'
    };
    var options = $.extend(defaults, options);

    return this.each(function()
    {
      obj = $(this);
      if(options._clearExisting=='yes'){
        obj.empty();
      }
      if(options._deleteBeforeInsert =='yes'){
        $('#'+options._id).remove();
      }

      var innerHtml = '<' + options._tag + ' id="' + options._id + '" class="' + options._class + '">';
      if(options._heading!=''){
        innerHtml += '<h2>' + options._heading + '</h2>';
      }

      if(/^[A-Za-z0-9]+\.php(\??([A-Za-z0-9]+=[A-Za-z0-9]+)(&[A-Za-z0-9]+=[A-Za-z0-9]+)*)?$/.test(options._content))
      {//if .php
        $.get(options._content,function(data)
        {
          //handle response from server here.
          innerHtml += data;
          innerHtml +='</' + options._tag + '>';
          if(options._insertAfterID !=''){
            $('#'+options._insertAfterID).after(innerHtml);
          }
          else{
            obj.html(innerHtml); 
          }
        });
      } // PHP rule 
      else
      {// .html
        innerHtml += options._content;
        innerHtml +='</' + options._tag + '>';
        if(options._insertAfterID !=''){
          $('#'+options._insertAfterID).after(innerHtml);
        }
        else{
          obj.html(innerHtml); 
        }
      } // HTML rule 
    }); // End of Returned Function
  };// End of addContent definition
})(jQuery); 
```

希望得到解答，非常感谢！

这是我的 DOM 结构：

```
<!-- JS -->
<script type="text/javascript" src="jquery_plugins/jquery-1.2.6.js" ></script>
<script type="text/javascript" src="jquery_plugins/jquery.livequery.js" ></script>
<script type='text/javascript' src='jquery_plugins/jquery.simplemodal.js'></script>
<script type="text/javascript" src="jquery_plugins/jquery.session.js"></script>
<!--<script type="text/javascript" src="jquery_plugins/jquery-plugin-wrapinner.js"></script>-->
<script type="text/javascript" src="jquery_plugins/jquery.content.js"></script>
<script type="text/javascript" src="jquery_plugins/osra_main.js"></script>
</head>

<正文>
<div id="包装器">   
    <div id="header">
        <div id="headercontent">请启用 JavaScript 以继续</div>
    </div>
    <div id="main">
        <div id="sidebarpaper" class="left">
            <!-- 侧边栏内容 (class="sidebar")-->
        </div>
        <div id="contentpaper" class="right">
            <!-- 主要内容 (class="content")-->
        </div>
        <div id="modals" class="clear">
            <!--模态弹窗-->
        </div>
    </div>
    <div id="footer"><p></p></div>
</div>
</正文>
</html>

```

我正在使用 id 在 div 中动态加载内容`#contentpaper`。我不知道如何重新绑定，除了使用 livequery 插件之外，还有这种用法： `$("#btnID").livequery('click',function(){});`

-bgreen1989

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T07:11:50.580

我快速浏览了一下，代码大小有点难以诊断，所以我重新考虑了一下，希望让自己和其他人更容易理解。

我认为是问题的一部分，而 BADTHING(TM) 是您通过将字符串粘合在一起生成的 html。这可能会破坏 DOM 事件绑定，并呈现非常糟糕的代码。

此外，看到您依赖实时查询，“将字符串粘合在一起”方法可能不会触发制作实时查询技巧（不确定）所需的 dom 事件，并且您 / 可能 / 发现使用 DOM 方法生成 DOM 元素应该解决这个问题

```
(function($){
  $.fn.addContent = function(options)
  {
    var defaults = {
      _tag: 'div',
      _id: '',
      _class: '',
      _content: '',
      _heading: '',
      _clearExisting:'yes',
      _insertAfterID:'',
      _deleteBeforeInsert:'no'
    };
    var options = $.extend(defaults, options);
    var phpregex = /^[A-Za-z0-9]+\.php(\??([A-Za-z0-9]+=[A-Za-z0-9]+)(&[A-Za-z0-9]+=[A-Za-z0-9]+)*)?$/;

    var x_generateElement = function()
    {
      var container = document.createElement(options._tag); 
      $(container).attr("id", options._id); 
      $(container).addClass(options._class);
      if(options._heading!=''){
        var header = document.createElement("h2"); 
        $(header).text( options._heading ); 
        $(container).append(header);
      }
      return container;
    };

    var x_preClear   = function( obj )
    {
      if(options._clearExisting=='yes'){
        obj.empty();
      }
      if(options._deleteBeforeInsert =='yes'){
        $('#'+options._id).remove();
      }
      return obj
    };

    var x_addElement = function( e , obj )
    {      
      if(options._insertAfterID !=''){
            $('#'+options._insertAfterID).after(e);
      }
      else{
        obj.html(e); 
      }
      return obj;
    };

    return this.each(function()
    {
      var obj = x_preClear( $(this) );
      var container = x_generateElement(); 

      if( phpregex.test(options._content)){
        $.get(options._content,function(data){
          //handle response from server here.
          $(container).append(data);
          obj = x_addElement(container, obj);
        });
      } else {
        $(container).append(options._content);
        obj = x_addElement(container, obj);
      } 
    });
  };
})(jQuery); 
```

# button - 如何使用 watin 获取按钮列表？

> ID：367603
> 
> 赞同：0
> 
> 时间：2008-12-15T06:34:11.610
> 
> 标签：button, web-crawler, watin

如何使用 Watin 获取网站上可用按钮的列表？watinTestRecorder 是如何做到的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T14:44:45.923

IE ie = new IE("www.example.com/pagewithbuttons.html");

```
ButtonCollection buttons = ie.Buttons; 
```

如果要过滤掉可见按钮，请使用：

```
ButtonCollection buttons = ie.Buttons.Filter(!Find.ByStyle("visible", "none")); 
```

HTH，杰伦·范梅宁

# flash - T 恤闪光设计师

> ID：367604
> 
> 赞同：0
> 
> 时间：2008-12-15T06:34:59.220
> 
> 标签：flash

有人知道这个网站使用的是什么 Flash 组件：http: [//www.comboutique.asia/shop/design_your_own_t_shirt.html](http://www.comboutique.asia/shop/design_your_own_t_shirt.html)吗？它看起来整洁且功能丰富。

我试过[http://www.harboarts.com/shirtdesigner/](http://www.harboarts.com/shirtdesigner/)但与上面的相比，它并不是很好。

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T07:06:46.223

如果我检查该站点的源代码，我能找到的唯一提示是注释 <--TSM2--> 我将其解释为 T-Shirt Manager 2。谷歌搜索这不会导致任何地方。对我来说，这似乎是他们无论如何都会发展自己的事情，因为这是他们业务的主要资产。

所以也许你应该直接联系这个网站的开发者。

# c# - WPF 事件的最佳模式是什么？

> ID：367607
> 
> 赞同：2
> 
> 时间：2008-12-15T06:36:06.597
> 
> 标签：c#, wpf, events

嘿，我正在扩展一些 WPF 控件，并且需要实现一些自定义事件。我已经阅读了有关“事件”关键字和方法组的信息，但我不确定如何在代码中实现它。任何人都可以提供自定义事件/处理程序/等的简单示例吗？谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T06:47:42.703

对于 WPF，最好将自定义事件创建为路由事件。这是有关如何在 MSDN 上执行此操作的教程：[http://msdn.microsoft.com/en-us/library/ms752288.aspx](http://msdn.microsoft.com/en-us/library/ms752288.aspx)。这是对路由事件的更广泛介绍：[http://msdn.microsoft.com/en-us/library/ms742806.aspx](http://msdn.microsoft.com/en-us/library/ms742806.aspx)。

# linq - LINQ 是否支持可组合的“或查询”？

> ID：367617
> 
> 赞同：3
> 
> 时间：2008-12-15T06:46:32.583
> 
> 标签：linq, wcf-data-services, where-clause

在另一个[帖子中：Linq-To-Sql 是否支持可组合查询](https://stackoverflow.com/questions/89193/does-linq-to-sql-support-composable-queries)，讨论了如何动态组合/连接 where 子句。这似乎是通过“AND”完成的（即第一个 where 子句和第二个 where 子句由 AND 连接）。我想知道是否有办法用 OR 组合 Linq 查询。

例子：

```
var people = from p in Person
             where p.age < 18
             select p

var otherPeople = from p in people
                  where p.firstName equals "Daniel"
                  select p 
```

这给出了名字为“Daniel”且未满 18 岁的人。我正在寻找加入这些的语法，以查找名字为“Daniel”或未满 18 岁的人。

注意：我正在使用 ADO.net 数据服务，因此我没有可用的 .Contains()。

**编辑**：Union Suggestion（Garry Shutler）正是我正在寻找的功能。我确实遇到了两个可能的问题：

1.  如果我要执行第三个条件（联合似乎将 IEnumerable 作为其参数），它看起来会产生多个数据库命中 - 我希望在代码中构建多个 AND 和 OR 语句，然后执行一个请求。
2.  ADO.Net 数据服务不支持联合（非常令人失望）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T10:03:53.323

是你想要的那么简单：

```
var people = from p in Person
             where p.age < 18 || p.firstName == "Daniel"
             select p; 
```

还是您刚刚举了一个简单的例子？

在这种情况下，您可以使用：

```
var under18 = from p in Person
              where p.age < 18
              select p;

var daniels = from p in Person
              where p.firstName == "Daniel"
              select p;

var combined = under18.Union(daniels); 
```

LinqToSql 可能足够聪明，可以将其转换为 OR，但我不太确定。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T11:22:27.267

使用Joe Albahari 的[PredicateBuilder怎么样？](http://www.albahari.com/nutshell/predicatebuilder.aspx)

```
var predicate = PredicateBuilder.False<Person>();
predicate = predicate.Or(p => p.age < 18);
predicate = predicate.Or(p => p.firstName == "Daniel");

var query = Person.Where(predicate); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T20:19:35.233

谓词选项是要走的路。Union 选项不能构建好的 sql。参考[http://social.msdn.microsoft.com/forums/en-US/linqprojectgeneral/thread/925b245d-5529-4a64-8cd4-4bc83ee6fe7a/](http://social.msdn.microsoft.com/forums/en-US/linqprojectgeneral/thread/925b245d-5529-4a64-8cd4-4bc83ee6fe7a/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-03T20:02:56.500

我在我的博客上写了关于如何实现在集合中搜索键值的查询。以下是相关链接。

[包含 ADO.NET 数据服务第一部分中的操作](http://blogs.msdn.com/phaniraj/archive/2008/07/17/set-based-operations-in-ado-net-data-services.aspx)

[包含 ADO.NET 数据服务第 II 部分中的操作](http://blogs.msdn.com/phaniraj/archive/2008/07/17/set-based-operations-in-ado-net-data-services.aspx)

使用它，您可以编写如下所示的查询
`//The set in which we have to search for a match
List<string> citiesIWillVisit = new List<string>() {"London","Berlin","Prague"};
var customersAround = nwContext.Customers
.IsIn<Customers>(citiesIWillVisit, c=> c.City);
foreach (Customers localCustomer in customersAround) {
System.Console.WriteLine(localCustomer.ContactName);
}`

# javascript - 如何修复：Ajax WebService 调用中的会话超时时出现 InvalidOperationException

> ID：367623
> 
> 赞同：2
> 
> 时间：2008-12-15T06:48:36.853
> 
> 标签：javascript, web-services, exception, session, asp.net-ajax

我们正在从客户端调用 Asp.Net ajax Web 服务。所以 JavaScript 函数有如下调用：

// 更改服务器端状态对象并为案例树设置选定节点的函数。

```
function JSMethod(caseId, url)
{  
    Sample.XYZ.Method(param1, param2, OnMethodReturn);  
}

function OnMethodReturn(result)
{
   var sessionExpiry = CheckForSessionExpiry(result);
   var error = CheckForErrors(result);

   ... process result
} 
```

在“.asmx.cs”文件中的服务器端：命名空间示例

```
[ScriptService]
class XYZ : WebService
{
       [WebMethod(EnableSession = true)]
        public string Method(string param1, string param2)
        {
            if (SessionExpired())
            {
                return sessionExpiredMessage;
            }
            .
            .
            .
        }
} 
```

该网站设置为使用基于表单的身份验证。现在，如果会话已过期，然后调用 JavaScript 函数“JSMethod”，则会出现以下错误：Microsoft JScript 运行时错误：Sys.Net.WebServiceFailedException：服务器方法“方法”失败并出现以下错误：System.InvalidOperationException -- 认证失败。

此异常由文件“ScriptResource.axd”中的方法“函数 Sys$Net$WebServiceProxy$invoke”引发：

```
function Sys$Net$WebServiceProxy$invoke
{

             .
             .
             .
               {
                    // In debug mode, if no error was registered, display some trace information
                    var error;
                    if (result && errorObj) {
                        // If we got a result, we're likely dealing with an error in the method itself
                        error = result.get_exceptionType() + "-- " + result.get_message();
                    }
                    else {
                        // Otherwise, it's probably a 'top-level' error, in which case we dump the
                        // whole response in the trace
                        error = response.get_responseData();
                    }
                    // DevDiv 89485: throw, not alert()
                    throw Sys.Net.WebServiceProxy._createFailedError(methodName, String.format(Sys.Res.webServiceFailed, methodName, error));
} 
```

所以问题是甚至在调用“方法”之前引发了异常，异常发生在创建 Web 代理期间。关于如何解决这个问题的任何想法

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-15T15:35:21.093

您在 WebMethod 调用中指定了回调方法 (OnMethodReturn)，但没有错误处理程序方法。您需要创建一个并在执行回调方法时将其传递给它。然后你可以在那里处理你失败的 WebMethod 调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-18T03:34:26.290

这个问题甚至在 Ajax 框架可以调用目标方法之前发生，它在创建 Web 代理时失败。无论如何，我通过启用对 Web 服务文件夹的匿名访问并在 Web 服务方法中显式检查会话来解决了这个问题

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-18T04:31:30.527

为什么不使用，`try { } catch { }`围绕你的 JS 方法调用？

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-08-06T04:58:48.323

试试这个……使用“静态”

```
[WebMethod(EnableSession = true)]
public static string Method(string param1, string param2) 
```

# java - 如何解决“List 类型的表达式需要未经检查的转换...”？

> ID：367626
> 
> 赞同：148
> 
> 时间：2008-12-15T06:49:11.140
> 
> 标签：java, warnings, unchecked-conversion

在 Java 代码段中：

```
SyndFeedInput fr = new SyndFeedInput();
SyndFeed sf = fr.build(new XmlReader(myInputStream));
List<SyndEntry> entries = sf.getEntries(); 
```

最后一行生成警告

“类型的表达`List`需要未经检查的转换才能符合`List<SyndEntry>`”

解决此问题的适当方法是什么？

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2010-05-17T10:29:43.993

这是处理 Java 5 之前的 API 时的常见问题。要自动化[来自 erickson 的解决方案](https://stackoverflow.com/questions/367626/how-do-i-fix-the-expression-of-type-list-needs-unchecked-conversion/367673#367673)，您可以创建以下通用方法：

```
public static <T> List<T> castList(Class<? extends T> clazz, Collection<?> c) {
    List<T> r = new ArrayList<T>(c.size());
    for(Object o: c)
      r.add(clazz.cast(o));
    return r;
} 
```

这允许您执行以下操作：

```
List<SyndEntry> entries = castList(SyndEntry.class, sf.getEntries()); 
```

因为此解决方案通过强制转换检查元素确实具有正确的元素类型，所以它是安全的，并且不需要`SuppressWarnings`.

* * *

## 回答 #2

> 赞同：102
> 
> 时间：2008-12-15T07:23:23.803

由于`getEntries`返回一个 raw `List`，它可以容纳任何东西。

无警告的方法是创建一个新的，然后在将结果的`List<SyndEntry>`每个元素添加到新列表之前将其转换为。不会为您执行此检查 -*尽管*可以实现它来执行此操作。`sf.getEntries()``SyndEntry``Collections.checkedList`

 *通过预先进行自己的转换，您“遵守了 Java 泛型的保证条款”：如果`ClassCastException`引发 a，它将与源代码中的转换相关联，而不是编译器插入的不可见转换。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-12-15T07:05:20.843

看起来`SyndFeed`没有使用泛型。

你可以有一个不安全的演员和一个警告抑制：

```
@SuppressWarnings("unchecked")
List<SyndEntry> entries = (List<SyndEntry>) sf.getEntries(); 
```

或致电[Collections.checkedList](http://java.sun.com/javase/6/docs/api/java/util/Collections.html#checkedList) - 尽管您仍然需要禁止显示警告：

```
@SuppressWarnings("unchecked")
List<SyndEntry> entries = Collections.checkedList(sf.getEntries(), SyndEntry.class); 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-15T06:55:20.753

你写了`SyndFeed`吗？

是否`sf.getEntries`返回 List 或`List<SyndEntry>`? 我的猜测是它返回`List`并将其更改为返回`List<SyndEntry>`将解决问题。

如果`SyndFeed`是库的一部分，我认为您不能在不向`@SuppressWarning("unchecked")`您的方法添加注释的情况下删除警告。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-12-18T02:11:53.303

如果您正在使用 Guava 并且您想要做的就是遍历您的值：

```
for(SyndEntry entry: Iterables.filter(sf.getEntries(), SyndEntry.class){
  ...
} 
```

如果您需要一个实际的列表，您可以使用

```
List<SyndEntry> list = Lists.newArrayList(
    Iterables.filter(sf.getEntries(), SyndEntry.class)); 
```

或者

```
List<SyndEntry> list = ImmutableList.copyOf(
    Iterables.filter(sf.getEntries(), SyndEntry.class)); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-15T06:55:55.310

如果您查看该类的 javadoc `SyndFeed`（我猜您指的是该类`com.sun.syndication.feed.synd.SyndFeed`），则 getEntries() 方法不会返回`java.util.List<SyndEntry>`，而是仅返回`java.util.List`.

所以你需要一个明确的演员表。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-05-08T07:30:22.383

```
SyndFeedInput fr = new SyndFeedInput();
SyndFeed sf = fr.build(new XmlReader(myInputStream));
List<?> entries = sf.getEntries(); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-16T04:08:56.207

如果您不想在每个 sf.getEntries() 调用上放置 @SuppressWarning("unchecked")，您始终可以创建一个将返回 List 的包装器。

看到[这个另一个问题](https://stackoverflow.com/questions/115692/how-to-avoid-type-safety-warnings-with-hibernate-hql-results#118976)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-05-16T15:07:32.407

更容易

`return new ArrayList<?>(getResultOfHibernateCallback(...))`

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-11-25T19:29:59.073

Bruno De Fraine 的回答很棒。但是，如果输入参数“Collection<?> c”的大小为 0，则例程会因空指针而崩溃。我建议做一个小的改进来避免这种情况（我给出了 HashSet 的版本）：

```
public static <T> HashSet<T> castHashSet(Class<? extends T> clazz, Collection<?> c) {
  int cSize = (c == null) ? 0 : c.size();
  HashSet<T> hashSet = new HashSet<T>(cSize);
  if (c != null) {
    for (Object o : c)
      hashSet.add(clazz.cast(o));
    }
    return hashSet;
} 
```

# linq-to-sql - LINQ to SQL 的提供者模型的哪一部分使其无法扩展它以支持第三方（阅读：非 Microsoft）数据库？

> ID：367627
> 
> 赞同：2
> 
> 时间：2008-12-15T06:49:44.120
> 
> 标签：linq-to-sql, provider, sealed

据说 LINQ to SQL 提供程序模型中有一些类是密封的——但我从来没有真正弄清楚哪些类需要“解封”才能使用它。

假设地说，我需要解封哪些类来启用提供者模型？

[编辑：我知道sealed关键字意味着它不应该被修改，但我们只是假设解封BCL类不是这里的问题。]

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-20T06:02:17.593

您可以创建自己的 LINQ 提供程序。不过，它不会是 LINQ to SQL 提供程序，而是 LINQ to [whatever] 提供程序。

更多详情请访问：[http ://dotnetslackers.com/articles/csharp/LINQProviderBasics.aspx](http://dotnetslackers.com/articles/csharp/LINQProviderBasics.aspx)

或者您可以查看 DB Link 项目：[http ://code2code.net/DB_Linq/](http://code2code.net/DB_Linq/)

# c++ - C++ 程序员应该了解哪些常见的未定义行为？

> ID：367633
> 
> 赞同：201
> 
> 时间：2008-12-15T06:55:42.423
> 
> 标签：c++, undefined, undefined-behavior, c++-faq

C++ 程序员应该了解哪些常见的未定义行为？

说，比如：

```
a[i] = i++; 
```

* * *

## 回答 #1

> 赞同：233
> 
> 时间：2008-12-15T07:15:24.583

### 指针

*   取消引用`NULL`指针
*   取消引用由大小为零的“新”分配返回的指针
*   使用指向生命周期已结束的对象的指针（例如，堆栈分配的对象或已删除的对象）
*   取消引用尚未明确初始化的指针
*   执行指针运算，产生超出数组边界（上方或下方）的结果。
*   在超出数组末尾的位置取消引用指针。
*   将指针转换为不兼容类型的对象
*   [用于`memcpy`复制重叠缓冲区](https://stackoverflow.com/a/11211519/241536)。

### 缓冲区溢出

*   以负数或超出该对象大小（堆栈/堆溢出）的偏移量读取或写入对象或数组

### 整数溢出

*   有符号整数溢出
*   评估未在数学上定义的表达式
*   将值左移负数（负数右移由实现定义）
*   将值移动的量大于或等于数字中的位数（例如`int64_t i = 1; i <<= 72`未定义）

### 类型、类型和常量

*   将数值转换为目标类型无法表示的值（直接或通过 static_cast）
*   在明确分配之前使用自动变量（例如，`int i; i++; cout << i;`）
*   使用任何类型的对象的值，而不是`volatile`在`sig_atomic_t`接收到信号时
*   尝试在其生命周期内修改字符串文字或任何其他 const 对象
*   在预处理期间将窄字符串与宽字符串文字连接起来

### 功能和模板

*   不从值返回函数返回值（直接或通过从 try 块流出）
*   同一实体的多个不同定义（类、模板、枚举、内联函数、静态成员函数等）
*   模板实例化中的无限递归
*   使用不同的参数调用函数或链接到函数定义为使用的参数和链接。

### 面向对象

*   具有静态存储持续时间的对象的级联破坏
*   分配给部分重叠对象的结果
*   在其静态对象的初始化期间递归地重新进入一个函数
*   从对象的构造函数或析构函数对对象的纯虚函数进行虚函数调用
*   引用尚未构造或已销毁的对象的非静态成员

### 源文件和预处理

*   不以换行符结尾或以反斜杠结尾的非空源文件（C++11 之前）
*   反斜杠后跟不属于字符或字符串常量中指定转义码的字符（这是在 C++11 中实现定义的）。
*   超过实现限制（嵌套块的数量、程序中的函数数量、可用的堆栈空间......）
*   不能用 a 表示的预处理器数值`long int`
*   类函数宏定义左侧的预处理指令
*   `#if`在表达式中动态生成定义的标记

### 待分类

*   在销毁具有静态存储持续时间的程序期间调用 exit

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-12-15T07:15:46.063

评估函数参数的顺序是***未指定*的行为**。（这不会使您的程序崩溃、爆炸或订购披萨......不像***未定义*的行为**。）

唯一的要求是在调用函数之前必须对所有参数进行全面评估。

* * *

这：

```
// The simple obvious one.
callFunc(getA(),getB()); 
```

可以等价于：

```
int a = getA();
int b = getB();
callFunc(a,b); 
```

或这个：

```
int b = getB();
int a = getA();
callFunc(a,b); 
```

它可以是；这取决于编译器。结果可能很重要，具体取决于副作用。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-12-15T07:35:13.420

编译器可以自由地重新排序表达式的求值部分（假设含义不变）。

从原来的问题：

```
a[i] = i++;

// This expression has three parts:
(a) a[i]
(b) i++
(c) Assign (b) to (a)

// (c) is guaranteed to happen after (a) and (b)
// But (a) and (b) can be done in either order.
// See n2521 Section 5.17
// (b) increments i but returns the original value.
// See n2521 Section 5.2.6
// Thus this expression can be written as:

int rhs  = i++;
int lhs& = a[i];
lhs = rhs;

// or
int lhs& = a[i];
int rhs  = i++;
lhs = rhs; 
```

双重检查锁定。还有一个容易犯的错误。

```
A* a = new A("plop");

// Looks simple enough.
// But this can be split into three parts.
(a) allocate Memory
(b) Call constructor
(c) Assign value to 'a'

// No problem here:
// The compiler is allowed to do this:
(a) allocate Memory
(c) Assign value to 'a'
(b) Call constructor.
// This is because the whole thing is between two sequence points.

// So what is the big deal.
// Simple Double checked lock. (I know there are many other problems with this).
if (a == null) // (Point B)
{
    Lock   lock(mutex);
    if (a == null)
    {
        a = new A("Plop");  // (Point A).
    }
}
a->doStuff();

// Think of this situation.
// Thread 1: Reaches point A. Executes (a)(c)
// Thread 1: Is about to do (b) and gets unscheduled.
// Thread 2: Reaches point B. It can now skip the if block
//           Remember (c) has been done thus 'a' is not NULL.
//           But the memory has not been initialized.
//           Thread 2 now executes doStuff() on an uninitialized variable.

// The solution to this problem is to move the assignment of 'a'
// To the other side of the sequence point.
if (a == null) // (Point B)
{
    Lock   lock(mutex);
    if (a == null)
    {
        A* tmp = new A("Plop");  // (Point A).
        a = tmp;
    }
}
a->doStuff();

// Of course there are still other problems because of C++ support for
// threads. But hopefully these are addresses in the next standard. 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-15T07:36:48.953

`const`使用剥离后分配给常数`const_cast<>`：

```
const int i = 10; 
int *p =  const_cast<int*>( &i );
*p = 1234; //Undefined 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-15T08:17:32.243

我最喜欢的是“模板实例化中的无限递归”，因为我相信它是唯一一个在编译时出现未定义行为的地方。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-12-15T14:49:10.440

除了**未定义的行为**，还有同样讨厌的**实现定义的行为**。

当程序执行标准未指定结果的操作时，会发生未定义的行为。

实现定义的行为是程序的行为，其结果未由标准定义，但实现需要记录。一个例子是“多字节字符文字”，来自 Stack Overflow 问题*[Is there a C compiler that failed to compile this?](https://stackoverflow.com/questions/328215)* .

实现定义的行为只会在您开始移植时咬你（但升级到新版本的编译器也是移植！）

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-15T07:22:53.133

变量只能在表达式中更新一次（技术上在序列点之间更新一次）。

```
int i =1;
i = ++i;

// Undefined. Assignment to 'i' twice in the same expression. 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-03-19T05:03:00.623

对各种环境限制的基本了解。完整列表在 C 规范的第 5.2.4.1 节中。这里有几个；

*   一个函数定义127个参数
*   一个函数调用中有 127 个参数
*   一个宏定义127个参数
*   一次宏调用中有 127 个参数
*   逻辑源代码行中有 4095 个字符
*   字符串文字或宽字符串文字中的 4095 个字符（连接后）
*   对象中的 65535 字节（仅在托管环境中）
*   #includedfiles 的 15 个嵌套级别
*   switch 语句的 1023 个 case 标签（不包括任何嵌套 switch 语句的标签）

实际上，我对 switch 语句的 1023 个 case 标签的限制感到有些惊讶，我可以很容易地预见到生成的代码/lex/解析器会超过这个限制。

如果超出这些限制，您将出现未定义的行为（崩溃、安全漏洞等）。

对，我知道这是来自 C 规范，但 C++ 共享这些基本支持。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-15T07:06:09.873

C++ 保证大小的唯一类型是`char`. 大小为 1。所有其他类型的大小取决于平台。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-12-22T05:28:34.973

不同编译单元中的命名空间级对象在初始化时不应相互依赖，因为它们的初始化顺序是未定义的。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-06-26T16:10:25.950

用于在重叠`memcpy`的内存区域之间进行复制。例如：

```
char a[256] = {};
memcpy(a, a, sizeof(a)); 
```

根据 C 标准，该行为是未定义的，该 C 标准包含在 C++03 标准中。

## 7.21.2.1 memcpy 函数

> 概要
> 
> 1/ #include void *memcpy(void * restrict s1, const void * restrict s2, size_t n);
> 
> 描述
> 
> 2/ memcpy函数将n个字符从s2指向的对象复制到s1指向的对象中。如果复制发生在重叠的对象之间，则行为未定义。返回 3 memcpy 函数返回 s1 的值。

## 7.21.2.2 memmove 函数

> 概要
> 
> 1 #include void *memmove(void *s1, const void *s2, size_t n);
> 
> 描述
> 
> 2 memmove函数将n个字符从s2指向的对象复制到s1指向的对象中。复制过程就像先将 s2 指向的对象中的 n 个字符复制到不与 s1 和 s2 指向的对象重叠的 n 个字符的临时数组中，然后将临时数组中的 n 个字符复制到s1 指向的对象。退货
> 
> 3 memmove 函数返回 s1 的值。

# asp.net - 用户控件和自定义控件的区别？

> ID：367640
> 
> 赞同：3
> 
> 时间：2008-12-15T06:59:22.370
> 
> 标签：asp.net, custom-controls, web-user-controls

ASP.NET中的用户控件和自定义控件有什么区别

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-15T07:03:41.313

AFAIK，用户控件是您可以从现有控件创建的控件，并且可以成为项目的一部分，并具有供您拖放的设计器界面。

自定义控件通常在项目外部，需要手动编码（使用各种 asp.net 控件事件和代码中的 html 构建）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T07:34:04.967

用户控件默认继承自 UserControl 类，可以根据特定的 UI 案例组合控件，也可以具有 UI 逻辑，并且可以在项目中的任何地方一次又一次地重用。

自定义控件继承自 Control 类（您可以更改要自定义的任何控件类型），通常用于为现有 UI 控件添加额外功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-10-12T09:14:57.537

**CustomControl 和 UserControl 之间** *的区别 所以，我猜现在你知道了 Custom Control 和 User Control 之间的区别。让我们再次总结一下区别。阅读下面的比较以使其清楚：*

[![在此处输入图像描述](https://i.stack.imgur.com/AUrtx.png)](https://i.stack.imgur.com/AUrtx.png)

# asp.net - Request.AppRelativeCurrentExecutionFilePath 设置的路径在哪里

> ID：367641
> 
> 赞同：-1
> 
> 时间：2008-12-15T06:59:53.007
> 
> 标签：asp.net

我需要知道`Request.AppRelativeCurrentExecutionFilePath`. 当我检索任何请求时，它会给出错误的文件路径。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-15T12:50:52.503

它获取应用程序根目录的虚拟路径，并通过使用波浪号 (~) 表示应用程序根目录使其相对。

因此，如果您的应用程序托管在[http://localhost/WebApp1](http://localhost/WebApp1)并且您想访问根目录中的 Picture1.jpg，则使用它将返回 ~/Picture1.jpg

string _directoryName = Request.AppRelativeCurrentExecutionFilePath + "Picture1.jpg" 将返回[http://localhost/WebApp1/Picture1.jpg](http://localhost/WebApp1/Picture1.jpg)

# java - 在 Java 网络连接上禁用字符回显

> ID：367645
> 
> 赞同：1
> 
> 时间：2008-12-15T07:03:07.947
> 
> 标签：java, networking, solaris, telnet, echo

我有一个用 Java6 编写的 Solaris 守护进程。客户端可以使用 telnet 风格的界面连接到它。他们远程登录到一个特定的端口，我读取输入行并对其进行操作。

在某一时刻，我需要提示用户输入密码，当他们输入时，我想禁用将字符回显回 telnet 客户端。

该代码有一个 Socket 对象，并从套接字的 getInputStream() 结果创建一个 InputStream，然后从 InputStream 读取和缓冲字符，在 cr/lf 边界上分解它们。

我在 InputStream 或 Socket 上都看不到任何属性来禁用将字符回显回客户端。

有人可以将我推向正确的方向吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T07:23:43.677

听起来您需要构建一个支持 no echo 等命令的简单网络虚拟终端。您应该在 SO 上参考一个很好的答案：[Telnet Server](https://stackoverflow.com/questions/267538/telnet-server)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-22T14:50:59.697

您应该了解回声的来源。TCP 连接和 java InputStreams 本身不提供回显。用户运行的 telnet 程序通常以“本地回显”模式启动，这意味着它将用户键入的所有内容回显到用户的屏幕上。当 telnet 客户端连接到实际的 telnet 服务器时，它通常会协商“远程回显”模式，在这种情况下，远程系统会提供回显。当 telnet 连接到其他东西时，比如 HTTP 或 SMTP 服务器，它只是停留在本地回显模式。

用户可以发出命令来关闭客户端中的本地回显，但要求您的用户这样做并不是很友好。正如另一个答案所说，如果要打开和关闭回显，则需要增强服务器以支持 telnet 协议，然后与客户端协商远程回显。

如果这样做，您还将遇到一次一行与一次字符的问题。Telnet 以一次一行的方式启动。它支持本地退格等行编辑键，并且仅在用户点击返回时将行发送到服务器。如果您正在执行远程回显，那么您需要在用户键入字符时回显字符，而不是在他点击返回之后。因此，您必须支持一次一个字符并在服务器中实现行编辑。

您应该仔细查看服务器主机上的 telnet 服务器程序。可以使用现有的 telnet 服务器作为程序的前端，而不是重新实现它所做的一切。祝你好运。

# c++ - 字符串提取

> ID：367656
> 
> 赞同：2
> 
> 时间：2008-12-15T07:11:18.303
> 
> 标签：c++, string, extract

目前我正在使用 C++ 环境进行非常基本的游戏。该游戏曾经是一个学校项目，但现在我完成了编程课，我想扩展我的技能并在这个旧任务上更加繁荣。

我已经做了很多我很满意的改变。我已将所有数据集中到文件夹层次结构中，并且我已经获得了读取这些位置的代码。

然而，我的问题源于一个一直困扰我的非常根本的缺陷。

为了访问我正在使用的图像数据，我使用了以下代码：

```
string imageLocation = "..\\DATA\\Images\\";

string bowImage = imageLocation + "bow.png"; 
```

问题是当玩家拿起游戏板上的物品时，我的代码应该使用以下代码：

```
hud.addLine("You picked up a " + (*itt)->name() + "!"); 
```

打印到命令行，“你拿起了弓！”。但相反，它显示“你拿起了一个 ..\DATA\Images\！”。

在我集中我曾经使用的数据之前：

```
name_(item_name.substr(0, item_name.find('.'))) 
```

在我的 Item 类构造函数中将项目名称砍成弓或蜡烛之类的东西。在我改变了我的数据的结构之后，我意识到我必须改变我将名字砍成同样简单的“弓”或“蜡烛”的方式。

我已更改上述代码以反映我对数据结构的更改为：

```
name_(item_name.substr(item_name.find("..\\DATA\\Images\\"), item_name.find(".png"))) 
```

但不幸的是，正如我之前提到的，这种代码更改并没有像我计划的那样工作。

所以现在我已经对我的问题进行了真正冗长的介绍，这是我的问题。

如何提取不需要的两个部分之间的字符串中间？此外，作为您目标的中间部分的长度未知。

非常感谢你们提供的任何帮助。如果您需要更多信息，请询问；我将非常乐意上传部分甚至我的整个代码以获得更多帮助。再次非常感谢您。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-15T10:41:46.633

老实说，您可能是从错误的角度来解决这个问题的。

您的项目类应该在私有成员中包含一个字符串“bow”。然后函数 Item::GetFilePath 将（在运行时）执行“..\DATA\Images\”+ this->name +“.png”。

“弓”项目对象的基本属性不是文件名 bow.png，而是它是“弓”这一事实。文件名只是一个派生的属性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T08:40:15.037

假设我理解正确，您的问题的简短版本是：如何拆分包含文件路径的字符串，以便删除路径和扩展名，只留下“标题”？

你需要`find_last_of`方法。这摆脱了路径：

```
std::size_type lastSlash = filePath.find_last_of('\\');
if (lastSlash == std::string::npos)
    fileName = filePath;
else
    fileName = filePath.substr(lastSlash + 1); 
```

请注意，您可能需要定义一个常量`\\`，以防您需要为其他平台更改它。并非所有操作系统文件系统都`\\`用于分隔路径段。

另请注意，您还需要使用`find_last_of`扩展名点，因为文件名通常可以在其路径中包含点。只有最后一个表示扩展的开始：

```
std::size_type lastDot = fileName.find_last_of('.');
if (lastDot == std::string::npos)
{
    title = fileName;
}
else
{
    title = fileName.substr(0, lastDot);
    extension = fileName.substr(lastDot + 1);
} 
```

请参阅[http://msdn.microsoft.com/en-us/library/3y5atza0(VS.80).aspx](http://msdn.microsoft.com/en-us/library/3y5atza0(VS.80).aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-15T10:25:54.357

使用升压文件系统：

```
#include "boost/filesystem.hpp"

namespace fs = boost::filesystem;

void some_function(void)
{
    string imageLocation = "..\\DATA\\Images\\";
    string bowImage = imageLocation + "bow.png";
    fs::path image_path( bowImage  ); 
    hud.addLine("You picked up a " + image_path.filename() + "!");  //prints: You picked up a bow! 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-15T08:03:47.607

所以结合保罗和我的想法，尝试这样的事情（为了可读性而分解）：

```
string extn = item_name.substr(item_name.find_last_of(".png"));
string path = item_name.substr(0, item_name.find("..\\DATA\\Images\\"));
name_ = item_name.substr( path.size(), item_name.size() - extn.size() ); 
```

如果您知道项目名称总是以“..DATA”等开头，您可以稍微简化一下*（*您可以将它存储在一个常量中，而不需要在字符串中搜索它）

`find_last_of`编辑：按照 EarWicker 的建议，更改了要使用的扩展查找部分（这避免了您的路径在扩展之前的某处包含“.png”的情况）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-15T07:26:24.640

item_name.find("..\DATA\Images\") 将返回子字符串 "..\DATA\Images\"*开始*的索引，但看起来你想要它*结束*的索引，所以你应该添加"..\DATA\Images\" 到 find 返回的索引的长度。

此外，正如 hamishmcn 指出的那样， substr 的第二个参数应该是要返回的字符数，我认为这将是“.png”开始的索引减去“..\DATA\Images\”结束的索引。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T07:22:50.793

看起来不对的一件事是 substr 的第二个参数应该是要复制的字符数，而不是位置。

# algorithm - 快速 FEM 求解器

> ID：367683
> 
> 赞同：5
> 
> 时间：2008-12-15T07:29:23.370
> 
> 标签：algorithm, solver

[FEM](http://en.wikipedia.org/wiki/Finite_element_method)方程的快速求解器是什么？我更喜欢开源实现，但如果有商业实现，那么我不介意为此付费。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-09-30T07:44:25.663

Code Aster 是一个开源的 FE 代码。[码翠菊](http://www.code-aster.org)

前处理和后处理通常由 Salome 完成 - 两者都来自 EDF。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T13:47:53.847

“布拉德”？你的意思是“广泛”？

你没有说你的问题是线性的还是非线性的。这会有很大的不同。

求解器取决于方程的类型和问题的大小。对于椭圆 pdes，您可以选择标准线性代数技术（如 lu 分解）、迭代方法（如连续过度松弛）或最小化内存消耗的波前求解器。

有些人喜欢解决非线性稳态问题，就好像它们是动力学问题一样。这个想法是创建“假”质量和阻尼矩阵，并使用显式时间积分来收敛到稳态。

很多选择。标准线性代数是一个很好的起点。

语？爪哇？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T08:08:49.343

[FEAP](http://www.ce.berkeley.edu/~rlt/feap/)怎么样。当您购买它时，它具有完整的源代码。这是一个相当大的项目，可能对您的需求来说太多了，但请检查一下。

> FEAP 是一个通用有限元分析程序，专为研究和教育用途而设计。完整程序的源代码可用于使用 Windows（Compaq 或 Intel 编译器）、LINUX 或 UNIX 操作系统以及基于 Mac OS X 的 Apple 系统进行编译。

它还有一个免费的名为[FEAPpv的个人版，包括源代码。](http://www.ce.berkeley.edu/~rlt/feappv/)[此 pdf](http://www.ce.berkeley.edu/~rlt/feappv/differ.pdf)中列出了这些版本之间的差异。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T08:10:22.460

哎呀，这是一个布拉德的问题。

求解微分方程通常从分析方程本身开始。众所周知，有些方程很难有效求解，例如无限边界问题。因此，如果您有其他问题而不是椭圆问题，那么您可能会更好地为未来的艰难时期做好准备。

下一个重要且关键的部分是将连续问题转移到离散网格中。通常，结果的准确性会因生成此网格的不同方式而异。你需要一些声音体验。

所以我会说没有什么比 FEM 方程*的*快速 slover 更好的了。无论如何，虽然[Wikipedia](http://en.wikipedia.org/wiki/Finite_element)提供了该主题的简短概述，但您也许还可以查看[德语 Wikipedia](http://de.wikipedia.org/wiki/Finite-Elemente-Methode)页面。它列出了众所周知的 FEM 实现。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-14T02:33:46.090

我使用 OpenFOAM 进行流体动力学研究。您可以使用 MPI 对它进行并行处理。如果您有 Cray T3E，它会很快！它是开源的：D [http://www.opencfd.co.uk/openfoam/features.html#features](http://www.opencfd.co.uk/openfoam/features.html#features)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-18T14:05:15.050

OpenFoam 和 Elmer 是两个开源求解器。不确定 Elmer，但我认为 OpenFoam 可能会使用控制体积方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-12-14T10:50:22.363

请寻找 Deal.II 开源库：

[http://www.dealii.org/](http://www.dealii.org/)

他们还提供预装库的 VirtualBox 映像。

# python - 从 OpenGL glReadPixels 获取数据（使用 Pyglet）

> ID：367684
> 
> 赞同：0
> 
> 时间：2008-12-15T07:30:59.293
> 
> 标签：python, opengl, graphics, pyglet, glreadpixels

我在应用程序的 Python 中使用 Pyglet（和 OpenGL），我正在尝试使用 glReadPixels 来获取一组像素的 RGBA 值。我的理解是 OpenGL 将数据作为打包整数返回，因为这就是它们在硬件上的存储方式。但是，出于显而易见的原因，我想将其转换为正常格式以供使用。根据一些阅读，我想出了这个：[http](http://dpaste.com/99206/) ://dpaste.com/99206/ ，但是它失败并出现 IndexError。我该怎么做呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-08T10:01:06.650

You must first create an array of the correct type, then pass it to glReadPixels:

```
a = (GLuint * 1)(0)
glReadPixels(x, y, 1, 1, GL_RGB, GL_UNSIGNED_INT, a) 
```

To test this, insert the following in the Pyglet "opengl.py" example:

```
@window.event
def on_mouse_press(x, y, button, modifiers):
    a = (GLuint * 1)(0)
    glReadPixels(x, y, 1, 1, GL_RGB, GL_UNSIGNED_INT, a)
    print a[0] 
```

Now you should see the color code for the pixel under the mouse cursor whenever you click somewhere in the app window.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-08T08:36:50.420

我能够使用 获取整个帧缓冲区`glReadPixels(...)`，然后使用 PIL 写入文件：

```
# Capture image from the OpenGL buffer
buffer = ( GLubyte * (3*window.width*window.height) )(0)
glReadPixels(0, 0, window.width, window.height, GL_RGB, GL_UNSIGNED_BYTE, buffer)

# Use PIL to convert raw RGB buffer and flip the right way up
image = Image.fromstring(mode="RGB", size=(window.width, window.height), data=buffer)     
image = image.transpose(Image.FLIP_TOP_BOTTOM)

# Save image to disk
image.save('jpap.png') 
```

我对 alpha 不感兴趣，但我相信你可以很容易地添加它。

我被迫使用`glReadPixels(...)`, 而不是 Pyglet 代码

```
pyglet.image.get_buffer_manager().get_color_buffer().save('jpap.png') 
```

因为使用的输出`save(...)`与我在窗口中看到的不同。（错过了多重采样缓冲区？）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T12:31:41.607

您可以使用 PIL 库，这是我用来捕获此类图像的代码片段：

```
 buffer = gl.glReadPixels(0, 0, width, height, gl.GL_RGB, 
                             gl.GL_UNSIGNED_BYTE)
    image = Image.fromstring(mode="RGB", size=(width, height), 
                             data=buffer)
    image = image.transpose(Image.FLIP_TOP_BOTTOM) 
```

我想包括 alpha 通道应该非常简单（可能只是用 RGBA 替换 RGB，但我没有尝试过）。

编辑：我不知道 pyglet OpenGL API 与 PyOpenGL API 不同。我想必须更改上面的代码以使用缓冲区作为第七个参数（符合较少的 pythonic pyglet 样式）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T18:47:00.957

在进一步的审查中，我相信我的原始代码是基于一些有效的 C 特定代码，因为数组只是一个指针，所以我使用指针算法可以获得特定字节，这显然不会转换为 Python。有谁如何使用不同的方法提取该数据（我认为这只是对数据进行位移的问题）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T08:30:21.140

如果您阅读链接到的代码段，您可以理解获得“正常”值的最简单方法就是以正确的顺序访问数组。
该片段看起来应该完成这项工作。如果没有，请调试它并查看问题所在。

# perl - 如何在 Perl 中获取替换的驱动器号？

> ID：367695
> 
> 赞同：2
> 
> 时间：2008-12-15T07:38:10.123
> 
> 标签：perl, drive-letter

我需要在 Perl 中获得替换的驱动器号。任何人都可以帮助我吗？$ENV{SYSTEMDRIVE} 不起作用；它给了我真正的逻辑驱动器号，而不是替代的驱动器号。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T07:42:20.347

您在寻找[Win32::FileOp](http://search.cpan.org/dist/Win32-FileOp)吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T09:43:17.483

```
 perl -e 'use Cwd; print( substr(getcwd(),10,1 )) ' # prints 10th char. 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T07:45:39.607

如果你想自己做，你可以捕获 subst 命令的输出并处理它，因为它输出所有当前替换的驱动器。

```
SUBST [drive1: [drive2:]path]
SUBST drive1: /D
    drive1:        Specifies a virtual drive to which you want to assign a path.
    [drive2:]path  Specifies a physical drive and path you want to assign to
                   a virtual drive.
    /D             Deletes a substituted (virtual) drive.
Type SUBST with no parameters to display a list of current virtual drives.

C:\Documents and Settings\Administrator\My Documents>subst r: c:\bin

C:\Documents and Settings\Administrator\My Documents>subst
    R:\: => C:\bin 
```

为此，您需要一个函数来返回替换后的输出，如下所示：

```
sub get_drive {
    my $drv = shift;
    my $ln;
    $drv = substr($drv,0,1);
    open (IN, "subst |");
    while ($ln = <IN>) {
            chomp ($ln);
            if ((substr($ln,0,1) eq $drv) && (substr($ln,1,6) eq ":\\: =>")) {
                    close (IN);
                    return substr($ln,8);
            }
    }
    close (IN);
    return $drv . ":\\";
}

print get_drive ("R:") . "\n";
print get_drive ("S:") . "\n"; 
```

这输出：

```
C:\bin
S:\ 
```

在我只有一个替代驱动器的系统上。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-08-09T23:44:20.920

（我知道，响应真的很晚）但是就在今天，我需要这样的东西，而 Win32::FileOp 无法在我的系统上编译。所以我调用了 subst 并用“真实”替换了虚拟驱动器；片段如下：

```
use strict;
use Data::Dumper;
use feature 'say';

my $DB=1;

$Data::Dumper::Indent = 1;
$Data::Dumper::Terse  = 1;
my %Virt;

exit main();

sub main
{
    my $rtn;
    my (@args) = @_;
    open CMD,"subst|" or die "can't run subst command";
    while (<CMD>) {
        chomp;
        my ($drv, $path) = split(/:\\: => /);
        $Virt{$drv} = $path;
    }

    my %rset; # result set
    while (my ($d,$p) = each %Virt) {
        $rset{$d} = expand($p);
    }
    #D say Dumper rset => \%rset;
    return $rtn;
}

# recursive call if expanded path has another 'virtual' drive
sub expand
{
    my ($loc) = @_;
    my $rtn = undef;
    my ($drv, $path) =  split(/:\\/, $loc);
    if ($a = $Virt{$drv}) {
        #D say "$a $path";
        $rtn = "$a\\$path";
        $rtn = expand($rtn);
    } else {
        #D say "$drv $path";
        $rtn = "$drv:\\$path";
    }
    return $rtn;
} 
```

注意：我使用 #D 来进行 quickNdirty 调试语句

我将此测试到三个级别，即 w: subst to x:, x: subst to y: 和 y: subst to c:

# eclipse - 找出谁编写/编辑了这行代码的最简单方法是什么？

> ID：367703
> 
> 赞同：8
> 
> 时间：2008-12-15T07:45:24.647
> 
> 标签：eclipse, version-control, cvs

这显然需要源文件处于源代码控制之下。理想情况下，我想要一个在 IDE（Eclipse、Visual Studio 等）下工作的工具——但外部工具也很好。显然，可以手动浏览文件的以前版本，并比较各个版本，但我正在寻找一种能够快速查看谁负责代码部分的方法。

我正在使用 CVS，但该工具应该理想地与不同的源代码控制系统一起使用。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-15T07:49:33.813

这看起来像是在[CVS](http://stuvel.eu/archive/42/blame-support-in-eclipse)或[Subversion](https://stackoverflow.com/questions/223657/svn-blame-in-eclipse)（也在 eclipse 中）的eclipse中支持的[blame 函数](http://svnbook.red-bean.com/en/1.0/re02.html)

正如您所提到的，该功能的 eclipse-name 是[**Show Annotations**](http://henke.ws/post.cfm/CFEclipse---Eclipse---Show-Annotations)。

![Eclipse Show-Annotations](https://i.stack.imgur.com/bDIfF.jpg)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-15T07:48:20.023

您没有提到您使用的是哪个源代码控制。

如果您使用的是 Subversion，您可以查看：

```
svn blame 
```

:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T08:16:59.653

对于带有 TFS 的 Visual Studio .NET。

该功能是“注释”，与 Blame 的工作方式几乎相同。

（我个人将这些称为团队的猎巫工具）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T15:13:28.377

这个问题非常广泛/开放。不知怎的，这是个好主意，可以作为参考……

在工作中，我使用 Perforce 及其图形界面。Time-lapse 视图允许查看文件，对于每一行，它已更改的修订版本和详细信息（谁提交了更改，何时等）。您可以移动滑块查看以前的版本。
有一个命令行版本：`p4 annotate`.

我开始使用 Mercurial，所以我看了看。[版本控制系统比较](http://www.versioncontrolblog.com/comparison/ "版本控制系统比较")（好网站，我刚刚发现）显示命令是`hg annotate`.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-04T13:07:05.780

在 AccuRev 中，使用注释 +“版本滑块”功能更加智能，它可以让您选择浏览历史文件的注释版本：

（不仅是谁更改了最新修订版的内容，还包括*所有*修订版）

[![Accurev 版本滑块](https://i.stack.imgur.com/zzMbW.png)](https://i.stack.imgur.com/zzMbW.png)
[（来源：[accurev.com](http://www.accurev.com/images/screenshots/4.6/annotate.png)）]

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T21:29:48.603

[在包括CVS](http://ximbiot.com/cvs/wiki/CVS--Concurrent%20Versions%20System%20v1.12.12.1:%20Guide%20to%20CVS%20commands#SEC134)、[Perforce](https://stackoverflow.com/questions/367703/what-is-the-easiest-way-to-figure-out-who-wrote-edited-this-line-of-code/368661#368661)、[AccuRev](https://stackoverflow.com/questions/367703/what-is-the-easiest-way-to-figure-out-who-wrote-edited-this-line-of-code/410958#410958)、[Mercurial](https://stackoverflow.com/questions/367703/what-is-the-easiest-way-to-figure-out-who-wrote-edited-this-line-of-code/368661#368661)和[Team Foundation Server](https://stackoverflow.com/questions/367703/what-is-the-easiest-way-to-figure-out-who-wrote-edited-this-line-of-code/367749#367749)在内的许多版本控制系统中，命令是**`annotate`**.

在[Subversion](https://stackoverflow.com/questions/367703/what-is-the-easiest-way-to-figure-out-who-wrote-edited-this-line-of-code/367710#367710)和[RCS](http://blame.sourceforge.net/)中，命令是**`blame`**.

例如，使用 CVS：

```
cvs annotate foo.cc > foo_changes.txt 
```

将创建`foo_changes.txt`，其中列出了与当前版本中每一行的最新更改相关联的修订号和用户名`foo.cc`。使用不同的选项将为您提供先前版本或文件标记版本的相同信息。

我也需要回答这个问题，但是在阅读已经发布的答案时它并没有立即跳出来，所以希望这个总结应该有所帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-12-28T21:07:11.217

对于 Eclipse 中的 perforce 插件，注释未显示在上下文菜单中。所以我需要使用：`p4 annotate my-file`然后使用Eclipse浏览历史。

# java - 如何在 Java 中解析命令行参数？

> ID：367706
> 
> 赞同：647
> 
> 时间：2008-12-15T07:46:10.870
> 
> 标签：java, command-line, command-line-arguments

在 Java 中解析命令行参数的好方法是什么？

* * *

## 回答 #1

> 赞同：490
> 
> 时间：2008-12-15T07:49:15.980

检查这些：

*   [http://commons.apache.org/cli/](http://commons.apache.org/cli/)
*   [http://www.martiansoftware.com/jsap/](http://www.martiansoftware.com/jsap/)

或者自己动手：

*   [http://docs.oracle.com/javase/7/docs/api/java/util/Scanner.html](http://docs.oracle.com/javase/7/docs/api/java/util/Scanner.html)

* * *

**例如，**这是您[`commons-cli`](https://mvnrepository.com/artifact/commons-cli/commons-cli/1.3.1)用来解析 2 个字符串参数的方式：

```
import org.apache.commons.cli.*;

public class Main {

    public static void main(String[] args) throws Exception {

        Options options = new Options();

        Option input = new Option("i", "input", true, "input file path");
        input.setRequired(true);
        options.addOption(input);

        Option output = new Option("o", "output", true, "output file");
        output.setRequired(true);
        options.addOption(output);

        CommandLineParser parser = new DefaultParser();
        HelpFormatter formatter = new HelpFormatter();
        CommandLine cmd = null;//not a good practice, it serves it purpose 

        try {
            cmd = parser.parse(options, args);
        } catch (ParseException e) {
            System.out.println(e.getMessage());
            formatter.printHelp("utility-name", options);

            System.exit(1);
        }

        String inputFilePath = cmd.getOptionValue("input");
        String outputFilePath = cmd.getOptionValue("output");

        System.out.println(inputFilePath);
        System.out.println(outputFilePath);

    }

} 
```

从命令行使用：

```
$> java -jar target/my-utility.jar -i asd                                                                                       
Missing required option: o

usage: utility-name
 -i,--input <arg>    input file path
 -o,--output <arg>   output file 
```

* * *

## 回答 #2

> 赞同：322
> 
> 时间：2010-07-26T16:52:58.913

看看更新的[JCommander](http://jcommander.org/)。

我创造了它。我很高兴收到问题或功能请求。

* * *

## 回答 #3

> 赞同：250
> 
> 时间：2011-10-20T00:21:36.303

我一直在尝试维护[Java CLI 解析器列表](http://jewelcli.lexicalscope.com/related.html)。

*   [**航空公司**](https://github.com/airlift/airline)
    *   主动分叉：[https ://github.com/rvesse/airline](https://github.com/rvesse/airline)
*   [**argparse4j**](https://github.com/tatsuhiro-t/argparse4j)
*   [**参数解析器**](http://www.cs.ubc.ca/spider/lloyd/java/argparser.html)
*   [**args4j**](http://args4j.kohsuke.org/)
*   [**克莱尔**](http://clajr.sourceforge.net/)
*   [**cli解析器**](http://code.google.com/p/cli-parser/)
*   [**CmdLn**](http://ostermiller.org/utils/CmdLn.html)
*   [**命令行**](https://github.com/jankroken/commandline)
*   [**DocOpt.java**](https://github.com/docopt/docopt.java)
*   [**海豚 getopt**](http://dolphin.sourceforge.net/getopt/)
*   [**DPML CLI（Jakarta Commons CLI2 分支）**](http://www.dpml.net/util/cli/index.html)
*   [**Matthias Laux 博士**](http://www.javaworld.com/javaworld/jw-08-2004/jw-0816-command.html)
*   [**雅加达公共 CLI**](http://jakarta.apache.org/commons/cli/)
*   [**空话**](https://github.com/Softhouse/jargo)
*   [**jargp**](http://jargp.sourceforge.net/)
*   [**罐子**](http://jargs.sourceforge.net/)
*   [**java-getopt**](http://www.urbanophile.com/arenn/hacking/download.html)
*   [**博克**](https://github.com/jbock-java/jbock)
*   [**JCLAP**](http://www.snaq.net/java/JCLAP/)
*   [**命令行**](http://jcmdline.sourceforge.net/)
*   [**jcommander**](http://jcommander.org/)
*   [**突击队**](http://jcommando.sourceforge.net/)
*   [**Jewelcli（我写的）**](http://jewelcli.lexicalscope.com/)
*   [**选择简单**](http://jopt-simple.sourceforge.net)
*   [**jsap**](http://www.martiansoftware.com/jsap/)
*   [**自然cli**](http://naturalcli.sourceforge.net/)
*   [**Object Mentor CLI 文章（有关重构和 TDD 的更多信息）**](http://www.objectmentor.com/resources/articles/Clean_Code_Args.pdf)
*   [**解析-cmd**](http://code.google.com/p/parse-cmd/)
*   [**ritopt**](http://ritopt.sourceforge.net/)
*   [**罗普**](http://ryenus.github.io/rop/)
*   [**TE-代码命令**](http://te-code.sourceforge.net/)
*   [**picocli**](http://picocli.info)具有 ANSI 彩色使用帮助和自动完成功能

* * *

## 回答 #4

> 赞同：90
> 
> 时间：2017-05-04T10:31:44.193

> *现在是 2022 年，是时候比 Commons CLI 做得更好...... :-)*

您应该构建自己的 Java 命令行解析器，还是使用库？

许多类似实用程序的小型应用程序可能会使用自己的命令行解析来避免额外的外部依赖。[picocli](http://picocli.info/)可能是一个有趣的选择。

Picocli 是一个现代库和框架，用于轻松构建功能强大、用户友好、支持 GraalVM 的命令行应用程序。它存在于 1 个源文件中，因此应用程序可以将其作为源包含以避免添加依赖项。

它支持颜色、自动完成、子命令等。用 Java 编写，可用于 Groovy、Kotlin、Scala 等。

[![ANSI 颜色的最小使用帮助](https://i.stack.imgur.com/UqZmi.png)](https://i.stack.imgur.com/UqZmi.png)

特征：

*   基于注释：**声明性**，**避免重复**并**表达**程序员**意图**
*   方便：解析用户输入并用**一行代码运行您的业务逻辑**
*   **强类型的**一切 - 命令行选项以及位置参数
*   POSIX 集群空头期权（`<command> -xvfInputFile`以及`<command> -x -v -f InputFile`）
*   **细粒度控制**：一个允许最小、最大和可变参数数量的模型，例如`"1..*"`，`"3..5"`
*   **子命令**（可以嵌套到任意深度）
*   **功能丰富**：可组合的 arg 组、拆分引用的 args、可重复的子命令等等
*   **用户友好**：使用帮助消息使用**颜色**将选项名称等重要元素与其他使用帮助进行对比，以减少用户**的认知负担**
*   将您的应用程序分发为**[GraalVM 原生映像](https://picocli.info/#_graalvm_native_image)**
*   适用于**Java 5**及更高版本
*   广泛而细致的[**文档**](https://picocli.info/)

使用帮助消息很容易通过注释自定义（无需编程）。例如：

[![扩展使用帮助信息](https://i.stack.imgur.com/hLO1d.png)](https://i.stack.imgur.com/hLO1d.png)（[来源](https://github.com/remkop/picocli/blob/v0.9.4/src/test/java/picocli/Demo.java#L337)）

我忍不住再添加一张屏幕截图来显示可能的使用帮助消息。使用帮助是您的应用程序的面孔，所以要有创意，玩得开心！

[![picocli 演示](https://i.stack.imgur.com/yLsst.png)](https://i.stack.imgur.com/yLsst.png)

免责声明：我创建了 picocli。非常欢迎反馈或问题。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2008-12-15T18:07:58.883

最近有人向我指出了基于注释的[args4j](http://github.com/kohsuke/args4j)。我很喜欢！

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2008-12-15T07:50:56.790

我使用过 JOpt，发现它非常方便：http: [//jopt-simple.sourceforge.net/](http://jopt-simple.sourceforge.net/)

首页还提供了大约 8 个替代库的列表，请查看它们并选择最适合您需求的库。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2016-12-07T16:13:43.203

这是作为 Bazel 项目的一部分开源的 Google 命令行解析库。就我个人而言，我认为它是最好的，而且比 Apache CLI 容易得多。

[https://github.com/pcj/google-options](https://github.com/pcj/google-options)

# 安装

### 巴泽尔

```
maven_jar(
    name = "com_github_pcj_google_options",
    artifact = "com.github.pcj:google-options:jar:1.0.0",
    sha1 = "85d54fe6771e5ff0d54827b0a3315c3e12fdd0c7",
) 
```

### 摇篮

```
dependencies {
  compile 'com.github.pcj:google-options:1.0.0'
} 
```

### 马文

```
<dependency>
  <groupId>com.github.pcj</groupId>
  <artifactId>google-options</artifactId>
  <version>1.0.0</version>
</dependency> 
```

# 用法

创建一个扩展`OptionsBase`并定义您的`@Option`（s）的类。

```
package example;

import com.google.devtools.common.options.Option;
import com.google.devtools.common.options.OptionsBase;

import java.util.List;

/**
 * Command-line options definition for example server.
 */
public class ServerOptions extends OptionsBase {

  @Option(
      name = "help",
      abbrev = 'h',
      help = "Prints usage info.",
      defaultValue = "true"
    )
  public boolean help;

  @Option(
      name = "host",
      abbrev = 'o',
      help = "The server host.",
      category = "startup",
      defaultValue = ""
  )
  public String host;

  @Option(
    name = "port",
    abbrev = 'p',
    help = "The server port.",
    category = "startup",
    defaultValue = "8080"
    )
    public int port;

  @Option(
    name = "dir",
    abbrev = 'd',
    help = "Name of directory to serve static files.",
    category = "startup",
    allowMultiple = true,
    defaultValue = ""
    )
    public List<String> dirs;

} 
```

解析参数并使用它们。

```
package example;

import com.google.devtools.common.options.OptionsParser;
import java.util.Collections;

public class Server {

  public static void main(String[] args) {
    OptionsParser parser = OptionsParser.newOptionsParser(ServerOptions.class);
    parser.parseAndExitUponError(args);
    ServerOptions options = parser.getOptions(ServerOptions.class);
    if (options.host.isEmpty() || options.port < 0 || options.dirs.isEmpty()) {
      printUsage(parser);
      return;
    }

    System.out.format("Starting server at %s:%d...\n", options.host, options.port);
    for (String dirname : options.dirs) {
      System.out.format("\\--> Serving static files at <%s>\n", dirname);
    }
  }

  private static void printUsage(OptionsParser parser) {
    System.out.println("Usage: java -jar server.jar OPTIONS");
    System.out.println(parser.describeOptions(Collections.<String, String>emptyMap(),
                                              OptionsParser.HelpVerbosity.LONG));
  }

} 
```

[https://github.com/pcj/google-options](https://github.com/pcj/google-options)

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2018-07-19T11:29:08.877

我知道这里的大多数人会找到 1000 万个他们不喜欢我的方式的理由，但没关系。我喜欢保持简单，所以我只需使用“=”将键与值分开，并将它们存储在 HashMap 中，如下所示：

```
Map<String, String> argsMap = new HashMap<>();
for (String arg: args) {
    String[] parts = arg.split("=");
    argsMap.put(parts[0], parts[1]);
} 
```

您始终可以维护一个包含您期望的参数的列表，以帮助用户以防他忘记了参数或使用了错误的参数......但是，如果您想要太多功能，这个解决方案无论如何都不适合您。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-12-15T07:50:00.317

看看[Commons CLI](http://commons.apache.org/cli/)项目，里面有很多好东西。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2008-12-15T07:51:38.830

是的。

我想你正在寻找这样的东西： [http ://commons.apache.org/cli](http://commons.apache.org/cli)

> *Apache Commons CLI 库提供了一个用于处理命令行界面的 API。*

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-12-15T07:50:03.483

也许这些

*   [用于 Java 的 JArgs 命令行选项解析套件](http://jargs.sourceforge.net/)——这个小型项目为 Java 程序员提供了一个方便、紧凑、预打包和全面记录的命令行选项解析器套件。最初，提供了与 GNU 风格的“getopt”兼容的解析。

*   [ritopt，Java 的终极选项解析器](http://ritopt.sourceforge.net/)- 尽管已经预先提出了几个命令行选项标准，但 ritopt 遵循 opt 包中规定的约定。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2019-07-12T09:26:21.767

如果您已经在使用 Spring Boot，那么参数解析是开箱即用的。

如果你想在启动后运行一些东西，实现`ApplicationRunner`接口：

```
@SpringBootApplication
public class Application implements ApplicationRunner {

  public static void main(String[] args) {
    SpringApplication.run(Application.class, args);
  }

  @Override
  public void run(ApplicationArguments args) {
    args.containsOption("my-flag-option"); // test if --my-flag-option was set
    args.getOptionValues("my-option");     // returns values of --my-option=value1 --my-option=value2 
    args.getOptionNames();                 // returns a list of all available options
    // do something with your args
  }
} 
```

您的`run`方法将在上下文成功启动后被调用。

*如果您需要在启动应用程序上下文之前*访问参数，您可以简单地手动解析应用程序参数：

```
@SpringBootApplication
public class Application implements ApplicationRunner {

  public static void main(String[] args) {
    ApplicationArguments arguments = new DefaultApplicationArguments(args);
    // do whatever you like with your arguments
    // see above ...
    SpringApplication.run(Application.class, args);
  }

} 
```

最后，如果您需要访问 bean 中的参数，只需注入`ApplicationArguments`：

```
@Component
public class MyBean {

   @Autowired
   private ApplicationArguments arguments;

   // ...
} 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2012-09-04T14:24:33.623

我写了另一个：[http ://argparse4j.sourceforge.net/](http://argparse4j.sourceforge.net/)

Argparse4j 是基于 Python 的 argparse 的 Java 命令行参数解析器库。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2008-12-15T08:04:01.163

如果您熟悉 gnu getopt，则在以下位置有一个 Java 端口：[http](http://www.urbanophile.com/arenn/hacking/download.htm) ://www.urbanophile.com/arenn/hacking/download.htm 。

似乎有一些类可以做到这一点：

*   *[http://docs.sun.com/source/816-5618-10/netscape/ldap/util/GetOpt.html](http://docs.sun.com/source/816-5618-10/netscape/ldap/util/GetOpt.html)*
*   *[http://xml.apache.org/xalan-j/apidocs/org/apache/xalan/xsltc/cmdline/getopt/GetOpt.html](http://xml.apache.org/xalan-j/apidocs/org/apache/xalan/xsltc/cmdline/getopt/GetOpt.html)*

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2013-04-09T07:57:32.407

[航空公司@Github](https://github.com/airlift/airline "Airline 是一个基于 Java 注释的框架，用于解析 Git 之类的命令行结构。")看起来不错。它基于注释，并试图模拟 Git 命令行结构。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2017-10-18T14:20:27.297

Argparse4j 是我发现的最好的。它模仿 Python 的 argparse 库，非常方便和强大。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2017-08-26T18:47:32.417

如果您想要一些轻量级（jar 大小 ~ 20 kb）且易于使用的东西，您可以尝试[argument-parser](https://github.com/shekhar-himanshu/argument-parser)。它可以在大多数用例中使用，支持在参数中指定数组，并且不依赖于任何其他库。它适用于 Java 1.5 或更高版本。以下摘录显示了如何使用它的示例：

```
public static void main(String[] args) {
    String usage = "--day|-d day --mon|-m month [--year|-y year][--dir|-ds directoriesToSearch]";
    ArgumentParser argParser = new ArgumentParser(usage, InputData.class);
    InputData inputData = (InputData) argParser.parse(args);
    showData(inputData);

    new StatsGenerator().generateStats(inputData);
} 
```

更多示例可以在[这里找到](https://easy-develop.github.io/argument-parser/1.0.0/examples)

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2020-12-29T16:54:57.343

我想向你展示我的实现：[ReadyCLI](https://github.com/sv-giampa/ReadyCLI)

好处：

*   **对于懒惰的程序员**：要学习的课程数量非常少，只需查看存储库中 README 上的两个小示例，您就已经完成了 90% 的学习；在没有任何其他知识的情况下开始编写 CLI/解析器；ReadyCLI 允许以最自然的方式编写 CLI；
*   它的设计考虑了**开发人员体验**；它主要使用 Lambda 表达式的 Builder 设计模式和功能接口，以允许非常快速的编码；
*   它支持**选项**、**标志**和**子命令**；
*   它允许从命令行解析参数并构建更复杂和交互式的 CLI；
*   可以像在任何其他 I/O 接口（例如套接字）上一样轻松地在标准 I/O 上启动 CLI；
*   它为命令文档提供了极大的支持。

我开发这个项目是因为我需要新功能（选项、标志、子命令）并且可以在我的项目中以最简单的方式使用。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-08-26T08:29:18.727

正如前面提到的评论之一（[https://github.com/pcj/google-options](https://github.com/pcj/google-options)）将是一个不错的选择。

我想添加的一件事是：

1) 如果遇到一些解析器反射错误，请尝试使用更新版本的番石榴。就我而言：

```
maven_jar(
    name = "com_google_guava_guava",
    artifact = "com.google.guava:guava:19.0",
    server = "maven2_server",
)

maven_jar(
    name = "com_github_pcj_google_options",
    artifact = "com.github.pcj:google-options:jar:1.0.0",
    server = "maven2_server",
)

maven_server(
    name = "maven2_server",
    url = "http://central.maven.org/maven2/",
) 
```

2）运行命令行时：

```
bazel run path/to/your:project -- --var1 something --var2 something -v something 
```

3）当您需要使用帮助时，只需键入：

```
bazel run path/to/your:project -- --help 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2018-09-21T00:11:06.933

对于 Spring 用户，我们还应该提到[https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/env/SimpleCommandLinePropertySource.html](https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/env/SimpleCommandLinePropertySource.html) 和他的孪生兄弟[https://docs.spring .io/spring/docs/current/javadoc-api/org/springframework/core/env/JOptCommandLinePropertySource.html](https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/env/JOptCommandLinePropertySource.html)（相同功能的JOpt实现）。Spring 的优点是可以直接将命令行参数绑定到属性，这里有一个例子[https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/env/ CommandLinePropertySource.html](https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/env/CommandLinePropertySource.html)

# c# - 关于在桌面应用程序中使用 Silverlight 的想法？

> ID：367707
> 
> 赞同：6
> 
> 时间：2008-12-15T07:46:43.130
> 
> 标签：c#, .net, silverlight, silverlight-2.0

总结一下，众所周知，

a) Silverlight 预计由浏览器托管，并在隔离的沙箱中运行，因此不会出现任何安全问题

1.  Silverlight 不能直接访问文件系统，除了隔离的存储区域
2.  没有直接的方法可以在 Silverlight 中打开像文件保存这样的常见对话框（尽管支持打开对话框）。

b) Silverlight 无法访问打印机等本地资源

有什么方法可以超越沙盒，以便我可以在本地托管 Silverlight 应用程序、读取文件并在需要时将它们保存回来、将数据移交给打印机等等。

**更新：**

完整的 WPF 不是我的选择吗？不。我还对跨平台解决方案感兴趣——例如，您可以在 Mono Web 浏览器控件中托管 Silverlight，这样您几乎可以在任何地方运行它。

这个想法是通过在某些领域（如持久性、资源访问等）提供关注点分离，在我的桌面上重用我为 web 构建的相同应用程序。场景：

1- 某种小工具容器，可以访问本地资源。2 - 基于桌面 Silver light 的媒体应用程序

**更新：**

我刚刚做了一个 POC，使我能够访问打印机并在本地保存文件，当然是通过我托管 Silverlight 应用程序的 shell。如果你不想，你可以看看[我博客中的帖子](http://amazedsaint.blogspot.com/2008/12/thinking-outside-silverlight-sandbox.html)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-15T07:48:46.763

我能想到的两种方法是，

**创建一个“外壳”**

使用 Web 浏览器控件在 Winforms 桌面应用程序中使用 Silverlight 托管 HTML 页面，并使用 HTML DOM 来回通信。然后我可以请求托管 shell 执行打印等操作。[在此处查看详细信息](http://amazedsaint.blogspot.com/2008/12/thinking-outside-silverlight-sandbox.html)

Mono 还有一个 Web 浏览器控件——基于 FireFox XULRunner 而不是 IE——尚未成功在其中加载 Silverlight。另一种选择可能是使用 Webkit。

![桌面外壳](https://3.bp.blogspot.com/__Mw4iY-4nuY/SUYUVhMcMtI/AAAAAAAAAXU/5vYVQz2EBnw/s400/image001.gif)

**嵌入网络服务器**

在 Host 应用程序中嵌入一个轻量级 Web 服务器，并处理执行此类操作的请求。您可能可以在 HTTP 之上定义一个协议，用于保存到本地文件夹、发送数据以打印等。

![嵌入服务器](https://3.bp.blogspot.com/__Mw4iY-4nuY/SUYUW8Rf2PI/AAAAAAAAAXc/kb-6LCr17gA/s400/image002.gif)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T08:20:19.053

完整的 WPF 应用程序不适合您的情况吗？

您可能知道 Silverlight 使用 WPF 的一个子集，因此您可以相对容易地更改您的应用程序。

wpf 应用程序比在应用程序中捆绑 Web 服务器等更容易。

如您所知，在可预见的将来，您将无法通过 Silverlight 访问诸如打印机和文件（除了独立存储）之类的资源。

您可以在应用程序的单独部分将文件上传到网络服务器，然后在您的 silverlight 应用程序中从服务中读取这些文件。

根据您的打印要求（例如，如果您只想将所有内容发送到办公室打印机），您可以将您想要打印的信息发送到服务，然后该服务将为您打印。但是我猜你希望每台客户端机器都能够打印，在这种情况下这对你不起作用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T14:23:53.347

我也在尝试为桌面和 Silverlight 重用代码库。除了提到的之外，我知道还有两个选项

如果您直接引用（而不是项目引用）来自普通项目的 silverlight dll，它应该可以工作。这将让您为这两个项目引用一个 silverlight dll。

有两个指向同一组文件的项目文件（一个 wpf，一个 silverlight）。您可能不得不在这里和那里使用一些编译器标志，但这应该让您对两者使用相同的文件。

# jquery - jQuery 和 Drupal 页面加载

> ID：367709
> 
> 赞同：7
> 
> 时间：2008-12-15T07:47:45.203
> 
> 标签：jquery, drupal

我想在 drupal 站点中执行 jQuery $(document).ready()。虽然我知道我可以把它贴在索引页上，但这真的很混乱而且很糟糕。

我想知道放置它的正确位置在哪里，它还需要特定于主题，因为我不希望所有主题都使用它。

在此先感谢您的帮助。

* * *

甜蜜的成功，谢谢你们的帮助，我对这个问题有最后的修改。现在我已经到了这一步，我需要执行 jQuery 代码来更新文档，我可以使用上下文来修改文档吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-15T08:02:05.737

不是 Drupal 专家，但这篇[博客文章](http://raincitystudios.com/blogs-and-pods/katherine-bailey/the-lowdown-jquery-drupal-part-two)表明，从 Drupal 6 开始，您根本不需要`$(document).ready()`在我们的 jQuery 代码中包含该函数。

相反，您可以将所有代码放在您指定为`Drupal.behaviors`.

> 在`misc/ directory`Drupal 安装中，我们不仅有 jquery.js 文件，而且还有 drupal.js（以及其他几个 js 文件，控制特定于某些页面或管理功能的功能，例如 upload.js），它管理着一般在 Drupal 中使用 jQuery。
> 
> 它声明 Drupal JavaScript 对象的目的是为了包含其他 js 文件需要访问和使用的属性。例如，Drupal.settings 属性用于将一组模块设置传递给该模块的 js 代码。您只需在 php 代码中调用 drupal_add_js() 并确保第二个参数作为“设置”传入，即可完成此操作，例如：

```
drupal_add_js(array('mymodule' => $array_of_settings), 'setting'); 
```

> 然后，在您的 js 文件中，您可以在 Drupal.settings.mymodule 中访问这些设置。因此，您使用 mymodule 属性扩展了 Drupal.settings 对象，该属性本身就是一个包含所有设置的对象。
> 
> Drupal 对象的另一个属性是行为对象，即`Drupal.behaviors`，当我们希望我们的模块添加新的 jQuery 行为时，我们只需扩展这个对象。您的模块的整个 jQuery 代码的结构可以是这样的：

```
Drupal.behaviors.myModuleBehavior = function (context) 
{
    //do some fancy stuff
}; 
```

> 但是，您可能想知道，所做的只是声明一个函数——它是如何被调用的？好吧，**这一切都在 drupal.js 中得到了照顾。它有一个`$(document).ready`调用该函数的`Drupal.attachBehaviors`函数，该函数依次在`Drupal.behaviors`对象中循环调用它的每个属性，这些都是由上述各种模块声明的函数，并作为上下文传入文档**。
> 
> 这样做的原因是，如果您的 jQuery 代码进行 AJAX 调用导致新的 DOM 元素被添加到页面中，您可能希望将您的行为（例如隐藏所有 h3 元素或其他）附加到该新内容好。但是由于它在 DOM 加载并`Drupal.attachBehaviors`运行时并不存在，因此它没有附加任何行为。但是，通过上述设置，您需要做的就是调用`Drupal.behaviors.myModuleBehavior(newcontext)`，`newcontext`新的、AJAX 交付的内容将在哪里，从而确保行为不会再次附加到整个文档。有关如何使用此代码的完整示例，请参见此处

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T08:34:16.623

VonC 充分回答了问题的“如何”部分，因此我将重点关注“在哪里”部分。

如果脚本是特定于主题的，那么放置脚本文件的自然位置就是您的主题。问题是当 Drupal 进入主题时，`$scripts`变量已经被“渲染”（用 Drupal 的说法）成 HTML。要在主题层中添加脚本，您需要添加脚本并重建`$scripts`变量。

假设您使用的是 Drupal 6，这将进入您的`theme_preprocess_page()`函数：

```
drupal_add_js(drupal_get_path('theme', 'theme_name') .'/example.js', 'theme');
$variables['scripts'] = drupal_get_js(); 
```

只需更改第二个参数`drupal_get_path()`以反映主题的名称，然后将脚本文件的名称从更改`example.js`为您为脚本命名的任何名称。

# php - 用于 MySQL 和 PHP 的最佳排序规则是什么？

> ID：367711
> 
> 赞同：776
> 
> 时间：2008-12-15T07:48:36.683
> 
> 标签：php, mysql, encoding, collation

我想知道对于一个您不能 100% 确定将输入什么内容的一般网站，在 MySQL 中是否有“最佳”排序选择？我知道所有的编码都应该是相同的，例如 MySQL、Apache、HTML 和 PHP 中的任何东西。

过去我已将 PHP 设置为以“UTF-8”输出，但是这在 MySQL 中与哪个排序规则匹配？我认为它是 UTF-8 之一，但我使用过`utf8_unicode_ci`, `utf8_general_ci`, 和`utf8_bin`之前。

* * *

## 回答 #1

> 赞同：659
> 
> 时间：2008-12-15T07:58:27.243

主要区别在于排序准确性（比较语言中的字符时）和性能。唯一特殊的是 utf8_bin，它用于比较二进制格式的字符。

`utf8_general_ci`比 快一些`utf8_unicode_ci`，但不太准确（用于排序）。特定语言的*utf8 编码*（例如`utf8_swedish_ci`）包含额外的语言规则，使它们对这些语言进行最准确的排序。大多数时候我使用`utf8_unicode_ci`（我更喜欢准确性而不是小的性能改进），除非我有充分的理由更喜欢特定的语言。

您可以在 MySQL 手册上阅读有关特定 unicode 字符集的更多信息 - [http://dev.mysql.com/doc/refman/5.0/en/charset-unicode-sets.html](http://dev.mysql.com/doc/refman/5.0/en/charset-unicode-sets.html)

* * *

## 回答 #2

> 赞同：141
> 
> 时间：2008-12-15T08:02:37.700

实际上，您可能想使用`utf8_unicode_ci`or `utf8_general_ci`。

*   `utf8_general_ci`通过去除所有重音符号并像 ASCII 一样排序
*   `utf8_unicode_ci`使用 Unicode 排序顺序，因此可以在更多语言中正确排序

但是，如果您只使用它来存储英文文本，那么这些应该没有什么不同。

* * *

## 回答 #3

> 赞同：120
> 
> 时间：2010-06-13T11:02:40.043

非常非常注意使用`utf8_general_ci`.

`utf8_general_ci`当使用排序规则时，MySQL 不会区分 select 语句中的某些字符。这可能会导致非常讨厌的错误——尤其是在涉及用户名的地方。根据使用数据库表的实现，此问题可能允许恶意用户创建与管理员帐户匹配的用户名。

这个问题至少在早期的 5.x 版本中暴露出来——我不确定这种行为后来是否发生了变化。

我不是 DBA，但为了避免这个问题，我总是选择`utf8-bin`不区分大小写的。

下面的脚本通过示例描述了该问题。

```
-- first, create a sandbox to play in
CREATE DATABASE `sandbox`;
use `sandbox`;

-- next, make sure that your client connection is of the same 
-- character/collate type as the one we're going to test next:
charset utf8 collate utf8_general_ci

-- now, create the table and fill it with values
CREATE TABLE `test` (`key` VARCHAR(16), `value` VARCHAR(16) )
    CHARACTER SET utf8 COLLATE utf8_general_ci;

INSERT INTO `test` VALUES ('Key ONE', 'value'), ('Key TWO', 'valúe');

-- (verify)
SELECT * FROM `test`;

-- now, expose the problem/bug:
SELECT * FROM test WHERE `value` = 'value';

--
-- Note that we get BOTH keys here! MySQLs UTF8 collates that are 
-- case insensitive (ending with _ci) do not distinguish between 
-- both values!
--
-- collate 'utf8_bin' doesn't have this problem, as I'll show next:
--

-- first, reset the client connection charset/collate type
charset utf8 collate utf8_bin

-- next, convert the values that we've previously inserted in the table
ALTER TABLE `test` CONVERT TO CHARACTER SET utf8 COLLATE utf8_bin;

-- now, re-check for the bug
SELECT * FROM test WHERE `value` = 'value';

--
-- Note that we get just one key now, as you'd expect.
--
-- This problem appears to be specific to utf8\. Next, I'll try to 
-- do the same with the 'latin1' charset:
--

-- first, reset the client connection charset/collate type
charset latin1 collate latin1_general_ci

-- next, convert the values that we've previously inserted
-- in the table
ALTER TABLE `test` CONVERT TO CHARACTER SET latin1 COLLATE latin1_general_ci;

-- now, re-check for the bug
SELECT * FROM test WHERE `value` = 'value';

--
-- Again, only one key is returned (expected). This shows 
-- that the problem with utf8/utf8_generic_ci isn't present 
-- in latin1/latin1_general_ci
--
-- To complete the example, I'll check with the binary collate
-- of latin1 as well:

-- first, reset the client connection charset/collate type
charset latin1 collate latin1_bin

-- next, convert the values that we've previously inserted in the table
ALTER TABLE `test` CONVERT TO CHARACTER SET latin1 COLLATE latin1_bin;

-- now, re-check for the bug
SELECT * FROM test WHERE `value` = 'value';

--
-- Again, only one key is returned (expected).
--
-- Finally, I'll re-introduce the problem in the exact same 
-- way (for any sceptics out there):

-- first, reset the client connection charset/collate type
charset utf8 collate utf8_generic_ci

-- next, convert the values that we've previously inserted in the table
ALTER TABLE `test` CONVERT TO CHARACTER SET utf8 COLLATE utf8_general_ci;

-- now, re-check for the problem/bug
SELECT * FROM test WHERE `value` = 'value';

--
-- Two keys.
--

DROP DATABASE sandbox; 
```

* * *

## 回答 #4

> 赞同：107
> 
> 时间：2014-08-24T19:57:22.880

**最好使用`utf8mb4`带有排序规则的字符集`utf8mb4_unicode_ci`。**

字符集`utf8`仅支持少量 UTF-8 代码点，大约占可能字符的 6%。`utf8`仅支持基本多语言平面 (BMP)。还有其他 16 架飞机。每个平面包含 65,536 个字符。`utf8mb4`支持所有 17 架飞机。

MySQL 将截断 4 字节的 UTF-8 字符，从而导致数据损坏。

该`utf8mb4`字符集于 2010 年 3 月 24 日在 MySQL 5.5.3 中引入。

**使用新字符集所需的一些更改并非易事：**

*   可能需要在您的应用程序数据库适配器中进行更改。
*   需要对 my.cnf 进行更改，包括设置字符集、排序规则以及将 innodb_file_format 切换为 Barracuda
*   SQL CREATE 语句可能需要包括：`ROW_FORMAT=DYNAMIC`
    *   VARCHAR(192) 和更大的索引需要 DYNAMIC。

注意：切换到`Barracuda`from`Antelope`可能需要多次重启 MySQL 服务。`innodb_file_format_max`直到 MySQL 服务重新启动后才会更改为：`innodb_file_format = barracuda`.

MySQL 使用旧的`Antelope`InnoDB 文件格式。`Barracuda`支持动态行格式，如果您不想在切换到字符集后创建索引和键时遇到 SQL 错误，您将需要这些格式：`utf8mb4`

*   #1709 - 索引列大小太大。最大列大小为 767 字节。
*   #1071 - 指定的密钥太长；最大密钥长度为 767 字节

以下场景已在 MySQL 5.6.17 上测试：默认情况下，MySQL 配置如下：

```
SHOW VARIABLES;

innodb_large_prefix = OFF
innodb_file_format = Antelope 
```

停止 MySQL 服务并将选项添加到现有的 my.cnf：

```
[client]
default-character-set= utf8mb4

[mysqld]
explicit_defaults_for_timestamp = true
innodb_large_prefix = true
innodb_file_format = barracuda
innodb_file_format_max = barracuda
innodb_file_per_table = true

# Character collation
character_set_server=utf8mb4
collation_server=utf8mb4_unicode_ci 
```

示例 SQL CREATE 语句：

```
CREATE TABLE Contacts (
 id INT AUTO_INCREMENT NOT NULL,
 ownerId INT DEFAULT NULL,
 created timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
 modified timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
 contact VARCHAR(640) NOT NULL,
 prefix VARCHAR(128) NOT NULL,
 first VARCHAR(128) NOT NULL,
 middle VARCHAR(128) NOT NULL,
 last VARCHAR(128) NOT NULL,
 suffix VARCHAR(128) NOT NULL,
 notes MEDIUMTEXT NOT NULL,
 INDEX IDX_CA367725E05EFD25 (ownerId),
 INDEX created (created),
 INDEX modified_idx (modified),
 INDEX contact_idx (contact),
 PRIMARY KEY(id)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB ROW_FORMAT=DYNAMIC; 
```

*   您可以看到为`INDEX contact_idx (contact)`if`ROW_FORMAT=DYNAMIC`从 CREATE 语句中删除而生成的错误 #1709。

注意：将索引更改为限制为前 128 个字符可以`contact`消除使用 Barracuda 的要求`ROW_FORMAT=DYNAMIC`

```
INDEX contact_idx (contact(128)), 
```

另请注意：当它说字段的大小是`VARCHAR(128)`时，不是 128 字节。您可以使用 128 个 4 字节字符或 128 个 1 字节字符。

此`INSERT`语句应在 2 行中包含 4 字节的“poo”字符：

```
INSERT INTO `Contacts` (`id`, `ownerId`, `created`, `modified`, `contact`, `prefix`, `first`, `middle`, `last`, `suffix`, `notes`) VALUES
(1, NULL, '0000-00-00 00:00:00', '2014-08-25 03:00:36', '1234567890', '12345678901234567890', '1234567890123456789012345678901234567890', '1234567890123456789012345678901234567890', '12345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678', '', ''),
(2, NULL, '0000-00-00 00:00:00', '2014-08-25 03:05:57', 'poo', '12345678901234567890', '', '', '', '', ''),
(3, NULL, '0000-00-00 00:00:00', '2014-08-25 03:05:57', 'poo', '12345678901234567890', '', '', '123', '', ''); 
```

您可以看到该`last`列使用的空间量：

```
mysql> SELECT BIT_LENGTH(`last`), CHAR_LENGTH(`last`) FROM `Contacts`;
+--------------------+---------------------+
| BIT_LENGTH(`last`) | CHAR_LENGTH(`last`) |
+--------------------+---------------------+
|               1024 |                 128 | -- All characters are ASCII
|               4096 |                 128 | -- All characters are 4 bytes
|               4024 |                 128 | -- 3 characters are ASCII, 125 are 4 bytes
+--------------------+---------------------+ 
```

在您的数据库适配器中，您可能希望为您的连接设置字符集和排序规则：

```
SET NAMES 'utf8mb4' COLLATE 'utf8mb4_unicode_ci' 
```

在 PHP 中，这将被设置为：`\PDO::MYSQL_ATTR_INIT_COMMAND`

参考：

*   [Mysql 5.6 参考手册：InnoDB 表的限制](http://dev.mysql.com/doc/refman/5.6/en/innodb-restrictions.html)
*   [如何在 MySQL 数据库中支持完整的 Unicode](https://mathiasbynens.be/notes/mysql-utf8mb4)

* * *

## 回答 #5

> 赞同：47
> 
> 时间：2008-12-15T08:04:36.323

排序规则影响数据的排序方式以及字符串相互比较的方式。这意味着您应该使用大多数用户期望的排序规则。

[charset unicode 文档中的](https://dev.mysql.com/doc/refman/5.5/en/charset-unicode-sets.html)示例：

> `utf8_general_ci`对德语和法语也都满意，除了 'ß' 等于 's' 而不是 'ss'。如果这对您的应用程序是可以接受的，那么您应该使用 `utf8_general_ci`它，因为它更快。否则，使用它，`utf8_unicode_ci`因为它更准确。

所以 - 这取决于您预期的用户群以及您需要多少*正确*排序。对于英语用户群，`utf8_general_ci`应该就足够了，对于其他语言，如瑞典语，已经创建了特殊的排序规则。

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2010-12-07T01:42:37.667

本质上，这取决于您如何看待字符串。

由于 Guus 强调的问题，我总是使用 utf8_bin。在我看来，就数据库而言，字符串仍然只是一个字符串。字符串是多个 UTF-8 字符。一个字符有一个二进制表示，那么为什么它需要知道你正在使用的语言呢？通常，人们将为具有多语言站点范围的系统构建数据库。这就是使用 UTF-8 作为字符集的重点。我有点纯粹主义者，但我认为错误风险大大超过了您在索引上可能获得的轻微优势。任何与语言相关的规则都应该在比 DBMS 更高的级别上完成。

在我的书中，“价值”永远不应该在一百万年内等于“价值”。

如果我想存储一个文本字段并进行不区分大小写的搜索，我将使用 MYSQL 字符串函数和 PHP 函数，例如 LOWER() 和 php 函数 strtolower()。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2008-12-15T07:55:17.607

对于 UTF-8 文本信息，您应该使用`utf8_general_ci`，因为...

*   `utf8_bin`: 通过字符串中每个字符的二进制值比较字符串

*   `utf8_general_ci`: 使用通用语言规则和不区分大小写的比较来比较字符串

aka 它应该使搜索和索引数据更快/更有效/更有用。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2013-07-30T13:20:02.873

公认的答案相当明确地建议使用 utf8_unicode_ci，虽然对于很棒的新项目，我想把我最近的相反经验联系起来，以防万一它节省了任何人的时间。

因为 utf8_general_ci 是 MySQL 中 Unicode 的默认排序规则，所以如果你想使用 utf8_unicode_ci 那么你最终不得不在*很多*地方指定它。

例如，所有客户端连接不仅有一个默认字符集（对我来说很有意义），而且还有一个默认排序规则（即排序规则将始终默认为 utf8_general_ci 用于 unicode）。

很可能，如果您将 utf8_unicode_ci 用于字段，则需要更新连接到数据库的脚本以明确提及所需的排序规则——否则当您的连接使用默认排序规则时，使用文本字符串的查询可能会失败。

结果是，当将任何大小的现有系统转换为 Unicode/utf8 时，由于 MySQL 处理默认值的方式，您最终可能被迫使用 utf8_general_ci。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2012-05-08T13:27:45.163

对于 Guus 强调的案例，我强烈建议使用 utf8_unicode_cs （区分大小写，严格匹配，大多数情况下正确排序）而不是 utf8_bin （严格匹配，错误排序）。

如果要搜索该字段，而不是为用户匹配，则使用 utf8_general_ci 或 utf8_unicode_ci。两者都不区分大小写，一个会丢失匹配（'ß' 等于's'，而不是'ss'）。还有特定语言的版本，例如 utf8_german_ci，其中丢失匹配更适合指定的语言。

[编辑 - 将近 6 年后]

我不再推荐 MySQL 上的“utf8”字符集，而是推荐“utf8mb4”字符集。它们几乎完全匹配，但允许更多的 unicode 字符。

实际上，MySQL 应该更新“utf8”字符集和相应的排序规则以匹配“utf8”规范，但是，一个单独的字符集和相应的排序规则不会影响那些已经使用其不完整的“utf8”字符集的存储指定.

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2015-04-12T12:34:37.283

我发现这些整理图表很有帮助。[http://collat​​ion-charts.org/mysql60/](http://collation-charts.org/mysql60/)。我不确定哪个是使用的 utf8_general_ci。

例如，这里是 utf8_swedish_ci 的图表。它显示了它解释为相同的字符。[http://collat​​ion-charts.org/mysql60/mysql604.utf8_swedish_ci.html](http://collation-charts.org/mysql60/mysql604.utf8_swedish_ci.html)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-06-23T06:01:30.543

在您的数据库上传文件中，在任何行之前添加以下行：

```
SET NAMES utf8; 
```

你的问题应该得到解决。

# objective-c - Cocoa 中的辅助函数

> ID：367724
> 
> 赞同：19
> 
> 时间：2008-12-15T07:58:11.517
> 
> 标签：objective-c, cocoa

在 Obj-C 类中合并帮助器/实用程序函数的标准方法是什么？

即在整个应用程序中使用并由超过 1 个类调用的通用函数。

Obj-C 方法可以存在于类之外，还是必须是 C 函数才能具有这种行为？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-15T08:33:21.633

我会将类似的函数分组为辅助类中的静态方法。然后可以使用类名而不是实例名来调用它们。静态方法用 + 而不是通常的 - 定义。

像这样：

```
@interface HelperClass: superclassname {
    // instance variables - none if all methods are static.
}

+ (void) helperMethod: (int) parameter_varName;

@end 
```

这将被称为这样。

```
[HelperClass helperMethod: 10 ]; 
```

由于这是静态的，因此您无需初始化/分配该类。这样做的好处是可以像 Helper 函数一样清晰地分组。您可以使用独立的 C 函数，但随着您的应用程序变大，它可能会变得一团糟！希望这可以帮助。

托尼

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-12-15T17:09:04.137

我不明白为什么人们会避免创建函数。Objective-C 是 C 的超集，这意味着 C 是它的一部分。而且，它是完全集成的——它们之间没有墙。

创建函数！没关系！基金会做到了。应用程序工具包做到了。核心动画做到了。核心媒体做到了。

我认为没有理由不这样做。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-15T08:55:56.580

在 Objective-C 中有许多选项。首先，由于 Obj-C 是 C 的严格超集，您可以在单独的模块（源文件）中定义所有库函数，并愉快地从您已有的任何 Obj-C 对象/代码中调用它们。如果您创建一个 obj-c 源文​​件（.m 文件），您可以回调到/使用对象。

如果您的泛型函数在逻辑上操作其他已建立的对象（例如，对 NSString 进行操作），您可以使用类别在现有类上绘制函数图（这是有意义的）。

最后，正如 Tony 指出的那样，您可以使用静态方法创建类（尽管我个人最不喜欢这个选项）。我倾向于使用一个和两个的混合......在适当的地方添加类别并为其他人使用标准功能。我通常只在设计类有意义的地方创建一个新类。

# c# - 如何在两个项目之间创建接口，未引用

> ID：367726
> 
> 赞同：1
> 
> 时间：2008-12-15T08:00:09.733
> 
> 标签：c#, interface

不同项目中的两个类如何相互通信？

如果 ClassA 引用 ClassB 我可以访问 ClassA 中 ClassB 的方法...如何利用接口访问 ClassB 中 ClassA 的方法？

如果我使用接口，确实需要链接这些类吗？

有人可以给我一个例子吗？

使用 C# 2.0 进行编码。

* * *

我的意思是上课。如果我有两个未引用的项目，但我想从另一个访问一个类中的方法......我如何使用接口来实现这一点。

有人暗示我这是我应该使用的，但是如果不引用项目，我很难理解如何实现接口。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T08:14:32.717

我假设您的意思是程序集，而不是类。

你有两个选择，要么使用 System.Reflection 命名空间（肮脏的方式），然后你甚至不需要任何接口，只需通过反射调用方法。

```
System.Reflection.Assembly.LoadFile("MyProject.dll").GetType("MyProject.TestClass").GetMethod("TestMethod").Invoke(); 
```

或者干净的方式，只使用接口创建 AssemblyZ 并让两个程序集（A 和 B）中的类来实现这些接口。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T08:21:16.057

您可以使用接口多态性通过接口从 B 访问 A 类的功能。

```
class B
{

   Public sub DoSomethingOnA(IA a )
   {
        a.DoSomething();
   }

}

Interface IA
{
    void DoSomething();
}

Class A : IA
{
    void DoSomething()
   {
       //
   }

} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T09:14:38.243

1.  在 Link Assembly 中，只需定义接口：

    ```
    Public Interface IA { void DoSomething(); }

    Public Interface IB { void DoSomething(); } 
    ```

2.  从另一个具有 A 类的程序集引用链接程序集：

    ```
    class A : LinkAssembly.IA {

    Public sub DoSomethingOnB(IB b ) { b.DoSomething(); }

    Public sub DoSomething(){// }

    } 
    ```

3.  与 A 类一样的 B 类：

    ```
    class B : LinkAssembly.IB {

    Public sub DoSomethingOnA(IA a ) { a.DoSomething(); }

    Public sub DoSomething(){// }

    } 
    ```

# c# - 如何更改 XML 属性

> ID：367730
> 
> 赞同：64
> 
> 时间：2008-12-15T08:02:22.507
> 
> 标签：c#, xml, linq-to-xml, xmldocument

如何使用 C# 更改 XML 文件中元素的属性？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-12-15T10:40:18.367

麦克风; 每次我需要修改 XML 文档时，我都是这样工作的：

```
//Here is the variable with which you assign a new value to the attribute
string newValue = string.Empty;
XmlDocument xmlDoc = new XmlDocument();

xmlDoc.Load(xmlFile);

XmlNode node = xmlDoc.SelectSingleNode("Root/Node/Element");
node.Attributes[0].Value = newValue;

xmlDoc.Save(xmlFile);

//xmlFile is the path of your file to be modified 
```

希望对你有帮助

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2008-12-15T08:31:31.840

如果您使用的是框架 3.5，则使用 LINQ to xml：

```
using System.Xml.Linq;

XDocument xmlFile = XDocument.Load("books.xml"); 

var query = from c in xmlFile.Elements("catalog").Elements("book")    
            select c; 

foreach (XElement book in query) 
{
   book.Attribute("attr1").Value = "MyNewValue";
}

xmlFile.Save("books.xml"); 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2015-01-06T14:47:45.323

如果您要更改的属性不存在或已被意外删除，则会发生异常。我建议您首先创建一个新属性并将其发送到如下函数：

```
private void SetAttrSafe(XmlNode node,params XmlAttribute[] attrList)
    {
        foreach (var attr in attrList)
        {
            if (node.Attributes[attr.Name] != null)
            {
                node.Attributes[attr.Name].Value = attr.Value;
            }
            else
            {
                node.Attributes.Append(attr);
            }
        }
    } 
```

用法：

```
 XmlAttribute attr = dom.CreateAttribute("name");
   attr.Value = value;
   SetAttrSafe(node, attr); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-05-31T17:40:00.530

这是解析器类的开始，可以帮助您入门。这最终成为我对类似问题的解决方案：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Xml.Linq;

namespace XML
{
    public class Parser
    {

        private string _FilePath = string.Empty;

        private XDocument _XML_Doc = null;

        public Parser(string filePath)
        {
            _FilePath = filePath;
            _XML_Doc = XDocument.Load(_FilePath);
        }

        /// <summary>
        /// Replaces values of all attributes of a given name (attributeName) with the specified new value (newValue) in all elements.
        /// </summary>
        /// <param name="attributeName"></param>
        /// <param name="newValue"></param>
        public void ReplaceAtrribute(string attributeName, string newValue)
        {
            ReplaceAtrribute(string.Empty, attributeName, new List<string> { }, newValue);
        }

        /// <summary>
        /// Replaces values of all attributes of a given name (attributeName) with the specified new value (newValue) in elements with a given name (elementName).
        /// </summary>
        /// <param name="elementName"></param>
        /// <param name="attributeName"></param>
        /// <param name="newValue"></param>
        public void ReplaceAtrribute(string elementName, string attributeName, string newValue)
        {
            ReplaceAtrribute(elementName, attributeName, new List<string> { }, newValue);
        }

        /// <summary>
        /// Replaces values of all attributes of a given name (attributeName) and value (oldValue)  
        /// with the specified new value (newValue) in elements with a given name (elementName).
        /// </summary>
        /// <param name="elementName"></param>
        /// <param name="attributeName"></param>
        /// <param name="oldValue"></param>
        /// <param name="newValue"></param>
        public void ReplaceAtrribute(string elementName, string attributeName, string oldValue, string newValue)
        {
            ReplaceAtrribute(elementName, attributeName, new List<string> { oldValue }, newValue);              
        }

        /// <summary>
        /// Replaces values of all attributes of a given name (attributeName), which has one of a list of values (oldValues), 
        /// with the specified new value (newValue) in elements with a given name (elementName).
        /// If oldValues is empty then oldValues will be ignored.
        /// </summary>
        /// <param name="elementName"></param>
        /// <param name="attributeName"></param>
        /// <param name="oldValues"></param>
        /// <param name="newValue"></param>
        public void ReplaceAtrribute(string elementName, string attributeName, List<string> oldValues, string newValue)
        {
            List<XElement> elements = _XML_Doc.Elements().Descendants().ToList();

            foreach (XElement element in elements)
            {
                if (elementName == string.Empty | element.Name.LocalName.ToString() == elementName)
                {
                    if (element.Attribute(attributeName) != null)
                    {

                        if (oldValues.Count == 0 || oldValues.Contains(element.Attribute(attributeName).Value))
                        { element.Attribute(attributeName).Value = newValue; }
                    }
                }
            }

        }

        public void SaveChangesToFile()
        {
            _XML_Doc.Save(_FilePath);
        }

    }
} 
```

# asp.net - Windows Web Server 2008 可以用来托管游戏吗？

> ID：367737
> 
> 赞同：0
> 
> 时间：2008-12-15T08:07:00.080
> 
> 标签：asp.net, windows-server-2008

我目前正在使用 linux 服务器，我们运行它的几个网站，通常使用 MySQL 的 PHP 应用程序。由于该服务器由一些朋友和我自己私人拥有（尽管我们确实将它托管在专业数据中心），因此我们有时还会使用它来托管我们的小型反恐精英源和使命召唤 4 比赛，方法是运行已发布的专用游戏服务器包。

我最近订阅了 DevExpress 的优秀 WinForms 和 ASP.Net 组件套件，并且正在考虑迁移到 Windows 以利用这些 ASP.Net 组件。我目前正在尝试在 Windows Server 的 Web 版和标准版之间做出决定，因为相差将近一千美元（我来自哪里）

对于 Windows Web Server 2008，Microsoft 已经放宽了对数据库服务器的限制，并明确表示不需要 CAL。但是一个人能够运行上面提到的网络服务器吗？我一直在谷歌搜索和搜索论坛无济于事。

在我投入现金之前需要一些帮助。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T09:45:03.470

在发表任何意见之前，我将首先回答您的核心问题：

*   是的，您可以在 Windows Server Web ed 上运行专用游戏服务器。

*   Web与标准的区别：

    *   Web 仅支持 2 gigs 的 ram。64 位模式下的标准可以支持 32gigs（以及更多？）。
    *   标准附带了更多更适合本地服务器环境的东西（例如：活动目录）。如果您想要 LDAP 控制的 Exchange 电子邮件，则需要 Standard。大多数网络服务器不需要这些。
    *   Web（显然）不支持完整的 SQL 服务器版本。快递应该运行。

意见时间。

Windows 服务器上的专用和虚拟专用货币开销很多……在某种程度上，您为软件支付的费用高于硬件成本，至少在第一年是这样。

租用软件（作为托管专用服务器或 VPS 的一部分）最初会便宜很多，但在几年的过程中，您的成本将大致相同，如果运行时间更长，最终会花费更多.

共享的 Windows 主机可能很好。我曾在一家名为[Hostek](http://www.hostek.com)（总部位于佛罗里达州）的公司工作，他们竭尽全力让托管一个相当繁忙的网站（每天大约 6000 个独立用户）对我来说非常便宜。它也可能是残酷的。我也有糟糕的托管公司。货比三家。

大约一年前，我放弃了家里的 Windows，转而使用 Linux。我不打算列举许多优点和缺点。我只是告诉你，那是我停止使用 .NET 转而支持更开放的框架的时候。我没有使用 Django（基于 Python 的 Web 框架）。虽然您可能不喜欢它（或其他框架 - 例如 Ruby on Rails），**但我恳请您在为任何与 Windows 相关的东西之前检查一下开源世界中正在发生的事情，**因为您已经拥有可用于托管 Django/ 的基础架构/导轨/等。

如果您想要*自己的*Linux 服务器，VPS 的起价约为 20 美元。正如我之前所说，比 Windows 同行便宜得多。我现在使用[Linode](http://linode.com)来托管我制作的所有新东西。价格实惠，他们可以像您当前的设置一样轻松运行专用游戏。

Mono 不适合您。反正还没有。它确实在帮助人们迁移他们的应用程序方面做了一些工作，但在 ASPNET 方面仍然很粗略。正如对另一个答案的评论所说：您要使用的控件目前严格仅限于 Windows。

Linux 将比 Windows 消耗更少的基线资源。在我必须管理的旧服务器（Windows 2000、IIRC）上，Windows 的核心将消耗 100-200 兆的 RAM。我当前的 Ubuntu 服务器吃了 40 兆。我不确定您必须在服务器上使用多少 RAM，但如果数量较少，您将在 Linux 主机上安装更多内存。（请记住，如果您有超过 2gigs，您没有 Web Server 版本的选择）

从这里可以清楚地看出我是一个完全的 Linux 超级爱好者，但我知道我的需求与你的不同。**ASP.NET 是一个*很棒的*平台**，但即使你在朋友之间分享它也会花费很多钱。你可以选择 Windows... 或者你可以选择 Linux，为你使用的项目捐一点钱，然后为这位女士购买新的等离子或闪亮的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T08:36:20.380

苏丹解放军？这不是针对服务提供商的吗？我和我的朋友为自己使用托管服务（游戏、电子邮件和网络），当然我们的网站是所有人都可以公开查看的；但我认为这几乎算不上“提供服务”？

不幸的是，继续使用 Linux 会使我无法使用我的 DevExpress 组件，这也是我首先考虑 Windows Server 的原因。Mono 可能部分支持 .NET，但不完全支持，DevExpress 使用了 Mono 不（至少目前）不支持的 .NET 的某些功能。

我们也已经拥有自己的专用服务器，因此只是在寻找合适的操作系统。

尽管如此，您的回复还是值得赞赏的。

# nhibernate - 如何为多对一设置最大返回结果

> ID：367739
> 
> 赞同：0
> 
> 时间：2008-12-15T08:08:45.100
> 
> 标签：nhibernate

我有一个与价格类有一对多关系的产品类。所以一个产品可以有多个价格。

我需要查询 db 以获得 10 个 Price.amount < $2 的产品。在这种情况下，它会在一个页面中填充一个包含 10 个项目的 UI。所以我写了以下代码：

```
ICriteria criteria = session.CreateCriteria(typeof(Product));

criteria.SetFirstResult(pageNumber);
criteria.SetMaxResults(numberOfItemInPage);

criteria = criteria.CreateCriteria("PriceCollection");
criteria.Add(Restrictions.Le("Amount", new Decimal(2)));
criteria.SetResultTransformer(CriteriaSpecification.DistinctRootEntity); 
```

而不是在列表中获得 10 个产品，我得到的少于那个（即 5 个）。原因是 SetMaxResults(10) 向我返回 10 个产品但有重复项。然后通过 SetResultTransformer(DistinctRootEntity) 删除重复项。

谁能告诉我有什么方法可以让我在不增加 SetMaxResults() 的情况下获得 10 个独特的产品？我需要使用 pagenumber 作为某种索引。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-15T08:19:13.487

这将由 SQL 来决定，具体取决于获取列表的方法中发生的情况，您需要更改 SQL 以使其行为符合您的喜好。

但由于不同，你不应该得到任何重复。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T10:25:42.623

您的重复问题似乎源于您要加入两个表的事实，因此您可以获得相同产品的次数与您的价格相同。

如何在您的产品表中添加 2 个额外的列：

```
MinimumPrice (numeric(18,2)
MaximumPrice (numeric(18,2) 
```

每当您的系统修改产品的定价时，您都会更新产品上的这两个字段。现在您可以编写如下 SQL 查询：

```
SELECT TOP 10 * FROM Product
WHERE MinimumPrice > 2.0 
```

而且您不会有重复的产品。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-15T09:09:53.370

语句的顺序会有所不同吗？看起来它提前设置了最大计数，并在最后清除了重复项，按该顺序应用可能最终会少于您限制的数量，这与您描述的情况一致。

我认为您需要有效地获得所有结果，然后应用限制（可能还有排序？）并清除重复项，然后最后将分页或计数限制应用于那些获得前 10 个，下一个 10 ， 等等。因此，重新排序语句以反映此逻辑顺序可能有助于修复您的错误。

# macos - 创建 .DMG

> ID：367751
> 
> 赞同：20
> 
> 时间：2008-12-15T08:17:39.183
> 
> 标签：macos, dmg

我想为我的 Mac 项目创建一个 dmg 文件。有人可以告诉我该怎么做吗？这是我的第一个 Mac 项目，我不知道如何进行。我还想给用户一个在启动时运行应用程序的选项。我该怎么做呢？

谢谢。

PS 我还想添加自定义许可协议。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-15T09:12:21.773

要手动执行此操作：

**方法一：**

*   使用 DMG 将包含的文件创建一个文件夹。

[![在此处输入图像描述](https://i.stack.imgur.com/sOBin.png)](https://i.stack.imgur.com/sOBin.png)

*   打开磁盘工具（位于`/Applications/Utilities/`）

[![在此处输入图像描述](https://i.stack.imgur.com/Px0Zh.png)](https://i.stack.imgur.com/Px0Zh.png)

*   转到文件 > 新建 > 从文件夹中新建图像 ( `Cmd + Shift + N`)

[![在此处输入图像描述](https://i.stack.imgur.com/T2owv.png)](https://i.stack.imgur.com/T2owv.png)

*   选择包含您的文件的文件夹
*   确保选中“压缩”，然后设置要保存创建的 DMG 的位置

[![在此处输入图像描述](https://i.stack.imgur.com/cgTGZ.png)](https://i.stack.imgur.com/cgTGZ.png)

[![在此处输入图像描述](https://i.stack.imgur.com/Oc9m1.png)](https://i.stack.imgur.com/Oc9m1.png)

[![在此处输入图像描述](https://i.stack.imgur.com/u58MR.png)](https://i.stack.imgur.com/u58MR.png)

**方法二：**

要执行诸如设置背景图像之类的事情可能有点复杂（您基本上将背景图像添加到 DMG，设置 Windows 属性以使用该图像，使用命令行将背景图像从移动`background.png`到`.background.png`使其隐藏）

我会推荐[iDMG](http://www.nscoding.co.uk/)，这会让事情变得不那么乏味。

您还可以使用该命令编写 DMG 创建脚本`hdiutil`。类似的东西

```
hdiutil create -srcfolder mydirtodmg mydmg.dmg 
```

[![在此处输入图像描述](https://i.stack.imgur.com/8pYQb.png)](https://i.stack.imgur.com/8pYQb.png)

至于自定义许可协议，您应该查看开发人员工具“PackageMaker”中包含的工具 - 它非常不言自明。在里面`/Developers/Application/Utilities/`

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-12-21T04:36:38.740

如果您需要将自定义 EULA 添加到磁盘映像，[此页面](https://web.archive.org/web/20140930100454/http://www.owsiak.org/?p=700 "这一页")描述了如何使用命令行工具执行此操作。它的要点是使用 Apple 的 slas_for_udifs_1.0.dmg 中提供的模板软件许可协议资源，使用您的 EULA 文本修改资源并将资源注入到您的磁盘映像文件中。（如果上述链接不可用，我会在下面提供简要说明，并更新它在步骤 1 中提供的搜索词。）

1.  使用您的 Apple 开发人员帐户转到[下载](https://developer.apple.com/downloads/)页面并搜索*UDIF 的软件许可*
2.  下载并挂载磁盘映像
3.  在终端：

    > ```
    > cd /Volumes/SLAs_for_UDIFs_1.0
    > DeRez SLAResources > /tmp/sla.r 
    > ```

4.  在文本编辑器中编辑 /tmp/sla.r，更新`data 'TEXT' (5000, "English SLA")`资源内容以包含新的许可证文本。

5.  展开包含安装程序的磁盘映像文件：

    > hdiutil unflatten installer_image.dmg

6.  将编辑后的许可资源添加到镜像中：

    > Rez -a /tmp/sla.r -o installer_image.dmg

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-10T15:35:24.333

你为什么不从你的 xcode 项目中运行一个脚本。尝试这样的事情：

```
# be sure to check the man page for hdiutil
# it is very powerful and has tons of options...

hdiutil create -megabytes 54 -fs HFS+ -volname awesome_app_install myAwesomeApplication.dmg
hdiutil mount myAwesomeApplication.dmg
cp -r /build/Release/AwesomeApplication.app /Volumes/awesome_app_install/ 
```

然后将您的脚本保存为“makeDMG.sh”之类的内容并保存在您的目标中，

选择添加->新构建阶段->运行脚本构建阶段
并将您的脚本拖到此构建阶段。

一旦你完成了所有这些，那么当你构建你的项目时，脚本将创建磁盘映像并将你的发布版本复制到其中......

当然你应该为你的脚本添加香料......这三行只是生肉

ps：您的自定义 EULA 应该内置到您的 packagemaker 项目中（您也可以很好地编写脚本）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-11-19T11:37:27.537

我制作了一个小 bash 脚本来自动创建光盘映像。

它会创建一个临时目录来存储所有需要的文件，然后将其导出到新的 DMG 文件中。然后删除临时目录。您可以在构建过程结束时自动启动此脚本。

```
#!/bin/bash
# Create .dmg file for macOS

# Adapt these variables to your needs
APP_VERS="1.0"
DMG_NAME="MyApp_v${APP_VERS}_macos"
OUTPUT_DMG_DIR="path_to_output_dmg_file"
APP_FILE="path_to_my_app/MyApp.app"
OTHER_FILES_TO_INCLUDE="path_to_other_files"

# The directory of the script
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# The temp directory used, within $DIR
WORK_DIR=`mktemp -d "${DIR}/tmp"`

# Check if tmp dir was created
if [[ ! "${WORK_DIR}" || ! -d "${WORK_DIR}" ]]; then
    echo "Could not create temp dir"
    exit 1
fi

# Function to deletes the temp directory
function cleanup {
    rm -rf "${WORK_DIR}"
    #echo "Deleted temp working directory ${WORK_DIR}"
}

# Register the cleanup function to be called on the EXIT signal
trap cleanup EXIT

# Copy application on temp dir
cp -R "${APP_FILE}" "${WORK_DIR}"
# Copy other files without hidden files
rsync -a --exclude=".*" "${OTHER_FILES_TO_INCLUDE}" "${WORK_DIR}"

# Create .dmg
hdiutil create -volname "${DMG_NAME}" -srcfolder "${WORK_DIR}" -ov -format UDZO "${OUTPUT_DMG_DIR}/${DMG_NAME}.dmg" 
```

# javascript - 无法将 onclick 处理程序添加到 listitem 内的超链接标记

> ID：367752
> 
> 赞同：1
> 
> 时间：2008-12-15T08:19:07.527
> 
> 标签：javascript, onclick, handler

尝试向我的选项卡添加 onclick 处理程序，但似乎无法正确选择 DOM。你们能帮忙吗？

```
 <div id="tabstrip">
    <ul>
      <li id="a" class="selected"><a href="#">A</a></li>
      <li id="b"><a href="#">B</a></li>
      <li id="b"><a href="#">C</a></li>
    </ul>
  </div>

function initTabStrip()
{
  var lis = document.getElementById('tabstrip').getElementsByTagName('li');
  for (var i=0;i<items.length;i++)
  {
    var as = items[i].getElementsByTagName('a');
    for (var j=0;j<as.length;j++)
    {
      as[j].onclick=function(){changeTab(items[i].id);return false}
    }
  }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T08:35:37.743

好像你的关闭是错误的。尝试

```
as[j].onclick = function(items, i)
{
    return function()
    {
        changeTab(items[i].id);
        return false;
    };
}(items, i); 
```

如果它有效，那么问题是[jQuery 闭包、循环和事件的欺骗](https://stackoverflow.com/questions/359467/jquery-closures-loops-and-events#359505)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T08:44:39.863

我同意 RoBorg 并建议阅读有关 JavaScript 作用域的内容。它会解释很多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T08:48:32.070

你的 JS 的第一行，你创建`var lis`，然后你迭代`items`. 这真的是你想要的吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T09:48:44.337

完整的功能，由 RoBerg 建议的更改：

```
function initTabStrip()
{
  var tabstrip = document.getElementById('tabstrip');
  var items = tabstrip.getElementsByTagName('li');
  for (var i=0;i<items.length;i++)
  {
    var as = items[i].getElementsByTagName('a');
    for (var j=0;j<as.length;j++)
    {
      as[j].onclick = function(items, i)
      {
        return function()
        {
          changeTab(items[i].id);
          return false;
        };
      }(items, i);
    }
  } 
```

}

# c# - 如何确定 DLL 是托管程序集还是本机（防止加载本机 dll）？

> ID：367761
> 
> 赞同：30
> 
> 时间：2008-12-15T08:22:25.557
> 
> 标签：c#, plugins, dll, assemblies, native

## 原标题：如何防止从 .NET 应用程序加载本机 dll？

**背景：**

我的 C# 应用程序包括一个插件框架和通用插件加载器。

插件加载器枚举应用程序目录以识别插件 dll（本质上它此时搜索 *.dll）。

在同一个应用程序目录中是一个本地（Windows，非 .net）dll，它间接依赖于插件 dll 之一。

插件加载器盲目地假设 native.dll 是一个 .NET 程序集 dll，仅仅是因为它只检查文件扩展名。当它尝试加载本机 dll 时，会引发异常：

“无法加载文件或程序集‘native.dll’或其依赖项之一。该模块应包含程序集清单。”

如果插件加载失败，我基本上会创建一个诊断报告，所以我试图避免让这个日志充满关于无法加载本机 dll 的消息（我什至不想尝试）。

**问题：**

是否有一些 .NET API 调用可用于确定二进制文件是否恰好是 .NET 程序集，以便我根本不尝试加载本机 dll？

也许从长远来看，我会将我的插件移动到一个子目录，但现在，我只想要一个不涉及在我的插件加载器中硬编码“native.dll”名称的解决方法。

我想我正在寻找某种我忽略的静态 Assembly.IsManaged() API 调用......大概不存在这样的 API？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2013-03-25T05:09:07.310

lubos hasko 引用的答案很好，但它不适用于 64 位程序集。这是一个更正的版本（灵感来自[http://apichange.codeplex.com/SourceControl/changeset/view/76c98b8c7311#ApiChange.Api/src/Introspection/CorFlagsReader.cs](http://apichange.codeplex.com/SourceControl/changeset/view/76c98b8c7311#ApiChange.Api/src/Introspection/CorFlagsReader.cs)）

```
public static bool IsManagedAssembly(string fileName)
{
    using (Stream fileStream = new FileStream(fileName, FileMode.Open, FileAccess.Read))
    using (BinaryReader binaryReader = new BinaryReader(fileStream))
    {
        if (fileStream.Length < 64)
        {
            return false;
        }

        //PE Header starts @ 0x3C (60). Its a 4 byte header.
        fileStream.Position = 0x3C;
        uint peHeaderPointer = binaryReader.ReadUInt32();
        if (peHeaderPointer == 0)
        {
            peHeaderPointer = 0x80;
        }

        // Ensure there is at least enough room for the following structures:
        //     24 byte PE Signature & Header
        //     28 byte Standard Fields         (24 bytes for PE32+)
        //     68 byte NT Fields               (88 bytes for PE32+)
        // >= 128 byte Data Dictionary Table
        if (peHeaderPointer > fileStream.Length - 256)
        {
            return false;
        }

        // Check the PE signature.  Should equal 'PE\0\0'.
        fileStream.Position = peHeaderPointer;
        uint peHeaderSignature = binaryReader.ReadUInt32();
        if (peHeaderSignature != 0x00004550)
        {
            return false;
        }

        // skip over the PEHeader fields
        fileStream.Position += 20;

        const ushort PE32 = 0x10b;
        const ushort PE32Plus = 0x20b;

        // Read PE magic number from Standard Fields to determine format.
        var peFormat = binaryReader.ReadUInt16();
        if (peFormat != PE32 && peFormat != PE32Plus)
        {
            return false;
        }

        // Read the 15th Data Dictionary RVA field which contains the CLI header RVA.
        // When this is non-zero then the file contains CLI data otherwise not.
        ushort dataDictionaryStart = (ushort)(peHeaderPointer + (peFormat == PE32 ? 232 : 248));
        fileStream.Position = dataDictionaryStart;

        uint cliHeaderRva = binaryReader.ReadUInt32();
        if (cliHeaderRva == 0)
        {
            return false;
        }

        return true;
    }
} 
```

缺少的部分是根据我们是 PE32 还是 PE32Plus 以不同的方式偏移到数据字典开始：

```
 // Read PE magic number from Standard Fields to determine format.
    var peFormat = binaryReader.ReadUInt16();
    if (peFormat != PE32 && peFormat != PE32Plus)
    {
        return false;
    }

    // Read the 15th Data Dictionary RVA field which contains the CLI header RVA.
    // When this is non-zero then the file contains CLI data otherwise not.
    ushort dataDictionaryStart = (ushort)(peHeaderPointer + (peFormat == PE32 ? 232 : 248)); 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-15T08:50:30.553

[**如何确定文件是否为 .NET 程序集？**](http://geekswithblogs.net/rupreet/archive/2005/11/02/58873.aspx)

```
public static bool IsManagedAssembly(string fileName)
{
    uint peHeader;
    uint peHeaderSignature;
    ushort machine;
    ushort sections;
    uint timestamp;
    uint pSymbolTable;
    uint noOfSymbol;
    ushort optionalHeaderSize;
    ushort characteristics;
    ushort dataDictionaryStart;
    uint[] dataDictionaryRVA = new uint[16];
    uint[] dataDictionarySize = new uint[16];

    Stream fs = new FileStream(fileName, FileMode.Open, FileAccess.Read);
    BinaryReader reader = new BinaryReader(fs);

    //PE Header starts @ 0x3C (60). Its a 4 byte header.
    fs.Position = 0x3C;
    peHeader = reader.ReadUInt32();

    //Moving to PE Header start location...
    fs.Position = peHeader;
    peHeaderSignature = reader.ReadUInt32();

    //We can also show all these value, but we will be       
    //limiting to the CLI header test.
    machine = reader.ReadUInt16();
    sections = reader.ReadUInt16();
    timestamp = reader.ReadUInt32();
    pSymbolTable = reader.ReadUInt32();
    noOfSymbol = reader.ReadUInt32();
    optionalHeaderSize = reader.ReadUInt16();
    characteristics = reader.ReadUInt16();

    // Now we are at the end of the PE Header and from here, the PE Optional Headers starts... To go directly to the datadictionary, we'll increase the stream’s current position to with 96 (0x60). 96 because, 28 for Standard fields 68 for NT-specific fields From here DataDictionary starts...and its of total 128 bytes. DataDictionay has 16 directories in total, doing simple maths 128/16 = 8\. So each directory is of 8 bytes. In this 8 bytes, 4 bytes is of RVA and 4 bytes of Size. btw, the 15th directory consist of CLR header! if its 0, its not a CLR file :)
    dataDictionaryStart = Convert.ToUInt16(Convert.ToUInt16(fs.Position) + 0x60);
    fs.Position = dataDictionaryStart;
    for (int i = 0; i < 15; i++)
    {
        dataDictionaryRVA[i] = reader.ReadUInt32();
        dataDictionarySize[i] = reader.ReadUInt32();
    }
    fs.Close();

    if (dataDictionaryRVA[14] == 0) return false;
    else return true;
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-15T09:09:37.690

恐怕这样做的唯一真正方法是调用`System.Reflection.AssemblyName.GetAssemblyName`将完整路径传递给您要检查的文件。这将尝试从清单中提取名称，而不将完整的程序集加载到域中。如果文件是托管程序集，则它将程序集的名称作为字符串返回，否则它将抛出一个`BadImageFormatException`您可以捕获并忽略的，然后再跳过程序集并移至其他插件。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-15T08:42:17.513

正如 orip 建议的那样，您需要将其包装在 try {} catch {} 块中 - 特别是，您要注意[BadImageFormatException](http://msdn.microsoft.com/en-us/library/system.badimageformatexception.aspx)

```
foreach (string aDll in dllCollection) 
{
  try 
  {
     Assembly anAssembly = Assembly.LoadFrom(aDll);
  }
  catch (BadImageFormatException ex)
  {
    //Handle this here
  }
  catch (Exception ex)
  {
    //Other exceptions (i/o, security etc.)
   }
} 
```

在此处查看其他例外情况[http://msdn.microsoft.com/en-us/library/1009fa28.aspx](http://msdn.microsoft.com/en-us/library/1009fa28.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-10-03T10:05:51.303

例如，使用 BadImageFormatException 异常是一种不好的方法。如果您的应用程序以 .NET 3.5 为目标，它将无法识别比方说针对 .NET Core 编译的程序集，尽管程序集是托管的。

所以我认为解析PE头要好得多。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T08:30:33.933

您总是可以使用 try/except 块来包装 DLL 加载...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-09-20T06:54:37.007

扩展基里尔的答案，我已将其翻译为 VB，`Boolean`稍微调整逻辑以提高可读性，并将其转换为`System.IO.FileInfo`. 希望它可以帮助某人。

```
Public Module FileSystem
  <Extension>
  Public Function IsManagedAssembly(File As FileInfo) As Boolean
    Dim _
      uHeaderSignature,
      uHeaderPointer As UInteger

    Dim _
      uFormat,
      u64,
      u32 As UShort

    u64 = &H20B
    u32 = &H10B

    IsManagedAssembly = False

    If File.Exists AndAlso File.Length.IsAtLeast(64) Then
      Using oStream As New FileStream(File.FullName, FileMode.Open, FileAccess.Read)
        Using oReader As New BinaryReader(oStream)
          'PE Header starts @ 0x3C (60). Its a 4 byte header.
          oStream.Position = &H3C
          uHeaderPointer = oReader.ReadUInt32

          If uHeaderPointer = 0 Then
            uHeaderPointer = &H80
          End If

          ' Ensure there is at least enough room for the following structures:
          '     24 byte PE Signature & Header
          '     28 byte Standard Fields         (24 bytes for PE32+)
          '     68 byte NT Fields               (88 bytes for PE32+)
          ' >= 128 byte Data Dictionary Table
          If uHeaderPointer < oStream.Length - 257 Then
            ' Check the PE signature.  Should equal 'PE\0\0'.
            oStream.Position = uHeaderPointer
            uHeaderSignature = oReader.ReadUInt32

            If uHeaderSignature = &H4550 Then
              ' skip over the PEHeader fields
              oStream.Position += 20

              ' Read PE magic number from Standard Fields to determine format.
              uFormat = oReader.ReadUInt16

              If uFormat = u32 OrElse uFormat = u64 Then
                ' Read the 15th Data Dictionary RVA field which contains the CLI header RVA.
                ' When this is non-zero then the file contains CLI data, otherwise not.
                Select Case uFormat
                  Case u32 : oStream.Position = uHeaderPointer + &HE8
                  Case u64 : oStream.Position = uHeaderPointer + &HF8
                End Select

                IsManagedAssembly = oReader.ReadUInt32 > 0
              End If
            End If
          End If
        End Using
      End Using
    End If
  End Function
End Module 
```

# ms-word - 如何在 Word 中对 MERGEFIELD 进行子串化？

> ID：367762
> 
> 赞同：6
> 
> 时间：2008-12-15T08:22:41.843
> 
> 标签：ms-word, word-field, fieldcodes

这个让我很疑惑。这似乎是一项简单的任务，但解决方案却让我望而却步： - 如何在用于邮件合并的 Word 模板中为合并字段设置子字符串？

例如，我有类似的东西`{MERGEFIELD barcodevalue}`，我想提取前 6 个字符，因为它同时是其他东西的标识符。

我可以找到有关如何删除数字字段中给定位置左侧`(\x)`而不是右侧的字符的信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T10:10:48.537

您的邮件合并数据的数据提供者是什么？如果是 SQL 查询，您可以使用 SQL 的 substr/substring 函数。

无论如何，更改源数据/查询可能更容易，而不是调整邮件合并字段代码，这似乎是有限的。

# javascript - 如何检测函数是否被称为构造函数？

> ID：367768
> 
> 赞同：118
> 
> 时间：2008-12-15T08:30:10.343
> 
> 标签：javascript, constructor

给定一个函数：

```
function x(arg) { return 30; } 
```

您可以通过两种方式调用它：

```
result = x(4);
result = new x(4); 
```

第一个返回 30，第二个返回一个对象。

如何检测**函数本身内部调用函数的**方式？

无论您的解决方案是什么，它都必须与以下调用一起使用：

```
var Z = new x(); 
Z.lolol = x; 
Z.lolol(); 
```

目前所有的解决方案都认为将`Z.lolol()`其称为构造函数。

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2009-12-10T12:38:33.173

**注意：这在 ES2015 及更高版本中现在是可能的。见[丹尼尔韦纳的回答](https://stackoverflow.com/a/31060154/96100)。**

我不认为你想要什么是可能的[在 ES2015 之前]。函数中根本没有足够的信息来进行可靠的推断。

查看 ECMAScript 第 3 版规范，`new x()`调用时采取的步骤基本上是：

*   创建一个新对象
*   将其内部 [[Prototype]] 属性分配给的原型属性`x`
*   正常调用`x`，将新对象传递为`this`
*   如果调用`x`返回一个对象，则返回它，否则返回新对象

函数的调用方式对执行代码没有任何用处，因此唯一可以在内部测试`x`的是`this`值，这就是这里所有答案所做的事情。正如您所观察到的，作为构造函数`x`调用时的 * 新实例与作为函数调用时传递`x`的预先存在的实例无法区分，**除非**您将属性分配给由 as 创建的每个新对象：`x``this``x`**`x`**

 **```
function x(y) {
    var isConstructor = false;
    if (this instanceof x // <- You could use arguments.callee instead of x here,
                          // except in in EcmaScript 5 strict mode.
            && !this.__previouslyConstructedByX) {
        isConstructor = true;
        this.__previouslyConstructedByX = true;
    }
    alert(isConstructor);
} 
```

显然这并不理想，因为你现在在每个由它构造的对象上都有一个额外的无用属性`x`，可以被覆盖，但我认为这是你能做的最好的。

**(*)**`x` “instance of”是一个不准确的术语，但与“通过调用构造函数创建的对象”相比，它足够接近且更简洁

* * *

## 回答 #2

> 赞同：90
> 
> 时间：2015-06-25T20:27:16.980

从 ECMAScript 6 开始，这可以通过[`new.target`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new.target). `new.target`如果函数被使用`new`（或使用`Reflect.construct`，其作用类似于`new`）调用，则将被设置，否则为`undefined`.

```
function Foo() {
    if (new.target) {
       console.log('called with new');
    } else {
       console.log('not called with new');
    }
}

new Foo(); // "called with new"
Foo(); // "not called with new"
Foo.call({}); // "not called with new" 
```

* * *

## 回答 #3

> 赞同：55
> 
> 时间：2008-12-15T08:48:55.033

1）您可以检查`this.constructor`：

```
function x(y)
{
    if (this.constructor == x)
        alert('called with new');
    else
         alert('called as function');
} 
```

`new`2）是的，返回值在上下文中使用时只是被丢弃

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2008-12-22T18:00:51.747

> 注意：这个答案是在**2008**写的，当时 javascript从**1999**开始还在**ES3**中。从那时起添加了许多新功能，因此现在存在更好的解决方案。由于历史原因，保留此答案。

 **下面代码的好处是您不需要两次指定函数的名称，它也适用于匿名函数。

```
function x() {
    if ( (this instanceof arguments.callee) ) {
      alert("called as constructor");
    } else {
      alert("called as function");
    }
} 
```

**更新** 正如[claudiu](https://stackoverflow.com/users/15055/claudiu)在下面的评论中指出的那样，如果您将构造函数分配给它创建的同一对象，上述代码将不起作用。我从来没有编写过这样的代码，并且最近看到其他人也这样做过。

克劳狄斯示例：

```
var Z = new x();
Z.lolol = x;
Z.lolol(); 
```

通过向对象添加属性，可以检测对象是否已初始化。

```
function x() {
    if ( (this instanceof arguments.callee && !this.hasOwnProperty("__ClaudiusCornerCase")) ) {
        this.__ClaudiusCornerCase=1;
        alert("called as constructor");
    } else {
        alert("called as function");
    }
} 
```

如果您删除添加的属性，即使上面的代码也会中断。***但是，您可以使用您喜欢的任何值覆盖它，包括`undefined`，它仍然有效。***但是如果你删除它，它就会坏掉。

目前 ecmascript 中没有原生支持来检测函数是否作为构造函数被调用。这是迄今为止我想出的最接近的东西，除非您删除该属性，否则它应该可以工作。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-12-15T09:12:08.217

两种方式，本质上是相同的。您可以测试范围`this`是什么，也可以测试是什么`this.constructor`。

如果您将方法作为构造函数`this`调用，则将是该类的新实例，如果将方法作为方法调用，`this`则将是方法的上下文对象。类似地，对象的构造函数将是方法本身，如果调用为 new，否则系统对象构造函数。这很清楚，但这应该会有所帮助：

```
var a = {};

a.foo = function () 
{
  if(this==a) //'a' because the context of foo is the parent 'a'
  {
    //method call
  }
  else
  {
    //constructor call
  }
}

var bar = function () 
{
  if(this==window) //and 'window' is the default context here
  {
    //method call
  }
  else
  {
    //constructor call
  }
}

a.baz = function ()
{
  if(this.constructor==a.baz); //or whatever chain you need to reference this method
  {
    //constructor call
  }
  else
  {
    //method call
  }
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-03-14T20:18:01.723

在构造函数中检查 [this] 的实例类型是可行的方法。问题是，事不宜迟，这种方法很容易出错。不过有一个解决办法。

假设我们正在处理函数 ClassA()。基本方法是：

```
 function ClassA() {
        if (this instanceof arguments.callee) {
            console.log("called as a constructor");
        } else {
            console.log("called as a function");
        }
    } 
```

有几种方法表明上述解决方案无法按预期工作。只考虑这两个：

```
 var instance = new ClassA;
    instance.classAFunction = ClassA;
    instance.classAFunction(); // <-- this will appear as constructor call

    ClassA.apply(instance); //<-- this too 
```

为了克服这些问题，一些人建议 a) 在实例的字段中放置一些信息，例如“ConstructorFinished”并检查它或 b) 在列表中跟踪您构造的对象。我对这两者都感到不舒服，因为更改 ClassA 的每个实例对于类型相关的功能来说太具有侵入性且成本太高。如果 ClassA 有很多实例，则收集列表中的所有对象可能会带来垃圾收集和资源问题。

要走的路是能够控制你的 ClassA 函数的执行。简单的方法是：

```
 function createConstructor(typeFunction) {
        return typeFunction.bind({});
    }

    var ClassA = createConstructor(
        function ClassA() {
            if (this instanceof arguments.callee) {
                console.log("called as a function");
                return;
            }
            console.log("called as a constructor");
        });

    var instance = new ClassA(); 
```

这将有效地防止所有企图欺骗 [this] 值。绑定函数将始终保持其原始 [this] 上下文，除非您使用**new**运算符调用它。

高级版本提供了将构造函数应用于任意对象的能力。一些用途可能是将构造函数用作类型转换器或在继承场景中提供可调用的基类构造函数链。

```
 function createConstructor(typeFunction) {
        var result = typeFunction.bind({});
        result.apply = function (ths, args) {
            try {
                typeFunction.inApplyMode = true;
                typeFunction.apply(ths, args);
            } finally {
                delete typeFunction.inApplyMode;
            }
        };
        return result;
    }

    var ClassA = createConstructor(
        function ClassA() {
            if (this instanceof arguments.callee && !arguments.callee.inApplyMode) {
                console.log("called as a constructor");
            } else {
                console.log("called as a function");
            }
        }); 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-04-19T00:59:59.493

实际上解决方案非常可能且简单...不明白为什么要为这么小的东西写这么多字

***更新：***感谢**TwilightSun**解决方案现已完成，即使对于**Claudiu**建议的测试！谢谢你们！！！

```
function Something()
{
    this.constructed;

    if (Something.prototype.isPrototypeOf(this) && !this.constructed)
    {
        console.log("called as a c'tor"); this.constructed = true;
    }
    else
    {
        console.log("called as a function");
    }
}

Something(); //"called as a function"
new Something(); //"called as a c'tor" 
```

在这里演示：[https ://jsfiddle.net/9cqtppuf/](https://jsfiddle.net/9cqtppuf/)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-12-13T15:52:42.457

扩展 Gregs 解决方案，此解决方案与您提供的测试用例完美配合：

```
function x(y) {
    if( this.constructor == arguments.callee && !this._constructed ) {
        this._constructed = true;
        alert('called with new');
    } else {
        alert('called as function');
    }
} 
```

**编辑：添加一些测试用例**

```
x(4);             // OK, function
var X = new x(4); // OK, new

var Z = new x();  // OK, new
Z.lolol = x; 
Z.lolol();        // OK, function

var Y = x;
Y();              // OK, function
var y = new Y();  // OK, new
y.lolol = Y;
y.lolol();        // OK, function 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-09-15T22:38:40.357

在我看到这个线程之前，我从未考虑过构造函数可能是实例的属性，但我认为下面的代码涵盖了这种罕见的场景。

```
// Store instances in a variable to compare against the current this
// Based on Tim Down's solution where instances are tracked
var Klass = (function () {
    // Store references to each instance in a "class"-level closure
    var instances = [];

    // The actual constructor function
    return function () {
        if (this instanceof Klass && instances.indexOf(this) === -1) {
            instances.push(this);
            console.log("constructor");
        } else {
            console.log("not constructor");
        }
    };
}());

var instance = new Klass();  // "constructor"
instance.klass = Klass;
instance.klass();            // "not constructor" 
```

在大多数情况下，我可能只检查 instanceof。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-03-12T11:19:01.690

没有可靠的方法来区分 JavaScript 代码中函数的调用方式。¹

但是，函数调用将`this`分配给全局对象，而构造函数将`this`分配给新对象。这个新对象永远不可能是全局对象，因为即使实现允许您设置全局对象，您仍然没有机会这样做。

您可以通过调用作为函数（呵呵）返回的函数来获取全局对象`this`。

我的直觉是，在 ECMAScript 1.3 的规范中，当作为函数调用时具有定义行为的构造函数应该使用以下比较来区分它们是如何被调用的：

```
function MyClass () {
    if ( this === (function () { return this; })() ) {
        // called as a function
    }
    else {
        // called as a constructor
    }
} 
```

无论如何，任何人都可以使用函数或构造函数的`call`or`apply`并设置`this`为任何内容。但是这样，您可以避免“初始化”全局对象：

```
function MyClass () {
    if ( this === (function () { return this; })() ) {
        // Maybe the caller forgot the "new" keyword
        return new MyClass();
    }
    else {
        // initialize
    }
} 
```

* * *

[1.]宿主（又名实现）可能能够分辨出差异，如果它实现了与内部属性`[[Call]]`和`[[Construct]]`. 前者用于函数或方法表达式，后者用于`new`表达式。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-08-06T13:28:58.330

在我对[http://packagesinjavascript.wordpress.com/](http://packagesinjavascript.wordpress.com/)的测试中，我发现测试 if (this == window) 在所有情况下都可以跨浏览器工作，所以这就是我最终使用的测试。

-Stijn

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-09-15T20:02:11.950

来自约翰·雷西格：

```
function makecls() {

   return function(args) {

        if( this instanceof arguments.callee) {
            if ( typeof this.init == "function")
                this.init.apply(this, args.callee ? args : arguments)
        }else{
            return new arguments.callee(args);
        }
    };
}

var User = makecls();

User.prototype.init = function(first, last){

    this.name = first + last;
};

var user = User("John", "Resig");

user.name 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2016-07-28T10:48:34.473

如果您要hackish，那么与其他答案一样，`instanceof`这是最低限度的解决方案。`new.target`但是使用该`instanceof`解决方案会在此示例中失败：

```
let inst = new x;
x.call(inst); 
```

结合@TimDown 解决方案，`WeakSet`如果您希望与旧的 ECMAScript 版本兼容以防止将属性放入实例中，则可以使用 ES6。好吧，`WeakSet`将使用以允许对未使用的对象进行垃圾收集。`new.target`不会在相同的源代码中兼容，因为它是 ES6 的语法特性。ECMAScript 指定标识符不能是保留字之一，并且`new`无论如何都不是对象。

```
(function factory()
{
    'use strict';
    var log = console.log;

    function x()
    {
        log(isConstructing(this) ?
            'Constructing' :
            'Not constructing'
        );
    }

    var isConstructing, tracks;
    var hasOwnProperty = {}.hasOwnProperty;

    if (typeof WeakMap === 'function')
    {
        tracks = new WeakSet;
        isConstructing = function(inst)
        {
            if (inst instanceof x)
            {
                return tracks.has(inst) ?
                    false : !!tracks.add(inst);
            }
            return false;
        }
    } else {
        isConstructing = function(inst)
        {
            return inst._constructed ?
                false : inst._constructed = true;
        };
    }
    var z = new x; // Constructing
    x.call(z)      // Not constructing
})(); 
```

ECMAScript 3 的`instanceof`运算符 of 被[指定](http://ecma-international.org/publications/files/ECMA-ST-ARCH/ECMA-262,%203rd%20edition,%20December%201999.pdf)为：

> **11.8.6 instanceof 运算符**
> --- 产生式 RelationalExpression：RelationalExpression **instanceof** ShiftExpression 的计算方法如下：
> --- 1\. 计算 RelationalExpression。
> --- 2\. 调用 GetValue(Result(1))。
> --- 3\. 评估 ShiftExpression。
> --- 4\. 调用 GetValue(Result(3))。
> --- 5\. 如果 Result(4) 不是对象，则抛出**TypeError**异常。
> --- 6\. 如果 Result(4) 没有 [[HasInstance]] 方法，则抛出**TypeError**异常。
> --- 7\. 调用Result(4) 的[[HasInstance]] 方法，带参数Result(2)。
> --- 8\. 返回结果(7)。

> **15.3.5.3 [[HasInstance]] (V)**
> --- 假设 F 是一个 Function 对象。
> --- 当 F 的 [[HasInstance]] 方法以值 V 被调用时，采取以下步骤：
> --- 1\. 如果 V 不是对象，则返回**false**。**--- 2\. 调用属性名为“prototype”**
> 的F的[[Get]]方法。 --- 3\. 令 O 为 Result(2)。 --- 4.如果O不是对象，抛出**TypeError**异常。 --- 5\. 令 V 为 V 的 [[Prototype]] 属性的值。 --- 6\. 如果 V 为 **null**，则返回**false**。 --- 7\. 如果 O 和 V 指的是同一个对象，或者如果它们指的是相互连接的对象（13.1.2），则返回**true**。 ********--- 8\. 转到步骤 5。********

 ******这意味着它将在转到其原型之后递归左侧值，直到它不是一个对象或直到它等于具有指定`[[HasInstance]]`方法的右侧对象的原型。这意味着它将检查左侧是否是右侧的实例，但会消耗左侧的所有内部原型。

```
function x() {
    if (this instanceof x) {
        /* Probably invoked as constructor */
    } else return 30;
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-11-15T15:32:48.987

也许我错了，但（以寄生虫为代价）以下代码似乎是一个解决方案：

```
function x(arg) {
    //console.debug('_' in this ? 'function' : 'constructor'); //WRONG!!!
    //
    // RIGHT(as accepted)
    console.debug((this instanceof x && !('_' in this)) ? 'function' : 'constructor');
    this._ = 1;
    return 30;
}
var result1 = x(4),     // function
    result2 = new x(4), // constructor
    Z = new x();        // constructor
Z.lolol = x; 
Z.lolol();              // function 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-03-13T09:14:35.423

虽然这个线程很古老，但我很惊讶没有人提到在严格模式下（[`'use strict'`](https://www.w3schools.com/js/js_strict.asp)）一个函数的默认`this`值是未定义的，而不是像以前那样设置为全局/窗口，所以要检查是否没有使用 new 只需测试`falsey`值`!this` - 例如：

```
function ctor() { 'use strict';
  if (typeof this === 'undefined') 
    console.log('Function called under strict mode (this == undefined)');
  else if (this == (window || global))
    console.log('Function called normally (this == window)');
  else if (this instanceof ctor)
    console.log('Function called with new (this == instance)');
  return this; 
} 
```

如果您按原样测试该函数`this`，由于`'use strict'`函数开头的指令，您将得到未定义的值。当然，如果已经开启了严格模式，那么如果你删除`'use strict'`指令它不会改变，但如果你删除它，`this`值将被设置为`window`or `global`。如果您使用`new`调用该函数，则该`this`值将与 instanceof 检查匹配（尽管如果您检查了其他内容，则 instance 是最后一个选项，因此不需要此检查，如果您想继承实例，则应避免）

```
function ctor() { 'use strict';
  if (!this) return ctor.apply(Object.create(ctor.prototype), arguments);
  console.log([this].concat([].slice.call(arguments)));
  return this;
} 
```

这会将`this`您传递给函数的值和任何参数记录到控制台，并返回该`this`值。如果`this`值是，`falsey`那么它会创建一个新实例，并使用`Object.create(ctor.prototype)`并使用`Function.apply()`相同的参数重新调用构造函数，但正确的实例为`this`. 如果该`this`值不是`falsey`then ，则假定它是一个有效实例并返回。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2021-04-01T14:04:31.327

我相信解决方案是将您的 Constructor 函数转换为真正的 Constructor 函数及其原型 Constructor 的包装器（如果需要）。该方法**将从 2009 年开始在 ES5 中工作，并且也可以在严格模式下工作**。在下面的代码窗口中，我有一个使用模块模式的示例，将真正的构造函数及其原型的构造函数保存在一个闭包中，可以通过**constructor(wrapper)**内的范围访问。这是有效的，因为没有属性被添加到 Constructor(wrapper) 中的“this”关键字并且没有设置 Constructor(wrapper).prototype，默认情况下是*Object*；因此从**Object.getpropertyNames返回的数组**如果 new 关键字已与 Constructor(wrapper) 一起使用，则长度将等于 0。如果为真则**返回新的 Vector**。

```
var Vector = (function() {

     var Vector__proto__ = function Vector() {
         // Vector methods go here
     }

     var vector__proto__ = new Vector__proto__();;

     var Vector = function(size) {
         // vector properties and values go here
         this.x = 0;
         this.y = 0;
         this.x = 0;
         this.maxLen = size === undefined? -1 : size;

     };
     Vector.prototype = vector__proto__;

     return function(size){

         if ( Object.getOwnPropertyNames(this).length === 0 ) {
             // the new keyword WAS USED with the wrapper constructor
             return new Vector(size); 
         } else { 
             // the new keyword was NOT USED with the wrapper constructor
             return; 
         };
    };
})(); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-12-09T20:44:22.453

使用`this instanceof arguments.callee`（可选地用`arguments.callee`它所在的函数替换，这可以提高性能）来检查是否有东西被称为构造函数。**不要**使用`this.constructor`，因为它很容易改变。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-12-10T13:41:00.100

Tim Down 我认为是正确的。我认为一旦你到了你认为需要能够区分这两种调用模式的地步，那么你就不应该使用“ `this`”关键字。`this`是不可靠的，它可能是全局对象，也可能是一些完全不同的对象。事实是，具有这些不同激活模式的功能，其中一些按您的预期工作，另一些则完全疯狂，这是不可取的。我想也许你正试图解决这个问题。

有一种惯用的方法可以创建一个构造函数，无论它如何调用，它的行为都相同。无论是像 Thing()、new Thing() 还是 foo.Thing()。它是这样的：

```
function Thing () {
   var that = Object.create(Thing.prototype);
   that.foo="bar";
   that.bar="baz";
   return that;
} 
```

其中 Object.create 是一个新的 ecmascript 5 标准方法，可以像这样在常规 javascript 中实现：

```
if(!Object.create) {
    Object.create = function(Function){
        // WebReflection Revision
       return function(Object){
           Function.prototype = Object;
           return new Function;
    }}(function(){});
} 
```

Object.create 将一个对象作为参数，并以传入的对象作为其原型返回一个新对象。

但是，如果您真的试图根据调用方式使函数表现不同，那么您就是一个坏人，您不应该编写 javascript 代码。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-09-11T05:28:01.047

如果您不想`__previouslyConstructedByX`在对象中放置属性 - 因为它会污染对象的公共接口并且很容易被覆盖 - 只需不要返回以下实例`x`：

```
function x() {

    if(this instanceof x) {
        console.log("You invoked the new keyword!");
        return that;
    }
    else {
        console.log("No new keyword");
        return undefined;
    }

}

x();
var Z = new x(); 
Z.lolol = x; 
Z.lolol();
new Z.lolol(); 
```

现在该`x`函数永远不会返回 type 的对象`x`，因此（我认为）仅在使用关键字`this instanceof x`调用该函数时才评估为 true 。`new`

缺点是这有效地搞砸了`instanceof`- 但取决于你使用它的程度（我不倾向于），这可能不是问题。

* * *

如果您的目标是两种情况都返回`30`，您可以返回一个实例`Number`而不是一个实例`x`：

```
function x() {

    if(this instanceof x) {
        console.log("You invoked the new keyword!");
        var that = {};
        return new Number(30);
    }
    else {
        console.log("No new");
        return 30;
    }

}

console.log(x());
var Z = new x();
console.log(Z);
Z.lolol = x;
console.log(Z.lolol());
console.log(new Z.lolol()); 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2013-08-31T00:25:04.407

当我尝试实现一个返回字符串而不是对象的函数时，我遇到了同样的问题。

在函数的开头检查“this”是否存在似乎就足够了：

```
function RGB(red, green, blue) {
    if (this) {
        throw new Error("RGB can't be instantiated");
    }

    var result = "#";
    result += toHex(red);
    result += toHex(green);
    result += toHex(blue);

    function toHex(dec) {
        var result = dec.toString(16);

        if (result.length < 2) {
            result = "0" + result;
        }

        return result;
    }

    return result;
} 
```

无论如何，最后我只是决定将我的 RGB() 伪类变成一个 rgb() 函数，所以我不会尝试实例化它，因此根本不需要安全检查。但这取决于你想要做什么。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2015-07-17T20:19:19.140

```
function createConstructor(func) {
    return func.bind(Object.create(null));
}

var myClass = createConstructor(function myClass() {
    if (this instanceof myClass) {
        console.log('You used the "new" keyword');
    } else {
        console.log('You did NOT use the "new" keyword');
        return;
    }
    // constructor logic here
    // ...
}); 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-02-15T16:33:33.200

在问题的顶部，下面的代码将自动修复问题，以防在没有 new 的情况下调用函数。

```
function Car() {

    if (!(this instanceof Car)) return new Car();

    this.a = 1;
    console.log("Called as Constructor");

}
let c1 = new Car();
console.log(c1); 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2021-09-03T07:26:33.730

这可以在不使用 ES6 new.target 的情况下实现。您可以在严格模式下运行代码，在这种情况下，如果在没有 new 的情况下调用 this 的值将是未定义的，否则它将是空对象。例子：：

```
"use strict"
function Name(){
    console.log(this)
if(this){
    alert("called by new")
}
else
    alert("did not called using new")
}
new Name() 
```

# java - 如何在 servlet 上下载 jad 文件的页面？

> ID：367781
> 
> 赞同：0
> 
> 时间：2008-12-15T08:37:55.853
> 
> 标签：java, java-me, midp

我有一个 java me 应用程序，现在我想将该应用程序放在服务器上。我想用servlet写下载页面。我的意思是当用户键入 servlet url 并点击该 servlet 时，我的 jad 文件将发送到手机（用户无需单击下载按钮或链接。页面加载后，servlet 会自动将 jad 文件发送到要求的手机。）。

我尝试使用此代码。

```
> File exportFile = new File("C:\\Voice.jad");
> response.setContentType("text/vnd.sun.j2me.app-descriptor");
> response.setContentLength((int)
> exportFile.length()); 
> response.addHeader("Content-Disposition",
> "attachment; filename=" +
> exportFile.getName()); 
> OutputStream os= response.getOutputStream(); 
> InputStream is = new FileInputStream("C:\\Voice.jad"); 
> while (is.available() > 0)  { char c =
> (char) is.read(); 
>     os.write(c); }    
>     os.flush(); 
>     is.close(); 
```

我尝试从诺基亚系列 40th 5rd edition 模拟器下载该应用程序。它显示 jad 文件的信息并尝试安装。但是在安装的路上，它说jar文件不存在。

我不知道如何继续前进。请给我一些资料或样品。如何在 servlet 上编写 java me 应用程序的下载页面？

谢谢你，问候

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T15:53:16.473

您应该添加通常出现在 jad 文件中的各种其他行；）

在下面的示例中，jad 和 jar 文件位于同一目录中。如果它们不在同一个目录中，则应提供 MIDlet-Jar-URL: 以及 jad 文件的相对路径或 jar 文件的绝对路径。我的意思是这必须是完整的 url - [http://yourserver.com/some/path/your.jar](http://yourserver.com/some/path/your.jar)

```
MIDlet-1: BiteTravel, i3.png, main.MainMidlet
MIDlet-Icon: i1.png
MIDlet-Jar-Size: 109855 //this is very important -- jar size must match this number!
MIDlet-Jar-URL: BiteTravelBite.jar
MIDlet-Name: BiteTravel
MIDlet-Vendor: Bite
MIDlet-Version: 1.0
MicroEdition-Configuration: CLDC-1.0
MicroEdition-Profile: MIDP-2.0 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T08:52:48.223

我猜问题在于 jad 文件的内容 - jar 文件的路径必须无效。

此外，手机经常对 jad 文件的格式非常挑剔——行顺序、换行符等

# javascript - 防止浏览器缓存 AJAX 调用结果

> ID：367786
> 
> 赞同：281
> 
> 时间：2008-12-15T08:44:11.270
> 
> 标签：javascript, jquery, ajax, browser-cache

看起来如果我使用 加载动态内容`$.get()`，结果会缓存在浏览器中。

在 QueryString 中添加一些随机字符串似乎可以解决这个问题（我使用`new Date().toString()`），但这感觉就像一个 hack。

有没有其他方法可以实现这一目标？或者，如果唯一的字符串是实现这一目标的唯一方法，除了`new Date()`?

* * *

## 回答 #1

> 赞同：536
> 
> 时间：2009-04-09T17:08:49.637

以下将阻止所有未来的 AJAX 请求被缓存，无论您使用哪种 jQuery 方法（$.get、$.ajax 等）

```
$.ajaxSetup({ cache: false }); 
```

* * *

## 回答 #2

> 赞同：346
> 
> 时间：2009-04-09T17:04:53.517

JQuery 的 $.get() 将缓存结果。代替

```
$.get("myurl", myCallback) 
```

您应该使用 $.ajax，这将允许您关闭缓存：

```
$.ajax({url: "myurl", success: myCallback, cache: false}); 
```

* * *

## 回答 #3

> 赞同：249
> 
> 时间：2008-12-15T09:12:58.730

我使用`new Date().getTime()`，这将避免冲突，除非您在同一毫秒内发生多个请求：

```
$.get('/getdata?_=' + new Date().getTime(), function(data) {
    console.log(data); 
}); 
```

**编辑：**这个答案已经有好几年了。它仍然有效（因此我没有删除它），但**现在有更好/更清洁的方法来实现这一点**。我更喜欢[这种](https://stackoverflow.com/a/735084/43140)方法，但是如果您想在页面的生命周期内禁用*每个*请求的缓存，[这个](https://stackoverflow.com/a/735101/43140)答案也很有用。

 ** * *

## 回答 #4

> 赞同：27
> 
> 时间：2016-09-21T03:21:23.717

这里的所有答案都会在请求的 URL 上留下足迹，该 URL 将显示在服务器的访问日志中。

我需要一个没有副作用的基于标头的解决方案，我发现它可以通过设置[如何跨所有浏览器控制网页缓存中提到的标头来实现？](https://stackoverflow.com/questions/49547/making-sure-a-web-page-is-not-cached-across-all-browsers).

结果，至少适用于 Chrome，将是：

```
$.ajax({
   url: url, 
   headers: {
     'Cache-Control': 'no-cache, no-store, must-revalidate', 
     'Pragma': 'no-cache', 
     'Expires': '0'
   }
});
```

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2008-12-15T08:49:38.980

另一种方法是在生成对 ajax 调用的响应的代码中不提供来自服务器端的缓存标头：

```
response.setHeader( "Pragma", "no-cache" );
response.setHeader( "Cache-Control", "no-cache" );
response.setDateHeader( "Expires", 0 ); 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-12-15T08:51:35.917

就我个人而言，我觉得查询字符串方法比尝试在服务器上设置标头更可靠 - 不能保证代理或浏览器无论如何都不会缓存它（有些浏览器比其他浏览器更糟糕 - 不命名）。

我通常使用`Math.random()`，但我认为使用日期没有任何问题（您不应该以足够快的速度执行 AJAX 请求以两次获得相同的值）。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2015-04-29T21:40:00.290

按照文档： [http ://api.jquery.com/jquery.ajax/](http://api.jquery.com/jquery.ajax/)

您可以使用该`cache`属性：

```
$.ajax({
    method: "GET",
    url: "/Home/AddProduct?",
    data: { param1: value1, param2: value2},
    cache: false,
    success: function (result) {
        // TODO
    }
}); 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-12-15T21:38:09.663

当然，“缓存破坏”技术将完成工作，但如果服务器向客户端指示不应缓存响应，则首先不会发生这种情况。在某些情况下，缓存响应是有益的，有时则不然。让服务器决定数据的正确生命周期。您可能想稍后更改它。在服务器上比在 UI 代码中的许多不同位置更容易。

当然，如果您无法控制服务器，这将无济于事。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-04-20T18:13:43.113

真正的问题是为什么你需要这个不被缓存。如果它不应该被缓存，因为它一直在变化，服务器应该指定不缓存资源。如果它有时只是改变（因为它依赖的资源之一可以改变），并且如果客户端代码有办法知道它，它可以将一个虚拟参数附加到从某个哈希或上次修改日期计算的 url这些资源的一部分（这就是我们在 Microsoft Ajax 脚本资源中所做的，因此它们可以被永久缓存，但新版本仍然可以在它们出现时提供）。如果客户端不知道变化，正确的方法应该是服务器正确处理 HEAD 请求并告诉客户端是否使用缓存版本。在我看来，附加一个随机参数或告诉客户端永远不要缓存是错误的，因为可缓存性是服务器资源的属性，因此应该在服务器端决定。另一个要问自己的问题是，该资源真的应该通过 GET 提供还是应该通过 POST 提供？这是一个语义问题，但它也有安全隐患（只有在服务器允许 GET 时才会发生攻击）。POST 不会被缓存。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-12-15T08:57:55.373

也许你应该看一下 $.ajax() （如果你使用的是 jQuery，它看起来像）。看看：[http](http://docs.jquery.com/Ajax/jQuery.ajax#options) ://docs.jquery.com/Ajax/jQuery.ajax#options和选项“缓存”。

另一种方法是查看您如何在服务器端缓存内容。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-12-15T21:52:33.703

使用 POST 请求而不是 GET ...怎么样？（无论如何你应该......）

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2013-05-06T19:39:29.663

对于那些在移动 Safari 上使用`cache`选项的人`$.ajaxSetup()`，看来您可能必须为 POST 使用时间戳，因为移动 Safari 也会缓存它。根据文档`$.ajax()`（您被定向到 from `$.ajaxSetup()`）：

> 将缓存设置为 false 仅适用于 HEAD 和 GET 请求。它通过将“_={timestamp}”附加到 GET 参数来工作。其他类型的请求不需要该参数，除非在 IE8 中对已由 GET 请求的 URL 进行 POST。

因此，在我上面提到的情况下，单独设置该选项对您没有帮助。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-12-15T10:47:56.120

对给出的优秀答案的一个小补充：如果您正在为没有 javascript 的用户使用非 ajax 备份解决方案，那么无论如何您都必须正确获取这些服务器端标头。这不是不可能的，虽然我理解那些放弃它的人；）

我敢肯定还有一个关于 SO 的问题，它将为您提供适当的完整标题集。我并不完全相信老鼠的回复涵盖了所有的基础 100%。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-01-22T14:52:54.993

基本上只需添加`cache:false;`您认为内容会随着进度而改变的ajax。并且内容不会改变的地方你可以省略这个。这样你每次都会得到新的响应

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-08-13T18:42:46.263

[Internet Explorer 的 Ajax 缓存：您打算怎么做？](http://www.dashbay.com/2011/05/internet-explorer-caches-ajax/)建议三种方法：

> 1.  向查询字符串添加缓存破坏标记，例如 ?date=[timestamp]。在 jQuery 和 YUI 中，您可以告诉它们自动执行此操作。
> 2.  使用 POST 而不是 GET
> 3.  发送一个 HTTP 响应头，专门禁止浏览器缓存它

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-08-01T15:43:50.490

正如@Athasach 所说，根据 jQuery 文档，`$.ajaxSetup({cache:false})`除了 GET 和 HEAD 请求之外，它不适用于其他请求。

`Cache-Control: no-cache`无论如何，您最好还是从您的服务器发回一个标头。它提供了更清晰的关注点分离。

当然，这不适用于您不属于您的项目的服务 url。在这种情况下，您可能会考虑从服务器代码代理第三方服务，而不是从客户端代码调用它。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2015-05-16T14:25:21.837

如果您使用的是 .net ASP MVC，请通过在端点函数上添加以下属性来禁用控制器操作上的缓存：

```
[OutputCacheAttribute(VaryByParam = "*", Duration = 0, NoStore = true)] 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2015-11-24T00:33:15.653

现在，通过在 ajax 请求中启用/禁用缓存选项很容易做到这一点，就像这样

```
$(function () {
    var url = 'your url goes here';
    $('#ajaxButton').click(function (e) {
        $.ajax({
            url: url,
            data: {
                test: 'value'
            },
                cache: true, //cache enabled, false to reverse
                complete: doSomething
            });
        });
    });
    //ToDo after ajax call finishes
    function doSomething(data) {
        console.log(data);
    }
}); 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-12-02T17:58:37.737

如果您使用的是 IE 9，那么您需要在控制器类定义前使用以下内容：

[OutputCache(NoStore = true, Duration = 0, VaryByParam = "*")]

公共类 TestController : 控制器

这将阻止浏览器缓存。

此链接的详细信息：http: [//dougwilsonsa.wordpress.com/2011/04/29/disabling-ie9-ajax-response-caching-asp-net-mvc-3-jquery/](http://dougwilsonsa.wordpress.com/2011/04/29/disabling-ie9-ajax-response-caching-asp-net-mvc-3-jquery/)

其实这解决了我的问题。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-12-03T13:57:03.810

添加标题

```
headers: {
                'Cache-Control':'no-cache'
            } 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2013-12-03T06:58:51.197

附加`Math.random()` 到请求 url

# asterisk - Asterisk 中的自定义 IVR 操作

> ID：367789
> 
> 赞同：2
> 
> 时间：2008-12-15T08:46:12.280
> 
> 标签：asterisk, telephony, ivr, pbx

有人可以指点我一个方向，示例代码或在线资源来完成以下操作：

**要求：** 我想编写一个简单的 IVR 菜单选项来运行脚本（Bash 或 Python）。例如，打电话给 Asterisk 机器并请求在另一个 Linux 机器上重新启动服务。“其他 Linux 盒子”的详细信息将被硬编码到 IVR 菜单选项中，并且不需要作为 IVR 交互的一部分提供 - 只需在盒子 Y 上重新启动服务 X。我有点担心并且不确定如何使用密码（即使它在版本中是硬编码的）。

**背景：** 我是 Asterisk 新手，从 AsteriskNow 发行版安装它，我还在学习这个产品。基本的 PBX 功能正在运行，并通过 FreePBX 进行管理。Asterisk 不是我们开发工作的主要重点，而是工具箱中的一个工具。我们主要从事 .NET 工作，但具有 Unix 技能。

如果可能的话，我不想花几天时间学习 Asterisk 的集成细节来完成工作......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-09-04T12:47:12.577

Asterisk 并不总是等待用户输入。仅在 Background、WaitExten、Read 命令期间。如果你使用 Playback()，Asterisk 在播放音频文件时会忽略任何 DTMF。

您可以用 Read() 替换 Playback，但您必须将读取超时设置为非常低的值，否则在您使用 Read() 播放的每个音频文件之后都会出现静音。如果您使用 Read() 那么您必须检查用户输入的值以检查退出，就像这样......

代替

```
exten => x,n,Playback(yourfile) 
exten => x,n,somethingelse... 
```

你需要

```
exten => x,n,Read(Exit,yourfile,1)
exten => x,n,GotoIf($["${Exit}" = "0"]?0,1) 
exten => x,n,somethingelse... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T09:04:26.173

[Asterisk AGI](http://www.voip-info.org/wiki/view/Asterisk+AGI)页面包含指向许多编程语言的应用程序的链接。如果您主要使用 .NET，也许[nasterisk](http://www.codeplex.com/nasterisk)或较旧的[MONO-TONE](http://gundy.org/asterisk/)会有所帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-20T18:59:32.500

你会为此设置 Asterisk 还是它/它会做其他事情，如 PBX、IVR 等？

如果您正在使用 Asterisk 做其他事情，那么设置一个隐藏的分机（IVR 菜单上没有广告的分机），一旦您连接就可以拨打该分机；在此扩展程序中，您可以检查来电显示并将其与您的号码进行比较，以便只有您可以执行脚本（您可以通过询问 PIN 号码来增加一些安全性，这样如果您找不到，您可以更轻松地休息您的手机）。

像这样的东西：

```
exten => 9999,1,GotoIf($["${CALLERID(num)}" = "yournumber"]?4)
exten => 9999,2,Playback(sorry)
exten => 9999,3,Hangup
exten => 9999,4,Read(Pin,please-enter-pin,4)
exten => 9999,5,AGI(your-script)
```

在您的脚本中，您检查 Pin 变量，如果它有效，则执行，否则不执行任何操作退出。这样您就不必在拨号计划中硬编码密码，其他人可能会看到...如果它是受信任的机器，那么您可以在拨号计划中验证密码：

```
exten => 9999,5,GotoIf($["Pin" != "1234"]?2)
exten => 9999,6,AGI(your-script)
```

# .net - System.ArgumentException 路径中的非法字符

> ID：367797
> 
> 赞同：5
> 
> 时间：2008-12-15T08:49:54.453
> 
> 标签：.net, exception, argumentexception, illegal-characters, path-combine

我正在使用`Path.Combine`，其中一个字符串包含 Unicode 字符。我明白了`{System.ArgumentException} exception; illegal characters in path`。

根据[MSDN](http://msdn.microsoft.com/en-us/library/aa365247.aspx)文件路径/名称可以有 unicode 字符。为什么我会得到这个异常？

### 编辑：

这是代码：

```
Path.Combine("C:\PDM\Silver","Amabel Bender QQQ") 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-15T09:34:26.783

我解决了这个问题。第二个字符串中包含一个“制表符”字符，导致异常。（当我在这里粘贴字符串时没有出现）

谢谢大家，很抱歉造成混乱。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T09:07:52.157

您的路径集中可能有[双引号](http://www.mail-archive.com/nant-developers@lists.sourceforge.net/msg05235.html)，因为[`Path.InvalidPathChars`](http://msdn.microsoft.com/en-us/library/system.io.path.invalidpathchars.aspx)包括双引号。

这将使您的异常与您的 Unicode 字符无关...

* * *

刚刚看到您对问题的编辑：VB，没有引号。

那么，您的第二个字符串中是否复制了一个不可打印的字符，看起来像一个空格，就在您的“QQQ”字符串之前？
也试试 if`"Amabel BenderQQQ"`或`"AmabelBenderQQQ"`work（只是为了测试它是否与 'QQQ' 字符或空间有关）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T09:16:40.500

如果您使用的是 C#，那么我确定您需要转义反斜杠

```
Path.Combine("C:\\PDM\\Silver","Amabel Bender QQQ") 
```

如果您使用的是 VB，则不适用...

# c# - 为我的应用程序重新分发和使用 CS.exe 编译器 (C#)

> ID：367814
> 
> 赞同：6
> 
> 时间：2008-12-15T09:06:26.030
> 
> 标签：c#, .net, compiler-construction, redistributable

我们目前正在构建一个需要编译 C# 代码的应用程序。`csc.exe`我们可以在我们的包裹中重新分配吗？我认为它附带了 .Net 框架安装，但通过查看 Microsoft 网站，我发现 .Net 框架和 .Net SDK 之间存在差异

我有哪些选择？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-15T09:10:24.443

csc.exe 绝对是框架本身的一部分，而不仅仅是 SDK。

但是，您可能不需要首先调用 csc.exe - [CSharpCodeProvider](http://msdn.microsoft.com/en-us/library/microsoft.csharp.csharpcodeprovider.aspx)可以让您以编程方式编译代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T12:25:05.580

csc.exe 可用于框架的基本安装。

# postgresql - 在 postgresql 中：如何创建一个可以重置的简单计数器？

> ID：367817
> 
> 赞同：8
> 
> 时间：2008-12-15T09:08:05.073
> 
> 标签：postgresql

我想实现以下目标：

```
ID | Counter
------------
 0 | 343
 1 | 8344 
```

现在说我想更新 ID 1 的计数器，最简单的方法是什么？我使用序列吗？我只是读取值并更新吗？它有什么特殊的类型吗？

我正在考虑使用序列，但随后我必须为每个 ID 创建一个（可能超过 1000 个。我还将面临一个问题，即我不知道我需要多少个序列，所以我必须检查是否该ID等有一个序列......我不想要那个。

假设这些数字是属于某个组的用户，那么我正在考虑的另一种方法是为每个计数输入一行，当我想获取数字时，我通过 id 或其他内容执行选择组并获取数字行。

编辑：澄清我收到我的程序每天处理几次的csv中的用户列表（每天几次新的csv）。然后根据用户今天是否发送了一条消息（例如），我为该用户所属的组增加计数器。现在在某个时刻，我想提取组（可以是动态的，这取决于我白天得到的）并获取我增加的数字并重置它。希望这能解释得更多：D

感谢您到目前为止的帮助，我将进行实验：D

你怎么看？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-15T09:23:20.330

UPDATE Table SET Counter=Counter+1 WHERE ID=:ID;

（其中'Table'当然是有计数器的表，参数':ID'是计数器的id）

序列主要用于按顺序自动生成 ID 值，并且可以有间隙。上面的 update 语句是原子的，因为 update 是原子动作。但是，并不是说如果您之后立即发出选择，计数器仍然是相同的值。如果你想要这样，你需要序列，但你会冒着出现间隙的风险。

所以这里的回答者可能有必要知道计数器的目的是什么。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-15T09:27:34.160

这看起来很简单。

增量

```
UPDATE Table SET Counter = Counter + 1 WHERE ID = 1 
```

重启

```
UPDATE Table SET Counter = 0 WHERE ID = 1 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T09:20:55.483

*听起来*您需要完全按照以下方式创建**视图**：

`select id, count(users) from foo group by id`

# vb.net - VB.NET 谓词数组查找

> ID：367818
> 
> 赞同：7
> 
> 时间：2008-12-15T09:08:12.843
> 
> 标签：vb.net, arrays, find, predicate

如何使用 Array.Find 将以下内容转换为 VB.NET 谓词？

```
Private Function FindCulture(ByVal Code As String) As Globalization.CultureInfo
    '
    Dim AllCultures As Globalization.CultureInfo() = Globalization.CultureInfo.GetCultures(Globalization.CultureTypes.AllCultures)
    '
    For Each Culture As Globalization.CultureInfo In AllCultures
        If Culture.TwoLetterISOLanguageName = Code Then
            Return Culture
        End If
    Next
    '
    Return Nothing
    '
End Function 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-15T09:27:50.510

```
Private Function FindCulture(ByVal Code As String) As Globalization.CultureInfo
    Dim AllCultures As Globalization.CultureInfo() = Globalization.CultureInfo.GetCultures(Globalization.CultureTypes.AllCultures)
    Return Array.Find(AllCultures, Function(s) s.TwoLetterISOLanguageName = Code)
End Function 
```

# c++ - 枚举整数类型转换：运算符或函数

> ID：367819
> 
> 赞同：8
> 
> 时间：2008-12-15T09:08:53.917
> 
> 标签：c++, enums, casting

在我使用的外部代码中有枚举：

```
enum En {VALUE_A, VALUE_B, VALUE_C}; 
```

在我使用的另一个外部代码中，有 3 个 #define 指令：

```
#define ValA 5
#define ValB 6
#define ValC 7 
```

很多时候我有 int X 等于 ValA 或 ValB 或 ValC，我必须将它转换为 En 的相应值（ValA 到 VALUE_A，ValB 到 VALUEB 等），因为某些函数签名具有枚举 En。很多时候我必须做相反的操作，将 enum En 转换为 ValA 或 ValB 或 ValC。我无法更改这些函数的签名，并且有很多这样的函数。

问题是：如何进行翻译？我应该创建 2 个将隐式使用的强制转换运算符吗？或者我应该只有 2 个将明确使用的翻译函数：

```
En ToEn(int)
int FromEn(En) 
```

或者任何其他解决方案？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-15T11:14:39.797

既然你不能只在这里转换，我会使用一个自由函数，如果可能还有其他枚举也需要转换，试着让它看起来有点像内置转换：

```
template<typename T>
T my_enum_convert(int);

template<>
En my_enum_convert<En>(int in) {
    switch(in) {
        case ValA: return VALUE_A;
        case ValB: return VALUE_B;
        case ValC: return VALUE_C;
        default: throw std::logic_error(__FILE__ ": enum En out of range");
    }
}

int my_enum_convert(En in) {
    switch(in) {
        case VALUE_A: return ValA;
        case VALUE_B: return ValB;
        case VALUE_C: return ValC;
        // no default, so that GCC will warn us if we've forgotten a case
    }
}

En enumValue = my_enum_convert<En>(ValA);
int hashDefineValue = my_enum_convert(VALUE_A);
enumValue = my_enum_convert<En>(0); // throws exception 
```

或类似的东西 - 如果在使用它时出现问题，可能会对其进行调整。

我不使用隐式转换的原因是已经存在*从*En 到 int 的隐式转换，这给出了错误的答案。即使您可以用给出正确答案的东西可靠地替换它，生成的代码也不会看起来好像在进行任何转换。IMO 这将阻碍以后查看代码的任何人，而不是键入对转换例程的调用会阻碍您。

如果您想转换为 int 和从 int 转换看起来非常不同，那么您可以为模板和上面的函数指定不同的名称。

或者，如果您希望它们看起来相同（更像是 static_cast），您可以这样做：

```
template<typename T>
T my_enum_convert(En in) {
    switch(in) {
        case VALUE_A: return ValA;
        case VALUE_B: return ValB;
        case VALUE_C: return ValC;
    }
}

int hashDefineValue = my_enum_convert<int>(VALUE_A); 
```

如所写，T 必须具有从 int 的隐式转换。如果要支持仅具有显式转换的 T，请使用“return T(ValA);” 相反（或“return static_cast<T>(ValA);”，如果您认为单参数构造函数是 C 风格的强制转换，因此是不允许的）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T09:22:54.793

虽然隐式转换比翻译函数更方便，但也不太明显看到发生了什么。一种既方便又明显的方法可能是将您自己的类与重载的强制转换运算符一起使用。将自定义类型转换为 enum 或 int 时，不容易忽略一些自定义转换。

如果出于某种原因为此创建一个类不是一个选项，我会选择翻译功能，因为维护期间的可读性比编写代码时的便利性更重要。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T09:15:50.003

有函数然后重载库函数？

```
//libFunc( enum a );

libFuncOverload( define a ) {
    libFunc( toEn( a ) );
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T09:18:36.987

您不能为枚举重载运算符。还是我错过了什么？好吧，您可以创建某种虚拟类，它有一个隐式构造函数采用一个 int，然后有一个强制转换运算符到一个枚举（反之亦然）。

因此，唯一的解决方案是拥有功能。另外，我会按照帕特里克的建议进行重载。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-15T10:31:58.603

**将*enum 转换为 int*，例如 int(VALUE_A)，会自动/透明地发生。**

**将*int 转换为 enum*，例如*En(ValA)*，**可以从完整性检查中受益，以确保*int*值是*枚举的有效成员。* （虽然希望库代码不假设它的*枚举*值首先是有效的。）

虽然它对“ *int x* ”情况没有帮助，但您可以通过更改来有所帮助：

```
#define ValA 5 
```

到：

```
#define ValA VALUE_A 
```

如果*enum En()*在任何地方都包含/定义，**则** *ValA*和*VALUE_A***都** 将自动/透明地**在任何地方为***foo(int)*和*bar(En)工作。*

 **你可以使用：

```
#ifdef ValA
STATIC_ASSERT( ValA == VALUE_A, ValA_equal_VALUE_A );
#undef ValA
#else
#warning "ValA undefined.  Defining as VALUE_A"
#endif
#define ValA VALUE_A 
```

其中**STATIC_ASSERT**类似于：

```
 /* Use CONCATENATE_4_AGAIN to expand the arguments to CONCATENATE_4 */
#define CONCATENATE_4(      a,b,c,d)  CONCATENATE_4_AGAIN(a,b,c,d)
#define CONCATENATE_4_AGAIN(a,b,c,d)  a ## b ## c ## d

    /* Creates a typedef that's legal/illegal depending on EXPRESSION.       *
     * Note that IDENTIFIER_TEXT is limited to "[a-zA-Z0-9_]*".              *
     * (This may be replaced by static_assert() in future revisions of C++.) */
#define STATIC_ASSERT( EXPRESSION, IDENTIFIER_TEXT)                     \
  typedef char CONCATENATE_4( static_assert____,      IDENTIFIER_TEXT,  \
                              ____failed_at_line____, __LINE__ )        \
            [ (EXPRESSION) ? 1 : -1 ] 
```

# linq-to-sql - Linq to SQL 嵌套 IN FROM 查询

> ID：367823
> 
> 赞同：6
> 
> 时间：2008-12-15T09:10:54.913
> 
> 标签：linq-to-sql

谁能告诉我如何编写嵌套 SQL 查询，例如

SELECT * FROM X WHERE X.ID IN (SELECT Y.XID FROM Y WHERE .....)

在 LINQ 中？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-15T09:13:49.943

你可以试试：

```
var yIds = from y in dataContext.Y
           where ...
           select y.XId;

var query = from x in dataContext.X
            where yIds.Contains(x.Id)
            select x; 
```

我不知道它是否会起作用 - 为什么你不想只是加入呢？例如：

```
var query = from x in dataContext.X
            join y in dataContext.Y.Where(...) on x.Id equals y.Xid
            select x; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-15T09:14:30.070

要在 sql 中做 IN，需要使用 Linq 中的 Contains 函数。

例如：

```
var query = from x in GetX()
            where (from y in GetY() select y.xID).Contains(x.xID)
            select x; 
```

如果您愿意，还可以单独定义内部 linq 查询，这样更具可读性

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-03-14T17:37:26.767

我正在寻找`NOT IN`LINQ to SQL 的解决方案。多亏了这个问题，我才能够在*谷歌*上找到正确的东西并找到这篇博文：[LINQ to SQL 中的 NOT IN 子句](http://introducinglinq.com/blogs/marcorusso/archive/2008/01/14/the-not-in-clause-in-linq-to-sql.aspx)

C＃

```
NorthwindDataContext dc = new NorthwindDataContext();
var query =
    from c in dc.Customers
    where !(from o in dc.Orders
            select o.CustomerID)
           .Contains(c.CustomerID)
    select c; 
```

VB.net

```
Dim db As New NorthwinDataContext()
Dim query = From c In dc.Customers _
            Where Not (From o in dc.Orders _
                       Select o.CustomerID).Contains(c.CustomerID) _
            Select c 
```

# c++ - 在 Qt OSE 项目中使用 Win32 API

> ID：367824
> 
> 赞同：1
> 
> 时间：2008-12-15T09:11:53.397
> 
> 标签：c++, windows, winapi, qt, qt4

*这是一个混乱的问题，希望你能弄清楚我想要什么:)*

**在 Qt 开源版项目中使用 Win32 功能的最佳方式是什么？**

目前我已经包含了必要的 Windows SDK 库并手动将目录包含到 qmake 项目文件中。它在小规模上运行良好，但不方便且麻烦。

那么，我应该将 Win32 的东西分离到一个库中，还是有一种将这两者结合起来的明智方法？还是我只是忽略了一些简化这一点的 Qt 方面？

**编辑**

删除了语法的东西，它并不真正相关，只是烦人。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-16T14:29:23.163

您可以构建一个接口层来包装 Win32 功能并在 DLL 或静态库中提供它。DLL 将最大限度地减少使用您的 qmake 项目直接链接到 Win32 库的需要。创建这样的通用接口然后将平台特定数据隐藏在私有实现中会更符合 Qt 的可移植性。奇趣科技通常使用[pimpl 成语](http://en.wikipedia.org/wiki/Opaque_pointer)来完成此类任务。因此，请查看 Qt 源代码以查看示例（即查找“d”指针）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T12:41:56.280

LPCWSTR 应该不是问题；这只是一个愚蠢的名字`wchar_t const*`。LPARAM 也不是问题，您可以将它们存储很长时间。当然，这些只是 C++ 类型，而不是 Qt。但 Qt 仍然可以处理它们。

VS 集成，据我了解，它与 Visual Studio IDE 相关，而不是 (V)C++ 语言。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-02T12:29:31.723

您可以在 .pro 文件中使用 win32 范围；

```
win32:HEADERS+=mywinheader.h 
```

或使用 .pri (pro include) 文件将其进一步划分；

```
win32:include( mywinpri.pri ) 
```

正如 monjardin 所描述的，您通常会将此方法与 PIMPL 习语一起使用

# c# - 如何将相关表映射到继承的实体（每个层次结构的表）？

> ID：367828
> 
> 赞同：0
> 
> 时间：2008-12-15T09:13:43.767
> 
> 标签：c#, entity-framework, ado.net

我的数据库中有这些表。

[替代文字 http://img166.imageshack.us/img166/3133/testdbschemafy5.png](http://img166.imageshack.us/img166/3133/testdbschemafy5.png)

使用实体框架，我想要这样的东西：

[替代文字 http://img166.imageshack.us/img166/5721/testdbschemaefdv5.png](http://img166.imageshack.us/img166/5721/testdbschemaefdv5.png)

我使用了按层次结构继承的表，因此我为高级用户添加了一个新实体，并将其映射到具有 IsPremiumUser 属性的条件的用户实体。我想让 PremiumAccount 表关联到 PremiumUser 实体，但它不会像我那样工作：-/ 我收到此错误消息：

> 错误 3021：从第 113 行开始映射片段时出现问题：表 PremiumAccount 中的以下列中的每一列都映射到多个概念性侧属性：PremiumAccount.UserID 映射到

我的问题有什么解决办法吗？我可以将 PremiumAccount 实体与继承的实体相关联吗？还有另一种方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T09:27:22.257

我认为应该删除子类型的 PK 字段（因为它从其超类型继承）。

也就是说，这不是一个好的继承候选者。仅当实体的类型无法更改时，才应执行实体继承。这更像是一个“角色”候选人，因此是真正的 1:1 关系。问题是用户可能会定期失去/获得高级角色，但您无法更改现有实体实例的类型（== 表行），即使看起来您可以通过简单地更改数据库。继承映射是关于严格的规则，你不能改变它们，因为实体中的继承是关于解释数据库中的数据，因为关系模型不知道继承的概念（尽管有些数据库通过允许 DDL SQL 中的继承来“作弊”像postgresql）

# c# - ASP.NET MVC 中的模型警告

> ID：367846
> 
> 赞同：7
> 
> 时间：2008-12-15T09:23:33.420
> 
> 标签：c#, asp.net-mvc, model

我目前在 asp.net mvc 中使用 ModelStateDictionary 来保存验证错误，然后传递给用户。尤其是能够使用 ModelState.IsValid 检查整个模型是否有效。但是，我正在处理的当前应用程序需要能够报告警告。这些并不那么重要，因此仍然可以保存表单内容，但它们应该显示给用户，以便可以选择采取行动。

我一直在查看框架，看看是否有任何明显的地方可以扩展它以允许我这样做。我在想另一个带有警告的字典和一个模型错误的子类，称为模型警告。我不确定如何让框架在视图等中使用我的新容器类。不过，我仍然希望所有现有的错误内容都能正常工作。

如果有人尝试过类似的事情或有任何想法，我会很感激他们的意见。

更新：

我已经扩展了 ViewDataDictionary 以添加一些警告

```
public class AetherViewDataDictionary : ViewDataDictionary
{
    public AetherViewDataDictionary()
    {
        ModelStateWarning = new ModelStateDictionary();
    }

    public AetherViewDataDictionary(object model) : base(model)
    {
        ModelStateWarning = new ModelStateDictionary();
    }

    public AetherViewDataDictionary(ViewDataDictionary viewDataDictionary) : base(viewDataDictionary) 
    {
        ModelStateWarning = new ModelStateDictionary();
    }

    public ModelStateDictionary ModelStateWarning { get; private set; }
} 
```

我现在遇到的问题是，当我看到我的视图代码时，这只是为了调试，我失去了它是我的新类型的事实，所以当我尝试将它转换回来并访问我的新字典时我没有快乐。

```
public partial class Index : ViewPage<PageViewData>
{
    protected override void SetViewData(ViewDataDictionary viewData)
    {
        base.SetViewData(viewData);
    }
} 
```

它在这里正确设置，但是当我检查类型时它消失了。

编辑：事实证明这是一种愚蠢的做事方式，请参阅下面的答案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-16T09:14:42.470

所以我之前的路线被证明是一个坏主意，框架中没有足够的访问权限来获取您需要的位。至少不是没有重新发明轮子几次。

我决定继续扩展 ModelState 类以向其添加警告集合：

```
public class AetherModelState : ModelState
{
    public AetherModelState() { }

    public AetherModelState(ModelState state)
    {
        this.AttemptedValue = state.AttemptedValue;

        foreach (var error in state.Errors)
            this.Errors.Add(error);
    }

    private ModelErrorCollection _warnings = new ModelErrorCollection();

    public ModelErrorCollection Warnings { get { return this._warnings; } }
} 
```

为了能够以与错误相同的方式轻松添加警告，我为 ModelStateDictionary 创建了一些扩展方法：

```
public static class ModelStateDictionaryExtensions
{
    public static void AddModelWarning(this ModelStateDictionary msd, string key, Exception exception)
    {
        GetModelStateForKey(key, msd).Warnings.Add(exception);
    }

    public static void AddModelWarning(this ModelStateDictionary msd, string key, string errorMessage)
    {
        GetModelStateForKey(key, msd).Warnings.Add(errorMessage);
    }

    private static AetherModelState GetModelStateForKey(string key, ModelStateDictionary msd)
    {
        ModelState state;
        if (string.IsNullOrEmpty(key))
            throw new ArgumentException("key");

        if (!msd.TryGetValue(key, out state))
        {
            msd[key] = state = new AetherModelState();
        }

        if (!(state is AetherModelState))
        {
            msd.Remove(key);
            msd[key] = state = new AetherModelState(state);
        }

        return state as AetherModelState;
    }

    public static bool HasWarnings(this ModelStateDictionary msd)
    {
        return msd.Values.Any<ModelState>(delegate(ModelState modelState)
        {
            var aState = modelState as AetherModelState;
            if (aState == null) return true;
            return (aState.Warnings.Count == 0);
        });
    }
} 
```

GetModelStateForKey 代码很复杂，但您应该能够看到我的目标。接下来要做的是编写一些扩展方法，允许我显示警告和错误

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-15T12:00:39.110

为什么不简单地向 ViewData 添加警告列表或字典，然后在视图中显示它们？

例如

```
ViewData[ "warnings" ] = new[] { "You need to snarfle your aardvark" } ; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-10-17T07:41:57.927

我使用 Simon Farrow 的解决方案作为起点，使警告与 Kendo 的数据源一起工作。默认情况下，您可以返回并显示`Data`OR `Errors`，但我想返回并显示`Data`AND `Warnings`。所以我包装了 Kendo`DataSourceResult`并添加了另一个扩展方法，它返回收集的警告。

```
// The wrapper
public class DataSourceResultWithWarnings: DataSourceResult
{
    public object Warnings { get; }

    public DataSourceResultWithWarnings(DataSourceResult dataSourceResult, IDictionary<string, IDictionary<string, IList<string>>> warnings)
    {
        this.AggregateResults = dataSourceResult.AggregateResults;
        this.Data = dataSourceResult.Data;
        this.Errors = dataSourceResult.Errors;
        this.Total = dataSourceResult.Total;
        Warnings = warnings;
    }
}

// The extension method
public static IDictionary<string, IDictionary<string, IList<string>>> GetWarnings(this ModelStateDictionary msd)
{
    var result = new Dictionary<string, IDictionary<string, IList<string>>>();

    for (var i = 0; i < msd.Values.Count; i++)
    {
        var wms = msd.Values.ElementAt(i) as WarningModelState;
        if (wms != null)
        {
            if (!result.ContainsKey(msd.Keys.ElementAt(i)))
            {
                result.Add(msd.Keys.ElementAt(i), new Dictionary<string, IList<string>>() { { "warnings", new List<string>() } });
            }
            result[msd.Keys.ElementAt(i)]["warnings"].AddRange((from rec in wms.Warnings select rec.ErrorMessage));
        }
    }

    return result;
}

// How to use it in the controller action
var result = new DataSourceResultWithWarnings(files.Values.ToDataSourceResult(request, ModelState), ModelState.GetWarnings());
return Json(result, JsonRequestBehavior.AllowGet); 
```

# css - IE 中这个简单的 CSS 有什么问题？

> ID：367847
> 
> 赞同：0
> 
> 时间：2008-12-15T09:24:29.317
> 
> 标签：css, internet-explorer, border, margin

有一个 div 具有内部内容，一个 div 具有在 div 内部的边框。不知何故，这个 div 被扩展为包含下一个 div。这让我大吃一惊。

```
<div style="background: yellow;">
  <div>
    <div style="border: 1px solid black; background: green">green background</div>
  </div>
</div>
<div style="margin-top: 100px;">
  IE gives me a yellow background, unless i take away the border of the green 
  background div.
</div> 
```

我想知道这是什么原因以及如何解决它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T09:30:22.110

听起来你正处于过渡的怪癖模式，这是邪恶的。

严格解决了这个问题。

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T09:26:24.117

一种解决方案是将“位置：相对”放在任何地方，但这会破坏我页面中的其他内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T09:31:36.477

您在内部 div 中缺少分号。如果省略最后一个分号，我会看到一些非常奇怪的行为。

```
<div style="border: 1px solid black; background: green;">green background</div> 
```

不知道你有什么版本的 IE，但这适用于 IE7

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <title>Test</title>
  </head>  
  <body>
    <div style="background: yellow;">
     <div>
        <div style="border: 1px solid black; background: green;">green background</div>
      </div>
    </div>
    <div style="margin-top: 100px;">
      IE gives me a yellow background, unless i take away the border of the green 
      background div.
    </div>
  </body>
</html> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T09:57:50.760

您需要为第一个 div “提供布局”。您最好使用 IE6 目标样式来执行此操作：

```
<style>
   * html .haslayout {
       display:inline-block;
   }
</style>

...

<div style="background: yellow;" class="haslayout"> 
```

这是 hasLayout 属性的一个已知 IE6 问题。在此处阅读更多信息 - [http://www.satzansatz.de/cssd/onhavelayout.html](http://www.satzansatz.de/cssd/onhavinglayout.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T22:44:05.660

答案很简单，因为你嵌套了不同的 div，它们没有高度，所以 IE6 存在溢出。做这个：

```
<div style="background: yellow;height: 1%;"> 
```

它会工作得很好。

# sql - 存储过程，你能帮我吗？

> ID：367853
> 
> 赞同：0
> 
> 时间：2008-12-15T09:27:35.800
> 
> 标签：sql, sql-server, stored-procedures

下面是我的存储过程。我想使用存储过程从 tbl_member 中选择所有日期行并插入 2 个表。但这是行不通的。有人可以帮助我吗？

```
Create PROCEDURE sp_test
AS
BEGIN
    SET NOCOUNT ON;

    Declare @A Varchar(255), @B Varchar(255), @C Varchar(255), @D int

    Declare Table_Cursor Cursor 
    For select A, B, C from tbl_Member Open Table_Cursor 
        Fetch Next From Table_Cursor 
        Into @A, @B, @C While(@@Fetch_Status=0)

    Begin Exec(
        'insert into NewMember (A, B, C, D) values (@A, @B, @C, @D)
        set @D = @@IDENTITY
        Insert into MemberId (Mid) VALUES(@D)   
    )
    Fetch Next From Table_Cursor Into @A, @B, @C End Close Table_Cursor
    Deallocate Table_Cursor
END
GO 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-15T09:42:13.053

我可以在这里看到的第一件事是您在不需要时使用光标。您可以将第一个查询重写为：

```
INSERT INTO NewMember(A, B, C, D)
SELECT A, B, C, D
FROM tbl_member 
```

然后，我将对插入标识列的 NewMember 有一个 INSERT 触发器。

```
create trigger myInsertTrigger
on newmember
for insert
as
insert into memberid(mid)
select <<identity_column>> from inserted 
```

顺便说一句 - 使用 @@IDENTITY 来获取插入的身份是个坏主意。请改用 SCOPE_IDENTITY 函数。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-15T15:31:36.500

请特别注意皮特对@@identity 的评价。使用@@identity 不好的原因是，如果将触发器添加到插入另一个具有标识的表的表中，则返回的标识不是您刚刚插入的标识。这可能会导致可能几个月都无法解决的大量数据完整性问题。

即使您保留了游标（我不建议这样做，游标是一种非常糟糕的插入方式，因为与 Pete 提供的基于集合的解决方案相比它们非常慢），您的代码也无法插入第一个表如果列 D 是标识列（我猜这是因为您稍后尝试将 D 分配给标识值）。那是因为您试图将一个值放入无法接受自动生成的值的列中。如果 D 是标识，则根本不要在插入中使用它，只需定义需要插入的列。如果 D 实际上是您的身份列，Pete 的解决方案也是如此。

# c# - 用于 ASP.Net GridView 的 ASP.Net PagingBulletedList Extender

> ID：367859
> 
> 赞同：2
> 
> 时间：2008-12-15T09:30:36.463
> 
> 标签：c#, asp.net

有谁知道我可以与提供 ASP.Net Ajax Control PagingBulletedList 功能的 ASP.Net gridview 一起使用的控件。我想为用户提供一种更简单的方式来访问网格中的数据。

理想情况下，它应该以与网格分页相同的方式工作，只是它应该显示所选选项的所有数据，即如果选择了字母 a，则所有以 a 开头的项目都会显示给用户。

我宁愿不必重新开发这样的东西，因为我确信它存在，我只是不知道你会怎么称呼它。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-19T04:37:03.840

不幸的是，没有什么已经为此建立起来了。要构建自己的，您必须创建自己的[PagerTemplate](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.pagertemplate.aspx)。

[本教程](http://www.highoncoding.com/Articles/209_GridView%20Alphabet%20Paging.aspx)中有一些与代码类似的内容。本教程可能会帮助您很好地实现您的要求。我会用 PagerTemplate 而不是 GridView Footer 来做不同的事情。

所以基本上要创建它会给出的分页栏：

```
<asp:UpdatePanel runat="server" ID="UpdatePanel">
<asp:GridView runat="server" ID="GridView">
  <PagerTemplate>
    <asp:LinkButton runat="server" Text="A" Command="A" />
-
    <asp:LinkButton runat="server" Text="B" Command="B" />
-
    <asp:LinkButton runat="server" Text="C" Command="C" />
-
    <asp:LinkButton runat="server" Text="D" Command="D" />
-
    <asp:LinkButton runat="server" Text="E" Command="E" />
<%-- Continue at will... --%>
  </PagerTemplate>
</asp:GridView>
</asp:UpdatePanel> 
```

然后您在命令后面的代码中捕获并重新创建一个新的数据源，其中仅包含您需要的字母的数据。您必须了解 GridView 绑定到无法操作的数据源。因此，当您最初显示它时，数据源提供者只会发送带有字母 A 的数据。当您单击 F 时，您将要求数据提供者仅检索带有字母 F 的信息并将数据重新分配给 gridview ： GridView.Datasource =我的新数据

希望这可以帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T03:57:40.440

DataGrid 有自己的一组数据排序，您可以点击它，例如，您可以通过在 gridview 标记中添加 'AllowPaging="true"' 来分页 GridView（或通过代码隐藏，没关系）。您还可以允许排序 ('AllowSorting="true"')。

不幸的是，我还没有遇到可以根据字母进行过滤的这种性质的控件。但是，我确实为它创建了一个自定义控件，它只执行了一个 DataTable.Select() 并将 GridView 反弹到新的 DataSet。开发起来真的没那么难，能掌握这样的性质就好了。还有一件事是您可以添加一个文本框，该文本框将根据用户输入的结果进行过滤 - 但这更像是一个建议而不是解决方案。

希望这可以帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-19T06:29:42.707

它很丑，但只有一个分页数据网格，一个单元格有一个单独的 ul/li .. 它们会排列在一起，并为您提供所需的功能。否则你可能不得不自己动手。

# java - 用于文件过滤的 Java 正则表达式

> ID：367862
> 
> 赞同：1
> 
> 时间：2008-12-15T09:32:52.747
> 
> 标签：java, regex

我想在 Java 中构建一个正则表达式，它将在 FilenameFilter 中传递以过滤目录中的文件。

问题是我无法掌握正则表达式“思维模型”的窍门:)

这是我想出的用于选择要排除的文件的正则表达式

((ABC|XYZ))+\w*Test.xml

我想做的是选择所有以 Test.xml 结尾但不以 ABC 或 XYZ 开头的文件。

您能否添加任何可以帮助我解决正则表达式的资源。

谢谢

以下资源解释了很多关于 regexp 正则表达式的信息[。](http://www.regular-expressions.info/refadv.html)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-15T09:38:43.983

没有正则表达式，这些东西更容易、更快、更易读。

```
if (str.endsWith("Test.xml") && !str.startsWith("ABC")) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-15T10:10:46.740

> 我想做的是选择所有以 or 结尾`Test.xml` 但不以`ABC`or开头的文件`XYZ`。

要么你用这个正则表达式匹配你的所有文件：

```
^(?:(?:...)(?<!ABC|XYZ).*?)?Test\.xml$ 
```

或者你做相反的事情，并获取每个*不*匹配的文件：

```
^(?:ABC|XYZ).*?Test\.xml$ 
```

就个人而言，我发现第二种选择要简单得多。

```
ABC_foo_Test.xml // #2 匹配
XYZ_foo_Test.xml // #2 匹配
ABCTest.xml // #2 匹配
XYZTest.xml // #2 匹配
DEF_foo_Test.xml // #1 匹配
DEFTest.xml // #1 匹配
Test.xml // #1 匹配

```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T09:45:07.370

只是为了正则表达式的乐趣：

```
(?ms)^([^\r\n]{3}(?<!ABC|XYZ)[^\r\n]*?)?Test\.xml$ 
```

即使这不是最易读的解决方案，它也应该有效，并且可以避免您定义自己的自定义文件过滤器。

`(?<!ABC|XYZ)`是一个后视表达式，避免在任何第四个字符（前三个字符之后）前面加上您想要避免的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T20:49:13.597

Tomalak 和 VonC 提供的正则表达式比它们需要的更复杂。在正则表达式的开头放置一个否定的lookahead 比匹配三个字符并做一个否定的lookbehind 要清楚得多。如果您使用该`matches()`方法，您甚至不必使用锚点 ( `^`, `$`, `\z`)。

```
public boolean accept(File dir, String name) {
    return name.matches("(?!ABC|XYZ).*Test\\.xml");
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T14:03:32.170

这将选择不以 A、B、C、X、Y 或 Z 开头并以 Test.xml 结尾的文件：

"[^ABCXYZ].*Test\\.xml\\z"

*   [^ABCXYZ]：任何不在集合 A、B、C、X、Y、Z 中的字符。
*   .*：任何字符，零次或多次
*   测试：确切的文本“测试”
*   \\.：点字符（需要使用反斜杠进行转义，如果您在字符串中，则该反斜杠需要转义......通过反斜杠！）
*   xml：确切的文本“xml”
*   \\z: 输入结束

# sql - 从一个表中查找另一个表中不存在的记录

> ID：367863
> 
> 赞同：363
> 
> 时间：2008-12-15T09:33:09.920
> 
> 标签：sql, mysql

我有以下两个表（在 MySQL 中）：

```
Phone_book
+----+------+--------------+
| id | name | phone_number |
+----+------+--------------+
| 1  | John | 111111111111 |
+----+------+--------------+
| 2  | Jane | 222222222222 |
+----+------+--------------+

Call
+----+------+--------------+
| id | date | phone_number |
+----+------+--------------+
| 1  | 0945 | 111111111111 |
+----+------+--------------+
| 2  | 0950 | 222222222222 |
+----+------+--------------+
| 3  | 1045 | 333333333333 |
+----+------+--------------+ 
```

我如何找出哪些电话是由`phone_number`不在的人拨打的`Phone_book`？所需的输出将是：

```
Call
+----+------+--------------+
| id | date | phone_number |
+----+------+--------------+
| 3  | 1045 | 333333333333 |
+----+------+--------------+ 
```

* * *

## 回答 #1

> 赞同：526
> 
> 时间：2008-12-15T09:35:14.160

有几种不同的方法可以做到这一点，效率不同，具体取决于查询优化器的好坏以及两个表的相对大小：

这是最短的语句，如果您的电话簿很短，可能是最快的：

```
SELECT  *
FROM    Call
WHERE   phone_number NOT IN (SELECT phone_number FROM Phone_book) 
```

或者（感谢[Alterlife](https://stackoverflow.com/users/36848/alterlife)）

```
SELECT *
FROM   Call
WHERE  NOT EXISTS
  (SELECT *
   FROM   Phone_book
   WHERE  Phone_book.phone_number = Call.phone_number) 
```

或（感谢 WOPR）

```
SELECT * 
FROM   Call
LEFT OUTER JOIN Phone_Book
  ON (Call.phone_number = Phone_book.phone_number)
  WHERE Phone_book.phone_number IS NULL 
```

（忽略这一点，正如其他人所说，通常最好只选择你想要的列，而不是' `*`'）

* * *

## 回答 #2

> 赞同：107
> 
> 时间：2008-12-15T11:51:40.423

```
SELECT Call.ID, Call.date, Call.phone_number 
FROM Call 
LEFT OUTER JOIN Phone_Book 
  ON (Call.phone_number=Phone_book.phone_number) 
  WHERE Phone_book.phone_number IS NULL 
```

应该删除子查询，让查询优化器发挥它的魔力。

此外，请避免使用“SELECT *”，因为如果有人更改基础表或视图（而且效率低下），它可能会破坏您的代码。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-12-15T09:41:20.250

在处理更大的数据集时，下面的代码将比上面给出的答案更有效。

```
SELECT *
FROM Call
WHERE NOT EXISTS (
    SELECT 'x'
    FROM Phone_book
    WHERE Phone_book.phone_number = Call.phone_number
); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-01-16T10:42:29.467

```
SELECT DISTINCT Call.id 
FROM Call 
LEFT OUTER JOIN Phone_book USING (id) 
WHERE Phone_book.id IS NULL 
```

这将返回 Phone_book 表中缺少的额外 ID。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-02-15T12:39:13.707

我认为

```
SELECT CALL.* FROM CALL LEFT JOIN Phone_book ON 
CALL.id = Phone_book.id WHERE Phone_book.name IS NULL 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-10-24T14:53:22.903

```
SELECT t1.ColumnID,
CASE 
    WHEN NOT EXISTS( SELECT t2.FieldText  
                     FROM Table t2 
                     WHERE t2.ColumnID = t1.ColumnID) 
    THEN t1.FieldText
    ELSE t2.FieldText
END FieldText       
FROM Table1 t1, Table2 t2 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-12-09T16:17:24.060

```
SELECT name, phone_number FROM Call a
WHERE a.phone_number NOT IN (SELECT b.phone_number FROM Phone_book b) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-08-21T11:55:32.183

或者，

```
select id from call
minus
select id from phone_number 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-04-14T23:41:32.500

### 不要忘记检查您的索引！

如果您的表格很大，您需要确保电话簿在该 `phone_number`字段上有索引。对于大型表，数据库很可能会选择同时扫描两个表。

```
SELECT *
FROM   Call
WHERE  NOT EXISTS
  (SELECT *
   FROM   Phone_book
   WHERE  Phone_book.phone_number = Call.phone_number) 
```

您应该同时创建索引`Phone_Book`并`Call`包含`phone_number`. 如果性能成为问题，请尝试这样的精简索引，仅使用电话号码：

字段越少越好，因为它必须完全加载它。您需要两个表的索引。

```
ALTER TABLE [dbo].Phone_Book ADD CONSTRAINT [IX_Unique_PhoneNumber] UNIQUE NONCLUSTERED 
(
    Phone_Number
)
WITH (STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ONLINE = ON) ON [PRIMARY]
GO 
```

如果您查看查询计划，它将看起来像这样，您可以确认您的新索引实际上正在被使用。请注意，这适用于 SQL Server，但对于 MySQL 应该类似。

通过我展示的查询，除了扫描两个表中的每条记录之外，数据库实际上没有其他方法可以产生结果。

[![在此处输入图像描述](https://i.stack.imgur.com/Xv0BZ.png)](https://i.stack.imgur.com/Xv0BZ.png)

# apache-flex - 保护应用程序的某些部分

> ID：367870
> 
> 赞同：3
> 
> 时间：2008-12-15T09:38:52.063
> 
> 标签：apache-flex, actionscript-3, security

如果有人登录到我的应用程序，则该用户包含具有某些权限的字典。

```
ex: module.view.workspace = true
    module.view.reporting = false
    ... 
```

然后我们知道用户可以访问应用程序的哪些部分。我想知道的是我们如何在视图上应用这些权限。我们在 AS 3 (FLEX) 环境中工作。

这是我们迄今为止提出的（但我想了解其他可能性）。我们有一个 modelLocator 存储loggedOnUser（其中包含它的权限）。这些权限被添加到模型定位器中的一个权限对象中。我们创建一个 SecurityManager 类，它有一个名为 hasAccess("permission") 的函数。该对象将检查模型定位器中的 PermissionObject 并返回真/假。在视图中，我们只检查用户是否具有访问权限，然后显示控件。

```
If (SecurityManager.hasAccess("module.view.workspace") {
     // code that generates the workspace;
} 
```

我只是不知道这是否是最佳做法。请帮帮我。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-15T10:12:00.310

扫描仪，

我有一个类似的方法，到目前为止效果很好。我的应用程序是用 C#.NET 编写的，但该方法仍然有效。因为我的是一个 WinForms 应用程序，所以我必须做其他事情，但基本上在某些时候会有一个 If 语句询问同样的“问题”。

马丁。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-16T19:32:54.233

该方法基本有效。我建议使用静态 const 定义一个类，该类映射到您的不同权限并引用：

```
SecurityManager.hasAccess(SecurityManager.MODULE_VIEW_WORKSPACE) 
```

如果您开始更改权限项的名称，这将为您节省大量手动搜索/替换工作。

# iphone - 在将 iPhone 应用程序提交到 Apple Store 之前，如何在 iPhone 设备上测试我的 iphone 应用程序？

> ID：367872
> 
> 赞同：0
> 
> 时间：2008-12-15T09:41:13.867
> 
> 标签：iphone, testing

在将 iPhone 应用程序提交到 Apple Store 之前，如何在 iPhone 设备上测试我的 iphone 应用程序？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T10:02:14.760

您需要加入[iPhone 开发者计划](http://developer.apple.com/iphone/)。这将为您提供一个数字证书，您可以使用它来签署您的应用程序，并允许它在您自己的 iPhone 上运行并提交到 App Store。这些文档在您注册时可用，并且通常非常好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T18:47:30.647

您可以使用内置于最新 XCode 中的 iPhone 模拟器

您可以将 iPhone 或 iPod touch 连接到您的 Mac，XCode 将直接在设备上运行您的应用程序，并提供调试支持。

# c# - Visual Studio 中的调试和发布有什么区别？

> ID：367884
> 
> 赞同：120
> 
> 时间：2008-12-15T09:45:58.507
> 
> 标签：c#, .net, visual-studio

> .NET 中可能重复 [的调试 Visual Studio 版本](https://stackoverflow.com/questions/90871/debug-vs-release-in-net)

Visual Studio 中的调试和发布有什么区别？

* * *

## 回答 #1

> 赞同：127
> 
> 时间：2008-12-15T10:06:27.903

最重要的是在Debug模式下没有优化，而在Release模式下有优化。这很重要，因为编译器非常先进，可以对代码进行一些非常棘手的低级改进。结果，您的代码中的某些行可能根本没有任何说明，或者有些可能会完全混淆。逐步调试是不可能的。此外，局部变量通常以神秘的方式进行优化，因此 Watches 和 QuickWatches 通常无法工作，因为变量被“优化掉了”。还有许多其他优化。尝试调试优化的 .NET 代码，您会看到。

另一个关键区别是，因此默认的 Release 设置不会生成大量的调试符号信息。那是您可能已经注意到的 .PDB 文件，它允许调试器找出哪些汇编指令对应于哪一行代码等。

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2008-12-15T10:07:14.517

“调试”和“发布”实际上只是一系列可能影响构建和调试的设置的两个标签。

在“调试”模式下，您通常有以下内容：

*   程序调试数据库文件，允许您在运行时非常密切地跟踪程序在源代码中的执行。
*   关闭所有优化，这使您可以检查变量的值并跟踪可能已被优化掉或内联的函数
*   一个 _DEBUG 预处理器定义，允许您编写与发布模式相比在调试模式下行为不同的代码，例如检测仅应在调试时使用的 ASSERT
*   链接到也使用调试选项编译的库，这些库通常不会部署给实际客户（出于大小和安全性的原因）

在“发布”模式下，优化被打开（尽管有多个选项可用）并且_DEBUG 预处理器定义没有被定义。通常，您仍然希望生成 PDB 文件，因为当事情运行得更快时，能够在发布模式下“调试”非常有用。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-15T09:49:03.960

大多数情况下，调试包含许多在调试时有用的额外信息。在发布模式下，这一切都被削减并换取了性能。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-15T09:48:35.367

如果您浏览项目编译选项并比较它们，您会看到有什么区别。

假设问题是关于本机/C++ 代码（从措辞中并不完全清楚）：

基本上，在 Debug 中，所有代码生成优化都已关闭。一些库（例如[STL](https://en.wikipedia.org/wiki/Standard_Template_Library)）默认进行更严格的错误检查（例如调试迭代器）。生成更多调试信息（例如“编辑并继续”）。在代码中生成更多的东西来捕获错误（局部变量值设置为未初始化的模式，并使用调试堆）。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-15T09:51:55.157

可能值得一提的是，构建标志允许使用不同的逻辑，这些逻辑*应该*仅用于更改日志记录和“控制台”消息传递，但它*可能*被滥用并不仅可以显着改变低级别，还可以改变实际的业务逻辑。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-12-15T10:00:06.060

另请注意，例如，在使用[MFC](https://en.wikipedia.org/wiki/Microsoft_Foundation_Class_Library)`MFC90D.DLL`时，调试项目链接到不可再分发的 DLL 版本，例如，而发布版本链接到可再分发的版本，例如`MFC90.DLL`. 这可能类似于其他框架。

因此，您可能无法在非开发机器上运行调试构建应用程序。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2010-08-16T09:44:46.367

此外，很明显，调试模式会创建许多额外的线程来帮助调试。无论您是否附加调试器，它们在整个过程的生命周期中都保持活动状态。[在这里](https://stackoverflow.com/questions/3476642/why-does-this-simple-net-console-app-have-so-many-threads)查看我的相关问题。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2015-11-07T00:30:44.687

当我开发从现有 Release 构建配置复制的应用程序时，我也对这个问题感到好奇。

我有一个开发人员，他对在调试模式下使用该应用程序很感兴趣，所以我想知道如何制作这个以 ReleaseMyBuild 的名称存在的构建配置，该名称是从 Release 配置复制的（因此所有设置都应该针对发布优化) 突然改变团队并成为调试版本，尽管构建配置名称令人困惑。

我认为项目配置只是一个名称和一种方便的方式来选择 Joris Timmermans 提到的“全部设置”。我想知道这些设置可能使名为“FOO”的构建配置用作优化的*发布*构建的细节。

这是其中的一瞥。我从 Visual Studio 2010 的空项目模板创建了一个新的 VCXPROJ。然后我复制并编辑了它，第一个保留调试内容，第二个保留发布内容。这是以相关差异为中心的差异...

[![空 VCXPROJs 调试与发布差异](https://i.stack.imgur.com/Tfov9.png)](https://i.stack.imgur.com/Tfov9.png)

**释放**

```
<PropertyGroup>
    <WholeProgramOptimization>true</WholeProgramOptimization>

<ClCompile>
    <Optimization>MaxSpeed</Optimization>
    <FunctionLevelLinking>true</FunctionLevelLinking>
    <IntrinsicFunctions>true</IntrinsicFunctions>
<Link>
    <EnableCOMDATFolding>true</EnableCOMDATFolding>
    <OptimizeReferences>true</OptimizeReferences> 
```

**调试**

```
<PropertyGroup>
    <UseDebugLibraries>true</UseDebugLibraries>`

<ClCompile>
    <Optimization>Disabled</Optimization> 
```

有趣的是，在 Link 部分，它们都`GenerateDebugInformation`设置为 true。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-15T10:06:19.653

您可以看到的明显区别是二进制文件的大小。Debug 生成比 Release 生成更大的二进制文件。

在 Debug 中编译时，符号表被添加到代码文件的编译对象中，这允许调试程序利用这些二进制文件并访问对象和变量的值。

另一个可观察到的区别是，在发布模式下，二进制文件在调试模式下会简单地因致命错误而崩溃，如果您开始在 Visual Studio 中调试应用程序，您可以检查调用堆栈，它会告诉您错误语句的确切位置.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-10-10T15:59:38.227

> 在调试配置中，您的程序使用完整的符号调试信息进行编译，并且没有优化。优化使调试复杂化，因为源代码和生成的指令之间的关系更加复杂。
> 
> 您的程序的发布配置没有符号调试信息，并且已完全优化。对于托管代码和 C++ 代码，可以在 .pdb 文件中生成调试信息，具体取决于使用的编译器选项。如果您以后必须调试发布版本，则创建 .pdb 文件会很有用。

参考微软[文档](https://docs.microsoft.com/en-us/visualstudio/debugger/how-to-set-debug-and-release-configurations?view=vs-2019)。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-07-02T06:22:08.337

在调试配置中，您的程序使用完整的符号调试信息进行编译，并且没有优化。优化使调试复杂化，因为源代码和生成的指令之间的关系更加复杂。

您的程序的发布配置没有符号调试信息，并且已完全优化。对于托管代码和 C++ 代码，可以在 .pdb 文件中生成调试信息，具体取决于使用的编译器选项。如果您以后必须调试发布版本，则创建 .pdb 文件会很有用。

# asp.net - 会话级异常

> ID：367892
> 
> 赞同：1
> 
> 时间：2008-12-15T09:52:07.043
> 
> 标签：asp.net

我有一个页面。我需要捕获由于超时而引发的异常..

是否有像 System.Applicationexception 这样的异常消息

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T10:39:15.233

您可以在 Global.asax.cs 中使用 Application_Error 事件：

```
 protected void Application_Error(object sender, EventArgs e)
    {
                var exception = Server.GetLastError();
                LogException(exception);
    } 
```

并在记录此异常或什至邮寄它之后:)

# java - 在 Web 服务存根中生成等于

> ID：367905
> 
> 赞同：6
> 
> 时间：2008-12-15T10:00:57.760
> 
> 标签：java, web-services, equals

从我们的后端生成的所有 webservice-stubs 都有一个类似于这个的 equals 方法：

```
private java.lang.Object __equalsCalc = null;
public synchronized boolean equals(java.lang.Object obj) {
    if (!(obj instanceof PropertyData)) return false;
    PropertyData other = (PropertyData) obj;
    if (obj == null) return false;
    if (this == obj) return true;
    if (__equalsCalc != null) {
        return (__equalsCalc == obj);
    }
    __equalsCalc = obj;
    boolean _equals;
    _equals = true && 
        ((this.key==null && other.getKey()==null) || 
         (this.key!=null &&
          this.key.equals(other.getKey()))) &&
        ((this.value==null && other.getValue()==null) || 
         (this.value!=null &&
          this.value.equals(other.getValue())));
    __equalsCalc = null;
    return _equals;
} 
```

有人可以向我解释一下的目的`__equalsCalc`吗？我只是不明白。它不在课堂上的其他地方使用。在我看来，在计算“平等”期间它并不完全为空。然而 equals 是声明的`synchronized`。因此，在任何给定时间只能有一个线程在其中。我看不出来，为什么`if (__equalsCalc != null)`应该永远是真的。

请告诉我我愚蠢的误解;-)

编辑：我是该项目的新手，因此我的回答可能是错误的。但是如果我正确地跟踪它，该方法是由axis-wsdl2java生成的

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-15T10:07:37.137

我怀疑它试图停止递归 - 如果某物以自身为键，你不希望它永远递归。

但是，此时它使用引用相等来进行测试，这可能是不可取的。

生成此代码的原因是什么？它是一个本土系统，还是一个公共系统？如果是本土的，负责的开发商还在公司吗？

编辑：好的，现在我们知道它是 WSDL2Java，答案是（有点）在[源代码](https://github.com/apache/axis-axis1-java/blob/master/axis-codegen/src/main/java/org/apache/axis/wsdl/toJava/JavaBeanWriter.java)中：

```
 // The __equalsCalc field and synchronized method are necessary
    // in case the object has direct or indirect references to itself. 
```

进而：

```
 // Have we been here before ? return true if yes otherwise false
    pw.println("        if (__equalsCalc != null) {");
    pw.println("            return (__equalsCalc == obj);");
    pw.println("        }"); 
```

不是最具解释性的评论，但至少它们表明我们在考虑递归方面走在了正确的轨道上。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-15T10:03:52.467

__equalsCal 作为最后一次调用 Equals 的缓存。因此，如果使用相同的参数调用同一实例中对 equals 方法的两次调用，则该方法将更快

编辑：对不起，如果

```
__equalsCalc = null; 
```

不会在那里，但重新检查您的代码，可能我的回答无效。

# opengl - OpenGL：颜色不准确？

> ID：367907
> 
> 赞同：1
> 
> 时间：2008-12-15T10:01:34.607
> 
> 标签：opengl, colors, pixels

我正在尝试按照此页面上的说明进行操作：
[http](http://www.opengl.org/resources/faq/technical/color.htm)
://www.opengl.org/resources/faq/technical/color.htm 关于渲染具有独特颜色的图元

我检查了每种颜色的位数，结果是每种颜色的位数为 8。
调用时：

```
 glColor3ui(0x80000000, 0, 0xFF000000); 
```

并用 glReadPixels() 读回像素我得到颜色：`0xFFFE007F`
对应于`R=0x7F, G=0, B=0xFE`
红色和蓝色的两个低位是错误的。

这是为什么？
我正在使用最新驱动程序的戴尔笔记本电脑上使用全新的 nVidia 卡

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T10:28:22.477

事实证明，FAQ有一个错误。

[glColor](http://www.opengl.org/sdk/docs/man/xhtml/glColor.xml)的文档 指出：“指定时，无符号整数颜色分量线性映射到浮点值，以便**最大可表示值**映射到 1.0（全强度），0 映射到 0.0（零强度）。”
这实际上表明，要获得全白，我应该调用：

```
glColor3ui(0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF); 
```

并不是

```
glColor3ui(0xFF000000, 0xFF000000, 0xFF000000); 
```

正如常见问题解答所建议的那样。
这就解释了为什么 0xFF000000 映射到 254。

我已经向应该维护常见问题解答的人提交了错误报告

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T10:07:12.210

你也这样做过吗？

```
In either event, you'll need to ensure that any state that could
affect the final color has been disabled. The following code will
accomplish this:

glDisable (GL_BLEND); glDisable (GL_DITHER);
glDisable (GL_FOG); glDisable (GL_LIGHTING);
glDisable (GL_TEXTURE_1D); glDisable (GL_TEXTURE_2D);
glDisable (GL_TEXTURE_3D); glShadeModel (GL_FLAT); 
```

还要检查你的 glReadPixels 缓冲区是否有 24/32 位。

# dns - Windows XP/Vista/Win7 的免费 DNS 服务器？

> ID：367908
> 
> 赞同：35
> 
> 时间：2008-12-15T10:02:03.670
> 
> 标签：dns, subdomain, sysadmin

我目前正在开发一个应该跨域工作的安全解决方案，因此我需要一个小型私有 dns 服务器来添加各种条目。我可以更改主机文件以达到相同的结果，但由于主机文件不支持通配符，我将有很多条目，因此支持通配符的 DNS 服务器会更容易一些。有什么建议么？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2011-12-20T01:07:32.693

作为参考：http: [//sourceforge.net/projects/acrylic/](http://sourceforge.net/projects/acrylic/)

Acrylic 是一个本地 DNS 代理，它通过缓存来自 DNS 服务器的响应来提高计算机的性能。

我发现它在从 XP 到 Win8 的每个 Windows 系统上都能完美运行，而且它是开源的。

是的，它支持通配符……它甚至支持域名的正则表达式。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-15T10:06:56.483

有一个 XP 版本的[Bind](https://www.isc.org/software/bind)，可能作为 Windows 服务运行。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-10-16T21:31:44.797

如果您使用的是 Windows Server（Web 版除外），则可以使用 Microsoft DNS。如果您不使用 BIND 进行管理，或者安装[Simple DNS Plus试用版（14 天）。](http://www.simpledns.com/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-10-09T09:35:02.123

在将域转发到您的计算机时，我最喜欢双 DHCP DNS 服务器。也可以阻止在某些程序上运行的广告。它还排除通配符并适用于 Windows 8。

[http://sourceforge.net/projects/dhcp-dns-server/](http://sourceforge.net/projects/dhcp-dns-server/)

# sockets - 远程关闭后 TCP 套接字的状态是什么？

> ID：367914
> 
> 赞同：0
> 
> 时间：2008-12-15T10:04:28.750
> 
> 标签：sockets, tcp, solaris, netstat

假设我已经接受（）到我的服务器（在 Solaris 上运行）的连接，并且客户端已经关闭了连接。在服务器端关闭（）它之前，服务器端的套接字（在 netstat 类别中）的状态是什么？它是绑定的吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-15T10:44:21.900

它将是 CLOSE_WAIT，参见 tcp 状态图，例如在[http://en.wikipedia.org/wiki/File:Tcp_state_diagram_new.svg](http://en.wikipedia.org/wiki/File:Tcp_state_diagram_new.svg)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T12:27:50.443

在这种情况下，客户端上的套接字将处于 TIME_WAIT 状态，而服务器上的套接字将通过 CLOSE_WAIT 并很快变为 CLOSED，因此在它完全从列表中消失之前，您可能无法在 netstat 中捕获它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-20T17:20:53.257

应该是从开始到--->`CLOSE_WAIT`的末尾开始。`FIN``TIME_WAIT``CLOSED`

在这种情况下，首先启动的是客户端。所以服务器会去`CLOSE_WAIT`。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-06-13T20:36:06.773

CLOSE_WAIT

您可以通过以下方式检查：

ps辅助

lsof -a -p [server_process_id]

你会得到：袜子 0,8

状态 8：TCP_CLOSE

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-15T10:15:46.263

我猜，TIME_WAIT。

您可以在 Linux 上使用“netstat”检查它，不知道在 Solaris 上如何操作。

# c++ - 使用来自 c++ 程序的 dll。（borland c++ builder 和一般）

> ID：367926
> 
> 赞同：2
> 
> 时间：2008-12-15T10:09:00.800
> 
> 标签：c++, dll, c++builder, dllimport

我正在尝试在我的程序中使用 dll，即 libcurl，但是，它没有链接。Libcurl 带有我可以包含的 .h 文件（负责 dllimport），但是我想我必须指定在以某种方式链接时实际使用的 dll ......我该怎么做？我正在使用 Borland C++ builder 进行编译，但我真的很想知道这些东西一般是如何工作的......

编辑：这是代码（来自 curl 主页的直接 c/p）

```
bool FTPGetFile::ConnectToFTP(string ftpServer){
CURL *curl;
CURLcode res;
curl = curl_easy_init();
if(curl) {
    curl_easy_setopt(curl, CURLOPT_URL, "curl.haxx.se");
    res = curl_easy_perform(curl);
    return true;
}else{
    return false;
}
} 
```

以下是错误：

```
[链接器错误] 错误：从 C:\PROJECTS\PC\TOOLBOX\DEBUG_BUILD\FTPGETFILE.OBJ 引用的无法解析的外部 '_curl_easy_init'
[链接器错误] 错误：从 C:\PROJECTS\PC\TOOLBOX\DEBUG_BUILD\FTPGETFILE.OBJ 引用的无法解析的外部 '_curl_easy_setopt'
[链接器错误] 错误：从 C:\PROJECTS\PC\TOOLBOX\DEBUG_BUILD\FTPGETFILE.OBJ 引用的无法解析的外部“_curl_easy_perform”

```

编辑 2：根据 joe_muc 的建议，我使用 implib 工具制作了 lib 文件，并将它们包含在链接器路径中。我仍然得到同样的错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T11:41:13.877

在构建器的 bin 或 app 目录中应该有一个名为 IMPLIB.EXE 的程序。对 dll 运行它以创建一个 .lib 文件。

编辑：[在线文档](http://docs.codegear.com/docs/radstudio/radstudio2007/RS2007_helpupdates/HUpdate3/EN/html/devwin32/implib_xml.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-16T05:42:14.613

如前所述，您将需要与通过 implib 运行的 .dll 一起使用的静态 .lib 文件，并将结果 lib 文件添加到您的项目中。

如果你这样做了，那么：

*   您可能需要使用 stdcall 调用约定。您没有提及您使用的是哪个版本的 Builder，但它通常位于项目选项 - 高级编译器 - 调用约定下。
*   您可能需要启用 MFC 兼容性选项。
*   这可能是名称修改问题（项目选项 - C++ 兼容性选项）。
*   或世代下划线
*   或高级链接器选项“Case_insensitive-link”打开或关闭

libcurl 似乎是 C 代码；但如果是 C++，请注意 Microsoft 和 Borland 类一般不兼容。应该有一些技巧可以让它们发挥作用，但处理起来确实是一团糟，而且我从未成功过。C 编码的 DLL 应该可以工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-26T13:01:29.277

使用 "Depends.Exe" 浏览 .DLL，找到您要使用的函数的确切名称，然后为 dll 添加 .lib 文件（或使用 borland 的 implib 创建它），并包含 .lib 文件在您的 bpr 项目文件中，通过右键单击并将其添加到项目中。然后在代码的顶部，使用 __declspec(dllimport) 来取悦链接器之神。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T10:21:00.357

通常，如果您要链接 Windows DLL，则需要将 DLL 或导入库的名称传递给链接器，否则它将无法链接可执行文件。

您引用的错误消息表明您确实需要指定 DLL 或导入库。当您将 curl 构建为 DLL 时，它可能同时创建了一个 .lib 和一个 .dll 文件。将链接器指向 .lib 文件，并在启动应用程序时确保 .dll 文件位于路径中的目录中，以便加载程序可以找到它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-15T10:34:30.453

到目前为止，最常见的解决方案是使用作为构建 libcurl 的一部分的导入库 (.lib)。这告诉（静态）链接器如何为动态加载准备 EXE。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T11:28:19.877

您是否尝试将 .h 文件添加到您的项目中？

# batch-file - Windows 批处理文件 - ENABLEDELAYEDEXPANSION 查询

> ID：367934
> 
> 赞同：2
> 
> 时间：2008-12-15T10:13:00.963
> 
> 标签：batch-file, delayedvariableexpansion

[阅读了关于stackoverflow](https://stackoverflow.com/questions/305605/weird-scope-issue-in-bat-file)的现有帖子并在网上进行了一些阅读。我认为是时候在我失去太多头发之前发布我的问题了！

我在 Windows XP SP3 下双击运行的批处理文件中有以下代码：

```
SETLOCAL ENABLEDELAYEDEXPANSION

::Observe variable is not defined
SET test

::Define initial value
SET test = "Two"

::Observe initial value is set
SET test

::Verify if the contents of the variable matches our condition
If "!test!" == "Two" GOTO TWO

::First Place holder
:ONE

::Echo first response
ECHO "One"

::Second Place holder
:TWO

::Echo second response
ECHO "Two"

::Await user input
PAUSE

ENDLOCAL 
```

基本上我试图确定我是否可以使用条件来浏览我的脚本。很明显，我在变量范围和延迟变量扩展方面遇到了一些问题，但我对自己做错了什么有点迷茫。

谁能指出我正确的方向？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-15T11:31:25.470

您的直接问题是您将变量设置为值 <"Two"> 您可以在此处看到：

```
@echo off

SETLOCAL ENABLEDELAYEDEXPANSION

::Observe variable is not defined
SET test

::Define initial value
SET test = "Two"

::Observe initial value is set
SET test
echo %test%
echo..%test %.

::Verify if the contents of the variable matches our condition
If "!test!" == "Two" GOTO TWO

::First Place holder
:ONE

::Echo first response
ECHO "One"

::Second Place holder
:TWO

::Echo second response
ECHO "Two"

::Await user input
PAUSE

ENDLOCAL 
```

产生：

```
Environment variable test not defined
test = "Two"
. "Two".
"One"
"Two"
Press any key to continue . . . 
```

您的“set test”输出变量的原因与“set t”输出变量的原因相同 - 如果没有特定名称的变量，它会输出以该名称开头的所有变量。

set 命令也是一个挑剔的小野兽，不喜欢 '=' 字符周围的空格；它将它们（以及引号）合并到环境变量名称和分配给它的值中。相反，使用：

```
set test=Two 
```

此外，您在哪里使用延迟扩展，因为 %test% 和 !test! 将扩展相同。它在以下语句中很有用：

```
if "!test!" == "Two" (
    set test=TwoAndABit
    echo !test!
) 
```

内部 echo 将输出 TwoAndABit 而 %test%，当遇到整个 if 语句时扩展，将导致它输出 Two。

尽管如此，我总是在任何地方都使用延迟扩展来保持一致性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T19:07:18.283

SET 命令获取等号之后的所有内容，直到最后一个非空白字符。你的命令...

```
SET test = "Two" 
```

...正在将变量 test 设置为带有前导空格和引号的值“Two”，而不仅仅是字符串 Two。

所以当你测试...

```
If "!test!" == "Two" GOTO TWO 
```

你真的在测试...

```
If " "Two"" == "Two" GOTO TWO 
```

# java - Java GUI 创建组件

> ID：367940
> 
> 赞同：2
> 
> 时间：2008-12-15T10:16:25.060
> 
> 标签：java, user-interface, jbutton, jtextfield

我希望从术语上来说，GUI 中的组件就像 JButton、JPanel、JTextField 等所有好东西是正确的。

我想创建一个接受整数的文本字段。然后可以按下提交按钮，并根据输入的整数，在弹出窗口或其他任何内容中创建那么多文本字段。

我不知道，有人可以让我朝着正确的方向开始吗？

我遇到的麻烦是我不知道如何创建一个 for 循环来创建 GUI 组件。我的意思是，如果我有一个 for 循环并执行以下操作：

```
print("JTextField num1 = new JTextField()"); 
```

然后在 for 循环中，当我想要很多时，它只会创建 1 个文本字段。我如何一般地创建 JTextFields 的变量？

谢谢你的帮助...

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T10:24:17.620

使用适当的 LayoutManager（例如 GridLayout）来创建和添加您的文本字段。

```
for (i = 0; i < numberOfTextFields; i++) {
    JTextField textField = new JTextField();
    container.add(textField);
    /* also store textField somewhere else. */
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T10:24:36.200

尝试这样的事情：

```
List<JTextField> nums = new ArrayList<JTextField>();
JTextField tempField;

for (int i = 0; i < 10; i++) {
    tempField = new JTextField();
    jPanel1.add(tempField); // Assuming all JTextFields are on a JPanel
    nums.add(tempField);
} 
```

不要忘记为容器设置适当的布局管理器。（在这种情况下为 jPanel1）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T10:20:57.050

我会创建一个列表来存储文本字段，然后您可以通过索引将它们取回。然后，您可以根据需要拥有任意数量的字段。

```
List fields = new ArrayList();

// Create as many elements as you need
for (int i = 0; i < numberOfElements; i++){
  JTextField field = new JTextField();
  // Add the fields to some panel so they are shown in the screen.  
  // I assume that the component is called parent panel
  parentPanel.add(field);

  // Store the component in the list so you can retrieve it later
  fields.add(field);
}

// ...

// When you want to retrieve a particular one:

JTextField field = (JTextField)fields.get( indexToRetrieve ); 
```

# c# - srand((无符号)(时间(NULL))); (rand())/(RAND_MAX/2) - 1 个 C# 等效项

> ID：367947
> 
> 赞同：3
> 
> 时间：2008-12-15T10:23:42.613
> 
> 标签：c#, equivalent, srand

以下 c++ 的 c# 等价物是什么：

```
srand((unsigned)(time(NULL)));
weight=(double)(rand())/(RAND_MAX/2) - 1; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T16:35:41.817

The paramaterless constructor for Random uses "a time-dependent default seed value" so all you need is:

```
Random rnd = new Random();
return rnd.Next(-1, 1); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T10:26:38.487

要在 .NET 中生成随机值，您应该使用 Random 类。用时间值播种它，使用： Random rand = new Random((int)DateTime.Now.Ticks);

有关详细信息，最好查看 MSDN 中有关 Random 类的文档，例如哪些方法可用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T10:27:06.693

```
Random rnd = new Random((int)DateTime.Now.Ticks);
return rnd.Next(-1,1); 
```

# visual-studio - 在 Visual Studio 2008 中转出查找和替换框

> ID：367956
> 
> 赞同：2
> 
> 时间：2008-12-15T10:27:25.007
> 
> 标签：visual-studio, text-editor

我在 Visual Studio 2008 中，正在编辑 CSS 文件。我经常使用 ctrl+fa 来查找文件周围的内容。一旦我找到一些东西，我习惯于使用 Esc 键退出查找窗口并返回编辑器。

我发誓这就是我在办公室时的工作方式，但在家里，我必须按 ctrl+tab 才能返回编辑器窗口，我讨厌它！任何人都知道这里发生了什么，或者我是否只是疯了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T10:45:34.207

VS 中的某些窗口可以设置为 Floating、Dockable、Tabbed 等。尝试将其更改为其他窗口之一，看看是否有帮助（右键单击搜索窗口的标题）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T12:24:07.953

原来我的 Esc 键完全坏了。哈哈

# plumtree - 以编程方式从李子树知识目录下载文件

> ID：367961
> 
> 赞同：1
> 
> 时间：2008-12-15T10:29:13.817
> 
> 标签：plumtree

我是 plumtree 的新手，我正在尝试了解 Plumtree 对象模型。我正在尝试以编程方式从 plumtree 知识目录下载文件。

这是我正在使用的代码：

```
IRemoteSession session = RemoteSessionFactory.GetExplicitLoginContext(new Uri(url), userName, password);

IDocumentFolderManager DocFolderManager = session.GetDocumentFolderManager();
IDocumentManager DocManager = session.GetDocumentManager();
IObjectQuery FolderQuery = DocFolderManager.GetSubFolders(folderID);
IDocumentQuery DocQuery = DocManager.CreateQuery(FolderQuery.GetRow(i).GetID());
IObjectQuery DocumentQuery = DocQuery.Execute();
IObjectQueryRow document = DocumentQuery.GetRow(1);
IDocumentProperties _docProperties = DocManager.QueryDocumentProperties(document.GetID());
string docUrl = _docProperties.GetStringValue(5);

WebClient webclient = new WebClient();
webclient.Credentials = new System.Net.NetworkCredential(userName, password, "");
webclient.Credentials = CredentialCache.DefaultCredentials;
webclient.DownloadFile(docUrl, "c:\1"); 
```

但是我的会话创建代码似乎存在一些问题，因为此代码不是下载实际文件，而是将 Plumtree 登录页面下载到我的文件系统。

有人可以告诉我我在这里做错了什么吗？一定有我想念的东西

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-09-22T18:10:11.490

问题是您的 webclient 实例不知道如何对 plumtree 服务器进行身份验证。new NetowrkCredential() 或 CredentialCache.DefaultCredentials 在简单的情况下有效，但显然不适用于这种情况。

Plumtree 要么使用 cookie，要么（更有可能）使用通过调用 GetExplicitLoginContext() 获得的特定登录令牌，然后与该会话中的所有后续请求一起发送。

您可能会使用 WebClient 伪造这个“与所有后续请求一起发送”，但您需要了解有关 Plumtree 服务器如何验证客户端的更多技术细节。[您可以使用Fiddler](http://www.fiddlertool.com)找出其中的一些信息，但更简单的方法可能是找到一个 plumtree 提供的 API 来下载以前上传到 Plumtree 的文件。

解决此问题的另一种（hacky）方法是伪造浏览器客户端。在上面提出你的请求，然后解析 HTML，提取登录表单的操作 URL，然后伪造一个 HttpWebRequest 调用，它看起来像一个真正的客户端填写登录表单。您需要使用 CookieContainer 来确保发送 cookie、确保标头正确等。请参阅[http://channel9.msdn.com/forums/TechOff/162017-Using-WebClient-to-enter-Form- based-Auth-system-How/](http://channel9.msdn.com/forums/TechOff/162017-Using-WebClient-to-enter-Form-based-Auth-system-How/)了解更多信息。

# pdf - 按顺序打印大量 PDF

> ID：367962
> 
> 赞同：6
> 
> 时间：2008-12-15T10:29:22.117
> 
> 标签：pdf, printing, automation

很抱歉，如果这对于常规的 stackoverflow 问题来说有点偏离主题，但我们正在为这个问题而烦恼。我们有一批大约 3500 个 3 页 PDF 要打印（到目前为止一切正常），我们遇到的问题是它们以特定顺序打印（按文件名升序）至关重要。我们的假脱机程序似乎随机化了打印运行。关于以老式方式解决此问题或指出我以编程方式解决此问题的正确方向的任何想法？

TIA

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T11:03:54.607

谢谢大家，关于一个名为“首先打印假脱机文档”的打印机设置，我对techrepublic提出了一些建议，取消选中该框似乎已经遵守了文件发送的顺序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T10:34:54.463

您应该能够使用 PDF 库和一些简单的脚本将它们变成一个邪恶的文档。一份 PDF 统治他们，一份 PDF 找到他们，一份 PDF 将他们全部带入，在黑暗中捆绑他们……可以这么说。

编辑：作为一个更简单的选择，您可以获得可以为您做坏事的软件。到目前为止，我见过的最简单/最便宜的方法是通过[PDFSam](http://www.pdfsam.org/?page_id=32)。如果你给开发者一个欧元（或更多，你的特权），你会得到一个更好的版本。不知道除了加密之外还有什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-15T10:35:36.597

使用 iText (java) 或 iTextSharp (.net)，您可以按照您想要的顺序将它们放在一起。

不过，我会先看看打印后台处理程序。

# java - 如何生成没有绿色复选标记的签名 PDF

> ID：367965
> 
> 赞同：2
> 
> 时间：2008-12-15T10:30:20.493
> 
> 标签：java, pdf, itext, signature

我正在使用 iText 签署 PDF。我在签名中包含了一个图形。这可行，但是当文档被验证时显示的绿色复选标记（或黄色问号）会干扰我插入的图形，使最终结果看起来很难看。

它要么显示在签名图形的上方或下方，但我无法让它消失。

有谁知道如何解决这一问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T13:43:35.300

对不起，但我不明白这一点。您想要一个有效的签名，但没有可能看到该签名是有效的？对我来说没有意义。

无论如何，我认为绿色复选标记是由 Adob​​e Reader 呈现的，因此您将没有机会将其删除。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-25T03:01:48.090

解决这个问题的诀窍是删除现有的签名块并在其位置应用您的图像。然后，使用不可见的签名签署 PDF。这仍将允许用户打开签名侧边栏以验证签名是否有效。

# c# - 如何在 C# 中截获调试信息（Debugview 风格）？

> ID：367966
> 
> 赞同：3
> 
> 时间：2008-12-15T10:31:23.953
> 
> 标签：c#, debugging, testing, trace

出于测试目的，我计划制作一个小应用程序，该应用程序将侦听来自应用程序的特定事件并在那时与之交互。

鉴于我们在测试过程中无法更改应用程序代码，从我的角度来看，理想的做法是听取应用程序的调试跟踪，有点像 debugview 所做的，并做出响应到那个。

任何人都可以就如何最好地解决这个问题提供指导吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-17T12:27:13.673

我发现这样做的方式是使用 Microsoft 的[Mdbg 工具](http://blogs.msdn.com/jmstall/archive/2005/11/08/mdbg_linkfest.aspx)，让我可以从运行时访问核心调试信息。我正在使用的代码的基本形状如下所示：

```
 MDbgEngine mg;
 MDbgProcess mgProcess;
 try
 {
       mg = new MDbgEngine();
       mgProcess = mg.Attach(debugProcess.Id);
 }
 catch (Exception ed)
 {
       Console.WriteLine("Exception attaching to process " + debugProcess.Id );
       throw (ed);
 }
 mgProcess.CorProcess.EnableLogMessages(true);
 mgProcess.CorProcess.OnLogMessage += new LogMessageEventHandler(HandleLogMessage);
 mg.Options.StopOnLogMessage = true;
 mgProcess.Go().WaitOne();
 bool running = true;
 Console.CancelKeyPress += new ConsoleCancelEventHandler(Console_CancelKeyPress);
  while (running)
   {
       try
       {
           running =mgProcess.IsAlive;
           mgProcess.Go().WaitOne();
        }
        catch
         {
            running = false;
         }
     } 
```

无论如何，它似乎足以满足我的需要，也许它会为其他发现自己处于同一条船上的人提供有用的模板。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T11:00:37.717

您要使用`System.Diagnostics`基于标准的跟踪来跟踪的应用程序吗？在这种情况下，您可以构建自己的[TraceListener](http://msdn.microsoft.com/en-us/library/system.diagnostics.tracelistener(VS.80).aspx)。

# linux - libtool 将额外的“U”添加到 .so 文件名

> ID：367969
> 
> 赞同：2
> 
> 时间：2008-12-15T10:33:13.637
> 
> 标签：linux, autotools, libtool

我有一个用 autotools 构建的项目，分为两个文件夹；第一个*lib*创建一些库，第二个*tools*链接它们。
构建失败，因为 libtool 在重新链接时将库重命名如下：

```
mylib.1.0.0 -> mylib.1.0.0U 
```

重命名发生后，反正之前的名字没有恢复，也没有创建新的*mylib.1.0.0 ，所以像**mylib*这样的符号链接仍然指向没有多余*U*的名字，链接失败。
有没有办法避免这种情况？或者甚至可能完全避免重新链接？我正在使用 libtool 1.5.6 版。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T14:22:54.863

显然我明白了......
这个问题很容易通过以下结构重现：

*   一个*lib*文件夹，构建：
    *   *利巴*
    *   *libb*，取决于*liba*
*   一个*src*文件夹，构建*prog*，它链接 libb

然后你必须在 lib/Makefile.am 中指定这个：

```
lib_LTLIBRARIES = \
    libb.la \
    liba.la 
```

此时将生成一个 liba.so.1.0.0U 文件。改为指定（请注意库的顺序已更改）

```
lib_LTLIBRARIES = \
    liba.la \
    libb.la 
```

构建工作正常。
我同意以正确的顺序指定事物在任何情况下都是最好的做法；我仍然不清楚这是否是 libtool 错误......

# windows - 如何清除 Windows 命令行中的最后一行？

> ID：367971
> 
> 赞同：5
> 
> 时间：2008-12-15T10:33:22.703
> 
> 标签：windows, command-line, cmd

是否有一个功能可以清除命令提示符中的最后一行？我的意思不是“cls”——它清除了整个屏幕，我只想删除最后一行。

例如，我正在文件夹及其子文件夹中搜索文件，并且我想打印到 cmd 当前文件夹 - 但我想在文件夹更改时重写它，而不仅仅是追加到末尾。我知道，这只是一种平庸，但我很感兴趣如何做到这一点。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T10:36:37.283

最后一行是哪一行？
提示上方的那个？
如果这就是你的意思，那么不，没有办法使用提示来清除它。如果您正在谈论以编程方式执行此操作，请尝试`"\r"`像这样使用：

```
print("\rNew text in the line"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T11:43:28.503

如果您使用的是 ANSI 屏幕驱动程序，您可以简单地输出 "\r"，您的新行，然后输出 'ESC'、'['、'K'，这将清除到行尾。

但是需要注意的一件事是，您应该将输出长度限制为预期的屏幕宽度，这样行就不会换行，例如

```
c:\directory\really_big_name_too_long_..._so_Ive_put_some_ellipses_in.txt 
```

在这种情况下，您可以以任何方式将所有内容填充到 79 个字符，并且它只使用“\r”字符，独立于 ANSI 驱动程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T13:19:42.210

您在寻找 Ctl-c 吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-11-21T22:21:55.647

您可以使用括号记录前一个，然后不记录您要使用 TYPE 命令删除的行：（这只是一个示例）

```
(
echo (Previous Outputs)
(This may happen as many times as needed)
) >> C:\file.txt
set /P thing=
cls
type C:\file.txt
pause 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T10:49:08.160

不，没有命令可以执行此操作

# sql-server - 虚拟 PC 中的 MSSQLServer 2008

> ID：367980
> 
> 赞同：0
> 
> 时间：2008-12-15T10:39:22.440
> 
> 标签：sql-server, virtual-pc

您在虚拟 PC 中运行 SQL Server 有何经验？目前我们有一个在虚拟机中运行的 sql2008 实例。执行查询的那一刻，两个 CPU 都达到了顶峰。

在这件事上你有什么经验和建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-15T11:32:07.543

我在使用虚拟化 SQL 服务器进行大量数据库应用程序（ETL 开发）时遇到了一些严重的性能问题。请参阅[这篇 Stackoverflow 帖子](https://stackoverflow.com/questions/149318/virtualized-sql-server-why-not#149381)，了解我的经验以及深入研究潜在问题的结果。

本质上，像 ETL 这样的 DB 繁重的进程会破坏 I/O（更多的顺序操作，因此它不像 OLTP 应用程序那样等待磁盘寻道）和转换后备缓冲区（大数据集），这两者都非常慢在一个天真的虚拟化图像上。[AMD 网站上的该白皮书](http://developer.amd.com/assets/NPT-WP-1%201-final-TM.pdf)的发布链接（由供应商编写，因此持保留态度）该白皮书（在颂扬 AMD 新 Opteron 芯片的优点之间）谈到了一些潜在问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T10:47:14.187

你在使用 VMWare 吗？如果是这样，请从 9 月起应用服务包。

否则，如果您没有限制机器，您可以限制 2008 使用的资源。

# c++ - 有哪些 C++ HTTP 框架可用？

> ID：367984
> 
> 赞同：2
> 
> 时间：2008-12-15T10:41:09.800
> 
> 标签：c++, frameworks

有哪些可用的 C++ HTTP 框架有助于向应用程序添加 HTTP/SOAP 服务支持？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-15T11:57:51.143

您还可以查看：

[http://pocoproject.org/](http://pocoproject.org/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-15T10:43:42.040

好吧，当然是 gSOAP。:)

[http://www.cs.fsu.edu/~engelen/soap.html](http://www.cs.fsu.edu/~engelen/soap.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-04-25T15:36:25.120

**新的！**回答一个老问题：现在有 Beast，它同时提供 HTTP 和 WebSocket： [https](https://github.com/vinniefalco/Beast) ://github.com/vinniefalco/Beast 这是一个使用该库的工作程序：

```
#include <beast/http.hpp>
#include <boost/asio.hpp>
#include <iostream>
#include <string>

int main()
{
    // Normal boost::asio setup
    std::string const host = "boost.org";
    boost::asio::io_service ios;
    boost::asio::ip::tcp::resolver r(ios);
    boost::asio::ip::tcp::socket sock(ios);
    boost::asio::connect(sock,
        r.resolve(boost::asio::ip::tcp::resolver::query{host, "http"}));

    using namespace beast::http;

    // Send HTTP request using beast
    request<empty_body> req({method_t::http_get, "/", 11});
    req.headers.replace("Host", host + ":" + std::to_string(sock.remote_endpoint().port()));
    req.headers.replace("User-Agent", "Beast");
    write(sock, req);

    // Receive and print HTTP response using beast
    beast::streambuf sb;
    response<streambuf_body> resp;
    read(sock, sb, resp);
    std::cout << resp;
} 
```

该文档最近也更新了：http: [//vinniefalco.github.io/beast/index.html](http://vinniefalco.github.io/beast/index.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T23:58:29.473

产生一个高性能的服务器框架，支持 IIRC SOAP [。](http://code.google.com/p/yield/updates/list)

# complexity-theory - REXX 中 length() 的处理开销是多少？

> ID：367986
> 
> 赞同：1
> 
> 时间：2008-12-15T10:41:19.877
> 
> 标签：complexity-theory, overhead, rexx

REXX中length()函数的处理开销如何随字符串的长度变化？

* * *

更新：我正在使用：

*   uni-REXX (R) 版本 297t
*   Open-REXX (TM) 版权所有 (C) iX Corporation 1989-2002。版权所有。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T11:09:06.780

这完全取决于实施。您是指 OS/2 的 REXX、z/VM 的 REXX、z/OS 的 REXX、Windows 的 OOREXX、REXX/400 还是 Regina？

IBM 的 REXX 语言规范中没有任何内容规定该函数是如何在幕后实现的，如果您扫描字符串，则可能是 O(N)，如果长度与字符串一起存储在某处，则可能是 O(1)。

如果它*真的很*重要，最好用基准代码进行测试，看看长度是否有影响。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T03:09:25.963

开销为 0。长度存储在描述符中。

Neil Milsted uni-REXX 的作者（不开玩笑）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-15T10:51:54.910

我不知道。我在我的日子里写过一些 Rexx，但我从来没有遇到过 length() 函数的性能问题。这种扩展方式甚至可能取决于您对 Rexx 解析器的实现。

我会编写一个 Rexx 脚本，在 10 个字符的字符串上对“length()”调用 10.000 次，然后是 100 个字符的字符串，然后是 1000 个字符的字符串。

在图表中绘制结果时间将为您提供关于性能如何下降的近似值。

说了这么多，我的猜测是性能下降最多是线性的，就像在 O(n) 中一样。（见[http://en.wikipedia.org/wiki/Big_O_notation](http://en.wikipedia.org/wiki/Big_O_notation)）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-15T11:36:23.933

它是特定于语言实现的。我现在已经很久没有写任何 REXX 了，事实上我写了 AREXX（Amiga 实现），那是 15 年前的事了。:-)

您可以编写自己的测试例程。生成长度增加的字符串，并使用高性能计时器测量获取 length() 所需的时间。如果您将时间和字符串长度存储在基于文本文件的逗号分隔表中，则可以使用[gnuplot](http://www.gnuplot.info/)绘制它。然后你会非常清楚地看到它是如何扩展的。

编辑：我应该先检查罗尔夫的答案，因为他或多或少写了相同的东西。:-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-27T22:56:51.973

我可以代表 IBM Mainframe 版本、OS/2 的 Classic Rexx 版本以及任何 Object Rexx 实现。长度存储在字符串描述符中，因此开销与字符串长度无关。******************