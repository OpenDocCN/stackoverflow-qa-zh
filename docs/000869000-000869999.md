# StackOverflow 问答 000869000-000869999

# nginx - 如何使用 NGINX 直接提供所有现有的静态文件，但将其余的代理到后端服务器。

> ID：869001
> 
> 赞同：93
> 
> 时间：2009-05-15T14:24:27.660
> 
> 标签：nginx, reverse-proxy, static-files

```
location / {
    proxy_set_header X-Real-IP  $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    if (-f $request_filename) {
        access_log off;
        expires 30d;
        break;
        }

    if (!-f $request_filename) {
        proxy_pass http://127.0.0.1:8080; # backend server listening
        break;
        }
    } 
```

以上将直接使用 Nginx 提供所有现有文件（例如 Nginx 仅显示 PHP 源代码），否则将请求转发给 Apache。我需要从规则中排除 *.php 文件，以便对 *.php 的请求也传递给 Apache 并进行处理。

我希望 Nginx 处理所有静态文件，而 Apache 处理所有动态文件。

编辑：有白名单方法，但不是很优雅，查看所有这些扩展，我不想要这个。

```
location ~* ^.+.(jpg|jpeg|gif|png|ico|css|zip|tgz|gz|rar|bz2|doc|xls|exe|pdf|ppt|txt|tar|mid|midi|wav|bmp|rtf|js)$ {
    access_log off;
    expires 30d;
    }
location / {
    proxy_set_header X-Real-IP  $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass http://127.0.0.1:8080;
    } 
```

编辑 2：在 Nginx 的较新版本上`try_files`使用[http://wiki.nginx.org/HttpCoreModule#try_files](http://wiki.nginx.org/HttpCoreModule#try_files)

* * *

## 回答 #1

> 赞同：158
> 
> 时间：2013-03-17T23:27:39.707

使用[try_files](http://nginx.org/en/docs/http/ngx_http_core_module.html#try_files)和命名位置块 ('@apachesite')。这将删除不必要的正则表达式匹配和 if 块。更高效。

```
location / {
    root /path/to/root/of/static/files;
    try_files $uri $uri/ @apachesite;

    expires max;
    access_log off;
}

location @apachesite {
    proxy_set_header X-Real-IP  $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass http://127.0.0.1:8080;
} 
```

**更新：**此配置的假设是 .php 下不存在任何 php 脚本`/path/to/root/of/static/files`。这在大多数现代 php 框架中很常见。如果您的旧 php 项目在同一文件夹中混合了 php 脚本和静态文件，您可能必须将您希望 nginx 服务的所有文件类型列入白名单。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-05-16T21:02:21.673

试试这个：

```
location / {
    root /path/to/root;
    expires 30d;
    access_log off;
}

location ~* ^.*\.php$ {
    if (!-f $request_filename) {
        return 404;
    }
    proxy_set_header X-Real-IP  $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass http://127.0.0.1:8080;
} 
```

希望它有效。正则表达式的优先级高于纯字符串，因此所有`.php`以 `.php`休息将作为静态文件处理。评估位置的实际算法在[这里](http://wiki.nginx.org/NginxHttpCoreModule#location)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-02-13T19:37:05.673

如果您使用 mod_rewrite 来隐藏脚本的扩展名，或者您只是喜欢以 / 结尾的漂亮 URL，那么您可能想从另一个方向处理这个问题。告诉 nginx 让任何带有非静态扩展的东西通过 apache。例如：

```
location ~* ^.+\.(jpg|jpeg|gif|png|ico|css|zip|tgz|gz|rar|bz2|pdf|txt|tar|wav|bmp|rtf|js|flv|swf|html|htm)$
{
    root   /path/to/static-content;
}

location ~* ^!.+\.(jpg|jpeg|gif|png|ico|css|zip|tgz|gz|rar|bz2|pdf|txt|tar|wav|bmp|rtf|js|flv|swf|html|htm)$ {
    if (!-f $request_filename) {
        return 404;
    }
    proxy_set_header X-Real-IP  $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass http://127.0.0.1:8080;
} 
```

我在以下位置找到了该片段的第一部分：[http ://code.google.com/p/scalr/wiki/NginxStatic](http://code.google.com/p/scalr/wiki/NginxStatic)

# sdlc - 您的软件开发团队在术语或组织结构图上是如何构成的？

> ID：869004
> 
> 赞同：-1
> 
> 时间：2009-05-15T14:24:36.973
> 
> 标签：sdlc

我想知道您当前的团队在报告和组织结构图方面的结构。如果有人能提供贵组织中使用的各种角色的名称，那就太好了。

我想我完全搞砸了这个问题。我还想知道理想的设置是什么，有点像你梦想的组织结构图。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T14:33:41.833

我在一家小型软件公司工作；我们只有两个开发人员。在我开始编写软件之前，我学习了心理学，之后获得了 MBA 学位，所以我可以从现存的文献中告诉你，一般人可以管理 2-7 件事，而最佳的是 4-5。所以，你最好的选择是参加 5 人或更少的团体。如果您有 5 个团队，则一个人可以管理所有 5 个团队。如果您有 25 个团队，则每个团队由一个人管理，五个经理由一个人管理。

就我个人而言，我总是有两个程序员在同一张桌子上工作。我和我的首席开发人员在一张非常大的办公桌前工作。我们面对面，没有隔阂。我们相处得很好，协作的便利性使我们非常有效率。我可能总是有多达 3 到 4 名程序员同时在同一个办公室工作。我会让他们面对面，这样你仍然有隐私，所以通过眼神交流来提问是容易和舒适的。

另外，我不会让我的程序员呆在一个公共区域。对于程序员来说，分心可能会付出极大的代价。我喜欢他们有能力关上门说：“今天没有人打扰我……我在这个区域！”

最后，理想情况下，开发人员一次会处理尽可能少的项目。上下文切换是开发环境中的杀手。一个简单的分心可能会花费多达一个小时的生产力。上下文切换可能需要几个小时。因为我们太小了，我们经常在同一天完成 5 或 6 个项目。较大的公司几乎将程序员专门用于一个项目，这减少了由于上下文切换而导致的效率损失。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T14:31:24.727

在 Microsoft Windows 和 Office 组织中，产品开发团队（大部分）由三个角色的人组成，即项目管理 (PM)、测试人员和开发人员。

当然，开发者负责开发。测试团队负责开发功能和相关的测试和基础设施；并运行测试以发现错误。很少有测试是手工完成的——我们花了很多时间使事情自动化。这包括设计事物以使它们更易于测试。

项目管理角色负责沟通、协调和规划。这对不同的团队意味着不同的事情。但它们是将一切粘合在一起的粘合剂。

从组织结构图的角度来看，事情非常传统。大多数经理有 3 到 9 人向他们汇报——不是太平，但也不是太深。一个非常扁平的组织树在微软不会很好地工作（这并不意味着它很糟糕，但从文化的角度来看，拥有超过 9 个直接下属是具有挑战性的）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T14:27:40.630

*   软件工程总监
*   首席软件工程师
*   高级软件工程师
*   软件工程师二
*   软件工程师我

我们还有“团队负责人”职位和“项目工程师”职位。我确定还有其他的我忘记了，但今天早上我还没有喝足够的咖啡。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T14:32:32.337

我们有：

主人。

开发*人员（从技术上讲，所有者是开发人员之一）*。

没有中层管理人员，没有头衔，没有不必要的手续。

为我工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T14:27:16.920

在我的公司，我们的管理结构非常扁平。我们的开发团队没有任何等级制度；所有软件工程师都处于同一“级别”，并直接向软件开发副总裁报告。有时我们中的一个人会被派去领导一个项目，但在我们公司，这只是意味着不同的职责，而不是晋升。这有点酷，因为它使我们的开发团队成为精英。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-15T14:28:04.717

在大多数情况下，我们的设置是这样的：

经理 <- CMMI 促进者 <- 软件工程师 I-IV

经理 <- 系统工程师

这是一个相当简单的设置，但效果很好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T14:28:57.710

[导演] <-> [PM] <-> [开发人员，测试人员]

[开发者] <-> [导演]

很平。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-15T18:49:15.293

我们的人力资源报告关系不同于开展工作的团队。我们有三个 Scrum 团队，其中有几个产品负责人，但这些团队中的人不一定向他们团队中的某个人报告。高级开发人员（我们三个）向工程总监报告，其余的其他开发人员（六人）向两名高级开发人员报告。同时，测试人员和 SDET 都向高级 SDET 报告。因此，在人力资源管理方面，有 3 名中层管理人员向工程总监汇报，还有一名没有任何报告的高级开发人员和我们的架构师。这 15 个左右的人依次分布在三个不一定与组织结构图一致的 Scrum 团队中。Scrum 团队负责日常确定人们应该做什么，

# iphone - 货币面具

> ID：869030
> 
> 赞同：0
> 
> 时间：2009-05-15T14:30:06.397
> 
> 标签：iphone, currency, mask

我需要创建一个货币掩码。我做了几行命令，它工作正常，但是当我在文本字段中设置值时，发生了无限循环。我使用 Editing Changed 行为监视文本字段，以捕获用户设置的每个字符，但是当我尝试更改文本值时，会发生无限循环。:(

有人有简单的代码吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-17T16:13:40.740

您是否在 textFieldDidChange 中设置文本？因为如果你这样做了，textFieldDidChange 通知将再次触发并且文本被再次设置并且通知将再次触发等等......

我也试过这样做。我能想出的唯一解决方案是在用户离开 textField 时格式化您的文本。在用户编辑文本字段时，我没有找到可靠格式化文本字段内容的方法。

# java - 如何在 Java 中复制对象？

> ID：869033
> 
> 赞同：870
> 
> 时间：2009-05-15T14:30:26.943
> 
> 标签：java, object, copy, clone

考虑下面的代码：

```
DummyBean dum = new DummyBean();
dum.setDummy("foo");
System.out.println(dum.getDummy()); // prints 'foo'

DummyBean dumtwo = dum;
System.out.println(dumtwo.getDummy()); // prints 'foo'

dum.setDummy("bar");
System.out.println(dumtwo.getDummy()); // prints 'bar' but it should print 'foo' 
```

所以，我想`dum`在不`dumtwo`影响. 但是上面的代码并没有这样做。当我改变一些东西时，同样的改变也在发生。`dum``dumtwo``dum``dumtwo`

我想，当我说`dumtwo = dum`，Java**仅复制参考**。那么，有没有办法创建一个新的副本`dum`并将其分配给`dumtwo`?

* * *

## 回答 #1

> 赞同：673
> 
> 时间：2009-05-15T14:35:42.483

创建一个复制构造函数：

```
class DummyBean {
  private String dummy;

  public DummyBean(DummyBean another) {
    this.dummy = another.dummy; // you can access  
  }
} 
```

每个对象还有一个克隆方法，可以用来复制对象，但不要使用它。创建一个类并执行不正确的克隆方法太容易了。*[如果您打算这样做，请至少阅读 Joshua Bloch 在Effective Java](http://books.google.com/books?id=ka2VUBqHiWkC&pg=PA55&lpg=PA55&dq=effective+java+clone&source=bl&ots=yXGhLnv4O4&sig=zvEip5tp5KGgwqO1sCWgtGyJ1Ns&hl=en&ei=CYANSqygK8jktgfM-JGcCA&sa=X&oi=book_result&ct=result&resnum=3#PPA54,M1)*中对此的看法。

* * *

## 回答 #2

> 赞同：439
> 
> 时间：2012-03-23T05:47:34.717

**基础：** Java 中的对象复制。

让我们假设一个 object- `obj1`，它包含两个对象**containsObj1**和**containsObj2**。
![在此处输入图像描述](https://i.stack.imgur.com/ZK4pQ.gif)

**浅拷贝：**
浅拷贝创建一个新`instance`的相同类并将所有字段复制到新实例并返回它。**Object 类**提供了一种`clone`方法并提供了对浅拷贝的支持。
![在此处输入图像描述](https://i.stack.imgur.com/xhF9B.gif)

**深拷贝：**
当*一个对象连同它所引用的对象一起被拷贝*时，就会发生深拷贝。下图显示`obj1`了对其执行深层复制后的情况。*不仅`obj1`被复制了*，而且其中包含的对象也被复制了。我们可以`Java Object Serialization`用来制作深拷贝。不幸的是，这种方法也存在一些问题（[详细示例](http://javatechniques.com/blog/faster-deep-copies-of-java-objects/)）。
![在此处输入图像描述](https://i.stack.imgur.com/mtNjt.gif)

**可能的问题：**
`clone`很难正确实施。
最好使用[防御性复制](http://www.javapractices.com/topic/TopicAction.do?Id=15)、[复制构造函数](http://www.javapractices.com/topic/TopicAction.do?Id=12)（如@egaga 回复）或[静态工厂方法](http://www.javapractices.com/topic/TopicAction.do?Id=21)。

1.  如果你有一个对象，你知道它有一个公共`clone()`方法，但你在编译时不知道对象的类型，那么你就有问题了。Java 有一个名为`Cloneable`. 在实践中，如果我们想制作一个对象，我们应该实现这个接口`Cloneable`。`Object.clone`是**受保护**的，所以我们必须用公共方法*覆盖*它才能访问它。

2.  当我们尝试对*复杂对象进行***深度复制**时，会出现另一个问题。假设所有成员对象变量的方法也做深拷贝，这个假设风险太大。您必须控制所有类中的代码。*`clone()`* 

 *例如[org.apache.commons.lang.SerializationUtils](http://commons.apache.org/lang/api-2.5/org/apache/commons/lang/SerializationUtils.html#clone%28java.io.Serializable%29)将具有使用序列化（[Source](http://www.jarvana.com/jarvana/view/commons-lang/commons-lang/2.4/commons-lang-2.4-sources.jar!/org/apache/commons/lang/SerializationUtils.java?format=ok)）进行深度克隆的方法。如果我们需要克隆 Bean，那么[org.apache.commons.beanutils](http://commons.apache.org/beanutils/api/org/apache/commons/beanutils/BeanUtils.html) ( [Source](http://grepcode.com/file/repo1.maven.org/maven2/commons-beanutils/commons-beanutils/1.8.0/org/apache/commons/beanutils/BeanUtils.java) ) 中有几个实用方法。

*   `cloneBean`将根据可用的属性 getter 和 setter 克隆 bean，即使 bean 类本身没有实现 Cloneable。
*   `copyProperties`对于属性名称相同的所有情况，会将属性值从源 bean 复制到目标 bean。

* * *

## 回答 #3

> 赞同：149
> 
> 时间：2013-05-02T19:45:03.023

包`import org.apache.commons.lang.SerializationUtils;`中有一个方法：

```
SerializationUtils.clone(Object); 
```

例子：

```
this.myObjectCloned = SerializationUtils.clone(this.object); 
```

* * *

## 回答 #4

> 赞同：109
> 
> 时间：2010-05-17T09:27:25.760

只需按照以下说明：

```
public class Deletable implements Cloneable{

    private String str;
    public Deletable(){
    }
    public void setStr(String str){
        this.str = str;
    }
    public void display(){
        System.out.println("The String is "+str);
    }
    protected Object clone() throws CloneNotSupportedException {
        return super.clone();
    }
} 
```

无论您想在哪里获得另一个对象，都可以简单地执行克隆。例如：

```
Deletable del = new Deletable();
Deletable delTemp = (Deletable ) del.clone(); // this line will return you an independent
                                 // object, the changes made to this object will
                                 // not be reflected to other object 
```

* * *

## 回答 #5

> 赞同：45
> 
> 时间：2014-08-16T09:27:25.860

为什么使用反射 API 没有答案？

```
private static Object cloneObject(Object obj){
        try{
            Object clone = obj.getClass().newInstance();
            for (Field field : obj.getClass().getDeclaredFields()) {
                field.setAccessible(true);
                field.set(clone, field.get(obj));
            }
            return clone;
        }catch(Exception e){
            return null;
        }
    } 
```

这真的很简单。

编辑：通过递归包含子对象

```
private static Object cloneObject(Object obj){
        try{
            Object clone = obj.getClass().newInstance();
            for (Field field : obj.getClass().getDeclaredFields()) {
                field.setAccessible(true);
                if(field.get(obj) == null || Modifier.isFinal(field.getModifiers())){
                    continue;
                }
                if(field.getType().isPrimitive() || field.getType().equals(String.class)
                        || field.getType().getSuperclass().equals(Number.class)
                        || field.getType().equals(Boolean.class)){
                    field.set(clone, field.get(obj));
                }else{
                    Object childObj = field.get(obj);
                    if(childObj == obj){
                        field.set(clone, clone);
                    }else{
                        field.set(clone, cloneObject(field.get(obj)));
                    }
                }
            }
            return clone;
        }catch(Exception e){
            return null;
        }
    } 
```

* * *

## 回答 #6

> 赞同：33
> 
> 时间：2013-07-09T20:14:24.277

我使用 Google 的 JSON 库对其进行序列化，然后创建序列化对象的新实例。它会进行深度复制，但有一些限制：

*   不能有任何递归引用

*   它不会复制不同类型的数组

*   应键入数组和列表，否则将找不到要实例化的类

*   您可能需要将字符串封装在您自己声明的类中

我还使用这个类来保存用户偏好、窗口和在运行时重新加载的东西。它非常易于使用且有效。

```
import com.google.gson.*;

public class SerialUtils {

//___________________________________________________________________________________

public static String serializeObject(Object o) {
    Gson gson = new Gson();
    String serializedObject = gson.toJson(o);
    return serializedObject;
}
//___________________________________________________________________________________

public static Object unserializeObject(String s, Object o){
    Gson gson = new Gson();
    Object object = gson.fromJson(s, o.getClass());
    return object;
}
       //___________________________________________________________________________________
public static Object cloneObject(Object o){
    String s = serializeObject(o);
    Object object = unserializeObject(s,o);
    return object;
}
} 
```

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2009-05-15T14:36:25.430

是的，您只是在引用该对象。如果它实现了，您可以克隆该对象`Cloneable`。

查看这篇关于复制对象的 wiki 文章。

[参考这里：对象复制](http://en.wikipedia.org/wiki/Object_copy#Copying_in_Java)

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2013-07-31T15:00:04.060

将代码添加`Cloneable`到您的课程中

```
public Object clone() throws CloneNotSupportedException {
        return super.clone();
    } 
```

用这个 `clonedObject = (YourClass) yourClassObject.clone();`

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2014-07-08T17:14:09.310

深度克隆是您的答案，这需要实现`Cloneable`接口并覆盖`clone()`方法。

```
public class DummyBean implements Cloneable {

   private String dummy;

   public void setDummy(String dummy) {
      this.dummy = dummy;
   }

   public String getDummy() {
      return dummy;
   }

   @Override
   public Object clone() throws CloneNotSupportedException {
      DummyBean cloned = (DummyBean)super.clone();
      cloned.setDummy(cloned.getDummy());
      // the above is applicable in case of primitive member types like String 
      // however, in case of non primitive types
      // cloned.setNonPrimitiveType(cloned.getNonPrimitiveType().clone());
      return cloned;
   }
} 
```

你会这样称呼它 `DummyBean dumtwo = dum.clone();`

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2017-01-26T08:50:46.297

这也有效。假设模型

```
class UserAccount{
   public int id;
   public String name;
} 
```

首先添加 `compile 'com.google.code.gson:gson:2.8.1'`到您的应用程序>gradle & sync。然后

```
Gson gson = new Gson();
updateUser = gson.fromJson(gson.toJson(mUser),UserAccount.class); 
```

`transient`您可以通过在访问修饰符后使用关键字来排除使用字段。

**注意：**这是不好的做法。也不建议使用`Cloneable`，否则`JavaSerialization`它很慢而且坏掉了。编写复制构造函数以获得最佳性能[ref](http://www.javapractices.com/topic/TopicAction.do?Id=12)。

就像是

```
class UserAccount{
        public int id;
        public String name;
        //empty constructor
        public UserAccount(){}
        //parameterize constructor
        public UserAccount(int id, String name) {
            this.id = id;
            this.name = name;
        }

        //copy constructor
        public UserAccount(UserAccount in){
            this(in.id,in.name);
        }
    } 
```

**90000 次迭代的测试统计数据：**
行`UserAccount clone = gson.fromJson(gson.toJson(aO), UserAccount.class);`耗时**808 毫秒**

线路`UserAccount clone = new UserAccount(aO);`耗时不到**1ms**

**结论：**如果您的老板很疯狂并且您更喜欢速度，请使用 gson。如果您更喜欢质量，请使用第二个复制构造函数。

您还可以在 Android Studio 中使用复制构造函数代码[生成器插件。](https://plugins.jetbrains.com/plugin/7225-generatecopyconstructor)

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2009-05-15T14:35:02.393

是的。您需要[深度复制](http://en.wikipedia.org/wiki/Object_copy)您的对象。

* * *

## 回答 #12

> 赞同：10
> 
> 时间：2009-05-15T14:35:32.327

`clone()`如果您最终需要它，这是一个不错的解释......

[这里：克隆（Java方法）](http://en.wikipedia.org/wiki/Clone_%28Java_method%29)

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2011-10-23T16:12:06.923

使用深度克隆实用程序：

```
SomeObjectType copy = new Cloner().deepClone(someObject); 
```

[这将深度复制任何 java 对象，请在https://github.com/kostaskougios/cloning](https://github.com/kostaskougios/cloning)上查看

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2014-12-23T12:46:35.313

传递要复制的对象并获取所需的对象：

```
private Object copyObject(Object objSource) {
        try {
            ByteArrayOutputStream bos = new ByteArrayOutputStream();
            ObjectOutputStream oos = new ObjectOutputStream(bos);
            oos.writeObject(objSource);
            oos.flush();
            oos.close();
            bos.close();
            byte[] byteData = bos.toByteArray();
            ByteArrayInputStream bais = new ByteArrayInputStream(byteData);
            try {
                objDest = new ObjectInputStream(bais).readObject();
            } catch (ClassNotFoundException e) {
                e.printStackTrace();
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        return objDest;

    } 
```

现在解析`objDest`所需的对象。

快乐编码！

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2009-05-15T14:33:07.623

为此，您必须以某种方式克隆对象。虽然 Java 有克隆机制，但如果没有必要，请不要使用它。创建一个为您完成复制工作的复制方法，然后执行以下操作：

```
dumtwo = dum.copy(); 
```

[以下](https://stackoverflow.com/questions/475842/copy-an-object-in-java)是有关完成副本的不同技术的更多建议。

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2019-09-19T08:29:23.017

替代[egaga 的](https://stackoverflow.com/a/869078/1876355)复制构造方法。您可能已经有一个 POJO，所以只需添加另一个方法`copy()`来返回初始化对象的副本。

```
class DummyBean {
    private String dummyStr;
    private int dummyInt;

    public DummyBean(String dummyStr, int dummyInt) {
        this.dummyStr = dummyStr;
        this.dummyInt = dummyInt;
    }

    public DummyBean copy() {
        return new DummyBean(dummyStr, dummyInt);
    }

    //... Getters & Setters
} 
```

如果您已经拥有`DummyBean`并想要一份副本：

```
DummyBean bean1 = new DummyBean("peet", 2);
DummyBean bean2 = bean1.copy(); // <-- Create copy of bean1 

System.out.println("bean1: " + bean1.getDummyStr() + " " + bean1.getDummyInt());
System.out.println("bean2: " + bean2.getDummyStr() + " " + bean2.getDummyInt());

//Change bean1
bean1.setDummyStr("koos");
bean1.setDummyInt(88);

System.out.println("bean1: " + bean1.getDummyStr() + " " + bean1.getDummyInt());
System.out.println("bean2: " + bean2.getDummyStr() + " " + bean2.getDummyInt()); 
```

> 输出：
> 
> ```
> bean1: peet 2
> bean2: peet 2
> 
> bean1: koos 88
> bean2: peet 2 
> ```

但两者都运作良好，这最终取决于你......

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2020-05-14T17:16:02.440

用于`gson`复制对象。

```
public static <T>T copyObject(Object object){
    Gson gson = new Gson();
    JsonObject jsonObject = gson.toJsonTree(object).getAsJsonObject();
    return gson.fromJson(jsonObject,(Type) object.getClass());
} 
```

假设我有一个对象`person`。所以

```
Person copyPerson = copyObject(person); 
```

**注意：**性能要慢得多。

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2009-05-15T14:43:35.163

除了显式复制之外，另一种方法是使对象不可变（无`set`或其他修改器方法）。这样，问题就永远不会出现。对于较大的对象，不变性变得更加困难，但另一方面是它会将您推向分裂成连贯的小对象和组合的方向。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2014-03-02T13:35:20.950

```
class DB {
  private String dummy;

  public DB(DB one) {
    this.dummy = one.dummy; 
  }
} 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2011-07-25T16:59:42.950

您可以使用 XStream 自动从[http://x-stream.github.io/](http://x-stream.github.io/)进行深度复制：

> XStream 是一个简单的库，用于将对象序列化为 XML 并再次返回。

将其添加到您的项目中（如果使用 maven）

```
<dependency>
    <groupId>com.thoughtworks.xstream</groupId>
    <artifactId>xstream</artifactId>
    <version>1.3.1</version>                
</dependency> 
```

然后

```
DummyBean dum = new DummyBean();
dum.setDummy("foo");
DummyBean dumCopy = (DummyBean) XSTREAM.fromXML(XSTREAM.toXML(dum)); 
```

有了这个，您无需实现任何克隆接口即可获得副本。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2018-02-04T08:27:50.183

```
public class MyClass implements Cloneable {

private boolean myField= false;
// and other fields or objects

public MyClass (){}

@Override
public MyClass clone() throws CloneNotSupportedException {
   try
   {
       MyClass clonedMyClass = (MyClass)super.clone();
       // if you have custom object, then you need create a new one in here
       return clonedMyClass ;
   } catch (CloneNotSupportedException e) {
       e.printStackTrace();
       return new MyClass();
   }

  }
} 
```

并在您的代码中：

```
MyClass myClass = new MyClass();
// do some work with this object
MyClass clonedMyClass = myClass.clone(); 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2009-05-15T19:49:59.733

您可以尝试实现`Cloneable`和使用该`clone()`方法；但是，如果您使用 clone 方法，您应该 - 按照标​​准 - 始终覆盖`Object`'s`public Object clone()`方法。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2017-02-05T16:17:11.430

如果您可以向源文件添加注释，则可以使用像[这样的注释处理器或代码生成器。](https://github.com/h908714124/zerobuilder "零建造者")

```
import net.zerobuilder.BeanBuilder

@BeanBuilder
public class DummyBean { 
  // bean stuff
} 
```

`DummyBeanBuilders`将生成一个类，该类具有`dummyBeanUpdater`创建浅拷贝的静态方法，与手动创建的方法相同。

```
DummyBean bean = new DummyBean();
// Call some setters ...
// Now make a copy
DummyBean copy = DummyBeanBuilders.dummyBeanUpdater(bean).done(); 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2021-06-15T18:43:58.383

# 使用 Kotlin 扩展功能

```
fun <T : Any?> T.duplicate(): T? {
    var copyObject: T? = null
    try {
        val byteArrayOutputStream = ByteArrayOutputStream()
        val objectOutputStream = ObjectOutputStream(byteArrayOutputStream)
        objectOutputStream.writeObject(this)
        objectOutputStream.flush()
        objectOutputStream.close()
        byteArrayOutputStream.close()
        val byteData = byteArrayOutputStream.toByteArray()
        val byteArrayInputStream = ByteArrayInputStream(byteData)
        try {
            copyObject = ObjectInputStream(byteArrayInputStream).readObject() as T
        } catch (e: ClassNotFoundException) {
            e.printStackTrace()
        }
    } catch (e: IOException) {
        e.printStackTrace()
    }
    return copyObject
} 
```

### 用例

```
var object = Any()
var duplicateObject = object.duplicate() 
```

# 爪哇

```
<T extends Object> T copyObject(T sourceObject) {

    T copyObject = null;

    try {
        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
        ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream);
        objectOutputStream.writeObject(sourceObject);
        objectOutputStream.flush();
        objectOutputStream.close();
        byteArrayOutputStream.close();
        byte[] byteData = byteArrayOutputStream.toByteArray();
        ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(byteData);
        try {
            copyObject = (T) new ObjectInputStream(byteArrayInputStream).readObject();
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        }
    } catch (IOException e) {
        e.printStackTrace();
    }
    return copyObject;
} 
```

### 用例

```
Object object = new Object();
Object duplicateObject = copyObject(object); 
```

===============================================

# 科特林更新

如果您使用数据类，那么您将拥有复制 Kotlin 数据类的复制方法。很酷的事情是您还可以传递一些值来使用新副本修改对象。我会推荐这种方式。

例子：

//班级

```
data class TestModel(val title: String, var subtitle: String) 
```

### 用例

```
val testClass = TestModel("Test title", "Test subtitle")

val newInstance = testClass.copy(subtitle = "new subtitle for copy instance") 
```

# java - 在一个非常大的项目中使用 ANT 生成 .jar

> ID：869034
> 
> 赞同：1
> 
> 时间：2009-05-15T14:30:53.633
> 
> 标签：java, eclipse, ant, jar

我有一个正在处理的大型项目（使用 Eclipse），它使用 1.5 update 18 JDK、各种外部 JAR 等。这一切都在 Eclipse 中正确设置。是否可以在我的项目中创建一个从特定源文件生成 JAR 的 Ant 文件？（许多源文件可以编译成 Java 应用程序。所有这些文件共享许多相同的资源，因此项目工作空间很大）。

到目前为止，我只能弄清楚如何为整个项目创建一个 Ant 构建文件，而不是将特定的 .java 文件构建到应用程序中，更不用说从中创建一个 .jar 了。

感谢所有的帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T14:35:16.120

`jar`您可以通过配置任务来指定要包含在 jar 文件中的文件。`includes`您可以通过使用和`includesFile`选项来配置哪些类文件进入 jar 。请参阅[Jar 任务文档](http://ant.apache.org/manual/Tasks/jar.html)。

# svn - 像 Trac 这样的 FogBugz SVN 集成？

> ID：869042
> 
> 赞同：6
> 
> 时间：2009-05-15T14:31:42.790
> 
> 标签：svn, trac, fogbugz

FogBugz 是否像 Trac 那样与 SVN 集成？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-15T14:34:16.467

是的！

[FogBugz 6 源代码控制集成](http://www.fogcreek.com/FogBugz/docs/60/topics/advanced/Sourcecontrolintegration.html)

基本上，您设置了一个 svn 提交后挂钩脚本，用于检查提交消息中是否存在 FogBugz Case #。我通常设置我的钩子脚本来查找字符串“BUGZID：NNN”。

如果你使用[TortoiseSVN](http://tortoisesvn.tigris.org/)，你甚至可以配置它，以便在 Commit 对话框中有一个输入 case # 的框。

如果它找到一个有效的 case #，它会添加一堆关于提交到 FogBugz 案例的信息。

![](https://farm4.static.flickr.com/3382/3532971601_f94604dc00.jpg?v=0)

# oracle - Oracle - 如何在存储过程中有一个 out ref 游标参数？

> ID：869055
> 
> 赞同：1
> 
> 时间：2009-05-15T14:33:37.327
> 
> 标签：oracle, scoping

我们的应用程序将信息从 oracle 存储过程传递到 oracle .net 提供程序的标准方式是通过 out ref 游标参数。

过去我们所有的存储过程都在包中，并且有这样的东西：

```
CREATE OR REPLACE PACKAGE test_package IS
   TYPE refcur IS REF CURSOR;
   PROCEDURE get_info ( o_cursor            OUT      refcur );
END test_package;
/
CREATE OR REPLACE PACKAGE BODY test_package IS
   PROCEDURE get_info ( o_cursor            OUT      refcur ) AS
   BEGIN
     OPEN o_cursor FOR
       SELECT * FROM v$database;
   END get_info;
END test_package;
/ 
```

现在我想将该 get_info 过程移出包并进入常规过程，但不知道如何获取 refcur 类型。如何在包范围之外创建它？

创建或替换类型 refcur 是 REF CURSOR；

不起作用。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-15T16:45:04.060

我不能在这里测试它（没有 Oracle），但你可以这样做：

```
create or replace procedure get_info(p_cursor out sys_refcursor)
is
begin
  open p_cursor for
    select *
    from   v$database; 
end;
/ 
```

在 Oracle 9 及更高版本中，不再需要声明**TYPE result_crsr IS REF CURSOR**

请改用**sys_refcursor**。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T14:37:48.970

```
TYPE result_crsr IS REF CURSOR; 
```

使用 ref 游标的匿名 SQL 块示例：

```
DECLARE
   TYPE result_crsr IS REF CURSOR;
   crsr_test_result   result_crsr;
BEGIN

   OPEN crsr_test_result FOR
        SELECT * from user_objects;
     ? := crsr_test_result;
END; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T14:45:18.623

试试这个：

```
CREATE OR REPLACE PROCEDURE get_info(o_cursor OUT sys_refcursor) IS
BEGIN
  OPEN o_cursor FOR SELECT * FROM dual;
END;
/ 
```

您的问题提出了两个重要问题：

1）你说它“不起作用”。我认为这意味着当您执行该语句时，Oracle 正在返回一个异常。Oracle 返回的错误消息是什么？它应该以 ORA-nnnnn 开头，然后是一些文本。

2) 将 PROCEDURE 从 PACKAGE 中移出可以达到什么目的？包中还有几行代码，过程签名在包规范和包体中重复，但在包中包含过程提供了几个重要的好处。

# security - 使用 .htaccess 文件保护网站目录是否安全？

> ID：869072
> 
> 赞同：4
> 
> 时间：2009-05-15T14:35:17.837
> 
> 标签：security, authentication, .htaccess, .htpasswd

我想知道使用 .htaccess 文件（使用公共 apache webroot 之外的 .htpasswd 文件）保护 Web 目录是否是保护目录（及其内容）的安全方法。

有人可以解释这种保护的注意事项吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-19T22:55:40.420

如果您使用标准 http 协议，身份验证将在网络上不受保护地通过。这不被认为是安全的，因为有人可能会嗅到密码。

如果您限制对 https 的访问，这是非常安全的。这意味着为 ssl 加密的 http 流量（端口 433，浏览器地址行中的 https://）安装和启用 apache 模块，并在端口 80 上禁用此目录的标准 http 流量。用户名和密码将为 ssl加密。一定要选择一个好的密码（足够长和复杂，无法猜测或暴力破解）。

Apache 配置可能很棘手，因此请注意保持简单并针对可能的错误进行测试。

如果您了解并控制它，最好将访问限制配置从 .htaccess 文件移动到主 apache 配置文件。您也可以更轻松地将其保存在 .htacces 文件中。而“简单”可以更安全。以您感觉简单、安全、易于维护和记忆的方式进行操作。

这是一个简单的设置，可增强安全性并防止事故发生：

如果您在受保护目录所在的计算机上配置了 php 和电子邮件，则可以编写一个简单的警报脚本。只是一个 php 文件“alarm.php”，其中包含向您发送电子邮件的 php 邮件功能，告诉您 htaccess 保护不起作用。

如果您的域和目录路径是“ [http://mybox.example.com/secretdir/alarm.php](http://mybox.example.com/secretdir/alarm.php) ”，您可以在另一台机器上的浏览器中输入它，只要 htaccess 是“打开的”，您就应该收到该邮件。如果它受到保护，您可以输入用户名和密码，您也会收到邮件。

要为此发出自动警报，您可以使用不同的 unix 框，每 15 分钟左右尝试获取此 url。crontab 的行：

*/15 * * * * user1 wget [http://mybox.example.com/secretdir/alarm.php](http://mybox.example.com/secretdir/alarm.php)

user1 是这台机器上允许运行 wget 的用户，并且必须安装 wget。

您可以禁用 htaccess 保护作为测试，并且应该每 15 分钟收到一次邮件。

根据我的经验，当您更改某些内容并且您不知道时，您认为受保护的目录会失去其保护，这是一个常见的安全漏洞，这样您就会收到警告您的电子邮件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-18T08:36:44.260

据我所知，如果 htaccess 被拦截，它很容易被破解（fe 您正在从运行网络嗅探器的网吧登录）。[据我所知](http://trac.edgewall.org/wiki/TracCgi#AddingAuthentication)，[Digest 身份验证](http://www.webreference.com/internet/apache/chap5/3/2.html)有助于解决这个问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T15:07:47.383

**.htaccess 是在您无权访问**主配置文件/没有 root 访问权限的情况下，如何对 Apache HTTPD 提供的资源进行每个目录配置更改的非常标准的方法。

如果您可以访问主配置，则将所有配置（包括身份验证）放在一个中心位置（即使它被拆分为多个文件）会容易得多，这样就不容易忽略它。根据我的经验，我可以告诉您，忘记您的`.htaccess`文件只是时间问题。

官方文档多次提到`.htaccess`应尽可能避免使用文件。

如果使用`.htaccess`是您唯一的选择，请确保您遵循与主要 HTTPD 配置一样的一般安全预防措施，即防止未经授权的用户读取它们，服务器可以读取文件，确保禁用目录列表，始终确保密码存储在加密/散列格式等

有关更多信息，请查看[Apache`htaccess`教程](http://httpd.apache.org/docs/2.2/howto/htaccess.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-16T10:25:50.297

.htaccess 文件非常方便，但是......这不会保护您免受他人利用您的代码并读取他想要的任何文件。如果您的网站（即使是一个小脚本）将被利用，.htaccess 或其他解决方案也不会保护您，因为黑客将获得执行脚本的用户的权限（通常是 www-data）。

这在 CGI 中尤其痛苦，但其他脚本也被黑客入侵。

# sql - 使用同义词与视图的优缺点是什么？

> ID：869073
> 
> 赞同：39
> 
> 时间：2009-05-15T14:35:19.380
> 
> 标签：sql, database, database-design

这是一个通用的数据库设计问题 - 在数据库开发中使用同义词比简单视图有什么好处？在两者之间进行选择时要记住的主要考虑因素是什么？

一个示例**视图**：

```
CREATE VIEW Users AS
SELECT * FROM IdentitySystem.dbo.Users 
```

和等效的同义词：

```
CREATE SYNONYM Users 
FOR IdentitySystem.dbo.LCTs 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-05-15T14:43:40.750

它们是不同的东西。同义词直接是对象的别名，视图是一个或多个表的构造。

使用视图的一些原因：

*   可能需要过滤、连接或以其他方式使用结果集的结构和语义

*   可能需要为已更改但具有您不想重新工作的依赖项的基础结构提供遗留支持。

*   可以提供安全性，其中表的某些内容应该对一类用户可见，但不是全部。这可能涉及删除包含敏感信息的列或过滤掉记录的子集。

*   可能希望将一些业务逻辑封装在用户可以访问的表单中，以进行报告。

*   您可能希望统一来自多个来源的数据。

......还有更多。

使用同义词的原因：

*   您可能希望为另一个数据库中的对象起别名，您不能（或不想）对特定数据库的引用进行硬编码。

*   您可能希望重定向到随时间变化的源，例如存档表。

*   您希望以不影响查询优化器的方式对某些内容进行别名。

......还有更多。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-15T15:02:18.737

有很多考虑。简而言之，使用最适合每种情况的工具。

有观点，我可以

*   隐藏列
*   添加谓词（WHERE 子句）以限制行
*   重命名列
*   为 SQL 表达式指定列名

使用同义词，我可以：

*   在不限定名称的情况下引用其他模式和数据库中的对象

同义词可能还可以做更多事情。在我们（Oracle 数据库）应用程序的设计中，我们为所有数据库对象（表、视图、触发器等）使用“所有者”模式（用户），并将这些对象的权限授予其他“应用程序”用户。在每个“app”用户模式中，我们创建同义词来引用“所有者”对象。

高温高压

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-16T11:41:46.263

视图主要是一个简单/复杂的“选择”语句。本质上，您将视图用作掩码，并仅显示那些有用的列值。您使用视图的目的是不向最终用户显示额外信息。

而同义词是数据库对象的替代名称。

*   它允许您在其他模式中使用表，而无需在表名中使用点作为模式名的前缀（user.tab_name 可以替换为 some_synonym_name）
*   你没有兴趣与他人分享实际对象，

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-12-30T20:49:14.863

我使用同义词来共享来自其他数据库的对象，因此当我使用 .Net Entity Framework 时，我可以使用单个 ObjectContext 从许多数据库中访问所有需要的数据。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-10-04T00:52:19.240

视图的列投影是在创建时建立的。因此，如果您将一列添加到基础视图，则在您更改视图之前它不会被公开。同义词并非如此。将其视为 tsql 中的简单名称替换，通常是为了隐藏复杂性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-02-05T01:02:02.820

如果我错了，请纠正我，但我认为我看到了同义词的另一种用法（至少在 Progress OpenEdge 中），我没有在任何地方看到记录，这可以使它比视图更安全。DML SELECT 语句语法允许您使用表、视图或同义词，但 INSERT、UPDATE 和 DELETE 语句只允许使用表或视图。一些视图，如果它们满足某些标准，则提供对数据的可更新、可插入和可删除的访问。同义词似乎是提供对数据的只读访问权限的好方法，而不必弄乱授予（或拒绝）视图的权限。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-01-08T07:49:18.357

我希望它可以帮助某人，我看了一下这篇文章，我找到了使用视图而不是同义词的理由。

当您使用 Sql server 作为 Db 服务器和 SAS 作为客户端时。如果您使用同义词，您的 SAS 库中将无法识别它。我必须创建一个视图。

它没有经过优化，但至少带有 Sql server 的 Windows sas 也不是最好的:)

# sql - 一种检查 SQL 2005 中是否存在外键的方法

> ID：869081
> 
> 赞同：45
> 
> 时间：2009-05-15T14:35:57.117
> 
> 标签：sql, sql-server-2005, foreign-keys

有没有一种简单的方法来检查表中的列是否存在外键？我正在编写一个脚本，仅当它不存在时才会添加外键。

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-05-15T14:38:09.373

您可以使用此脚本：

```
IF EXISTS (SELECT * 
           FROM sys.foreign_keys 
           WHERE object_id = OBJECT_ID(N'[dbo].[FK_NAME]') 
             AND parent_object_id = OBJECT_ID(N'[dbo].[MyTable]'))
BEGIN
    -- do stuff
END 
```

如果您展开表并右键单击现有 FK 并选择脚本键作为“DROP TO”，则可以做到这一点，然后您将从 SQL 中获得生成的脚本。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-15T14:39:29.573

呜呼！我刚刚花了过去两天做这个。

```
IF NOT EXISTS ( SELECT  name
                FROM    sys.foreign_keys
                WHERE   name = 'FK_Name' ) 
    ALTER TABLE table_name ADD CONSTRAINT FK_Name FOREIGN KEY (idcol) 
                           REFERENCES OtherTable(idcol) 
```

# objective-c - 如何在 NSTextView 中找到字符的像素位置？

> ID：869086
> 
> 赞同：3
> 
> 时间：2009-05-15T14:36:29.923
> 
> 标签：objective-c, cocoa, nstextview

我目前正在使用以下代码来获取字形的逻辑 NSView 位置，该位置运行良好，但它似乎有点慢，并且位置并不精确地位于字符字距调整点和基线上。很有可能我需要做的就是一个一个地迭代字形本身并自己构建矩形。

现在这段代码（函数），只是想看看它是否可以更有效或更正确地完成。

```
// lastRange is any valid, bounds checked character range in an NSTextView

NSLayoutManager *layoutManager = [self layoutManager];
NSRect paragraphRect = [layoutManager boundingRectForGlyphRange:lastRange inTextContainer:[self textContainer]];

// Draw a gradient around the range.
NSGradient * gradient = [self indicatorGradient];
CGContextRef myContext = [[NSGraphicsContext currentContext] graphicsPort];
CGContextSetBlendMode(myContext , kCGBlendModeMultiply);
[gradient drawInRect:paragraphRect angle:90]; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-17T16:27:17.910

这是做到这一点的方法。但是，如果 lastRange 是您所描述的 characterRange，则必须将其通过

```
lastRange = [layoutManager glyphRangeForCharacterRange:lastRange actualRange:NULL]; 
```

首先要得到正确的结果。您还需要确保考虑文本布局的文本容器的来源，然后执行

```
NSPoint containerOrigin = [[container textView] textContainerOrigin];
paragraphRect = NSOffsetRect(paragraphRect,containerOrigin.x,containerOrigin.y); 
```

在绘图之前。

# asp.net - AntiXss.JavaScriptEncode 是否有充分的理由将结果包装成单引号？

> ID：869089
> 
> 赞同：5
> 
> 时间：2009-05-15T14:37:00.983
> 
> 标签：asp.net, xss, antixsslibrary

我一直在使用[Microsoft 的 AntiXss 库](http://www.microsoft.com/downloads/details.aspx?familyid=efb9c819-53ff-4f82-bfaf-e11625130c25&displaylang=en)，想知道它的方法是否有充分的理由`JavaScriptEncode`将结果用单引号括起来？这种行为似乎不合常规。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-29T07:53:24.407

实际上新的 3.0beta 版本有一个标志 JavaScriptEncode(string input, bool flagforQuote)。将其设置为 false，会产生不带引号的结果。

[http://www.microsoft.com/downloads/details.aspx?familyid=051EE83C-5CCF-48ED-8463-02F56A6BFC09&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=051EE83C-5CCF-48ED-8463-02F56A6BFC09&displaylang=en)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T14:42:06.120

可能是为了确保它返回一个字符串。我见过的用法是接受输入并返回一个值，您可以将其分配给 javascript 中的变量。

var message=<%=AntiXss.JavaScriptEncode(message)%>;

现在，无论消息中包含什么内容，js 变量消息都会正确转义正确的输入，因此如果某些混蛋试图将 javascript 注入该消息中，他们只会看到将消息分配给消息变量的结果。

# c# - BitSharp / MonoTorrent 扼杀所有同行

> ID：869091
> 
> 赞同：1
> 
> 时间：2009-05-15T14:37:34.493
> 
> 标签：c#, bittorrent, monotorrent, bitsharp

我正在编写一个库来通过 bittorrent 下载文件。不会有用户干预。用户将幸福地不知道文件甚至正在被下载。我选择了 BitTorrent 作为传输文件的首选方法，并围绕 MonoTorrent 库构建了应用程序。在我的服务器上，我运行 bttrack python 脚本进行跟踪，并运行 rTorrent 进行播种。

我已成功将 1078 个文件下载到客户端计算机上。然而，有 2 个文件分别没有超过 8% 和 11%。当我使用 uTorrent、BitTorrent 甚至 MonoTorrent GUI 时，文件下载没有任何问题。

除了我自己的以外，所有客户端都可以正常下载。我使用哪个客户端播种并不重要。文件大小或文件名都没有什么异常：

72 359 940b - a05276e5193644d48aaf711242b40a30.ssz

74 448 896b - e5ba856c6115453091d8b82ae53749bd.ssz

第一个文件在我的客户端下载到 7.58% (5.30MB)。第二个文件为 11.42% (8.30MB)。

在 rTorrent（从 rTorrent 播种时）屏幕上，它最初显示状态为 r/ci/un（远程发起的连接/远程客户端阻塞本地客户端，有兴趣下载/本地客户端未阻塞远程客户端，对上传不感兴趣）

当种子到达死锁时，状态变为r/cn/cn（远程发起的连接/远程阻塞本地，对下载不感兴趣/本地客户端阻塞远程，对上传不感兴趣）

转移停在那里，无论我做了什么，我都无法让它继续前进。

我正在使用 MonoTorrent 版本 0.70.0.0，SVN 修订版 134304。

由于客户端都在昂贵的 GSM 连接上，我将种子设置为 0 个上传槽。但即使在测试中，为上传分配插槽也不能解决问题。

我怎样才能让这些客户成为朋友，而不再互相扼杀？

编辑：我还尝试了 monotorrent svn 中的示例客户端。它也只下载上面提到的文件。MonoTorrentGUI 是在旧版本的 MonoTorrent（版本 0.2.0.0）上构建的，它会下载文件，但即使我尝试使用该二进制文件，它也不会通过我的应用程序下载。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-01-25T07:27:48.793

这里的问题原来是 monotorrent 库中的一个错误。它已在此期间修复。作者的论坛上有一个帖子有详细说明。

[http://monotorrent.21.forumer.com/viewtopic.php?t=325&highlight=](http://monotorrent.21.forumer.com/viewtopic.php?t=325&highlight=)

感谢您修复此艾伦 :)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T16:02:12.103

您能否更明确地说明到底发生了什么。哪些客户端正在播种，哪些客户端正在下载，以及哪种组合导致这两个文件不可下载。还有哪个组合有效*？*

即 rtorrent 播种、monotorrent/utorrent 下载 - 失败

monotorrent 播种，rtorrent/monotorrent/utorrent 下载 - 工作

# apache - 如何为 Apache 2.2 启用 mod_rewrite

> ID：869092
> 
> 赞同：523
> 
> 时间：2009-05-15T14:37:40.717
> 
> 标签：apache, mod-rewrite

我在我的 Vista 机器上安装了全新的 Apache 2.2，一切正常，除了 mod rewrite。

我已取消注释

```
LoadModule rewrite_module modules/mod_rewrite.s 
```

但我的重写规则都不起作用，即使是简单的规则

```
RewriteRule not_found %{DOCUMENT_ROOT}/index.php?page=404 
```

我使用的所有规则都在我的主机上工作，所以它们应该没问题，所以我的问题是，apache 配置中是否有任何隐藏的东西可以阻止 mod 重写？

* * *

## 回答 #1

> 赞同：1093
> 
> 时间：2011-04-22T18:14:45.500

为了使用`mod_rewrite`，您可以在终端中键入以下命令：

```
sudo a2enmod rewrite 
```

之后重启apache2

```
sudo /etc/init.d/apache2 restart 
```

或者

```
sudo service apache2 restart 
```

或按照新的统一系统控制方式

```
sudo systemctl restart apache2 
```

然后，如果您愿意，可以使用以下`.htaccess`文件。

```
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule . /index.php [L]
</IfModule> 
```

上述`.htaccess`文件（如果放置在您的 中`DocumentRoot`）会将所有流量重定向到 中的`index.php`文件，`DocumentRoot`除非该文件存在。

因此，假设您有以下目录结构，而 httpdocs 是`DocumentRoot`

```
httpdocs/
    .htaccess
    index.php
    images/
        hello.png
    js/
        jquery.js
    css/
        style.css
includes/
    app/
        app.php 
```

httpdocs 中存在的任何文件都将使用`.htaccess`上面显示的方式提供给请求者，但是，其他所有文件都将被重定向到`httpdocs/index.php`. 您的应用程序文件`includes/app`将无法访问。

* * *

## 回答 #2

> 赞同：240
> 
> 时间：2011-02-24T19:25:59.943

对于我的情况，我有

```
RewriteEngine On 
```

在我的`.htaccess`，以及正在加载的模块中，它无法正常工作。

我的问题的解决方案是编辑我的虚拟主机条目以包含

```
AllowOverride all 
```

在`<Directory>`相关网站的部分中。

* * *

## 回答 #3

> 赞同：91
> 
> 时间：2011-11-04T03:30:02.027

尝试设置：`AllowOverride All`.

* * *

第二个最常见的问题是没有启用 mod 重写：`a2enmod rewrite`然后重新启动 apache。

* * *

## 回答 #4

> 赞同：89
> 
> 时间：2012-08-07T12:54:59.727

如果上述方法均无效，请尝试编辑 /etc/apache2/sites-enabled/000-default

几乎在顶部你会发现

```
<Directory /var/www/>
    Options Indexes FollowSymLinks MultiViews
    AllowOverride None
    Order allow,deny
    allow from all
</Directory> 
```

更改`AllowOverride None`为`AllowOverride All`

这对我有用

* * *

## 回答 #5

> 赞同：48
> 
> 时间：2012-07-11T15:25:01.747

在 Ubuntu 中：

跑：

```
a2enmod rewrite 
```

进而：

```
service apache2 restart 
```

`mod_rewrite`现在将启用！

* * *

## 回答 #6

> 赞同：46
> 
> 时间：2015-06-18T06:09:14.227

新的 apache 版本在某些方面发生了变化。如果您的 apache 版本是 2.4，那么您必须转到`/etc/apache2/`. 会有一个名为`apache2.conf`. 你必须编辑那个（你应该有root权限）。像这样更改目录文本

```
<Directory /var/www/>
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
</Directory> 
```

现在重新启动apache。

```
service apache2 reload 
```

希望它有效。

* * *

## 回答 #7

> 赞同：34
> 
> 时间：2014-02-09T12:11:21.647

如果您知道问题的根源，有很多方法可以解决此问题。

**问题 1**

首先，您的 apache 没有安装或启用 mod_rewrite.c 模块可能是个问题。

因此，您必须按如下方式启用它

1.  打开你的控制台并输入它，这个：

    `sudo a2enmod rewrite`

2.  重新启动您的 apache 服务器。

    `service apache2 restart`

**问题 2**

1.  除了上述之外，您还可能需要更改 apache conf 文件（apache2.conf、http.conf 或 000-default 文件）中的覆盖规则。

2.  找到“目录/var/www/”

3.  将“无覆盖”更改为“全部覆盖”

**问题 3**

如果您收到一条错误消息，指出未找到重写模块，则可能您的 userdir 模块未启用。因此，您需要启用它。

1.  在控制台中输入：

    `sudo a2enmod userdir`

2.  如果仍未启用（如上所述），则尝试启用重写模块。

要进一步阅读此内容，您可以访问此网站：[http ://seventhsoulmountain.blogspot.com/2014/02/wordpress-permalink-ubuntu-problem-solutions.html](http://seventhsoulmountain.blogspot.com/2014/02/wordpress-permalink-ubuntu-problem-solutions.html)

* * *

## 回答 #8

> 赞同：31
> 
> 时间：2014-07-04T10:06:13.613

打开终端并输入`a2enmod rewrite`，它将启用您`mod_rewrite`的 Apache 模块。

然后转到`/etc/apache2/sites-available`并编辑默认文件。（为此，您必须对此文件和站点可用文件夹具有可写权限。）

用现有的第 4 到 14 行替换下面

```
DocumentRoot /var/www
<Directory />
Options FollowSymLinks
AllowOverride All
</Directory>
<Directory /var/www/>
Options Indexes FollowSymLinks MultiViews
AllowOverride All
Order allow,deny
allow from all
</Directory> 
```

`/etc/init.d/apache2 restart`现在通过or重启你的 apache`service apache2 restart`

再次进行干净的 URL 测试，这一次将通过。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2009-05-16T22:17:59.103

**<编辑>**

刚刚注意到您说的是 mod_rewrite.s 而不是 mod_rewrite.so - 希望这是您的问题而不是 httpd.conf 文件中的错字！:)

**</编辑>**

我更习惯在 Linux 上使用 Apache，但前几天我不得不这样做。

首先，查看您的 Apache 安装目录。（我假设您在此处将其安装到“C:\Program Files”）

查看文件夹：“C:\Program Files\Apache Software Foundation\Apache2.2\modules”并确保其中有一个名为 mod_rewrite.so 的文件。（应该是，它是作为默认安装的一部分提供的。

接下来，打开“C:\Program Files\Apache Software Foundation\Apache2.2\conf”并打开 httpd.conf。确保行：

```
#LoadModule rewrite_module modules/mod_rewrite.so 
```

未注释：

```
LoadModule rewrite_module modules/mod_rewrite.so 
```

此外，如果您想默认启用 RewriteEngine，您可能需要添加类似

```
<IfModule mod_rewrite>
    RewriteEngine On
</IfModule> 
```

到您的 httpd.conf 文件的末尾。

如果没有，请确保指定

```
RewriteEngine On 
```

在您的 .htaccess 文件中的某处。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2014-10-12T11:00:07.540

我刚做了这个

```
sudo a2enmod rewrite 
```

然后你必须通过以下命令重新启动 apache 服务

```
sudo service apache2 restart 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2017-03-27T09:03:48.150

旧线程，只是想将不设置 AllowOverride 设置为 all 而是使用您要使用的特定 mod，

```
AllowOverride mod_rewrite mod_mime 
```

这条线应该不加注释

```
LoadModule rewrite_module modules/mod_rewrite.so 
```

参考文献

*   [http://www.eschrade.com/page/why-you-should-not-use-htaccess-allowoverride-all-in-production/](http://www.eschrade.com/page/why-you-should-not-use-htaccess-allowoverride-all-in-production/)
*   [https://httpd.apache.org/docs/2.4/misc/security_tips.html](https://httpd.apache.org/docs/2.4/misc/security_tips.html)
*   [https://httpd.apache.org/docs/2.4/rewrite/avoid.html](https://httpd.apache.org/docs/2.4/rewrite/avoid.html)

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2018-09-12T13:37:24.293

使用以下命令

```
sudo a2enmod rewrite 
```

并通过以下命令重新启动 apache

```
sudo service apache2 restart 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-05-15T15:52:58.540

显然有不止一种方法可以做到，但我建议使用更标准的：

```
ErrorDocument 404 /index.php?page=404 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2014-02-07T10:00:50.330

什么对我有用（在 ubuntu 中）：

```
sudo su
cd /etc/apache2/mods-enabled
ln ../mods-available/rewrite.load rewrite.load 
```

此外，如前所述，请确保`AllowOverride all`在相关部分中设置`/etc/apache2/sites-available/default`

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2015-04-29T09:29:27.457

我第一次与忽略流量的 mod_rewrite 规则作斗争时，我（沮丧地）了解到我把它们放在了错误的位置`<VirtualHost>`，这意味着无论它们写得多么好，我的流量都会忽略它们**。**确保这不会发生在您身上：

`# Change the log location to suit your system. RewriteLog /var/log/apache-rw.log RewriteLogLevel 2`

如果您执行 Apache 的正常重启，这些参数将激活，因此您可以回收它们并密切监视 mod_rewrite 行为。解决问题后，将 RewriteLogLevel 调低并庆祝。

根据我 100% 的经验，我发现 RewriteLog 帮助我发现了重写规则的问题。我不能推荐这个。祝您故障排除！

此外，这个书签是你最好的朋友： [http ://httpd.apache.org/docs/2.2/mod/mod_rewrite.html#rewritelog](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html#rewritelog)

# objective-c - 从 int/float 获取前三位

> ID：869093
> 
> 赞同：3
> 
> 时间：2009-05-15T14:37:47.097
> 
> 标签：objective-c, iphone

我想从大浮点数或整数中获取前三位数字，并在某些情况下插入小数。例如：

```
KB
----------
32589 >> 325
43266 >> 432

MB
----------
1234599 >> 1.23
3422847 >> 3.42 
```

对于特定数字，我将使用“KB”和“MB”字符串。这会让我知道是否需要小数，如“MB”示例中所示。我查看了 NSNumberFormatter 但不确定那里有什么帮助。有什么建议么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-15T14:52:19.917

Here is some quick & dirty code to pull off the top three digits of the number (in NSString format):

```
long someNumber = 1234599;
NSString * allDigits = [NSString stringWithFormat:@"%l", someNumber];
NSString * topDigits = [allDigits substringToIndex:3];

NSLog(@"%@", topDigits); // will output 123 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-15T14:48:37.477

等等，你是说 32589 字节是 325 KB 吗？

重复将数字除以 1000 直到结果小于 1000 是否有意义，然后使用您拥有的任何 printf 等值进行格式化？

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-15T15:10:08.953

实际上，决定加入我自己的答案。这是我生成字符串以从字节计数输出人体大小的例程：

```
#include <math.h>    // for isgreater()
static NSString * MemorySizeString( mach_vm_size_t size )
{
    enum
    {
        kSizeIsBytes        = 0,
        kSizeIsKilobytes,
        kSizeIsMegabytes,
        kSizeIsGigabytes,
        kSizeIsTerabytes,
        kSizeIsPetabytes,
        kSizeIsExabytes
    };

    int sizeType = kSizeIsBytes;
    double dSize = (double) size;

    while ( isgreater(dSize, 1024.0) )
    {
        dSize = dSize / 1024.0;
        sizeType++;
    }

    NSMutableString * str = [[NSMutableString alloc] initWithFormat: (sizeType == kSizeIsBytes ? @"%.00f" : @"%.02f"), dSize];
    switch ( sizeType )
    {
        default:
        case kSizeIsBytes:
            [str appendString: @" bytes"];
            break;

        case kSizeIsKilobytes:
            [str appendString: @"KB"];
            break;

        case kSizeIsMegabytes:
            [str appendString: @"MB"];
            break;

        case kSizeIsGigabytes:
            [str appendString: @"GB"];
            break;

        case kSizeIsTerabytes:
            [str appendString: @"TB"];
            break;

        case kSizeIsPetabytes:
            [str appendString: @"PB"];
            break;

        case kSizeIsExabytes:
            [str appendString: @"EB"];
            break;
    }

    NSString * result = [str copy];
    [str release];

    return ( [result autorelease] );
} 
```

它使用 1024 作为基数（1024 字节 = 1KB、1024KB = 1MB 等），通过查看它的二进制数量级来计算出正确的大小。在执行此操作时，它会缩小输入值（使用浮点运算），这样一旦它低于 1024，它就会同时具有人类可读的值和幅度说明符。然后它生成一个包含格式化值的字符串（字节没有小数位，任何较大的量级都保留 2 个小数位），并检查量级常数以确定要附加的后缀。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T14:42:54.667

您可以通过使用 itoa 或 sprintf 将数字转换为文本表示或实现您自己的这种转换技术版本来实现此目的。完成此操作后，您可以从文本缓冲区中提取前三个字符以供使用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T14:44:11.293

处理此问题的最简单方法可能是将其转换为字符串并使用 cocoadev 正则表达式库之一进行格式化

# mysql - 可以比较 MySQL 上多行的 COUNT(*) 吗？

> ID：869095
> 
> 赞同：2
> 
> 时间：2009-05-15T14:37:51.653
> 
> 标签：mysql

嗨，我正在处理一个使用以下模式的查询，以了解用户按公司进行搜索的频率（该应用程序基本上允许您按公司进行搜索）

```
SEARCH_LOG
----------
date_of_search (DATETIME)
company_id (INT)

COMPANIES
---------
id (INT)
company_name (VARCHAR)

(there are more columns but these are the relevant ones) 
```

所以我正在运行以下查询：

```
SELECT company_name,COUNT(*) FROM companies LEFT OUTER JOIN search_log ON search_log.company_id=companies.id GROUP BY companies.id 
```

这很好，因为它返回每个公司和执行的搜索次数，但是我想将这些数字表示为百分比。我的下意识反应是单独运行以下查询：

```
SELECT COUNT(*) FROM search_log 
```

获取该结果并仅在应用程序端进行除法，但这似乎效率低下，如果可能的话，我想在一个查询中完成所有操作（最好不使用子查询），但不知道如何获取该信息.

任何帮助或指导将不胜感激。

**编辑：**也许我并不完全清楚我在追求什么。而不是得到如下结果：

```
COMPANY_NAME | COUNT(*)
-----------------------
CompanyA     | 1
CompanyB     | 3 
```

我宁愿看到：

```
COMPANY_NAME | COUNT(*)
-----------------------
CompanyA     | 25%
CompanyB     | 75% 
```

显然格式不是很重要，因为 25,25%,0.25 都是可用的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T15:07:18.990

尽管不是单个查询，但以下解决方案将在 SQL 中使用变量执行此操作：

```
select @total:=count(*) from search_log;  
select company_id,count( * ) , count( * )/@total as percentage from search_log group by company_id; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T14:46:21.367

我已经用视图和自定义函数做了这样的事情（虽然我不知道函数是否在 mysql 中可用）。老实说，最好的办法是创建一个小型数据仓库。这样报告这样的事情会快得多。您还可以找到报告数据的新方法。

缺点是通常您无法获得“实时”报告。您通常会在晚上汇总所有数据。好处是，您可以通过这种方式查看一段时间内的趋势。

基本上，在交通流量较低的时段，您将拍摄数据快照。然后，您将对它们进行变异并将它们粘贴到维度模型中。之后，您的所有报告都非常容易！:)

除此之外，最好的办法是使用标量函数或子查询。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T14:49:07.943

[以前曾以稍微不同的形式提出过](https://stackoverflow.com/questions/770579/how-to-calculate-percentage-with-a-sql-statement)这个问题，我没有看到任何可以避免第二次查询的解决方案 - 如果您想在数据库中完成所有操作。

如果您在应用程序中执行此操作，则实际上不需要执行第二次查询。只需遍历第一个查询的所有结果并将每个组的总数相加即可。这应该为您提供“总计”，而不必使用第二个查询来访问数据库。

不过，它可能会迫使您对结果进行两次迭代——一次获得总数，第二次计算百分比。但仍然可能比进行第二次查询更快。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T14:53:35.420

How about this instead of

```
SELECT company_name,COUNT(*) FROM companies LEFT OUTER JOIN search_log ON search_log.company_id=companies.id GROUP BY companies.id 
```

try

```
SELECT company_name,(COUNT(*)/(select count(*) from search_log) * 100) as percent FROM companies LEFT OUTER JOIN search_log ON search_log.company_id=companies.id GROUP BY companies.id 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-24T21:42:04.350

这将只运行一次子查询并为您提供您正在寻找的比例。

```
SELECT company_name, COUNT(*)/t.total FROM companies 
LEFT OUTER JOIN search_log ON search_log.company_id=companies.id
JOIN (SELECT count(*) as total FROM companies) AS t
GROUP BY companies.id 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-15T14:58:39.853

I've always done what your knee-jerk reaction was.

First, I'm more comfortable with writing math on the application side. And second, I don't know how much I trust MySQL's math.

I don't think doing a `count(*)` is inefficient at all.

# winapi - 如何以编程方式更改 Windows 中的默认纸张大小？

> ID：869101
> 
> 赞同：0
> 
> 时间：2009-05-15T14:38:23.197
> 
> 标签：winapi, printing

如何以编程方式更改 Windows 中的默认纸张大小？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T14:58:03.553

Take a look at the `dmPaperSize` member of the `[DEVMODE](http://msdn.microsoft.com/en-us/library/dd183565(VS.85).aspx)` member of the `[PRINTER_DEFAULTS](http://msdn.microsoft.com/en-us/library/dd162839(VS.85).aspx)` structure passed to `[OpenPrinter](http://msdn.microsoft.com/en-us/library/dd162751(VS.85).aspx)`.

[Here's a code sample](http://www.novapdf.com/kb/how-to-set-programmatically-the-page-related-settings-page-size-layout-via-novapdf-sdk-112.html).

# c# - LINQ to Stored Procedure 上的“存储属性错误”错误

> ID：869107
> 
> 赞同：1
> 
> 时间：2009-05-15T14:40:09.103
> 
> 标签：c#, asp.net, linq-to-sql

我刚刚在我的项目中添加了一个新创建的 SP，不幸的是它需要一个临时表来操作，所以我不得不手动为 SP 构建我的 RESULT 类。现在，当我尝试运行时，以下属性出现“存储属性错误”错误。

```
public partial class sp_One_EVA_Get_User_InformationResult
{
    private string _Security_USER_ID;

public sp_One_EVA_Get_User_InformationResult()
    {
    }

    [Column(Storage = "_Security_USER_ID;", DbType="VarChar(15) NOT NULL")]
    public string Security_USER_ID
    {
        get
        {
            return this._Security_USER_ID;
        }
        set
        {
            if ((this._Security_USER_ID != value))
            {
                this._Security_USER_ID = value;
            }
        }
    } 
```

不知道这有什么问题，我已经用其他 SP 做了很多次，没有任何错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-20T07:06:58.053

写下这一行

`[Column(Storage = "_Security_USER_ID", DbType="VarChar(15) NOT NULL")]`

你写存储有错误，分号

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-19T13:55:38.703

这可能是错误的行：

```
[Column(Storage = "_Security_USER_ID;", DbType="VarChar(15) NOT NULL")] 
```

我会根据实际从数据库返回的内容仔细检查`DbType`属性 ( ) 的值。`VarChar(15) NOT NULL`很可能两者之间存在不匹配。

# ruby-on-rails - 你最喜欢的鲜为人知的 Rails gems/plugins

> ID：869108
> 
> 赞同：7
> 
> 时间：2009-05-15T14:40:48.057
> 
> 标签：ruby-on-rails, plugins, gem

你最喜欢的 Rails 的鲜为人知的 gems/plugins 是什么？

[这个](https://stackoverflow.com/questions/538600/what-rails-plugins-are-good-stable-and-really-enhance-your-code)关于 Rails 插件的问题只提出了常见的问题（Paperclip、RSpec、Shouda、Restful Auth 等）。获得一份关于隐藏的、不太受欢迎的摇滚乐的列表会很棒。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T18:21:42.067

我最近在项目中经常使用[cache_money](http://github.com/nkallen/cache-money/tree/master)。它给了我们巨大的性能提升

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-15T21:11:40.520

我刚开始使用[App_Version](http://github.com/toland/app_version/tree/master "App_Version")。很高兴能够将您运行的应用程序版本放在页面底部（例如此页面右下角的“svn 修订版”编号）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-15T22:32:45.160

我真的很喜欢[delayed_job](http://github.com/tobi/delayed_job/tree/master)用于异步任务，它简单而有效。一直将它用于异步邮件并取得了巨大成功。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-03T11:10:05.127

我发现我越来越多地使用的另一个是[andand](http://andand.rubyforge.org/)，这为您提供了受保护的方法调用。

代替

```
entry.at('description') && entry.at('description').inner_text 
```

你写

```
entry.at('description').andand.inner_text 
```

在过去的几个项目中，它为我的手指节省了很多打字时间。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T22:11:31.280

[Dr. Nic 的魔法模型](http://magicmodels.rubyforge.org/)并不是说​​我真的在我的任何项目中使用了这个 gem，我只是觉得它刚发布时很酷。Nic 博士也做了一个 hack，所以如果你在代码中打错字，它会猜到你的意思，所以非常非常错误.. 但很有趣。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-16T00:26:32.080

[responds_to _parent](http://github.com/markcatley/responds_to_parent/tree/master)让您可以使用文件上传表单（不能使用真正的 ajax）来做类似 ajax 的事情。但您也可以在任何时候将 RJS 发送到父窗口时使用它。

另外，有点自我推销。我真的很喜欢我的插件[soundex_find](http://github.com/waltjones/soundex_find/tree/master)，它允许您在自动完成程序或搜索中处理拼写错误和语音匹配。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-07-17T04:32:04.927

我认为 Summarize (https://github.com/ssoper/summarize) 和 Geocoder (http://www.rubygeocoder.com/) 非常酷。

# c# - 如何以编程方式搜索 C# DropDownList

> ID：869122
> 
> 赞同：11
> 
> 时间：2009-05-15T14:43:32.077
> 
> 标签：c#, search, drop-down-menu

我很难弄清楚如何编写一系列“if”语句，这些语句在不同的下拉列表中搜索文本框中输入的特定值。我能够编写在每个下拉列表中找到特定值的代码；但是，在这发生之前，我需要添加一个“if”语句，“如果下拉列表不包含特定值，则转到下一个 if 语句，依此类推”。以下是我到目前为止的一个例子：

```
if (dropdownlist1.SelectedValue == textbox1)
{
  dropdownlist1.SelectedIndex = dropdownlist1.items.indexof(dorpdownlist1.items.findbyvalue(textbox1.text) ...

if (dropdownlist2.SelectedValue == textbox1)
{
  dropdownlist2.SelectedIndex = dropdownlist2.items.indexof(dorpdownlist2.items.findbyvalue(textbox1.text) ...

etc... 
```

这样做是根据我在 textbox1 中的条目读取或扫描每个下拉列表中的第一个值或索引。不幸的是，它只识别第一个值或索引。我需要弄清楚如何在整个下拉列表中扫描每个“if”语句的所有值，以找到匹配的 textbox1 值。有没有人有什么建议？

谢谢，

DFM

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-05-15T14:49:03.793

```
foreach (ListItem li in dropdownlist1.Items)
{
    if (li.Value == textBox1.text)
    {
       // The value of the option matches the TextBox. Process stuff here.
    }
} 
```

这是我对如何查看该值是否在下拉列表中的建议。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-15T14:52:24.427

[DropDownList](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.dropdownlist.aspx)从[ListControl](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listcontrol.aspx)继承[Items](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listcontrol.items.aspx)集合。由于 Items 是一个数组，因此您可以使用以下语法：

dropdownlist1.Items.Contains(textbox1.Text) 作为布尔值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-10-10T18:32:42.213

你可以简单地这样做。

```
if (ddl.Items.FindByValue("value") != null) {
   ddl.SelectedValue = "value";
}; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-15T14:52:15.550

我会制作一个下拉框列表，然后使用 linq 对其进行选择。

```
List<DropDownList> list = new List<DropDownList>();
list.Item.Add(dropdown1);
list.Item.Add(dropdown2); 
.... (etc)

var selected = from item in list.Cast<DropDownList>()
               where item.value == textBox1.text
               select item; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-04-27T12:12:21.327

如果您想在加载的组合框中搜索确切的值，则提供的解决方案可以工作。

此解决方案也搜索部分值。它使用搜索按钮和下拉框的文本部分作为搜索条件

```
Private Sub btnSearch_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnSearch.Click

    ' query the dropdown object
    ''''''''''''
    ' part 9457 is a "contains" sample
    ' part 111 is a "startswith" sample

    Dim query As IEnumerable(Of [Object]) = _
    From item In cboParts.Items _
    Where (item.ToString().ToUpper().StartsWith(cboParts.Text.ToUpper())) _
    Select (item)

    ' show seached item as selected item
    cboParts.SelectedItem = query.FirstOrDefault()

    ' "startswith" fails, so look for "contains" 
    If String.IsNullOrEmpty(cboParts.SelectedItem) Then

        Dim query1 As IEnumerable(Of [Object]) = _
        From item In cboParts.Items _
        Where (item.ToString().ToUpper().Contains(cboParts.Text.ToUpper())) _
        Select (item)

        ' show seached item as selected item
        cboParts.SelectedItem = query1.FirstOrDefault()

        If String.IsNullOrEmpty(cboParts.SelectedItem) Then
            MsgBox("Part is not in dropdown list")
        End If

    End If 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-03-06T10:10:00.270

我试图在下拉列表中按文本查找项目。我使用了下面的代码，它的工作原理：）

```
ListItem _lstitemTemp = new ListItem("Text To Find In Dropdownlist");
if(_DropDownList.Items.Contains(_lstitemTemp))
{
    dosomething();
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T14:52:58.013

一行代码拆分为可读性。

```
this.DropDownList1.SelectedItem = this.DropDownList1.Items
     .SingleOrDefault(ddli => ddli.value == this.textbox1.value); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-15T14:56:20.767

如果您不想使用 LINQ：

```
 List<ComboBox> dropDowns = new List<ComboBox>();
        dropDowns.Add(comboBox1);
        dropDowns.Add(comboBox2);

        bool found = false;
        ComboBox foundInCombo = null;
        int foundIndex = -1;

        for (int i = 0; i < dropDowns.Count && found == false; i++)
        {
            for (int j = 0; j < dropDowns[i].Items.Count && found == false; j++)
            {
                if (item == textBox1.Text)
                {
                    found = true;
                    foundInCombo = dropDowns[i];
                    foundIndex = j;
                }
            }
        } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-07-20T06:00:30.420

```
while(dropdownlist1.SelectedIndex++ < dropdownlist1.Items.Count)
{
    if (dropdownlist1.SelectedValue == textBox1.text)
    {
      // Add your logic here.
    }
}

//resetting to 0th index(optional)
dropdownlist1.SelectedIndex = 0; 
```

# asp.net - asp.net Ajax 定时器控制

> ID：869130
> 
> 赞同：1
> 
> 时间：2009-05-15T14:46:02.863
> 
> 标签：asp.net, ajax

我有一个带有计时器控件的页面。当页面加载时，它会触发一个函数。我的问题是页面的标题最初出现，但定时器控制功能完成后，标题中的字符串消失了。我将计时器函数中的所有内容都注释掉了，字符串中的标题仍然出现。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T14:52:08.467

If you're using ASP.NET AJAX and programatically define the page title (as opposed to statically having it defined in your .aspx page), then you must re-define it again in your partial page update. It's just the way asp.net ajax works.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T15:20:33.843

看起来 asp.net ajax 不喜欢标题栏中的 asp:Literal 控件。我从标题栏中删除了文字控件并将其替换为 <% Response.Write(szTitle); %> 对我有用！

# email - 从 Outlook::Attachment（嵌入式电子邮件）获取 Outlook::_MailItem

> ID：869132
> 
> 赞同：3
> 
> 时间：2009-05-15T14:46:57.120
> 
> 标签：email, outlook, atl, embedded-resource

我正在使用 VC/ATL 编写 Outlook 插件。这个特定的插件接收选定的电子邮件并将它们写入磁盘。它还将所有关联的附件写入磁盘。然后，我们将所有内容读入 Outlook 之外的应用程序。

使用 Outlook 对象模型，这非常简单，因为 _MailItem 和 Attachment 都有 SaveAs 方法。**当附件本身是嵌入的电子邮件时，问题就出现了，我们也希望将其拆分并保存为单独的文件。**

在理想情况下，我可以查询 _MailItem 接口的附件，并像处理选择的正常部分一样处理它。但 QueryInterface 返回“无接口”。

我需要一个通过 Outlook 2010 与 Outlook XP (2002) 一起使用的解决方案。我知道在 Outlook 2007 中，应用程序对象上有一个方法 (CreateItemFromTemplate)，它允许我从磁盘上保存的消息中获取 MailItem，但是不适用于 Outlook XP / 2003。我还需要完整的发件人/收件人信息。

我也知道第 3 方赎回库可以使用扩展 MAPI 做到这一点。但是，我们试图避免使用 3rd 方库。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-01T12:11:14.930

如果您不想使用第三方库，那么您可能必须编写自己的 MSG 文件解析器来提取嵌入的邮件项目。

除此之外，如果您真的对开发 Outlook 插件很认真，那么您迟早会使用 Redemption，那么为什么还要等待呢？**它的**价值绝对超过其作者的黄金重量。

# perl - 如何生成具有不同基数的字符序列，如十六进制？

> ID：869144
> 
> 赞同：3
> 
> 时间：2009-05-15T14:49:31.140
> 
> 标签：perl, string, math, hex, sequences

我有以下基于数字生成字符串的 Perl 脚本：

```
my @chars;
push @chars, map(chr, 48..57), map(chr, 97..122);
my $c = $#chars+1;

for (0..50) {
    my $string;
    my $l = $_ / $c;
    my $i = int $l;
    my $r = ($l - $i) * $c;
    $string .= $chars[$r];
    while ($i > 0) {
        $l = $i / $c;
        $i = int $l;
        $r = ($l - $i) * $c;
        $string .= $chars[$r];
    }
    print "$string\n";
} 
```

当我运行它时，我得到以下输出：

```
0
1
2
3
4
...
z
01
01
21
21
41
41
61
61
81
91
91
b1
b1
d1
d1 
```

我错过了什么？感谢您的帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T14:57:14.867

试试这个，它比您拥有的脚本更清晰，并且可以正确转换为任意基础：

```
my @chars;
push @chars, map(chr, 48..57), map(chr, 97..122);

my $base = @chars;

for my $num (0..100) {
    my $string = '';

    while ($num >= $base) {
        my $r = $num % $base;
        $string .= $chars[$r];

        $num = int($num / $base);
    }
    $string .= $chars[$num];
    print reverse($string) . "\n";
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T15:47:21.813

另请参阅[http://www.rosettacode.org/wiki/Number_base_conversion#Perl](http://www.rosettacode.org/wiki/Number_base_conversion#Perl)

# internet-explorer-8 - IE8 日志文件？

> ID：869148
> 
> 赞同：3
> 
> 时间：2009-05-15T14:50:05.927
> 
> 标签：internet-explorer-8

有没有办法打开IE的日志记录？

我正在尝试解决仅在 Windows Server 2008 上查看时才出现在我的网站上的 IE8 信息栏消息。

> 此网站的插件无法运行。检查 Internet 选项中的安全设置是否存在潜在冲突。

这些页面都按预期工作，我想知道 IE 认为哪个插件无法运行。

真正奇怪的是它随机出现。我可以浏览我的网站，信息栏消息将出现在几个随机页面上，但是当我离开这些页面然后返回同一页面时，消息可能会出现也可能不会出现。

随机显示消息的页面只使用标准的html和javascript，没有插件运行失败。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-11-12T15:13:36.377

检查是否有任何伪造的对象标签。此外，如果您使用的是 jquery 1.3.2，则有一个变更集可以解决一个非常相似的问题。见[http://dev.jquery.com/changeset/6268](http://dev.jquery.com/changeset/6268)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T21:01:40.137

[通过下载Microsoft Application Compatibility Toolkit](http://www.microsoft.com/downloads/details.aspx?FamilyID=24DA89E9-B581-47B0-B45E-492DD6DA2971&displaylang=en)并运行 Internet Explorer Compatibility Test Tool，我能够获得一些日志记录。

我能够看到多个“ [ActiveX Blocking](http://msdn.microsoft.com/en-us/library/dd565667(VS.85).aspx) ”事件，但它没有给我任何关于它们的原因的详细信息。就是说 CLSID 是 {00000000-0000-0000-0000-000000000000} 并且没有控制 URL、名称或发布者。我的 html 中没有任何对象对象标签。我对造成这种情况的原因感到困惑，并开始认为这是 IE 的缺陷。

仅供参考 - 当我在安装后尝试运行 Internet Explorer 兼容性测试工具时，我收到“[文件大小超过允许的限制且无法保存](http://support.microsoft.com/kb/954368)”的错误消息，要求我安装[热修复程序](http://support.microsoft.com/kb/950923/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-08T19:59:04.230

这个问题的解决方案可以在 Server 2008 / Server Manager 安全信息中找到。您需要通过 Server 2008 / Server Manager 禁用 IE ESC（增强的安全配置）：

*   开始，管理工具，服务器管理器
*   在服务器摘要下，安全信息单击配置 IE8 ESC
*   单击管理员和用户的禁用单选按钮

# c# - BindingSource.Filter 不适用于 '!='

> ID：869149
> 
> 赞同：1
> 
> 时间：2009-05-15T14:50:21.730
> 
> 标签：c#, .net, data-binding

我有一个绑定源，它有一个名为的列`Description`，我想排除所有描述设置为“x”的行。

我试过了：

```
bindingSource.Filter = "Description != ' + x; 
```

那是行不通的。有谁知道如何对`is not`绑定源的过滤器进行比较？我在 MSDN 上找不到任何帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-15T14:52:38.387

尝试`<>`代替`!=`.

请参阅此以获得更多帮助：

> [http://msdn.microsoft.com/en-us/library/system.data.datacolumn.expression.aspx](http://msdn.microsoft.com/en-us/library/system.data.datacolumn.expression.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T14:57:09.733

试试这个：

```
bindingSource.Filter = String.Format("Description != '{0}'", x); 
```

另一件要尝试的事情是使用`<>`而不是`!=`如果上述方法仍然不起作用。

# air - 在 Adob e Air 中中断系统关闭

> ID：869150
> 
> 赞同：0
> 
> 时间：2009-05-15T14:50:26.740
> 
> 标签：air

当系统关闭时，我试图让我的 Air 应用程序向用户显示 NativeWindow（该应用程序通常隐藏在系统托盘中）。我目前正在使用以下代码，如果按下退出按钮，它可以很好地工作，但在系统关闭时它不起作用。我正在使用自定义镀铬。任何帮助将非常感激。

```
NativeApplication.nativeApplication.addEventListener(Event.EXITING, this.Application_Exiting);

private function SysTrayExit_Select(e: Event):void{
      this.applicationExit();
}

public function applicationExit():void { 
    var exitingEvent:Event = new Event(Event.EXITING, false, true);

    NativeApplication.nativeApplication.dispatchEvent(exitingEvent);

    if (!exitingEvent.isDefaultPrevented()) {

        NativeApplication.nativeApplication.exit();

    }  }

private function Application_Exiting(e: Event): void {

      e.preventDefault();

      Alert.show("Exiting");
      ShowTaskEntry();  
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-18T12:19:26.510

除非您可以在 ActionScript 中访问平台的 API，否则没有真正的方法可以做到这一点。

# css - CSS中的标题问题H1

> ID：869152
> 
> 赞同：1
> 
> 时间：2009-05-15T14:50:36.053
> 
> 标签：css

我无法在我的网站中更改标题 h1 的大小和颜色。

我使用了外部 Css 文件。

代码如下..

```
h1 {
    Background-color : red;
    Color : green;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T14:56:16.630

An URL would be helpful.

Also, CSS rules are lowercase. (e.g. background-color, not Background-color)

Read about CSS specifity, that is probably the problem: [http://htmldog.com/guides/cssadvanced/specificity/](http://htmldog.com/guides/cssadvanced/specificity/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T14:54:38.833

Try using Firebug or IE8 Developer Tools to inspect the element and make sure you don't have conflicting styles from another stylesheet or somewhere else in your html document.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-15T14:56:41.077

Thats looks ok to me.

You may have an issue with the H1 already being set somewhere else in the style sheet.

Either you can search for it or make your adjustments as important ie.

```
h1{
  background-color: #ff0000 !important;
  color: #00FF00 !important;
} 
```

Hope this helps

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T14:54:10.880

Try setting '!important' behind it:

```
color: green !important; 
```

Note that this only applies if there are other styles overriding your external css. You should test that your external CSS-file is read at all. You can do that by making a new paragraph for example. Give it an id (id="foo") and set this in your css

```
color: green; 
```

If it doesn't turn green you should check your css include path.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T14:56:37.193

You might also consider using the hex codes for the colors instead of "red" and "green" - I've seen that produce some odd behaviors in some browsers (or be ignored entirely).

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-15T14:56:43.493

```
h1 {
    background: red !important;
    color: green !important;
} 
```

Also, depending on how your original h1 declaration was written, you can use [specificity](http://htmldog.com/guides/cssadvanced/specificity/) and [cascading](http://www.w3.org/TR/CSS2/cascade.html) to overwrite the previous value(s).

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T15:11:00.947

此外，考虑您调用外部样式表的顺序，您可能首先出现一个主 css 文件，然后是第二个样式表，该样式表也在 H1 上设置了样式，这可能会覆盖您的第一个样式表 - 一些反正看看。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-15T16:02:24.383

我确定您已验证外部样式表已加载到您的站点并且您正确引用它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-03-03T05:17:56.217

遇到此问题的一种方法是，如果您的 css 文件位于子文件夹中，`styles`或者`styles\pages`您没有提供完整的相对路径。

说如果 site.css 文件在样式文件夹中。

这*不会*加载样式（因为提供了路径并且文件不在根目录中）

```
<link rel="stylesheet" type="text/css" href="site.css" media="screen" /> 
```

这将正确加载它。

```
<link rel="stylesheet" type="text/css" href="styles/site.css" media="screen" /> 
```

# sql - SQL 连接条件 A=B 或反转为 B=A？

> ID：869164
> 
> 赞同：2
> 
> 时间：2009-05-15T14:52:53.427
> 
> 标签：sql, join

我认为这对数据库没有任何影响，但是在加入表时，您更喜欢哪个顺序来编写条件：

```
SELECT
    ...
    FROM AAA
        INNER JOIN BBB ON AAA.ID=BBB.ID
    WHERE ... 
```

或者

```
SELECT
    ...
    FROM AAA
        INNER JOIN BBB ON BBB.ID=AAA.ID
    WHERE ... 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-15T15:36:00.373

我更喜欢第二个示例（B=A），因为在连接中我列出了确定应包含哪些 B 行的条件。换句话说，我想要 B 中的所有行，其中“X”对 B 为真。当我需要检查除 FK 之外的标准时，这也是一致的。例如：

```
SELECT
     some_columns
FROM
     Table_A A
INNER JOIN Table_B B ON
     B.a_id = A.a_id AND
     B.active = 1 
```

在我看来，如果我有以下内容，它就不会具有相同的可读性：

```
1 = B.active 
```

还要考虑您的连接条件包括多个表的情况：

```
SELECT
     some_columns
FROM
     Table_A A
INNER JOIN Table_B B ON
     B.a_id = A.a_id AND
     B.active = 1
INNER JOIN Table_C C ON
     C.a_id = A.a_id AND
     C.b_id = B.b_id AND
     C.category = 'Widgets' 
```

对我来说，这清楚地表明了应该包含 C 中的哪些行的标准。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-15T14:56:11.843

我更喜欢第二个选项，最近写的表格排在第一位。

不过，我认为 Linq 要求它是相反的（选项 1）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-15T14:56:32.807

我经常做

```
From TABLE_A A

JOIN TABLE_B B ON A.Column = B.Column 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-15T16:06:36.493

没关系，两者都是正确的。我的偏好是第二种。

我的偏好是基于表 BBB 是我要添加到结果集中的表的想法，并且手头的工作是将新表 BBB 中的列（表达式）绑定到结果集中已经存在的其他列。在不同的示例中可能更有意义：

```
SELECT ...
  FROM AAA a
  JOIN BBB b ON (b.AAA_ID = a.ID)
  JOIN CC c ON (c.AAA_ID = b.AAA_ID AND UPPER(c.FEE) IN ('FI','FO'))
  JOIN DDD d ON (d.CC_ID = c.ID AND LEFT(d.DAH,2) = c.FEE) 
```

是的，这是一个任意复杂的示例，但有时实际代码确实会变得如此复杂。在连接条件中引用多个谓词时，我发现当每个谓词引用最近连接的表中的第一个（在左侧）表达式时会很有帮助。

还有其他模式也有帮助，例如，当每个表的主键是一个名为“ID”的列而外键列通常命名为 PARENTTABLE_ID 时，这样当我看到像 a.ID=b 这样的构造时。 ID，我看到的是主键连接到主键的模式（一对一的关系，这不是规范模式）。当我看到 b.FOREIGN_ID = c.FOREIGN_ID 时，我看到的是外键连接到外键。同样，不是通常的模式，表明这可能是多对多连接，或者可能是性能的快捷连接。我在父子连接中寻找的通常模式就像 child.PARENT_ID = parent.ID

这些模式没有对错之分，只是一种偏好。我发现这些模式不会使正确的代码看起来很漂亮，但会使“奇怪”的代码脱颖而出。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-15T14:55:55.820

我更喜欢第一个选项。您要从 A 到 B，因此字段的顺序似乎更合适。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-15T14:57:08.813

我不认为它真的有区别，但我更喜欢

```
INNER JOIN BBB ON AAA.ID=BBB.ID 
```

因为它与linq一致。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-15T15:29:08.113

AAA.ID = BBB.ID 的另一个温和声音。这对我来说似乎更有意义，但这并不重要。

然而，在一个切线相关的注释中，我最近开始质疑我是如何编写相等测试的。我一直喜欢：

```
If ValueInQuestion = TestValue Then
... 
```

那是，

```
If fullMoonsThisMonth = 2 Then
... 
```

在其他人的代码中，我经常看到这个测试被颠倒了，它让我困扰了一段时间。我开始意识到我的偏好是基于在英语中哪个表述听起来“更好”，并且有时将不变值放在左边是有充分理由的。在只有一个运算符用于相等性测试和赋值的语言中（例如 VB，以防您没有识别示例......），然后编译器将阻止您在您打算进行测试时意外地进行赋值。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-15T14:56:39.983

没有区别，但为了清楚起见，我会选择“AAA INNER JOIN BBB ON AAA.ID=BBB.ID”（但有别名）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-15T14:56:52.073

我使用第一种语法 AAA.ID = BBB.ID。在我看来，它使代码更容易阅读，因为加入参与者遵循表格顺序。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-15T15:33:52.750

我倾向于使用两者，因为它根本没有区别。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-15T16:12:34.420

只要查询中已经提到了您引用的表，您编写联接的顺序无关紧要。

我个人更喜欢列出最近的表第二（选项1）。这个约定很有帮助，因为我决定在需要时总是使用左外连接（而不是右外连接），而且我不必考虑哪个表将在右侧或左侧。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-15T16:32:08.367

让我们在这里记住**LINQ 不是 SQL**，那么为什么还要在这里提到它呢？SQL 问题不应该用 LINQ 答案来回答。在我看来，这很奇怪，而且完全不相关！！

这两个例子都是可以接受的。正如大多数 SQL 开发人员一样，我更喜欢第二个示例。它还取决于您要使用的 SQL JOIN 类型。问题标题仅适用于“JOIN”，但您的示例使用了 INNER JOIN。

在这种情况下，对于 INNER JOIN，这无关紧要。但请记住，这两个示例都会产生 HASH MATCHED JOIN，这在处理索引时并不理想。循环连接效率更高。只要确保您将索引视为哈希连接是索引效率低下的指标。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-15T17:15:53.050

它不能根据两个表的索引方式以及它们连接的字段来产生性能差异吗？

无论您指定什么顺序，某些数据库引擎中的查询优化器可能都能够做正确的事情，但只有一段时间的查询计划和测试才能确定答案。

# visual-studio - 阻止 Visual Studio 尝试为特定 DLL 加载符号

> ID：869168
> 
> 赞同：76
> 
> 时间：2009-05-15T14:53:52.957
> 
> 标签：visual-studio, debugging, debug-symbols

我将 Visual Studio 2005 设置为使用 Microsoft 的符号服务器。我还安装了[UltraMon](http://www.realtimesoft.com/ultramon/)，它会在每个进程中注入一个钩子 DLL。每当我开始调试[MFC](http://en.wikipedia.org/wiki/Microsoft_Foundation_Class_Library)应用程序时，Visual Studio 都会说：

```
"Loading symbols for C:\Program Files\UltraMon\RTSUltraMonHookX32.dll..." 
```

从眨眼到几十秒的任何时间。它永远找不到那些符号……我可以告诉它不要费心去寻找吗？

（我尝试创建一个空`RTSUltraMonHookX32.pdb`文件，但 Visual Studio 认为它不好并继续查找。）

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2009-05-15T14:56:33.387

您不能以非常精细的方式执行此操作，但您可以禁用自动符号加载，然后通过“模块”窗口（调试 -> Windows -> 模块）手动选择要加载的符号。

禁用自动符号加载

*   工具 -> 选项 -> 调试 -> 符号
*   勾选“仅在手动加载符号时搜索上述位置”

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2010-07-04T22:12:07.550

还要检查您是否没有“_NT_SYMBOL_PATH”环境变量。如果你有这个 var 符号，无论 VS 设置如何，都会加载。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2012-05-25T08:31:43.307

从 Visual Studio 2010 开始，您可以访问：

```
Tools -> Options -> Debugging -> Symbols -> Specify excluded modules 
```

并输入加载时间过长的 dll 列表。我使用输出窗口给出的完整路径；也许它接受通配符或简单的文件名。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2017-03-02T11:48:29.823

就我而言，这是因为**我**在

```
Tools > Options > Debugging > General. 
```

我没有将其设置为 false，而是将“仅启用我的代码”设置为 true，这会自动将“启用 .Net Source Stepping”设置为 false。在这样做之前它给了我一个警告：

```
Enabling Just my code automatically disabled .Net framework source stepping 
```

这表明`Just My Code`并且`.Net source stepping`是**相互排斥**的。

我希望这可以帮助别人。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-04T15:54:26.630

您还可以在 HKEY_CURRENT_USER\Software\Microsoft\Symbol Server\Exclusions 或 HKEY_LOCAL_MACHINE\Software\Microsoft\Symbol Server\Exclusions 或通过 .ini 文件在 %WINDIR%\ 中设置不会尝试下载的符号服务器排除项system32\inetsrv\Symsrv.ini（使用标题 [exclusions] 并将每个排除项放在自己的行上）。排除是简单的模式匹配，因此使用 msxml5.* 例如。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-01-13T09:08:04.010

不仅`_NT_SYMBOL_PATH`会导致这种行为，而且对我来说`_NT_ALT_SYMBOL_PATH`，导致延迟的是环境变量。

（我相信我在试验 WinDbg 时添加了这个变量）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-01-28T04:28:43.843

如果您转到 Debug Options -> Symbols 然后选中 "load only specified symbols" ，它不会自动加载符号并且调试器可以正常工作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-09-01T14:59:02.393

在 Visual Studio 2013 Pro 中，如果选中 Microsoft Symbol Server，VS 将尝试在其服务器上加载所有符号，从而导致大量额外时间。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-09-06T23:11:10.183

*   手动从 MS 网站加载所有符号包，将它们放在 SSD 驱动器上以提高速度:-)
*   如果您有“_NT_SYMBOL_PATH”环境变量，请*从“SRV* e:\symbols* [http://msdl.microsoft.com/download/symbols](http://msdl.microsoft.com/download/symbols) ”中删除“ *[http://msdl.microsoft.com/download/symbols](http://msdl.microsoft.com/download/symbols)* ”部分，因此您只有珍贵下载的符号所在的符号路径。
*   现在您已经支持符号，但它们不会从 MS 下载，而是从驱动器加载

# java - Type safety, Java generics and querying

> ID：869169
> 
> 赞同：10
> 
> 时间：2009-05-15T14:53:55.903
> 
> 标签：java, generics

I have an interesting situation and I'm wondering if there is a better way to do this. The situation is this, I have a tree structure (an abstract syntax tree, specifically) and some nodes can contain child nodes of various types but all extended from a given base class.

I want to frequently do queries on this tree and I'd like to get back the specific subtypes I'm interested in. So I created a predicate class that I can then pass into a generic query method. At first I had a query method that looked like this:

```
public <T extends Element> List<T> findAll(IElementPredicate pred, Class<T> c); 
```

where the `Class` argument was used just to indicate the return type. What bothered me about this approach is that all of my predicates were already for specific types so there is redundant information here. A typical call might look like:

```
List<Declaration> decls = 
    scope.findAll(new DeclarationPredicate(), Declaration.class); 
```

So I refactored it like this:

```
public <T extends Element> List<T> findAll(IElementPredicate<T> pred); 
```

Where the `IElementPredicate` interface looks like this:

```
public interface IElementPredicate<T extends Element> {
    public boolean match(T e);
    public String getDescription();
    public Class<T> getGenericClass();
} 
```

The point here is that the predicate interface is expanded to provide the `Class` object instead. It makes writing the actual `findAll` method a little bit more work and it adds a bit more work in writing the predicate, but those are both essentially tiny "one-time" things and it makes the query call so much nicer because you don't have to add the extra (potentially redundant) argument, e.g.

```
List<Declaration> decls = scope.findAll(new DeclarationPredicate()); 
```

I haven't noticed this pattern before. Is this a typical way of dealing with the semantics of Java generics? Just curious if I'm missing some better pattern.

Commments?

UPDATE:

One question was what do you need the Class for? Here is the implementation of findAll:

```
public <T extends Element> List<T> findAll(IElementPredicate<T> pred) {
    List<T> ret = new LinkedList<T>();
    Class<T> c = pred.getGenericClass();
    for(Element e: elements) {
        if (!c.isInstance(e)) continue;
        T obj = c.cast(e);
        if (pred.match(obj)) {
            ret.add(c.cast(e));
        }
    }
    return ret;
} 
```

While it is true that match only takes a T, I need to make sure the object is a T before I can call it. For that, I need the "isInstance" and "cast" methods of Class (as far as I can tell).

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-16T19:53:29.327

我认为最接近的“模式”是**type token**和 Generics Tutorial 推荐它们。您还可以将基本谓词转换为[超级类型标记](http://gafter.blogspot.com/2006/12/super-type-tokens.html)（又名 Gafter 小工具），并在定义新谓词时节省额外的几行代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-16T05:14:05.227

您的树结构听起来很像 XML DOM 对象。您是否考虑过将树转换为 DOM 结构并使用 XPath 进行查询？它可能会少很多自定义代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T15:11:42.757

如果需要，您可以使用访问者模式或变体来绕过显式构造和强制转换。请参阅有关[此的休眠 wiki 页面](https://www.hibernate.org/280.html)。我一直在考虑你是否会完全考虑到类型擦除的特性来解决你的问题，我不完全确定它会一直工作。

编辑：我看到了你的补充。如果您要使谓词层次结构遵循访问者层次结构，则在 match 调用之前不需要强制转换。像这样（未经测试）：

```
interface Element {
    public boolean accept(ElementPredicateVisitor v);
}

class Declaration implements Element {
    public boolean accept(ElementPredicateVisitor v) {
        return v.visit(this);
    }    
}

class TaxReturn implements Element {
    public boolean accept(ElementPredicateVisitor v) {
        return v.visit(this);
    }    
}

interface IElementPredicate {
    public void match(Element e);
}

class ElementPredicateVisitor implements IElementPredicate {
    public boolean match(Element e) { 
        return e.accept(this); 
    }
    /**
     * default values
     */
    boolean visit(Declaration d) { return false; }
    boolean visit(TaxReturn tr) { return false; }
}

class DeclarationNamePredicate extends ElementPredicateVisitor {
    boolean visit(Declaration d) {
        return d.dSpecificExtraName() == "something"
    }
}

class TaxReturnSumPredicate extends ElementPredicateVisitor {
    boolean visit(TaxReturn tr) {
        return tr.sum() > 1000;
    }
}

public <T extends Element> List<T> findAll(IElementPredicate pred) {
    List<T> ret = new LinkedList<T>();
    for(Element e: elements) {            
        if (pred.match(obj)) {
                ret.add((T) obj);
        }
    }
    return ret;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-16T05:23:09.557

我认为这是一种很好且干净的方式，我可能会以同样的方式来做。

# c# - Why doesn't my application show when started by my service

> ID：869186
> 
> 赞同：0
> 
> 时间：2009-05-15T14:56:43.370
> 
> 标签：c#, process, hidden

```
[DllImport("user32.dll")]
static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);

const int SW_SHOW =5;

string Tartgetfile = @"C:\BringLog.exe";
p.StartInfo.WindowStyle = ProcessWindowStyle.Normal;
p.StartInfo.CreateNoWindow = false;
p.StartInfo.FileName = Tartgetfile;
try
 {
  if (p.Start() == true)
   {
     ShowWindow(p.Handle, SW_SHOW);
     WriteToLog("PROCESS STARTED");
   }
  else
   {
    WriteToLog("FAILED TO START PROCESS");
   }
 }
catch (Exception ex)
 {
  WriteToLog("FAILED TO START PROCESS" + ex.Message+ ex.Source);
 } 
```

i have used this code in my service onsessionchange event, the service start my application on logon event but application is hidden but running. i couldn't view

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T15:11:39.510

默认情况下，服务无权访问任何会话——登录会话，Vista 中的安全 UAC，甚至普通用户会话都没有。因此，他们没有地方可以展示他们的窗户。这很好。它周围有黑客，但正确的方法可能是在 Windows Station "Winsta0" 中创建进程。`STARTUPINFO.lpDesktop ="winsta0\default";`调用时设置`CreateProcess( )`

# webforms - 使用 Web 表单和 DI 对象实例化的 MVP 模式

> ID：869199
> 
> 赞同：6
> 
> 时间：2009-05-15T14:59:07.607
> 
> 标签：webforms, dependency-injection, structuremap, ninject

我正在使用通用存储库模式来保存我的数据。在 PageLoad 上，我正在创建一个新的 Repository（来自 IRepository）对象，在 PageUnload 上，我将其处理掉。

MasterPage/Page 应该负责实例化传递给演示者的对象，还是应该由演示者负责？我更关心的是测试演示者而不是页面（视图），因为它更容易模拟传递给演示者的接口。

**示例页面**

```
public partial class _Default : System.Web.UI.Page
{
    private IRepository _repo;
    protected void Page_Load(object sender, EventArgs e)
    {
        if (_repo == null)
            _repo = new Repository();
        ConnectPresenter();
    }

    private void ConnectPresenter()
    {
        _DefaultPresenter presenter = new _DefaultPresenter(_repo);
    }

    private void Page_Unload(object sender, EventArgs e)
    {
        if (_repo != null)
            _repo.Dispose();
    }
} 
```

在这种情况下，诸如 StructureMap 或 Ninject 之类的 DI 框架会有所帮助吗？它会负责处理此类物品吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-11-07T17:54:58.023

Page 类和演示者都不必直接处理管理其任何依赖项的构造或生命周期 - 这一切都应该由您的容器处理。由于构造函数注入不适用于 WebForms，因此您需要将任何需要的依赖项公开为类的属性。例如，您可以将班级更改为：

```
public partial class _Default : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
    }

    public _DefaultPresenter Presenter { get; set; }
} 
```

该页面不需要对存储库的任何引用，因为它将被注入到演示者中。

*此答案的其余部分特定于 StructureMap - 其他容器的详细信息可能有所不同。*

要启用 setter 注入，您需要告诉 StructureMap 要填充哪些属性。一种方法是将 [SetterProperty] 属性应用于属性本身。但是，在您的类中包含 StructureMap 详细信息可能会让人觉得有点侵入性。另一种方法是配置 StructureMap 以便它知道要注入哪些属性类型。例如：

```
protected void Application_Start(object sender, EventArgs e)
{
    ObjectFactory.Initialize(x =>
    {
        x.Scan(scan =>
        {
            scan.TheCallingAssembly();
            scan.WithDefaultConventions();
        });
        x.ForRequestedType<IRepository>().TheDefaultIsConcreteType<Repository>().CacheBy(InstanceScope.Hybrid);
        x.SetAllProperties(set => set.WithAnyTypeFromNamespaceContainingType<IRepository>());
    });
} 
```

SetAllProperties 方法允许您告诉 StructureMap 如何识别它应该填充的属性。在这种情况下，我告诉 StructureMap 注入所有演示者（假设它们都在同一个命名空间中）。

您仍然需要对每个请求执行 setter 注入。使用 StructureMap，您可以使用 BuildUp() 方法将依赖项注入现有实例。您可以在每个页面或页面基类的 Init 或 Load 事件中执行此操作，但同样，这让人感觉很侵入。要将容器完全排除在页面类之外，您可以使用应用程序的 PreRequestHandlerExecute 事件（在 global.asax 或 IHttpModule 中）：

```
protected void Application_PreRequestHandlerExecute(object sender, EventArgs e)
{
    var application = (HttpApplication)sender;
    var page = application.Context.CurrentHandler as Page;
    if (page == null) return;
    ObjectFactory.BuildUp(page);
} 
```

最后，如果你想显式地处理你的 IRepository，你可以在 EndRequest 事件中处理它：

```
protected void Application_EndRequest(object sender, EventArgs e)
{
    var disposable = ObjectFactory.GetInstance<IRepository>() as IDisposable;
    if (disposable != null) disposable.Dispose();
} 
```

请注意，这可以正常工作，因为在初始化时我们告诉 StructureMap 通过 Hybrid 缓存 IRepository，这意味着“为每个 HTTP 请求（或线程，如果不在网站中运行）给我相同的实例”。当您在 EndRequest 中检索 IRepository 时，您将收到在整个请求中使用的同一个，您可以将其丢弃。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-05T16:25:16.563

是的，非常值得您研究[将 DI 与 ASP.NET 结合使用的演练之一](http://davidhayden.com/blog/dave/archive/2008/06/20/NinjectDependencyInjectionASPNETWebPagesSample.aspx)。

是的，在适当的点处理每个请求的行为对象通常由容器与 ASP.NET 的集成来管理。

典型的安排是对象创建从 Page 和`Application`/ `Module`s 向内流动。通常你`[Inject]`在你的`Page`类上标记属性，但这取决于你如何安排你的三元组。Presenter 通常可以使用 Constructo Injection 来声明它需要什么，无论是它的测试还是 ASP.NET cotext。然后在运行时，依赖项将由 DI 满足。在测试时，您仍然可以使用 DI，但在其他情况下，与 SUT 一起创建一堆 Fakes 并将它们传递给 Presenter 可能更自然。

关于测试的 triead 安排，我发现[Justin Etheredge 的这篇 MSDN Mag 文章中关于将 Ninject 与 xUnit.net 结合使用](http://msdn.microsoft.com/en-us/magazine/dd942838.aspx)非常有用，尽管它针对的是 ASP.NET MVC。

# infopath - 是否有一种简单的方法可以检测 InfoPath 2007 表单服务部分中的更改？

> ID：869201
> 
> 赞同：0
> 
> 时间：2009-05-15T15:00:02.363
> 
> 标签：infopath, infopath-forms-services

我正在寻找处理 InfoPath 部分中字段更改的提示/技巧。基本上，我希望能够为一个部分设置一个脏标志。我将 InfoPath 2007 与 Forms Services 一起使用。

目前，我的方法是向该部分中的每个字段添加规则以更新脏标志，但这太痛苦和混乱了。我缺少一些简单的解决方案吗？

作为推论，如果有人有在只读和非只读之间切换字段的提示/技巧，那也将不胜感激。我唯一的解决方案是复制另一个部分中的字段并根据逻辑隐藏/显示适当的部分。我意识到我也可以用视图来做到这一点，但两者都是丑陋的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-17T01:05:13.053

如果您不想添加一堆 InfoPath 规则；似乎编写一些表单代码可能是您最好的选择。

下面的 xmlchangedeventhandler 看起来有些用处。

[http://msdn.microsoft.com/en-us/library/microsoft.office.infopath.xmlchangedeventhandler.aspx](http://msdn.microsoft.com/en-us/library/microsoft.office.infopath.xmlchangedeventhandler.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-11T22:57:15.003

如果您不能使用代码，这将是规则/隐藏字段的混杂（即使那样它也不会很漂亮！）

# asp.net-mvc - 单元测试 asp.net mvc - viewengine 可以找到视图吗？

> ID：869203
> 
> 赞同：1
> 
> 时间：2009-05-15T15:01:09.740
> 
> 标签：asp.net-mvc, unit-testing

我发现我们的 mvc 设置中的一个常见断点是控制器返回时

```
return View(); 
```

或者其他什么，并且视图引擎找不到视图。

我希望能够测试我的控制器，然后在生成的 ViewResult 上运行 ExecuteResult，但是底层的 ViewEngine 与虚拟目录如此绑定，以至于我无法弄清楚如何测试它。

理想情况下，我实际上希望能够渲染视图并确定是否已找到它。

我在网上找不到太多关于这个的信息，我想知道 asp.net mvc 到底有多“可测试”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-16T13:55:47.737

我认为你的问题是你试图测试太多。

没有看到代码有点困难，但有一些初始起点：

1) 将您的控制器与您的虚拟目录分离 - 控制器应该是隔离的，并且不依赖于底层 Web 服务器设置。你通过这个访问什么？

您的控制器将返回一个 ViewResult，这应该附加您的模型，然后您可以使用它来验证是否将正确的数据传递给您的视图。使用 stubs\mocks 和依赖注入来验证控制器是否与数据库存储库等底层服务正确通信。

有一组单独的集成测试来涵盖您的存储库实现。

2) 使用Watin 等Web 测试框架来验证视图是否按预期呈现。这将允许您与网页和 HTML dom 进行交互，以验证它是否按预期工作。通过单元测试测试你的控制器。两个不同层的两个单独测试。

单元测试的目的是使您的测试和代码尽可能地隔离。

# xml - SQL Server 2005 XML 查询

> ID：869206
> 
> 赞同：1
> 
> 时间：2009-05-15T15:02:16.180
> 
> 标签：xml, sql-server-2005, xpath

有没有办法将模式应用于 xml 列以键入日期、整数、小数等值？此外，当使用 XPath 查询内容时，是否有办法检查实际类型而不是其字符串值？

我们是否应该尝试这样做，对这些值进行原始字符串检查是否会影响性能，或者我们是否应该关注这种方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T15:32:33.347

SQL Server XML 列的 XML 架构 - 是的，绝对是。您需要做的是创建一个模式集合（一个集合中可以有多个模式）

```
CREATE XML SCHEMA COLLECTION MySchemaCollection
AS N'...(here comes your xml schema as a string).....' 
```

然后当您定义 XML 列时，您需要引用该 XML 模式集合以将 XML 列绑定到该模式集合：

```
CREATE TABLE YourTable
   (......(some fields),
    XmlField XML(DOCUMENT MySchemaCollection),
      .... (more fields) ); 
```

XPath 的事情——不确定，但我不这么认为——XML 最终真的只是字符串，对吧？

马克

# c# - 在 LINQ to Entities 中批量删除

> ID：869209
> 
> 赞同：84
> 
> 时间：2009-05-15T15:02:39.923
> 
> 标签：c#, database, linq, entity-framework, linq-to-entities

有没有办法批量删除与 LINQ 或 LINQ-to-Entities 中的给定查询匹配的一堆对象？我能找到的唯一引用已经过时，迭代并手动删除我希望删除的所有对象似乎很愚蠢。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-05-15T17:59:07.643

不久前，我写了一个由 4 部分组成的博客系列（第[1、2、3 和 4](http://blogs.msdn.com/alexj/archive/2008/02/11/rolling-your-own-sql-update-on-top-of-the-entity-framework-part-4.aspx)[部分](http://blogs.msdn.com/alexj/archive/2008/02/11/rolling-your-own-sql-update-on-top-of-the-entity-framework-part-3.aspx)[）](http://blogs.msdn.com/alexj/archive/2007/12/07/rolling-your-own-sql-update-on-top-of-the-entity-framework-part-1.aspx)，[涵盖](http://blogs.msdn.com/alexj/archive/2008/01/15/rolling-your-own-sql-update-on-top-of-the-entity-framework-part-2.aspx)了在实体框架中进行批量更新（使用一个命令）。

虽然该系列的重点是更新，但您绝对可以使用所涉及的原则进行删除。

所以你应该能够写出这样的东西：

```
var query = from c in ctx.Customers
            where c.SalesPerson.Email == "..."
            select c;

query.Delete(); 
```

您需要做的就是实现 Delete() 扩展方法。有关如何...的提示，请参阅帖子系列

希望这可以帮助

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2011-07-07T16:07:17.910

```
 using (var context = new DatabaseEntities())
    {
        // delete existing records
        context.ExecuteStoreCommand("DELETE FROM YOURTABLE WHERE CustomerID = {0}", customerId);
    } 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2012-11-22T15:17:34.230

这个问题是一个老问题（在 EF5 存在之前）。对于使用 EF5 的任何人，[EntityFramework.Extended](https://github.com/loresoft/EntityFramework.Extended)可以快速完成此操作。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-03-30T18:57:50.273

我在这里看到的答案是 Linq to Sql

DeleteAllOnSubmit 是 System.Data.Linq 和 ITable 的一部分，它是 Linq to Sql

这不能用实体框架来完成。

说了这么多，我还没有解决方案，但是当我有解决方案时会回复

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-07-08T08:15:33.560

对于那些使用 EF6 并希望执行行 SQL 查询以进行删除的人：

```
using (var context = new DatabaseEntities())
{
    // delete existing records
    context.Database.ExecuteSqlCommand("DELETE FROM YOURTABLE WHERE CustomerID = @id", idParameter);
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-02-27T16:40:29.650

RemoveRange 是在 EF6 中引入的，它可以删除对象列表。超级容易。

```
var origins= (from po in db.PermitOrigins where po.PermitID == thisPermit.PermitID select po).ToList();
db.PermitOrigins.RemoveRange(origins);
db.SaveChanges(); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-15T15:07:59.490

我知道任何数据上下文的[DeleteAllOnSubmit](http://msdn.microsoft.com/en-us/library/system.data.linq.itable.deleteallonsubmit.aspx)方法，它将删除查询中的所有记录。由于正在删除许多对象，因此必须进行一些优化。不过我不确定。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-15T15:14:34.730

我不确定它的效率如何，但你可以尝试这样的事情：

```
// deletes all "People" with the name "Joe"
var mypeople = from p in myDataContext.People
               where p.Name == "Joe";
               select p;
myDataContext.People.DeleteAllOnSubmit(mypeople);
myDataContext.SubmitChanges(); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-15T17:28:08.060

你可以编写一个存储过程来执行删除并从 LINQ 调用它。基于集合的删除总体上可能更快，但如果它影响太多记录，您可能会导致锁定问题，并且您可能需要混合循环遍历记录集（一次可能 2000 个，大小取决于您的数据库设计，但 2000 是如果您发现基于集合的删除需要很长时间以影响表的其他使用）来执行删除。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-11-11T23:12:04.100

通过实体框架删除数据依赖于使用 DeleteObject 方法。您可以在要删除的实体类的 EntityCollection 或派生的 ObjectContext 上调用此方法。这是一个简单的例子：

```
NorthwindEntities db = new NorthwindEntities();

IEnumerable<Order_Detail> ods = from o in db.Order_Details
                                where o.OrderID == 12345                                    
                                select o;

foreach (Order_Detail od in ods) 
    db.Order_Details.DeleteObject(od);

db.SaveChanges(); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-02-10T14:09:39.923

在此示例中，我将要删除的记录一一附加到结果集中，然后请求将其删除。然后我有 1 个保存更改。

```
 using (BillingDB db = new BillingDB())
    {
      var recordsToDelete = (from i in db.sales_order_item
                  where i.sales_order_id == shoppingCartId
                  select i).ToList<sales_order_item>();

      if(recordsToDelete.Count > 0)
      {
        foreach (var deleteSalesOrderItem in recordsToDelete)
        {                  
            db.sales_order_item.Attach(deleteSalesOrderItem);
            db.sales_order_item.Remove(deleteSalesOrderItem);                  
        }
        db.SaveChanges();
      } 
    } 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-05-09T10:55:55.030

```
 context.Entity.Where(p => p.col== id)
               .ToList().ForEach(p => db.Entity.DeleteObject(p)); 
```

这些是使用 EF 从数据库中删除记录的最快方法

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-09-19T19:56:46.457

我会做类似的事情：

```
var recordsToDelete = (from c in db.Candidates_T where c.MyField == null select c).ToList<Candidates_T>();
if(recordsToDelete.Count > 0)
{
    foreach(var record in recordsToDelete)
    {
        db.Candidate_T.DeleteObject(record);
        db.SaveChanges();
    }
} 
```

我认为没有循环就没有办法做到这一点，因为实体框架与实体一起工作，而且大多数时候，这些意味着对象的集合。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-02-02T11:12:41.630

**当前 EF 中没有实现批量操作。**

这正是实体框架团队设计的方式。反编译器清楚地显示了 EF 在内部做什么：

```
public void DeleteAllOnSubmit<TSubEntity>(IEnumerable<TSubEntity> entities) 
where TSubEntity : TEntity
{
    if (entities == null)
    {
        throw Error.ArgumentNull("entities");
    }
    CheckReadOnly();
    context.CheckNotInSubmitChanges();
    context.VerifyTrackingEnabled();
    foreach (TSubEntity item in entities.ToList())
    {
        TEntity entity = (TEntity)(object)item;
        DeleteOnSubmit(entity);
    }
} 
```

如您所见，EF 在内部循环遍历表的所有元素 - 通过调用在内存中具体化`.ToList()`.

如果您仍然想使用 EF 开箱即用的可能性来完成它，而不是提交 SQL 命令，您仍然可以使用一些辅助方法让您的生活更轻松。语法

```
ctx.Table1.DeleteAllOnSubmit(ctx.Table1);
ctx.Table2.DeleteAllOnSubmit(ctx.Table2);
ctx.Table3.DeleteAllOnSubmit(ctx.Table3);
ctx.SubmitChanges(); 
```

在我看来不是很好看。

这是我在[LinqPad](https://www.linqpad.net/)中写的一个例子，它简化了一点：

```
void Main()
{
    var ctx = this;

    void DeleteTable<T>(System.Data.Linq.Table<T> tbl, bool submitChanges = false)
    where T : class
    {
        tbl.DeleteAllOnSubmit(tbl);
        if (submitChanges) ctx.SubmitChanges();
    }

    DeleteTable(ctx.Table1);
    DeleteTable(ctx.Table2);
    DeleteTable(ctx.Table3);

    ctx.SubmitChanges();
} 
```

如果你正在做测试并且需要删除很多表，那么这种语法更容易处理。换句话说，这是为您提供方便的一些语法糖。但请记住，EF 仍会在内部和内存中循环遍历所有对象，如果数据量很大，这可能会非常低效。

# sql - WHERE x IN (5) vs WHERE x = 5 ... 为什么使用 IN？

> ID：869214
> 
> 赞同：6
> 
> 时间：2009-05-15T15:03:38.547
> 
> 标签：sql, mysql, syntax

我最近注意到的事情是人们使用 IN 似乎有点不合适。我觉得我错过了一个技巧 - 也许有速度提升或其他什么？

这个查询：

```
SELECT * FROM pages WHERE is_visible IN ($visibility) 
```

为什么用那个？为什么不：

```
SELECT * FROM pages WHERE is_visible = $visibility 
```

当然，如果是这样的话：

```
SELECT * FROM pages WHERE is_visible 
IN ($visibility,$invisibility,$somethingelse) 
```

那么`WHERE x IN (1,2,3)`是一个更好的选择`WHERE x = 1 OR x = 2 OR x = 3`，对吧？但肯定这是您应该使用 IN 的*唯一*场景？

无论如何，感谢您的宝贵时间 - 我期待您的回复！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-15T15:08:03.203

也许不知道 $visibility 是指单个值还是多个值？不太适合你的例子，但我在其他地方看到过这种用法。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-15T15:05:46.250

> 那么`WHERE x IN (1,2,3)`是一个更好的选择`WHERE x = 1 OR x = 2 OR x = 3`，对吧？但肯定这是您应该使用的唯一场景`IN`？

不，您也可以将 IN 与子查询一起使用。

... where 字段（从另一个表中选择字段）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-15T15:06:30.850

也许 $visibility 是动态生成的，像这样：

```
$visibility = implode(', ', array_map('intval', array(1, 2, 3))); 
```

其中 array(1, 2, 3) 可能来自不受信任的来源。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-15T15:17:56.453

我认为更重要的是了解 IN 的作用。

如果你这样做

```
SELECT * FROM pages WHERE is_visible = $visibility 
```

在上面的 $visibility 必须是一个 var 所以 is_visibile = 1，所以你的 SQL 收集所有 is_visible = 1 的地方

在哪里

```
SELECT * FROM pages WHERE is_visible IN ($visibility) 
```

$visibility 将是一组数据，如@Ionut G. Stan 所示。

所以你的电话看起来像 is_visible IN ('1', '2', '3')

所以现在你的 SQL 将收集所有 1,2 & 3 行。

希望这是有道理的。它有很大的不同。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-15T15:12:30.837

In 作用于任何类型的集合操作，而 = 作用于单个值。因此，您可以将 in 用于另一个表上的多个记录，或用于表示多个值的任何其他类型的数据结构。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-15T15:35:13.603

这里没有提高性能的技巧，但我认为也没有任何性能影响。所以两种方式都可以。我同意你的观点，使用只有一个参数的 IN 子句看起来很有趣，但它仍然很容易理解。

我认为这可能会发生，因为开发人员认为将来可能允许多个值（这样查询就不会改变）。或者可能开发人员已经习惯了可能有多个值的场景，他们只是出于习惯这样写。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-15T15:21:55.650

不，这不是诡计。两种说法：

```
SELECT * FROM pages WHERE is_visible IN ($visibility)
SELECT * FROM pages WHERE is_visible = $visibility 
```

几乎等价。我们观察到这两个语句在普通情况下是等价的，例如，当`$visibility`是一个值为 1 的标量时。

但是，当包含其他内容时，这些陈述在非平凡的情况下是**不等价的。**`$visibility`我们可以观察到两种形式的行为存在显着差异。`$visibility`考虑当一个字符串包含这些示例值时，每个表单会发生什么：

```
    '1,2,3'
    '1 或 1=1'
    '从 vals v 中选择 v.val'

```

我们观察到两种形式生成的 SQL 语句的显着差异：

```
    SELECT * FROM pages WHERE is_visible IN (1,2,3)
    SELECT * FROM pages WHERE is_visible = 1,2,3

```

```
    SELECT * FROM pages WHERE is_visible IN (1 OR 1=1 )
    SELECT * FROM pages WHERE is_visible = 1 OR 1=1

```

* * *

对于任何一种形式的语句，这里的一个大问题是 SQL 注入的可能性。如果`$visibility`打算作为标量值，那么在语句中使用绑定变量是一种更安全的方法，因为它可以避免任何人将“额外”的 SQL 语法滑入语句中。（当然，使用绑定变量并不能阻止所有的 SQL 注入，但它是关闭一个漏洞的合适方法。使用绑定变量也将提高可伸缩性，至少在一些 DBMS 平台上，例如 Oracle。）

考虑当我们使用绑定变量（占位符）时会发生什么，我们知道它*不会*被解释为 SQL 语法。我们观察到这两个陈述**确实**是等价的：

```
    SELECT * FROM pages WHERE is_visible IN (?)
    SELECT * FROM pages WHERE is_visible = ?

```

对于为绑定变量提供的任何值。

高温高压

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-15T15:10:54.770

无论如何，“WHERE x IN (1,2,3)”与“WHERE x = 1 OR x = 2 OR x = 3”相同。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-15T20:26:37.087

> 那么 WHERE x IN (1,2,3) 是 WHERE x = 1 OR x = 2 OR x = 3 的更好替代方案，对吧？但肯定这是您应该使用 IN 的唯一场景？

IN () 和 OR 在语法上是等价的。检查您的两个建议的执行计划将显示这一点。IN() 只是一种更有效且易于理解的符号。

# c# - Linq to XML 生成 DDL

> ID：869216
> 
> 赞同：2
> 
> 时间：2009-05-15T15:03:50.247
> 
> 标签：c#, xml, linq, linq-to-xml, ddl

我们以本问题末尾的格式将数据库定义存储为 XML。我遇到的问题是获取模式列表、这些模式中的表、这些表中的列（所有这些都带有相关信息）。我当前的代码（包含在示例 XML 下方）抓取所有内容，完全忽略嵌套，并且由于多个模式，多次返回每个表/列。

**示例 XML：**

```
<schemas>
    <schema>
        <name>schema_name1</name>
        <tables>
            <table>
                <name>table_name2</name>
                <comment>comment string2</comment>
                <type>innodb2</type>
                <columns>
                    <column>
                        <name>column_name3</name>
                        <type>data_type3</type>
                        <size>3</size>
                        <nullable>not null3</nullable>
                        <comment>comment string3</comment>
                    </column>
                    <column>
                        <name>column_name4</name>
                        <type>data_type4</type>
                        <size>4</size>
                        <nullable>not null4</nullable>
                        <comment>comment string4</comment>
                    </column>
                </columns>
            </table>
        </tables>
    </schema>
    <schema>
        <name>schema_name5</name>
        <tables>
            <table>
                <name>table_name6</name>
                <comment>comment string6</comment>
                <type>innodb6</type>
                <columns>
                    <column>
                        <name>column_name7</name>
                        <type>data_type7</type>
                        <size>7</size>
                        <nullable>not null7</nullable>
                        <comment>comment string7</comment>
                    </column>
                </columns>
            </table>
        </tables>
    </schema>
</schemas> 
```

**C#代码：**

```
 XDocument xml_input = XDocument.Load(FILE_IN);
    string column_create = "";
    //build a list of all schemas in xml
    var schemas = from s in xml_input.Descendants("schema")
                  select new
                  {
                      name = s.Element("name").Value
                  };
    //loop through all schemas
    foreach (var s in schemas)
    {
        //write the schema creation lines
        Console.WriteLine("DROP SCHEMA IF EXISTS " + s.name + ";");
        Console.WriteLine("CREATE SCHEMA " + s.name + ";");
        //build a list of all tables in schema
        var tables = from t in xml_input.Descendants("schema")
                                        .Descendants("table")
                     select new
                     {
                         name = t.Element("name").Value,
                         comment = t.Element("comment").Value,
                         type = t.Element("type").Value
                     };
        //loop through all tables in schema
        foreach (var t in tables)
        {
            //write the beginning of the table creation lines
            Console.WriteLine("CREATE TABLE " + s.name + "." + t.name + " (");
            //build a list of all columns in the schema
            var columns = from c in xml_input.Descendants("schema")
                                             .Descendants("table")
                                             .Descendants("column")
                          select new
                          {
                              name = c.Element("name").Value,
                              type = c.Element("type").Value,
                              size = c.Element("size").Value,
                              comment = c.Element("comment").Value
                          };
            //loop through all columns in table
            foreach (var c in columns)
            {
                //build the column creation line
                column_create = c.name + " " + c.type;
                if (c.size != null)
                {
                    column_create += "(" + c.size + ")";
                }
                if (c.comment != null)
                {
                    column_create += " COMMENT '" + c.comment + "'";
                }
                column_create += ", ";
                //write the column creation line
                Console.WriteLine(column_create);
            }
            //write the end of the table creation lines
            Console.WriteLine(")");
            if (t.comment != null)
            {
                Console.WriteLine("COMMENT '" + t.comment + "'");
            }
            if (t.type != null)
            {
                Console.WriteLine("TYPE = " + t.type);
            }
            Console.WriteLine(";");
        }
    } 
```

关于如何保留嵌套结构的任何想法？我也无法处理可选的 XML 元素（例如表格注释或大小字段，它们不适用于所有数据类型）。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T16:43:13.253

以下是如何保留嵌套结构。将 XElement 添加到您的匿名类型以用作嵌套查询的源。

```
 XDocument xml_input = XDocument.Load(FILE_IN);
        string column_create = "";
        //build a list of all schemas in xml
        var schemas = from s in xml_input.Descendants("schema")
                      select new
                      {
                          schema = s,
                          name = s.Element("name").Value
                      };
        //loop through all schemas
        foreach (var s in schemas)
        {
            //write the schema creation lines
            Console.WriteLine("DROP SCHEMA IF EXISTS " + s.name + ";");
            Console.WriteLine("CREATE SCHEMA " + s.name + ";");
            //build a list of all tables in schema
            var tables = from t in s.schema.Descendants("table")
                         select new
                         {
                             table = t,
                             name = t.Element("name").Value,
                             comment = t.Element("comment").Value,
                             type = t.Element("type").Value
                         };
            //loop through all tables in schema
            foreach (var t in tables)
            {
                //write the beginning of the table creation lines
                Console.WriteLine("CREATE TABLE " + s.name + "." + t.name + " (");
                //build a list of all columns in the schema
                var columns = from c in t.table.Descendants("column")
                              select new
                              {
                                  name = c.Element("name").Value,
                                  type = c.Element("type").Value,
                                  size = c.Element("size").Value,
                                  comment = c.Element("comment").Value
                              };
                //loop through all columns in table
                foreach (var c in columns)
                {
                    //build the column creation line
                    column_create = c.name + " " + c.type;
                    if (c.size != null)
                    {
                        column_create += "(" + c.size + ")";
                    }
                    if (c.comment != null)
                    {
                        column_create += " COMMENT '" + c.comment + "'";
                    }
                    column_create += ", ";
                    //write the column creation line
                    Console.WriteLine(column_create);
                }
                //write the end of the table creation lines
                Console.WriteLine(")");
                if (t.comment != null)
                {
                    Console.WriteLine("COMMENT '" + t.comment + "'");
                }
                if (t.type != null)
                {
                    Console.WriteLine("TYPE = " + t.type);
                }
                Console.WriteLine(";");
            }
        } 
```

处理可选元素的一种方法是让您的 xml 在此列的注释中没有值时包含空元素：

```
 <column>
        <name>column_name4</name>
        <type>data_type4</type>
        <size>4</size>
        <nullable>not null4</nullable>
        <comment/>
      </column> 
```

这将在您的查询中返回一个空字符串，因此将代码更改为：

```
if (!string.IsNullOrEmpty(c.comment))
    {
        column_create += " COMMENT '" + c.comment + "'";
    } 
```

# unit-testing - 帮助从 dos 命令行运行 NUnit

> ID：869219
> 
> 赞同：0
> 
> 时间：2009-05-15T15:04:38.250
> 
> 标签：unit-testing, nunit

我正在编写一个 MSBuilds 脚本来从 CruiseControl.Net 运行我的 NUnit 测试。_Test_DAL 包含三个测试。

我在获取正确的 dos 命令来运行 NUnit 时遇到问题。

这是运行 NUnit 的命令，但它没有找到任何测试。

> D:\CC\JCDCHelper\Source_Test_DAL\bin\Debug>"C:\Program Files\NUnit 2.4.3\bin\nunit-console" /nologo _Test_DAL.dll
> 
> 测试运行：0，失败：0，未运行：0，时间：0.047 秒

我可以使用 resharper 来运行测试，所以我知道测试是正确编写的。

任何帮助都是极好的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-05-26T15:59:14.160

回去回答我提出的独立解决的问题。

我们现在使用 Powershell，但如果它对任何人有用，我们就是这样解决它的

```
function Invoke-UnitTests  { 

  $NUnitExe = "C:\" + $WhereIsProgramFiles + "\NUnit 2.5.7\bin\net-2.0\nunit-console.exe"
  Show-Status "Invoke-UnitTests was called."
  Show-Status $NUnitExe

  foreach( $OneProject in ( $TestProjects))
  {
    Show-Status "Running unit test for $OneProject"

    $GetCommonDlls = "D:\CC\$AppName\Source\$AppName\_CommonDlls"
    $GetBinDlls = "D:\CC\$AppName\Source\$AppName\Bin"
    Copy-Item "$GetCommonDlls\*" "$WorkingDir" 
    Copy-Item "$GetBinDlls\*" "$WorkingDir" 

    $WorkingDir = "D:\CC\$AppName\Source\$OneProject\obj\$ReleaseOrDebug"
    $NUnitOutput = "D:\CC\$AppName\NUnit\" + $OneProject + ".xml"

    & "$NUnitExe" "$WorkingDir\$OneProject.DLL" /nologo /xml:$NUnitOutput
    if ($lastExitCode -ne 0) 
    {
        Show-Status "NUnit test Command failed for Project:$ProjectName in Application:$AppName”
        Show-Status "Command that failed: ""$NUnitExe"" ""$WorkingDir\$OneProject.DLL"" /nologo /xml:$NUnitOutput"
        Show-Error “Error: Unit test for $OneProject failed”
    }
  }

  Show-Status "All Done with Unit tests"    
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T17:14:01.993

输入文件必须先行，然后是选项。

nunit-console _Test_DAL.dll /nologo

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-27T15:08:44.430

我不确定 Resharper 如何处理测试，但我确实记得 TestDriven.Net 能够对实际上未标记为单元测试的方法“运行测试”。确保您的类是公共的并标记为 [TestFixture]，并且单元测试是标记为 [Test] 的公共 void 方法。

# visual-studio - 禁用 Visual Studio 2008 项目的编译

> ID：869225
> 
> 赞同：21
> 
> 时间：2009-05-15T15:05:52.380
> 
> 标签：visual-studio, visual-studio-2008

有没有办法告诉 Visual Studio 在构建解决方案时不包含项目，而不仅仅是从解决方案中删除项目？

我的情况是解决方案中的一个项目需要一个我没有安装的插件/工具/库，但我们团队中的另一位开发人员需要。因此，当我尝试构建解决方案时，会出现编译错误。这是一个单元测试项目，因此从编译中删除它不会影响应用程序的功能。

我不想从解决方案中删除该项目，因为他只需要在我签入解决方案后重新添加它（然后我需要在签出时将其删除，无限期）。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-05-15T15:08:52.247

转到“构建”下拉菜单，选择“配置管理器”，您可以选择要更新的配置。然后在下面的项目列表中，取消选择要从构建中排除的项目上的“构建”复选标记。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-15T15:08:25.103

一个快速的解决方法是卸载项目。这是本地设置，因此不会更改解决方案或项目。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-15T15:10:23.993

右键单击解决方案>配置管理器...

在这里您可以看到一个带有复选框的构建列的网格，只需取消选中您不想构建的项目即可。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-09T01:09:29.523

如果您卸载项目，那么其他对您卸载的项目有任何引用的项目，将在编译期间抛出构建错误

# python - 为什么在 Python 中循环 range() 比使用 while 循环更快？

> ID：869229
> 
> 赞同：90
> 
> 时间：2009-05-15T15:06:41.847
> 
> 标签：python, performance, benchmarking

前几天我在做一些 Python 基准测试，遇到了一些有趣的事情。下面是两个或多或少做同样事情的循环。循环 1 的执行时间大约是循环 2 的两倍。

循环 1：

```
int i = 0
while i < 100000000:
  i += 1 
```

循环 2：

```
for n in range(0,100000000):
  pass 
```

为什么第一个循环这么慢？我知道这是一个微不足道的例子，但它激起了我的兴趣。range() 函数有什么特别之处，使其比以相同方式递增变量更有效吗？

* * *

## 回答 #1

> 赞同：173
> 
> 时间：2009-05-15T15:27:07.807

看python字节码的反汇编，你可能会有更具体的想法

使用 while 循环：

```
1           0 LOAD_CONST               0 (0)
            3 STORE_NAME               0 (i)

2           6 SETUP_LOOP              28 (to 37)
      >>    9 LOAD_NAME                0 (i)              # <-
           12 LOAD_CONST               1 (100000000)      # <-
           15 COMPARE_OP               0 (<)              # <-
           18 JUMP_IF_FALSE           14 (to 35)          # <-
           21 POP_TOP                                     # <-

3          22 LOAD_NAME                0 (i)              # <-
           25 LOAD_CONST               2 (1)              # <-
           28 INPLACE_ADD                                 # <-
           29 STORE_NAME               0 (i)              # <-
           32 JUMP_ABSOLUTE            9                  # <-
      >>   35 POP_TOP
           36 POP_BLOCK 
```

循环体有 10 个 op

使用范围：

```
1           0 SETUP_LOOP              23 (to 26)
            3 LOAD_NAME                0 (range)
            6 LOAD_CONST               0 (0)
            9 LOAD_CONST               1 (100000000)
           12 CALL_FUNCTION            2
           15 GET_ITER
      >>   16 FOR_ITER                 6 (to 25)        # <-
           19 STORE_NAME               1 (n)            # <-

2          22 JUMP_ABSOLUTE           16                # <-
      >>   25 POP_BLOCK
      >>   26 LOAD_CONST               2 (None)
           29 RETURN_VALUE 
```

循环体有 3 个 op

运行 C 代码的时间比解释器要短得多，可以忽略。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-05-15T15:18:02.523

`range()`在 C 中实现，而`i += 1`被解释。

使用`xrange()`可以使它更快地处理大量数据。从 Python 3.0 开始与`range()`以前相同`xrange()`。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2013-04-18T00:54:44.300

必须说，在 while 循环中进行了大量的对象创建和销毁。

```
i += 1 
```

是相同的：

```
i = i + 1 
```

但是因为 Python int 是不可变的，所以它不会修改现有对象；相反，它创建了一个具有新价值的全新对象。基本上是：

```
i = new int(i + 1)   # Using C++ or Java-ish syntax 
```

垃圾收集器还将进行大量清理工作。“对象创建很昂贵”。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2020-12-16T23:45:38.193

我认为这里的答案比其他答案建议的要微妙一些，尽管它的要点是正确**的：for 循环更快，因为更多的操作发生在 C 中，而在 Python 中发生的更少**。

更具体地说，在 for 循环的情况下，C 中发生了两件事，而 while 循环中则在 Python 中处理：

1.  在 while 循环中，比较`i < 100000000`在 Python 中执行，而在 for 循环中，作业被传递给 的迭代器`range(100000000)`，该迭代器在 C 中内部执行迭代（并因此进行边界检查）。

2.  在 while 循环中，循环更新`i += 1`发生在 Python 中，而在 for 循环中`range(100000000)`，用 C 编写的迭代器再次执行`i+=1`（或`++i`）。

我们可以看到，通过手动将它们添加回去以查看差异，正是这两者的结合使 for 循环更快。

```
import timeit

N = 100000000

def while_loop():
    i = 0
    while i < N:
        i += 1

def for_loop_pure():
    for i in range(N):
        pass

def for_loop_with_increment():
    for i in range(N):
        i += 1

def for_loop_with_test():
    for i in range(N):
        if i < N: pass

def for_loop_with_increment_and_test():
    for i in range(N):
        if i < N: pass
        i += 1

def main():
    print('while loop\t\t', timeit.timeit(while_loop, number=1))
    print('for pure\t\t', timeit.timeit(for_loop_pure, number=1))
    print('for inc\t\t\t', timeit.timeit(for_loop_with_increment, number=1))
    print('for test\t\t', timeit.timeit(for_loop_with_test, number=1))
    print('for inc+test\t', timeit.timeit(for_loop_with_increment_and_test, number=1))

if __name__ == '__main__':
    main() 
```

我尝试了数字 100000000 一个字面常量和它是一个`N`更典型的变量。

```
# inline constant N
while loop      3.5131139
for pure        1.3211338000000001
for inc         3.5477727000000003
for test        2.5209639
for inc+test    4.697028999999999

# variable N
while loop      4.1298240999999996
for pure        1.3526357999999998
for inc         3.6060175
for test        3.1093069
for inc+test    5.4753364 
```

如您所见，在这两种情况下，`while`时间都非常接近 和 的`for inc+test`差值`for pure`。另请注意，在我们使用`N`变量的情况下，`while`重复查找 的值时会额外减速`N`，但`for`不会。

**如此微不足道的修改可以导致超过3 倍的代码加速**，这真是太疯狂了，但那是 Python 适合你的。当你可以在循环中使用内置函数时，甚至不要让我开始......

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-15T15:15:04.013

因为您在解释器中更频繁地运行用 C 编写的代码。即 i+=1 在 Python 中，所以很慢（相对而言），而 range(0,...) 是一个 C 调用，for 循环也将主要在 C 中执行。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-15T15:39:43.110

大多数 Python 的内置方法调用都作为 C 代码运行。必须解释的代码要慢得多。在内存效率和执行速度方面，差异是巨大的。python 内部已经优化到了极致，最好利用这些优化。

# php - PHP 订阅 - 阻止共享

> ID：869233
> 
> 赞同：0
> 
> 时间：2009-05-15T15:07:23.717
> 
> 标签：php

有一位客户正在考虑开发一个网站，客户可以通过订阅获得访问权限。

显然，最大的担忧是人们分享他们的登录详细信息。

是否有任何好的技术可以用来帮助防止或至少减少这种情况。

显然，每个登录的用户只允许一个会话，所以如果他们登录，它会踢掉其他人。

还有什么好主意吗？

如果您能提供建议，谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T16:08:28.533

您可以将活动会话存储在数据库表中并使用它来防止多次登录。但是，必须将这些存储的会话设置为相当快地过期。如果有人没有注销或切换浏览器或他们的计算机崩溃，他们不想等待一天再次登录。

这不是一个编程解决方案，但另一个想法是：给它定价，这样就没有分享的动力。人们转向 Napster 是因为 CD 被高估了。现在他们很乐意在亚马逊或 iTunes 上为每首歌支付 1 美元。人们盗版 MS Office，因为它的成本很高，最好让 5 个人参与然后分享它。人们很少盗版教育许可版本，因为它只需约 60 美元。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T15:14:02.593

这实际上取决于您对错误地锁定合法用户的担忧程度。

您可以跟踪他们登录时使用的 IP 地址，以及其他一些标识符，例如他们的用户代理字符串，然后查找差异。因此，如果某人通常使用 Firefox 从 Verizon 拥有的 IP 登录，然后突然使用 Internet Explorer 从巴西的一个 IP 登录，那可能是有人分享了他们的登录详细信息。但是，也可能是同一个用户刚刚去巴西旅行并正在使用他们叔叔的电脑。你打算怎么讲？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T15:15:00.113

您可以添加人们不愿意传递的个人问题，例如出生日期，这是登录所需的。

我对可能订阅的人一无所知，但可以将订阅限制在 IP 范围内。这通常不会起作用，例如，如果您的客户是公众成员。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T15:19:32.627

如果登录的价值足够高，您可以发送一个类似银行用于身份验证的硬件 - 每次您要登录时它都会生成一个 PIN。

这将使登录共享仅限于对设备具有物理访问权限的人。

# java - 如何实现递归的拖放文件/文件夹上传？

> ID：869234
> 
> 赞同：2
> 
> 时间：2009-05-15T15:07:28.413
> 
> 标签：java, file-upload

我正在寻找某种方法来实现要上传到站点的文件和文件夹的下拉框。我从[rad inks](http://www.radinks.com/upload/)中找到了一个，但它只支持多个文件。

有谁知道像这样支持文件夹上传的东西？

该网站本身基于 PHP。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T21:29:18.370

您可以使用您正在寻找的同一个人的小程序来做到这一点：

[http://www.radinks.com/upload/folder.php](http://www.radinks.com/upload/folder.php)

演示： [http ://www.radinks.com/upload/applet.php](http://www.radinks.com/upload/applet.php)

# c# - 将 XslCompiledTransform 与 cdata-section-elements 一起使用

> ID：869238
> 
> 赞同：2
> 
> 时间：2009-05-15T15:07:59.693
> 
> 标签：c#, xml, xslt

我希望在我的输出 XML 中有 CDATA 部分。我尝试使用 xsl:output 的“cdata-sections-element”属性。但是，我的输出中没有 CDATA。

```
using System;
using System.Xml;
using System.Xml.Xsl;
using System.IO;
using System.Text;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            string stylesheet =
@"<xsl:stylesheet version=""1.0"" xmlns:xsl=""http://www.w3.org/1999/XSL/Transform"">
<xsl:output xmlns:t=""temp-uri"" cdata-section-elements=""t:text"" method=""xml""/>
<xsl:template match=""/"">
<text xmlns=""temp-uri""><xsl:value-of select="".""/></text>
</xsl:template>
</xsl:stylesheet>
";
            XmlReader reader = XmlReader.Create(new StringReader(stylesheet));
            XslCompiledTransform t = new XslCompiledTransform(true);
            t.Load(reader);

            XmlReader input = XmlReader.Create(new StringReader("<foo><![CDATA[<hello]]></foo>"));
            StringBuilder sb = new StringBuilder();

            XmlWriter results = XmlWriter.Create(new StringWriter(sb));
            t.Transform(input, null, results);

            Console.WriteLine(sb.ToString());
            Console.ReadLine();
        }
    }
} 
```

实际输出

```
 <?xml version="1.0" encoding="utf-16"?><text xmlns="temp-uri">&lt;hello</text> 
```

所需输出

```
<?xml version="1.0" encoding="utf-16"?><text xmlns="temp-uri"><!CDATA[<hello]]></text> 
```

我在这里想念什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T15:15:05.773

您的 XmlWriter 必须被告知当前的输出设置：

```
XmlWriter results = XmlWriter.Create(new StringWriter(sb), t.OutputSettings);
//---------------------------------------------------------^^^^^^^^^^^^^^^^ 
```

# java - 如何将 JLabels 定位到 Java GUI 上的绝对位置

> ID：869245
> 
> 赞同：9
> 
> 时间：2009-05-15T15:09:12.887
> 
> 标签：java, user-interface, swing, layout-manager

我在 a 中有很多`JLabel`s（包括`ImageIcon`s）`JPanel`。

这`JPanel`只是 GUI 上的一个面板；还有很多其他面板。

我想将标签放置在其`JPanel`容器上的确切像素坐标上。

我怎么能不使用`GroupLayout`呢？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-15T15:19:51.427

请参阅Java 教程中的[不使用布局管理器（绝对定位）进行操作。](http://java.sun.com/docs/books/tutorial/uiswing/layout/none.html)

> 创建没有布局管理器的容器涉及以下步骤。
> 
> 1.  通过调用将容器的布局管理器设置为空`setLayout(null)`。
> 2.  为容器的每个子级调用`Component`类的`setbounds`方法。
> 3.  调用`Component`类的`repaint`方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T15:19:42.550

任何一个

*   在面板上设置自定义[`LayoutManager`](http://java.sun.com/javase/6/docs/api/java/awt/LayoutManager.html)( [`Container.setLayout`](http://java.sun.com/javase/6/docs/api/java/awt/Container.html#setLayout(java.awt.LayoutManager))) 以设置您想要的确切位置或
*   设置`null`布局管理器 ( `myPanel.setLayout(null);`) 并在外部设置组件位置 ( [`Component.setBounds`](http://java.sun.com/javase/6/docs/api/java/awt/Component.html#setBounds(java.awt.Rectangle)))。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-15T15:26:30.427

看看 MigLayout，它可以让你做绝对定位，它不是 JDK 的一部分，[而是一个单独的下载](http://www.miglayout.com/ "http://www.miglayout.com/")。

就布局管理器而言，它非常好，可以进行绝对定位，再加上一大堆其他事情。

# windows - 用于评论长度的 Windows 预提交挂钩 Subversion

> ID：869248
> 
> 赞同：34
> 
> 时间：2009-05-15T15:09:53.807
> 
> 标签：windows, svn, tortoisesvn, svn-hooks, pre-commit

我似乎对此一无所获。要么在网上搜索脚本等。任何人都有一个脚本，你可以在 Windows 环境中编辑开箱即用的 pre-commit.tmpl，需要输入 x 字符才能评论 Tortoise Subversion 中的提交全局，以便团队中的所有成员都需要，而此要求从 SVN 服务器下推到客户端？

我不知道脚本语言，这应该是非常简单的事情，无需我花时间在接下来的 3 小时内弄清楚脚本。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-05-15T15:20:53.733

这是一个需要注释的 .bat 文件。它检查评论中是否存在至少一个字符。

```
 @echo off  
 :: Stops commits that have empty log messages.        
 @echo off  

 setlocal  

 rem Subversion sends through the path to the repository and transaction id  
 set REPOS=%1  
 set TXN=%2           

 svnlook log %REPOS% -t %TXN% | findstr . > nul  
 if %errorlevel% gtr 0 (goto err) else exit 0  

 :err  
 echo. 1>&2  
 echo Your commit has been blocked because you didn't enter a comment. 1>&2  
 echo Write a log message describing the changes made and try again. 1>&2
 echo Thanks 1>&2
 exit 1 
```

该文件位于存储库的 /hooks 文件夹中，名为 pre-commit.bat。如果您需要最少数量的字符，则要修改的行是

```
svnlook log %REPOS% -t %TXN% | findstr . > nul 
```

因此，如果您想要至少 10 个字符，则需要 10 个 . 而不仅仅是一个

```
svnlook log %REPOS% -t %TXN% | findstr .......... > nul 
```

findstr 命令的更[高级选项](http://technet.microsoft.com/en-us/library/bb490907.aspx)将让您进行更高级的检查（某些字符集等）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T15:43:18.500

我使用[SubversionNotify](http://www.subversionnotify.com/)，它可能比您需要的更多，但设置起来非常简单。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-12-11T12:41:49.530

我有一个[预提交钩子](https://github.com/qazwart/SVN-Precommit-Kitchen-Sink-Hook)，可以完全按照您的意愿行事。再加上很多。

*   您可以指定提交评论的最小长度。
*   您可以将提交注释与[正则表达式](http://en.wikipedia.org/wiki/Regular_expression)进行匹配。不仅可以指定长度，还可以指定某些参数。例如，提交注释是否包含缺陷跟踪系统使用的错误编号，以便您可以将更改追溯到特定缺陷？

它还允许您执行以下操作：

*   针对特定文件或目录设置各种提交权限：
    *   **读写**：用户可以签出和提交这些项目。
    *   **只读**：用户可以签出此项目，但不能提交更改。
    *   **add-only**：用户可以通过添加目录`svn cp`，但不能提交任何更改。`/tags`这对于允许您制作标签但不能修改标签的目录来说是完美的。
    *   **no-delete**：用户可以提交更改并添加新文件，但不能删除这些文件。
    *   **no-add**：用户只能提交更改，不能在提交中添加或删除文件。

而且，它还允许您这样做：

*   [通过globbing](http://en.wikipedia.org/wiki/Glob_(programming))的正则表达式禁止某些文件名，
*   要求某些文件或目录具有将特定属性设置为特定值的特定属性。对于确保 Unix shell 脚本、Unix Makefile 和 Windows 批处理文件具有正确的行结尾或`svn:ignore`已设置等事情非常有用，因此用户不会意外提交不应提交的文件。
*   要求使用某些值设置某些修订属性。这是您检查提交消息的方式，但`svn:log`必须与某些正则表达式匹配。

这个预提交脚本是用 Perl 编写的。默认情况下，Perl 带有 Unix、Mac 和 Linux 服务器。不幸的是，它不包含在 Windows 计算机上。幸运的是，有几个开源、免费且易于安装 PC 的 Perl 包，例如[ActivePerl](http://www.activestate.com/activeperl/downloads)和[Strawberry Perl](http://strawberryperl.com)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-09-13T15:56:18.150

在 Windows 上，您可以使用`VisualSVNServerHooks.exe check-logmessage`VisualSVN Server 附带的预提交挂钩，该挂钩位于`%VISUALSVN_SERVER%bin`目录中。这个简单的工具将帮助您定义日志消息中允许的最小字符数。

有关说明，请参阅文章[KB140：验证 VisualSVN 服务器](https://www.visualsvn.com/support/topic/00140/)中的提交日志消息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-04T14:42:30.800

试试这个 ：

```
rem Make sure that the log message contains some text.
set REPOS=%1
set TXN=%2

"C:\Program Files\Subversion\bin\SVNlook.exe" log -t %TXN% %REPOS% | FindStr [a-zA-Z0-9]  
IF %ERRORLEVEL% EQU 0 GOTO OK  
echo Your commit has been blocked because you didn't provide a log message 1>&2  
echo Please write a log message describing the purpose of your changes and 1>&2  
echo then try committing again. -- Thank you 1>&2   
exit 1  

:OK  
rem -------------------------------------------------------------  
rem Check if comment is in list of reserved words to not be used..  
rem -------------------------------------------------------------  

"C:\Program Files\Subversion\bin\SVNlook.exe" log -t %TXN% %REPOS% >comment  
setlocal enabledelayedexpansion  
Set SEPARATOR=  
set COMMENT=  
for /f "delims=" %%a in (comment) do (      
    set currentline=%%a  
    set COMMENT=!COMMENT!%SEPARATOR%!currentline!  
)  

FIND "%COMMENT%" "C:\Program Files\Subversion\excludedwords.txt">Null  
If %ERRORLEVEL% EQU 1 goto OK2  

:Fail  
echo Your commit has been blocked because the single word comment you provided is not allowed 1>&2  
echo Line is -%COMMENT%- 1>&2  
echo Please write a proper log message describing the purpose of your changes and 1>&2  
echo then try committing again. -- Thank you 1>&2   
exit 1  

:OK2  
rem -------------------------------------------------------------  
rem Check number of words on the line if = 2 then reject comment  
rem -------------------------------------------------------------  
Set VAR1=%COMMENT%  
Set count=0  
For %%j in (%VAR1%) Do Set /A count+=1  
IF %count% EQU 2 goto Fail2  
goto OK3  

:Fail2  
echo Your commit has been blocked because not enough detail supplied 1>&2  
echo Please write a longer log message describing the purpose of your changes and 1>&2  
echo then try committing again. -- Thank you 1>&2   
exit 1  

:OK3  
rem -------------------------------------------------------------  
rem Check that the author of this commit has the rights to perform  
rem -------------------------------------------------------------  
rem the commit on the files and directories being modified.  
rem commit-access-control.pl "$REPOS" "$TXN" commit-access-control.cfg || exit 1  

rem All checks passed, so allow the commit.  
exit 0 
```

# asp.net - 当我设置宽度时，为什么 GridView 宽度没有在页面上扩展 100%？

> ID：869249
> 
> 赞同：0
> 
> 时间：2009-05-15T15:10:05.973
> 
> 标签：asp.net, css, gridview

我有以下标记，我从 div 中取出了额外的东西，所以更容易理解。我使用可折叠面板扩展器将 GridView 设置为 100%，它在页面上显示良好。然后，不用做可折叠面板扩展器和使用手风琴面板，gridview 只会根据需要扩展，无论我将宽度设置为什么。这是下面的标记：

```
<div>
    <cc1:Accordion ID="Accordion1" runat="server" SelectedIndex="0"
                   HeaderCssClass="collapsePortfolioHeader"
                   FadeTransitions="true" 
                   FramesPerSecond="40" 
                   TransitionDuration="250" 
                   AutoSize="None">
        <Panes>
            <cc1:AccordionPane runat="server">
                <Header>
                    Create Portfolio</Header>
                <Content>
                    <br />
                    <div style="height: 290px;">
                        <div style="float: left; width: 250px; 
                                    margin-right: 75px;">
                        </div>
                        <div style="float: left; width: 250px;">
                        </div>
                        <div style="float: left; width: 70px; 
                                    margin: 5px;">
                        </div>
                        <div style="float: left; width: 250px; 
                                    margin: 5px;">

                        </div>
                        <div class="clear"> //just a clear both;
                        </div>
                    </div>
                </Content>
            </cc1:AccordionPane>
            <cc1:AccordionPane runat="server">
                <Header>
                    Create Portfolio By Location</Header>
                <Content>

                    <div style="height: 150px;">
                        <div style="float: left; width: 170px; 
                                    margin: 5px;">

                        </div>
                        <div style="float: left; 
                                    margin-right: 5px;">
                        </div>
                        <div style="float: left; width: 250px;
                                    margin-right: 5px;">

                        </div>
                        <div style="float: left; width: 70px; 
                                    padding-top: 100px;">
                        </div>
                        <div style="float: left; width: 250px; 
                                    margin-left: 15px;">

                        </div>
                        <div class="clear">
                        </div>
                    </div>
                </Content>
            </cc1:AccordionPane>
        </Panes>
    </cc1:Accordion>
</div>

<div class="grid"> //the grid class just has margin:0;
// GridView goes here
</div> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T15:40:50.503

赛软，

不确定您的环境有什么不同。但是我使用了您在问题中粘贴的代码，添加了一个网格视图，用一些测试数据填充它并将宽度设置为 100%，它跨越了整个页面。我能想到的唯一一件事是你的 CSS 中有一些东西可能会导致它。它适用于不同页面的事实意味着它可能不是 CSS（嗯）。可能是此页面的本地内容？

我认为这与手风琴无关。

看看下面复制的代码，这是我在我的测试项目中拥有的，它有效。

我建议从没有 CSS 的新页面开始，然后从那里开始。如果没有看到你的整个 CSS，这将很难回答。

```
<div>
            <ajaxToolkit:Accordion ID="Accordion1" runat="server" SelectedIndex="0" HeaderCssClass="collapsePortfolioHeader"
                FadeTransitions="true" FramesPerSecond="40" TransitionDuration="250" AutoSize="None">
                <Panes>
                    <ajaxToolkit:AccordionPane runat="server">
                        <Header>
                            Create Portfolio</Header>
                        <Content>
                            <br />
                            <div style="height: 290px;">
                                <div style="float: left; width: 250px; margin-right: 75px;">
                                </div>
                                <div style="float: left; width: 250px;">
                                </div>
                                <div style="float: left; width: 70px; margin: 5px;">
                                </div>
                                <div style="float: left; width: 250px; margin: 5px;">
                                </div>
                                <div class="clear">
                                </div>
                            </div>
                        </Content>
                    </ajaxToolkit:AccordionPane>
                    <ajaxToolkit:AccordionPane runat="server">
                        <Header>
                            Create Portfolio By Location</Header>
                        <Content>
                            <div style="height: 150px;">
                                <div style="float: left; width: 170px; margin: 5px;">
                                </div>
                                <div style="float: left; margin-right: 5px;">
                                </div>
                                <div style="float: left; width: 250px; margin-right: 5px;">
                                </div>
                                <div style="float: left; width: 70px; padding-top: 100px;">
                                </div>
                                <div style="float: left; width: 250px; margin-left: 15px;">
                                </div>
                                <div class="clear">
                                </div>
                            </div>
                        </Content>
                    </ajaxToolkit:AccordionPane>
                </Panes>
            </ajaxToolkit:Accordion>
        </div>
        <div class="grid">
            <asp:GridView ID="GridView1" runat="server" Width="100%">
            </asp:GridView>
        </div> 
```

# svn - Subversion 外部定义中的相对路径对我不起作用！

> ID：869253
> 
> 赞同：5
> 
> 时间：2009-05-15T15:10:57.687
> 
> 标签：svn, externals

我知道有一个关于[subversion 中的相对路径](https://stackoverflow.com/questions/359302/relative-path-in-subversion-external-configuration)的问题，但它对我不起作用。

我得到的错误是：

```
svn propset svn:externals "openscada_da_server_common ../../openscada_da_server_common/schema" /tmp/atlantis-trunk/org.openscada.da.client.viewer/schema
svn: Ungültige Eigenschaft svn:externals 
    auf »/tmp/atlantis-trunk/org.openscada.da.client.viewer/schema«: 
    Ziel »../../openscada_da_server_common/schema« ist ein absoluter 
    Pfad oder enthält »..« 
```

等效的英文版本应该是：

```
"Invalid %s property on '%s': target '%s' is an absolute path or involves '..'" 
```

我的问题是为什么？根据颠覆文档，这是一个有效值[http://svnbook.red-bean.com/en/1.5/svn.advanced.externals.html](http://svnbook.red-bean.com/en/1.5/svn.advanced.externals.html)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-03-07T16:18:17.157

交换 2 个参数的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T15:20:57.010

如果您在所参考的手册页面中进一步阅读，您会注意到以下内容：

> 此外，定义的本地子目录部分不能包含 .. 父目录指示符（例如 ../../skins/myskin）。

为清楚起见，对于相对路径，参数的正确顺序为`svn:externals`：

```
^/../otherRepo/trunk/path/to/dir     dir 
```

# java - IIS WCF 服务通过带有 NTLM 身份验证的 JAVA 访问

> ID：869255
> 
> 赞同：1
> 
> 时间：2009-05-15T15:11:31.743
> 
> 标签：java, .net, wcf, ntlm

我们有一个托管在 IIS 6 中的 WCF 服务，并在目录安全下打开了集成 Windows 身份验证。从 .NET Windows 客户端使用此服务，缓存的 NTLM 凭据流向服务器 PC，一切正常。当 Java 客户端从 Windows PC 访问服务（通过 WSDL 生成的对象）时，我们希望发生同样的情况。我们在网上搜索的所有内容似乎都表明，如果我们利用 Sun java.net.authenticator 并在 Windows 平台上运行该进程，我们不需要将用户名/密码硬编码到 Java 代码中。这是真的？我们有一个使用 Axis 2.0 及其专有 NTLM 身份验证器的解决方案，但是我们必须对用户名/密码进行硬编码。理想情况下，我们希望 NTLM 缓存凭据自动流向服务器。

想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-11-16T11:25:33.037

这是一个开源库[http://spnego.sourceforge.net/protected_soap_service.html](http://spnego.sourceforge.net/protected_soap_service.html)，它完全可以满足您的需求。

# sql-server - 在 SQL Reporting Services 中，如何根据参数过滤数据集？

> ID：869261
> 
> 赞同：7
> 
> 时间：2009-05-15T15:12:14.550
> 
> 标签：sql-server, reporting-services, reporting

我有一个未经过滤的数据集要处理以生成报告*（SQL Server 2005 btw）*。

假设我有一个*名称*列，我想在我的报告中添加一个参数，以便只选择包含某些字符的名称。

有人知道如何处理这些过滤器吗？

我试过没有运气这些：

```
=Fields!Name.Value Like =Parameters!FilterName.Value

=Fields!Name.Value = = "%" + Parameters!FilterName.Value + "%" 
```

如果我给出参数“oo”，我希望能够获得名称“foo”和“foobar”

**编辑：** *我知道过滤应该在 SQL 服务器端完成，但我不控制给定的数据集（网络服务使用无参数方法提供它），所以我必须在报表端进行过滤。*

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-15T15:25:44.110

我回答我自己的问题，过滤器表达式实际上是：

```
=Fields!Name.Value Like ="*"+ Parameters!FilterName.Value + "*" 
```

即使用`"*"`而不是`"%"`，事实上。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T15:16:49.530

首选的做法是进行完全匹配。

您可以根据查询或替代查询返回的数据集构建多值参数列表，从而确保可以实现精确匹配。

以下参考资料可能很有用。

[http://msdn.microsoft.com/en-us/library/ms155917.aspx](http://msdn.microsoft.com/en-us/library/ms155917.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-15T15:53:58.957

我建议您将过滤器应用为 SQL 语句的一部分，该语句执行以恢复数据集，而不是尝试在 Reporting Services 报告中应用过滤器。我认为 SQL 引擎在处理这些类型的过滤器/查询方面更加优化。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-01-25T15:51:54.087

你的回答让我走上了正轨:)！SQL Server 2005 可能不同；但是以下解决方案对我有用：

```
=Fields!AppName.Value    Like    ="*" & Parameters!FilterApplication.Value & "*" 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T15:16:56.783

转到数据集的属性，转到过滤器选项卡。在表达式下拉列表中，单击要按（名称）过滤的字段。单击运算符并选择like。在值框中单击表达式选择。将打开一个新窗口。转到您的参数列表并将参数添加到方程中。点击确定。

# php - 是否有适用于手动测试的代码覆盖率工具？

> ID：869263
> 
> 赞同：3
> 
> 时间：2009-05-15T15:12:43.160
> 
> 标签：php, phpunit, code-coverage

**在 php 中，有没有一种工具可以在不**使用自动化单元测试用例的情况下生成代码覆盖率报告？

（基本上不使用 phpunit 或类似的单元测试框架，它们可以很好地生成报告，但需要用 php 编写单元测试用例！）。

正是我正在寻找的工具，它可以根据测试人员执行的手动测试为我生成代码覆盖率报告。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-07-26T22:08:05.610

谢尔顿，

你听说过 Xdebug 吗？我正在使用它，它太棒了！我使用的是 Ubuntu 8.04，它可以通过包存储库 (apt-get) 获得。

它是免费的，并且具有基本的代码覆盖率分析功能：

[http://xdebug.org/docs/code_coverage](http://xdebug.org/docs/code_coverage)

供您参考，还提供分析：

xdebug.org/docs/profiler

（这应该是一个超链接！！！它只允许我每个答案发布一个超链接，因为我是一个新用户......叹息......）

希望这可以帮助！

健二

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-14T04:19:21.187

我的公司 Semantic Designs 提供了一个 PHP 测试覆盖工具，可以很好地做到这一点： [http ://www.semdesigns.com/Products/TestCoverage/PHPTestCoverage.jsp](http://www.semdesigns.com/Products/TestCoverage/PHPTestCoverage.jsp)

您设置了覆盖集合，然后运行手动测试。您可以将手动测试分组到单个测试覆盖率集合中，或者单独处理它们，稍后使用覆盖率显示工具将它们的结果合并在一起。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T17:18:12.203

Compuware 的 DevPartner 工具可以做到这一点。我不确定，但您可能需要手动合并多个测试运行的结果。

# java - Java应用程序的调试/标准构建

> ID：869264
> 
> 赞同：3
> 
> 时间：2009-05-15T15:12:49.807
> 
> 标签：java, debugging

问候，

我正在使用嵌入式 java，我将应用程序写入低资源设备。我遇到的问题之一是代码崩溃时设备停止。通过我添加的一些日志记录，我可以从中获得一些信息。（简单的打印语句）

由于内存限制，此日志记录无法保留在应用程序中。

我想知道是否有人知道我可以将一个标志传递给 JVM 来说明它是我需要的调试还是标准编译。

如果它是调试版本，我希望包含打印语句，如果它是删除打印语句的标准版本。我问是因为我必须不断地剪切和粘贴语句等。（这很痛苦）

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-15T15:16:30.903

`if (constant)`您可以利用编译器优化的事实。

在某处创建一个全局变量`DEBUG`：

```
public static final boolean DEBUG = true; 
```

然后像这样进行日志记录：

```
if (DEBUG) {
    System.out.println("Debug");
} 
```

要禁用调试，只需更改`DEBUG`为`false`，编译器将优化所有日志记录语句。您可以通过查看生成的字节码来验证这一点`javap -c`。

例如：

```
class DebugTest {
    public static final boolean DEBUG = true;
    public static void main(String[] args) {
        if (DEBUG) {
            int a = 10;
            System.out.println("a = " + a);
        }
    }
} 
```

编译为：

```
编译自“DebugTest.java”
类 DebugTest 扩展 java.lang.Object{
公共静态最终布尔调试；

调试测试（）；
  代码：
   0：aload_0
   1：调用特殊#1；//方法 java/lang/Object."":()V
   4：返回

公共静态无效主（java.lang.String[]）；
  代码：
   0：双向推 10
   2：istore_1
   3：获取静态#2；//字段 java/lang/System.out:Ljava/io/PrintStream;
   6：新#3；//类 java/lang/StringBuilder
   9：重复
   10：调用特殊#4；//方法 java/lang/StringBuilder."":()V
   13：最不发达国家#5；//字符串a =
   15：调用虚拟#6；//方法java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
   18: iload_1
   19：调用虚拟#7；//方法java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
   22：调用虚拟#8；//方法 java/lang/StringBuilder.toString:()Ljava/lang/String;
   25：调用虚拟#9；//方法java/io/PrintStream.println:(Ljava/lang/String;)V
   28：返回

}
```

更改`DEBUG`为`false`收益率：

```
编译自“DebugTest.java”
类 DebugTest 扩展 java.lang.Object{
公共静态最终布尔调试；

调试测试（）；
  代码：
   0：aload_0
   1：调用特殊#1；//方法 java/lang/Object."":()V
   4：返回

公共静态无效主（java.lang.String[]）；
  代码：
   0：返回

}
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T15:15:41.453

好吧，你必须使用预处理器，但它仍然是一种丑陋的。

只需在编译之前预处理您的源代码。`cpp`例如，使用。

据说 javac 有时可能会在死条件分支中丢弃语句，包括静态最终布尔值，例如

```
private static final DEBUG = false;

if(DEBUG) System.err.println("Entered"); 
```

但我不确定，我建议您尝试一下并检查字节码是否包含该调用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T15:23:52.743

是必须从标准版本中删除日志记录语句的问题，还是不能启用它们？

如果只是后者，那么就像其他答案提到的那样，只需将您的日志语句包装在 if-check 中。

无论您做什么，都不要继续在项目中复制/粘贴您的代码 - 自动执行手动工作。节省自己的时间。

# c# - 如何捕获（并希望修复）GDI 资源泄漏

> ID：869266
> 
> 赞同：4
> 
> 时间：2009-05-15T15:13:18.743
> 
> 标签：c#, user-interface, gdi, resources, memory-leaks

我的应用程序在运行 6 小时后记录了一个异常：

操作系统版本：Microsoft Windows NT 5.1.2600 Service Pack 3 (5.1.2600.196608)

.NET 版本：2.0.50727.3082

SQL Server 版本：9.00.4035.00

SQL Server 级别：SP3

SQL Server 版：标准版

错误消息：参数无效。

异常类型：System.ArgumentException

来源：System.Drawing

```
Stack Trace: 
at System.Drawing.Graphics.GetHdc()
at System.Windows.Forms.ImageList.GetBitmap(Int32 index)
at System.Windows.Forms.ImageList.ImageCollection.get_Item(Int32 index)
<<< MY code >>> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T19:12:03.037

最近我创建了一个简单的类，它[`GetGuiResources()`](http://msdn.microsoft.com/en-us/library/ms683192(VS.85).aspx)在构造函数和析构函数中调用函数并报告 GDI 对象计数的任何差异。在一些函数中使用它作为作用域对象帮助我在代码中堵住了 GDI 泄漏。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T18:47:56.700

[GDIView](http://www.nirsoft.net/utils/gdi_handles.html)为我工作。它指出了字体泄漏。我搜索了 ToHfont()。剩下的就是历史了。

# asp.net - 让 ASP.NET 无 Cookie 会话和 JQuery AJAX 很好地协同工作

> ID：869268
> 
> 赞同：6
> 
> 时间：2009-05-15T15:13:55.730
> 
> 标签：asp.net, jquery, ajax, cookies, session-state

我有一个使用 JQuery AJAX 的网站。使用这个 JQuery 代码

```
$.post("/ajax/getsomedata.aspx", {'id': id }, 
    function(data) 
    {
        dosomething(data);
    }
); 
```

当我使用**cookieless="false"**运行它时， **id**会显示在**Request.Form**中。当我设置**cookieless="true"**时，**id**不再在**Request.Form**中。

**更新，我做了什么**

我添加了对 Response.ApplyAppPathModifier() 的调用以保留数据并避免自动重定向。我排除了 **Diago(( 并删除了我自己的，因为他的引用提供了一些关于正在发生的事情的现场信息。我喜欢单独域的想法，但我不能在这里这样做。

这是更新的代码：

```
$.post("<%=Response.ApplyAppPathModifier("/ajax/getsomedata.aspx")%>", 
        {'id': id },
    function(data)     
    {        
        dosomething(data);    
    }
); 
```

根据[MSDN](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.applyapppathmodifier.aspx) **Response.ApplyAppPathModifier()**如果您处于无 cookie 会话状态，则添加会话 ID，如果不是，则返回未更改的 URL。

由于没有会话 ID，ASP.NET 创建一个新会话并进行重定向（从而剥离任何表单数据）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T17:31:58.630

我最近在同样的问题上苦苦挣扎。这是使用无 cookie 会话的四个缺点之一。请求在访问服务器时被重写，请求变量被删除。当使用 WebServices 和使用 ASP.Net 的 POST 请求时，这可能会非常痛苦。这在使用 GET 时效果很好。

使用普通帖子您将遇到类似的问题。[这里](http://www.developer.com/net/asp/article.php/2216431)有一篇文章解释了它是如何完成的。[这篇](http://msdn.microsoft.com/en-us/library/aa479314.aspx)MSDN 文章还详细讨论了这些缺点。

最好的解决方案是将您的服务放在不使用无 cookie 会话的单独域或 IIS 虚拟站点上。

将表单身份验证与无 cookie 会话一起使用也是一个有趣的挑战。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-28T16:00:23.620

我浪费了一整天的时间来解决这个问题，而这只是一个快速解决方案。

在`PageMethod`调用期间，会话 ID 没有与请求 URL 一起传递，因此`session_start`会触发一个新事件。我们只需要在调用 a 之前设置确切的请求路径`pagemethod`，这样新的会话开始事件就不会被触发。

```
if ('<%= HttpContext.Current.Session.IsCookieless %>==True') {
    //need to pass session id in request path
    PageMethods.set_path('<%= System.Web.Configuration.WebConfigurationManager.AppSettings("WebRoot") %>(S(<%=Session.SessionID%>))/secure/PageName.aspx');
}
PageMethods.PageMethodName(param1,param2, CallSuccess, CallFailed); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T15:21:58.473

您必须在请求中包含会话令牌。ASP.Net 必须将其添加到 url 或隐藏的表单字段中。抓住它并添加它 jquery 参数对象。据我所知，因为我从未在 ASP.NET 中编写过代码

# c# - 如何在不暴露物理路径的情况下在线提供可下载文件？

> ID：869269
> 
> 赞同：8
> 
> 时间：2009-05-15T15:13:58.103
> 
> 标签：c#, php, asp-classic

我正在提供要求用户在下载前注册的文件。目前，一旦您注册并登录，文档的链接将显示为：

```
myurl.com/docs/mypdf.pdf 
```

因此，任何登录的人都可以看到文档的物理路径。隐藏文档的物理路径以使注册用户无法与未注册用户共享直接链接或在其他地方发布指向文档的直接链接的最佳做法是什么？

**编辑：**我只是在寻找一个与语言无关的想法，所以我选择了一些我最喜欢的语言作为标签。这种情况下的实际实现是 ASP 经典的。我目前正在使用一个下载包装脚本，该脚本在重定向到实际文档 URL 之前确认用户已登录。为了简单起见，我只是没有将它包含在我的问题中。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-15T15:18:52.567

不要那样做。而是将文件保存在文档树之外的某个位置，然后使用脚本（例如，php、.Net 等）使它们可访问

该脚本可以检查他们是否已登录，验证他们是否被允许访问该文件，如果允许则返回它。他们去的路径可能看起来更像这样... /download.php?file=mypdf.pdf

类似于...的东西

```
<?php
if (IsUserLoggedIn())
    readfile('/secret/path/to/file/mypdf.pdf');
?> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-15T15:17:49.013

最好的方法是从非 Web 可访问路径读取文件并将其写入输出流。

这似乎在您似乎正在使用的 php 中显示了一个好的示例？只需将安全检查添加到 php 顶部，如果它们未经授权，则将它们踢出。

[http://www.higherpass.com/php/Tutorials/File-Download-Security/](http://www.higherpass.com/php/Tutorials/File-Download-Security/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-18T17:10:32.320

很多个月前，我在经典 ASP 中遇到了类似的问题。

将文件保存在 webroot 之外的目录中。

验证后，通过 ADODB.Stream 发送文件，然后检查文件扩展名以确保我设置了正确的 mime 类型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T15:17:56.470

最好的方法是使用 php/asp 或服务器端脚本文件来读取文档一个外部不可用的位置

然后该文件可以检查用户是否已登录，它还可以隐藏物理文件的路径

所以网址是 www.yourwebsite.com/file.php?file=image.png

file.php 将验证用户是否已登录，然后它将读取文件或将其重定向到登录页面

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T15:24:20.870

您要做的是创建一个 PHP 页面，该页面执行两件事：

1.  验证发出请求的用户
2.  将文件流式传输到客户端

此[链接](http://www.php.net/stream)将有助于流。这段代码可能会有所帮助：

```
header("Content-Disposition: attachment; filename=$name of pdf that you want to download");
header("Content-Type: application/pdf");
header("Content-Length: ".filesize("$location of pdf/$name of pdf that you want to download"));
header("Pragma: no-cache");
header("Expires: 0");
$fp=fopen("$location of pdf/$name of pdf that you want to download","r");
print fread($fp,filesize("$location of pdf/$name of pdf that you want to download"));
fclose($fp);
exit(); 
```

[在此处](http://www.webmasterworld.com/forum88/3765.htm)的讨论中看到了这一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-15T15:18:28.030

不清楚您使用的是 ASP.NET、ASP.NET MVC 还是其他东西。不过，这个帖子...

[如何呈现文件以从 MVC 控制器下载？](https://stackoverflow.com/questions/730699/asp-net-mvc-how-do-i-code-for-pdf-downloads)

...展示了如何使用 ASP.NET 以编程方式将文件返回给用户（问题显示 ASP.NET 方式，答案显示 MVC 方式）。

这将允许物理文件位于用户无法访问的文件夹中，并允许您在返回文档之前添加验证以确保用户已注册等。

如果您正处于使用 ASP.NET MVC 为时不晚的开发阶段，那么就这样做吧。这个场景（提供一个文件）变成了一个单行，还有很多其他的事情会更容易（特别是你的应用程序的测试）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T15:19:47.027

您可以在 .net 中使用[IHttpHandler](http://msdn.microsoft.com/en-us/library/system.web.ihttphandler.aspx)，尽管您需要在 IIS 中进行通配符访问。您可以使用基于会话的处理程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-15T15:32:46.573

1.  使用脚本进行访问控制

    制作一个类似 myurl.com/file.php?docs/mypdf.pdf 的脚本，用于检查用户是否有权访问该文件。该脚本将从网络不可见的地方获取文件。

2.  （可选）使用 mod_rewrite 使您的 url 看起来不错，并将用户重定向到 file.php 脚本。就像是：

    RewriteCond docs/%{REQUEST_FILENAME} !-f

    RewriteRule ^(.*)$ file.php/$1 [QSA,L]

    这会将 /docs/mypdf.pdf 重定向到 /file.php?docs/mypdf.pdf 但对用户来说看起来更好。

# powershell - 如何使用 & 运算符从 PowerShell 调用 MSBuild？

> ID：869278
> 
> 赞同：35
> 
> 时间：2009-05-15T15:15:32.077
> 
> 标签：powershell

我刚刚在 PowerShell v1.0 上对此进行了测试。设置如下：

```
 Id CommandLine
 -- -----------
  1 $msbuild = "C:\Windows\Microsoft.NET\Framework\v3.5\msbuild.exe"
  4 $a = "C:\some\project\or\other\src\Solution.sln /target:Clean /target:Build" 
```

.

**此行失败并显示不直观的错误消息：**

```
 Id CommandLine
 -- -----------
  5 & $msbuild $a 
```

.

**此行失败，因为 & 期望第一个参数是命令本身。**

```
 Id CommandLine
 -- -----------
 10 & "$msbuild $a" 
```

.

**这条线有效：**

```
 Id CommandLine
 -- -----------
 16 cmd /c "$msbuild $a" 
```

.

请解释。我对 & 语法为什么不起作用比特定于 MSBuild 的解决方法更感兴趣。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-05-15T17:13:55.147

啊。

```
$collectionOfArgs = @("C:\some\project\or\other\src\Solution.sln", 
    "/target:Clean", "/target:Build")
& $msbuild $collectionOfArgs 
```

这行得通。& 接受参数集合，因此您必须将包含多个参数的字符串拆分为字符串参数集合。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-05-16T03:19:37.063

您看到的问题来自 PowerShell 解析参数。在第一个示例中，当 PowerShell 看到 $a 时，它会将其作为单个参数 msbuild 传递。我们可以使用[PSCX](http://pscx.codeplex.com)中的 echoargs 实用程序看到这一点：。

```
PS> $a = "C:\some\project\or\other\src\Solution.sln /target:Clean /target:Build"
PS> & echoargs $a
Arg 0 is <C:\some\project\or\other\src\Solution.sln /target:Clean /target:Build> 
```

第二个例子更糟糕，因为你告诉 powershell 调用 "$echoargs $a" 作为命令名，它不是一个有效的命令名。

第三行有效，因为 CMD.exe 将 "$echoargs $a" 的扩展形式作为解析并执行的单个参数：

您在这里有几个选择。首先我这样做：

```
PS> & $msbuild C:\some\project\or\other\src\Solution.sln `
    /target:Clean /target:Build 
```

另一种选择是像这样使用 Invoke-Expression：

```
PS> Invoke-Expression "$msbuild $a" 
```

一般来说，我尝试对 Invoke-Expression 非常小心，特别是如果被调用的字符串的任何部分是由用户提供的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-03-12T22:52:24.297

您也可以尝试使用免费的[Invoke-MsBuild powershell script/module](https://github.com/deadlydog/Invoke-MsBuild)。这实质上为您提供了一个可以调用的 Invoke-MsBuild PowerShell cmdlet，而不是尝试自己手动调用 msbuild.exe。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-11-21T00:42:14.233

这对我很有效：

```
PS> cmd.exe /c 'C:\Windows\Microsoft.NET\Framework\v3.5\msbuild.exe' /target:Clean /target:Build 'C:\some\project\or\other\src\Solution.sln' 
```

# c++ - 从构造函数初始化列表传递 this

> ID：869281
> 
> 赞同：10
> 
> 时间：2009-05-15T15:16:07.067
> 
> 标签：c++

在以下代码中将“this”传递给初始化程序列表中的另一个对象时是否有任何问题？

```
class Callback { public: virtual void DoCallback() = 0; }; 

class B
{
    Callback& cb;
public:
    B(Callback& callback) : cb(callback) {}
    void StartThread();

    static void Thread() 
    {
        while (!Shutdown())
        {
            WaitForSomething();
            cb.DoCallback();
        }
     }
};

class A : public Callback
{
    B b;
public:
    A() : b(*this) {b.StartThread();}
    void DoCallback() {} 
}; 
```

如果这样做不安全，那么最好的选择是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-15T15:20:13.827

如果您**非常**小心，这将正常工作。如果你开始调用虚方法或使用依赖于类型中其他对象的方法，你会遇到很多麻烦。但是，如果您只是设置参考，这应该可以正常工作。

更安全（但不是完全安全）的替代方法是在构造函数完成后稍后设置 b 。这不会消除 vtable 问题，但会消除在构造之前访问其他成员变量等问题。

```
class A : public Callback {
  std::auto_ptr<B> spB;
public:
  A() {
    spB.reset(new B(this));
    spB->StartThread();
  }
}; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-15T15:21:23.857

如果另一个类只存储指针/引用，就像你的情况一样，它是安全的。但是您必须确保您传递给的构造函数/函数不会在的构造函数完成`this`之前尝试访问引用的对象。`A`该`A`对象尚未完全构造，调用属性的方法`A`和访问属性可能会导致未定义的结果。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-15T15:21:38.927

如果您只是将指针存储起来以备后用，它通常是安全的。我已经做到了。我不会做以下任何事情：

*   使用它来访问基类或派生类数据（它们可能没有运行它们的构造函数）
*   做任何多态的事情，vtable 可能不会被初始化。

[这](http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.7)是 C++ FAQ 中的一篇很棒的文章，详细介绍了构造函数中“this”的问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-15T18:38:39.310

在仍在构造对象中运行代码的构造函数中启动线程是危险的。您提供的代码将按原样正常工作，但解决方案很脆弱。

如果`DoCallback`在其中调用虚拟方法，`A`则最终可能会出现意外结果，具体取决于线程运行的速度。如果被调用的方法是纯虚拟的，那么应用程序将会死掉，如果它不是纯的，那么`A`将调用方法的版本而不是派生的版本。这与你永远不应该从构造函数调用虚方法的原因完全相同。

更安全的方法是让用户调用线程。这也是 boost::thread 库和即将推出的标准中的方法。创建并初始化将要执行的对象，然后将其传递给正在运行的线程：

```
class Worker
{
public:
   void DoWork();
};
void startWorkerThread()
{
   Worker w; // fully create the object that is going to be run before you...
   boost::thread thr( boost::bind( &Worker::DoWork, &w ) ); // ...create thread and run
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-15T15:23:57.343

只要您记住该`this`对象尚未完全构建，它就足够安全了。如果您的`B`类只存储指针，而不在构造函数中调用任何函数，那么您是安全的。如果您尝试从 B 的构造函数访问指针，则必须非常小心并注意初始化 A 的成员的顺序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-15T15:20:28.867

只要确保引用仍然有效，这与称为双重调度的习语非常相似。在这种情况下，这可能有点矫枉过正，但它本质上并没有错。

# flash - 如何用 Flash 识别声音（例如拍手）？

> ID：869291
> 
> 赞同：0
> 
> 时间：2009-05-15T15:17:46.830
> 
> 标签：flash, speech-recognition

识别我的网站访问者是否刚刚拍了两次手的最简单方法是什么？

我的想法：如果用户允许，Flash 能够使用麦克风。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T15:28:42.763

请至少看看这个关于 Flash 和麦克风的[教程。](http://www.kirupa.com/developer/actionscript/microphone.htm)

# sql - SQL Server 2008 变更数据捕获，谁进行了变更？

> ID：869300
> 
> 赞同：9
> 
> 时间：2009-05-15T15:18:55.967
> 
> 标签：sql, sql-server-2008, auditing, cdc

大约一周前，我在 SOF 上问了一个关于审计 SQL 数据更改的问题。出现了关于使用触发器的常见内容，在 SQL Server 2008 中也提到了 CDC。

我今天一直在尝试它，到目前为止一切都很好，我看不到它支持的一件事是跟踪谁实际进行了更改。谁执行了声明？

我很想知道是否有人使用 CDC 进行审计，以及您如何跟踪谁进行了更改？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-08-20T17:00:23.187

我直接使用更改了 CDC 表： **ALTER TABLE cdc.dbo_MyTable_CT ADD UserName nvarchar(50) NULL DEFAULT(SUSER_SNAME())**

顺便说一句，您不需要日期信息，因为它已经在开始和结束 LSN 字段中。

我唯一的问题是我的用户通过允许他们修改权限的 Windows 组登录，但用户名字段始终是我的用户名而不是他们的用户名。我还没有找到解决这个问题的方法。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2017-02-22T12:21:58.557

更改数据捕获不会跟踪进行更改的用户、机器或更改时间。

跟踪使用 CDC 进行更改的用户的最佳解决方案是创建一个新字段来存储用户详细信息，该字段将在每次更改时更新（在[此处](http://solutioncenter.apexsql.com/analyzing-and-reading-change-data-capture-cdc-records/)找到该想法）。

同一系列中的另一篇文章将我引向第三方工具，该工具提供了开箱即用的解决方案。我仍在评估过程中，但到目前为止看起来还不错。[您可以在本续集](http://solutioncenter.apexsql.com/auditing-sql-server-data-changes-the-centralized-solution/)末尾的方便表格中查看跟踪信息的比较。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-26T17:05:01.450

Edmundo 先生，在我看来，CDC 还没有准备好迎接黄金时段。目前，在启用 CDC 的情况下从 Visual Studio 部署数据库项目似乎有些困难（它不喜欢 DDL 更改）。此外，CDC 似乎有一个内置的数据生命周期结束清理过程，所以如果你真的想长期维护你的审计历史，这对你来说可能是个糟糕的时期。

另外，如果我误解了，请纠正我，但似乎 SQL 审计适用于审计 SQL Server 中发生的大量事件，例如登录失败、DDL 更改等。

Change Tracking 仅适用于 DDL 而不是 DML，因此您不走运。

如果您的意图确实是捕获从表中更新或删除的“旧”记录，那么最好的答案似乎仍然是在 dbo.TableName 上创建 Audit.TableName 和 update+delete 触发器。还要确保 TableName 包含 CreatedBy DEFAULT SUSER、CreatedDate DEFAULT getdate()、ModifiedBy、ModifiedDate 列。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-17T02:50:54.627

CDC 确实不是为审计而设计的。如果您正在寻找审计功能，您应该使用[SQL Server Audit](http://msdn.microsoft.com/en-us/library/cc280386.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-04T15:58:10.227

虽然并不理想，但普遍的共识似乎是 CDC 不会捕获谁进行了更改，但我们已经实现了 CreatedBy/Date 和 UpdatedBy/Date 列，可用于查看谁触发了更改。当然，为此，更新行的 SP 或 SQL 语句需要分别使用 suser_name() 和 getDate() 显式设置 UpdatedBy/Date 字段。我同意开箱即用会很好，这会让 CDC 做一些本不该做的事情，但我也在尝试使用 CDC 来异步审计数据更改，而不是使用传统的触发器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-02-17T11:58:12.690

这是一个触发器，可以通过一些自动化过程或在该特定表上启用 CDC 时手动创建，此触发器将解决**谁**和**从何处进行**更改的问题：

```
CREATE TRIGGER TR_TABLENAME_CDC 
ON TABLENAME
FOR INSERT, UPDATE, DELETE 
AS
DECLARE           
       @SessionID int,
       @AppName nvarchar(255),
       @HostName nvarchar(255),
       @UserName nvarchar(32)
BEGIN
    SELECT @SessionID=@@SPID
    SELECT @AppName=program_name, @HostName=host_name from sys.dm_exec_sessions where session_id = @SessionID

    IF(@AppName = 'BLAH BLAH' OR @AppName = 'XYZ' OR @AppName = 'ABC')
    BEGIN
        SELECT @UserName=login_name from sys.dm_exec_sessions where session_id = @SessionID
        INSERT INTO UserDetail (SessionID, AppName, HostName, UserName) VALUES (@SessionID, @AppName, @HostName, @UserName)
    END 
END 
```

# ruby-on-rails - 杂种怎么了？Windows上有什么替代品吗？

> ID：869305
> 
> 赞同：7
> 
> 时间：2009-05-15T15:19:50.227
> 
> 标签：ruby-on-rails, ruby, windows, mongrel

我刚刚看到mongrel的最后一次更新是大约一年前...

[http://mongrel.rubyforge.org/wiki/WikiStart?action=diff&version=35](http://mongrel.rubyforge.org/wiki/WikiStart?action=diff&version=35)

它已经停产了吗？

Windows开发盒还有其他轻量级的替代品吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-15T17:14:16.517

由于 mongrel 已经很长时间没有更新了，所以某些功能，例如 --prefix 不再适用于最常见的 rails 版本（2.3+）

我建议改用[瘦服务器](http://code.macournoyer.com/thin/)，因为它似乎是 mongrel 的自然演变，并且项目维护人员正在积极开发它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-20T17:45:32.507

Mongrel 在 Windows 和其他操作系统的生产环境中运行良好。它没有被开发 b/c 它适用于大多数情况。在 mongrel-users listserv 上仍然会定期讨论修复这个或那个极端情况。但我对 mongrel 的体验是它的效果很好。

我不久前也测试过瘦，它也很好用。我确实发现了一个缓存错误，但维护者很快发布了一个修复程序，这很好。我想如果你在 Mongrel 中发现了一个 bug，当前的维护者也会很快修复它。

我在这里对瘦与杂种进行了比较：

[http://www.misuse.org/science/2008/04/07/thin-vs-mongrel-a-ruby-on-rails-performance-shootout/](http://www.misuse.org/science/2008/04/07/thin-vs-mongrel-a-ruby-on-rails-performance-shootout/)

还有另一个研究各种流水线技术（nginx 公平代理模块与 unix 套接字）。Thin 似乎在重负载下表现出一些奇怪的集群行为——但现在可以修复了。

[http://www.misuse.org/science/2008/04/07/thin-ruby-on-rails-nginx-fair-proxy-performance-testing/](http://www.misuse.org/science/2008/04/07/thin-ruby-on-rails-nginx-fair-proxy-performance-testing/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T15:35:13.683

原作者 Zed Shaw 不再维护它，但它仍然适合在工作站上部署 rails 应用程序作为 webrick 的替代品（Rails 默认设置）。

如果您没有将 Windows 用作生产环境，我建议您设置一个配置了您的生产服务器的 rails 引擎的 VM。

# gcc - 在 gcc 和 g++ 中选择消息语言

> ID：869309
> 
> 赞同：32
> 
> 时间：2009-05-15T15:20:02.860
> 
> 标签：gcc, localization, g++

我在 Linux 上使用`gcc`/`g++`并且因为我的安装是西班牙语（我的母语），所以会用西班牙语`gcc`打印警告和错误。我宁愿用英文阅读它们，原因有两个：

1.  用谷歌搜索英文消息要容易得多。
2.  西班牙语翻译或多或少是可怕的。

有什么帮助吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-15T15:26:20.583

GCC 手册页的末尾包含对其语言环境变量的概述：

> *   朗
> *   LC_CTYPE
> *   LC_MESSAGES
> *   LC_ALL
> 
> 这些环境变量控制 GCC 使用本地化信息的方式，允许 GCC 使用不同的国家惯例。GCC 会检查语言环境类别`LC_CTYPE`以及`LC_MESSAGES`是否已对其进行配置。这些语言环境类别可以设置为您的安装支持的任何值。典型值为 en_GB.UTF-8 表示以 UTF-8 编码的英国英语。
> 
> `LC_CTYPE`环境变量指定字符分类。GCC 使用它来确定字符串中的字符边界；这对于一些包含引号和转义字符的多字节编码是必需的，否则这些字符将被解释为字符串结尾或转义。
> 
> `LC_MESSAGES`环境变量指定在诊断消息中使用的语言。
> 
> 如果`LC_ALL`设置了环境变量，它会覆盖 LC_CTYPE 和`LC_MESSAGES`; 否则，`LC_CTYPE`默认`LC_MESSAGES`为 LANG 环境变量的值。如果没有设置这些变量，GCC 默认为传统的 C 英语行为。

我这样做：

```
LC_MESSAGES=C gcc-command-here 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-05-15T15:26:17.090

尝试更改`LANG`环境变量： http: [//gcc.gnu.org/onlinedocs/gcc-4.4.0/gcc/Environment-Variables.html#Environment-Variables](http://gcc.gnu.org/onlinedocs/gcc-4.4.0/gcc/Environment-Variables.html#Environment-Variables/)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-01-03T21:34:30.060

要将 gcc 翻译更改为英文，必须将环境变量 LANG 设置为英文：

$ 出口 LANG=en

将其添加到您的 .profile 文件中，它将始终为英文

# matlab - 在 PARFOR 循环中不必要地覆盖重复项

> ID：869311
> 
> 赞同：0
> 
> 时间：2009-05-15T15:20:15.387
> 
> 标签：matlab

在 MATLAB 中，下面的第一组循环说明了重复项，但第二组循环（使用 PARFOR）没有。它们覆盖以前的值。我们如何解决这个问题？

对于循环：

```
for d = 1:length(set),
  for k = 1:length(dset),
    if strcmp(pset(k),set(d)),
      t(h,p) = dset(k);
      h = h+1;
    end
  end
end 
```

PARFOR 循环：

```
parfor d = 1:length(set),
  for k = 1:length(dset),
    if strcmp(pset(k),set(d)),
      t(d) = dset(k);
    end
  end
end 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T17:28:45.157

几点...

1.  **错别字**：你确定你应该使用变量**pset**，还是你的意思是使用**dset**？此外，在第一组循环中有一个未定义的变量**p 。**第一组循环中的代码应该如下所示吗？：

    ```
    t(h) = dset(k);
    h = h+1; 
    ```

2.  您在每组循环中都没有做同样的事情。您是否尝试过更换线路：

    ```
    t(d) = dset(k); 
    ```

    用我上面写的两行？

3.  我不禁注意到，这些循环组中的每一个都可以使用[ISMEMBER](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/ismember.html)函数替换为矢量化解决方案。根据您上面的代码，我相信这应该完成同样的事情：

    ```
    t = dset(ismember(pset,set)); 
    ```

    或者，如果**pset**实际上应该是**dset**：

    ```
    t = dset(ismember(dset,set)); 
    ```

    此外，命名您的变量之一不是一个好主意**set**，因为已经有一个内置函数称为：[SET](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/set.html)。

# sql-server-2005 - 将文件添加到全文索引而不将它们存储为 blob

> ID：869312
> 
> 赞同：0
> 
> 时间：2009-05-15T15:20:15.623
> 
> 标签：sql-server-2005, full-text-search

有没有办法将文件添加到 sql server 索引而不将它们作为 blob 添加到数据库中？目前，我们确实使用 pdf2text 提取所有 pdf 文件的文本内容并将它们存储为 blob。这样，sql server 可以将文本添加到他的索引中。但这是对空间的极大浪费。我们使用的是sql server 2005。sql server 2008的新文件流类型可以处理这个吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-17T01:03:20.470

是的，根据规范全文索引适用于文件流列。请参阅[http://msdn.microsoft.com/en-us/library/bb895334.aspx#FullText](http://msdn.microsoft.com/en-us/library/bb895334.aspx#FullText)： *全文索引与 FILESTREAM 列的工作方式与 varbinary(max) 列相同。FILESTREAM 表必须有一列包含每个 FILESTREAM BLOB 的文件扩展名*

# asp.net - 尝试执行存储过程时出现无效的对象名称错误？

> ID：869315
> 
> 赞同：3
> 
> 时间：2009-05-15T15:20:47.743
> 
> 标签：asp.net, sql-server, stored-procedures

不知道交易是什么我有存储过程命名正是我调用的但是它总是给我这个无效的对象错误。这是连接代码，错误在倒数第二行引发。

```
SqlConnection cnstr = new SqlConnection(ConfigurationManager.ConnectionStrings["darconn"].ConnectionString);
SqlCommand sqlcmd = new SqlCommand();

sqlcmd.CommandType = CommandType.StoredProcedure;
sqlcmd.Connection = cnstr;
sqlcmd.CommandText = "SetMapping";

String[] pullKodID = bundlelist.SelectedValue.ToString().Split(':');
int kod_id = System.Convert.ToInt32(pullKodID[0]);

sqlcmd.Parameters.Add("@kod_id", kod_id);
sqlcmd.Parameters.Add("@ell_id", courselist.Items[i].Text);
cnstr.Open();
sqlcmd.ExecuteNonQuery();
cnstr.Close(); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T15:23:08.377

`dbo`很可能存储过程对您的代码不可见，因为它是由连接字符串中指定的用户以外的用户创建/拥有的。

您是否尝试过为存储过程名称添加前缀`dbo`？例如“dbo.SetMapping”。

如果做不到这一点，请使用 Management Studio/Enterprise Manager 找出谁拥有存储过程，然后将其重新创建为`dbo`或更新您的代码/连接字符串以使用适当的用户。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-01-18T06:57:03.183

我遇到了同样的问题，结果发现我在 [master] 数据库中创建了存储过程，而不是我应该处理的那个。可能不是您的问题，但需要注意。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T15:34:34.573

sql 探查器显示什么？

你可以在应用程序的上下文之外执行吗？来自 mgt studio 或 qry 分析仪？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T15:47:35.573

检查存储过程中表名的拼写。

保存存储过程时，它会检查所用表中的字段名称，但可以保存使用不存在（或拼写错误）的表名的存储过程。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T15:49:45.333

检查存储过程以查看它是否由“dbo”拥有，因此名称将是“dbo.SetMapping”而不是“SomeUser.SetMapping”之类的名称

我还将明确指定“dbo”。在名字里

```
sqlcmd.CommandText = "dbo.SetMapping"; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-15T15:35:38.113

你确定你输入的名字正确吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T16:34:08.907

这是一个长镜头，但已经列出了常见的答案。

很少有脚本可以在目录中获得与脚本中不同的名称。我相信这可能会导致类似于您所看到的问题。

以下脚本将检查您的数据库以查看目录中是否有与脚本不匹配的项目。（您需要 SQL 2005 或更高版本才能正常工作）

```
-------------------------------------------------------------------------
-- Check Syntax of Database Objects
-- Copyrighted (2009).  Free to use as a tool to check your own code or in 
--  any software not sold. All other uses require written permission from Author
-- Author: Stephen Schaff
-------------------------------------------------------------------------
-- Turn on ParseOnly so that we don't actually execute anything.
SET PARSEONLY ON 
GO

-- Create a table to iterate through
declare @ObjectList table (ID_NUM int NOT NULL IDENTITY (1, 1), OBJ_NAME varchar(255), OBJ_TYPE char(2))

-- Get a list of most of the scriptable objects in the DB.
insert into @ObjectList (OBJ_NAME, OBJ_TYPE)
SELECT   name, type
FROM     sysobjects WHERE type in ('P', 'FN', 'IF', 'TF', 'TR', 'V')
order by type, name

-- Var to hold the SQL that we will be syntax checking
declare @SQLToCheckSyntaxFor varchar(max)
-- Var to hold the name of the object we are currently checking
declare @ObjectName varchar(255)
-- Var to hold the type of the object we are currently checking
declare @ObjectType char(2)
-- Var to indicate our current location in iterating through the list of objects
declare @IDNum int
-- Var to indicate the max number of objects we need to iterate through
declare @MaxIDNum int
-- Set the inital value and max value
select  @IDNum = Min(ID_NUM), @MaxIDNum = Max(ID_NUM)
from    @ObjectList

-- Begin iteration
while @IDNum <= @MaxIDNum
begin
  -- Load per iteration values here
  select  @ObjectName = OBJ_NAME, @ObjectType = OBJ_TYPE
  from    @ObjectList
  where   ID_NUM = @IDNum 

  -- Get the text of the db Object (ie create script for the sproc)
  SELECT @SQLToCheckSyntaxFor = OBJECT_DEFINITION(OBJECT_ID(@ObjectName, @ObjectType))

  begin try
    -- Run the create script (remember that PARSEONLY has been turned on)
    EXECUTE(@SQLToCheckSyntaxFor)
  end try
  begin catch
    -- See if the object name is the same in the script and the catalog (kind of a special error)
    if (ERROR_PROCEDURE() <> @ObjectName)
    begin
      print 'Error in ' + @ObjectName
      print '  The Name in the script is ' + ERROR_PROCEDURE()+ '. (They don''t match)'
    end

  end catch

  -- Setup to iterate to the next item in the table
  select  @IDNum = case
            when Min(ID_NUM) is NULL then @IDNum + 1
            else Min(ID_NUM)
          end  
  from    @ObjectList
  where   ID_NUM > @IDNum

end
-- Turn the ParseOnly back off.
SET PARSEONLY OFF 
GO 
```

（作为旁注，如果您想查看数据库中的所有错误，请在`if (ERROR_PROCEDURE() <> @ObjectName)`块后添加。）

```
else if (ERROR_MESSAGE() <> 'There is already an object named ''' + ERROR_PROCEDURE() + ''' in the database.')
begin
  -- Report the error that we got.
  print 'Error in ' + ERROR_PROCEDURE()
  print '  ERROR TEXT: ' + ERROR_MESSAGE() 
end 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-15T21:05:26.010

数据库是否使用区分大小写的排序规则？如果是这样，您的 C# 代码中的情况是否与数据库中的情况相同？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-07-07T09:09:10.120

它抱怨的实际对象的名称是什么？我在存储过程中看到了同样的问题，实际上存储过程本身没有问题 - 但由于拼写错误，存储过程中使用的表的名称是错误的（存储过程名称被意外粘贴为表名），因此它返回了与存储过程名称匹配的无效对象名称错误 - 这非常令人困惑。

尝试更改存储过程名称并从代码中再次调用它，看看会发生什么 - 或尝试直接在 SQL Management Studio 中运行存储过程。

如果这不起作用，那么要非常有条理，分而治之——回到基础，再次端到端检查所有内容。连接字符串是否正确，它在运行时连接到什么数据库，什么用户 id，sproc 在 Sql management studio 中是否独立工作等

希望有帮助。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-12-07T21:27:05.767

对于它的价值，我在 .NET 4 上遇到了一个完全不同的问题，它产生了相同的异常，几乎没有有用的信息来诊断它。

我更新了我的 DBML 中的几个表。我可能已经重新加载了一个存储过程，但我不记得这样做了。

我在designer.cs中留下了以下sproc包装器：

```
[global::System.Data.Linq.Mapping.FunctionAttribute(Name="dbo.GetSomeInformation", IsComposable=true)]
public IQueryable<GetSomeInformationResult> GetSomeInformation([global::System.Data.Linq.Mapping.ParameterAttribute(DbType="BigInt")] System.Nullable<long> infoId)
{
    return this.CreateMethodCallQuery<GetSomeInformationResult>(this, ((MethodInfo)(MethodInfo.GetCurrentMethod())), infoId);
} 
```

`CreateMethodCallQuery`旨在调用表值函数，而不是存储过程。我很困惑为什么它会改变这一点。我将其恢复为使用`ExecuteMethodCall`：

```
[global::System.Data.Linq.Mapping.FunctionAttribute(Name="dbo.GetSomeInformation")]
public ISingleResult<GetSomeInformationResult> GetSomeInformation([global::System.Data.Linq.Mapping.ParameterAttribute(DbType="BigInt")] System.Nullable<long> infoId)
{
    IExecuteResult result = this.ExecuteMethodCall(this, ((MethodInfo)(MethodInfo.GetCurrentMethod())), infoId);
    return ((ISingleResult<GetSomeInformationResult>)(result.ReturnValue));
} 
```

一切都很好。很奇怪。

更新：这似乎是由于 Visual Studio 在将存储过程添加到 dbml 时决定存储过程是表值函数引起的。我以前从未见过这种情况。

“IsComposable”标志似乎是它区分存储过程和表值函数的唯一方法。一旦我从 dbml 中的 Function 节点清除了标志，Visual Studio 就会在设计器文件中生成正确的代码。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-06-27T23:30:27.070

首先确保您的存储过程实际上在.net 之外工作。如果它工作得很好，那么请考虑以下...

如果引用的对象工作正常，则此错误可能会产生误导，请检查您在同一页面上使用的其他存储过程是否存在对“对象”的无效引用

原因是它可能在您在同一页面上运行的**完全独立的损坏存储过程中引用了 SQL 错误。**例如，假设您有一个存储过程来获取表的内容；如果您错误地将*表*与*存储过程*（而不是存储过程引用的表）连接到同一页面上的另一个存储过程中，则会引发此错误。这可能会令人困惑，因为您知道引用的存储过程可以正常工作！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-02-11T03:04:49.717

我在过程中输入了错误的表名，这就是我收到该错误的原因。

示例：有一个`test2`在过程中命名的表，其中包含表中的字段`test`。它看起来像：

`insert into test2 (fields from test) values`...

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-06-06T13:38:09.717

我有类似的问题。我忘了写到我的实际数据库的完整路径。所以你必须写 select *From [your databasename].[dbo].[object name] 在我的例子中是一个实际命名数据库中的表对象所以，select *from [practical].[dbo].[employee]同样的逻辑也适用于存储过程

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-10-19T16:40:18.427

每次我尝试使用 ADO.Net 在 SQL 表中插入某些数据时，也会出现同样的错误。后来，当我尝试直接在 SQL Server 中执行相同的命令时，我发现表上的触发器阻止了这种情况。所以也检查一下。

# perl - Perl DBI 动态 fetchrow while 循环

> ID：869316
> 
> 赞同：3
> 
> 时间：2009-05-15T15:20:48.477
> 
> 标签：perl, dynamic, loops, dbi, while-loop

我试图将表名传递给一个获取该表的所有字段名的子程序，将它们存储到一个数组中，然后将该数组与另一个 sql 查询的 fetchrow 结合使用以显示这些字段中的数据。这是我现在拥有的代码：

以表名作为参数的子调用示例：

```
shamoo("reqhead_rec");
shamoo("approv_rec");
shamoo("denial_rec"); 
```

洗发水子：

```
sub shamoo
{
    my $table = shift;
    print uc($table)."\n=====================================\n";

    #takes arg (table name) and stores all the field names into an array
    $STMT = <<EOF;
    select first 1 * from $table
    EOF

    my $sth = $db1->prepare($STMT);$sth->execute;

    my ($i, @field);
    my $columns = $sth->{NAME_lc};
    while (my $row = $sth->fetch){for $i (0 .. $#$row){$field[$i] = $columns->[$i];}}

    $STMT = <<EOF;
    select * from $table where frm = '$frm' and req_no = $req_no
    EOF
    $sth = $db1->prepare($STMT);$sth->execute;
    $i=0;
    while ($i!=scalar(@field))
    {
    #need code for in here...
    }
} 
```

我正在寻找一种方法来把它变成不需要明确定义的东西......

```
my ($frm, $req_no, $auth_id, $alt_auth_id, $id_acct, $seq_no, $id, $appr_stat, $add_date, $approve_date, $approve_time, $prim);
while(($frm, $req_no, $auth_id, $alt_auth_id, $id_acct, $seq_no, $id, $appr_stat, $add_date, $approve_date, $approve_time, $prim) = $sth->fetchrow_array()) 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-15T15:52:09.163

使用 fetchrow_hashref：

```
sub shamoo {
    my ($dbh, $frm, $req_no, $table) = @_;

    print uc($table), "\n", "=" x 36, "\n";

    #takes arg (table name) and stores all the field names into an array
    my $sth = $dbh->prepare(
        "select * from $table where frm = ? and req_no = ?"
    );

    $sth->execute($frm, $req_no);

    my $i = 1;
    while (my $row = $sth->fetchrow_hashref) {
        print "row ", $i++, "\n";
        for my $col (keys %$row) {
            print "\t$col is $row->{$col}\n";
        }
    }
} 
```

您可能还希望设置`FetchHashKeyName`为`"NAME_lc"`或`"NAME_uc"`在创建数据库句柄时：

```
my $dbh = DBI->connect(
    $dsn,
    $user,
    $pass,
    {
        ChopBlanks       => 1,
        AutoCommit       => 1,
        PrintError       => 0,
        RaiseError       => 1,
        FetchHashKeyName => "NAME_lc",
    }
) or die DBI->errstr; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T17:58:08.613

我想知道这种方法是否适用于空表。

获取列元数据的最安全方法不是查看返回的 hashref 的键（可能不存在），而是按照规则进行操作并使用 DBI 提供的 $sth 本身的属性：

```
$sth->{NAME}->[i]
$sth->{NAME_uc}->[i]
$sth->{NAME_lc}->[i] 
```

有关详细信息，请参阅 DBI 手册页的元数据部分。

# windows - 如何防止 DLL 注入

> ID：869320
> 
> 赞同：38
> 
> 时间：2009-05-15T15:21:19.957
> 
> 标签：windows, security, code-injection

所以前几天，我看到了这个：

[http://www.edgeofnowhere.cc/viewtopic.php?p=2483118](https://web.archive.org/web/20090904193405/https://www.edgeofnowhere.cc/viewtopic.php?p=2483118)

它介绍了三种不同的 DLL 注入方法。我将如何阻止这些过程？或者至少，我如何防止第一个？

我在想也许一个环 0 驱动程序可能是阻止这三个驱动程序的唯一方法，但我想看看社区的想法。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-05-15T16:18:34.607

最好的技术解决方案是做一些事情，导致加载程序代码在您的进程初始化后无法正常运行。这样做的一种方法是使用 NT 加载程序锁定，这将有效地阻止任何加载程序操作的发生。其他选项包括直接在内存中修补加载程序代码，以使攻击者对 LoadLibrary 的调用失败（例如插入 int3 断点和自调试以处理预期情况）。

但是，作为一名黑客（实际上是管理您链接的网站的人），您永远不会阻止人们以某种​​方式将代码输入您的流程。LoadLibrary 恰好是一个方便的快捷方式，但是有很多不同的手动加载代码的方法，除了一些极其复杂的 ring0 代码之外，您永远无法完全停止这些方法。即使你去 ring0，黑客也会在你身边。

此外，DLL 注入还有很多合法用途。主题程序、辅助工具和各种扩展操作系统功能的程序都可能使用 DLL 注入为任何程序提供附加功能。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-04-07T09:40:37.303

如何防御这 3 种技术：

# 创建远程线程

您可以通过挂钩 LoadLibrary 来阻止第一种技术（调用 LoadLibrary 的 CreateRemoteThread）。在您的钩子中，您可以检查您知道是进程的一部分并且可能已加载的 DLL 名称列表，或者您可以检查您不想加载的已知 DLL 列表。

当您找到一个 DLL 时，您不想加载 SetLastError(ERROR_ACCESS_DENIED) 然后返回 NULL。我设置了最后一个错误，以便编写代码寻找错误代码的人得到一个。这似乎可行，也许不同的代码可能更合适。

这将阻止 DLL 加载。

# SetWindowsHookEx

我认为 CreateRemoteThread 阻塞的相同技术适用于 SetWindowsHookEx，但前提是您可以在 SetWindowsHookEx 技术开始加载其代码之前安装您的钩子（通常是在应用程序中创建第一个窗口时 - 在其生命周期的早期）。

# 代码洞穴

不错的技术。以前没见过。您可以对此进行防御，但您必须挂钩 LoadLibrary 入口点（而不是 IAT 表），因为 Code Cave 直接调用 LoadLibrary。

正如文章的作者所评论的 - 有很多方式可以攻击你，你可能很难打败它们。但通常您只想防御某些 DLL 加载（例如与您的软件不兼容的特定 3rd 方 DLL，因为 3rd 方 DLL 没有正确编写以适应另一个钩子也可能存在的事实，所以您阻止它从加载）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-15T15:49:55.177

最好的方法是确保没有不受信任的进程获得管理员访问权限，或者以与您的应用程序相同的用户帐户运行。如果没有这种访问权限，就不可能将代码注入到您的应用程序中；一旦这样的进程获得了访问权限，它可能会导致各种恶作剧，而无需将自己注入另一个进程 - 注入只会使其更容易隐藏。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-04-11T11:33:18.313

由于这张海报暗示他正在投资游戏反黑客，让我谈谈我的想法。作为一个前骗子。

只是关于游戏反黑客的指针。

最好的办法是**让服务器运行核心游戏逻辑**。例如，在第一人称射击游戏中，监控客户端发送到服务器的动作。不要让他们随意走动。**让服务器根据自己的逻辑告诉客户端每个玩家在哪里**。永远不要只转发命令。他们可能是假的。

谁在乎黑客是否入侵了他自己的客户端？只是拒绝其他人，一切都很好。对于星际争霸地图黑客，解决方案很简单。不要为应该未知的区域提供游戏状态。它也节省了带宽。

我是三角洲部队的大骗子（这是一个老游戏）。我使用的主要技巧是通过直接修改进程内存来扭曲游戏中的任何地方。无需DLL！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-16T13:21:54.653

您是否正在寻找 Ring3 解决方案？如果是这样，您希望在当前（至少据我所知）未提供开箱即用的系统中构建附加功能，因此需要一些工作。此外，这可以通过驱动程序实现，事实上，您的大多数 AV 软件都会定期执行此类活动。

至于从用户模式停止上述方法，它会变得有点棘手，因为您不能只将自己注册为对进程创建或 DLL 加载的回调。但是，如果您假设您的进程在他们之前启动，则可以全局挂钩 CreateRemoteThread 和类似函数并自己执行此类检查。

所以实际上你想检查 CreateRemoteThread 想在哪里创建一个线程，如果你不满意它会返回一个错误。

这将否定前两种方法。对于第三种方法，如果磁盘上有原始程序的有效哈希值，那么您总是可以在加载之前检查哈希值。如果你没有散列，你至少可以检查一些简单的地方，有人会添加那种类型的代码，并寻找你不希望出现的DLL（例如IAT，或运行字符串）。

它不是万无一失的，但它似乎提供了您要求的功能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-07-01T10:07:22.153

只是简短的讨论想法:)

使用代码洞穴将 CRC 检查注入您自己的代码可能会减慢其他人使用其他代码洞穴的速度。

轮询正在加载的未知 dll 的进程模块列表可能有助于减慢人们使用附加线程和消息挂钩注入任何旧东西的速度。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T15:50:52.240

为什么要阻止这种情况？这是实际的“业务”需求，还是您只是对“黑客”感兴趣以反对“黑客”

如果用户权限允许，这是设计使然 - 操作系统为*您*（系统管理员）分配给他们运行的帐户的所有用户提供便利。

Raymond Chen 很快就会链接到这里...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-15T16:29:29.370

我对 Windows API 不是很熟悉，但我可以给你一些更通用的指针：

1.  查看是否可以使用 Windows 数据执行保护 (DEP)。它可能不适用于所有（阅读：大多数）情况，因为从操作系统的角度来看，链接中概述的过程是有效的过程。纵深防御

2.  确保您的流程方法在整个应用程序中声明安全权限

3.  静态分配您的内存空间，以便生成的任何新线程都将失败或覆盖现有内存空间；不过，您可能需要大量的逻辑来检测和纠正这一点。

4.  将您的代码放入设备驱动程序或其他一些低级类型的进程中，您可以在 Windows 文件保护伞下获得这些进程。

刚刚看到 Cthulon 的回答，恐怕他可能是对的：任何想要在您的应用程序上执行代码注入的人都会找到这样做的方法。上述步骤可能只会让它变得更加困难。

希望这可以帮助

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2022-02-23T11:38:05.360

我参加聚会迟到了，但我想我还是应该分享。

应用程序应使用强大的加密算法进行签名。有 3 种不同的技术用于 DLL 注入。要防止 DLL 注入，请执行以下操作：

1.  CreateRemoteThread 您可以通过挂钩 LoadLibrary 来阻止第一种技术（调用 LoadLibrary 的 CreateRemoteThread）。在您的钩子中，您可以检查您知道是进程的一部分并且可能已加载的 DLL 名称列表，或者您可以检查您不想加载的已知 DLL 列表。当您找到不想加载的 DLL 时， `SetLastError(ERROR_ACCESS_DENIED)`返回 NULL。我设置了最后一个错误，以便编写代码寻找错误代码的人得到一个。这似乎可行，也许不同的代码可能更合适。这将阻止 DLL 加载。

2.  SetWindowsHookEx CreateRemoteThread 阻塞的相同技术将适用于 SetWindowsHookEx，但前提是您可以在 SetWindowsHookEx 技术开始加载其代码之前安装您的钩子（这通常是在应用程序中创建第一个窗口时 - 在其生命周期的早期） .

3.  Code Cave You can defend against this, but you'll have to hook the LoadLibrary entry point (not the IAT table) as the Code Cave calls LoadLibrary directly. There are many ways you can be attacked and you probably will have a hard time defeating them all. But often you only want to defend against certain DLL loads (such as a particular 3rd party DLL that is incompatible with your software because the 3rd party DLL wasn't written properly to accommodate the fact that another hook may also be present, so you block it from loading). Also, Digitally sign the application. It will ensure the authenticity and the integrity of the executable application.

[Link 1](https://www.quora.com/What-is-a-DLL-injection) [Link 2](https://social.msdn.microsoft.com/Forums/windowsdesktop/en-US/3decb49c-3418-42b8-a9fa-7e28f1c93757/stop-dll%02injection?forum=vcgeneral)

# project-management - 如何让敏捷适应不同的公司？MBA论文

> ID：869324
> 
> 赞同：17
> 
> 时间：2009-05-15T15:21:40.080
> 
> 标签：project-management, agile

我的硕士论文是研究如何应用敏捷。

有大量的企业推销敏捷——许多管理顾问将他们的品牌推销为“最佳”。

我对[XP](http://en.wikipedia.org/wiki/Extreme_Programming)、[Scrum](http://en.wikipedia.org/wiki/Scrum)、[Crystal Clear](http://www.agilekiwi.com/crystal_clear.htm)、[Agile-CMMI](http://www.agilemanagement.net/Articles/Papers/StretchingAgiletoFitCMMIL.html)、[Six Sigma](http://en.wikipedia.org/wiki/Six_Sigma)或任何其他品牌/变体是否最好不感兴趣。我对真正的、活跃的开发人员（即你们）实际应用敏捷感兴趣。

我研究的是如何根据不同的组织要求定制敏捷。

通过对不同组织如何应用敏捷的研究，我制定了以下指南——在什么情况下应该应用哪些敏捷变体的秘诀：

*   更大、更分散或更灵活的团队需要更严格的编码和测试标准，小团队可以（并且应该）使用更少。
*   流程文档应该是最少的、实时的和最新的。
*   详细的统计控制指标是不必要的开销：不完整软件的早期发布是进度的更好指示。
*   理想情况下，开发人员应该靠近客户，没有专门的中间角色。仅当客户的专业化方式阻止开发人员同时成为用户时，才应使用其他角色。
*   迭代应该是灵活的，除非它有利于与其他部门或其他流程的发布协调。
*   开发人员应该能够轻松且定期地进行交流，但会议应该不频繁（每月和每周，而不是每天）。
*   结对编程只能用于培训和调查任务。
*   这些指南只是一个起点：应该使用持续改进来进一步根据具体情况定制敏捷变体。

当应用在具有现有传统（即[BDUF](http://en.wikipedia.org/wiki/Big_Design_Up_Front)或[瀑布](http://en.wikipedia.org/wiki/Waterfall_development)）模型的组织中时，这些因素会发生变化，其中敏捷团队必须与使用非敏捷方法的团队共存或适应团队：

*   带有签字和结构化步骤的流程文档将帮助其他团队跟踪项目。
*   统计指标（如速度）可以帮助让非敏捷团队放心，流程是受控的。
*   固定迭代将有助于团队之间的协调。

这些附加指南将有助于敏捷与传统模型共存，但它们提供了额外的开销和限制。

我想知道的是你——编写软件的人，而不是敏捷顾问——对这个框架的看法。

你认为什么是准确的？你觉得哪里不对？你会改变什么？我错过了什么？

最重要的是：为什么？

* * *

我为此添加了赏金，以提供额外的动力来回答一个相当长的问题。赏金将颁发给从 SO 社区获得最多选票的人——我意识到没有唯一的正确答案，但我对最接近社区共识的内容感兴趣。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-18T17:18:34.893

> *   更大、更分散或更灵活的团队需要更严格的编码和测试标准，小团队可以（并且应该）使用更少。
> *   流程文档应该是最少的、实时的和最新的。
> *   详细的统计控制指标是不必要的开销：不完整软件的早期发布是进度的更好指示。
> *   理想情况下，开发人员应该靠近客户，没有专门的中间角色。仅当客户的专业化方式阻止开发人员同时成为用户时，才应使用其他角色。
> *   迭代应该是灵活的，除非它有利于与其他部门或其他流程的发布协调。
> *   开发人员应该能够轻松且定期地进行交流，但会议应该不频繁（每月和每周，而不是每天）。
> *   结对编程只能用于培训和调查任务。
> *   这些指南只是一个起点：应该使用持续改进来进一步根据具体情况定制敏捷变体。

无论团队的规模和分布如何，都需要实施编码/测试标准 IMO。拥有编码/测试标准会导致代码更易于管理/稳定。

我同意文档。通过在代码中使用一些干净的代码实践，例如有意义的注释和意图揭示命名约定，您可以消除对代码本身文档的一些需求。文档应该是业务级别的，我更喜欢采用验收测试的形式。

虽然让开发人员接近客户会通过迭代过程得到改进，但您需要通过直接与开发人员联系以进行添加/更改/范围蔓延，从而保护开发人员免受绕过流程的业务的影响。业务仍然需要通过积压梳理/优先级等来遵循流程。

通过将发布迭代与开发迭代一起使用，您可以维护适用于团队的灵活的迭代计划。目前，我们进行 1 周的 sprint 迭代，每 3 到 4 周进行一次发布 sprint。

会议的类型应决定会议的频率。每日站立会议需要每天进行。他们为团队提供问责制和透明度，这对于拥有一个成功的团队至关重要。回顾需要在每次迭代结束时进行，并且频率取决于迭代的大小。其他会议，如代码审查、演示，永远不应该按时决定，而应该根据需要和完成来决定。

结对编程永远不应该被固定在特定的类型上。我们与我们的 QA 测试人员、我们的 BA 团队进行结对编程，以便双方更好地了解 UAT 和故事。我们还为知识共享、原型设计、调查任务等进行结对编程。在我们的环境中，结对编程已成为第二天性。

当您学习根据业务需求修改敏捷实践时，敏捷的持续改进将成为二手性质。只要你不偏离宣言，你的敏捷就应该是成功的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-21T19:11:55.870

作为博士论文的一部分，您还应该考虑如何在分布在全球不同地区的团队中使用敏捷。所以，如果你在东海岸有一个产品团队，在印度和俄罗斯有开发团队，在新加坡有 QA 团队等等。对我来说，这是一场完全不同的球赛，需要完全不同的模式。

例如，一些模式是：

1.  根据时区，将世界某一地区的早起者与另一地区的晚睡者配对，反之亦然。这不完全是结对编程，但您可以将其称为任何您想要的模式。

2.  重点必须是使代码尽可能地可读而不是可写。这意味着我们可能不得不强调统一的设计模式和流畅的命名。

3.  以这样一种方式创建团队，让您拥有其中的一个和我们中的一个。这意味着您将俄罗斯开发人员与印度开发人员配对，他们在一个模块上一起工作。

随着时间的推移发明自己的模式来让敏捷工作变得非常有趣，并且需要大量的耐心和努力。

希望这个新角度对您有所帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-15T17:16:12.160

最后两点我有一个小问题。每日站立会议非常有益。它让我们回顾前一天的工作，以及我们打算在下一次会议（明天）之前完成的工作。重要的是要注意，每日站立会议应保持简短和重点。我们遇到了一些人喜欢提出关于项目的各种问题的情况，所以我们决定不能问任何问题，只能问生产力陈述。如果有问题，将与该组件的负责人安排进一步的会议。

此外，结对编程不应仅用于培训和调查任务。结对编程有很多好处，例如知识共享/转移和代码所有权。对一个问题的两个想法可以带来许多有趣的观点，并且可以帮助隔离潜在的设计缺陷。在我看来，结对编程被低估了，大多数自私的程序员都不喜欢结对编程。这是对项目和团队的好处，而不是对自己的好处。好的软件是由协作团队编写的，而不是一个书呆子。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-24T03:40:58.083

崇高的事业，祝你好运。以上所有优点。我只会补充：

# 敏捷是关于原则，而不是过程。

请参阅[敏捷宣言](http://agilemanifesto.org)。

改变企业行为是目标，而不是改变经过验证的流程以“与”一个破碎的组织“合作”，因此要强调每项实践背后的原则。然后**不要改变做法**。如果这些原则不适用，则放弃反映该原则的做法。改变做法会损害原则并违背其目的。这种“适应”的最终结果很可能*是已经在使用的同样有缺陷的过程*，现在包裹在敏捷术语中，但缺乏使其工作的原则。

# 流程文档是反敏捷的

```
"Process documentation with sign off and structured steps 
 will help other teams track the project" 
```

我不得不对此说一个大大的不。*文档将使敏捷脱离流程*（更不用说开发人员的生命和精力）。如果您想帮助其他团队跟踪项目，请在内网上发布迭代计划和速度。请不要浪费开发人员的时间和客户的金钱来编写流程文档，尤其是为了*其他非利益相关者且没有风险的人*的所谓利益。

当然，如果没有至少一个 Dilbert 参考资料，任何 MBA 候选人都无法逃脱程序员线程：（[来源：][[dilbert.com](http://dilbert.com/dyn/str_strip/000000000/00000000/0000000/000000/50000/4000/500/54565/54565.strip.gif)][）][![Dilbert 遇到了 MBA](https://i.stack.imgur.com/sCYDc.gif)](https://i.stack.imgur.com/sCYDc.gif)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-15T15:33:18.133

好家伙。祝你好运。

我喜欢你的方法，尤其是从我们的咕噜声而不是黄金手表的幻灯片集那里得到输入。

我想说，任何此类方法都需要适应特定情况。*没有人应该只*因为别人说他们应该做某事。恕我直言，为自己思考应该始终处于最前沿。

我与斯隆商学院的 MBA 合作已经有一段时间了，但我清楚地感觉到，他们被教导说程序员应该被“管理”，而不是“培养”。我们是一种令人不快的商品，而不是完整的团队成员。我希望你有比这更好的体验。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-20T10:16:38.780

当软件可以在共享硬件环境中部署到生产环境时，我们在一家拥有高度集成的软件和预先确定的窗口的大公司中实践敏捷。

我们开发了一套由 SCRUM（项目管理）实践和 XP（工程）实践组成的敏捷实践。我们部署的许多系统都使用了传统的瀑布流程

关于您的框架，我将回复每个项目：

**“更大、更分散或更灵活的团队需要更严格的编码和测试标准，小团队可以（并且应该）使用更少。”**

如果您所说的编码和测试标准是指工程实践 (XP)，例如持续集成、结对编程、测试驱动开发、自动化功能和性能测试等。无论团队或项目的规模如何，我们都采用相同的实践。因此，我们经常发布在用户验收测试期间发现的零缺陷的软件。发布具有延展性的高质量软件（低缺陷）以可持续的速度实现持续开发，推动了对工程实践的需求，而不是组织的规模。

**“流程文档应该是最少的、实时的和最新的。”**

如果您所说的流程文档是指敏捷流程文档，那么我们的所有内容都贴在墙上。我们展示了宣言，映射到 12 条原则，最后是我们员工的 21 项实践。它们贴在墙上并且高度可见的事实使团队能够理解它们，更重要的是实际将它们付诸实践。

**“详细的统计控制指标是不必要的开销：不完整软件的早期发布是进度的更好指示。”**

传统工作工件的完成百分比几乎没有价值。每两周向我们的产品所有者/业务合作伙伴演示工作软件是进度的最佳指标。跟踪实际速度（完成的故事卡单元）和缺陷率并在大的可见图表上显示数据非常有用。在向团队介绍某些实践时，显示进度很有用。例如，学习 TDD 时在代码之前编写的单元测试的数量。

“理想情况下，开发人员应该靠近客户，没有专门的中间角色。只有当客户的专业化方式阻止开发人员同时成为用户时，才应该使用额外的角色。”

如果可能，用户应该在开放的工作空间中与团队合作。如果用户不可能与团队在一起，那么用户代理是下一个最好的上线人。没有人能提供比实际使用该软件完成工作的人更好的反馈。

“迭代应该是灵活的，除非它有利于与其他部门或其他流程的发布协调。”

更重要的是，发布日期应该在团队之间保持一致。如果持续时间保持一致（我们每 2 周使用一次），迭代是最好的。一致的迭代长度与时间盒和用于提交到下一次迭代的故事卡的速度计算一致。

**“开发人员应该能够轻松且定期地进行交流，但会议应该不频繁（每月和每周，而不是每天）。”**

团队应该参加每日站立会议，以及每次迭代的迭代计划会议、展示和讲述会议、计划扑克会议和回顾会议。每次发布，团队都会参加发布计划会议。鉴于用户/业务合作伙伴与该线路一起工作，每天都可以就正在完成的工作进行对话。

**“结对编程只能用于培训和调查任务。”**

使用结对编程的第一个原因是消除缺陷。我写了一些关于结对编程的回复。总而言之，配对不太可能被阻止，不太可能参加电子邮件或网络假期，提供转移业务领域、应用程序领域和工程实践技能的机制，消除知识孤岛（大型组织中的关键）等。

**“这些指导方针只是一个起点：应该使用持续改进来进一步根据具体情况定制敏捷变体。”**

回顾，计划每次迭代或发生需要回顾的事件时，零缺陷的心态推动持续改进。员工 XP 工程实践使团队能够保持代码健康，从而可以无限期地轻松添加新功能。我们将瀑布项目的可交付成果视为约束。为了管理约束，我们要求这些团队提前做好工作，并使用模拟等工程技术来测试将与这些可交付成果集成的故事卡。

**“当应用于具有现有传统（即 BDUF 或瀑布）模型的组织时，这些因素会发生变化，其中敏捷团队必须与使用非敏捷方法的团队共存或适应团队：”**

我们拥有生活在瀑布世界中的敏捷团队。我们邀请瀑布项目参加我们的发布和迭代计划会议（和回顾）。我们已经并将继续取得的成功继续为公司内的敏捷实践带来新的转变。

**“带有签字和结构化步骤的流程文档将帮助其他团队跟踪项目。”**

不同意。故事卡片墙、迭代计划和发布计划都是团队内部或团队外部人员所需要的。

**“统计指标（如速度）可以帮助让非敏捷团队放心，流程是受控的。”**

同意。敏捷团队将使速度和缺陷率可见。预算将在 1% 或 2% 以内，并且发布将按计划进行，因为它们是有时间限制的。

**“固定迭代将有助于团队之间的协调。”**

在高度集成的大型环境中需要。还可以帮助团队根据速度构建迭代和发布计划。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-23T20:51:00.020

> *   更大、更分散或更灵活的团队需要更严格的编码和测试标准，小团队可以（并且应该）使用更少。

无论团队规模如何，持续测试都是非常宝贵的。应该改变的是基于项目成熟度和组件重要性的测试量。

对于新产品来说，定期演示对士气很有帮助，并且足以让管理层感受到进步。

对于成熟和交付的产品，主要功能的定期验收测试将跟踪产品的发布准备情况。

对于主要的系统接口，单元测试是说明性的，有助于避免意外。在处理签约的子项目时，单元测试比文档更好，并且对于避免相互指责的延迟至关重要。

测试优先的开发对于繁重的代码片段来说是一个有价值的实验。如果您最宝贵的资产是您的技术，那么它应该经过彻底的测试。

> *   详细的统计控制指标是不必要的开销：不完整软件的早期发布是进度的更好指示。

统计控制指标对于及早识别项目超限至关重要，但最好将它们永久地或直到整个团队在对进度和延迟进行准确核算之前都留在“敏捷教练”或“Scrum Master”手中。

当有效应用时，敏捷开发实践应该产生足够小的故事和任务，以便在几小时到几天内完成。有效管理“计划游戏”和导致个别任务超支的反馈可以最大限度地减少估计和收集进度数据的开销。

最后，客户（和/或管理层）决策的历史记录以及对这些决策的实际反应时间（天数）的核算将引导改进工程和业务流程。一张“泳道”或“甘特图”表示受阻的开发和花费的时间将显示“但我们很敏捷”如何不是草率的商业决策的借口。

> *   理想情况下，开发人员应该靠近客户，没有专门的中间角色。仅当客户的专业化方式阻止开发人员同时成为用户时，才应使用其他角色。

这一次我同意！单独的开发和管理会议可以很好地分离关注点。

> *   迭代应该是灵活的，除非它有利于与其他部门或其他流程的发布协调。

敏捷迭代是建立可连续发布产品的宝贵开发节奏。迭代的结束是可以实施功能决策并且可以进行源代码控制更改以分支不会成为目标的功能。

但是，当迭代无法满足业务需求时，团队可能难以实施这种做法。应围绕演示和促销等业务需求安排迭代。

> *   开发人员应该能够轻松且定期地进行交流，但会议应该不频繁（每月和每周，而不是每天）。

周一/周四的站立会议是个好主意。但是，它需要一个硬性的 15-30 分钟上限。根据需要拆分会议以减少时间。将关注点分开以避免浪费开发人员的时间。

办公室犬可以帮助人们在会议期间保持专注。几声吠叫比人们打瞌睡或发短信要好。

> *   结对编程只能用于培训和调查任务。

结对编程、单元测试、无情的重构和测试驱动的实践是团队最难采用的敏捷技能。结对编程的好处是提高意识和知识，并防止工作孤立地进行，错误的决策和假设可能会持续存在和级联。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-22T20:33:51.923

1.  “流程文档应该是最少的、实时的和最新的。”

“最小”是什么意思？是从总页数的意义上说还是从覆盖率的意义上说（v.gr.标准文档，配置管理手册，设计文档）。

当您假设团队中没有人员流动的项目时——并且在长期项目中这不是一个合理的假设，您需要一种有效的知识转移机制，而最有效的知识转移机制是文档。

我见过文档保持最少的项目（在页数的意义上），因为开发文档太麻烦了。但是，如果您可以将文档从一个项目重用到另一个项目，而无需更改或更改很少（这对于编程标准、配置管理手册等文档是合理的），则没有文档开发负担。

流程文档应涵盖所有软件开发流程，否则您将面临流程的步骤以不一致的方式执行的风险。敏捷团队拥有敏捷的软件流程。我所说的软件开发过程是指管理代码、控制版本、控制审查、签入代码、修复错误等的清晰机制。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-22T20:51:45.897

> *   更大、更分散或更灵活的团队需要更严格的编码和测试标准，小团队可以（并且应该）使用更少。

无论团队规模如何，都应该存在编码和测试标准。它们提高了代码的可维护性，并使新资源的速度更容易。

> *   流程文档应该是最少的、实时的和最新的。

同意。

> *   详细的统计控制指标是不必要的开销：不完整软件的早期发布是进度的更好指示。

对于软件开发来说，始终有价值的统计控制指标并不多。我会寻找时间和预算的差异、测试和生产中的缺陷率以及估计的差异。

> *   理想情况下，开发人员应该靠近客户，没有专门的中间角色。仅当客户的专业化方式阻止开发人员同时成为用户时，才应使用其他角色。

通常这是不切实际或不可能的。客户在自己的工作中要做的事情太多了，以至于他们很少有时间与开发人员密切合作。业务分析师具有整合业务问题并更有效地获得明确答案所需的技能。如果您的发布周期足够短，客户将有很多机会获得反馈。

> *   迭代应该是灵活的，除非它有利于与其他部门或其他流程的发布协调。

应该有一定的灵活性，但不多。敏捷方法的好处之一是它迫使团​​队将范围限制在最有价值的需求上。增加迭代时间的灵活性会增加范围蔓延的风险。

> *   开发人员应该能够轻松且定期地进行交流，但会议应该不频繁（每月和每周，而不是每天）。

每日会议对较大的团队有效。他们使人们保持正轨并增加协作。它们有助于防止团队成员在不寻求帮助的情况下陷入问题。它们还有助于保持对迭代的控制，考虑到缺乏其他可用的控制，这非常有用。

> *   结对编程只能用于培训和调查任务。

关于这一点，我没有太多要说的。

> *   这些指南只是一个起点：应该使用持续改进来进一步根据具体情况定制敏捷变体。**

确切地！敏捷旨在适应组织的需求。不断调整对于完善流程至关重要。

祝你论文顺利。

# svn - 我的脚本是否必须更新 svn 服务器？

> ID：869325
> 
> 赞同：2
> 
> 时间：2009-05-15T15:21:44.417
> 
> 标签：svn

我正在尝试使用脚本自动化从现有项目创建新项目的过程。我最初的想法是应该有两个脚本：

1：从 svn 存储库中签出一个现有项目，然后重命名它（即在所有文件中从 ExistingProjectName => NewProjectName 搜索和替换，然后“svn rename”包含字符串 ExistingProjectName 的所有文件和目录）

2：用户检查编译等后，在存储库上创建新项目（例如使用“svn switch”命令）

这个想法是，在用户有机会进行检查之前，不应更改存储库。

但是，有人向我指出了潜在的风险。#1 运行后，本地工作副本仍与现有项目相关联。在这个阶段不小心提交的人会搞砸现有的项目。

任何人都可以想到一些可以阻止用户在 #1 之后提交的 svn 技巧吗？即使浏览了文档，我也想不出任何东西。

谢谢你。

安迪

（如果无法停止提交，那么我们将需要采取两败俱伤的做法，并编写脚本，以便在用户有机会检查之前更新存储库。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T15:33:41.627

可能，您可以向更改的文件写入一个特殊值，以指示状态。然后，使用 svn 提交钩子来检查是否有人试图提交到错误的存储库...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T15:36:00.280

可能你可能想做一个 svn 导出。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T15:38:52.067

要在 svn 中创建新分支，请使用 svn copy 命令。完成后，您在存储库中有 2 个项目，您可以在闲暇时修改其中任何一个。

所以，如果你还是要 svn 重命名项目 - 为什么不创建分支然后重命名文件（并更新内容）。任务完成！

另一种方法是检查您现有的项目，重命名并编辑它，然后将工作副本添加到 svn。那将是“原子的”，并且会阻止重命名出现在日志中。

添加一个全新的分支和复制一样好，除了你没有得到 svn 的“廉价副本”的好处，但是当你进行重要的编辑（和重命名！）时，这不是一个更好的方法吗？地方？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T15:36:29.890

停止提交的技巧是`svn export`在第一步中使用。然后，当更改准备就绪时，使用`svn import`.

# java - Java：在客户端和 servlet 之间传递消息的适当方式？

> ID：869333
> 
> 赞同：0
> 
> 时间：2009-05-15T15:24:00.917
> 
> 标签：java, communication, message-passing

我的系统成功地将对象从客户端传递到 servlet。然而，它是原始的，因为它是为迎合 Java 1.1 而构建的。它传递的消息对象由一个 int （代表大约七十种类型之一）和一个需要解析的令牌字符串组成（令牌可能包含一个列表、对象列表等）。不好！

因此，我希望将其重构为 Java 1.5。使用 enum 而不是 int 肯定是一种改进，但我不确定如何发送其余的消息。创建 70 个不同的类来表示每种类型肯定不是正确的方法。

关于我应该如何重构它的任何指示？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T15:34:54.057

您可能想要使用序列化对象。

它们旨在轻松地在网络中传递。

在您的情况下，您只需要一个序列化的“消息”类。然后您可以读取并将其写入流。

[这](http://java.sun.com/developer/technicalArticles/Programming/serialization/)是使用序列化对象的教程。那里有很多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T16:36:18.527

无需创建不同的类来表示每种类型的消息。您创建一个具有所需属性的消息类。像这样的东西：

```
public class Message implements Serializable{
     private Long id;
     private String msgText;
     //other necessary properties

     public Message(){
        this(0, "default message");
     }

     public Message(Long id, String msgText){
         setId(id);
         setMsgText(msgText);
         //etc
     }

     //getters and setters
} 
```

然后根据需要创建对象。例如：

```
Message m1 = new Message(9, "The Eagle has landed");
//serialize m1 to server

Message m2 = new Message(27, "The Wren has landed");
//serialize m2 to the server 
```

等等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T15:47:12.327

[您还可以使用xStream](http://xstream.codehaus.org/)将对象序列化为 XML 并再次返回对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T16:53:23.307

第一个问题：为什么你觉得有必要做出改变？是因为当前系统不支持您计划添加的某些功能吗？还是只是为了打扫而进去打扫？如果是后者，我强烈建议让睡虫撒谎。

第二个问题：我假设这是一个小程序。你会计划使用不同的前端吗？或者将此服务器公开为通用服务？如果不是，那么我回到第一个问题。如果是，那么您几乎肯定希望远离特定于语言的序列化。

如果您打算公开为服务，那么遵循一些“标准”服务协议是一个好主意。REST 可能是最简单的 POST-ing XML 有效负载。你也可以做 SOAP，但我一直认为这是矫枉过正。

或者，您可以使用标准的 URL 编码的 POST ......这应该比将所有内容包装在 XML 中更容易实现。

# .net - Linq to SQL 错误 SQL 不比较 NText、Text、Xml 或 Image？

> ID：869349
> 
> 赞同：12
> 
> 时间：2009-05-15T15:27:47.117
> 
> 标签：.net, linq-to-sql

尝试对 Linq 对象进行更新时，我收到以下错误。

“SQL Server 不处理 NText、Text、Xml 或 Image 数据类型的比较。”

数据库中有一个字段是文本字段，因为它将保存一个可能长达 32kb 的字符串。

我应该更改数据类型还是可以使用 Linq 中的解决方法？

编辑

我支持 SQL 2000，这就是它是 TEXT 字段的原因。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-09-09T14:44:56.517

您始终可以在有问题的字符串上使用 ToString() ，这将强制客户端进行比较。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-15T15:29:59.047

将其更改为 VARCHAR(max) - 这将使生活更轻松。

* * *

编辑

全文索引在这里可能对您有所帮助，但不确定 SQL 2000 是否允许您在文本列上“搜索”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-09T06:58:40.637

或者您可以在代码中设置 UpdateCheck：

```
 [Column(Name = "SomeXml", Storage = "_someXml", CanBeNull = true, UpdateCheck = UpdateCheck.Never)]
    public System.Xml.Linq.XDocument SomeXml { get { return _someXml; } set { _someXml = value; } } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-02-24T09:53:47.113

您可以在 .dbml 中手动将更新检查更改为“从不”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-07-30T15:31:34.333

您必须将表的**所有**字段更改为**NVARCHAR(MAX)** - 即使是您不更新的字段。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2022-02-19T12:30:15.730

我有同样的问题，我只是做了这样的事情：

由此：

```
Dim query = From x In db.Transactions
            Where x.Description = "from ImnoX"
            Select x 
```

对此：

```
Dim query = From x In db.Transactions
            Where x.Description.ToString = "from ImnoX"
            Select x 
```

# .net - 何时使用 AsyncOperation 和 AsyncOperationManager

> ID：869355
> 
> 赞同：4
> 
> 时间：2009-05-15T15:29:33.867
> 
> 标签：.net, asynchronous

今晚我花了很多时间阅读实现基于事件的异步模式

不幸的是，我根本找不到任何关于了解只支持一个异步调用的类的文章。

我见过的每个示例都假定方法调用将被多次调用，因此应该将 userState 对象传递给*MethodName* Async

您会看到 MS 在本文的第三个要点中提到了这一点 [http://msdn.microsoft.com/en-us/library/ms228974(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms228974(VS.80).aspx)在“同时执行操作”标题下.

但我很困惑。我是否应该使用 AsyncOperation 和 AsyncOperationManager 类来获得异步功能，其中一个方法一次只能由一个线程调用？

一个链接也很好:)

谢谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-03-26T14:22:26.953

首先，我们需要说一下什么是同步上下文。
同步上下文是一个类，它决定应该执行哪些线程操作。
主要的同步上下文类 - SynchronizationContext 和 WindowsFormsSynchronizationContext - 只是可以将操作委托给其他线程的简单类。
SynchronizationContext.Post() 方法只是将操作委托给线程池中的某个线程（在内部使用 ThreadPool.QueueUserWorkItem(...) 方法）。
SynchronizationContext.Send() 方法只是在同一个线程中执行委托。
WindowsFormsSynchronizationContext 最常见的用法如下：当您创建应用程序的主窗体时，WindowsFormsSynchronizationContext 在内部为主 GUI 线程设置。稍后，此同步上下文用于在同一主 GUI 线程上执行委托。

因此，我将得出结论，同步上下文是一个简单的类，它决定将在哪个线程上执行委托。

现在，让我们回到 AsyncOperationManager 类。
当您需要在某些同步上下文上执行操作时，您可以使用 AsyncOperationManager 类。将在其上执行操作的同步 cotnext 可以是：

1) 如果线程定义了 SynchronizationContext，则调用 AsyncOperationManager.CreateOperation() 方法的同步上下文相同。
或
2) 如果当前线程尚未定义同步上下文，则新同步上下文（由基本 SynchronizationContext 类的新实例表示）。正如我之前所说，基本 SynchronizationContext 类的实例将在线程池中的某个线程上执行委托。

基本上，AsyncOperationManager 只是一个简单的辅助类，它在内部使用 AsyncOperation 和 SynchronizationContext 类。

现在，关于使用场景。
例如，在您的主 GUI 线程中，您创建一个使用基于事件的异步模式提供异步操作的类（即，它提供报告进度的事件）。
您希望您的事件处理程序在同一个 GUI 线程中执行，因此您将能够从事件处理程序使用您的 GUI 控件。
在这种情况下，在 OperationAsync 方法中，您将创建一个 AsyncOperation 对象并将其存储以供以后使用：

```
public void OperationAsync(object arg1, object arg2, ...)
{
  _asyncOperation = AsyncOperationManager.CreateOperation(null);
  /* _asyncOperation object now captured current synchronization 
     context, which is WindowsFormsSynchronizationContext if you 
     run this method from GUI thread. */
  ...
} 
```

当操作完成时，您使用 AsyncOperation.Post() 方法引发 OperationCompleted 事件。如果您从应用程序的 GUI 线程运行 AsyncOperationManager.CreateOperation() 方法，事件处理程序将在同一线程上执行 - 即在您的主 GUI 线程上：

```
private void OnOperationCompleted(AsyncCompletedEventArgs e)
{
  EventHandler<AsyncCompletedEventArgs> handler = OperationCompleted;
  if(handler != null)
  {
    _asyncOperation.Post(
      delegate
      {
        handler(this, e);
      },
      null);

    _asyncOperation.OperationCompleted();
  }
  ....
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-09-14T20:36:58.417

CodeProject 的这篇文章清楚地解释了您的问题的答案：http: [//www.codeproject.com/KB/cpp/SyncContextTutorial.aspx](http://www.codeproject.com/KB/cpp/SyncContextTutorial.aspx)

# c# - 在强类型 MVC 视图用户控件中使用值类型

> ID：869358
> 
> 赞同：4
> 
> 时间：2009-05-15T15:30:03.353
> 
> 标签：c#, asp.net-mvc

我有一个具有以下基本结构的 MVC 用户控件：

```
<%@ Control Language="C#" Inherits="System.Web.Mvc.ViewUserControl<Decimal>" %>

<%= Math.Round(Model) %> 
```

当我使用它时，它会给出这个错误消息：

> 编译器错误消息：CS0452：类型“十进制”必须是引用类型才能将其用作泛型类型或方法“System.Web.Mvc.ViewUserControl”中的参数“TModel”

有没有办法让它工作（以某种方式欺骗框架将 Decimal 视为引用类型？）或者我试图做的只是根本上的错误？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-15T15:43:34.473

我建议您将值类型包装在 ViewModel 中。这将允许将来有一些灵活性（可能需要也可能不需要）。

```
public class MyUserControlViewModel
{
    public Decimal MyValue { get; private set; }

    public MyUserControlViewModel(Decimal dec)
    {
        MyValue = dec;
    }
}

<%@ Control Language="C#" Inherits="System.Web.Mvc.ViewUserControl<MyUserControlViewModel>" %>

<%= Math.Round(Model.MyValue) %> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-12-15T15:14:24.967

不必进入课堂，如果你想要一个快速的方式，使用这个

```
<%@ Control Language="C#" Inherits="System.Web.Mvc.ViewUserControl<Nullable<Decimal>>" %> 
```

你也可以考虑使用

```
<%@ Control Language="C#" Inherits="System.Web.Mvc.ViewUserControl<dynamic>" %> 
```

并通过代码验证

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-15T15:35:50.717

`ViewUserControl`声明如下：

```
public class ViewUserControl<TModel> : ViewUserControl
where TModel : class 
```

因此，您不能欺骗它使用值类型进行编译。我建议将您的`Decimal`对象包装在另一个类中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-15T15:41:32.420

您可以将值包装在一个类中：

```
 public class Wrapper
{
        public Wrapper(decimal d)
        {
            this.Value = d;   
        }
        Decimal Value { get; set; }
} 
```

在视图中：

```
<%@ Control Language="C#" Inherits="System.Web.Mvc.ViewUserControl<Wrapper>" %>
<%= Math.Round(Model.Value) %> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T15:47:55.307

模型是从控制器到视图的 DTO。即使只有一个十进制属性，您也应该创建自己的 DTO。视图的职责只是渲染，Math.Round 应该由控制器执行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-16T17:05:32.100

虽然我强烈支持上述所有答案，但声明将十进制值包装在一个类中以支持进一步开发，您可以通过使十进制为空（“十进制？”）来快速解决您的问题，因为 System.Nullable 是一种引用类型。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T15:40:00.427

我对 ASP.Net MVC 框架不是很熟悉，但错误是说你的模型必须是一个类，而不是原始类型，从模型视图控制器的角度来看，这是非常标准的。

为了让它工作，你需要一个像这样的类：

```
class MyDouble : Model   // or whatever MVC calls it's Model
{
   public TheValue {
     get;
     set;
   }
} 
```

然后将您的行替换为`<%= Math.Round(Model.TheValue) %>`.

请注意，只有一个双精度值的自定义控件似乎是一个奇怪的设计。如果这只是一个示例应用程序，那很好，但除此之外，您可能需要重新考虑如何最好地使用自定义控件。

# asp.net - EnableHeaderChecking=true 是否足以防止 Http Header 注入攻击？

> ID：869361
> 
> 赞同：10
> 
> 时间：2009-05-15T15:30:18.750
> 
> 标签：asp.net, iis, security, fortify

将 [ `System.Web.Configuration.HttpRuntimeSection.EnableHeaderChecking`]( [http://msdn.microsoft.com/en-us/library/system.web.configuration.httpruntimesection.enableheaderchecking(VS.85).aspx)](http://msdn.microsoft.com/en-us/library/system.web.configuration.httpruntimesection.enableheaderchecking(VS.85).aspx))设置为`true`（默认）是否足以完全阻止 Http响应拆分等标头注入攻击？

我问是因为白盒渗透测试工具（强化）报告了可利用的 http 标头注入问题`HttpResponse.Redirect`和 cookie，但我还没有找到成功执行攻击的方法。（**编辑**：..我们启用了EnableHeaderChecking ..）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-22T15:30:41.610

我已经研究了一段时间，并得出结论，将[EnableHeaderChecking](http://msdn.microsoft.com/en-us/library/system.web.configuration.httpruntimesection.enableheaderchecking(VS.85).aspx)设置为`true`实际上足以防止 http 标头注入攻击。

查看“反映”的 ASP.NET 代码，我发现：

1.  只有一种方法可以将自定义 HTTP 标头添加到 HTTP 响应，即使用[HttpResponse.AppendHeader](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.appendheader.aspx)方法
2.  [HttpResponse.AppendHeader](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.appendheader.aspx)要么
    *   创建`HttpResponseHeader`（内部）的实例
    *   或调用`HttpResponseHeader.MaybeEncodeHeader`(for `IIS7WorkerRequests`)
    *   或分配其各自的属性（对于已知的标头，如[RedirectLocation](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.redirectlocation.aspx)或[ContentType](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.contenttype.aspx)）
3.  `HttpResponseHeader`[在发送RedirectLocation](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.redirectlocation.aspx)或[ContentType](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.contenttype.aspx)等已知标头之前创建实例（`HttpResponse.GenerateResponseHeaders`）
4.  构造`HttpResponseHeader`函数检查[EnableheaderChecking](http://msdn.microsoft.com/en-us/library/system.web.configuration.httpruntimesection.enableheaderchecking(VS.85).aspx)设置并`HttpResponseHeader.MaybeEncodeHeader`在设置为时调用`true`
5.  `HttpResponseHeader.MaybeEncodeHeader`正确编码换行符，这使得 HTTP 标头注入攻击不可能

这是一个大致演示我如何测试的片段：

```
// simple http response splitting attack
Response.AddHeader("foo", "bar\n" + 
    // injected http response, bad if user provided
    "HTTP/1.1 200 OK\n" + 
    "Content-Length: 19\n" +
    "Content-Type: text/html\n\n" +
    "<html>danger</html>"
); 
```

以上仅在您明确关闭[EnableHeaderChecking](http://msdn.microsoft.com/en-us/library/system.web.configuration.httpruntimesection.enableheaderchecking(VS.85).aspx)时才有效：

```
<httpRuntime enableHeaderChecking="false"/>
```

Fortify 根本不考虑配置（显式设置[EnableHeaderChecking](http://msdn.microsoft.com/en-us/library/system.web.configuration.httpruntimesection.enableheaderchecking(VS.85).aspx)无效），因此*总是*报告这些类型的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-19T09:45:46.103

AFAIK 就足够了，它应该默认打开。

我认为 Fortify 只是在考虑深度防御，就好像您在部署等中更改配置一样。

我假设你没有在你的配置中严格设置它，如果你有，也许 Fortify 不是那么聪明地认为我们的。

**最好的确认方法是利用它:)**

*   只需获取 fiddler 的副本
*   拦截请求
*   尝试注入新行
*   查看您刚刚注入的新行是否在 HTTP 响应中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-19T09:38:00.800

EnableHeaderChecking 仅适用于不受信任的数据。如果您将数据直接从 cookie 传递到重定向，则生成的标头可能被认为是受信任的，并且 \r\n 值不会被转义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-22T23:06:55.027

Josef，HttpResponse.AppendHeader() 不是不受信任的数据可以进入 HTTP 响应标头的唯一位置。

如果数据包含回车（或任何被解释为回车的内容），则来自攻击者的任何以 Cookie 或 HTTP 重定向结尾的数据都可以写入新的标头。

一般来说，利用你的时间来验证你的数据比坐在那里尝试解决漏洞要好得多。很有可能，黑客在这方面会比你或我做得更好。

# css - absolute 中相对定位的项目。IE中的问题

> ID：869365
> 
> 赞同：3
> 
> 时间：2009-05-15T15:32:02.380
> 
> 标签：css, internet-explorer-6

这让我很头疼。我在 IE (6/7) 中遇到以下代码的问题。

我在页面上有许多相对定位的容器项目。其中一个里面是一个绝对定位的项目。这个内部项目应该出现在任何容器项目之上。这在 Safari 和 Firefox 中正确显示，但在 IE 中不正确。

我已经包含了一个非常精简的示例供您查看。我无法删除位置：相对；在容器或位置上：绝对；在内部项目上，因为这最终将是一个 html 下拉项目。

非常感谢你的帮助。

[在这里预览。](http://louiswalch.com/beta/css_dropdowns.php)

```
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title></title>
    <link href="http://www.louiswalch.com/common/css/reset.css" type="text/css" rel="stylesheet">
    <style type="text/css">     

        BODY { padding: 20px; }

        .item {
            margin-bottom: 5px;
            padding: 5px;
            background-color: orange;       
            position: relative;
            float: left;
            width: 300px;
            }

            .item .display {
                background-color: red;
                }

            .item .inside {
                padding: 5px;
                background-color: yellow;
                position: absolute;
                top: 23px;
                left: 10px;
                width: 100%;
                z-index: 5000;
                }           

        .clear { clear: both; }

    </style>
</head>
<body>
    <div class="item">
        <div class="display">Item</div>
    </div>
    <div class="clear"></div>

    <div class="item">
        <div class="display">Item (Open)</div>
        <div class="inside">This is inside<br/>more<br/>more</div>
    </div>
    <div class="clear"></div>

    <div class="item">
        <div class="display">Item</div>
    </div>

</body>
</html> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T15:52:51.957

在 IE 中，你不能有一个 z-index 比它的容器更高的 div，所以如果你想让“内部”元素在其他 div 之上弹出，那么它的容器也必须在这些元素之上（不确定是什么标准是，但从逻辑上讲，IE 方式似乎更有意义）。

在您的示例中，请执行此操作...

```
<div class="item" style="z-index:5000">
            <div class="display">Item (Open)</div>
            <div class="inside">This is inside<br/>more<br/>more</div>
    </div> 
```

....您的菜单现在将像在 FF 中一样位于底部项目的上方。

理想情况下，您只需要创建一个名为“itemOpen”的样式或具有像这样设置的 z-index 属性的样式，但即使样式属性也可以解决问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T15:47:38.113

显然在 IE 中，定位元素会生成独立于任何定义的 z-index 值的堆叠顺序。[链接文本](http://therealcrisp.xs4all.nl/meuk/IE-zindexbug.html)

[这篇文章](http://www.brenelz.com/blog/2009/02/03/squish-the-internet-explorer-z-index-bug/)指出，给父元素一个更高的 z-index 将修复这个错误。试一试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T15:50:57.547

IE 恐怕不支持 z-index。

IE 从上到下为每个项目分配一个 zindex。因此，底部出现的任何内容都具有更大的优先级。

例如，当我创建下拉菜单时，我确保它们出现在主要内容下方的代码中。

# iphone - iPhone通过手机网络访问网页时是否获得固定IP地址？

> ID：869371
> 
> 赞同：0
> 
> 时间：2009-05-15T15:33:11.287
> 
> 标签：iphone, web-applications, networking

我猜不是，但我想知道是否有人有任何经验。我想它可能会因移动网络而异。

我将在这里对英国的 O2 进行一些测试并更新帖子。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T15:36:29.453

不，不是的。蜂窝网络为每个加入的设备创建一个动态 IP 地址。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T15:49:56.753

仅供参考 - 当您运行带宽测试时，免费应用程序“SpeedTest.net”会显示您 iPhone 的公共 IP。运行它，记录 ip，然后在不同的地理位置再次运行它。我打赌你会找到一个不同的ip。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-04-16T03:16:46.220

这取决于哪个“载体盒”（我称之为版本或冲刺拥有的地面上的奇怪盒子），如果您连接到某个“载体盒”，它将为您提供该盒子具有的 IP。假设有两个盒子 - 盒子 1 的 IP 地址是 192.25.1.100，盒子 2 的 IP 地址可能是 192.26.1.100。

希望这可以帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T15:37:29.043

如果您通过 3G/EDGE 网络连接，那么您可能应该使用固定 ip。并且可能落后于一些代理。如果它不是一个固定的IP，那么我猜只有几个。

但这应该取决于你在哪里。我的提供商会这样做......至少当我在一些'whatismyip'网站上检查它时......通过网络连接时我总是得到相同的结果。

我想这取决于您在哪里捕获网络，如果您留在同一个地方，它可能会是一样的。

# deployment - 持续集成服务器设置：从开发到生产

> ID：869372
> 
> 赞同：1
> 
> 时间：2009-05-15T15:33:11.380
> 
> 标签：deployment, continuous-integration, installation, teamcity

我们正在重新配置我们的服务器环境，从开发到生产。所有服务器都将是作为 VM 运行的 Windows 2008 服务器。我们将使用 TeamCity 进行持续集成和 SubVersion 作为我们的版本控制系统。

在阅读了一些建议之后，这是我目前计划要做的事情（不包括任何冗余、灾难恢复等......）：

*   **生产：** (1) Web 服务器 + (1) DB 服务器
*   **暂存：** (1) Web 服务器 + (1) DB 服务器
*   **构建：** (1) SVN + TeamCity Web&DB + (1) TeamCity 代理
*   **开发：**（1）Web/DB 服务器

所以总共 2 个生产 + 2 个暂存 + 2-3 个构建 + 1 个开发 = 7-8 个服务器

我的问题是：

1.  **SVN 应该放在专用服务器上，还是可以放在开发服务器上？**

    > **答：**到目前为止，似乎一致认为 SVN**不**应该在开发服务器上。它应该是独立的，或者可以与 TeamCity 在同一台服务器上配对。

2.  **TeamCity 应该在专用服务器上，还是可以在 SVN 服务器上运行？**

    > **答：**目前的共识是 TeamCity*可以*与 SVN 在同一台服务器上，特别是如果 TeamCity 代理和 SQL DB 位于不同的服务器上。

3.  **任何其他建议，最佳实践？**

    > **回答：** TeamCity 应该分成 3 个服务器实例：一个用于 TeamCity Web，一个用于 TeamCity Agents，一个用于 TeamCity SQL DB。

我正在尝试进行可靠的最佳实践设置，同时尽量减少服务器蔓延。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T15:43:42.367

要回答您的问题：

*   我会将 SVN 放在与开发服务器不同的服务器上。通常各种垃圾都安装在开发服务器上。
*   TeamCity 可以与 SVN 服务器在同一台服务器上。（称它为您的构建服务器）
*   您的生产系统中没有任何弹性。
    我建议至少再拥有两台服务器，另一台 Web 服务器和一台从您的实时数据库服务器镜像的热备用数据库服务器。
    这些不应与您的其他服务器位于同一数据中心，并且应使用其他网关连接到 Internet。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T15:52:06.187

我刚刚使用 SQL Server DB 和我们在 Tomcat 上运行的 webapp 实例设置了 TeamCity，所有这些都在同一个 Windows VM 上。

*   TeamCity Web 服务器在 Tomcat 本身上运行，并使用大量内存（与任何 Tomcat 应用程序一样）。
*   TeamCity Build 代理，因为它们编译，使用大量内存。
*   SQL Server 是一个内存猪。

JetBrains 提到构建代理不应该与 Web 服务器运行在同一台服务器上。我建议也将数据库分开（在物理机上，而不仅仅是 VM），以便 CI 设置本身使用 3 个系统（TeamCity Web 服务器、TeamCity 数据库、TeamCity 构建代理）。如果您的构建需要超过几分钟的时间，我会添加另一个构建代理服务器，这样开发人员就不会在提交时排队，特别是如果您正在使用来自 IDEA 或 Eclipse 的 TeamCity 的远程运行/个人构建功能。

将 SVN 服务器与 TeamCity Web 服务器放在同一系统上不会有问题。

请记住，编译是一项通常受 CPU 限制或磁盘访问限制的活动。构建代理将受益于分离到单独的 CPU 和/或磁盘上。但是，由于多个 VM 的开销，位于共享磁盘和 CPU 的单独 VM 上可能浪费多于帮助。

# vbscript - 如何从 SQL Server 2005 中检索 XML 数据？

> ID：869373
> 
> 赞同：5
> 
> 时间：2009-05-15T15:33:11.427
> 
> 标签：vbscript

我的脚本：

```
Dim myStream, myConnection, myCommand
Set myStream = CreateObject("ADODB.Stream")
Set myConnection = CreateObject("ADODB.Connection")
Set myCommand = CreateObject("ADODB.Command")
'
myConnection.Open "Provider=SQLOLEDB;Integrated Security=SSPI;" & _
"Persist Security Info=False;Initial Catalog=DSIPAR;Data Source=.\DSIDATA"

myCommand.ActiveConnection = myConnection

myCommand.CommandText = "SELECT itemsgt, item FROM NIFItem"

myStream.Open

myCommand.Properties("Output Stream") = myStream
myCommand.Execute , , adExecuteStream

myStream.Position = 0
myStream.Charset = "ISO-8859-1"

Dim strxml
strxml = myStream.ReadText
MsgBox (strxml) 
```

我可以运行脚本，并且可以看到查询在我的 SQL 服务器实例上执行，但没有任何内容返回到输出流。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-15T15:49:12.883

要将结果检索到流中，查询需要包含“FOR XML AUTO”。还将文本 adExecuteStream 更改为常量值 1024。

完整代码：

```
Dim myStream, myConnection, myCommand
Set myStream = CreateObject("ADODB.Stream")
Set myConnection = CreateObject("ADODB.Connection")
Set myCommand = CreateObject("ADODB.Command")
myConnection.Open "Provider=SQLOLEDB;Integrated Security=SSPI;" & _
"Persist Security Info=False;Initial Catalog=DSIPAR;Data Source=.\DSIDATA"
myCommand.ActiveConnection=myConnection

myCommand.CommandText="SELECT itemsgt,item FROM NIFItem FOR XML AUTO"

myStream.Open
myCommand.Properties("Output Stream") = myStream
myCommand.Properties("xml root") = "root"

myCommand.Execute ,,1024 'instead of adExecuteStream
myStream.Position=0
myStream.Charset="ISO-8859-1"
Dim strxml
strxml = myStream.ReadText
MsgBox (strxml) 
```

如果您不需要流，而是想读取 itemsgt 和 item 的值，请尝试以下操作：

```
Dim myStream, myConnection, myCommand, adoRec
Set myStream = CreateObject("ADODB.Stream")
Set myConnection = CreateObject("ADODB.Connection")
Set myCommand = CreateObject("ADODB.Command")
myConnection.Open "Provider=SQLOLEDB;Integrated Security=SSPI;" & _
"Persist Security Info=False;Initial Catalog=DSIPAR;Data Source=.\DSIDATA"
myCommand.ActiveConnection=myConnection
myCommand.CommandText="SELECT itemsgt,item FROM NIFItem"
SET adoRec = myCommand.Execute()
'Get the first results
If Not adoRec.EOF then
  MsgBox "itemsgt = "  & adoRec(0) & vbcrlf & "item="  &  adoRec(1)
End If

'Iterate through the results
While Not adoRec.EOF
  itemsgt = adoRec(0)
  item = adoRec(1)
  'MsgBox "itemsgt = " & itemsgt & vbcrlf & "item="  & item
  adoRec.MoveNext
Wend 
```

# sql - 使用 SQL 在 Oracle 模式之间复制数据

> ID：869390
> 
> 赞同：10
> 
> 时间：2009-05-15T15:35:48.643
> 
> 标签：sql, oracle, insert, oracle10g, bulkinsert

我正在尝试使用SQL 语句将数据从一个 Oracle 模式 ( `CORE_DATA`) 复制到另一个 ( ) 中。`MY_DATA``INSERT INTO (...)`

SQL 语句会是什么样子？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-15T15:41:19.270

以具有访问权限的用户身份登录时，使用模式名称为表名添加前缀：

```
insert into MY_DATA.table_name select * from CORE_DATA.table_name; 
```

假设表在两个模式中的定义相同，以上将把 CORE_DATA 中名为 table_name 的表中的所有记录复制到 MY_DATA 中名为 table_name 的表中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-01-18T07:55:29.280

```
usage: COPY FROM [db] TO [db] [opt] [table] { ([cols]) } USING [sel]

  [db]   : database schema string, e.g., grprass/grprass@grprass, pplan/pplan@prassm1
  [opt]  : ONE of the keywords: APPEND, CREATE, INSERT or REPLACE
  [table]: name of the destination table
  [cols] : a comma-separated list of destination column aliases ( optional )
  [sel]  : any valid SQL SELECT statement

SQL> COPY FROM scott/tiger@schema1 TO scott/tiger@schema2 insert mytable using select * from mytable; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-15T14:29:08.660

您的架构必须为此授予创建任何表权限

# c# - 泛型构造函数和反射

> ID：869395
> 
> 赞同：9
> 
> 时间：2009-05-15T15:36:24.740
> 
> 标签：c#, generics, reflection

是否可以查看哪个构造函数是通用构造函数？

```
internal class Foo<T>
{
  public Foo( T value ) {}
  public Foo( string value ) {}
}

var constructors = typeof( Foo<string> ).GetConstructors(); 
```

'ContainsGenericParameters' 属性为我返回了两个构造函数 false。有没有办法找出构造函数 [0] 是通用的？它们都具有相同的签名，但我想将“真实”字符串称为一。

**编辑：**

我想使用调用给定的类型

```
ilGen.Emit( OpCodes.Newobj, constructorInfo ); 
```

所以我需要使用绑定版本。但我想调用“最佳”构造函数。这应该是标准行为。当我打电话

```
new Foo<string>() 
```

调用具有字符串签名的构造函数（而不是具有通用签名的构造函数）。我的代码也应该发生同样的情况。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-15T16:02:52.727

您需要 System.Reflection.ParameterInfo.ParameterType.IsGenericParameter。这是一个通过的 VS2008 单元测试，说明了这一点：

班级：

```
public class Foo<T>
{
    public Foo(T val)
    {
        this.Value = val.ToString();
    }
    public Foo(string val)
    {
        this.Value = "--" + val + "--";
    }

    public string Value { get; set; }
} 
```

测试方法：

```
Foo<string> f = new Foo<string>("hello");
Assert.AreEqual("--hello--", f.Value);

Foo<int> g = new Foo<int>(10);
Assert.AreEqual("10", g.Value);

Type t = typeof(Foo<string>);
t = t.GetGenericTypeDefinition();

Assert.AreEqual(2, t.GetConstructors().Length);

System.Reflection.ConstructorInfo c = t.GetConstructors()[0];
System.Reflection.ParameterInfo[] parms = c.GetParameters();
Assert.AreEqual(1, parms.Length);
Assert.IsTrue(parms[0].ParameterType.IsGenericParameter);

c = t.GetConstructors()[1];
parms = c.GetParameters();
Assert.AreEqual(1, parms.Length);
Assert.IsFalse(parms[0].ParameterType.IsGenericParameter); 
```

这里值得注意的一点是 parms[0].ParameterType.IsGenericParameter 检查，它检查参数是否是通用的。

找到构造函数后，您就可以将 ConstructorInfo 传递给 Emit。

```
public System.Reflection.ConstructorInfo FindStringConstructor(Type t)
{
    Type t2 = t.GetGenericTypeDefinition();

    System.Reflection.ConstructorInfo[] cs = t2.GetConstructors();
    for (int i = 0; i < cs.Length; i++)
    {
        if (cs[i].GetParameters()[0].ParameterType == typeof(string))
        {
            return t.GetConstructors()[i];
        }
    }

    return null;
} 
```

不完全确定你的意图是什么。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T15:42:33.337

稍微澄清一下。这两个构造函数都不是通用方法。它们是泛型类的普通方法。对于“通用”的方法，它必须具有通用参数。所以做一个像“IsGenericMethod”这样的测试会返回假。

简单地查看参数并确定它们是否是通用的也并不容易。对于您提供的示例，可以遍历参数并查找通用参数。但也要考虑下面的代码

```
public Foo(IEnumerable<T> p1) ...
public Foo(IEnumerable<KeyValuePair<string,Func<T>>> p1) ... 
```

您需要考虑这样的项目。

**编辑**

您将所有参数都视为字符串的原因是您在获取构造函数之前显式绑定了 Foo 类型。尝试将您的代码切换到使用未绑定 Foo 的以下代码，因此将在方法中返回通用参数。

```
var constructors = typeof( Foo<> ).GetConstructors(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T15:39:51.410

您可以检查[Type.GetGenericArguments](http://msdn.microsoft.com/en-us/library/system.type.getgenericarguments.aspx)结果类型，并将其与构造函数参数类型进行比较。

只需调用具有不同类型的那个（类型！= typeof（T））。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T15:56:39.730

当你说你想调用具体的构造函数时，你能解释一下你想要完成的事情吗？我只是好奇是否有另一种方法可以解决您的问题而无需检测构造函数是否包含泛型参数。

如果传入的参数是字符串，我正在考虑将构造函数链接或将逻辑构建到通用构造函数中以某种方式运行，例如：

```
 static void Main(string[] args)
    {
        Console.WriteLine(new Foo<string>("myValue").IsValueAString);
        Console.WriteLine(new Foo<int>(1).IsValueAString);
        Console.ReadLine();
    }

    public class Foo<T>
    {
        public bool IsValueAString = false;
        public Foo(T value) {
            if (value is string)
            {
                IsValueAString = true;
            }
        }
    } 
```

另一种选择是创建 Foo 的具体实现，例如：

```
internal class Foo<T>
{
    ...
}
internal class MyFoo : Foo<string>
{
    ...
} 
```

并将任何特定逻辑嵌入到后代的构造函数中。这条路径上的各种选项都是可能的，因此您可以避免必须从该类中反映信息。

# sql - SQL Server：如何在查询中获取 XML 属性？

> ID：869405
> 
> 赞同：18
> 
> 时间：2009-05-15T15:37:29.997
> 
> 标签：sql, sql-server, xml

我目前正在尝试使用 SQL 查询从一些 XML 中获取所有属性。

我一直在尝试以下方法来检索它，但我一定错过了一些相当基本的东西。

```
DECLARE @T varchar(max) 
SET @T = 
'<root>
    <Field FieldRowId="1000">
    <Items>
        <Item Name="CODE"/>
        <Item Name="DATE"/>
    </Items>
        <Attributes>
        <Attribute ID ="1"/>
        </Attributes>
    </Field>
    <Field FieldRowId="2000">
    <Items>
                <Item Name="CODE"/>
                <Item Name="DATE"/>
    </Items>
    <Attributes>
        <Attribute ID ="2"/>
    </Attributes>
    </Field>
</root>'

DECLARE @X xml

SET @X = CAST(@T as xml)
SELECT Y.ID.value('@FieldRowId', 'int') as FieldID, 
   Y.ID.value('/Items/@Name', 'varchar(max)') as "Name",
   Y.ID.value('/Attributes/@ID', 'int') as AttributeID
FROM @X.nodes('/root/Field') as Y(ID) 
```

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-05-15T15:48:20.530

您将不得不尝试这样的事情：（@name 属性位于“Item”元素 - 而不是“Items”！）

```
SET @X = CAST(@T as xml)
SELECT 
   Y.ID.value('(@FieldRowId)[1]', 'int') as FieldID,
   Y.ID.value('(Items/Item/@Name)[1]', 'varchar(max)') as "Name",
   Y.ID.value('(Attributes/Attribute/@ID)[1]', 'int') as AttributeID
FROM @X.nodes('/root/Field') as Y(ID) 
```

马克

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-11-06T11:38:08.993

```
SELECT t1.fieldId, name, attributeId
FROM ( SELECT Y.ID.value('../../@FieldRowId', 'int') as FieldID
     , Y.ID.value('@Name', 'varchar(max)') as Name    
FROM @T.nodes('(/root/Field/Items/Item)') as Y(ID)
) t1 -- alias the first result 
JOIN
(SELECT Y.ID.value('../../@FieldRowId', 'int') as FieldID
    , Y.ID.value('@ID', 'int') as AttributeID
FROM @T.nodes('(/root/Field/Attributes/Attribute)') as Y(ID)
) t2 -- alias the second result 
on t1.fieldid = t2.FieldID -- join them on a common column 
```

# jquery - jquery load 方法是否提供与 Rails replace_html 方法等效的 ajax 功能？

> ID：869409
> 
> 赞同：6
> 
> 时间：2009-05-15T15:38:02.007
> 
> 标签：jquery, ruby-on-rails, ajax, dom

[jquery load 方法](http://docs.jquery.com/Ajax/load)从远程文件加载 HTML 并将其注入 DOM。例如，要将 feeds.html 文件加载到带有提要 ID 的 div 中，您可以这样做：

```
$("#feeds").load("feeds.html"); 
```

这是使用 Rails replace_html 方法调用部分的替代方法，还是功能略有不同？

```
page.replace_html 'feeds', :partial => 'main/feeds',
    :locals => {:feed =>  @feed_data } 
```

[编辑]：正如 Craig Stuntz 指出的那样，replace_html 返回 Javascript 而不是 HTML - 这有什么优点/缺点？这是否只是意味着您返回的片段具有更多的功能，就像使用 Javascript 的网页比普通的 HTML 页面更强大一样？还是有其他原因返回 Javascript 而不是 HTML？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-15T15:56:44.007

最终结果大致相同，但它们以非常不同的方式工作。load 方法意味着你的服务器返回一个 HTML 片段，然后 jQuery 将它插入到页面中。replace_html 方法意味着您的服务器正在返回 JavaScript 而不是 HTML，并且执行此 JavaScript 以将 HTML 片段插入页面。所以最终生成的 HTML 是一样的，但是客户端和服务器之间的流量却大不相同。

# sql-server-2008 - 我在 sqlserver2008 中的全文索引选项是灰色的？

> ID：869410
> 
> 赞同：11
> 
> 时间：2009-05-15T15:38:16.997
> 
> 标签：sql-server-2008, full-text-search

我在 sqlserver2008 中的全文索引选项是灰色的？

是单独安装吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-12-17T08:49:31.037

您可以通过执行[sp_fulltext_database](http://crazzycoding.blogspot.com/2010/12/sql-server-why-full-text-indexing.html)命令来启用它。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2013-05-30T02:15:31.163

确保已安装全文搜索功能。对您的数据库运行以下查询：

```
SELECT SERVERPROPERTY('IsFullTextInstalled') 
```

**结果“0”（零）表示服务器上未**安装 全文搜索。

**结果为“1”（一）表示在 SQL Server上**安装了全文搜索。

如果未安装，则需要重新运行 SQL Server 安装程序并添加全文搜索功能。这是一篇很好的文章，向您展示如何[验证和安装全文搜索](http://sqlish.com/installing-full-text-search-on-sql-server/)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-02-20T06:24:26.340

您需要执行此系统存储过程以启用全文索引：

```
--enable fulltext index
EXEC sp_fulltext_database 'enable' 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-17T02:55:11.497

您没有提及您使用的是哪个版本的 SQL Server，但如果是 SQL Express，您需要确保您已下载并安装了带有高级服务的 SQL Server 2008。“普通” SQL Server Express 安装不包括全文搜索（以将包大小保持在最小）。[在此处](http://www.microsoft.com/express/sql/download/http://www.microsoft.com/express/sql/download/)查看和下载各种版本。

如果您使用的是非快速版本，则需要确保您已安装全文搜索功能 - 如果尚未安装，请再次运行安装程序并在功能页面上选择“全文搜索”。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-06-27T19:16:01.240

我通过重新启动 SSMS 18.1 来解决问题

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-15T12:35:47.230

尝试创建一个新数据库，因为我也遇到了同样的问题。我刚刚创建了一个新数据库，很高兴看到启用了全文索引。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T16:06:57.677

你在哪里看它是灰色的？如果它在数据库上，您需要转到管理工作室中的存储/全文目录以更改 sql server 2008 中的全文设置。

您可以通过转到服务首先检查其安装；默认情况下，它似乎在安装后被禁用。如果未安装，您可以通过添加删除程序更改已安装的组件。

# jquery - 带圆角的 jquery 对话框

> ID：869413
> 
> 赞同：2
> 
> 时间：2009-05-15T15:39:22.270
> 
> 标签：jquery, modal-dialog

我在实现这一点时遇到了麻烦，我尝试了 jquery.corner.js 中corner() 函数的几种变体。有人可以在调用对话框或对话框本身的页面中粘贴代码的样子，以及它应该驻留在哪里的示例吗？

谢谢，娜塔莎

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T15:58:56.903

你用的是哪个角落插件？如果是这个：[JQuery Corner Plugin](http://www.malsup.com/jquery/corner/)那么它看起来很容易。例如，如果您的页面上有一个需要圆角的 div，它的 id 为“cornered”，那么我想代码会很简单：

```
<script language="javascript">
    $(document).ready(function() {
        $("#cornered").corner();
    });
</script> 
```

上述代码需要引用或放置在与需要圆角的 div/元素相同的页面中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T15:51:49.900

试试jquery.ui。[对话框控件](http://jqueryui.com/demos/dialog/)已经带有圆角。使用 jquery ui，您只需将“ui-corner-all”类添加到 html 项目以启用圆角（Internet Explorer 除外）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T17:48:54.080

与corner() 有点奇怪：它喜欢使用任何元素的背景颜色作为圆角的背景颜色。因此，如果您尝试对一个白色框进行四舍五入，并且它最初位于蓝色背景上，它将使用蓝色在角落处进行四舍五入。

确保在您的元素*结束后调用corner()；*否则，你会在那里得到颜色错误的角落。

# ios - 为 UITableViewCell 的附件视图使用自定义图像并让它响应 UITableViewDelegate

> ID：869421
> 
> 赞同：141
> 
> 时间：2009-05-15T15:40:35.837
> 
> 标签：ios, cocoa-touch, uitableview, uikit

我正在使用自定义绘制的 UITableViewCell，包括单元格的`accessoryView`. 我对附件视图的设置是通过以下方式进行的：

```
UIImage *accessoryImage = [UIImage imageNamed:@"accessoryDisclosure.png"];
UIImageView *accImageView = [[UIImageView alloc] initWithImage:accessoryImage];
accImageView.userInteractionEnabled = YES;
[accImageView setFrame:CGRectMake(0, 0, 28.0, 28.0)];
self.accessoryView = accImageView;
[accImageView release]; 
```

此外，当初始化单元格时，使用`initWithFrame:reuseIdentifier:`我确保设置以下属性：

```
self.userInteractionEnabled = YES; 
```

不幸的是，在我的 UITableViewDelegate 中，我的`tableView:accessoryButtonTappedForRowWithIndexPath:`方法（尝试重复 10 次）没有被触发。代表肯定接线正确。

可能缺少什么？

谢谢大家。

* * *

## 回答 #1

> 赞同：229
> 
> 时间：2009-05-15T16:25:19.723

遗憾的是，除非点击使用其中一种预定义类型时提供的内部按钮类型，否则不会调用该方法。要使用您自己的，您必须将附件创建为按钮或其他 UIControl 子类（我建议使用按钮`-buttonWithType:UIButtonTypeCustom`并设置按钮的图像，而不是使用 UIImageView）。

这是我在 Outpost 中使用的一些东西，它自定义了足够多的标准小部件（只是稍微地，以匹配我们的蓝绿色），我最终做了我自己的 UITableViewController 中间子类来保存所有其他表视图使用的实用程序代码（它们现在是子类OPTableViewController）。

首先，此函数使用我们的自定义图形返回一个新的详细信息披露按钮：

```
- (UIButton *) makeDetailDisclosureButton
{
    UIButton * button = [UIButton outpostDetailDisclosureButton];

[button addTarget: self
               action: @selector(accessoryButtonTapped:withEvent:)
     forControlEvents: UIControlEventTouchUpInside];

    return ( button );
} 
```

完成后，按钮将调用此例程，然后为辅助按钮提供标准 UITableViewDelegate 例程：

```
- (void) accessoryButtonTapped: (UIControl *) button withEvent: (UIEvent *) event
{
    NSIndexPath * indexPath = [self.tableView indexPathForRowAtPoint: [[[event touchesForView: button] anyObject] locationInView: self.tableView]];
    if ( indexPath == nil )
        return;

    [self.tableView.delegate tableView: self.tableView accessoryButtonTappedForRowWithIndexPath: indexPath];
} 
```

该函数通过从按钮提供的事件中获取触摸在表格视图中的位置并在表格视图中询问该点的行的索引路径来定位行。

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2010-10-06T20:03:41.367

我发现这个网站很有帮助： [在 iphone 中为您的 uitableview 自定义附件视图](http://www.edumobile.org/iphone/iphone-programming-tutorials/impliment-a-custom-accessory-view-for-your-uitableview-in-iphone/)

简而言之，在`cellForRowAtIndexPath:`：

```
UIImage *image = (checked) ? [UIImage imageNamed:@"checked.png"] : [UIImage imageNamed:@"unchecked.png"];

UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];
CGRect frame = CGRectMake(0.0, 0.0, image.size.width, image.size.height);
button.frame = frame;
[button setBackgroundImage:image forState:UIControlStateNormal];

[button addTarget:self action:@selector(checkButtonTapped:event:)  forControlEvents:UIControlEventTouchUpInside];
button.backgroundColor = [UIColor clearColor];
cell.accessoryView = button; 
```

然后，实现这个方法：

```
- (void)checkButtonTapped:(id)sender event:(id)event
{
    NSSet *touches = [event allTouches];
    UITouch *touch = [touches anyObject];
    CGPoint currentTouchPosition = [touch locationInView:self.tableView];
    NSIndexPath *indexPath = [self.tableView indexPathForRowAtPoint: currentTouchPosition];

    if (indexPath != nil)
    {
        [self tableView: self.tableView accessoryButtonTappedForRowWithIndexPath: indexPath];
    }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-05-04T16:55:20.080

我的方法是创建一个`UITableViewCell`子类并封装将在其中调用常用`UITableViewDelegate`方法的逻辑。

```
// CustomTableViewCell.h
@interface CustomTableViewCell : UITableViewCell

- (id)initForIdentifier:(NSString *)reuseIdentifier;

@end

// CustomTableViewCell.m
@implementation CustomTableViewCell

- (id)initForIdentifier:(NSString *)reuseIdentifier;
{
    // the subclass specifies style itself
    self = [super initWithStyle:UITableViewCellStyleValue1 reuseIdentifier:reuseIdentifier];
    if (self) {
        // get the button elsewhere
        UIButton *accBtn = [ViewFactory createTableViewCellDisclosureButton];
        [accBtn addTarget: self
                   action: @selector(accessoryButtonTapped:withEvent:)
         forControlEvents: UIControlEventTouchUpInside];
        self.accessoryView = accBtn;
    }
    return self;
}

#pragma mark - private

- (void)accessoryButtonTapped:(UIControl *)button withEvent:(UIEvent *)event
{
    UITableViewCell *cell = (UITableViewCell*)button.superview;
    UITableView *tableView = (UITableView*)cell.superview;
    NSIndexPath *indexPath = [tableView indexPathForCell:cell];
    [tableView.delegate tableView:tableView accessoryButtonTappedForRowWithIndexPath:indexPath];
}

@end 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-05-02T11:12:46.380

对吉姆·多维（Jim Dovey）上述回答的扩展：

将 UISearchBarController 与 UITableView 一起使用时要小心。在这种情况下，您要检查`self.searchDisplayController.active`并使用`self.searchDisplayController.searchResultsTableView`而不是`self.tableView`. 否则，当 searchDisplayController 处于活动状态时，您会得到意想不到的结果，尤其是在滚动搜索结果时。

例如：

```
- (void) accessoryButtonTapped:(UIControl *)button withEvent:(UIEvent *)event
{
    UITableView* tableView = self.tableView;
    if(self.searchDisplayController.active)
        tableView = self.searchDisplayController.searchResultsTableView;

    NSIndexPath * indexPath = [tableView indexPathForRowAtPoint:[[[event touchesForView:button] anyObject] locationInView:tableView]];
    if(indexPath)
       [tableView.delegate tableView:tableView accessoryButtonTappedForRowWithIndexPath:indexPath];
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-07-11T13:45:39.593

1.  为按钮标签定义宏：

    ```
    #define AccessoryViewTagSinceValue 100000 // (AccessoryViewTagSinceValue * sections + rows) must be LE NSIntegerMax 
    ```

2.  创建单元格时创建按钮并设置cell.accessoryView

    ```
    UIButton *accessoryButton = [UIButton buttonWithType:UIButtonTypeContactAdd];
    accessoryButton.frame = CGRectMake(0, 0, 30, 30);
    [accessoryButton addTarget:self action:@selector(accessoryButtonTapped:) forControlEvents:UIControlEventTouchUpInside];
    cell.accessoryView = accessoryButton; 
    ```

3.  在 UITableViewDataSource 方法中通过 indexPath 设置 cell.accessoryView.tag -tableView:cellForRowAtIndexPath:

    ```
    cell.accessoryView.tag = indexPath.section * AccessoryViewTagSinceValue + indexPath.row; 
    ```

4.  按钮的事件处理程序

    ```
    - (void) accessoryButtonTapped:(UIButton *)button {
        NSIndexPath *indexPath = [NSIndexPath indexPathForRow:button.tag % AccessoryViewTagSinceValue
                                                    inSection:button.tag / AccessoryViewTagSinceValue];

        [self.tableView.delegate tableView:self.tableView accessoryButtonTappedForRowWithIndexPath:indexPath];
    } 
    ```

5.  实现 UITableViewDelegate 方法

    ```
    - (void)tableView:(UITableView *)tableView accessoryButtonTappedForRowWithIndexPath:(NSIndexPath *)indexPath {
        // do sth.
    } 
    ```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-02-22T06:30:24.350

点击按钮时，您可以让它在 UITableViewCell 子类中调用以下方法

```
 -(void)buttonTapped{
     // perform an UI updates for cell

     // grab the table view and notify it using the delegate
     UITableView *tableView = (UITableView *)self.superview;
     [tableView.delegate tableView:tableView accessoryButtonTappedForRowWithIndexPath:[tableView indexPathForCell:self]];

 } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-10-05T21:41:54.720

您必须使用 a`UIControl`来正确获取事件调度（例如 a `UIButton`）而不是 simple `UIView/UIImageView`。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-07-02T18:30:52.663

使用 yanchenko 方法，我必须添加：`[accBtn setFrame:CGRectMake(0, 0, 20, 20)];`

如果您使用 xib 文件来自定义您的 tableCell 然后 initWithStyle:reuseIdentifier: 不会被调用。

而是覆盖：

```
-(void)awakeFromNib
{
//Put your code here 

[super awakeFromNib];

} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-06-05T17:45:49.100

**斯威夫特 5**

这种方法`UIButton.tag`使用基本位移来存储 indexPath。只要您没有超过 65535 个部分或行，该方法将适用于 32 位和 64 位系统。

```
public func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {

    let cell = tableView.dequeueReusableCell(withIdentifier: "cellId")
    let accessoryButton = UIButton(type: .custom)
    accessoryButton.setImage(UIImage(named: "imageName"), for: .normal)
    accessoryButton.sizeToFit()
    accessoryButton.addTarget(self, action: #selector(handleAccessoryButton(sender:)), for: .touchUpInside)

    let tag = (indexPath.section << 16) | indexPath.row
    accessoryButton.tag = tag
    cell?.accessoryView = accessoryButton

}

@objc func handleAccessoryButton(sender: UIButton) {
    let section = sender.tag >> 16
    let row = sender.tag & 0xFFFF
    // Do Stuff
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-11-03T19:33:12.880

从 iOS 3.2 开始，您可以避免使用此处其他人推荐的按钮，而是使用带有轻击手势识别器的 UIImageView。一定要启用用户交互，在 UIImageViews 中默认是关闭的。

# firefox - 在Firefox中修改div onclick大纲

> ID：869432
> 
> 赞同：3
> 
> 时间：2009-05-15T15:43:16.033
> 
> 标签：firefox

在 Firefox 中，每当单击链接时，项目周围都会有一个虚线轮廓。

是否可以修改它以便我可以选择突出显示的 div，或自定义它概述的区域？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T16:02:05.210

我想你会想看看[Removing Dotted Links](http://sonspring.com/journal/removing-dotted-links)。

如果要为基于选项卡的导航保留虚线边框，请将其应用于`a:active`. 这仍然允许指示器在通过键盘聚焦时出现，但在鼠标激活时隐藏：

```
a:active
{
    outline: none;
} 
```

对于所有链接：

```
a
{
    outline: none;
} 
```

仅适用于基于 Mozilla 的浏览器：

```
:focus
{
    -moz-outline-style: none;
} 
```

不过，这只回答了你一半的问题。要更改虚线轮廓的区域，您可能必须编写一些 JavaScript 来根据链接的单击事件更改要勾勒的元素的边框或轮廓。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T16:02:15.693

在 CSS 中：

```
a:active{outline:0;border:(customize the border around the active link)} 
```

对于 div（使用 JQuery）：

```
$(function(){ 
    $('div#your-id').click(function(){ 
        $(this).css({'enter the CSS rules for the div here'}); 
    }); 
}); 
```

[http://docs.jquery.com/CSS/css#name](http://docs.jquery.com/CSS/css#name)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-01-04T10:33:16.997

*CSS：*

```
:focus {outline:none;}
::-moz-focus-inner {border:0;} 
```

# .net - 根据两个或多个值对通用列表进行排序

> ID：869438
> 
> 赞同：19
> 
> 时间：2009-05-15T15:43:42.540
> 
> 标签：.net, vb.net, generics, sorting, lambda

我们有一个通用 List(Of Product) ，它必须根据 Product 类的两个或多个属性进行排序。

产品类具有“流行”数字 (asc)、“点击”数字 (desc)、“名称”字符串 (asc) 属性。为了命名属性，我们希望对列表进行排序。

如何使用 Lamba 语句进行排序？如果您发现根据一个属性对列表进行排序。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-05-15T15:52:20.710

**编辑**刚刚意识到这是一个 VB 问题。这是 VB.Net 解决方案

```
Dim list = GetSomeList()
Dim sorted = list. _
  OrderBy(Function(x) x.Popular). _
  ThenBy(Function(x) x.Clicked). _
  ThenBy(Function(x) x.Name) 
```

C# 版本。尝试以下

```
var list = GetSomeList();
var sorted = list.OrderBy(x => x.Popular).ThenBy(x => x.Clicked).ThenBy(x => x.Name); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-15T16:15:15.303

要回答您关于 lambda 表达式的问题，因为 VB 不支持多行 lambda 表达式，所以放入 lambda 表达式太复杂了。

对于非 LINQ 解决方案：

您需要一个命名方法作为比较器：

```
Private Function Comparer(ByVal x As Product, ByVal y As Product) As Integer
    Dim result As Integer = x.Popular.CompareTo(y.Popular)
    If result = 0 Then
        result = x.Clicked.CompareTo(y.Clicked)
        If result = 0 Then
            result = x.Name.CompareTo(y.Name)
        End If
    End If
    Return result
End Function 
```

用法：

```
theList.Sort(AddressOf Comparer) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-03-26T11:34:43.313

```
List<Product> sortedProducts = null;
sortedProducts = products.OrderBy(p => p.Popular)
                         .ThenByDescending(p => p.Clicked)
                         .ThenBy(p => p.Name)
                         .ToList(); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-15T15:52:17.667

对不起，你知道 C# 吗？

```
products.OrderBy(p => p.Popular).
    ThenByDescending(p => p.Clicked).
    ThenBy(p => p.Name); 
```

你能从中得到你需要的东西吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-01-14T18:17:32.800

也可以使用 List.Sort lambda 函数进行复合排序。这是一个 vb.Net 示例：

```
 Dim Conts As List(of clsContact)
    Conts.Sort(Function(C1 As clsContact, C2 As clsContact)
        Dim CompRes As Integer = C1.Contact_LastName.CompareTo(C2.Contact_LastName)
        If CompRes = 0 Then
            CompRes = C1.Contact_FirstName.CompareTo(C2.Contact_FirstName)
        End If

        Return CompRes
    End Function) 
```

# sql - MySql 中的关系规则

> ID：869443
> 
> 赞同：2
> 
> 时间：2009-05-15T15:45:37.293
> 
> 标签：sql, mysql

如何在mysql中定义关系规则？

表1：bookId authorId bookName

表 2：作者 ID 作者姓名

这就是我希望 Mysql 服务器的行为方式：当我尝试使用 table2 中不存在的 authorId 将一行插入 table1 时，mysql 会产生错误。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-15T15:51:49.867

您必须将 authorid 定义为外键。你需要做这样的事情：

```
Alter Table Table1 Add Foreign Key (authorid) References Table2 (authorid); 
```

确保您的表是 innodb，因为它不适用于 myisam 表。[您可以在此处](http://dev.mysql.com/doc/refman/5.1/en/innodb-foreign-key-constraints.html)找到文档。

# c# - 在 C# 中创建运行时可编辑连接器控件？

> ID：869447
> 
> 赞同：1
> 
> 时间：2009-05-15T15:46:28.913
> 
> 标签：c#

我正在 C# 中开发运行时可编辑控件，其中将在运行时添加控件，但现在我坚持创建连接器控件。

我的意思是连接器就像我们通常在工作流或 Visio 中连接两个组件一样。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-05T22:15:41.600

不幸的是，创建一个独立的“连接器”控件很困难。这将涉及创建一个具有[透明背景](http://msdn.microsoft.com/en-us/library/wk5b13s4(VS.71).aspx)的控件。

然后您将处理绘制样式连接器所需的渲染代码（但是您想这样做，一条简单的线或更复杂的东西）。如果您不确定如何绘制，请查看[Graphics](http://msdn.microsoft.com/en-us/library/system.drawing.graphics.aspx)类以及它如何与[Bitmap](http://msdn.microsoft.com/en-us/library/system.drawing.bitmap.aspx)类一起使用。

您还可以在连接器的末端渲染小方块以用作手柄来拖动连接器（以连接到其他组件）。您必须进行命中测试以确定用户鼠标按下的方格。并在他们将鼠标悬停在另一个组件上时再次点击测试（以存储连接器“连接”到的组件）。

您还可以添加选择在线上将线分成两个或更多线段的其他点的功能。这将允许您建立不是简单直线的连接。这将再次涉及在线命中测试，并使鼠标代码更加复杂。

您需要通过修改其 z 顺序属性并添加连接器和组件来确保每个连接器控件都高于每个组件控件。

* * *

另一种选择是创建一个包含您的组件的容器控件。容器控件将对所有鼠标事件做出反应，并简单地将连接绘制到自身上（它当然也必须存储连接信息）。这种方法不同，因为连接器不是控件，它们只是直接绘制在容器上。

* * *

最后，如果您正在寻找一种自动布局组件的方法，[这里](http://en.wikipedia.org/wiki/Graph_drawing)是一个起点。

# java - 我怎样才能拥有一个从 Java 中的抽象基类型派生的单例？

> ID：869449
> 
> 赞同：11
> 
> 时间：2009-05-15T15:47:19.770
> 
> 标签：java, inheritance, singleton

我有一些用作单例的类。它们共享一些基本功能，并从通常不用作 Singleton 的库中扩展相同的祖先。

如果我将通用功能放在继承自共同祖先的基类中，我会得到一个实例化没有意义的类，因此我将其抽象化。此外，因为这些类都用作单例，所以它们都应该有一个 init() 和一个 getInstance() 方法，它们都是静态的。所有的构造函数当然都是非公开的。

现在，由于`static`是抽象方法的非法修饰符，因此以下内容不起作用，尽管这正是我想要的：

```
class Base extends LibraryClass {
    protected Base() {
        // ... constructor
    }

    // ... common methods

    // ILLEGAL!
    public static abstract void init();
    public static abstract <T extends Base>T getInstance();
}

class A extends Base {
    private static A _INSTANCE;

    private A() {
        super();
    }

    public static void init() {
        _INSTANCE = new A();
    }

    public static A getInstance() {
        return _INSTANCE;
    }
} 
```

我可以忽略基类中的非法行并完成它。但是我如何表达Base的每个孩子都*必须*有这些方法呢？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-15T15:52:43.140

这在 Java 中是不可能的。方法的存在`static`不能被强制执行；既不通过`abstract`也不使用`interface`.

我的解决方案是以某种方式使用 IoC：我为单例创建了一个工厂类。它会将单身人士保存在地图中。关键是班级。这样，我可以说：

```
A singleton = Factory.create (A.class); 
```

这种设计的主要优点：我可以创建一个`Factory.replace()`测试用例可以覆盖单例的方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T16:19:57.757

处理将单例语义添加到可能不方便正确添加语义的类的常见方法是在包装类中实现单例功能。例如：

```
public class UsefulThing {

}

public final class SingletonOfUsefulThing {
    private static UsefulThing instance;

    private SingletonOfUsefulThing() {}

    public UsefulThing getInstance() {
        if (instance == null) {
            instance = new UsefulThing(); 
        }

        return instance;
    }
} 
```

这使您可以为类提供一些主要的单例好处，而不会产生在类中实现单例语义直接迫使您处理的一些后果，并为更改您所公开的类的特定类型留出一些空间作为一个单例（例如，通过使用工厂来创建实例，而不是`new`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-15T15:51:46.217

您不能表示子类具有特定的*静态*方法。

事实上，应该没有必要这样做，因为静态方法只会直接在子类上调用（`A.init()`在`A.getInstance()`您的示例中），并且永远不会通过对基类的引用（即静态方法不支持多态性）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T15:53:24.217

为什么不一路走下去，让你的工厂（在基类中）传入一个参数，指示你希望它返回哪个子类。这样做有很多优点，而缺点很少。

您尝试这样做的方式没有多大意义，因为静态方法与普通方法处理继承的方式不同。

# php - 重新排序订单以提高仓库效率

> ID：869456
> 
> 赞同：3
> 
> 时间：2009-05-15T15:48:13.183
> 
> 标签：php, algorithm, language-agnostic, sorting

我正在尝试优化我工作中订单的填写方式。现在，一名员工只需获取最新的 16 个订单（有时是 14 个或 18 个）并填写它们。

我试图改变它，而不是简单地通过最新的订单列表，而是订购它们，以便每批在相似的位置都有订单。但我不知道我应该如何对列表进行排序。下面是我想要做的一个简化示例。

示例订单列表：

*   订单 1：位置 E 的 2 个产品，位置 Q 的 5 个产品
*   订单 2：Z 位置 1 个，B 位置 20 个
*   订单 3：位置 Y 中的 1 个，位置 N 中的 1 个
*   订单 4：3 在位置 B
*   订单 5：1 个在位置 A，10 个在位置 E
*   订单 6：1 个在位置 A，1 个在位置 B，5 个在位置 Q

对列表进行排序后，我希望订单 2 和 4 彼此相邻，1 和 6 彼此相邻，等等。这样的事情：

*   订单 1：位置 E 的 2 个产品，位置 Q 的 5 个产品
*   订单 6：1 个在位置 A，1 个在位置 B，5 个在位置 Q
*   订单 2：Z 位置 1 个，B 位置 20 个
*   订单 4：3 在位置 B
*   订单 3：位置 Y 中的 1 个，位置 N 中的 1 个
*   订单 5：1 个在位置 A，10 个在位置 E

我正在使用 PHP，但任何语言的任何示例或提示都会非常有帮助。

编辑：

让我尝试更详细地解释这一点。员工抓起一批订单，然后他们使用带有条形码扫描仪的 PDA 填写订单。我们的仓库设置为首先位置 A，其次是 B，依此类推。根本不涉及回溯。通常，他们必须走遍整个仓库才能完成这批订单，因为平均而言，这 16 个订单将有来自所有位置的产品。

如果我将下一个订单的排序从订单日期更改为订单产品的位置，那么一批订单可能只有位置 AG，而不必走整个仓库。

另一个编辑（我真的需要更好地发布好的细节）

这是我们目前的流程：

1.  Picker 抓起一辆装有 16 个桶的推车
2.  Picker 通过 PDA（带有扫描仪和 wifi）将桶中的 16 个唯一条形码扫描到网页上，并创建“拣货单”
3.  产品按位置排序（拣货员只经过任何产品一次）
4.  然后，特殊网页会告诉员工要抓取的产品和数量，然后他们会扫描产品上的条形码
5.  然后它会说将产品放入哪个桶中，然后他们扫描将产品放入的桶上的条形码
6.  挑选完所有产品后，Picker 前往发货站，将其中一个桶扫描到一个 VB 程序中（是的，我知道。总有一天会转换）
7.  为该“拣货单”中的所有订单打印收据，并将其放入正确的存储桶中
8.  每个桶都被清空并打包
9.  Picker 现在托运人将包装好的订单放在秤上，并将收据上的条形码扫描到程序中。
10.  自动打印正确的邮资，订单标记为已发货，并向客户发送一封包含跟踪信息的电子邮件
11.  发件人将邮资标签贴在页面上，将其密封并放入成品包裹堆中
12.  一天结束时，USPS 和 UPS 会取货。

我还应该注意，我们的很多/大部分产品都很小，一张 16 份订单的“拣货单”可以有 500-800 件单件。目前，我们有大约 28,000 种不同的产品库存。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T17:20:43.257

正如我在对该问题的评论中所写的那样，我认为您只是以错误的方式看待问题。

您的描述暗示他们可以在必须“建造”/完成订单之前前往所有地点。问题是现在，事情是按照订单进行分组的，所以他们试图通过前往所有需要的位置来填写订单#1，然后他们开始查看订单#2，等等。

相反，您需要向他们提供有关位置的汇总信息，以及他们需要在每个地点获取的信息。然后他们只是去所有地点，以任何顺序，并从每个地点拿起他们需要的一切。当他们去过所有地点时，他们会浏览列表并从一大堆东西中填写订单。

如果我在这里做了一些不正确的假设，请告诉我，我会尝试提出不同的方法。

* * *

只是为了尝试消除差异，这是员工在每种方法中的动议（前两个不确定，因为他们可能以不同的顺序前往地点，我只是按照您列出的确切顺序，作为员工可能会）。

**原始按日期排序（12 步）：**

```
E > Q > Z > B > Y > N > B > A > E > A > B > Q 
```

**您重新排序的版本（10 步）：**

```
E > Q > A > B > Z > B > Y > N > A > E 
```

**通过按位置聚合（7 次移动）：**

```
A > B > E > N > Q > Y > Z 
```

为了进一步强调差异，如果我假设您的所有位置都与前一个位置等距（因此从 A 移动到 B 的成本为 1），并且每个字母都有一个。还假设您都想在位置 0 开始和结束，您有：

**原始按日期排序：**移动量 = 138
**您重新排序的版本：**移动量 = 138 *（这有点令人惊讶）*
**按位置聚合：**移动量 = 52

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T19:37:42.977

我认为这里最好的解决方案是将拣货和包装阶段分开。

这是它在我的工作场所的工作方式

1.  分配订单批次（一般根据发货方式和/或网站订单来源）
2.  拣货员被分配，拣货单打印，包含产品清单和数量（不特定于订单）
3.  拣货员去拣货，带回车站。
4.  物品在 PC 上进行扫描，并经过“结帐”过程。这可以确保选择器正确地选择了所有东西。
5.  发票已打印
6.  批量包装，扫描每张发票，然后是订单物品，包装，放入运输箱
7.  循环浏览订单
8.  完成批次，向客户发送电子邮件/短信，说明他们的订单正在发货
9.  皇家邮政/其他运输公司来取走订单

我们发现这非常有效，尤其是每个阶段的确认。

我们目前正在用 PHP 重新实现所有东西，这对我们来说非常好。

我的建议是，重新考虑你的工作流程

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T19:57:55.050

这个问题似乎自相矛盾 - 编辑之前的第一部分处理订单的*排序*，而编辑讨论的是获得正确的订单*批次*以提供给用户。我将假设您的编辑更正确，并讨论批处​​理而不是订购。

听起来，在最坏的情况下，员工需要走遍所有地点（我假设是 AZ），然后返回 A 开始下一批订单。鉴于此假设，您似乎只是在尝试创建最大位置小于 Z 的批次。换句话说，如果您有六个订单，您将分为两个批次，如下所示：`[A, Y, B, G, Y, Z]`，您将它们拆分为`[ABG]`和`[YYZ]`。因此，我认为该算法将非常简单：

1.  遍历每个订单并计算最大距离项目。
2.  按最大位置对订单进行排序。
3.  根据此排序返回批次。

例如，假设我们有四个订单，我们要从中分两批：（A，B），（A，Y），（F，G），（E，P）。然后我们将它们的最大距离项计算为 [B, Y, G, P]。排序后，我们最终得到 [B, G, P, Y]。因此第一批将包含#1 和#3，第二批将包含#2 和#4。无论如何，包含 Y 的订单都必须从 A 一直到 Y，因此它还需要 A 中的商品没有区别；但是通过将#1 和#3 保持在一起，其中一名员工走路的次数减少了很多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T16:26:13.997

通过使用[usort](http://us.php.net/manual/en/function.usort.php)，您可以自定义定义您的排序方法。这样，基于数组（列表），您可以比较元素并将该数组以您希望的最佳顺序放置，而不仅限于键或值。您可以使用数组本身中的对象，并确定顺序应该是什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T16:47:02.840

这是一个复杂的问题，听起来像旅行推销员。

您可以做的是：
按所有可能的顺序创建列表。
根据每行之间的连接数计算每个列表的分数。

例如：如果 order2 后跟 order6，则得分为 1，因为 1 个位置 (B) 是重叠的。如果下一个订单是 order3，则分数将增加 0，因为 Y 或 N 都不是 order6。

得分最高的列表处于最佳顺序。

对于列表中的 18 个元素，有 18 个！= 6402373710000000 种排序列表的可能方式。所以我会以随机顺序创建 10 到 20 个列表，然后选择得分最高的列表。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-15T19:21:55.480

您可能在这里缺乏重点：太多细节，例如您使用的编程语言、最终用户使用的 PDA/扫描仪类型等。

您只需要一件事：两个元素**的传递比较 (<) 运算符**（传递含义，如果 A<B 和 B<C 则始终 A<C）。如果你有这个运算符，你就有了一个排序。

专注于这一件事，并在必要时与您的客户讨论需求。如果定义运算符 < 太复杂，客户很可能对解决方案不满意。

# .net - 如何添加在自定义 msbuild 任务中创建的文件以供以后构建操作？

> ID：869458
> 
> 赞同：0
> 
> 时间：2009-05-15T15:48:57.237
> 
> 标签：.net, msbuild

我正在使用自定义 msbuild 任务生成缩小的 javascript 文件。这个动作是在“BeforeBuild”完成的。我希望在生成这些生成的 javascript 文件后将它们包含为“EmbeddedResource”。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T16:56:53.627

通过使用

```
<CreateItem Include="FilesToConvert">
        <Output TaskParameter="Include" ItemName="EmbeddedResource" />
</CreateItem> 
```

# java - 在 AS3Crypto 和 Javax.Crypto 之间加密/解密 ECB/PKS5/Blowfish 失败并出现填充错误

> ID：869470
> 
> 赞同：0
> 
> 时间：2009-05-15T15:49:59.030
> 
> 标签：java, actionscript-3, encryption, padding, blowfish

我有一个作为文件发送给我的密钥，因此我可以使用 Blowfish 加密一些 xml 数据。如何访问密钥以便可以将其与 AS3Crypto 一起使用？我假设我需要使用 [Embed] 元标记嵌入它。它是 mimeType="application/octet-stream" 但我不确定这是否正确。如何嵌入，然后将此文件作为密钥引用？我正在加密的 xml 无法在 Java 端解密。每次尝试都失败，但出现以下异常：

javax.crypto.BadPaddingException：给定最终块未正确填充。

作为奖励，如果有人有使用 lib 来处理 Java 实现的经验并且知道使用的理想模式/填充/IV，那将是很棒的。谢谢！

```
//keyFile is an embedded asset. I was given a file to use as the key
var kdata:ByteArray = new keyFile() as ByteArray;

//Convert orderXML to Base64
var orderData:ByteArray = Base64.decodeToByteArray(String(orderXML));

//Cipher name   
var cname:String = "simple-blowfish-ecb";

var pad:IPad = new PKCS5;
var mode:ICipher = Crypto.getCipher(cname, kdata, pad);

//not sure if this is necessary. seems to be also set in mode
pad.setBlockSize(mode.getBlockSize());

mode.encrypt(orderData);

var transmitXML:String = Base64.encodeByteArray(orderData);

//DEBUG: Output to TextArea
storePanel.statusBox.text += "\n--TRANSMIT--\n"+transmitXML; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-09-01T02:48:41.123

不知道如果您仍然不确定如何嵌入二进制数据，但您对使用`[Embed]`标签的看法是正确的（这当然是一种很好的方法）。

我经常这样嵌入：

```
[Embed(source="myKeyFile.key", mimeType="application/octet-stream")]
private const _KeyFile:Class;
private var keyFile:ByteArray = new _KeyFile();

...

trace(keyFile.length + " bytes"); // XYZ bytes 
```

更多信息： [http ://dispatchevent.org/roger/embed-almost-anything-in-your-swf/](http://dispatchevent.org/roger/embed-almost-anything-in-your-swf/)

# javascript - 使用id问题获取元素

> ID：869474
> 
> 赞同：0
> 
> 时间：2009-05-15T15:50:58.357
> 
> 标签：javascript, dom

我正在修改现有的旧网页（我不应该修改现有的部分，而是添加）并且网页使用 document.write 来编写某些 html 元素。当我使用

```
<script type="text/javascript" language="javascript">
   var  v = document.getElementById('td_date_cal_0');
   alert(v);
</script> 
```

v 变为空，当我创建按钮并单击时

```
<input type="button" id="mnbutton" onclick="mnLoader();" value="Click Me!" />;
<script type="text/javascript" language="javascript" >
    function mnLoader() {
        var v = document.getElementById("td_date_cal_0");
        alert(v); 
    } <br />

</script> 
```

任何想法，如何在不需要用户操作（例如单击）的情况下获取元素？

谢谢，埃贝

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-15T15:55:40.497

尝试将脚本附加到或的`onload`事件。`document``window`

```
function mnLoader() {
 var v = document.getElementById("td_date_cal_0");
 alert(v); 
}
// Execute the function after the page has loaded
document.onload = function() {
 mnLoader();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T15:54:54.180

我猜您将脚本元素放在您尝试获取的元素之前。

解决此问题的最简单方法是将脚本元素放在正文元素的 END 标记之前。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T15:57:29.090

我预计会发生这种情况，因为脚本在创建 ID 为“td_date_cal_0”的元素之前运行。

尝试将脚本移动到它正在操作的元素下方，或者将代码连接到 document.onload 事件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T16:04:04.847

@Mathias 给出了一个很可能解决您的问题的示例。也就是说，您尝试使用 document.getElementById 访问的元素在您尝试时尚未加载到 DOM 中。

但是，如果您对能够尽早运行代码感兴趣，更好的解决方案是观察**“dom:loaded”事件**或 DOM 就绪事件。这比调用*window.onload要复杂一些，但*[Prototype.js](http://www.prototypejs.org/api/document/observe)或[jQuery](http://jquery.com/)等框架可以提供帮助。

请参阅Michael Sharman 讨论此功能的[页面。](http://www.chapter31.com/2008/01/23/taking-advantage-of-dom-on-ready-and-event-observers-using-prototypejs/)

然后，您可以编写如下代码：

```
 document.observe(document, 'dom:loaded', initFunction);   

function initFunction()  
{  
  // this code will run as soon as DOM is loaded, 
  // but before any images are loaded
} 
```

显然，如果您不想使用框架，则可以仅使用标准 javascript 调用来复制行为，但您必须准备好处理浏览器之间的差异。您可以先查看**onreadystatechanged**事件和其他浏览器的类似事件（即**DOMContentLoaded**）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-07-01T09:42:03.900

以下代码正常工作。

```
<input type="text" id="xxxx"/>
<input type="button" id="mnbutton" onclick="mnLoader();" value="Click Me!" />;
<script>
        function mnLoader() {
        var v = document.getElementById("xxxx").value;
        alert(v); 
        }
</script> 
```

# algorithm - 将帧转换为 NTSC 丢帧时间码

> ID：869490
> 
> 赞同：3
> 
> 时间：2009-05-15T15:52:59.413
> 
> 标签：algorithm, delphi, language-agnostic, video

我正在寻找一个将帧中的整数值转换为 NTSC 丢帧时间码 (hh:mm:ss.ff) 的函数。

我正在使用 Delphi，但可以使用任何语言。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-05-21T06:43:19.040

这个问题有一个众所周知的*经典解决方案*......

*   输入帧数 nr 是相对于实际帧速率的，对于 NTSC，它*总是*30000/1001 ~= 29.97 帧每秒
*   计算结果 frame-nr 是标称帧速率 30fps（并且每整分钟都会显示 +2 帧跳跃，除非该分钟可被 10 整除

（当然，如果您知道您的值范围有限，您可以使用较小的 int 类型）

```
const uint FRAMES_PER_10min = 10*60 * 30000/1001;
const uint FRAMES_PER_1min  =  1*60 * 30000/1001;
const uint DISCREPANCY      = (1*60 * 30) - FRAMES_PER_1min;

/** reverse the drop-frame calculation
 * @param  frameNr raw frame number in 30000/1001 = 29.97fps
 * @return frame number using NTSC drop-frame encoding, nominally 30fps
 */
int64_t
calculate_drop_frame_number (int64_t frameNr)
{
  // partition into 10 minute segments
  lldiv_t tenMinFrames = lldiv (frameNr, FRAMES_PER_10min);

  // ensure the drop-frame incidents happen at full minutes;
  // at start of each 10-minute segment *no* drop incident happens,
  // thus we need to correct discrepancy between nominal/real framerate once: 
  int64_t remainingMinutes = (tenMinFrames.rem - DISCREPANCY) / FRAMES_PER_1min;

  int64_t dropIncidents = (10-1) * tenMinFrames.quot + remainingMinutes;
  return frameNr + 2*dropIncidents;
}                 // perform "drop" 
```

从产生的“丢弃”帧数中，您可以像往常一样使用标称的 30fps 帧速率计算组件...

```
frames  =    frameNumber % 30
seconds =   (frameNumber / 30) % 60 
```

等等...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T16:50:00.943

```
function FramesToNTSCDropFrameCode(Frames:Integer;FramesPerSecond:Double):string;
var
  iTH, iTM, iTS, iTF : word;
  MinCount, MFrameCount : word;
begin
  DivMod( Frames, Trunc(SecsPerMin * FramesPerSecond), MinCount, MFrameCount );
  DivMod( MinCount, MinsPerHour, iTH, iTM );
  DivMod( MFrameCount, Trunc(FramesPerSecond), ITS, ITF );
  Result := Format('%.2d:%.2d:%.2d.%.2d',[iTH,iTM,iTS,iTF]);
end; 
```

您将需要从 SysUtils 单元复制 DivMod 例程，并在实现此功能的任何内容中包含 sysUtils 单元。

# functional-programming - Y-Combinator 实际示例

> ID：869497
> 
> 赞同：40
> 
> 时间：2009-05-15T15:54:14.933
> 
> 标签：functional-programming, y-combinator

我最近读了一些关于函数式编程的书，我正在尝试了解 Y-Combinator。我知道您可以使用 Y-Combinator 以不直接支持递归的语言有效地实现递归。但是，我可能使用的每种语言都已经支持递归，所以我不确定使用 Y-Combinator 会有多大用处。

是否有我缺少的 Y-Combinator 使用的更好的实际示例？有没有人在实际生产代码中实际使用过一个？或者使用 Y-Combinator 真的只是一个令人费解的学术练习（尽管很酷）。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-05-16T00:43:02.947

我不同意其他答案：**定点 (Y) 组合*器确实*有实际应用**，但要找到它们需要非常有想象力的头脑。就像布鲁斯麦克亚当一样。这是他的论文[That About Wraps Up](http://www.lfcs.inf.ed.ac.uk/reports/97/ECS-LFCS-97-375/)的摘要：

> 用于计算不动点的 Y 组合子可以用标准 ML 表示。它经常被用作高阶函数功能的示例，但通常不被视为有用的编程结构。在这里，我们将了解基于 Y 组合器和包装器的编程技术如何使程序员能够对函数的内部工作进行一定程度的控制，而这在不重写和重新编译代码的情况下是不可能实现的。作为一个实验，类型推断算法 W 是使用这种技术实现的，因此产生的错误消息对算法的干扰最小。此示例程序的代码说明了这些概念的真正有用性以及应用它们的难易程度。还讨论了许多其他实现技术和可能的应用，

这是一篇很棒的论文；任何对函数式编程感兴趣的人都可能会喜欢阅读它。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-15T17:22:22.520

您可以查看这篇关于在 C# 中实现 Y Combinator 的漂亮帖子：[递归 Lambda 表达式](http://blogs.msdn.com/madst/archive/2007/05/11/recursive-lambda-expressions.aspx)，它可能会帮助您更好地理解这个想法。

您可能想查看 Wikipedia 上的一些不错的文章：[定点组合](http://en.wikipedia.org/wiki/Fixed_point_combinator)器和[定点定理](http://en.wikipedia.org/wiki/Fixed-point_theorem#Fixed_point_theorems_in_discrete_mathematics_and_theoretical_computer_science)

正如 Nathan 所说，许多函数技术都与 Y 组合器相关并且很有用，所以坚持下去！Y 确实很有用，因为它可以让您更好地理解您的代码，但我认为这对于描述它如何提供帮助并不是特别有帮助。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-15T16:11:24.843

如果我错了，其他人可以纠正我，但我很确定 Y 组合器是严格的学术性的。想一想：要实现它，您的语言需要支持高阶函数而不是递归。我只知道一种这样的语言：lambda calculus。

因此，在我们的机器从图灵机切换到在 lambda 演算上运行之前，Y 组合器将是严格的学术性的。

注意：与 Y 组合器相关的其他函数技术*也*很有用，因此请坚持使用。了解 Y 组合器将帮助您了解延续、惰性求值等。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-15T17:14:52.773

您可以将组合器视为运行您的函数的虚拟机，您可以通过非递归函数（= 高阶函数）来描述它。

有时最好让这个组合器受程序控制，做与面向方面编程（记忆、跟踪等）类似的事情，但我所知道的任何编程语言都不允许这样做。可能大多数时候它太麻烦和/或太难学了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-02-14T10:13:57.487

```
let sprite = pipe4 sprite_start blanks (manyTill attribute newline) blanks (fun a b c _ -> Sprite(a,c))

let sprites = 
    let rec y f x = f (y f) x // The Y Combinator
    //let rec sprites_up = many1Indents sprite sprites_up |>> (fun x -> SubSprites x) // Does not work.
    let sprites_up = y (fun f -> many1Indents sprite f |>> (fun x -> SubSprites x))
    many1Indents sprite sprites_up 
```

这是我在 F# 中制作的小型游戏库的编译器示例。更具体地说，在上面我需要让 sprites_up 递归调用自身，否则缩进解析器将无法正常工作。

如果没有 Y Combinator，我无法正确完成解析器，不得不求助于编写如下内容：

```
let sprites_up4 = many1Indents sprite error |>> (fun x -> SubSprites x) 
let sprites_up3 = many1Indents sprite sprites_up4 |>> (fun x -> SubSprites x) 
let sprites_up2 = many1Indents sprite sprites_up3 |>> (fun x -> SubSprites x) 
let sprites_up1 = many1Indents sprite sprites_up2 |>> (fun x -> SubSprites x) 
let sprites_up = many1Indents sprite sprites_up1 |>> (fun x -> SubSprites x) 
```

这不是一个很好的解决方案，Y Combinator 真的救了我。不过，这当然不是首先想到的。

# php - 内存/优化问题

> ID：869502
> 
> 赞同：1
> 
> 时间：2009-05-15T15:55:43.273
> 
> 标签：php, mysql, optimization, memory-management

我正在处理一个复杂的脚本，它可以处理多达 500,000 条记录。这是我的问题。

基本上，我的代码将解析一个文本文件以获取这 500,000 条左右的记录中的每一条。每条记录都有一个类别，我的代码需要检查`categories`在特定处理期间是否为该类别创建了表中的新记录，如果没有，它将创建该记录。

所以我有两个选择：

1）我存储了一个包含类别名称和ID的键=>值数组，所以我可以这样做：

```
if (array_key_exists($category,$allCategories))
   $id=$allCategories[$category];
else
{
   mysql_query("INSERT INTO categories (procId,category) 
                       VALUES ('$procId''$category')");
   $id=mysql_insert_id();
   $allCategories[$category]=$id;
} 
```

2）每次处理这个文本文件，都会得到自己的进程ID。因此，与其检查`$allCategories`可能增长到 100,000 多个条目的变量，我可以这样做：

```
SELECT id FROM categories WHERE procId='$procId' AND category='$category' 
```

这里的缺点是这个查询将针对 500,000+ 条记录中的每一条运行。而将所有类别保存在一个数组中的缺点是我可能会耗尽内存或服务器可能崩溃。

有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T16:00:51.610

你能只保留一个你已经插入的ID列表吗？如果它们是整数 id，则每次 4 个字节，100,000 个条目将仅使用大约 400K 的内存。

预计到达时间：

为避免存储类别名称，请对名称进行散列并存储散列。使用 128 位 MD5 散列，即每个散列 16 个字节或仅约 1.6MB 的内存 + 开销。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T16:03:00.417

一个想法是在表上添加一个约束，以便数据库拒绝重复插入。然后继续插入所有记录并让数据库进行检查。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T16:24:52.067

Given that your average category name is 30 bytes, you'd only need 30 * 500000 bytes = 15000000 bytes = 15000 kilobytes = 1.5 megabytes.

I think you have this much memory.

# c++ - 不同字符编码之间的故障安全转换

> ID：869503
> 
> 赞同：0
> 
> 时间：2009-05-15T15:55:55.130
> 
> 标签：c++, c, utf-8

我需要将字符串从一种编码（UTF-8）转换为另一种。问题是在目标编码中我们没有来自源编码的所有字符，并且 libc iconv(3) 函数在这种情况下失败。我想要的是能够执行转换，但在输出字符串中，这个有问题的字符被替换为一些符号，比如“？”。

编程语言是 C 或 C++。

有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T17:09:27.997

尝试将“//TRANSLIT”或“//IGNORE”附加到目标字符集字符串的末尾。请注意，这仅在 GNU C 库下受支持。

从[iconv_open(3)](http://www.gnu.org/software/libiconv/documentation/libiconv/iconv_open.3.html)：

```
 //TRANSLIT
          When the string "//TRANSLIT" is appended to tocode, translitera‐
          tion is activated.  This means that when a character  cannot  be
          represented  in the target character set, it can be approximated
          through one or several similarly looking characters.

   //IGNORE
          When the string "//IGNORE" is  appended  to  tocode,  characters
          that  cannot  be represented in the target character set will be
          silently discarded. 
```

[或者，当您从iconv(3)](http://www.gnu.org/software/libiconv/documentation/libiconv/iconv.3.html)获得 -EILSEQ 时，手动跳过一个字符并在输出中插入一个替换。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T17:05:57.707

基于可翻译源范围的正则表达式，用于将对应的占位符换成任何不匹配的字符。

# firebug - 阻止萤火虫重新请求 html 源

> ID：869507
> 
> 赞同：0
> 
> 时间：2009-05-15T15:56:18.657
> 
> 标签：firebug

我正在处理一个加载大约需要 10-15 秒的页面，因为它运行一个巨大的 SQL 查询，而且似乎每次我尝试使用它时，firebug 都会重新请求源。有没有其他人遇到过这个？有没有办法关闭它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T21:26:26.273

您的服务器端代码是否发送 HTTP 缓存控制标头？如果没有，您可以尝试添加它们。如果是这样，并且您仍然看到问题，您可以尝试在您的开发机器上安装 Web 缓存代理并配置 firefox 以通过它进行连接。

如果您无法更改服务器端代码以添加缓存控制标头，您可以编写一个代理，将请求转发到您的服务器并将标头添加到它返回的响应中。

# c# - 使用动态类型

> ID：869508
> 
> 赞同：2
> 
> 时间：2009-05-15T15:56:22.197
> 
> 标签：c#, dynamic, casting

我正在使用带有 SQL DB 的实体模型，并且我有一组大约 30 个查找表，它们采用相同的 3 列格式**ID**、**Text**、**IsActive**。但我不想创建 30 个表单，我想创建一个表单并根据给定类型的字符串名称，然后填充 gridview 并允许**插入**、**更新**或**删除**该类型的记录。

我努力了

```
string objectType = "Namespace.Models.BenefitType";
object o = Assembly.GetExecutingAssembly().CreateInstance(objectType);
Type t = o.GetType(); 
```

但我无法访问该类型，我收到一条消息，说它是 System.Type 而不是 BenefitType 的类型。

有人可以告诉我如何转换一种在动态调用之前未知的类型。

非常感谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T16:08:52.527

如果可能的话，我肯定会先使用接口，然后使用泛型类型（或泛型方法），而不是真正动态地做事。如果您的自动生成代码使用部分类，这很容易做到 - 只需围绕您当前拥有的内容编写接口，然后添加一个新文件：

```
public partial class BenefitType : ICommonType {}
public partial class OtherType : ICommonType{} 
// etc 
```

然后你可以写：

```
public class LookupForm<T> : Form where T : ICommonType, new() 
```

你走了。缺点是设计者对泛型不是很满意。

如果您只需要根据类型名称*使用*它，您仍然可以这样做：

```
string objectType = "Namespace.Models.BenefitType";
Type type = Type.GetType(objectType);
Type formType = typeof(LookupForm<>).MakeGenericType(type);
Form form = (Form) Activator.CreateInstance(formType); 
```

您*可能*希望在 和 之间创建一个抽象的非泛型形式`LookupForm<T>`，`Form`您可以以强类型的方式使用它，但它与`T`. 这完全取决于您需要做什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T16:01:53.760

目前你的选择是有限的。*框架需要能够在编译时*了解更多关于类型信息的信息，而不仅仅是字符串名称，以便能够轻松使用它们。这意味着在你的类型字符串上做一个 switch 语句，这不是很好，或者确保你所有的动态类型都实现了一些你可以转换到的通用接口（更好）。

在 C# 4.0 中，您将能够使用`dynamic`关键字在运行时解析这些调用。

# sifr - 在某些标题上阻止 sifr

> ID：869512
> 
> 赞同：0
> 
> 时间：2009-05-15T15:56:38.577
> 
> 标签：sifr

我正在使用 sifr 的现有网站上工作。它被设置为用 sifr 替换所有 h1、h2 等。我需要防止这种情况发生在几个头条新闻上。

不幸的是，由于时间线的原因，我没有时间将 sifr-config 更改为更加锁定，然后也更改所有 html 页面。

有什么方法可以向 H1 添加一个类来防止 sifr 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-16T20:35:13.140

您可以将该`sIFR-ignore`类添加到您不想被替换的元素中。

请注意，应用于相关元素（例如`.sIFR-active h1`规则）的任何与 sIFR 相关的 CSS 可能仍然适用。

# templating - 哪些模板语言将 HTML *输出为节点树*？

> ID：869516
> 
> 赞同：5
> 
> 时间：2009-05-15T15:56:48.687
> 
> 标签：templating

首先，HTML 是一棵节点树。它不仅仅是一个文本。

然而，大多数模板引擎处理它们的输入和输出只是一个文本。他们不在乎他们的标签，他们`{$foo}`的 's 和`<% bar() %>`'s 周围发生了什么；他们也不关心他们在输出什么。有时他们碰巧生成了正确的 html，但这只是巧合；他们不是为此而想的，他们想要的只是用他们的评价来替换文本流中的一些有趣的标记。

有一些模板引擎确实将它们的输出视为一组节点。想到了 XSLT 和 Haml。对于某些任务，这具有优势：例如，您可以自动重新格式化（例如，删除所有空文本节点；自动缩进；自动换行）。结果保证是正确的 xml/sgml，除非您使用可以破坏它的严格操作子集。此外，这样的模板引擎会自动引用字符串，在文本节点和属性中有所不同，因为它严格知道您是在编写属性还是文本节点。此外，它可以有条件地从输出中删除一个节点，因为它知道它在哪里开始和结束，这很有用，并且可以执行其他非平凡的节点操作。

您可能不喜欢 XSLT 的冗长性或功能性，但是您的模板是 xmllint-able XML，并且您的输出是一个好的 sgml/xml，这该死的帮助。

所以问题是：**您知道哪些模板引擎将其输出视为一组正确的节点**，而不仅仅是非结构化文本？我知道 XSLT、Haml 和一些不知名的基于 python 的。呻吟！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-02-28T15:09:31.903

*   HTML 组合库，例如：
    *   [翼拍](http://wingbeats.codeplex.com/)(F#)
    *   [SharpDOM](http://sharpdom.codeplex.com/) (C#)
    *   [CityLizard](http://citylizard.codeplex.com/)（.NET，任何语言）
    *   [BlazeHtml](http://jaspervdj.be/blaze/) (Haskell)
    *   [Ocsigen / Eliom](http://ocsigen.org/eliom/dev/manual/html) (OCaml)
*   XML 文字作为一种语言特性可以很容易地充当“HTML 模板语言”
    *   [VB.NET XML 文字](http://msdn.microsoft.com/en-us/library/bb384460.aspx)
    *   [Hasic](http://www.assembla.com/spaces/hasic/wiki)（使用 VB.NET XML 文字）
    *   [Scala XML 文字](http://www.scala-lang.org/node/131)
    *   [哈姆雷特](http://www.yesodweb.com/book/templates)（使用模板 Haskell）

尽管这些都是*嵌入式*DSL，但取决于它们的宿主语言

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-24T08:13:03.343

> 您知道哪些模板引擎将其输出视为一组正确的节点

令人惊讶的是 ASP.NET 做到了！如果需要，您可以通过一种 DOM 更改页面的 HTML 输出：[http ://en.wikipedia.org/wiki/Asp.net#Rendering_technique](http://en.wikipedia.org/wiki/Asp.net#Rendering_technique)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-04-25T20:27:38.693

在称为[SXML](http://okmij.org/ftp/Scheme/SXML.html)的 Scheme 中有一种表示 XML（或其子集，例如 XHTML）的标准方法。在我看来，这是使 Scheme 成为[Web 开发的好语言的](http://gcbenison.wordpress.com/2012/02/19/guile-vs-php/)原因之一。可以将文档的内容构建为本地方案列表，然后在一个函数调用中将其呈现为（正确的）XHTML。

这是一个示例，它采用一个简单的文本字符串，并将其包装为单段 HTML 页面的内容。因此该函数`as-page`充当模板；它的输出是一个 Scheme 列表，可以很容易地翻译成它的等效 HTML。这种方法不可能实现不平衡或格式错误的标签。

```
(use-modules (sxml simple))

(define (as-page txt)
  `(html
    (head (title "A web page"))
    (body (p ,txt))))

(as-page "It works!!!!!")
;; $2 = (html (head (title "A web page")) (body (p "It works!!!!")))

(sxml->xml (as-page "It works!!!!"))
;; $3 = <html><head><title>A web page</title></head><body><p>It works!!!!</p></body></html> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T20:54:32.527

TAL（最初是 Zope 的一部分，但现在[以多种语言实现](http://en.wikipedia.org/wiki/Template_Attribute_Language)）是基于 XML 的。使用它是非常合乎逻辑和意图的——而不是塞进一堆文本中，而是告诉模板“将此链接的 href 属性设置为[http://google.com/](http://google.com/)并将其文本内容设置为“搜索 Google”。您不必管理需要转义的字符串 - 通常，如果您打算将某些内容解释为标记，则将其放入模板中，如果您不打算将其解释为标记您将其作为属性值或文本内容输入，TAL 将正确转义它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T16:12:16.713

基本上所有使用 XML 作为文件格式的模板引擎（用于定义模板）。通过使用 XML，他们强制文件必须格式正确。

[编辑] 示例是：[Genshi](http://genshi.edgewall.org/) (Python) 或[JSP 2.0](http://en.wikipedia.org/wiki/JavaServer_Pages) (Java)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-18T08:23:26.657

使用 Nagare Web 框架， [视图](http://www.nagare.org/trac/wiki/PresentationTier)始终是 XML 节点树，直接用 Python 构建。然后可以用 Python 操作树，用 XSL 转换，用 HTML 或 XHTML 序列化......

（“nagare.namespaces”包随 Nagare 项目提供，但可以在任何 Python 应用程序中使用）

例子：

```
>>> from nagare.namespaces import xhtml_base
>>> h = xhtml_base.Renderer()    # The XHTML tree builder
>>>
>>> # Building the tree of nodes
>>> with h.html:
>>>    with h.body:
>>>        h << h.h1('Hello world')
>>> tree = h.root  # The tree root element
>>>
>>> print tree.write_xmlstring() # Tree serialized in XML

<html><body><h1>Hello world</h1></body></html> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-02-13T01:33:23.287

我在这里维护了一个推式模板系统列表：http: //perlmonks.org/?node_id= [674273](http://perlmonks.org/?node_id=674273)

我正在评估各种 Perl 模板系统的分离指数： [http ://bit.ly/bXaYt7](http://bit.ly/bXaYt7)

但是基于树的一个是我写的，HTML::Seamstress - [http://search.cpan.org/dist/HTML-Seamstress/](http://search.cpan.org/dist/HTML-Seamstress/)

“推式”一词来自 Terence Parr 的论文“Enforcing Strict Model-View Separation in Template Engines” - [http://www.cs.usfca.edu/~parrt/papers/mvc.templates.pdf](http://www.cs.usfca.edu/~parrt/papers/mvc.templates.pdf)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-05-25T19:38:03.630

此外，来自 Haskell 的 snap 的[http://snapframework.com/docs/tutorials/heist](http://snapframework.com/docs/tutorials/heist)似乎很合适。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-12-10T18:51:41.327

TAL 绝对不是推式的。它可能是基于 XML 的，但它是拉式（推式的最退化形式）。

# python - 从模块运行 unittest.main()？

> ID：869519
> 
> 赞同：2
> 
> 时间：2009-05-15T15:57:58.387
> 
> 标签：python, unit-testing

我写了一个动态定义 unittest.TestCase 类的小函数（下面的简单版本）。

当我将它从同一个源文件移到它自己的模块中时，我不知道如何让 unittest 发现新类。从任一文件调用 unittest.main() 都不会执行任何测试。

`factory.py`：

```
import unittest

_testnum = 0
def test_factory(a, b):

    global _testnum

    testname = 'dyntest' + str(_testnum)

    globals()[testname] = type(testname, (unittest.TestCase,), {'testme': lambda self: self.assertEqual(a, b)})

    _testnum += 1

def finish():
    unittest.main() 
```

`someotherfile.py`：

```
from factory import test_factory, finish

test_factory(1, 1)
test_factory(1, 2)

if __name__ == '__main__':
    finish() 
```

输出：

```
----------------------------------------------------------------------
Ran 0 tests in 0.000s

OK 
```

所以它不执行任何测试。

请注意，将它们全部保存在同一个文件中可以按预期工作：

```
import unittest

_testnum = 0
def test_factory(a, b):

    global _testnum

    testname = 'dyntest' + str(_testnum)

    globals()[testname] = type(testname, (unittest.TestCase,), {'testme': lambda self: self.assertEqual(a, b)})

    _testnum += 1

test_factory(1, 1)
test_factory(1, 2)

if __name__ == '__main__':
    unittest.main() 
```

输出（如预期）：

```
.F
======================================================================
FAIL: testme (__main__.dyntest1)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "partb.py", line 11, in <lambda>
    globals()[testname] = type(testname, (unittest.TestCase,), {'testme': lambda self: self.assertEqual(a, b)})
AssertionError: 1 != 2

----------------------------------------------------------------------
Ran 2 tests in 0.008s

FAILED (failures=1) 
```

如何使用我的 test_factory() 函数，以便我可以执行它从单独的源文件定义的所有 TestCase 对象？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-15T16:31:53.953

总体思路（unittest.main 为您做什么）是：

```
suite = unittest.TestLoader().loadTestsFromTestCase(SomeTestCase)
unittest.TextTestRunner(verbosity=2).run(suite) 
```

根据[http://docs.python.org/library/unittest.html?highlight=unittest#module-unittest](http://docs.python.org/library/unittest.html?highlight=unittest#module-unittest)。您的测试用例`globals()`被该`test_factory`函数隐藏，因此只需执行 a `dir()`，找到作为实例`unittest.TestCase`（或名称以 等开头的实例）的全局变量，`'dyntest'`然后以这种方式构建您的套件并运行它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-15T16:55:28.000

默认情况下， unittest.main() 在主模块中查找单元 TestCase 对象。test_factory 在自己的模块中创建 TestCase 对象。这就是为什么将它移到主模块之外会导致您看到的行为。

尝试：

```
def finish():
    unittest.main(module=__name__) 
```

# c# - 正则表达式不适合 C#

> ID：869520
> 
> 赞同：0
> 
> 时间：2009-05-15T15:58:23.347
> 
> 标签：c#, regex

我写了一个简单的程序来从网络上获取信息

```
string loginName = null;
Regex rloginName = new Regex(@" <tr><td dir='rtl'><h1>(.*?)</h1><br /></td></tr> <!--.............. Titel der Referat ..............-->");

Match mloginName = rloginName.Match(source);
if (mloginName.Success)
{

} 
```

好的，我在 RegexBuddy 3 上对此进行了测试，一切都很好，但在我的代码中无法得到回报，

所以我的代码问题在哪里

这是代码：

```
<tr><td dir='rtl'><h1>xxx:xxx:xxxx:xxx@xxx.xxx</h1><br /></td></tr> <!--.............. Titel der Referat ..............-->     
          <tr><td dir='rtl' style='text-align: justify'> 
```

我想得到

```
xxx:xxx:xxxx:xxx@xxx.xxx 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-16T05:10:41.023

它是 Regex 模式开头的微小空格。如果你删除它，你可以使用 mloginName.Groups[1] 得到你想要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T16:02:42.667

那么网页中是否没有空格/新行？

# asp.net - Ajax replacment for JavaScript prompt command

> ID：869525
> 
> 赞同：0
> 
> 时间：2009-05-15T16:00:01.907
> 
> 标签：asp.net, javascript, ajax, asp.net-ajax

The JavaScript prompt command

```
prompt("sometext","defaultvalue"); 
```

is a useful way to easily prompt the user to provide a value. But it can't really be a part of any polished web 2.0 application (The dialog looks horrible).

Is there any existing component to display a modal dialog that will prompt a user for a value? I can use a pure JavaScript solution or anything developed for ASP.NET

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T16:16:08.623

I'm sure there are a lot of things that fit the bill in of the most javascript frameworks out there. For instance, there are a few out there for jQuery e.g. [Impromptu](http://trentrichardson.com/Impromptu/index.php) or if you want something specifically for ASP.NET then there are few things you could probably use from the [ASP.NET Ajax Control Toolkit](http://www.asp.net/ajax/AjaxControlToolkit/Samples/) such as the [Modal Dialog](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/ModalPopup/ModalPopup.aspx) or of course, you could roll your own!

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T16:08:08.563

You can code your own solution with a `div` containing an input field and a button and some JavaScript to show/hide the `div`.

This will not block the JavaScript code flow so you will have to set a callback function on the `Close`/`Ok` button.

If you are ok with JS libraries almost all of them have a `Dialog` widget.

# common-lisp - Common Lisp中的`set`，`setq`和`setf`之间的区别？

> ID：869529
> 
> 赞同：188
> 
> 时间：2009-05-15T16:00:32.483
> 
> 标签：common-lisp

Common Lisp 中的“set”、“setq”和“setf”有什么区别？

* * *

## 回答 #1

> 赞同：187
> 
> 时间：2009-05-15T16:36:39.323

最初，在 Lisp 中，没有词法变量——只有动态变量。而且没有 SETQ 或 SETF，只有 SET 函数。

现在写成：

```
(setf (symbol-value '*foo*) 42) 
```

写成：

```
(set (quote *foo*) 42) 
```

最终缩写为 SETQ (SET Quoted)：

```
(setq *foo* 42) 
```

然后出现了词法变量，并且 SETQ 也开始用于对它们进行赋值——因此它不再是 SET 的简单包装器。

后来，有人发明了 SETF（SET Field）作为一种为数据结构赋值的通用方式，以反映其他语言的左值：

```
x.car := 42; 
```

将被写为

```
(setf (car x) 42) 
```

为了对称性和通用性，SETF 还提供了 SETQ 的功能。在这一点上，说 SETQ 是低级原语，而 SETF 是高级操作是正确的。

然后发生了符号宏。因此，符号宏可以透明地工作，如果分配给的“变量”确实是符号宏，那么 SETQ 必须像 SETF 一样工作：

```
(defvar *hidden* (cons 42 42))
(define-symbol-macro foo (car *hidden*))

foo => 42

(setq foo 13)

foo => 13

*hidden* => (13 . 42) 
```

所以我们来到了今天：SET 和 SETQ 是旧方言的萎缩残骸，很可能会从 Common Lisp 的最终继承者中被淘汰。

* * *

## 回答 #2

> 赞同：169
> 
> 时间：2009-09-25T06:57:34.640

```
(set ls '(1 2 3 4)) => Error - ls has no value

(set 'ls '(1 2 3 4)) => OK

(setq ls '(1 2 3 4)) => OK - make ls to (quote ls) and then have the usual set

(setf ls '(1 2 3 4)) => OK - same as setq so far BUT

(setf (car ls) 10) => Makes ls '(10 2 3 4) - not duplicated by setq/set 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-05-15T16:18:14.623

`setq`就像`set`引用的第一个 arg 一样 -`(set 'foo '(bar baz))`就像`(setq foo '(bar baz))`. `setf`，另一方面，确实很微妙——它就像一个“间接”。我建议[http://www.nano.com/lisp/cmucl-tutorials/LISP-tutorial-16.html](http://www.n-a-n-o.com/lisp/cmucl-tutorials/LISP-tutorial-16.html)作为开始理解它的更好方法，比这里的任何答案都可以给出......总之，不过，`setf`需要第一个参数作为“参考”，因此 eg`(aref myarray 3)`将起作用（作为第一个参数`setf`）来设置数组内的项目。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2012-08-01T23:32:57.147

您可以使用`setf`代替`set`或`setq`反之亦然，因为`setf`如果变量具有单个元素，也可以设置变量的单个元素的值。请参阅以下示例：

所有四个示例都将列表 (1, 2, 3) 分配给名为 foo 的变量。

```
(set (quote foo) (list 1 2 3))    ;foo => (1 2 3)
(1 2 3)

(set 'foo '(1 2 3))   ;foo => (1 2 3) same function, simpler expression
(1 2 3)

(setq foo '(1 2 3))   ;foo => (1 2 3) similar function, different syntax
(1 2 3)

(setf foo '(1 2 3))   ;foo => (1 2 3) more capable function
(1 2 3) 
```

`setf`具有将列表成员设置为`foo`新值的附加功能。

```
foo                   ;foo => (1 2 3) as defined above
(1 2 3)

(car foo)             ;the first item in foo is 1
1

(setf (car foo) 4)    ;set or setq will fail since (car foo) is not a symbol
4

foo                   ;the fist item in foo was set to 4 by setf
(4 2 3) 
```

但是，您可以定义一个符号宏来表示其中的单个项目`foo`

```
(define-symbol-macro foo-car (car foo))    ; assumes FOO => (1 2 3)
FOO-CAR

foo-car               ;foo-car is now a symbol for the 1st item in foo
1

(setq foo-car 4)      ;set or setq can set the symbol foo-car 
4

foo                   ;Lisp macros are so cool
(4 2 3) 
```

`defvar`如果您尚未定义变量并且不想在稍后的代码中给它一个值，则可以使用。

```
(defvar foo2)
(define-symbol-macro foo-car (car foo2)) 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2013-08-08T09:25:55.917

可以认为是`SET`低级`SETQ`构造。

*   `SET`可以设置符号的值。

*   `SETQ`可以设置变量的值。

然后`SETF`是一个宏，它提供了很多种设置的东西：符号，变量，数组元素，实例槽，...

对于符号和变量，可以认为好像`SETF`展开为`SET`and `SETQ`。

```
* (macroexpand '(setf (symbol-value 'a) 10))

(SET 'A 10)

* (macroexpand '(setf a 10))         

(SETQ A 10) 
```

所以`SET`和`SETQ`用于实现 的一些功能`SETF`，这是更通用的构造。当我们考虑符号宏时，其他一些答案会告诉您稍微复杂的故事。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-07-16T13:01:47.480

我想在之前的答案中添加 setf 是宏，它根据作为第一个参数传递的内容调用特定函数。比较 setf 与不同类型参数的宏展开结果：

```
(macroexpand '(setf a 1))

(macroexpand '(setf (car (list 3 2 1)) 1))

(macroexpand '(setf (aref #(3 2 1) 0) 1)) 
```

对于某些类型的参数，“setf 函数”将被调用：

```
(defstruct strct field)
(macroexpand '(setf (strct-field (make-strct)) 1)) 
```

# c# - 如何在 ASP.NET 上进行身份验证

> ID：869530
> 
> 赞同：1
> 
> 时间：2009-05-15T16:00:35.557
> 
> 标签：c#, asp.net, authentication

我正在开发一个需要对用户进行身份验证的 ASP.NET 应用程序 (c#)。为此，我有一个包含此应用程序用户的 SQL Server 数据库。

最好的方法是什么？

我一直在读这个：

[如何：实现简单表单身份验证](http://msdn.microsoft.com/en-us/library/xdt4thhy.aspx)

在示例中，我将替换此代码：

```
<script runat="server">
  void Logon_Click(object sender, EventArgs e)
  {
    if ((UserEmail.Text == "jchen@contoso.com") && 
            (UserPass.Text == "37Yj*99Ps"))
      {
          FormsAuthentication.RedirectFromLoginPage 
             (UserEmail.Text, Persist.Checked);
      }
      else
      {
          Msg.Text = "Invalid credentials. Please try again.";
      }
  }
</script> 
```

用我的 ADO.NET 实体代码在数据库上搜索用户。它会起作用吗？

另一种方式是会员制（[ [http://msdn.microsoft.com/en-us/library/tw292whz.aspx][2]](http://msdn.microsoft.com/en-us/library/tw292whz.aspx][2])），但我认为这是最难的方式。

或者，也许我可以使用 Windows Live ID，但我不知道如何将 Live ID 与我的用户表连接起来。

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-15T16:07:09.893

会员资格是提供身份验证 IMO 的最简单方法。如果您有兴趣使用它，我推荐 Scott Mitchell 的本[教程](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)：

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T16:07:25.650

最重要的安全规则之一（OWASP 前 10 名中的第 7 条）是当有经过尝试和测试的机制可用时，不要编写自己的身份验证机制。ASP.Net 身份验证易于使用，并且经过尝试和测试，如果您继续编写自己的机制，您将面临各种痛苦。

[2007 年前 10 名-损坏的身份验证和会话管理](http://www.owasp.org/index.php/Top_10_2007-A7)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-15T16:08:31.433

这两种方法都可以，但推荐的方法是实现您自己的会员资格提供者，原因有两个：

1.  内置的 .NET 身份验证机制可能比您的更强大
2.  它使您能够将一些标准的 .NET 控件连接到您的自定义用户数据库。

[此](http://msdn.microsoft.com/en-us/library/f1kyba5e.aspx)页面包含有关如何实施您自己的会员资格提供程序的说明

# linux - Linux目录权限读写不删除

> ID：869536
> 
> 赞同：62
> 
> 时间：2009-05-15T16:01:37.207
> 
> 标签：linux, file-permissions

是否可以设置目录权限，使组能够读取和写入文件和子目录但不能删除任何内容？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-05-15T16:33:05.230

在目录上设置粘性位可能就足够了。用户将能够删除他们拥有的任何文件，但不能删除其他用户的文件。这对于您的用例可能已经足够了。在大多数系统上，/tmp 以这种方式设置（/tmp 设置为 1777）

chmod 1775 /受控

但是，如果您想要更多控制权，则必须在相关文件系统上启用 ACL。

在 /etc/fstab 中，将 acl 附加到标志：

```
/dev/root        /                       ext3    defaults,acl       1 1 
```

然后您可以使用 setfacl/getfacl 来控制和查看 acl 级别的权限。

示例：（创建文件，一旦写入，它们是只读的，但可以被所有者删除，但不能被其他人删除。）

```
setfacl --set u::rwxs,g::rwx /controlled
setfacl -d --set u::r-x,g::r-x,o::- /controlled 
```

您可以在目录上设置默认的 acl 列表，该目录将被在那里创建的所有文件使用。

正如其他人所指出的，请注意准确指定您想要的内容。你说“写”——但用户可以覆盖他们自己的文件吗？他们可以更改现有内容，还是只是追加内容？一旦写入，它是只读的？也许您可以在评论中指定更多细节。

最后，selinux 和 grsecurity 提供了更多的控制，但这是完全不同的蠕虫。设置可能非常复杂。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-05-15T16:04:04.800

好吧，这将是这个目录的 rx。

并且其中的文件将具有 rw-。

这是因为如果文件的权限允许写入，则可以写入文件，但只有在其*目录*的权限允许写入时才能将其删除。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-15T16:07:19.970

可能与否，请确保用 0 字节文件覆盖并不等同于在您的特定上下文中删除文件。

# algorithm - 从总计中扣除项目成本？

> ID：869547
> 
> 赞同：3
> 
> 时间：2009-05-15T16:02:47.250
> 
> 标签：algorithm, math, statistics

这可以分解为三个简单的方程：

```
a + b = 3
b + c = 5
a + c = 4 
```

我怎样才能最好地近似这些值？请注意，在实际应用程序中，我会有更多这样的总数和变量。特别是，我想找出是否可以通过杂货收据中的物品清单和总数来有效地估算食品成本。我假设如果我能计算出成本，那么我可以预期的准确度范围会有所不同，因此额外需要知道近似值正确的可能性以及价格*必须*在什么范围内。

编辑：我只是没有看到这个得到我满意的答案，因为我一开始就没有正确地提出这个问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T16:05:36.497

您正在处理一个线性方程组，以解决它：

[http://www.codeproject.com/KB/cs/LinearEquationsSystemSoln.aspx](http://www.codeproject.com/KB/cs/LinearEquationsSystemSoln.aspx)

其基本思想是在方程中建立一个系数矩阵，并使用[LU分解](http://en.wikipedia.org/wiki/LU_decomposition)或[高斯消元](http://en.wikipedia.org/wiki/Gaussian_elimination)来推导变量的值。[LAPACK](http://www.netlib.org/lapack/)可以提供帮助。

跟进：LAPACK 是一个功能齐全的库，用于处理所有类型的线性代数（它在这方面非常高效，还有基于 GPU 的库，例如使用 CUDA 在 NVIDIA GPU 上运行的 CUBLAS）。

如果您处理的方程数量与未知数相同，那么您将处理简单的方程求解解决方案。

基本上，如果你有比方程更多的未知数，你将处理一个叫做*underdetermined system*的东西。同样，您可能正在处理方程多于未知数的系统（*超定系统*）。如果您有一个欠定系统，您可能想要寻找*最小范数*解决方案（单个欠定系统可能有无限数量的解决方案）。对于超定系统，我们可能正在寻找所谓的*最小二乘解决方案*。有关这些解决方案的更多信息，请查看： http: [//www.netlib.org/lapack/lug/node27.html](http://www.netlib.org/lapack/lug/node27.html)。这些概念来自线性代数。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T16:14:33.667

[这个问题的更一般的解决方案是找到线性回归/最小二乘解决方案](http://en.wikipedia.org/wiki/Least_squares)，您可以拥有比未知数更多的方程。回归统计将为您提供有关结果准确性所需的信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-15T16:18:20.117

如果您的变量比方程多，那么将有无限数量的精确解，并且可能的值将无处不在，而不是有用的近似值。

您至少需要与变量一样多的方程，并且需要[大不相同](http://en.wikipedia.org/wiki/Linear_independence)的方程（仅复制一个方程几次不会有帮助）。因此，如果您的方程式比变量少，它将不起作用，否则请寻找统计或线性代数库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T17:47:07.500

对于这样的方系统，可以求解矩阵方程

```
| 1 1 0 ||a| |3|
| 0 1 1 ||b|=|5|
| 1 0 1 ||c| |4| 
```

提供左边的矩阵是可逆的，就像这个一样。

但是，通常，您要么有太多变量，要么有两个变量。两个多方程更好，因为可以使用最小二乘近似。要找到最小二乘解，请求解 x 的正规方程 A ^T A x = A ^T b，其中 x = (a, b,c)，b = (3,5,4)，A 是系数矩阵。请注意，上标 T 指的是矩阵的转置。

我确信那里有一些代码可以实现这一点。

但是，当系统欠定时，即使假设 a、b 和 c 是正数，您也会有无限多的解。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T16:15:53.663

为了娱乐：

```
a+b=3 | a=3-b | a=3-(5-c) | a=c-2 | a=(4-a)-2 | 2a=2  | a=1   |       |
b+c=5 | b=5-c | b=5-c     | b=5-c | b=5-c     | b=5-c | b=5-c | b=5-3 | b=2
a+c=4 | c=4-a | c=4-a     | c=4-a | c=4-a     | c=4-a | c=4-1 | c=3   | 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-22T15:09:49.577

对于价格必须处于的范围，请在您最喜欢的数值代数系统中使用[线性规划求解器。](http://en.wikipedia.org/wiki/Linear_programming)您的等式约束是收据中的各个等式；此外，您还需要添加不等式约束以保证每个价格都是非负的。要找到商品 X 的可能价格范围，请将您的目标函数设置为 X 的价格，并分别求解最小值和最大值。

如果一件物品在不同的收据上有不同的价格，这种方法可能会失败；线性程序可能变得不可行，或者可能会有更微妙的影响。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T16:11:14.110

如果您使用的是 .NET，请查看[Microsoft Solver Foundation](http://code.msdn.microsoft.com/solverfoundation)。[这篇文章](http://code.msdn.microsoft.com/solverfoundation/Thread/View.aspx?ThreadId=1555)提供了一个示例，说明如何使用它来求解线性方程。

# windows - 关于 Vista 中的 Mutex 对象

> ID：869552
> 
> 赞同：0
> 
> 时间：2009-05-15T16:03:27.110
> 
> 标签：windows, winapi, windows-vista, uac

我的操作系统是打开 UAC 的 Vista，我在服务器端创建了一个全局互斥对象，然后我的带有 UI 的 AP 想使用同名的 CreateMutex 来获取已在服务器中创建的互斥对象，但函数告诉我我没有'无权访问它。我该怎么做？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T16:52:23.373

我认为在您的情况下，您需要通过初始化相应的安全属性来明确允许对互斥锁的所有访问。

尝试以这种方式创建互斥锁（将其视为半伪代码）：

```
SECURITY_ATTRIBUTES sa;
SECURITY_DESCRIPTOR sd;
InitializeSecurityDescriptor(&sd, SECURITY_DESCRIPTOR_REVISION);
SetSecurityDescriptorDacl(&sd, TRUE, NULL, FALSE);
sa.nLength = sizeof(sa);
sa.lpSecurityDescriptor = &sd;
CreateMutex(&sa, ...); 
```

顺便说一句 - 可以使用*CreateMutex*打开***现有的***互斥锁。但是，OpenMutex 允许您指定所需的访问级别。

另请注意，如果您需要一个真正的全局互斥体 - 您必须在其名称前加上“Global\”（请参阅​​ MSDN 的“Kernel Object Namespaces”文章）

# c++ - 带有目标相机的 C++ 3d 矢量/矩阵库的建议

> ID：869558
> 
> 赞同：3
> 
> 时间：2009-05-15T16:05:20.210
> 
> 标签：c++, 3d, vector, matrix

我正在编写一个非常简单的 3d 粒子软件渲染系统，但我只对粒子系统和光栅化器的编码感兴趣，所以我正在寻找的是从 3d 粒子坐标通过相机到屏幕的最简单方法坐标，但具有可变 FOV 和目标（查看）相机等功能。

任何额外的功能，例如点到点的距离、边界体积等都会是一个额外的好处，但对我来说，易用性比功能更重要。

唯一的许可证要求是它是免费的（就像啤酒一样）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T16:10:25.267

您可能需要一个场景图库。存在许多 C++ 场景图库。OpenScenegraph 很受欢迎，Coin3D（免费用于非商业用途）是 OpenInventor 规范的实现，它们中的任何一个都可能满足您的需求，因为听起来您不需要任何尖端支持。还有 Panda3D，如果你喜欢 Python，我听说它很好。

您可以在像 OpenGL 这样的直接低级工具包中完成所有这些工作，但如果没有经验，使用 OpenGL 比任何场景图形库都需要更长的时间。

选择场景库时，可能只取决于您喜欢哪种 API 的个人偏好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T16:11:34.813

查看是通过基本转换完成的，与完成模型转换的方式相同。如果你想要 GLU 中的 gluLookAt() 之类的便利函数，那我不知道，但你自己做会很容易。

如果您确实想制作自己的 Look At 函数等，那么我可以推荐[eigen](http://eigen.tuxfamily.org/)，它是一个非常易于使用的 C++ 线性代数库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T16:12:23.733

如果您只想专注于粒子系统的渲染部分，我会使用已建立的 3D 渲染库。

根据您的描述，您可以考虑尝试将粒子光栅化添加到[Irrlicht](http://irrlicht.sourceforge.net/)中的一个或两个软件渲染器中。这样做的另一个优点是您可以将您的结果与已经存在的 DX/OGL 粒子效果渲染器进行比较。所有管道/相机管理/等都会为您完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-09T05:43:06.600

您可能还想看看[Armadillo C++ 库](http://arma.sourceforge.net)

# c# - 在 404 之后访问 IHttpModule 中的 SessionState？

> ID：869561
> 
> 赞同：1
> 
> 时间：2009-05-15T16:05:49.397
> 
> 标签：c#, asp.net

是否可以在 404 之后访问 HttpModule 的错误事件处理程序中的 SessionState？

我尝试使用此博客文章中描述的技术为完整和部分回发实现一致的错误处理机制，

[ASP.NET 错误处理......](http://blogs.microsoft.co.il/blogs/oshvartz/archive/2008/05/17/asp-net-error-handling-using-httpmodule-full-and-partial-post-back-ajax-updatepanel.aspx?CommentPosted=true#commentmessage)

我没有在查询字符串上传递大量参数，而是试图将异常推送到会话状态并从错误页面访问它。

SessionState 在我执行 Server.Transfer 时永远不可用（在 HttpModule 的错误处理程序中），因此对错误页面不可用。

我尝试了将 IHttpHandler 重置为具有 IRequestSessionState 接口的技巧，但没有任何乐趣。

提前致谢，

编辑 - IHttpModule 错误处理程序的代码是，

```
void context_Error(object sender, EventArgs e)
{
    try
    {            
        var srcPageUrl = HttpContext.Current.Request.Url.ToString();                       

        // If the error comes our handler we retrieve the query string
        if (srcPageUrl.Contains(NO_PAGE_STR))
        {
            // Deliberate 404 from page error handler so transfer to error page
            // SESSION NOT AVAILABLE !!!!

            HttpContext.Current.ClearError();                
            HttpContext.Current.Server.Transfer(string.Format("{0}?ErrorKey={1}", ERROR_PAGE_URL, errorKey), true);
        }
        else            
            HttpContext.Current.Server.ClearError();                

        return;
    }
    catch (Exception ex)
    {
        Logging.LogEvent(ex);
    }
} 
```

马特

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-18T13:36:33.700

```
 public class ExceptionModule : IHttpModule
    {
        #region IHttpModule Members

        public void Dispose()
        {

        }

    /// <summary>
    /// Init method to register the event handlers for 
    /// the HttpApplication
    /// </summary>
    /// <param name="application">Http Application object</param>
    public void Init(HttpApplication application)
    {
        application.Error += this.Application_Error;
    }

    private void Application_Error(object sender, EventArgs e)
    {

                    // Create HttpApplication and HttpContext objects to access
                    // request and response properties.
                    var application = (HttpApplication)sender;
                    var context = application.Context;
                    application.Session["errorData"] = "yes there is an error";

                    context.Server.Transfer("Error.aspx");

         }
} 
```

这应该可以解决问题！为我工作！

# c# - 在 C# 中将 UpdatePanel 与 Masterpage 一起使用时出现问题

> ID：869574
> 
> 赞同：1
> 
> 时间：2009-05-15T16:10:01.150
> 
> 标签：c#, asp.net, updatepanel, master-pages, postback

我的代码：

```
<%@ Page Language="C#" %>

<script runat="server">

    void button_Click(object sender, EventArgs e)
    {
        label.Text = "Refreshed by server side event handler at " + DateTime.Now + ".<br>Value provided:" + text.Text;
    }

</script>      
<html>
<head>
    <title>How to update an UpdatePanel with JavaScript</title>

    <script type="text/javascript">
        function UpdPanelUpdate(id) {
            var obj = document.getElementById("<%= text.ClientID %>");
            obj.value = id;
            __doPostBack("<%= button.ClientID %>", "");
        }
    </script>

</head>
<body>
    <form id="form1" runat="server">
    <asp:ScriptManager ID="ScriptManager1" runat="server" />
    <div>
        <a href="javascript:UpdPanelUpdate('Value passed by javascript')">Update the Panel</a>
        <asp:TextBox ID="text" runat="server" Style="display: none;"></asp:TextBox>
        <asp:Button ID="button" runat="server" OnClick="button_Click" Style="display: none;" />
        <asp:UpdatePanel runat="server" ID="UpdatePanel1" UpdateMode="Conditional" ChildrenAsTriggers="false">
            <contenttemplate>
               <asp:Label ID="label" runat="server"></asp:Label>
            </contenttemplate>
            <triggers>
               <asp:AsyncPostBackTrigger ControlID="button" EventName="Click" />
            </triggers>
        </asp:UpdatePanel>
    </div>
    </form>
</body>
</html> 
```

这很好用，但是当我将它与 Masterpage 一起使用时，链接似乎不起作用......没有错误，但什么也没发生......

任何的想法？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T18:01:59.850

在您的 JavaScript 中尝试使用**UniqueID**而不是 ClientID：

```
function UpdPanelUpdate(id) {
            var obj = document.getElementById("<%= text.UniqueID%>");
            obj.value = id;
            __doPostBack("<%= button.UniqueID%>", "");
        } 
```

让我知道这是否有效。

我怀疑正在发生的事情是文本框 ID 不再是您期望的那样。ID 最初是“文本”，但是一旦您将该页面移动到母版页，情况就会发生变化。由于控件现在包含在母版页中，因此它们的 ID 会有效地更改以显示这种关系。因此，文本框的 ID 不再是“text”，而是类似于 ctl00$cphBody$text - 其中“ctl100”是母版页的 ID 前缀，“cphBody”是您分别分配给该页面的 ContentPlaceHolderID 的值。

当然，您可以从后面的代码中执行 this.text.Text = "new value" 并直接访问它。没关系。但是尝试使用 FindControl，您会发现事情变得混乱。真正理解我所描述内容的最简单方法是使用母版页在您的页面上执行以下操作：

1.  在页面加载时设置断点
2.  调出您的即时窗口 (CTRL + ALT + I)
3.  输入：**?this.text.ID** （你应该看到文本）
4.  输入：**?** this.text.ClientID（你应该看到 ctl00_cphBody_text）
5.  输入：**?** this.text.UniqueID（你应该看到 ctl00$cphBody$text）
6.  现在使用 FindControl 测试步骤 3-5 的结果。使用 ?this.FindControl("text") 和 ?this.FindControl("ctl00_cphBody_text") 和 ?this.FindControl("ctl00$cphBody$text") - 除了最后一个应该返回 null。

为了进一步理解这一点，我建议阅读[这篇文章](http://odetocode.com/Articles/450.aspx)，特别是标题为“FindControl、JavaScript 和命名容器”的部分。

**编辑：**我目前实际上无法测试该功能，但我想知道我发布的有关 FindControl 的内容是否适用于访问该控件的 JavaScript。根据[这篇文章](http://msdn.microsoft.com/en-us/library/3hc29e2a.aspx)，似乎建议使用 ClientID 而不是 UniqueID。所以这可能行不通。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T17:24:46.617

您是否确保 ScriptManager 正确包含在母版页中？您可能会发现此链接很有用；[将 ASP.NET UpdatePanel 控件与母版页一起使用](http://www.asp.net/AJAX/documentation/live/tutorials/UsingUpdatePanelMasterPages.aspx)

# transactions - MSDTC（分布式事务协调器）首次启动缓慢

> ID：869577
> 
> 赞同：4
> 
> 时间：2009-05-15T16:10:38.997
> 
> 标签：transactions, msdtc, distributed-transactions

我注意到非常简单的分布式事务在第一次运行时需要很长时间（3-4 秒）才能完成。但是如果再次调用相同的事务范围，它会快得多（30ms）。似乎 MSDTC 在一小时后进入睡眠状态。一个小时过去后，下一个要运行的事务将需要 3-4 秒。

我预计网站上的流量不会很大，因此单个交易之间可能会经过很多小时。

我认为这可能是由于 MSDTC 服务设置为手动启动，但我确保 MSDTC 服务都自动运行。

猜测某处有一个注册表设置，但我没有在 MSDN 中找到任何东西。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T16:15:20.467

MSDTC 运行 COM 组件来处理事务，并在 20 分钟（我相信默认设置）后从内存中卸载组件。您在第一个事务中看到的减速是环境旋转并将事物加载到内存中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-12-18T10:42:00.633

我今天遇到了这个问题，我知道这个问题有点老了，但我正在研究类似的事情并遇到了这个问题：

[http://support.microsoft.com/kb/197810](http://support.microsoft.com/kb/197810)

这个 KB 也很旧，但在我看来，空闲连接周围有一些东西被关闭了。它还列出了注册表设置。我不确定这是否有帮助，但我的情况完全不同，所以这不是问题（如果这确实是问题），我只是想知道发生了什么。

我不太确定 MSDTC 作为 COM+ 组件运行。它有 COM 接口，但我找不到任何提到它是 COM+ 组件的地方。它被列为服务，并且可以绕过 COM 接口，因此可以直接访问 MSDTC。尽管如此，我真的怀疑它是一个 COM+ 组件。话虽如此 - 它还有其他几个依赖项 - 我认为像 RPC 映射器，它们也可能参与这个问题。

# c# - 异常处理 - 已跳过行且 sqle 为空

> ID：869579
> 
> 赞同：0
> 
> 时间：2009-05-15T16:10:48.263
> 
> 标签：c#, exception, .net-1.0

IDE = VS7 或 2002

大家好，我这里有一个非常奇怪的问题。代码似乎没有按预期执行。我正在通过调试器运行它，它的表现真的很奇怪。

我已确定虚拟目录使用的是 ASP.NET 1.0.3705。

代码如下，我解释了调试器在评论中显示的执行步骤：

```
try
{
    objConnection.Open();  // STARTS HERE
    objCommand.ExecuteNonQuery();  // DOES NOT THROW EXCEPTION
    int c = 0;  // THIS LINE IS EXECUTED
}
catch (SqlException sqle)
{

    LogError();  // THIS LINE IS NOT EXECUTED
    throw sqle;  // THIS LINE IS EXECUTED AFTER THE int c = 0; 
                 // sqle IS NULL
                 // EXCEPTION IS NOT CAUGHT AND 
                 // EXECUTION CONTINUES IN FINALLY BLOCK
}
finally
{
    // EXECUTES AS EXPECTED FROM HERE ON OUT,
    // AS THOUGH THE throw sqle; DID NOT HAPPEN.
    if (objConnection.State == ConnectionState.Open) objConnection.Close();
} 
```

有没有人经历过这种奇怪的行为？知道如何解决吗？我可能会广泛地改变方法，但我仍然想知道为什么会这样。

我怀疑由于 sqle 为 null，这就是 throw 未按预期运行的原因。但是为什么我们一开始就跳进这个代码块呢？

我已经多次重新加载它，保存并重建，并使用调试器执行并多次观察此行为。

感谢大家的帮助！

祝一切顺利，

格雷厄姆

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T16:35:49.857

很奇怪。我不确定您的代码发生了什么，但我看到的一件事是使用：

```
catch (SqlException sqle)
{

    LogError();  // THIS LINE IS NOT EXECUTED
    throw sqle;  // THIS LINE IS EXECUTED AFTER THE int c = 0; 
                 // sqle IS NULL
                 // EXCEPTION IS NOT CAUGHT AND 
                 // EXECUTION CONTINUES IN FINALLY BLOCK
} 
```

你想写：

```
catch (SqlException sqle)
{

    LogError(); 
    throw; 
} 
```

重新抛出异常。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T16:16:18.623

等等..您的代码没有抛出异常，您想知道为什么它不执行 catch 块？

**编辑（参考您的评论）：**

这听起来真的很难相信。我从未听说过 catch 块内的实际异常为 null 的情况，正如您已经提到的那样，catch 块内的第一行没有执行，我认为这指向了根本没有异常的方向。

您是否尝试使用老式调试技术 (Debug.WriteLine) 并跳过调试器来检查程序流程？

我的假设是您正在查看引发异常的错误位置..或者根本没有异常。

# python - 如何反汇编 Python 脚本？

> ID：869586
> 
> 赞同：12
> 
> 时间：2009-05-15T16:12:02.440
> 
> 标签：python, debugging, reverse-engineering

今天早些时候，我[问了一个](https://stackoverflow.com/questions/869229/why-is-looping-over-range-in-python-faster-than-using-a-while-loop)关于 Python 处理某些类型循环的方式的问题。其中一个答案包含我的示例的反汇编版本。

我想知道更多。如何反汇编我自己的 Python 代码？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-15T16:14:49.203

看[dis](http://docs.python.org/library/dis.html)模块：

```
def myfunc(alist):
    return len(alist)

>>> dis.dis(myfunc)
  2           0 LOAD_GLOBAL              0 (len)
              3 LOAD_FAST                0 (alist)
              6 CALL_FUNCTION            1
              9 RETURN_VALUE 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T17:38:30.843

除了`dis`作为模块使用外，您还可以将其作为命令行工具运行

例如，在 Windows 上，您可以运行：

```
c:\Python25\Lib\dis.py test.py 
```

并将反汇编结果输出到控制台。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-15T16:24:53.127

使用`dis`Python 标准库中的模块（`import dis`例如在交互式解释器中，然后`dis.dis`使用您关心的任何函数！-）。

# bash - 为什么 ssh 从 crontab 失败但从命令行执行时成功？

> ID：869589
> 
> 赞同：31
> 
> 时间：2009-05-15T16:12:19.897
> 
> 标签：bash, unix, ssh, crontab

我有一个 bash 脚本，它对远程机器执行 ssh 并在那里执行命令，例如：

```
ssh -nxv user@remotehost echo "hello world" 
```

当我从命令行执行命令时，它工作正常，但在作为 crontab 的一部分执行时失败（错误代码 = 255 - 无法建立 SSH 连接）。细节：

```
...
Waiting for server public key.
Received server public key and host key.
Host 'remotehost' is known and matches the XXX host key.
...
Remote: Your host key cannot be verified: unknown or invalid host key.
Server refused our host key.
Trying XXX authentication with key '...'
Server refused our key.
... 
```

在本地执行时，我以 root 身份运行，crontab 也以 root 身份运行。从 crontab 和命令行执行 'id' 会得到完全相同的结果：

```
$ id
> uid=0(root) gid=0(root) groups=0(root),... 
```

我从一些本地机器 ssh 到运行 crond 的机器。我有 ssh 密钥和 ssh 到 crond 机器和脚本连接到的任何其他机器的凭据。

PS。请不要问/抱怨/评论以 root 身份执行任何操作都是坏的/错误的/等等——这不是这个问题的目的。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2013-08-04T08:22:38.803

## [`keychain`](http://linux.die.net/man/1/keychain)

以一种无痛的方式解决了这个问题。它在 Debian/Ubuntu 的存储库中：

```
sudo apt-get install keychain 
```

也许对于许多其他发行版（看起来它起源于 Gentoo）。

如果没有运行，该程序将启动`ssh-agent`，并提供可以`source`d 的 shell 脚本并将当前 shell 连接到这个特定的`ssh-agent`.

对于`bash`，使用名为 的私钥`id_rsa`，将以下内容添加到您的`.profile`：

```
keychain --nogui id_rsa 
```

这将在重新启动后的第一次登录时启动`ssh-agent`并添加`id_rsa`密钥。如果密钥受密码保护，它也会要求输入密码。**不再需要使用不受保护的密钥！**对于后续登录，它将识别代理并且不再要求输入密码。

此外，将以下内容添加为您的最后一行`.bashrc`：

```
. ~/.keychain/$HOSTNAME-sh 
```

这将使 shell 知道从何处访问由 管理的 SSH 代理`keychain`。确保它`.bashrc`来自`.profile`.

但是，`cron`工作似乎仍然没有看到这一点。作为补救措施，`crontab`在您的实际命令之前，将上面的行包含在 中：

```
* * * * * . ~/.keychain/$HOSTNAME-sh; your-actual-command 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-05-15T17:09:31.723

我猜通常当您从本地机器 ssh 到运行 crond 的机器时，您的私钥会加载到 ssh-agent 中并通过连接转发。因此，当您从命令行执行命令时，它会在 ssh-agent 中找到您的私钥并使用它来登录远程计算机。

当 crond 执行命令时，它无权访问 ssh-agent，因此无法使用您的私钥。

您必须在运行 crond 的机器上为 root 创建一个新的私钥，并将其公共部分复制到`authorized_keys`您希望 crond 登录的远程机器上的适当文件中。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-08-03T17:07:58.993

不要在没有密码的情况下公开您的 SSH 密钥。请改用[ssh-cron](https://github.com/fbb-git/ssh-cron)，它允许您使用 SSH 代理来安排任务。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-11-30T16:21:51.283

所以我遇到了类似的问题。我来到这里并看到了各种答案，但是通过一些实验，我可以使用带有密码短语、ssh-agent 和 cron 的 sshkeys 来使用它。

首先，我的 ssh 设置在我的 bash 初始化脚本中使用了以下脚本。

```
# JFD Added this for ssh
SSH_ENV=$HOME/.ssh/environment

    # start the ssh-agent
    function start_agent {
        echo "Initializing new SSH agent..."
        # spawn ssh-agent
        /usr/bin/ssh-agent | sed 's/^echo/#echo/' > "${SSH_ENV}"
        echo succeeded
        chmod 600 "${SSH_ENV}"
        . "${SSH_ENV}" > /dev/null
        /usr/bin/ssh-add
    }

    if [ -f "${SSH_ENV}" ]; then
         . "${SSH_ENV}" > /dev/null
         ps -ef | grep ${SSH_AGENT_PID} | grep ssh-agent$ > /dev/null || {
            start_agent;
        }
   else
        start_agent;
   fi 
```

当我登录时，我输入我的密码一次，然后从那时起它将使用 ssh-agent 自动对我进行身份验证。

ssh-agent 详细信息保存在 .ssh/environment 中。这是该脚本的外观：

```
SSH_AUTH_SOCK=/tmp/ssh-v3Tbd2Hjw3n9/agent.2089; export SSH_AUTH_SOCK;
SSH_AGENT_PID=2091; export SSH_AGENT_PID;
#echo Agent pid 2091; 
```

关于 cron，您可以通过各种方式将作业设置为普通用户。如果您以 root 用户身份运行 crontab -e，它将设置一个 root 用户 cron。如果您以 crontab -u davis -e 运行，它将添加一个 cron 作业作为用户 ID davis。同样，如果您以用户 davis 运行并执行 crontab -e，它将创建一个以用户 davis 运行的 cron 作业。这可以通过以下条目进行验证：

```
30 *  *   *   *     /usr/bin/whoami 
```

这将每 30 分钟将 whoami 的结果邮寄给用户 davis。（我以用户 davis 的身份执行了 crontabe -e。）

如果您尝试查看哪些键用作用户 davis，请执行以下操作：

```
36 *  *   *   *     /usr/bin/ssh-add -l 
```

它会失败，通过邮件发送的日志会说

```
To: davis@xxxx.net
Subject: Cron <davis@hostyyy> /usr/bin/ssh-add -l

Could not open a connection to your authentication agent. 
```

解决方案是为上面的 ssh-agent 获取 env 脚本。这是生成的 cron 条目：

```
55 10  *   *   *     . /home/davis/.ssh/environment; /home/davis/bin/domythingwhichusesgit.sh 
```

这将在 10:55 运行脚本。注意领先。在脚本中。它说要在我的环境中运行这个脚本，类似于 .bash 初始化脚本中的内容。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2013-03-11T16:22:12.277

昨天我遇到了类似的问题...

我在一台服务器上有 cron 作业，它使用 ssh 在另一台服务器上启动一些操作......问题是用户权限和密钥......

在 crontab 我有

```
* * * * * php /path/to/script/doSomeJob.php 
```

而且它根本不起作用（没有权限）。我尝试以特定用户身份运行 cron，该用户连接到其他服务器

```
* * * * * user php /path/to/script/doSomeJob.php 
```

但没有任何效果。

最后，我导航到脚本，然后执行 php 文件，它工作了..

```
* * * * * cd /path/to/script/; php doSomeJob.php 
```

# c++ - upper_bound / lower_bound 的比较函数

> ID：869593
> 
> 赞同：18
> 
> 时间：2009-05-15T16:12:49.193
> 
> 标签：c++, algorithm, stl

我想在一个字段小于某个值 x 的排序向量中找到第一个项目。
我需要提供一个比较函数，将“x”与 MyClass 中的内部值进行比较，但我无法计算出函数声明。
我不能简单地重载 '<' 但是当 args 是 '&MyClass' 和 'float' 时我该怎么做？

```
 float x;
 std::vector< MyClass >::iterator last = std::upper_bound(myClass.begin(),myClass.end(),x); 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-15T16:29:52.210

您将什么函数传递给排序算法？您应该能够将相同的用于上界和下界。

进行比较的最简单方法是创建一个虚拟对象，并将关键字段设置为您的搜索值。那么比较总是在相似的对象之间进行。

**编辑：**如果由于某种原因您无法获得具有正确比较值的虚拟对象，那么您可以创建一个比较函子。仿函数可以为 operator() 提供三个重载：

```
struct MyClassLessThan
{
    bool operator() (const MyClass & left, const MyClass & right)
    {
        return left.key < right.key;
    }
    bool operator() (const MyClass & left, float right)
    {
        return left.key < right;
    }
    bool operator() (float left, const MyClass & right)
    {
        return left < right.key;
    }
}; 
```

如您所见，这是很长的路要走。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-03-24T18:21:47.887

您可以通过在 MyClass 中创建 MyClassLessThan 的静态实例来进一步改进 Mark 的解决方案

```
class CMyClass 
{
   static struct _CompareFloatField
   {
      bool operator() (const MyClass & left, float right) //...
      // ...
   } CompareFloatField;
}; 
```

这样你就可以通过以下方式调用lower_bound：

```
std::lower_bound(coll.begin(), coll.end(), target, CMyClass::CompareFloatField); 
```

这使它更具可读性

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2020-06-07T17:55:47.893

将 lambda 函数传递给 upper_bound

```
 float x;
 MyClass target;
 target.x_ = x;
 std::vector< MyClass >::iterator last = 
 std::upper_bound(myClass.begin(),myClass.end(),target, 
 [](const MyClass& a, const MyClass& b){return a.x_ < b.x_;}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T16:19:07.010

我想你需要的是`std::bind2nd(std::less<MyClass>(), x)`. 但是，当然，必须为 MyClass 定义 operator<。

编辑：哦，我认为您将需要一个 MyClass 的构造函数，它只接受一个浮点数，以便它可以被隐式转换。但是，可能有更好的方法来做到这一点。

# wordpress - 用不同的网址替换作者网址（wordpress）

> ID：869594
> 
> 赞同：1
> 
> 时间：2009-05-15T16:12:55.043
> 
> 标签：wordpress, permalinks

我们公司博客中有 3 位作者，**每个作者在个人资料设置中都有自己的站点 url**：

```
Mike - http://mike.com
Gelens - http://gelens.com
Admin - http://site.com/company/ 
```

配置文件的链接是：

```
http://site.com/author/Mike/
http://site.com/author/Gelens/
http://site.com/author/Admin/ 
```

我需要替换一个指向管理员页面的链接，因此，如果`<?php the_author_posts_link(); ?>`某个页面上有标签，并且作者是管理员，则链接必须是`http://site.com/company/`而不是`http://site.com/author/Admin/`.

**我怎样才能做到这一点？**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-24T15:14:39.853

看起来该`the_author_posts_link`函数只是调用以获取链接，该链接在返回之前将`get_author_posts_url`链接传递给过滤器。`author_link`在您的主题中`functions.php`，您可以添加类似这样的内容（未经测试）：

```
add_filter('author_link', 'admin_author_link', 10, 3);
功能 admin_author_link($link, $author_id, $author_nicename) {
    如果（$author_id==1）{
        $link = 'http://site.com/company/';
    }
    返回$链接；
}
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-01-02T18:44:32.640

我认为最少的胃灼热将是[wordpress > the_author_meta](http://codex.wordpress.org/Function_Reference/the_author_meta)。

像您所做的那样，让每个用户在 wordpress 用户配置文件中添加他们的 url。然后在您的主题中`functions.php`使用`the_author_meta('user_url')`. 请记住，这将回显 url。要将其用作变量，请使用`get_the_author_meta('user_url')`.

这是我们如何使用二十个主题来完成的，这是在`functions.php`

```
function twentyten_posted_on() {
printf( __( '<span class="%1$s">Posted on</span> %2$s <span class="meta-sep">by</span> %3$s', 'twentyten' ),
    'meta-prep meta-prep-author',
    sprintf( '<a href="%1$s" title="%2$s" rel="bookmark"><span class="entry-date">%3$s</span></a>',
        get_permalink(),
        esc_attr( get_the_time() ),
        get_the_date()
    ),
    sprintf( '<span class="author vcard"><a class="url fn n" href="%1$s" title="%2$s">%3$s</a></span>',
        get_the_author_meta('user_url'), //changed from get_author_posts_url( get_the_author_meta( 'ID' ) ),
        sprintf( esc_attr__( 'About %s', 'twentyten' ), get_the_author() ),
        get_the_author()
    )
);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-20T15:23:33.933

那是使用 .htaccess 重写 URL，这可以通过手动编辑 .htaccess 来实现。

但是对于使用诸如[http://wordpress.org/extend/plugins/redirection/](http://wordpress.org/extend/plugins/redirection/)之类的插件的初学者来说更容易， 这似乎可以满足您的需求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-18T15:47:26.840

您可以使用 http 重写来做到这一点。

# defensive-programming - 我的代码应该有多“防御”？

> ID：869599
> 
> 赞同：13
> 
> 时间：2009-05-15T16:14:35.477
> 
> 标签：defensive-programming

我正在和我的一位同事讨论你的代码应该如何防御。我都是专业的防御性编程，但你必须知道在哪里停下来。我们正在开发一个将由其他人维护的项目，但这并不意味着我们必须检查开发人员可以做的所有疯狂的事情。当然，你可以这样做，但这会给你的代码增加很大的开销。

你怎么知道在哪里画线？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-15T16:21:17.783

*用户*直接或间接输入的任何内容都应**始终**进行完整性检查。除此之外，`assert`这里和那里的几个 s 不会受到伤害，但无论如何，你不能对疯狂的程序员编辑和破坏你的代码做太多事情！-)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-15T16:19:34.420

我倾向于根据语言更改我在代码中的防御量。今天我主要在 C++ 中工作，所以我的想法正朝着那个方向发展。

在 C++ 中工作时，防御性编程是不够的。我对待我的代码就好像我在保护核机密，而其他所有程序员都想得到它们。断言、抛出、编译时错误模板黑客、参数验证、消除指针、深入的代码审查和一般的偏执狂都是公平的游戏。C++ 是一种邪恶而美妙的语言，我既喜欢它又严重不信任它。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-15T16:25:18.710

我不喜欢“防御性编程”这个词。对我来说，它建议这样的代码：

```
void MakePayment( Account * a, const Payment * p ) {
    if ( a == 0 || p == 0 ) {
       return;
    }
    // payment logic here
} 
```

这是错误的，错误的，错误的，但我一定已经看过数百次了。函数一开始就不应该用空指针调用，悄悄地接受它们是完全错误的。

这里的正确方法是有争议的，但最小的解决方案是通过使用断言或抛出异常来大声失败。

**编辑：**我不同意这里的一些其他答案和评论——我不认为所有函数都应该检查它们的参数（对于许多函数来说，这根本是不可能的）。相反，我认为所有函数都应该记录可接受的值，并声明其他值将导致未定义的行为。这是有史以来最成功且使用最广泛的库（C 和 C++ 标准库）所采用的方法。

现在让反对票开始......

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-15T16:20:06.010

我不知道真的有什么办法可以回答这个问题。这只是你从经验中学到的东西。您只需要问自己一个潜在问题可能有多普遍并做出判断。还要考虑到您不一定*必须*始终进行防御性编码。有时，只需注意代码文档中的任何潜在问题是可以接受的。

但最终，我认为这只是一个人必须遵循他们的直觉的东西。没有正确或错误的方法来做到这一点。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-15T16:19:50.160

如果您正在处理组件的公共 API，那么进行大量参数验证是值得的。这让我养成了到处做验证的习惯。那是一个错误。所有这些验证代码都没有经过测试，并且可能使系统变得比它需要的更复杂。

现在我更喜欢通过单元测试来验证。验证肯定会针对来自外部来源的数据进行，但不会针对来自非外部开发人员的调用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-15T16:24:47.417

我总是 Debug.Assert 我的假设。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-15T16:35:52.070

我个人的意识形态：程序的防御性应该与潜在用户群的最大天真/无知成正比。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-15T16:51:46.120

防御使用您的 API 代码的开发人员与防御普通用户没有什么不同。

*   检查参数以确保它们在适当的范围内和预期的类型
*   验证可以进行的 API 调用次数是否在您的服务条款范围内。通常称为限制它通常仅适用于 Web 服务和密码检查功能。

除此之外，除了确保您的应用程序在出现问题时能够很好地恢复，并且您始终向开发人员提供充足的信息以便他们了解正在发生的事情之外，没有什么可做的了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-15T16:19:43.483

防御性编程只是以按合同*设计*的编码方式履行合同的一种方式。

另外两个是

*   *总编程*和
*   *名义上的编程。*

当然，您不应该为开发人员可能做的*每一件疯狂的事情*辩护，但是您应该在上下文中说明它将使用先决条件做预期的事情。

```
//precondition : par is so and so and so 
function doSth(par) 
{
debug.assert(par is so and so and so )
//dostuf with par 
return result
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-15T16:24:31.333

我认为你必须提出你是否也在创建测试的问题。您应该在编码时采取防御措施，但正如 JaredPar 所指出的那样——我也相信这取决于您使用的语言。如果它是非托管代码，那么您应该非常防御。如果管理得当，我相信你还有一点回旋余地。

**如果您有测试，而其他一些开发人员试图抽取您的代码，测试将会失败**。但是话又说回来，这取决于您的代码的测试覆盖率（如果有的话）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-15T16:49:57.763

我尝试编写的代码不仅仅是防御性的，而且是敌对的。如果出现问题并且我可以修复它，我会的。如果不是，则抛出或传递异常并使其成为其他人的问题。任何与物理设备交互的东西——文件系统、数据库连接、网络连接都应该被认为是不可靠的并且容易发生故障。预测这些故障并捕获它们是至关重要的

一旦你有了这种心态，关键是你的方法要保持一致。您是否希望交回状态代码以解决调用链中的问题，或者您是否喜欢异常。混合模特会杀了你，或者至少会让你喝酒。沉重。如果您使用的是其他人的 api，则将这些东西隔离到根据您使用的术语捕获/报告的机制中。使用这些包装接口。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-15T16:51:05.280

如果这里的讨论是如何针对未来的（可能是恶意的或无能的）维护者进行防御性编码，那么您可以做的事情是有限的。通过测试覆盖率和自由使用断言你的假设来执行合同可能是你能做的最好的事情，并且应该以一种理想的方式来完成，它不会使代码混乱，并使未来的非邪恶维护者的工作更加困难。代码。断言很容易阅读和理解，并清楚地说明给定代码段的假设是什么，因此它们通常是一个好主意。

对用户行为进行防御性编码完全是另一个问题，我使用的方法是认为用户是来抓我的。每个输入都经过我所能管理的仔细检查，并且我尽一切努力让我的代码安全 - 尽量不要坚持任何未经严格审查的状态，尽可能纠正，如果不能优雅退出，等等。如果您只需考虑外部代理可能对您的代码进行的所有笨拙的事情，它就会使您处于正确的心态。

针对其他代码（例如您的平台或其他模块）进行防御性编码与用户完全相同：他们是来抓你的。操作系统总是会在不合时宜的时候换掉你的线程，网络总是会在错误的时间消失，而且总的来说，邪恶无处不在。您不需要针对所有潜在问题进行编码——维护成本可能不值得增加安全性——但考虑一下肯定不会有坏处。如果有一个你想到但由于某种原因认为不重要的场景，在代码中显式注释通常不会有什么坏处。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-15T18:02:36.107

系统应该有精心设计的边界，在那里进行防御性检查。应该决定在哪里验证用户输入（在什么边界）以及在哪里需要检查其他潜在的防御问题（例如，第三方集成点、公开可用的 API、规则引擎交互或由不同的程序员团队编码的不同单元）。在许多情况下，更多的防御性检查违反了 DRY，并且只是增加了维护成本而没有什么好处。

话虽如此，在某些方面你不能太偏执。应该非常严格地防范缓冲区溢出、数据损坏和类似问题的可能性。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-05-15T18:17:37.520

我最近有一个场景，其中用户输入数据通过远程外观接口传播，然后是本地外观接口，然后是其他一些类，最终到达实际使用它的方法。我在问自己一个问题：*什么时候应该验证价值？*我只将验证代码添加到最终类，其中实际使用了该值。在传播路径上的类中添加其他验证代码片段对我来说过于防御性编程。一个例外可能是远程门面，但我也跳过了它。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-08-05T12:45:03.117

好问题，我在做健全性检查和不做它们之间摇摆不定。它是 50/50

在这种情况下，我可能会采取中间立场，我只会“防弹”任何例程：

(a) 从项目中的多个地方调用

(b) 有可能改变的逻辑

(c) 不能使用默认值

(d) 例程不能优雅地“失败”

黑夜

# performance - 工作流设计器非常慢。是 Xoml 吗？

> ID：869606
> 
> 赞同：3
> 
> 时间：2009-05-15T16:15:57.437
> 
> 标签：performance, workflow, workflow-foundation

我有一个 WF 状态机，我用它来处理 WPF 媒体中心应用程序上的页面导航。它有六个状态，每个状态都有初始化处理程序和一个或两个 EventDriven 处理程序。

当您第一次使用 VS 模板创建 StateMachine 工作流时，您可以选择使用代码隐藏模型或代码分离模型，其中工作流拓扑在 .Xoml (xml) 文件中描述。

最近，每当我使用状态机时，Visual Studio 会间歇性地挂起长达十秒钟，之后它总是会恢复。

如果我使用 Code-behind 模型重做状态机，这可能是 Xoml 解析中固有的问题吗？

任何人都对任一模型中的 Workflow Designer 性能有相关经验吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T16:28:18.080

这是 Visual Studio 2008 中的工作流设计器的一个众所周知的问题。我们承诺在 sp1 中进行改进（据说得到了改进，但我什么也没注意到）。建议包括：

**将工作流中使用的所有类型移至工作流所在的不同项目。**

将接口、事件类型、自定义活动、助手类移动到工作流所在的不同项目中。例如，在一个客户的解决方案中，大约有 10 个项目，每个项目有 10 个工作流和 10 个关联的事件类型。每次用户更改项目中的工作流时，这些类型都会重新解析以更新以构建设计时类型信息。将这些移动到不同的程序集，例如仅一个项目，其中包含 10 个工作流项目所需的所有类型，将有助于提高性能。

**减少项目中的工作流数量。**

每个工作流都是一个类型（直接在c#/vb中，间接在xoml情况下）需要通过解析构建设计时类型，所以如果一个项目中有10个工作流，第一次打开项目中的任何工作流也意味着解析所有其他工作流。根据它们的功能对这些工作流进行分类并将它们分组到每个项目的 2-3 个工作流中，极大地提高了性能。

**将大型状态机工作流程重构为较小的工作流程**

我们从一位客户那里发现的一个示例在同一个工作流中有 780 个状态和 1000 个活动绑定，导致 InitializeComponent() 大约有 16000 行。将此状态机分解为更小的可重用工作流将使设计人员的性能更好，并减少大量冗余状态。

**不要在活动构造函数中做长时间运行的工作**

活动构造函数在设计时也被调用，因此连接数据库等操作永远不应该在构造函数中完成，这会使设计者花费太长时间来使用这些活动打开工作流文档。

来自：http: [//blogs.msdn.com/madhuponduru/archive/2008/09/30/workflow-designer-and-performance.aspx](http://blogs.msdn.com/madhuponduru/archive/2008/09/30/workflow-designer-and-performance.aspx)

-Oisin

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-04T15:53:36.510

VS 2008 给了我你描述的同样无法使用的缓慢行为。

我一直在 VS 2010（在 Win 7 RC VM 中）使用相同的 WF 项目，性能似乎有了很大提高。至少，图表布局并没有像 2008 年那样迷失方向。

所以也许未来还有希望。

# c# - 键盘类型（Qwerty 或 Dvorak）检测

> ID：869609
> 
> 赞同：5
> 
> 时间：2009-05-15T16:16:29.543
> 
> 标签：c#

一个朋友问了我这个问题，这激起了我的好奇心，我一直无法找到解决方案，所以我希望有人知道。

有没有办法以编程方式检测用户正在使用什么类型的键盘？我对键盘的理解是，DVORAK 键盘上的“A”发送到计算机的信号与 QUERTY 键盘上的“A”发送到计算机的信号相同。但是，我已经阅读了有关[切换到/从 dvorak](https://stackoverflow.com/questions/167031/programatically-change-keyboard-to-dvorak)的方法，即突出显示注册表调整，但我希望有一个机器设置或其他一些我可以查询的东西。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T16:20:11.343

这可能取决于操作系统。我确信某处有一个操作系统设置可以注册键盘的国籍。（德沃夏克被认为是一个国籍，因为法国键盘不同于美国键盘不同于......）

另外，只是一个旁注：'A'是一个不好的例子，因为'A'恰好是dvorak和qwerty中的同一个键...... B-）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T16:27:38.003

您可能可以通过 DirectInput 或任何当前的 DirectX 等效项来完成。我在 Dvorak 键盘上打字，我购买的大约 50% 的游戏会检测到我的键盘并重新配置默认键盘映射以支持它（例如，使用 ,aoe 而不是 wasd）

是的，正如布赖恩所说，两个键盘上的“A”都是一样的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-15T16:45:06.510

您可以通过调用 GetKeyboardLayoutName() Win32 API 方法来完成此操作。德沃夏克键盘有特定的名称。例如，美国 Dvorak 布局的名称为 00010409。

代码片段：

```
 public class Program
  {
    const int KL_NAMELENGTH = 9;

    [DllImport("user32.dll")]
    private static extern long GetKeyboardLayoutName(
          System.Text.StringBuilder pwszKLID); 

    static void Main(string[] args)
    {
      StringBuilder name = new StringBuilder(KL_NAMELENGTH);

      GetKeyboardLayoutName(name);

      Console.WriteLine(name);

    }
  } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T16:19:42.110

为什么会很重要？依赖于键盘的某些特殊实现根本不是一个好主意。我们到处使用条形码扫描仪来模拟键盘输入。你的程序会用这些设备做什么？:)

PS：上述注册表项将常规键盘的键排列为 dvorak 布局。

# c# - 在运行时解析参数名称

> ID：869610
> 
> 赞同：20
> 
> 时间：2009-05-15T16:16:44.067
> 
> 标签：c#, reflection, anonymous-types

> **可能重复：**
> [在 C# 中查找传递给函数的变量名称](https://stackoverflow.com/questions/72121/finding-the-variable-name-passed-to-a-function-in-c-sharp)

在 C# 中，有没有办法（越简洁越好）在运行时解析参数的名称？

例如，在以下方法中，如果您重命名方法参数，您还必须记住更新传递给 ArgumentNullException 的字符串文字。

```
 public void Woof(object resource)
    {
        if (resource == null)
        {
            throw new ArgumentNullException("resource");
        }

        // ..
    } 
```

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-15T16:20:14.590

单程：

```
static void Main(string[] args)
{
  Console.WriteLine("Name is '{0}'", GetName(new {args}));
  Console.ReadLine();
} 
```

此代码还需要一个支持函数：

```
static string GetName<T>(T item) where T : class
{
  var properties = typeof(T).GetProperties();
  Enforce.That(properties.Length == 1);
  return properties[0].Name;
} 
```

基本上，代码通过定义一个新的匿名类型来工作，该类型具有一个由您想要的参数组成的属性。GetName() 然后使用反射来提取该属性的名称。

这里有更多细节：http: [//abdullin.com/journal/2008/12/13/how-to-find-out-variable-or-parameter-name-in-c.html](http://abdullin.com/journal/2008/12/13/how-to-find-out-variable-or-parameter-name-in-c.html)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-05-15T16:19:59.597

简短的回答：不，没有。（够简洁吗？；）

（编辑：贾斯汀的回答可能很重要。它在我的嘴里留下了不好的味道，但它实现了“无需将参数名称放入字符串”的目标。我不认为我真的会算 AOP，因为这真的改变了一种完全不同的方法，而不是回答从方法中获取参数名称的原始问题。）

更长的答案：有一种方法可以找出方法的*所有参数*，但我认为在这种情况下它没有用。

这是一个显示来自几个方法的参数名称的示例：

```
using System;
using System.Reflection;

class Test
{
    static void Main()
    {
        Foo(null);
        Bar(null);
    }

    static void Foo(object resource)
    {
        PrintParameters(MethodBase.GetCurrentMethod());
    }

    static void Bar(object other)
    {
        PrintParameters(MethodBase.GetCurrentMethod());
    }

    static void PrintParameters(MethodBase method)
    {
        Console.WriteLine("{0}:", method.Name);
        foreach (ParameterInfo parameter in method.GetParameters())
        {
            Console.WriteLine(" {0} {1}",
                              parameter.ParameterType,
                              parameter.Name);
        }
    }
} 
```

这样就可以了，但是如果你有多个参数并且你想抛出一个适当的异常，你怎么知道（以一种安全的方式）使用哪个？理想情况下，您想要类似的东西：

```
public void Woof(object resource)
{
    if (resource == null)
    {
        throw new ArgumentNullException(infoof(resource));
    }

    // ..
} 
```

神话中的`infoof`运算符将返回 a `ParameterInfo`。不幸的是，这不存在。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-06-28T23:48:00.433

我处理了同样的问题。有几种获取参数名称的方法，但最高效的是深入到 IL 中。您可以在我的博客文章中看到我的实现示例，关于这个问题[消除参数验证的痛苦](http://bronumski.blogspot.com/2010/06/taking-pain-out-of-parameter-validation.html)。

这种方法的一个警告是您需要将参数名称作为委托传递，但为更简洁的代码付出的代价很小：

```
public void SomeMethod(string value)
{
    Validate.Argument(() => value).IsNotNull().IsNotEmpty();
} 
```

这比：

```
public void SomeMethod(string value)
{
    if (value == null)
    {
        throw new ArgumentNullException("value");
    }
    if (value == string.Empty)
    {
        throw new ArgumentException("Value cannot be an empty string.", "value");
    }
} 
```

静态方法方法允许我在一个流畅的界面中将多个方法链接在一起。最初返回一个 Argument 对象，它只允许一个基本的 null 测试，该测试返回一个 ReferenceArgument 对象，然后可以进行额外的验证。如果被测对象是值类型，则可以使用不同的测试。

API 允许许多常见测试，但很难捕获所有可能的测试，因此为了提供灵活性，通用测试方法允许提供表达式或函数，在前者的情况下，表达式实际上可以用作错误信息。

我的示例仅涵盖了一些基础知识，但您可以轻松扩展接口以检查范围并抛出 ArgumentOutOfRangeExceptions 或测试从特定基类继承的对象或实现接口。有一些类似的实现，但我还没有看到任何获得参数名称的实现。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-15T16:35:58.857

您可以使用 AOP 获取此信息。您可以定义在方法执行之前调用的拦截并在那里抛出异常。这也解决了空检查是一个横切关注点的问题。

[PostSharp](http://www.postsharp.org/)是 AOP 的一个很好的简单实现。

这是您的代码的样子（尚未测试，但它应该让您非常接近）

```
[AttributeUsage(AttributeTargets.Parameter)]
public class CanBeNullAttribute : Attribute
{
    private readonly bool canBeNull;

    public CanBeNullAttribute()
        : this(true)
    {
    }

    public CanBeNullAttribute(bool canBeNull)
    {
        this.canBeNull = canBeNull;
    }

    public bool AllowNull
    {
        get { return canBeNull; }
    }
}

[AttributeUsage(AttributeTargets.Method, AllowMultiple = false, Inherited = true)]
public class EnforceNullConstraintAttribute : OnMethodInvocationAspect
{
    public override void OnInvocation(MethodInvocationEventArgs eventArgs)
    {
        object[] arguments = eventArgs.GetArgumentArray();
        ParameterInfo[] parameters = eventArgs.Delegate.Method.GetParameters();

        for (int i = 0; i < arguments.Length; i++)
        {
            if (arguments[i] != null) continue;

            foreach (CanBeNullAttribute attribute in parameters[i].GetCustomAttributes(typeof(CanBeNullAttribute), true))
            {
                if (!attribute.AllowNull) throw new ArgumentNullException(parameters[i].Name);
            }
        }

        base.OnInvocation(eventArgs);
    }
} 
```

现在，您可以修改您的方法：

```
[EnforceNullConstraint]
public void Woof([CanBeNull(false)] object resource)
{
    // no need to check for null, PostSharp will weave it at compile time

    // execute logic assured that "resource" is not null
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-03T11:34:52.433

你可能想要：

1)

```
public static void ThrowIfNull<T>(Expression<Func<T>> expr)
{
    if (expr == null || expr.Compile()() != null) //the compile part is slow
        return;

    throw new ArgumentNullException(((MemberExpression)expr.Body).Member.Name);
} 
```

或者

2)

```
public static void ThrowIfNull<T>(Expression<Func<T>> expr)
{
    if (expr == null)
        return;

    var param = (MemberExpression)expr.Body;
    if (((FieldInfo)param.Member).GetValue(((ConstantExpression)param.Expression).Value) == null)
        throw new ArgumentNullException(param.Member.Name);
} 
```

并称之为：

```
Class.ThrowIfNull(() => resource); 
```

但这可能不是你想要的。它也慢很多 1) 比 2) 慢 1000 倍。或许：

3)

```
public static void ThrowIfNull<T>(this T item) where T : class
{
    if (item == null)
        return;

    var param = typeof(T).GetProperties()[0];
    if (param.GetValue(item, null) == null)
        throw new ArgumentNullException(param.Name);
} 
```

并称之为：

```
new { resource }.ThrowIfNull(); 
```

更干净，比上面2快多了！:)

您还可以为对象的属性扩展这些方法。例如，

```
new { myClass.MyProperty1 }.ThrowIfNull(); 
```

您可以缓存属性值以进一步提高性能，因为属性名称在运行时不会更改。请参阅相关问题[查找传递给函数的变量名称](https://stackoverflow.com/questions/72121/finding-the-variable-name-passed-to-a-function-in-c-sharp)

# nhibernate - NHibernate - 从聚合根向下钻取

> ID：869617
> 
> 赞同：0
> 
> 时间：2009-05-15T16:19:05.513
> 
> 标签：nhibernate, aggregateroot

给定一个聚合根 X，它有很多 Y，Y 有很多 Z...

如何深入了解关联并仅选择 Z 具有特定属性值的那些 X？

IList Xs = Session.CreateCriteria(typeof(X)) .CreateAlias("Ys", "Y") .CreateAlias("Y.Zs", "Z") .Add(Expression.Eq("Z.Property", 1 ）） 。列表（）;

这样做会导致 PropertyAccessException，我不知道为什么。

加载所有 X 并测试它们的 Z 属性将是非常多余的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-17T19:42:24.010

我已经尝试过了，在我的测试设置中它完美无缺。当设置属性时，PropertyAccessExceotion 可能与不可用的设置器或类型不匹配有关。如果您发布一些映射和实体源代码，它可能会有所帮助。

# sharepoint - ASP.Net AJAX 是否将其纳入 WSS3/MOSS Service Pack 1？

> ID：869641
> 
> 赞同：0
> 
> 时间：2009-05-15T16:25:07.760
> 
> 标签：sharepoint, asp.net-ajax, moss

有很多承诺和希望，但 MS 是否真的将 ASP.Net AJAX 包含在 WSS3 SP1 或 MOSS SP1 中？没有任何发行说明提到它......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T16:48:52.337

不，ASP.Net AJAX 不包含在任一 Service Pack 中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T16:53:18.253

ASP.Net AJAX 包含在 .net 3.5 中。

据我记得它不包含在 WSS3 或 MOSS SP1 中。

BTW WSS3 和 MOSS SP2 现已推出（我也不相信它包含在其中。）

设置起来并不难，您只需要在 web.config 和母版页中添加一些有趣的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-16T01:33:40.797

以我的经验，必须自行安装 ASP.NET AJAX（它没有包含在我安装的任何东西中）。[这是安装程序的下载链接](http://www.asp.net/ajax/downloads/)。

按照[本文](http://www.codeproject.com/KB/sharepoint/MossAjaxWebPart.aspx)将其加载到 SharePoint web.config 文件中。

# .net - 模块化产品的最佳 .NET 框架/方法？

> ID：869644
> 
> 赞同：3
> 
> 时间：2009-05-15T16:25:43.623
> 
> 标签：.net, asp.net-mvc, modularity

寻找有关构建模块化 Web 应用程序的框架和方法的建议。

主要目标是尽量减少重新部署的需要，但有时重新部署也可以。

Java 的 OSGI 似乎是正确的想法，但我需要一个 .NET 实现。

[http://www.osgi.org/Main/HomePage](http://www.osgi.org/Main/HomePage) [模块化网络应用程序](https://stackoverflow.com/questions/126073/modular-web-apps)

ASP.NET MVC + 呢？？？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T16:54:55.003

我会使用 ASP.NET MVC + [MEF](http://code.msdn.microsoft.com/mef)，你可以得到相当模块化。

请参阅[此示例](http://blogs.msdn.com/hammett/archive/2009/04/23/mef-and-asp-net-mvc-sample.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T16:28:44.397

研究领域驱动设计，Eric Evans 关于该主题的书是一个很好的资源。

您不需要 ASP.MVC 在 .Net 中构建 MVC 风格的应用程序，但它有助于获得 Microsoft 的支持 :)...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T16:40:31.000

如果您正在查看 .NET，那么 ASP.NET MVC 几乎绝对是您应该采用的方式。该设计允许您非常清晰地分离应用程序的各种关注点，并对其进行测试。根据您的要求，它可能具有的一个缺点是，任何更改的程序集都必须重新编译和重新部署，因为 ASP.NET MVC 应用程序不是就地编译的（据我所知......）。

但是，由于您已经清楚地分离了您的关注点（对吗？），并在部署之前运行了所有单元测试（对吗？），您可以部署一个已更改的新程序集，并且高度确信它不会更改打破任何东西。

如果您对 ASP.NET MVC 感兴趣，我强烈推荐 Scott Hanselman、Scott Guthrie、Rob Conery 和 Phil Haack 的新书 - 第一章（200 页和完整的应用程序教程！）可[在此处免费在线获取](http://tinyurl.com/aspnetmvc)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T16:42:13.850

有很多方法可以做到这一点。每个都有自己的权衡。

一种方法是拥有一个带有虚拟目录的基本主站点。每个虚拟目录将指向一个完整但相关的应用程序。缺点是您必须在创建 cookie 时指定要使用的基本 url，否则一个应用程序将无法访问另一个应用程序的 cookie。

另一种是通过用户控件创建每个子站点（想想 DNN）。这需要对核心应用程序如何公开通用功能进行大量思考和规划。

其他想法通常建立在其中之一之上。

# tdd - 测试驱动开发“进入壁垒”？

> ID：869645
> 
> 赞同：5
> 
> 时间：2009-05-15T16:26:12.873
> 
> 标签：tdd

我正在研究测试驱动开发，其中一个讨论点是与 TDD 相关的“进入障碍”。有没有人在这方面有任何经验，在你从事的任何项目中因为进入门槛太高而决定不使用 TDD？

据我所知，进入的唯一障碍是个别开发人员的知识（以及经验），大多数人并不完全习惯这个过程，而且有点陌生。鉴于大多数市场领先的工具都是开源的、免费提供的、有据可查的并且得到很好的支持，因此在财务上似乎非常有吸引力。

想法/感觉受到赞赏。

谢谢，

编辑 - 有人知道提倡 TDD 的人的任何高调引用吗？很想看看它在链条上上升到多高。干杯。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-15T16:59:07.133

一些障碍包括：

1.  不适合单元测试的现有代码库。
2.  难以进行有意义的单元测试的问题域，例如 GUI 工作或与第三方系统的集成。
3.  对单元问题的集成问题的看法（换句话说，如果它不能端到端地工作，它就不会做任何事情，那么测试单元的意义何在）。
4.  一种想要提前设计并拥有清晰的系统设计而不是测试驱动设计的心态
5.  一种政治文化，其中设计由与开发不同的人/团体完成，并且该设计对单元测试不友好。
6.  无法克服 TDD 不是关于一致性测试的事实（诸如“编写测试的人不应该是编写测试的人，他们对自己过于宽容”和此类变体之类的论点）。
7.  直到现在，他们的编码方式还不是他们的方式，所以这种转变更加困难。
8.  有时某个测试可能很难设置，因此该方法会因为“感觉”较慢而被放弃。
9.  不适合或根本不适合发展设计的设计要求（认为核电站控制软件或其他系统的实际生命取决于它们的正常运行）。
10.  如果每个人都没有在签入代码之前运行测试，那么测试开始经常因为错误的原因而中断（即代码的预期行为发生了变化，但测试没有跟上，所以测试是错误的，而不是代码) 所以它们可以被视为拖累。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-15T16:32:19.990

就进入壁垒而言，实际上，由于您明确编写了在代码被认为完成之前必须通过的测试，因此在开发周期中获得功能代码所涉及的前置时间更长。现在，当使用 TDD 时，您可以有效地保证代码的一定质量水平（无论您选择测试的质量水平如何），因此这通常足以弥补交付周期的延迟，但严格来说，使用 TDD 获取功能代码的准备时间更长。

实际上，如果您有编写无错误代码的编码人员，TDD 将拖累您的开发周期。当然，TDD 的价值在于没有任何程序员可以始终编写无错误的代码，因此必须在某个地方考虑​​修复错误的成本；在 TDD 中，测试基础设施的成本是预先加载的。

请注意，这绝不是 TDD 的负面影响。我只是说，前装可以被认为是“进入障碍”。就个人而言，作为一名程序员，我会说投资回报是值得付出努力的，我认为大多数有经验的开发经理也会如此。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-15T16:33:02.857

团队和/或管理层的支持是一些公司的最大障碍。如果您是唯一一个尝试使用 TDD 的开发人员，并且您无法让其他人对该项目感兴趣，那可能会非常令人沮丧。

当然，这根本不是财务障碍。最大**的财务**障碍可能是时间。如果您有一个需要编写单元测试的大型代码库，这似乎相当令人生畏。您的经理（或他们之上的人）会质疑您为什么要花时间编写不会向代码添加特性/功能的代码。许多人没有意识到预先编写测试（就像您在 TDD 中所做的那样）实际上可以*节省您的时间*，无论是立即还是从长远来看，当您维护该代码时。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-15T20:19:39.287

我认为一个主要障碍是它如何要求你改变你的思维方式。

在我尝试 TDD 之前，我会创建一个类，比如 Employee，然后我会存根诸如 FirstName、LastName、Email 等内容。然后我会编写一些逻辑并忘记我错过了一些字段或其他内容。在我知道之前，我有一个非常复杂的课程，不知道这些字段是否是必要的。

此外，这与我们习惯于编写软件的方式完全不同。我们习惯于编写软件，因为我们从签署我们支票的人那里收到功能。我们不习惯编写无法编译的代码，使其编译，然后使其工作以使我们的测试通过。

第一次这样做时，你会觉得有点……愚蠢和愚蠢。为什么我故意让我的代码失败？这与我们长期以来被教导的“让它发挥作用”的理念似乎不合逻辑。

到目前为止我工作的地方失败的几个原因：

1.  大多数正在进行的项目都是较旧的应用程序。不是 .NET 之前的版本，而是 .NET 2.0，在某些情况下是 .NET 1.0。
2.  其中一些项目没有得到很好的考虑，要么是因为 1.0 中没有该技术，要么是因为他们现在需要一些东西而快速构建。
3.  正如 Jon 所指出的，对于单元测试、UI、数据库等，有些东西仍然是 PIA（痛苦的***）。
4.  昂贵的工具。如果您只被允许使用 Microsoft 工具，那么以“正确的方式”执行此操作将付出高昂的代价。我们使用 resharper，所以这真的不是问题。
5.  时间。我在一个由三个人组成的团队中，支持一个 30 人的部门。我们被认为是开销，我们的许多开发都包括将系统连接在一起

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T17:00:45.707

一个不明显的障碍（至少对我来说不明显）是构建基础设施。如果开发人员无法控制构建过程，或者基础架构过于陈旧而无法管理，那么将测试集成到构建过程中就会以“效率”的名义被抛到一边。（当然，在这些情况下，应该以效率的名义将构建基础设施搁置一旁。）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-15T16:34:05.303

是的，进入的主要障碍是在你的头脑中或在其他程序员的头脑中。

一开始你不知道在你的测试中要写什么。

诀窍是考虑如何使用您的代码，而不是专注于您将如何编写它。说起来容易做起来难……

当您开始“了解”时，有点难以知道在哪里停止编写测试。你必须记住，测试什么都证明不了，所以你不能编写测试来涵盖所有情况，你必须选择最有用的那些......这已经很多了！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-15T16:41:23.617

我当然看到了很多阻力。我遇到的障碍是：

*   单元测试用户界面（Web 或胖客户端）很棘手。我知道有*很多*尝试来解决这个问题，但我认为他们中的任何一个都没有让它变得非常简单——因为这是一个自然而然的难题。
*   另一方面，尽管有多种方法可以更轻松地测试与数据库相关的代码，但它仍然很棘手且耗时。
*   虽然好的测试肯定会加快整体开发速度，但测试是一种技能——虽然你不擅长它，但单元测试可能比它的价值更麻烦，这意味着你永远不会建立技能......
*   经理们经常将其视为开发的一个可选附加项——拥有它而不是关键。这意味着当项目不可避免地出现资源紧张时，这是第一件事。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-15T16:44:42.673

几周前我写了一篇关于这个的长篇文章，“[为什么我先写测试](http://www.coveros.com/blog/?p=72)”。

我认为最大的障碍是建立从测试开始的学科，但我不认为 TDD（或任何与此相关的实践）应该始终、绝对、100% 地解决问题。

TDD 是每个开发人员的工具。我倾向于认为它在大多数情况下对我很有效。不习惯于编写测试（首先或其他方式）的开发人员如果强制执行 TDD，可能会很难完成任何事情，因为他们无法考虑首先编写测试。

我认为自己是一位经验丰富的测试编写者，但我不能总是从测试的角度思考。有些问题不适合它，或者至少我的头脑有些日子没有被它缠住。并且某些类型的代码（例如 UI 和客户端代码）并不适合始终编写测试。

如果您有一个开发人员团队不习惯性地编写测试，我会先推动它。我没有问题要求所有新代码在可能/可行的情况下都附带单元测试。一旦测试成为一门学科，将开发人员单独或作为一个团队转换为 TDD 会容易得多。

# c++ - 重新抛出指针捕获的异常

> ID：869648
> 
> 赞同：1
> 
> 时间：2009-05-15T16:27:35.773
> 
> 标签：c++, exception

在 C++ 中，以下示例有什么区别？

**重新抛出指针**：

```
catch (CException* ex)
{
    throw ex;
} 
```

**简单的重新抛出**：

```
catch (CException* ex)
{
    throw;
} 
```

当重新抛出被捕获时，堆栈跟踪会有所不同吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-15T16:29:03.460

是的。基本上，在第一种情况下，您是自己扔物体。看起来您自己`throw ex`在行中生成了异常。在第二种情况下，您只是让原始对象在调用堆栈中上升（从而保留原始调用堆栈），它们是不同的。通常，您应该使用`throw;`.

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-05-15T16:44:33.780

我认为存在性能差异。第二个版本不会制作异常的临时副本。第一个将创建一个副本，因此第二个是要走的路。

您可以创建一个简单的异常类并尝试一下，让构造函数/复制构造函数在它们被触发时打印到控制台。这样你就应该看到区别了。

# php - 让 SimpleXMLElement 在输出中包含编码

> ID：869650
> 
> 赞同：22
> 
> 时间：2009-05-15T16:27:53.150
> 
> 标签：php, xml, dom, simplexml

这个：

```
$XML = new SimpleXMLElement("<foo />");
echo($XML->asXML()); 
```

...输出：

```
<?xml version="1.0"?>
<foo/> 
```

但我也希望它输出编码：

```
<?xml version="1.0" encoding="UTF-8"?>
<foo/> 
```

有没有办法告诉 SimpleXMLElement 包含 <?xml?> 标记的编码属性？除了这样做：

```
$XML = new SimpleXMLElement("<?xml version='1.0' encoding='utf-8'?><foo />");
echo($XML->asXML()); 
```

哪个有效，但是必须手动指定版本和编码很烦人。

出于这个问题的目的，假设我不能使用 DOMDocument 代替。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-07-30T11:48:16.877

你可以试试这个，但你必须为 $xml使用**simplexml_load_string**

```
$xml // Your main SimpleXMLElement
$xml->addAttribute('encoding', 'UTF-8'); 
```

或者您仍然可以使用其他方式将编码添加到您的输出中。

**简单更换**

```
$outputXML=str_replace('<?xml version="1.0"?>', '<?xml version="1.0" encoding="UTF-8"?>', $outputXML); 
```

**常用表达**

```
$outputXML=preg_replace('/<\?\s*xml([^\s]*)\?>/' '<?xml $1 encoding="UTF-8"?>', $outputXML); 
```

**DOMDocument** -*我知道你说过你不想使用 DOMDocument，但这里有一个例子*

```
$xml=dom_import_simplexml($simpleXML);
$xml->xmlEndoding='UTF-8';
$outputXML=$xml->saveXML(); 
```

您可以将此代码包装到一个函数中，该函数接收参数 $encoding 并将其添加到

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2016-05-14T19:15:23.867

简单明了只做这个

```
$XMLRoot = new SimpleXMLElement('<?xml version="1.0" encoding="utf-8"?><element></element>'); 
```

输出

```
<?xml version="1.0" encoding="UTF-8"?>
      <element></element> 
```

在元素中添加属性仅使用

```
$XMLRoot->addAttribute('name','juan'); 
```

添加儿童使用

```
$childElement = $XMLRoot->addChild('elementChild');
$childElement->addAttribute('attribName','somthing'); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-06-15T12:27:19.893

如果文档不太重， [Cristian Toma](https://stackoverflow.com/a/1206090)的 DOMDoc 提议似乎是一个不错的方法。你可以把它包装成这样：

```
private function changeEncoding(string $xml, string $encoding) {
    $dom = new \DOMDocument();
    $dom->loadXML($xml);
    $dom->encoding = $encoding;
    return $dom->saveXML();
} 
```

当您无权访问生成 xml 的序列化程序时会派上用场。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-16T07:37:01.593

我会说您需要在创建每个 XML 对象时执行此操作。即使 SimpleXMLElement 有设置它的方法，你仍然需要设置它，因为我猜对象可能会选择一个有效的默认值。

也许创建一个常量并像这样创建对象

```
$XML = new SimpleXMLElement($XMLNamespace . "<foo />");
echo($XML->asXML()); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-22T03:05:26.710

如果您不指定编码，SimpleXML 无法（理智地）猜出您想要的是哪一个。

# asp.net - 如何在周围的 DIV 上添加额外的 CSS 类以防止表单验证失败？

> ID：869662
> 
> 赞同：3
> 
> 时间：2009-05-15T16:30:24.003
> 
> 标签：asp.net

这是我的场景：

```
 <!-- Normal Control -->
  <div class="required">
    <label for="address1">Address line 1</label>
    <input type="text id="address1" name="address1" class="inputText" />
  </div>

  <!-- Same Control - but with a validation error -->
  <div class="required error">
    <p class="error">Address Line 1 Field is required</p>
    <label for="address1">Address line 1</label>
    <input type="text id="address1" name="address1" class="inputText" />
  </div> 
```

在“验证错误”html 区域中，我可以使用如下代码显示消息：

```
 <div class="required">
    <asp:RequiredFieldValidator id="address1_validate" runat="server" ControlToValidate="address1" Text='<p class="error">Address Line 1 Field is required</p>' />
    <label for="address1">Address (line 1)</label>
    <asp:TextBox id="address1" CssClass="inputText" CausesValidation="true" runat="server"/>
  </div> 
```

我不能做的是将附加类添加到周围的 div 标签中。我在想我可以做类似的事情：

```
 <div class="required <%= !address1_validate.isValid ? "error" : "" %>"> 
```

那几乎是行不通的。

无论如何，我不想依赖 JavaScript 来设置这些值——它需要像“Web 1.0”一样工作。

有任何想法吗？

谢谢，乔恩

-------- 我的解决方案------- 这是对我有用的代码：

```
 protected void Page_Load(object sender, EventArgs e)
  {
    if (this.IsPostBack)
    {
      address1_validate.Validate();
      if (!address1_validate.IsValid)
      {
        address_panel.CssClass = "required error";
      }
    }
  } 
```

和前端：

```
 <asp:Panel runat="server" id="address_panel" CssClass="required">
    <asp:RequiredFieldValidator id="address1_validate" runat="server" ControlToValidate="address1" Text='<p class="error">Address Field is required</p>' />
    <label for="address1">Address (line 1)</label>
    <asp:TextBox id="address1" CssClass="inputText" CausesValidation="true" EnableViewState="true" runat="server"  />
  </asp:Panel> 
```

谢谢您的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T16:48:01.073

您可以用 ASP 面板替换 div，当然 runat=server。

```
<asp:Panel runat="server" ID="Panel1">
    <label for="address1">Address line 1</label>
    <input type="text id="address1" name="address1" class="inputText" />
</asp:Panel> 
```

在代码隐藏中，您可以执行以下操作 -

```
address1_validate.Validate();
...
...
if(address1_validate.IsValid)
     Panel1.CssClass = "required";
else
     Panel1.CssClass = "required error"; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T16:36:43.097

可以在上面放一个 ID 并 runat="server" 并在后面的代码中更改它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T16:37:01.710

首先，将 runat=server 和一个 id 添加到外部 div。

从这里你有几个选择。您可以覆盖页面上的 validate 方法并更改该 div 上的类设置。

或者，您可以创建一个继承自 requiredfieldvalidator 的自定义验证器。添加一个属性来保存 div id，并在验证代码中根据需要注入您的类。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-02-10T03:17:49.787

只是想我会添加到这一点，如果你为RequiredFieldValidator或CustomValidator挂钩OnPreRender并将类添加到正在验证的元素/控件，你可以这样做：

```
protected void uxValidator_PreRender(object sender, EventArgs e)
    {
        RequiredFieldValidator uxValidator = sender as RequiredFieldValidator;
        bool isValid = true;
        WebControl control = null;
        if (uxValidator != null)
        {
            isValid = uxValidator.IsValid;
            control = uxValidator.NamingContainer.FindControl(uxValidator.ControlToValidate) as WebControl;
        }
        else
        {
            CustomValidator uxCustomValidator = sender as CustomValidator;
            if (uxCustomValidator != null)
            {
                isValid = uxCustomValidator.IsValid;
                control = uxCustomValidator.NamingContainer.FindControl(uxCustomValidator.ControlToValidate) as WebControl;
            }
        }
        if (control != null)
        {
            if (!isValid)
            {
                control.Attributes["class"] = "error";
            }
            else
            {
                if ((control as TextBox) != null && !string.IsNullOrEmpty((control as TextBox).Text))
                {
                    control.Attributes["class"] = "";
                }
            }
        }
    } 
```

# c++ - 带继承的多线程 (C++)

> ID：869664
> 
> 赞同：0
> 
> 时间：2009-05-15T16:30:37.903
> 
> 标签：c++, multithreading, inheritance

我正在尝试在新线程中调用“运行”函数。现在，我使用 openMP 的这段代码实际上并没有在新线程中运行“运行”。注意：我不是在寻求使用 OpenMP 的帮助。这段代码只是一个快速修复。我更喜欢 CreateThread() 方法来解决这个问题。

```
vector<ICommand*>* commands;
string strInput;
// For each command...
for(vector<ICommand*>::iterator i = commands->begin(); i != commands->end(); ++i)
{
    // ...if the current command we're examining is valid...
    if((*i)->ContainsCommand(strInput))
    {
        // ...run it in a new thread and don't let ZChatInput handle it normally...
        #pragma omp sections nowait
        {
        #pragma omp section
            (*i)->Run(strInput);
        #pragma omp section
            bRet = false;
        }

        // ...and don't check any more commands.
        break;
    }

} 
```

那么如何仅使用标准和 STL 来完成呢？当然，我正在寻找一种可行的方法:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T16:39:19.160

使用 Boost.Thread 怎么样？

```
if((*i)->ContainsCommand(strInput))
{
    boost::thread t( boost::bind( &ICommand::Run, *i ) );
} 
```

这将在一个分离的线程中运行“运行”。（注意，我没有对此进行测试。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T16:48:00.200

像这样？[http://msdn.microsoft.com/en-us/library/kdzttdcb(VS.80).aspx](http://msdn.microsoft.com/en-us/library/kdzttdcb(VS.80).aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-15T17:56:45.340

你可以尝试这样的事情：

```
vector<ICommand*>* commands;
string strInput;

void CommandOnThread(void* command)
{
    (ICommand*)command->Run();
}

// For each command...
for(vector<ICommand*>::iterator i = commands->begin(); i != commands->end(); ++i)
{
    // ...if the current command we're examining is valid...
    if((*i)->ContainsCommand(strInput))
    {
        //Attach the input to the command
        (*i)->AttachInput(strInput);
        _beginthread(CommandOnThread, 0, *i);
        break;
    }
} 
```

为此，您必须稍微更改命令接口，以便分两步传递命令输入：首先将输入存储在命令对象中，然后不带参数调用 Run()。如果你喜欢它们非常相似，你可以用 CreateThread 替换 _beginthread。

澄清一下：您不能使用实例方法作为 _beginthread（或 CreateThread）的函数参数。上面的解决方案是将对象（命令）传递给函数，然后调用它的实例方法（运行）。但是在这种情况下，您不能将额外的参数传递给线程函数，因此不能将参数传递给实例方法。最简单的解决方案是在将参数传递给线程函数之前以某种方式将参数附加到实例。

我希望这有帮助。当然，如果您无法更改 Command 类的接口和实现，则此解决方案是不可能的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T16:44:45.293

您真的要为每个命令创建一个线程吗？线程创建是昂贵的。如果您绝对需要这部分是异步的 - 创建一个同步队列，预生成线程数（这是您的可伸缩性）让它们阻塞在队列中，然后将消息（指针？）放入循环中的队列中。

回答您的评论：

```
// 设置
同步队列 wq；// 这将受到互斥锁和一个或两个条件变量的保护
for ( i = 0; i < parallel_factor; ++i ) start_thread( th_func, wq );
...

// 你的循环体：
    ...
    if (valid_input) q.put(item);
    ...

//线程函数
无效 th_func(sync_queue&q)
{
    工作项目* pwi；
    而 (( pwi = q.get())) do_it( pwi );
}

```

说得通？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-18T19:55:43.843

所以我在仔细检查了 MSDN 文档后发现了它。以下是我的做法，以防你们中的任何人感兴趣：

```
static vector<ICommand*>* commands;
// This is what we pass to CommandOnThread.
struct CommandParameter
{
    string strInput;
    ICommand* command;
};

int CommandOnThread(CommandParameter* cp)
{
    cp->command->Run(cp->strInput);
    delete cp;

    return 0;
}

void foo()
{
    string strInput;
    ...
    // For each command...
    for(vector<ICommand*>::iterator i = commands->begin(); i != commands->end(); ++i)
    {
        // ...if the current command we're examining is valid...
        if((*i)->ContainsCommand(strInput))
        {
            // Put the CP on the stack.
            CommandParameter* temp = new CommandParameter;
            if(temp == NULL)
            {
                Print("Out of memory!");
                bRet = false;
                break;
            }

            // ...set up the parameters to createthread...
            temp->strInput = strInput;
            temp->command = *i;

            // ...run it in a new thread...
            CreateThread(NULL, NULL, (LPTHREAD_START_ROUTINE)CommandOnThread, temp, NULL, NULL);

            // ...and don't check any more commands.
            bRet = false;
            break;
        }
    }
} 
```

# php - PHP 5.3 或 6 windows 安装

> ID：869667
> 
> 赞同：1
> 
> 时间：2009-05-15T16:31:01.163
> 
> 标签：php, apache, httpd.conf

如何将最新版本的 PHP 安装为 Apache 2 模块？PHPIniDir 指令抛出错误。更重要的是，在最新的 PHP 发行版中没有 php5apache2.dll 文件或类似文件！

[示例 distr php 5.3](http://windows.php.net/downloads/snaps/php-5.3-nts-win32-VC9-x86-latest.zip)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T19:18:43.740

根据[PHP QA 站点](http://windows.php.net/qa/)，如果您将 PHP 与 Apache 1 或 Apache2 一起使用，那么您需要使用 VC6 候选版本，而不是 VC9。VC9 用于 IIS。

由于您在问题中提供的链接指向 VC9 下载，因此我假设您下载的是该链接，我会说您应该下载 VC6 版本。

# entity-framework - 从另一个表向实体框架实体添加属性

> ID：869668
> 
> 赞同：2
> 
> 时间：2009-05-15T16:31:09.837
> 
> 标签：entity-framework, wcf-data-services

我刚开始使用 Entity Framework 和 ADO.NET 数据服务，我遇到了一个我似乎无法弄清楚的问题。我有两张表，一张包含用户信息，另一张包含创建者字段。在数据库中，这些表之间没有外键。用户表包含任意 ID、用户名和显示名称。created by 字段包含用户的用户名。在我的实体中，我想拥有用户的显示名称，因为这是我需要通过 ADO.NET 数据服务显示和公开的内容？我知道我可以重组数据库，但我希望我可以像在 SQL 语句中那样使用用户名进行连接。

提前致谢，

-达米安

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T16:54:02.650

您可以使用两个表的连接创建视图，然后使用此对象显示用户名。

这里有一些关于映射自定义查询的[信息](http://msdn.microsoft.com/en-us/library/cc982038.aspx)。

# python - 使用post方法和python下载文件

> ID：869679
> 
> 赞同：2
> 
> 时间：2009-05-15T16:33:32.107
> 
> 标签：python, urllib2

我需要一些帮助来获取从网站下载的 tar 文件。该网站设置为一个表单，您可以在其中选择所需的文件并单击提交，然后会打开下载窗口供您选择位置。

我试图在代码中做同样的事情（所以我不必手动选择每个文件）。到目前为止，我已经让 python 2.5.2 返回响应，但它在 a 中`socket._fileobject`，我现在不知道如何将它转换为我计算机上的文件。

下面是 python shell 的输出和我采取的步骤

```
Python 2.5.2 on win32

IDLE 1.2.2      
>>> import urllib
>>> import urllib2
>>> url = 'http://website/getdata.php'
>>> values = {'data[]': 'filex.tar'}
>>> data = urllib.urlencode(values)
>>> req = urllib2.Request(url,data)
>>> response = urllib2.urlopen(req)
>>> response
addinfourl at 22250280 whose fp = <socket._fileobject object at 0x01534570
>>> response.fp
socket._fileobject object at 0x01534570 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T16:38:53.373

附加这个：

```
myfile = open('myfile.tar', 'wb')
shutil.copyfileobj(response.fp, myfile)
myfile.close() 
```

`response.fp`是一个可以读取的类文件对象，就像打开的文件一样。 `shutil.copyfileobj()`是一个简单的函数，它从一个类文件对象读取并将其内容写入另一个。

# javascript - KeyPress Javascript函数的问题

> ID：869681
> 
> 赞同：1
> 
> 时间：2009-05-15T16:34:00.593
> 
> 标签：javascript

我使用 OnKeyPress="clickSearchButton()" 从文本框中调用 javascript 函数

这是我的功能：

```
function clickSearchButton()
{
  var code = e.keyCode || e.which;
  var btnSearch = document.getElementById("TopSubBanner1_SearchSite1_btnSearchSite");
  if(code == 13);
      {          
           btnSearch.click(); 
           return false; 
      } 
} 
```

我的问题是，当用户点击任何文本框中的输入按钮时，该函数会触发，而不仅仅是调用该函数的那个​​。我错过了什么？

编辑：仍然无法正常工作。所以如果有帮助的话，我会把我的 HTML 扔出去。

```
<input name="TopSubBanner1:SearchSite1:txtSearch" type="text" id="TopSubBanner1_SearchSite1_txtSearch" OnKeyPress="clickSearchButton(this)" /><input type="submit" name="TopSubBanner1:SearchSite1:btnSearchSite" value="Search" id="TopSubBanner1_SearchSite1_btnSearchSite" /> 
```

此外，如果这有所不同，这是一个 ASP.NET 页面。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-15T16:44:52.830

默认情况下，该事件作为参数传递给您的函数，但您不会将其作为参数捕获。如果您捕获它，则上述内容应该可以正常工作。

```
function clickSearchButton(e)
{
   e = e || window.event //for IE compliane (thanks J-P)
   //etc 
```

或者

```
function clickSearchButton()
{
   var e = arguments[0];
   e = e || window.event; 
```

正如凯文指出的那样，你还有一个额外的分号。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-15T16:37:47.387

```
function clickSearchButton(e)
{
  var code;

if(window.event)
    code = e.keyCode;
else
   code = e.which;

var btnSearch = document.getElementById("TopSubBanner1_SearchSite1_btnSearchSite");
  if(code == 13)
      {          
           btnSearch.click(); 
           return false; 
      } 
} 
```

你的调用方法应该是：

```
onkeypress="clickSearchButton(event)" 
```

# debugging - 有哪些技术和工具可用于帮助调试 SiteKiosk 客户端？

> ID：869697
> 
> 赞同：0
> 
> 时间：2009-05-15T16:37:39.210
> 
> 标签：debugging

我负责一些 SiteKiosk 客户端机器的维护和开发。目前，我们正在运行该软件的第 6 版，近期不打算升级。

我有一台演示机器，我可以在其中打开任何我想促进调试的功能，但 SiteKiosk 中的嵌入式浏览器支持的功能非常有限。更重要的是，它启用了自定义 Javascript 对象，阻止我尝试在非嵌入式浏览器中查看我的代码。

无论如何，您使用什么技术来针对这个浏览器进行编码？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-09-05T16:34:22.570

您可以在开发机器上运行该软件并关闭所有保护功能（窗口管理、键盘过滤器、外壳替换等），启用调试窗口，然后使用 SiteKiosk.Logfile.Notification() 方法将输出打印到调试窗户。

# ruby-on-rails - 从两个不同的域发送电子邮件（使用 Postfix）

> ID：869700
> 
> 赞同：2
> 
> 时间：2009-05-15T16:38:31.457
> 
> 标签：ruby-on-rails, email

我有两个 Ruby on Rails 应用程序和两个虚拟域（mydomain1.com 和 mydomain2.com）（使用 Apache+REE+mod_rails）。我使用 Postfix 作为邮件服务器。

所以我在 main.cf 中有 myhostname = mail.mydomain1.com 这就是为什么发件人总是 mail.mydomain1.com，无论我从哪个应用程序发送电子邮件。

我需要从虚拟域 mydomain1.com 上的应用程序发送的所有电子邮件都已收到：来自 mydomain1.com，以及来自 mydomain2.com 上的第二个 Rails 应用程序 - 已收到：来自 mydomain2.com

那可能吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-01T18:30:17.080

`Received:`标头由接收服务器添加，它只是对连接（发送者）IP 地址进行反向 DNS 查找。除非您可以强制 Postfix 在特定 IP 上进行传出连接，然后将每个域的 IP 绑定到您的服务器，否则您将无法获得所需的结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T17:08:32.897

我想有一种方法可以配置 Postifx 以将虚拟帐户用于单独的域。使用它，您应该能够让您的两个应用程序使用不同的设置。

也许这有帮助：

[http://howtoforge.org/virtual-users-and-domains-postfix-courier-mysql-centos5.1](http://howtoforge.org/virtual-users-and-domains-postfix-courier-mysql-centos5.1)

或这个

[http://www.akadia.com/services/postfix_separate_mailboxes.html](http://www.akadia.com/services/postfix_separate_mailboxes.html)

马特

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T19:48:28.957

这是一个很好的问题，但我不相信有一个简单的答案。

在过去的某一时刻，postfix 的作者表示“postfix 仅根据收件人地址做出投递决定。依赖于发件人的路由没有逻辑。” 那是几年前的事了，但它可能仍然是真的。

有些人尝试使用两个独立的 Postfix 实例。[这里](http://souptonuts.sourceforge.net/postfix_sbr.html)有一篇文章可能会有所帮助，尽管我没有仔细研究过它。

# c# - Windows 服务的位置 *not* 在我的项目中

> ID：869701
> 
> 赞同：1
> 
> 时间：2009-05-15T16:38:37.243
> 
> 标签：c#, .net, windows-services

如果我在“服务”对话框中右键单击并选择服务（例如，即插即用）的属性，我会得到几条信息，包括“可执行文件的路径”。对于即插即用（在 Vista 中），这是：

C:\Windows\system32\svchost.exe -k DcomLaunch

如果我知道服务名称（和/或显示名称），是否有某种方法可以使用 .NET 代码获取相同的信息？

（我不能使用`GetExecutingAssembly()`，因为我没有从我的项目中运行服务。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T16:51:06.853

没有互操作的另一种选择是 WMI 查找（或注册表 - 有点 hacky！）。

这是一个基于[此代码](http://www.developmentnow.com/g/36_2005_4_0_0_505060/Get-path-for-install-service.htm)的快速示例：

```
private static string GetServiceImagePathWMI(string serviceDisplayName)
{
    string query = string.Format("SELECT PathName FROM Win32_Service WHERE DisplayName = '{0}'", serviceDisplayName);
    using (ManagementObjectSearcher search = new ManagementObjectSearcher(query))
    {
        foreach(ManagementObject service in search.Get())
        {
            return service["PathName"].ToString();
        }
    }
    return string.Empty;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-02-21T07:40:32.797

[总是有这里](http://msdn.microsoft.com/en-us/library/aa394418%28v=VS.85%29.aspx)`Win32_Service`描述的 WMI 类，特别是.`PathName`

这有效：

```
ManagementClass mc = new ManagementClass("Win32_Service");
foreach(ManagementObject mo in mc.GetInstances())
{
    if(mo.GetPropertyValue("Name").ToString() == "<Short name of your service>")
    {
        return mo.GetPropertyValue("PathName").ToString().Trim('"');
    }
} 
```

如果您有任何与 Reference 有关的问题，请在您的项目中添加[System.Management](http://msdn.microsoft.com/en-us/library/wkze6zky%28VS.80%29.aspx)的引用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T16:46:07.333

此信息位于[QUERY_SERVICE_CONFIG](http://msdn.microsoft.com/en-us/library/ms684950(VS.85).aspx)结构中。您将需要使用 P/Invoke 将其取出。

基本流程是：

调用 OpenSCManager 以获取托管服务的句柄。

调用 OpenService 以获取服务的句柄。

调用 QueryServiceConfig 以获取 QUERY_SERVICE_CONFIG 结构。

# crystal-reports - 公式字段中的数字到字符串

> ID：869702
> 
> 赞同：19
> 
> 时间：2009-05-15T16:38:39.910
> 
> 标签：crystal-reports, data-conversion

我正在使用公式字段来连接用破折号分隔的 2 个十进制值。但是，我希望结果为两个值修剪所有不必要的尾随零和小数点。

例如，我希望值 10 和 8.5 为“10 - 8.5”。现在它显示“10.00 - 8.50”。

我使用的公式是`CSTR({field1}) + " - " + CSTR({field2}).`

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-05-15T16:58:59.207

我相信这就是您正在寻找的：

[将十进制数转换为仅显示非零小数的文本](http://www.kenhamady.com/form15.shtml)

特别是这一行可能会有所帮助：

```
StringVar text     :=  Totext ( {Your.NumberField} , 6 , ""  )  ; 
```

第一个参数是要转换的小数，第二个参数是小数位数，第三个参数是千/百万等分隔符。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2012-04-12T18:05:42.220

```
CSTR({number_field}, 0, '') 
```

第二个占位符用于小数。

最后一个占位符用于千位分隔符。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-27T13:30:52.680

我为此写了一个简单的函数：

```
Function (stringVar param)
(
    Local stringVar oneChar := '0';
    Local numberVar strLen := Length(param);
    Local numberVar index := strLen;

    oneChar = param[strLen];

    while index > 0 and oneChar = '0' do
    (
        oneChar := param[index];
        index := index - 1;
    );

    Left(param , index + 1);
) 
```

# iphone - iPhone 应用程序架构

> ID：869712
> 
> 赞同：4
> 
> 时间：2009-05-15T16:42:22.447
> 
> 标签：iphone, web-services

谁能给我指点具体的书，或者给我一个关于数据驱动的 iPhone 应用程序架构的快速概述？例如，假设您正在实现一个搜索在线购物网站并为您提供建议的应用程序......等等。建立一个托管的 Web 服务后端，让所有数据库/购物网站 API 连接/Web 服务正常工作并让 iPhone 应用程序在该后端使用服务，这是一种常见的模式吗？还是你把所有东西都放在 iPhone 应用程序中？此外，如果您要建立 Web 服务后端，使用 REST/JSON 与 REST/XML 与 SOAP/XML 等是否更好？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T17:02:29.510

要回答您问题的第一部分，我会说这取决于您。如果 Web 服务和 iPhone 之间需要进行大量处理，那么也许您应该让自己的后端服务器在将其发送到 iPhone 之前进行处理。但是，如果您只需要 iPhone 上的 Web 服务中的数据，那么直接使用它即可。

至于不同的格式，在网络流量方面，iPhone 越小**越好**。一定要坚持使用 REST，这样您就可以最大限度地减少需要从 iPhone 传输的数据。至于 JSON 与 XML，显然 JSON 更轻量级，这使得它通常更适合 iPhone，但如果您的数据需要比 JSON 提供的更复杂的表示，那么请使用 XML。如果可以完全避免，请不要使用 SOAP。它太重了，并且会因许多请求而更快地耗尽 iPhone 的电池。

如果您对数据驱动的 iPhone 应用程序的架构和实现细节感到好奇，请查看 Apple 关于 iPhone 上的 Core Data 的所有文档和教程。

# c# - 如何在 3D 场景中显示子模型？

> ID：869714
> 
> 赞同：1
> 
> 时间：2009-05-15T16:42:52.397
> 
> 标签：c#, wpf, 3d

我必须修改一个用 C# 编写的 WPF 应用程序，该应用程序显示具有许多子模型或部件的复杂 3D 模型。当用户通过备用用户界面机制选择零件时，我想旋转、缩放或移动场景，以便子模型进入视野。没有子模型是完全隐藏的（即在主模型内部）。

最好的方法是什么？

作为进一步的信息，模型没有真正的顶部或底部。它是分子的 3D 表示，用户选择需要“滚动到视图中”的原子。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T16:49:57.997

获取子模型包围体的中心（或质心）。旋转相机以查看中心。移动或缩放视图，直到子模型包围体占据屏幕的预定义部分。这涉及求解一个与观看体积和边界体积相关的简单线性方程。如果您的边界体积是最小边界框，这相当容易。

**编辑**

在这种情况下，如果您先进行一些谷歌搜索，您可能会更好。您所说的特定功能通常称为**'zoom to fit'**。如果您进行一些谷歌搜索，我相信您会找到一些关于实现的深入讨论，这将比我在这里做得更好。解释要求您了解诸如屏幕坐标和世界坐标之间的转换以及它们之间的关系之类的东西。

# visual-studio-2008 - 如何在 Visual Studio 2008 中显示剪贴板环？

> ID：869718
> 
> 赞同：3
> 
> 时间：2009-05-15T16:43:54.360
> 
> 标签：visual-studio-2008

如果我尝试在工具箱中添加一个选项卡并将其命名为“剪贴板环”，我会收到一条错误消息，提示该名称的选项卡已经存在。有什么办法让它显示吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T16:53:46.443

据此，该选项卡已从较新版本的 Visual Studio 中删除： [如何使剪贴板环出现在 VS2008 工具箱中？](https://stackoverflow.com/questions/74604/how-to-make-clipboard-ring-appear-in-vs2008-toolbox)

可能他们会保留这个名字，以防万一他们想把它带回来。

但是，您仍然可以将文本拖到“工具箱”选项卡并将其放在那里以备后用。

我使用 Control+Shift+Ins 在环中循环。Control+Shift+V 也可以。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T16:50:00.163

`Control`+ `Shift`+`V`

或者

`Control`+ `Shift`+`Ins`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-04-14T12:24:34.933

您还可以选择文本并将其拖到工具箱窗口中。只需双击工具栏中的文本即可包含。当我需要在不同的地方复制文本时，我发现它更容易。[请参阅此处](http://www.cheezycode.com/2015/09/visual-studio-clipboard-ring-ctrl-shift-v.html)以获取更多详细信息

# .net - 使用 WCF 设计 API

> ID：869722
> 
> 赞同：1
> 
> 时间：2009-05-15T16:44:31.753
> 
> 标签：.net, wcf, architecture

我正在创建一个 API（使用 WCF），它将向外界公开电子商务公司的一些内部系统。API 的目标用户大多是可能没有大量开发人员资源的小型企业。为了保证 API 未来的发展，我决定 API 的输入和输出参数为字符串（xml 文档转换为字符串）。这让我想到了所有可能的方法，一旦将字符串接收到我的方法并从中生成 xml 文档后，我将如何将此 xml 文档映射到我可以访问的强类型对象 - 这些对象用于我的 api 公开的内部系统。

将 xml 文档转换为强类型类的最佳实践是什么（但请记住，我不能直接将 xml 转换为对象，因为在某些情况下，我必须在 api 中添加其他信息来构建对象内部系统需要）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-17T21:37:14.493

WCF 自动将请求消息映射到对象。[您可以使用DataContract](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.datacontractattribute.aspx)属性及其朋友来指定它是*如何*做到的。

您可能想在[此处](http://msdn.microsoft.com/en-us/library/ms733127.aspx)阅读基础知识。

# c# - 为什么我的表格这么害羞？

> ID：869729
> 
> 赞同：1
> 
> 时间：2009-05-15T16:44:57.010
> 
> 标签：c#, .net, winforms, multithreading, splash-screen

## 编辑 2

好的，根据以下答案的建议，我消除了线程方法，现在我的程序如下所示： *program.cs*

```
 static void Main(){

Application.EnableVisualStyles();

Application.SetCompatibleTextRenderingDefault(false);

FrmWWCShell FrmWWCShell = null;
var splash = new FrmSplash();
splash.SplashFormInitialized += delegate
                                {
                                    FrmWWCShell = new FrmWWCShell();
                                    splash.Close();
                                };
Application.Run(splash);
Application.Run(FrmWWCShell); 
```

}

像这样*的 FrmSplash.cs*：

```
public partial class FrmSplash : Form
{

    public FrmSplash()
    {
        InitializeComponent();
    }

    protected override void  OnLoad(EventArgs e)
    {
        splashTimer.Interval = 1;
        splashTimer.Tick +=
            delegate { if (SplashFormInitialized != null) SplashFormInitialized(this, EventArgs.Empty); };
        splashTimer.Enabled = true;
    }

    public event EventHandler SplashFormInitialized;
} 
```

问题是它现在根本不起作用。闪屏会弹出一瞬间，品牌进度条甚至从未初始化，然后在我等待 10 秒让 dll 和主窗体出现时消失，同时什么都不看......

颜色我现在**严重困惑**！

* * *

## 原始帖子--> 供参考

我实现了一个应用程序加载启动画面，它在一个单独的线程上运行，而所有 dll 都在加载并且表单正在“绘制”。这按预期工作。奇怪的是，现在当 Splash 表单退出时，它会将我的主表单发送到后面，如果还有其他东西打开（*即 Outlook*）。我在 Program.cs 中启动线程，

```
static class Program
{
    public static Thread splashThread;

    [STAThread]
    static void Main()
    {
        splashThread = new Thread(doSplash);
        splashThread.Start();

        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);
        Application.Run(new FrmWWCShell());
    }

    private static void doSplash()
    {
        var splashForm = new FrmSplash();
        splashForm.ShowDialog();
    }
} 
```

然后，一旦我的 FrmSearch_Shown 事件被触发，我就会结束它。

```
private void FrmSearch_Shown(object sender, EventArgs e)
    {
        Program.splashThread.Abort();
        this.Show();
        this.BringToFront();
    } 
```

如您所见，我尝试在 FrmSearch 上调用 Show() 和/或 BringToFront() ，但它仍然“*跳*”到后面。

我错过了什么？
我还能尝试什么？
我这样做是不是非常无知，以至于是我的过程导致了这种情况？
我应该申请提前退休吗？

感谢您的任何见解！

* * *

## 编辑 1

我尝试将主窗体上的 TopMost 属性设置为*TRUE*。这可以防止我的表单隐藏，但也可以防止用户查看任何其他应用程序。看来我有点自恋了……

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T16:58:38.333

首先，在主应用程序线程上完成 UI 工作非常重要。实际上，通过在后台线程上显示启动屏幕，您并没有遇到更严重的错误，这让我感到有点惊讶。

这是我使用过的一种技术：

在您的初始表单上使用 Application.Run 而不是您的“真实”表单。

在您的启动表单中，有一个初始化事件：

```
public event EventHandler SplashFormInitialized 
```

创建一个在一毫秒内触发的计时器，并触发该事件。

然后在您的应用程序运行方法中，您可以加载您的真实表单，然后关闭您的启动表单并在真实表单上执行 Application.Run

```
var realForm = null;

var splash = new SplashForm();
splash.SplashFormInitialized += delegate {
  // As long as you use a system.windows.forms.Timer in the splash form, this
  // handler will be called on the UI thread
  realForm = new FrmWWCShell();
  //do any other init
  splash.Close();
}
Application.Run(splash); //will block until the splash form is closed

Application.Run(realForm); 
```

飞溅可能包括：

```
overrides OnLoad(...)
{
   /* Using a timer will let the splash screen load and display itself before
      calling this handler
   */
   timer.Interval = 1;
   timer.Tick += delegate {
     if (SplashFormInitialized != null) SplashFormInitialized(this, EventArgs.Empty);
   };
   timer.Enabled = true; 
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T16:48:03.383

尝试在演出后立即调用 Application.DoEvents()。

警告：不要经常调用 DoEvents，但这是其中之一。

编辑：克莱德注意到我没有注意到的事情：你正在处理这个。不要在另一个线程上运行任何 UI。取出线程，留在 Application.DoEvents() 中。

# c# - 如何使用 EmguCV（C# 中的 OpenCV）？

> ID：869732
> 
> 赞同：1
> 
> 时间：2009-05-15T16:45:40.270
> 
> 标签：c#, opencv

我不明白我必须安装什么才能使 EmguCV 工作。我打开了 EmguCV 提供的 sample-src，但在 Visual Studio 2008 中出现错误。

我还尝试了其他用于 OpenCV 的 .NET 包装器，但它们都不起作用（包括示例）。在我运行任何使用 OpenCV 的程序后，会显示一条消息“（示例程序）遇到问题并需要关闭。请将此错误报告给 microsoft bla bla bla”。

如何在 C# 中完成这项工作？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-09-16T11:12:56.560

所有必需的 .dll 是否都已到位？尝试将所有 Emgu .dll 复制到包含 .exe 的目录中。

为了自动化这一点，我在 Visual Studio 中添加了一个构建后事件：

```
xcopy /Y /D /F $(ProjectDir)Emgu.CV.Binary-2.0.1.0\*.dll $(TargetDir) 
```

您需要设置正确的源目录（我喜欢将我的库与源一起保存）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-17T14:39:28.037

我在使用 Visual Studio 2010 时遇到了示例问题，这就是我所做的：

1.  删除的引用：Emgu.CV.dll Emgu.UI.dll Emgu.Util.dll
2.  从“项目”菜单 -> 首选项 -> 并将 .Net Framework 目标更改为 3.5
3.  我添加了我下载的 DLL（我之前删除的同名的）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-02-03T20:59:29.413

在上面的答案之后添加了一个很好的文章：http: [//www.codeproject.com/Articles/257502/Creating-Your-First-EMGU-Image-Processing-Project](http://www.codeproject.com/Articles/257502/Creating-Your-First-EMGU-Image-Processing-Project)

# database - Sphinx 过滤器 - 我可以在过滤器属性之间使用“或”吗？

> ID：869733
> 
> 赞同：2
> 
> 时间：2009-05-15T16:45:59.567
> 
> 标签：database, search, sphinx

我正在使用 sphinx 在这里列出我的数据库中的一些项目。这几乎是 100%，我只是还没有弄清楚如何`OR`在两个不同的过滤器之间创建一个。例如：

我在数据库中的对象有一个开始和结束日期，我可以`filter(starting_date, x, y)`和`filter(ending_date,x,y)`，但是两个过滤器都必须返回 true 才能给我带来对象，我怎么能说狮身人面像过滤这个属性，或者那个？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-15T22:39:39.887

在 Sphinx 论坛上提问和回答。

仅在 0.9.9 中可用，使用 SetSelect。

[http://sphinxsearch.com/forum/view.html?id=3577](http://sphinxsearch.com/forum/view.html?id=3577)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T20:40:11.187

没有办法`OR`在 Sphinx 中的不同属性之间建立逻辑。通常，有两种可能的解决方法：

1.  拥有一个多值属性，其中包含要匹配的两组值 - 并过滤值数组。
2.  如果每次都是相同的 OR 逻辑，则将其组合成一个布尔属性，让 SQL 语句完成最初的艰苦工作。

但是，使用时间戳会使事情变得更加困难-此时 MVA 仅适用于整数……您是在特定时间发生的所有对象之后吗？或者是其他东西？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T16:51:18.040

狮身人面像用途 | 对于或

如“黑色”或“白色”将是“黑色”| “白色” [http://www.sphinxsearch.com/docs/manual-0.9.9.html#boolean-syntax](http://www.sphinxsearch.com/docs/manual-0.9.9.html#boolean-syntax)

# sql-server - 如何在 sql server 2008 上安装全文？

> ID：869736
> 
> 赞同：12
> 
> 时间：2009-05-15T16:46:48.877
> 
> 标签：sql-server, sql-server-2008, full-text-search

试图在我的 sql server 2008 机器上安装全文。

我去了“程序和功能”，选择了 sql server 2008，现在我得到这个弹出窗口，要求选择：添加/修复或删除。

我点击添加，它询问我 sql server CD 的位置？我提取了我们拥有的 ISO，不知道该指向哪个文件？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-07-29T22:18:15.797

从以下位置下载安装程序：

[http://www.microsoft.com/download/en/details.aspx?displaylang=en&id=1842](http://www.microsoft.com/download/en/details.aspx?displaylang=en&id=1842)

或者对于 SQL 2008 R2 Express，它在这里： [http ://www.microsoft.com/en-us/download/details.aspx?id=25174](http://www.microsoft.com/en-us/download/details.aspx?id=25174)

然后转到您保存它的位置并解压缩自解压EXE（右键单击并单击“解压”）。

转到添加或删除程序，您现在可以通过浏览提取的文件来“添加功能”。

有关如何在现有 SQL Server 2008 Express 实例上升级和安装全文搜索的完整详细信息，请参阅我在[此处的帖子](http://beweb.pbworks.com/w/page/43820429/SQL%20Server%20Fulltext%20Search)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-18T02:58:29.900

要向 SQL Server 安装添加功能，您应该从安装光盘运行安装程序本身。按照 u07ch 的建议，您可以挂载映像，也可以刻录光盘。完成此操作后，运行安装程序，您将看到从“功能”页面添加全文搜索的选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T20:27:57.863

下载 microsoft Virtual CD Control Panel 并将 iso 作为 cd 驱动器安装在您的计算机上；然后指向添加/删除安装软件。

[http://download.microsoft.com/download/7/b/6/7b6abd84-7841-4978-96f5-bd58df02efa2/winxpvirtualcdcontrolpanel_21.exe](http://download.microsoft.com/download/7/b/6/7b6abd84-7841-4978-96f5-bd58df02efa2/winxpvirtualcdcontrolpanel_21.exe)

# c# - 如何编写可扩展的基于 TCP/IP 的服务器

> ID：869744
> 
> 赞同：150
> 
> 时间：2009-05-15T16:49:18.670
> 
> 标签：c#, .net, networking, tcp, scalability

我正在编写一个新的 Windows 服务应用程序的设计阶段，该应用程序接受 TCP/IP 连接以进行长时间运行的连接（即，这不像 HTTP 有许多短连接，而是客户端连接并保持连接数小时或数天甚至几周）。

我正在寻找设计网络架构的最佳方法的想法。我将需要为该服务启动至少一个线程。我正在考虑使用异步 API（BeginRecieve 等），因为我不知道在任何给定时间我将连接多少个客户端（可能是数百个）。我绝对不想为每个连接启动一个线程。

数据将主要从我的服务器流向客户端，但有时客户端会发送一些命令。这主要是一个监控应用程序，其中我的服务器定期向客户端发送状态数据。

使其尽可能可扩展的最佳方法是什么？基本工作流程？

需要明确的是，我正在寻找基于 .NET 的解决方案（如果可能，C#，但任何 .NET 语言都可以使用）。

我需要一个解决方案的工作示例，可以是指向我可以下载的内容的指针，也可以是一个简短的在线示例。它必须是基于 .NET 和 Windows 的（任何 .NET 语言都可以接受）。

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2009-05-18T03:55:46.380

我过去写过类似的东西。*几年前我的研究表明，使用异步*套接字编写自己的套接字实现是最好的选择。这意味着没有真正做任何事情的客户实际上需要相对较少的资源。发生的任何事情都由 .NET 线程池处理。

我把它写成一个管理服务器所有连接的类。

我只是使用一个列表来保存所有客户端连接，但是如果您需要更快地查找更大的列表，您可以随意编写它。

```
private List<xConnection> _sockets; 
```

您还需要实际侦听传入连接的套接字。

```
private System.Net.Sockets.Socket _serverSocket; 
```

start 方法实际上启动服务器套接字并开始侦听任何传入连接。

```
public bool Start()
{
  System.Net.IPHostEntry localhost = System.Net.Dns.GetHostEntry(System.Net.Dns.GetHostName());
  System.Net.IPEndPoint serverEndPoint;
  try
  {
     serverEndPoint = new System.Net.IPEndPoint(localhost.AddressList[0], _port);
  }
  catch (System.ArgumentOutOfRangeException e)
  {
    throw new ArgumentOutOfRangeException("Port number entered would seem to be invalid, should be between 1024 and 65000", e);
  }
  try
  {
    _serverSocket = new System.Net.Sockets.Socket(serverEndPoint.Address.AddressFamily, SocketType.Stream, ProtocolType.Tcp);
   }
   catch (System.Net.Sockets.SocketException e)
   {
      throw new ApplicationException("Could not create socket, check to make sure not duplicating port", e);
    }
    try
    {
      _serverSocket.Bind(serverEndPoint);
      _serverSocket.Listen(_backlog);
    }
    catch (Exception e)
    {
       throw new ApplicationException("An error occurred while binding socket. Check inner exception", e);
    }
    try
    {
       //warning, only call this once, this is a bug in .net 2.0 that breaks if
       // you're running multiple asynch accepts, this bug may be fixed, but
       // it was a major pain in the rear previously, so make sure there is only one
       //BeginAccept running
       _serverSocket.BeginAccept(new AsyncCallback(acceptCallback), _serverSocket);
    }
    catch (Exception e)
    {
       throw new ApplicationException("An error occurred starting listeners. Check inner exception", e);
    }
    return true;
 } 
```

我只想指出异常处理代码看起来很糟糕，但原因是我在那里有异常抑制代码，因此`false`如果设置了配置选项，任何异常都会被抑制并返回，但我想将其删除简洁的缘故。

上面的 _serverSocket.BeginAccept(new AsyncCallback(acceptCallback)), _serverSocket) 本质上是设置我们的服务器套接字在用户连接时调用 acceptCallback 方法。此方法从 .NET 线程池运行，如果您有许多阻塞操作，它会自动处理创建额外的工作线程。这应该以最佳方式处理服务器上的任何负载。

```
 private void acceptCallback(IAsyncResult result)
    {
       xConnection conn = new xConnection();
       try
       {
         //Finish accepting the connection
         System.Net.Sockets.Socket s = (System.Net.Sockets.Socket)result.AsyncState;
         conn = new xConnection();
         conn.socket = s.EndAccept(result);
         conn.buffer = new byte[_bufferSize];
         lock (_sockets)
         {
           _sockets.Add(conn);
         }
         //Queue receiving of data from the connection
         conn.socket.BeginReceive(conn.buffer, 0, conn.buffer.Length, SocketFlags.None, new AsyncCallback(ReceiveCallback), conn);
         //Queue the accept of the next incoming connection
         _serverSocket.BeginAccept(new AsyncCallback(acceptCallback), _serverSocket);
       }
       catch (SocketException e)
       {
         if (conn.socket != null)
         {
           conn.socket.Close();
           lock (_sockets)
           {
             _sockets.Remove(conn);
           }
         }
         //Queue the next accept, think this should be here, stop attacks based on killing the waiting listeners
         _serverSocket.BeginAccept(new AsyncCallback(acceptCallback), _serverSocket);
       }
       catch (Exception e)
       {
         if (conn.socket != null)
         {
           conn.socket.Close();
           lock (_sockets)
           {
             _sockets.Remove(conn);
           }
         }
         //Queue the next accept, think this should be here, stop attacks based on killing the waiting listeners
         _serverSocket.BeginAccept(new AsyncCallback(acceptCallback), _serverSocket);
       }
     } 
```

上面的代码基本上刚刚完成了接受进来的连接，排队`BeginReceive`是一个回调，当客户端发送数据时将运行，然后排队下一个`acceptCallback`接受下一个进来的客户端连接。

方法调用是告诉套接字从`BeginReceive`客户端接收数据时要做什么。对于`BeginReceive`，您需要给它一个字节数组，这是客户端发送数据时它将复制数据的位置。该`ReceiveCallback`方法将被调用，这就是我们处理接收数据的方式。

```
private void ReceiveCallback(IAsyncResult result)
{
  //get our connection from the callback
  xConnection conn = (xConnection)result.AsyncState;
  //catch any errors, we'd better not have any
  try
  {
    //Grab our buffer and count the number of bytes receives
    int bytesRead = conn.socket.EndReceive(result);
    //make sure we've read something, if we haven't it supposadly means that the client disconnected
    if (bytesRead > 0)
    {
      //put whatever you want to do when you receive data here

      //Queue the next receive
      conn.socket.BeginReceive(conn.buffer, 0, conn.buffer.Length, SocketFlags.None, new AsyncCallback(ReceiveCallback), conn);
     }
     else
     {
       //Callback run but no data, close the connection
       //supposadly means a disconnect
       //and we still have to close the socket, even though we throw the event later
       conn.socket.Close();
       lock (_sockets)
       {
         _sockets.Remove(conn);
       }
     }
   }
   catch (SocketException e)
   {
     //Something went terribly wrong
     //which shouldn't have happened
     if (conn.socket != null)
     {
       conn.socket.Close();
       lock (_sockets)
       {
         _sockets.Remove(conn);
       }
     }
   }
 } 
```

编辑：在这个模式中，我忘了在这个代码区域提到：

```
//put whatever you want to do when you receive data here

//Queue the next receive
conn.socket.BeginReceive(conn.buffer, 0, conn.buffer.Length, SocketFlags.None, new AsyncCallback(ReceiveCallback), conn); 
```

一般来说，无论你想要什么代码，我都会将数据包重新组装成消息，然后将它们创建为线程池上的作业。这样，无论消息处理代码正在运行，来自客户端的下一个块的 BeginReceive 都不会延迟。

accept 回调通过调用 end receive 完成读取数据套接字。这将填充开始接收函数中提供的缓冲区。一旦你在我留下评论的地方做任何你想做的事情，我们调用下一个`BeginReceive`方法，如果客户端发送更多数据，它将再次运行回调。

现在这是真正棘手的部分：当客户端发送数据时，您的接收回调可能只与部分消息一起调用。重新组装会变得非常非常复杂。我使用自己的方法并创建了一种专有协议来做到这一点。我把它省略了，但如果你要求，我可以添加它。这个处理程序实际上是我写过的最复杂的一段代码。

```
public bool Send(byte[] message, xConnection conn)
{
  if (conn != null && conn.socket.Connected)
  {
    lock (conn.socket)
    {
    //we use a blocking mode send, no async on the outgoing
    //since this is primarily a multithreaded application, shouldn't cause problems to send in blocking mode
       conn.socket.Send(bytes, bytes.Length, SocketFlags.None);
     }
   }
   else
     return false;
   return true;
 } 
```

上面的 send 方法实际上使用了同步`Send`调用。对我来说这很好，因为我的应用程序的消息大小和多线程性质。如果你想发送给每个客户端，你只需要遍历 _sockets 列表。

您在上面看到的 xConnection 类基本上是一个简单的套接字包装器，用于包含字节缓冲区，在我的实现中还有一些附加功能。

```
public class xConnection : xBase
{
  public byte[] buffer;
  public System.Net.Sockets.Socket socket;
} 
```

这里还有`using`我包含的 s 供参考，因为当它们不包含在内时我总是很生气。

```
using System.Net.Sockets; 
```

我希望这会有所帮助。它可能不是最干净的代码，但它可以工作。代码也有一些细微差别，您应该对更改感到厌烦。一方面，任何时候只有一个`BeginAccept`被叫。过去有一个非常烦人的 .NET 错误，那是几年前的事了，所以我不记得细节了。

此外，在`ReceiveCallback`代码中，我们在排队下一次接收之前处理从套接字接收到的任何内容。这意味着对于单个套接字，我们实际上 `ReceiveCallback`在任何时间点都只有一次，并且我们不需要使用线程同步。但是，如果您重新排序以在提取数据后立即调用下一个接收，这可能会更快一些，您需要确保正确同步线程。

此外，我修改了很多代码，但留下了正在发生的事情的本质。这应该是你设计的一个好的开始。如果您对此还有任何疑问，请发表评论。

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2009-05-21T21:23:45.463

在 C# 中进行网络操作的方法有很多种。它们都在底层使用不同的机制，因此在高并发下会遇到主要的性能问题。Begin* 操作是许多人经常误认为是更快/最快的联网方式之一。

为了解决这些问题，他们引入了*Async 方法集*：来自 MSDN，*[SocketAsyncEventArgs 类](https://docs.microsoft.com/en-us/dotnet/api/system.net.sockets.socketasynceventargs)*-

> SocketAsyncEventArgs 类是 System.Net.Sockets..::.Socket 类的一组增强功能的一部分，它提供了一种可供专门的高性能套接字应用程序使用的替代异步模式。此类专为需要高性能的网络服务器应用程序而设计。应用程序可以专门或仅在目标热点区域（例如，当接收大量数据时）使用增强异步模式。
> 
> 这些增强的主要特点是避免在大容量异步套接字 I/O 期间重复分配和同步对象。目前由 System.Net.Sockets..::.Socket 类实现的 Begin/End 设计模式要求为每个异步套接字操作分配一个 System..::.IAsyncResult 对象。

在幕后，*Async API 使用 I/O 完成端口，这是执行网络操作的最快方式，请参阅*[Windows Sockets 2.0: Write Scalable Winsock Apps Using Completion Ports](https://docs.microsoft.com/en-us/archive/msdn-magazine/2000/october/windows-sockets-2-0-write-scalable-winsock-apps-using-completion-ports)*

只是为了帮助你，我包含了我使用 *Async API 编写的 telnet 服务器的源代码。我只包括相关部分。还要注意的是，我不是内联处理数据，而是选择将其推送到在单独线程上处理的无锁（无等待）队列中。请注意，我不包括相应的 Pool 类，它只是一个简单的池，如果它是空的，它将创建一个新对象，而 Buffer 类只是一个自扩展缓冲区，除非您收到不确定性，否则它并不是真正需要的数据量。

```
public class Telnet
{
    private readonly Pool<SocketAsyncEventArgs> m_EventArgsPool;
    private Socket m_ListenSocket;

    /// <summary>
    /// This event fires when a connection has been established.
    /// </summary>
    public event EventHandler<SocketAsyncEventArgs> Connected;

    /// <summary>
    /// This event fires when a connection has been shutdown.
    /// </summary>
    public event EventHandler<SocketAsyncEventArgs> Disconnected;

    /// <summary>
    /// This event fires when data is received on the socket.
    /// </summary>
    public event EventHandler<SocketAsyncEventArgs> DataReceived;

    /// <summary>
    /// This event fires when data is finished sending on the socket.
    /// </summary>
    public event EventHandler<SocketAsyncEventArgs> DataSent;

    /// <summary>
    /// This event fires when a line has been received.
    /// </summary>
    public event EventHandler<LineReceivedEventArgs> LineReceived;

    /// <summary>
    /// Specifies the port to listen on.
    /// </summary>
    [DefaultValue(23)]
    public int ListenPort { get; set; }

    /// <summary>
    /// Constructor for Telnet class.
    /// </summary>
    public Telnet()
    {
        m_EventArgsPool = new Pool<SocketAsyncEventArgs>();
        ListenPort = 23;
    }

    /// <summary>
    /// Starts the telnet server listening and accepting data.
    /// </summary>
    public void Start()
    {
        IPEndPoint endpoint = new IPEndPoint(0, ListenPort);
        m_ListenSocket = new Socket(endpoint.AddressFamily, SocketType.Stream, ProtocolType.Tcp);

        m_ListenSocket.Bind(endpoint);
        m_ListenSocket.Listen(100);

        //
        // Post Accept
        //
        StartAccept(null);
    }

    /// <summary>
    /// Not Yet Implemented. Should shutdown all connections gracefully.
    /// </summary>
    public void Stop()
    {
        //throw (new NotImplementedException());
    }

    //
    // ACCEPT
    //

    /// <summary>
    /// Posts a requests for Accepting a connection. If it is being called from the completion of
    /// an AcceptAsync call, then the AcceptSocket is cleared since it will create a new one for
    /// the new user.
    /// </summary>
    /// <param name="e">null if posted from startup, otherwise a <b>SocketAsyncEventArgs</b> for reuse.</param>
    private void StartAccept(SocketAsyncEventArgs e)
    {
        if (e == null)
        {
            e = m_EventArgsPool.Pop();
            e.Completed += Accept_Completed;
        }
        else
        {
            e.AcceptSocket = null;
        }

        if (m_ListenSocket.AcceptAsync(e) == false)
        {
            Accept_Completed(this, e);
        }
    }

    /// <summary>
    /// Completion callback routine for the AcceptAsync post. This will verify that the Accept occured
    /// and then setup a Receive chain to begin receiving data.
    /// </summary>
    /// <param name="sender">object which posted the AcceptAsync</param>
    /// <param name="e">Information about the Accept call.</param>
    private void Accept_Completed(object sender, SocketAsyncEventArgs e)
    {
        //
        // Socket Options
        //
        e.AcceptSocket.NoDelay = true;

        //
        // Create and setup a new connection object for this user
        //
        Connection connection = new Connection(this, e.AcceptSocket);

        //
        // Tell the client that we will be echo'ing data sent
        //
        DisableEcho(connection);

        //
        // Post the first receive
        //
        SocketAsyncEventArgs args = m_EventArgsPool.Pop();
        args.UserToken = connection;

        //
        // Connect Event
        //
        if (Connected != null)
        {
            Connected(this, args);
        }

        args.Completed += Receive_Completed;
        PostReceive(args);

        //
        // Post another accept
        //
        StartAccept(e);
    }

    //
    // RECEIVE
    //

    /// <summary>
    /// Post an asynchronous receive on the socket.
    /// </summary>
    /// <param name="e">Used to store information about the Receive call.</param>
    private void PostReceive(SocketAsyncEventArgs e)
    {
        Connection connection = e.UserToken as Connection;

        if (connection != null)
        {
            connection.ReceiveBuffer.EnsureCapacity(64);
            e.SetBuffer(connection.ReceiveBuffer.DataBuffer, connection.ReceiveBuffer.Count, connection.ReceiveBuffer.Remaining);

            if (connection.Socket.ReceiveAsync(e) == false)
            {
                Receive_Completed(this, e);
            }
        }
    }

    /// <summary>
    /// Receive completion callback. Should verify the connection, and then notify any event listeners
    /// that data has been received. For now it is always expected that the data will be handled by the
    /// listeners and thus the buffer is cleared after every call.
    /// </summary>
    /// <param name="sender">object which posted the ReceiveAsync</param>
    /// <param name="e">Information about the Receive call.</param>
    private void Receive_Completed(object sender, SocketAsyncEventArgs e)
    {
        Connection connection = e.UserToken as Connection;

        if (e.BytesTransferred == 0 || e.SocketError != SocketError.Success || connection == null)
        {
            Disconnect(e);
            return;
        }

        connection.ReceiveBuffer.UpdateCount(e.BytesTransferred);

        OnDataReceived(e);

        HandleCommand(e);
        Echo(e);

        OnLineReceived(connection);

        PostReceive(e);
    }

    /// <summary>
    /// Handles Event of Data being Received.
    /// </summary>
    /// <param name="e">Information about the received data.</param>
    protected void OnDataReceived(SocketAsyncEventArgs e)
    {
        if (DataReceived != null)
        {
            DataReceived(this, e);
        }
    }

    /// <summary>
    /// Handles Event of a Line being Received.
    /// </summary>
    /// <param name="connection">User connection.</param>
    protected void OnLineReceived(Connection connection)
    {
        if (LineReceived != null)
        {
            int index = 0;
            int start = 0;

            while ((index = connection.ReceiveBuffer.IndexOf('\n', index)) != -1)
            {
                string s = connection.ReceiveBuffer.GetString(start, index - start - 1);
                s = s.Backspace();

                LineReceivedEventArgs args = new LineReceivedEventArgs(connection, s);
                Delegate[] delegates = LineReceived.GetInvocationList();

                foreach (Delegate d in delegates)
                {
                    d.DynamicInvoke(new object[] { this, args });

                    if (args.Handled == true)
                    {
                        break;
                    }
                }

                if (args.Handled == false)
                {
                    connection.CommandBuffer.Enqueue(s);
                }

                start = index;
                index++;
            }

            if (start > 0)
            {
                connection.ReceiveBuffer.Reset(0, start + 1);
            }
        }
    }

    //
    // SEND
    //

    /// <summary>
    /// Overloaded. Sends a string over the telnet socket.
    /// </summary>
    /// <param name="connection">Connection to send data on.</param>
    /// <param name="s">Data to send.</param>
    /// <returns>true if the data was sent successfully.</returns>
    public bool Send(Connection connection, string s)
    {
        if (String.IsNullOrEmpty(s) == false)
        {
            return Send(connection, Encoding.Default.GetBytes(s));
        }

        return false;
    }

    /// <summary>
    /// Overloaded. Sends an array of data to the client.
    /// </summary>
    /// <param name="connection">Connection to send data on.</param>
    /// <param name="data">Data to send.</param>
    /// <returns>true if the data was sent successfully.</returns>
    public bool Send(Connection connection, byte[] data)
    {
        return Send(connection, data, 0, data.Length);
    }

    public bool Send(Connection connection, char c)
    {
        return Send(connection, new byte[] { (byte)c }, 0, 1);
    }

    /// <summary>
    /// Sends an array of data to the client.
    /// </summary>
    /// <param name="connection">Connection to send data on.</param>
    /// <param name="data">Data to send.</param>
    /// <param name="offset">Starting offset of date in the buffer.</param>
    /// <param name="length">Amount of data in bytes to send.</param>
    /// <returns></returns>
    public bool Send(Connection connection, byte[] data, int offset, int length)
    {
        bool status = true;

        if (connection.Socket == null || connection.Socket.Connected == false)
        {
            return false;
        }

        SocketAsyncEventArgs args = m_EventArgsPool.Pop();
        args.UserToken = connection;
        args.Completed += Send_Completed;
        args.SetBuffer(data, offset, length);

        try
        {
            if (connection.Socket.SendAsync(args) == false)
            {
                Send_Completed(this, args);
            }
        }
        catch (ObjectDisposedException)
        {
            //
            // return the SocketAsyncEventArgs back to the pool and return as the
            // socket has been shutdown and disposed of
            //
            m_EventArgsPool.Push(args);
            status = false;
        }

        return status;
    }

    /// <summary>
    /// Sends a command telling the client that the server WILL echo data.
    /// </summary>
    /// <param name="connection">Connection to disable echo on.</param>
    public void DisableEcho(Connection connection)
    {
        byte[] b = new byte[] { 255, 251, 1 };
        Send(connection, b);
    }

    /// <summary>
    /// Completion callback for SendAsync.
    /// </summary>
    /// <param name="sender">object which initiated the SendAsync</param>
    /// <param name="e">Information about the SendAsync call.</param>
    private void Send_Completed(object sender, SocketAsyncEventArgs e)
    {
        e.Completed -= Send_Completed;
        m_EventArgsPool.Push(e);
    }

    /// <summary>
    /// Handles a Telnet command.
    /// </summary>
    /// <param name="e">Information about the data received.</param>
    private void HandleCommand(SocketAsyncEventArgs e)
    {
        Connection c = e.UserToken as Connection;

        if (c == null || e.BytesTransferred < 3)
        {
            return;
        }

        for (int i = 0; i < e.BytesTransferred; i += 3)
        {
            if (e.BytesTransferred - i < 3)
            {
                break;
            }

            if (e.Buffer[i] == (int)TelnetCommand.IAC)
            {
                TelnetCommand command = (TelnetCommand)e.Buffer[i + 1];
                TelnetOption option = (TelnetOption)e.Buffer[i + 2];

                switch (command)
                {
                    case TelnetCommand.DO:
                        if (option == TelnetOption.Echo)
                        {
                            // ECHO
                        }
                        break;
                    case TelnetCommand.WILL:
                        if (option == TelnetOption.Echo)
                        {
                            // ECHO
                        }
                        break;
                }

                c.ReceiveBuffer.Remove(i, 3);
            }
        }
    }

    /// <summary>
    /// Echoes data back to the client.
    /// </summary>
    /// <param name="e">Information about the received data to be echoed.</param>
    private void Echo(SocketAsyncEventArgs e)
    {
        Connection connection = e.UserToken as Connection;

        if (connection == null)
        {
            return;
        }

        //
        // backspacing would cause the cursor to proceed beyond the beginning of the input line
        // so prevent this
        //
        string bs = connection.ReceiveBuffer.ToString();

        if (bs.CountAfterBackspace() < 0)
        {
            return;
        }

        //
        // find the starting offset (first non-backspace character)
        //
        int i = 0;

        for (i = 0; i < connection.ReceiveBuffer.Count; i++)
        {
            if (connection.ReceiveBuffer[i] != '\b')
            {
                break;
            }
        }

        string s = Encoding.Default.GetString(e.Buffer, Math.Max(e.Offset, i), e.BytesTransferred);

        if (connection.Secure)
        {
            s = s.ReplaceNot("\r\n\b".ToCharArray(), '*');
        }

        s = s.Replace("\b", "\b \b");

        Send(connection, s);
    }

    //
    // DISCONNECT
    //

    /// <summary>
    /// Disconnects a socket.
    /// </summary>
    /// <remarks>
    /// It is expected that this disconnect is always posted by a failed receive call. Calling the public
    /// version of this method will cause the next posted receive to fail and this will cleanup properly.
    /// It is not advised to call this method directly.
    /// </remarks>
    /// <param name="e">Information about the socket to be disconnected.</param>
    private void Disconnect(SocketAsyncEventArgs e)
    {
        Connection connection = e.UserToken as Connection;

        if (connection == null)
        {
            throw (new ArgumentNullException("e.UserToken"));
        }

        try
        {
            connection.Socket.Shutdown(SocketShutdown.Both);
        }
        catch
        {
        }

        connection.Socket.Close();

        if (Disconnected != null)
        {
            Disconnected(this, e);
        }

        e.Completed -= Receive_Completed;
        m_EventArgsPool.Push(e);
    }

    /// <summary>
    /// Marks a specific connection for graceful shutdown. The next receive or send to be posted
    /// will fail and close the connection.
    /// </summary>
    /// <param name="connection"></param>
    public void Disconnect(Connection connection)
    {
        try
        {
            connection.Socket.Shutdown(SocketShutdown.Both);
        }
        catch (Exception)
        {
        }
    }

    /// <summary>
    /// Telnet command codes.
    /// </summary>
    internal enum TelnetCommand
    {
        SE = 240,
        NOP = 241,
        DM = 242,
        BRK = 243,
        IP = 244,
        AO = 245,
        AYT = 246,
        EC = 247,
        EL = 248,
        GA = 249,
        SB = 250,
        WILL = 251,
        WONT = 252,
        DO = 253,
        DONT = 254,
        IAC = 255
    }

    /// <summary>
    /// Telnet command options.
    /// </summary>
    internal enum TelnetOption
    {
        Echo = 1,
        SuppressGoAhead = 3,
        Status = 5,
        TimingMark = 6,
        TerminalType = 24,
        WindowSize = 31,
        TerminalSpeed = 32,
        RemoteFlowControl = 33,
        LineMode = 34,
        EnvironmentVariables = 36
    }
} 
```

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2009-05-26T02:59:42.687

Coversant 的 Chris Mullins 曾经对使用 .NET 的可扩展 TCP/IP 进行过很好的讨论。不幸的是，他的博客似乎已经从之前的位置消失了，所以我将尝试从记忆中拼凑出他的建议（他的一些有用的评论出现在这个线程中：[C++ vs. C#：开发高度可扩展的 IOCP 服务器](http://www.codeguru.com/forum/archive/index.php/t-408685.html)）

首先，请注意 using`Begin/End`和类中的`Async`方法`Socket`都使用[I/O 完成端口](https://en.wikipedia.org/wiki/Input/output_completion_port)(IOCP) 来提供可伸缩性。与您实际选择两种方法中的哪一种来实现您的解决方案相比，这对可伸缩性产生了更大的差异（如果使用得当；见下文）。

Chris Mullins 的帖子基于 using `Begin/End`，这是我个人有过的经验。请注意，Chris 基于此组合了一个解决方案，该解决方案在具有 2 GB 内存的 32 位计算机上扩展到 10,000 个并发客户端连接，并在具有足够内存的 64 位平台上扩展到 100,000 个。根据我自己使用这种技术的经验（尽管远不及这种负载），我没有理由怀疑这些指示性数字。

## IOCP 与每连接线程或“选择”原语

您要使用在底层使用 IOCP 的机制的原因是它使用了一个非常低级的 Windows 线程池，该线程池在您尝试读取的 I/O 通道上有实际数据之前不会唤醒任何线程from（请注意，IOCP 也可用于文件 I/O）。这样做的好处是，Windows 不必切换到线程只是为了发现还没有数据，因此这将您的服务器必须进行的上下文切换次数减少到所需的最低限度。

上下文切换肯定会杀死“每个连接线程”机制，尽管如果您只处理几十个连接，这是一个可行的解决方案。然而，这种机制绝不是“可扩展”的想象。

## 使用 IOCP 时的重要注意事项

**记忆**

首先，如果您的实现过于幼稚，了解 IOCP 在 .NET 下很容易导致内存问题，这一点至关重要。每个 IOCP`BeginReceive`调用都会导致您正在读取的缓冲区“固定”。有关为什么这是一个问题的一个很好的解释，请参阅：[Yun Jin 的博客：OutOfMemoryException 和 Pinning](http://blogs.msdn.com/yunjin/archive/2004/01/27/63642.aspx)。

幸运的是，这个问题可以避免，但它需要一些权衡。建议的解决方案是在应用程序启动时（或接近启动时）分配一个`byte[]`至少 90 KB 左右的大缓冲区（从 .NET 2 开始，在以后的版本中所需的大小可能会更大）。这样做的原因是大内存分配自动结束在一个有效地自动固定的非压缩内存段（[大对象堆）中。](https://docs.microsoft.com/en-us/dotnet/standard/garbage-collection/large-object-heap)通过在启动时分配一个大缓冲区，您可以确保这块不可移动内存位于相对“低地址”，不会妨碍并导致碎片。

然后，您可以使用偏移量将这个大缓冲区分割为需要读取一些数据的每个连接的单独区域。这就是权衡发挥作用的地方。由于需要预先分配此缓冲区，因此您必须决定每个连接需要多少缓冲区空间，以及要为要扩展到的连接数设置的上限（或者，您可以实现抽象可以在需要时分配额外的固定缓冲区）。

最简单的解决方案是在此缓冲区内的唯一偏移处为每个连接分配一个字节。然后，您可以`BeginReceive`调用要读取的单个字节，并根据您获得的回调执行其余的读取操作。

**加工**

当您从`Begin`您所做的调用中获得回调时，意识到回调中的代码将在低级 IOCP 线程上执行是非常重要的。在此回调中避免冗长的操作是绝对**必要的。**使用这些线程进行复杂的处理会像使用'thread-per-connection'一样有效地扼杀你的可伸缩性。

建议的解决方案是仅使用回调将工作项排队以处理传入数据，这些数据将在其他线程上执行。避免回调中的任何潜在阻塞操作，以便 IOCP 线程可以尽快返回其池。在 .NET 4.0 中，我建议最简单的解决方案是生成 a ，为其提供对客户端套接字的引用以及调用`Task`已读取的第一个字节的副本。`BeginReceive`然后，此任务负责从套接字中读取代表您正在处理的请求的所有数据，执行它，然后再次调用新的`BeginReceive`调用以将套接字排队等待 IOCP。在 .NET 4.0 之前，您可以使用 ThreadPool，或者创建自己的线程工作队列实现。

## 概括

基本上，我建议对此解决方案使用[Kevin 的示例代码，并添加以下警告：](https://stackoverflow.com/questions/869744/how-to-write-a-scalable-tcp-ip-based-server/876200#876200)

*   确保您传递给的缓冲区`BeginReceive`已经“固定”
*   确保您传递给的回调只是`BeginReceive`将任务排队以处理传入数据的实际处理

当您这样做时，我毫不怀疑您可以复制 Chris 的结果，将其扩展到潜在的数十万个并发客户端（当然，前提是正确的硬件和您自己的处理代码的有效实现；）

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2009-05-23T01:53:18.723

您已经通过上面的代码示例得到了大部分答案。使用异步 I/O 操作绝对是这里的方法。异步 I/O 是 Win32 内部设计的扩展方式。您可以获得的最佳性能是使用*完成端口*实现的，将您的套接字绑定到完成端口并有一个线程池等待完成端口完成。普遍的看法是每个 CPU（核心）有 2-4 个线程等待完成。我强烈建议阅读 Windows 性能团队的 Rick Vicik 撰写的这三篇文章：

1.  [为性能设计应用程序 - 第 1 部分](http://blogs.technet.com/winserverperformance/archive/2008/04/25/designing-applications-for-high-performance-part-1.aspx)
2.  [为性能设计应用程序 - 第 2 部分](http://blogs.technet.com/winserverperformance/archive/2008/05/21/designing-applications-for-high-performance-part-ii.aspx)
3.  [为性能设计应用程序 - 第 3 部分](http://blogs.technet.com/winserverperformance/archive/2008/06/26/designing-applications-for-high-performance-part-iii.aspx)

上述文章主要涵盖本机 Windows API，但对于任何试图掌握可伸缩性和性能的人来说，它们都是必读的。他们也有一些关于管理方面的简报。

您需要做的第二件事是确保阅读《*[提高 .NET 应用程序性能和可扩展性](http://msdn.microsoft.com/en-us/library/ms998530.aspx)*》一书，该书可在线获得。您将在第 5 章中找到有关使用线程、异步调用和锁的相关且有效的建议。但真正的珍宝在第 17 章中，您将在其中找到诸如调整线程池的实用指南之类的好东西。在我按照本章中的建议调整 maxIothreads/maxWorkerThreads 之前，我的应用程序遇到了一些严重的问题。

你说你想做一个纯TCP服务器，所以我的下一点是假的。*但是*，如果您发现自己走投无路并使用 WebRequest 类及其派生类，请注意有一条巨龙守卫着那扇门：[ServicePointManager](http://msdn.microsoft.com/en-us/library/system.net.servicepointmanager.aspx)。这是一个在生活中有一个目的的配置类：破坏你的表现。确保您将服务器从人为强加的 ServicePoint.ConnectionLimit 中释放出来，否则您的应用程序将永远无法扩展（我让您自己发现默认值是什么......）。您还可以重新考虑在 HTTP 请求中发送 Expect100Continue 标头的默认策略。

现在关于核心套接字管理 API，发送端的事情相当简单，但接收端的事情要复杂得多。为了实现高吞吐量和规模，您必须确保套接字不受流控制，因为您没有为接收发布的缓冲区。理想情况下，为了获得高性能，您应该提前发布 3-4 个缓冲区，并在收到一个缓冲区后立即发布新缓冲区（在处理返回的缓冲区**之前**），这样您就可以确保套接字始终有存放来自网络的数据的地方. 您会明白为什么您可能无法在短期内实现这一目标。

在您玩完 BeginRead/BeginWrite API 并开始认真工作之后，您会意识到您需要对流量进行安全保护，即 NTLM/Kerberos 身份验证和流量加密，或者至少是流量篡改保护。你这样做的方式是使用内置的 System.Net.Security.NegotiateStream （或者 SslStream 如果你需要跨不同的域）。这意味着您将依赖 AuthenticatedStream 异步操作，而不是依赖直接的套接字异步操作。一旦获得套接字（从客户端的连接或服务器上的接受），您就在套接字上创建一个流并通过调用 BeginAuthenticateAsClient 或 BeginAuthenticateAsServer 将其提交以进行身份​​验证。[您的产品必须支持ACL](https://en.wikipedia.org/wiki/Access_control_list)验证。

之后，您将使用 BeginWrite 发送消息，并且您将使用 BeginRead 接收它们。这是我之前谈到的问题，您将无法发布多个接收缓冲区，因为 AuthenticateStream 类不支持这一点。BeginRead 操作在内部管理所有 I/O，直到您收到整个帧。否则，它无法处理消息认证（解密帧并验证帧上的签名）。虽然根据我的经验，AuthenticatedStream 类所做的工作相当不错，应该没有任何问题。即，您应该能够仅用 4-5% 的 CPU 使 1 Gbit/s 网络饱和。AuthenticatedStream 类还将对您施加特定于协议的帧大小限制（SSL 为 16k，Kerberos 为 12k）。

这应该让你开始走上正轨。我不打算在这里发布代码，[MSDN 上有一个非常好的例子](http://msdn.microsoft.com/en-us/library/system.net.security.negotiatestream(VS.85).aspx)。我已经完成了许多这样的项目，并且能够毫无问题地扩展到大约 1000 个连接的用户。除此之外，您需要修改注册表项以允许内核使用更多套接字句柄。并确保您部署在**服务器**操作系统上，即[Windows Server 2003](https://en.wikipedia.org/wiki/Windows_Server_2003)，而不是 Windows XP 或[Windows Vista](https://en.wikipedia.org/wiki/Windows_Vista)（即客户端操作系统），这会产生很大的不同。

顺便说一句，请确保，如果您在服务器或文件 I/O 上进行数据库操作，您也对它们使用异步风格，否则您将立即耗尽线程池。对于 SQL Server 连接，请确保将“Asyncronous Processing=true”添加到连接字符串。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-05-18T01:57:38.983

我的一些解决方案中运行着这样的服务器。以下是在 .NET 中执行此操作的不同方法的非常详细的说明：*[Get Closer to the Wire with High-Performance Sockets in .NET](http://msdn.microsoft.com/en-us/magazine/cc300760.aspx)*

最近我一直在寻找改进代码的方法，并将研究以下内容：“[版本 3.5 中的套接字性能增强](http://msdn.microsoft.com/en-us/library/bb968780.aspx)”，其中专门包含“供使用异步网络 I/O 以实现最高性能的应用程序使用”。

“这些增强的主要特点是避免在大容量异步套接字 I/O 期间重复分配和同步对象。目前由 Socket 类实现的异步套接字 I/O 的 Begin/End 设计模式需要一个 System.为每个异步套接字操作分配 IAsyncResult 对象。”

如果您点击链接，您可以继续阅读。我个人明天将测试他们的示例代码，以根据我所拥有的进行基准测试。

[在这里](http://www.codeproject.com/KB/IP/socketasynceventargssampl.aspx)，您可以找到使用新的 3.5 SocketAsyncEventArgs 的客户端和服务器的工作代码，以便您可以在几分钟内对其进行测试并完成代码。这是一种简单的方法，但它是开始更大实施的基础。此外，大约两年前在 MSDN 杂志上发表的[这篇文章也很有趣。](http://msdn.microsoft.com/en-us/magazine/cc163356.aspx)

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-05-17T05:40:04.020

考虑只使用[WCF](https://en.wikipedia.org/wiki/Windows_Communication_Foundation)网络 TCP 绑定和发布/订阅模式。WCF 将允许您（主要）专注于您的域而不是管道......

IDesign 的下载部分有很多 WCF 示例，甚至还有一个发布/订阅框架，这可能很有用：[http ://www.idesign.net](http://www.idesign.net/idesign/DesktopDefault.aspx?tabindex=5&tabid=11)

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-05-21T06:37:35.400

我想知道一件事：

> 我绝对不想为每个连接启动一个线程。

这是为什么？至少从 Windows 2000 开始，Windows 就可以处理应用程序中的数百个线程。我已经做到了，如果线程不需要同步，那么使用起来真的很容易。特别是考虑到您正在执行大量 I/O（因此您不受 CPU 限制，并且很多线程会在磁盘或网络通信上被阻塞），我不明白这个限制。

你有没有测试过多线程的方式，发现它缺少什么？您是否还打算为每个线程建立一个数据库连接（这会杀死数据库服务器，所以这是一个坏主意，但通过 3 层设计很容易解决）。您是否担心您将拥有数千个客户而不是数百个客户，然后您真的会遇到问题？（尽管如果我有 32 GB 以上的 RAM，我会尝试一千个线程甚至一万个线程 - 再次，鉴于您不受 CPU 限制，线程切换时间应该绝对无关紧要。）

这是代码 - 要查看它的运行情况，请访问[http://mdpopescu.blogspot.com/2009/05/multi-threaded-server.html](http://mdpopescu.blogspot.com/2009/05/multi-threaded-server.html)并单击图片。

服务器类：

```
 public class Server
  {
    private static readonly TcpListener listener = new TcpListener(IPAddress.Any, 9999);

    public Server()
    {
      listener.Start();
      Console.WriteLine("Started.");

      while (true)
      {
        Console.WriteLine("Waiting for connection...");

        var client = listener.AcceptTcpClient();
        Console.WriteLine("Connected!");

        // each connection has its own thread
        new Thread(ServeData).Start(client);
      }
    }

    private static void ServeData(object clientSocket)
    {
      Console.WriteLine("Started thread " + Thread.CurrentThread.ManagedThreadId);

      var rnd = new Random();
      try
      {
        var client = (TcpClient) clientSocket;
        var stream = client.GetStream();
        while (true)
        {
          if (rnd.NextDouble() < 0.1)
          {
            var msg = Encoding.ASCII.GetBytes("Status update from thread " + Thread.CurrentThread.ManagedThreadId);
            stream.Write(msg, 0, msg.Length);

            Console.WriteLine("Status update from thread " + Thread.CurrentThread.ManagedThreadId);
          }

          // wait until the next update - I made the wait time so small 'cause I was bored :)
          Thread.Sleep(new TimeSpan(0, 0, rnd.Next(1, 5)));
        }
      }
      catch (SocketException e)
      {
        Console.WriteLine("Socket exception in thread {0}: {1}", Thread.CurrentThread.ManagedThreadId, e);
      }
    }
  } 
```

服务器主程序：

```
namespace ManyThreadsServer
{
  internal class Program
  {
    private static void Main(string[] args)
    {
      new Server();
    }
  }
} 
```

客户端类：

```
 public class Client
  {
    public Client()
    {
      var client = new TcpClient();
      client.Connect(IPAddress.Loopback, 9999);

      var msg = new byte[1024];

      var stream = client.GetStream();
      try
      {
        while (true)
        {
          int i;
          while ((i = stream.Read(msg, 0, msg.Length)) != 0)
          {
            var data = Encoding.ASCII.GetString(msg, 0, i);
            Console.WriteLine("Received: {0}", data);
          }
        }
      }
      catch (SocketException e)
      {
        Console.WriteLine("Socket exception in thread {0}: {1}", Thread.CurrentThread.ManagedThreadId, e);
      }
    }
  } 
```

客户端主程序：

```
using System;
using System.Threading;

namespace ManyThreadsClient
{
  internal class Program
  {
    private static void Main(string[] args)
    {
      // first argument is the number of threads
      for (var i = 0; i < Int32.Parse(args[0]); i++)
        new Thread(RunClient).Start();
    }

    private static void RunClient()
    {
      new Client();
    }
  }
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-05-16T05:43:25.843

如果您能正确掌握所有细节，那么使用 .NET 的集成异步 I/O（`BeginRead`等）是一个好主意。当您正确设置套接字/文件句柄时，它将使用操作系统的底层 IOCP 实现，允许您在不使用任何线程的情况下完成操作（或者，在最坏的情况下，使用我认为来自内核 I/O 线程的线程pool 而不是 .NET 的线程池，这有助于缓解线程池拥塞。）

主要问题是确保您以非阻塞模式打开套接字/文件。大多数默认的便利函数（如`File.OpenRead`）不这样做，因此您需要自己编写。

另一个主要问题之一是错误处理——在编写异步 I/O 代码时正确处理错误比在同步代码中处理要困难得多。即使您可能不直接使用线程，也很容易导致竞争条件和死锁，因此您需要注意这一点。

如果可能，您应该尝试使用便利库来简化执行可扩展异步 I/O 的过程。

Microsoft 的[并发协调运行时](http://msdn.microsoft.com/en-us/library/bb648752.aspx)是 .NET 库的一个示例，旨在减轻进行此类编程的难度。它看起来很棒，但由于我没有使用它，我无法评论它的扩展性如何。

对于需要进行异步网络或磁盘 I/O 的个人项目，我使用了一组我在过去一年中构建的 .NET 并发/I/O 工具，称为[Squared.Task](http://code.google.com/p/fracture/source/browse/#svn/trunk/Squared/TaskLib)。[它受到imvu.task](http://thespeedbump.livejournal.com/63798.html)和[twisted](http://twistedmatrix.com/trac/)等库的启发，并且我在存储库中包含了一些执行网络 I/O 的[工作示例](http://code.google.com/p/fracture/source/browse/#svn/trunk/Squared/Examples)。我还在我编写的一些应用程序中使用了它——最大的公开发布的应用程序是[NDexer](http://code.google.com/p/ndexer/)（将它用于无线程磁盘 I/O）。该库是根据我使用 imvu.task 的经验编写的，并且具有一组相当全面的单元测试，因此我强烈建议您尝试一下。如果您对此有任何问题，我很乐意为您提供一些帮助。

在我看来，根据我的经验，在 .NET 平台上使用异步/无线程 I/O 代替线程是值得尝试的，只要您准备好应对学习曲线。它允许您避免 Thread 对象成本带来的可伸缩性麻烦，并且在许多情况下，您可以通过仔细使用并发原语（如[futures 和 promises](https://en.wikipedia.org/wiki/Futures_and_promises) ）来完全避免使用锁和互斥锁。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-11-22T15:04:17.267

我使用了[Kevin 的解决方案](https://stackoverflow.com/questions/869744/how-to-write-a-scalable-tcp-ip-based-server/876200#876200)，但他说该解决方案缺少用于重新组装消息的代码。开发人员可以使用此代码重新组装消息：

```
private static void ReceiveCallback(IAsyncResult asyncResult )
{
    ClientInfo cInfo = (ClientInfo)asyncResult.AsyncState;

    cInfo.BytesReceived += cInfo.Soket.EndReceive(asyncResult);
    if (cInfo.RcvBuffer == null)
    {
        // First 2 byte is lenght
        if (cInfo.BytesReceived >= 2)
        {
            //this calculation depends on format which your client use for lenght info
            byte[] len = new byte[ 2 ] ;
            len[0] = cInfo.LengthBuffer[1];
            len[1] = cInfo.LengthBuffer[0];
            UInt16 length = BitConverter.ToUInt16( len , 0);

            // buffering and nulling is very important
            cInfo.RcvBuffer = new byte[length];
            cInfo.BytesReceived = 0;

        }
    }
    else
    {
        if (cInfo.BytesReceived == cInfo.RcvBuffer.Length)
        {
             //Put your code here, use bytes comes from  "cInfo.RcvBuffer"

             //Send Response but don't use async send , otherwise your code will not work ( RcvBuffer will be null prematurely and it will ruin your code)

            int sendLenghts = cInfo.Soket.Send( sendBack, sendBack.Length, SocketFlags.None);

            // buffering and nulling is very important
            //Important , set RcvBuffer to null because code will decide to get data or 2 bte lenght according to RcvBuffer's value(null or initialized)
            cInfo.RcvBuffer = null;
            cInfo.BytesReceived = 0;
        }
    }

    ContinueReading(cInfo);
 }

private static void ContinueReading(ClientInfo cInfo)
{
    try
    {
        if (cInfo.RcvBuffer != null)
        {
            cInfo.Soket.BeginReceive(cInfo.RcvBuffer, cInfo.BytesReceived, cInfo.RcvBuffer.Length - cInfo.BytesReceived, SocketFlags.None, ReceiveCallback, cInfo);
        }
        else
        {
            cInfo.Soket.BeginReceive(cInfo.LengthBuffer, cInfo.BytesReceived, cInfo.LengthBuffer.Length - cInfo.BytesReceived, SocketFlags.None, ReceiveCallback, cInfo);
        }
    }
    catch (SocketException se)
    {
        //Handle exception and  Close socket here, use your own code
        return;
    }
    catch (Exception ex)
    {
        //Handle exception and  Close socket here, use your own code
        return;
    }
}

class ClientInfo
{
    private const int BUFSIZE = 1024 ; // Max size of buffer , depends on solution
    private const int BUFLENSIZE = 2; // lenght of lenght , depends on solution
    public int BytesReceived = 0 ;
    public byte[] RcvBuffer { get; set; }
    public byte[] LengthBuffer { get; set; }

    public Socket Soket { get; set; }

    public ClientInfo(Socket clntSock)
    {
        Soket = clntSock;
        RcvBuffer = null;
        LengthBuffer = new byte[ BUFLENSIZE ];
    }

}

public static void AcceptCallback(IAsyncResult asyncResult)
{

    Socket servSock = (Socket)asyncResult.AsyncState;
    Socket clntSock = null;

    try
    {

        clntSock = servSock.EndAccept(asyncResult);

        ClientInfo cInfo = new ClientInfo(clntSock);

        Receive( cInfo );

    }
    catch (SocketException se)
    {
        clntSock.Close();
    }
}
private static void Receive(ClientInfo cInfo )
{
    try
    {
        if (cInfo.RcvBuffer == null)
        {
            cInfo.Soket.BeginReceive(cInfo.LengthBuffer, 0, 2, SocketFlags.None, ReceiveCallback, cInfo);

        }
        else
        {
            cInfo.Soket.BeginReceive(cInfo.RcvBuffer, 0, cInfo.BytesReceived, SocketFlags.None, ReceiveCallback, cInfo);

        }

    }
    catch (SocketException se)
    {
        return;
    }
    catch (Exception ex)
    {
        return;
    }

} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-17T05:56:15.743

[您可以在C10k 问题页面上](http://www.kegel.com/c10k.html)找到一个很好的技术概述。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-15T16:58:45.730

您可以尝试使用称为[自适应通信环境](https://en.wikipedia.org/wiki/Adaptive_Communication_Environment)(ACE) 的框架，它是用于网络服务器的通用 C++ 框架。这是一款非常可靠、成熟的产品，旨在支持电信级的高可靠性、大容量应用。

该框架处理相当广泛的并发模型，并且可能有一个适合您的应用程序开箱即用。这应该使系统更容易调试，因为大多数令人讨厌的并发问题已经得到解决。这里的权衡是该框架是用 C++ 编写的，并不是最温暖和蓬松的代码库。另一方面，您可以获得经过测试的工业级网络基础设施和开箱即用的高度可扩展架构。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-15T16:59:41.357

我会使用[SEDA](http://www.eecs.harvard.edu/%7Emdw/proj/seda/)或轻量级线程库（[Erlang](https://en.wikipedia.org/wiki/Erlang_%28programming_language%29)或更新的 Linux。请参阅[服务器端的 NTPL 可扩展性](http://www.theserverside.com/discussions/thread.tss?thread_id=26700)）。如果您的通信不是，异步编码非常麻烦:)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-05-15T22:28:59.430

好吧，.NET 套接字似乎提供了[select()](http://msdn.microsoft.com/en-us/library/system.net.sockets.socket.select.aspx) - 这对于处理输入来说是最好的。对于输出，我将有一个套接字编写器线程池监听工作队列，接受套接字描述符/对象作为工作项的一部分，因此每个套接字不需要一个线程。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-05-21T23:38:03.930

我会使用 .NET 3.5 中添加的 AcceptAsync/ConnectAsync/ReceiveAsync/SendAsync 方法。我做了一个基准测试，当有 100 个用户不断发送和接收数据时，它们的速度大约快了 35%（响应时间和比特率）。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-01-27T14:24:38.793

要人们复制粘贴接受的答案，您可以重写 acceptCallback 方法，删除所有调用 _serverSocket.BeginAccept(new AsyncCallback(acceptCallback), _serverSocket); 并将其放在 finally{} 子句中，这样：

```
private void acceptCallback(IAsyncResult result)
    {
       xConnection conn = new xConnection();
       try
       {
         //Finish accepting the connection
         System.Net.Sockets.Socket s = (System.Net.Sockets.Socket)result.AsyncState;
         conn = new xConnection();
         conn.socket = s.EndAccept(result);
         conn.buffer = new byte[_bufferSize];
         lock (_sockets)
         {
           _sockets.Add(conn);
         }
         //Queue recieving of data from the connection
         conn.socket.BeginReceive(conn.buffer, 0, conn.buffer.Length, SocketFlags.None, new AsyncCallback(ReceiveCallback), conn);
       }
       catch (SocketException e)
       {
         if (conn.socket != null)
         {
           conn.socket.Close();
           lock (_sockets)
           {
             _sockets.Remove(conn);
           }
         }
       }
       catch (Exception e)
       {
         if (conn.socket != null)
         {
           conn.socket.Close();
           lock (_sockets)
           {
             _sockets.Remove(conn);
           }
         }
       }
       finally
       {
         //Queue the next accept, think this should be here, stop attacks based on killing the waiting listeners
         _serverSocket.BeginAccept(new AsyncCallback(acceptCallback), _serverSocket);       
       }
     } 
```

您甚至可以删除第一个 catch，因为它的内容是相同的，但它是一个模板方法，您应该使用类型化异常来更好地处理异常并了解导致错误的原因，因此只需使用一些有用的代码来实现这些 catch。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-05-20T06:17:52.270

我建议在[ACE](https://en.wikipedia.org/wiki/Adaptive_Communication_Environment)上阅读这些书籍，

*   [C++ 网络编程：使用 ACE 和模式掌握复杂性](http://www.cs.wustl.edu/%7Eschmidt/ACE/book1/)
*   [C++ 网络编程：ACE 和框架的系统重用](http://www.cs.wustl.edu/%7Eschmidt/ACE/book2/)

获取有关模式的想法，让您创建高效的服务器。

尽管 ACE 是用 C++ 实现的，但这些书籍涵盖了许多可以在任何编程语言中使用的有用模式。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2009-05-16T02:28:59.727

> 需要明确的是，我正在寻找基于 .NET 的解决方案（如果可能，C#，但任何 .NET 语言都可以）

如果您纯粹使用 .NET，您将无法获得最高级别的可伸缩性。GC 暂停会阻碍延迟。

> 我将需要为该服务启动至少一个线程。我正在考虑使用异步 API（BeginReceive 等），因为我不知道在任何给定时间我将连接多少个客户端（可能是数百个）。我绝对不想为每个连接启动一个线程。

[重叠 I/O](http://msdn.microsoft.com/en-us/library/ms686358(VS.85).aspx)通常被认为是 Windows 用于网络通信的最快 API。我不知道这是否与您的异步 API 相同。不要使用*select*，因为每次调用都需要检查每个打开的套接字，而不是在活动套接字上进行回调。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2010-07-20T10:16:14.880

您可以使用*[Push Framework](http://www.pushframework.com)*开源框架进行高性能服务器开发。它基于[IOCP](https://en.wikipedia.org/wiki/Input/output_completion_port)构建，适用于推送场景和消息广播。

# cucumber - 如何在 Cucumber 中测试 authlogic 的 current_user？

> ID：869753
> 
> 赞同：7
> 
> 时间：2009-05-15T16:51:30.347
> 
> 标签：cucumber, authlogic

我正在尝试在[Cucumber](https://github.com/aslakhellesoy/cucumber/wiki/)中使用 authlogic 的测试助手，调用 activate_authlogic。

我们的 application_controller 有一个 current_user_session 方法。

当我们进入调试器中层时，`controller`返回一个`Authlogic::TestCase::MockController`.

但是当我们调用controller.current_user_session 时。

评估时发生错误`nil.current_user_session`。

这个mock怎么突然变成nil了？

这个模拟控制器是否知道我们的应用程序控制器的代码？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-30T19:22:46.160

我不知道 authlogic （如果这个答案有帮助的话），但是那个模拟对象首先来自哪里？你不应该在你的黄瓜故事中使用任何模拟。Cucumber 就像一个集成测试，测试完整的 Rails Stack。

我使用它来确保我的视图、控制器和模型规范没有相互偏离。

# c# - WPF：实现 MediaPlayer 音频/视频搜索器

> ID：869761
> 
> 赞同：4
> 
> 时间：2009-05-15T16:53:49.843
> 
> 标签：c#, wpf, xaml, audio, media-player

我目前正在使用 WPF 开发 MP3 播放器（在 WPF 应用程序中），`MediaPlayer`基本上，我想实现一个与当前播放歌曲一起移动的 Song Seeker。

我已经实现了一个歌曲滑块（来自[Sacha Barber 的应用程序](http://www.codeproject.com/KB/WPF/WPF_Media_Player.aspx?fid=459289&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=26#xx0xx)），当用户手动拖动搜索器时它可以工作（如，歌曲从该位置继续）但我不知道如何使搜索器根据当前位置移动这首歌。

问题是我认为没有办法检查 的`Position`属性何时`MediaPlayer`发生变化，所以我对如何实现这个功能感到困惑。

关于如何解决这个问题的任何想法？

**[更新]**

关于用计时器增加搜索器，我实际上想到了使用我还没有尝试它的原因是因为我认为有更好的方法来实现这个使用`MediaTimeline`......但我还没有弄清楚如何。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-12-25T10:55:05.963

起来回答！服侍你的主人

好的，我已经想出了如何工作。我确定我没有以完全正确的方式进行操作，但它确实有效。

这是一个 WPF 应用程序的代码隐藏，带有一个暂停/播放按钮。

```
public partial class Main : Window
{
    MediaPlayer MPlayer;
    MediaTimeline MTimeline;

    public Main()
    {
        InitializeComponent();

        var uri = new Uri("C:\\Test.mp3");
        MPlayer = new MediaPlayer();
        MTimeline = new MediaTimeline(uri);
        MTimeline.CurrentTimeInvalidated += new EventHandler(MTimeline_CurrentTimeInvalidated);
        MPlayer.Clock = MTimeline.CreateClock(true) as MediaClock;
        MPlayer.Clock.Controller.Stop();
    }

    void MTimeline_CurrentTimeInvalidated(object sender, EventArgs e)
    {
        Console.WriteLine(MPlayer.Clock.CurrentTime.Value.TotalSeconds);
    }

    private void btnPlayPause_Click(object sender, RoutedEventArgs e)
    {
        //Is Active
        if (MPlayer.Clock.CurrentState == ClockState.Active)
        {
            //Is Paused
            if (MPlayer.Clock.CurrentGlobalSpeed == 0.0)
                MPlayer.Clock.Controller.Resume();
            else //Is Playing
                MPlayer.Clock.Controller.Pause();
        }
        else if (MPlayer.Clock.CurrentState == ClockState.Stopped) //Is Stopped
            MPlayer.Clock.Controller.Begin();
    }
} 
```

诀窍是，一旦您设置了 MediaPlayer 的时钟，它就会成为时钟控制的，因此使用 MPlayer.Clock.Controller 来完成所有控制:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-16T09:05:14.983

从来没有玩过媒体播放器，但假设你知道歌曲的长度，你不能设置一个在歌曲播放时每秒滴答的计时器。因此，对于每个滴答声，只需根据歌曲的总时长来增加搜索器。

歌曲长度为 100 秒。因此，每一秒/滴答声都相当于总进度的 1%。

暂停歌曲等时，您必须停止计时器...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-28T10:25:01.263

MediaElement 有一个可以用于此的位置属性：http: [//msdn.microsoft.com/en-us/library/system.windows.controls.mediaelement.position.aspx](http://msdn.microsoft.com/en-us/library/system.windows.controls.mediaelement.position.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-19T14:05:24.580

你检查过 WPF [MediaKit](http://wpfmediakit.codeplex.com/)了吗？

# css - 一个 div 可以有一个背景图像，但重复一个不同的背景图像吗？

> ID：869764
> 
> 赞同：0
> 
> 时间：2009-05-15T16:54:12.510
> 
> 标签：css, html, background

我正在设置一个使用一些渐变的设计，这当然会导致问题。我想要的是我的一个具有垂直渐变的背景图像作为主要背景，但是如果内容扩展并将 div 推出，我希望在底部重复一个不同的 sliver 图像。有可能做这样的事情吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T16:57:07.713

您可以获得的最接近的方法是在背景图像中使用背景颜色。然后将图像设置为不重复。然后颜色将成为 div 中没有背景图像的部分的背景。

# c# - 序列化事件

> ID：869768
> 
> 赞同：6
> 
> 时间：2009-05-15T16:55:08.280
> 
> 标签：c#, serialization, events

我有 A 类，它公开了一个事件。订阅了该事件的 B 类对象。这两个实例实际上也经常互相引用。我想序列化 A，并通过网络传输两个对象，以便在另一端重建。这工作正常，除了不保留事件订阅。

我认为我必须实现自己的序列化构造函数，以便在我的对象被反序列化时“收到通知”，以便它可以重新订阅该事件。

但是，看起来这意味着我必须自己通过实现 ISerializable 来完全实现序列化。我现在依赖 BinaryFormatter 和 [Serializable] 属性，实际上非常喜欢。

有没有人知道一种方法让我在反序列化时得到通知，同时仍然能够使用内置的序列化系统为我自动序列化和反序列化我有点复杂的对象图？

谢谢，卢卡斯

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-15T17:02:08.933

标准（非 XML）序列化机制使用特殊属性来标记要在（反）序列化期间用作回调的方法。[OnDeserializedAttribute](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.ondeserializedattribute.aspx)是您正在寻找的。类似的解决方案是实现[IDeserializationCallback](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.ideserializationcallback.aspx)接口。

# winapi - Windows 视频错误 80044066

> ID：869769
> 
> 赞同：1
> 
> 时间：2009-05-15T16:55:26.377
> 
> 标签：winapi, avi, vfw

我正在使用 Video for Windows 将屏幕抓取记录到 AVI 文件。通常它工作正常，但一些用户报告错误：

AVI 错误 (80044066)：格式错误

对此错误的含义以及可能导致该错误的原因的任何解释将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-02-02T01:04:20.653

是否有可能某些机器安装了正确的编解码器而其他机器没有？

# javascript - 如何将任何类型的实例转换为字符串？

> ID：869773
> 
> 赞同：30
> 
> 时间：2009-05-15T16:56:19.837
> 
> 标签：javascript

我正在实现一个函数，该函数接收一个需要将其转换为其字符串表示形式的参数。

如果给定的对象实现了一个`toString()`方法，那么该函数应该使用它。否则，该函数可以依赖于 JavaScript 实现提供的内容。

我想出的是这样的：

```
var convert = function (arg) {
  return (new String(arg)).valueOf();
} 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2016-02-27T18:45:47.387

`String(null)`返回 - “空”

`String(undefined)`返回 - “未定义”

`String(10)`返回 - “10”

`String(1.3)`返回 - “1.3”

`String(true)`返回 - “真”

我认为这是一种更优雅的方式。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-05-15T17:04:47.697

我不确定你甚至需要一个函数，但这将是最短的方法：

```
function( arg ) {
    return arg + '';
} 
```

否则这是最短的方法：

```
arg += ''; 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-05-15T17:00:38.220

```
value = value+""; 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2020-04-14T19:56:09.357

如果以 ES6 或更高版本为目标，您可以使用[模板文字](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals)：

```
function (arg) {
    return `${arg}`;
} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-05-15T17:24:29.427

JavaScript 中的所有数据类型都继承一个**`toString`**方法：

```
('hello').toString();   // "hello"
(123).toString();       // "123"
([1,2,3]).toString();   // "1,2,3"
({a:1,b:2}).toString(); // "[object Object]"
(true).toString();      // "true" 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2021-08-28T03:38:10.363

这些都是很好的答案，但这是涵盖所有情况的最终解决方案:)

```
function stringify(value) {
  switch (typeof value) {
    case 'string': case 'object': return JSON.stringify(value);
    default: return String(value);
  }
};

for (const value of [
  null,
  undefined,
  12345,
  'abcdef',
  true,
  false,
  BigInt(9007199254740991),
  NaN,
  Symbol('sym'),
  [1, 2, 3],
  {aaa: 'AAA', bbb: 'BBB'},
  (a, b) => a + b,
  stringify,
]) {
  console.log(stringify(value));
}
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-10-24T21:53:50.490

当涉及到传递的 JSON 对象时，其他答案是不完整的。所以我做了这个，它适用于所有人：

```
var getString = (o) => {
    if (o !== null) {
        if (typeof o === 'string') {
            return o;
        } else {
            return JSON.stringify(o);
        }
    } else {
        return null;
    }
}
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-07-30T11:09:30.857

`JSON.stringify(value)`

适用于 null、未定义、原语、数组和对象——基本上是所有东西。

# python - 在 Python 中按索引填充列表/数组？

> ID：869778
> 
> 赞同：33
> 
> 时间：2009-05-15T16:57:25.047
> 
> 标签：python, list

这可能吗：

```
myList = []

myList[12] = 'a'
myList[22] = 'b'
myList[32] = 'c'
myList[42] = 'd' 
```

当我尝试时，我得到：

```
# IndexError: list assignment index out of range # 
```

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-05-15T17:03:29.993

您必须先用一些东西（例如`0`或`None`）预先填充它，然后才能对其进行索引：

```
myList = [None] * 100  # Create list of 100 'None's
myList[12] = 'a'  # etc. 
```

或者，正如[Alex Martelli 建议](https://stackoverflow.com/questions/869778/populating-a-list-array-by-index-in-python/869805#869805)的那样，使用 dict 而不是列表。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-05-15T17:01:13.727

对于“稀疏列表”，您可以使用 a`dict`代替：

```
mylist = {}
mylist[12] = 'a' 
```

等等如果你想要一个实际的列表（用 初始化它`[]`，当然*不是* `()`！-）你需要将未设置的插槽填充到_some_thing，例如`None`，通过一个小辅助函数或通过子类化`list`。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-05-15T17:20:46.253

这是一个快速列表包装器，如果您尝试将值分配给超过其长度的索引，它将自动用零扩展您的列表。

```
class defaultlist(list):

   def __setitem__(self, index, value):
      size = len(self)
      if index >= size:
         self.extend(0 for _ in range(size, index + 1))

      list.__setitem__(self, index, value) 
```

现在你可以这样做：

```
>>> a = defaultlist([1,2,3])
>>> a[1] = 5
[1,5,3]
>>> a[5] = 10
[1,5,3,0,0,10] 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-15T17:03:32.690

`None`并非没有使用某些内容（例如或空字符串）填充列表中的其他位置。尝试使用您编写的代码将元素插入到列表中会导致`IndexError`.

还有`mylist.insert`，但是这段代码：

```
myList.insert(12,'a') 
```

只会在列表中第一个未占用的位置插入“a”（使用您的示例将是 0）。

因此，正如我所说，列表中必须在索引 0-11 处存在某些内容，然后才能在`myList[12]`.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-15T17:19:36.053

如果您不提前知道列表的大小，可以使用 try/except 然后在 except 中扩展列表：

```
L = []
def add(i, s):
    try:
        L[i] = s
    except IndexError:
        L.extend([None]*(i-len(L)+1))
        L[i] = s

add(12, 'a')
add(22, 'b') 
```

**- - - 更新 - - - - - - - - - - - - - - - - - - - - - - -根据 tgray 的评论：如果您的代码***大部分时间*
可能会抛出异常，您应该每次检查列表的长度，并避免异常：

 *```
L = []
def add(i, s):
    size = len(L)
    if i >= size:
        L.extend([None]*(i-size+1))
        L[i] = s 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-11-17T14:42:52.253

以防万一有人需要，我想出了一个解决我的问题的方法，我需要**计算很多阶乘**，其中一些**可以重复**，所以这是我的解决方案：

```
factorials = {}

def calcFact(v):
    try:
        return factorials[v]
    except KeyError:
        factorials[v] = math.factorial(v)
        return factorials[v] 
```

**测试用例：**

```
calcFact(99000)
calcFact(90900)
calcFact(90090)
calcFact(90009)
calcFact(90009) #repeated
calcFact(90009) #repeated 
```

**结果：**

> 重复数学计算：**1.576** s
> 
> 使用上面的代码（存储重复值的列表）：**1.011** s

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-03-04T10:23:17.753

建立在三联画之上..如果你想要一个任意维度的列表

```
class dynamiclist(list):
    """ List not needing pre-initialization

    Example:
        l = dynamiclist()
        l[20][1] = 10
        l[21][1] = 20
    """

    def __setitem__(self, index, value):
        size = len(self)
        if index >= size:
            self.extend(dynamiclist() for _ in range(size, index + 1))

        list.__setitem__(self, index, value)

    def __getitem__(self, index):
        size = len(self)
        if index >= size:
            self.extend(dynamiclist() for _ in range(size, index + 1))  # allows dimensions > 1

        return list.__getitem__(self, index) 
```

例子

```
l = dynamiclist()
l[20][1] = 10
l[21][1] = 20 
```

# xml - 用于 AS3/Flex/Adobe AIR 应用程序的流式解析器 (JSON/XML)

> ID：869780
> 
> 赞同：3
> 
> 时间：2009-05-15T16:57:27.103
> 
> 标签：xml, actionscript-3, json, parsing, air

AS3 中是否有任何可用于 json 或 xml 格式的流式读取、解析库？我正在使用 URLStream/URLRequest 设置一个长轮询应用程序。除了格式之间的选择之外，我无法控制我收到的数据。我想要一个可以一次处理片段的解析器，这将允许我在某些完整片段可用时触发自定义事件。想法？当前的 AIR 应用程序正在做什么来处理这个问题？

示例 API：

```
var decoder:StreamingJSONDecoder = new StreamingJSONDecoder();
decoder.attachEvent("onobjectavailable", read_object); 

while (urlStream.bytesAvailable) 
{
  decoder.readBytes(get_bytes(urlStream)); 
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-12-24T06:21:03.287

当前的 AIR 版本 (v2.5) 通过 JSON.stringify() 和 JSON.parse() 捆绑了具有原生 JSON 支持的较新 WebKit。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-18T07:27:25.773

是的。

看看 AS3 Corelib：[http ://code.google.com/p/as3corelib/](http://code.google.com/p/as3corelib/)

这是一个 Adob​​e 库。[labs.adobe.com](http://labs.adobe.com/wiki/index.php/ActionScript_3:resources:apis:libraries)上应该有更多信息。

我确实在日期格式上遇到了 RSS 解析器的问题，但除此之外，一切似乎都很好。

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-01T17:07:02.500

您可能会使用[URLStream](http://livedocs.adobe.com/flex/3/langref/flash/net/URLStream.html)实例从远程网络逐步下载数据，然后在有足够数据可用时解码 JSON 结果。

像这样的东西（未经测试，只是给你一个想法）：

```
var stream:URLStream = new URLStream();
stream.addEventListener( ProgressEvent.PROGRESS, handleProgress );
stream.load( new URLRequest( "/path/to/data" ) );

function handleProgress( event:ProgressEvent ):void
{
    // Attempt to read as much from the stream as we can at this point in time
    while ( stream.bytesAvailable )
    {
        // Look for a JSONParseError if the JSON is not complete or not
        // encoded correctly.
        // Look for an EOFError is we can't read a UTF string completely
        // from the stream.
        try
        {
            var result:* = JSON.decode( stream.readUTF() );
            // If we're here, we were able to read at least one decoded JSON object
            // while handling this progress event
        }
        catch ( e:Error )
        {
            // Can't read, abort the while loop and try again next time we
            // get download progress.
            break;
        }
    }   
} 
```

# com - Windows 64 位注册表与 32 位注册表

> ID：869783
> 
> 赞同：44
> 
> 时间：2009-05-15T16:57:51.737
> 
> 标签：com, registry, x86, 64-bit, clsid

我听说在 Windows x64 架构上，为了支持同时运行 x86 和 x64 应用程序，有两组单独/不同的 Windows 注册表——一组用于 x86 应用程序访问，另一组用于 x64 应用程序访问？例如，如果一个 COM 在 x86 注册表集中注册 CLSID，那么 x64 应用程序将永远无法通过 CLSID 访问 COM 组件，因为 x86/x64 有不同的注册表集？

那么，我的问题是我对上述示例的理解是否正确？我还想获得更多文档来学习这个主题，关于 x64 架构上的两组不同的注册表。（我做了一些搜索，但没有找到任何有价值的信息。）

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-05-15T17:13:26.443

不久前我遇到了这个问题。简短的回答是，如果您在 64 位机器上运行 32 位应用程序，那么它的注册表项位于 Wow6432Node 下。

例如，假设您有一个应用程序将其注册表信息存储在：

```
HKEY_LOCAL_MACHINE\SOFTWARE\CompanyX 
```

如果您将应用程序编译为 64 位二进制文​​件并在 64 位计算机上运行，​​则注册表项位于上述位置。但是，如果您将应用程序编译为 32 位二进制文​​件并在 64 位计算机上运行，​​那么您的注册表信息现在位于此处：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\CompanyX 
```

这意味着如果您在同一台机器上同时运行 32 位和 64 位版本的应用程序，那么它们将各自查看一组不同的注册表项。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-15T17:05:23.623

你的理解是正确的。x64 应用程序不需要访问 x86 CLSID，因为它永远无法加载这些组件，反之亦然。

如果要创建供 x86 和 x64 使用的组件，则需要创建一对为 x86 构建的 dll，另一个为 x64 构建的 dll，并在注册表的相应部分注册。System32文件夹中的regsrv32.exe会反常注册x64组件，SysWOW64文件夹中的regsrv32.exe会注册x86组件。

或者，为任何 CPU 架构都可以使用的任何 CPU 构建 .NET 程序集。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-15T17:07:29.530

它们不是单独的注册表——一个是另一个的子节点，操作系统进行虚拟化以确保 32 位应用程序获取它们的密钥，而 64 位应用程序获取它们的密钥。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T17:03:41.270

我运行 x64 位机器作为我的桌面；而且我从未遇到过不同注册表配置的任何问题。

根据 MSDN，显然存在差异： http: [//msdn.microsoft.com/en-us/library/ms724072 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms724072(VS.85).aspx)

高温高压

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T17:03:57.917

这是 WOW64 注册表上的 Wikipedia 文章，它可能会为您提供一些您正在寻找的信息：

[http://en.wikipedia.org/wiki/WOW64](http://en.wikipedia.org/wiki/WOW64)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-09T15:01:39.610

如何注册 .NET 程序集以在纯 64 位应用程序中用作 COM？

**问题：** 默认情况下，如果您在构建设置中启用“注册 COM 互操作”，它不会为 64 位注册类型库。

**解决方案：** 要在 64 位机器上注册不在 GAC 中的程序集，请打开 cmd 窗口并执行以下操作：

```
cd c:\windows\microsoft.net\framework64\v2.x.xxxxx
regasm /codebase "path to your compiled assembly dll" 
```

当使用本机 C++ 将 .NET 程序集实例化为 COM 对象时，这将消除“类未注册错误”。

# asp.net - ASP.NET 中的水晶报表 - 显示图像

> ID：869784
> 
> 赞同：1
> 
> 时间：2009-05-15T16:58:34.997
> 
> 标签：asp.net, crystal-reports

我在我的网站上使用 Crystal Report 来动态构建 PDF 文件以供下载。这很好用。但是，现在我想在报告中添加图像。当我转到插入 - 图片时，浏览到我的图像文件，然后单击确定没有任何反应，这让我相信我添加不正确。我怎样才能做到这一点？此外，图像是否需要存在于我的网络服务器上，还是嵌入在报告中？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T17:16:35.873

那么您是通过 Crystal Reports 设计器将图片添加到报表中吗？

可能图片的格式不受支持？尝试将其保存为另一种格式并再次添加，可能会起作用！

据我所知，该图像将嵌入到报告中。

# programming-languages - 编写易于修改的代码

> ID：869799
> 
> 赞同：1
> 
> 时间：2009-05-15T17:00:52.433
> 
> 标签：programming-languages, coding-style, dry

有哪些方法可以编写易于修改的代码？

我从经验中学到的一点是，我几乎总是需要写一个扔掉。这样，在编写实际应用程序之前，我就对所需的领域知识和程序结构有了一定的了解。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T17:11:11.907

一般准则是偏离的

*   高内聚、低耦合
*   不要重复自己
*   识别设计模式并实现它们
*   不要识别不存在或不需要的设计模式
*   使用编码标准，坚持下去
*   如有疑问，请评论应评论的所有内容：评论
*   使用单元测试
*   在实施之前写评论和测试，这样你就知道你想做什么
*   当它出错时：重构，重构，重构。通过良好的测试，您可以确保没有任何问题

哦，是的：

阅读： http: [//www.pragprog.com/the-pragmatic-programmer](http://www.pragprog.com/the-pragmatic-programmer)

上面的一切（我认为）和更多都在里面

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T17:17:28.897

我认为您对可修改性的强调比可读性更重要。使某些内容易于阅读并不难，但是当其他人（或您）必须根据不断变化的需求对其进行修改时，对它的理解程度的真正考验就来了。

我试图做的是假设修改是必要的，如果不是很清楚如何进行修改，请在代码中留下明确的指示以说明如何进行修改。

我假设我可能需要对代码的读者进行一些教育，以使他或她知道如何正确修改代码。这需要我的精力，也需要阅读代码的人的精力。

所以虽然我很欣赏文学编程的理念，它可以很容易地阅读和理解，但*有时*它更像是数学，唯一的方法就是让读者系好安全带，密切关注，再读几遍次，并确保他们理解。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T17:40:12.853

## 把你的代码挂起来晾干

在分配更改 Web 界面外观的任务时，我很早就知道了这一点。代码是 C 语言，我讨厌，并被编译成 CGI 可执行文件。而且，更糟糕的是，它是建立在一个被废弃的库上的——没有更新，没有支持，而且投入了太多的工时来改变它。在框架之上是一个杂乱无章的代码网络，由各种表单和元素构建器、自定义字符串实现以及各种其他神秘的东西（非 C 程序员可以自杀）组成。

对于我所做的每一项更改，输出 HTML 都会有几个，有时是很多例外。这些异常中的每一个都需要在表单构建器中进行小的更改或改进，这要归功于该语言没有继承，因此只有函数和结构，而不是花费时间在团队中，而是经常编写这些异常。

由于缺乏经验，我被迫更改每个异常的输出，而不是在改进的表单生成器中合并更改。但是，在无效更改后数小时内搜索 15,000 行代码会导致代码烧毁，以及需要一夜睡眠才能治愈的迷雾。

始终通过 DRY-er 运行您的代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T17:08:02.383

修改代码的最简单方法不是编写代码。编写伪代码不仅仅是为了算法，如果你不确定，你的代码应该如何构造。

在编写代码的同时进行设计永远不会奏效......对我来说:-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T17:16:01.757

这是我目前的经验：我正在（Java）使用一种可能经常更改的数据库模式（添加/删除的字段，修改的数据类型）。[我的策略是解析这个模式并使用apache velocity](http://velocity.apache.org/)生成代码。生成的`BaseClass`永远不会被程序员修改。否则，将`MyClass extends BaseClass`创建 a 并使用超类的“getters”和“setters”来实现此类的逻辑组件（例如 toString() ！）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-15T17:17:54.543

可读性有很大帮助：如果您做了一些不明显的事情，或者您正在走捷径，请发表评论。注释是您以后有时间可以返回和重构的地方。为所有内容使用合理的名称，以便更容易理解正在发生的事情。

不断的修订将使您从初稿转变为更好的草案，而不会丢掉（太多）工作。任何时候你从头开始重写，你都可能失去经验教训。在编写代码时，请使用重构工具来消除代表不再需要的探索领域的代码，并使显而易见的事情变得晦涩难懂。第一个减少了您需要维持的数量；第二个减少了每平方英尺的工作量。（真的，Sqft 和代码行一样有意义。）

适当地模块化并强制执行模块之间的逻辑封装和分离。您不希望对代码的任何一部分有太多依赖，否则该部分本来就更难理解。

考虑使用经过验证的真实方法而不是尖端方法。你为了可预测性放弃了一些功能。

最后，如果这是人们将在修改前后使用的代码，您需要（ed）有一个适当的 API 将您的代码与他们的代码隔离开。拥有强大的 API 可以让您在幕后进行更改，而无需提醒所有消费者。我认为有一篇关于 Coding Horror 的不错的文章。

# cocoa - 从可可/基础工具控制台读取输入？

> ID：869802
> 
> 赞同：2
> 
> 时间：2009-05-15T17:01:00.090
> 
> 标签：cocoa, console, foundation

我想知道 Objective-C/Foundation 是否有任何特殊的命令可以从控制台读取用户输入。因为它有 NSLog 用于输出，所以我可以使用其他东西来代替 scanf 命令。

我需要将一些数字（用户输入）读入我的工具。以 double 或 int 等类型获取这些输入的最佳方法是什么？以及如何让用户输入到 NSString 中？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-10-29T05:05:48.280

早些时候我很无聊，遇到了'use scanf'这个问题。因为我想看看我是否可以在不进入 c 的情况下做到这一点，所以出现了以下问题：

```
NSFileHandle *input = [NSFileHandle fileHandleWithStandardInput];
while (1)
{
    NSData* data = [input availableData];
    if(data != nil)
    {    
        NSString* aStr = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];
    }
 } 
```

我相信有人可以优化它并使它更好（这用于一个非常简单的 PoC CLI 工具）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-15T17:20:11.527

唯一真正的 Cocoa 对输入的支持是[NSFileHandle](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSFileHandle_Class/Reference/Reference.html#//apple_ref/occ/clm/NSFileHandle/fileHandleWithStandardInput)的`fileHandleWithStandardInput`。这并不比`scanf()`你问我更有用。但是对于特定类型的输入，嗯，这几乎是 NSFormatter 的*事情*。已经有很多用于标准事物的预定义格式化程序类型，如果您有更专业的需求，您可以制作自定义格式化程序。因此，如果您需要更多的东西`scanf()`，只需读入数据（作为字节`scanf()`或带有 NSFileHandle 的数据）并从中创建一个 NSString，您可以将其格式化为您心中的内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-15T17:22:22.770

没有什么像`scanf`（[这是一件好事](http://www.google.com/search?ie=utf-8&oe=utf-8&num=20&q=scanf+insecure)）。您可以使用[NSFileHandle](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSFileHandle_Class/)从标准输入中获取数据；对于交互式输入，`fgets`更好。然后，您需要使用`strtol`/ `strtoul`/ `strtod`、NSScanner 或 NSNumberFormatter 将输入转换为数字类型。

# asp.net - 在 DetailsView 上使用 Cancel 命令后会触发哪个事件？

> ID：869804
> 
> 赞同：0
> 
> 时间：2009-05-15T17:01:10.013
> 
> 标签：asp.net, page-lifecycle

在用户插入或取消 DetailsView 后，我需要执行一些检查（启用或禁用页面其他位置的标签）。我必须这样做，因为在此事件期间 DropDownList.SelectedIndexChanged 不会触发（我认为这很愚蠢，因为索引确实发生了变化）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T17:15:49.557

ModeChanging 应该触发，所以你可以这样做吗？

```
protected void DetailsView1_ModeChanging(object sender, DetailsViewModeEventArgs e)
{
    if (e.CancelingEdit)
    {
        //Checks
    }
} 
```

# jquery - JQUERY找到顶级父并在其中获取div，除了这个

> ID：869807
> 
> 赞同：1
> 
> 时间：2009-05-15T17:01:23.867
> 
> 标签：jquery, checkbox, parent

```
1）当我点击任何复选框时，
  a) 我想在同一个 div 中选择收音机
  b) 使用复选框取消选择其他收音机。

2）当我点击收音机时，
  a) 选中同一 div 中的所有复选框。
  b) 取消选中其他收音机

3）有没有办法让父母没有第一个父母div？

```

我怎样才能做到这一点？

```
<div class="topDiv">
    <div class="repeaterDiv"><input type="radio" id="rpt_01_rb" />
        <input type="checkbox" id="rpt_01_cb1" />
        <input type="checkbox" id="rpt_01_cb2" />
        <input type="checkbox" id="rpt_01_cb3" />
    </div>
    <div class="repeaterDiv"><input type="radio" id="rpt_02_rb" />
        <input type="checkbox" id="rpt_02_cb1" />
        <input type="checkbox" id="rpt_02_cb2" />
        <input type="checkbox" id="rpt_02_cb3" />
    </div>
    <div class="repeaterDiv"><input type="radio" id="rpt_03_rb" />
        <input type="checkbox" id="rpt_03_cb1" />
        <input type="checkbox" id="rpt_04_cb2" />
        <input type="checkbox" id="rpt_05_cb3" />
    </div>
</div> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T17:47:40.447

这应该比 DrJokepu 更有效：

```
$(function() {
    $('.repeaterDiv>:radio').bind('click',function() {
        $('.repeaterDiv>:checkbox').removeAttr('checked');
        $(this).siblings(':checkbox').attr('checked','checked');
    });

    $('.repeaterDiv>:checkbox').bind('click',function() {
        $('.repeaterDiv>:checkbox').removeAttr('checked');
        $(this).attr('checked','checked').siblings(':radio').attr('checked','checked');
    });
}); 
```

作为旁注，您应该确保单选按钮都具有相同的名称，以便符合标准...

如果有一些奇怪的原因导致您不能这样做，您可以将复选框绑定块的最后一行（尽管可能很难看）更改为：

```
$(this)
    .attr('checked','checked')
    .parent().siblings('.repeaterDiv').find(':radio')
    .removeAttr('checked');

    // I prefer to break the chain here but...
    // you could continue the above chain by doing: 
    // '.end().end().end().siblings(':radio').attr('checked','checked');'

$(this).siblings(':radio').attr('checked','checked'); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T18:10:49.113

```
// when a radio is clicked, unselect any checkboxes in other groups
$('div.topDiv input[type=radio]').click(function() {
    $('div.topDiv div.repeaterDiv').not($(this).parent(".repeaterDiv")).children("input[type=checkbox]").attr('checked', '');
});

// when a checkbox is checked, and it's radio isn't, "click" its radio
// which in turn unchecks other boxes using event defined above
$('div.topDiv input[type=checkbox]').click(function() {
    if (!$(this).siblings('input[type=radio]').attr('checked')) {
        $(this).siblings('input[type=radio]').trigger('click');
    }
}); 
```

这将取消选中任何其他单选选项检查组中的复选框。与其他人相同的通知 RE：需要通用名称的单选选项。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-15T17:29:36.997

确保所有单选按钮共享相同的名称：

```
<input type="radio" id="rpt_01_rb" name="rpt_rb" />
<input type="radio" id="rpt_02_rb" name="rpt_rb" />
// etc... 
```

然后尝试以下代码（我没有测试过）：

```
$('div.repeaterDiv>input[type=checkbox]').each(function(idx, item)
{
    $(item).click(function()
    {
        $(item).siblings('input[type=radio]:first').attr('checked', 'checked');
    });
});

$('div.repeaterDiv>input[type=radio]').each(function(idx, item)
{
    $(item).click(function()
    {
        $(item).siblings('input[type=checkbox]').attr('checked', 'checked');
    });
}); 
```

这里会发生什么？

第一部分循环遍历 div 中的复选框，并为每个复选框附加一个事件处理程序。此事件处理程序检查同一 div 中的单选按钮。

同样，第二部分循环遍历 div 中的单选按钮，附加一个事件处理程序，该处理程序检查同一 div 中的所有复选框。

如果您没有忘记确保单选按钮具有相同的名称，则取消选中其他单选按钮应该由浏览器自动完成。

# regex - 结合正则表达式？

> ID：869809
> 
> 赞同：68
> 
> 时间：2009-05-15T17:01:42.790
> 
> 标签：regex

在收集各种条件的用户输入后，例如

1.  以。。开始 ：`/(^@)/`
2.  以。。结束 ：`/(@$)/`
3.  包含：`/@/`
4.  不包含

为了在用户输入多个条件时制作单个正则表达式，我将它们与`"|"`所以如果 1 和 2 给定它变成`/(^@)|(@$)/`

这种方法到目前为止有效，但是，

我无法正确确定，第四个条件的正则表达式应该是什么？并以这种方式结合正则表达式有效吗？

* * *

> 更新：@（用户输入）对于两个条件不会相同，并且并非所有四个条件都始终存在，但它们可以存在，并且将来我可能需要更多条件，例如“完全是”和“完全不是”等。所以，我'我更想知道这种方法会扩展吗？
> 
> 也可能存在用户输入清理问题，因此正则表达式正确转义，但现在被忽略了。

* * *

## 回答 #1

> 赞同：127
> 
> 时间：2009-05-15T19:46:10.740

条件会被 ORed 或 ANDed 在一起吗？

```
开头：abc
结尾：xyz
包含：123
不包含：456
```

OR 版本相当简单；正如您所说，这主要是在各个条件之间插入管道的问题。正则表达式只是在其中一个替代项匹配时停止寻找匹配项。

```
/^abc|xyz$|123|^(?:(?!456).)*$/ 
```

第四种选择可能看起来很奇怪，但这就是您在正则表达式中表达“不包含”的方式。顺便说一句，替代品的顺序无关紧要。这实际上是相同的正则表达式：

```
/xyz$|^(?:(?!456).)*$|123|^abc/ 
```

AND 版本更复杂。在每个单独的正则表达式匹配后，必须将匹配位置重置为零，以便下一个正则表达式可以访问整个输入。这意味着所有条件都必须表示为先行（从技术上讲，其中一个不必是先行，我认为它以这种方式更清楚地表达了意图）。一场决赛结束`.*$`了比赛。

```
/^(?=^abc)(?=.*xyz$)(?=.*123)(?=^(?:(?!456).)*$).*$/ 
```

然后还有组合 AND 和 OR 条件的可能性——这就是真正有趣的地方。:D

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T17:06:13.900

不包含@: /(^[^@]*$)/

如果组合的预期结果是它们中的任何一个匹配导致整个正则表达式匹配，则组合有效。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-15T17:06:16.413

如果字符串不能包含`@`，则每个字符都必须是另一个字符`@`：

```
/^[^@]*$/ 
```

这将匹配任何长度但不包含`@`.

另一种可能的解决方案是反转 的布尔结果`/@/`。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-15T17:10:01.707

根据我使用正则表达式的经验，您确实需要关注您想要匹配的内容，而不是不匹配的内容。

例如

```
\d{2}

[1-9][0-9] 
```

第一个表达式将匹配任何 2 个数字....第二个表达式将匹配从 1 到 9 的 1 个数字和 1 个数字 - 任何数字。因此，如果您键入 07，第一个表达式将验证它，但第二个表达式不会。

请参阅此以获得高级参考：

[http://www.regular-expressions.info/refadv.html](http://www.regular-expressions.info/refadv.html)

编辑：

`^((?!my string).)*$`是不包含“我的字符串”的正则表达式。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-10-23T23:38:55.770

1 + 2 + 4 条件：开始|结束，但不在中间

```
/^@[^@]*@?$|^@?[^@]*@$/ 
```

几乎相同：

```
/^@?[^@]*@?$/ 
```

但是这个匹配任何没有@的字符串，示例'我的名字是 hal9000'

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-15T17:16:56.323

将第四个选项的正则表达式与其他任何选项组合在一个正则表达式中都不起作用。4 + 1 表示字符串以@ 开头或根本不包含@。你将需要两个单独的比较来做到这一点。

# cvs - Linux CVS 访问控制

> ID：869812
> 
> 赞同：1
> 
> 时间：2009-05-15T17:02:42.647
> 
> 标签：cvs, access-control

对托管在 Linux 服务器上的 CVS 存储库实施访问控制的最佳方法是什么？目标是防止开发人员意外删除模块。开发人员应该能够执行所有其他 CVS 活动。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T17:13:10.250

使用 SSH 访问：[howto cvs-ssh](http://forrest.apache.org/docs_0_70/howto/cvs-ssh/howto-cvs-ssh.html)，[其他howto](http://www.seul.org/sys/doc/dev-faq/ssh-cvs-FAQ.html)

看起来您还想给他们一个外壳？并访问 CVS 存储库文件系统？如果是，则没有必要。他们不需要访问 repo 文件系统来执行所有标准 CVS 活动。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T20:07:43.777

CVSACL 是 CVS 的补丁。它向 cvs 添加了两个新的子命令（acl 和 racl），用于访问控制列表管理。

[http://cvsacl.sourceforge.net/](http://cvsacl.sourceforge.net/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T17:16:34.500

罗山？不，但说真的，如果你阻止模块删除，仍然没有什么能阻止他们删除模块的内容，所以我不太明白这个问题。他们应该能够准确地做什么？

# apache-flex - FileReference.save() 重复 ByteArray

> ID：869816
> 
> 赞同：0
> 
> 时间：2009-05-15T17:03:14.017
> 
> 标签：apache-flex, flash, actionscript-3, flash-10

我在使用 FileReference.save() 时遇到了内存问题。我的 Flash 应用程序会实时生成大量数据，需要将这些数据保存到本地文件中。据我了解，Flash 10（相对于 AIR）不支持流式传输到文件。但是，更糟糕的是 FileReference.save() 在保存之前复制了所有数据。我一直在寻找这种双倍内存使用的解决方法，并考虑了以下方法：

如果我将 ByteArray 的自定义子类作为参数传递给 FileReference.save() 会怎样，这个 ByteArray 子类将覆盖所有 read*() 方法。重写的 read*() 方法将等待我的应用程序生成一段数据，返回这段数据并立即将其从内存中删除。我知道会生成多少数据，所以我也可以覆盖 length/bytesAvailable 方法。

这有没有可能？你能给我一些提示吗？我创建了一个 ByteArray 的子类，为它注册了一个别名，将此子类的一个实例传递给 FileReference.save()，但不知何故 FileReference.save() 似乎把它当作一个 ByteArray 实例来对待，而不是调用我的任何重写方法...

非常感谢您的帮助！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-16T14:11:01.240

这是一个有趣的想法。也许一开始您应该在扩展的 ByteArray 中添加跟踪，以查看 FileReference#save() 内部的功能。

如果它有某种

```
while( originalByteArray.bytesAvailable ) 
  writeToSaveBuffer( originalByteArray.readByte() ); 
```

覆盖的功能可以像你说的那样在每次读取时截断原始缓冲区，例如：

```
override function readByte() : uint {
  var b : uint = super.readByte();
  // Truncate the bytes (assuming bytesAvailable = length - removedBytes)
  length = length - bytesAvailable;
  return b;
} 
```

另一方面，如果这现在可行，我猜原始字节数组以后将不再在应用程序中可用。

（我自己没有测试过，截断可能需要比示例更多的工作）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T18:24:27.457

这不是我之前尝试过的东西，但是您可以尝试将数据发送到一个 php 应用程序，该应用程序将处理将 ByteArray 保存到服务器，就像将图像保存到服务器一样，那么您将使用 URLLoader.data 代替，使用这样的东西：

[http://www.zedia.net/2008/sending-bytearray-and-variables-to-server-side-script-at-the-same-time/](http://www.zedia.net/2008/sending-bytearray-and-variables-to-server-side-script-at-the-same-time/)

# visual-studio - 如何在 Visual Studio 2008 版本中打印 SET 命令？

> ID：869829
> 
> 赞同：0
> 
> 时间：2009-05-15T17:05:04.450
> 
> 标签：visual-studio, visual-studio-2008, variables, environment

我想在构建期间查看所有当前环境变量。如果可能，我想在构建前或构建后的步骤中执行此操作，因为我不想编辑 Targets 文件。这可以打印到输出窗口或文件。我尝试了许多不同的方法，但都没有成功。我正在使用 Visual Studio 2008。谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T17:11:33.593

如果您只是在 Post Build 事件中键入设置，它会在输出窗口中显示环境变量。

# javascript - Javascript 中的条件运算符

> ID：869832
> 
> 赞同：18
> 
> 时间：2009-05-15T17:05:25.900
> 
> 标签：javascript, operators, conditional-operator, conditional

可以使用像这样的语句这样的条件运算符吗？

```
(x == y) ? alert("yo!") : alert("meh!"); 
```

或者使用它来分配这样的值是否更正确？

```
z = (x == y) ? "yo!" : "meh!"; 
```

如果像语句一样使用它并没有错，那么是否可以像这样添加多行代码来执行？对多行代码使用 ifthen 和 switch 语句是否更正确？

```
(x == y) ? (alert("yo!"), document.write("woot!")) : (alert("meh!"), document.write("blah!")); 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-05-15T17:13:37.223

条件运算符有意简洁，对赋值特别有用：

```
var a = x ? 1 : 2; 
```

使用它们来有条件地运行函数，虽然可能，但为了便于阅读，应该使用 IF/ELSE 语句来完成：

```
// This is possible but IMO not best practice:
X ? doSomething() : doSomethingElse(); 
```

虽然冗长，但大多数时候，这是更好的解决方案：

```
if (X) {
    doSomething();
} else {
    doSomethingElse();
} 
```

IF/ELSE 结构的一个显着好处是，您可以在每种情况下轻松添加额外的任务。

您的最后一个片段也是可能的，但它看起来有些冗长，并且可能更适合更传统的逻辑结构；就像一个 IF/ELSE 块。

也就是说，条件运算符仍然是可读的，例如

```
(something && somethingElse > 2) ?
   doSomeLongFunctionName()
   : doSomeOtherLongFunctionName(); 
```

最后，像许多事情一样，这取决于个人喜好。永远记住，你编写的代码不只是为你而写的；其他开发人员将来可能不得不涉足它；尝试使其尽可能可读。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-15T17:09:27.527

JavaScript 不会阻止你这样做，但这是一种非常不寻常的做法，它会让任何阅读你代码的人感到困惑。

条件运算符几乎总是用于选择两个替代值，而不是语句。`if`语句优先用于语句的条件分支。

至于你的最后一个问题，是的，如果你真的必须，你可以滥用这个`[]`结构：

```
(x == y) ? [alert("yo!"), document.write("woot!")] : otherstuff(); 
```

但请不要。8-)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-15T17:10:11.223

这完全取决于你，你可以做任何一种方式。但是，您只需要问自己，这种风格是否符合公司准则，以及您希望此代码的可读性如何？

使用 if 语句更具可读性。

就个人而言，我只将三元运算符用于简单而快速的真/假条件——这样做是有意义的——或者我需要“内联”的东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-15T17:09:11.337

这两种方法中的任何一种都是可以接受的，尽管你也可以这样写：

```
alert((x == y) ? "yo!" : "meh!"); 
```

除此之外，我绝不建议对多行语句使用内联条件，只需使用标准 if/else 块。鉴于您输入的语法也不是有效的 JS，您可以将多个语句放入匿名方法和 yada yada 中，然后您会进入一个几乎无法管理和不必要的困难代码的混乱混乱。再说一次，标准 if/else。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-15T21:26:43.197

我同意 Chris 和 JP 的观点：

1.  条件运算符对于简短的语句很方便。JP 的变量赋值就是一个很好的例子：`var a = x ? 1 : 2;`
2.  为了便于阅读，多语句子句应分隔成单独的行。
3.  条件运算符可以作为具有正确缩进的多行语句可读，但`if/else`大多数开发人员更熟悉语法。可读性是关于匹配读者的期望，所以熟悉度很重要。

我将补充一点，多行条件运算符会让您容易遇到分号插入错误。查看[JSLint 文档](http://www.jslint.com/lint.html)（参见“换行”部分）了解更多信息。如果必须使用多行条件运算符，请确保运算符位于每行的末尾。因此，我将修改 JP 的多行示例：

```
(something && somethingElse > 2) ?
   doSomeLongFunctionName() :
   doSomeOtherLongFunctionName(); 
```

如前所述，那里有许多风格指南，您可以选择您喜欢的任何一种。然而，有些选择比其他选择更容易出错。一定要仔细看看[JSLint 文档](http://www.jslint.com/lint.html)；这是一个经过深思熟虑的风格指南，如果你坚持下去，你甚至可以使用 JSLint 工具自动检查你的代码是否存在潜在问题。

# wpf - Silverlight 特定图像向右移动

> ID：869852
> 
> 赞同：1
> 
> 时间：2009-05-15T17:10:30.803
> 
> 标签：wpf, silverlight

我正在生成一组图像以形成人体，以便我可以用于物理引擎。生成的图像位于特定的用户控件中，我在其中设置每个图像的尺寸和坐标。然后将该用户控件加载到另一个用户控件中，但是由于某种原因，当加载图像时，我命名为（rightBicep）的一个特定图像向右移动。这是一个屏幕截图：

[替代文字 http://img193.imageshack.us/img193/592/imageshift.jpg](http://img193.imageshack.us/img193/592/imageshift.jpg)

我用虚线说明了图像的位置，绿色虚线是指图像应该放置的位置，红色虚线是显示图像的位置。

奇怪的是它下面的图像（称为 rightForearm）取自它的 LeftPosition，并且在调试期间它们具有完全相同的 leftProperty 值。这是语法：

```
 public void generateRightBicep(string imageUrl)
        {
            rightBicep = new Image();            
            rightBicep.Name = CharacterName + "rightbicep";
            Uri imageUri = new Uri(imageUrl, UriKind.Relative);
            LayoutRoot.Children.Add(rightBicep);

            rightBicep.Source = new BitmapImage(imageUri);
            rightBicep.ImageOpened += new EventHandler<RoutedEventArgs>(bodyPart_ImageOpened);

        }

       public void rightBicepLoaded()
        {
            var bi = waitTillImageLoad(rightBicep.Name);
            rightBicep.Height = elbowToArmpit + (2 * palm);
            rightBicep.Width = ratio(bi.PixelHeight, bi.PixelHeight, rightBicep.Height); // to be determined

            Vector2 topVector;
            topVector.X = (float)(Convert.ToDouble(torso.GetValue(Canvas.LeftProperty)) - palm);
            topVector.Y = (float)(Convert.ToDouble(neck.GetValue(Canvas.TopProperty)) + neck.Height);

            if (!faceRight)
            {
                perspectiveVectorHeight(ref topVector, ref rightBicep, torso.Width);
                rightBicep.Width = ratio(bi.PixelHeight, bi.PixelHeight, rightBicep.Height);
            }

            rightBicep.SetValue(Canvas.LeftProperty, Convert.ToDouble(topVector.X));
            rightBicep.SetValue(Canvas.TopProperty, Convert.ToDouble(topVector.Y));
            rightBicep.SetValue(Canvas.ZIndexProperty, rightBicepZindex);
            generateRightShoulder();
        }

public void generateRightForearm(string imageUrl)
        {
            rightForearm = new Image();
            rightForearm.Name = CharacterName + "rightforearm";
            Uri imageUri = new Uri(imageUrl, UriKind.Relative);
            LayoutRoot.Children.Add(rightForearm);
            rightForearm.Source = new BitmapImage(imageUri);
            rightForearm.ImageOpened += new EventHandler<RoutedEventArgs>(bodyPart_ImageOpened);

        }

 public void rightForearmLoaded()
        {
            var bi = waitTillImageLoad(rightForearm.Name);
            rightForearm.Height = (elbowToHandTip - handLength) + palm;
            rightForearm.Width = ratio(bi.PixelHeight, bi.PixelWidth, rightForearm.Height);

            Vector2 topVector;
            if (faceRight)
            {
                topVector.X = (float)(Convert.ToDouble(rightBicep.GetValue(Canvas.LeftProperty)));
                topVector.Y = (float)(Convert.ToDouble(rightBicep.GetValue(Canvas.TopProperty)) + rightBicep.Height - palm);
            }
            else
            {
                topVector.X = (float)(Convert.ToDouble(leftBicep.GetValue(Canvas.LeftProperty)));
                topVector.Y = (float)(Convert.ToDouble(leftBicep.GetValue(Canvas.TopProperty)) + leftBicep.Height - palm);

                perspectiveVectorHeight(ref topVector, ref rightForearm, torso.Width);
                rightForearm.Width = ratio(bi.PixelHeight, bi.PixelWidth, rightForearm.Height);
            }

            rightForearm.SetValue(Canvas.LeftProperty, Convert.ToDouble(topVector.X));
            rightForearm.SetValue(Canvas.TopProperty, Convert.ToDouble(topVector.Y));
            rightForearm.SetValue(Canvas.ZIndexProperty, rightForearmZIndex);
            generateRightElbow();
        } 
```

现在我加在一起的所有值都是我预设的一组双精度值，属性 faceRight 用于判断人体是朝右还是朝左，以确定身体部位的位置（因为如果右手在当人体向另一方向转动时左侧）。

如果你注意到右前臂占据了右二头肌的左属性，那么从技术上讲，它应该直接显示在它下面而不是它。我还调试了用户控件，并且都具有 -3 的 left 属性。

PS。我调用方法`rightbicepLoaded`，并`rightforearmLoaded`在所有 imageOpened 事件都被触发时调用事件。

关于为什么会发生这种情况的任何想法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-16T07:39:21.057

找出原因，在我的方法比例中，它应该采用高度和宽度，然后我放了 2 个高度

# sql - 单元测试数据访问层 - 测试更新方法？

> ID：869854
> 
> 赞同：2
> 
> 时间：2009-05-15T17:11:21.563
> 
> 标签：sql, vb.net, unit-testing, stored-procedures, nunit

我正在考虑为我的数据访问层中的某些类添加一些单元测试，并且我正在查看一个没有返回值的更新例程。它只是根据您在您提供的任何列名称处提供的 id 更新一行。

在这个方法内部，我们收集参数并将它们传递给一个辅助例程，该例程调用存储过程来更新表。

在这种情况下如何进行单元测试有推荐的方法吗？我很难想到一个不依赖于其他方法的测试。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T17:26:07.193

首先测试从数据库中读取数据的方法。

然后你可以调用更新函数，并使用上面测试过的函数来验证更新的值是否正确。

我倾向于在我的单元测试中使用其他方法，只要我有测试也可以测试那些被调用的测试。

如果您的辅助函数在数据库中（存储过程或函数），那么只需先使用 DatabaseUnitTest 测试它们，然后测试 Visual Basic 代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T17:16:36.933

我只会使用查找方法来验证数据是否已正确更新。

是的，从技术上讲，这将依赖于正常工作的查找方法，但我认为您不一定必须避免这种依赖。只需确保也测试了查找方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T17:19:23.667

我将使用该方法获取该数据并检查您更新的返回值并断言预期值。这确实假设用于检索数据的方法已经过测试并且可以正常工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T18:46:49.573

我使用休眠和事务，对于单元测试，我不提交到数据库，但我刷新会话，如果需要，它会给出相同的错误，但不写入数据。

当然，如果您有一个构建服务器，您只需针对一个新制作的数据库运行单元测试，该数据库是在每次构建时新制作的。尝试使用基于文件的数据库，例如 firebird 之类的。

# django - 如何防止在 Django Admin 中对 FK / MTM 字段进行自我（递归）选择

> ID：869856
> 
> 赞同：13
> 
> 时间：2009-05-15T17:12:00.797
> 
> 标签：django, django-models, django-admin, foreign-keys, many-to-many

给定具有 ForeignKeyField (FKF) 或 ManyToManyField (MTMF) 字段的模型，其外键为“自我”，我如何防止在 Django Admin (admin) 中进行*自我*（递归）选择。

简而言之，应该可以*防止*在管理员中自我（递归）选择模型实例。这适用于编辑模型的现有实例，而不是创建新实例。

例如，新闻应用中的文章采用以下模型；

```
class Article(models.Model):           
    title = models.CharField(max_length=100)
    slug = models.SlugField()
    related_articles = models.ManyToManyField('self') 
```

如果有 3 个实例（标题：a1-3），当通过管理员`Article`编辑现有实例时，该字段默认由一个 html（多个）选择框表示，该框提供所有文章的列表 ( )。用户应该只看到并能够选择除自身以外的实例，例如在编辑a1 时，可用于选择 = a2、a3。`Article``related_articles``Article.objects.all()``Article``Article``related_articles`

我目前可以看到 3 种可能的方法来做到这一点，按偏好递减的顺序排列；

1.  提供一种方法来设置查询集，在管理表单字段中提供可用选项`related_articles`（通过排除查询过滤器，例如`Article.objects.filter(~Q(id__iexact=self.id))`，从用户可以查看和选择的相关文章列表中排除正在编辑的当前实例。创建/设置要使用的查询集可以在`__init__`自定义的构造函数 () 中发生`Article ModelForm`，或者通过某种动态`limit_choices_to Model`选项发生。这需要一种方法来获取正在编辑的实例以用于过滤。
2.  覆盖or类的`save_model`函数以在保存实例之前检查并从中删除自身。这仍然意味着管理员用户可以查看和选择所有文章，包括正在编辑的实例（对于现有文章）。`Article Model``ModelAdmin``related_articles`
3.  当需要在管理员之外使用时过滤掉自我引用，例如模板。

理想的解决方案 (1) 目前可以通过管理员外部的自定义模型表单来完成，因为可以将正在编辑的实例的过滤查询集变量传递给模型表单构造函数。问题是，您能否获得`Article`实例，即在创建表单之前正在编辑“自我”以执行相同的操作。

可能是我以错误的方式解决这个问题，但是如果您允许将 FKF / MTMF 定义为同一模型，那么应该有一种方法让管理员 -*做正确的事情*- 并阻止用户通过以下方式选择自己在可用选项列表中排除它。

**注意：**现在可以执行解决方案 2 和 3，并提供解决方案以尝试避免将这些作为答案，理想情况下，我希望得到解决方案 1 的答案。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-12-08T21:18:57.257

卡尔是正确的，这是一个剪切和粘贴代码示例`admin.py`

我发现如果你没有扎实的掌握，导航 Django 关系可能会很棘手，一个活生生的例子可能比“去读这个”更有价值 1000 倍（并不是说你不需要了解正在发生的事情） .

```
class MyForm(forms.ModelForm):
    class Meta:
        model = MyModel

    def __init__(self, *args, **kwargs):
        super(MyForm, self).__init__(*args, **kwargs)
        self.fields['myManyToManyField'].queryset = MyModel.objects.exclude(
            id__exact=self.instance.id) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-16T16:23:07.037

您可以在管理员中使用自定义 ModelForm（通过设置[ModelAdmin 子类的“form”属性](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#django.contrib.admin.ModelAdmin.form)）。因此，您在管理员中的操作方式与在其他任何地方相同。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-09-28T15:45:01.093

您还可以`get_form`像这样覆盖 ModelAdmin 的方法：

```
def get_form(self, request, obj=None, **kwargs):
    """
    Modify the fields in the form that are self-referential by
    removing self instance from queryset
    """
    form = super().get_form(request, obj=None, **kwargs)
    # obj won't exist yet for create page
    if obj:
        # Finds fieldnames of related fields whose model is self
        rmself_fields = [f.name for f in self.model._meta.get_fields() if (
            f.concrete and f.is_relation and f.related_model is self.model)]
        for fieldname in rmself_fields:
            form.base_fields[fieldname]._queryset =
                form.base_fields[fieldname]._queryset.exclude(id=obj.id)
    return form 
```

请注意，这是一个万能的解决方案，它会自动查找自引用模型字段并从所有这些字段中删除 self :-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-04-19T07:36:59.240

我喜欢定时检查的解决方案`save()`：

```
 def save(self, *args, **kwargs):
        # call full_clean() that in turn will call clean()
        self.full_clean()
        return super().save(*args, **kwargs)

    def clean(self):
        obj = self
        parents = set()
        while obj is not None:
            if obj in parents:
                raise ValidationError('Loop error', code='infinite_loop')
            parents.add(obj)
            obj = obj.parent 
```

# iphone - 在 iPhone 上播放期间更改音频的音高

> ID：869859
> 
> 赞同：2
> 
> 时间：2009-05-15T17:12:13.747
> 
> 标签：iphone, audio, core-audio

实现这一目标的最佳方法是什么？

从我目前阅读的内容来看，您似乎必须设置 IO Remote（这本身就是一种痛苦）。你需要做一个FFT吗？有没有例子？

我可以加快/减慢播放速度吗？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-07-06T19:12:41.507

OpenAL 允许您使用 AL_PITCH 源属性进行音高转换。也许您可以通过 OpenAL 运行您的音频并使用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-25T22:26:26.280

I've never developed for an iPhone, but if you have sufficient control over the buffer sent to the audiodevice, then you could do the following:

say you have a buffer read from an audiofile, if you send only every even sample to the audiodevice (probably put in some other buffer which is passed to some function), then it will double the frequency and half the time to play the file.

If you want something in between you need to compute in between samples or [resample](http://ccrma.stanford.edu/~jos/resample/) the audiofile = interpolate values between successive samples.

# asp.net-mvc - 您可以将 ASP.NET MVC UpdateModel() 与包含列表的复杂模型对象一起使用吗 ?

> ID：869864
> 
> 赞同：2
> 
> 时间：2009-05-15T17:13:26.740
> 
> 标签：asp.net-mvc, model

我已经看到文章和博客文章表明我正在尝试做的事情应该得到支持；但是，我一直无法让它工作，所以希望有人可以确认它确实/不起作用和/或告诉我我做错了什么。

我有一个“复杂”模型（包含 InvoiceItem 列表的发票），我试​​图绑定到该模型，我只想更新列表对象上的某些属性和某些项目/索引）。我相信我的问题主要在于包含/排除是否适用于列表数据。我正在尝试将 UpdateModel() 与它的 includeProperties 一起使用，如下所示：

```
Public Function Edit(ByVal id As String, ByVal values As FormCollection)
    Dim invoice As Invoice = _getInvoice(id)
    UpdateModel(invoice, "", New String() {"InvoiceDate", "CustomerName", "Items[0].Price"})        
    'Do some stuff...
End Function 
```

我所有的代码都在下面......

我有以下模型：

```
Public Class Invoice
    Private _invoiceNumber As String
    Private _invoiceDate As DateTime
    Private _customerName As String
    Private _items As List(Of InvoiceItem)
    Public Property InvoiceNumber() As String
        Get
            Return _invoiceNumber
        End Get
        Set(ByVal value As String)
            _invoiceNumber = value
        End Set
    End Property
    Public Property InvoiceDate() As DateTime
        Get
            Return _invoiceDate
        End Get
        Set(ByVal value As DateTime)
            _invoiceDate = value
        End Set
    End Property
    Public Property CustomerName() As String
        Get
            Return _customerName
        End Get
        Set(ByVal value As String)
            _customerName = value
        End Set
    End Property
    Public Property Items() As List(Of InvoiceItem)
        Get
            Return _items
        End Get
        Set(ByVal value As List(Of InvoiceItem))
            _items = value
        End Set
    End Property
End Class

Public Class InvoiceItem
    Private _itemNumber As Integer
    Private _description As String
    Private _price As Decimal
    Public Property ItemNumber() As Integer
        Get
            Return _itemNumber
        End Get
        Set(ByVal value As Integer)
            _itemNumber = value
        End Set
    End Property
    Public Property Description() As String
        Get
            Return _description
        End Get
        Set(ByVal value As String)
            _description = value
        End Set
    End Property
    Public Property Price() As Decimal
        Get
            Return _price
        End Get
        Set(ByVal value As Decimal)
            _price = value
        End Set
    End Property
End Class 
```

我有以下观点：

```
<%@ Page Title="" Language="VB" MasterPageFile="~/Views/Shared/Site.Master" 
    Inherits="System.Web.Mvc.ViewPage(Of MvcApplication2.Invoice)" %>

<asp:Content ID="Content1" ContentPlaceHolderID="head" runat="server">
    <title>Edit</title>
</asp:Content>

<asp:Content ID="Content2" ContentPlaceHolderID="MainContent" runat="server">

    <h2>Edit</h2>

    <%=Html.ValidationSummary()%>

    <% Using Html.BeginForm() %>

        <fieldset>
            <legend>Fields</legend>
            <p>
                <label for="InvoiceNumber">InvoiceNumber:</label>
                <%= Html.TextBox("InvoiceNumber") %>
                <%= Html.ValidationMessage("InvoiceNumber", "*") %>
            </p>
            <p>
                <label for="InvoiceDate">InvoiceDate:</label>
                <%= Html.TextBox("InvoiceDate") %>
                <%= Html.ValidationMessage("InvoiceDate", "*") %>
            </p>
            <p>
                <label for="CustomerName">CustomerName:</label>
                <%= Html.TextBox("CustomerName") %>
                <%= Html.ValidationMessage("CustomerName", "*") %>
            </p>
            <%For x As Integer = 0 To ViewData.Model.Items.Count - 1%>       
            <p>    
                <label for="Item<%=ViewData.Model.Items(x).ItemNumber %>">Item <%=ViewData.Model.Items(x).ItemNumber%>:</label>
                <%=Html.Hidden("Items.Index", x)%>
                <%=Html.TextBox(String.Format("Items[{0}].Description", x), ViewData.Model.Items(x).Description)%>
                <%=Html.ValidationMessage("Description", "*")%>
                <%=Html.TextBox(String.Format("Items[{0}].Price", x), ViewData.Model.Items(x).Price)%>
                <%=Html.ValidationMessage("Price", "*")%>
            </p>
            <%Next x%>
            <p>
                <input type="submit" value="Save" />
            </p>
        </fieldset>

    <% End Using %>

</asp:Content> 
```

这是我的控制器：

```
Public Class InvoicingController
    Inherits System.Web.Mvc.Controller

    Private Function _getInvoice(ByVal id As String) As Invoice
        Dim invoice As New Invoice
        invoice.InvoiceNumber = id
        invoice.CustomerName = "John Doe"
        invoice.InvoiceDate = DateTime.Now
        invoice.Items = New List(Of InvoiceItem)
        For x As Integer = 1 To 5
            Dim item As InvoiceItem = New InvoiceItem
            item.ItemNumber = x
            item.Description = String.Format("Item {0}", x)
            item.Price = 100 + x
            invoice.Items.Add(item)
        Next
        Return invoice
    End Function

    <AcceptVerbs(HttpVerbs.Post)> _
    Function Edit(ByVal id As String) As ActionResult
        Dim invoice As Invoice = _getInvoice(id)
        Return View(invoice)
    End Function

        'UpdateModel(invoice, "", New String() {"InvoiceDate", "CustomerName", "Items"}) 'NOTE: THis line appears to update any InvoiceItem attributes that are supplied
        UpdateModel(invoice, "", New String() {"InvoiceDate", "CustomerName", "Items[0].Price"}) 'This line does not allow the first item's Price to be updated.

        Return View()

    End Function

End Class 
```

提前致谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-09-23T12:59:33.820

在您的表单视图模型中，不要为您不希望 MVC 绑定/更新的字段声明属性。

MVC 绑定器仅将属性与 getter/setter 绑定。只需将“只读”属性声明为简单字段。

您也可以尝试在这些字段上添加 [BindNever] 属性。

# java - 为什么我的套接字只能通信客户端到服务器而不是服务器到客户端？

> ID：869865
> 
> 赞同：0
> 
> 时间：2009-05-15T17:13:31.777
> 
> 标签：java, networking, sockets, dispatcher

我编写了一个简单的 Java 调度程序，它带有一个守护线程来处理传入的流量，并使用另一个线程来发送命令。

当服务器接收到第一条消息时，问题就出现了，然后客户端/服务器系统卡在服务器试图向客户端发送响应的位置。当服务器发送数据时，两端的套接字只是简单地冻结。

我已将原始问题简化为回显服务器和客户端；我想我在代码上一定有一个非常愚蠢的错误。我机器上的代码和结果复制如下。谁能解释出了什么问题？

谢谢！

这是结果，我们可以看到服务器和客户端在收到第一条消息后就卡住了。

```
Echo Server listening port...
Echo Server: Waiting from client connection.
Connecting to the server.
Connected to the server.
Dispatcher send: 10
Dispatcher send: 11
Dispatcher send: 12
Dispatcher send: 13
Dispatcher read...
Dispatcher read...
Dispatcher readed 10 
```

### 代码：

**回声测试：**

```
import java.io.*;
import java.net.*;

public class EchoTest {
  public static void main(String[] args) {
    EchoServer.listen();
    EchoClient client = new EchoClient();
    EchoServer server = EchoServer.accept();
  }
} 
```

**客户端和服务器：**

```
class EchoClient implements Runnable {
  private static final int PORT = 13244;

  Socket socket;
  Disp disp;
  Thread client;

  public EchoClient() {
    client = new Thread(this);
    client.start();
  }

  public void run() {
    try {
      System.out.println("Connecting to the server.");
      Socket socket = new Socket("localhost", PORT);
      System.out.println("Connected to the server.");
      disp = new Disp(socket);

      disp.send(10);
      disp.send(11);
      disp.send(12);
      disp.send(13);

    } catch(IOException e) {
      System.out.println("Would not connect to local host: " + PORT);
      System.exit(-1);
    }
  }

  public void send(int m) {
    disp.send(m);
    System.out.println("Sent message " + m);

    int echo = disp.getMsg();

    if(m == echo) {
      System.out.println("Message " + m + "sent and received.");
    } else {
      System.out.println("Message " + m + "cannot be echoed correctly.");
    }
  }
}

class EchoServer implements Runnable{
  private static final int PORT = 13244;
  private static ServerSocket serverSocket;

  Disp disp;

  public EchoServer(Socket s) {
    disp = new Disp(s);
  }

  public static void listen() {
    System.out.println("Echo Server listening port...");

    try {
      serverSocket = new ServerSocket(PORT);
    } catch (IOException e) {
      System.out.println("Could not listen on port: " + PORT);
      System.exit(-1);
    }
  }

  public static EchoServer accept(){
    try {
      System.out.println("Echo Server: Waiting from client connection.");
      return new EchoServer(serverSocket.accept());
    } catch(IOException e) {
      System.out.println("Couldn't accept connection from client.");
      System.exit(-1);
    }

    return null;
  }

  public void run() {
    while(true) {
      int m = disp.getMsg();
      disp.send(m);
    }
  }
} 
```

**显示：**

```
class Disp implements Runnable{
  int msg = -1;
  Socket socket;
  BufferedInputStream input;
  DataInputStream dis;
  BufferedOutputStream output;
  DataOutputStream dos;
  Thread daemon;

  public Disp(Socket s) {
    this.socket = s;

    try{
      input = new BufferedInputStream(socket.getInputStream());
      dis = new DataInputStream(input);

      output = new BufferedOutputStream(socket.getOutputStream());
      dos = new DataOutputStream(output);
    }catch(IOException e) {
    }
    daemon = new Thread(this);
    daemon.start();
  }

  public void run() {
    while(true) {
      int m = get();
      setMsg(m);
    }
  }

  public void send(int m) {
    synchronized(dos) {
      try{
        System.out.println("Dispatcher send: " + m);
        dos.writeInt(m);
        dos.flush();
      } catch(IOException e) {
      }
    }
  }

  public int get() {
    System.out.println("Dispatcher read...");
    synchronized(dis) {
      try{
        int m = dis.readInt();
        System.out.println("Dispatcher readed " + m);
        return m;
      } catch(IOException e) {
      }
    }

    return -1;
  }

  synchronized public void setMsg(int m) {
    while(true) {
      if(msg == -1) {
        try {
          wait();
        } catch(InterruptedException e) {
        } 
      } else {
        msg = m;
        notifyAll();
      }
    }
  }

  synchronized public int getMsg() {
    while(true) {
      if(msg != -1) {
        try {
          wait();
        } catch(InterruptedException e) {
        } 
      } else {
        notifyAll();
        return msg;
      }
    }
  }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T17:22:18.497

那是非常多的代码。首先，我建议削减它。

其次，你似乎从不打电话`EchoServer.run`，但很难看到。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-17T12:03:00.480

您还应该设置 TCP_NODELAY 标志，因为您只发送几个字节。操作系统通常会在发送包之前等待更多数据（并且您的 flush() 对该行为没有影响，因为 flush 仅处理 java 的缓冲区）。

# tsql - T-SQL 中对变量的类数组访问

> ID：869871
> 
> 赞同：11
> 
> 时间：2009-05-15T17:14:17.593
> 
> 标签：tsql

在我的存储过程中，我有多个类似的变量`@V1`，`@V2`... `@V20`（假设其中 20 个）从记录中提取。我将如何使用动态 SQL 使用这些变量作为参数对另一个存储过程进行 20 次调用？

当然`@V[i]`语法不正确，但它表达了意图

```
 fetch next from maincursor into @status, @V1, @V2, ...

    while @i<21
    begin
       -- ??? execute sp_executesql 'SecondSP', '@myParam int', @myParam=@V[i]
       -- or 
       -- ??? execute SecondSP @V[i]
       set @i = @i+1
    end 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-15T18:26:41.460

正如其他人所说，设置一个临时表，将您需要的值插入其中。然后“迭代”通过它从这些值执行必要的 SQL。这将允许您执行 0 到 MANY 值，因此您不必为每个值设置一个变量。

以下是一个完整的示例，说明如何在没有游标的情况下执行此操作。

```
SET NOCOUNT ON

DECLARE @dict TABLE (
                    id          INT IDENTITY(1,1), -- a unique identity column for reference later
                    value       VARCHAR(50),       -- your parameter value to be passed into the procedure
                    executed    BIT                -- BIT to mark a record as being executed later
                    )

-- INSERT YOUR VALUES INTO @dict HERE
-- Set executed to 0 (so that the execution process will pick it up later)
-- This may be a SELECT statement into another table in your database to load the values into @dict
INSERT @dict
SELECT 'V1Value', 0 UNION ALL
SELECT 'V2Value', 0

DECLARE @currentid INT
DECLARE @currentvalue VARCHAR(50)
WHILE EXISTS(SELECT * FROM @dict WHERE executed = 0)
BEGIN
    -- Get the next record to execute
    SELECT 
    TOP 1   @currentid = id 
    FROM    @dict 
    WHERE   executed = 0

    -- Get the parameter value
    SELECT  @currentvalue = value
    FROM    @dict
    WHERE   id = @currentid

    -- EXECUTE THE SQL HERE
    --sp_executesql 'SecondSP', '@myParam int', @myParam = 
    PRINT   'SecondSP ' +  '@myParam int ' + '@myParam = ' + @currentvalue

    -- Mark record as having been executed
    UPDATE  d
    SET     executed = 1
    FROM    @dict d
    WHERE   id = @currentid
END 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T17:38:53.510

使用#TempTable

如果您使用的是 SQL Server 2005，则可以在父存储过程中创建 #TempTable，并且它在它调用的子存储过程中可用。

```
CREATE TABLE #TempTable
(col1  datatype
,col2  datatype
,col3  datatype
)

INSERT INTO #TempTable
    (col1, col2, col3)
    SELECT 
        col1, col2, col3
        FROM ...

EXEC @ReturnCode=YourOtherProcedure 
```

在另一个过程中，您可以访问#TempTable 来选择、删除等...使该子过程处理一组数据，而不是一次处理一个元素

请记住，在 SQL 中，循环会消耗性能！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T17:22:45.373

为什么不直接使用 table 变量，然后遍历 table 获取每个值。

基本上将表格中的每一行视为数组单元格，表格包含一列。

只是一个想法。:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T17:36:27.743

这似乎是一个奇怪的要求——你总是有一组固定的变量吗？如果数字从 20 变为 21 等等，您是否必须经常声明新变量？

是否有可能，而不是将值检索到单独的变量中，而是将它们作为单独的行返回并在游标中循环它们？

如果没有，您必须按照说明使用各个变量，这是一种解决方案：

```
declare @V1 nvarchar(100)
set @V1 = 'hi'
declare @V2 nvarchar(100)
set @V2 = 'bye'
declare @V3 nvarchar(100)
set @V3 = 'test3'
declare @V4 nvarchar(100)
set @V4 = 'test4'
declare @V5 nvarchar(100)
set @V5 = 'end'

declare aCursor cursor for
select @V1 
union select @V2 union select @V3
union select @V4 union select @V5

open aCursor

declare @V nvarchar(100)
fetch next from aCursor into @V
while @@FETCH_STATUS = 0
begin
    exec TestParam @V

    fetch next from aCursor into @V

end

close aCursor
deallocate aCursor 
```

我不太喜欢这个解决方案，它看起来很混乱且无法扩展。此外，作为旁注 - 您提出问题的方式似乎是询问 T-SQL 中是否存在数组。默认情况下没有，尽管如果您绝对需要它们，在谷歌上快速搜索可以为您指明解决方法的方向。

# ruby-on-rails - Rails/ActiveRecord：保存对模型关联集合的更改

> ID：869873
> 
> 赞同：7
> 
> 时间：2009-05-15T17:15:25.783
> 
> 标签：ruby-on-rails, ruby, activerecord

我是否必须保存对模型集合中单个项目的修改，或者在保存模型时是否可以调用方法来保存它们。

`#save`似乎没有这样做。例如：

```
irb> rental = #...
#=> #<Rental id: 18737, customer_id: 61, dvd_id: 3252, date_rented: "2008-12-16 05:00:00", date_shipped: "2008-12-16 05:00:00", date_returned: "2008-12-22 05:00:00">
irb> rental.dvd
#=> #<Dvd id: 3252, title: "The Women of Summer", year: 1986, copies: 20, is_new: false, is_discontinued: false, list_price: #<BigDecimal:1a48f0c,'0.1599E2',8(8)>, sale_price: #<BigDecimal:1a48ed0,'0.1599E2',8(8)>>
irb> rental.dvd.copies += 1
#=> 21
irb> rental.save
#=> true
irb> rental.dvd
#=> #<Dvd id: 3252, title: "The Women of Summer", year: 1986, copies: 21, is_new: false, is_discontinued: false, list_price: #<BigDecimal:1a2e9cc,'0.1599E2',8(8)>, sale_price: #<BigDecimal:1a2e97c,'0.1599E2',8(8)>>
irb> Dvd.find_by_title('The Women of Summer')
#=> #<Dvd id: 3252, title: "The Women of Summer", year: 1986, copies: 20, is_new: false, is_discontinued: false, list_price: #<BigDecimal:1a30164,'0.1599E2',8(8)>, sale_price: #<BigDecimal:1a30128,'0.1599E2',8(8)>> 
```

在上面的示例中，租用的 DVD 副本似乎没有更新 DB 中的副本（请注意副本数量不同）。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2012-04-25T03:31:09.750

`:autosave => true`通过在声明关联时添加选项，您可以将 ActiveRecord 配置为级联保存对模型集合中项目的更改。[阅读更多](http://api.rubyonrails.org/classes/ActiveRecord/AutosaveAssociation.html)。

例子：

```
class Payment < ActiveRecord::Base
    belongs_to :cash_order, :autosave => true
    ...
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T17:41:24.083

> 你必须自己做

这并不完全正确。您可以使用强制保存的“构建”方法。为了举例，假设您有一个公司模型和员工（公司有_很多员工）。您可以执行以下操作：

```
acme = Company.new({:name => "Acme, Inc"})
acme.employees.build({:first_name => "John"})
acme.employees.build({:first_name => "Mary"})
acme.employees.build({:first_name => "Sue"})
acme.save 
```

将创建所有 4 条记录，Company 记录和 3 条 Employee 记录，并且 company_id 将被适当地推送到 Employee 对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-15T19:00:35.327

增加值后只需执行rental.dvd.save，或者在上述情况下，您可以使用

```
rental.dvd.increment!(:copies) 
```

这也将自动保存，请注意“！” 增量！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T17:37:45.603

你必须自己做。 [Active Record 在初始保存后不会级联 has_many 关系中的保存操作。](http://javathehutt.blogspot.com/2006/05/rails-realities-part-12-active-record.html)

您可以通过`before_save`回调自动执行该过程。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-07-06T17:30:48.667

这篇文章很有用： [http ://erikonrails.snowedin.net/?p=267](http://erikonrails.snowedin.net/?p=267)

Erik describe how to use "accepts_nested_attributes_for" in the model and <% f.fields_for %> in the view to do the job.

Its detailed description can be found in: [http://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html](http://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html)

# c++ - 为什么 strncpy 不安全？

> ID：869883
> 
> 赞同：71
> 
> 时间：2009-05-15T17:16:42.003
> 
> 标签：c++, c, string, strncpy

我正在寻找为什么 strncpy 被认为是不安全的。是否有人对此有任何类型的文档或使用它的利用示例？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-05-15T17:20:06.660

看看[这个网站](https://devblogs.microsoft.com/oldnewthing/20050107-00/?p=36773)；这是一个相当详细的解释。基本上，`strncpy()`不需要 NUL 终止，因此容易受到各种攻击。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2012-06-01T07:12:07.457

最初的问题显然是[strcpy(3)](https://msdn.microsoft.com/en-us/library/kk6xf663.aspx)不是[内存安全操作](http://en.wikipedia.org/wiki/Memory_safety)，因此攻击者可以提供比缓冲区更长的字符串，这会覆盖堆栈上的代码，如果精心安排，可以执行攻击者的任意代码。

但是[strncpy(3)](https://msdn.microsoft.com/en-us/library/xdsywd25.aspx)的另一个问题是它不会在目的地的每种情况下都提供空终止。（想象一个源字符串比目标缓冲区长。）未来的操作可能期望在相同大小的缓冲区之间符合 C 以 nul 结尾的字符串，并且当结果被复制到第三个缓冲区时下游会发生故障。

使用 strncpy(3) 比 strcpy(3) 更好，但像 strlcpy(3) 这样的东西更好。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-10-22T17:29:22.117

为了安全地使用 strncpy，必须 (1) 手动将空字符粘贴到结果缓冲区，(2) 事先知道缓冲区以空结尾，并将 (length-1) 传递给 strncpy，或者 (3) 知道永远不会使用任何不会将其长度绑定到缓冲区长度的方法来复制缓冲区。

重要的是要注意 strncpy 会将缓冲区中复制的字符串之后的所有内容填零，而其他长度受限的 strcpy 变体不会。这在某些情况下可能会消耗性能，但在其他情况下会带来安全优势。例如，如果使用 strlcpy 将“supercalifragilisticexpalidocious”复制到缓冲区，然后复制“it”，则缓冲区将保存“it^ercalifragilisticexpalidocious^”（使用“^”表示零字节）。如果缓冲区被复制为固定大小的格式，额外的数据可能会随之标记。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-09-10T14:50:35.120

该问题基于“加载”的前提，这使得问题本身无效。

这里的底线`strncpy`是不被认为是不安全的，也从未被认为是不安全的。可以附加到该函数的唯一“不安全”声明是 C 内存模型和 C 语言本身的普遍不安全的广泛声明。（但这显然是一个完全不同的话题）。

在 C 语言领域内，对某种固有的“不安全性”的误导性信念`strncpy`源自于广泛使用`strncpy`的“安全字符串复制”的可疑模式，即此功能不做且从未打算用于的事情。这种用法确实很容易出错。但即使你在“高度容易出错”和“不安全”之间加上一个等号，它仍然是一个使用问题（即缺乏教育问题）而不是`strncpy`问题。

基本上，可以说唯一的问题`strncpy`是一个不幸的命名，这使得新手程序员假设他们理解这个函数的作用，而不是实际阅读规范。查看函数名称，一个不称职的程序员会认为它`strncpy`是 的“安全版本” `strcpy`，而实际上这两个函数完全不相关。

例如，可以针对除法运算符提出完全相同的主张。正如你们大多数人所知，关于 C 语言的最常见问题之一是“我认为它`1/2`会计算结果，`0.5`但我得到了`0`。为什么？” 然而，我们不会仅仅因为语言初学者倾向于误解它的行为就声称除法运算符是不安全的。

再举一个例子，我们之所以称伪随机数生成器函数为“不安全”，只是因为不称职的程序员常常对他们的输出并非真正随机这一事实感到不快。

这正是它的`strncpy`功能。就像初学者程序员需要时间来了解伪随机数生成器的实际作用一样，他们也需要时间来了解`strncpy`实际作用。学习这`strncpy`是一个*转换*函数需要时间，用于将*零结尾的*字符串转换为*固定宽度的*字符串。学习`strncpy`与“安全字符串复制”完全无关并且不能有意义地用于该目的需要时间。

`strncpy`诚然，语言学生学习目的通常比使用除法运算符解决问题要花更长的时间。但是，这是针对`strncpy`.

PS 在接受的答案中链接的 CERT 文档专门用于：展示典型的无能滥用`strncpy`功能作为“安全”版本的不安全性`strcpy`。它绝不是要声称`strncpy`自己在某种程度上是不安全的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-08-19T17:05:03.927

Git 2.19（Q3 2018）的一个pathc发现太容易误用系统API函数如`strcat()`；`strncpy()`; ...并禁止此代码库中的这些功能。

请参阅[Jeff King ( ) 的](https://github.com/peff)[提交 e488b7a](https://github.com/git/git/commit/e488b7aba743d23b830d239dcc33d9ca0745a9ad)、[提交 cc8fdae](https://github.com/git/git/commit/cc8fdaee1eeaf05d8dd55ff11f111b815f673c58)、[提交 1b11b64](https://github.com/git/git/commit/1b11b64b815db62f93a04242e4aed5687a448748)（2018 年 7 月 24 日）和[提交 c8af66a](https://github.com/git/git/commit/c8af66ab8ad7cd78557f0f9f5ef6a52fd46ee6dd)（2018 年 7 月 26 日[）](https://github.com/peff)。^(（由)^([Junio C Hamano 合并 --](https://github.com/gitster)) ^([--](https://github.com/gitster))^在^([提交 e28daf2](https://github.com/git/git/commit/e28daf222f51f137d9038a58812f2a89f414781e))^(中，2018 年 8 月 15 日）)[`peff`](https://github.com/peff)
^([`gitster`](https://github.com/gitster))

> ## `banned.h`: 标记`strcat()`为禁止
> 
> 该`strcat()`函数具有与`strcpy()`.
> 作为奖励，很容易意外地以二次方告终，因为每个后续调用都必须遍历现有字符串。
> 
> 最后一次`strcat()`调用在[f063d38](https://github.com/git/git/commit/f063d38b808e184675e5b0931ea0167a013b3fcb)中消失（守护进程：重生时使用 cld->env_array，2015-09-24，Git 2.7.0）。
> 通常，`strcat()`可以用动态字符串（`strbuf`或`xstrfmt`）替换，或者`xsnprintf`如果您知道长度是有界的，则可以替换为。

# python - 使用Python中的索引向后循环？

> ID：869885
> 
> 赞同：351
> 
> 时间：2009-05-15T17:17:06.450
> 
> 标签：python, loops

我正在尝试从 100 循环到 0。如何在 Python 中执行此操作？

`for i in range (100,0)`不起作用。

* * *

## 回答 #1

> 赞同：498
> 
> 时间：2009-05-15T17:20:46.503

Try `range(100,-1,-1)`，第三个参数是要使用的增量（[在此处](https://docs.python.org/library/functions.html#range)记录）。

[（此处](https://docs.python.org/3/library/stdtypes.html?highlight=range#range)记录了“范围”选项、开始、停止、步骤）

* * *

## 回答 #2

> 赞同：226
> 
> 时间：2009-05-15T17:24:09.317

在我看来，这是最易读的：

```
for i in reversed(xrange(101)):
    print i, 
```

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2009-05-15T17:21:39.700

```
for i in range(100, -1, -1) 
```

和一些稍长（和更慢）的解决方案：

```
for i in reversed(range(101))

for i in range(101)[::-1] 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-11-17T17:26:02.493

一般在 Python 中，可以使用负索引从后面开始：

```
numbers = [10, 20, 30, 40, 50]
for i in xrange(len(numbers)):
    print numbers[-i - 1] 
```

结果：

```
50
40
30
20
10 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2017-02-12T15:54:04.350

**为什么你的代码不起作用**

你的代码`for i in range (100, 0)`很好，*除了*

第三个参数（`step`）是默认的`+1`。因此，您必须为 range() 指定第三个参数才能`-1`后退。

```
for i in range(100, -1, -1):
    print(i) 
```

注意：这包括输出中的 100 和 0。

有多种方法。

**更好的方法**

对于 pythonic 方式，请检查[PEP 0322](https://www.python.org/dev/peps/pep-0322/)。

这是从 100 打印到 0（包括 100 和 0）的 Python3 pythonic 示例。

```
for i in reversed(range(101)):
    print(i) 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-07-24T14:48:06.340

另一种解决方案：

```
z = 10
for x in range (z):
   y = z-x
   print y 
```

结果：

```
10
9
8
7
6
5
4
3
2
1 
```

提示：如果您使用此方法来计算列表中的索引，您需要从“y”值开始 -1，因为您的列表索引将从 0 开始。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2017-11-28T10:55:16.323

解决您的问题的简单答案可能是这样的：

```
for i in range(100):
    k = 100 - i
    print(k) 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-05-29T00:55:40.023

在你的情况下，你总是可以增加范围并从变量中`100 - i`减去`i in range( 0, 101 )`。

```
for i in range( 0, 101 ):
    print 100 - i 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-06-23T20:15:58.913

`for var in range(10,-1,-1)`作品

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-05-18T19:27:33.590

短而甜。这是我在做 codeAcademy 课程时的解决方案。以 rev 顺序打印字符串。

```
def reverse(text):
    string = ""
    for i in range(len(text)-1,-1,-1):
        string += text[i]
    return string 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-02-03T14:59:27.207

我想同时向后循环两个列表，所以我需要负索引。这是我的解决方案：

```
a= [1,3,4,5,2]
for i in range(-1, -len(a), -1):
    print(i, a[i]) 
```

结果：

```
-1 2
-2 5
-3 4
-4 3
-5 1 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-04-28T23:53:04.023

您还可以在 python 中创建自定义反向机制。它可以在任何地方用于向后循环迭代

```
class Reverse:
    """Iterator for looping over a sequence backwards"""
    def __init__(self, seq):
        self.seq = seq
        self.index = len(seq)

    def __iter__(self):
        return self

    def __next__(self):
        if self.index == 0:
            raise StopIteration
        self.index -= 1
        return self.seq[self.index]

>>> d = [1,2,3,4,5]
>>> for i in Reverse(d):
...   print(i)
... 
5
4
3
2
1 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-11-04T13:37:02.290

您可能想`reversed`在 python 中使用该函数。在我们进入代码之前，我们必须记住该`range` 函数总是返回一个列表（或我不知道的元组），所以`range(5)`会返回`[0, 1, 2, 3, 4]`。该`reversed`函数反转列表或元组，因此您的解决方案`reversed(range(5))`可能`[4, 3, 2, 1, 0]`是：

```
for i in reversed(range(100)):
    print(i) 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-07-07T18:55:05.973

我在其中一个 codeacademy 练习中尝试了这个（在不使用 reversed 或 :: -1 的情况下反转字符串中的字符）

```
def reverse(text):
    chars= []
    l = len(text)
    last = l-1
    for i in range (l):
        chars.append(text[last])
        last-=1

    result= ""   
    for c in chars:
        result += c
    return result
print reverse('hola') 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-05-27T20:50:51.827

哦，好吧，把问题读错了，我想这是关于在数组中倒退？如果是这样，我有这个：

```
array = ["ty", "rogers", "smith", "davis", "tony", "jack", "john", "jill", "harry", "tom", "jane", "hilary", "jackson", "andrew", "george", "rachel"]

counter = 0   

for loop in range(len(array)):
    if loop <= len(array):
        counter = -1
        reverseEngineering = loop + counter
        print(array[reverseEngineering]) 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2021-08-24T18:25:35.190

它对我很有效

```
for i in range(5)[::-1]:
    print(i,end=' ') 
```

输出：4 3 2 1 0

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2015-09-22T11:50:33.923

```
a = 10
for i in sorted(range(a), reverse=True):
    print i 
```

# windows - PC相当于Coda？

> ID：869886
> 
> 赞同：30
> 
> 时间：2009-05-15T17:17:13.907
> 
> 标签：windows, development-environment, coda

任何人都可以为 Windows 推荐一个好的多合一 Web 开发工具。

与仅适用于 Mac OS X 的 Coda 相提并论？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2011-09-04T09:16:55.393

我自己没有使用过 Coda，但相信无论它有什么，你也可以在 Sublime Text 2 中找到，检查一下。对于远程文件访问，您可以使用像 ExpanDrive 这样的实用程序将远程驱动器安装为本地磁盘。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-10-19T17:32:23.543

我喜欢[科莫多编辑](http://www.activestate.com/komodo-edit)。我建议您尝试一下。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-20T02:43:18.717

我试过NotePad++，它实际上很酷，但是它时不时会崩溃，它可以删除你的工作！:O，遗憾的是我还没有找到像 PC 的 CODA 这样的东西，所以我留在 mac

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-08-14T20:04:16.973

我认为您可以将 notepad++ 与 ftp_synchronize 插件一起使用，以便您可以远程编辑服务器上的文件；）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-07-23T07:07:21.807

据我所知，在 mac 上没有什么能比得上 Coda。这很可悲。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-10-20T00:00:07.987

我喜欢 Coda 并且每天都专业地使用它。但是，我将在 PC 上查看 Aptana Studio 和 Komodo IDE——它们看起来都非常好。

请注意，Coda 不是免费的（下载，99 美元），因此答案可能不应仅限于免费的 PC 软件，以便比较苹果和苹果（双关语）。

干杯!

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-10-21T17:54:09.000

我自己使用了 PHPed，对我来说是最好的

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-08-26T19:46:03.450

我已经看过了，NetBeans 7.x 和我发现的差不多。Coda 不仅仅是一个编辑器……它支持 Subversion，具有出色的内置 CSS 编辑器，并允许非常优雅的本地开发和发布到主机的工作流程。甚至 NetBeans 也只是本地或远程的，但不能在一个项目中同时处理两者。但是，NetBeans 的 MySQL 集成非常方便。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-16T04:29:33.463

Coda 不只是一个文本编辑器吗？对于 Windows，有[notepad++](http://notepad-plus.sourceforge.net/uk/about.php)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-06-30T04:15:35.200

我使用 KomodoEdit，它甚至无法与 Coda 相比。在 Mac 上编码有很大不同，因为您可以拥有一个内置终端。Windows 等价物必须有一个用于腻子或类似东西的插件。

# asp.net - ASP.NET 中的多种登录模式 - 需要建议

> ID：869888
> 
> 赞同：4
> 
> 时间：2009-05-15T17:17:31.597
> 
> 标签：asp.net, login

寻找一些关于在哪里获取当前 web 应用程序的建议，该应用程序支持基于活动目录的登录并利用内置的 asp 登录组件。

问题是我们希望可以选择使用活动目录登录或使用存储在本地数据库中的数据的“正常”登录。

*只是为了说清楚。在每个已安装的系统上，它将是一个或另一个，所以我不问如何检查每次登录尝试。*

基本流程：

```
Determine which login mode is set
  if active directory
    load active directory login form
    validate login info against active directory
    login to system
  else if normal login
    load default login form
    validate login info against database
    login to system 
```

我对 asp 登录组件缺乏了解可能是这里的问题，但我不确定如何让登录组件知道在哪种登录模式上运行验证？登录表单看起来就像一个黑匣子，在如此重要的任务中使用它让我有点不安。

这可以做到吗？

或者..

我应该为系统编写一个自定义登录名并完成它吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T17:28:47.123

在这种情况下，登录控件将成为您的朋友，因为它只是利用 ASP.Net 成员提供程序模型。您根本不需要更改应用程序！

您需要做的就是在 web.config 文件中指定您将使用的身份验证模式。这当然可以在一台机器的基础上进行设置。因此，对于您的活动目录机器：

```
<connectionStrings>
  <add name="ADConnectionString" connectionString="LDAP://testdomain.test.com/CN=Users,DC=testdomain,DC=test,DC=com" />
 </connectionStrings>

<membership defaultProvider="MyADMembershipProvider">
  <providers>
    <add
       name="MyADMembershipProvider"
       type="System.Web.Security.ActiveDirectoryMembershipProvider, System.Web, Version=2.0.0.0, 
             Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
       connectionStringName="ADConnectionString"
       connectionUsername="testdomain\administrator" 
       connectionPassword="password"/>
  </providers>
 </membership> 
```

[您可以从http://msdn.microsoft.com/en-us/library/ms998360.aspx](http://msdn.microsoft.com/en-us/library/ms998360.aspx)阅读有关使用会员提供程序和活动目录实现登录的更多信息。

然后对于将要针对数据库进行身份验证的机器，您只需编写一个自定义成员资格提供程序来针对您的数据库进行身份验证。这真的很简单，你真的只需要实现一种方法。您可以从这里开始：http: [//msdn.microsoft.com/en-us/library/f1kyba5e.aspx](http://msdn.microsoft.com/en-us/library/f1kyba5e.aspx)。这也是一个很好的例子，只有最少的代码和一个简单的设置方法： [http ://www.15seconds.com/issue/050216.htm](http://www.15seconds.com/issue/050216.htm)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T17:29:34.360

如果您使用表单身份验证，您可以根据活动目录和数据库检查用户，如果其中任何一个返回肯定，则将表单身份验证设置为 true。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T17:30:35.620

是和不是。

LOGIN 组件使用 Membership 提供程序类。您需要自己编写一个 Active Directory 版本，并告诉 ASP.Net 寻找它的 AD，或者如果使用数据库则寻找 SQLMembershipProvider

# c# - 如何使这个扩展方法编译？

> ID：869903
> 
> 赞同：4
> 
> 时间：2009-05-15T17:20:53.087
> 
> 标签：c#, .net, generics, extension-methods

我正在尝试为通用委托创建一个扩展方法，`Action<T>`以便能够对`Action<T>`方法进行简单的异步调用。它基本上只是实现了当您想要执行该方法而不关心它的进度时的模式：

```
public static class ActionExtensions
{
    public static void AsyncInvoke<T>(this Action<T> action, T param) {
        action.BeginInvoke(param, AsyncActionCallback, action);
    }

    private static void AsyncActionCallback<T>(IAsyncResult asyncResult) {
        Action<T> action = (Action<T>)asyncResult.AsyncState;
        action.EndInvoke(asyncResult);
    }
} 
```

问题是它不会编译，因为额外的东西`<T>`使`AsyncActionCallback`泛型和具有与预期不同的签名。签名`void AsyncActionCallback(IAsyncResult)`是预期的。

有谁知道如何解决这个问题或完成我想要做的事情？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-15T17:26:39.857

```
public static void AsyncInvoke<T>(this Action<T> action, T param)
{
    action.BeginInvoke(param, asyncResult => 
    {
        Action<T> a = (Action<T>)asyncResult.AsyncState;
        a.EndInvoke(asyncResult);
    }, action);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T17:22:24.237

`AsyncActionCallback<T>`?

免责声明：不确定上述内容，可能是这些“限制”之一。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T19:02:18.927

如果你想让你的函数分开（而不是 lambda），那么这样的事情：

```
public static void AsyncInvoke<T>(Action<T> action, T param)
{
    action.BeginInvoke(param, new AsyncCallback(AsyncActionCallback<T>), action);
} 
```

# java - 类未找到异常

> ID：869909
> 
> 赞同：0
> 
> 时间：2009-05-15T17:22:23.083
> 
> 标签：java, eclipse

我正在使用 Eclipse；当我在调试中运行我的代码时，我得到一个类未找到异常，但在没有调试的情况下运行它可以正常工作。
我看到它找不到我写的课程。

我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T17:36:46.293

仔细检查 Eclipse 中的运行配置是否为两者设置了相同的类路径（正常运行与调试）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T17:51:34.760

Eclipse 有很多设置，但我会尝试检查以下内容：

```
Run > Debug Configurations > Java Application > PROJECT_NAME > Classpath 
```

此外，您可以检查同一位置下的源代码，以确保您的所有 JAR 文件都已正确添加。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T20:31:43.157

我假设我们正在查看一个普通的 Java 应用程序。Eclipse 为正常执行创建运行配置，为调试运行创建调试配置。并且同一类的 Run 和 Debug 配置之间通常没有显着差异。

最简单的方法是开始清理：导航到“运行配置...”并删除所有“Java 应用程序”配置。然后对“调试配置”执行相同的操作。完成此操作后，以正常模式和调试模式启动应用程序一次。

替代方案：切换到新工作区（文件 -> 切换工作区），导入项目（文件 -> 导入...，确保复制内容）并运行/调试您的应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T20:32:39.367

检查您的运行/启动配置。您可能对调试与运行有不同的配置。很有可能调试的不是指向程序的主类。

只需检查调试...选项（下拉调试菜单，不要单击按钮，然后单击调试...），第一页应该有一个“主类”字段。使用与 run... 选项中相同的主类。

# python - BWSplitView 和 PyObjc

> ID：869912
> 
> 赞同：3
> 
> 时间：2009-05-15T17:24:04.687
> 
> 标签：python, cocoa, pyobjc, bwtoolkit

我正在尝试在 Cocoa PyObjc 项目中使用来自 BWToolkit 的 Brandon Walkin 的 BWSplitView。当我运行项目时，我收到以下错误消息：

```
NSInvalidUnarchiveOperationException - *** -[NSKeyedUnarchiver decodeObjectForKey:]: cannot decode object of class (BWSplitView) 
```

这是否意味着他的工具包与 PyObc 项目不兼容，所以我应该只使用默认的界面构建器视图？BWToolkit 似乎非常适合我的程序，我计划在界面的其他地方使用它。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T17:51:02.250

我怀疑您收到该错误是因为您在尝试加载的 nib/xib 文件中有一个 BWSplitView。为了取消归档 nib 文件中的对象，运行时需要能够创建已归档类的实例（例如 BWSplitView）。引发的异常是因为 BWSplitView 对运行时不可用。在 Objective-C 应用程序中，您将链接到 BWToolkit 框架，动态链接器将完成使 BWSplitView 可用于运行时的工作。在 PyObjC 应用程序中，您必须显式导入您希望运行时可用的类（在幕后未为您链接的类，例如 Cocoa 类）。幸运的是，BWToolkit 有一个桥接支持文件，因此您可以直接导入它（假设它位于标准框架位置，例如 /Library/Frameworks）。`objc.loadBundle`然后用于`NSClassFromString`获取类对象。

附带说明一下，/System/Library/Frameworks 是为 Apple 提供的系统框架保留的。您不应将第三方框架放在该文件夹中，因为 Apple 可能会在系统更新时擦除该文件夹（不太可能但可能）。系统上所有用户都可以使用的第三方框架应该放在 /Library/Frameworks 中，用户特定的框架类似地放在 ~/Library/Frameworks 中，应用程序特定的框架放在 Contents/Frameworks 中，在应用程序的应用程序包中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-15T17:42:51.893

我已经使用以下步骤解决了这个问题：
1\. 下载并安装[http://github.com/jrydberg/pyobjc-bwtoolkitframework/tree/master](http://github.com/jrydberg/pyobjc-bwtoolkitframework/tree/master)
2\. 确保您在 /System/Library/Frameworks 中安装了 BWToolkit.framework（这可以通过重新下载 BWToolkit 并复制文件夹来完成）
3\. 在 main.py 中使用 import BWToolkitFramework

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-20T03:20:31.113

我们收到了类似的信息：

```
*** Terminating app due to uncaught exception ‘NSInvalidUnarchiveOperationException’, reason: ‘*** -[NSKeyedUnarchiver decodeObjectForKey:]: cannot decode object of class (MKMapView)’ 
```

在我们的例子中，这是由于目标构建设置下的“框架搜索路径”设置中的一个杂散条目。清除该条目后，问题就消失了。

# xcode - Xcode 的 Change Case of Letter 快捷方式似乎不起作用

> ID：869915
> 
> 赞同：0
> 
> 时间：2009-05-15T17:24:28.990
> 
> 标签：xcode, keyboard-shortcuts

在 Preferences->Key Bindings->Text Key Bindings Xcode 有一个“Change Case of Letter”键绑定。但是，当我为此绑定分配一个快捷方式，然后尝试利用它来交换我的一个源代码文件中的字母的大小写时，它似乎没有做任何事情。

我尝试将光标定位在字母之前和之后，并尝试在触发分配的快捷方式之前选择字母。似乎什么都做不了。

有人知道我可能做错了什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T19:40:15.700

那是一个通用的 AppKit 文本功能，但显然在几年前就被删除了。我将更新 Xcode 的文本绑定以反映它。

相反，编写一个用户脚本：（ [来源：][[mac.com](http://idisk.mac.com/cdespinosa/Public/Change%20Case.png)][）][![替代文字](https://i.stack.imgur.com/kpV7E.png)](https://i.stack.imgur.com/kpV7E.png)

并为其分配您想要的任何快捷方式。

# tdd - 我知道在编写失败的单元测试之前我可能不会编写生产代码，所以我可以告诉我的经理我不能编写 UI 吗？

> ID：869918
> 
> 赞同：2
> 
> 时间：2009-05-15T17:25:16.693
> 
> 标签：tdd, code-coverage

我一直在使用 TDD 进行服务器端开发。我不确定将所有生产代码都包含在单元测试中的好处是否超过了花费 4 倍于重构所需时间的劣势。

但是当我在开发 UI 代码时，我根本无法应用 TDD。对于那里的所有原教旨主义者，TDD 的第一定律指出“在编写失败的单元测试之前，您不得编写生产代码”。但是，如果您正在开发 UI，这怎么可能呢？

（可以使用 Selenium 之类的验收测试框架，但这不算数，因为您不直接与源代码交互。）

那么，我可以告诉我的经理，由于新的 >90% 代码覆盖率政策，我无法编写用户界面代码吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T17:34:52.180

如果您发现编写 TDD 会使您在重构上花费 4 倍以上的时间，那么您需要编写更好、更独立的测试，并真正让测试按预期驱动设计。当您在没有测试的情况下进行重构时，您还没有计算在调试器中花费的时间，更不用说其他人在您重构时引入的错误上花费了多少时间。

不管怎样，[这里](https://stackoverflow.com/questions/362671/does-tdd-apply-well-when-developing-an-ui)有一些关于 TDD 对 UI 开发意味着什么的好建议。这将转化为代码覆盖率的程度在很大程度上取决于 UI 框架。

绝对不要告诉你的经理你做不到，他可能会用能做的人代替你。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T17:33:54.740

TDD 是关于孤立地测试方法。如果你想测试你的 UI，你是在做集成测试而不是单元测试。因此，如果您仔细分离应用程序中的关注点，您将能够成功地将 TDD 应用于任何类型的项目。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-16T17:27:58.863

首先，即使是 Robert Martin 也[遇到了 UI 测试挑战](http://twitter.com/unclebobmartin/status/1087523846)。

在对 UI 进行 TDD 时，您会编写尽可能接近动作的“行为契约”。理想情况下，这意味着单元测试。但是一些 UI 框架使这变得异常困难，要求您退后一步并使用集成或“验收”测试来捕获您期望 UI 的行为方式。

如果您不能使用单元测试，这不算数吗？这取决于您使用哪些规则来记分。“只计算单元测试”规则对于初学者来说是一个很好的规则，就像“不要拆分不定式”或“避免被动语态”一样。最终，您会了解该规则的边界在哪里。在一个播客中，Kent Beck 谈到了适当地使用单元测试和集成测试的组合（如果我没记错的话，补充说这不会打扰他）。

如果 TDD 是您的目标，您当然可以先编写 Selenium 测试，尽管这可能是一种缓慢的方式。我参与了几个项目，这些项目使用 Selenium RC 取得了很好的效果（也很痛苦，因为测试运行得如此缓慢）。

无论你的框架是什么，你都可以在谷歌上搜索来自那些经历过相同战斗的人的 TDD 技巧。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T17:43:26.463

该策略听起来有点人为，但我同意 UI 需要功能测试用例而不是单元测试的答案。然而，我不同意先到先得的观点。我曾在这样一个环境中工作过，在这种环境中，必须在开发 UI 之前编写 UI 功能测试，并且发现它工作得非常好。当然，这假设您也预先进行了一些设计工作。只要测试用例作者和开发人员就设计达成一致，就可以在您开始编码之前编写测试用例；那么你的代码必须让所有的测试用例都通过。相同的基本原则，但它并没有完全遵守法律。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T17:33:08.423

单元测试不适用于 UI 代码。功能测试用于测试 UI，但您不能先编写这些测试。您应该与您的经理确认 >90% 的代码覆盖率政策是否也涵盖 UI 代码。如果是这样，他可能应该认真重新考虑这一举动。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-15T17:33:08.923

将业务逻辑从 UI 中分离出来，保证 UI 代码占总数的 10% 以下？关注点分离是 TDD 的主要目标，所以这实际上是一件好事。

就 90% 的覆盖率而言......好吧，最好的课程是回顾现存的文献（我会关注 Kent Beck 和 Bob Martin），我认为你会发现不遵循盲目覆盖率的支持（事实上，我想鲍勃叔叔最近写了一篇关于这个的博客文章）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T17:34:34.783

拥有 >90% 的代码覆盖率是愚蠢的，因为聪明的开发人员可以在一次测试中获得 100% 的覆盖率。;)

如果您使用的是 WPF，如果您使用 MVVM 模式，则可以测试您的 UI 代码。通过测试您的 UI 代码，我的意思是您可以测试 ModleView，但我知道没有任何东西可以测试 XAML。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-15T17:57:01.220

阅读[菲利普的书](https://rads.stackoverflow.com/amzn/click/com/0321227328)

# java - Java MouseListener - 事件

> ID：869923
> 
> 赞同：1
> 
> 时间：2009-05-15T17:26:25.507
> 
> 标签：java, swing, mouseevent

有谁知道以下是否`MouseEvent`是触发什么的预期行为？一个似乎在其他地方丢失或消耗。

1.  右键单击`JPanel`并显示`JPopupMenu`：

    ```
    MousePressed java.awt.event.MouseEvent[MOUSE_PRESSED,
      (469,347),absolute(2214,490),button=3,modifiers=Meta+Button3,
      extModifiers=Button3,clickCount=1]

    MouseReleased java.awt.event.MouseEvent[MOUSE_RELEASED,
      (469,347),absolute(2214,490),button=3,modifiers=Meta+Button3,
      extModifiers=Meta,clickCount=1]

    MouseClicked java.awt.event.MouseEvent[MOUSE_CLICKED,
      (469,347),absolute(2214,490),button=3,modifiers=Meta+Button3,
      extModifiers=Meta,clickCount=1] 
    ```

    到目前为止，按钮 3 中的所有 3 个都很好，并且顺序正确

2.  仍然在不在的`JPopupMenu`某处显示左键单击：`JPanel``JPopupMenu`

    事件发生了什么`MousePressed`？

    ```
    MouseReleased java.awt.event.MouseEvent[MOUSE_RELEASED,
      (452,339),absolute(2197,482),button=1,modifiers=Button1,clickCount=1]

    MouseClicked java.awt.event.MouseEvent[MOUSE_CLICKED,
      (452,339),absolute(2197,482),button=1,modifiers=Button1,clickCount=1] 
    ```

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T17:43:36.027

所以导致弹出菜单关闭的事件已经消失了。

IIRC，确切的实现方式从 1.5 更改为 1.6。在 1.5 中有一个玻璃板，在 1.6`AWTEventListener`秒内使用。有关详细信息，请参阅`BasicPopupMenuUI`来源。看起来您可以（全局）停止正在使用的事件：

```
UIManager.put("PopupMenu.consumeEventOnClose", false); 
```

# broadcasting - 测试广播和接收消息

> ID：869925
> 
> 赞同：1
> 
> 时间：2009-05-15T17:26:59.920
> 
> 标签：broadcasting

伙计们很难弄清楚这一点：我正在尝试测试用于广播消息和接收消息的代码（在 c# 中）是否有效：

发送数据报的代码（在这种情况下是主机名）是：

```
public partial class Form1 : Form
{
    String hostName;
    byte[] hostBuffer = new byte[1024];
    public Form1()
    {
        InitializeComponent();
        StartNotification();
    }
    public void StartNotification()
    {

        IPEndPoint notifyIP = new IPEndPoint(IPAddress.Broadcast, 6000);

        hostName = Dns.GetHostName();
        hostBuffer = Encoding.ASCII.GetBytes(hostName);

        UdpClient newUdpClient = new UdpClient();
        newUdpClient.Send(hostBuffer, hostBuffer.Length, notifyIP);

    }
} 
```

接收数据报的代码是：

```
 public partial class Form1 : Form
{
    byte[] receivedNotification = new byte[1024];
    String notificationReceived;
    StringBuilder listBox;

    UdpClient udpServer;
    IPEndPoint remoteEndPoint;

    public Form1()
    {
        InitializeComponent();
        udpServer = new UdpClient(new IPEndPoint(IPAddress.Any, 1234));
        remoteEndPoint=null;

        startUdpListener1();

    }

    public void startUdpListener1()
    {
        receivedNotification = udpServer.Receive(ref remoteEndPoint);
        notificationReceived = Encoding.ASCII.GetString(receivedNotification);

        listBox = new StringBuilder(this.listBox1.Text);
        listBox.AppendLine(notificationReceived);

        this.listBox1.Items.Add(listBox.ToString());
    } 
```

}

对于代码的接收，我有一个只有一个列表框（listBox1）的表单。这里的问题是，当我执行要接收的代码时，程序运行但表单不可见。但是，当我评论函数调用（ startUdpListener1() ）时，没有达到目的，但表单是可见的。怎么了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T17:34:44.660

udpServer.Receive() 可能是一个阻塞调用，等待数据（它没有得到）

# php - Curl和HttpRequest之间的PHP区别

> ID：869927
> 
> 赞同：25
> 
> 时间：2009-05-15T17:27:14.287
> 
> 标签：php, http, post

我需要向服务器发出 RAW POST (PUT a $var) 请求，并接受来自该页面的结果作为字符串。还需要添加自定义 HTTP 头信息（如 x-example-info: 2342342）

我有两种方法

*   卷曲（[http://us.php.net/manual/en/book.curl.php](http://us.php.net/manual/en/book.curl.php)）
*   PHP HTTP 使用 HTTPRequest ( [http://us.php.net/manual/en/book.http.php](http://us.php.net/manual/en/book.http.php) )

两者有什么区别？什么更瘦？快点？两者在我看来几乎一样...

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-15T17:33:27.080

Curl 与 PHP 捆绑在一起，HTTPRequest 是一个单独的 PECL 扩展。

因此，CURL 更有可能安装在您的目标平台上，这几乎是大多数项目的决定因素。如果您打算只在您个人有能力安装 PECL 扩展的服务器上安装软件，我只会考虑使用 HTTPRequest；如果您的客户将进行自己的安装，那么安装 PECL 扩展通常是不可能的。

[这个页面](http://us.php.net/manual/en/intro.http.php)似乎暗示 HTTPRequest 在幕后使用 CURL。不过，听起来它可能会为 curl_multi_*() 提供一个稍微优雅的接口。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-15T17:39:03.340

HTTPRequest（和 PECL 扩展）建立在 libcurl 之上。

[http://us.php.net/manual/en/http.requirements.php](http://us.php.net/manual/en/http.requirements.php)

HTTPRequest 实际上只是执行相同任务的一种更简单/语法更友好的方式。

正如 Frank Farmer 所提到的，您更有可能已经安装了 curl 的目标平台，并且可能难以让托管服务提供商安装 PECL 库。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-15T17:37:39.630

HTTPRequest 是 curl 的“一种”包装器。手册中的这两个引用应该给你一个线索：

*   如果使用 CURL 支持构建，它会提供强大的请求功能。并行请求可用于 PHP 5 及更高版本。

*   扩展必须使用 » libcurl 支持来构建请求功能（--with-http-curl-requests）。需要等于或高于 v7.12.3 的库版本。

说过（并说我自己从来没有使用过这个扩展），看起来如果你想让你的代码看起来更面向对象，你可以选择这个，但它可能会慢一点，尽管与外部相比没有什么你将要拨打的电话，所以我不会考虑性能来做出我的选择。我会优先考虑 curl 是内置的，而另一个你必须自己添加它，如果你想在你无法控制的共享环境中托管你的应用程序，这很不方便并且降低了可移植性。

对于您在问题中解释的需求，我肯定会选择 curl。

# apache-flex - 任何想法为什么增量弹性编译不适用于相同源的连续编译？

> ID：869930
> 
> 赞同：1
> 
> 时间：2009-05-15T17:28:38.387
> 
> 标签：apache-flex, compiler-construction

我在命令行中使用*-incremental=true*运行 mxmlc 。Flex 首次使用校验和构建缓存文件。随后的编译失败并显示此消息：

**无法将编译目标与 path_to_cache/projectname_329043.cache 匹配。缓存文件不会被重复使用。**

1.  path_to_cache 存在
2.  缓存文件存在于 path_to_cache
3.  编译器没有尝试创建新的缓存文件，所以我假设它正在生成相同的校验和

我的环境：

1.  弹性 3.0
2.  Mac - OSX 10.4.x

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-16T22:59:54.417

我自己刚刚遇到了这个问题，在网络上的任何地方都没有找到答案之后，我在几乎是反复试验中猛烈抨击 mxmlc，直到找到答案。就我而言，每次从 ant 中编译时，我都会重新生成 flex config xml 文件。事实证明，这是您在认为配置已更改的情况下遇到的错误。您可以通过简单地触摸您的配置文件并针对未修改的源运行来测试这一点。因此，如果您的 flex config.xml 上的时间戳在编译之间发生变化，那很可能是罪魁祸首。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-18T19:03:33.713

这可能是权限问题。你试过跑步`sudo`吗？我不建议永久这样做，但是如果使用`sudo`使错误消息消失，那么您知道这是权限问题；您可以继续使用正确的方法来解决它。

您也可以尝试进入磁盘工具并检查/修复磁盘权限。OSX 因偶尔需要这样做而臭名昭著。

# c# - 从 mht 中提取文本

> ID：869934
> 
> 赞同：4
> 
> 时间：2009-05-15T17:29:09.277
> 
> 标签：c#, .net, regex, extract, mhtml

我有一个 mht 文件，我希望得到 mht 的所有文本。我坚持使用正则表达式，但我在 mht 中除了英语还有其他语言，所以文本本身包含 A7=A98=D6 之类的东西...

选择在浏览器中查看的文件的所有文本，然后将其复制并粘贴到记事本中 - 这就是我需要的。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-16T06:29:14.173

Open the file in Internet Explorer and save it as plain text (UTF-8). :) If you need an automated solution, look for an mht to txt converter for your platform or programming language.

Actually, you can automate this in Powershell as well:

```
$ie = New-Object -ComObject "InternetExplorer.Application"
$ie.Navigate2("file:///C:/MyFile.mht")
$text = $ie.Document.documentElement.innerText 
```

# c# - 通用表单的具体实现在 Designer 中不起作用

> ID：869941
> 
> 赞同：1
> 
> 时间：2009-05-15T17:30:37.743
> 
> 标签：c#, generics, visual-studio-2005, windows-forms-designer

我有一个基类，定义如下（我也在使用 DevExpress 组件）：

```
public abstract partial class BaseFormClass<R> : XtraForm where R : DataRow
{
  ...
} 
```

与我从其他地方读到的相反，我仍然能够设计这个类。我不必为此创建一个具体的类。但是，当我创建一个派生自它的具体类时（如下所示），该类在设计器中不起作用。

```
public partial class ConcreteFormClass : BaseFormClass<StronglyTypedRow>
{
  ...
} 
```

我收到这条消息：

> 无法为此文件显示设计器，因为无法设计其中的任何类。设计人员检查了文件中的以下类： ConcreteFormClass --- 无法加载基类“BaseFormClass”。确保已引用程序集并且已构建所有项目。

有没有人见过这个？任何已知的解决方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-15T17:36:05.123

抱歉，但这行不通（真遗憾——我过去希望你也可以这样做。）问题在于设计者的基本方法。

为了向您展示您的表单模型，它实际上并没有尝试构建表单本身。如果这样做，您会遇到其他问题——如果您的表单没有无参数构造函数怎么办？相反，它实际上实例化了表单基类的一个实例。然后它会扫描您的`InitializeComponents()`方法并将您在那里定义的所有控件“叠加”到基本表单上。

所以很明显为什么这不起作用。您可以设计 的实例`BaseFormClass`，因为要设计它，它会创建 的实例`XtraForm`，这是具体的。但是您不能设计 的实例`ConcreteFormClass`，因为要这样做，就需要创建 的实例`BaseFormClass`，这是抽象的。

最简单的解决方法是只制作`BaseFormClass`非抽象的。（如果你想绝对确定没有人可以创建一个，也许你可以将默认构造函数设为私有？我不确定设计师是否可以处理这个问题，但我不明白为什么它不能。）很烂，但是这就是人生。向微软投诉，也许 Visual Studio 2012 会更好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-09T06:51:42.533

这听起来与让设计人员渲染具有抽象基类的表单非常相似。我没有做过任何通用的多继承，但你至少可以试试[我的方法](https://stackoverflow.com/questions/1620847/how-can-i-get-vs2008-winforms-designer-to-render-a-form-that-implements-an-abstra/2406058#2406058)，看看它是否有效。

编辑：是的，好的，刚刚尝试过，我的解决方案肯定有效。您只需要修改中间类定义和表单定义（包含在 中`#if DEBUG`）

让我知道你是否可以尝试！

# database - B+ 树，选择顺序

> ID：869944
> 
> 赞同：1
> 
> 时间：2009-05-15T17:31:07.320
> 
> 标签：database, data-structures, file-structure

我是第一次研究 B+ 树。我只想知道，开发者应该根据什么来选择B+树的顺序？

另外，有没有类似 B+ 树的傻瓜教程？我迫切需要它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-16T17:28:01.140

如果您的意思是 B+-tree 节点中传出指针的数量“顺序”，则应考虑顺序*k*，以便磁盘上的节点是磁盘扇区大小或文件系统块大小的倍数，例如 4 KB。

如果您从磁盘读取节点，则磁盘（我在这里假设磁盘而不是 SSD）必须寻找节点的位置并读取节点。对于大小为 KB 的节点，寻道时间远大于该节点在磁盘上的实际传输时间。因此，选择一个订单以使节点的磁盘大小为 64 KB 可能是一个不错的选择。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T17:36:06.887

理想情况下，您需要选择一个具有良好[参考位置](http://en.wikipedia.org/wiki/Locality_of_reference)的订单来帮助缓存。鼓励对键进行顺序扫描的顺序也很有帮助。一般来说，这取决于您的数据。

# java - 如何将 java.util.logging 发送到 log4j？

> ID：869945
> 
> 赞同：85
> 
> 时间：2009-05-15T17:31:55.913
> 
> 标签：java, logging, log4j, apache-commons, slf4j

我有一个现有的应用程序，它针对 log4j 执行所有日志记录。我们使用许多其他库，这些库要么也使用 log4j，要么针对 Commons Logging 进行日志记录，最终在我们的环境中使用 log4j。我们的依赖项之一甚至针对 slf4j 进行日志记录，这也可以正常工作，因为它最终也委托给 log4j。

现在，我想将 ehcache 添加到这个应用程序中以满足一些缓存需求。以前版本的 ehcache 使用 commons-logging，这在这种情况下可以完美运行，但是从[1.6-beta1 版本](http://ehcache.sourceforge.net/changes-report.html#1.6.0-beta1)开始，他们已经删除了对 commons-logging 的依赖，并将其替换为 java.util.logging。

不太熟悉 java.util.logging 提供的内置 JDK 日志记录，是否有一种简单的方法可以将发送到 JUL 的任何日志消息记录到 log4j 中，这样我就可以使用现有配置并设置任何即将到来的日志记录来自ehcache？

查看 JUL 的 javadocs，看起来我可以设置一堆环境变量来更改`LogManager`使用的实现，也许可以使用它来将 log4j 包装`Logger`在 JUL`Logger`类中。这是正确的方法吗？

具有讽刺意味的是，当（大多数）世界其他地方使用 3rd 方库时，库使用内置 JDK 日志记录会引起如此头痛。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-05-15T17:47:08.310

我成功使用的一种方法是使用[slf4j](http://www.slf4j.org/)作为我的主要日志 API。然后我将 slf4j 绑定到 log4j。使用其他框架（如 JUL）的 3rd 方依赖项可以[桥](http://www.slf4j.org/legacy.html#jul-to-slf4j)接到 slf4j。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-05-16T06:38:04.120

我们在当前项目中使用[SLF4J](http://www.slf4j.org/)，它对我们来说效果很好。SLF4J 由 Log4J 的创建者 Ceki Gülcü 编写，他做得非常出色。在我们的代码中，我们直接使用 SLF4J 日志记录 API，并配置 SLF4J，以便来自[Jakarta Commons Logging](http://commons.apache.org/logging/) (JCL)、java.util.logging (JUL) 和[Log4J](http://logging.apache.org/log4j/1.2/index.html) API 的调用都桥接到 SLF4J API。我们需要这样做，因为像您一样，我们使用选择了不同日志 API 的第三方（开源）库。

在 SLF4J 的底部，您将其配置为使用特定的记录器实现。它带有一个内部或“简单”记录器，您可以使用 Log4J、JUL 或[Logback](http://logback.qos.ch/)覆盖它。只需在类路径中放入不同的 jar 文件即可完成所有配置。

最初，我们使用了同样由 Ceki Gülcü 编写的 Logback 实现。这是非常强大的。但是，我们随后决定将我们的应用程序部署到 Glassfish Java EE 应用程序服务器，其日志查看器需要 JUL 格式的消息。所以今天我从 Logback 切换到 JUL，在短短几分钟内，我将两个 Logback jar 替换为一个 SLF4J jar，将其连接到 JUL 实现。

所以就像@overthink，我衷心推荐在你的设置中使用 SLF4J。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2010-11-30T21:02:53.750

有一个比 SLF4J 更简单的替代方法来连接 JUL 和 log4j，请参阅[http://people.apache.org/~psmith/logging.apache.org/sandbox/jul-log4j-bridge/examples.html](http://people.apache.org/~psmith/logging.apache.org/sandbox/jul-log4j-bridge/examples.html)

您只需将 jul-log4j-bridge 放在类路径上并添加一个系统属性：

```
-Djava.util.logging.manager=org.apache.logging.julbridge.JULBridgeLogManager 
```

jul-log4j-bridge 不在 Maven Central 中，可以从这个存储库中获取：

```
<repository>
  <id>psmith</id>
  <url>http://people.apache.org/~psmith/logging.apache.org/repo</url>
  <releases>
    <enabled>false</enabled>
  </releases>
</repository> 
```

然后与：

```
<dependency>
  <groupId>org.apache.logging</groupId>
  <artifactId>apache-jul-log4j-bridge</artifactId>
  <version>1.0.0-SNAPSHOT</version>
  <scope>test</scope>
  <exclusions>
    <exclusion>
      <groupId>log4j</groupId>
      <artifactId>apache-log4j-component</artifactId>
    </exclusion>
  </exclusions>
</dependency> 
```

也可以通过以下步骤从源代码重建它：

1.  svn co [http://svn.apache.org/repos/asf/logging/sandbox/jul-to-log4j-bridge/](http://svn.apache.org/repos/asf/logging/sandbox/jul-to-log4j-bridge/)
2.  编辑 pom.xml，将 log4j:log4j:1.2.15 的依赖替换为 log4j:apache-log4j-extras:1.2.17 并删除对 apache-log4j-component 的依赖
3.  mvn包

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2014-10-24T10:50:44.880

2014 年 10 月

由于 log4j 的 2.1 版存在组件 log4j-jul，它完全允许这样做。尽管如此，如果您使用的是 log4j 1，则必须可以升级到 log4j2 才能使用这种方法。

[JDK 日志适配器](https://logging.apache.org/log4j/2.x/log4j-jul/index.html)

[类 LogManager](https://logging.apache.org/log4j/2.x/log4j-jul/apidocs/org/apache/logging/log4j/jul/LogManager.html)

[从 log4j 1.x 迁移到 log4j 2](https://logging.apache.org/log4j/2.x/manual/migration.html)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-15T17:48:14.423

我相信 slf4j 站点有一个通过 slf4j 传递 java.util.logging 事件的桥梁（并因此传递给 log4j）。

是的，SLF4J 下载包含 jul-to-slf4j，我相信它就是这样做的。它包含一个将记录传递给 SLF4J 的 JUL 处理程序。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-06-21T17:36:19.573

@Yishai - 感谢您将链接发布到我的 wiki。那里的示例将 JUL 重定向到 Log4J，我已经让它在生产系统中运行了几年。JBoss 5.x 已经将 JUL 重定向到 Log4J，所以我在升级时将其取出。我有一个更新的重定向到 SLF4J，我现在在一些事情上使用它。当我有机会时，我会发布。

然而，SLF4J 已经有了它：

[http://mvnrepository.com/artifact/org.slf4j/jul-to-slf4j](http://mvnrepository.com/artifact/org.slf4j/jul-to-slf4j)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-08-09T10:00:36.403

您应该在启动时手动添加自爆

```
SLF4JBridgeHandler.removeHandlersForRootLogger()
SLF4JBridgeHandler.install() 
```

演示-> [https://gist.github.com/jiahut/654ecc75a13b0a1d8f3b4d5d2d69dc6d](https://gist.github.com/jiahut/654ecc75a13b0a1d8f3b4d5d2d69dc6d)

# c# - NDIS 到 C# 的中间驱动程序接口

> ID：869947
> 
> 赞同：3
> 
> 时间：2009-05-15T17:32:27.957
> 
> 标签：c#, networking, driver, ndis

我正在开发本质上是一个专门的防火墙应用程序。该解决方案需要兼容 32 位和 64 位。我的公司想保留当前的程序界面，它是用 C# 编写的。

我需要的是：一种监控和操纵系统上所有网络流量的方法。我的研究使我相信 NDIS（网络驱动程序接口规范）中间驱动程序是可行的方法。如果我可以用 C# 编写这种驱动程序，那就太好了，但我不确定这是否可能。至少，我需要一个 C# 接口到用任何语言编写的驱动程序。

我在网上找到了一个很好的资源，用于在题为“扩展 Microsoft PassThru NDIS 中间驱动程序”的一系列文章中创建一个：

1.  [第 1 部分 - 添加 DeviceIoControl 接口](http://www.wd-3.com/archive/ExtendingPassthru.htm)
2.  [第 2 部分 - 两个 IP 地址阻止 NDIS IM 驱动程序](http://www.wd-3.com/archive/ExtendingPassthru2.htm)
3.  [第 3 部分 - 支持 Windows XP 64 位版本](http://www.wd-3.com/031504/PTEx3_index.htm)

但是，它的日期为（2003 年）。在我投入阅读和学习它的内容之前，我想确保我没有浪费我的时间。

有一个更好的方法吗？有没有比上面的文章更能解释这个过程的开源项目或文章？我什至在球场上？请帮忙。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-15T18:16:09.957

同一作者还有另一个页面，标题为[Windows 网络数据和数据包过滤](http://www.ndis.com/papers/winpktfilter.htm)，它提供了“可用于在 Microsoft Windows 平台上过滤网络数据和网络数据包的各种技术的简要介绍”。

它提到了其他选项，例如“TDI 过滤器驱动程序”和“用户模式网络数据过滤”，它们可能更适合，这取决于您是否*真的*想要操纵系统上的*所有*网络流量。

# reflection - 反射的真实示例

> ID：869959
> 
> 赞同：3
> 
> 时间：2009-05-15T17:35:53.923
> 
> 标签：reflection

在生产代码中使用反射的最佳示例是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T17:38:22.013

ASP.NET MVC 推断要从 URL 调用的操作和控制器。路由一般。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T17:39:12.730

最近，我不得不使用反射仅从程序集的路径加载程序集（以调查其公共类型）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-15T17:40:23.990

在 Linq To Sql 出现之前...我必须在 .NET 2.0 中编写自己的 ORM。

我大量使用反射来反思：

*   CRUD 存储过程的类
*   列名的属性
*   哪些操作对类有效

在检索结果后，我还使用反射来处理所有变量赋值（所有类都继承了处理对 DAL 的调用的 ActiveRecord 类）。

粗糙的东西......但经过一些性能调整后，它还不错。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T17:41:11.947

从具有 ID、类型和其他数据的 SQL 表中提取数据

然后你可以加载“雪佛兰”并使用它的所有方法

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T17:52:42.463

我确实有机会一次编写了一个 Python O/R 映射器，但这是一个概念证明，从未投入生产。

我做了很多工作，广泛使用 DBMS 上的系统数据字典（例如通用的缓慢变化的维度加载器）。有人可能会争辩说，这在原则上与反射编程没有什么不同。

最后，所有形式的 Python 都非常容易进行反射。事实上，它在这方面做得非常好，我用它来探讨其他语言的底层 API - 并使用反射功能来查询底层接口。我已经使用 Python 世界中存在的几乎所有反射机制做到了这一点：Python API 上的 CPython 和使用 makepy 的 COM API，Java API 的 Jython 和 .Net API 的 IronPython。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-15T18:03:35.637

在我最近的一个应用程序（Kofax Express 的插件）中，我可以选择对文件进行 OCR 并输出 PDF。由于我使用的 OCR 工具有运行时费用，因此我将 OCR 部分设置为单独的程序集。如果文件存在，我将显示 OCR 选项并后期绑定程序集并调用所需的方法并通过反射附加到事件。没有接口的简单插件架构，如果客户不需要 OCR，则无需支付版税；我们只是不给他们 OCR dll。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T17:38:56.850

WPF 数据绑定：

1）绑定路径“（TextBox.Text）”与“文本”？

如果绑定到名为 Text 的路径，WPF 将使用反射来解析名称。如果您使用类限定名称，则绑定可避免反射性能受到影响。类限定名称还允许绑定到附加属性！

（通过[http://dotnet.org.za/rudi/archive/2008/03/25/10-things-i-didn-t-know-about-wpf-data-binding.aspx](http://dotnet.org.za/rudi/archive/2008/03/25/10-things-i-didn-t-know-about-wpf-data-binding.aspx)）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-15T17:40:15.503

*   [NUnit 单元测试框架](http://www.nunit.org/index.php)- 虽然不是很典型
*   [CSLA](http://www.lhotka.net/cslanet/)大量使用反射
*   几乎所有支持插件的 Windows 窗体应用程序

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-15T17:40:35.003

我的 DAL 都是基于反射的。它反映了构建 SQL 的 POCO 属性。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-15T17:43:10.567

在工厂中，我们使用反射来传回接口的“虚拟”实现或接口的真实（挂钩到 DB）实现，基于属性文件中指定的类（在 Java 中）。

# asp-classic - 使用 Excel 的“打印标题”时，如何在工作表中途更改标题

> ID：869969
> 
> 赞同：0
> 
> 时间：2009-05-15T17:38:30.203
> 
> 标签：asp-classic, printing, export-to-excel

我有一个经典的 ASP Web 应用程序，可以将报告输出到 Excel，但它实际上只是 html。

一些报告输出有多个组，每个组可以跨越多个页面（垂直）。我知道 Excel 的“页面标题”功能可以在每个页面上打印指定的行（或行），但是，我需要每个组的标题也显示在标题中。否则，第一组的标题将显示为每个组的标题。

我在谷歌群组上看到有人建议将每个群组放在单独的工作表上，但我认为我不能轻松地输出多个工作表 - 或者根本不能 - 单独使用 html。

我正在寻找一个快速而肮脏的解决方案，因为我没有太多时间来维护这个糟糕的旧应用程序。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-05T21:33:33.853

答案有点晚了，但我想我已经找到了解决方案。您可以做的是打开 Excel，手动模拟您想要的内容，然后将其保存为网页。在简单的文本编辑器中打开生成的文件并检查生成的 HTML/XML。我为具有多个工作表的工作簿执行此操作，它似乎有效。

您可以对多个组执行相同的操作，因为这似乎是您真正想要的解决方案，过程是相同的。但是多个工作表选项也可以使用。以下是当我保存一个简单的 2 表工作簿时 Excel 为我生成的有趣部分（来自 Book.htm，而不是工作表文件），第一页为“abc”，第二页为“def”：

```
<script language="JavaScript">
 var c_lTabs=2;

 var c_rgszSh=new Array(c_lTabs);
 c_rgszSh[0] = "Sheet1";
 c_rgszSh[1] = "Sheet2";

------

<xml>
 <x:ExcelWorkbook>
  <x:ExcelWorksheets>
   <x:ExcelWorksheet>
    <x:Name>Sheet1</x:Name>
    <x:WorksheetSource HRef="Book1_files/sheet001.htm"/>
   </x:ExcelWorksheet>
   <x:ExcelWorksheet>
    <x:Name>Sheet2</x:Name>
    <x:WorksheetSource HRef="Book1_files/sheet002.htm"/>
   </x:ExcelWorksheet>
  </x:ExcelWorksheets>
  <x:Stylesheet HRef="Book1_files/stylesheet.css"/>
  <x:WindowHeight>13065</x:WindowHeight>
  <x:WindowWidth>15315</x:WindowWidth>
  <x:WindowTopX>360</x:WindowTopX>
  <x:WindowTopY>75</x:WindowTopY>
  <x:ProtectStructure>False</x:ProtectStructure>
  <x:ProtectWindows>False</x:ProtectWindows>
 </x:ExcelWorkbook>
</xml><![endif]-->
</head> 
```

# python - Python GUI 中的缩进

> ID：869975
> 
> 赞同：2
> 
> 时间：2009-05-15T17:39:27.783
> 
> 标签：python, user-interface, indentation

当我用 Python 编写代码时，突然想在我已经编写的代码前面添加一个新块......完整代码的缩进受到影响......

移动到每一行并更改缩进是一个非常乏味的过程......有没有办法做自动缩进或什么？

例如：

```
def somefunction:
     x =5
     return x 
```

如果我想添加一个控制块

例如：

```
def somefunction:
     if True:
         x =5
         return x
     return 0 
```

这个添加控制块的小改变需要大量的标签工作......

是否有捷径或其他方法可以轻松做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-16T00:18:29.010

我不知道每个人都来自什么古怪的星球，但在大多数不追溯到石器时代的编辑器中，缩进代码块通常只需要选择一个文本块并按下 Tab。另一方面，Shift+Tab 通常会取消块的凹痕。

这适用于 Visual Studio、Notepad2、e、Textmate、Slickedit、#Develop 等等等。

如果你不做大型多文件项目，我强烈推荐[Notepad2](http://www.flos-freeware.ch/notepad2.html)。它是一个非常轻量级、免费、易于使用的记事本替代品，具有足够的以代码为中心的功能（行号、缩进指南、代码突出显示等）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-15T17:43:58.803

在空闲编辑器中，您只需选择要缩进的行并按 Tab。

我应该注意，这实际上并没有在您的源代码中插入任何选项卡，只是空格。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-15T17:46:27.750

在 IDLE 中，我只在代码块上使用 ctrl+] 和 ctrl+[。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-15T23:10:04.667

使用 emacs 有 Python 模式。在该模式下，您突出显示并执行以下操作：

```
ctrl-c >
ctrl-c < 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T17:49:46.357

使用 VI 并且永远不要再编写相同的程序。:^)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-15T22:53:41.367

[有趣 ;-)] 伙计，我告诉过你，如果你有这个新的键盘模型 [Pythonic 键盘，你将不需要一名开发人员 http://img22.imageshack.us/img22/7318/pythonkeyboard.jpg](http://img22.imageshack.us/img22/7318/pythonkeyboard.jpg)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-15T23:35:32.623

Vim：切换到可视模式，选择块，使用 > 缩进（或 < 取消缩进）。

另请参阅：[在 vi 中快速缩进多行](https://stackoverflow.com/questions/235839/how-do-i-indent-multiple-lines-quickly-in-vi)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-15T23:46:59.303

如果您使用 vim，则有一个专门用于此的插件：[Python_fn.vim](http://vim.sourceforge.net/scripts/script.php?script_id=30)

它提供了有用的 python 函数（和菜单等价物）：

```
]t      -- Jump to beginning of block
]e      -- Jump to end of block
]v      -- Select (Visual Line Mode) block
]<      -- Shift block to left
]>      -- Shift block to right
]#      -- Comment selection
]u      -- Uncomment selection
]c      -- Select current/previous class
]d      -- Select current/previous function
]<up>   -- Jump to previous line with the same/lower indentation
]<down> -- Jump to next line with the same/lower indentation 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-15T17:50:59.177

在 TextMate 中，只需突出显示要缩进和使用的行：

⌘ + [
或
⌘ + ]

以适当的方向移动文本。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-15T21:15:21.913

PyDev，您可以在[http://pydev.sourceforge.net/](http://pydev.sourceforge.net/)找到它，它有一个“代码格式化程序”。它还具有自动缩进功能。它是 Eclipse 的一个插件，Mac 也可以免费使用。

如果您熟悉 Vim 或花时间学习 Vim，另一个选择是[http://code.google.com/p/macvim/](http://code.google.com/p/macvim/)，它有很多自动缩进功能，不仅适用于 Python。

但是，不要忘记，在 Python 中，缩进会改变程序的含义，这与 C 家族语言不同。例如对于 C 或 C#，实用程序可以根据“{”和“}”符号美化代码。但是，在 Python 中这将是模棱两可的，因为程序无法格式化以下内容：

```
#Say we wrote the following and expect it to be formatted.
a = 1
for i in range(5):
print i
a = a + i
print a 
```

你期望它是

```
a = 1
for i in range(5):
    print i
a = a + i
print a #Will print 5 
```

或者

```
a = 1
for i in range(5):
    print i
    a = a + i
print a #Will print 11 
```

这是两个不同的片段。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-16T01:52:52.717

在 Komodo 中，Tab 和 Shift Tab 都可以按预期缩进和取消缩进大块代码。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-16T02:54:09.730

在 vim 中，您可以输入：

`>>`

缩进一行。如果您输入：

`5>>`

您在光标处和光标下方缩进 5 行。 `5<<`做相反的事情。

# programming-languages - 什么是编程语言？

> ID：869976
> 
> 赞同：4
> 
> 时间：2009-05-15T17:39:31.560
> 
> 标签：programming-languages, theory, wikipedia

维基百科说：

> 编程语言是一种机器可读的人工语言，旨在表达可由机器（尤其是计算机）执行的计算。编程语言可用于创建指定机器行为的程序、精确表达算法或作为人类交流的一种模式。

但这是真的吗？今天早上洗澡的时候我突然想到，一种编程语言可能只是一组约定，人类和适当安排的编译器都可以解释的东西。如果是这样的话，那么编程语言的这种定义是否具有误导性？如果不是这种情况，那么编译器和它编译的语言有什么区别？

谢谢！

z。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-15T17:43:56.900

编程语言正是那套约定，但我不明白为什么这会使维基百科条目产生误导，真的。如果它让您感觉更好，您可以将其编辑为类似以下内容：

> 编程语言是一种机器可读的人工语言，旨在表达可由机器（尤其是计算机）执行的计算。编程语言可用于*定义*指定机器行为的程序，精确表达算法，或作为人类交流的模式。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-15T17:43:13.827

我看不出你问的有什么不同...

> 今天早上洗澡的时候我突然想到，一种编程语言可能只是一组约定，人类和适当安排的编译器都可以解释的东西。

...和维基百科的定义。

关键是编程语言只是“一种机器可读的人工语言”。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-15T17:57:45.837

我明白你在说什么，你是对的。将编程语言描述为“旨在表达可以由机器执行的计算的机器可读人工语言”是不必要的具体。编程语言可以更广泛地概括为任务的既定描述（或“一组约定”），允许一个实体控制另一个实体的行为。我们传统上定义的编程语言只是机器代码和程序员之间的抽象层，是专门为电子计算机设计的。

编程语言不仅限于传统计算机（请参阅[K'NEX 计算机](http://knexcomputer.blogspot.com/)），甚至根本不必限于计算设备。例如，当我对我的狗的行为感到满意时，他会得到款待。当我不高兴时，他什么也得不到。随着时间的推移，狗学会了零食/不零食编程，我可以使用零食来控制他的行为（在一定程度上）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-15T17:44:05.247

就简化为机器代码而言，编译器确实可以作为一种语言的有效规范 - 但是，由于通常很难通过阅读编译器的源代码来理解一种语言，因此人们通常会根据抽象处理模型来考虑编程语言编译器实现的。这种抽象模型是指编程语言时的含义。

也就是说，确实有许多语言（嗨，PHP！）其中编译器是现有语言的唯一规范。随着编译器错误的修复或引入，这些语言往往会发生不可预测的变化。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-15T17:48:41.070

编程语言是一个抽象层，有助于使程序员不必用电信号与计算机交谈。该语言的创建者在创建结构（语言）或标准（语法、共轭等）方面做了所有艰苦的工作，然后编译器可以用计算机理解的术语来解释这些结构（语言）或标准。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-15T18:57:17.567

所有编程语言实际上只不过是用于机器代码或操作处理实体的寄存器和内存的领域特定语言。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-02-16T05:23:03.817

这可能是对编程语言真正含义的真正解释：

第 1 步：考虑一种语言及其语法，这是一组使用该语言制作语法有效语句的规则。例如，一种名为 GRID 的语言将块 {0,1} 作为其字母表和语法规则，以确保每个 GRID 语句的长度和高度都相等。

第 2 步（程序定义）：到目前为止，GRID 是无用的。我敢于将任何有效的 GRID 声明都视为数据。我们需要向 GRID 添加其他内容：后继函数。所以 GRID={语法、字母表、后继函数}。为了明确这一点，让我们使用“生命游戏”的规则作为后继函数。

第 3 步：生命游戏实际上是图灵完备的，因此 GRID={Grammar, alphabet, successor function = GOL} 可以执行任何可计算的计算。

编程语言不过是具有后继功能的语言。评估语言（程序）的有效语句的环境除了遵循那些后继函数之外什么都不做。例如，变量是其后继函数 =（保持不变）的事物

计算机只是非常快速的环境；）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-12-29T23:16:09.167

维基百科的定义可能断章取义。一方面，只有用机器代码编写的程序才是机器可读的。否则，您需要一个编译器将 C++、Java 甚至汇编代码转换为机器代码，以便计算机能够执行您的指令。除非您包含只有人类可读的注释，或者除非您在程序范围内严格讨论某个主题，否则编程不足以进行人类交流。

# sharepoint - ASP.NET webpart 和 Sharepoint webpart 之间的 WebPartTitleID 差异

> ID：869977
> 
> 赞同：1
> 
> 时间：2009-05-15T17:39:39.717
> 
> 标签：sharepoint, web-parts

当我引用**Microsoft.SharePoint.WebPartPages.WebPart**时 ，WebPartTitleID 会在以下格式的页面上生成。WebPartTitleWPQ2

当我引用**System.Web.UI.WebControls.WebParts.WebPart**

WebPartTitleID 是在如下页面上生成的

WebPartTitlectl00_m_g_cfe73da2_e9aa_44e3_aa10_b8a300837217

有没有办法控制这个，所以我在 asp.net webpart 上获得了 WPQ 模式？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-15T18:09:59.457

据我所知，没有办法控制这些自动生成的 Web 部件 ID。如果您需要为它们设置样式，我能做的最好的事情就是将所有内容包装为具有自定义 ID 或类的 div。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-17T22:29:53.933

试试这个：

```
string clientName = ((Microsoft.SharePoint.WebPartPages.WebPart)wp).ClientName;

string wpqId = clientName.Substring(clientName.IndexOf("WPQ")); 
```

# sql-server - 删除 dbo。来自 SQLServer (2005) Management Studio 的对象资源管理器的架构前缀

> ID：869984
> 
> 赞同：14
> 
> 时间：2009-05-15T17:40:33.087
> 
> 标签：sql-server, ssms

我想`dbo`从对象资源管理器中删除前缀，以便我可以`S`按键并转到以`S`;开头的表。有`dbo`刺激性（对我来说）。

我在网上搜索过*，其他站点*上有一个答案说我应该`F7`在摘要选项卡中使用，但我找不到摘要选项卡，并且按下`F7`对象资源管理器对我不起作用。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-15T17:43:43.903

您不能在对象资源管理器中，但对象资源管理器详细信息不会作为 dbo 的前缀。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-10-20T02:45:13.217

我刚刚发现您可以输入，例如，`dbo.f`它会导航到以 开头的第一个表`f`。

# model-view-controller - MVC 作为热门范式

> ID：869987
> 
> 赞同：4
> 
> 时间：2009-05-15T17:41:20.917
> 
> 标签：model-view-controller, architecture

Stack Overflow 的人自己在 Podcast 上提到 MVC 是如何成为新的热门事物；.Net（大概 4.0 将成为标准）、Rails 和 Django。

但我想知道有什么大不了的。

它让我想起了 2000 年的 asp/jsp——在 HTML 中散布了大量的请求和响应命令。

而且我不明白为什么实际上在 SQL Server 或 MySQL 中编写 SQL 是那么痛苦，我也不理解 ORM、LINQ 等的好处。

对我来说，最复杂的事情从来都不是检索、输入、管理或创建数据，而是在一定程度上使用 AJAX 真正做一个丰富的前端。

有人能告诉我为什么 MVC 如此热门而且比 .Net 3.0 更可取，因为在 .Net 3.0 中，我的大部分代码和时间不是花在数据管理上，而是用于前端工作？

乔纳森

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T17:47:22.617

今天的应用程序变得越来越复杂（从业务逻辑和 UI 逻辑的角度来看）。这些工具和模式有助于处理这种复杂性（这实际上是软件开发的目的）：它们有助于管理[基本的复杂性](http://en.wikipedia.org/wiki/Essential_complexity)，而不会引入大量的[意外复杂性](http://en.wikipedia.org/wiki/Accidental_complexity)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T17:50:13.750

从[这里](http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller)：

> 该模式的成功使用将业务逻辑与用户界面考虑隔离开来，从而使应用程序更容易修改应用程序的视觉外观或底层业务规则，而不会影响另一个。

经典的 ASP.NET Web 开发是高度耦合的，这使得孤立地修改任何东西和轻松应用任何自动测试方法变得非常困难。使用 MVC，您可以真正应用 DRY 等原则和 TDD 等技术。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-15T21:45:41.857

我最近切换到 MVC，我的经历很复杂，但我很高兴我做出了切换。

最大的障碍是，即使据称一个新的 MVC 项目已经准备好运行并且您可以开始在它之上迭代地构建，我实际上必须为一个真正的应用程序构建大量的脚手架并进行大量的阅读/学习。

我选择了**Entity Framework** (EF)，它最初引起了很多悲痛，直到我让**EFPocoAdapter**做很多我想做的事情（因为它是过渡性的并且会发现自己合并到 EF 4.0 中而被弃用）。在这个过程中，我必须学习**Persistence Ignorance**，**Inversion of Control**，**复习 SOLID**原理，然后了解**MVC 架构**本身。我目前正在重新阅读 Head First **Design Patterns**，因为直到现在我才完全利用这些模式。

我遇到了对象图中的循环引用、实体与**POCO**对象以及从客户端持久化数据并返回数据库的**序列化问题。**我真的开始了解**REST**是什么，并深入了解**HTTP**和支持**HTML5**（PUT/DELETE 支持）。

 ******我也熟悉了以前从未使用过的**ORM 。**我学习并且仍在学习**Linq**（查询表达式）和**表达式树**。我亲身体验了很多我只读过的**C# 3.0特性（对象初始化器、匿名类型、隐式类型和大多数其他特性）。**

在 ASP.NET MVC 本身中，我喜欢编写**动作过滤器**和**自定义路由约束**，在模型和控制器之间取得平衡，思考域对象，与 POCO 和持久性无知作斗争，并编写了大量**AJAX**代码。

作为一名网络开发人员，我非常喜欢它。**在此过程中，当我意识到他们在 MVC、 DDD**和 ORM 方面的实力（更不用说一些伟大的开源计划）时，我也对 Ruby on Rails 和 Java 社区产生了极大的尊重。

除非你弄脏你的手，否则你真的不会欣赏它的全部内容。把它作为一种爱好，给它一个月。我可以向您保证，您将成为比现在更好的开发人员，并且您会非常感激这些东西，如果不是全部的话。这确实是一种范式转变，已经在 RoR/Java 社区中发生，而 .NET 直到现在才刚刚赶上。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T17:54:25.750

整个想法是将业务逻辑（模型）与 UI（视图）与两者（控制器）之间的通信和数据传输方法分开。

这样，业务逻辑程序员可以专注于编写无错误的逻辑模块，而设计师可以专注于构建可用的 UI。如果 MVC 设计良好，您应该能够通过控制器将这两者“插入”在一起，并依靠每层之间建立的合同来确保一切正常。

如果需要重构或替换任何层，则该过程要容易得多，因为可以使用其他层而无需进行很多更改。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T17:46:46.987

对我来说最大的好处是当您使用 MVC 时可以清楚地分离关注点。这在传统的 Web 表单编程中很难实现。

单元测试的好处也非常好。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-15T19:35:33.060

MVC 作为多层应用程序的设计模式和框架并不是什么新鲜事。将数据与视图分开并将访问委托给控制器显然是有意义的。与其说是管理复杂性，不如说是关于可重用性和维护代码库。如果代码库遵循 mvc 模式，任何人都更容易在代码库上工作。更聪明的人可以给你一个更深入的解释它的优点。我想我不明白为什么 MVC 会与 net 3.0 互斥？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T19:06:33.520

> 而且我不明白为什么实际上在 SQL Server 或 MySQL 中编写 SQL 是那么痛苦，我也不了解 ORM 的好处

SQL 是不可组合的。ORM 条件通常是。

> 比 .Net 3.0 更可取，我的大部分代码和时间不是花在数据管理上，而是前端工作

我已经完成了 .NET 和 Rails，我怀疑这是 .NET 对于前端工作过于冗长的症状。在更简洁的框架中，前端是如此之小，以至于编写 SQL 是一个瓶颈。

# php - 使用 Curl 获取图像尺寸

> ID：869989
> 
> 赞同：1
> 
> 时间：2009-05-15T17:42:07.293
> 
> 标签：php, curl

我想要远程图像的高度*宽度。这可以用 Curl 完成吗？如果可以，怎么做？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-15T17:48:14.330

[getimagesize()](http://www.php.net/manual/en/function.getimagesize.php)是您想要的功能。

它应该能够下载远程图像并对其进行分析。

编辑：作为对您问题的更直接回答，Curl 无法直接分析图像，但它当然可以为您获取图像，在这种情况下，您可以使用 GD 库对其进行分析。getimagesize() 也可以进行获取，因此您可以将 Curl 排除在等式之外。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-04-08T06:31:26.940

希望这篇单独的帖子是有道理的，因为我担心这个答案会作为对我之前帖子的评论而丢失。你问，为什么认为这值得一个单独的帖子？好吧，我想我已经找到了答案。

诚然，我使用的是 CLI 版本而不是 libcurl（以您选择的语言），但在得到有效的答案之前，我一直在折腾。如下：

```
curl -r 0-25 --silent http://www.google.com/logos/giroux1.jpg | identify -format "%wx%h" - 
```

在上面的示例中发生的情况是 CURL 使用 -r 标志仅请求文件的前 25 个字节，并将其传送到名为 IDENTIFY 的 imagemagick 命令，在那里它提取尺寸并以指定的格式打印出来。

有关您可以使用 IDENTIFY 提取的信息的更多信息，请访问[http://www.imagemagick.org/script/identify.php](http://www.imagemagick.org/script/identify.php)

为了使命令对脚本更友好，我将在末尾添加“2> /dev/null”以抑制错误消息（stderr）：

```
curl -r 0-25 --silent http://www.google.com/logos/giroux1.jpg | identify -quiet -format "%wx%h" - 2> /dev/null 
```

与尺寸似乎与前 10-20 个字节紧密相关的 GIF 图像不同，从 JPEG 获取尺寸数据似乎不需要固定数量的字节。更多测试表明，对于大图像，您可能需要最多请求前约 10k 才能获取尺寸数据。一个很好的例子是来自 NASA 的以下 4MB 图像：http: [//veimages.gsfc.nasa.gov/17921/southern_africa_25jul02_lrg.jpg](http://veimages.gsfc.nasa.gov/17921/southern_africa_25jul02_lrg.jpg)我发现不少于 5971 字节将呈现尺寸（10836 x 9324），但我想这是比必须下载整个东西更好。

重点是...您的里程可能会有所不同，因此请自己尝试一下。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T17:45:37.287

卷曲不能那样做。引自[http://curl.haxx.se/](http://curl.haxx.se/)

> Blockquote curl 是一个命令行工具，用于传输带有 URL 语法的文件，支持 FTP、FTPS、HTTP、HTTPS、SCP、SFTP、TFTP、TELNET、DICT、LDAP、LDAPS 和 FILE。curl 支持 SSL 证书、HTTP POST、HTTP PUT、FTP 上传、基于 HTTP 表单的上传、代理、cookie、用户+密码身份验证（Basic、Digest、NTLM、Negotiate、kerberos...）、文件传输恢复、代理隧道和大量其他有用的技巧。

Curl 可用于查看 http 标头并猜测图像类型，但要确定图像的尺寸，您将需要图像本身。

您可以使用例如。[Python Imaging Library](http://www.pythonware.com/products/pil/ "Python 图像库")在下载图像时实际检查尺寸。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-15T17:50:20.160

图像的高度和宽度是图像文件中的属性，您需要检索文件才能访问它们。根据图像格式，此属性将位于图像元数据的不同位置。您可以使用 getimagesize 执行此操作，但请记住，您实际上是在检索完整图像，这将影响操作的性能。

如果图像很大，您可以尝试开始将图像传输到服务器，一旦您开始接收数据并知道图像的格式，就等到从图像接收到足够的数据以查看高度和宽度信息并停止传输。您很可能需要自己完成这项工作，因为图像库和 API 中的内置函数可能需要完整的图像才能正常工作。

如果您偶然控制了图像所在的服务器，则最好编写一个托管在该服务器中的小脚本，该脚本给定图像文件标识符，返回该图像的高度和宽度。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-07T05:08:12.837

根据 CURL 文档：

> HTTP 1.1 引入了字节范围。使用它，客户端可以请求仅获取指定文档的一个或多个子部分。Curl 使用 -r 标志支持这一点。
> 
> ```
> Get the first 100 bytes of a document:  
>     curl -r 0-99 http://www.get.this/
> 
> Get the last 500 bytes of a document:  
>     curl -r -500 http://www.get.this/ 
> ```

鉴于您可以通过 CURL 仅请求图像的一部分，您很*可能*能够完成您想要做的事情。现在的关键是能够将部分图像传递给 GD（或您选择的应用程序）之类的东西，以提取和报告图像尺寸。

如果您只使用 JPEG，您的生活会变得更轻松，因为尺寸存储在带有指定标记的标题中的文件开头。请参阅 stackoverflow 上的另一个讨论，标题为“[从二进制文件中获取 JPEG 的图像大小](https://stackoverflow.com/questions/2517854/getting-image-size-of-jpeg-from-its-binary)”。

虽然它需要更多的工作，但看起来像这样会让你找到正确的标记：

```
curl -r 0-999 --url http://www.google.com/logos/giroux1.jpg | grep -n $'\xc0' 
```

* * *

我在搜索 JPEG 信息时遇到的其他一些参考资料：

*   在 C++ 中读取 JPEG 尺寸而不读取整个文件

    [http://www.64lines.com/jpeg-width-height](http://www.64lines.com/jpeg-width-height)

*   在 C# 中读取 JPEG 尺寸而不读取整个文件

    [http://code.msdn.microsoft.com/ReadingJPEGSize](http://code.msdn.microsoft.com/ReadingJPEGSize)

*   在 Java 中读取 JPEG 尺寸而不读取整个文件

    [Java/ImageIO 在不读取整个文件的情况下获取图像尺寸？](https://stackoverflow.com/questions/1559253/java-imageio-getting-image-dimension-without-reading-the-entire-file)

*   JPEG 标头信息

    [http://web.archive.org/web/20080224153210/http://www.obrador.com/essentialjpeg/headerinfo.htm](http://web.archive.org/web/20080224153210/http://www.obrador.com/essentialjpeg/headerinfo.htm)

# java - IBM Developer Kit for Java for iSeries (AS/400) Javadocs 的位置

> ID：869991
> 
> 赞同：3
> 
> 时间：2009-05-15T17:42:26.653
> 
> 标签：java, ibm-midrange

有谁知道我在哪里可以找到适用于 iSeries 的 IBM Developer Kit for Java 的 Javadoc？[信息中心](http://publib.boulder.ibm.com/infocenter/iseries/v6r1m0/topic/rzaha/whatitis.htm)好像没有。我所能找到的只是 iSeries 特定 JAAS 的 Javadoc。

具体来说，我正在寻找用于编写 Java 存储过程（主要是`com.ibm.db2.app`包）的 Javadoc。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T18:41:34.623

查看 Redbook [Stored Procedures, Triggers, and User-Defined Functions on DB2 Universal Database for iSeries](http://www.redbooks.ibm.com/abstracts/sg246503.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-18T19:07:58.243

尝试[有关 Java 存储过程的 V5R3 文档](http://publib.boulder.ibm.com/infocenter/iseries/v5r3/index.jsp?topic=/rzaha/javaproc.htm)。

是的，我也没有找到。您是否考虑[过自己打印 Javadoc](http://java.sun.com/j2se/javadoc/)？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-04T12:35:02.897

[您可以在http://sourceforge.net/project/showfiles.php?group_id=128806&package_id=141064](http://sourceforge.net/project/showfiles.php?group_id=128806&package_id=141064)下载 JTOpen 的 javadoc 。

请记住，这是开源版本，尽管它仍然由 IBM 编写。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-05-06T08:57:52.093

事实证明，IBM 没有为 iSeries 的 IBM Developer Kit 发布 Javadoc。唯一的信息来源是信息中心和像 JamesA 的答案中列出的红皮书。********