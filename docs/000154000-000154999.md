# StackOverflow 问答 000154000-000154999

# javascript - 将文本传递给可能有单引号的 javascript 函数

> ID：154004
> 
> 赞同：3
> 
> 时间：2008-09-30T17:03:03.387
> 
> 标签：javascript

我有一个动态创建的链接，如下所示：

```
<a onclick="Edit('value from a text column here')" href="javascript:void(null);">Edit</a> 
```

使用 Edit 函数，然后将传入的值放入 Yahoo 富文本编辑器。这很好用，除非在传递的文本中有单引号。明显的问题是链接看起来像：

```
<a onclick="Edit('I'm a jelly donut')" href="javascript:void(null);">Edit</a> 
```

关于我能做什么的任何建议？我宁愿不要偏离我目前使用的结构太远，因为它是一种标准（也许标准很糟糕，但这完全是另一个问题）。

注意：我使用 ASP 作为我的服务器端语言。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-30T17:04:37.877

在将引号字符`&quot;`插入 HTML 之前，将它们转换为它们的 HTML 等价物等。维基百科上有[很长](http://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references)的 HTML/XML 字符代码列表。

很可能有一个函数可以为您执行此操作，具体取决于您如何动态生成代码：PHP 有[htmlspecialchars](http://uk.php.net/htmlspecialchars)，虽然我不熟悉 ASP 等，但我确信有类似的例程。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T17:20:47.980

您可以将 ' 替换为 \'

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T17:20:38.480

通过转义函数运行文本以在 ' 之前放置一个 \。如果您在服务器上生成链接，我们需要知道您使用的服务器端语言以提供更具体的建议。

如果您在 javascript 中将标签客户端生成为字符串（不要这样做，请使用 document.createElement），请在参数字符串上使用[String.replace](http://www.w3schools.com/jsref/jsref_replace.asp)方法来挑选出会破坏您所使用的语法的字符生成并用转义版本替换它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T21:06:36.127

我看到至少三个额外的可能性：

### JavaScript Unicode 转义

```
<a onclick="Edit('I\u0027m a jelly donut')" href="javascript:void(null);">Edit</a> 
```

因为 \u0027 是引用的 javascript espace 字符。其他不太实用：

### JavaScript 函数

```
<script>function getQuote() { return "'" }</script>
<a onclick="Edit('I' + getQuote() + 'm a jelly donut')" href="javascript:void(null);">Edit</a> 
```

和：

### JavaScript 全局变量

```
<script>var g_strJellyText = "I\u0027m a jelly donut"</script>
<a onclick="Edit(g_strJellyText)" href="javascript:void(null);">Edit</a> 
```

但我相信您已经考虑过这些解决方案（或其变体，或 Chris Johnson 提到的 HTML 实体转义）。

尽管如此，还是值得一提的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T17:10:13.340

所以似乎还有更多事情要做，其中大多数可能在大多数情况下都可以工作，但为了后代的利益，这就是我必须做的。

被拉入富文本编辑器的信息位于 YUI 数据表中，我正在使用自定义格式化程序原型为所述控件创建一个链接。

使用“用\'替换'”方法的问题是我仍然需要以相同的方式查看数据表中显示的文本。

使用 htmlspecialchars (Server.HTMLEncode) 的 ASP 等价物的问题在于，它在从自定义格式化程序函数生成的 javascript 中仍然存在问题。我不知道究竟是为什么，但我确实尝试过，但没有奏效。该答案最接近我提出的答案（并将我推向正确的方向），因此我接受了该答案。

我所做的是使用 javascript 函数 'escape' 传递给我的编辑函数，然后 unescape 为富文本编辑器设置内部 HTML。

# asp.net - 如何在 RSS 提要中显示文章链接和子提要链接？

> ID：154008
> 
> 赞同：1
> 
> 时间：2008-09-30T17:03:24.620
> 
> 标签：asp.net, rss

我正在为我们拥有的自定义任务系统开发一些 RSS 提要。主提要将显示分配给当前用户的任务列表。返回的每个任务的链接属性指向该任务的网页。但是，任务本身有一个用于更新的 RSS 提要，我也希望能够为该 RSS 提要与主提要提供链接。我怎样才能做到这两点？

我现在正在考虑的解决方案是将文章的`title`属性设置为包含`<a href="..."`指向实际文章的链接，并将其`link`属性设置为指向提要的链接（反之亦然）。但是，我不确定这是否会奏效，因为大多数读者将标题显示为链接到链接（如果这对您有任何意义）。

另外，这是 atom 原生支持的东西吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T17:34:07.620

在原始 RSS 提要 HTML 中制作每个项目的内容。（我相信你必须让 CDATA 逃离这个块）。在此内容中放置一个指向更新提要 RSS 的超链接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T17:31:40.167

为什么不将其作为链接添加到条目摘要中？

> ID：154013
> 
> 赞同：
> 
> 时间：
> 
> 标签：

None

# c# - .NET 相当于 Java 线程组？

> ID：154016
> 
> 赞同：3
> 
> 时间：2008-09-30T17:04:10.703
> 
> 标签：c#, .net, multithreading

我正在尝试监视用 C# 编写的 Microsoft.NET 应用程序中一组线程的状态。我还希望能够监视由原始线程产生的任何子线程。

在 Java 中，您可以将线程分配给一个线程组，它们的子级也将属于该组。.NET 中是否有等价物？

我简要查看了 ExecutionContext 和 LogicalCallContext，但我看不到如何找到上下文中的所有线程。Raymond Chen 有一篇关于枚举线程的[Win32 API 方法](http://blogs.msdn.com/oldnewthing/archive/2006/02/23/537856.aspx)的文章，但我希望我不必那么低。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T18:29:13.900

您可以使用System.Diagnostics.Process的[Threads属性枚举进程中的线程。](http://msdn.microsoft.com/de-de/library/system.diagnostics.process.threads(VS.80).aspx)

但是请注意，您在此处获得的对象与您自己创建以启动线程的对象类型不同（即不是 System.Threading.Thread 对象）。

然而，AFAIK 并不存在线程组的概念。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T12:25:35.263

他们正在他们的“任务”API 中进行类似的工作，这是并行扩展的一部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T16:43:13.673

让它简单：

使用包装线程创建过程的方法创建您的 ThreadGroup 类。

调用此方法时，它会将创建的线程添加到 Collection 中，并且存在您的组。

# java - 在 java 正则表达式中，我怎样才能得到一个字符类，例如 [az] 来匹配 - 减号？

> ID：154031
> 
> 赞同：18
> 
> 时间：2008-09-30T17:08:24.780
> 
> 标签：java, regex

```
Pattern pattern = Pattern.compile("^[a-z]+$");
String string = "abc-def";
assertTrue( pattern.matcher(string).matches() ); // obviously fails 
```

是否可以让字符类匹配 "-" ？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-30T17:09:36.273

不要在字符之间放置减号。

```
"[a-z-]" 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-30T17:09:12.500

转义减号

```
[a-z\\-] 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-11-19T09:06:09.217

在字符类中，**如果**两边都被字符包围，则`[...]`a`-`将被特殊处理（作为范围运算符） 。这意味着如果您在字符类的开头或结尾包含 ，它将被逐字处理（非特殊）。**`-`**

 **所以你可以使用正则表达式：

```
^[a-z-]+$ 
```

或者

```
^[-a-z]+$ 
```

由于`-`我们添加的内容是按字面意思处理的，因此无需逃避它。虽然如果你这样做不是错误。

另一种（不太推荐）的方法是不包括`-`在字符类中：

```
^(?:[a-z]|-)+$ 
```

请注意，在这种情况下，括号不是可选的，因为`|`优先级非常低，因此使用括号：

```
^[a-z]|-+$ 
```

将匹配字符串开头的小写字母和结尾的一个或多个`-`。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-30T18:15:08.800

我会更具体地改写“不要把它放在角色之间”。

使破折号成为字符类中的第一个或最后一个字符。例如“[-a-z1-9]”匹配小写字符、数字或破折号。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-30T17:17:57.813

这对我有用

```
 Pattern p = Pattern.compile("^[a-z\\-]+$");
   String line = "abc-def";
   Matcher matcher = p.matcher(line);
   System.out.println(matcher.matches());  // true 
```

# sql - 如何在 SSIS 中打开 FastParse 选项？

> ID：154041
> 
> 赞同：4
> 
> 时间：2008-09-30T17:09:48.160
> 
> 标签：sql, sql-server, ssis

我购买的帮助我理解 SSIS 的书似乎掩盖了这一点，我想知道在 SSIS 中打开 FastParse 的确切方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T17:14:02.707

设置快速解析（从[这里](http://msdn.microsoft.com/en-us/library/ms139833.aspx)）

1.  右键单击平面文件源或数据转换转换，然后单击显示高级编辑器。
2.  在“高级编辑器”对话框中，单击“输入和输出属性”选项卡。
3.  在 Inputs and Outputs 窗格中，单击要为其启用快速解析的列。
4.  在“属性”窗口中，展开“自定义属性”节点，然后将 FastParse 属性设置为 True。
5.  单击确定。

# java - 在实现接口的控制器上使用 @Controller 的 Spring-MVC 问题

> ID：154042
> 
> 赞同：35
> 
> 时间：2008-09-30T17:09:51.390
> 
> 标签：java, spring-mvc, controller, annotations

我正在使用 spring 2.5 和注释来配置我的 spring-mvc web 上下文。不幸的是，我无法使以下工作。我不确定这是否是一个错误（似乎是这样），或者是否对注释和接口实现子类化的工作方式存在基本误解。

例如，

```
@Controller
@RequestMapping("url-mapping-here")
public class Foo {
  @RequestMapping(method=RequestMethod.GET)
  public void showForm() {
    ...
  }
  @RequestMapping(method=RequestMethod.POST)
  public String processForm() {
  ...
  }
} 
```

工作正常。当上下文启动时，会发现这个处理程序处理的 url，并且一切正常。

然而，这不会：

```
@Controller
@RequestMapping("url-mapping-here")
public class Foo implements Bar {
  @RequestMapping(method=RequestMethod.GET)
  public void showForm() {
    ...
  }
  @RequestMapping(method=RequestMethod.POST)
  public String processForm() {
  ...
  }
} 
```

当我尝试提取 url 时，我得到以下讨厌的堆栈跟踪：

```
javax.servlet.ServletException: No adapter for handler [com.shaneleopard.web.controller.RegistrationController@e973e3]: Does your handler implement a supported interface like Controller?
    org.springframework.web.servlet.DispatcherServlet.getHandlerAdapter(DispatcherServlet.java:1091)
    org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:874)
    org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:809)
    org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:571)
    org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:501)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:627) 
```

但是，如果我将 Bar 更改为抽象超类并让 Foo 扩展它，那么它会再次起作用。

```
@Controller
@RequestMapping("url-mapping-here")
public class Foo extends Bar {
  @RequestMapping(method=RequestMethod.GET)
  public void showForm() {
    ...
  }
  @RequestMapping(method=RequestMethod.POST)
  public String processForm() {
  ...
  }
} 
```

这似乎是一个错误。@Controller 注释应该足以将其标记为控制器，并且我应该能够在我的控制器中实现一个或多个接口，而无需执行任何其他操作。有任何想法吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-07-06T22:13:48.593

我需要做的是更换

```
 <tx:annotation-driven/> 
```

和

```
 <tx:annotation-driven  proxy-target-class="true"/> 
```

这迫使 aspectj 使用 CGLIB 来执行切面而不是动态代理——CGLIB 不会丢失注释，因为它扩展了类，而动态代理只公开了实现的接口。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-03-01T20:11:17.480

埃德是对的，添加

```
<bean class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping"/>
<bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter"/> 
```

工作正常

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-10-23T11:10:56.233

如果您希望为 Spring MVC 控制器使用接口，则需要稍微移动注释，如 Spring 文档中所述： http: [//static.springsource.org/spring/docs/3.1.x/spring-framework -reference/html/mvc.html#mvc-ann-requestmapping](http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/mvc.html#mvc-ann-requestmapping)

> 在接口方法上使用@RequestMapping 在使用需要为控制器对象创建代理的功能（例如@Transactional 方法）时，会发生使用带注释的控制器类时的常见缺陷。通常您会为控制器引入一个接口，以便使用 JDK 动态代理。要完成这项工作，您必须将 @RequestMapping 注释移动到接口，并且映射机制只能“看到”代理公开的接口。或者，您可以在配置中为应用于控制器的功能激活 proxy-target-class="true"（在我们的事务场景中）。这样做表明应该使用基于 CGLIB 的子类代理而不是基于接口的 JDK 代理。

不幸的是，它没有给出具体的例子。我发现这样的设置有效：

```
@Controller
@RequestMapping(value = "/secure/exhibitor")
public interface ExhibitorController {

    @RequestMapping(value = "/{id}")
    void exhibitor(@PathVariable("id") Long id);
}

@Controller
public class ExhibitorControllerImpl implements ExhibitorController {

    @Secured({"ROLE_EXHIBITOR"})
    @Transactional(readOnly = true)
    @Override
    public void exhibitor(final Long id) {

    }
} 
```

所以你在这里有一个接口，它声明了@Controller、@PathVariable 和@RequestMapping 注释（Spring MVC 注释），然后你可以将@Transactional 或@Secured 注释放在具体类上。由于 Spring 进行映射的方式，您只需要在接口上放置 @Controller 类型注释。

请注意，只有在使用接口时才需要这样做。如果您对 CGLib 代理感到满意，则不一定需要这样做，但如果出于某种原因您想使用 JDK 动态代理，这可能是可行的方法。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-10T06:22:49.837

毫无疑问，注释和继承会有点棘手，但我认为这应该可行。尝试将 AnnotationMethodHandlerAdapter 显式添加到您的 servlet 上下文中。

[http://static.springframework.org/spring/docs/2.5.x/reference/mvc.html#mvc-ann-setup](http://static.springframework.org/spring/docs/2.5.x/reference/mvc.html#mvc-ann-setup)

如果这不起作用，更多信息会有所帮助。具体来说，这两个带注释的控制器方法是否来自接口？Foo 应该是 RegistrationController 吗？

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-04-13T06:55:04.757

我知道为时已晚，但如果您使用基于注释的配置，我正在为任何有此问题的人写这篇文章......解决方案可能是这样的：

```
@Configuration
@ComponentScan("org.foo.controller.*")
@EnableAspectJAutoProxy(proxyTargetClass=true)
public class AppConfig { ...} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-09-05T08:46:25.840

您需要使用 'proxy-target-class="true"' 的真正原因在于`DefaultAnnotationHandlerMapping#determineUrlsForHandler()`方法：虽然它`ListableBeanFactory#findAnnotationOnBean`用于查找`@RequestMapping`注释（并且这会处理任何代理问题），但额外的`@Controller`注释查找是使用`AnnotationUtils#findAnnotation`(不处理代理问题）

# javascript - 如何在 JavaScript 中检查空/未定义/空字符串？

> ID：154059
> 
> 赞同：3516
> 
> 时间：2008-09-30T17:17:45.273
> 
> 标签：javascript, null, is-empty

我看到了[这个问题](https://stackoverflow.com/questions/10230/checking-for-string-contents-string-length-vs-empty-string)，但没有看到 JavaScript 特定的示例。JavaScript中是否有一个简单的`string.Empty`可用，或者它只是一个检查的情况`""`？

* * *

## 回答 #1

> 赞同：4357
> 
> 时间：2008-09-30T17:20:14.207

如果你只是想检查是否有[真值](https://developer.mozilla.org/en-US/docs/Glossary/Truthy)，你可以这样做：

```
if (strValue) {
    //do something
} 
```

如果您需要专门检查空字符串而不是空字符串，我认为检查`""`是您最好的选择，使用[运算符](http://webreference.com/js/column26/stricteq.html)[（`===`](http://webreference.com/js/column26/stricteq.html)这样您就知道它实际上是您要比较的字符串）。

```
if (strValue === "") {
    //...
} 
```

* * *

## 回答 #2

> 赞同：1339
> 
> 时间：2010-07-16T01:45:58.773

为了检查变量是否为[假](https://developer.mozilla.org/en-US/docs/Glossary/Falsy)或者它的长度属性是否等于零（对于字符串来说，这意味着它是空的），我使用：

```
function isEmpty(str) {
    return (!str || str.length === 0 );
} 
```

[（请注意，字符串不是唯一具有`length`属性的变量，例如，数组也有它们。）]

为了检查变量是否为假或字符串是否仅包含空格或为空，我使用：

```
function isBlank(str) {
    return (!str || /^\s*$/.test(str));
} 
```

如果你愿意，你可以像这样对原型进行[猴子补丁：](https://www.audero.it/blog/2016/12/05/monkey-patching-javascript/)`String`

```
String.prototype.isEmpty = function() {
    // This doesn't work the same way as the isEmpty function used 
    // in the first example, it will return true for strings containing only whitespace
    return (this.length === 0 || !this.trim());
};
console.log("example".isEmpty()); 
```

[请注意，猴子修补内置类型是有争议的，因为无论出于何种原因，它都可能破坏依赖于内置类型现有结构的代码。]

* * *

## 回答 #3

> 赞同：486
> 
> 时间：2011-03-30T13:34:22.147

以前的所有答案都很好，但这会更好。使用双重 NOT 运算符 ( `!!`)：

```
if (!!str) {
    // Some code here
} 
```

或使用类型转换：

```
if (Boolean(str)) {
    // Code here
} 
```

两者都执行相同的功能。将变量类型转换为布尔值，其中`str`是一个变量。

*   它返回`false`, `null`, `undefined`, `0`, `000`, `""`。`false`

*   它返回`true`除空字符串以外的所有字符串值（包括和之类的`"0"`字符串`" "`）

* * *

## 回答 #4

> 赞同：125
> 
> 时间：2008-09-30T19:17:32.003

您可以得到的最接近的东西`str.Empty`（前提是 str 是一个字符串）是：

```
if (!str.length) { ... 
```

* * *

## 回答 #5

> 赞同：111
> 
> 时间：2008-09-30T23:08:32.510

如果您需要确保字符串不仅仅是一堆空格（我假设这是用于表单验证），您需要对空格进行替换。

```
if(str.replace(/\s/g,"") == ""){
} 
```

* * *

## 回答 #6

> 赞同：71
> 
> 时间：2010-07-09T18:52:40.450

我用：

```
function empty(e) {
  switch (e) {
    case "":
    case 0:
    case "0":
    case null:
    case false:
    case typeof(e) == "undefined":
      return true;
    default:
      return false;
  }
}

empty(null) // true
empty(0) // true
empty(7) // false
empty("") // true
empty((function() {
    return ""
})) // false 
```

* * *

## 回答 #7

> 赞同：55
> 
> 时间：2017-08-17T06:51:14.923

您可以使用[lodash](https://lodash.com/)：_.isEmpty(value)。

它涵盖了很多情况，例如`{}`, `''`, `null`,`undefined`等。

但它总是返回[JavaScript 原始数据类型](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures)的`true`类型，例如 return或两者都返回。`Number``_.isEmpty(10)``_.isEmpty(Number.MAX_VALUE)``true`

* * *

## 回答 #8

> 赞同：55
> 
> 时间：2019-12-31T18:48:11.937

## 表现

我在[macOS v10.13.6](https://en.wikipedia.org/wiki/MacOS_High_Sierra) (High Sierra) 上针对 18 个选定的解决方案进行了测试。解决方案的工作方式略有不同（对于极端情况输入数据），如下面的片段中所示。

**结论**

*   基于 、 和 的简单解决方案适用于`!str`所有`==`浏览`===`器`length`（A、B、C、G、I、J）
*   基于正则表达式 ( `test`, `replace`)的解决方案`charAt`对于所有浏览器 (H,L,M,P) 都是最慢的
*   标记为最快的解决方案仅在一次测试运行中最快 - 但在许多运行中它会在“快速”解决方案组内发生变化

[![在此处输入图像描述](https://i.stack.imgur.com/bFeGV.png)](https://i.stack.imgur.com/bFeGV.png)

## 细节

在下面的片段中，我通过使用不同的输入参数比较了选择的 18 种方法的结果

*   `""` `"a"` `" "`- 空字符串、带字母的字符串和带空格的字符串
*   `[]` `{}` `f`- 数组、对象和函数
*   `0` `1` `NaN` `Infinity`- 数字
*   `true` `false`- 布尔值
*   `null` `undefined`

并非所有经过测试的方法都支持所有输入案例。

```
function A(str) {
  let r=1;
  if (!str)
    r=0;
  return r;
}

function B(str) {
  let r=1;
  if (str == "")
    r=0;
  return r;
}

function C(str) {
  let r=1;
  if (str === "")
    r=0;
  return r;
}

function D(str) {
  let r=1;
  if(!str || 0 === str.length)
    r=0;
  return r;
}

function E(str) {
  let r=1;
  if(!str || /^\s*$/.test(str))
    r=0;
  return r;
}

function F(str) {
  let r=1;
  if(!Boolean(str))
    r=0;
  return r;
}

function G(str) {
  let r=1;
  if(! ((typeof str != 'undefined') && str) )
    r=0;
  return r;
}

function H(str) {
  let r=1;
  if(!/\S/.test(str))
    r=0;
  return r;
}

function I(str) {
  let r=1;
  if (!str.length)
    r=0;
  return r;
}

function J(str) {
  let r=1;
  if(str.length <= 0)
    r=0;
  return r;
}

function K(str) {
  let r=1;
  if(str.length === 0 || !str.trim())
    r=0;
  return r;
}

function L(str) {
  let r=1;
  if ( str.replace(/\s/g,"") == "")
    r=0;
  return r;
}

function M(str) {
  let r=1;
  if((/^\s*$/).test(str))
    r=0;
  return r;
}

function N(str) {
  let r=1;
  if(!str || !str.trim().length)
    r=0;
  return r;
}

function O(str) {
  let r=1;
  if(!str || !str.trim())
    r=0;
  return r;
}

function P(str) {
  let r=1;
  if(!str.charAt(0))
    r=0;
  return r;
}

function Q(str) {
  let r=1;
  if(!str || (str.trim()==''))
    r=0;
  return r;
}

function R(str) {
  let r=1;
  if (typeof str == 'undefined' ||
      !str ||
      str.length === 0 ||
      str === "" ||
      !/[^\s]/.test(str) ||
      /^\s*$/.test(str) ||
      str.replace(/\s/g,"") === "")

    r=0;
  return r;
}

// --- TEST ---

console.log(                  '   ""  "a"  " " [] {} 0 1 NaN Infinity f true false null undefined ');
let log1 = (s,f)=> console.log(`${s}: ${f("")}   ${f("a")}    ${f(" ")}   ${f([])}  ${f({})}  ${f(0)} ${f(1)} ${f(NaN)}   ${f(Infinity)}        ${f(f)} ${f(true)}    ${f(false)}     ${f(null)}    ${f(undefined)}`);
let log2 = (s,f)=> console.log(`${s}: ${f("")}   ${f("a")}    ${f(" ")}   ${f([])}  ${f({})}  ${f(0)} ${f(1)} ${f(NaN)}   ${f(Infinity)}        ${f(f)} ${f(true)}    ${f(false)}`);
let log3 = (s,f)=> console.log(`${s}: ${f("")}   ${f("a")}    ${f(" ")}`);

log1('A', A);
log1('B', B);
log1('C', C);
log1('D', D);
log1('E', E);
log1('F', F);
log1('G', G);
log1('H', H);

log2('I', I);
log2('J', J);

log3('K', K);
log3('L', L);
log3('M', M);
log3('N', N);
log3('O', O);
log3('P', P);
log3('Q', Q);
log3('R', R);
```

然后对于所有方法，我`str = ""`为浏览器 Chrome v78.0.0、Safari v13.0.4 和 Firefox v71.0.0 执行速度测试用例 - 您可以在[此处在您的机器上运行测试](https://jsperf.com/empty-string-checking/1)

[![在此处输入图像描述](https://i.stack.imgur.com/IxaPG.png)](https://i.stack.imgur.com/IxaPG.png)

* * *

## 回答 #9

> 赞同：42
> 
> 时间：2014-02-27T20:31:28.310

非常通用的“一体化”功能（*虽然不推荐*）：

```
function is_empty(x)
{
    return (                                                           //don't put newline after return
        (typeof x == 'undefined')
              ||
        (x == null)
              ||
        (x == false)        //same as: !x
              ||
        (x.length == 0)
              ||
        (x == 0)            // note this line, you might not need this. 
              ||
        (x == "")
              ||
        (x.replace(/\s/g,"") == "")
              ||
        (!/[^\s]/.test(x))
              ||
        (/^\s*$/.test(x))
    );
} 
```

但是，我不建议使用它，因为您的目标变量应该是特定类型（即字符串、数字或对象？），因此请应用与该变量相关的检查。

* * *

## 回答 #10

> 赞同：39
> 
> 时间：2008-09-30T17:42:32.543

```
var s; // undefined
var s = ""; // ""
s.length // 0 
```

JavaScript 中没有任何内容代表空字符串。进行检查`length`（如果您知道 var 将始终是字符串）或检查`""`

* * *

## 回答 #11

> 赞同：37
> 
> 时间：2013-01-09T02:54:50.370

尝试：

```
if (str && str.trim().length) {  
    //...
} 
```

* * *

## 回答 #12

> 赞同：31
> 
> 时间：2008-09-30T17:20:57.323

我不会太担心最**有效**的方法。使用对您的意图最清楚的内容。对我来说这通常是`strVar == ""`.

根据来自[Constantin](https://stackoverflow.com/users/20310/constantin)的评论，如果 strVar 可能最终包含一个整数 0 值，那么这确实是那些意图澄清的情况之一。

* * *

## 回答 #13

> 赞同：21
> 
> 时间：2010-05-31T14:57:38.887

您也可以使用正则表达式：

```
if((/^\s*$/).test(str)) { } 
```

检查为空或填充有空格的字符串。

* * *

## 回答 #14

> 赞同：21
> 
> 时间：2016-03-31T08:29:46.890

很多答案，还有很多不同的可能性！

毫无疑问，为了快速简单的实施，获胜者是：`if (!str.length) {...}`

但是，还有许多其他示例可用。我建议最好的功能方法：

```
function empty(str)
{
    if (typeof str == 'undefined' || !str || str.length === 0 || str === "" || !/[^\s]/.test(str) || /^\s*$/.test(str) || str.replace(/\s/g,"") === "")
        return true;
    else
        return false;
}
```

有点过分，我知道。

* * *

## 回答 #15

> 赞同：20
> 
> 时间：2015-02-24T15:38:42.140

1.  检查`var a;`存在
2.  修剪掉`false spaces`in 值，然后测试`emptiness`

    ```
    if ((a)&&(a.trim()!=''))
    {
      // if variable a is not empty do this 
    } 
    ```

* * *

## 回答 #16

> 赞同：18
> 
> 时间：2013-08-09T10:10:50.573

我通常使用这样的东西，

```
if (!str.length) {
    // Do something
} 
```

* * *

## 回答 #17

> 赞同：17
> 
> 时间：2013-05-15T14:55:15.700

此外，如果您将空格填充的字符串视为“空”。

您可以使用以下正则表达式对其进行测试：

```
!/\S/.test(string); // Returns true if blank. 
```

* * *

## 回答 #18

> 赞同：15
> 
> 时间：2014-10-01T06:55:13.743

如果一个人不仅需要检测空字符串，还需要检测空字符串，我将添加到 Goral 的答案中：

```
function isEmpty(s){
    return !s.length;    
}

function isBlank(s){
    return isEmpty(s.trim());    
} 
```

* * *

## 回答 #19

> 赞同：13
> 
> 时间：2011-06-01T15:40:33.437

我使用组合，最快的检查是第一个。

```
function isBlank(pString) {
    if (!pString) {
        return true;
    }
    // Checks for a non-white space character
    // which I think [citation needed] is faster
    // than removing all the whitespace and checking
    // against an empty string
    return !/[^\s]+/.test(pString);
} 
```

* * *

## 回答 #20

> 赞同：13
> 
> 时间：2020-02-10T08:34:31.653

从...开始：

```
return (!value || value == undefined || value == "" || value.length == 0); 
```

查看最后一个条件，如果 value == ""，则它的长度*必须*为 0。因此删除它：

```
return (!value || value == undefined || value == ""); 
```

可是等等！在 JavaScript 中，空字符串为假。因此，丢弃值 == ""：

```
return (!value || value == undefined); 
```

并且 !undefined 为真，因此不需要检查。所以我们有：

```
return (!value); 
```

而且我们不需要括号：

```
return !value 
```

* * *

## 回答 #21

> 赞同：12
> 
> 时间：2012-07-31T14:05:04.670

我没有注意到考虑到字符串中可能存在空字符的答案。例如，如果我们有一个空字符串：

```
var y = "\0"; // an empty string, but has a null character
(y === "") // false, testing against an empty string does not work
(y.length === 0) // false
(y) // true, this is also not expected
(y.match(/^[\s]*$/)) // false, again not wanted 
```

为了测试它的空性，可以做这样的事情：

```
String.prototype.isNull = function(){ 
  return Boolean(this.match(/^[\0]*$/)); 
}
...
"\0".isNull() // true 
```

它适用于空字符串和空字符串，并且可用于所有字符串。此外，它可以扩展为包含其他 JavaScript 空字符或空白字符（即不间断空格、字节顺序标记、行/段落分隔符等）。

* * *

## 回答 #22

> 赞同：11
> 
> 时间：2018-03-12T08:48:23.637

同时，我们可以使用一个函数来检查所有“空”，例如**null、undefined、''、' '、{}、[]**。所以我只写了这个。

```
var isEmpty = function(data) {
    if(typeof(data) === 'object'){
        if(JSON.stringify(data) === '{}' || JSON.stringify(data) === '[]'){
            return true;
        }else if(!data){
            return true;
        }
        return false;
    }else if(typeof(data) === 'string'){
        if(!data.trim()){
            return true;
        }
        return false;
    }else if(typeof(data) === 'undefined'){
        return true;
    }else{
        return false;
    }
} 
```

用例和结果。

```
console.log(isEmpty()); // true
console.log(isEmpty(null)); // true
console.log(isEmpty('')); // true
console.log(isEmpty('  ')); // true
console.log(isEmpty(undefined)); // true
console.log(isEmpty({})); // true
console.log(isEmpty([])); // true
console.log(isEmpty(0)); // false
console.log(isEmpty('Hey')); // false 
```

* * *

## 回答 #23

> 赞同：11
> 
> 时间：2019-04-11T12:16:21.823

到目前为止，还没有像 string.empty 这样的直接方法来检查字符串是否为空。但是在您的代码中，您可以使用包装器检查空字符串，例如：

```
// considering the variable in which your string is saved is named str.

if (str && str.length>0) { 

  // Your code here which you want to run if the string is not empty.

} 
```

使用它，您还可以确保字符串也不是未定义的或为空的。请记住，undefined、null 和 empty 是三个不同的东西。

* * *

## 回答 #24

> 赞同：11
> 
> 时间：2019-10-23T21:13:57.653

我在这里没有看到好的答案（至少不是适合我的答案）

所以我决定回答自己：

`value === undefined || value === null || value === "";`

您需要开始检查它是​​否未定义。否则您的方法可能会爆炸，然后您可以检查它是否等于 null 或等于空字符串。

你不能有！！或者只是`if(value)`因为如果你检查`0`它会给你一个错误的答案（0是错误的）。

话虽如此，将其包装在如下方法中：

`public static isEmpty(value: any): boolean { return value === undefined || value === null || value === ""; }`

PS.：**您不需要检查 typeof**，因为它甚至在进入方法之前就会爆炸并抛出

* * *

## 回答 #25

> 赞同：10
> 
> 时间：2013-05-08T17:15:40.953

所有这些答案都很好。

但我不能确定变量是一个字符串，不只包含空格（这对我很重要），并且可以包含“0”（字符串）。

我的版本：

```
function empty(str){
    return !str || !/[^\s]+/.test(str);
}

empty(null); // true
empty(0); // true
empty(7); // false
empty(""); // true
empty("0"); // false
empty("  "); // true 
```

[jsfiddle](http://jsfiddle.net/YZfGs/)上的示例。

* * *

## 回答 #26

> 赞同：10
> 
> 时间：2013-05-14T10:18:36.587

我对如果将非字符串和非空/空值传递给测试器函数会发生什么进行了一些研究。众所周知， (0 == "") 在 JavaScript 中是正确的，但由于 0 是一个值，而不是空或 null，您可能需要对其进行测试。

以下两个函数仅对未定义、null、空/空白值返回 true，对其他所有值（例如数字、布尔值、对象、表达式等）返回 false。

```
function IsNullOrEmpty(value)
{
    return (value == null || value === "");
}
function IsNullOrWhiteSpace(value)
{
    return (value == null || !/\S/.test(value));
} 
```

存在更复杂的示例，但这些示例很简单并且给出了一致的结果。无需测试未定义，因为它包含在 (value == null) 检查中。您还可以通过将它们添加到 String 来模仿[C#](https://en.wikipedia.org/wiki/C_Sharp_%28programming_language%29)行为，如下所示：

```
String.IsNullOrEmpty = function (value) { ... } 
```

你不想把它放在 Strings 原型中，因为如果 String-class 的实例为 null，它会报错：

```
String.prototype.IsNullOrEmpty = function (value) { ... }
var myvar = null;
if (1 == 2) { myvar = "OK"; } // Could be set
myvar.IsNullOrEmpty(); // Throws error 
```

我使用以下值数组进行了测试。如果有疑问，您可以循环它以测试您的功能。

```
// Helper items
var MyClass = function (b) { this.a = "Hello World!"; this.b = b; };
MyClass.prototype.hello = function () { if (this.b == null) { alert(this.a); } else { alert(this.b); } };
var z;
var arr = [
// 0: Explanation for printing, 1: actual value
    ['undefined', undefined],
    ['(var) z', z],
    ['null', null],
    ['empty', ''],
    ['space', ' '],
    ['tab', '\t'],
    ['newline', '\n'],
    ['carriage return', '\r'],
    ['"\\r\\n"', '\r\n'],
    ['"\\n\\r"', '\n\r'],
    ['" \\t \\n "', ' \t \n '],
    ['" txt \\t test \\n"', ' txt \t test \n'],
    ['"txt"', "txt"],
    ['"undefined"', 'undefined'],
    ['"null"', 'null'],
    ['"0"', '0'],
    ['"1"', '1'],
    ['"1.5"', '1.5'],
    ['"1,5"', '1,5'], // Valid number in some locales, not in JavaScript
    ['comma', ','],
    ['dot', '.'],
    ['".5"', '.5'],
    ['0', 0],
    ['0.0', 0.0],
    ['1', 1],
    ['1.5', 1.5],
    ['NaN', NaN],
    ['/\S/', /\S/],
    ['true', true],
    ['false', false],
    ['function, returns true', function () { return true; } ],
    ['function, returns false', function () { return false; } ],
    ['function, returns null', function () { return null; } ],
    ['function, returns string', function () { return "test"; } ],
    ['function, returns undefined', function () { } ],
    ['MyClass', MyClass],
    ['new MyClass', new MyClass()],
    ['empty object', {}],
    ['non-empty object', { a: "a", match: "bogus", test: "bogus"}],
    ['object with toString: string', { a: "a", match: "bogus", test: "bogus", toString: function () { return "test"; } }],
    ['object with toString: null', { a: "a", match: "bogus", test: "bogus", toString: function () { return null; } }]
]; 
```

* * *

## 回答 #27

> 赞同：10
> 
> 时间：2017-06-02T08:33:53.163

要检查它是否完全是一个空字符串：

```
if(val==="")... 
```

要检查它是否是空字符串或无值的逻辑等效项（null、undefined、0、NaN、false、...）：

```
if(!val)... 
```

* * *

## 回答 #28

> 赞同：10
> 
> 时间：2020-12-04T09:55:27.050

使用 null-coalescing 运算符修剪空白：

```
if (!str?.trim()) {
  // do something...
} 
```

* * *

## 回答 #29

> 赞同：9
> 
> 时间：2016-11-04T22:28:45.243

没有`isEmpty()`方法，你必须检查类型和长度：

```
if (typeof test === 'string' && test.length === 0){
  ... 
```

需要进行类型检查以避免在`test`is`undefined`或时出现运行时错误`null`。

* * *

## 回答 #30

> 赞同：9
> 
> 时间：2019-05-10T21:33:38.653

试试这个：

```
export const isEmpty = string => (!string || !string.length); 
```

* * *

## 回答 #31

> 赞同：9
> 
> 时间：2020-08-24T09:55:30.200

```
if ((str?.trim()?.length || 0) > 0) {
   // str must not be any of:
   // undefined
   // null
   // ""
   // " " or just whitespace
} 
```

**更新：** 由于这个答案越来越流行，我想我也会写一个函数形式：

```
const isNotNilOrWhitespace = input => (input?.trim()?.length || 0) > 0;

const isNilOrWhitespace = input => (input?.trim()?.length || 0) === 0; 
```

* * *

## 回答 #32

> 赞同：8
> 
> 时间：2012-07-19T02:00:00.983

忽略空白字符串，您可以使用它来检查 null、空和未定义：

```
var obj = {};
(!!obj.str) // Returns false

obj.str = "";
(!!obj.str) // Returns false

obj.str = null;
(!!obj.str) // Returns false 
```

它很简洁，适用于未定义的属性，尽管它不是最易读的。

* * *

## 回答 #33

> 赞同：7
> 
> 时间：2010-07-22T15:30:53.933

试试这个

```
str.value.length == 0 
```

* * *

## 回答 #34

> 赞同：7
> 
> 时间：2013-07-15T10:55:44.933

不要假设您检查的变量是字符串。不要假设如果这个 var 有长度，那么它就是一个字符串。

问题是：仔细考虑你的应用必须做什么和可以接受什么。构建强大的东西。

如果您的方法/函数应该只处理非空字符串，那么测试参数是否为非空字符串并且不要做一些“技巧”。

作为一个例子，如果你不仔细地遵循这里的一些建议，就会爆炸。

```
 var getLastChar = function (str) {
 if (str.length > 0)
   return str.charAt(str.length - 1)
}

getLastChar('hello')
=> "o"

getLastChar([0,1,2,3])
=> TypeError: Object [object Array] has no method 'charAt' 

```

所以，我会坚持

```
 if (myVar === '')
  ... 

```

* * *

## 回答 #35

> 赞同：7
> 
> 时间：2017-10-07T02:33:01.343

您可以轻松地将其添加到**JavaScript中的本机****String**对象并反复重用它...... 如果您想检查空字符串，像下面的代码这样简单的东西可以为您完成这项工作： **`''`**

 **```
String.prototype.isEmpty = String.prototype.isEmpty || function() {
  return !(!!this.length);
} 
```

否则，如果你想同时检查`''`空字符串和`' '`空格，你可以通过添加来做到这一点，`trim()`就像下面的代码：

```
String.prototype.isEmpty = String.prototype.isEmpty || function() {
   return !(!!this.trim().length);
} 
```

你可以这样称呼它：

```
''.isEmpty(); //return true
'alireza'.isEmpty(); //return false 
```

* * *

## 回答 #36

> 赞同：6
> 
> 时间：2010-02-15T02:46:49.510

我通常使用类似的东西：

```
if (str == "") {
     //Do Something
}
else {
     //Do Something Else
} 
```

* * *

## 回答 #37

> 赞同：6
> 
> 时间：2017-11-30T06:26:50.223

您可以验证以下方法并了解其中的区别。

```
var j = undefined;
console.log((typeof j == 'undefined') ? "true":"false");
var j = null; 
console.log((j == null) ? "true":"false");
var j = "";
console.log((!j) ? "true":"false");
var j = "Hi";
console.log((!j) ? "true":"false");
```

* * *

## 回答 #38

> 赞同：6
> 
> 时间：2020-11-05T19:24:26.300

这里有很多有用的信息，但在我看来，最重要的元素之一没有得到解决。

`null`, `undefined`, 和`""`都是*假*的。

在评估空字符串时，通常是因为您需要将其替换为其他内容。

在这种情况下，您可以预期以下行为。

```
var a = ""
var b = null
var c = undefined

console.log(a || "falsy string provided") // prints ->"falsy string provided"
console.log(b || "falsy string provided") // prints ->"falsy string provided"
console.log(c || "falsy string provided") // prints ->"falsy string provided" 
```

`""`考虑到这一点，可以返回字符串是否为、`null`或（无效字符串）与有效字符串的方法或函数`undefined`就像这样简单：

```
const validStr = (str) => str ? true : false

validStr(undefined) // returns false
validStr(null) // returns false
validStr("") // returns false
validStr("My String") // returns true 
```

我希望这会有所帮助。

* * *

## 回答 #39

> 赞同：5
> 
> 时间：2014-05-06T06:38:00.287

您也应该始终检查类型，因为 JavaScript 是一种鸭子类型语言，因此您可能不知道数据在处理过程中何时以及如何更改。所以，这是更好的解决方案：

```
 let undefinedStr;
    if (!undefinedStr) {
      console.log("String is undefined");
    }

    let emptyStr = "";
    if (!emptyStr) {
      console.log("String is empty");
    }

    let nullStr = null;
    if (!nullStr) {
      console.log("String is null");
    }
```

* * *

## 回答 #40

> 赞同：5
> 
> 时间：2019-10-18T09:02:47.140

以下正则表达式是另一种解决方案，可用于 null、空或未定义的字符串。

```
(/(null|undefined|^$)/).test(null) 
```

我添加了这个解决方案，因为它可以进一步扩展以检查空值或某些值，如下所示。以下正则表达式正在检查字符串可以为空 null undefined 还是只有整数。

```
(/(null|undefined|^$|^\d+$)/).test() 
```

* * *

## 回答 #41

> 赞同：4
> 
> 时间：2010-08-06T16:28:06.440

```
function tell()
{
    var pass = document.getElementById('pasword').value;
    var plen = pass.length;

    // Now you can check if your string is empty as like
    if(plen==0)
    {
        alert('empty');
    }
    else
    {
        alert('you entered something');
    }
}

<input type='text' id='pasword' /> 
```

这也是检查字段是否为空的通用方法。

* * *

## 回答 #42

> 赞同：4
> 
> 时间：2013-07-03T04:16:06.887

我更喜欢使用非空白测试而不是空白

```
function isNotBlank(str) {
   return (str && /^\s*$/.test(str));
} 
```

* * *

## 回答 #43

> 赞同：4
> 
> 时间：2015-06-10T08:44:51.057

Underscore.js [JavaScript](https://en.wikipedia.org/wiki/Underscore.js)库[http://underscorejs.org/](http://underscorejs.org/)提供了一个非常有用的`_.isEmpty()`函数来检查空字符串和其他空对象。

参考：[http ://underscorejs.org/#isEmpty](http://underscorejs.org/#isEmpty)

> **isEmpty** `_.isEmpty(object)`
> 如果可枚举对象不包含任何值（没有可枚举的自身属性），则返回 true。对于字符串和类似数组的对象，_.isEmpty 检查长度属性是否为 0。
> 
> `_.isEmpty([1, 2, 3]);`
> => 假的
> 
> `_.isEmpty({});`
> => 真

其他非常有用的 Underscore.js 功能包括：

*   [http://underscorejs.org/#isNull](http://underscorejs.org/#isNull) `_.isNull(object)`
*   [http://underscorejs.org/#isUndefined](http://underscorejs.org/#isUndefined)
*   `_.isUndefined(value)`
*   [http://underscorejs.org/#has](http://underscorejs.org/#has) `_.has(object, key)`

* * *

## 回答 #44

> 赞同：3
> 
> 时间：2012-12-18T22:31:17.503

检查您是否没有尝试传递未定义的术语也是一个好主意。

```
function TestMe() {
  if((typeof str != 'undefined') && str) {
    alert(str);
  }
 };

TestMe();

var str = 'hello';

TestMe(); 
```

当对象实例的字符串属性不为空时，我通常会遇到想要做某事的情况。这很好，只是该属性并不总是存在。

* * *

## 回答 #45

> 赞同：3
> 
> 时间：2021-01-14T17:04:29.507

您可以使用 typeof 运算符和 length 方法来检查这一点。

```
const isNonEmptyString = (value) => typeof(value) == 'string' && value.length > 0 
```

根据@kip2 的建议进行编辑。

* * *

## 回答 #46

> 赞同：3
> 
> 时间：2021-09-13T12:31:09.303

只需检查变量是否存在且不为空。

```
//let Str = "";
if (Str && Str.length !== 0) {
  console.log("String is not empty");
} 
```

* * *

## 回答 #47

> 赞同：3
> 
> 时间：2021-10-08T07:56:46.703

试试这个代码：

```
function isEmpty(strValue)
{
      // Test whether strValue is empty
    if (!strValue || strValue.trim() === "" || (strValue.trim()).length === 0) {
        //do something
    }
} 
```

* * *

## 回答 #48

> 赞同：3
> 
> 时间：2021-10-13T18:13:16.193

这就是`falsy`价值。 [虚假值](https://developer.mozilla.org/en-US/docs/Glossary/Falsy)

第一个解决方案：

```
const str = "";
return str || "Hello" 
```

第二种解决方案：

```
const str = "";
return (!!str) || "Hello"; // !!str is Boolean 
```

第三种解决方案：

```
const str = "";
return (+str) || "Hello"; // !!str is Boolean 
```

* * *

## 回答 #49

> 赞同：2
> 
> 时间：2013-02-10T10:20:48.167

另一种方式，但我相信[bdukes 的答案](https://stackoverflow.com/questions/154059/how-can-i-check-for-an-empty-undefined-null-string-in-javascript/154068#154068)是最好的。

```
var myString = 'hello'; 
if(myString.charAt(0)){
    alert('no empty');
}
alert('empty'); 
```

* * *

## 回答 #50

> 赞同：1
> 
> 时间：2021-08-22T10:12:54.757

isBlank 函数的**终极和最短变体：**

```
/**
 * Will return:
 * False for: for all strings with chars
 * True for: false, null, undefined, 0, 0.0, "", " ".
 *
 * @param str
 * @returns {boolean}
 */
function isBlank(str){
    return (!!!str || /^\s*$/.test(str));
}

// tests
console.log("isBlank TRUE variants:");
console.log(isBlank(false));
console.log(isBlank(undefined));
console.log(isBlank(null));
console.log(isBlank(0));
console.log(isBlank(0.0));
console.log(isBlank(""));
console.log(isBlank(" "));

console.log("isBlank FALSE variants:");
console.log(isBlank("0"));
console.log(isBlank("0.0"));
console.log(isBlank(" 0"));
console.log(isBlank("0 "));
console.log(isBlank("Test string"));
console.log(isBlank("true"));
console.log(isBlank("false"));
console.log(isBlank("null"));
console.log(isBlank("undefined"));
```

* * *

## 回答 #51

> 赞同：0
> 
> 时间：2020-12-15T16:58:08.483

这个函数对我来说效果很好，确保它既是字符串又不是空的：

`isNonBlankString = function(s) { return ((typeof s === 'string' || s instanceof String) && s !== ''); }`

* * *

## 回答 #52

> 赞同：0
> 
> 时间：2021-06-12T08:58:13.597

对于那些寻找`.blank?`js 字符串的 rails 的人：

```
function is_blank(str) { 
  return (!str || str.length === 0 || str.trim() == '')
} 
```

* * *

## 回答 #53

> 赞同：0
> 
> 时间：2021-07-04T06:16:58.440

好吧，检查这个的最简单的功能是......

`const checkEmpty = string => (string.trim() === "") || !string.trim();`

用法：

```
checkEmpty(""); // returns true.
checkEmpty("mystr"); // returns false. 
```

就是这么简单。:)

* * *

## 回答 #54

> 赞同：-1
> 
> 时间：2014-04-08T09:37:02.127

```
var x ="  ";
var patt = /^\s*$/g;
isBlank = patt.test(x);
alert(isBlank); // Is it blank or not??
x = x.replace(/\s*/g, ""); // Another way of replacing blanks with ""
if (x===""){
    alert("ya it is blank")
} 
```

* * *

## 回答 #55

> 赞同：-1
> 
> 时间：2021-06-16T11:33:42.440

这是另一种带有字符串修剪选项的类型，它是防错的：

```
let strTest = " ";

console.log("Is empty string?",isEmptyString(strTest)); // without trim

console.log("Is empty string?",isEmptyString(strTest,true)); // with trim (escape left and right white spaces)

strTest = "abcd ";

console.log("Is empty string?",isEmptyString(strTest)); // without trim
console.log("Is empty string?",isEmptyString(strTest,true)); // with trim

function isEmptyString(str, withTrim = false) { 
  try {
    if (withTrim){
      if (str.trim()) return false;
      else return true;
    }
    else{
      if (str) return false;
      else return true;
    }
  } catch (error) {
    return true;
  }
}
```

* * *

## 回答 #56

> 赞同：-2
> 
> 时间：2021-06-23T15:29:15.947

我已经尝试了这里建议的几个示例。我的目标是不仅能够检查空，而且能够检查！empty。这就是结果我在这些解决方案中唯一找不到的是如何检测函数中的未定义，如果它至少没有被声明。也许这是不可能的。

我将其扩展为包括数组。看看小提琴。这确实有效。

```
function empty(data)
{
    if(Array.isArray(data) && !data.length)
    {
       return true;
    }
    if(typeof data === "undefined")
    {
        return true;
    }
    else if(data === "0")
    {
        return true;
    }
    else if(!data)
    {
        return true;
    }
    else if(/\S/.test(data) == "")
    {
        return true;
    }
    else
    {
        return false;
    }
} 
```

**测试**

```
var One = "    "; if(empty(One)) // true
var One = ""; if(empty(One)) // true
var One = 0; if(empty(One)) // true
var One = "0"; if(empty(One)) //true
var One = NaN; if(empty(One)) // true
var One = null; if(empty(One)) // true
var One = false; if(empty(One)) //true
var Two; if(empty(Two) //True
var One = []; // true
var One = ["One", "Two", "Three"] //false
============
Not Empty
============
var One = "     "; if(!empty(One)) //false (empty)
var One = ""; if(!empty(One)) //false
var One = 6; if(!empty(One)) //true
var One = "seven"; if(!empty(One)) //true
var One = NaN; if(!empty(One)) // false
var One = null; if(!empty(One)) //false
var One = false; if(!empty(One)) //false
Var Two; if(!empty(Two)) // false (undefined)
var One = []; // false
var One = ["One", "Two", "Three"] //true 
```

* * *

## 回答 #57

> 赞同：-2
> 
> 时间：2021-11-09T21:04:36.697

这是我用来处理这个问题的一些自定义函数。以及代码如何运行的示例。

```
const v1 = 0
const v2 = '4'
const v2e = undefined
const v2e2 = null
const v3 = [1, 2, 3, 4]
const v3e = []
const v4 = true
const v4e = false
const v5 = {
  test: 'value'
}
const v5e = {}
const v6 = 'NotEmpty'
const v6e = ''

function isNumeric(n) {
  return !isNaN(parseFloat(n)) && isFinite(n)
}

function isEmpty(v, zeroIsEmpty = false) {
  /**
   * When doing a typeof check, null will always return "object" so we filter that out first
   * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/typeof#typeof_null
   */
  if (v === null) {
    return true
  }

  if (v === true) {
    return false
  }

  if (typeof v === 'object') {
    return !Object.keys(v).length
  }

  if (isNumeric(v)) {
    return zeroIsEmpty ? parseFloat(v) === 0 : false
  }

  return !v || !v.length || v.length < 1
}

console.log(isEmpty(v1), isEmpty(v1, true))
console.log(isEmpty(v2), isEmpty(v2e), isEmpty(v2e))
console.log(isEmpty(v3), isEmpty(v3e))
console.log(isEmpty(v4), isEmpty(v4e))
console.log(isEmpty(v5), isEmpty(v5e))
console.log(isEmpty(v6), isEmpty(v6e))
```

也供参考，这里是 lodash isEmpty 的来源： [https ://github.com/lodash/lodash/blob/master/isEmpty.js](https://github.com/lodash/lodash/blob/master/isEmpty.js)

* * *

## 回答 #58

> 赞同：-6
> 
> 时间：2015-03-25T09:37:11.483

```
<html>
    <head>
        <script lang="javascript">

            function nullcheck()
            {
                var n = "fdgdfg";
                var e = n.length;
                if (e == 0)
                {
                    return true;
                }
                else
                {
                    alert("success");
                    return false;
                }
            }
        </script>
    </head>

    <body>
        <button type="submit" value="add" onclick="nullcheck()"></button>
    </body>
</html> 
```

* * *

## 回答 #59

> 赞同：-10
> 
> 时间：2014-07-19T18:15:50.973

要检查它是否为空：

```
var str = "Hello World!";
if(str === ''){alert("THE string str is EMPTY");} 
```

要检查它是否是字符串类型：

```
var str = "Hello World!";
if(typeof(str) === 'string'){alert("This is a String");} 
```

# c++ - 覆盖 gSOAP 中的命名空间

> ID：154060
> 
> 赞同：1
> 
> 时间：2008-09-30T17:17:57.033
> 
> 标签：c++, web-services, gsoap

我将[`gSOAP`](http://gsoap2.sourceforge.net)其用作 Web 服务工具包，并且一次通过`soapcpp2`多个`WSDL`s 生成了存根和代理类。因此，所有命名空间绑定都在一个`.nsmap`文件中。

现在的问题是所有命名空间绑定都与我进行的所有方法调用一起发送。`HTTP POST`数据包异常大且丑陋。

有没有办法以编程方式覆盖命名空间绑定？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-02T09:30:23.310

检查`soapcpp2`和它的`-q`标志，它会帮助你。

除此之外，该`-penv`标志将在可执行文件中打包与 gSOAP 相关的基本方法，不包括任何服务对象。

因此生成的文件`-penv`可以在多个命名空间之间共享，属于不同的生成 gSOAP Web 服务。

# ms-access - 通过 MS Access 中的 FileDialog 保存时如何过滤报表对象

> ID：154064
> 
> 赞同：3
> 
> 时间：2008-09-30T17:18:13.180
> 
> 标签：ms-access, vba, report, filedialog

我正在尝试使用 FileDialog 保存 rtf 文件，并希望使用 where 子句进行过滤。这就是我所拥有的：

```
Set dlgSave = FileDialog(msoFileDialogSaveAs)
With dlgSave
  .Title = "Provide the place to save this file"
  .ButtonName = "Save As..."
  .InitialFileName = Me.cmbPickAReportToPrint.Value & "-" & Format(Date, "mmddyy") & ".rtf"
  .InitialView = msoFileDialogViewDetails

  If .Show Then
      DoCmd.OutputTo acOutputReport, Me.cmbPickAReportToPrint.Value, acFormatRTF, .SelectedItems(1)
  End If
End With 
```

关于如何在不更改报告的情况下添加 where 子句的任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T17:36:03.513

我发现在不触及报表代码本身的情况下执行此操作的最简单方法是在应用了过滤器的情况下以预览模式打开报表，然后将报表输出为您需要的任何格式。

```
If .Show Then
    DoCmd.OpenReport Me.cmbPickAReportToPrint.Value, acViewPreview, , "fieldToFilterOn = 'value'"
    DoCmd.OutputTo acOutputReport, Me.cmbPickAReportToPrint.Value, acFormatRTF, .SelectedItems(1)
End If 
```

# windows - 使用“start”命令并将参数传递给已启动的程序

> ID：154075
> 
> 赞同：249
> 
> 时间：2008-09-30T17:21:11.300
> 
> 标签：windows, command-prompt

我在 Virtual PC 2007 中有一个虚拟机。

要从桌面启动它，我在批处理文件中有以下命令：

```
"c:\program files\Microsoft Virtual PC\Virtual PC.exe" -pc "MY-PC" -launch 
```

但这会在主机上留下一个 dos 提示，直到虚拟机关闭，然后我退出 Virtual PC 控制台。这很烦人。

所以我改变了我的命令以使用 START 命令，而不是：

```
start "c:\program files\Microsoft Virtual PC\Virtual PC.exe" -pc MY-PC -launch 
```

但它会阻塞传递到 Virtual PC 的参数。

`START /?`表明参数确实在那个位置。有没有人使用 START 启动具有多个命令行参数的程序？

* * *

## 回答 #1

> 赞同：518
> 
> 时间：2008-09-30T17:25:33.193

START 有一个特殊性，涉及第一个参数周围的双引号。如果第一个参数有双引号，它会将其用作新窗口的可选 TITLE。

我相信你想要的是：

```
start "" "c:\program files\Microsoft Virtual PC\Virtual PC.exe" -pc MY-PC -launch 
```

换句话说，在程序名称之前给它一个空标题来伪造它。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-30T17:29:31.750

您可以在桌面上创建快捷方式，而不是批处理文件。

将目标设置为：

```
"c:\program files\Microsoft Virtual PC\Virtual PC.exe" -pc "MY-PC" -launch 
```

一切就绪。由于您没有启动命令提示符来启动它，因此不会有 DOS 框。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-06-30T14:11:35.490

空格是 DOS/CMD 问题，因此您应该通过以下方式转到路径：

```
cd "c:\program files\Microsoft Virtual PC" 
```

然后只需通过以下方式启动 VPC：

```
start Virtual~1.exe -pc MY-PC -launch 
```

`~1`表示第一个`exe`以`"Virtual"`开头。因此，如果存在 a`"Virtual PC.exe"`和 a `"Virtual PC1.exe"`，则第一个将是 the`Virtual~1.exe`和第二个`Virtual~2.exe`，依此类推。

或者使用像 VirtualBox 这样的 VNC-Client。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-02-12T21:37:03.663

您可以通过使用 [ `/D"Path"`]`/D` **仅**用于指定路径而不是路径+程序来使用引号。似乎随后同一行上的所有代码都恢复正常，这意味着您不需要分隔路径和文件。

```
 start  /D "C:\Program Files\Internet Explorer\" IEXPLORE.EXE 
```

或者：

```
 start  /D "TITLE" "C:\Program Files\Internet Explorer\" IEXPLORE.EXE 
```

将以默认网页启动 IE。

```
 start  /D "TITLE" "C:\Program Files\Internet Explorer\" IEXPLORE.EXE www.bing.com 
```

以 Bing 开头，但不会重置您的主页。

`/D`代表“目录”，使用引号是可以的！

**错误的例子：**

```
 start  /D "TITLE" "C:\Program Files\Internet Explorer\IEXPLORE.EXE" 
```

给出：

> 错误“*当前目录无效。* ”

`/D`后面只能跟目录路径。然后空间和您希望启动/运行的批处理文件或程序

在 XP 下测试和工作，但 windows Vista/7/8 可能需要对 UAC 进行一些调整。

-Mrbios

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-06-04T15:48:58.950

这些答案都不适合我。

相反，我不得不使用 Call 命令：

```
Call "\\Path To Program\Program.exe" <parameters> 
```

我不确定这是否真的在等待完成......我正在安装的 C++ Redistributable 速度足够快，这并不重要

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-02-17T13:45:09.833

如果要在 c: 驱动器的测试文件夹中传递参数和 .exe 文件

`start "parameter" "C:\test\test1.exe" -pc My Name-PC -launch`

如果您不想在 c: 驱动器的测试文件夹中传递参数和 .exe 文件

`start "" "C:\test\test1.exe" -pc My Name-PC -launch`

如果您不想在 H: (Any Other)drive 的测试文件夹中传递参数和 .exe 文件

`start "" "H:\test\test1.exe" -pc My Name-PC -launch`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-05-20T15:59:37.177

“特殊性”中的答案是正确的，直接回答了问题。正如 TimF 所回答的，由于第一个参数用引号引起来，因此它被视为窗口标题。

另请注意，Virtual PC 选项被视为“启动”命令本身的选项，对“启动”无​​效。这适用于所有具有“开始”命令的 Windows 版本。

'start' 将引用的参数视为标题的问题比仅发布的问题更令人讨厌。如果你运行这个：

```
start "some valid command with spaces" 
```

你会得到一个新的命令提示符窗口，窗口标题的结果很明显。更烦人的是，这个新窗口没有继承自定义的字体、颜色或窗口大小，它只是 cmd.exe 的默认设置。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-04-18T08:30:12.907

如果必须在任何参数处使用双引号，则会出现错误“'c:\somepath' is not Recognized a internal or external command, operable program or batch file”。使用双引号时，我建议使用以下解决方案： [https ://stackoverflow.com/a/43467194/3835640](https://stackoverflow.com/a/43467194/3835640)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2016-05-14T17:46:16.233

# `/b`范围

```
start /b "" "c:\program files\Microsoft Virtual PC\Virtual PC.exe" -pc "MY-PC" -launch 
```

* * *

## 回答 #10

> 赞同：-4
> 
> 时间：2008-09-30T17:23:29.970

你有没有尝试过：

```
start "c:\program files\Microsoft Virtual PC\Virtual PC.exe" "-pc MY-PC -launch" 
```

?

* * *

## 回答 #11

> 赞同：-4
> 
> 时间：2008-09-30T17:24:24.787

将命令放在批处理文件中，并使用参数调用它。

另外，你试过了吗？（移动结束引号以封装参数）

```
start "c:\program files\Microsoft Virtual PC\Virtual PC.exe -pc MY-PC -launch" 
```

* * *

## 回答 #12

> 赞同：-4
> 
> 时间：2013-06-17T05:33:58.290

将“Virtual PC.exe”更改为文件夹中没有空格的名称，如“VirtualPC.exe”。当您`start "path"`使用“”编写时，CMD 会启动一个以路径为标题的新 cmd 窗口。将名称更改为不带空格的名称，将其写在记事本上，然后像 Name.cmd 或 Name.bat 一样保存：

```
CD\
CD Program Files
CD Microsoft Virtual PC
start VirtualPC.exe
timeout 2
exit 
```

此命令会将 CMD 重定向到文件夹，启动 VirualPC.exe，等待 2 秒并退出。

# windows - 为什么我的文件需要 dos2unix？仅在日食中

> ID：154078
> 
> 赞同：1
> 
> 时间：2008-09-30T17:22:48.940
> 
> 标签：windows, eclipse, encoding

当我在 Eclipse 中打开一个文件时，它显示不正确的行距，显示每行之间有一个额外的换行符。当我用记事本或写字板打开文件时，它不会显示只有 eclipse 显示的这些额外的换行符。如何让 eclipse 在没有这些换行符的情况下读取这些文件，如记事本和写字板？

-edit：我对所有文件都没有这个问题，但只有少数几个我进行了本地更改>将它们上传到我们的太阳站>然后将这些文件拉回我的本地工作站以供将来修改。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T17:34:37.713

Eclipse 应该有一个`File -> Convert Line Delimiters To...`选项可以为您纠正这个问题。（如果它不适用于您的文件，[这篇文章](http://www-01.ibm.com/support/docview.wss?rs=79&context=SSJNRR&context=SSNJU5&context=SSSTY3&uid=swg21315284&loc=en_US&cs=UTF-8&lang=en)可能会有所帮助。）

但是，实际上，您应该让文件传输程序将源文件视为 ascii 而不是二进制文件。那么你的行尾问题应该没有实际意义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T17:34:40.333

服务器（或介于两者之间的东西）可能正在用 CR LF（单独的）替换所有 CR+LF？

尝试专门设置文本文件编码（Window->Preferences->General->Workspace），或者每次获得最新版本时使用 File->Convert Line Delimiters To->Windows（我知道，不理想）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T14:58:38.903

事实证明，问题是通过仅在二进制中执行我的 ftp 并将 Eclipse 编码设置为 US-ASCII 来解决的。我不完全理解为什么这可以解决问题，但它确实有效。感谢您的 2 个答案，他们都将我引向了我的解决方案。

# graphics - 多个像素的 alpha 混合公式是什么？

> ID：154079
> 
> 赞同：6
> 
> 时间：2008-09-30T17:22:49.737
> 
> 标签：graphics, alpha, alphablending, raytracing

我有许多 RGBA 像素，每个像素都有一个 alpha 分量。

所以我有一个像素列表：（*p0 p1 p2 p3 p4 ... pn*）其中 p_0_ 是前面的像素， p_n_ 是最远的（在后面）。

最后一个（或任何）像素不一定是不透明的，因此生成的混合像素也可以是透明的。我从列表的开头到结尾进行混合，反之亦然（是的，它是光线追踪）。因此，如果结果在任何时候变得足够不透明，我可以以足够正确的结果停止。我将以这种方式应用混合算法： (((( *p0* @ *p1* ) @ *p2* ) @ *p3* ) ... )

谁能建议我一个正确的混合配方，不仅适用于 R、G 和 B，而且适用于 A 成分？

**UPD**：我想知道对于确定的混合颜色过程，我们怎么可能有很多公式？这是某种近似吗？对我来说，这看起来很疯狂：公式并没有太大的不同，以至于我们真正获得了效率或优化。任何人都可以澄清这一点吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-30T18:03:46.830

Alpha 混合是比您想象的更深入的主题之一。这取决于 alpha 值在您的系统中的含义，如果您猜错了，那么您最终会得到看起来不错的结果，但会显示奇怪的伪影。

查看 Porter 和 Duff 的经典论文“[合成数字图像](http://keithp.com/~keithp/porterduff/p253-porter.pdf)”，了解精彩、易读的讨论和所有公式。您可能需要“over”运算符。

听起来您正在做一些更接近体积渲染的事情。有关公式和参考，请参阅[图形常见问题解答](http://www.faqs.org/faqs/graphics/algorithms-faq/)，问题 5.16“如何执行体绘制？”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T17:30:48.890

有多种可能的方法来执行此操作，具体取决于 RGBA 值如何实际表示材料的属性。

这是一个可能的算法。从最终的像素颜色开始`lightr=lightg=lightb=0`，`lightleft=1`;

对于遇到的每个 r,g,b, 一个像素求值：

```
lightr += lightleft*r*(1-a)
lightg += lightleft*g*(1-a)
lightb += lightleft*b*(1-a)
lightleft *= 1-a; 
```

（RGBA 值在 0 和 1 之间进行归一化，我假设 a=1 表示不透明，a=0 表示完全透明）

如果遇到的第一个像素是不透明度为 50% 的蓝色，则 50% 的可用颜色设置为蓝色，其余的未知。如果接下来是不透明度为 50% 的红色像素，则将*剩余*光的 25% 设置为红色，因此该像素具有 50% 的蓝色和 25% 的红色。如果接下来是不透明度为 60% 的绿色像素，则该像素为 50% 的蓝色、25% 的红色、15% 的绿色，剩余 10% 的光。

与此功能对应的物理材料是发光但部分不透明的材料：因此，堆栈中间的像素永远不会使最终颜色变暗：它只能防止其后面的光增加最终颜色（通过变黑并且完全不透明）。

# c# - 使用 C# 使 Windows 音量静音

> ID：154089
> 
> 赞同：17
> 
> 时间：2008-09-30T17:24:42.337
> 
> 标签：c#, winforms, audio, volume

任何人都知道如何使用 C# 以编程方式使 Windows XP Volume 静音？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-30T17:35:18.413

为 P/Invoke 声明：

```
private const int APPCOMMAND_VOLUME_MUTE = 0x80000;
private const int WM_APPCOMMAND = 0x319;

[DllImport("user32.dll")]
public static extern IntPtr SendMessageW(IntPtr hWnd, int Msg, IntPtr wParam, IntPtr lParam); 
```

然后使用这条线来静音/取消静音。

```
SendMessageW(this.Handle, WM_APPCOMMAND, this.Handle, (IntPtr) APPCOMMAND_VOLUME_MUTE); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-09-21T16:33:24.167

您可以在 Windows Vista/7 和 8 中使用什么：

您可以使用[NAudio](https://github.com/naudio/NAudio)。
下载最新版本。提取 DLL 并在 C# 项目中引用 DLL NAudio。

然后添加以下代码以遍历所有可用的音频设备并尽可能将其静音。

```
try
{
    //Instantiate an Enumerator to find audio devices
    NAudio.CoreAudioApi.MMDeviceEnumerator MMDE = new NAudio.CoreAudioApi.MMDeviceEnumerator();
    //Get all the devices, no matter what condition or status
    NAudio.CoreAudioApi.MMDeviceCollection DevCol = MMDE.EnumerateAudioEndPoints(NAudio.CoreAudioApi.DataFlow.All, NAudio.CoreAudioApi.DeviceState.All);
    //Loop through all devices
    foreach (NAudio.CoreAudioApi.MMDevice dev in DevCol)
    {
        try
        {
            //Show us the human understandable name of the device
            System.Diagnostics.Debug.Print(dev.FriendlyName);
            //Mute it
            dev.AudioEndpointVolume.Mute = true;
        }
        catch (Exception ex)
        {
            //Do something with exception when an audio endpoint could not be muted
        }
    }
}
catch (Exception ex)
{
    //When something happend that prevent us to iterate through the devices
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-02-02T12:48:46.787

请参阅[如何使用 C# 以编程方式使 Windows XP 卷静音？](http://alvas.net/alvas.audio,tips.aspx#tip115 "如何使用 C# 以编程方式使 Windows XP 卷静音？")

```
void SetPlayerMute(int playerMixerNo, bool value)
{
    Mixer mx = new Mixer();
    mx.MixerNo = playerMixerNo;
    DestinationLine dl = mx.GetDestination(Mixer.Playback);
    if (dl != null)
    {
        foreach (MixerControl ctrl in dl.Controls)
        {
            if (ctrl is MixerMuteControl)
            {
                ((MixerMuteControl)ctrl).Value = (value) ? 1 : 0;
                break;
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-10-18T11:34:25.360

这是 Mike de Klerks 答案的略微改进版本，不需要“on error resume next”代码。

第 1 步：将 NAudio NuGet 包添加到您的项目（[https://www.nuget.org/packages/NAudio/](https://www.nuget.org/packages/NAudio/)）

第 2 步：使用此代码：

```
using (var enumerator = new NAudio.CoreAudioApi.MMDeviceEnumerator())
{
    foreach (var device in enumerator.EnumerateAudioEndPoints(NAudio.CoreAudioApi.DataFlow.Render, NAudio.CoreAudioApi.DeviceState.Active))
    {
        if (device.AudioEndpointVolume?.HardwareSupport.HasFlag(NAudio.CoreAudioApi.EEndpointHardwareSupport.Mute) == true)
        {
            Console.WriteLine(device.FriendlyName);
            device.AudioEndpointVolume.Mute = false;
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2022-02-03T12:10:09.607

```
CoreAudioDevice defaultPlaybackDevice = new 
CoreAudioController().DefaultPlaybackDevice;   
        if (!defaultPlaybackDevice.IsMuted)
            defaultPlaybackDevice.ToggleMute(); 
```

# emacs - 你的 .emacs 里有什么？

> ID：154097
> 
> 赞同：53
> 
> 时间：2008-09-30T17:27:08.667
> 
> 标签：emacs, text-editor, elisp, dot-emacs

我最近换了几次电脑，在某个地方我丢失了我的 .emacs。我正在尝试重新构建它，但是当我这样做时，我想我会选择其他人使用的其他好的配置。

那么，如果您使用 Emacs，*您的*.emacs 中有什么？

我的现在很贫瘠，只包含：

1.  全局字体锁定模式！`(global-font-lock-mode 1)`
2.  我个人对缩进、制表符和空格的偏好。
3.  使用 cperl 模式而不是 perl 模式。
4.  编译的快捷方式。

你觉得什么有用？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-10-18T13:26:25.637

使用[终极 dotfiles 站点](http://dotfiles.org/.emacs)。在此处添加您的“.emacs”。阅读其他人的“.emacs”。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-01T14:58:29.483

我最喜欢的片段。Emacs 的终极魅力：

```
;; real lisp hackers use the lambda character
;; courtesy of stefan monnier on c.l.l
(defun sm-lambda-mode-hook ()
  (font-lock-add-keywords
   nil `(("\\<lambda\\>"
   (0 (progn (compose-region (match-beginning 0) (match-end 0)
        ,(make-char 'greek-iso8859-7 107))
      nil))))))
(add-hook 'emacs-lisp-mode-hook 'sm-lambda-mode-hook)
(add-hook 'lisp-interactive-mode-hook 'sm-lamba-mode-hook)
(add-hook 'scheme-mode-hook 'sm-lambda-mode-hook) 
```

因此，您在编辑 lisp/scheme 时会看到以下内容：

```
(global-set-key "^Cr" '(λ () (interactive) (revert-buffer t t nil))) 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-10-01T10:23:22.437

我有这个要更改`yes`或`no`提示`y`或`n`提示：

```
(fset 'yes-or-no-p 'y-or-n-p) 
```

我有这些来启动 Emacs，而没有从[这个问题](https://stackoverflow.com/questions/144983/how-do-i-make-emacs-start-without-so-much-fanfare)中得到这么多“大张旗鼓” 。

```
(setq inhibit-startup-echo-area-message t)
(setq inhibit-startup-message t) 
```

以及[Steve Yegge](http://steve.yegge.googlepages.com/my-dot-emacs-file)重命名您正在编辑的文件及其相应缓冲区的功能：

```
(defun rename-file-and-buffer (new-name)
  "Renames both current buffer and file it's visiting to NEW-NAME."
  (interactive "sNew name: ")
  (let ((name (buffer-name))
 (filename (buffer-file-name)))
    (if (not filename)
 (message "Buffer '%s' is not visiting a file!" name)
      (if (get-buffer new-name)
   (message "A buffer named '%s' already exists!" new-name)
 (progn
   (rename-file name new-name 1)
   (rename-buffer new-name)
   (set-visited-file-name new-name)
   (set-buffer-modified-p nil)))))) 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-10-05T22:01:33.043

可以证明非常有用的一件事：在它变得太大之前，尝试将它拆分为多个文件以执行各种任务：我的 .emacs 只是设置我的加载路径并加载一堆文件 - 我已经拥有了所有的模式 -中的特定设置`mode-configs.el`，中的键绑定`keys.el`等

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-05-10T13:13:44.703

我的 .emacs 只有 127 行，这里是最有用的小片段：

```
;; keep backup files neatly out of the way in .~/
(setq backup-directory-alist '(("." . ".~"))) 
```

这使得我在目录中发现杂乱无章的 *~ 文件进入一个特殊的目录，在这种情况下.~

```
;; uniquify changes conflicting buffer names from file<2> etc
(require 'uniquify)
(setq uniquify-buffer-name-style 'reverse)
(setq uniquify-separator "/")
(setq uniquify-after-kill-buffer-p t) ; rename after killing uniquified
(setq uniquify-ignore-buffers-re "^\\*") ; don't muck with special buffers 
```

这设置了 uniquify ，它将您在多个文件具有相同名称时获得的那些丑陋的文件 <2> 等缓冲区名称更改为使用尽可能多的文件整个路径的更简洁明确的名称。

就是这样......其余的都是相当标准的东西，我相信每个人都知道。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-09-30T20:38:55.803

这不是整个套件和 kaboodle，但它是我收集的一些更有用的片段：

```
(defadvice show-paren-function (after show-matching-paren-offscreen
                                      activate)
  "If the matching paren is offscreen, show the matching line in the                               
echo area. Has no effect if the character before point is not of                                   
the syntax class ')'."
  (interactive)
  (let ((matching-text nil))
    ;; Only call `blink-matching-open' if the character before point                               
    ;; is a close parentheses type character. Otherwise, there's not                               
    ;; really any point, and `blink-matching-open' would just echo                                 
    ;; "Mismatched parentheses", which gets really annoying.                                       
    (if (char-equal (char-syntax (char-before (point))) ?\))
        (setq matching-text (blink-matching-open)))
    (if (not (null matching-text))
        (message matching-text))))

;;;;;;;;;;;;;;;
;; UTF-8
;;;;;;;;;;;;;;;;;;;;
;; set up unicode
(prefer-coding-system       'utf-8)
(set-default-coding-systems 'utf-8)
(set-terminal-coding-system 'utf-8)
(set-keyboard-coding-system 'utf-8)
;; This from a japanese individual.  I hope it works.
(setq default-buffer-file-coding-system 'utf-8)
;; From Emacs wiki
(setq x-select-request-type '(UTF8_STRING COMPOUND_TEXT TEXT STRING))
;; Wwindows clipboard is UTF-16LE 
(set-clipboard-coding-system 'utf-16le-dos)

(defun jonnay-timestamp ()
  "Spit out the current time"
  (interactive)
  (insert (format-time-string "%Y-%m-%d")))

(defun jonnay-sign ()
  "spit out my name, email and the current time"
  (interactive)
  (insert "-- Jonathan Arkell (jonathana@criticalmass.com)")
  (jonnay-timestamp))

;; Cygwin requires some seriosu setting up to work the way i likes it
(message "Setting up Cygwin...")
(let* ((cygwin-root "c:")
       (cygwin-bin (concat cygwin-root "/bin"))
       (gambit-bin "/usr/local/Gambit-C/4.0b22/bin/")
       (snow-bin "/usr/local/snow/current/bin")
       (mysql-bin "/wamp/bin/mysql/mysql5.0.51a/bin/"))
   (setenv "PATH" (concat cygwin-bin ";" ;
                          snow-bin ";" 
                          gambit-bin ";"
                          mysql-bin ";"
                          ".;")  
           (getenv "PATH"))
   (setq exec-path (cons cygwin-bin exec-path)))

(setq shell-file-name "bash")
(setq explicit-shell-file-name "bash")

(require 'cygwin-mount)
(cygwin-mount-activate)
(message "Setting up Cygwin...Done")

; Completion isn't perfect, but close
(defun my-shell-setup ()
   "For Cygwin bash under Emacs 20+"
   (setq comint-scroll-show-maximum-output 'this)
   (setq comint-completion-addsuffix t)
   (setq comint-eol-on-send t)
   (setq w32-quote-process-args ?\")
   (make-variable-buffer-local 'comint-completion-addsuffix))

(setq shell-mode-hook 'my-shell-setup)
(add-hook 'emacs-startup-hook 'cygwin-shell)

; Change how home key works
(global-set-key [home] 'beginning-or-indentation)
(substitute-key-definition 'beginning-of-line 'beginning-or-indentation global-map)

(defun yank-and-down ()
  "Yank the text and go down a line."
  (interactive)
  (yank)
  (exchange-point-and-mark)
  (next-line))

(defun kill-syntax (&optional arg)
  "Kill ARG sets of syntax characters after point."
  (interactive "p")
  (let ((arg (or arg 1))
    (inc (if (and arg (< arg 0)) 1 -1))
    (opoint (point)))
    (while (not (= arg 0))
      (if (> arg 0)
      (skip-syntax-forward (string (char-syntax (char-after))))
    (skip-syntax-backward (string (char-syntax (char-before)))))
      (setq arg (+ arg inc)))
    (kill-region opoint (point))))

(defun kill-syntax-backward (&optional arg)
  "Kill ARG sets of syntax characters preceding point."
  (interactive "p")
  (kill-syntax (- 0 (or arg 1))))

(global-set-key [(control shift y)] 'yank-and-down)
(global-set-key [(shift backspace)] 'kill-syntax-backward)
(global-set-key [(shift delete)] 'kill-syntax)

(defun insert-file-name (arg filename)
  "Insert name of file FILENAME into buffer after point.
  Set mark after the inserted text.

  Prefixed with \\[universal-argument], expand the file name to
  its fully canocalized path.

  See `expand-file-name'."
  ;; Based on insert-file in Emacs -- ashawley 2008-09-26
  (interactive "*P\nfInsert file name: ")
  (if arg
      (insert (expand-file-name filename))
      (insert filename)))

(defun kill-ring-save-filename ()
  "Copy the current filename to the kill ring"
  (interactive)
  (kill-new (buffer-file-name)))

(defun insert-file-name ()
  "Insert the name of the current file."
  (interactive)
  (insert (buffer-file-name)))

(defun insert-directory-name ()
  "Insert the name of the current directory"
  (interactive)
  (insert (file-name-directory (buffer-file-name))))

(defun jonnay-toggle-debug ()
  "Toggle debugging by toggling icicles, and debug on error"
  (interactive)
  (toggle-debug-on-error)
  (icicle-mode))

(defvar programming-modes
  '(emacs-lisp-mode scheme-mode lisp-mode c-mode c++-mode 
    objc-mode latex-mode plain-tex-mode java-mode
    php-mode css-mode js2-mode nxml-mode nxhtml-mode)
  "List of modes related to programming")

; Text-mate style indenting
(defadvice yank (after indent-region activate)
  (if (member major-mode programming-modes)
      (indent-region (region-beginning) (region-end) nil))) 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-10-18T04:44:18.140

我已经提到了很多其他的，但我认为这些是绝对必要的：

```
(transient-mark-mode 1) ; makes the region visible
(line-number-mode 1)    ; makes the line number show up
(column-number-mode 1)  ; makes the column number show up 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-09-30T17:31:15.113

你可以看这里： http: [//www.dotemacs.de/](http://www.dotemacs.de/)

而且我的 .emacs 放在这里也很长，所以它会使答案不太可读。无论如何，如果你愿意，我可以发给你。

另外，我建议您阅读以下内容：[http ://steve.yegge.googlepages.com/my-dot-emacs-file](http://steve.yegge.googlepages.com/my-dot-emacs-file)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-09-30T17:37:39.063

以下是我依赖的一些键映射：

```
(global-set-key [(control \,)] 'goto-line)
(global-set-key [(control \.)] 'call-last-kbd-macro)
(global-set-key [(control tab)] 'indent-region)
(global-set-key [(control j)] 'join-line)
(global-set-key [f1] 'man)
(global-set-key [f2] 'igrep-find)
(global-set-key [f3] 'isearch-forward)
(global-set-key [f4] 'next-error)
(global-set-key [f5] 'gdb)
(global-set-key [f6] 'compile)
(global-set-key [f7] 'recompile)
(global-set-key [f8] 'shell)
(global-set-key [f9] 'find-next-matching-tag)
(global-set-key [f11] 'list-buffers)
(global-set-key [f12] 'shell) 
```

其他一些杂项，主要用于 C++ 开发：

```
;; Use C++ mode for .h files (instead of plain-old C mode)
(setq auto-mode-alist (cons '("\\.h$" . c++-mode) auto-mode-alist))

;; Use python-mode for SCons files
(setq auto-mode-alist (cons '("SConstruct" . python-mode) auto-mode-alist))
(setq auto-mode-alist (cons '("SConscript" . python-mode) auto-mode-alist))

;; Parse CppUnit failure reports in compilation-mode
(require 'compile)
(setq compilation-error-regexp-alist
      (cons '("\\(!!!FAILURES!!!\nTest Results:\nRun:[^\n]*\n\n\n\\)?\\([0-9]+\\)) test: \\([^(]+\\)(F) line: \\([0-9]+\\) \\([^ \n]+\\)" 5 4)
            compilation-error-regexp-alist))

;; Enable cmake-mode from http://www.cmake.org/Wiki/CMake_Emacs_mode_patch_for_comment_formatting
(require 'cmake-mode)
(setq auto-mode-alist
      (append '(("CMakeLists\\.txt\\'" . cmake-mode)
                ("\\.cmake\\'" . cmake-mode))
              auto-mode-alist))

;; "M-x reload-buffer" will revert-buffer without requiring confirmation
(defun reload-buffer ()
  "revert-buffer without confirmation"
  (interactive)
  (revert-buffer t t)) 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-10-01T17:00:08.753

在 Emacs 中刷新您正在编辑的网页

```
(defun moz-connect()
  (interactive)
  (make-comint "moz-buffer" (cons "127.0.0.1" "4242"))
  (global-set-key "\C-x\C-g" '(lambda () 
                (interactive)
                (save-buffer)
                (comint-send-string "*moz-buffer*" "this.BrowserReload()\n")))) 
```

[与http://hyperstruct.net/projects/mozlab](http://hyperstruct.net/projects/mozlab)结合使用

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-11-04T08:47:14.637

[您可以在我的网站](http://xtalk.msk.su/~ott/en/emacs/)上找到我的配置（在 html 和 tar'ed 存档中）。它包含许多不同模式的设置

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-10-18T04:50:56.253

这个块对我来说是最重要的：

```
(setq locale-coding-system 'utf-8)
(set-terminal-coding-system 'utf-8)
(set-keyboard-coding-system 'utf-8)
(set-selection-coding-system 'utf-8)
(prefer-coding-system 'utf-8) 
```

不过，我一直不清楚它们之间的区别。货物崇拜，我猜...

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2010-02-16T22:48:24.780

我尽量让我的 .emacs 井井有条。配置将始终是一项正在进行的工作，但我开始对整体结构感到满意。

所有的东西都在`~/.elisp`，一个受版本控制的目录（如果感兴趣的话，我使用 git）。 `~/.emacs`只是指向`~/.elisp/dotemacs`它本身刚刚加载`~/.elisp/cfg/init`。该文件依次通过`require`. 这意味着配置文件需要表现得像模式：它们导入它们所依赖的东西，它们`provide`自己在文件的末尾，例如`(provide 'my-ibuffer-cfg)`. 我在我的配置中定义的所有标识符前面加上`my-`.

我根据模式/主题/任务组织配置，而不是根据它们的技术含义，例如，我*没有*一个单独的配置文件，其中定义了*所有*键绑定或面孔。

我`init.el`定义了以下钩子，以确保 Emacs 在保存时重新编译配置文件（编译后的 Elisp 加载速度更快，但我不想手动执行此步骤）：

```
;; byte compile config file if changed
(add-hook 'after-save-hook
          '(lambda ()
                   (when (string-match
                          (concat (expand-file-name "~/.elisp/cfg/") ".*\.el$")
                          buffer-file-name)
           (byte-compile-file buffer-file-name)))) 
```

这是目录结构`~/.elisp`：

`~/.elisp/todo.org`：组织模式文件，我在其中跟踪仍然需要完成的事情（+愿望清单项目）。

`~/.elisp/dotemacs`：符号链接目标`~/.emacs`，加载`~/.elisp/cfg/init`。

`~/.elisp/cfg`: 我自己的配置文件。

`~/.elisp/modes`：仅包含单个文件的模式。

`~/.elisp/packages`: 带有 lisp、文档和可能的资源文件的复杂模式。

我使用 GNU Emacs，那个版本没有真正支持包。因此我手动组织它们，通常是这样的： `~/.elisp/packages/foobar-0.1.3`是包的根目录。子目录`lisp`包含所有 lisp 文件，并且`info`是文档所在的位置。 `~/.elisp/packages/foobar`是一个符号链接，指向当前使用的软件包版本，这样我在更新某些东西时就不需要更改我的配置文件。对于某些软件包，我保留了一个`~/.elisp/packages/foobar.installation`文件，其中记录了有关安装过程的信息。出于性能原因，我在新安装的包中编译所有 elisp 文件，默认情况下不是这种情况。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2010-04-15T06:06:37.493

这是我自己的一些东西：

以 ISO 8601 格式插入日期：

```
(defun insertdate ()
  (interactive)
  (insert (format-time-string "%Y-%m-%d")))

(global-set-key [(f5)] 'insertdate) 
```

对于 C++ 程序员，创建一个类骨架（类的名称将与没有扩展名的文件名相同）：

```
(defun createclass ()
  (interactive)
  (setq classname (file-name-sans-extension (file-name-nondirectory   buffer-file-name)))
  (insert 
"/**
  * " classname".h 
  *
  * Author: Your Mom
  * Modified: " (format-time-string "%Y-%m-%d") "
  * Licence: GNU GPL
  */
#ifndef "(upcase classname)"
#define "(upcase classname)"

class " classname "
{
  public:
    "classname"();
    ~"classname"();

  private:

};
#endif
")) 
```

自动创建右括号：

```
(setq skeleton-pair t)
(setq skeleton-pair-on-word t)
(global-set-key (kbd "[") 'skeleton-pair-insert-maybe)
(global-set-key (kbd "(") 'skeleton-pair-insert-maybe)
(global-set-key (kbd "{") 'skeleton-pair-insert-maybe) 
(global-set-key (kbd "<") 'skeleton-pair-insert-maybe) 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-09-30T20:48:07.233

我使用 paredit 来轻松 (e)lisp 处理和 ido 模式 minibuffer 完成。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-04-15T06:15:55.413

很难回答这个问题，因为每个人使用 Emacs 的目的都不同。

此外，更好的做法可能是亲吻你的 dotmacs。由于Emacs 模式广泛支持[Easy Customization Interface](http://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Easy-Customization)，因此您应该将所有自定义存储在您的`custom-file`（可能是 dotmacs 中的一个单独位置）中，对于[dotmacs](http://github.com/nyuhuhuu/home/blob/68cad23038183405ba02d25af5c72adc86dbc70a/.emacs)，仅将加载路径设置、包要求、挂钩放入其中, 和键绑定。一旦你开始使用[Emacs Starter Kit](http://www.emacsblog.org/2008/12/05/emacs-starter-kit/)，一大堆有用的设置也可能会从你的 dotmacs 中删除。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2011-10-28T21:24:23.030

请参阅 EmacsWiki 的[DotEmacs](http://www.emacswiki.org/emacs/CategoryDotEmacs)类别。它提供了许多指向解决此问题的页面的链接。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-30T17:29:33.713

```
(put 'erase-buffer 'disabled nil)
(put 'downcase-region 'disabled nil)
(set-variable 'visible-bell t)
(set-variable 'tool-bar-mode nil)
(set-variable 'menu-bar-mode nil)

(setq load-path (cons (expand-file-name "/usr/share/doc/git-core/contrib/emacs") load-path))
 (require 'vc-git)
 (when (featurep 'vc-git) (add-to-list 'vc-handled-backends 'git))
 (require 'git)
 (autoload 'git-blame-mode "git-blame"
           "Minor mode for incremental blame for Git." t) 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-02-14T21:41:54.543

我使用 webjump 设置了一些方便的网页和搜索快捷方式

```
(require 'webjump)
(global-set-key [f2] 'webjump)
(setq webjump-sites
      (append '(
        ("Reddit Search" .
         [simple-query "www.reddit.com" "http://www.reddit.com/search?q=" ""])
        ("Google Image Search" .
         [simple-query "images.google.com" "images.google.com/images?hl=en&q=" ""])
        ("Flickr Search" .
         [simple-query "www.flickr.com" "flickr.com/search/?q=" ""])
        ("Astar algorithm" . 
         "http://www.heyes-jones.com/astar")
        )
          webjump-sample-sites)) 
```

关于如何在此处工作的博客文章

[http://justinsboringpage.blogspot.com/2009/02/search-reddit-flickr-and-google-from.html](http://justinsboringpage.blogspot.com/2009/02/search-reddit-flickr-and-google-from.html)

我也推荐这些：

```
(setq visible-bell t) ; no beeping

(setq transient-mark-mode t) ; visually show region

(setq line-number-mode t) ; show line numbers

(setq global-font-lock-mode 1) ; everything should use fonts

(setq font-lock-maximum-decoration t) 
```

我也摆脱了一些多余的 gui 东西

```
 (if (fboundp 'scroll-bar-mode) (scroll-bar-mode -1))
  (if (fboundp 'tool-bar-mode) (tool-bar-mode -1))
  (if (fboundp 'menu-bar-mode) (menu-bar-mode -1))) 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-02-26T10:47:36.020

一行修改加载路径一行加载我的init库一行加载我的emacs init文件

当然，“emacs 初始化文件”非常多，每个特定的东西一个，以确定的顺序加载。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-05-10T14:00:34.640

[emacs-starter-kit](http://github.com/technomancy/emacs-starter-kit/tree/master)作为基础，然后我添加了 .. `vimpulse.el`、`whitespace.el`、`yasnippet`和.`textmate.el``newsticker.el`

在我的 ~/.emacs.d/$USERNAME.el (dbr.el) 文件中：

```
(add-to-list 'load-path (concat dotfiles-dir "/vendor/"))

;; Snippets
(add-to-list 'load-path "~/.emacs.d/vendor/yasnippet/")
(require 'yasnippet)

(yas/initialize)
(yas/load-directory "~/.emacs.d/vendor/yasnippet/snippets")

;; TextMate module
(require 'textmate)
(textmate-mode 'on)

;; Whitespace module
(require 'whitespace)
(add-hook 'ruby-mode-hook 'whitespace-mode)
(add-hook 'python-mode-hook 'whitespace-mode)

;; Misc
(flyspell-mode 'on)
(setq viper-mode t)
(require 'viper)
(require 'vimpulse)

;; IM
(eval-after-load 'rcirc '(require 'rcirc-color))
(setq rcirc-default-nick "_dbr")
(setq rcirc-default-user-name "_dbr")
(setq rcirc-default-user-full-name "_dbr")

(require 'jabber)

;;; Google Talk account
(custom-set-variables
 '(jabber-connection-type (quote ssl))
 '(jabber-network-server "talk.google.com")
 '(jabber-port 5223)
 '(jabber-server "mysite.tld")
 '(jabber-username "myusername"))

;; Theme
(color-theme-zenburn)

;; Key bindings
(global-set-key (kbd "M-z") 'undo)
(global-set-key (kbd "M-s") 'save-buffer)
(global-set-key (kbd "M-S-z") 'redo) 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-05-10T14:11:50.790

始终将我的配置保存在 svn [http://my-trac.assembla.com/ez-conf/browser/emacs.d](http://my-trac.assembla.com/ez-conf/browser/emacs.d)

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-12-10T18:00:01.713

读完这篇文章后，我认为最好有一个简单的站点来进行最好的 .emacs 修改。随时在这里发布和投票：

[http://dotemacs.slinkset.com/](http://dotemacs.slinkset.com/)

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2010-10-22T20:59:53.607

对于[Scala](http://www.scala-lang.org/)编码器

```
;; Load the ensime lisp code... http://github.com/aemoncannon/ensime
(add-to-list 'load-path "ENSIME_ROOT/elisp/")
(require 'ensime)
;; This step causes the ensime-mode to be started whenever ;; scala-mode is started for a buffer. You may have to customize this step ;; if you're not using the standard scala mode.
(add-hook 'scala-mode-hook 'ensime-scala-mode-hook)
;; MINI HOWTO:  ;; Open .scala file. M-x ensime (once per project) 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2011-01-17T16:44:53.063

[https://b7j0c.org/stuff/dotemacs.html](https://b7j0c.org/stuff/dotemacs.html)

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2011-07-19T06:04:33.690

我是 emacs 的新手，在我的 .emacs 文件中有

*   缩进配置
*   颜色主题
*   php模式、咖啡模式和js2模式
*   偶像模式

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2011-08-21T00:12:46.853

FWIW，我的 .emacs 在这里：

[http://svn.red-bean.com/repos/kfogel/trunk/.emacs](http://svn.red-bean.com/repos/kfogel/trunk/.emacs)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2011-10-19T00:49:02.117

很多东西：[https ://github.com/tavisrudd/emacs.d](https://github.com/tavisrudd/emacs.d)

[el-get](https://github.com/dimitri/el-get)使管理它和依赖关系变得更加容易：[https ://github.com/tavisrudd/emacs.d/blob/master/dss-init-el-get.el](https://github.com/tavisrudd/emacs.d/blob/master/dss-init-el-get.el)

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2012-04-29T16:45:39.593

这些年来，我的 emacs 配置已经变得相当大，那里有很多对我有用的东西，但如果我有两个功能，那可能就是那些功能了。

定义 Cx UP 和 Cx DOWN 以移动当前行或向下移动光标，使光标保持在正确的位置：

```
;Down/UP the current line
(global-set-key '[(control x) (up)] 'my-up-line)
(global-set-key '[(control x) (down)] 'my-down-line)
(defun my-down-line()
  (interactive)
  (let ((col (current-column)))
    (forward-line 1)
    (transpose-lines 1)
    (forward-line -1)
    (forward-char col)
    )
  )

(defun my-up-line()
  (interactive)
  (let ((col (current-column)))
    (transpose-lines 1)
    (forward-line -2)
    (forward-char col)
    )
  ) 
```

# .net - 跨多个项目共享应用程序偏好

> ID：154101
> 
> 赞同：2
> 
> 时间：2008-09-30T17:27:46.043
> 
> 标签：.net, app-config

我们有一个相当大的 .NET 解决方案，其中包含多个可执行项目（winforms 和命令行程序）。目前，这些项目中的每一个都有自己的 app.config，其中包含连接字符串、邮件服务器设置等。正如您可以想象的那样，每当需要更新特定设置时，在每个 app.config 文件中进行更改并不是那么方便。

您认为集中管理这些设置的最佳做法是什么？到目前为止，我已经考虑了两种不同的方法。第一种是使用自定义类（或多个类），该类包含设置并从 XML 序列化和反序列化。第二种方法是仅为单个项目定义 app.config 文件并使用 ConfigurationManager.OpenExeConfiguration() 来访问它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T17:32:37.250

在您的启动项目上创建 App.config 并在其他项目上静态链接到它。

您可以通过转到添加->现有项目来静态链接，当单击文件浏览器窗口上的添加按钮时，添加按钮上有一个小的向下箭头。单击此处，将显示“添加为链接”选项。这将在两个项目上放置相同的 App.Config，只有一个实际文件。

如果您的项目有不同的 App.Config，只有“一些”设置相同，请考虑检查文件参数；我的意思是，您可以在一个项目中拥有多个 App.Config：[http ://weblogs.asp.net/pwilson/archive/2003/04/09/5261.aspx](http://weblogs.asp.net/pwilson/archive/2003/04/09/5261.aspx)

只需创建一个中央 common.config 文件并指向它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T18:09:09.860

使用[ConfigSource](http://msdn.microsoft.com/en-us/library/system.configuration.sectioninformation.configsource.aspx)指令从具有共享值的中央文件加载所有设置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T17:37:16.473

我个人建议不要对另一个程序集的 .config 文件引入不必要的依赖。在这种情况下，使用带有序列化的自定义类听起来更干净，但是您将自己暴露在潜在的版本控制问题中，并且您失去了 app.config 提供的潜在优势（节处理程序等）。

# c# - 自定义编译器警告

> ID：154109
> 
> 赞同：127
> 
> 时间：2008-09-30T17:31:02.963
> 
> 标签：c#, .net, vb.net, attributes, compiler-warnings

在 .Net 中使用 ObsoleteAtribute 时，它​​会给您编译器警告，告诉您对象/方法/属性已过时，应该使用其他东西。我目前正在从事一个需要大量重构前雇员代码的项目。我想编写一个自定义属性，我可以使用它来标记方法或属性，这些方法或属性将生成编译器警告，这些警告会给出我编写的消息。像这样的东西

```
[MyAttribute("This code sux and should be looked at")]
public void DoEverything()
{
} 
```

```
<MyAttribute("This code sux and should be looked at")>
Public Sub DoEverything()
End Sub 
```

我希望这会生成一个编译器警告，上面写着“此代码 sux 并且应该查看”。我知道如何创建自定义属性，问题是如何使其在 Visual Studio 中生成编译器警告。

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2008-09-30T18:09:30.640

这值得一试。

您不能扩展 Obsolete，因为它是最终的，但也许您可以创建自己的属性，并将该类标记为已过时，如下所示：

```
[Obsolete("Should be refactored")]
public class MustRefactor: System.Attribute{} 
```

然后，当您使用“MustRefactor”属性标记您的方法时，将显示编译警告。它会生成编译时警告，但错误消息看起来很有趣，您应该自己查看并选择。这非常接近您想要实现的目标。

**更新：使用[此代码](http://pastie.org/282556)它会生成一个警告（不是很好，但我认为没有更好的东西）。**

```
public class User
{
    private String userName;

    [TooManyArgs] // Will show warning: Try removing some arguments
    public User(String userName)
    {
        this.userName = userName;   
    }

    public String UserName
    {
        get { return userName; }
    }
    [MustRefactor] // will show warning: Refactor is needed Here
    public override string ToString()
    {
        return "User: " + userName;
    }
}
[Obsolete("Refactor is needed Here")]
public class MustRefactor : System.Attribute
{

}
[Obsolete("Try removing some arguments")]
public class TooManyArgs : System.Attribute
{

} 
```

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2008-09-30T17:33:50.460

在某些编译器中，您可以使用 #warning 发出警告：

```
#warning "Do not use ABC, which is deprecated. Use XYZ instead." 
```

在 Microsoft 编译器中，您通常可以使用 message pragma：

```
#pragma message ( "text" ) 
```

您提到了 .Net，但没有说明您是使用 C/C++ 还是 C# 进行编程。如果您使用 C# 进行编程，那么您应该知道[C# 支持 #warning 格式](http://msdn.microsoft.com/en-us/library/963th5x3(VS.71).aspx)。

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2008-09-30T19:39:32.093

我们目前正在进行大量重构，无法立即修复所有问题。我们只需在需要返回查看代码的地方使用#warning preproc 命令。它显示在编译器输出中。我不认为你可以把它放在一个方法上，但你可以把它放在方法里面，而且它仍然很容易找到。

```
public void DoEverything() {
   #warning "This code sucks"
} 
```

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2008-09-30T18:20:07.587

## 更新

现在可以使用 Roslyn (Visual Studio 2015)。您可以[构建](https://johnkoerner.com/csharp/creating-your-first-code-analyzer/)[代码分析器](https://github.com/dotnet/roslyn/wiki/How-To-Write-a-C%23-Analyzer-and-Code-Fix)来检查自定义属性

* * *

我不相信这是可能的。ObsoleteAttribute 由编译器特殊处理，并在 C# 标准中定义。为什么 ObsoleteAttribute 到底是不可接受的？在我看来，这正是它的设计目的，并准确地达到了你的要求！

另请注意，Visual Studio 也会即时获取 ObsoleteAttribute 生成的警告，这非常有用。

不要想无益，只是想知道为什么你不热衷于使用它......

不幸的是 ObsoleteAttribute 是密封的（可能部分是由于特殊处理），因此您不能从中继承您自己的属性。

从 C# 标准：-

> 属性 Obsolete 用于标记不应再使用的类型和类型的成员。
> 
> 如果程序使用带有 Obsolete 属性的类型或成员，编译器会发出警告或错误。具体来说，如果没有提供错误参数，或者如果提供了错误参数并且值为 false，编译器会发出警告。如果指定了 error 参数并且值为 true，则编译器会发出错误。

这不是总结了您的需求吗？...您不会比我认为的做得更好。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2010-01-10T22:02:36.813

在 VS 2008 (+sp1) 中，#warnings 在 Clean Soultion & Rebuild Solution 后没有正确显示在错误列表中，不是全部。只有在我打开特定的类文件后，错误列表中才会显示一些警告。所以我被迫使用自定义属性：

```
[Obsolete("Mapping ToDo")]
[AttributeUsage(AttributeTargets.Class | AttributeTargets.Property)]
public class MappingToDo : System.Attribute
{
    public string Comment = "";

    public MappingToDo(string comment)
    {
        Comment = comment;
    }

    public MappingToDo()
    {}
} 
```

所以当我用它标记一些代码时

```
[MappingToDo("Some comment")]
public class MembershipHour : Entity
{
    // .....
} 
```

它会产生如下警告：

> Namespace.MappingToDo 已过时：“映射 ToDo”。

我无法更改警告的文本​​，“一些评论”没有显示错误列表。但它会跳转到文件中的适当位置。因此，如果您需要更改此类警告消息，请创建各种属性。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2014-09-28T21:37:20.770

你试图做的是滥用属性。而是使用 Visual Studio 任务列表。您可以像这样在代码中输入注释：

```
//TODO:  This code sux and should be looked at
public class SuckyClass(){
  //TODO:  Do something really sucky here!
} 
```

然后从菜单中打开查看/任务列表。任务列表有两个类别，用户任务和评论。切换到评论，你会看到你所有的 //Todo: 在那里。双击 TODO 将跳转到代码中的注释。

铝

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-30T17:59:10.930

我不认为你可以。据我所知，对 ObsoleteAttribute 的支持基本上是硬编码到 C# 编译器中的；你不能直接做任何类似的事情。

您可以做的是使用 MSBuild 任务（或构建后事件），针对刚刚编译的程序集执行自定义工具。自定义工具将反映程序集中的所有类型/方法并使用您的自定义属性，此时它可以打印到 System.Console 的默认或错误 TextWriters。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-30T18:11:35.470

查看[ObsoleteAttribute](http://msdn.microsoft.com/en-us/library/system.obsoleteattribute.aspx)的源代码，它看起来并没有做任何特别的事情来生成编译器警告，所以我倾向于使用[@technophile](https://stackoverflow.com/questions/154109/custom-compiler-warnings#154221)并说它是硬编码到编译器中的。您是否有理由不想只使用[ObsoleteAttribute](http://msdn.microsoft.com/en-us/library/system.obsoleteattribute.aspx)来生成警告消息？

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-07-31T15:10:13.580

这是 Roslyn 实现，因此您可以创建自己的属性来即时发出警告或错误。

我创建了一个名为 Type Called`IdeMessage`的属性，它将是生成警告的属性：

```
[AttributeUsage(AttributeTargets.Method, AllowMultiple = true, Inherited = true)]
public class IDEMessageAttribute : Attribute
{
    public string Message;

    public IDEMessageAttribute(string message);
} 
```

为此，您需要先安装 Roslyn SDK 并使用分析器启动一个新的 VSIX 项目。我省略了一些不太相关的部分，比如消息，你可以弄清楚如何做到这一点。在您的分析仪中，您执行此操作

```
public override void Initialize(AnalysisContext context)
{
    context.RegisterSyntaxNodeAction(AnalyzerInvocation, SyntaxKind.InvocationExpression);
}

private static void AnalyzerInvocation(SyntaxNodeAnalysisContext context)
{
    var invocation = (InvocationExpressionSyntax)context.Node;

    var methodDeclaration = (context.SemanticModel.GetSymbolInfo(invocation, context.CancellationToken).Symbol as IMethodSymbol);

    //There are several reason why this may be null e.g invoking a delegate
    if (null == methodDeclaration)
    {
        return;
    }

    var methodAttributes = methodDeclaration.GetAttributes();
    var attributeData = methodAttributes.FirstOrDefault(attr => IsIDEMessageAttribute(context.SemanticModel, attr, typeof(IDEMessageAttribute)));
    if(null == attributeData)
    {
        return;
    }

    var message = GetMessage(attributeData); 
    var diagnostic = Diagnostic.Create(Rule, invocation.GetLocation(), methodDeclaration.Name, message);
    context.ReportDiagnostic(diagnostic);
}

static bool IsIDEMessageAttribute(SemanticModel semanticModel, AttributeData attribute, Type desiredAttributeType)
{
    var desiredTypeNamedSymbol = semanticModel.Compilation.GetTypeByMetadataName(desiredAttributeType.FullName);

    var result = attribute.AttributeClass.Equals(desiredTypeNamedSymbol);
    return result;
}

static string GetMessage(AttributeData attribute)
{
    if (attribute.ConstructorArguments.Length < 1)
    {
        return "This method is obsolete";
    }

    return (attribute.ConstructorArguments[0].Value as string);
} 
```

对此没有 CodeFixProvider，您可以将其从解决方案中删除。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-11-12T17:00:28.830

有几条评论建议插入警告或编译指示。过时的工作方式非常不同！标记库 L 的过时函数，即使调用程序不在库 L 中，程序调用该函数时也会引发过时消息。警告仅在编译 L 时引发消息。

# c# - C# 潜在面试问题……太难了？

> ID：154112
> 
> 赞同：19
> 
> 时间：2008-09-30T17:31:34.287
> 
> 标签：c#, .net, puzzle

在不运行此代码的情况下，确定`Foo`将调用哪个方法：

```
class A
{
   public void Foo( int n )
   {
      Console.WriteLine( "A::Foo" );
   }
}

class B : A
{
   /* note that A::Foo and B::Foo are not related at all */
   public void Foo( double n )
   {
      Console.WriteLine( "B::Foo" );
   }
}

static void Main( string[] args )
{
   B b = new B();
   /* which Foo is chosen? */
   b.Foo( 5 );
} 
```

哪种方法？为什么？运行代码不会作弊。

我在网上找到了这个谜题；我喜欢它，我想我会用它作为面试问题......意见？

编辑：我不会判断候选人是否犯了这个错误，我会用它作为对 C# 和 CLR 本身进行更全面讨论的一种方式，这样我就可以很好地了解候选人的能力。

**来源： http:** [//netpl.blogspot.com/2008/06/c-puzzle-no8-beginner.html](http://netpl.blogspot.com/2008/06/c-puzzle-no8-beginner.html)

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-09-30T17:37:25.257

我真的不会用这个作为面试问题。我知道答案及其背后的原因，但这样的事情应该很少出现，以至于它不应该成为问题。知道答案并不能说明候选人的编码能力。

请注意，即使 A.Foo 是虚拟的并且 B 覆盖它，您也会得到相同的行为。

如果你喜欢 C# 谜题和古怪的东西，[我也有一些（包括这个）](http://pobox.com/~skeet/csharp/teasers.html)。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-09-30T18:41:58.860

太难？不，但你在这个问题中的目标是什么？您希望从受访者那里得到什么？他们知道这种特殊的语法怪癖吗？这要么意味着他们已经很好地研究了规范/语言（对他们有好处），要么他们遇到了这个问题（希望不是他们写的，但如果他们这样做了 - 哎呀）。这两种情况都没有真正表明你手头有一个可靠的程序员/工程师/架构师。我认为重要的不是问题，而是围绕问题的讨论。

当我面试候选人时，我通常会问一个基于语言语义怪癖的看似简单的问题——但我不在乎我的受访者是否知道，因为语义怪癖让我开辟了很多途径，让我找到如果我的候选人有条不紊，他们的沟通方式，如果他们愿意说“我不知道”，他们是否能够独立思考，他们是否了解语言设计和机器架构，他们是否了解平台和可移植性问题-简而言之，我正在寻找很多加起来就是“他们明白了吗？”的成分。这个过程需要一个小时或更长时间。

最后，我实际上并不关心他们是否知道我的问题的答案——这个问题是一个诡计，让我无需询问即可间接获得所有其余信息。如果你在这个问题上没有有价值的不可告人的东西，那就不要费心去问它——你在浪费你的时间和你的候选人的时间。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-30T18:43:38.763

完全同意乔尔的观点。我有 20 多年的设计和编码经验，当我看到它时我想到的第一件事是：它甚至不会编译。

我做出这样的假设是因为我试图避免只有一个数据类型不同的重载，并且在查看代码时甚至没有发现 int/double 的差异；我认为需要一个新的运算符来允许在 B 中重新定义。

事实上，我使用了一个程序员创建的库，用于处理一些文本文件生成，这有点令人困惑，因为其中一个方法有 8 个不同的重载，其中两个仅在最后一个参数的数据类型上有所不同。一个是字符串，一个是字符。参数的字符串版本所需的值是一个字符长的可能性非常好，因此希望您能看到它的发展方向。我们遇到了调试问题，因为库的使用者无意中触发了错误的调用，因为引用差异，单对双。

故事的寓意，感谢候选人不知道答案，因为它可能表明良好的编码习惯。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-30T18:18:29.197

另一个投票反对使用它，但出于不同的原因。

当这样摆在现场时，很多真正优秀的程序员会想出错误的答案，但这并不是因为他们不了解这些概念或无法弄清楚。发生的情况是，他们会看到这样的事情并想，“啊哈，诡计问题！”，然后在回答中继续超越自己。在面试环境中尤其如此，他们没有 IDE 或 Google 或任何其他帮助程序员在日常编程中理所当然的帮助。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-30T17:36:57.597

Console.WriteLine("B::Foo");

因为它会自动转换并使用第一个而无需进一步继承。

我不认为这是一个很好的面试问题，但尝试在不编译代码的情况下解决可能会很有趣。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-02T12:24:36.100

作为一个面试问题并不公平，因为这是一个有点技巧的问题。我想从受访者那里得到的好的答案将更*像是“需要重构”*。

除非您想聘请某人从事编译器工作，否则我不确定您是否需要深入了解 CLR。

对于面试问题，我会寻找能够在回答中显示编码人员理解水平的内容。这更像是一个奇怪/谜题。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-01T00:55:13.690

这实际上是一个技巧问题。

对于“应该”发生什么，答案是模棱两可的。当然，C# 编译器将其从具体的模棱两可的领域中解脱出来。但是，由于这些方法相互重载，既不覆盖也不遮蔽，因此可以合理地假设“最佳参数拟合”应该适用于此处，因此得出结论应该是 A::Foo(int n)当提供一个整数作为参数时调用。

为了证明“应该”发生的事情尚不清楚，完全相同的代码在 VB.NET 中运行时会产生相反的结果：

```
Public Class Form1
    Private Sub Button1_Click(ByVal sender As System.Object, _
                              ByVal e As System.EventArgs) _
                              Handles Button1.Click
        Dim b As New B
        b.Foo(5)   ' A::Foo
        b.Foo(5.0) ' B::Foo
    End Sub
End Class

Class A
    Sub Foo(ByVal n As Integer)
        MessageBox.Show("A::Foo")
    End Sub
End Class

Class B
    Inherits A

    Overloads Sub Foo(ByVal n As Double)
        MessageBox.Show("B::Foo")
    End Sub
End Class 
```

我意识到我正在为 C# 程序员“抨击”VB.NET 不遵守 C# 提供机会。但我认为可以提出一个非常有力的论点，即 VB.NET 在这里做出了正确的解释。

此外，C# IDE 中的 IntelliSense 建议 B 类有两个重载（因为有，或者至少应该有！），但实际上不能调用 B.Foo(int n) 版本（不是没有第一个显式转换为 A 类）。结果是 C# IDE 实际上与 C# 编译器不同步。

另一种看待这个问题的方式是，C# 编译器正在采用预期的重载并将其转换为阴影方法。（这对我来说似乎不是正确的选择，但这显然只是一种意见。）

作为一个面试问题，我认为如果你有兴趣在这里讨论这些问题是可以的。至于“正确”或“错误”，我认为这个问题接近于一个很容易因为错误原因而被遗漏甚至正确的技巧问题。事实上，“应该”这个问题的答案是什么，其实是很值得商榷的。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-01T03:41:22.933

这是一个荒谬的问题——我可以使用 Snippet Compiler 在 60 秒内回答它，如果我曾经在依赖于功能的代码库中工作过——它会很快被重构不存在。

最好的答案是“这是一个愚蠢的设计，不要那样做，你不必解析语言规范就知道它会做什么”。

如果我是被采访者，我会非常看好你的极客琐事信誉，并可能会邀请你参加下一场极客琐事追逐。但是，我不太确定我是否愿意与您/为您合作。如果那是您的目标，请务必询问。

*   请注意，在非正式的情况下，像这样的极客琐事可能会很有趣。但是，对于被采访者来说，采访绝不是有趣或非正式的——为什么还要用被采访者不知道你是否认真对待的琐碎问题来进一步煽动它呢？

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-30T21:50:31.637

我认为这是一个可怕的问题。当真正的答案是“运行它看看！”时，我认为任何问题都是一个可怕的问题。

如果我需要在现实生活中知道这一点，那正是我要做的：创建一个测试项目，输入它，然后找出答案。然后我不必担心抽象推理或 C# 规范中的细节。

就在今天我遇到了这样一个问题：如果我用同一行填充相同类型的 DataTable 两次，会发生什么？行的一份副本，还是两份？即使我改变了它，它会覆盖第一行吗？我想问问别人，但我意识到我可以很容易地启动一个我已经拥有的使用 DataSets 的测试项目，编写一个小方法并对其进行测试。

回答：

...啊，但如果我告诉你，你会错过重点。:) 关键是，在编程中，您不必将这些东西作为假设，如果可以合理地测试它们，您*也不应该这样做。*

所以我认为这是一个可怕的问题。你不是更愿意雇佣一个尝试过然后*知道*会发生什么的开发人员，而不是一个尝试从他逐渐消失的记忆中挖掘出来的开发人员，或者一个会问别人并接受一个答案的开发人员吗？可能是错的？

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-30T19:00:23.950

这对我来说是一个棘手的问题。如果您使用该语言的时间足够长，那么您可能已经遇到了问题并知道了答案；但多久才够长？

这也是一个问题，你的背景可能对你不利。我知道在 C++ 中 B 中的定义会隐藏 A 中的定义，但我不知道它在 C# 中是否同样有效。在现实生活中，我知道这是一个有问题的领域并尝试查找它。在接受采访时，我可能会尝试猜测，因为我被放在了现场。我可能会弄错。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-30T19:07:02.887

仅当您希望候选人在描述他认为应该发生的事情时告诉您他的思维过程时，才可以将其用作问题。谁在乎实际代码的对错——在现实世界中，候选人会发现这样的代码，发现它不起作用并使用调试器和 writeline 调用的组合来调试它，所以如果你想这是一个无用的问题知道（或猜测）正确答案的候选人。

但那些能够解释他们认为会发生什么的人，那是另一回事。即使他们弄错了，也要雇用他们。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2012-01-25T17:06:26.967

在实际工作情况下，需要 5 秒钟才能找出问题所在。编译，测试，哎呀。

我更关心是否有人可以构建良好且可维护的代码。问诸如此类的问题

*   你会如何设计这个，写简单的抽象设计，没有代码。
*   这是一个对象设计。客户来了，说他们想要这个。制定新的设计 - 或 - 讨论需求无法满足实际客户需求的原因。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-19T06:44:48.767

尝试下面给出的类似示例：

```
class Program
{
    class P
    {}
    class Q : P
    {}

    class A 
    { 
        public void Fee(Q q)
        {
            Console.WriteLine("A::Fee");
        }
    }

    class B : A 
    {   
        public void Fee(P p)
        {
            Console.WriteLine("B::Fee");
        }
    }

    static void Main(string[] args) 
    { 
        B b = new B();   
        /* which Fee is chosen? */  

        b.Fee(new Q());
        Console.ReadKey();
    }
} 
```

如果可以隐式转换参数以匹配任何此类方法，编译器似乎更喜欢将“b.Fee()”调用链接到该类型的可用方法而不是继承的方法（基类型的方法）。即参数的隐式转换优先于基类方法链接。

虽然老实说，我发现相反的方法更直观，因为对我来说，继承的方法与直接引入的方法一样好。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-10-23T08:24:33.373

有问题的代码将打印`B::Foo`。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-11-03T11:34:04.570

正如许多人已经说过的那样，当我面试某人时，我想了解候选人是否能够沟通，是否能够编写有意义且易于他人理解的代码，是否可以维护代码等等。我个人不喜欢花时间在建议的练习上。相反，我宁愿做一个练习，让候选人自己编写代码——即使是在普通的文本编辑器中——然后从那里开始基于代码审查、改进等的讨论。无需编译代码：编译器最终会完成它的工作。我知道很多人可能不同意这种方法，但到目前为止，我发现这是寻找优秀候选人的最佳方式。

# asp.net - 可以从不是文件系统的源处理 ASP.NET ASPX 页面吗？

> ID：154117
> 
> 赞同：3
> 
> 时间：2008-09-30T17:32:45.407
> 
> 标签：asp.net

有没有办法执行完整的 ASPX 源文件，其中页面源来自字符串/数据库/资源​​而不是文件系统上的文件？使用 HTTP 处理程序和模块呈现动态内容/图像/等并写入响应是直接的，但似乎没有一种方法可以在文件系统上没有文件的情况下执行/编译 ASPX 源。例如：

*   HttpContext.Current.Server.Execute() 重载需要文件路径
*   System.Web.Compilation.BuildManager 只能从虚拟路径创建

目标是能够从 Handler/Module/ViewEngine 执行如下字符串源，并且不需要文件系统上的文件（但从另一个位置获取源）：

```
<%@ Page language="C#" MasterPageFile="~/Shared/Site.Master" Inherits="System.Web.UI.Page" %>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head id="Head1" runat="server">
<title>ListView Example</title>
</head>
<body>
<form id="form1" runat="server">
<h3>ListView Example</h3>
<asp:ListView ID="List" runat="server" DataSourceID="ProductDataSource">
<LayoutTemplate><ol><asp:PlaceHolder runat="server" ID="itemPlaceholder"></asp:PlaceHolder></ol></LayoutTemplate>
<ItemTemplate><li><%# Eval("ProductName") %></li></ItemTemplate>
</asp:ListView>
<asp:AccessDataSource ID="ProductDataSource" runat="server"DataFile="~/App_Data/Northwind.mdb"SelectCommand="SELECT [ProductName], [QuantityPerUnit], [UnitPrice], [CategoryName] FROM [Alphabetical List of Products]"></asp:AccessDataSource>
</form>
</body>
</html> 
```

（注意：上面的示例只是一个简单的示例，但显示了使用服务器控件、数据绑定语法、母版页和页面指令中可能的用户控件声明等...）

我希望这是有道理的！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T18:16:44.427

也许您需要一个[虚拟路径提供程序](http://msdn.microsoft.com/en-us/library/system.web.hosting.virtualpathprovider.aspx)。它允许您将 ASPX 和代码隐藏存储在不同的媒体中 - RDBMS、xml 文件等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T18:05:34.877

更新：使用 virtualpathprovider 检查[korchev](https://stackoverflow.com/questions/154117#154279)的帖子，它更适合这种情况。

您可以使用带有占位符**文字**控件的虚拟文件并将文字控件替换为实际源吗？

这些可能没有用，但发布了我发现的几个链接：

[在 HttpHandler 中动态加载 ASP.NET 页面类](http://www.west-wind.com/weblog/posts/120530.aspx)

[如何：动态加载页面进行处理](http://weblogs.asp.net/palermo4/archive/2007/07/06/how-to-dynamically-load-a-page-for-processing.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T22:30:53.677

我知道 SharePoint Server 曾经将 ASPX 页面保存在数据库中，而不是文件系统中。细节，但是，我不持有。

# c# - 得到 .PNG 文件。希望嵌入的图标资源在表单标题栏上显示为图标

> ID：154119
> 
> 赞同：36
> 
> 时间：2008-09-30T17:33:23.283
> 
> 标签：c#, .net, winforms

这是一道面试题。鉴于 Visual Studio 2008 和保存为 .PNG 文件的图标，他们需要将图像作为嵌入资源并用作表单标题栏中的图标。

我正在寻找这个问题的模型答案，包括（工作！）代码和任何 Visual Studio 技巧。（如果我下次遇到它，模型答案应该能让我得到这份工作。）

具体来说，我不知道如何将图像作为嵌入式资源加载，也不知道如何将其作为标题栏的图标。

作为部分解决方案，忽略嵌入位，我将资源复制到输出目录并尝试以下操作：-

```
public partial class Form1 : Form
{
    public Form1()
    {
        InitializeComponent();
        this.Icon = new Icon("Resources\\IconImage.png");
    }
} 
```

这失败并出现错误“参数'图片'必须是可以用作图标的图片。”

我假设 .PNG 文件实际上需要是 .ICO，但我看不到如何进行转换。这个假设是正确的还是有不同的问题？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-10-01T03:25:08.947

启动 VS，启动新的 Windows 应用程序。打开属性表，将 .png 文件添加为资源（在本例中为 glider.png ）。从这里开始，您可以将资源作为 WindowsFormsApplication10.Properties.Resources.glider 的位图文件访问

将其用作应用程序图标的代码：

```
 public Form1()
        {
            InitializeComponent();
            Bitmap bmp = WindowsFormsApplication10.Properties.Resources.glider;
            this.Icon = Icon.FromHandle(bmp.GetHicon());
        } 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-10-01T11:12:55.280

`Icon.FromHandle`将导致PNG出现问题，因为PNG具有不止一位的透明度。此类问题可以通过[IconLib 之](http://www.codeproject.com/KB/cs/IconLib.aspx "图标库")类的库来解决。

他们可能不知道该怎么做，他们试图从潜在员工那里挤出答案。此外，从 PNG 设置表单的图标是不必要的性能损失，它本来应该是一个 ICO。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2010-03-18T18:57:17.277

到这里：

[http://www.getpaint.net/](http://www.getpaint.net/)（免费）

和这里：

[Paint.NET ico 插件](http://forums.getpaint.net/index.php?/topic/927-icon-cursor-and-animated-cursor-format-v37-may-2010/)（免费）

安装 Paint.NET。将 ico 插件（第二个链接）放入 Paint.NET\FileTypes 文件夹。启动 Paint.NET。打开您的 .png 并将其另存为 .ico。

自由而轻松。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T17:35:05.497

*[C# 2.0 Convert Bitmap to Icon](http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/4a10d440-707f-48d7-865b-1d8804faf649/)*中关于该主题的一个很好的资源。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-04-10T17:06:08.760

这适用于我的目的，因为我的所有资源都是 PNG 文件：

```
[System.Runtime.InteropServices.DllImport("user32.dll", CharSet = CharSet.Auto)]
extern static bool DestroyIcon(IntPtr handle);

// From http://msdn.microsoft.com/en-us/library/system.drawing.bitmap.gethicon.aspx
private Icon bitmapToIcon(Bitmap myBitmap)
{
    // Get an Hicon for myBitmap.
    IntPtr Hicon = myBitmap.GetHicon();

    // Create a new icon from the handle.
    Icon newIcon = Icon.FromHandle(Hicon);

    return newIcon;
} 
```

# javascript - 跨浏览器兼容性的典型缺陷

> ID：154132
> 
> 赞同：3
> 
> 时间：2008-09-30T17:35:50.610
> 
> 标签：javascript, html, css, cross-browser

主要桌面浏览器中最常见的浏览器兼容性问题是什么？

请不要重复。您遇到的投票问题。我希望列表能够自我排序。“IE sux”不是一个陷阱，而是呼吁投反对票。

[编辑] 是的，我知道这是一项民意调查——我不会在此发布答案来收集积分——我实际上很想知道人们通常会遇到什么。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T18:03:23.570

[Internet Explorer 6 中的透明 PNG，尤其是因为使用 AlphaImageLoader 的常见的、无 JavaScript 的解决方法可能会产生锁定 IE6](http://blogs.cozi.com/tech/2008/03/transparent-png.html)的副作用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T17:58:11.087

CSS - 在现代浏览器中大部分被整理出来，但仍然是一个问题 - 特别是与布局有关。

请注意，这并不重要 - 但这是一个兼容性问题，我在设计网站时几乎总是会回到这个问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T17:50:33.947

缓存和前一页哈希。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T17:39:41.787

内存管理可能是一个问题——不同的垃圾收集器会阻塞不同类型的循环引用，尽管 Firefox 在正确清理复杂对象方面做得很好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T23:53:09.003

我发现 IE 6 对允许的堆栈深度的限制非常小。

有一次，我使用了一个很好的递归函数来获取文档中元素的位置：

```
function getOffsetTop (element) {
    var offset = 0;

    if (element.offsetTop)
        offset = offset + element.offsetTop;

    if (element.offsetParent)
        offset = offset + getOffsetTop(element.offsetParent);   

    return offset;
} 
```

不幸的是，当为非常深的节点层次结构中的元素调用此方法时，IE 抱怨超出了最大堆栈大小（我忘记了确切的错误消息）。为了解决这个问题，我需要使用迭代方法来保持堆栈大小：

```
function getOffsetTop (element) {
    var offset = 0;

    if (element.offsetTop)
        offset = offset + element.offsetTop;

    var parent = element.offsetParent;
    while (parent) {
        if (parent.offsetTop)
            offset = offset + parent.offsetTop;
        parent = parent.offsetParent;
    }

    return offset;
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-10-23T18:56:01.487

浮动。IE6/7 中的浮动错误数不胜数 - [Peekabo](http://www.positioniseverything.net/explorer/peekaboo.html)、[断头台](http://www.positioniseverything.net/explorer/guillotine.html)、[双倍边距](http://www.positioniseverything.net/explorer/doubled-margin.html)、[转义浮动](http://www.positioniseverything.net/explorer/escape-floats.html)、[3px 间隙](http://www.positioniseverything.net/explorer/threepxtest.html)、[重复字符](http://www.positioniseverything.net/explorer/dup-characters.html)、许多清除错误、与可用空间相关的错误...

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-01T04:41:54.707

[Quirksmode](http://quirksmode.org/)列出了许多需要注意的不同之处！-)

——但他像网络上的大多数其他网站和博主一样，专注于他的方式，这导致了一些小或大的错误和不一致......

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-09-18T04:01:10.180

我能想到的最常见的问题——仅本周我就遇到了两次问题——是 IE6 和盒子模型错误。查一下！

具体来说，我正在考虑的问题是，当您浮动 DIV 时，开发人员*认为*它们都适合包装器 DIV，但它们在 IE6 中不适合，因为它们稍大一些。

所以不是三列，而是两列，第三列在屏幕底部的某个地方——你想要：

```
 +-------------------------------+
   |+------+ +-----------+ +------+|
   ||      | |           | |      ||
   || foo  | |   bar     | | baz  ||
   ||      | |           | |      ||
   ||      | |           | |      ||
   |+------+ +-----------+ +------+|
   +-------------------------------+ 
```

但你得到：

```
 +-------------------------------+
   |+--------+ +------------+      |
   ||        | |            |      |
   ||  foo   | |    bar     |      |
   ||        | |            |      |
   ||        | |            |      |
   |+--------+ +------------+      |
   |+------+                       |
   ||      |                       |
   ||      |                       |
   || baz  |                       |
   ||      |                       |
   ||      |                       |
   |+------+                       |
   +-------------------------------+ 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T00:04:39.693

当执行 XMLHttpRequest 并执行函数“onreadystatechange”时，XMLHttpRequest.responseText 属性包含在 Firefox 中加载的数据，但在 IE（可能还有 Safari）中不包含。

这可以防止在这些浏览器中捕获部分数据以用于显示执行进度表。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-09-17T23:56:58.583

我创建的每个固定宽度、居中的站点——即在某些包含 div 的地方使用“margin:0 auto”来使所有内容居中——在我测试它并应用“hack”之前无法在 IE6 上工作。这让我每次。

# c++ - 为什么在宏中使用看似毫无意义的 do-while 和 if-else 语句？

> ID：154136
> 
> 赞同：879
> 
> 时间：2008-09-30T17:36:24.213
> 
> 标签：c++, c, c-preprocessor, c++-faq

在许多 C/C++ 宏中，我看到宏的代码被包裹在一个看似毫无意义的`do while`循环中。以下是示例。

```
#define FOO(X) do { f(X); g(X); } while (0)
#define FOO(X) if (1) { f(X); g(X); } else 
```

我看不到`do while`它在做什么。为什么不直接写这个呢？

```
#define FOO(X) f(X); g(X) 
```

* * *

## 回答 #1

> 赞同：910
> 
> 时间：2008-09-30T17:36:35.693

`do ... while`and`if ... else`是为了让你的宏后面的分号总是意味着同样的事情。假设您有类似第二个宏的东西。

```
#define BAR(X) f(x); g(x) 
```

现在，如果你要`BAR(X);`在一个`if ... else`语句中使用 if 语句的主体没有用大括号括起来，你会大吃一惊。

```
if (corge)
  BAR(corge);
else
  gralt(); 
```

上面的代码将扩展为

```
if (corge)
  f(corge); g(corge);
else
  gralt(); 
```

这在语法上是不正确的，因为 else 不再与 if 相关联。在宏中用大括号括起来并没有帮助，因为大括号后面的分号在语法上是不正确的。

```
if (corge)
  {f(corge); g(corge);};
else
  gralt(); 
```

有两种方法可以解决问题。第一种是使用逗号对宏中的语句进行排序，而不会剥夺它像表达式一样的能力。

```
#define BAR(X) f(X), g(X) 
```

上面版本的 bar`BAR`将上面的代码扩展成下面的代码，在语法上是正确的。

```
if (corge)
  f(corge), g(corge);
else
  gralt(); 
```

如果不是`f(X)`您有更复杂的代码体需要放在自己的块中，例如声明局部变量，这将不起作用。在最一般的情况下，解决方案是使用类似的东西`do ... while`使宏成为一个使用分号而不会混淆的单个语句。

```
#define BAR(X) do { \
  int i = f(X); \
  if (i > 4) g(i); \
} while (0) 
```

您不必使用`do ... while`，您也可以用它来做一些事情`if ... else`，尽管在`if ... else`an 内部扩展时会`if ... else`导致“[悬空 else](http://en.wikipedia.org/wiki/Dangling_else) ”，这可能会使现有悬空 else 问题更难找到，如下面的代码所示.

```
if (corge)
  if (1) { f(corge); g(corge); } else;
else
  gralt(); 
```

关键是在悬挂分号错误的情况下用完分号。当然，在这一点上可以（并且可能应该）争辩说，最好将其声明`BAR`为实际函数，而不是宏。

总之，`do ... while`可以解决 C 预处理器的缺点。当那些 C 风格指南告诉你放弃 C 预处理器时，这就是他们担心的事情。

* * *

## 回答 #2

> 赞同：175
> 
> 时间：2008-09-30T18:12:20.680

宏是预处理器将放入正版代码中的文本的复制/粘贴片段；宏的作者希望替换将产生有效的代码。

成功的三个好“技巧”：

## 帮助宏表现得像真正的代码

普通代码通常以分号结尾。如果用户查看代码不需要...

```
doSomething(1) ;
DO_SOMETHING_ELSE(2)  // <== Hey? What's this?
doSomethingElseAgain(3) ; 
```

这意味着如果分号不存在，用户希望编译器产生错误。

但真正好的理由是，在某些时候，宏的作者可能需要用真正的函数（可能是内联的）替换宏。所以宏应该**真的**像一个。

所以我们应该有一个需要分号的宏。

## 生成有效代码

如 jfm3 的回答所示，有时宏包含多个指令。如果在 if 语句中使用宏，这将是有问题的：

```
if(bIsOk)
   MY_MACRO(42) ; 
```

这个宏可以扩展为：

```
#define MY_MACRO(x) f(x) ; g(x)

if(bIsOk)
   f(42) ; g(42) ; // was MY_MACRO(42) ; 
```

`g`无论 的值如何，都会执行该函数`bIsOk`。

这意味着我们必须为宏添加一个范围：

```
#define MY_MACRO(x) { f(x) ; g(x) ; }

if(bIsOk)
   { f(42) ; g(42) ; } ; // was MY_MACRO(42) ; 
```

## 生成有效代码 2

如果宏是这样的：

```
#define MY_MACRO(x) int i = x + 1 ; f(i) ; 
```

我们可能在以下代码中遇到另一个问题：

```
void doSomething()
{
    int i = 25 ;
    MY_MACRO(32) ;
} 
```

因为它会扩展为：

```
void doSomething()
{
    int i = 25 ;
    int i = 32 + 1 ; f(i) ; ; // was MY_MACRO(32) ;
} 
```

当然，这段代码不会编译。因此，同样，解决方案是使用范围：

```
#define MY_MACRO(x) { int i = x + 1 ; f(i) ; }

void doSomething()
{
    int i = 25 ;
    { int i = 32 + 1 ; f(i) ; } ; // was MY_MACRO(32) ;
} 
```

代码再次正常运行。

## 结合分号+范围效果？

有一个 C/C++ 习惯用法可以产生这种效果： do/while 循环：

```
do
{
    // code
}
while(false) ; 
```

do/while 可以创建一个作用域，从而封装宏的代码，最后需要一个分号，从而扩展为需要一个的代码。

奖金？

C++ 编译器将优化 do/while 循环，因为它的后置条件为假这一事实在编译时是已知的。这意味着像这样的宏：

```
#define MY_MACRO(x)                                  \
do                                                   \
{                                                    \
    const int i = x + 1 ;                            \
    f(i) ; g(i) ;                                    \
}                                                    \
while(false)

void doSomething(bool bIsOk)
{
   int i = 25 ;

   if(bIsOk)
      MY_MACRO(42) ;

   // Etc.
} 
```

将正确扩展为

```
void doSomething(bool bIsOk)
{
   int i = 25 ;

   if(bIsOk)
      do
      {
         const int i = 42 + 1 ; // was MY_MACRO(42) ;
         f(i) ; g(i) ;
      }
      while(false) ;

   // Etc.
} 
```

然后被编译和优化为

```
void doSomething(bool bIsOk)
{
   int i = 25 ;

   if(bIsOk)
   {
      f(43) ; g(43) ;
   }

   // Etc.
} 
```

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2008-09-30T18:05:30.167

@jfm3 - 你对这个问题有一个很好的答案。您可能还想补充一点，宏成语还可以通过简单的“if”语句防止可能更危险（因为没有错误）的意外行为：

```
#define FOO(x)  f(x); g(x)

if (test) FOO( baz); 
```

扩展为：

```
if (test) f(baz); g(baz); 
```

这在语法上是正确的，因此没有编译器错误，但可能会导致始终调用 g() 的意外后果。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2012-08-03T15:21:08.423

上面的答案解释了这些构造的含义，但两者之间存在显着差异，没有提到。事实上，有理由更喜欢`do ... while`结构`if ... else`。

该`if ... else`构造的问题在于它不会*强制*您输入分号。就像在这段代码中：

```
FOO(1)
printf("abc"); 
```

虽然我们省略了分号（错误地），但代码将扩展为

```
if (1) { f(X); g(X); } else
printf("abc"); 
```

并将静默编译（尽管某些编译器可能会针对无法访问的代码发出警告）。但该`printf`语句永远不会被执行。

`do ... while`构造没有这样的问题，因为在之后唯一有效的标记`while(0)`是分号。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2014-03-23T12:04:30.807

### 解释

`do {} while (0)`并`if (1) {} else`确保将宏扩展为仅 1 条指令。除此以外：

```
if (something)
  FOO(X); 
```

将扩展为：

```
if (something)
  f(X); g(X); 
```

并将在控制语句`g(X)`之外执行。`if`使用`do {} while (0)`and时可以避免这种情况`if (1) {} else`。

* * *

### 更好的选择

使用 GNU[语句表达式](https://gcc.gnu.org/onlinedocs/gcc-6.2.0/gcc/Statement-Exprs.html#Statement-Exprs)（不是标准 C 的一部分），您有更好的方法`do {} while (0)`来`if (1) {} else`解决这个问题，只需使用`({})`：

```
#define FOO(X) ({f(X); g(X);}) 
```

并且此语法与返回值兼容（注意`do {} while (0)`不是），如下所示：

```
return FOO("X"); 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2009-10-10T08:27:38.950

虽然预计编译器会优化`do { ... } while(false);`循环，但还有另一种解决方案不需要该构造。解决方案是使用逗号运算符：

```
#define FOO(X) (f(X),g(X)) 
```

甚至更具异国情调：

```
#define FOO(X) g((f(X),(X))) 
```

虽然这适用于单独的指令，但它不适用于构建变量并将其用作以下内容的一部分的情况`#define`：

```
#define FOO(X) (int s=5,f((X)+s),g((X)+s)) 
```

有了这个，将被迫使用 do/while 构造。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2014-11-19T16:19:45.383

Jens Gustedt 的[P99 预处理器库](http://p99.gforge.inria.fr/p99-html/index.html)（是的，存在这种东西的事实也让我大吃一惊！）`if(1) { ... } else`通过定义以下内容，以一种小而重要的方式改进了结构：

```
#define P99_NOP ((void)0)
#define P99_PREFER(...) if (1) { __VA_ARGS__ } else
#define P99_BLOCK(...) P99_PREFER(__VA_ARGS__) P99_NOP 
```

这样做的理由是，与`do { ... } while(0)`构造不同，`break`并且`continue`仍然在给定块内工作，但是`((void)0)`如果在宏调用之后省略分号，则会产生语法错误，否则会跳过下一个块。（这里实际上没有“悬空的 else”问题，因为`else`绑定到最近的`if`，这是宏中的那个。）

如果您对可以使用 C 预处理器或多或少安全地完成的各种事情感兴趣，请查看该库。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2011-12-21T18:42:56.580

由于某些原因，我无法对第一个答案发表评论......

你们中的一些人展示了带有局部变量的宏，但没有人提到你不能只在宏中使用任何名称！总有一天它会咬用户！为什么？因为输入参数被替换到您的宏模板中。在您的宏示例中，您使用了可能最常用的变量名称**i**。

例如当下面的宏

```
#define FOO(X) do { int i; for (i = 0; i < (X); ++i) do_something(i); } while (0) 
```

用于以下函数

```
void some_func(void) {
    int i;
    for (i = 0; i < 10; ++i)
        FOO(i);
} 
```

宏不会使用在 some_func 开头声明的预期变量 i，而是在宏的 do ... while 循环中声明的局部变量。

因此，永远不要在宏中使用公共变量名！

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-18T22:04:41.047

我不认为它被提及所以考虑这个

```
while(i<100)
  FOO(i++); 
```

会被翻译成

```
while(i<100)
  do { f(i++); g(i++); } while (0) 
```

注意`i++`宏如何计算两次。这可能会导致一些有趣的错误。

# javascript - 更改嵌入的谷歌视频 src

> ID：154148
> 
> 赞同：0
> 
> 时间：2008-09-30T17:38:57.810
> 
> 标签：javascript, video

我正在尝试在 Google 视频上重新创建功能，您可以在其中通过`#1h1m1m`输入 URL 来访问视频的某些部分。

所以我有一个嵌入的谷歌视频和右边的链接，我想在该视频的某些时间链接到这些链接。

我可以通过页面刷新来做到这一点，但我试图通过 javascript 来做到这一点，所以我不必这样做。

无论出于何种原因，我似乎都无法通过 javascript 获取嵌入元素的 src。

我没有链接，因为我还没有弄清楚。我只想跳到 Google 视频的不同部分而不重新加载页面。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T00:28:32.807

如果您嵌入的 google 视频是 YouTube 视频，则有记录的 API 可以使播放器搜索到指定时间（以秒为单位）。

请参阅：[YouTube Javascript API 参考](http://code.google.com/apis/youtube/js_api_reference.html)

# .net - 开发人员机器理由

> ID：154159
> 
> 赞同：14
> 
> 时间：2008-09-30T17:41:34.730
> 
> 标签：.net, visual-studio

寻找好的技术来为开发人员证明“比普通机器更好”的机器。我工作的公司为每个人购买同样功能不足的 500 美元系统，并寻找证明 ROI 或使用论据的方法。对不起，我在最初的问题中没有说这个，堆栈是VS 2008，SQL 2005/2008。由于职责要求我们是 SQL 管理员以及 Web/Winform/WebService 开发人员。因此，同时打开 2 个 VS 会话和至少一个 SQL 会话是非常典型的。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-30T17:43:05.133

算出你在编辑 -> 构建 -> 调试周期中花费了多长时间，然后在一年的时间里加起来。然后猜测（有一些合理的通货膨胀）一台好的计算机会对这个数字做什么。将时间改进乘以您的小时费率，并将其作为业务案例展示。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-30T17:45:40.587

一个好的是：

每次编译的额外时间**X**每小时的编译次数**X**工作日的小时数**X**月的天数**X**开发人员的数量

这突出了您有多少（昂贵的）时间被浪费在等待机器完成上。您可以对测试运行等执行相同的操作...

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-30T17:49:27.473

不要忘记在您的请求中包含多个显示设备：拥有第二个屏幕以在一个屏幕上显示代码，在另一个屏幕上显示调试器（例如）是非常宝贵的。或者在一个屏幕上进行编码，而在另一个屏幕上使用语言参考。

您是否有完成构建的中央服务器？如果是这样，争论“比正常情况下更大”的开发工作站可能会很困难。

不过，能够将构建时间缩短 2-3 倍，是购买更大硬件的合乎逻辑的理由。

OTOH，如果一家公司如此担心他们花了多少钱，以至于他们只能得到沃尔玛特价商品（这对于“正常”工作（打字、电子邮件、日程安排、演示）来说很好），他们会吓到——离开他们实际的技术人员，比如你自己，他们实际上想要完成工作，而且他们的工作比行政助理更复杂。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-30T17:51:45.377

除非您正在雇用不称职的开发人员，或者您的开发人员提出了极其荒谬的要求，否则投资回报几乎总是比工作站的成本高几个数量级。无论如何，即使是一台配备 30 英寸显示器的大功率机器也比一个优秀的开发人员的薪水便宜。用一些闪亮的小玩意来取悦开发人员是多么容易。如果你不这样做，隔壁公司就会！

你从开发者那里得到的一切都是通过他或她的工具来传递的。这些工具中最轻微的不足之处将在这些工具的生命周期内复杂化一千倍（预计必须在两年内对其进行升级）。这些不足之处会扼杀开发人员的生产力，甚至可能会产生很多挫败感。为什么您要为您的开发人员节省最重要的资源？我敢打赌，如果你仔细观察，你会发现公司其他地方的浪费要大得多。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T18:02:13.947

表示为代码：

```
AnnualSavings := DeveloperCostPerHour * (AnnualWaitHours(OldPC) - AnnualWaitHours(NewPC));

if AnnualSavings > (MachineCost(NewPC) - MachineCost(OldPC)) then
  ShowMessage('Time to pony up for a new machine!!')
else
  ShowMessage('Sorry bub, gotta keep the old clunker.'); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T19:55:26.530

如果你是一个领薪水的无人机，疯狂地工作并完成要求你做的所有事情，不要浪费你的时间从萝卜上榨血。公司在剥削你，你允许，他们没有理由改变。要么自己花钱（每天为自己争取一些额外的时间），要么找到某种方式让当前的情况导致楼上的痛苦，要么忍受它。

另一方面，如果您的工作时间合理或按小时计酬，您应该能够通过减少工作时间（= 降低成本）或提高生产力（= 更快地完成工作）来证明请求的合理性。您需要确定组织对哪个组织更感兴趣，并以这些术语提出您的请求。

确定（并尽可能量化）动力不足的机器如何阻碍您的生产力并减慢您的速度。然后将其应用于*减少*相同工作的时间*或*同时完成更多工作。

祝你好运！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T17:45:40.807

至少，测试应该在尽可能接近其发布环境的系统上进行。大多数开发人员至少会在他们的桌面上进行一些测试，因此这就是不比您的实际环境差的原因。

如果您的实时环境是一个功能不足的 500 美元系统，那么这就是您的环境。也许你应该为此努力？很难说你应该提出什么其他的东西，而不知道你正在做什么样的开发。应用？服务器？解释语言还是编译语言？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-30T17:45:58.293

我的说法是“程序员生产力的答案不是给每个人都慢机器”

尽可能多地为狗和小马表演做志愿者（有机会向副总裁等重要人物炫耀你所做的事情）。在某些时候，您的机器会陷入困境。他们会问为什么一切都需要这么长时间。说明您的计算机速度非常慢。还要指出你将如何冒着错过最后期限的风险。指出硬盘驱动器如何从不停止研磨。

播放数字，指出与现在升级您的一次性成本相比，您的时间有多昂贵。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-30T18:02:29.190

我可以根据自己的经验做出贡献，为什么更强大的机器会有所帮助：

1.  在不同的配置下测试代码。这将需要运行一些虚拟化解决方案。这样的解决方案需要一台强大的机器。
2.  运行沙箱。很多时候，开发的应用程序需要数据库、Web 服务器或其他补充产品。同样，此类软件可能需要强大的机器。
3.  平行发展。有时，运行多个开发环境实例可能会很有帮助。为此，请将单个实例的系统要求相乘。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-30T19:19:51.983

在硬件上便宜是愚蠢的。与硬件相比，寻找、雇用和保留人员的成本要高得多。最小硬件和出色硬件之间的成本差异通常相当于程序员几周的工资。您应该为开发人员提供他们选择的高端机器和至少 2 个屏幕。如果您的公司不会为您（以及他们）提供成功的工具，那么它们不值得您花时间。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-30T17:48:25.057

Danimal 有一个很好的配方。您可能会在该业务案例中包含一个电子表格，显示基本机器与您公司的“普通”开发人员需要和想要的比较。内存、CPU 速度、预装应用程序、GPU 等。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-30T17:56:38.423

部分原因是机器的生产力和对开发人员的响应能力，否则他们会在编译期间玩椅子比赛；还因为开发人员将安装您将在生产服务器之外看到的最大、资源匮乏的应用程序。

Visual Studio 占用大量磁盘、RAM 和大量 CPU。Eclipse（我被告知）是一样的。任何开发人员为什么要做有用的事情也将拥有源代码控制、生产系统的开发版本（例如要开发的本地数据库）等。所有这些应用程序也占用大量内存和 CPU。

除非您在某处的服务器上进行远程开发，否则您将需要大量资源来安装他们希望您使用的一半臃肿应用程序！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-30T18:12:36.763

是的，我听到了。

基本的理由对我来说总是一样的：较慢的机器 -> 较慢的开发；更快的机器 -> 更快的开发。

如果你的老板过于关注数字，微软也无济于事。

[Visual Studio 设置要求](http://msdn.microsoft.com/en-us/vstudio/aa718687.aspx)：

> 安装 Visual Studio 2005 的系统要求
> 
> **处理器**
> 
> 最低：600 兆赫 (MHz) 奔腾处理器
> 
> 推荐：1 吉赫 (GHz) 奔腾处理器
> 
> **内存**
> 
> 最小：192 兆字节 (MB)
> 
> 推荐：256 MB

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-30T20:34:15.440

我猜你可能不为软件公司工作——像我一样，你可能是制造/硬件公司的软件组的一员，或者可能是金融或教育机构等？

对我来说，与这些类型的公司合作/为这些类型的公司工作，通常不是公司想要拒绝人们完成工作所需的工具，而是不理解“为什么”开发人员需要更好的机器而不是销售人员的问题。

也许尝试使用对持有支票簿的人有意义的类比。当麦当劳就在街对面时，为什么销售人员会带客户去牛排馆？沃尔玛卖 Buffalo 牌螺丝刀，机械师为什么要多花钱买 Snap-On 工具？（当然，我家里有一些 Buffalo 螺丝刀——但我不是机械师）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-30T20:38:13.277

这太荒谬了，开发人员的聘用和支付费用非常昂贵，硬件非常便宜。

在服务器机房中为每个人提供一台像样的机器，以及一台配置良好的服务器（8G 内存应该没问题）是您应该期望的最低要求。

否则，他们如何能够一次运行大量的虚拟机？

严格来说，只要他们有一个不错的开发服务器（我假设这不是游戏开发等），他们的台式机并不重要。不过，两个屏幕是个好主意。

* * *

## 回答 #16

> 赞同：-3
> 
> 时间：2008-09-30T18:07:59.067

告诉他们，您将支付他们廉价机器和您想要的机器之间的差价。如果您有信心它会显着提高您的生产力，那么您将很容易通过绩效奖金/加薪来赚钱。

此外，如果你把钱放在嘴边，那么他们很可能不会坚持让你付钱，因为这会在会计上造成太多问题。

公司标准化购买机器的原因之一是避免员工 A 得到一件东西而员工 B 得到更好的东西时发生的争吵。如果您为此付费，那么没有人会抱怨您拥有更好的 PC。

如果他们仍然说不，那么至少你知道你的立场。他们不认真对待你，也不认真对待开发人员的角色。除尘简历。

# virtualbox - 从应用程序中检测虚拟化操作系统？

> ID：154163
> 
> 赞同：74
> 
> 时间：2008-09-30T17:42:42.217
> 
> 标签：virtualbox, vmware, virtualization, xen, virtual-pc

我需要检测我的应用程序是否在虚拟化操作系统实例中运行。

我找到[了一篇文章](http://www.codeproject.com/KB/system/VmDetect.aspx)，其中包含有关该主题的一些有用信息。同一篇文章出现在多个地方，我不确定原始出处。[VMware](http://www.vmware.com/)实现了一个特定的无效 x86 指令来返回有关自身的信息，而[VirtualPC](http://www.microsoft.com/windows/products/winfamily/virtualpc/default.mspx)使用幻数和 I/O 端口以及 IN 指令。

这是可行的，但在这两种情况下似乎都是未记录的行为。我想 VMWare 或 VirtualPC 的未来版本可能会改变机制。有没有更好的办法？这两种产品是否有受支持的机制？

同样，有没有办法检测[Xen](http://www.xen.org/)或[VirtualBox](http://www.virtualbox.org/)？

我不担心平台故意试图隐藏自己的情况。例如，蜜罐使用虚拟化，但有时会掩盖恶意软件用来检测它的机制。我不在乎我的应用程序会认为它没有在这些蜜罐中虚拟化，我只是在寻找“尽力而为”的解决方案。

该应用程序主要是 Java，尽管我希望为这个特定功能使用本机代码和 JNI。Windows XP/Vista 支持是最重要的，尽管参考文章中描述的机制是 x86 的通用特性并且不依赖于任何特定的操作系统工具。

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2008-09-30T17:59:12.380

你听说过[蓝色药丸，红色药丸吗？](http://web.archive.org/web/20100725003848/http://www.redlightsecurity.com/2008/04/virtualization-red-pill-or-blue.html). 这是一种用于查看您是否在虚拟机中运行的技术。该术语的起源源于向Neo 提供蓝色或红色药丸[的矩阵电影](http://www.imdb.com/title/tt0133093/)（留在矩阵内 = 蓝色，或进入“真实”世界 = 红色）。

以下是一些代码，可以检测您是否在“矩阵”内运行：（从[该站点](http://web.archive.org/web/20110929075510/http://invisiblethings.org/papers/redpill.html)
借用的代码还包含有关手头主题的一些不错的信息）：

```
 int swallow_redpill () {
   unsigned char m[2+4], rpill[] = "\x0f\x01\x0d\x00\x00\x00\x00\xc3";
   *((unsigned*)&rpill[3]) = (unsigned)m;
   ((void(*)())&rpill)();
   return (m[5]>0xd0) ? 1 : 0;
 } 
```

当您在虚拟机中运行时，该函数将返回 1，否则返回 0。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2010-11-28T22:36:45.587

在 Linux 下我使用了命令：**dmidecode**（我在 CentOS 和 Ubuntu 上都有）

来自男人：

> dmidecode 是一种以人类可读格式转储计算机的 DMI（有人说是 SMBIOS）表内容的工具。

所以我搜索了输出，发现它可能是 Microsoft Hyper-V

```
Handle 0x0001, DMI type 1, 25 bytes
System Information
    Manufacturer: Microsoft Corporation
    Product Name: Virtual Machine
    Version: 5.0
    Serial Number: some-strings
    UUID: some-strings
    Wake-up Type: Power Switch

Handle 0x0002, DMI type 2, 8 bytes
Base Board Information
    Manufacturer: Microsoft Corporation
    Product Name: Virtual Machine
    Version: 5.0
    Serial Number: some-strings 
```

另一种方法是搜索eth0的MAC地址与哪个厂商有关： http: [//www.coffer.com/mac_find/](http://www.coffer.com/mac_find/)

如果它返回 Microsoft、vmware 等，那么它可能是一个虚拟服务器。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2010-08-16T18:32:49.970

VMware 有一种[机制来确定软件是否在 VMware 虚拟机](http://kb.vmware.com/kb/1009458)知识库文章中运行，该文章有一些源代码。

微软还有一个关于[“确定是否安装了管理程序”](http://msdn.microsoft.com/en-us/library/ff538624%28VS.85%29.aspx)的页面。[MS 在其“服务器虚拟化验证测试”](http://msdn.microsoft.com/en-us/library/dd871279%28v=MSDN.10%29.aspx)文档的“ IsVM 测试”部分中详细说明了虚拟机管理程序的这一要求

VMware 和 MS 文档都提到使用 CPUID 指令来检查管理程序存在位（寄存器 ECX 的第 31 位）

RHEL bugtracker 有一个用于[“应为 CPUID 叶 0x00000001 设置 ISVM 位 (ECX:31)”](https://bugzilla.redhat.com/show_bug.cgi?id=573771)以设置 Xen 内核下寄存器 ECX 的第 31 位。

因此，在不了解供应商细节的情况下，您似乎可以使用 CPUID 检查来了解您是否在虚拟运行。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-09-30T17:52:44.750

不，这是不可能完全准确地检测到的。一些虚拟化系统，比如[QEMU](http://www.qemu.org/)，模拟整个机器到硬件寄存器。让我们扭转局面：你想做什么？也许我们可以提供帮助。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-10-02T06:58:56.117

我认为继续前进，依靠像坏掉的 SIDT 虚拟化这样的技巧并没有真正的帮助，因为硬件填补了奇怪和混乱的 x86 架构留下的所有漏洞。最好的办法是游说 Vm 提供者以一种标准的方式告诉您您在 VM 上——至少在用户明确允许的情况下是这样。但是，如果我们假设我们明确允许检测到 VM，我们也可以在其中放置可见标记，对吗？我建议只用一个文件更新你的虚拟机上的磁盘，告诉你你在一个虚拟机上——例如，文件系统根目录中的一个小文本文件。或者检查 ETH0 的 MAC，并将其设置为给定的已知字符串。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2014-04-30T15:41:54.613

在 virtualbox 上，假设您可以控制 VM 来宾并且您有 dmidecode，您可以使用以下命令：

```
dmidecode -s bios-version 
```

它会回来

```
VirtualBox 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-05-28T13:21:14.977

我想推荐一篇发表在 Usenix HotOS '07 上的论文，*Comptibility is Not Transparency: VMM Detection Myths and Realities*，它总结了几种判断应用程序是否在虚拟化环境中运行的技术。

例如，使用 sidt 指令，就像 redpill 一样（但这条指令也可以通过动态翻译变得透明），或者将 cpuid 的运行时间与其他非虚拟化指令进行比较。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2010-01-14T23:34:09.757

在安装 newes Ubuntu 时，我发现了名为 imvirt 的软件包。看看它[http://micky.ibh.net/~liske/imvirt.html](http://micky.ibh.net/~liske/imvirt.html)

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2015-08-14T14:39:13.940

此 C 函数将检测 VM 来宾操作系统：

（在 Windows 上测试，使用 Visual Studio 编译）

```
#include <intrin.h>

    bool isGuestOSVM()
    {
        unsigned int cpuInfo[4];
        __cpuid((int*)cpuInfo,1);
        return ((cpuInfo[2] >> 31) & 1) == 1;
    } 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2019-03-06T04:16:14.230

在 linux systemd 上，提供了一个用于检测系统是否作为虚拟机运行的命令。

命令：
`$ systemd-detect-virt`

如果系统是虚拟化的，那么它会输出虚拟化软件/技术的名称。如果不是，则输出`none`

例如，如果系统正在运行 KVM，那么：

```
$ systemd-detect-virt
kvm 
```

您不需要将其作为 sudo 运行。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-09-30T17:45:18.123

在 Linux 下，您可以在 /proc/cpuinfo 上进行报告。如果它在 VMware 中，它的出现通常与在裸机上不同，但并非总是如此。Virtuozzo 显示了对底层硬件的直通。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-09-30T17:48:55.947

尝试读取[SMBIOS](http://www.dmtf.org/standards/smbios/)结构，尤其是带有[BIOS](http://www.dmtf.org/standards/published_documents/DSP0134_2.6.0.pdf)信息的结构。

在 Linux 中，您可以使用[dmidecode](http://www.nongnu.org/dmidecode/)实用程序来浏览信息。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2012-08-09T08:44:38.257

检查工具[virt-what](http://linux.die.net/man/1/virt-what)。它使用前面提到的 dmidecode 来确定您是否在虚拟主机上和类型。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2016-10-12T09:18:10.897

我尝试了朋友建议的不同方法。在 VMWARE 上运行的虚拟机没有 CPU TEMPERATURE 属性。即它们不显示 CPU 的温度。我正在使用 CPU 温度计应用程序来检查 CPU 温度。

**（在 VMWARE 中运行的 Windows）** [![在此处输入图像描述](https://i.stack.imgur.com/YILzM.jpg)](https://i.stack.imgur.com/YILzM.jpg)

**（在真实 CPU 上运行的 Windows）** [![在此处输入图像描述](https://i.stack.imgur.com/XpKhV.png)](https://i.stack.imgur.com/XpKhV.png)

所以我编写了一个小 C 程序来检测温度传感器

```
#include "stdafx.h"

#define _WIN32_DCOM
#include <iostream>
using namespace std;
#include <comdef.h>
#include <Wbemidl.h>

#pragma comment(lib, "wbemuuid.lib")

int main(int argc, char **argv)
{
    HRESULT hres;

    // Step 1: --------------------------------------------------
    // Initialize COM. ------------------------------------------

    hres = CoInitializeEx(0, COINIT_MULTITHREADED);
    if (FAILED(hres))
    {
        cout << "Failed to initialize COM library. Error code = 0x"
            << hex << hres << endl;
        return 1;                  // Program has failed.
    }

    // Step 2: --------------------------------------------------
    // Set general COM security levels --------------------------

    hres = CoInitializeSecurity(
        NULL,
        -1,                          // COM authentication
        NULL,                        // Authentication services
        NULL,                        // Reserved
        RPC_C_AUTHN_LEVEL_DEFAULT,   // Default authentication 
        RPC_C_IMP_LEVEL_IMPERSONATE, // Default Impersonation  
        NULL,                        // Authentication info
        EOAC_NONE,                   // Additional capabilities 
        NULL                         // Reserved
        );

    if (FAILED(hres))
    {
        cout << "Failed to initialize security. Error code = 0x"
            << hex << hres << endl;
        CoUninitialize();
        return 1;                    // Program has failed.
    }

    // Step 3: ---------------------------------------------------
    // Obtain the initial locator to WMI -------------------------

    IWbemLocator *pLoc = NULL;

    hres = CoCreateInstance(
        CLSID_WbemLocator,
        0,
        CLSCTX_INPROC_SERVER,
        IID_IWbemLocator, (LPVOID *)&pLoc);

    if (FAILED(hres))
    {
        cout << "Failed to create IWbemLocator object."
            << " Err code = 0x"
            << hex << hres << endl;
        CoUninitialize();
        return 1;                 // Program has failed.
    }

    // Step 4: -----------------------------------------------------
    // Connect to WMI through the IWbemLocator::ConnectServer method

    IWbemServices *pSvc = NULL;

    // Connect to the root\cimv2 namespace with
    // the current user and obtain pointer pSvc
    // to make IWbemServices calls.
    hres = pLoc->ConnectServer(
        _bstr_t(L"ROOT\\CIMV2"), // Object path of WMI namespace
        NULL,                    // User name. NULL = current user
        NULL,                    // User password. NULL = current
        0,                       // Locale. NULL indicates current
        NULL,                    // Security flags.
        0,                       // Authority (for example, Kerberos)
        0,                       // Context object 
        &pSvc                    // pointer to IWbemServices proxy
        );

    if (FAILED(hres))
    {
        cout << "Could not connect. Error code = 0x"
            << hex << hres << endl;
        pLoc->Release();
        CoUninitialize();
        return 1;                // Program has failed.
    }

    cout << "Connected to ROOT\\CIMV2 WMI namespace" << endl;

    // Step 5: --------------------------------------------------
    // Set security levels on the proxy -------------------------

    hres = CoSetProxyBlanket(
        pSvc,                        // Indicates the proxy to set
        RPC_C_AUTHN_WINNT,           // RPC_C_AUTHN_xxx
        RPC_C_AUTHZ_NONE,            // RPC_C_AUTHZ_xxx
        NULL,                        // Server principal name 
        RPC_C_AUTHN_LEVEL_CALL,      // RPC_C_AUTHN_LEVEL_xxx 
        RPC_C_IMP_LEVEL_IMPERSONATE, // RPC_C_IMP_LEVEL_xxx
        NULL,                        // client identity
        EOAC_NONE                    // proxy capabilities 
        );

    if (FAILED(hres))
    {
        cout << "Could not set proxy blanket. Error code = 0x"
            << hex << hres << endl;
        pSvc->Release();
        pLoc->Release();
        CoUninitialize();
        return 1;               // Program has failed.
    }

    // Step 6: --------------------------------------------------
    // Use the IWbemServices pointer to make requests of WMI ----

    // For example, get the name of the operating system
    IEnumWbemClassObject* pEnumerator = NULL;
    hres = pSvc->ExecQuery(
        bstr_t("WQL"),
        bstr_t(L"SELECT * FROM Win32_TemperatureProbe"),
        WBEM_FLAG_FORWARD_ONLY | WBEM_FLAG_RETURN_IMMEDIATELY,
        NULL,
        &pEnumerator);

    if (FAILED(hres))
    {
        cout << "Query for operating system name failed."
            << " Error code = 0x"
            << hex << hres << endl;
        pSvc->Release();
        pLoc->Release();
        CoUninitialize();
        return 1;               // Program has failed.
    }

    // Step 7: -------------------------------------------------
    // Get the data from the query in step 6 -------------------

    IWbemClassObject *pclsObj = NULL;
    ULONG uReturn = 0;

    while (pEnumerator)
    {
        HRESULT hr = pEnumerator->Next(WBEM_INFINITE, 1,
            &pclsObj, &uReturn);

        if (0 == uReturn)
        {
            break;
        }

        VARIANT vtProp;

        // Get the value of the Name property
        hr = pclsObj->Get(L"SystemName", 0, &vtProp, 0, 0);
        wcout << " OS Name : " << vtProp.bstrVal << endl;
        VariantClear(&vtProp);
        VARIANT vtProp1;
        VariantInit(&vtProp1);
        pclsObj->Get(L"Caption", 0, &vtProp1, 0, 0);
        wcout << "Caption: " << vtProp1.bstrVal << endl;
        VariantClear(&vtProp1);

        pclsObj->Release();
    }

    // Cleanup
    // ========

    pSvc->Release();
    pLoc->Release();
    pEnumerator->Release();
    CoUninitialize();

    return 0;   // Program successfully completed.

} 
```

**在 Vmware 机器上输出** [![在此处输入图像描述](https://i.stack.imgur.com/JXhOK.jpg)](https://i.stack.imgur.com/JXhOK.jpg)

**真实 CPU 上的输出** [![在此处输入图像描述](https://i.stack.imgur.com/5SNFn.png)](https://i.stack.imgur.com/5SNFn.png)

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2015-09-07T02:22:40.737

我使用这个`C#`类来检测来宾操作系统是否在虚拟环境中运行（**仅限 Windows**）：

**系统信息.cs**

```
using System;
using System.Management;
using System.Text.RegularExpressions;

namespace ConsoleApplication1
{
    public class sysInfo
    {
            public static Boolean isVM()
            {
                bool foundMatch = false;
                ManagementObjectSearcher search1 = new ManagementObjectSearcher("select * from Win32_BIOS");
                var enu = search1.Get().GetEnumerator();
                if (!enu.MoveNext()) throw new Exception("Unexpected WMI query failure");
                string biosVersion = enu.Current["version"].ToString();
                string biosSerialNumber = enu.Current["SerialNumber"].ToString();

                try
                {
                    foundMatch = Regex.IsMatch(biosVersion + " " + biosSerialNumber, "VMware|VIRTUAL|A M I|Xen", RegexOptions.IgnoreCase);
                }
                catch (ArgumentException ex)
                {
                    // Syntax error in the regular expression
                }

                ManagementObjectSearcher search2 = new ManagementObjectSearcher("select * from Win32_ComputerSystem");
                var enu2 = search2.Get().GetEnumerator();
                if (!enu2.MoveNext()) throw new Exception("Unexpected WMI query failure");
                string manufacturer = enu2.Current["manufacturer"].ToString();
                string model = enu2.Current["model"].ToString();

                try
                {
                    foundMatch = Regex.IsMatch(manufacturer + " " + model, "Microsoft|VMWare|Virtual", RegexOptions.IgnoreCase);
                }
                catch (ArgumentException ex)
                {
                    // Syntax error in the regular expression
                }

                    return foundMatch;
            }
        }

} 
```

* * *

**用法：**

```
 if (sysInfo.isVM()) { 
            Console.WriteLine("VM FOUND");
        } 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2021-03-13T17:12:22.070

我想出了一个通用的方法来检测每一种类型的 Windows 虚拟机，只需要 1 行代码。它支持win7--10（xp尚未测试）。

## 为什么我们需要通用方式？

最常用的方法是从 win32 搜索和匹配供应商值。但是如果有 1000 多家虚拟机制造商呢？那么您将不得不编写一个代码来匹配 1000 多个 VM 签名。但它的时间浪费。即使过了一段时间，也会有新的其他虚拟机启动，你的脚本也会被浪费掉。

## 背景

我为此工作了好几个月。我做了很多测试，观察到： **win32_portconnector**在虚拟机上总是为空且为空。请查看完整报告

```
//asked at: https://stackoverflow.com/q/64846900/14919621
what win32_portconnector is used for ? This question have 3 parts.
1) What is the use case of win32_portconnector ?    //https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-portconnector
2) Can I get state of ports using it like Mouse cable, charger, HDMI cables etc ?
3) Why VM have null results on this query : Get-WmiObject Win32_PortConnector ? 
```

**在虚拟机上：**

```
PS C:\Users\Administrator> Get-WmiObject Win32_PortConnector 
```

**在真实环境中：**

```
PS C:\Users\Administrator> Get-WmiObject Win32_PortConnector
Tag                         : Port Connector 0
ConnectorType               : {23, 3}
SerialNumber                :
ExternalReferenceDesignator :
PortType                    : 2

Tag                         : Port Connector 1
ConnectorType               : {21, 2}
SerialNumber                :
ExternalReferenceDesignator :
PortType                    : 9

Tag                         : Port Connector 2
ConnectorType               : {64}
SerialNumber                :
ExternalReferenceDesignator :
PortType                    : 16

Tag                         : Port Connector 3
ConnectorType               : {22, 3}
SerialNumber                :
ExternalReferenceDesignator :
PortType                    : 28

Tag                         : Port Connector 4
ConnectorType               : {54}
SerialNumber                :
ExternalReferenceDesignator :
PortType                    : 17

Tag                         : Port Connector 5
ConnectorType               : {38}
SerialNumber                :
ExternalReferenceDesignator :
PortType                    : 30

Tag                         : Port Connector 6
ConnectorType               : {39}
SerialNumber                :
ExternalReferenceDesignator :
PortType                    : 31 
```

## 给我看代码

基于这些测试，我制作了一个可以检测 Windows VM 的小程序。

```
//@graysuit
//https://graysuit.github.io
//https://github.com/Back-X/anti-vm
using System;
using System.Windows.Forms;

public class Universal_VM_Detector
{
    static void Main()
    {
        if((new System.Management.ManagementObjectSearcher("SELECT * FROM Win32_PortConnector")).Get().Count == 0)
        {
            MessageBox.Show("VM detected !");
        }
        else
        {
            MessageBox.Show("VM NOT detected !");
        }
    }
} 
```

您可以[阅读代码](https://github.com/Back-X/anti-vm/blob/main/anti-vm.cs#L11)或获得[编译的可执行文件](https://github.com/Back-X/anti-vm/actions)。

## 稳定

它在许多环境中进行了测试，并且非常稳定。

*   检测到 Visrtualbox
*   检测 Vmware
*   检测 Windows 服务器
*   检测 RDP
*   检测到 Virustotal
*   检测[any.run](https://app.any.run/tasks/874cd411-5996-4e93-83d8-fdc72e95215a) 等...

# linq-to-sql - 是否可以在 LinqToSql 中使用 Soundex（或其他 SQL 函数）？

> ID：154179
> 
> 赞同：3
> 
> 时间：2008-09-30T17:47:39.927
> 
> 标签：linq-to-sql, soundex

我正在重构一些当前在存储过程中实现的代码以使用 LinqToSql（用于培训）。是否可以在 linqToSql 查询中使用 SQL 函数？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T17:56:12.917

这是来自 MSDN 论坛帖子的一些有用信息。 [Soundex 和 LINQ](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2940301&SiteID=1)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-06-06T14:43:30.690

我自己还没有尝试过，但[最初发布在这里](https://stackoverflow.com/questions/2993087/linq-to-sql-soundex-possible)的以下方法似乎是最好的解决方案。

```
 [Function(Name="SoundEx", IsComposable = true)]
    public string SoundsLike(string input)
    {
        throw new NotImplementedException();
    } 
```

# unit-testing - NUnit（和 MSTest）如何处理改变静态/共享变量的测试？

> ID：154180
> 
> 赞同：9
> 
> 时间：2008-09-30T17:47:59.083
> 
> 标签：unit-testing, nunit, parallel-processing

我有一些代码使用共享网关模式来实现控制容器的反转。我有数百个 NUnit 单元测试来练习使用这个 IOC 的代码。它们都可以工作（在我的机器上！）但我担心这些测试在负载下可能会失败。我似乎记得 NUnit（和 MSTest）尝试在多个线程上并行运行测试（这肯定会触发静态/共享网关上的竞争条件），但我找不到任何说明实际发生情况的文档。我的经验是 NUnit 似乎是按顺序运行测试的。我的问题是，NUnit（或 MSTest）是否曾经并行运行单元测试？如果有，在什么条件下？而且，我可以通过某种配置选项将其关闭吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T18:10:35.770

**更新：**

Visual Studio 2010 引入了并行运行测试的能力。

这是有关如何启用此功能的[分步文章。](http://blogs.msdn.com/b/vstsqualitytools/archive/2009/12/01/executing-unit-tests-in-parallel-on-a-multi-cpu-core-machine.aspx)

**MsTest：**
因此，来自 Microsoft Visual Studio Team System 的 David Williamson在 MSDN 论坛的[这篇文章中表示：](http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=3894574&SiteID=1)

> 在 VS 或通过 mstest.exe 运行时，测试绝对不会并行运行。如果它们是通过 VS 在负载测试中运行的，那就另当别论了。但是，基本执行始终是串行的。

此外，使用 MsTest 运行的测试每个都使用不同的线程运行，以确保您对每个测试都有一个干净的状态。无法禁用此行为。

**NUnit：**
NUnit 在同一个线程上运行所有测试。

# c# - 在不触发事件的情况下设置 WPF 依赖属性

> ID：154184
> 
> 赞同：3
> 
> 时间：2008-09-30T17:49:05.307
> 
> 标签：c#, wpf, events, dependency-properties

我需要在我的代码中的控件 (Slider.Value) 上设置依赖属性，而不触发 ValueChanged 事件（因为我设置了值，而不是用户）。在 WPF 中处理这种情况的最佳方法是什么？

为了澄清起见，我要做的是将 WPF 滑块连接到 WinForms 用户控件。目前在我的应用程序中，我有一个 ValueChanged 事件处理程序，它通过方法调用将滑块值传递给 WinForms 控件。WinForms 控件（实际上是原生 OpenGL 窗口的包装器）需要能够根据其内部计算动态更改滑块。为此，我使用了一个滑块 (ISlider) 的抽象，我在我的应用程序中实例化了该滑块的 WPF 风格，并通过 WinForms 用户控件上的 .NET 属性将一个句柄传递给 WinForms 控件。所有这些目前都在工作，只是当内部逻辑决定滑块需要更改时，它调用 ISlider::SetPos()，然后更改 WPF 滑块，然后在滑块上触发 ValueChanged 事件，并且该事件的处理程序提取滑块的位置并将其传递给最初发起该事件的 WinForms 控件。ligaz 和 Alan Le 的建议似乎都应该奏效，但我只是不确定我是否会以最好的方式解决这个问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T23:33:59.563

这是一个简单的解决方法/黑客。添加一个布尔值来跟踪您是否更改了设置，比如说“IsChangedByMe”。当您在代码中更改依赖属性时，将 bool 设置为 true。在 ValueChanged 事件中，如果 IsChangedByMe 为真，则不执行任何操作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T06:49:35.837

你确定你真的想这样做吗？如果有一段 UI 数据绑定到该属性，并且您允许在不触发 ValueChanged 事件的情况下更改值，那么您很快就会使您的 UI 不再与数据同步。

对于您的滑块，假设用户将其放置在 75%。现在您的代码在后台将其更改为 10%，但抑制了更改通知。它在屏幕上看起来仍然像 75%（因为它没有被告知它已更改），但它被正在运行的代码用作 10%。听起来像是混乱的秘诀。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T21:51:56.393

一种可能的解决方案是从 Slider 派生并覆盖*OnValueChanged(...)*。当您不想引发事件时，您应该什么都不做，否则您应该调用基本实现。

# marshalling - 什么是对象编组？

> ID：154185
> 
> 赞同：61
> 
> 时间：2008-09-30T17:49:10.907
> 
> 标签：marshalling, terminology, glossary

我经常听到这个概念，但我并没有很好地理解它是什么。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-09-30T17:52:43.520

将内存中的对象转换为可以写入磁盘或通过网络发送等的格式。

[维基百科的描述](http://en.wikipedia.org/wiki/Marshalling_(computer_science))。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-09-30T17:51:38.170

我不敢苟同，维基百科对此非常清楚。

> 在计算机科学中，编组（类似于序列化）是将对象的内存表示转换为适合存储或传输的数据格式的过程。当必须在计算机程序的不同部分之间或从一个程序到另一个程序之间移动数据时，通常使用它。

[http://en.wikipedia.org/wiki/Marshalling_(computer_science)](http://en.wikipedia.org/wiki/Marshalling_(computer_science))

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-30T18:59:04.513

人们已经很清楚地定义了编组，所以我将跳过定义并跳转到一个示例。

远程过程调用使用编组。调用远程函数时，您必须将参数编组为某种标准格式，以便可以通过网络传输。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-30T17:57:06.737

[编组](http://en.wikipedia.org/wiki/Marshalling_(computer_science))是将对象的内存表示转换为可以存储或传输的数据格式的过程。它也称为[序列化](http://en.wikipedia.org/wiki/Serialization)（尽管在某些情况下可能会有所不同）。对象的内存表示可以存储为二进制或 XML 或任何适合存储和/或传输的格式，以允许您解组它并取回原始对象。

例如，如果您有一些带有客户端和服务器组件的在线游戏，并且您想将包含玩家统计信息和世界坐标的玩家对象从客户端发送到服务器（或相反），您可以简单地编组它在客户端，通过网络发送，并在另一端解组它，它会出现在服务器上，就好像对象是在服务器本身上创建的一样。这是一个红宝石示例：

```
srcplayer = Player.new
# marshal (store it as string)
str = Marshal.dump(srcplayer)
#unmarshal (get it back)
destplayer = Marshal.load(str) 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-30T17:55:26.977

我将谷歌搜索澄清为“数据编组”，第一次点击是[在一个名为 webopedia 的地方](http://www.webopedia.com/TERM/D/data_marshalling.html)，这非常好。要点是您将数据来回转换为一种形式，以便通过网络传输。它解决的问题是您不能真正通过网络以程序可用的形式传输数据。您必须解决许多问题，包括数据的字节顺序、如何存储复杂的数据类型（如字符串）等。

编组不仅是为了解决网络传输问题，还包括其他问题，例如从一种架构到另一种架构，可能是不同的语言，尤其是那些可能使用虚拟机之类的语言，以及其他“翻译”问题。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-30T18:20:28.570

编组是跨应用程序边界或不同数据格式之间传输数据的过程。编组非常常见，例如将数据写入磁盘或数据库在技术上是编组，但该术语倾向于用于描述“外部”API 或进程间通信的数据转换。

例如，在 .NET 中，托管和非托管代码之间的通信（例如访问某些 win32 API）可能需要编组，以便在托管 C# 对象和 C/C++ 样式对象（结构、句柄、输出缓冲区、等）静态[元帅类](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal_members.aspx)的帮助可能会有所帮助。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-30T17:52:23.050

这意味着将任何数据转换为另一种数据类型以传输到另一个系统。

例如，将结构编组到 XML 文档中以发送到 Web 服务，或编组指针以发送到不同的线程单元。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-30T17:57:16.580

基本上，它是一个表达式，用于将对象（或类似对象）一般地转换为另一种表示形式，（例如）可以通过线路发送或存储到磁盘（通常是字符串或二进制流。相反，解组，描述读取编组的相反方向表示和重新创建对象或之前存在的任何内存结构。

另一个当前的日常示例是 JSON

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-30T17:52:36.577

在编程中非常通用的意义上，它只是意味着以一种格式获取数据并将其转换为其他一些子系统可以接受的格式。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-04-25T13:48:30.737

编组是跨 ABI 边界调用时需要进行的调用参数转换。边界可能在COM客户端和COM服务器之间，其中COM客户端的ABI的类型需要通过COM库编组为COM二进制的ABI（在COM中，编组也可以指在同一进程中跨越单元边界时所需的参数到要发送到所属线程的消息队列以由 COM 窗口过程处理和解组的消息格式，并且在跨越进程边界的情况下，附加的由 COM 代理编组到 RPC/LPC 的步骤，即将 LPC 消息发送到 LPC 端口）。

第二种情况的一个例子是 Mono .NET。您可以从非托管（本机）代码（C++，不由虚拟机库管理，而是由虚拟机库管理和运行，由内部对象和结构表示）调用托管代码（高级语言）链接到库），并且您还可以在使用虚拟机库 API 设置虚拟机时基于 C++ 代码进行的内部绑定执行从 C# 到非托管（本机）代码 (C++) 的本机调用。例如，`System.String`在 C# 中，内部由`MonoString`.`MonoString`是一个使用 C++ ABI 的 C++ 对象，但与标准使用方式以及本机代码如何期望字符串类型的参数在 ABI 中表示的方式不同，因为 VM 库已使用逻辑实现了自己的 ABI C++ ABI 的某种安排——装在 C++ 类型的对象中，`MonoString*`而不是`const wchar_t*`. `System.String`使用 P/Invoke（[执行自动编组](https://manski.net/2012/06/pinvoke-tutorial-passing-parameters-part-3/)）将 a传递`const wchar_t*`给 C# 中的本机调用会导致在发生自动编组时将 a 传递给本机调用。但是，当您使用内部调用时，它将作为`MonoString*`，C++ 函数必须对自身进行编组，然后对返回到 VM 逻辑 ABI 类型所需的任何内容进行编组。只有 blittable 类型在使用内部调用时不需要编组，例如，[`int`](https://stackoverflow.com/questions/22428411/add-mono-internal-call-where-a-string-is-passed-by-reference)它是 a`System.Int32`被传递为 a `gint32`，它只是一个`int`.

另一个例子是[Spidermonkey JS 引擎](https://stackoverflow.com/a/61408475/7194773)，它在 C++ 原生类型`HTMLElement`和内部运行时表示之间编组`JSObject`，它表示`HTMLElement`javascript 中的类型。

# .net - 修改 RichTextBox 中的默认选项卡大小

> ID：154204
> 
> 赞同：20
> 
> 时间：2008-09-30T17:53:53.720
> 
> 标签：.net, winforms, tabs, richtextbox

有什么方法可以更改 .NET RichTextBox 中的默认选项卡大小？它目前似乎设置为相当于 8 个空格，这对我来说有点大。

编辑：为了澄清，我想将“\t”的全局默认设置为控件的 4 个空格。据我了解， SelectionTabs 属性要求您首先选择所有文本，然后通过数组选择选项卡宽度。如果必须，我会这样做，但如果可能的话，我宁愿只更改一次全局默认值，这样我就不必每次都这样做。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-30T18:09:37.970

您可以通过设置[SelectionTabs](http://msdn.microsoft.com/en-us/library/system.windows.forms.richtextbox.selectiontabs.aspx)属性来设置它。

```
private void Form1_Load(object sender, EventArgs e)
{
    richTextBox1.SelectionTabs = new int[] { 100, 200, 300, 400 };
} 
```

更新：
顺序很重要....

如果在初始化控件文本之前设置选项卡，则不必在设置选项卡之前选择文本。

例如，在上面的代码中，这将保留带有原始 8 个空格制表位的文本：

```
richTextBox1.Text = "\t1\t2\t3\t4";
richTextBox1.SelectionTabs = new int[] { 100, 200, 300, 400 }; 
```

但这将使用新的：

```
richTextBox1.SelectionTabs = new int[] { 100, 200, 300, 400 };
richTextBox1.Text = "\t1\t2\t3\t4"; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-01-09T10:29:26.600

Winforms 没有使用单个数字设置 RichTexBox 的默认选项卡大小的属性，但是如果您准备深入研究富文本框的 Rtf 并对其进行修改，则可以使用以下设置： “\deftab”。后面的数字表示缇的数量（1 点 = 1/72 英寸 = 20 缇）。标准制表符大小为 720 缇的 Rtf 可能类似于：

```
{\rtf1\ansi\ansicpg1252\deff0\deflang2057\deftab720{\fonttbl{\f0\fnil\fcharset0 Microsoft Sans Serif;}}
\viewkind4\uc1\pard\f0\fs41
1\tab 2\tab 3\tab 4\tab 5\par
} 
```

如果您需要将缇转换为像素，请使用受[Convert Pixels to Points](https://stackoverflow.com/questions/139655/how-to-convert-pixels-to-points-px-to-pt-in-net-c)启发的代码：

```
int tabSize=720;
Graphics g = this.CreateGraphics();
int pixels = (int)Math.Round(((double)tabSize) / 1440.0 * g.DpiX);
g.Dispose(); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2018-08-31T21:10:57.083

奇怪的是一直没有人提出这种方法）

我们可以继承`RichTextBox`并重写 CmdKey 处理程序（[ProcessCmdKey](https://msdn.microsoft.com/ru-ru/library/system.windows.forms.control.processcmdkey(v=vs.110).aspx)）
它看起来像这样：

```
public class TabRichTextBox : RichTextBox
{
    [Browsable(true), Category("Settings")]
    public int TabSize { get; set; } = 4;

    protected override bool ProcessCmdKey(ref Message Msg, Keys KeyData)
    {

        const int WM_KEYDOWN = 0x100;       // https://docs.microsoft.com/en-us/windows/desktop/inputdev/wm-keydown
        const int WM_SYSKEYDOWN = 0x104;    // https://docs.microsoft.com/en-us/windows/desktop/inputdev/wm-syskeydown
        // Tab has been pressed
        if ((Msg.Msg == WM_KEYDOWN || Msg.Msg == WM_SYSKEYDOWN) && KeyData.HasFlag(Keys.Tab))
        {
            // Let's create a string of spaces, which length == TabSize
            // And then assign it to the current position
            SelectedText += new string(' ', TabSize);

            // Tab processed
            return true;
        }
        return base.ProcessCmdKey(ref Msg, KeyData);
    }
} 
```

现在，当您按下 时`Tab`，将在控制区域中插入指定数量的空格，而不是`\t`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-08-23T09:36:03.100

如果您有一个仅用于显示（只读）固定间距文本的 RTF 框，那么最简单的方法就是不要乱用制表位。只需用空格替换它们。

如果您希望用户可以输入某些内容并使用该 Tab 键前进，您还可以通过覆盖`OnKeyDown()`和打印空格来捕获 Tab 键。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-10-03T19:35:14.997

我正在使用带有等宽字体的此类；它将所有 TAB 替换为空格。

您所要做的就是根据您的要求设置以下设计器属性：

*   AcceptsTab = True TabSize
*   ConvertTabToSpaces = True
*   选项卡大小 = 4

**PS**：正如@ToolmakerSteve 所指出的，显然这里的制表符大小逻辑非常简单：它只是用 4 个空格替换制表符，这仅适用于每行开头的制表符。如果您需要改进选项卡处理，只需扩展逻辑即可。

**代码**

```
using System.ComponentModel;
using System.Windows.Forms;

namespace MyNamespace
{
    public partial class MyRichTextBox : RichTextBox
    {
        public MyRichTextBox() : base() =>
            KeyDown += new KeyEventHandler(RichTextBox_KeyDown);

        [Browsable(true), Category("Settings"), Description("Convert all tabs into spaces."), EditorBrowsable(EditorBrowsableState.Always), DesignerSerializationVisibility(DesignerSerializationVisibility.Visible)]
        public bool ConvertTabToSpaces { get; set; } = false;

        [Browsable(true), Category("Settings"), Description("The number os spaces used for replacing a tab character."), EditorBrowsable(EditorBrowsableState.Always), DesignerSerializationVisibility(DesignerSerializationVisibility.Visible)]
        public int TabSize { get; set; } = 4;

        [Browsable(true), Category("Settings"), Description("The text associated with the control."), Bindable(true), EditorBrowsable(EditorBrowsableState.Always), DesignerSerializationVisibility(DesignerSerializationVisibility.Visible)]
        public new string Text
        {
            get => base.Text;
            set => base.Text = ConvertTabToSpaces ? value.Replace("\t", new string(' ', TabSize)) : value;
        }

        protected override bool ProcessCmdKey(ref Message Msg, Keys KeyData)
        {
            const int WM_KEYDOWN = 0x100; // https://docs.microsoft.com/en-us/windows/desktop/inputdev/wm-keydown
            const int WM_SYSKEYDOWN = 0x104; // https://docs.microsoft.com/en-us/windows/desktop/inputdev/wm-syskeydown

            if (ConvertTabToSpaces && KeyData == Keys.Tab && (Msg.Msg == WM_KEYDOWN || Msg.Msg == WM_SYSKEYDOWN))
            {
                SelectedText += new string(' ', TabSize);
                return true;
            }
            return base.ProcessCmdKey(ref Msg, KeyData);
        }

        public new void AppendText(string text)
        {
            if (ConvertTabToSpaces)
                text = text.Replace("\t", new string(' ', TabSize));
            base.AppendText(text);
        }

        private void RichTextBox_KeyDown(object sender, KeyEventArgs e)
        {
            if ((e.Shift && e.KeyCode == Keys.Insert) || (e.Control && e.KeyCode == Keys.V))
            {
                SuspendLayout();
                int start = SelectionStart;
                string end = Text.Substring(start);
                Text = Text.Substring(0, start);
                Text += (string)Clipboard.GetData("Text") + end;
                SelectionStart = TextLength - end.Length;
                ResumeLayout();
                e.Handled = true;
            }
        }

    } // class
} // namespace 
```

# wpf - 您可以在样式或 ControlTemplate 中包含的情节提要中使用 DynamicResource

> ID：154206
> 
> 赞同：13
> 
> 时间：2008-09-30T17:54:45.887
> 
> 标签：wpf, animation

我正在尝试使用包含在 ControlTemplate 中的 Storyboard 中的 DynamicResource。

但是，当我尝试执行此操作时，出现“无法冻结此 Storyboard 时间线树以供跨线程使用”错误。

这里发生了什么？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-30T18:00:59.363

不可以，您不能在 Storyboard 中使用包含在 Style 或 ControlTemplate 中的 DynamicResource。事实上，您也不能使用数据绑定表达式。

这里的故事是 Style 或 ControlTemplate 中的所有内容都必须安全地跨线程使用，并且计时系统实际上会尝试冻结 Style 或 ControlTemplate 以使其成为线程安全的。但是，如果存在 DynamicResource 或数据绑定表达式，则无法冻结它们。

有关详细信息，请参阅：[MSDN 链接](http://msdn.microsoft.com/en-us/library/ms742868.aspx)。查看“样式中的动画”和“ControlTemplate 中的动画”部分（此文档页面相当长）。

对于解决方法（至少对于我的场景），请参阅：[WPF 论坛帖子](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/9336022f-badb-4b40-a86c-a50ab1a64ba5/)。

希望这可以帮助某人。我已经失去了足够多的头发。

科里

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-11-22T15:01:03.107

在某些情况下，有一种解决方法：

*   引入附加属性，
*   使用所需的 setter 为引入的属性指定样式触发器

# web-services - 在不同的子网上访问 Web 服务

> ID：154207
> 
> 赞同：1
> 
> 时间：2008-09-30T17:55:05.947
> 
> 标签：web-services, iis-7, proxy

我知道这有点像服务器问题，但我还是想问一下，以防有人以前做过。

我有一个位于我们内部 172.xxx 子网上的 Web 服务和一个位于我们内部 10.xxx 子网上的 Web 服务器。网络服务器需要访问 172 网络服务，但无法路由到那里。真正的解决方案是说服我们的网络管理员将服务器放在 DMZ 后面的 172 网络上，但这种解决方案似乎遥不可及。

我快速而肮脏的解决方案是在一个连接到两个网络的盒子上创建一个代理服务器，这样我就可以对我的 Web 服务调用进行编程以访问代理服务器。但是，我是一名开发人员，对如何设置它知之甚少。

我有朋友在 Nix 中使用 Squid Proxy Server 运气不错，但唯一可用的盒子是 Windows Server 2003 盒子。理想情况下，我想要某种可以在 IIS 之上设置的代理。你们知道什么吗？我已经看过一些关于 ISA Server 2006 的评论，但我不想收取公司预算，因为我们只需要它来用于这一项 Web 服务。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T18:06:15.297

正如您所提到的，最好的选择是将 Web 服务器塞进 DMZ。那是不可能的，看看wiremonkeys是否可以*在服务器和Web服务之间的防火墙中打开适当的端口（并且只用于http/https流量）*。如果两者都不可能，我想代理是可能的（如果允许代理在两个网络之间中继）。

然而，我一直在问自己，在什么情况下，您可以拥有一个您有业务需求的 Web 服务，但不允许您在“Z”上公开它？你的wiremonkeys是否对改变如此抗拒以至于你无法完成你的工作？如果是这样，跳船，伙计！生命太短暂了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T17:59:42.830

它确实又快又脏，但是您可以在可以访问两个网络的 Windows 机器上使用[tcpmon工具。](https://tcpmon.dev.java.net/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T20:35:13.037

我必须同意 Danimal 的观点，处理此问题的正确方法是在防火墙上戳适当的孔。特别是如果，如您所说，界面对于面向客户的应用程序很重要。

在我看来，“受影响的客户 > 1000”是一个很好的商业案例，可以说服网络管理员或他们的老板花费精力来安全地允许您的流量。

# ms-access - 如何在 MS Access 中创建（类型、ID）（又名“多态”）-外键列？

> ID：154209
> 
> 赞同：4
> 
> 时间：2008-09-30T17:56:03.497
> 
> 标签：ms-access, rdbms

在 Ruby-on-Rails 中，这称为“多态关联”。

我的应用程序中有几`Commentable`件事，每个表格如下：

```
Post
id | title | text | author (FK:Person.id) | ...

Person
id | name | ...

Photo
id | title | owner (FK:Person.id) | path | ... 
```

我想添加一个`Comments`表格，如下所示：

```
Comments
id | commentable_type | commentable_id | text | author (FK:Person.id) 
```

我知道我以这种方式失去了数据库的引用完整性，但唯一的其他选择是拥有多个`Comments`表：`PostComments`, `PersonComments`, `PhotoComments`, ...

**现在的问题：**

我如何构建一个表单来了解如何进行查找，首先是从获取表名`Comments.commentable_type`，然后从获取 id `Comments.commentable_id`？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T08:32:43.263

这种技术在 SQL 世界中通俗地称为“子类化”。有关工作示例（SQL Server 语法，但很容易适应 MS Access），请参阅[David Porta 的博客。](http://web.archive.org/web/20100309034643/http://consultingblogs.emc.com/davidportas/archive/2007/01/08/Distributed-Keys-and-Disjoint-Subtypes.aspx).

在您的场景中，所有评论共有的数据项将在您的 Comments 表中；特定于每种类型的任何内容都将在专用表中，例如 PhotoComments 等。请注意，FK 应该是 ID 和类型的两列复合，这经常被忽略，但对这里的引用完整性至关重要，例如你不想要作为照片评论出现在 PersonComments 表中的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T18:04:50.837

我相信很多人都会为这类事情制作元表。和你描述的差不多。

# .net - 评估 OPF3（.NET 的 ORM 框架）

> ID：154217
> 
> 赞同：2
> 
> 时间：2008-09-30T17:57:19.793
> 
> 标签：.net, orm, opf3

是否有人使用或有人将[OPF3](http://opf3.com)评估为 ORM (.NET)？它如何与 EntitySpaces 或 Subsonic 相提并论？

到目前为止，我在评估中喜欢 OPF3 的一件事是它非常容易定制。由于它使用属性将数据库字段绑定到对象成员，因此您*不需要*使用任何代码生成工具。这也意味着您基本上可以创建自己的类，然后在其上添加 OPF3 数据绑定。

```
<Persistent("users")> _
Public Class User

    <Field("userid", AutoNumber:=True, Identifier:=True, allowDbnull:=False)> _
    Public Property ID() As Long

    <Field("name", allowDbnull:=False)> _
    Public Property Name() As String
End Class 
```

他们确实有一个生成工具，我不喜欢的一件事是演示不会输出类，所以我实际上看不到它*真正*要做什么。从好的方面来说，当您购买该工具时，您似乎也获得了它的来源。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T15:08:55.260

我们在我的公司使用 Opf3，直到现在它工作得很好，只是它的功能比需要的多。但是请注意您如何构建您的类，创建一个新项目以将 ObjectSetHolder 添加为子项可能会很棘手。新项目没有关于 ObjectContext 的任何信息，除非您使用 _context.Attach() 将它们附加到 ObjectContext

无论如何，我个人喜欢 Opf3 以及它可以做什么，但我们不使用 wizzard，因为它并不真正适用于我们的数据库 Pervasive。

# asp.net - ASP.NET 2.0 应用程序在 Win 2003 上以 IIS 5 隔离模式运行，但不在（默认）IIS 6 模式下运行

> ID：154232
> 
> 赞同：0
> 
> 时间：2008-09-30T18:03:26.583
> 
> 标签：asp.net, iis-6, unmanaged, dllimport

该应用程序使用 DLLImport 调用旧版非托管 dll。为了这个问题，我们将这个 dll 称为 Unmanaged.dll。Unmanaged.dll 依赖于其他 5 个旧版 dll。所有旧版 dll 都放在我的 ASP.NET 应用程序的 WebApp/bin/ 目录中。

当 IIS 在 5.0 隔离模式下运行时，应用程序工作正常 - 对旧版 dll 的调用被正确处理。

当 IIS 在默认的 6.0 模式下运行时，应用程序能够启动 Unmanaged.dll (InitMe())，但在稍后调用它 (ProcessString()) 期间会死掉。

我在这里拉头发。我已经将非托管 dll 移动到不同的位置，尝试了各种安全设置，并长期努力地寻找解决方案。帮助！

示例代码：

```
[DllImport("Unmanaged.dll", EntryPoint="initME", CharSet=System.Runtime.InteropServices.CharSet.Ansi, CallingConvention=CallingConvention.Cdecl)]
    internal static extern int InitME();
//Calls to InitMe work fine - Unmanaged.dll initiates and writes some entries in a dedicated log file
[DllImport("Unmanaged.dll", EntryPoint="processString", CharSet=System.Runtime.InteropServices.CharSet.Ansi, CallingConvention=CallingConvention.Cdecl)]
    internal static extern int ProcessString(string inStream, int inLen, StringBuilder outStream, ref int outLen, int maxLen);
//Calls to ProcessString cause the app to crash, without leaving much of a trace that I can find so far 
```

### 更新：

带回一堆，取自一个小型转储。似乎是堆栈溢出，但如果有人可以帮助我，我想知道更多。加载了 sos.dll 的 WinDbg 中“kb”的结果：

```
1beb51fc 7c947cfb 7c82202c 00000002 1beb524c ntdll!KiFastSystemCallRet  
1beb5200 7c82202c 00000002 1beb524c 00000001 ntdll!NtWaitForMultipleObjects+0xc  
WARNING: Stack unwind information not available. Following frames may be wrong.  
1beb52a8 7c822fbe 00000002 1beb52ec 00000000 kernel32!WaitForMultipleObjectsEx+0xd2  
1beb52c4 7a2e1468 00000002 1beb52ec 00000000 kernel32!WaitForMultipleObjects+0x18  
1beb5308 7a2d00c4 7a0c3077 1bc4ffd8 1bc4ffd8 mscorwks!CreateHistoryReader+0x19e9d  
1beb531c 7a0c312f 7a0c3077 1bc4ffd8 888d9fd9 mscorwks!CreateHistoryReader+0x8af9  
1beb5350 7a106b2d 1b2733a0 00000001 1b2733a0 mscorwks!GetCompileInfo+0x345ed  
1beb5378 7a105b91 1b272ff8 1b2733a0 00000001 mscorwks!GetAddrOfContractShutoffFlag+0x93a8  
1beb53e0 7a105d46 1beb5388 1b272ff8 1beb5520 mscorwks!GetAddrOfContractShutoffFlag+0x840c  
1beb5404 79fe29c5 00000001 00000000 00000000 mscorwks!GetAddrOfContractShutoffFlag+0x85c1  
1beb5420 7c948752 1beb5504 1beef9b8 1beb5520 mscorwks!NGenCreateNGenWorker+0x4d52  
1beb5444 7c948723 1beb5504 1beef9b8 1beb5520 ntdll!ExecuteHandler2+0x26  
1beb54ec 7c94855e 1beb1000 1beb5520 1beb5504 ntdll!ExecuteHandler+0x24  
1beb54ec 1c9f2264 1beb1000 1beb5520 1beb5504 ntdll!KiUserExceptionDispatcher+0xe  
1beb57f4 1c92992d 1beb6e28 1db84d70 1db90e28 Unmanaged1!UMgetMaxSmth+0x1200ad  
1beb5860 1c929cfe 00000000 1db84d70 1beb6e28 Unmanaged1!UMgetMaxSmth+0x57776  
1beb58c0 1c930b04 00000000 1db84d70 1beb6e28 Unmanaged1!UMgetMaxSmth+0x57b47  
1beb5924 1c99d088 00000000 1db84d70 1beb6e28 Unmanaged1!UMgetMaxSmth+0x5e94d  
1beb5990 1c99c955 00000000 1beb6e28 1beb6590 Unmanaged1!UMgetMaxSmth+0xcaed1  
1beb5a44 1c99e9ae 00000000 40977000 1db90e28 Unmanaged1!UMgetMaxSmth+0xca79e 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-16T11:37:38.837

解决方案：创建一个新线程来运行导入的 dll，为其堆栈分配更多内存。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T18:35:23.493

给出的错误是什么？如果应用程序真的崩溃了，您可能必须进入 Windows 事件日志以获取错误的堆栈跟踪。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T18:51:06.810

我已经运行了 procmon、debugdiag，尝试使用 microsoft 调试工具。每次应用程序崩溃时，Dr. Watson 都会创建一对文件 - .dmp 和 .tmp（我尝试调试但没有成功）。

这是事件日志中的错误：

事件类型：错误
事件源：.NET 运行时 2.0 错误报告
事件类别：无
事件代码：1000
日期：30.09.2008
时间：16:13:38
用户：不适用
计算机：APPLICATIONTEST010
描述：
错误应用程序 w3wp.exe，版本 6.0 .3790.3959，标记 45d6968e，故障模块 Unmanaged1.dll，版本 0.0.0.0，标记 48b6bfb8，调试？0，故障地址0x00122264。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-21T21:05:48.670

我认为这里要寻找的一个潜在问题是，您的 DLL 可能会在调用 InitME 和 ProcessString 之间的运行时卸载 - 所以如果 ProcessString 取决于首先调用 InitME，它可能会“繁荣”。

解决方案是使用良好的旧 LoadLibrary 和 FreeLibrary 来强制运行时在调用这两个函数之间保持库的加载。不需要 GetProcAddress（据我所知）。

# security - Windows Mobile 中的数字版权管理 (DRM) 前向锁定

> ID：154242
> 
> 赞同：1
> 
> 时间：2008-09-30T18:06:11.083
> 
> 标签：security, windows-ce, mobile-phones, drm

是否可以将 DRM 前向锁定应用于 Windows 移动应用程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-15T05:24:31.820

是的，它确实。

您需要使用 Windows Mobile[基于文件的数字版权管理](http://msdn.microsoft.com/en-us/library/ms879882.aspx)API。这是一个 WM5 API，因此在 WM 2003 下不受支持。

您的设备需要安装 FDRM 提供程序。我相信大多数 WM5/6 设备应该在 ROM 中默认安装某种提供程序。

# c++ - 编辑文本缓冲区

> ID：154245
> 
> 赞同：16
> 
> 时间：2008-09-30T18:06:54.017
> 
> 标签：c++, c, open-source, editor

好吧，这是一个有点厚颜无耻的问题。我想构建一个简单的文本编辑器（使用我自己的文本模式屏幕处​​理）。我只想要一个可用于表示文本缓冲区的数据结构的好示例，以及一些简单的字符/文本插入/删除示例。我可以自己处理所有其余的代码（文件 i/o、控制台 i/o 等）。一个不错的简单编辑器源的链接会很棒（C 或 C++）。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-30T18:41:46.427

我曾经在一家主要产品是文本编辑器的公司工作。虽然我主要研究它的脚本语言，但编辑器本身的内部设计自然是讨论的主要话题。

似乎它分解成两个一般的思路。一种是您单独存储每一行​​，然后将它们链接到一个链表或其他您满意的整体数据结构中。优点是任何面向行的编辑操作（例如删除整行，或在文件中移动行块）都非常容易实现，因此速度极快。不利的一面是加载和保存文件需要更多的工作，因为您必须遍历整个文件并构建这些数据结构。

当时的另一种思路是在没有更改的情况下尝试将大块文本保持在一起，而不考虑换行符，仅在编辑需要时将它们分解。优点是可以很容易地将未经编辑的文件大块分解为文件。加载文件、更改一行和保存文件的简单编辑速度非常快。缺点是执行面向行或列块的操作非常耗时，因为您必须解析这些文本块并移动大量数据。

我们始终坚持以线为导向的设计，无论价值如何，我们的产品被认为是当时最快的编辑器之一。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-30T18:22:33.633

“四人帮”一书（[设计模式](http://en.wikipedia.org/wiki/Design_Patterns)）有一个基于 GUI 的文本编辑器作为示例的主要来源，是一本值得拥有的书。

一般的“纯文本”编辑器可能使用绳索，SGI 的 STL 有一个[实现](http://www.sgi.com/tech/stl/Rope.html)。基本上，它们是字符缓冲区的链接列表。这样，插入/删除字符涉及更改较小的缓冲区和一些指针，而不是将整个文档存储在单个缓冲区中并且必须移动所有内容。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-30T21:07:11.570

这是 2008 年。不要编写文本编辑器；你正在重新发明火。

还在？我不确定这是否适用或您计划支持哪些平台，但[Neatpad 系列教程](http://www.catch22.net/tuts/neatpad/)是开始考虑编写文本编辑器的好地方。他们专注于将 Win32 作为基本平台，但学到的许多经验教训将适用于任何地方。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-30T21:35:33.687

我最喜欢的解决方案是[间隙缓冲区](http://en.wikipedia.org/wiki/Gap_buffer)，因为它很容易实现并且具有良好的*摊销*效率。只需使用单个字符数组，并将区域指定为间隙。一旦你理解了这个概念，代码几乎就自然而然地遵循了。

您还需要一个辅助数组 [vector<int>] 来跟踪每行开头的索引 - 这样您就可以轻松地提取特定的文本行。仅当间隙移动或插入/删除换行符时才需要更新辅助数组。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-07-20T20:28:22.450

这两个在线文档为文本编辑器提供了一个小而有用的“众所周知的”数据结构/技术的聚宝盆。

1.  [文本序列的数据结构](http://www.cs.unm.edu/~crowley/papers/sds.pdf)描述并实验分析了一些数据结构，倾向于片表作为选择的数据结构。然而，Net.wisdom 似乎倾向于间隙缓冲区，因为它足以用于文本编辑，并且更易于实现/调试。
2.  《文本编辑的工艺》（www.finseth.com/craft/）是较老的作品，不仅仅涉及数据结构，而且面向 Emacs 风格的编辑器；但这些概念通常很有用。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-30T18:26:58.617

一种简单的方法是面向行的——将文件表示为 char/wchar_t 数组/向量的数组/向量，每行一个。插入和删除按您期望的方式工作，尽管行尾是一种特殊情况。

我会从那开始，并可能在其他所有工作都正常工作后，用更有效地支持长行插入/删除的东西替换行数据结构。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-01T07:07:21.020

您几乎可以使用任何数据结构来编写文本编辑器。两百万个字符是相当厚的小说的打字价值，您可以在不到十分之一秒的时间内轻松地向上/向下移动它们（对于简单数组中的插入/删除）。不要听任何人告诉你不要建造一个，你会得到在所有小细节上都完全正确的东西。

我写了我的，在我浏览了太多网页之后，我已经习惯了向上/向下翻页，就像在滚动条拇指的上方/下方单击一样。当您在普通编辑器中键入字符时，跳回到开始滚动条导航之前，这对我来说太烦人了，所以我自己写了。

如果我要进行重写（我只是对当前版本中的每个文本缓冲区使用了 delphi ansistrings，并嵌入了换行符），我会为每个字符使用整数或 int64s，并对块开始/停止、光标位置和行进行编码高位标记，这样您在插入或删除内容时不必调整指针。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-30T18:32:28.040

您的主要数据结构是包含文本的数据结构。您可能需要一个行数组，而不是使用长缓冲区来包含文本，因为将字符插入行中间比将字符插入大缓冲区中间更快。

您需要决定您的文本编辑器是否应该支持嵌入格式。例如，如果您需要使用字体、粗体、下划线等，那么您的数据结构将需要包含在文本中嵌入格式代码的方法。在过去 8 位字符的好日子里，我们可以使用整数的高 8 位来存储任何格式标志，使用低 8 位来存储字符本身。

实际代码将取决于您使用的语言。在 C# 或 C++ 中，您可能会为这些行使用一个字符串数组。在 C 中，您将拥有一组基于堆的字符数组。

尽可能将显示代码与文本处理代码分开。您的代码的中心将是一个紧密的循环，例如：

```
while (editing) {
    GetCharacter();
    ProcessCharacter();
    UpdateDisplay();
} 
```

更复杂的编辑器将使用单独的线程进行字符获取/处理和显示更新。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-30T18:30:46.407

这真的取决于你的设计。几年前，我用curses写了一个小编辑器。我使用了双向链表，其中每个节点都是一个字符（相当浪费的设计......但它使格式化和屏幕刷新例程非常容易）。

我的朋友使用的其他数据结构是（这是一个家庭作业项目）：1）数组的链表，每个数组代表一条线。2）一个二维链表（只是组成了那个名字）..它是一个字符的链表，但每个字符都链接到上面和下面的字符。3)链表数组

但是，我建议您通过一些简单的编辑器（例如 pico）的源代码来查看他们使用的 ds。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-30T20:53:04.567

你检查过[Scintilla](http://www.scintilla.org/)的源代码吗？

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-30T18:25:17.747

查看 vim，它是开源的。在其中四处逛逛，看看它如何处理您想要的。

# internet-explorer - 如何配置 IE7 以下载文件类型而不是在浏览器中打开

> ID：154247
> 
> 赞同：1
> 
> 时间：2008-09-30T18:07:48.257
> 
> 标签：internet-explorer, download, watir, browser-automation

我写了一个下载文件的 watir 脚本。它下载的文件之一具有 .dcf 扩展名。几个月前，在我的机器上，我更改了某处的设置，以便 .dcf 文件提示下载（“您要打开还是保存此文件？”）而不是在浏览器中打开。这是我想要的行为。我正在使用 XP Pro/IE7。

我现在正在设置一台专用的测试机器，但似乎找不到我在我的机器上所做的配置选项 - 这很容易找到，我没有记下它。我现在找到的所有解决方案要么是更改下载本身，要么是修改注册表。我正在从浏览器/IE 级别的客户端角度寻找一些东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T18:30:12.680

这里的说明：
[http://www.mydigitallife.info/2007/06/15/disable-automatic-opening-or-saving-of-downloads-re-enable-always-ask-before-check-box/](http://www.mydigitallife.info/2007/06/15/disable-automatic-opening-or-saving-of-downloads-re-enable-always-ask-before-check-box/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T19:00:15.993

对于 PHP，请尝试使用以下标头：

header("Content-Type: application/force-download");

header("Content-Type: application/octet-stream");

header("内容类型：应用程序/下载");

header("Content-Disposition: attachment; filename=".basename($filename).";");

当然，您可以使用所使用的任何语言的相同标题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T22:33:01.753

[tloach](https://stackoverflow.com/users/14092/tloach "tloach 的个人资料")的链接为我需要的答案提供了方向：

1.  我需要打开一个 Windows 资源管理器窗口并从**工具**菜单中选择**文件夹选项...。**
***   我需要转到“**文件类型**”选项卡并找到要更改其行为的扩展名。*   我需要有文件类型的**高级**按钮——它并不总是在那里。*   **下载后确认打开**复选框需要***选中***（未清除）*   需要有行动——并不总是有。我发现一个叫做**编辑**和另一个叫做**打开**就足够了。我将它们绑定到记事本（C:\WINDOWS\system32\NOTEPAD.EXE %1）。我还需要***选中*****Use DDE**复选框并为**Application:**和*System* for **Topic**填写*NOTEPAD ：***

 *******希望这对其他人有帮助。下次它可能会对我有所帮助。

# java - 如何在 Java 1.4 中向 XML 节点添加属性

> ID：154248
> 
> 赞同：7
> 
> 时间：2008-09-30T18:07:59.020
> 
> 标签：java, xml

我试过：

```
DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();

DocumentBuilder db = dbf.newDocumentBuilder();
Document doc = db.parse(f);
Node mapNode = getMapNode(doc);
System.out.print("\r\n elementName "+ mapNode.getNodeName());//This works fine.

Element e = (Element) mapNode; //This is where the error occurs
//it seems to work on my machine, but not on the server.
e.setAttribute("objectId", "OBJ123"); 
```

但这会在将其转换为 Element 的行上引发 java.lang.ClassCastException 错误。 **mapNode 是一个有效的节点。** 我已经把它打印出来了

我想也许这段代码在 Java 1.4 中不起作用。我真正需要的是使用 Element 的替代方法。我试着做

```
NamedNodeMap atts = mapNode.getAttributes();
    Attr att = doc.createAttribute("objId");
    att.setValue(docId);    
    atts.setNamedItem(att); 
```

但是 getAttributes() 在服务器上返回 null。即使它不是，我在本地使用与服务器上相同的文档。它可以打印出 getNodeName() 只是 getAttributes() 不起作用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T20:04:07.463

我在服务器上使用了不同的 dtd 文件。那是造成问题的原因。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T18:20:24.577

第一个孩子可能是仅空白文本节点或类似节点吗？

尝试：

```
System.out.println(doc.getFirstChild().getClass().getName()); 
```

编辑：

刚刚在我自己的代码中查找，您需要：

```
doc.getDocumentElement().getChildNodes(); 
```

或者：

```
NodeList nodes = doc.getElementsByTagName("MyTag"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T18:25:12.847

我认为您对 doc.getFirstChild() 输出的强制转换是您获得异常的地方-您获得了一些非元素节点对象。堆栈跟踪上的行号是否指向该行？您可能需要执行 doc.getChildNodes() 并迭代以查找第一个元素子节点（文档根），跳过非元素节点。

您的 e.setAttribute() 调用看起来很明智。假设 e 是一个 Element 并且您实际上到达了那条线...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T18:36:58.937

如前所述，`ClassCastException`可能不会被扔进`setAttribute`. 检查堆栈中的行号。我的猜测是`getFirstChild()`返回 a `DocumentType`，而不是`Element`.

试试这个：

```
DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();

DocumentBuilder db = dbf.newDocumentBuilder();
Document doc = db.parse(f);

Element e = (Element) doc.getDocumentElement().getFirstChild();
e.setAttribute("objectId", "OBJ123"); 
```

更新：

看起来你很困惑`Node`并且`Element`. `Element`是 的一种实现`Node`，但肯定不是唯一的一种。所以，并不是所有`Node`的都可以转换为`Element`. `getMapNode()`如果演员在一台机器上工作，而不是在另一台机器上工作，那是因为解析器的行为不同，你得到了其他东西。XML 解析器在 Java 1.4 中是可插入的，因此您可能会从不同的供应商那里得到一个完全不同的实现，甚至有不同的错误。

由于您没有发布`getMapNode()`，我们无法看到它在做什么，但您应该明确说明您希望它返回哪个节点（使用`getElementsByTagName`或以其他方式）。

# performance - 在单个主机上运行多个虚拟机

> ID：154250
> 
> 赞同：3
> 
> 时间：2008-09-30T18:08:26.040
> 
> 标签：performance, vmware, virtual-machine

我需要在数量相对较少的物理主机上运行数量相对较多的虚拟机。每台虚拟机都没有做太多事情——每台虚拟机基本上只需要运行一个基本的网络服务——想想 SMTP 之类的。此外，每个人的负载都将非常轻。

不幸的是，这些数字大约是 5 台物理主机上的 100 台虚拟机。每个主机都足够好 - 核心 2 有 2 gigs 的 ram 和 1tb 磁盘。但是，我知道仅获取 ubuntu 的 vmware 映像并扔到那台机器上不会让我接近 100 个实例，而是接近 20 个。

那么，这种图像与主机的比例是否有希望？此外，哪种虚拟机实现最适合此目的 - 即具有有效的整体资源使用率？我们这里主要使用 vmware，但如果切换到 Xen 等可以获得显着的性能优势，我相信我们会考虑它。

提前感谢您的见解:)

注意：我们最终使用了 OpenVZ，它运行良好。ubuntu 模板的默认参数允许我们在每台机器上运行大约 40 个实例。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-30T18:51:32.113

有三个主要方面可以使它们适合：

1.  较低的开销。如果适用，OpenVZ、Vserver、chroot 将是理想的选择。如果您确实需要每个实例都是具有自己内核的真实 VM，请尝试使用 KVM/Xen 而不是 VMWare。可能不那么成熟，但你会有更多的灵活性。

2.  较小的客人。试试 Ubuntu JeOS，或者使用 busybox 自己动手

3.  客人之间尽可能多地分享。尝试与所有操作系统共享一个 R/O 映像，并在 /var、/home、/etc 等上为每个来宾安装一个小的 R/W 映像

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T18:43:08.140

有几个问题......

1.  对于 Vmware 服务器，您确实需要服务器硬件，除非它仅用于测试。
2.  使用裸级别的虚拟化解决方案，例如 Xen Server、VMware ESX 或 ESXi（免费）或 Hyper-V，它们不是裸级别但性能更接近。
3.  对于 20-1，您将需要更多 RAM。数学没有加起来。最小功能机器需要 512，除非它是一个完美剥离的 linux，应该至少有 256。20x256 = 5gb + 5-10% 开销。这些规格不会真的发生。
4.  对于 20-1，您将需要更多处理器。每台机器都有一个 vCPU。在核心 2 上共享意味着每个处理器 10-1。不好。我们在双四核 Dell 1950、16gb RAM 上运行了近 20 个。效果很好。
5.  无论你选择什么，你都会超额订阅内存。不完全确定哪些让你。Vmware 会，但会显示警告。
6.  我听说过但没有证据表明 XenServer 将提供性能优势，但没有人声称超过 10-20%。

祝你好运

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T20:12:34.813

你真的需要 100 个全功能操作系统吗？

为什么不采取 Web 服务器已经使用的方法呢？我的意思是虚拟网络服务器/主机。

例如，将 Apache HTTPD 安装在使用单个配置文件托管许多虚拟服务器的单个物理服务器上。另外，您需要配置 DNS 和/或许多具有不同 IP 地址的虚拟网络接口（eth0:0、eth0:1、...、eth0:n）。

如果您真的只需要几个暴露给世界的服务并且负载不高，这应该可以工作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-02T06:41:57.297

另一种可能性是使用可以在非常少的内存中运行的轻量级 Linux 发行版。DamnSmallLinux 之类的东西或 DDWRT 的变体。它们可以在低至 16MB 的内存中运行，允许您在单台机器上运行 20 或更多。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T19:26:14.620

您最好运行 VMware ESX/ESXi，因为它们都具有奇特的内存池功能。它基本上占用相同的内存页面并在多个客户机中使用它们，因此如果您运行大量相同的客户机，您将能够在主机上获得比其他 VM 更多的内存。

[在此博客条目](http://blogs.vmware.com/virtualreality/2008/03/cheap-hyperviso.html)中查看有关“透明页面共享”的部分，并[在此处](http://dcsblog.burtongroup.com/data_center_strategies/2007/06/virtualization_.html)也对此发表评论。

显然，您仍在使用每台主机 20 个来宾并且每个主机上只有 2Gb RAM，但如果您删除*所有*无关的服务和应用程序，并在每个主机上安装专用应用程序之前构建 1 个来宾映像并克隆它，您可能*会*逃脱有了它，尤其是当 VMware 链接显示运行 40 个客人的 4Gb 主机时！

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-06-25T21:39:03.613

我有一台运行完整桌面的四核机器和 9 台虚拟机。因为这是一台测试机器，所以我使用了各种各样的客人。最好的 ram 使用似乎是 debian-kfreebsd 和 tiny core linux。tiny core linux 使用 10M 的 ram 无所事事。添加几个服务，它可能是 32M，所以我可以在 1GB 的内存中运行 32 个虚拟机！你有 2GB，所以假设你可以运行 48 台机器，包括管理程序和开销（我使用的是 kvm。）所以有了 5 台机器，我们最多可以运行 240 台机器：D

我想我马上就试试看：D

顺便提一句。你说虚拟机的负载应该很轻，所以我没有指望cpuload或diskload。并且这些数字恰好具有 0 冗余。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T18:15:55.630

如果您可以足够瘦身来宾，您可能可以做到，没有 X，启动最少的服务等。看看 slackware 或 ubuntu 服务器。Xen 似乎在网络托管公司中很受欢迎，因此可能值得一看。

CPU 使用率将取决于应用程序，但您可能需要购买更多内存！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-01T20:50:41.257

每个网络服务实例需要划分到自己的虚拟机中是否有原因？如果您不需要将用户彼此隔离，但确实需要隔离进程和流量，那么您最好按原样使用五台服务器并为每个实例启动单独的进程。每个实例都将绑定到一个单独的虚拟接口。

例如，配置一个虚拟接口并为其分配一个 IP 地址。为您要创建的实例创建一个 httpd.conf 文件和/或 sendmail.cf 文件。在配置文件中，指定守护进程应该绑定到虚拟接口（并且只有那个）。启动守护进程。

对每个实例重复。您将运行大量进程（数百个，如果不是数千个），它们的总和将使用比数十个 VM 更少的内存。另外，您的操作系统将能够将未使用的交换到磁盘。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T18:18:41.257

如果你算一算，每台机器平均有 100 MB 的内存。这并不多。虚拟机的开销非常大，必须在每个实例中运行一个完整的操作系统。

您要么使用一些非常小的操作系统（[http://www.damnsmalllinux.org/](http://www.damnsmalllinux.org/)？）并花时间将其进一步精简，要么您获得更大的机器。

机器那么便宜，我倾向于升级到具有大量内存的 64 位操作系统。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-30T18:21:38.457

VMWare 有一个很酷的选项，您可以在其中“汇集”一组物理机，它会自动将虚拟机移动到利用率最低的硬件，而不会中断 VM 的运行。

[而是广告链接。](http://www.vmware.com/products/vi/vc/vmotion.html)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-30T18:24:39.543

您是否仅限于vmware？您是否考虑过[操作系统级虚拟化？](http://en.wikipedia.org/wiki/Operating_system-level_virtualization)假设每个 VM 可以运行相同的内核，您将获得更多的 VM 和更少的开销。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-30T18:33:12.983

几个想法...

1-正如其他人指出的那样，内存算术不起作用，您将需要更多 RAM。

2- 根据服务的不同，您可能能够找到预配置的虚拟机。例如，[Astaro](http://www.astaro.com)为其免费的防火墙软件设置了 VM。你也可以找到一个非常小的 Linux 发行版，你可以适应它。

3-也许我遗漏了一些东西，但听起来 Ubuntu 已经非常接近了...... 5 台机器上的每台机器 20 个实例可以获得您需要的 100 个实例。未来的增长空间不大，但是...

保重，祝你好运。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-02T06:48:45.423

我不知道这是否可能，但是在 chroot 环境中运行每个服务怎么样？您可以通过硬链接必要的库文件来创建每个 chroot 文件系统来节省磁盘空间。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-03T19:16:04.827

在自己的 VM 中运行每个服务的另一个问题是它们都需要自己的 IP 地址。100 个 IP 在内部网络上可能不是问题（例如 172/8 或 10/8 设置），但如果它们是您的 A 类的一部分（假设您有那么多公共 IP），那么您将用完快速地。

而且，正如其他人所问的那样，为什么每个服务都需要成为自己的虚拟机？它们中的许多应该能够轻松地在同一主机上运行。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-26T10:07:51.607

如果它可以在应用程序级别完成 - 我会不使用任何虚拟化。您可以在不同的端口号上运行应用程序的多个实例，甚至可以轻松地在具有 IP 别名的不同 IP 上运行。这样您就可以轻松地在每个盒子上运行 20 多个副本。哎呀，您也许可以用一半的硬件做所有事情。

虚拟化并不是万能的解决方案。:)

我的2c。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-12-21T11:39:22.197

根据[此博客](https://blog.junjizhi.com/all/research/vm/2019/11/07/vm-isolation.html)，拥有这么多虚拟机，您可能会遇到性能干扰问题。

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2016-02-12T16:15:20.420

云铸造。与可能已提交答案的其他任何人相比，我对虚拟机一无所知，但据我了解，如果您有一个主机、该主机上的一个虚拟机，然后该虚拟机上的 Cloud Foundry，您可以轻松创建基础辅助虚拟机并且轻松在该辅助 VM 集中复制和配置所有服务，同时保持较低的硬件使用率。我不知道它是否肯定会起作用，但据我了解，这将是一种更简单的方法，它是一种两壳方法，可以降低损坏主机的可能风险。

# c# - 有没有办法遍历所有枚举值？

> ID：154256
> 
> 赞同：31
> 
> 时间：2008-09-30T18:09:54.787
> 
> 标签：c#, enumeration

> **可能重复：**
> [C#：如何枚举枚举？](https://stackoverflow.com/questions/105372/c-how-to-enumerate-an-enum)

主题说明了一切。我想用它在组合框中添加枚举的值。

谢谢

冰山

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-30T18:11:53.287

```
string[] names = Enum.GetNames (typeof(MyEnum)); 
```

然后只需使用数组填充下拉列表

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-09-30T18:29:44.570

我知道其他人已经回答了正确的答案，但是，如果您想在组合框中使用枚举，您可能需要额外的码数并将字符串与枚举相关联，以便您可以在显示的字符串（例如单词之间的空格或使用与您的编码标准不匹配的大小写的显示字符串）

此博客条目可能很有[用-Associating Strings with enums in c#](http://blog.spontaneouspublicity.com/2008/01/17/associating-strings-with-enums-in-c/)

```
public enum States
{
    California,
    [Description("New Mexico")]
    NewMexico,
    [Description("New York")]
    NewYork,
    [Description("South Carolina")]
    SouthCarolina,
    Tennessee,
    Washington
} 
```

作为奖励，他还提供了一个实用方法来枚举我现在用 Jon Skeet 的评论更新的枚举

```
public static IEnumerable<T> EnumToList<T>()
    where T : struct
{
    Type enumType = typeof(T);

    // Can't use generic type constraints on value types,
    // so have to do check like this
    if (enumType.BaseType != typeof(Enum))
        throw new ArgumentException("T must be of type System.Enum");

    Array enumValArray = Enum.GetValues(enumType);
    List<T> enumValList = new List<T>();

    foreach (T val in enumValArray)
    {
        enumValList.Add(val.ToString());
    }

    return enumValList;
} 
```

Jon 还指出，在 C# 3.0 中，它可以被简化为这样的东西（现在它变得如此轻量级，我想你可以直接在线完成）：

```
public static IEnumerable<T> EnumToList<T>()
    where T : struct
{
    return Enum.GetValues(typeof(T)).Cast<T>();
}

// Using above method
statesComboBox.Items = EnumToList<States>();

// Inline
statesComboBox.Items = Enum.GetValues(typeof(States)).Cast<States>(); 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-30T18:22:23.650

使用 Enum.GetValues 方法：

```
foreach (TestEnum en in Enum.GetValues(typeof(TestEnum)))
{
    ...
} 
```

您不需要将它们转换为字符串，这样您就可以通过将 SelectedItem 属性直接转换为 TestEnum 值来检索它们。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-30T18:13:59.240

[您可以改为遍历Enum.GetNames 方法](http://msdn.microsoft.com/en-us/library/system.enum.getnames(VS.80).aspx)返回的数组。

```
public class GetNamesTest {
    enum Colors { Red, Green, Blue, Yellow };
    enum Styles { Plaid, Striped, Tartan, Corduroy };

    public static void Main() {

        Console.WriteLine("The values of the Colors Enum are:");
        foreach(string s in Enum.GetNames(typeof(Colors)))
            Console.WriteLine(s);

        Console.WriteLine();

        Console.WriteLine("The values of the Styles Enum are:");
        foreach(string s in Enum.GetNames(typeof(Styles)))
            Console.WriteLine(s);
    }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-30T18:23:12.137

如果您需要组合的值与枚举的值相对应，您还可以使用以下内容：

```
foreach (TheEnum value in Enum.GetValues(typeof(TheEnum)))
    dropDown.Items.Add(new ListItem(
        value.ToString(), ((int)value).ToString()
    ); 
```

通过这种方式，您可以在下拉列表中显示文本并取回值（在 SelectedValue 属性中）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T18:41:28.720

使用枚举填充下拉列表的问题是枚举中不能有奇怪的字符或空格。我有一些扩展枚举的代码，以便您可以添加任何您想要的字符。

像这样使用它..

```
public enum eCarType
{
    [StringValue("Saloon / Sedan")] Saloon = 5,
    [StringValue("Coupe")] Coupe = 4,
    [StringValue("Estate / Wagon")] Estate = 6,
    [StringValue("Hatchback")] Hatchback = 8,
    [StringValue("Utility")] Ute = 1,
} 
```

像这样绑定数据..

```
StringEnum CarTypes = new StringEnum(typeof(eCarTypes));
cmbCarTypes.DataSource = CarTypes.GetGenericListValues(); 
```

这是扩展枚举的类。

```
// Author: Donny V.
// blog: http://donnyvblog.blogspot.com

using System;
using System.Collections;
using System.Collections.Generic;
using System.Reflection;

namespace xEnums
{

    #region Class StringEnum

    /// <summary>
    /// Helper class for working with 'extended' enums using <see cref="StringValueAttribute"/> attributes.
    /// </summary>
    public class StringEnum
    {
        #region Instance implementation

        private Type _enumType;
        private static Hashtable _stringValues = new Hashtable();

        /// <summary>
        /// Creates a new <see cref="StringEnum"/> instance.
        /// </summary>
        /// <param name="enumType">Enum type.</param>
        public StringEnum(Type enumType)
        {
            if (!enumType.IsEnum)
                throw new ArgumentException(String.Format("Supplied type must be an Enum.  Type was {0}", enumType.ToString()));

            _enumType = enumType;
        }

        /// <summary>
        /// Gets the string value associated with the given enum value.
        /// </summary>
        /// <param name="valueName">Name of the enum value.</param>
        /// <returns>String Value</returns>
        public string GetStringValue(string valueName)
        {
            Enum enumType;
            string stringValue = null;
            try
            {
                enumType = (Enum) Enum.Parse(_enumType, valueName);
                stringValue = GetStringValue(enumType);
            }
            catch (Exception) { }//Swallow!

            return stringValue;
        }

        /// <summary>
        /// Gets the string values associated with the enum.
        /// </summary>
        /// <returns>String value array</returns>
        public Array GetStringValues()
        {
            ArrayList values = new ArrayList();
            //Look for our string value associated with fields in this enum
            foreach (FieldInfo fi in _enumType.GetFields())
            {
                //Check for our custom attribute
                StringValueAttribute[] attrs = fi.GetCustomAttributes(typeof (StringValueAttribute), false) as StringValueAttribute[];
                if (attrs.Length > 0)
                    values.Add(attrs[0].Value);

            }

            return values.ToArray();
        }

        /// <summary>
        /// Gets the values as a 'bindable' list datasource.
        /// </summary>
        /// <returns>IList for data binding</returns>
        public IList GetListValues()
        {
            Type underlyingType = Enum.GetUnderlyingType(_enumType);
            ArrayList values = new ArrayList();
            //List<string> values = new List<string>();

            //Look for our string value associated with fields in this enum
            foreach (FieldInfo fi in _enumType.GetFields())
            {
                //Check for our custom attribute
                StringValueAttribute[] attrs = fi.GetCustomAttributes(typeof (StringValueAttribute), false) as StringValueAttribute[];
                if (attrs.Length > 0)
                    values.Add(new DictionaryEntry(Convert.ChangeType(Enum.Parse(_enumType, fi.Name), underlyingType), attrs[0].Value));

            }

            return values;

        }

        /// <summary>
        /// Gets the values as a 'bindable' list<string> datasource.
        ///This is a newer version of 'GetListValues()'
        /// </summary>
        /// <returns>IList<string> for data binding</returns>
        public IList<string> GetGenericListValues()
        {
            Type underlyingType = Enum.GetUnderlyingType(_enumType);
            List<string> values = new List<string>();

            //Look for our string value associated with fields in this enum
            foreach (FieldInfo fi in _enumType.GetFields())
            {
                //Check for our custom attribute
                StringValueAttribute[] attrs = fi.GetCustomAttributes(typeof(StringValueAttribute), false) as StringValueAttribute[];
                if (attrs.Length > 0)
                    values.Add(attrs[0].Value);
            }

            return values;

        }

        /// <summary>
        /// Return the existence of the given string value within the enum.
        /// </summary>
        /// <param name="stringValue">String value.</param>
        /// <returns>Existence of the string value</returns>
        public bool IsStringDefined(string stringValue)
        {
            return Parse(_enumType, stringValue) != null;
        }

        /// <summary>
        /// Return the existence of the given string value within the enum.
        /// </summary>
        /// <param name="stringValue">String value.</param>
        /// <param name="ignoreCase">Denotes whether to conduct a case-insensitive match on the supplied string value</param>
        /// <returns>Existence of the string value</returns>
        public bool IsStringDefined(string stringValue, bool ignoreCase)
        {
            return Parse(_enumType, stringValue, ignoreCase) != null;
        }

        /// <summary>
        /// Gets the underlying enum type for this instance.
        /// </summary>
        /// <value></value>
        public Type EnumType
        {
            get { return _enumType; }
        }

        #endregion

        #region Static implementation

        /// <summary>
        /// Gets a string value for a particular enum value.
        /// </summary>
        /// <param name="value">Value.</param>
        /// <returns>String Value associated via a <see cref="StringValueAttribute"/> attribute, or null if not found.</returns>
        public static string GetStringValue(Enum value)
        {
            string output = null;
            Type type = value.GetType();

            if (_stringValues.ContainsKey(value))
                output = (_stringValues[value] as StringValueAttribute).Value;
            else 
            {
                //Look for our 'StringValueAttribute' in the field's custom attributes
                FieldInfo fi = type.GetField(value.ToString());
                StringValueAttribute[] attrs = fi.GetCustomAttributes(typeof (StringValueAttribute), false) as StringValueAttribute[];
                if (attrs.Length > 0)
                {
                    _stringValues.Add(value, attrs[0]);
                    output = attrs[0].Value;
                }

            }
            return output;

        }

        /// <summary>
        /// Parses the supplied enum and string value to find an associated enum value (case sensitive).
        /// </summary>
        /// <param name="type">Type.</param>
        /// <param name="stringValue">String value.</param>
        /// <returns>Enum value associated with the string value, or null if not found.</returns>
        public static object Parse(Type type, string stringValue)
        {
            return Parse(type, stringValue, false);
        }

        /// <summary>
        /// Parses the supplied enum and string value to find an associated enum value.
        /// </summary>
        /// <param name="type">Type.</param>
        /// <param name="stringValue">String value.</param>
        /// <param name="ignoreCase">Denotes whether to conduct a case-insensitive match on the supplied string value</param>
        /// <returns>Enum value associated with the string value, or null if not found.</returns>
        public static object Parse(Type type, string stringValue, bool ignoreCase)
        {
            object output = null;
            string enumStringValue = null;

            if (!type.IsEnum)
                throw new ArgumentException(String.Format("Supplied type must be an Enum.  Type was {0}", type.ToString()));

            //Look for our string value associated with fields in this enum
            foreach (FieldInfo fi in type.GetFields())
            {
                //Check for our custom attribute
                StringValueAttribute[] attrs = fi.GetCustomAttributes(typeof (StringValueAttribute), false) as StringValueAttribute[];
                if (attrs.Length > 0)
                    enumStringValue = attrs[0].Value;

                //Check for equality then select actual enum value.
                if (string.Compare(enumStringValue, stringValue, ignoreCase) == 0)
                {
                    output = Enum.Parse(type, fi.Name);
                    break;
                }
            }

            return output;
        }

        /// <summary>
        /// Return the existence of the given string value within the enum.
        /// </summary>
        /// <param name="stringValue">String value.</param>
        /// <param name="enumType">Type of enum</param>
        /// <returns>Existence of the string value</returns>
        public static bool IsStringDefined(Type enumType, string stringValue)
        {
            return Parse(enumType, stringValue) != null;
        }

        /// <summary>
        /// Return the existence of the given string value within the enum.
        /// </summary>
        /// <param name="stringValue">String value.</param>
        /// <param name="enumType">Type of enum</param>
        /// <param name="ignoreCase">Denotes whether to conduct a case-insensitive match on the supplied string value</param>
        /// <returns>Existence of the string value</returns>
        public static bool IsStringDefined(Type enumType, string stringValue, bool ignoreCase)
        {
            return Parse(enumType, stringValue, ignoreCase) != null;
        }

        #endregion
    }

    #endregion

    #region Class StringValueAttribute

    /// <summary>
    /// Simple attribute class for storing String Values
    /// </summary>
    public class StringValueAttribute : Attribute
    {
        private string _value;

        /// <summary>
        /// Creates a new <see cref="StringValueAttribute"/> instance.
        /// </summary>
        /// <param name="value">Value.</param>
        public StringValueAttribute(string value)
        {
            _value = value;
        }

        /// <summary>
        /// Gets the value.
        /// </summary>
        /// <value></value>
        public string Value
        {
            get { return _value; }
        }
    }

    #endregion
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T19:15:20.123

.NET 3.5 通过使用扩展方法使其变得简单：

```
enum Color {Red, Green, Blue} 
```

可以迭代

```
Enum.GetValues(typeof(Color)).Cast<Color>() 
```

或定义一个新的静态泛型方法：

```
static IEnumerable<T> GetValues<T>() {
  return Enum.GetValues(typeof(T)).Cast<T>();
} 
```

请记住，使用 Enum.GetValues() 方法进行迭代会使用反射，因此会降低性能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T18:13:17.807

在枚举中定义最小值和最大值通常很有用，它们始终是第一项和最后一项。这是一个使用 Delphi 语法的非常简单的示例：

```
procedure TForm1.Button1Click(Sender: TObject);
type
  TEmployeeTypes = (etMin, etHourly, etSalary, etContractor, etMax);
var
  i : TEmployeeTypes;
begin
  for i := etMin to etMax do begin
    //do something
  end;
end; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T18:33:08.367

稍微“复杂”一点（可能有点矫枉过正），但我使用这两种方法返回字典以用作数据源。第一个返回名称作为键，第二个值作为键返回。

```
公共静态 IDictionary<string, int> ConvertEnumToDictionaryNameFirst<K>()
{
  if (typeof(K).BaseType != typeof(Enum))
  {
    抛出新的 InvalidCastException();
  }

  return Enum.GetValues(typeof(K)).Cast<int>().ToDictionary(currentItem
    => Enum.GetName(typeof(K), currentItem));
}

```

或者你可以做

```
公共静态 IDictionary<int, string> ConvertEnumToDictionaryValueFirst<K>()
{
  if (typeof(K).BaseType != typeof(Enum))
  {
    抛出新的 InvalidCastException();
  }

  return Enum.GetNames(typeof(K)).Cast<string>().ToDictionary(currentItem
    => (int)Enum.Parse(typeof(K), currentItem));
}

```

这假设您使用的是 3.5。如果没有，您必须替换 lambda 表达式。

采用：

```
  字典列表 = ConvertEnumToDictionaryValueFirst<SomeEnum>();

```

```
  使用系统；
  使用 System.Collections.Generic；
  使用 System.Linq；

```

# sql - 如何连接表中的最新行？

> ID：154261
> 
> 赞同：4
> 
> 时间：2008-09-30T18:11:36.453
> 
> 标签：sql, aggregate, pivot

我经常遇到这种形式的问题，但还没有找到好的解决方案：

假设我们有两个代表电子商务系统的数据库表。

```
userData (userId, name, ...)
orderData (orderId, userId, orderType, createDate, ...) 
```

对于系统中的所有用户，选择他们的用户信息、类型='1'的最新订单信息和类型='2'的最新订单信息。我想在一个查询中做到这一点。这是一个示例结果：

```
(userId, name, ..., orderId1, orderType1, createDate1, ..., orderId2, orderType2, createDate2, ...)
(101, 'Bob', ..., 472, '1', '4/25/2008', ..., 382, '2', '3/2/2008', ...) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T18:54:24.667

这应该有效，您必须调整表/列名称：

```
select ud.name,
       order1.order_id,
       order1.order_type,
       order1.create_date,
       order2.order_id,
       order2.order_type,
       order2.create_date
  from user_data ud,
       order_data order1,
       order_data order2
 where ud.user_id = order1.user_id
   and ud.user_id = order2.user_id
   and order1.order_id = (select max(order_id)
                            from order_data od1
                           where od1.user_id = ud.user_id
                             and od1.order_type = 'Type1')
   and order2.order_id = (select max(order_id)
                             from order_data od2
                            where od2.user_id = ud.user_id
                              and od2.order_type = 'Type2') 
```

非规范化数据也可能是一个好主意。这种类型的事情做起来会相当昂贵。因此，您可以将 a 添加`last_order_date`到您的 userData。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T21:57:51.057

我提供了三种不同的方法来解决这个问题：

1.  使用枢轴
2.  使用案例陈述
3.  在 where 子句中使用内联查询

所有解决方案都假设我们正在根据列确定“最近”的顺序`orderId`。`createDate`由于时间戳冲突，使用该列会增加复杂性并严重影响性能，因为`createDate`它可能不是索引键的一部分。我只使用 MS SQL Server 2005 测试了这些查询，所以我不知道它们是否可以在您的服务器上运行。

解决方案 (1) 和 (2) 的性能几乎相同。事实上，它们都导致从数据库中读取相同数量的数据。

处理大型数据集时，解决方案 (3)**不是首选方法。**它始终比 (1) 和 (2) 进行数百次逻辑读取。当过滤一个特定用户时，方法（3）与其他方法相当。在单用户情况下，cpu 时间的减少有助于抵消显着增加的读取次数；但是，随着磁盘驱动器变得更忙并且发生缓存未命中，这种微小的优势将消失。

## 结论

对于呈现的场景，如果您的 DBMS 支持，请使用枢轴方法。与 case 语句相比，它需要更少的代码，并简化了将来添加订单类型的过程。

请注意，在某些情况下，PIVOT 不够灵活，使用 case 语句的特征值函数是可行的方法。

## 代码

方法（1）使用 PIVOT：

```
select 
    ud.userId, ud.fullname, 
    od1.orderId as orderId1, od1.createDate as createDate1, od1.orderType as orderType1,
    od2.orderId as orderId2, od2.createDate as createDate2, od2.orderType as orderType2

from userData ud
    inner join (
            select userId, [1] as typeOne, [2] as typeTwo
            from (select
                userId, orderType, orderId
            from orderData) as orders
            PIVOT
            (
                max(orderId)
                FOR orderType in ([1], [2])
            ) as LatestOrders) as LatestOrders on
        LatestOrders.userId = ud.userId 
    inner join orderData od1 on
        od1.orderId = LatestOrders.typeOne
    inner join orderData od2 on
        od2.orderId = LatestOrders.typeTwo 
```

方法（2）使用案例陈述：

```
select 
    ud.userId, ud.fullname, 
    od1.orderId as orderId1, od1.createDate as createDate1, od1.orderType as orderType1,
    od2.orderId as orderId2, od2.createDate as createDate2, od2.orderType as orderType2

from userData ud 
    -- assuming not all users will have orders use outer join
    inner join (
            select 
                od.userId,
                -- can be null if no orders for type
                max (case when orderType = 1 
                        then ORDERID
                        else null
                        end) as maxTypeOneOrderId,

                -- can be null if no orders for type
                max (case when orderType = 2
                        then ORDERID 
                        else null
                        end) as maxTypeTwoOrderId
            from orderData od
            group by userId) as maxOrderKeys on
        maxOrderKeys.userId = ud.userId
    inner join orderData od1 on
        od1.ORDERID = maxTypeTwoOrderId
    inner join orderData od2 on
        OD2.ORDERID = maxTypeTwoOrderId 
```

方法 (3) 在 where 子句中使用内联查询（基于 Steve K. 的响应）：

```
select  ud.userId,ud.fullname, 
        order1.orderId, order1.orderType, order1.createDate, 
        order2.orderId, order2.orderType, order2.createDate
  from userData ud,
       orderData order1,
       orderData order2
 where ud.userId = order1.userId
   and ud.userId = order2.userId
   and order1.orderId = (select max(orderId)
                            from orderData od1
                           where od1.userId = ud.userId
                             and od1.orderType = 1)
   and order2.orderId = (select max(orderId)
                             from orderData od2
                            where od2.userId = ud.userId
                              and od2.orderType = 2) 
```

生成表和 1000 个用户的脚本，每个用户有 100 个订单：

```
CREATE TABLE [dbo].[orderData](
    [orderId] [int] IDENTITY(1,1) NOT NULL,
    [createDate] [datetime] NOT NULL,
    [orderType] [tinyint] NOT NULL, 
    [userId] [int] NOT NULL
) 

CREATE TABLE [dbo].[userData](
    [userId] [int] IDENTITY(1,1) NOT NULL,
    [fullname] [nvarchar](50) NOT NULL
) 

-- Create 1000 users with 100 order each
declare @userId int
declare @usersAdded int
set @usersAdded = 0

while @usersAdded < 1000
begin
    insert into userData (fullname) values ('Mario' + ltrim(str(@usersAdded)))
    set @userId = @@identity

    declare @orderSetsAdded int
    set @orderSetsAdded = 0
    while @orderSetsAdded < 10
    begin
        insert into orderData (userId, createDate, orderType) 
            values ( @userId, '01-06-08', 1)
        insert into orderData (userId, createDate, orderType) 
            values ( @userId, '01-02-08', 1)
        insert into orderData (userId, createDate, orderType) 
            values ( @userId, '01-08-08', 1)
        insert into orderData (userId, createDate, orderType) 
            values ( @userId, '01-09-08', 1)
        insert into orderData (userId, createDate, orderType) 
            values ( @userId, '01-01-08', 1)
        insert into orderData (userId, createDate, orderType) 
            values ( @userId, '01-06-06', 2)
        insert into orderData (userId, createDate, orderType) 
            values ( @userId, '01-02-02', 2)
        insert into orderData (userId, createDate, orderType) 
            values ( @userId, '01-08-09', 2)
        insert into orderData (userId, createDate, orderType) 
            values ( @userId, '01-09-01', 2)
        insert into orderData (userId, createDate, orderType) 
            values ( @userId, '01-01-04', 2)

        set @orderSetsAdded = @orderSetsAdded + 1
    end
    set @usersAdded = @usersAdded + 1
end 
```

除了 SQL Profiler 之外，用于在 MS SQL Server 上测试查询性能的小片段：

```
-- Uncomment these to clear some caches
--DBCC DROPCLEANBUFFERS
--DBCC FREEPROCCACHE

set statistics io on
set statistics time on

-- INSERT TEST QUERY HERE

set statistics time off
set statistics io off 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T18:25:24.470

抱歉，我面前没有 oracle，但这是我在 oracle 中所做的基本结构：

```
SELECT b.user_id, b.orderid, b.orderType, b.createDate, <etc>,
       a.name
FROM orderData b, userData a
WHERE a.userid = b.userid
AND (b.userid, b.orderType, b.createDate) IN (
  SELECT userid, orderType, max(createDate) 
  FROM orderData 
  WHERE orderType IN (1,2)
  GROUP BY userid, orderType) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T18:29:38.627

T-SQL 示例解决方案（MS SQL）：

```
SELECT
    u.*
    , o1.*
    , o2.* 
FROM
(
    SELECT
        , userData.*
        , (SELECT TOP 1 orderId.url FROM orderData WHERE orderData.userId=userData.userId AND orderType=1 ORDER BY createDate DESC)
            AS order1Id
        , (SELECT TOP 1 orderId.url FROM orderData WHERE orderData.userId=userData.userId AND orderType=2 ORDER BY createDate DESC)
            AS order2Id
    FROM userData
) AS u
LEFT JOIN orderData o1 ON (u.order1Id=o1.orderId)
LEFT JOIN orderData o2 ON (u.order2Id=o2.orderId) 
```

在 SQL 2005 中，您还可以使用 RANK ( ) OVER 函数。（但 AFAIK 完全是 MSSQL 特有的功能）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T18:14:29.690

他们最新的你是说今天的所有新的吗？如果 createDate >= 当前日期，您始终可以检查您的 createDate 并获取所有用户和订单数据。

```
SELECT * FROM
"orderData", "userData"
WHERE
"userData"."userId"  ="orderData"."userId"
AND "orderData".createDate >= current_date; 
```

**更新**

这是您在此处发表评论后想要的：

```
SELECT * FROM
"orderData", "userData"
WHERE
"userData"."userId"  ="orderData"."userId"
AND "orderData".type = '1'
AND "orderData"."orderId" = (
SELECT "orderId" FROM "orderData"
WHERE 
"orderType" = '1'
ORDER "orderId" DESC
LIMIT 1 
```

)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T18:21:18.490

您也许可以为此进行联合查询。确切的语法需要一些工作，尤其是按部分分组，但联合应该能够做到。

例如：

```
SELECT orderId, orderType, createDate
FROM orderData
WHERE type=1 AND MAX(createDate)
GROUP BY orderId, orderType, createDate

UNION

SELECT orderId, orderType, createDate
FROM orderData
WHERE type=2 AND MAX(createDate)
GROUP BY orderId, orderType, createDate 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T18:29:50.277

我在 MySQL 中使用这样的东西：

```
SELECT
   u.*,
   SUBSTRING_INDEX( MAX( CONCAT( o1.createDate, '##', o1.otherfield)), '##', -1) as o2_orderfield,
   SUBSTRING_INDEX( MAX( CONCAT( o2.createDate, '##', o2.otherfield)), '##', -1) as o2_orderfield
FROM
   userData as u
   LEFT JOIN orderData AS o1 ON (o1.userId=u.userId AND o1.orderType=1)
   LEFT JOIN orderData AS o2 ON (o1.userId=u.userId AND o2.orderType=2)
GROUP BY u.userId 
```

简而言之，使用 MAX() 通过将条件字段 (createDate) 附加到感兴趣的字段 (otherfield) 来获取最新的。SUBSTRING_INDEX() 然后去掉日期。

OTOH，如果您需要任意数量的订单（如果 userType 可以是任意数量，而不是有限的 ENUM）；最好使用单独的查询来处理，如下所示：

```
select * from orderData where userId=XXX order by orderType, date desc group by orderType 
```

对于每个用户。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T18:36:16.020

假设 orderId 随时间单调递增：

```
SELECT *
FROM userData u
INNER JOIN orderData o
  ON o.userId = u.userId
INNER JOIN ( -- This subquery gives the last order of each type for each customer
  SELECT MAX(o2.orderId)
    --, o2.userId -- optional - include if joining for a particular customer
    --, o2.orderType -- optional - include if joining for a particular type
  FROM orderData o2
  GROUP BY o2.userId
    ,o2.orderType
) AS LastOrders
  ON LastOrders.orderId = o.orderId -- expand join to include customer or type if desired 
```

然后在客户端进行透视，或者如果使用 SQL Server，则有 PIVOT 功能

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T18:57:45.110

这是将类型 1 和类型 2 数据移动到同一行的一种方法：（
通过将类型 1 和类型 2 信息放入它们自己的选择中，然后在 from 子句中使用。）

```
SELECT
  a.name, ud1.*, ud2.*
FROM
    userData a,
    (SELECT user_id, orderid, orderType, reateDate, <etc>,
    FROM orderData b
    WHERE (userid, orderType, createDate) IN (
      SELECT userid, orderType, max(createDate) 
      FROM orderData 
      WHERE orderType = 1
      GROUP BY userid, orderType) ud1,
    (SELECT user_id, orderid, orderType, createDate, <etc>,
    FROM orderData 
    WHERE (userid, orderType, createDate) IN (
      SELECT userid, orderType, max(createDate) 
      FROM orderData 
      WHERE orderType = 2
      GROUP BY userid, orderType) ud2 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-30T19:08:46.020

这是我的做法。这是标准 SQL，适用于任何品牌的数据库。

```
SELECT u.userId, u.name, o1.orderId, o1.orderType, o1.createDate,
  o2.orderId, o2.orderType, o2.createDate
FROM userData AS u
  LEFT OUTER JOIN (
    SELECT o1a.orderId, o1a.userId, o1a.orderType, o1a.createDate
    FROM orderData AS o1a 
      LEFT OUTER JOIN orderData AS o1b ON (o1a.userId = o1b.userId 
        AND o1a.orderType = o1b.orderType AND o1a.createDate < o1b.createDate)
    WHERE o1a.orderType = 1 AND o1b.orderId IS NULL) AS o1 ON (u.userId = o1.userId)
  LEFT OUTER JOIN (
    SELECT o2a.orderId, o2a.userId, o2a.orderType, o2a.createDate
    FROM orderData AS o2a 
      LEFT OUTER JOIN orderData AS o2b ON (o2a.userId = o2b.userId 
        AND o2a.orderType = o2b.orderType AND o2a.createDate < o2b.createDate)
    WHERE o2a.orderType = 2 AND o2b.orderId IS NULL) o2 ON (u.userId = o2.userId); 
```

请注意，如果您有多个日期等于最新日期的任一类型的订单，您将在结果集中获得多行。如果您有两种类型的多个订单，您将在结果集中获得 N x M 行。因此，我建议您在单独的查询中获取每种类型的行。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-30T19:24:18.807

史蒂夫 K 是绝对正确的，谢谢！我确实稍微改写了他的答案，以说明可能没有特定类型的订单（我没有提到，所以我不能责怪史蒂夫 K。）

这是我最终使用的：

```
select ud.name,
       order1.orderId,
       order1.orderType,
       order1.createDate,
       order2.orderId,
       order2.orderType,
       order2.createDate
  from userData ud
  left join orderData order1
   on order1.orderId = (select max(orderId)
                            from orderData od1
                           where od1.userId = ud.userId
                             and od1.orderType = '1')
  left join orderData order2
   on order2.orderId = (select max(orderId)
                            from orderData od2
                           where od2.userId = ud.userId
                             and od2.orderType = '2')
 where ...[some limiting factors on the selection of users]...; 
```

# c# - 如何在 C# 中访问嵌入式 .Net 图像资源所需的示例代码

> ID：154262
> 
> 赞同：10
> 
> 时间：2008-09-30T18:11:52.287
> 
> 标签：c#, .net, resources

将图像文件标记为嵌入式资源非常容易，但是此后如何访问图像。请问我可以有一些示例代码吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-30T18:15:38.987

最直接的方法：

```
YourProjectsBaseNamespace.Properties.Resources.YourImageResourceName 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-30T18:15:56.397

1)[添加和编辑资源 (Visual C#)](http://msdn.microsoft.com/en-us/library/7k989cfy(VS.80).aspx)

```
System.Drawing.Bitmap bitmap1 = myProject.Properties.Resources.Image01; 
```

2)[使用 GetManifestResourceStream 访问嵌入式资源](http://www.attilan.com/2006/08/accessing-embedded-resources-u.php)

```
Assembly _assembly = Assembly.GetExecutingAssembly();

Stream _imageStream = 
    _assembly.GetManifestResourceStream(
    "ThumbnailPictureViewer.resources.Image1.bmp");
Bitmap theDefaultImage = new Bitmap(_imageStream); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T18:14:22.563

查看位于[http://msdn.microsoft.com/en-us/library/aa309403(VS.71).aspx的第三个代码片段](http://msdn.microsoft.com/en-us/library/aa309403(VS.71).aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T18:18:17.577

```
//Get the names of the embedded resource files;

List<string> resources = new List<string>(AssemblyBuilder.GetExecutingAssembly().GetManifestResourceNames());

//Get the stream

StreamReader sr = new StreamReader(
                AssemblyBuilder.GetExecutingAssembly().GetManifestResourceStream(
                    resources.Find(target => target.ToLower().Contains("insert name here")) 
```

您可以从流中的位图转换。Bitmap 类有一个方法可以做到这一点。LoadFromStream 如果我没记错的话。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-07-11T11:44:53.390

您可以尝试使用[https://www.nuget.org/packages/EmbeddedResourceBrowser/](https://www.nuget.org/packages/EmbeddedResourceBrowser/)库，项目页面上有代码示例（[https://andrei15193.github.io/EmbeddedResourceBrowser/](https://andrei15193.github.io/EmbeddedResourceBrowser/)）。它只是为了帮助访问 .NET 应用程序中的嵌入式资源。您可以`Stream`阅读内容，它使浏览资源更加容易。

# c# - Windows 窗体中的东西在最大化时移动 - C#

> ID：154270
> 
> 赞同：6
> 
> 时间：2008-09-30T18:14:06.900
> 
> 标签：c#, windows, user-interface

自从我编写 GUI 程序以来已经有一段时间了，所以这最终可能非常简单，但我在网上的任何地方都找不到解决方案。

基本上我的问题是，当我最大化我的程序时，窗口内的所有东西（按钮、文本框等）都停留在窗口中的相同位置，这导致靠近底部和右侧的地方有一个大的空白区域。

有没有办法让程序中的元素按比例拉伸？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-30T18:22:33.977

您想要检查并正确设置窗体中每个控件的 Anchor 和 Dock 属性。控件上的 Anchor 属性告诉控件被“锚定”到窗体的哪一侧（顶部、底部、左侧、右侧）。调整窗体大小时，控件与其锚点之间的距离将保持不变。例如，这使您可以使控件保持在右下角。

Dock 属性指示控件填充整个父窗体或填充它的一侧（同样是顶部、底部、左侧或右侧）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T18:14:46.773

Anchor 和 Dock 属性

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T18:18:43.427

[在http://msdn.microsoft.com/en-us/library/aa289756(VS.71).aspx](http://msdn.microsoft.com/en-us/library/aa289756(VS.71).aspx)查看动态布局：锚定和停靠示例

它在 VB 中，但您需要的概念和属性/方法在 C# 中是相同的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T18:34:34.713

有一些布局面板控件可以帮助您在表单扩展/收缩时保持比例：

TableLayoutPanel
FlowLayoutPanel

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T18:35:05.057

> 至于布局，我不太确定您的意思，但我使用的是 Visual Studio 2008 的默认 GUI 编辑器。

有一些特殊的“容器”类型面板可以粘贴在表单上，​​例如`FlowLayoutPanel`和`TableLayoutPanel`。这些类型的容器具有额外的布局行为。

如果你发现你的某些控件在resize期间仍然不想表现，那么使用控件的右键上下文菜单列出控件的祖先：它的父级，它的父级的父级等。你可能会发现麻烦控件是一些特殊容器的子容器，它有自己的布局规则。

# windows - 使用清单在 LoadLibrary 中搜索 Windows 路径

> ID：154281
> 
> 赞同：4
> 
> 时间：2008-09-30T18:17:12.070
> 
> 标签：windows, dll, manifest, loadlibrary, side-by-side

如果您在`LoadLibrary`没有路径的情况下调用（例如，`LoadLibrary("whatever.dll")`Windows 通常会遵循其标准搜索算法，与它用于查找 EXE 的算法相同。

我的问题是：假设应用程序清单指定了系统 DLL 的特定版本，例如 comctl32.dll 6.0。在这种情况下，会`LoadLibrary("comctl32.dll")`立即转到正确的并排文件夹，还是仍然执行某种搜索？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T18:26:07.683

来自[微软：](http://msdn.microsoft.com/en-us/library/ms682586.aspx)

> 应用程序可以通过指定完整路径、使用 DLL 重定向或使用清单来控制加载 DLL 的位置。如果没有使用这些方法，系统会在加载时搜索 DLL，如本主题中所述。

所以是的，如果存在清单，它将直接进入 SxS 文件夹。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-09-13T17:42:39.800

要在遇到缺少库的问题时探测加载程序，您可以使用“sxstrace”功能。[www.codeproject.com/KB/DLL/QueryAssemblyIdentities.aspx](http://www.codeproject.com/KB/DLL/QueryAssemblyIdentities.aspx)提供了有关清单和 WinSxs 之间依赖关系的一些详细信息。

# php - php访问冲突

> ID：154290
> 
> 赞同：0
> 
> 时间：2008-09-30T18:18:46.873
> 
> 标签：php, drupal, administration

我正在尝试在 Vista (IIS 7) 上安装 Php。安装和配置似乎没问题。几乎遵循[http://blogs.iis.net/bills/archive/2006/09/19/How-to-install-PHP-on-IIS7-_2800_RC1_2900_.aspx中提到的所有内容](http://blogs.iis.net/bills/archive/2006/09/19/How-to-install-PHP-on-IIS7-_2800_RC1_2900_.aspx)

我什至可以调出一个test.php，它基本上也可以通过代码连接到mysql db。但是，当我尝试调出其他一些 php 页面时，例如 drupal 的索引页面或 phpmyadmin 索引页面，它会显示一个 Php 访问冲突消息。

任何线索发生了什么？还有一些用于 php 的跟踪/诊断工具来跟踪网络服务器上发生的事情。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T18:57:30.307

在您的 PHP.INI 文件中，尝试注释所有扩展行并重新启动 IIS。请注意，MySql 将不再工作。做一些测试。

如果成功，请取消注释 mySql 行。做一些测试。

如果不成功，他们我帮不了你更多。我怀疑这是导致错误的加载扩展。你必须找到哪一个...

希望这可以帮助。

冰山

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T13:40:16.317

多谢你们。我禁用了所有扩展并开始一次添加一个，并且只添加我需要使用的那些（mysql、mbstring 等）。我还必须将 php.ini 复制到 System32 文件夹中（即使我在系统路径中有它）。瞧，它奏效了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T19:01:19.797

我假设您使用的是 PHP 5.2.6（最新版本）。我还假设您使用链接中的说明使用 ISAPI。

似乎有很多关于 IIS 上的 PHP 存在访问冲突的错误报告。

[这里](http://bugs.php.net/bug.php?id=43303)和[这里](http://bugs.php.net/bug.php?id=44869)或[列表](http://bugs.php.net/search.php?cmd=display&status=&search_for=IIS+access+violation&php_os=&boolean=1&author_email=&bug_age=0&by=&order_by=&direction=&phpver=&limit=30&assign=&reorder_by=id)

到目前为止，我发现的唯一建议是尝试 FastCGI 而不是 ISAPI。

我从来不用调试 PHP 本身，我自己的脚本，但不是 PHP。有[生成回溯](http://bugs.php.net/bugs-generating-backtrace-win32.php)和一些[一般调试信息](http://us3.php.net/manual/en/debugger.php)的说明。

编辑——在阅读了viceBerg的回答后，我记得另一个可能的原因是非线程安全的PHP扩展和IIS不喜欢对方。将它们全部禁用并一次启用它们可能是值得的，但只有当您可以获得一个脚本来始终导致该错误时它才真正有用。

如果没有一致的、可重现的错误，这将很难调试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-29T00:25:44.763

尝试将php自带的libmysql.dll移到windows\system32

# java - 在不同 JDK 上运行的 ActiveMQ 代理和客户端有什么问题吗？

> ID：154292
> 
> 赞同：2
> 
> 时间：2008-09-30T18:18:59.960
> 
> 标签：java, activemq

我们有一个分布式系统，其组件（包括 ActiveMQ 代理）在 jdk 1.6 上运行。

一位潜在客户希望将基于 jdk 1.4 构建的组件与我们的系统集成。虽然该客户愿意编写代码以与我们的系统集成，但他们不愿意从 jdk 1.4 迁移。

一个客户端运行旧 jdk 的系统会有任何问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T07:44:05.487

ActiveMQ 5.x 适用于 Java 1.5 或更高版本 - 任何 JVM 1.5 或更高版本都应该可以正常工作，因为 ActiveMQ 使用自己的编组层并且不依赖于序列化等。

如果您想使用 Java 1.4，您需要安装[Retrotranslator JIT](http://retrotranslator.sourceforge.net/)或使用 Retrotranslator 将 jar 转换为 1.4 兼容的字节码。有一个[Maven 逆向翻译插件可以提供帮助](http://mojo.codehaus.org/retrotranslator-maven-plugin/)。有关更多帮助，请参阅[ActiveMQ 常见问题解答条目](http://activemq.apache.org/can-i-use-activemq-5x-or-later-on-java-14.html)

另一种选择是编写一个简单的[STOMP 客户端](http://stomp.codehaus.org/)，这对于小程序等来说是一个很好的解决方案。

# asp.net-mvc - ASP.NET MVC 路由上的尾部斜杠

> ID：154295
> 
> 赞同：18
> 
> 时间：2008-09-30T18:19:33.720
> 
> 标签：asp.net-mvc, asp.net-mvc-routing

在最新的 MVC 预览版中，我将此路由用于旧版 URL：

```
routes.MapRoute(
"Legacy-Firefox", // Route name
"Firefox-Extension/", // URL with parameters
new { controller = "Home", action = "Firefox", id = "" } // Parameter defaults
); 
```

问题是这两个 URL 的工作： http: [//example.com/Firefox-Extension](http://example.com/Firefox-Extension) [http://example.com/Firefox-Extension/](http://example.com/Firefox-Extension/)

我只希望第二个工作（对于 SEO）。此外，当我创建指向该页面的链接时，路由引擎会返回一个不带斜杠的 URL。

这是我用来生成链接的代码：

```
<%= Html.ActionLink("Firefox Extension", "Firefox", "Home")%> 
```

我相信可以通过使用 HTTP 处理程序执行 301 重定向到带有尾部斜杠的 URL 来解决第一个问题。但是，我想链接到带有斜杠的 URL，并且我希望不必用斜杠对版本进行硬编码。

任何人都知道如何强制路线使用斜杠？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-05T12:38:56.973

如果您在 RouteLink 上有一个包装器，那么这个问题的解决方案就很简单了。例如，我有一个包装方法 RouteLinkEx：

```
public static string RouteLinkEx(this HtmlHelper helper,string text,string routeName,RouteValueDictionary rvd,object htmlAttributes)
      {

      UrlHelper uh = new UrlHelper(helper.ViewContext.RequestContext,helper.RouteCollection);
      // Add trailing slash to the url of the link
      string url = uh.RouteUrl(routeName,rvd) + "/";
      TagBuilder builder = new TagBuilder("a")
      {
        InnerHtml = !string.IsNullOrEmpty(text) ? HttpUtility.HtmlEncode(text) : string.Empty
      };
      builder.MergeAttributes(new RouteValueDictionary(htmlAttributes));
      builder.MergeAttribute("href",url);
      return builder.ToString(TagRenderMode.Normal);
      //---  
      } 
```

如您所见，我首先使用参数生成 URL。然后我在 URL 的末尾添加了“/”。然后我使用这些 URL 生成了完整的链接。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-05-06T13:00:20.667

我偶然发现了这篇博文：

[http://www.ytechie.com/2008/10/aspnet-mvc-what-about-seo.html](http://www.ytechie.com/2008/10/aspnet-mvc-what-about-seo.html)

今天早上在 StackOverflow 上遇到这个问题之前。那篇博文（来自这个问题的作者）有一个来自 Scott Hanselman 的这篇博文的引用，并回答了这个问题：

[http://www.hanselman.com/blog/ASPNETMVCAndTheNewIIS7RewriteModule.aspx](http://www.hanselman.com/blog/ASPNETMVCAndTheNewIIS7RewriteModule.aspx)

我很惊讶地发现没有从这里到那里的链接，所以我只是添加了它。:)

Scott 的回答建议使用 URL 重写。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-08T05:57:49.690

编写链接时，应始终包含最后的斜杠。我不知道这是否适用于 mvc 框架（或一般的 URL 路由），但我知道对于静态资源，如果您不添加斜线，则会在请求完成两次时增加一点开销。

斜杠立即将 url 标识为指向目录。无需解析文件。

同样，我不相信这适用于您使用 URL 路由时，但我没有调查过。

在此处查看[有关斜杠的文章](http://dmiessler.com/study/hyperlink_trailing_slash/)

编辑：考虑到这一点......我认为最好不要使用斜线，而不是尝试包含它。当您使用 url 路由时，您正在使用 URL 直接路由到资源。与使用 index.html 或 default.aspx 指向目录相反，您指向的是特定文件。

我知道差异是微妙的，但对于路由 URL，最好坚持使用非斜线，而不是与框架抗争。

当您实际指向一个目录时，请严格使用尾部斜杠。我想我想如果你真的不喜欢它，你可以每次都在末尾附加一个斜杠。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-07-23T08:47:37.253

MVC 5 和 6 可以选择为您的路由生成小写 URL。我的路线配置如下所示：

```
public static class RouteConfig
{
    public static void RegisterRoutes(RouteCollection routes)
    {
        // Imprive SEO by stopping duplicate URL's due to case or trailing slashes.
        routes.AppendTrailingSlash = true;
        routes.LowercaseUrls = true;

        routes.IgnoreRoute("{resource}.axd/{*pathInfo}");

        routes.MapRoute(
            name: "Default",
            url: "{controller}/{action}/{id}",
            defaults: new { controller = "Home", action = "Index", id = UrlParameter.Optional });
    }
} 
```

使用此代码，您应该不再需要规范化 URL，因为这是为您完成的。如果您使用 HTTP 和 HTTPS URL 并为此需要一个规范的 URL，则可能会出现一个问题。在这种情况下，很容易使用上述方法并将 HTTP 替换为 HTTPS，反之亦然。

另一个问题是链接到您网站的外部网站可能会省略尾部斜杠或添加大写字符，为此您应该执行 301 永久重定向到带有尾部斜杠的正确 URL。完整用法和源代码，参考我的[博](http://rehansaeed.com/canonical-urls-for-asp-net-mvc/)文和`RedirectToCanonicalUrlAttribute`过滤器：

```
/// <summary>
/// To improve Search Engine Optimization SEO, there should only be a single URL for each resource. Case 
/// differences and/or URL's with/without trailing slashes are treated as different URL's by search engines. This 
/// filter redirects all non-canonical URL's based on the settings specified to their canonical equivalent. 
/// Note: Non-canonical URL's are not generated by this site template, it is usually external sites which are 
/// linking to your site but have changed the URL case or added/removed trailing slashes.
/// (See Google's comments at http://googlewebmastercentral.blogspot.co.uk/2010/04/to-slash-or-not-to-slash.html
/// and Bing's at http://blogs.bing.com/webmaster/2012/01/26/moving-content-think-301-not-relcanonical).
/// </summary>
[AttributeUsage(AttributeTargets.Method | AttributeTargets.Class, Inherited = true, AllowMultiple = false)]
public class RedirectToCanonicalUrlAttribute : FilterAttribute, IAuthorizationFilter
{
    private readonly bool appendTrailingSlash;
    private readonly bool lowercaseUrls;

    #region Constructors

    /// <summary>
    /// Initializes a new instance of the <see cref="RedirectToCanonicalUrlAttribute" /> class.
    /// </summary>
    /// <param name="appendTrailingSlash">If set to <c>true</c> append trailing slashes, otherwise strip trailing 
    /// slashes.</param>
    /// <param name="lowercaseUrls">If set to <c>true</c> lower-case all URL's.</param>
    public RedirectToCanonicalUrlAttribute(
        bool appendTrailingSlash, 
        bool lowercaseUrls)
    {
        this.appendTrailingSlash = appendTrailingSlash;
        this.lowercaseUrls = lowercaseUrls;
    } 

    #endregion

    #region Public Methods

    /// <summary>
    /// Determines whether the HTTP request contains a non-canonical URL using <see cref="TryGetCanonicalUrl"/>, 
    /// if it doesn't calls the <see cref="HandleNonCanonicalRequest"/> method.
    /// </summary>
    /// <param name="filterContext">An object that encapsulates information that is required in order to use the 
    /// <see cref="RedirectToCanonicalUrlAttribute"/> attribute.</param>
    /// <exception cref="ArgumentNullException">The <paramref name="filterContext"/> parameter is <c>null</c>.</exception>
    public virtual void OnAuthorization(AuthorizationContext filterContext)
    {
        if (filterContext == null)
        {
            throw new ArgumentNullException("filterContext");
        }

        if (string.Equals(filterContext.HttpContext.Request.HttpMethod, "GET", StringComparison.Ordinal))
        {
            string canonicalUrl;
            if (!this.TryGetCanonicalUrl(filterContext, out canonicalUrl))
            {
                this.HandleNonCanonicalRequest(filterContext, canonicalUrl);
            }
        }
    }

    #endregion

    #region Protected Methods

    /// <summary>
    /// Determines whether the specified URl is canonical and if it is not, outputs the canonical URL.
    /// </summary>
    /// <param name="filterContext">An object that encapsulates information that is required in order to use the 
    /// <see cref="RedirectToCanonicalUrlAttribute" /> attribute.</param>
    /// <param name="canonicalUrl">The canonical URL.</param>
    /// <returns><c>true</c> if the URL is canonical, otherwise <c>false</c>.</returns>
    protected virtual bool TryGetCanonicalUrl(AuthorizationContext filterContext, out string canonicalUrl)
    {
        bool isCanonical = true;

        canonicalUrl = filterContext.HttpContext.Request.Url.ToString();
        int queryIndex = canonicalUrl.IndexOf(QueryCharacter);

        if (queryIndex == -1)
        {
            bool hasTrailingSlash = canonicalUrl[canonicalUrl.Length - 1] == SlashCharacter;

            if (this.appendTrailingSlash)
            {
                // Append a trailing slash to the end of the URL.
                if (!hasTrailingSlash)
                {
                    canonicalUrl += SlashCharacter;
                    isCanonical = false;
                }
            }
            else
            {
                // Trim a trailing slash from the end of the URL.
                if (hasTrailingSlash)
                {
                    canonicalUrl = canonicalUrl.TrimEnd(SlashCharacter);
                    isCanonical = false;
                }
            }
        }
        else
        {
            bool hasTrailingSlash = canonicalUrl[queryIndex - 1] == SlashCharacter;

            if (this.appendTrailingSlash)
            {
                // Append a trailing slash to the end of the URL but before the query string.
                if (!hasTrailingSlash)
                {
                    canonicalUrl = canonicalUrl.Insert(queryIndex, SlashCharacter.ToString());
                    isCanonical = false;
                }
            }
            else
            {
                // Trim a trailing slash to the end of the URL but before the query string.
                if (hasTrailingSlash)
                {
                    canonicalUrl = canonicalUrl.Remove(queryIndex - 1, 1);
                    isCanonical = false;
                }
            }
        }

        if (this.lowercaseUrls)
        {
            foreach (char character in canonicalUrl)
            {
                if (char.IsUpper(character))
                {
                    canonicalUrl = canonicalUrl.ToLower();
                    isCanonical = false;
                    break;
                }
            }
        }

        return isCanonical;
    }

    /// <summary>
    /// Handles HTTP requests for URL's that are not canonical. Performs a 301 Permanent Redirect to the canonical URL.
    /// </summary>
    /// <param name="filterContext">An object that encapsulates information that is required in order to use the 
    /// <see cref="RedirectToCanonicalUrlAttribute" /> attribute.</param>
    /// <param name="canonicalUrl">The canonical URL.</param>
    protected virtual void HandleNonCanonicalRequest(AuthorizationContext filterContext, string canonicalUrl)
    {
        filterContext.Result = new RedirectResult(canonicalUrl, true);
    }

    #endregion
} 
```

确保所有请求都被 301 重定向到正确的规范 URL 的使用示例：

```
filters.Add(new RedirectToCanonicalUrlAttribute(
    RouteTable.Routes.AppendTrailingSlash, 
    RouteTable.Routes.LowercaseUrls)); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-23T05:25:28.173

这是我的 ASP.NET MVC 2 版本

```
 public static MvcHtmlString RouteLinkEx(this HtmlHelper helper, string text, RouteValueDictionary routeValues)
    {
        return RouteLinkEx(helper, text, null, routeValues, null);
    }

    public static MvcHtmlString RouteLinkEx(this HtmlHelper htmlHelper, string text, string routeName, RouteValueDictionary routeValues, object htmlAttributes)
    {
        string url = UrlHelper.GenerateUrl(routeName, null, null, null, null, null, routeValues, htmlHelper.RouteCollection, htmlHelper.ViewContext.RequestContext, false);

        var builder = new TagBuilder("a")
        {
            InnerHtml = !string.IsNullOrEmpty(text) ? HttpUtility.HtmlEncode(text) : string.Empty
        };
        builder.MergeAttributes(new RouteValueDictionary(htmlAttributes));
        // Add trailing slash to the url of the link
        builder.MergeAttribute("href", url + "/");
        return MvcHtmlString.Create(builder.ToString(TagRenderMode.Normal));
    } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-02-08T15:00:49.623

I think you are solving the problem from the wrong angle. The reason given for wanting to force the single url is for SEO. I believe this refers to getting a duplicate content penalty because search engines consider this two URLs with the same content.

Another solution to this problem then is to add a CANONICAL tag to your page which tells the search engines which is the "official" url for the page. Once you do that you no longer need to force the URLs and search engines will not penalize you and will route search results to your official url.

[https://support.google.com/webmasters/answer/139066?hl=en](https://support.google.com/webmasters/answer/139066?hl=en)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-02-01T04:13:16.850

这里是 RouteLinkEx(HtmlHelper, string,string, object) 的重载

```
 public static string RouteLinkEx(this HtmlHelper helper, string text, string routeName, object routeValues)
    {

        UrlHelper uh = new UrlHelper(helper.ViewContext.RequestContext);

        // Add trailing slash to the url of the link 
        string url = uh.RouteUrl(routeName, routeValues) + "/";
        TagBuilder builder = new TagBuilder("a")
        {
            InnerHtml = !string.IsNullOrEmpty(text) ? HttpUtility.HtmlEncode(text) : string.Empty
        };
        //builder.MergeAttributes(new RouteValueDictionary(htmlAttributes));
        builder.MergeAttribute("href", url);
        return builder.ToString(TagRenderMode.Normal);
        //---   
    } 
```

# vb6 - 调试VB6应用程序时如何设置工作目录？

> ID：154299
> 
> 赞同：13
> 
> 时间：2008-09-30T18:21:17.600
> 
> 标签：vb6

我正在调试一个 VB6 可执行文件。可执行文件在运行时从其当前目录加载 dll 和文件。在调试器中运行时，当前目录似乎是 VB6 的目录。

如何为 VB6 设置工作目录？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-30T18:31:27.310

这似乎不是一个“开箱即用”的解决方案。

取自[软件论坛上的老乔尔](http://discuss.fogcreek.com/joelonsoftware1/default.asp?cmd=show&ixPost=19026&ixReplies=5)

> 无论如何.. 让这个话题休息.. 以下是我的 VB6 解决方案：我在我的 VB 项目“MPDEBUG”和“MPRELEASE”中定义了 2 个符号，并在我的应用程序入口点函数中调用以下函数作为第一个操作。

```
Public Sub ChangeDirToApp()
#If MPDEBUG = 0 And MPRELEASE = 1 Then
  ' assume that in final release builds the current dir will be the location
  ' of where the .exe was installed; paths are relative to the install dir
  ChDrive App.path
  ChDir App.path
#Else
  ' in all debug/IDE related builds, we need to switch to the "bin" dir
  ChDrive App.path
  ChDir App.path & BackSlash(App.path) & "..\bin"
#End If
End Sub 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-30T19:33:30.967

仅当您使用 File-Open 打开项目时，“当前目录似乎是 VB6 的目录”。

在关闭 IDE 的同时双击 .vbp 文件将其打开。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-30T19:28:30.887

我发现可行的解决方案使用`Sub Main`, 并检查程序是否在 IDE 中运行。

```
Dim gISIDE as Boolean

Sub Main()
    If IsIDE Then
        ChDrive App.Path
        ChDir   App.Path
    End If

    ' The rest of the code goes here...

End Sub

Public Function IsIDE() As Boolean '
        IsIDE = False
        'This line is only executed if running in the IDE and then returns True
        Debug.Assert CheckIDE 
        If gISIDE Then 
            IsIDE = True
        End If
End Function

Private Function CheckIDE() As Boolean ' this is a helper function for Public Function IsIDE() 
        gISIDE = True 'set global flag 
        CheckIDE = True 
End Function 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T18:27:31.330

[这行得通吗？](http://sintaks.blogspot.com/2006/07/vb6-set-current-working-directory.html)

```
'Declaration
Private Declare Function SetCurrentDirectory Lib "kernel32" _
Alias "SetCurrentDirectoryA" (ByVal lpPathName As String) As Long

'syntax to set current dir
SetCurrentDirectory App.Path 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T19:09:52.723

任何程序的当前目录 - 包括 vb6 - 都可以在快捷方式的属性中更改。我已将其更改为我的源代码树的根，它可以更快地使用 File-Open。

# wpf - 除了 1 个控件之外，是否可以对 Canvas/Grid 上的所有内容进行 ScaleTransform？

> ID：154305
> 
> 赞同：3
> 
> 时间：2008-09-30T18:23:07.813
> 
> 标签：wpf

给定以下画布：

```
<Canvas>
    <Canvas.LayoutTransform>
        <ScaleTransform ScaleX="1" ScaleY="1" CenterX=".5" CenterY=".5" />
    </Canvas.LayoutTransform>
    <Button x:Name="scaleButton" Content="Scale Me" Canvas.Top="10" Canvas.Left="10" />
    <Button x:Name="dontScaleButton" Content="DON'T Scale Me" Canvas.Top="10" Canvas.Left="50" />
</Canvas> 
```

当 ScaleX 和 ScaleY 改变时，是否可以缩放 1 个按钮，但不能缩放另一个？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-30T18:39:36.293

不在 XAML 中。您可以在代码中通过构建反向转换并将其应用于您不想转换的对象来执行此操作。

如果您想花哨，您可以构建一个依赖属性，您可以在 XAML 中将其附加到您不想被任何父转换转换的任何对象。这个依赖属性将接受父对象的转换，构建一个反向转换并将其应用于它所附加的对象。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-04-15T01:19:50.433

当你问这个问题时不确定这是否不可能，但我会这样处理：

```
<Button x:Name="dontScaleButton" Content="DON'T Scale Me" Canvas.Top="10" Canvas.Left="50"
        LayoutTransform="{Binding LayoutTransform.Inverse,
                                  RelativeSource={RelativeSource AncestorType=Canvas}}"/> 
```

不过，原始变换似乎仍然对按钮有平移效果。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T19:12:00.443

您还可以重组元素，以便您不想使用 缩放的元素`Canvas`实际上不是 that 的子元素`Canvas`。

```
<Canvas>
    <Canvas>
        <Canvas.LayoutTransform>
            <ScaleTransform ScaleX="1" ScaleY="1" CenterX=".5" CenterY=".5" />
        </Canvas.LayoutTransform>
        <Button x:Name="scaleButton" Content="Scale Me" Canvas.Top="10" Canvas.Left="10" />
    </Canvas>
    <Button x:Name="dontScaleButton" Content="DON'T Scale Me" Canvas.Top="10" Canvas.Left="50" />
</Canvas> 
```

# .net - 为什么 .Net 字典中的条目要另外排序？

> ID：154307
> 
> 赞同：23
> 
> 时间：2008-09-30T18:23:32.993
> 
> 标签：.net, data-structures, dictionary, hashtable

我刚刚看到这种行为，我对此感到有点惊讶......

如果我将 3 或 4 个元素添加到字典，然后执行“For Each”以获取所有键，它们会按照我添加它们的顺序出现。

这让我感到惊讶的原因是 Dictionary 应该是内部的 HashTable，所以我希望事情以任何顺序出现（按键的哈希排序，对吗？）

我在这里想念什么？这是我可以指望的行为吗？

*编辑：好的，我已经想到了可能*发生这种情况的许多原因（例如条目的单独列表，这是否是巧合等）。我的问题是，有人**知道**这到底是如何工作的吗？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-06-10T16:54:38.010

如果您在 3.5 类库上使用 .NET Reflector，您可以看到 Dictionary 的实现实际上将项目存储在一个数组中（根据需要调整大小），并将索引散列到该数组中。获取密钥时，它完全忽略哈希表并遍历项目数组。出于这个原因，您将看到您所描述的行为，因为新项目被添加到数组的末尾。如果您执行以下操作，则看起来像：

```
add 1
add 2
add 3
add 4
remove 2
add 5 
```

你会得到 1 5 3 4 因为它重用了空槽。

重要的是要注意，就像许多其他人一样，您不能指望在未来（或过去）版本中出现这种行为。如果您希望对字典进行排序，那么为此目的有一个[SortedDictionary类。](http://msdn.microsoft.com/en-us/library/f7fta44c.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-30T18:25:02.130

字典以散列顺序检索项目。他们按插入顺序出现的事实完全是巧合。

MSDN 文档说：

> KeyCollection 中键的顺序未指定，但它与 Values 属性返回的 ValueCollection 中的关联值的顺序相同。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-30T18:31:51.023

你不能指望这种行为，但这并不奇怪。

考虑如何为一个简单的哈希表实现键迭代。您需要遍历所有哈希桶，无论它们是否有任何内容。从大哈希表中获取小数据集可能效率低下。

因此，保留一个单独的重复键列表可能是一个很好的优化。使用双链表，您仍然可以获得恒定时间的插入/删除。（您可以将哈希表存储桶中的指针保留回该列表。）这样遍历键列表仅取决于条目数，而不取决于存储桶数。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T18:34:20.673

我认为这来自旧的 .NET 1.1 时代，您有两种字典“ListDictionary”和“HybridDictionary”。[ListDictionary](http://msdn.microsoft.com/en-us/library/system.collections.specialized.listdictionary.aspx)是内部实现为有序列表的字典，推荐用于“小型条目集”。然后你有[HybridDictionary](http://msdn.microsoft.com/en-us/library/system.collections.specialized.hybriddictionary.aspx)，它最初在内部组织为一个列表，但如果它变得大于可配置的阈值，它将成为一个哈希表。这样做是因为历史上正确的基于散列的字典被认为是昂贵的。现在日子没有多大意义，但我认为.NET 只是基于旧的 HybridDictionary 的新 Dictionary 泛型类。

**注意**：无论如何，正如其他人已经指出的那样，你*永远不*应该指望字典顺序来做任何事情

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T18:27:46.867

来自[MSDN](http://msdn.microsoft.com/en-us/library/3fcwy8h6.aspx)的引用：

> Dictionary<(Of <(TKey, TValue>)>).KeyCollection 中键的顺序未指定，但与 Dictionary<(Of <(TKey, TValue>)>) 中关联值的顺序相同Dictionary<(Of <(TKey, TValue>)>).Values 属性返回的 .ValueCollection。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T18:29:27.753

您在测试中添加了哪些键，按什么顺序添加？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T19:02:58.950

您的条目可能都在字典中的同一个哈希桶中。每个桶可能是桶中条目的列表。这将解释按顺序返回的条目。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T18:26:01.583

据我所知，这不应该是一种可以依赖的行为。要快速检查它，请使用相同的元素并更改将它们添加到字典的顺序。您会看到是否按照添加顺序将它们取回，或者这只是巧合。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-09T22:31:40.553

在达到一定的列表大小之前，只检查每个条目而不是散列会更便宜。这可能就是正在发生的事情。

添加 100 或 1000 个项目，看看它们是否仍处于相同的顺序。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-08-11T07:38:10.657

我讨厌这种“设计”的功能。我认为，当给你的班级起一个像“字典”这样的通用名称时，它的行为也应该“像一般预期的那样”。例如 std::map 总是保持它的键值排序。

编辑：显然解决方案是使用 SortedDictionary，其行为类似于 std::map。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-05-05T14:52:19.123

这个问题和许多答案似乎误解了哈希表或字典的目的。这些数据结构对于数据结构中包含的项目的值（或实际上是键）的枚举没有指定的行为。

字典或哈希表的目的是能够有效地查找给定已知键的特定值。任何字典或哈希表的内部实现都应该在查找中提供这种效率，但不需要提供关于枚举或值或键上的“每个”类型迭代的任何特定行为。

简而言之，内部数据结构可以按照它希望的任何方式存储和枚举这些值，包括它们被插入的顺序。

# java - 我怎样才能弄清楚是什么保留了未释放的对象？

> ID：154309
> 
> 赞同：15
> 
> 时间：2008-09-30T18:24:33.893
> 
> 标签：java, garbage-collection, jprofiler

我们的一个程序有时会`OutOfMemory`在一个用户的机器上出错，但在我测试它时当然不会。我只是用 JProfiler 运行它（在 10 天评估许可证上，因为我以前从未使用过它），并过滤我们的代码前缀，总大小和实例数的最大块是特定简单类的 8000+ 个实例.

我单击了 JProfiler 上的“垃圾收集”按钮，我们其他类的大多数实例都消失了，但这些特定的实例没有。我再次运行测试，仍然在同一个实例中，它创建了 4000 多个该类的实例，但是当我单击“垃圾收集”时，这些实例消失了，留下了 8000 多个原始实例。

这些实例确实在各个阶段陷入了各种集合中。我假设它们不是垃圾收集的事实一定意味着某些东西正在持有对其中一个集合的引用，因此它持有对对象的引用。

有什么建议可以让我弄清楚参考资料是什么？我正在寻找有关在代码中寻找什么的建议，以及在 JProfiler 中找到它的方法（如果有）。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-30T19:28:17.737

转储堆并检查它。

我确信有不止一种方法可以做到这一点，但这里有一个简单的方法。此描述适用于 MS Windows，但可以在其他操作系统上执行类似的步骤。

1.  如果您还没有 JDK，请安装它。[它带有一堆整洁的工具。](http://java.sun.com/javase/6/docs/technotes/tools/index.html)
2.  启动应用程序。
3.  打开任务管理器并找到 java.exe（或您正在使用的任何可执行文件）的进程 ID (PID)。如果默认情况下不显示 PID，请使用 View > Select Columns... 添加它们。
4.  *使用jmap*转储堆。
5.  在您生成的文件上启动*jhat*服务器并打开浏览器访问*[http://localhost:7000](http://localhost:7000)*（默认端口为 7000）。现在您可以浏览您感兴趣的类型以及实例数量、引用它们的内容等信息。

这是一个例子：

```
C:\dump>jmap -dump:format=b,file=heap.bin 3552

C:\dump>jhat heap.bin
Reading from heap.bin...
Dump file created Tue Sep 30 19:46:23 BST 2008
Snapshot read, resolving...
Resolving 35484 objects...
Chasing references, expect 7 dots.......
Eliminating duplicate references.......
Snapshot resolved.
Started HTTP server on port 7000
Server is ready. 
```

为了解释这一点，了解 Java 使用的一些[数组类型命名法](http://java.sun.com/javase/6/docs/api/java/lang/Class.html#getName())很有用——比如知道**类 [Ljava.lang.Object;** 真正意味着**Object[]**类型的对象。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-30T19:26:21.127

试试 Eclipse 内存分析器。它将向您展示每个对象如何连接到 GC 根 - 一个不会被垃圾回收的对象，因为它由 JVM 持有。

有关 Eclipse MAT 如何工作的更多信息，请参阅[http://dev.eclipse.org/blogs/memoryanalyzer/2008/05/27/automated-heap-dump-analysis-finding-memory-leaks-with-one-click/](http://dev.eclipse.org/blogs/memoryanalyzer/2008/05/27/automated-heap-dump-analysis-finding-memory-leaks-with-one-click/)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-30T18:58:33.547

我会在你的类中查看集合（尤其是静态集合）（HashMaps 是一个很好的起点）。以这段代码为例：

```
Map<String, Object> map = new HashMap<String, Object>(); // 1 Object
String name = "test";             // 2 Objects
Object o = new Object();          // 3 Objects
map.put(name, o);                 // 3 Objects, 2 of which have 2 references to them

o = null;                         // The objects are still being
name = null;                      // referenced by the HashMap and won't be GC'd

System.gc();                      // Nothing is deleted.

Object test = map.get("test");    // Returns o
test = null;

map.remove("test");               // Now we're down to just the HashMap in memory
                                  // o, name and test can all be GC'd 
```

只要 HashMap 或其他一些集合有对该对象的引用，它就不会被垃圾收集。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T18:44:26.187

那里没有灵丹妙药，您必须使用分析器来识别包含那些不需要的对象的集合，并在代码中找到应该删除它们的位置。正如 JesperE 所说，静态集合是首先要看的地方。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T18:35:32.900

留意静态容器。只要加载了类，静态容器中的任何对象都将保留。

编辑：删除了对 WeakReference 的不正确评论。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-30T18:44:23.440

一个明显的候选对象是带有终结器的对象。他们可以在调用 finalize 方法时逗留。它们需要被收集，然后最终确定（通常只使用一个终结器线程），然后再次收集。

另请注意，您可以获得 OOME，因为 gc 未能收集足够的内存，尽管实际上有足够的内存来创建对象请求。否则性能会被磨平。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T19:20:18.533

我刚刚读过一篇关于这个的文章，但很抱歉我不记得在哪里。我认为它可能在“Effective Java”一书中。如果我找到参考资料，我会更新我的答案。

它概述的两个重要教训是：

1）最终方法告诉gc在剔除对象时要做什么，但它没有要求它这样做，也没有办法要求它这样做。

2）现代非托管内存环境中的“内存泄漏”等价物是被遗忘的引用。如果您在使用完对象后没有将所有对对象的引用设置为*null*，则该对象将*永远不会*被剔除。这在实现您自己的 Collection 或您自己的管理 Collection 的包装器时最重要。如果您有一个池、一个堆栈或一个队列，并且当您从集合中“删除”一个对象时没有将存储桶设置为*null*，则该对象所在的存储桶将使该对象保持活动状态，直到该存储桶设置为引用另一个对象。

免责声明：我知道其他答案提到了这一点，但我试图提供更多细节。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-30T19:30:57.307

我使用 Yourkit Java profiler ( [http://www.yourkit.com](http://www.yourkit.com) ) 对 java 1.5 进行性能优化。它有一个关于如何处理内存泄漏的部分。我觉得它很有用。

[http://www.yourkit.com/docs/75/help/performance_problems/memory_leaks/index.jsp](http://www.yourkit.com/docs/75/help/performance_problems/memory_leaks/index.jsp)

您可以获得 15 天的评估：http: [//www.yourkit.com/download/yjp-7.5.7.exe](http://www.yourkit.com/download/yjp-7.5.7.exe)

BR，
~A

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-09T07:24:17.417

收藏品已经提到过。另一个难以找到的位置是，如果您使用多个 ClassLoader，因为在所有引用都消失之前，旧的 classloader 可能无法被垃圾收集。

还要检查静态数据 - 这些很讨厌。日志框架可以保持开放，这可能会在自定义附加程序中保留引用。

你解决问题了吗？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-31T01:51:06.720

一些建议：

*   无限地图用作缓存，尤其是在静态时
*   服务器应用中的 ThreadLocals，因为线程通常不会死掉，所以 ThreadLocal 没有被释放
*   Interning 字符串（Strings.intern()），导致 PermSpace 中有一堆字符串

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-30T18:37:01.760

如果您在垃圾收集语言中遇到 OOM 错误，这通常意味着收集器没有占用一些内存。也许您的对象拥有非 java 资源？如果是这样，那么他们应该有某种“关闭”方法来确保即使没有足够快地收集 Java 对象也能释放资源。

# php - XML 解析错误：SYSTEM 或 PUBLIC，缺少 URI

> ID：154310
> 
> 赞同：0
> 
> 时间：2008-09-30T18:24:36.470
> 
> 标签：php, xml, rss

我正在从以下 URL 解析 RSS 提要：

[http://rss.sciam.com/ScientificAmerican-Global?format=xml](http://rss.sciam.com/ScientificAmerican-Global?format=xml)

```
// $xml_text is filled with the contents read from the URL
$xml_parser = xml_parser_create();
$res = xml_parse($xml_parser, $xml_text);

if (!$res) {
  $error =
    xml_error_string(xml_get_error_code($xml_parser)).
    " at line ".
    xml_get_current_line_number($xml_parser);
}

// $error contains: "SYSTEM or PUBLIC, the URI is missing at line 1" 
```

[FeedValidator.org](http://FeedValidator.org)说这是一个很好的提要。

如何让 PHP 的 XML 解析器解决此错误？

**编辑**：看起来他们正在根据用户代理将此提要重定向到另一个位置。我的 PHP 脚本没有得到正确的提要。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-30T18:33:29.833

代码对我有用，你一定是弄错了文字。

# java - 什么时候应该使用 final 作为方法参数和局部变量？

> ID：154314
> 
> 赞同：185
> 
> 时间：2008-09-30T18:25:04.330
> 
> 标签：java, final

我发现了一些建议尽可能多地使用的参考资料（[例如），我想知道这有多重要。](http://www.javapractices.com/topic/TopicAction.do?Id=23)`final`这主要是在方法参数和局部变量的上下文中，而不是最终方法或类。对于常量，这显然是有道理的。

一方面，编译器可以做一些优化，让程序员的意图更加清晰。另一方面，它增加了冗长，优化可能是微不足道的。

这是我应该努力记住的事情吗？

* * *

## 回答 #1

> 赞同：190
> 
> 时间：2008-09-30T19:14:50.687

沉迷于：

*   最终字段 - 将字段标记为最终字段会强制它们在构造结束时设置，从而使该字段引用不可变。这允许安全地发布字段，并且可以避免在以后读取时需要同步。（请注意，对于对象引用，只有字段引用是不可变的 - 对象引用所引用的内容仍然可以更改并且影响不可变性。）
*   最终静态字段 - 虽然我现在在许多我曾经使用静态最终字段的情况下使用枚举。

考虑但明智地使用：

*   最终类 - 框架/API 设计是我考虑的唯一情况。
*   最终方法 - 与最终类基本相同。如果您正在使用模板方法模式（例如疯狂并将内容标记为 final），那么您可能过于依赖继承而没有足够的委托。

除非感觉肛门，否则忽略：

*   方法参数和局部变量——我很少这样做，主要是因为我很懒，而且我发现它会使代码混乱。我完全承认我不会修改的标记参数和局部变量是“更正确的”。我希望它是默认值。但事实并非如此，而且我发现随着决赛的结束，代码更难理解。如果我在别人的代码中，我不会把它们拉出来，但如果我正在编写新代码，我不会把它们放进去。一个例外是你必须标记一些最终的东西以便你可以访问它来自匿名内部类。

*   [编辑：请注意， @adam-gent](https://stackoverflow.com/a/18856192/2750743)提到的最终局部变量实际上非常有用的一个用例是当值被分配给`if`/`else`分支中的 var 时。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-09-30T18:31:04.720

> 这是我应该努力记住去做的事情吗？

不，如果您使用的是 Eclipse，因为您可以配置保存操作来自动为您添加这些*最终*修饰符。然后，您会以更少的努力获得好处。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2013-09-17T17:28:28.833

我`final`一直在使用使 Java 更加基于表达式。请参阅 Java 的条件`if,else,switch`（

因此，在使用条件时，您应该尝试始终（恕我直言）使用最终变量。

让我给你举个例子：

```
 final String name;
    switch(pluginType) {
        case CANDIDATE_EXPORT:
            name = "Candidate Stuff";
            break;
        case JOB_POSTING_IMPORT:
            name = "Blah";
            break;
        default:
            throw new IllegalStateException();
    } 
```

现在如果添加另一个`case`语句并且不设置`name`编译器将失败。如果您没有在每种情况下都中断（您设置变量），编译器也会失败。这使您可以使 Java 与 Lisp 的表达式非常相似`let`，并使您的代码不会大量缩进（因为词法范围变量）。

正如@Recurse 指出的那样（但显然是-1 me），您可以执行上述操作而无需`String name` `final`获取编译器错误（我从未说过您不能），但是您可以轻松地使编译器错误在切换后消失设置名称语句丢弃了表达式语义或更糟的是忘记了`break`如果不使用就不能导致错误（尽管@Recurse 说）`final`：

```
 String name;
    switch(pluginType) {
        case CANDIDATE_EXPORT:
            name = "Candidate Stuff";
            //break; whoops forgot break.. 
            //this will cause a compile error for final ;P @Recurse
        case JOB_POSTING_IMPORT:
            name = "Blah";
            break;
    }
    // code, code, code
    // Below is not possible with final
    name = "Whoops bug"; 
```

由于错误设置名称（除了忘记`break`另一个错误之外）我现在可以不小心这样做：

```
 String name;
    switch(pluginType) {
        case CANDIDATE_EXPORT:
            name = "Candidate Stuff";
            break;
        //should have handled all the cases for pluginType
    }
    // code, code, code
    // Below is not possible with final
    name = "Whoops bug"; 
```

final 变量强制对应该是什么名称进行单一评估。类似于具有返回值的函数必须始终返回一个值（忽略异常），名称切换块将必须解析名称并因此绑定到该切换块，这使得重构代码块更容易（即 Ecipe 重构：提取方法） .

OCaml 中的上述内容：

```
type plugin = CandidateExport | JobPostingImport

let p = CandidateExport

let name = match p with
    | CandidateExport -> "Candidate Stuff"
    | JobPostingImport -> "Blah" ;; 
```

`match ... with ...`评估像一个函数，即表达式。注意它看起来像我们的 switch 语句。

这是 Scheme (Racket or Chicken) 中的一个示例：

```
(define name 
    (match b
      ['CandidateExport "Candidate Stuff"]
      ['JobPostingImport "Blah"])) 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-09-30T19:06:11.050

“最终”的开发时优势至少与运行时优势一样重要。它告诉未来的代码编辑者你的意图。

将类标记为“final”表明您在设计或实现类期间没有努力优雅地处理扩展。如果读者可以对类进行更改，并且想要删除“final”修饰符，他们可以自行承担风险。由他们来确保类能够很好地处理扩展。

将变量标记为“final”（并在构造函数中分配它）对于依赖注入很有用。它表明变量的“合作者”性质。

将方法标记为“final”在抽象类中很有用。它清楚地描绘了扩展点的位置。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-09-30T18:31:56.373

好吧，这一切都取决于你的风格......如果你喜欢在不修改变量的情况下看到最终结果，那么就使用它。如果您不喜欢看到它...然后将其排除在外。

我个人喜欢尽可能少的冗长，所以我倾向于避免使用不必要的额外关键字。

不过，我更喜欢动态语言，所以我喜欢避免冗长也就不足为奇了。

所以，我想说的是，选择你所倾向的方向并顺其自然（无论如何，尽量保持一致）。

* * *

作为旁注，我从事过使用和不使用这种模式的项目，并且我发现错误或错误的数量没有差异......我不认为这是一种模式会极大提高你的错误数量或任何东西，但它再次是风格，如果你喜欢表达你不会修改它的意图，那么继续使用它。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-10-01T01:41:39.927

我发现将方法参数和局部变量标记`final`为当所讨论的方法是几页长的难以理解的混乱时，它可用作重构辅助工具。随意洒`final`，看看编译器（或您的 IDE）抛出的“无法分配给最终变量”错误，您可能会发现为什么名为“数据”的变量最终为空，即使有几个（过时的）评论发誓可以不会发生。

然后，您可以通过用更接近使用点声明的新变量替换重用变量来修复一些错误。然后你发现你可以将方法的整个部分包裹在范围括号中，突然间你离“提取方法”只有一个 IDE 按键，你的怪物变得更容易理解了。

如果您的方法还不是*无法*维护的残骸，我想将东西定型可能会阻止人们将其变成所说的残骸；但如果它是一个简短的方法（请参阅：不是不可维护的），那么您可能会增加很多冗长。特别是，Java 函数签名很难容纳 80 个字符，因为每个参数不增加 6 个字符！

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-01T01:55:52.780

在参数中避免意外更改参数值并引入微妙的错误很有用。我过去常常忽略这个建议，但花了大约 4 小时后。以一种可怕的方法（数百行代码和多个 fors、嵌套 if 和各种不良做法）我建议你这样做。

```
 public int processSomethingCritical( final int x, final int y ){
 // hundreds of lines here 
     // for loop here...
         int x2 = 0;
        x++; // bug aarrgg...
 // hundreds of lines there
 // if( x == 0 ) { ...

 } 
```

当然，在一个完美的世界里，这不会发生，但是.. 好吧.. 有时你必须支持其他代码。:(

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-30T19:17:52.083

如果您正在编写一个应用程序，并且有人必须在 1 年后阅读代码，那么是的，在不应一直修改的变量上使用 final。通过这样做，您的代码将更加“自我记录”，并且您还可以减少其他开发人员做一些愚蠢的事情的机会，例如使用局部常量作为局部临时变量。

如果您正在编写一些一次性代码，那么，不，不要费心识别所有常量并使它们成为最终的。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-30T19:22:02.663

我会尽可能多地使用final。如果您无意中更改了字段，这样做会标记。我还将方法参数设置为 final。这样做时，当他们尝试“设置”忘记Java按值传递的参数时，我从我接管的代码中发现了几个错误。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-01T01:09:09.820

从问题中不清楚这是否明显，但是将方法参数设为 final 只会影响方法的主体。它不会**向**调用者传达有关方法意图的任何有趣信息。传入的对象仍然可以在方法内发生变异（final 不是 consts），并且变量的范围在方法内。

为了回答您的确切问题，我不会费心将实例或局部变量（包括方法参数）设为 final，除非代码需要它（例如，变量是从内部类引用的），或者澄清一些非常复杂的逻辑。

例如变量，如果它们在逻辑上是常量，我会将它们设为最终变量。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-06-21T06:40:29.140

变量有很多用途`final`。这里仅仅是少数

**最终常数**

```
 public static class CircleToolsBetter {
     public final static double PI = 3.141;
        public double getCircleArea(final double radius) {
          return (Math.pow(radius, 2) * PI);
        }
    } 
```

然后可以将其用于代码的其他部分，或由其他类访问，这样，如果您要更改值，则不必一一更改。

**最终变量**

```
public static String someMethod(final String environmentKey) {
    final String key = "env." + environmentKey;
    System.out.println("Key is: " + key);
    return (System.getProperty(key));

  }

} 
```

在此类中，您将构建一个作用域最终变量，该变量将前缀添加到参数 environmentKey。在这种情况下，最终变量仅在执行范围内是最终的，在方法的每次执行时都是不同的。每次输入方法时，都会重新构建最终的方法。一经构造，在方法执行范围内无法更改。这允许您在方法的持续时间内修复方法中的变量。见下文：

```
public class FinalVariables {

  public final static void main(final String[] args) {
    System.out.println("Note how the key variable is changed.");
    someMethod("JAVA_HOME");
    someMethod("ANT_HOME");
  }
} 
```

**最终常数**

```
public double equation2Better(final double inputValue) {
    final double K = 1.414;
    final double X = 45.0;

double result = (((Math.pow(inputValue, 3.0d) * K) + X) * M);
double powInputValue = 0;         
if (result > 360) {
  powInputValue = X * Math.sin(result); 
} else {
  inputValue = K * Math.sin(result);   // <= Compiler error   
} 
```

当您有很长的代码行时，这些特别有用，并且它会生成编译器错误，因此当有人意外更改不应更改的变量时，您不会遇到逻辑/业务错误。

**最终收藏**

当我们谈论集合时的不同情况，您需要将它们设置为不可修改的。

```
 public final static Set VALID_COLORS; 
    static {
      Set temp = new HashSet( );
      temp.add(Color.red);
      temp.add(Color.orange);
      temp.add(Color.yellow);
      temp.add(Color.green);
      temp.add(Color.blue);
      temp.add(Color.decode("#4B0082")); // indigo
      temp.add(Color.decode("#8A2BE2")); // violet
      VALID_COLORS = Collections.unmodifiableSet(temp);
    } 
```

否则，如果您不将其设置为不可修改：

```
Set colors = Rainbow.VALID_COLORS;
colors.add(Color.black); // <= logic error but allowed by compiler 
```

**最终类**和**最终方法**不能分别扩展或覆盖。

**编辑：解决有关封装的最后一类问题：**

有两种方法可以使班级决赛。第一种是在类声明中使用关键字final：

```
public final class SomeClass {
  //  . . . Class contents
} 
```

使类成为 final 的第二种方法是将其所有构造函数声明为私有：

```
public class SomeClass {
  public final static SOME_INSTANCE = new SomeClass(5);
  private SomeClass(final int value) {
  } 
```

如果发现它实际上是一个final，那么将它标记为final可以为您省去麻烦，以演示查看这个Test类。第一眼看上去很公开。

```
public class Test{
  private Test(Class beanClass, Class stopClass, int flags)
    throws Exception{
    //  . . . snip . . . 
  }
} 
```

不幸的是，由于该类的唯一构造函数是私有的，因此无法扩展该类。在 Test 类的情况下，没有理由认为该类应该是最终的。Test 类是隐式 final 类如何导致问题的一个很好的例子。

**因此，当您通过将构造函数设为私有来隐式地使类最终成为最终时，您应该将其标记为最终。**

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-30T18:38:05.750

正如您所提到的，这是一种权衡，但我更喜欢显式使用某些东西而不是隐式使用。这将有助于为未来的代码维护者消除一些歧义——即使只是你自己。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-30T18:45:50.177

如果您有内部（匿名）类，并且该方法需要访问包含方法的变量，则需要将该变量设置为 final。

除此之外，你说的是对的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-11-28T13:33:25.417

如果`final`您将该变量设为`immutable`

通过将变量声明为final，它可以帮助开发人员排除在高度多线程环境中可能出现的变量修改问题。

随着 java 8 的发布，我们多了一个概念，叫做“ ***`effectively final variable`***”。*非最终变量可以作为最终变量上升。*

***从 lambda 表达式引用的局部变量必须是 final 或有效 final***

> 如果在本地块中初始化后未修改变量，则该变量被视为***有效最终变量。***这意味着您现在可以在匿名类或 lambda 表达式中使用没有 final 关键字的局部变量，前提是它们必须是有效的 final。

***在 Java 7 之前，您不能在匿名类中使用非最终局部变量，但从 Java 8 开始，您可以***

看看这篇[文章](http://javarevisited.blogspot.in/2015/03/what-is-effectively-final-variable-of.html)

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2013-07-08T03:52:23.673

首先，final 关键字用于使变量成为常量。恒定意味着它不会改变。例如：

```
final int CM_PER_INCH = 2.54; 
```

您将声明变量 final 因为每英寸厘米不变。

如果您尝试覆盖最终值，则该变量就是它首先声明的内容。例如：

```
final String helloworld = "Hello World";
helloworld = "A String"; //helloworld still equals "Hello World" 
```

有一个编译错误，类似于：

```
local variable is accessed from inner class, must be declared final 
```

如果您的变量不能声明为 final 或者您不想将其声明为 final，请尝试以下操作：

```
final String[] helloworld = new String[1];
helloworld[0] = "Hello World!";
System.out.println(helloworld[0]);
helloworld[0] = "A String";
System.out.println(helloworld[0]); 
```

这将打印：

```
Hello World!
A String 
```

# asp.net - 如何将 XPS 文档流式传输到浏览器并将其嵌入网页中？

> ID：154318
> 
> 赞同：5
> 
> 时间：2008-09-30T18:25:39.117
> 
> 标签：asp.net, stream, binaryfiles, xpsdocument

我正在寻找一些关于如何解决这个问题的建议。任何输入表示赞赏！

目前，我有一个 ASP.NET MVC 应用程序。在客户端，我有一个带有 XPS 文档 ID 的链接。当用户单击该链接时，他们会被带到一个包含文档详细信息的页面。除了此信息之外，我希望在同一页面中显示此信息旁边的文档。

在服务器端，一旦我有了 ID，我就可以从数据库中获取文档，序列化为字节数组。问题是，将序列化文档放入网页的*最佳*方式是什么？

我非常希望不必将该文档放入文件系统中，然后将文件路径组合在一起。我希望能够将文档作为“application/vnd.ms-xpsdocument”的内容类型流式传输到浏览器。

我尝试使用 Web 控件来处理这个问题（不能写出二进制文件），考虑过创建一个 HTTP 处理程序来执行此操作（不知道从哪里开始），并且已经搞砸了其他几种获取文档的方法流到浏览器。

此外，还有如何在网页中嵌入文档的问题。我是否使用 EMBED 标签？还是一个对象？或者我是否使用 iframe 并将源设置为指向提供文档的任何内容？

再说一次，我不希望一个解决方案包在一个弓上。我正在寻找一些关于如何解决这个问题的建议。而且，虽然这个问题是关于 xps 文档的，但它适用于流式传输要在浏览器中托管的二进制文件（PDF 等）的任何应用程序。

* * *

好的，至于在浏览器中显示，一个字：Silverlight。这就解决了。我仍然有找出从服务器发送到浏览器的最佳方式的问题。

* * *

打那个。Silverlight 似乎还不够先进，无法显示 XPS 文档。我现在正在考虑一个指向 http 处理程序的 iframe ... iframe 有效。太糟糕了，它把整个事情都扔到了管道里。我想我总是可以撕掉第一页然后送那只小狗……

* * *

哇。不需要 HTTP 处理程序。MVC 中的自定义 ActionResult 就是您所需要的。这有多可怕？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T18:31:50.773

我认为最简单的方法是从详细信息页面提供文档作为链接 (target="_blank")。这有几个优点：

*   除非用户要求，否则您不需要检索和流式传输整个文档。
*   在我的系统上，至少 IE 已经注册为默认的 XPS 查看器，因此通过为文档提供它自己的窗口，您可以避免如何嵌入它的整个问题。
*   它使为文档提供流式源变得简单：只需使用带有 ID 的 HTTP 处理程序作为查询字符串参数。

即使您不喜欢这个想法，也一定要使用 HTTP 处理程序来传输文档。做起来真的很简单：当你在 Visual Studio 中创建一个新的 HTTP 处理程序时，它应该会给你一个漂亮的页面，所有的工作都已经完成了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-02T12:12:25.010

有一个 Silverlight 控件能够显示 XPS 文档。有关更多信息，请参见[http://firstfloorsoftware.com/blog/announcement-document-toolkit-for-silverlight/](http://firstfloorsoftware.com/blog/announcement-document-toolkit-for-silverlight/)

# mysql - 如何使用 mysqldump 在帐户之间复制视图？

> ID：154332
> 
> 赞同：20
> 
> 时间：2008-09-30T18:29:16.723
> 
> 标签：mysql, mysqldump

我正在使用**mysqldump**在特定机器上的帐户之间复制数据库。一切都很好，除了当我们到达我们定义的视图时。因为转储包含如下一行...

```
/*!50013 DEFINER=`user_a`@`localhost` SQL SECURITY DEFINER */ 
```

...当在 user_b 上将转储加载到 mysql 时，我们收到一个错误：

```
ERROR 1227 (42000) at line 657: Access denied; you need the SUPER privilege for this operation 
```

不用说，我对这个 mysql 实例没有超级权限。有没有办法说服**mysqldump**以与用户无关的方式转储视图？关于这一点，我在手册中找不到任何内容。我是否必须实际解析转储文件来替换用户名？还是我错过了什么？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-24T10:43:28.087

同样的问题。我是这样解决的：

```
mysqldump -uuser1 -ppassword1 database1 > backup.sql

sed '/^\/\*\!50013 DEFINER/d' backup.sql > backup_without_50013.sql

mysql -u user2 -ppassword2 -D database2 < backup_without_50013.sql 
```

有趣的是[sed](http://soft.zoneo.net/Linux/remove_comment_lines.php)命令，它在这里删除了所有以 /*!50013 开头的行。

海蒂

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-12-18T22:22:15.177

您将需要处理备份文件并更改 DEFINER：

定义者= `user_a`@`localhost`

我喜欢将其更改为：

DEFINER=CURRENT_USER

然后它将自动关联到加载它的帐户。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T19:28:41.103

SQL SECURITY 子句确定在检查视图的访问权限时使用哪个 MySQL 帐户（您可能已经知道了）。

创建视图时，您可以为该视图定义几个安全选项。[您可以在此处](http://dev.mysql.com/doc/refman/5.0/en/create-view.html)阅读更多内容，但基本上默认情况下，访问权限仅限于视图的“定义者”，即创建它的用户。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-17T19:24:56.613

`mysqldump`使用选项运行`"--skip-triggers"`

# ubuntu - SDL 的 ubuntu 问题

> ID：154348
> 
> 赞同：0
> 
> 时间：2008-09-30T18:32:21.817
> 
> 标签：ubuntu, audio, sdl, ubuntu-8.04

我正在尝试学习将 SDL 用于我正在编写的一个小游戏，但我遇到了一个问题。一个应用程序可以在给定时间在我的系统上播放声音。例如，如果我有 amarok 或 kaffeine（甚至在播放 flash 视频时使用 firefox），则没有其他应用程序可以播放声音。我发现的唯一解决方案是在给定时间只运行一个应用程序，但是，这似乎不是一个自然的解决方案。有什么提示吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T18:58:21.973

我从您的标签中看到您正在使用 Ubuntu Hardy Heron (8.04)。此版本下的脉冲音频存在一些音频问题，已知这些问题会影响 flash/firefox 以及您的其他应用程序。[请参阅https://wiki.ubuntu.com/PulseAudio](https://wiki.ubuntu.com/PulseAudio)上的“已知问题” 。

确实存在各种解决方法（请参阅链接），但它们并不是很令人满意。Ubuntu 因发布 8.04 而这个问题未解决而受到一定程度的批评。

# java - Hibernate.initialize() 和二级缓存

> ID：154352
> 
> 赞同：3
> 
> 时间：2008-09-30T18:33:13.750
> 
> 标签：java, hibernate, jpa

有谁知道 Hibernate`static initialize()`填充代理对象的方法是否会在进入数据库之前尝试访问二级缓存？我的代码似乎就是这样，我似乎在文档中找不到任何关于此的内容。Java 文档（像往常一样）是稀疏的。

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-04T01:13:17.510

确实如此。只要激活了二级缓存并且您的实体被声明为可缓存的，那么当没有显式查询时缓存优先。[您可以通过配置 org.hibernate.cache 记录器](http://docs.jboss.org/hibernate/core/4.0/manual/en-US/html/session-configuration.html#configuration-logging)来跟踪缓存查询/命中/未命中。

# c - 将 nmake makefile 转换为 Visual Studio 2005 项目

> ID：154364
> 
> 赞同：7
> 
> 时间：2008-09-30T18:35:45.163
> 
> 标签：c, visual-studio-2005, nmake

我们这里有一些用 nmake 构建的旧 C 代码。

有没有一种自动化的方式将 Makefile 拉入 Visual Studio 2005 并创建一个项目？在 MSDN 上的一些搜索表明[VS6](http://msdn.microsoft.com/en-us/library/aa269915(VS.60).aspx)可以做到这一点，但看起来 VS7/8 放弃了该功能。

如有必要，我可以使用 project.mak 文件作为参考从头开始构建项目，但对于更复杂的项目，这可能不可行。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T21:04:34.477

我一直积极参与公司的一个项目来做同样的事情。我发现我们的许多旧的基于 nmake 的项目有许多共同的设置。因此，我走上了创建[自定义项目向导](http://msdn.microsoft.com/en-us/library/90bsfska.aspx)的路线。

花了几天的时间才弄好它，但节省了很多时间。它还允许我们以一种对他们来说很容易的方式将其他开发人员带入重新编译的工作中，同时强制执行我们想要的许多编译器设置。

使用向导，重新编译的步骤看起来很像：

1.) 创建项目。

2.) 编译并删除*所有*错误和警告。

3.) 添加需要链接的库。

4.) 完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T18:47:16.227

这是[关于该主题的 VS 2005 文档](http://msdn.microsoft.com/en-us/library/txcwa2xx(VS.80).aspx)的链接。它还具有指向 VS 2003 和 2008 的链接，它们可能是相同的。

**编辑：**我只想对不会有太大变化的旧代码执行此操作，尤其是在编译和链接参数的方式上，因为手动编辑 make 文件是更改代码编译方式的唯一方法。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2008-09-30T18:38:37.557

这应该可以使用 Visual Studio 的 COM 接口来实现，但我无法为您提供任何详细信息。

# c++ - 在文本中搜索 25 000 个单词

> ID：154365
> 
> 赞同：17
> 
> 时间：2008-09-30T18:35:55.163
> 
> 标签：c++, full-text-search

我需要在文本中找到约 25 000 个单词的出现。为此目的最合适的算法/库是什么？

目标语言是 C++

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-30T18:47:29.813

> 我曾经使用过 Boyer-Moore 算法，它非常快。

Boyer-Moore 不适合有效地搜索许多单词。实际上有一种非常有效的算法可以做到这一点，称为 Wu-Manber 算法。我将发布一个参考实现。但是请注意，我前段时间这样做只是为了教育目的。因此，该实现并不适合直接使用，也可以提高效率。

它还使用`stdext::hash_map`来自 Dinkumware STL 的。替换为`std::tr1::unordered_map`或适当的实现。

在Knut Reinert 举办的柏林自由大学的讲座中，有一个[演讲稿](http://www.inf.fu-berlin.de/inst/ag-bio/FILES/ROOT/Teaching/Lectures/SS08//ssa/script-02-HorspoolWuManber.pdf)中对该算法的解释。

原始[论文](http://webglimpse.net/pubs/TR94-17.pdf)也在网上（刚刚又找到了），但我不是特别喜欢那里的伪代码。

```
#ifndef FINDER_HPP
#define FINDER_HPP

#include <string>

namespace thru { namespace matching {

class Finder {
public:
    virtual bool find() = 0;

    virtual std::size_t position() const = 0;

    virtual ~Finder() = 0;

protected:
    static size_t code_from_chr(char c) {
        return static_cast<size_t>(static_cast<unsigned char>(c));
    }
};

inline Finder::~Finder() { }

} } // namespace thru::matching

#endif // !defined(FINDER_HPP) 
```

* * *

```
#include <vector>
#include <hash_map>

#include "finder.hpp"

#ifndef WUMANBER_HPP
#define WUMANBER_HPP

namespace thru { namespace matching {

class WuManberFinder : public Finder {
public:

    WuManberFinder(std::string const& text, std::vector<std::string> const& patterns);

    bool find();

    std::size_t position() const;

    std::size_t pattern_index() const;

private:

    template <typename K, typename V>
    struct HashMap {
        typedef stdext::hash_map<K, V> Type;
    };

    typedef HashMap<std::string, std::size_t>::Type shift_type;
    typedef HashMap<std::string, std::vector<std::size_t> >::Type hash_type;

    std::string const& m_text;
    std::vector<std::string> const& m_patterns;
    shift_type m_shift;
    hash_type m_hash;
    std::size_t m_pos;
    std::size_t m_find_pos;
    std::size_t m_find_pattern_index;
    std::size_t m_lmin;
    std::size_t m_lmax;
    std::size_t m_B;
};

} } // namespace thru::matching

#endif // !defined(WUMANBER_HPP) 
```

* * *

```
#include <cmath>
#include <iostream>

#include "wumanber.hpp"

using namespace std;

namespace thru { namespace matching {

WuManberFinder::WuManberFinder(string const& text, vector<string> const& patterns)
    : m_text(text)
    , m_patterns(patterns)
    , m_shift()
    , m_hash()
    , m_pos()
    , m_find_pos(0)
    , m_find_pattern_index(0)
    , m_lmin(m_patterns[0].size())
    , m_lmax(m_patterns[0].size())
    , m_B()
{
    for (size_t i = 0; i < m_patterns.size(); ++i) {
        if (m_patterns[i].size() < m_lmin)
            m_lmin = m_patterns[i].size();
        else if (m_patterns[i].size() > m_lmax)
            m_lmax = m_patterns[i].size();
    }

    m_pos = m_lmin;
    m_B = static_cast<size_t>(ceil(log(2.0 * m_lmin * m_patterns.size()) / log(256.0)));

    for (size_t i = 0; i < m_patterns.size(); ++i)
        m_hash[m_patterns[i].substr(m_patterns[i].size() - m_B)].push_back(i);

    for (size_t i = 0; i < m_patterns.size(); ++i) {
        for (size_t j = 0; j < m_patterns[i].size() - m_B + 1; ++j) {
            string bgram = m_patterns[i].substr(j, m_B);
            size_t pos = m_patterns[i].size() - j - m_B;

            shift_type::iterator old = m_shift.find(bgram);
            if (old == m_shift.end())
                m_shift[bgram] = pos;
            else
                old->second = min(old->second, pos);
        }
    }
}

bool WuManberFinder::find() {
    while (m_pos <= m_text.size()) {
        string bgram = m_text.substr(m_pos - m_B, m_B);
        shift_type::iterator i = m_shift.find(bgram);
        if (i == m_shift.end())
            m_pos += m_lmin - m_B + 1;
        else {
            if (i->second == 0) {
                vector<size_t>& list = m_hash[bgram];
                // Verify all patterns in list against the text.
                ++m_pos;
                for (size_t j = 0; j < list.size(); ++j) {
                    string const& str = m_patterns[list[j]];
                    m_find_pos = m_pos - str.size() - 1;
                    size_t k = 0;

                    for (; k < str.size(); ++k)
                        if (str[k] != m_text[m_find_pos + k])
                            break;

                    if (k == str.size()) {
                        m_find_pattern_index = list[j];
                        return true;
                    }
                }
            }
            else
                m_pos += i->second;
        }
    }

    return false;
}

size_t WuManberFinder::position() const {
    return m_find_pos;
}

size_t WuManberFinder::pattern_index() const {
    return m_find_pattern_index;
}

} } // namespace thru::matching 
```

### 使用示例：

```
vector<string> patterns;
patterns.push_back("announce");
patterns.push_back("annual");
patterns.push_back("annually");

WuManberFinder wmf("CPM_annual_conference_announce", patterns);

while (wmf.find())
    cout << "Pattern \"" << patterns[wmf.pattern_index()] <<
        "\" found at position " << wmf.position() << endl; 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-30T18:39:09.633

用单词构建一个哈希表，并扫描文本，为单词表中的每个单词查找并填充所需的信息（增加计数，添加到位置列表等）。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-30T18:40:17.460

[布隆过滤器](http://en.wikipedia.org/wiki/Bloom_filter)可能是您最好的选择。你用你的搜索词初始化你的过滤器，然后在阅读你的语料库时可以快速检查每件作品是否在过滤器中。

它非常节省空间，比简单地散列每个单词要好得多：误报率为 1%，每个元素只需要 9.6 位。每个元素每增加 4.8 位，误报率就会降低 10 倍。将此与普通散列进行对比，后者通常需要每个元素 sizeof(int) == 32 位。

我在这里有一个 C# 实现：http: [//www.codeplex.com/bloomfilter](http://www.codeplex.com/bloomfilter)

这是一个示例，演示了它与字符串的使用：

```
int capacity = 2000000; // the number of items you expect to add to the filter
Filter<string> filter = new Filter<string>(capacity);
filter.Add("Lorem");
filter.Add("Ipsum");
if (filter.Contains("Lorem"))
    Console.WriteLine("Match!"); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-30T19:09:56.330

如果语料库这么大，尝试这样优化：

计算您需要检查的每个单词的哈希值，为每个字符分配一个整数素数，然后将每个数字相乘；将每个数字-> 单词存储在多重映射中（您需要在单个键上允许多个值）

在扫描单词列表时，以相同的方式计算每个单词的哈希值，然后获取与哈希图上的计算键关联的单词。使用整数作为键，您可以检索 O(1)；这样，如果处理后的单词在地图中有一些字谜（您将字符相乘），您就可以非常快速地找到它。

请记住：您在多重映射中存储了具有相同哈希的单词集合，因此您现在需要在这个大大减少的集合中找到匹配项。你需要这个额外的检查，因为地图上整数的简单存在并不等同于相关集合中单词的存在：我们在这里使用散列来减少问题的计算空间，但这会引入冲突，需要对每个已识别的字谜进行消歧义检查。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-01T18:03:56.340

使用[Aho-Corasick 算法](http://en.wikipedia.org/wiki/Aho-Corasick_algorithm)。它是为这个应用程序制作的。您只需阅读搜索文本中的每个字母一次。我最近实施并使用了它，效果很好。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-30T18:50:25.143

正如 Javier 所说，最简单的解决方案可能是哈希表。

在 C++ 中，这可以使用 STL 集来实现。首先将 25,000 个测试词添加到集合中，然后扫描文本中的每个单词，使用 set.find(current_word) 评估该单词是否在 25,000 个测试词中。

set.find 的对数速度很快，所以 25,000 个测试词不应该太大。该算法在文本中的单词数量上显然是线性的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-01T17:50:49.540

如果您要搜索的文本很大，那么可能值得进行一些预处理：将您的 25,000 个单词组合成一个 TRIE。

扫描到文本中第一个单词的开头，并在遍历单词的字母时开始走 TRIE。如果您的 TRIE 中没有转换，请跳到下一个单词的开头并返回到 TRIE 的根。如果您到达单词的结尾，并且您位于 TRIE 中的单词结尾节点，则您找到了匹配项。对文本中的每个单词重复。

如果您的文本只是很大（而不是很大），那么只需在哈希表中查找每个单词就足够了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T18:43:55.330

副伯格 说：

> 我曾经使用过 Boyer-Moore 算法，它非常快。

使用 Boyer-Moore，您通常不是在文本块中搜索**单个**字符串吗？

对于一个简单的实现解决方案，请使用 Javier 建议的哈希表方法。FatCat1111 建议的布隆过滤器也应该可以工作......取决于目标。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T18:51:08.417

可能将您的初始字典（25000 个单词）存储在磁盘上的 berkeley db 哈希表中，您可能可以直接从 c/c++ 使用（我知道您可以从 perl 中使用），对于文本中的每个单词，查询如果它存在于数据库中。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-30T20:16:43.937

您还可以按字母顺序对文本和单词列表进行排序。当您有两个排序数组时，您可以轻松地在线性时间内找到匹配项。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-30T22:45:12.520

你想要一个[三元搜索树](http://en.wikipedia.org/wiki/Ternary_search_tree)。一个好的实现可以在[这里](http://www.cs.princeton.edu/~rs/strings/)找到。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-11-10T21:35:22.983

Aho-Corasick 算法是专门为此目的而构建的：一次搜索多个单词。

# database - 代表夏令时规则的最佳方式是什么？

> ID：154369
> 
> 赞同：6
> 
> 时间：2008-09-30T18:36:57.577
> 
> 标签：database, time, schema, datetime

我需要将世界不同地区的夏令时（夏令时）转换规则存储在数据库中。我已经有了一种存储区域和子区域的方法（因此整个[“澳大利亚的一半”/亚利桑那/纳瓦霍](http://en.wikipedia.org/wiki/Image:DaylightSaving-World-Subdivisions.png)问题都得到了解决），但我想知道实现这一目标的最有效模式是什么。我看到的两个选项：

*   有一个表格，其中包含每年和地区的唯一一行，给出夏季时间的开始和结束时间以及特定的偏移量
*   有一个表格，其中存储每个地区的公式和有效日期范围（以色列等地区所需的有效范围）

第一个的优点是灵活性，因为实际上*一切皆有*可能。不幸的是，它还需要 (a) 更多空间，并且相应地 (b) 需要大量工作来获取数据输入。第二个很好，因为一行可以对应一个区域几十年，但它也需要应用层中的某种语言解析器和解释器。由于这个数据库将被几个用没有强大文本处理能力的语言编写的不同应用程序使用，我宁愿避免这条路线。

我很想只使用 zoneinfo 或类似的东西，但不幸的是，在这种情况下这不是一个选项。同样，我无法标准化数据库中*必须*存在的日期、时区和夏令时信息以满足某些用例。

有没有人有做类似事情的经验？同样，有没有人有任何我可能错过的绝妙选择？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-30T18:42:28.923

你几乎注定要第一个选择。对于那些对时间变化有“规则”的国家，您可以根据需要预先生成日期，但有些地区没有任何规则，并且这些变化是通过独裁法令或每年通过立法投票制定的（巴西这样做直到今年）。

这就是所有操作系统供应商每年推出一到两次时区文件更改的原因——他们必须这样做，因为他们无法以编程方式生成 100% 准确的文件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T18:45:24.797

如果 DST 规则必须在数据库中，我可能会选择从外部权威来源（图书馆、网站等）自动更新它们。手动维护 DST 规则听起来并不有趣。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-03T02:37:47.390

有关时区规则的最佳信息来源之一是 Olson 数据库，该数据库可从[elsie.nci.nih.gov 获得](ftp://elsie.nci.nih.gov/pub/)。2008 年 9 月，当前版本的数据是 tzdata2008f.tar.gz，当前版本的代码是 tzcode2008e.tar.gz（是的，在数据​​发布的时候代码并不总是发布）。这往往是许多其他系统的信息来源（尤其包括 Oracle 信息）。还有一个可用的邮件列表。如您所见，2008 年至今已有六个版本的数据；我的机器上潜伏着 2005r、2006l、2007k 的副本，因此情况可能会经常发生变化。

如今（2017 年 3 月），Olson 数据库可从 IANA 获得 — 参见[https://iana.org/time-zones](https://iana.org/time-zones)和[ftp://ftp.iana.org/tz](ftp://ftp.iana.org/tz)（尤其是[ftp://ftp.iana.org/ tz/发布](ftp://ftp.iana.org/tz/releases)）。

还有 Common Locale Data Repository [CLDR](http://www.unicode.org/cldr/)，其中也包含有关时区的信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T10:02:17.097

Oracle DBMS 会自动为您处理这个问题。日期以内部表示形式存储（为了参数，让我们想象一下 UMT），并在转换为字符串时根据时区规则进行格式化。

这也解决了随着时间的推移在变化期间应该做什么的争论。IE 当您将时钟拨回 1/2 小时时，同一天实际上有 2 个 3:25 am 实例。

# activerecord - 使用活动记录时如何列出为数据库定义的所有表？

> ID：154372
> 
> 赞同：131
> 
> 时间：2008-09-30T18:37:02.350
> 
> 标签：activerecord

使用活动记录时，如何获取为数据库定义的所有表的列表？

* * *

## 回答 #1

> 赞同：270
> 
> 时间：2008-10-01T00:34:18.077

打电话[`ActiveRecord::ConnectionAdapters::SchemaStatements#tables`](http://github.com/rails/rails/tree/master/activerecord/lib/active_record/connection_adapters/abstract/schema_statements.rb#L21)。此方法在 MySQL 适配器中未记录，但在 PostgreSQL 适配器中记录。SQLite/SQLite3 也实现了该方法，但未记录。

```
>> ActiveRecord::Base.connection.tables
=> ["accounts", "assets", ...] 
```

请参阅[`activerecord/lib/active_record/connection_adapters/abstract/schema_statements.rb:21`](http://github.com/rails/rails/tree/master/activerecord/lib/active_record/connection_adapters/abstract/schema_statements.rb#L21)以及此处的实现：

*   [`activerecord/lib/active_record/connection_adapters/mysql_adapter.rb:412`](http://github.com/rails/rails/tree/master/activerecord/lib/active_record/connection_adapters/mysql_adapter.rb#L412)
*   [`activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb:615`](http://github.com/rails/rails/tree/master/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb#L615)
*   [`activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb:176`](http://github.com/rails/rails/tree/master/activerecord/lib/active_record/connection_adapters/sqlite_adapter.rb#L176)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2013-01-11T11:00:44.680

根据前两个答案，您可以这样做：

```
ActiveRecord::Base.connection.tables.each do |table|
  next if table.match(/\Aschema_migrations\Z/)
  klass = table.singularize.camelize.constantize      
  puts "#{klass.name} has #{klass.count} records"
end 
```

列出每个抽象表的模型以及记录数。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2018-06-22T15:00:19.757

> **Rails 5.2**的更新

 **对于 Rails 5.2，您还可以使用`ApplicationRecord`来获取`Array`表名。只是，正如imechemi 所提到的，请注意，此方法也将返回**`ar_internal_metadata`**并且**`schema_migrations`**在该数组中。

```
ApplicationRecord.connection.tables 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T23:07:38.770

似乎应该有更好的方法，但这是我解决问题的方法：

```
Dir["app/models/*.rb"].each do |file_path|
  require file_path # Make sure that the model has been loaded.

  basename  = File.basename(file_path, File.extname(file_path))
  clazz     = basename.camelize.constantize

  clazz.find(:all).each do |rec|
    # Important code here...
  end
end 
```

此代码假定您遵循类和源代码文件的标准模型命名约定。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T18:57:38.433

不知道活动记录，但这里有一个简单的查询：

从 INFORMATION_SCHEMA.Tables 中选择 table_name，其中 TABLE_TYPE = 'BASE TABLE'

# asp.net - ASP.NET 图像列表框

> ID：154382
> 
> 赞同：0
> 
> 时间：2008-09-30T18:40:26.307
> 
> 标签：asp.net, image, combobox, listbox, obout

我想显示供用户选择的图像列表（而不是文本）。该控件是数据绑定的（URL 来自数据库） 而不是列表框中典型的垂直滚动条，我希望这个框是水平的。我正在寻找与此类似的 ASP.NET 服务器控件：http: [//www.infragistics.com/dotnet/netadvantage/aspnet/webimageviewer.aspx#Overview](http://www.infragistics.com/dotnet/netadvantage/aspnet/webimageviewer.aspx#Overview)

我考虑了所有的答案，最后决定使用 obout.com 的 ComboBox，它也可以显示图像。

谢谢尚卡尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T18:45:55.373

如果您对 ajax 和/或 jQuery 有经验，您可以查看 jQuery SliderGallery 控件。

[http://ui.jquery.com/repository/real-world/product-slider/](http://ui.jquery.com/repository/real-world/product-slider/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T18:49:59.357

我只是把它们放在一个 div (asp:panel?) 中，它的样式具有特定的高度和宽度并水平溢出。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T18:53:17.820

除非我遗漏了什么，否则这对我来说似乎是一个非常简单的问题。只需创建一个[可滚动的 DIV](http://www.divitodesign.com/2007/12/css-how-to-use-overflow/)来托管所有图像。

# winforms - 如何绘制delphi组框以具有透明背景

> ID：154387
> 
> 赞同：3
> 
> 时间：2008-09-30T18:43:02.790
> 
> 标签：winforms, delphi, transparency, vcl

我试图让一些非常微妙的东西起作用，它现在看起来很糟糕。我正在尝试绘制 TGroupBox 的背景，我已经重载了它的绘制函数，以便角落显示到它们的父对象。我有一堆嵌套的组合框，如果没有 XPThemes，它们看起来很不错。

有没有办法在运行时绘制透明背景的一部分。我正在编写表单生成器，而不是使用 Delphi 设计视图。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T20:21:54.860

当我遇到这样的情况时，我最初使用 TGroupBox，但后来决定使用 TPaintBox（在本示例中称为 pb）并模拟 TGroupBox 的图形部分。

```
procedure TfraNewRTMDisplay.pbPaint(Sender: TObject);
const
  icMarginPixels=0;
  icCornerElipsisDiameterPixels=10;
begin
  pb.Canvas.Pen.Color:=clDkGray;
  pb.Canvas.Pen.Width:=1;
  pb.Canvas.Pen.Style:=psSolid;
  pb.Canvas.Brush.Color:=m_iDisplayColor;
  pb.Canvas.Brush.Style:=bsSolid;
  pb.Canvas.RoundRect(icMarginPixels,
                      icMarginPixels,
                      pb.Width-icMarginPixels*2,
                      pb.Height-icMarginPixels*2,
                      icCornerElipsisDiameterPixels,
                      icCornerElipsisDiameterPixels);
end; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T19:02:02.167

我正在尝试通过以下步骤复制此问题：

1 - 将主题设置为 Windows XP 默认

2 - 将 TGroupBox 拖放到空表单上 (align = alNone)

3 - 将两个 TGroupBoxes 放在第一个内，其中 align = alBottom 和 align = alClient

但在视觉上它看起来对我来说还不错。

你能提供更多关于你是如何设计表格的信息吗？从 .DFM 粘贴的一些代码就可以了。

这是我的 DFM 的相关部分：

```
 object GroupBox1: TGroupBox
    Left = 64
    Top = 56
    Width = 481
    Height = 361
    Margins.Left = 10
    Caption = 'GroupBox1'
    ParentBackground = False
    TabOrder = 0
    object GroupBox2: TGroupBox
      Left = 2
      Top = 254
      Width = 477
      Height = 105
      Align = alBottom
      Caption = 'GroupBox2'
      TabOrder = 0
    end
    object GroupBox3: TGroupBox
      Left = 2
      Top = 15
      Width = 477
      Height = 239
      Align = alClient
      Caption = 'GroupBox3'
      TabOrder = 1
    end
  end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T14:21:36.177

哈，那很蹩脚，我只需要不设置`ParentBackground := false`我的构造函数并在适当的时候绘制组框的内部。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T15:50:35.307

> 哈，那太蹩脚了，我只需要在我的构造函数中不设置 ParentBackground := false 并在适当的时候绘制组框的内部。

也许有些事情我不知道，但在我最近的经验中，它并不像听起来那么简单，因为主题和确切地知道要画什么区域。甚至 TCanvas.FloodFill 也不能可靠地完成这项工作，可能是因为有时操作系统不需要重新绘制所有内容。

# .net - .NET Framework 平台支持传统

> ID：154396
> 
> 赞同：2
> 
> 时间：2008-09-30T18:44:33.113
> 
> 标签：.net, .net-3.5, compatibility

从 .NET 框架问世的第一天起，就有最低限度的操作系统支持：

*   .NET 1.0 - Windows NT 或更高版本（也支持 Windows 98/ME）
*   .NET 2.0 - Windows 2000 或更高版本（也支持 Windows 98/ME）
*   .NET 3.0 - Windows XP 或更高版本
*   .NET 3.5 - Windows XP 或更高版本

这种最低限度的操作系统支持可以通过仅使用框架来忽略特定于平台的问题。较旧的平台上忽略了较新的功能。例如，ListView 控件中的“平铺视图”样式或 Windows 98/ME 上的窗体透明度。

但是，在 System.Core.dll（.NET 3.5 的一部分）中，有一些类使用新的 Vista API，如果在 XP 机器上使用，则会抛出 PlatformNotSupportedException。例如，看看新的 EventLogReader 类（在 System.Diagnostics.Eventing.Reader 命名空间中）。

微软是否打破了平台支持的传统？

公平地说，.NET 2.0 已经有支持 NTFS 安全特性的类，这些在 Windows 98/ME 上不可用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T18:49:15.550

最低操作系统支持意味着该产品已在特定平台及更高版本上进行了测试。它不保证所有功能（或在像 .Net 这样的开发平台的情况下的类/API）都可以在所有受支持的平台上运行。

XP 中不存在特定于 Vista 的原生 API。.Net 3.5 为这些 API 添加了对托管世界的支持，但它不会尝试为 XP 上不存在的本机 API 提供托管实现。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T18:54:11.560

我可以用经验告诉你，.NET 从未真正在 Windows 98 或 ME 上运行过。我记得在 2002 年 1.0 版是新版本时，我和一些同事发现，任何比带有一些按钮和死的简单功能的 WinForm 更复杂的东西都不会在 Windows 9x 上运行，尽管微软声称相反。鉴于我们已经使用 XP 一年了，并且我们可以合理地期待 Windows 2000 至少在我们当时处理的机器上，这没什么大不了的。

但基本上微软忽略了带有 .NET 的旧版本的 Windows 并不是什么新鲜事。至少这些天他们正在抛出 PlatformNotSupportedException 异常。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T18:54:32.450

微软显然正在推动以 Vista 为中心的开发环境。这不仅仅是因为显而易见的“我们需要赚钱”的原因，还因为 Vista 是酷炫的新 API 萌芽的地方。

公平地说，Windows API 一直都是这样，.NET 可能也会这样。没有您所描述的“传统”，而是使可能无法工作的 API 通知您您处于不支持它的操作系统中的传统。他们总是试图*向后*兼容，而不是*向前*限制，如果你理解的话:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T18:50:05.347

平台支持总是因类型而异。例如，Compact Framework 不支持许多类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T19:04:51.537

我不能说全部，但我知道，例如，Vista 中的事件日志系统已经过[彻底改造](http://en.wikipedia.org/wiki/Event_Viewer)，与 Windows XP 中的事件日志系统几乎没有任何相似之处。它可能只是字面上不兼容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-27T00:38:01.413

这里的问题是**System.Diagnostics.Eventing**在 AppFabric（即 Windows Azure）中使用，因此您基本上要进行一场艰苦的战斗，让 Windows XP 与云通信。

# php - 用于生成 Phing 构建文件的用户界面？

> ID：154402
> 
> 赞同：1
> 
> 时间：2008-09-30T18:45:38.180
> 
> 标签：php, integration, phing, continuous

我想使用[Phing](http://www.phing.info/trac/)作为构建工具，我想知道是否有任何（Web）界面来生成构建文件。

任何关于手写的替代方法的建议也将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T13:51:40.703

有几个用于 ANT 构建文件的 GUI 编辑器，这是 Phing 所基于的。

一个快速的谷歌发现了这个。 [http://antsnest.sourceforge.net/](http://antsnest.sourceforge.net/)

诸如 eclipse 之类的 IDE 也有用于编辑 ant 构建文件的插件，并且应该可以与 phing 一起使用。

不过，这些都不是基于网络的，抱歉。

# vba - Visio VBA 函数查看形状前面/后面是否有形状

> ID：154408
> 
> 赞同：4
> 
> 时间：2008-09-30T18:47:23.730
> 
> 标签：vba, visio, shapes

Visio VBA 中有没有办法查看 Visio 中的形状前面或后面是否有形状？

我想我可以写一些东西来检查页面中每个形状的边界框，看看它是否占据了与我的形状相同的空间。我宁愿使用内置的东西，因为随着绘图的形状越来越多，检查每个形状可能需要很长时间。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T20:30:03.657

Shape.SpatialRelation 属性将告诉您两个形状是否接触。Shape.Index 属性将告诉您在 z 顺序中哪个在前面或后面。

这是一个简单的例子：

```
Public Sub DoShapesIntersect(ByRef shape1 As Visio.Shape, ByRef shape2 As Visio.Shape)

    '// do they touch?
    If (shape1.SpatialRelation(shape2, 0, 0) <> 0) Then

        '// they touch, which one is in front?
        If (shape1.Index > shape2.Index) Then
            Debug.Print shape1.Name + " is in front of " + shape2.Name
        Else
            Debug.Print shape1.Name + " is behind " + shape2.Name
        End If
    Else
        Debug.Print "shape1 and shape2 do not touch"
    End If

End Sub 
```

在这里阅读更多：

[MSDN 上的 Shape.SpatialRelation 属性](http://msdn.microsoft.com/en-us/library/ms367944.aspx)

# tfs - 如何让 Team Build 运行 MbUnit 测试？

> ID：154411
> 
> 赞同：0
> 
> 时间：2008-09-30T18:47:30.767
> 
> 标签：tfs, msbuild, mbunit, tfsbuild

我无法让 Team Build 执行我的 MbUnit 单元测试。我尝试编辑 TFSBuild.proj 并添加了以下部分：

```
<Project ...>
  <UsingTask TaskName="MbUnit.MSBuild.Tasks.MbUnit" AssemblyFile="path_to_MbUnit.MSBuild.Tasks.dll" />
  ...
  ...
  <ItemGroup>
    <TestAssemblies Include="$(OutDir)\Project1.dll" />
    <TestAssemblies Include="$(OutDir)\Project2.dll" />
  </ItemGroup>
  <Target Name="Tests">
    <MbUnit
      Assemblies="@(TestAssemblies)"
      ReportTypes="html"
      ReportFileNameFormat="buildreport{0}{1}"
      ReportOutputDirectory="." />
  </Target>
  ...
</Project> 
```

但我还没有让测试运行。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T11:06:38.400

上面的建议对我没有多大帮助，但我找到了一些 Team Build 的文档并调整了我的构建脚本以覆盖 AfterCompile 目标：

*（编辑：现在我对 Team Build 有了更好的了解，我向测试运行器添加了更多内容。它现在将使用构建步骤更新构建资源管理器/构建监视器，其中包含有关测试运行的详细信息）*

```
<Project ...>
  <UsingTask TaskName="MbUnit.MSBuild.Tasks.MbUnit" AssemblyFile="path_to_MbUnit.MSBuild.Tasks.dll" />
  ...
  ...
  <Target Name="AfterCompile">
    <ItemGroup>
      <TestAssemblies Include="$(OutDir)\Project1.dll" />
      <TestAssemblies Include="$(OutDir)\Project2.dll" />
    </ItemGroup>

    <BuildStep
      TeamFoundationServerUrl="$(TeamFoundationServerUrl)"
      BuildUri="$(BuildUri)"
      Message="Running tests (cross your fingers)...">
      <Output TaskParameter="Id" PropertyName="StepId" />
    </BuildStep>

    <MbUnit
      Assemblies="@(TestAssemblies)"
      ReportTypes="html"
      ReportFileNameFormat="buildreport{0}{1}"
      ReportOutputDirectory="." />

    <BuildStep
      TeamFoundationServerUrl="$(TeamFoundationServerUrl)"
      BuildUri="$(BuildUri)"
      Id="$(StepId)"
      Message="Yay! All tests succeded!"
      Status="Succeeded" />
    <OnError ExecuteTargets="MarkBuildStepAsFailed" />
  </Target>

  <Target Name="MarkBuildStepAsFailed">
    <BuildStep
      TeamFoundationServerUrl="$(TeamFoundationServerUrl)"
      BuildUri="$(BuildUri)"
      Id="$(StepId)"
      Message="Oh no! Some tests have failed. See test report in drop folder for details."
      Status="Failed" />
  </Target>
  ...
</Project> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-02T01:17:30.187

您无需再次调用 MSBuild 即可填充您的 ItemGroup，有一种更简单的方法。重新调用 MSBuild 有其缺点，例如传递所有 Teambuild 参数以使 TeamBuild 任务正常工作。我们使用 MSBuild 中的 CreateItem 任务来动态生成带有我们所有测试 DLL 的 ItemGroup：

```
<Target Name="AfterCompile">
<CreateItem Include="$(OutDir)\*.Test.dll">
           <Output
               TaskParameter="Include"
               ItemName="TestBinaries"/>
</CreateItem>
</Target><!--Test run happens in a later target in our case, we use MSTest --> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T20:14:17.173

MSBuild 中的 ItemGroup 的工作方式是在运行任何目标之前，在 MSBuild 脚本的一开始就对它们进行评估。因此，如果程序集尚不存在（它们不会存在，因为它们尚未构建），则 ItemGroups 将找不到任何文件。

MSBuild 中解决此问题的常用模式是此时再次重新调用 MSBuild，以便在内部 MSBuild 执行中评估项组时，程序集将存在。

例如，类似：

```
 <PropertyGroup>
    <TestDependsOn>
      $(TestDependsOn);
      CallMbUnitTests;
    </TestDependsOn>
  </PropertyGroup>

  <Target Name="CallMbUnitTests">
    <MSBuild Projects="$(MSBuildProjectFile)"
             Properties="BuildAgentName=$(BuildAgentName);BuildAgentUri=$(BuildAgentUri);BuildDefinitionName=$(BuildDefinitionName);BuildDefinitionUri=$(BuildDefinitionUri);
                         BuildDirectory=$(BuildDirectory);BuildNumber=$(BuildNumber);CompilationStatus=$(CompilationStatus);CompilationSuccess=$(CompilationSuccess);
                         ConfigurationFolderUri=$(ConfigurationFolderUri);DropLocation=$(DropLocation);
                         FullLabelName=$(FullLabelName);LastChangedBy=$(LastChangedBy);LastChangedOn=$(LastChangedOn);LogLocation=$(LogLocation);
                         MachineName=$(MachineName);MaxProcesses=$(MaxProcesses);Port=$(Port);Quality=$(Quality);Reason=$(Reason);RequestedBy=$(RequestedBy);RequestedFor=$(RequestedFor);
                         SourceGetVersion=$(SourceGetVersion);StartTime=$(StartTime);Status=$(Status);TeamProject=$(TeamProject);TestStatus=$(TestStatus);
                         TestSuccess=$(TestSuccess);WorkspaceName=$(WorkspaceName);WorkspaceOwner=$(WorkspaceOwner);
                         SolutionRoot=$(SolutionRoot);BinariesRoot=$(BinariesRoot);TestResultsRoot=$(TestResultsRoot)"
             Targets="RunMbUnitTests"/>
  </Target>

  <ItemGroup>
    <TestAssemblies Include="$(OutDir)\Project1.dll" />
    <TestAssemblies Include="$(OutDir)\Project2.dll" />
  </ItemGroup>
  <Target Name="RunMbUnitTests">
    <MbUnit
      Assemblies="@(TestAssemblies)"
      ReportTypes="html"
      ReportFileNameFormat="buildreport{0}{1}"
      ReportOutputDirectory="." />
  </Target> 
```

希望有帮助，祝你好运。

马丁。

# audio - 个人 DirecShow 在音频渲染上的优点

> ID：154412
> 
> 赞同：0
> 
> 时间：2008-09-30T18:48:49.563
> 
> 标签：audio, directshow

我的电脑有两个外部声卡和一个在带有 windows vista 的主板上。在 Vista 中，它看到同一个声卡的两个实体，一个数字输出和一个模拟输出。

当我尝试播放带有数字音频的视频文件（例如 dvd）时，它选择*“默认 DirectSound”*，而我希望它使用“*数字输出 Auzentech* ”。所以我想很容易，我只是将“数字输出 Auzentech”的优点更改为高于其他值的值，因此当应用程序尝试构建播放图时会选择它。

我遇到的问题是所有音频实体都具有相同的 ID，因此通过更改“数字输出 Auzentech”，“默认直接声音”获得相同的优点。我相信已经在 google-dry 上搜索过有关优点、directshow 和 audiorenders 的信息，但仍然没有找到答案。

也许在这里闲逛的一些聪明人可以帮助我

（我使用的工具是 Vista Ultimate 32 位上的 GSpot 和 GraphEdit）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T14:02:43.580

为什么要修补 directshow 过滤器的“优点”？会不会有点矫枉过正。您的视频文件中是否包含数字音频，您可以在此处使用任何输出设备。因此，您甚至可以将“数字输出 Auzentech”用于系统上的所有音频，而不仅仅是用于 dvd。

如果您只想为特定应用程序选择“数字输出 Auzentech”，那么我相信大多数体面的应用程序都能让您做到这一点。如果你想做并覆盖所有应用程序（不是应用程序设置，而是 Windows 的默认设置），然后前往控制面板下的“声音和音频设备”（这是针对 xp，vista 有类似的东西，但我可以'不记得它的名字），在音频选项卡下，将您的声音播放默认设备更改为“数字输出 Auzentech”，就是这样。然后你的所有音频都将从它输出。

我个人使用 Media Player Classic，如果我在电影中有 AC3 或 ACC 音轨，并且更喜欢享受全数字输出，我可以轻松地从 Sound Filter 设置切换。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T17:20:42.713

谢谢回复 有问题

有点因为我懒。我的声卡通过光缆连接到 hifi 设置，当我观看 dvd、带有 DTS og DD 音轨的电影文件时，我希望它自动切换到数字源，这样我就可以启用 SPDIF。这是因为新的受保护媒体路径和 vista 中的其他内容，这使得这变得更加困难，因为在过去 (winxp) 中，它会以“正确”的方式执行 DTS Connect 和 SPDIF，而无需我自动更改默认音频输出设备。另一件事是我使用 windows 媒体中心和 windows 媒体播放器，因为我发现它们是媒体播放的最佳应用程序。

通过您建议将数字输出设置为默认值的解决方案，我的电脑将在游戏、音乐等中输出 PCM，而当有数字音轨时，spdif 功能将起作用。但是我在玩游戏时不想要 PCM 立体声，我想要 5.1 声音，许多游戏都提供 DTS 编码，所以我不需要在我的放大器上切换音频通道，也不需要在 Windows 设置中切换。我知道许多其他人有同样的问题，当他们切换到 vista 时，有些人或多或少地接受了解决方案，通过手动切换，但我拒绝:)

我想到如果我可以将诸如 PCM 音频渲染之类的优点设置更改为数字输出而不是默认的直接声音输出，我的自动切换问题将得到解决，因此对于 PCM 音频，我的音频渲染将受到青睐.

并且通过使用我的解决方案，所有 Directshow 应用程序，比如 Itunes，（在这里很勉强）powerdvd、itunes、mpc 等，如果它们没有实现或覆盖评价系统，它们将使用我的设置。

除了设置音频渲染的优点之外，我还没有找到任何其他更有可能的解决方案，不幸的是我无法正常工作。欢迎任何其他建议，我愿意尝试，但是我不太可能更改 MCE 或 WMP 的默认用法。我已经尝试过其他球员，但我不喜欢他们中的大多数。

# jquery - JQuery Datepicker 返回 Date 对象类型

> ID：154427
> 
> 赞同：4
> 
> 时间：2008-09-30T18:52:47.400
> 
> 标签：jquery, datepicker

Datepicker 返回的对象类型是什么？假设我有以下内容：

```
$("#txtbox").datepicker({
   onClose: function(date){
          //something
       }
}); 
```

是什么`date`？我有兴趣从另一个 Datepicker 读取日期对象以进行比较，例如：

```
 function(date){
       oDate = $("#oDP").datepicker("getDate");
       if(oDate == date)
          //do one
       else if(oDate > date)
          //do two
   } 
```

但是，这种比较是行不通的。我猜 Date 对象有某种比较方法，但我不知道。我还尝试比较日期的字符串表示，`oDate.toString() > date.toString()`但无济于事。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-24T16:58:06.443

我刚刚从[这里](http://www.kelvinluck.com/assets/jquery/datePicker/v2/demo/scripts/jquery.datePicker.js)下载了源代码并注意到（例如第 600 行）作者正在使用 .getTime() 来比较日期，你试过吗？

```
if (oDate.getTime() > date.getTime()) {
    ...
} 
```

这也是切线的，但您提到您尝试了 oDate.toString() 而我在[示例](http://www.kelvinluck.com/assets/jquery/datePicker/v2/demo/datePickerDefaultToday.html)中注意到作者正在使用 .asString()

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T12:54:31.370

`Date`对象由`datePicker`.

您比较日期的方法是有效的 - 来自[W3schools](http://www.w3schools.com/js/js_obj_date.asp)：

```
var myDate=new Date();
myDate.setFullYear(2010,0,14);
var today = new Date();

if (myDate>today)
{
    alert("Today is before 14th January 2010");
} 
```

`oDate`您是否从这条线上获得了价值？

```
oDate = $("#oDP").datepicker("getDate"); 
```

您的比较方法似乎有效 - 所以我想知道是否`datePicker`成功从中提取值`#oDP`？

**编辑**-`oDate`确认包含有效日期。这可能是一个非常愚蠢的问题，但您是否确认`date`包含有效日期？我想知道将其命名为与关键字`Date`（[Javascript关键字和保留字](http://www.quackit.com/javascript/javascript_reserved_words.cfm)）相同是否可能存在问题。也许尝试在您的函数中将其重命名为`tDate`或类似名称，以确保双重清楚这不会导致您的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-19T16:15:37.213

使用它来比较日期，它可以工作： $("#datepickerfrom").datepicker("getDate") < $("#datepickerto").datepicker("getDate")

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-09-30T18:57:32.240

> 什么是日期？

它是 $("#txtbox") 对象

# c# - 使用 .Net 持久存储加密数据

> ID：154430
> 
> 赞同：19
> 
> 时间：2008-09-30T18:53:59.283
> 
> 标签：c#, encryption, dns, roaming

我需要在应用程序运行之间存储加密数据（几个小字符串）。我不希望用户每次启动应用程序时都提供密码。即，毕竟它归结为安全地存储加密密钥。

我正在研究 RSACryptoServiceProvider 并使用 PersistentKeyInCsp，但我不确定它是如何工作的。密钥容器在应用程序运行或机器重启之间是否持久存在？如果是，它是特定于用户的，还是特定于机器的。即，如果我将加密数据存储在用户的漫游配置文件中，如果用户登录另一台机器，我可以解密数据吗？

如果上述方法不起作用，我有什么选择（我需要处理漫游配置文件）。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-30T19:53:41.763

数据保护 API (DPAPI) 完全符合您的要求。它使用机器或（更好的）用户的凭据作为加密密钥提供任意数据的对称加密。您不必担心管理密钥；Windows 会为您解决这些问题。如果用户更改密码，Windows 将使用用户的新密码重新加密数据。

DPAPI 在 .NET 中通过 System.Security.Cryptography.ProtectedData 类公开：

```
byte[] plaintextBytes = GetDataToProtect();
byte[] encodedBytes = ProtectedData.Protect(plaintextBytes, null, DataProtectionScope.CurrentUser); 
```

Protect 方法的第二个参数是一个可选的熵字节数组，它可以用作附加的特定于应用程序的“秘密”。

要解密，请使用 ProtectedData.Unprotect 调用：

```
byte[] encodedBytes = GetDataToUnprotect();
byte[] plaintextBytes = ProtectedData.Unprotect(encodedBytes, null, DataProtectionScope.CurrentUser); 
```

DPAPI 可以与漫游配置文件一起正常工作（如此[处](http://support.microsoft.com/kb/309408)所述），但您需要将加密数据存储在您的各种机器可以访问的位置（网络共享、IsolatedStorage 和[IsolatedStorageScope.Roaming](http://msdn.microsoft.com/en-us/library/zzdt0e7f(VS.71).aspx)等）。

有关详细信息，请参阅 MSDN 中的 ProtectedData 类。[这里](http://msdn.microsoft.com/en-us/library/ms995355.aspx)有一份 DPAPI 白皮书，其中包含比您想要的更多的信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T20:02:46.077

我想添加到 DPAPI 方法。

虽然我自己还没有实现用户存储方法，但 Microsoft 文档中有一种用户存储方法，它为特定用户加密和解密数据。

我使用机器商店使用 DPAPI。我会描述它，以防它适合你想要做的事情。我使用 Windows 服务加载 Windows 用户配置文件，并且该用户的密码用于加密数据。

附带说明一下，DPAPI 使用的 Triple-DES 可能稍弱（比 AES），但我不确定您正在寻找哪种类型的保护。

Windows 数据保护 [http://msdn.microsoft.com/en-us/library/ms995355.aspx](http://msdn.microsoft.com/en-us/library/ms995355.aspx)

# vba - 让 Excel 从 VBA 中刷新工作表上的数据

> ID：154434
> 
> 赞同：50
> 
> 时间：2008-09-30T18:54:25.290
> 
> 标签：vba, excel

如何在 Excel 中获取电子表格数据以从 VBA 中重新计算自身，而无需更改单元格值？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-09-30T18:54:58.970

以下几行可以解决问题：

```
ActiveSheet.EnableCalculation = False  
ActiveSheet.EnableCalculation = True 
```

**编辑：** 该`.Calculate()`方法不适用于所有功能。我在带有附加数组函数的工作表上对其进行了测试。我正在使用的生产表足够复杂，我不想测试该`.CalculateFull()`方法，但它可能会起作用。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-30T19:26:59.470

这应该可以解决问题...

```
'recalculate all open workbooks
Application.Calculate

'recalculate a specific worksheet
Worksheets(1).Calculate

' recalculate a specific range
Worksheets(1).Columns(1).Calculate 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2013-09-04T19:11:12.783

有时 Excel 会出现问题，需要重新启动才能重新应用公式。当您使用自定义公式时，在某些情况下会发生这种情况。

确保您有以下脚本

```
ActiveSheet.EnableCalculation = True 
```

重新应用选择方程。

```
Cells(RowA,ColB).Formula = Cells(RowA,ColB).Formula 
```

然后可以根据需要循环。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-30T19:52:04.137

你也可以试试

```
Application.CalculateFull 
```

或者

```
Application.CalculateFullRebuild 
```

如果您不介意重建所有打开的工作簿，而不仅仅是活动工作表。（`CalculateFullRebuild`也重建依赖项。）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-12-02T17:28:11.233

我在关闭VBA 中的背景图像*（草稿水印）时遇到问题。*我的更改没有出现（使用`Sheets(1).PageSetup.CenterHeader = ""`方法执行） - 所以我需要一种刷新方法。该`ActiveSheet.EnableCalculation`方法部分起到了作用，但没有涵盖未使用的单元格。

最后，我找到了我需要的一个衬里，它使图像在不再设置时消失：-

`Application.ScreenUpdating = True`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-06-24T22:28:24.067

数据连接更新后，某些 UDF 未执行。使用子程序，我试图重新计算一个列：

```
Sheets("mysheet").Columns("D").Calculate 
```

但上述声明没有任何效果。上述解决方案都没有帮助，除了 kambeeks 建议替换公式有效并且如果在更新期间手动重新计算打开速度很快。下面的代码解决了我的问题，即使对 OP “kluge” 评论不完全负责，它也提供了一个快速/可靠的解决方案来强制重新计算用户指定的单元格。

```
Application.Calculation = xlManual
DoEvents
For Each mycell In Sheets("mysheet").Range("D9:D750").Cells
    mycell.Formula = mycell.Formula
Next
DoEvents
Application.Calculation = xlAutomatic 
```

# apache - 设置 HTTP 代理以插入标头

> ID：154441
> 
> 赞同：57
> 
> 时间：2008-09-30T18:55:33.663
> 
> 标签：apache, proxy, http-headers, proxypass

我需要测试与我不想修改的客户端的一些 HTTP 交互。我需要测试的是当客户端的请求包含某个静态标头时服务器的行为。

我认为运行此测试的最简单方法是设置一个 HTTP 代理，在每个请求中插入标头。设置它的最简单方法是什么？

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2008-09-30T19:44:08.773

我在我的开发环境中通过将端口 80 上的 Apache 配置为端口 8080 上的应用程序服务器的代理来执行类似的操作，并使用以下 Apache 配置：

```
NameVirtualHost *
<VirtualHost *>
   <Proxy http://127.0.0.1:8080/*>
      Allow from all
   </Proxy>
   <LocationMatch "/myapp">
      ProxyPass http://127.0.0.1:8080/myapp
      ProxyPassReverse http://127.0.0.1:8080/myapp
      Header add myheader "myvalue"
      RequestHeader set myheader "myvalue"   
   </LocationMatch>
</VirtualHost> 
```

请参阅[LocationMatch](http://httpd.apache.org/docs/current/mod/core.html#locationmatch)和[RequestHeader](http://httpd.apache.org/docs/current/mod/mod_headers.html#requestheader)文档。

这会将标头*myheader: myvalue*添加到发送到应用程序服务器的请求中。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-01T14:09:39.943

您还可以安装非常容易安装的 Fiddler ( [http://www.fiddler2.com/fiddler2/ )（例如，比 Apache 更容易）。](http://www.fiddler2.com/fiddler2/)

启动后，它将自己注册为系统代理。然后打开“规则”菜单，并选择“自定义规则...”打开一个 JScript 文件，该文件允许您自定义请求。

要添加自定义标题，只需在`OnBeforeRequest`函数中添加一行：

```
oSession.oRequest.headers.Add("MyHeader", "MyValue"); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T19:03:34.923

我会尝试[tinyproxy](http://www.banu.com/tinyproxy/)。事实上，最好的办法是在其中嵌入一种脚本语言......听起来对[Lua](http://www.lua.org/)来说是一项完美的工作，尤其是在看到它对[mysqlproxy的工作情况之后](http://forge.mysql.com/wiki/MySQL_Proxy)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T19:16:11.040

我有同事为此使用了[Burp](http://www.portswigger.net/burp/)（“用于攻击和测试 Web 应用程序的交互式 HTTP/S 代理服务器”）。您还可以使用[Fiddler](http://www.fiddlertool.com/fiddler/)（“一个 HTTP 调试代理”）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T19:25:08.290

使用[http://www.proxomitron.info](http://www.proxomitron.info)并设置您想要的标题等。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-06-06T19:35:08.567

我没有使用代理，而是使用 Firefox 插件[“修改标题”](https://addons.mozilla.org/en-US/firefox/addon/modify-headers/)来插入标题（在我的情况下，使用单点登录来伪造登录，以便我可以作为不同的人进行测试）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-07-25T04:04:57.963

如果您的系统上有 ruby​​，那么使用 Sinatra 的小型 Rub​​y 代理怎么样（确保安装 Sinatra Gem）。这应该比设置 apache 更容易。代码可以在[这里找到。](http://thecoderslife.blogspot.com/2015/07/a-http-proxy-using-sinatra.html)

# python - 如何避免 .pyc 文件？

> ID：154443
> 
> 赞同：285
> 
> 时间：2008-09-30T18:55:59.263
> 
> 标签：python

我可以在不生成已编译的 .pyc 文件的情况下运行 python 解释器吗？

* * *

## 回答 #1

> 赞同：305
> 
> 时间：2008-09-30T19:38:02.283

来自[“Python 2.6 中的新增功能 - 解释器更改”](http://docs.python.org/dev/whatsnew/2.6.html#interpreter-changes)：

> [现在可以通过向 Python 解释器提供-B](http://docs.python.org/using/cmdline.html#cmdoption-B)开关或在运行解释器之前设置 [PYTHONDONTWRITEBYTECODE](http://docs.python.org/using/cmdline.html#envvar-PYTHONDONTWRITEBYTECODE)环境变量来阻止 Python 写入 .pyc 或 .pyo 文件。此设置可作为 [`sys.dont_write_bytecode`](http://docs.python.org/library/sys.html#sys.dont_write_bytecode)变量供 Python 程序使用，Python 代码可以更改该值以修改解释器的行为。

`.pyc`2010-11-27 更新：Python 3.2通过引入一个特殊的子文件夹解决了源文件夹与文件混杂的问题`__pycache__`，请参阅[Python 3.2 中的新增功能 - PYC 存储库目录](http://docs.python.org/dev/whatsnew/3.2.html#pep-3147-pyc-repository-directories)。

#### 注意：默认行为是生成字节码，并且是出于“性能”原因而完成的（有关更多信息，请参阅此处的[python2](https://www.python.org/dev/peps/pep-0304/)和此处的[python3](https://www.python.org/dev/peps/pep-3147/)）。

*   字节码 .pyc 文件的生成是一种[缓存](https://en.wikipedia.org/wiki/Cache_(computing))形式（即大大提高了平均性能）。
*   配置 python`PYTHONDONTWRITEBYTECODE=1`可能不利于 python 性能（对于 python2，请参见[https://www.python.org/dev/peps/pep-0304/](https://www.python.org/dev/peps/pep-0304/)，对于 python3，请参见[https://www.python.org/dev/peps/pep -3147/](https://www.python.org/dev/peps/pep-3147/) )。
*   如果您对性能影响感兴趣，请参见此处[https://github.com/python/cpython](https://github.com/python/cpython)。

* * *

## 回答 #2

> 赞同：119
> 
> 时间：2012-03-05T05:59:47.527

```
import sys

sys.dont_write_bytecode = True 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-09-30T19:44:04.953

在 Python 2.3+ 中实际上有一种方法可以做到这一点，但它有点深奥。我不知道您是否意识到这一点，但您可以执行以下操作：

```
$ unzip -l /tmp/example.zip
 Archive:  /tmp/example.zip
   Length     Date   Time    Name
 --------    ----   ----    ----
     8467  11-26-02 22:30   jwzthreading.py
 --------                   -------
     8467                   1 file
$ ./python
Python 2.3 (#1, Aug 1 2003, 19:54:32) 
>>> import sys
>>> sys.path.insert(0, '/tmp/example.zip')  # Add .zip file to front of path
>>> import jwzthreading
>>> jwzthreading.__file__
'/tmp/example.zip/jwzthreading.py' 
```

根据[zipimport](http://docs.python.org/lib/module-zipimport.html)库：

> ZIP 存档中可能存在任何文件，但只有文件 .py 和 .py[co] 可用于导入。不允许 ZIP 导入动态模块（.pyd、.so）。请注意，如果存档仅包含 .py 文件，Python 不会尝试通过添加相应的 .pyc 或 .pyo 文件来修改存档，这意味着如果 ZIP 存档不包含 .pyc 文件，则导入可能会很慢。

因此，您所要做的就是压缩文件，将压缩文件添加到您的 sys.path 中，然后导入它们。

如果您正在为 UNIX 构建它，您还可以考虑使用以下配方打包您的脚本： [unix zip executable](http://code.activestate.com/recipes/497000/)，但请注意，如果您打算使用标准输入或从 sys.args 读取任何内容（它可以是没有太多麻烦就完成了）。

根据我的经验，性能并不会因此受到太大影响，但是在以这种方式导入任何非常大的模块之前，您应该三思而后行。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-30T19:27:08.940

在 2.5 中，除了不授予用户对目录的写权限等措施外，没有其他方法可以抑制它。

然而，在 python 2.6 和 3.0 中，sys 模块中可能有一个名为“dont_write_bytecode”的设置可以设置为抑制这种情况。这也可以通过传递“-B”选项或设置环境变量“PYTHONDONTWRITEBYTECODE”来设置

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2019-08-08T13:43:29.017

从**Python 3.8**开始，您可以使用环境变量`PYTHONPYCACHEPREFIX`为 Python 定义缓存目录。

来自 Python 文档：

> 如果设置了此项，Python 将在此路径的镜像目录树中写入 .pyc 文件，而不是在源树中的**pycache**目录中。这等效于指定 -X pycache_prefix=PATH 选项。

**例子**

如果您`./profile`在 Linux 中添加以下行：

```
export PYTHONPYCACHEPREFIX="$HOME/.cache/cpython/" 
```

Python 不会`__pycache__`在您的项目目录中创建烦人的目录，而是将所有这些目录放在`~/.cache/cpython/`

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2017-06-15T07:02:41.020

您可以`sys.dont_write_bytecode = True`在源代码中进行设置，但这必须在加载的第一个 python 文件中。如果你执行`python somefile.py`，那么你将不会得到`somefile.pyc`.

当您使用安装实用程序时`setup.py`，`entry_points=`您将`sys.dont_write_bytecode`在启动脚本中进行设置。因此，您不能依赖 setuptools 生成的“默认”启动脚本。

如果您自己使用 python 文件作为参数启动 Python，您可以指定`-B`：

```
python -B somefile.py 
```

`somefile.pyc`无论如何都不会生成，但也不会生成`.pyc`其他文件的文件。

如果您有一些实用程序`myutil`并且您无法更改它，它不会将 -B 传递给 python 解释器。只需通过设置环境变量来启动它`PYTHONDONTWRITEBYTECODE`：

```
PYTHONDONTWRITEBYTECODE=x myutil 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-10-07T20:43:57.550

我在一个测试套件中有几个测试用例，在我像这样在 Mac 终端中运行测试套件之前：

```
python LoginSuite.py 
```

以这种方式运行命令，我的目录中填充了 .pyc 文件。我尝试了以下所述的方法，它解决了这个问题：

```
python -B LoginSuite.py 
```

如果您将测试用例导入测试套件并在命令行上运行该套件，则此方法有效。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-02-11T04:38:09.463

解决方案`ipython 6.2.1 using python 3.5.2`（在 Ubuntu 16.04 和 Windows 10 上测试）：

`Ipython`不尊重`%env PYTHONDONTWRITEBYTECODE =1`是否在`ipython`解释器中设置或在`~/.ipython/profile-default/startup/00-startup.ipy`. 而是在您的`~.ipython/profile-default/startup/00-startup.py`

```
import sys
sys.dont_write_bytecode=True 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-30T19:03:12.693

您可以将您的模块存在的目录设置为对运行 Python 解释器的用户只读。

我认为没有更优雅的选择。[PEP 304](http://www.python.org/dev/peps/pep-0304/)似乎试图为此引入一个简单的选项，但它似乎已被放弃。

我想您可能正在尝试解决其他一些问题，为此禁用 .py[co] 似乎是一种解决方法，但最好还是解决这个原始问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-30T19:01:46.473

据我所知，python 将编译您“导入”的所有模块。但是，python 不会编译使用以下命令运行的 python 脚本：“python script.py”（但它会编译脚本导入的任何模块）。

真正的问题是为什么你不希望 python 编译模块？如果它们妨碍您，您可能可以自动化一种方法来清理它们。

# c# - 帮助刚接触 C# 变量的人

> ID：154446
> 
> 赞同：2
> 
> 时间：2008-09-30T18:57:25.283
> 
> 标签：c#, variables

我试图在按钮按下时将数据保存到数据库中，但这些变量似乎是私有的，因为它们被定义的性质。我试图移动它们定义的位置，但这似乎会产生其他错误。

给定一个修复程序，为什么它是这样修复的？

代码如下。

```
namespace enable
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
            OleDbConnection favouriteConnection = new System.Data.OleDb.OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;Data Source=\\\\192.168.123.5\\Share\\Matt\\BugTypes.mdb");
            string strSQL = "SELECT CategoryName, Show " + "FROM [Categories] WHERE Show = 'Yes' " + "ORDER BY CategoryName";
            OleDbDataAdapter adapter = new OleDbDataAdapter(strSQL, favouriteConnection);
            OleDbCommandBuilder cBuilder = new OleDbCommandBuilder(adapter);
            DataTable dTable = new DataTable();
            adapter.Fill(dTable);
            BindingSource bSource = new BindingSource();
            bSource.DataSource = dTable;
            dataGridView1.DataSource = bSource;
            adapter.Update(dTable);
        }
        private void button1_Click(object sender, EventArgs e)
        {
            adapter.Update(dTable);//this is the button that needs to do the save, but can't see the variables.
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-30T19:01:04.073

您在构造函数中声明`dTable`和`adapter`，因此一旦构造函数完成，它就会超出范围。

您想将变量声明移到主类中，例如：

```
public partial class Form1 : Form
{
    private DataTable dTable;
    private OleDbDataAdapter adapter;

    Public Form1()
    {
         ... your setup here ...
         dTable = new DataTable();
         ... etc ...
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T19:01:15.880

```
namespace enable
{    
    public partial class Form1 : Form
    {

    OleDbDataAdapter adapter;
    DataTable dTable = new DataTable();

        public Form1()
        {
            InitializeComponent();
            OleDbConnection favouriteConnection = new System.Data.OleDb.OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;Data Source=\\\\192.168.123.5\\Share\\Matt\\BugTypes.mdb");
            string strSQL = "SELECT CategoryName, Show " + "FROM [Categories] WHERE Show = 'Yes' " + "ORDER BY CategoryName";
            adapter = new OleDbDataAdapter(strSQL, favouriteConnection);
            OleDbCommandBuilder cBuilder = new OleDbCommandBuilder(adapter);
            adapter.Fill(dTable);
            BindingSource bSource = new BindingSource();
            bSource.DataSource = dTable;
            dataGridView1.DataSource = bSource;
            adapter.Update(dTable);            
        }
        private void button1_Click(object sender, EventArgs e)
        {
            adapter.Update(dTable);//this is the button that needs to do the save, but can't see the variables.
        }
    }
} 
```

您需要更改 DataAdapter 和 dataTable 范围才能访问按钮单击方法事件。如果您在构造函数上声明它们，则它们不能在其他方法上使用，您需要将它们声明为对象字段，以便对您的对象实例是“全局的”。

你需要找出每个变量需要什么作用域，你可以有一个局部作用域，即声明在方法内或类作用域，声明在方法外。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T19:01:09.347

适配器的作用域是 Form1 的构造函数，而不是类本身。

将适配器和 dtable 移动为类的私有成员。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T19:00:13.670

更新：[叹气]我也忘了把 dTable 移到班级应付......

```
namespace enable
{    
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
            OleDbConnection favouriteConnection = new System.Data.OleDb.OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;Data Source=\\\\192.168.123.5\\Share\\Matt\\BugTypes.mdb");
            string strSQL = "SELECT CategoryName, Show " + "FROM [Categories] WHERE Show = 'Yes' " + "ORDER BY CategoryName";
            m_Adapter = new OleDbDataAdapter(strSQL, favouriteConnection)l
            OleDbCommandBuilder cBuilder = new OleDbCommandBuilder(m_Adapter);
            dTable = new DataTable();
            m_Adapter.Fill(dTable);
            BindingSource bSource = new BindingSource();
            bSource.DataSource = dTable;
            dataGridView1.DataSource = bSource;
            m_Adapter.Update(dTable);            
        }

        private void button1_Click(object sender, EventArgs e)
        {
            m_Adapter.Update(dTable);//this is the button that needs to do the save, but can't see the variables.
        }

        OleDbDataAdapter m_Adapter;
        DataTable dTable;
    }
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-30T19:06:10.410

适配器和 dTable 在您的构造函数中声明。它们都应该从构造函数中“移出”以获得类范围的独家新闻。就像 Franci 对适配器所做的那样。

可能还有其他错误，但是当您没有发布编译器错误时很难猜测。

/约翰/

# c# - SharpZipLib - ZipException“额外数据结束” - 为什么我会收到此异常？

> ID：154463
> 
> 赞同：0
> 
> 时间：2008-09-30T19:01:15.570
> 
> 标签：c#, .net, unzip, sharpziplib

我正在使用 SharpZipLib 0.85.5 版来解压缩文件。我的代码已经运行了好几个月，直到我发现一个它不喜欢的 ZIP 文件。

```
ICSharpCode.SharpZipLib.Zip.ZipException: End of extra data     
    at ICSharpCode.SharpZipLib.Zip.ZipExtraData.ReadCheck(Int32 length) in C:\C#\SharpZLib\Zip\ZipExtraData.cs:line 933     
    at ICSharpCode.SharpZipLib.Zip.ZipExtraData.Skip(Int32 amount) in C:\C#\SharpZLib\Zip\ZipExtraData.cs:line 921     
    at ICSharpCode.SharpZipLib.Zip.ZipEntry.ProcessExtraData(Boolean localHeader) in C:\C#\SharpZLib\Zip\ZipEntry.cs:line 925     
    at ICSharpCode.SharpZipLib.Zip.ZipInputStream.GetNextEntry() in C:\C#\SharpZLib\Zip\ZipInputStream.cs:line 269     
    at Constellation.Utils.Tools.UnzipFile(String sourcePath, String targetDirectory) in C:\C#\Constellation2\Utils\Tools.cs:line 90     
--- End of inner exception stack trace --- 
```

这是我的解压缩方法：

```
 public static void UnzipFile(string sourcePath, string targetDirectory)
     {
        try
        {
            using (ZipInputStream s = new ZipInputStream(File.OpenRead(sourcePath)))
            {
                ZipEntry theEntry;
                while ((theEntry = s.GetNextEntry()) != null)
                {
                    //string directoryName = Path.GetDirectoryName(theEntry.Name);
                    string fileName = Path.GetFileName(theEntry.Name);

                    if (targetDirectory.Length > 0)
                    {
                        Directory.CreateDirectory(targetDirectory);
                    }

                    if (fileName != String.Empty)
                    {
                        using (FileStream streamWriter = File.Create(targetDirectory + fileName))
                        {
                            int size = 2048;
                            byte[] data = new byte[2048];
                            while (true)
                            {
                                size = s.Read(data, 0, data.Length);
                                if (size > 0)
                                {
                                    streamWriter.Write(data, 0, size);
                                }
                                else
                                {
                                    break;
                                }
                            }
                        }
                    }
                }
            }
        }
        catch (Exception ex)
        {
            throw new Exception("Error unzipping file \"" + sourcePath + "\"", ex);
        }
    } 
```

使用 XP 的内置 ZIP 支持、WinZIP 和 7-Zip 可以很好地解压缩文件。异常被抛出`s.GetNextEntry()`。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T19:23:47.497

其他 zip 工具可能会忽略损坏的额外数据 - 或者 #ZipLib 中同样可能存在错误。（我不久前发现了一个 - 某个文件不会压缩，然后使用某些选项干净地解压缩。）

在这种特殊情况下，我建议您在#ZipLib 论坛上发帖以引起开发人员的注意。如果您的文件不包含任何敏感数据，并且您可以获得一个简短但完整的程序，我怀疑这将有很大帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T23:25:36.260

请参阅[官方 ZIP 规范](http://www.pkzip.com/support/zip-application-note)。

ZIP 存档中的每个文件都可以有一个与之关联的“额外”字段。我认为#ZipLib 告诉您给出的“额外”字段长度比可读取的数据量长；换句话说，ZIP 文件很可能已被截断。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T21:36:43.510

我同意乔恩的观点。无法在评论中包含以下内容：

（虽然这不能回答你的问题）使用这样的东西不是更容易吗：

```
public static void UnzipFile(string sourcePath, string targetDirectory)
{
    try
    {
        FastZip fastZip = new FastZip();
        fastZip.CreateEmptyDirectories = false;
        fastZip.ExtractZip(sourcePath, targetDirectory,"");
    }
    catch(Exception ex)
    {
        throw new Exception("Error unzipping file \"" + sourcePath + "\"", ex);
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-06-19T09:12:56.683

根据[官方 ZIP 规范](https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT)4.5.3 ，额外数据的字段大小和压缩大小“必须仅在相应的本地或中央目录记录字段设置为 0xFFFF 或 0xFFFFFFFF 时出现”。

但`SharpZipLib`仅当“useZip64_ == UseZip64.On”时才将其写入方法 ZipFile.WriteCentralDirectoryHeader。我添加了`entry.IsZip64Forced()`条件和错误消失）

```
 if ( entry.CentralHeaderRequiresZip64 ) {
            ed.StartNewEntry();

            if ((entry.Size >= 0xffffffff) || (useZip64_ == UseZip64.On) || entry.IsZip64Forced())
            {
                ed.AddLeLong(entry.Size);
            }

            if ((entry.CompressedSize >= 0xffffffff) || (useZip64_ == UseZip64.On) || entry.IsZip64Forced())
            {
                ed.AddLeLong(entry.CompressedSize);
            } 
```

# c++ - 未命名/匿名命名空间与静态函数

> ID：154469
> 
> 赞同：592
> 
> 时间：2008-09-30T19:02:00.437
> 
> 标签：c++, namespaces

C++ 的一个特性是能够创建未命名（匿名）命名空间，如下所示：

```
namespace {
    int cannotAccessOutsideThisFile() { ... }
} // namespace 
```

你会认为这样的特性是没有用的——因为你不能指定命名空间的名称，所以不可能从外部访问其中的任何内容。但是这些未命名*的命名空间可以在创建它们的文件中*访问，就好像您对它们有一个隐含的 using 子句一样。

我的问题是，为什么或什么时候这比使用静态函数更可取？或者他们本质上是做同样事情的两种方式？

* * *

## 回答 #1

> 赞同：384
> 
> 时间：2008-09-30T19:06:19.613

~~C++ 标准在第 7.3.1.1 节未命名命名空间，第 2 段中写道：~~

 ~~> ~~在命名空间范围内声明对象时，不推荐使用 static 关键字，未命名命名空间提供了更好的选择。~~

静态仅适用于对象、函数和匿名联合的名称，不适用于类型声明。

## 编辑：

弃用关键字的这种使用`static`（影响翻译单元中变量声明的可见性）的决定已被撤销（[ref](http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#1012)）。在这种情况下，使用 a`static`或 unnamed`namespace`本质上是两种做同样事情的方式。有关更多讨论，请参阅[此](https://stackoverflow.com/questions/4726570/deprecation-of-the-static-keyword-no-more)SO question。

Unnamed`namespace`仍然具有允许您定义翻译单元本地类型的优势。有关更多详细信息，请参阅[此](https://stackoverflow.com/questions/4422507/superiority-of-unnamed-namespace-over-static)SO 问题。

[感谢Mike Percy](https://stackoverflow.com/users/1220179/mike-percy)让我注意到了这一点。

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2008-09-30T23:20:49.690

将方法放在匿名命名空间中可以防止您意外违反[One Definition Rule](http://en.wikipedia.org/wiki/One_Definition_Rule)，让您不必担心将帮助方法命名为与您可能链接的其他方法相同。

[而且，正如luke](https://stackoverflow.com/a/154482/913098)所指出的，匿名命名空间比静态成员更受标准的青睐。

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2008-10-01T09:15:19.370

在一种极端情况下，静态具有令人惊讶的效果（至少对我来说是这样）。C++03 标准在 14.6.4.2/1 中声明：

> 对于依赖于模板参数的函数调用，如果函数名称是*unqualified-id*但不是*template-id*，则使用通常的查找规则（3.4.1、3.4.2）找到候选函数，但以下情况除外：
> 
> *   对于使用非限定名称查找 (3.4.1) 的查找部分，仅找到具有来自模板定义上下文的外部链接的函数声明。
> *   对于使用关联命名空间 (3.4.2) 的查找部分，仅找到在模板定义上下文或模板实例化上下文中找到的具有外部链接的函数声明。
> 
> ...

下面的代码将调用`foo(void*)`，而不是`foo(S const &)`您可能期望的那样。

```
template <typename T>
int b1 (T const & t)
{
  foo(t);
}

namespace NS
{
  namespace
  {
    struct S
    {
    public:
      operator void * () const;
    };

    void foo (void*);
    static void foo (S const &);   // Not considered 14.6.4.2(b1)
  }

}

void b2()
{
  NS::S s;
  b1 (s);
} 
```

就其本身而言，这可能没什么大不了的，但它确实强调了对于完全兼容的 C++ 编译器（即支持 的编译器`export`），该`static`关键字仍将具有其他任何方式都不可用的功能。

```
// bar.h
export template <typename T>
int b1 (T const & t);

// bar.cc
#include "bar.h"
template <typename T>
int b1 (T const & t)
{
  foo(t);
}

// foo.cc
#include "bar.h"
namespace NS
{
  namespace
  {
    struct S
    {
    };

    void foo (S const & s);  // Will be found by different TU 'bar.cc'
  }
}

void b2()
{
  NS::S s;
  b1 (s);
} 
```

确保在使用 ADL 的模板中找不到我们未命名命名空间中的函数的唯一方法是 make 它`static`。

**现代 C++ 更新**

从 C++ '11 开始，未命名命名空间的成员隐式具有内部链接 (3.5/4)：

> 未命名的命名空间或在未命名的命名空间中直接或间接声明的命名空间具有内部链接。

但同时，更新了 14.6.4.2/1 以删除对链接的提及（这取自 C++ '14）：

> 对于后缀表达式是从属名称的函数调用，使用通常的查找规则（3.4.1、3.4.2）找到候选函数，除了：
> 
> *   对于使用非限定名称查找 (3.4.1) 的查找部分，只能找到来自模板定义上下文的函数声明。
>     
>     
> *   对于使用关联命名空间 (3.4.2) 的查找部分，只能找到在模板定义上下文或模板实例化上下文中找到的函数声明。

结果是静态和未命名命名空间成员之间的这种特殊差异不再存在。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-10-01T00:39:12.090

我最近开始在我的代码中用匿名命名空间替换静态关键字，但立即遇到了一个问题，即命名空间中的变量不再可用于在我的调试器中进行检查。我使用的是 VC60，所以我不知道这是否与其他调试器无关。我的解决方法是定义一个“模块”命名空间，在这里我给它我的 cpp 文件的名称。

例如，在我的 XmlUtil.cpp 文件中，我`XmlUtil_I { ... }`为所有模块变量和函数定义了一个命名空间。这样我就可以`XmlUtil_I::`在调试器中应用限定来访问变量。在这种情况下，它将它与我可能想在其他地方使用`_I`的公共命名空间区分开来。`XmlUtil`

我认为与真正匿名的方法相比，这种方法的一个潜在缺点是有人可能会通过在其他模块中使用命名空间限定符来违反所需的静态范围。我不知道这是否是一个主要问题。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-26T20:43:26.557

根据经验，我只是注意到，虽然这是将以前的静态函数放入匿名命名空间的 C++ 方式，但较旧的编译器有时会遇到问题。我目前为我们的目标平台使用了一些编译器，更现代的 Linux 编译器可以将函数放入匿名命名空间中。

但是，在 Solaris 上运行的较旧的编译器，在未指定的未来版本之前，我们一直使用它，有时会接受它，有时会将其标记为错误。这个错误不是让我担心的，而是它*接受它时**可能*会做的事情。因此，在我们全面现代化之前，我们仍然使用静态（通常是类范围）函数，我们更喜欢匿名命名空间。

 ** * *

## 回答 #6

> 赞同：8
> 
> 时间：2018-04-05T18:25:46.430

我个人更喜欢静态函数而不是无名命名空间，原因如下：

*   仅从函数定义就可以清楚地看出，它对于编译它的翻译单元是私有的。对于无名命名空间，您可能需要滚动并搜索以查看函数是否在命名空间中。

*   命名空间中的函数可能会被某些（较旧的）编译器视为 extern。在 VS2017 中，它们仍然是外部的。出于这个原因，即使函数位于无名命名空间中，您可能仍希望将它们标记为静态。

*   静态函数在 C 或 C++ 中的行为非常相似，而无名命名空间显然只是 C++。无名命名空间还增加了额外的缩进级别，我不喜欢这样 :)

所以，我很高兴看到[不再不推荐](http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#1012)使用静态函数。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-30T19:13:35.273

C++98 标准不推荐为此目的使用 static 关键字。static 的问题在于它不适用于类型定义。它也是一个在不同上下文中以不同方式使用的重载关键字，因此未命名的命名空间稍微简化了一些事情。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2020-06-03T15:06:48.720

不同之处在于损坏标识符的名称（`_ZN12_GLOBAL__N_11bE`vs `_ZL1b`，这并不重要，但它们都被组装成符号表中的局部符号（没有`.global`asm 指令）。

```
#include<iostream>
namespace {
   int a = 3;
}

static int b = 4;
int c = 5;

int main (){
    std::cout << a << b << c;
}

        .data
        .align 4
        .type   _ZN12_GLOBAL__N_11aE, @object
        .size   _ZN12_GLOBAL__N_11aE, 4
_ZN12_GLOBAL__N_11aE:
        .long   3
        .align 4
        .type   _ZL1b, @object
        .size   _ZL1b, 4
_ZL1b:
        .long   4
        .globl  c
        .align 4
        .type   c, @object
        .size   c, 4
c:
        .long   5
        .text 
```

至于嵌套的匿名命名空间：

```
namespace {
   namespace {
       int a = 3;
    }
}

        .data
        .align 4
        .type   _ZN12_GLOBAL__N_112_GLOBAL__N_11aE, @object
        .size   _ZN12_GLOBAL__N_112_GLOBAL__N_11aE, 4
_ZN12_GLOBAL__N_112_GLOBAL__N_11aE:
        .long   3 
```

翻译单元中的所有 1 级匿名命名空间相互组合，翻译单元中的所有 2 级嵌套匿名命名空间相互组合

您还可以在匿名命名空间中拥有嵌套命名空间或嵌套内联命名空间

```
namespace {
   namespace A {
       int a = 3;
    }
}

        .data
        .align 4
        .type   _ZN12_GLOBAL__N_11A1aE, @object
        .size   _ZN12_GLOBAL__N_11A1aE, 4
_ZN12_GLOBAL__N_11A1aE:
        .long   3

which for the record demangles as:
        .data
        .align 4
        .type   (anonymous namespace)::A::a, @object
        .size   (anonymous namespace)::A::a, 4
(anonymous namespace)::A::a:
        .long   3

//inline has the same output 
```

您也可以使用匿名内联命名空间，但据我所知，`inline`匿名命名空间的效果为 0

```
inline namespace {
   inline namespace {
       int a = 3;
    }
} 
```

`_ZL1b`:`_Z`表示这是一个损坏的标识符。`L`通过 . 表示它是一个本地符号`static`。`1`是标识符的长度，`b`然后是标识符`b`

`_ZN12_GLOBAL__N_11aE` `_Z`表示这是一个损坏的标识符。`N`表示这是一个命名空间`12`是匿名命名空间名称的长度`_GLOBAL__N_1`，然后是匿名命名空间名称`_GLOBAL__N_1`，然后`1`是标识符的长度`a`，`a`是标识符`a`并`E`关闭驻留在命名空间中的标识符。

`_ZN12_GLOBAL__N_11A1aE`与上面相同，只是其中有另一个名称空间（`1A`）称为`A`，前缀长度`A`为1。匿名名称空间都有名称`_GLOBAL__N_1`

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-12-08T19:02:23.557

此外，如果有人像这个例子一样在变量上使用 static 关键字：

```
namespace {
   static int flag;
} 
```

它不会在映射文件中看到

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-04-18T06:16:55.587

编译以下代码可以看到匿名命名空间和静态函数之间的编译器特定差异。

```
#include <iostream>

namespace
{
    void unreferenced()
    {
        std::cout << "Unreferenced";
    }

    void referenced()
    {
        std::cout << "Referenced";
    }
}

static void static_unreferenced()
{
    std::cout << "Unreferenced";
}

static void static_referenced()
{
    std::cout << "Referenced";
}

int main()
{
    referenced();
    static_referenced();
    return 0;
} 
```

使用 VS 2017 编译此代码（指定级别 4 警告标志 /W4 以启用[警告 C4505: unreferenced local function has been removed](https://docs.microsoft.com/en-us/cpp/error-messages/compiler-warnings/compiler-warning-level-4-c4505)）和带有 -Wunused-function 或 -Wall 标志的 gcc 4.9 表明 VS 2017 只会产生警告未使用的静态函数。gcc 4.9 及更高版本，以及 clang 3.3 及更高版本，将对命名空间中未引用的函数产生警告，并对未使用的静态函数产生警告。

[gcc 4.9 和 MSVC 2017 的现场演示](https://godbolt.org/g/53ubwO)

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-30T19:09:26.597

刚刚在阅读您的问题时才了解此功能，我只能推测。这似乎比文件级静态变量提供了几个优点：

*   匿名命名空间可以相互嵌套，提供多级保护，符号无法逃脱。
*   几个匿名命​​名空间可以放在同一个源文件中，实际上在同一个文件中创建不同的静态级别范围。

我有兴趣了解是否有人在真实代码中使用过匿名名称空间。

# c# - 如何有条件地格式化.Net中的字符串？

> ID：154483
> 
> 赞同：32
> 
> 时间：2008-09-30T19:06:25.683
> 
> 标签：c#, .net, string, string.format

我想做一些字符串的条件格式。我知道您可以对整数和浮点数进行一些条件格式化，如下所示：

```
Int32 i = 0;
i.ToString("$#,##0.00;($#,##0.00);Zero"); 
```

如果变量为正数、负数或零，上述代码将产生三种格式之一。

我想知道是否有任何方法可以在字符串参数上使用部分。对于一个具体但**人为的**示例，我希望在以下代码中替换“if”检查：

```
string MyFormatString(List<String> items, List<String> values)
{
    string itemList = String.Join(", " items.ToArray());
    string valueList = String.Join(", " values.ToArray());

    string formatString;

    if (items.Count > 0)
    //this could easily be: 
    //if (!String.IsNullOrEmpty(itemList))
    {
        formatString = "Items: {0}; Values: {1}";
    }
    else
    {
        formatString = "Values: {1}";
    }

    return String.Format(formatString, itemList, valueList);
} 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-30T19:10:48.573

好吧，您可以使用条件运算符稍微简化一下：

```
string formatString = items.Count > 0 ? "Items: {0}; Values: {1}" : "Values: {1}";
return string.Format(formatString, itemList, valueList); 
```

甚至将其包含在同一语句中：

```
return string.Format(items.Count > 0 ? "Items: {0}; Values: {1}" : "Values: {1}",
                     itemList, valueList); 
```

这就是你所追求的吗？我认为您不能拥有一个有时包含位有时不包含位的格式字符串。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-30T19:10:34.750

不在 String.Format() 中，但您可以使用 C# 的内联运算符，例如：

```
return items.Count > 0 
       ? String.Format("Items: {0}; Values: {1}", itemList, valueList)
       : String.Format("Values: {0}", valueList); 
```

这将有助于整理代码。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-12-15T21:26:34.830

*虽然没有直接解决 OP，但这也属于问题标题。*

我经常需要使用一些自定义单位来格式化字符串，但是在我没有数据的情况下，我根本不想输出任何东西。我将它与各种可为空的类型一起使用：

```
/// <summary>
/// Like String.Format, but if any parameter is null, the nullOutput string is returned.
/// </summary>
public static string StringFormatNull(string format, string nullOutput, params object[] args)
{
    return args.Any(o => o == null) ? nullOutput : String.Format(format, args);
} 
```

例如，如果我正在格式化像“20°C”这样的温度，但遇到一个空值，它将打印一个替代字符串而不是“°C”。

```
double? temp1 = 20.0;
double? temp2 = null;

string out1 = StringFormatNull("{0}°C", "N/A", temp1); // "20°C"
string out2 = StringFormatNull("{0}°C", "N/A", temp2); // "N/A" 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T19:51:18.897

```
string.Format(  (items.Count > 0 ? "Items: {0}; " : "") + "Values {1}"
              , itemList
              , valueList); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-08-10T16:45:50.647

只是不要。我不知道您的代码中的项目和值是什么，但我相信，这对可以被视为某种实体。将此实体定义为一个类并覆盖其`ToString()`方法以返回您想要的任何内容。`if`根据某些上下文决定如何格式化此字符串绝对没有错。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T19:09:14.163

这可能不是您要寻找的，但是...

```
formatString = (items.Count > 0) ? "Items: {0}; Values: {1}" : "Values: {1}"; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T19:24:56.590

我希望这可以做到：

```
return String.Format(items.ToString(itemList + " ;;") + "Values: {0}", valueList); 
```

不幸的是，.ToString() 方法似乎不喜欢空白的负数和零选项，或者在任何地方都没有 # 或 0。我会把它留在这里，以防它为其他人指出更好的答案。

# .net - 如何在不打开数据库的情况下测试 SqlServer 连接

> ID：154485
> 
> 赞同：5
> 
> 时间：2008-09-30T19:08:02.807
> 
> 标签：.net, sql, sql-server, sqlconnection

标题基本概括了所有内容。我想创建一个 SqlConnection 然后在不打开数据库的情况下检查该连接，因为那时我还不知道我将连接到哪里。有可能这样做吗？SqlConnection 类有一个“Open”成员，它试图打开您在 Database 属性中设置的数据库，如果您没有设置，SqlServer 会尝试使用主数据库。问题是我试图连接的用户（MACHINE\ASPNET）可以访问一些数据库（我还不知道）而不是主数据库。

问候， 塞巴

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-30T21:09:04.420

连接到临时数据库。每个人都可以访问 tempdb，因此您将能够验证自己的访问权限。稍后当您知道实际的数据库时，您可以更改此属性以连接到您想要的数据库。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T19:19:44.853

我不确定这是否是您需要的。

[检查用户是否有权访问 Sql Server 2005 中的数据库](http://www.sqlservercurry.com/2008/03/check-if-user-has-access-to-database.html?showComment=1221349680000)

```
SELECT HAS_DBACCESS('Northwind'); 
```

HAS_DBACCESS 返回有关用户是否有权访问指定数据库 (BOL) 的信息。

查找当前用户有权访问的所有数据库

```
SELECT [Name] as DatabaseName from master.dbo.sysdatabases
WHERE ISNULL(HAS_DBACCESS ([Name]),0)=1
ORDER BY [Name] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T21:25:35.020

如果您只需要知道服务是否处于活动状态，您可以尝试通过套接字连接到端口，以查看它是否打开

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T19:13:05.993

只是好奇...如果您不知道需要连接的精确数据库，您可以验证哪些信息？“真实”数据库可能出现的许多问题都无法通过这种测试连接进行测试，例如连接性或安全性。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2011-11-26T03:58:13.970

我不知道您是否得到了答案，但是当我们都在这里寻找答案时，我希望这就是您要寻找的

```
dim con as new sqlconnection
con.connectionstring="<<put your conn string here>>"
'try...catch block fires exception if the con is not successfully opened
try
con.open()
catch ex as exception
msgbox ex.message
end try 
```

# c# - C# 不支持静态索引器吗？

> ID：154489
> 
> 赞同：36
> 
> 时间：2008-09-30T19:09:55.127
> 
> 标签：c#, .net, clr

我一直在尝试几种不同的方法，但我得出的结论是无法做到。这是我过去从其他语言中喜欢的语言功能。这只是我应该注销的东西吗？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2008-09-30T19:18:52.563

不，C# 不支持静态索引器。然而，与其他答案不同，我看到拥有它们很容易。考虑：

```
Encoding x = Encoding[28591]; // Equivalent to Encoding.GetEncoding(28591)
Encoding y = Encoding["Foo"]; // Equivalent to Encoding.GetEncoding("Foo") 
```

我怀疑它会相对很少使用，但我认为它被禁止很奇怪——据我所知，它没有特别的原因造成不对称。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2010-08-18T09:04:38.753

您可以使用静态索引属性模拟静态索引器：

```
public class MyEncoding
{
    public sealed class EncodingIndexer
    {
        public Encoding this[string name]
        {
            get { return Encoding.GetEncoding(name); }
        }

        public Encoding this[int codepage]
        {
            get { return Encoding.GetEncoding(codepage); }
        }
    }

    private static EncodingIndexer StaticIndexer;

    public static EncodingIndexer Items
    {
        get { return StaticIndexer ?? (StaticIndexer = new EncodingIndexer()); }
    }
} 
```

用法：

```
Encoding x = MyEncoding.Items[28591]; // Equivalent to Encoding.GetEncoding(28591)   
Encoding y = MyEncoding.Items["Foo"]; // Equivalent to Encoding.GetEncoding("Foo") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-02-14T21:57:36.343

不，但是可以创建一个静态字段来保存使用索引器的类的实例...

```
namespace MyExample {

   public class Memory {
      public static readonly MemoryRegister Register = new MemoryRegister();

      public class MemoryRegister {
         private int[] _values = new int[100];

         public int this[int index] {
            get { return _values[index]; }
            set { _values[index] = value; }
         }
      }
   }
} 
```

...Which could be accessed in the way you are intending. This can be tested in the Immediate Window...

```
Memory.Register[0] = 12 * 12;
?Memory.Register[0]
144 
```

# macos - 用于 Mac OS X Leopard 的软件，用于跟踪和记录网络使用情况

> ID：154501
> 
> 赞同：2
> 
> 时间：2008-09-30T19:12:25.277
> 
> 标签：macos, osx-leopard, network-monitoring

我正在寻找一个可以安装在 Mac 上的程序，它会告诉我每天下载多少字节，并以这样的方式存储该信息，以便以后查看结果。

限制端口（80、443、21、22）也很棒。

这样的事情存在吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T01:43:10.470

您可能对[Wireshark感兴趣。](http://www.wireshark.org/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T01:47:37.183

您可以运行本地 Web 代理，然后分析日志。

下载和安装[SquidMan](http://homepage.mac.com/adg/SquidMan/index.html)很简单，这是在您的系统上启用 squid Web 代理的一种点击方式。

您必须将您的机器配置为通过 localhost 上的代理，而不是直接访问网站。您可以在 System Preferences -> Network 的网络接口的高级选项卡中找到它

然后，您可以分析日志，不仅可以查看下载了多少，还可以查看下载的内容和时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T19:13:33.590

在终端中输入“man tcpdump”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T01:40:39.867

好的，这不是一个完整的包或任何东西，但 netstat 会显示在接口上传输的字节数

```
netstat -ib 
```

你可以每天在某个地方记录下来。“man netstat”了解更多信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-19T19:46:31.267

另一个工具是[ethernal](http://www.cs.usfca.edu/~jbovet/ethernal.html)，但它已经有一段时间没有更新了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-10T18:07:59.790

我刚刚遇到[这两个应用程序](http://homepage.mac.com/rominar/net.html)，Net Monitor 和 Net Monitor Sidekick，第一个执行您描述的操作（使用计算器确定某个日期范围内的吞吐量），第二个按主机跟踪流量。在尝试使用[ntop](http://www.ntop.org/)后，它的设置很糟糕，使用起来很糟糕，而且非常非常有限，我很激动 =)

# html - 图像和html之间的颜色差异

> ID：154502
> 
> 赞同：5
> 
> 时间：2008-09-30T19:12:27.320
> 
> 标签：html, css, png, cross-browser, color-management

我在将 css 背景颜色与同一 html 页面上的图像颜色匹配时遇到问题。是什么赋予了？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T19:15:07.610

我猜你使用PNG图像？这是一个伽马校正“功能”。Mark Ransom 发布了一篇关于此的[有用文本。](https://stackoverflow.com/questions/115818/which-format-for-small-website-images-gif-or-png#128390)

请注意，`pngcrush`某处列出的解决方案对我不起作用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T19:17:27.620

您使用的是什么图像编辑程序？我找到[了这篇关于 Photoshop 颜色配置文件](http://kb.adobe.com/selfservice/viewContent.do?externalId=326083&sliceId=1)的文章。[PNG gamma 校正](http://hsivonen.iki.fi/png-gamma/)也可能存在问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T19:17:34.377

可能是由于浏览器的[颜色管理](http://www.gballard.net/psd/go_live_page_profile/embeddedJPEGprofiles.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T19:17:22.223

这可能是颜色配置文件问题。

例如，如果图像是 JPEG 并且具有颜色配置文件，并且您的浏览器不支持在它们指定的颜色配置文件中显示图像，则图像本身的颜色将在您的浏览器中呈现不同。在这种情况下，如果您在 Photoshop（颜色配置文件感知）中检查图像的颜色，然后在 CSS 中应用该颜色并在不感知颜色配置文件的浏览器中查看页面，它看起来会有所不同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T19:14:37.817

脑海中浮现出三种可能性：

*   检查您的显示器颜色深度是否设置为 32 位或 24 位，而不是 16 位
*   检查图像没有被分配调色板（例如网络安全调色板）。这可能是 .gif 或 8 位 .png 图像的情况。
*   检查 IE 中的 .png 伽玛校正问题 - 有关详细信息，请参阅其他帖子

我在遥远的过去使用的一种解决方法是通过重复一个小图像来设置背景颜色，而不是在 HTML 中设置它。这种技巧在网络安全调色板等时代很有用，但现在用处不大。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-30T19:15:05.410

可能是您测试的浏览器，我在使用 ie 6 时遇到了很多麻烦。

# python - timsort 是通用的还是 Python 特定的？

> ID：154504
> 
> 赞同：32
> 
> 时间：2008-09-30T19:12:46.680
> 
> 标签：python, algorithm, sorting

> Timsort 是一种自适应的、稳定的、自然的归并排序。它在多种部分有序数组上具有超自然的性能（少于所需的 lg(N!) 比较，并且少至 N-1），但速度与 Python 之前在随机数组上高度调整的采样排序混合一样快。

你见过在 CPython 之外使用[timsort吗？](http://svn.python.org/projects/python/trunk/Objects/listsort.txt)是否有意义？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-06-29T20:09:52.003

是的，在特定的 CPython 或 Python 之外使用 timsort 是很有意义的。

目前正在[努力](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6804124)用 timsort 代替 Java 的“修改归并排序”，初步结果相当积极。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-09-30T20:14:57.063

该算法非常通用，但好处是特定于 Python 的。与大多数排序例程不同，Python 的 list.sort（使用 timsort）关心的是避免不必要的比较，因为通常比较比交换项目（总是只是一组指针副本）甚至分配一些更*昂贵*额外的内存（因为它始终只是一个指针数组，与任何 Python 操作的平均开销相比，开销很小。）

如果您受到类似的限制，那么它可能是合适的。不过，我还没有看到任何其他比较真的那么昂贵的情况:-)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-30T20:02:01.023

它看起来并不特别熟悉，但“智能”合并排序在广泛的软件世界中非常普遍。

至于它是否有意义，这取决于您要排序的内容，以及比较与内存分配的相对成本。在内存受限的环境中，需要多达 2*N 字节额外内存的排序不会是一个好的选择。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-10-29T07:36:01.403

现在在[Wikipedia](http://en.wikipedia.org/wiki/Timsort)上回答： timsort 将用于从 Android 复制它的 Java 7。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-06-09T06:53:42.433

Timsort 现在也在 Android 中：[http ://www.kiwidoc.com/java/l/x/android/android/5/p/java.util/c/TimSort](http://www.kiwidoc.com/java/l/x/android/android/5/p/java.util/c/TimSort)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T19:21:28.017

您链接的描述看起来很笼统。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-11-29T18:20:01.127

Timsort*不是*特定于 Python 的。在 Python 中使用 Timsort 对对象引用列表进行排序的好处存在于任何具有指针或对象引用的编程语言中。例如，Java SE 7+、Android 和 Swift 使用 Timsort 对*对象*进行排序。

另一方面，由于缓存一致性，快速排序的某些变体（例如 introsort、dual-pivot 快速排序）通常会更快地对原始类型进行排序，因此通常选择它来执行此任务。

# maven-2 - 关于Maven2中快照的使用问题

> ID：154516
> 
> 赞同：1
> 
> 时间：2008-09-30T19:16:36.767
> 
> 标签：maven-2

我正在为内部 jar 工件编写 POM 文件。该工件取决于我们团队编写的其他几个内部工件。在声明目标的依赖项时，我应该将这些依赖项限制为固定发布版本还是将它们保留为 SNAPSHOT 版本。如果依赖模块的其他SNAPSHOT版本过多，则会在测试中产生不确定性，如果我限制为固定版本，我将无法利用依赖模块的错误修复。那里的做法是什么？

其次，如何命名快照版本> 1.0.0-SNAPSHOT 或1.0-SNAPSHOT。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T19:27:44.243

通常，您应该避免使用快照并仅使用稳定版本，除非您的代码依赖于尚未发布的某些功能（或错误修复）。

至于版本编号，我更喜欢三位数字，从结尾：
修订：修复错误时的
更改次要：添加新功能时的
更改主要：进行不兼容的更改时的更改。
我相信这是（至少一些）Apache Java 库使用的标准。

# c# - 在 C# 中将 WPF 属性绑定到 ApplicationSettings 的最佳方法？

> ID：154533
> 
> 赞同：51
> 
> 时间：2008-09-30T19:20:29.080
> 
> 标签：c#, .net, wpf, visual-studio

在 C# 中将 WPF 属性绑定到 ApplicationSettings 的最佳方法是什么？有没有像 Windows 窗体应用程序那样的自动方式？与[这个问题](https://stackoverflow.com/questions/18421/best-way-to-bind-windows-forms-properties-to-applicationsettings-in-c)类似，您如何（并且有可能）在 WPF 中做同样的事情？

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2008-11-05T00:08:07.227

您可以直接绑定到 Visual Studio 创建的静态对象。

在您的 windows 声明中添加：

```
xmlns:p="clr-namespace:UserSettings.Properties" 
```

应用程序命名空间在哪里`UserSettings`。

然后您可以将绑定添加到正确的设置：

```
<TextBlock Height="{Binding Source={x:Static p:Settings.Default}, 
           Path=Height, Mode=TwoWay}" ....... /> 
```

现在您可以保存设置，例如当您关闭应用程序时：

```
protected override void OnClosing(System.ComponentModel.CancelEventArgs e)
{
    Properties.Settings.Default.Save();
    base.OnClosing(e); 
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-02-10T17:39:18.857

如果您是尝试此操作的**VB.Net**开发人员，答案会有所不同。

```
xmlns:p="clr-namespace:ThisApplication" 
```

请注意 .Properties 不存在。

* * *

在您的绑定中，它是 MySettings.Default，而不是 Settings.Default - 因为 app.config 以不同方式存储它。

```
<TextBlock Height={Binding Source={x:Static p:MySettings.Default}, Path=Height, ... 
```

在拉了一点头发后，我发现了这一点。希望能帮助到你

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-10-19T20:24:18.923

我喜欢接受的答案，但我遇到了一个特殊情况。我将文本框设置为“只读”，这样我只能在代码中更改它的值。尽管我将模式设置为“TwoWay”，但我无法理解为什么该值没有传播回设置。

然后，我发现了这个：http: [//msdn.microsoft.com/en-us/library/system.windows.data.binding.updatesourcetrigger.aspx](http://msdn.microsoft.com/en-us/library/system.windows.data.binding.updatesourcetrigger.aspx)

> 默认值为 Default，它返回目标依赖属性的默认 UpdateSourceTrigger 值。但是，大多数依赖项属性的默认值为 PropertyChanged，而**Text 属性的默认值为 LostFocus**。

因此，如果您的文本框具有 IsReadOnly="True" 属性，则必须将 UpdateSourceTrigger=PropertyChanged 值添加到 Binding 语句：

```
<TextBox Text={Binding Source={x:Static p:Settings.Default}, Path=myTextSetting, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged} ... /> 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-01T09:25:06.507

最简单的方法是绑定到将您的应用程序设置作为属性公开的对象，或者将该对象包含为 StaticResource 并绑定到该对象。

您可以采取的另一个方向是创建自己的[标记扩展](http://msdn.microsoft.com/en-us/library/ms747254.aspx)，这样您就可以简单地使用 PropertyName="{ApplicationSetting SomeSettingName}"。要创建自定义标记扩展，您需要继承[MarkupExtension](http://msdn.microsoft.com/en-us/library/system.windows.markup.markupextension.aspx)并使用[MarkupExtensionReturnType](http://msdn.microsoft.com/en-us/library/system.windows.markup.markupextensionreturntypeattribute.aspx)属性装饰类。[John Bowen](http://blogs.interknowlogy.com/johnbowen)有一篇[关于创建自定义 MarkupExtension](http://blogs.interknowlogy.com/johnbowen/archive/2007/05/16/13445.aspx)的帖子，这可能会使该过程更加清晰。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-30T23:30:20.587

Kris，我不确定这是绑定 ApplicationSettings 的最佳方式，但这就是我在[Witty](http://code.google.com/p/wittytwitter/)中的做法。

1）在窗口/页面/用户控件/容器中为要绑定的设置创建依赖属性。在这种情况下，我有一个用户设置来播放声音。

```
 public bool PlaySounds
    {
        get { return (bool)GetValue(PlaySoundsProperty); }
        set { SetValue(PlaySoundsProperty, value); }
    }

    public static readonly DependencyProperty PlaySoundsProperty =
        DependencyProperty.Register("PlaySounds", typeof(bool), typeof(Options),
        new FrameworkPropertyMetadata(false, new PropertyChangedCallback(OnPlaySoundsChanged)));

    private static void OnPlaySoundsChanged(DependencyObject obj, DependencyPropertyChangedEventArgs args)
    {
        Properties.Settings.Default.PlaySounds = (bool)args.NewValue;
        Properties.Settings.Default.Save();
    } 
```

2) 在构造函数中，初始化属性值以匹配应用程序设置

```
 PlaySounds = Properties.Settings.Default.PlaySounds; 
```

3）在XAML中绑定属性

```
 <CheckBox Content="Play Sounds on new Tweets" x:Name="PlaySoundsCheckBox" IsChecked="{Binding Path=PlaySounds, ElementName=Window, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" /> 
```

您可以下载完整的[Witty 源代码](http://code.google.com/p/wittytwitter/)以查看它的运行情况，或者只浏览[选项窗口的代码](http://code.google.com/p/wittytwitter/source/browse/trunk/Witty/Witty/Options.xaml.cs)。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-07-01T15:17:19.983

我喜欢通过 ViewModel 来做，只是在 XAML 中像往常一样做绑定

```
 public Boolean Value
    {
        get
        {
            return Settings.Default.Value;

        }
        set
        {
            Settings.Default.SomeValue= value;
            Settings.Default.Save();
            Notify("SomeValue");
        }
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T06:50:48.063

另请阅读[这篇](http://www.hanselman.com/blog/LearningWPFWithBabySmashConfigurationWithDataBinding.aspx)关于如何在 BabySmash 中完成的文章

如果您需要更改通知，您只需要使用 DO 支持设置（如 Alan 的示例）！绑定到 POCO 设置类也可以！

# asp.net - 如何确保 Visual Studio 2005 正确显示表格和图像？

> ID：154535
> 
> 赞同：0
> 
> 时间：2008-09-30T19:21:17.970
> 
> 标签：asp.net, html, visual-studio, designer, photoshop

我使用 Photoshop CS2 的“保存为 Web”功能为我的站点布局创建了一个图像表。

此 HTML 在 Web 浏览器中看起来很好，但是当导入 Visual Studio 并在站点设计器中查看时，度量是错误的，并且图像（表格单元格）之间存在水平间隙。

Photoshop 的输出不涉及任何样式表。
表格属性将边框、单元格填充和单元格间距设置为 0。

这是它在设计器中的外观：

![替代文字](https://sites.google.com/site/sizerfx/Home/layout1.png?attredirects=0)

这是它在浏览器中的外观：

![替代文字](https://sites.google.com/site/sizerfx/Home/layout2.png?attredirects=0)

Visual Studio 对表格和图像的布局是否挑剔？这是 Visual Studio 2005 中的错误吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-30T19:34:31.323

我没有玩过“Save for Web”功能，但我很确定输出的 html，除了表格标记和图像，还应该包含一些定义整个页面显示行为的 css 样式。

因此，在将 html 导入 VS 时，请确保关联的样式也被传输。

也不要忘记并确保 HTML 有效性 - 您可以在 web.config 或项目属性中选择 Web 应用程序的一致性级别（或仅在 html 编辑器中 - 将 Target Schema 设置为 XHTML Transitional，您应该确保您从 Photoshop 获得的 html 将得到正确验证。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T17:57:09.560

就我个人而言，我从不信任并且很少使用 Visual Studio 中的设计视图，并且通常将其设置为所有页面的代码视图。我倾向于在 IE 和 Firefox 中打开文件的工作版本，以使我能够看到它们的布局，但这可能会在尝试查看多步骤表单等时导致问题。在这些情况下，我总是倾向于放置一些代码来启用我选择我希望看到的状态/步骤，而不需要通过每个步骤来测试它的所有严谨性。

请记住，在 VS 中，您可以右键单击项目资源管理器中的文件，然后选择在 Web 浏览器中查看它。您还可以将各种不同的浏览器添加到 VS 首选项中，以便您选择希望在其中查看文件的浏览器。

我意识到这不是一个答案，但希望它有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T19:11:14.780

Visual Studio 2005 的设计者似乎在渲染某些 HTML 内容时遇到了困难。正如 Toby 所说，解决该问题的最佳方法是在 Web 浏览器中预览页面，而不是与设计师合作。

当然，另一种选择是使用 Visual Studio 2008，它使用与 Expression Web 中相同的 Web 设计器组件。我还没有将 Visual Studio 2008 广泛用于 Web 项目，但据我所见，它令人印象深刻！Visual Studio 2008 还具有“拆分”视图选项，它允许您在编辑 HTML 时查看设计器（无需在源视图和设计视图之间切换，而且需要几分钟才能赶上您！）

# c++ - 在 C++ 中编码/解码 URL

> ID：154536
> 
> 赞同：95
> 
> 时间：2008-09-30T19:21:21.077
> 
> 标签：c++, urlencode, urldecode, percent-encoding

有谁知道有什么好的 C++ 代码可以做到这一点？

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2013-07-17T19:40:36.487

前几天我遇到了这个问题的一半编码。对可用选项不满意，在查看了[这个 C 示例代码](http://www.geekhideout.com/urlcode.shtml)之后，我决定推出自己的 C++ url-encode 函数：

```
#include <cctype>
#include <iomanip>
#include <sstream>
#include <string>

using namespace std;

string url_encode(const string &value) {
    ostringstream escaped;
    escaped.fill('0');
    escaped << hex;

    for (string::const_iterator i = value.begin(), n = value.end(); i != n; ++i) {
        string::value_type c = (*i);

        // Keep alphanumeric and other accepted characters intact
        if (isalnum(c) || c == '-' || c == '_' || c == '.' || c == '~') {
            escaped << c;
            continue;
        }

        // Any other characters are percent-encoded
        escaped << uppercase;
        escaped << '%' << setw(2) << int((unsigned char) c);
        escaped << nouppercase;
    }

    return escaped.str();
} 
```

decode 函数的实现留给读者作为练习。:P

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2008-09-30T19:41:49.060

回答我自己的问题...

libcurl 有[curl_easy_escape](http://curl.haxx.se/libcurl/c/curl_easy_escape.html)用于编码。

对于解码，[curl_easy_unescape](https://curl.haxx.se/libcurl/c/curl_easy_unescape.html)

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2011-01-28T00:52:06.050

```
string urlDecode(string &SRC) {
    string ret;
    char ch;
    int i, ii;
    for (i=0; i<SRC.length(); i++) {
        if (int(SRC[i])==37) {
            sscanf(SRC.substr(i+1,2).c_str(), "%x", &ii);
            ch=static_cast<char>(ii);
            ret+=ch;
            i=i+2;
        } else {
            ret+=SRC[i];
        }
    }
    return (ret);
} 
```

不是最好的，但工作正常;-)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2014-08-15T22:36:32.137

[cpp-netlib](http://cpp-netlib.org/)有功能

```
namespace boost {
  namespace network {
    namespace uri {    
      inline std::string decoded(const std::string &input);
      inline std::string encoded(const std::string &input);
    }
  }
} 
```

它们允许非常容易地对 URL 字符串进行编码和解码。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2015-04-30T07:59:08.773

通常在编码时将 '%' 添加到 char 的 int 值将不起作用，该值应该是十六进制等效值。例如“/”是“%2F”而不是“%47”。

我认为这是 url 编码和解码的最佳和简洁的解决方案（没有太多的标头依赖项）。

```
string urlEncode(string str){
    string new_str = "";
    char c;
    int ic;
    const char* chars = str.c_str();
    char bufHex[10];
    int len = strlen(chars);

    for(int i=0;i<len;i++){
        c = chars[i];
        ic = c;
        // uncomment this if you want to encode spaces with +
        /*if (c==' ') new_str += '+';   
        else */if (isalnum(c) || c == '-' || c == '_' || c == '.' || c == '~') new_str += c;
        else {
            sprintf(bufHex,"%X",c);
            if(ic < 16) 
                new_str += "%0"; 
            else
                new_str += "%";
            new_str += bufHex;
        }
    }
    return new_str;
 }

string urlDecode(string str){
    string ret;
    char ch;
    int i, ii, len = str.length();

    for (i=0; i < len; i++){
        if(str[i] != '%'){
            if(str[i] == '+')
                ret += ' ';
            else
                ret += str[i];
        }else{
            sscanf(str.substr(i + 1, 2).c_str(), "%x", &ii);
            ch = static_cast<char>(ii);
            ret += ch;
            i = i + 2;
        }
    }
    return ret;
} 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2015-04-16T12:36:02.447

[死灵法师模式开启]
在寻找快速、现代、独立于平台且优雅的解决方案时偶然发现了这个问题。不喜欢上述任何一个，cpp-netlib 将是赢家，但它在“解码”功能中存在可怕的内存漏洞。所以我想出了boost的精神气/业力解决方案。

```
namespace bsq = boost::spirit::qi;
namespace bk = boost::spirit::karma;
bsq::int_parser<unsigned char, 16, 2, 2> hex_byte;
template <typename InputIterator>
struct unescaped_string
    : bsq::grammar<InputIterator, std::string(char const *)> {
  unescaped_string() : unescaped_string::base_type(unesc_str) {
    unesc_char.add("+", ' ');

    unesc_str = *(unesc_char | "%" >> hex_byte | bsq::char_);
  }

  bsq::rule<InputIterator, std::string(char const *)> unesc_str;
  bsq::symbols<char const, char const> unesc_char;
};

template <typename OutputIterator>
struct escaped_string : bk::grammar<OutputIterator, std::string(char const *)> {
  escaped_string() : escaped_string::base_type(esc_str) {

    esc_str = *(bk::char_("a-zA-Z0-9_.~-") | "%" << bk::right_align(2,0)[bk::hex]);
  }
  bk::rule<OutputIterator, std::string(char const *)> esc_str;
}; 
```

上面的用法如下：

```
std::string unescape(const std::string &input) {
  std::string retVal;
  retVal.reserve(input.size());
  typedef std::string::const_iterator iterator_type;

  char const *start = "";
  iterator_type beg = input.begin();
  iterator_type end = input.end();
  unescaped_string<iterator_type> p;

  if (!bsq::parse(beg, end, p(start), retVal))
    retVal = input;
  return retVal;
}

std::string escape(const std::string &input) {
  typedef std::back_insert_iterator<std::string> sink_type;
  std::string retVal;
  retVal.reserve(input.size() * 3);
  sink_type sink(retVal);
  char const *start = "";

  escaped_string<sink_type> g;
  if (!bk::generate(sink, g(start), input))
    retVal = input;
  return retVal;
} 
```

[死灵法师模式关闭]

EDIT01：修复了零填充的东西 - 特别感谢 Hartmut Kaiser
EDIT02：[在 CoLiRu 上直播](http://coliru.stacked-crooked.com/a/a697f0864ef3b09d)

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2015-09-15T21:25:59.117

受 xperroni 启发，我编写了一个解码器。谢谢你的指点。

```
#include <iostream>
#include <sstream>
#include <string>

using namespace std;

char from_hex(char ch) {
    return isdigit(ch) ? ch - '0' : tolower(ch) - 'a' + 10;
}

string url_decode(string text) {
    char h;
    ostringstream escaped;
    escaped.fill('0');

    for (auto i = text.begin(), n = text.end(); i != n; ++i) {
        string::value_type c = (*i);

        if (c == '%') {
            if (i[1] && i[2]) {
                h = from_hex(i[1]) << 4 | from_hex(i[2]);
                escaped << h;
                i += 2;
            }
        } else if (c == '+') {
            escaped << ' ';
        } else {
            escaped << c;
        }
    }

    return escaped.str();
}

int main(int argc, char** argv) {
    string msg = "J%C3%B8rn!";
    cout << msg << endl;
    string decodemsg = url_decode(msg);
    cout << decodemsg << endl;

    return 0;
} 
```

编辑：删除了不需要的 cctype 和 iomainip 包括。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-30T19:27:03.027

[CGICC](http://www.gnu.org/software/cgicc/)包括进行 url 编码和解码的方法。[form_urlencode 和 form_urldecode](http://www.gnu.org/software/cgicc/doc/namespacecgicc.html#90356a1f522eeb502bb68e7d87a1f848)

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2012-01-04T19:31:20.743

在 win32 c++ 应用程序中搜索用于解码 url 的 api 时，我最终遇到了这个问题。由于问题并没有完全指定平台，假设 Windows 不是一件坏事。

InternetCanonicalizeUrl 是 Windows 程序的 API。更多信息[在这里](http://msdn.microsoft.com/en-us/library/windows/desktop/aa384342%28v=vs.85%29.aspx)

```
 LPTSTR lpOutputBuffer = new TCHAR[1];
        DWORD dwSize = 1;
        BOOL fRes = ::InternetCanonicalizeUrl(strUrl, lpOutputBuffer, &dwSize, ICU_DECODE | ICU_NO_ENCODE);
        DWORD dwError = ::GetLastError();
        if (!fRes && dwError == ERROR_INSUFFICIENT_BUFFER)
        {
            delete lpOutputBuffer;
            lpOutputBuffer = new TCHAR[dwSize];
            fRes = ::InternetCanonicalizeUrl(strUrl, lpOutputBuffer, &dwSize, ICU_DECODE | ICU_NO_ENCODE);
            if (fRes)
            {
                //lpOutputBuffer has decoded url
            }
            else
            {
                //failed to decode
            }
            if (lpOutputBuffer !=NULL)
            {
                delete [] lpOutputBuffer;
                lpOutputBuffer = NULL;
            }
        }
        else
        {
            //some other error OR the input string url is just 1 char and was successfully decoded
        } 
```

InternetCrackUrl ([这里](http://msdn.microsoft.com/en-us/library/windows/desktop/aa384376%28v=vs.85%29.aspx)) 似乎也有标志来指定是否解码 url

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2014-10-23T00:47:59.900

Windows API 具有用于此任务的功能[UrlEscape](http://msdn.microsoft.com/en-us/library/windows/desktop/bb773774(v=vs.85).aspx) / [UrlUnescape](https://msdn.microsoft.com/en-us/library/windows/desktop/bb773791(v=vs.85).aspx)，由 shlwapi.dll 导出。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2011-06-28T22:11:48.090

为 Bill 的使用 libcurl 的建议添加后续内容：很好的建议，并且要更新：
3 年后，不推荐使用[curl_escape](http://curl.haxx.se/libcurl/c/curl_escape.html)函数，因此为了将来的使用，最好使用[curl_easy_escape](http://curl.haxx.se/libcurl/c/curl_easy_escape.html)。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2017-01-02T23:16:20.480

我在这里找不到同时解码 2 和 3 字节序列的 URI 解码/取消转义。贡献我自己的版本，即时将 c sting 输入转换为 wstring：

```
#include <string>

const char HEX2DEC[55] =
{
     0, 1, 2, 3,  4, 5, 6, 7,  8, 9,-1,-1, -1,-1,-1,-1,
    -1,10,11,12, 13,14,15,-1, -1,-1,-1,-1, -1,-1,-1,-1,
    -1,-1,-1,-1, -1,-1,-1,-1, -1,-1,-1,-1, -1,-1,-1,-1,
    -1,10,11,12, 13,14,15
};

#define __x2d__(s) HEX2DEC[*(s)-48]
#define __x2d2__(s) __x2d__(s) << 4 | __x2d__(s+1)

std::wstring decodeURI(const char * s) {
    unsigned char b;
    std::wstring ws;
    while (*s) {
        if (*s == '%')
            if ((b = __x2d2__(s + 1)) >= 0x80) {
                if (b >= 0xE0) { // three byte codepoint
                    ws += ((b & 0b00001111) << 12) | ((__x2d2__(s + 4) & 0b00111111) << 6) | (__x2d2__(s + 7) & 0b00111111);
                    s += 9;
                }
                else { // two byte codepoint
                    ws += (__x2d2__(s + 4) & 0b00111111) | (b & 0b00000011) << 6;
                    s += 6;
                }
            }
            else { // one byte codepoints
                ws += b;
                s += 3;
            }
        else { // no %
            ws += *s;
            s++;
        }
    }
    return ws;
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-11-09T10:44:03.063

这个版本是纯 C 并且可以选择规范化资源路径。将它与 C++ 一起使用很简单：

```
#include <string>
#include <iostream>

int main(int argc, char** argv)
{
    const std::string src("/some.url/foo/../bar/%2e/");
    std::cout << "src=\"" << src << "\"" << std::endl;

    // either do it the C++ conformant way:
    char* dst_buf = new char[src.size() + 1];
    urldecode(dst_buf, src.c_str(), 1);
    std::string dst1(dst_buf);
    delete[] dst_buf;
    std::cout << "dst1=\"" << dst1 << "\"" << std::endl;

    // or in-place with the &[0] trick to skip the new/delete
    std::string dst2;
    dst2.resize(src.size() + 1);
    dst2.resize(urldecode(&dst2[0], src.c_str(), 1));
    std::cout << "dst2=\"" << dst2 << "\"" << std::endl;
} 
```

输出：

```
src="/some.url/foo/../bar/%2e/"
dst1="/some.url/bar/"
dst2="/some.url/bar/" 
```

和实际功能：

```
#include <stddef.h>
#include <ctype.h>

/**
 * decode a percent-encoded C string with optional path normalization
 *
 * The buffer pointed to by @dst must be at least strlen(@src) bytes.
 * Decoding stops at the first character from @src that decodes to null.
 * Path normalization will remove redundant slashes and slash+dot sequences,
 * as well as removing path components when slash+dot+dot is found. It will
 * keep the root slash (if one was present) and will stop normalization
 * at the first questionmark found (so query parameters won't be normalized).
 *
 * @param dst       destination buffer
 * @param src       source buffer
 * @param normalize perform path normalization if nonzero
 * @return          number of valid characters in @dst
 * @author          Johan Lindh <johan@linkdata.se>
 * @legalese        BSD licensed (http://opensource.org/licenses/BSD-2-Clause)
 */
ptrdiff_t urldecode(char* dst, const char* src, int normalize)
{
    char* org_dst = dst;
    int slash_dot_dot = 0;
    char ch, a, b;
    do {
        ch = *src++;
        if (ch == '%' && isxdigit(a = src[0]) && isxdigit(b = src[1])) {
            if (a < 'A') a -= '0';
            else if(a < 'a') a -= 'A' - 10;
            else a -= 'a' - 10;
            if (b < 'A') b -= '0';
            else if(b < 'a') b -= 'A' - 10;
            else b -= 'a' - 10;
            ch = 16 * a + b;
            src += 2;
        }
        if (normalize) {
            switch (ch) {
            case '/':
                if (slash_dot_dot < 3) {
                    /* compress consecutive slashes and remove slash-dot */
                    dst -= slash_dot_dot;
                    slash_dot_dot = 1;
                    break;
                }
                /* fall-through */
            case '?':
                /* at start of query, stop normalizing */
                if (ch == '?')
                    normalize = 0;
                /* fall-through */
            case '\0':
                if (slash_dot_dot > 1) {
                    /* remove trailing slash-dot-(dot) */
                    dst -= slash_dot_dot;
                    /* remove parent directory if it was two dots */
                    if (slash_dot_dot == 3)
                        while (dst > org_dst && *--dst != '/')
                            /* empty body */;
                    slash_dot_dot = (ch == '/') ? 1 : 0;
                    /* keep the root slash if any */
                    if (!slash_dot_dot && dst == org_dst && *dst == '/')
                        ++dst;
                }
                break;
            case '.':
                if (slash_dot_dot == 1 || slash_dot_dot == 2) {
                    ++slash_dot_dot;
                    break;
                }
                /* fall-through */
            default:
                slash_dot_dot = 0;
            }
        }
        *dst++ = ch;
    } while(ch);
    return (dst - org_dst) - 1;
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-05-28T07:03:39.643

多汁的部分

```
#include <ctype.h> // isdigit, tolower

from_hex(char ch) {
  return isdigit(ch) ? ch - '0' : tolower(ch) - 'a' + 10;
}

char to_hex(char code) {
  static char hex[] = "0123456789abcdef";
  return hex[code & 15];
} 
```

注意到

```
char d = from_hex(hex[0]) << 4 | from_hex(hex[1]); 
```

如在

```
// %7B = '{'

char d = from_hex('7') << 4 | from_hex('B'); 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-01-22T10:16:45.757

您可以简单地使用 atlutil.h 中的函数 AtlEscapeUrl()，只需阅读有关如何使用它的文档即可。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-04-05T16:36:18.683

另一种解决方案是使用[Facebook 的 folly 库](https://github.com/facebook/folly)：`folly::uriEscape`和`folly::uriUnescape`.

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-03-11T13:39:04.353

您可以使用 glib.h 提供的“g_uri_escape_string()”函数。 [https://developer.gnome.org/glib/stable/glib-URI-Functions.html](https://developer.gnome.org/glib/stable/glib-URI-Functions.html)

```
#include <stdio.h>
#include <stdlib.h>
#include <glib.h>
int main() {
    char *uri = "http://www.example.com?hello world";
    char *encoded_uri = NULL;
    //as per wiki (https://en.wikipedia.org/wiki/Percent-encoding)
    char *escape_char_str = "!*'();:@&=+$,/?#[]"; 
    encoded_uri = g_uri_escape_string(uri, escape_char_str, TRUE);
    printf("[%s]\n", encoded_uri);
    free(encoded_uri);

    return 0;
} 
```

编译它：

```
gcc encoding_URI.c `pkg-config --cflags --libs glib-2.0` 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-11-10T21:04:37.940

我知道这个问题要求使用 C++ 方法，但对于那些可能需要它的人，我想出了一个用纯 C 语言编写的非常短的函数来对字符串进行编码。它不会创建新字符串，而是更改现有字符串，这意味着它必须有足够的大小来容纳新字符串。很容易跟上。

```
void urlEncode(char *string)
{
    char charToEncode;
    int posToEncode;
    while (((posToEncode=strspn(string,"1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_.~"))!=0) &&(posToEncode<strlen(string)))
    {
        charToEncode=string[posToEncode];
        memmove(string+posToEncode+3,string+posToEncode+1,strlen(string+posToEncode));
        string[posToEncode]='%';
        string[posToEncode+1]="0123456789ABCDEF"[charToEncode>>4];
        string[posToEncode+2]="0123456789ABCDEF"[charToEncode&0xf];
        string+=posToEncode+3;
    }
} 
```

* * *

## 回答 #19

> 赞同：-2
> 
> 时间：2015-02-04T16:27:55.240

必须在没有 Boost 的项目中这样做。所以，最后写了我自己的。我会把它放在 GitHub 上：[https ://github.com/corporateshark/LUrlParser](https://github.com/corporateshark/LUrlParser)

```
clParseURL URL = clParseURL::ParseURL( "https://name:pwd@github.com:80/path/res" );

if ( URL.IsValid() )
{
    cout << "Scheme    : " << URL.m_Scheme << endl;
    cout << "Host      : " << URL.m_Host << endl;
    cout << "Port      : " << URL.m_Port << endl;
    cout << "Path      : " << URL.m_Path << endl;
    cout << "Query     : " << URL.m_Query << endl;
    cout << "Fragment  : " << URL.m_Fragment << endl;
    cout << "User name : " << URL.m_UserName << endl;
    cout << "Password  : " << URL.m_Password << endl;
} 
```

# apache-flex - 如何禁用 Flex Text 控件中的复制/粘贴？

> ID：154538
> 
> 赞同：3
> 
> 时间：2008-09-30T19:21:46.643
> 
> 标签：apache-flex, actionscript-3

长话短说，我需要在我的 Flex 应用程序中添加一些文本，并且我不希望用户能够复制。我打算使用标签，但显然标签不支持文本换行。我可以让用户无法在 Flex Text 控件中选择文本吗？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T20:54:20.447

您可以使用 Text 控件并将 selectable 属性设置为 false ...

```
 <mx:Text width="175" selectable="false" text="This is an example of a multiline text string in a Text control." /> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-30T14:28:11.207

您可以通过捕获 textInput 事件来禁用超过 1 个字符的粘贴：

```
 private function onTextInput(e:flash.events.TextEvent):void
{
  if (e.text.length > 1) 
    e.preventDefault();
} 

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T20:20:30.217

您可以将 enabled 属性设置为“false”，以禁用用户交互。您可能还希望将 disabledcolor 属性更改为您的选择。

```
print("
        <mx:Text enabled="false" disabledColor="0x000000" text=Text"/>
"); 
```

# user-interface - 使您的网站布局适合低分辨率显示器有多重要？

> ID：154542
> 
> 赞同：11
> 
> 时间：2008-09-30T19:23:00.883
> 
> 标签：user-interface

使网站布局适合 640 x 480 和 800 x 600 显示器有多重要？一段时间以来，我一直在假设*至少为*1024 x 768 进行设计，但我并没有专业地做这件事（只是在我的网站上，它只是一个只有 10-15 位朋友阅读的博客）。有没有人有任何关于真实网络用户的屏幕分辨率分布的非轶事统计数据？

***注意 1：** “非轶事”是指请不要给出“我认识很多人使用 640x480”或“我妈妈在 800x600 中运行，所以它一定很常见”之类的答案。我宁愿拥有实际数据（或指向实际数据的链接），特别是如果它是关于一般用户（而不是极客）的数据。*

***注 2：**我不关心 PDA 和手机上的极小显示器（至少目前不关心）。我只是在谈论台式机/笔记本电脑显示器。*

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-30T19:27:04.150

W3Schools 跟踪各种浏览器统计数据，包括显示分辨率。您可以在此处找到显示分辨率：http: [//www.w3schools.com/browsers/browsers_display.asp](http://www.w3schools.com/browsers/browsers_display.asp)

当然，您应该使用尽可能接近目标受众的统计数据。这些统计数据来自浏览 W3School 网站的人（主要是开发人员）的浏览器。其他目标受众可能有不同的个人资料。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-30T19:26:41.920

我认为这些天的一般假设是 1024x768 是可以接受的，这当然是我采取的路线。一个很好的基准是查看像[BBC](http://www.bbc.co.uk)这样的大型网站，他们最近切换到 1024x768 设计。这并不是说每个站点都必须是这样，对于较小的站点，我经常坚持使用 800x600，只是为了内容看起来不那么可悲:o)

这是我经常用于网络统计的来源，其[2008 年 8 月的统计数据](http://www.thecounter.com/stats/2008/August/res.php)显示 800x600 为 7%。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-30T19:36:14.707

你在我的网络浏览器中运行。即使我使用的是 1024x768，您如何确定我的浏览器是全屏的？

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-30T19:34:27.377

我刚刚检查了我监控的所有域的[谷歌分析](https://www.google.com/analytics/)数据。小于 800x600 的屏幕分辨率为零，而 800x600 的屏幕分辨率为 3-6%

也许您可以提前在域上设置 Google Analytics，并收集有关访问者的一些信息。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-30T19:36:45.577

如果您可以使您的网站支持稍低的分辨率，那可能是值得的。这样人们就可以在非全屏窗口中运行您的网站，而且它看起来仍然不错，并且不会有丑陋的滚动条。

此外，诸如[Asus EEE](http://eeepc.asus.com/global/product.htm)之类的“上网本”也越来越受欢迎，它们通常具有小屏幕（9-10 英寸）和非常适中的分辨率（例如 800x480 或 1024x600）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-30T20:01:13.100

这是一个轶事答案，但需要注意的是......

我们为内部使用的客户端设计了一个 Web 应用程序（实际上是一个瘦客户端 Intranet 应用程序）。我们被告知首选 1024x768 设计，因为几乎所有用户都具有该分辨率或更高。事实上，我们被告知忽略用户报告的以较低分辨率运行的任何问题，因为他们的内部帮助台回答是“将您的分辨率设置为 1024x768 或更高，并在浏览器最大化的情况下运行”。

部署应用程序后，页面上出现了需要太多水平滚动的帮助台票证，并且有些东西没有正确定位，但报告的分辨率为 1024x768。我们没有考虑到使用浏览器侧边栏（历史、书签、RSS 提要等）的用户。我们的开发人员都没有使用过它们，所以他们从来没有想过。未正确定位的零件是我们真正的错误。水平滚动是因为我们将所有内容都设置为自动调整大小，但在 768 处停止水平调整大小（实际上客户区宽度为 1024x768）。

也不要忘记用户可能会将他们的文本大小设置更改为奇怪的设置。实际上，当用户有视力障碍时，这并不奇怪，但重要的是要记住测试并适应它。Firefox 3 在按比例调整文本和图像方面做得很好，但运行其他和旧版浏览器的用户控制较少。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-30T20:38:11.483

一个好的做法是将网站的核心设计在 750 像素左右，这样我们仍有 800 像素显示器的 5%-15% 的观众可以在不滚动的情况下阅读它。然后，您可以将不太重要的信息（广告、非关键任务功能）放在右侧的额外 250 像素列中，对于 1024 像素或更大的访问者可见。

此外，正如 jimharries99 所建议的那样，屏幕（或浏览器或其他任何东西）的互联网范围内的统计数据可能与您的受众资料不匹配，因此您应该使用分析来了解您的特定受众。例如，我们建立的一些网站的大部分流量都来自某个政府机构，该机构以 IE6 为标准（禁止其他浏览器）并拥有大量 800x600 显示器。另一方面，《连线》杂志的观众可能拥有比平均水平更大的屏幕和更现代的浏览器。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-30T21:07:47.153

就我个人而言，我设计网站时，它们会按照我的设想出现在 1024 x 768 显示器上。我知道有些人会打开他们的浏览器，有些人也会有更大的显示器并让它全屏运行。

我觉得目前 1024 x 768 是正确的妥协水平。同时，我尝试确保我的网站在可接受的较低分辨率下降级，以使浏览器在窗口模式下运行的人们也感到高兴。如果迫在眉睫而我别无选择，我宁愿排除较低的分辨率并保持我的视野完好无损，这样它所产生的影响就不会丢失。

但是，使用现代浏览器，用户可以缩小，因此根据站点的内容，可降解性问题可能没有实际意义——如果布局对于 res 来说太大，用户可以简单地缩小。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-30T19:26:56.757

这是一篇[有趣的博客文章](http://www.tamingthebeast.net/blog/web-development/monitor-resolution-statistics-0208.htm)，根据今年 2 月该特定网络网站的 600 万次点击，给出了具体的统计数据。

前两位：**47%** 1024x768 和**30%** 1280x1024

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-30T19:28:13.493

Valve 通过 Steam 收集连接到它们的机器的能力数据，您可以在此处查看结果：

[http://steampowered.com/status/survey.html](http://steampowered.com/status/survey.html)

请记住，这些是游戏玩家的系统，因此往往比普通电脑更强大，正如您所见，1024*768 以下的系统并不多

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-30T19:38:40.627

虽然我同意 1024x768 通常是一个很好的最低桌面分辨率，但我似乎花费了越来越多的时间通过较小的面板查看网站 - 特别是 Windows Mobile 设备、iPhone，有时还有 800 x 480 的 eeepc。

虽然 eeepc 可能不寻常（毫无疑问将在机器类上被 1024x768 取代），但移动设备的访问量只会增加，这将是明智的 - 特别是如果您正在运行人们想要连接的那种网站远离桌面以了解您的网站在手持设备上的工作方式。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-30T19:44:25.200

根据[Jakob Nielsen 的 Alertbox](http://www.useit.com/alertbox/screen_resolution.html)，截至 2006 年 7 月，60% 的显示器设置为 1024x768，因此针对该分辨率优化您的网站是他的建议。

为您的网站设置较低分辨率的样式有多重要？我想这个问题的答案取决于您的网站在 800x600（及以下）下的显示效果......如果它不可读，那么这就是该受众对您的网站的重要性的问题。如果您需要每个观众，无论他们的分辨率如何，那么您应该设计能够为偶尔使用 640x480 的人带来可以忍受的体验的样式。如果没有，您可以尝试像以前一样对其进行样式设置，并且仅在您有商业案例时才使用替代样式。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-30T19:44:59.973

将 Google Analytics 添加到您的网站，它是免费的，数据只会与您的受众有关

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-30T19:56:29.243

我认为真正的答案是设计您的网站，使其以较低的分辨率优雅地降级。在内容主列的右侧和左侧设置不会调整大小并导致网站主要内容挤压的栏并不是一个好主意。

就像已经指出的那样，仅仅因为一个人以 1280x1024 运行并不意味着他们的网络浏览器将被最大化——有些人坚持在非最大化窗口中运行所有内容（我认为 Mac 曾经强制执行此操作）。更不用说那些有 10 个工具栏并且只以 800x600 运行的人，因为操作系统不再让他们进入 640x480（然后他们想知道为什么所有东西在 LCD 屏幕上看起来都很“模糊”，为什么他们的眼睛是去拉屎）

当然，以这种方式设计您的网站并不总是您所拥有的奢侈品 - 有时客户希望它与 Photoshop 设计的带有巨大显示器的像素完美匹配。尽你所能，并准备好以后有一个“这就是你所说的你想要的”的论点（假设你不能事先向他们成功解释）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-30T20:01:06.533

我是否可以建议您使用适合浏览器窗口的自动调整大小的布局，不管它有多宽？虽然您可能将其设计为在 1024x768 下看起来最好，但分辨率较低的人（例如，由于视力不佳或计算机便宜）根本无法使用更高的分辨率，并且不应该左右滚动来阅读每一行文字。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-30T20:48:23.753

我有一个 1920 X 1200 的屏幕尺寸，所以我可以同时打开多个窗口并查看它们。如果一个站点贪婪地试图为自己使用所有这些空间，我将停止访问该站点。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-30T21:46:46.280

将网站设计为 700-800 像素宽的原因有两个。

1.  当列不太宽时，文本更容易阅读。如果您使用 400-500 像素宽的文本，您就有空间容纳 250-400 像素的侧栏，它适用于各种尺寸的屏幕。

2.  您的页面打印得更好。我运行一个站点，其中包含许多用户可能打印的信息，并且在打印 css 中禁用了侧边栏，页面非常适合一张纸。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2008-09-30T19:40:57.503

看，显示器越来越大，人们想要的也越来越多。人们喜欢更大的显示器。唯一拥有小显示器的人是共享计算机中心或一些老年人。

@All，我们需要作为开发人员一起加入，并且只需要在 1024x768 上构建应用程序。如果我们大家齐心协力，我们将使其成为标准。

不要问你的显示器能为你做什么，要问你能为显示器做什么！

# c# - Panel.Dock 填充忽略其他 Panel.Dock 设置

> ID：154543
> 
> 赞同：163
> 
> 时间：2008-09-30T19:23:17.483
> 
> 标签：c#, .net, winforms, visual-studio-2005

如果您在表单上创建一个面板并将其设置为 Dock=Top，然后放下另一个面板并设置其 Dock=Fill，它可能会填充整个表单，而忽略第一个面板。更改标签顺序没有任何作用。

* * *

## 回答 #1

> 赞同：356
> 
> 时间：2010-03-01T14:36:56.907

停靠布局取决于同级控件的**顺序**。控件停靠“按钮向上”，因此**集合中的最后一个控件首先停靠**。*停靠控件仅考虑先前*停靠的兄弟姐妹的布局。因此，如果您希望它考虑其他停靠控件，则 Dock=Fill 的控件应该在同级顺序中位于第一个（顶部）。如果它不是第一个控件，则较早的控件将与其重叠。

这可能会造成混淆，因为同级顺序不一定与视觉顺序相同，并且同级顺序在设计视图中并不总是显而易见的。

**文档大纲**窗口（视图 -> 其他窗口 -> 文档大纲）提供了一个有用的控件层次结构和顺序的树视图，并允许您更改控件的同级顺序。

您还可以通过上下文菜单直接在设计器中更改兄弟顺序 -> 放在前面/发送到后面，这会将控件移动到兄弟姐妹的第一个或最后一个。这些菜单标签可能会有些混乱，因为实际效果取决于布局模型。

使用固定定位控件，2D 位置与兄弟顺序无关，但当控件重叠时，顺序中最早的控件将“在顶部”，隐藏顺序后面的部分兄弟。在这种情况下，放在前面/放在后面是有意义的。

在流程或表格布局面板中，创建顺序决定了控件的视觉顺序。没有重叠的控件。所以带到前面/发送到后面实际上意味着按照控件的顺序先制作或最后制作。

使用停靠布局，放在前面/放在后面可能会更加混乱，因为它决定了计算停靠的顺序，所以在填充停靠控件上“放在前面”会将控件放在父控件的*中间*，考虑到所有边缘停靠控件。

* * *

## 回答 #2

> 赞同：115
> 
> 时间：2008-09-30T19:23:32.257

使用 Dock=Fill 右键单击​​面板，然后单击“置于前面”。

这使得该控件最后创建，这考虑了同一容器中其他控件的 Dock 设置。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2015-02-11T16:22:49.623

我遇到了同样的问题，我设法解决了。
如果你有一个容器和 `DockStyle.Fill`其他容器也应该有 DockStyle 但 Top 或任何你想要的。
重要的是 `DockStyle.Fill`先在 Controls 中添加控件，然后再在其他控件中添加控件。

例子：

```
ComboBox cb = new ComboBox();
cb.Dock =  DockStyle.Top;

GridView gv = new GridView();
gv.Dock =  DockStyle.Fill;

Controls.Add(gv); // this is okay
Controls.Add(cb); 
```

但是如果我们把 cb 放在第一位

```
Controls.Add(cb);
Controls.Add(gv); // gv will overlap the combo box. 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-30T19:36:13.503

另一个可能更简洁的选项是使用 TableLayout 控件。为您的顶部码头设置一排所需高度，另一排为底部填充 100%。将里面的两个面板都设置为填充，就完成了。

（不过，TableLayout 确实需要一些时间来适应。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-07-10T09:23:22.520

如果您不想更改代码中元素的顺序，您可以使用Container.Controls.SetChildIndex() 方法，Container 是您想要添加控件的例如Form、Panel 等。

例子：

```
 //Container ------------------------------------
     Panel Container = new Panel();

     //Top-Docked Element ---------------------------
     ButtonArea = new FlowLayoutPanel();
     Container.Controls.Add(ButtonArea);
     Container.Controls.SetChildIndex(ButtonArea, 1);
     ButtonArea.Dock = DockStyle.Top;

     //Fill-Docked Element --------------------------
     box = new RichTextBox();
     Container.Controls.Add(box);
     Container.Controls.SetChildIndex(box, 0); //setting this to 0 does the trick
     box.Dock = DockStyle.Fill; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-08-07T20:44:54.913

JacquesB 有文档大纲的想法，但层次结构并没有解决我的问题。我的控件不是分层样式，它们只是与同一个父级一起列出。

我了解到，如果您更改顺序，它将修复您想要的外观。

列表底部的控件将与“文档大纲”窗口中顶部的控件重叠。在您的情况下，您将确保第一个面板位于第二个面板下方，依此类推。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-09-01T20:56:08.570

这是一个对我有用的技巧..

放置顶部项目并将其停靠在顶部。

放置一个拆分器，并将其停靠在顶部，然后将其设置为禁用（除非您想调整顶部的大小）。

然后放置填充对象并将停靠设置为填充。该对象将停留在拆分器下方。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-05-08T13:45:54.237

我遇到了同样的问题。我的是在运行时在菜单条下方添加新的/自定义控件。问题是停靠时的控件，决定从表单顶部停靠并完全忽略菜单条，如果你问我，这很烦人。由于这必须通过代码动态完成，而不是在设计模式期间，这变得非常令人沮丧。我发现最简单的方法是在设计模式下创建一个面板并停靠在菜单条下方。从那里您可以将控件添加/删除到面板，您可以在运行时停靠它。无需弄乱表单上不需要更改的所有控件，过多的工作取决于您真正需要做的事情。

```
object.dock = Fill
Panel.Controls.Add(object) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-05-01T12:23:50.953

我知道这是一篇旧帖子，但我发现了一些有用的东西。要以编程方式为动态创建的控件调整同级控件顺序，您可以执行以下操作：

```
parentForm.Controls.SetChildIndex (myPanel, 0) 
```

就我而言，我这样做是为了将 Dock/Fill 面板移动为表单中的第一个控件，这样它就不会与另一个设置为 Dock/Top（菜单条）的停靠控件重叠。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-08-27T12:04:20.433

也可能是采用“填充”组件并右键单击，剪切并粘贴到所需区域的快速解决方案。

# c++ - 控制获取热键，如制表符和空格

> ID：154547
> 
> 赞同：1
> 
> 时间：2008-09-30T19:24:16.997
> 
> 标签：c++, mfc, user-interface, hotkeys

我有一个对话框，允许用户设置热键以在 Windows 上的 3d 程序中使用。我正在使用 CHotKeyCtrl，它非常好，但不处理用户想要使用的某些键 - 特别是制表符和空格。

热键处理足够智能，可以触发这些键，我只需要一个 UI 来设置它们。类似于 CHotKeyCtrl 的控件将是理想的，但其他解决方法也值得赞赏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T03:23:42.243

一种解决方法是使用带有消息挂钩功能的标准编辑控件。

这将允许您捕获发送到该编辑控件的键盘**WM_KEYDOWN消息。**

钩子函数看起来像这样：

```
 LRESULT CALLBACK MessageHook(int code, WPARAM wParam, LPMSG lpMsg)
    {
      LRESULT lResult = 0;

      if ((code >= 0) && (code == MSGF_DIALOGBOX))
      {
        if (lpMsg->message == WM_KEYDOWN)
        {
          //-- process the key down message
          lResult = 1;
        }
      }

      // do default processing if required
      if (lResult == 0)
      {
        lResult = CallNextHookEx(MessageFilterHook, code, wParam, (LPARAM)lpMsg);
      }

      return lResult;
    } 
```

当编辑控件获得焦点时，挂钩可以附加到编辑控件，如下所示：

```
 //-- create an instance thunk for our hook callback
    FARPROC FilterProc = (FARPROC) MakeProcInstance((HOOKPROC)(MessageHook),
                                                    hInstance);
    //-- attach the message hook
    FilterHook = SetWindowsHookEx(WH_MSGFILTER, 
                                 (HOOKPROC)FilterProc, 
                                  hInstance, GetCurrentThreadId()); 
```

and removed when the edit control when looses focus as follows:

```
 //-- remove a message hook
    UnhookWindowsHookEx(MessageFilterHook); 
```

Using this approach every key press will be sent to the hook, provided the edit control has focus.

# sql-server - 将 SQL2000 数据库迁移到另一台机器上的 SQL2005

> ID：154549
> 
> 赞同：2
> 
> 时间：2008-09-30T19:24:54.797
> 
> 标签：sql-server, database-migration

几天来，我一直在用这个应用程序迁移来打败自己。我拥有的是一个由 MSSQL Server 2000 支持的旧应用程序，它正在升级到运行 SMSQL Server 2005 的 Windows 2003 Server。我对 SQL Server 知之甚少，但显然还不够。

我尝试通过转到数据库-> [数据库]->所有任务->备份数据库...，选择“完整”并保存文件来备份旧服务器上的数据库。我将该备份文件移至新服务器并尝试进行还原，但它抱怨说它正在旧服务器上的位置寻找 [Database].mdf 文件。

所以然后我尝试做一个导出数据，选择本地 SQL 2000 数据库，将它指向另一台机器上的新 SQL 2005 数据库，它一直到最后并死去抱怨其中一个表的方式是被加入。

然后我尝试在 2000 框上执行“生成 SQL”命令并在 SQL 2005 下运行该命令。看起来有很多外部连接使用 SQL Server 2005 不再支持的旧 *= 语法，这是一个供应商数据库，不知道他们设置这些表时的真正意图是什么。

有没有其他方法可以尝试迁移这个数据库？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T19:29:19.947

备份文件具有存储在其中的数据文件的“硬”位置。您只需要更新它们：

当您在 2005 中恢复时，在单击最后的“确定”进行恢复之前（在您选择 .bak 文件之后），请转到选项选项卡。这将具有备份文件中的 mdf 和 ldf 位置。将这些更改为新机器上的合法目录。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T19:28:48.110

您可以将数据库与旧服务器分离，将 mdf 和 ldf（以及任何其他相关文件）复制到服务器服务器，然后将数据库附加到新服务器。

当您附加它时，SQL Server 会将其升级为 2005 格式的数据库。如果您在兼容性方面遇到问题，您也可以更改它。在 SQL Server Management Studio 中，右键单击您的数据库，单击属性，单击选项，然后将兼容模式更改为“SQL Server 2000 (80)”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T19:44:21.333

正如彼得所指出的，您必须将路径更改为新服务器上存在的新路径。
这张照片将有助于：

![恢复](https://farm4.static.flickr.com/3216/2902861378_86da17a65e.jpg?v=1222804266)

我几年前学到的一个技巧是单击最后一个选项按钮（“将数据库保留为只读...”）一分钟，以查看和复制数据文件在新服务器中的位置。**只是不要忘记在恢复之前将其放回第一个选项**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-12-16T14:21:08.247

将 SQL2000 的数据库备份到文件中。在 SQL2005 上创建具有相同名称的新数据库，并使用选项“强制恢复现有数据库”将备份文件恢复到新数据库中，并将新数据库的合规级别设置为“SQL2000 (8.0)”。

# c# - 易失性与互锁性与锁定性

> ID：154551
> 
> 赞同：753
> 
> 时间：2008-09-30T19:25:06.760
> 
> 标签：c#, multithreading, locking, volatile, interlocked

假设一个类有一个`public int counter`由多个线程访问的字段。这`int`只是增加或减少。

要增加这个字段，应该使用哪种方法，为什么？

*   `lock(this.locker) this.counter++;`,
*   `Interlocked.Increment(ref this.counter);`,
*   将访问修饰符更改为`counter`to `public volatile`。

现在我发现了`volatile`，我一直在删除许多`lock`语句和`Interlocked`. 但是有理由不这样做吗？

* * *

## 回答 #1

> 赞同：955
> 
> 时间：2008-09-30T20:13:08.237

### 最差（实际上不起作用）

> 将访问修饰符更改为`counter`to`public volatile`

正如其他人所提到的，这本身并不安全。关键`volatile`是在多个 CPU 上运行的多个线程可以并且将缓存数据并重新排序指令。

如果**不是** `volatile`，并且 CPU A 增加一个值，那么 CPU B 可能直到一段时间后才能真正看到该增加的值，这可能会导致问题。

如果是`volatile`，这只是确保两个 CPU 同时看到相同的数据。它根本不会阻止他们交错读取和写入操作，这是您要避免的问题。

### 次好的：

> `lock(this.locker) this.counter++`;

这样做是安全的（只要您记得`lock`您访问的其他任何地方`this.counter`）。它防止任何其他线程执行任何其他由`locker`. 使用锁也可以防止如上所述的多 CPU 重新排序问题，这很棒。

问题是，锁定很慢，如果你在其他一些不相关的地方重新使用，`locker`那么你最终可能会无缘无故地阻塞你的其他线程。

### 最好的

> `Interlocked.Increment(ref this.counter);`

这是安全的，因为它有效地执行了不可中断的“一击”读取、递增和写入操作。正因为如此，它不会影响任何其他代码，你也不需要记住在其他地方锁定。它也非常快（正如 MSDN 所说，在现代 CPU 上，这通常实际上是一条 CPU 指令）。

~~但是，我不完全确定它是否可以绕过其他 CPU 重新排序，或者您是否还需要将 volatile 与增量相结合。~~

联锁注意事项：

1.  互锁方法在任何数量的内核或 CPU 上都是安全的。
2.  互锁方法在它们执行的指令周围应用了一个完整的栅栏，因此不会发生重新排序。
3.  Interlocked 方法**不需要甚至不支持对 volatile 字段的访问**，因为 volatile 在给定字段上的操作周围放置了半栅栏，而 interlocked 则使用完整栅栏。

### 脚注： volatile 实际上有什么好处。

由于`volatile`不能防止这些类型的多线程问题，它有什么用？一个很好的例子是说你有两个线程，一个总是写入一个变量（比如`queueLength`），一个总是从同一个变量中读取。

如果`queueLength`不是 volatile，线程 A 可能会写入五次，但线程 B 可能会将这些写入视为延迟（甚至可能以错误的顺序）。

一种解决方案是锁定，但在这种情况下您也可以使用 volatile。这将确保线程 B 将始终看到线程 A 编写的最新内容。但是请注意，此逻辑*仅*适用于您有从不阅读的作者和从不写作的读者，*并且*您正在编写的内容是原子值的情况。一旦您执行了一次读取-修改-写入，您就需要进行互锁操作或使用锁。

* * *

## 回答 #2

> 赞同：157
> 
> 时间：2008-09-30T19:29:35.003

**编辑：**正如评论中所指出的，这些天我很高兴将其`Interlocked`用于*显然可以的**单个变量*的情况。当它变得更复杂时，我仍然会恢复锁定......

 *当您需要增加时，使用`volatile`将无济于事 - 因为读取和写入是单独的指令。另一个线程可以在您阅读之后但在您回写之前更改该值。

*就我个人而言，我几乎总是只是锁定 - 以一种明显*正确的方式正确比波动性或 Interlocked.Increment更容易。就我而言，无锁多线程适用于真正的线程专家，我不是其中之一。如果 Joe Duffy 和他的团队构建了很好的库，可以并行化事物而没有我构建的东西那么多的锁定，那就太棒了，我会立即使用它 - 但是当我自己做线程时，我会尝试把事情简单化。

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2008-09-30T19:32:52.327

” `volatile`“不代替`Interlocked.Increment`！它只是确保变量没有被缓存，而是直接使用。

增加一个变量实际上需要三个操作：

1.  读
2.  增量
3.  写

`Interlocked.Increment`将所有三个部分作为单个原子操作执行。

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2011-06-23T15:08:37.957

您正在寻找锁定或互锁增量。

Volatile 绝对不是您所追求的 - 它只是告诉编译器将变量视为始终在变化，即使当前代码路径允许编译器以其他方式优化从内存读取。

例如

```
while (m_Var)
{ } 
```

如果在另一个线程中将 m_Var 设置为 false，但它没有声明为 volatile，则编译器可以通过检查 CPU 寄存器（例如 EAX，因为那是m_Var 从一开始就被提取到了什么）而不是向 m_Var 的内存位置发出另一次读取（这可能被缓存 - 我们不知道也不关心，这就是 x86/x64 的缓存一致性点）。其他人之前提到指令重新排序的所有帖子都只是表明他们不了解 x86/x64 架构。挥发性*不*正如前面的帖子所暗示的那样，发出读/写障碍，说“它可以防止重新排序”。事实上，再次感谢 MESI 协议，我们可以保证我们读取的结果在 CPU 之间始终是相同的，无论实际结果是否已退休到物理内存或只是驻留在本地 CPU 的缓存中。我不会过多介绍这个细节，但请放心，如果出现问题，英特尔/AMD 可能会召回处理器！这也意味着我们不必关心乱序执行等。结果总是保证按顺序退出 - 否则我们会被塞满！

使用 Interlocked Increment，处理器需要出去，从给定的地址中获取值，然后递增并写回 - 同时拥有整个高速缓存行的独占所有权（锁定 xadd）以确保没有其他处理器可以修改它的价值。

使用 volatile，您仍然会得到 1 条指令（假设 JIT 应该是高效的） - inc dword ptr [m_Var]。但是，处理器 (cpuA) 在执行与互锁版本所做的所有操作时，并不要求对高速缓存行进行独占所有权。可以想象，这意味着其他处理器可以在 cpuA 读取更新值后将其写回 m_Var。因此，现在不是将值增加两次，而是最终只增加了一次。

希望这可以解决问题。

有关详细信息，请参阅“了解低锁技术在多线程应用程序中的影响” - [http://msdn.microsoft.com/en-au/magazine/cc163715.aspx](http://msdn.microsoft.com/en-au/magazine/cc163715.aspx)

ps 是什么导致了这个很晚的回复？所有回复在他们的解释中都非常不正确（尤其是标记为答案的回复），我只需要为其他阅读本文的人清理它。*耸耸肩*

pps 我假设目标是 x86/x64 而不是 IA64（它具有不同的内存模型）。请注意，Microsoft 的 ECMA 规范被搞砸了，因为它指定了最弱的内存模型而不是最强的内存模型（最好针对最强的内存模型进行指定，以便它在平台之间保持一致 - 否则代码将在 x86/ 上运行 24-7 x64 可能根本无法在 IA64 上运行，尽管英特尔已经为 IA64 实现了类似的强大内存模型）——微软自己承认了这一点——http: [//blogs.msdn.com/b/cbrumme/archive/2003/05/17/51445.aspx](http://blogs.msdn.com/b/cbrumme/archive/2003/05/17/51445.aspx) .

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2008-09-30T19:27:22.403

联锁功能不锁定。它们是原子的，这意味着它们可以在增量期间完成而无需上下文切换。所以没有死锁或等待的机会。

我会说你应该总是更喜欢它而不是锁和增量。

如果您需要在一个线程中写入以在另一个线程中读取，并且如果您希望优化器不对变量的操作重新排序（因为优化器不知道的另一个线程中正在发生事情），那么 Volatile 很有用。这是您如何增加的正交选择。

如果您想了解更多关于无锁代码以及编写它的正确方法的信息，这是一篇非常好的文章

[http://www.ddj.com/hpc-high-performance-computing/210604448](http://www.ddj.com/hpc-high-performance-computing/210604448)

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-09-30T19:32:09.473

lock(...) 有效，但可能会阻塞线程，并且如果其他代码以不兼容的方式使用相同的锁，则可能导致死锁。

Interlocked.* 是正确的方法……因为现代 CPU 将其作为原语支持，所以开销要少得多。

volatile 本身是不正确的。尝试检索然后写回修改值的线程仍可能与执行相同操作的另一个线程发生冲突。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2009-05-24T23:12:18.533

我做了一些测试以了解该理论的实际工作原理：[kennethxu.blogspot.com/2009/05/interlocked-vs-monitor-performance.html](http://kennethxu.blogspot.com/2009/05/interlocked-vs-monitor-performance.html)。我的测试更侧重于 CompareExchnage，但 Increment 的结果是相似的。在多 cpu 环境中不需要更快地互锁。这是在 2 年的 16 CPU 服务器上进行增量的测试结果。请记住，该测试还涉及增加后的安全读取，这在现实世界中很常见。

```
D:\>InterlockVsMonitor.exe 16
Using 16 threads:
          InterlockAtomic.RunIncrement         (ns):   8355 Average,   8302 Minimal,   8409 Maxmial
    MonitorVolatileAtomic.RunIncrement         (ns):   7077 Average,   6843 Minimal,   7243 Maxmial

D:\>InterlockVsMonitor.exe 4
Using 4 threads:
          InterlockAtomic.RunIncrement         (ns):   4319 Average,   4319 Minimal,   4321 Maxmial
    MonitorVolatileAtomic.RunIncrement         (ns):    933 Average,    802 Minimal,   1018 Maxmial 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2012-04-29T22:04:53.253

我支持 Jon Skeet 的回答，并希望为所有想了解更多关于“易失性”和 Interlocked 的人添加以下链接：

[原子性、易变性和不变性是不同的，第一部分 - （Eric Lippert 的 Fabulous Adventures In Coding）](http://blogs.msdn.com/b/ericlippert/archive/2011/06/16/atomicity-volatility-and-immutability-are-different-part-one.aspx)

[原子性、易变性和不变性是不同的，第二部分](http://blogs.msdn.com/b/ericlippert/archive/2011/06/16/atomicity-volatility-and-immutability-are-different-part-two.aspx)

[原子性、易变性和不变性是不同的，第三部分](http://blogs.msdn.com/b/ericlippert/archive/2011/06/16/atomicity-volatility-and-immutability-are-different-part-three.aspx)

[Sayonara Volatile -（2012 年出现的 Joe Duffy 博客的 Wayback Machine 快照）](https://web.archive.org/web/20120303105945/http://www.bluebytesoftware.com/blog/2010/12/04/SayonaraVolatile.aspx)

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2018-12-02T15:51:32.287

我想补充其他答案中提到的`volatile`,`Interlocked`和之间的区别`lock`：

[volatile 关键字可以应用于以下类型的字段](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/volatile)：

*   引用类型。
*   指针类型（在不安全的上下文中）。请注意，尽管指针本身可以是易失的，但它指向的对象不能。换句话说，您不能将“指针”声明为“易失性”。
*   简单类型，例如`sbyte`, `byte`, `short`, `ushort`, `int`, `uint`, `char`, `float`, 和`bool`.
*   具有以下基本类型之一的枚举类型：`byte`、`sbyte`、`short`、 ushort `int`、 或`uint`。
*   已知为引用类型的泛型类型参数。
*   `IntPtr`和`UIntPtr`。

**其他类型**，包括`double`and `long`，不能标记为“易失性”，因为不能保证对这些类型的字段的读写是原子的。要保护对这些类型字段的多线程访问，请使用`Interlocked`类成员或使用 `lock`语句保护访问。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2022-01-21T07:39:41.097

我只是在这里指出 Orion Edwards 回答中关于 volatile 的错误。

他说：

> “如果它是易失性的，这只是确保两个 CPU 同时看到相同的数据。”

这是错的。在微软关于[volatile](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/volatile#/)的文档中，提到：

> “在多处理器系统上，易失性读操作不能保证获得任何处理器写入该内存位置的最新值。同样，易失性写操作不能保证写入的值立即对其他处理器可见。”

# asp.net - ASP.NET Web 服务上 WSDL 中所需参数的 minOccurs="0"

> ID：154554
> 
> 赞同：2
> 
> 时间：2008-09-30T19:25:49.800
> 
> 标签：asp.net, vb.net, web-services, wsdl

我正在使用 Microsoft Visual Web Developer 2005 (Express Edition) 编写一个简单的 Web 服务，动态生成的 WSDL 的所有参数都有一个 minOccurs="0"。

如何在不诉诸于创建静态 WSDL 文件的情况下获得所需参数的 minOccurs="1"？

我需要**使用 ASP.NET Web 服务**(.NET v2) 来执行此操作。所以，没有WCF。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T21:39:19.030

我认为该`XmlElement(IsNullable = true)`属性将完成这项工作：

```
using System.Xml.Serialization;

[WebMethod]
public string MyService([XmlElement(IsNullable = true)] string arg)
{
  return "1";
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T19:45:34.667

来自 msdn 论坛“如果您正在创建新的 Web 服务，我强烈建议您使用 Windows Communication Foundation (WCF) 而不是使用 ASP.NET Web 服务来构建 Web 服务。在 WCF 中，当您为您的服务指定数据协定时您可以使用 DataMemberAttribute 上的 IsRequired 属性指定给定数据成员是必需的。"

来源 - [http://social.msdn.microsoft.com/forums/en-US/asmxandxml/thread/40ab5748-d32c-42a6-a47f-984ba18a1fe2/](http://social.msdn.microsoft.com/forums/en-US/asmxandxml/thread/40ab5748-d32c-42a6-a47f-984ba18a1fe2/)

# file - 为 P2P 应用程序拆分文件

> ID：154563
> 
> 赞同：2
> 
> 时间：2008-09-30T19:27:00.640
> 
> 标签：file, p2p, split

我必须实现一个用于文件共享的中间件系统，它必须拆分文件，这与在 bittorrent 上发生的情况不同，它同时从各种来源发送和接收单独的片段。我怎么做？它是一个库还是我必须自己实现文件拆分？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T19:29:27.530

将文件分成块，假设每个块 100KB。然后在每个块上计算一个 SHA 哈希（或其他一些哈希算法）。所以如果文件是 905KB，你将计算出 10 个这样的哈希值。

服务器将为它所服务的每个文件包含一个哈希定义文件。该散列定义文件将包含文件所有块的列表以及散列。因此，如果服务器正在为我们的名为 test.exe 的 905KB 文件提供服务。然后我们将有另一个名为 test.exe.hashes 的文件，其中包含该文件的 10 个哈希的列表。

客户端将下载散列定义文件，并确保它具有所有块。客户端可以单独请求每个块，下载后，它可以再次计算其末端的哈希值，以确保没有损坏。

您不需要物理拆分文件，拆分文件只是读取您感兴趣的部分。文件的第一个块是从字节范围0到102399，下一个块是从102400到204800，等等。所以只需打开文件，寻找那个位置，读取数据，然后关闭文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T19:43:05.920

查看 Split & Concat（GNU 软件）的实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-28T21:52:38.743

您可能需要考虑使用 Solomon-Reed 编码。这将使获得最终块变得更加容易。这是微软在 Avalaunch 中采取的路线。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-28T21:59:40.927

出于兴趣：为什么不直接实施 BitTorrent 或类似的东西？有很多开源客户端（即[Azureus](http://sourceforge.net/projects/azureus/)），协议[非常简单](http://www.bittorrent.org/beps/bep_0003.html)。还有[一篇更详细的文章](http://wiki.theory.org/BitTorrentSpecification)，但这包含一些扩展 - 值得怀疑的是，官方规范总是正确的。

# java - 多态性 vs 覆盖 vs 重载

> ID：154577
> 
> 赞同：371
> 
> 时间：2008-09-30T19:29:02.460
> 
> 标签：java, oop, polymorphism, overloading, overriding

在 Java 方面，当有人问：

> 什么是多态性？

**重载**或**覆盖**是一个可以接受的答案吗？

我认为还有更多的东西。

*如果您有一个抽象基类定义了一个没有实现的方法，并且您在子类中定义了该方法，那仍然是覆盖吗？*

我认为**重载**肯定不是正确的答案。

* * *

## 回答 #1

> 赞同：933
> 
> 时间：2008-09-30T20:33:51.040

表达多态性最清晰的方法是通过抽象基类（或接口）

```
public abstract class Human{
   ...
   public abstract void goPee();
} 
```

这个类是抽象的，因为该`goPee()`方法对于人类来说是不可定义的。它只能为子类 Male 和 Female 定义。此外，人类是一个抽象概念——你不能创造一个既不是男性也不是女性的人。它必须是一个或另一个。

所以我们通过使用抽象类来推迟实现。

```
public class Male extends Human{
...
    @Override
    public void goPee(){
        System.out.println("Stand Up");
    }
} 
```

和

```
public class Female extends Human{
...
    @Override
    public void goPee(){
        System.out.println("Sit Down");
    }
} 
```

现在我们可以告诉满屋子的人去撒尿。

```
public static void main(String[] args){
    ArrayList<Human> group = new ArrayList<Human>();
    group.add(new Male());
    group.add(new Female());
    // ... add more...

    // tell the class to take a pee break
    for (Human person : group) person.goPee();
} 
```

运行它会产生：

```
Stand Up
Sit Down
... 
```

* * *

## 回答 #2

> 赞同：99
> 
> 时间：2008-09-30T19:51:18.303

**多态性**是类实例表现得好像它是其继承树中另一个类的实例的能力，通常是它的祖先类之一。例如，在 Java 中，所有类都继承自 Object。因此，您可以创建一个 Object 类型的变量并将任何类的实例分配给它。

**覆盖**_**是一种发生在从另一个类继承的类中的函数。覆盖函数“替换”从基类继承的函数，但这样做的方式是，即使其类的实例通过多态性伪装成不同的类型，也会调用它。参考前面的示例，您可以定义自己的类并覆盖 toString() 函数。因为这个函数是从 Object 继承的，所以如果你把这个类的一个实例复制到一个 Object 类型的变量中，它仍然可以使用。通常，如果您在类伪装成 Object 时调用 toString()，则实际触发的 toString 版本是在 Object 本身上定义的版本。但是，由于该函数是一个覆盖，因此即使在类实例'**

 ****重载**是定义多个具有相同名称但具有不同参数的方法的操作。它与覆盖或多态无关。

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2012-10-21T05:07:45.327

多态是指不止一种形式，同一个对象根据需要执行不同的操作。

多态性可以通过两种方式来实现，它们是

1.  方法覆盖
2.  方法重载

*方法重载*是指使用相同的方法名在同一个类中编写两个或多个方法，但传递的参数不同。

*方法覆盖*意味着我们在不同的类中使用方法名称，这意味着在子类中使用父类方法。

在Java中实现多态一个超类引用变量可以持有子类对象。

为了实现多态性，每个开发人员都必须在项目中使用相同的方法名称。

* * *

## 回答 #4

> 赞同：45
> 
> 时间：2008-09-30T19:42:37.950

覆盖和重载都用于实现多态性。

您可以在一个类中拥有一个在一个或多个子类中被**覆盖的方法。**该方法根据用于实例化对象的类执行不同的操作。

```
 abstract class Beverage {
       boolean isAcceptableTemperature();
    }

    class Coffee extends Beverage {
       boolean isAcceptableTemperature() { 
           return temperature > 70;
       }
    }

    class Wine extends Beverage {
       boolean isAcceptableTemperature() { 
           return temperature < 10;
       }
    } 
```

你也可以有一个 用两组或多组参数**重载的方法。**该方法根据传递的参数类型执行不同的操作。

```
 class Server {
        public void pour (Coffee liquid) {
            new Cup().fillToTopWith(liquid);
        }

        public void pour (Wine liquid) {
            new WineGlass().fillHalfwayWith(liquid);
        }

        public void pour (Lemonade liquid, boolean ice) {
            Glass glass = new Glass();
            if (ice) {
                glass.fillToTopWith(new Ice());
            }
            glass.fillToTopWith(liquid);
        }
    } 
```

* * *

## 回答 #5

> 赞同：41
> 
> 时间：2008-09-30T19:41:50.993

这是伪 C#/Java 中的多态性示例：

```
class Animal
{
    abstract string MakeNoise ();
}

class Cat : Animal {
    string MakeNoise () {
        return "Meow";
    }
}

class Dog : Animal {
    string MakeNoise () {
        return "Bark";
    }
}

Main () {
   Animal animal = Zoo.GetAnimal ();
   Console.WriteLine (animal.MakeNoise ());
} 
```

Main 函数不知道动物的类型，它取决于 MakeNoise() 方法的特定实现行为。

编辑：看起来布莱恩打败了我。有趣的是，我们使用了相同的示例。但是上面的代码应该有助于澄清概念。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2008-09-30T19:35:05.003

你是对的，重载不是答案。

两者都不是压倒一切的。覆盖是获得多态性的方法。多态性是对象根据其类型改变行为的能力。当表现出多态性的对象的调用者不知道该对象是什么特定类型时，这一点得到了最好的证明。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2008-09-30T19:51:19.863

具体来说，重载或覆盖并不能给出完整的画面。多态性只是对象根据其类型专门化其行为的能力。

我不同意这里的一些答案，因为重载是多态性（参数多态性）的一种形式，在这种情况下，具有相同名称的方法可以表现不同，给出不同的参数类型。一个很好的例子是运算符重载。您可以定义“+”来接受不同类型的参数——比如字符串或整数——并且基于这些类型，“+”的行为会有所不同。

多态性还包括继承和覆盖方法，尽管它们在基类型中可以是抽象的或虚拟的。在基于继承的多态性方面，Java 仅支持单类继承，将其多态行为限制为单基类型链。Java 确实支持多个接口的实现，这是另一种形式的多态行为。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2010-12-20T05:02:32.547

多态性只是意味着“多种形式”。

它不需要继承来实现......作为接口实现，它根本不是继承，服务于多态需求。可以说，接口实现比继承“更好”地服务于多态需求。

例如，你会创建一个超类来描述所有可以飞行的东西吗？我应该不这么认为。您最好创建一个描述飞行的界面并将其保留在那里。

因此，由于接口描述行为，而方法名称描述行为（对程序员而言），将方法重载视为一种较小形式的多态性并不过分。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-09-30T19:37:58.210

经典的例子，狗和猫都是动物，动物有方法makeNoise。我可以遍历一组对它们调用 makeNoise 的动物，并期望它们会在那里执行相应的实现。

调用代码不必知道它们是什么特定的动物。

这就是我认为的多态性。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2018-05-06T17:18:06.607

虽然，多态性已经在这篇文章中进行了详细的解释，但我想更加强调为什么是它的一部分。

> 为什么多态在任何 OOP 语言中都如此重要。

让我们尝试为有和没有继承/多态的电视构建一个简单的应用程序。发布应用程序的每个版本，我们都会进行一次小型回顾。

假设您是一家电视公司的软件工程师，您被要求为音量、亮度和颜色控制器编写软件，以根据用户命令增加和减少它们的值。

您首先为这些功能中的每一个编写类，方法是添加

1.  设置：- 设置控制器的值。（假设这有控制器特定的代码）
2.  获取：- 获取控制器的值。（假设这有控制器特定的代码）
3.  调整：-验证输入并设置控制器。（通用验证..独立于控制器）
4.  与控制器的用户输入映射：- 获取用户输入并相应地调用控制器。

> 应用程序版本 1

```
import java.util.Scanner;    
class VolumeControllerV1 {
    private int value;
    int get()    {
        return value;
    }
    void set(int value) {
        System.out.println("Old value of VolumeController \t"+this.value);
        this.value = value;
        System.out.println("New value of VolumeController \t"+this.value);
    }
    void adjust(int value)  {
        int temp = this.get();
        if(((value > 0) && (temp >= 100)) || ((value < 0) && (temp <= 0)))    {
            System.out.println("Can not adjust any further");
            return;
        }
        this.set(temp + value);
    }
}
class  BrightnessControllerV1 {
    private int value;
    int get()    {
        return value;
    }
    void set(int value) {
        System.out.println("Old value of BrightnessController \t"+this.value);
        this.value = value;
        System.out.println("New value of BrightnessController \t"+this.value);
    }
    void adjust(int value)  {
        int temp = this.get();
        if(((value > 0) && (temp >= 100)) || ((value < 0) && (temp <= 0)))    {
            System.out.println("Can not adjust any further");
            return;
        }
        this.set(temp + value);
    }
}
class ColourControllerV1    {
    private int value;
    int get()    {
        return value;
    }
    void set(int value) {
        System.out.println("Old value of ColourController \t"+this.value);
        this.value = value;
        System.out.println("New value of ColourController \t"+this.value);
    }
    void adjust(int value)  {
        int temp = this.get();
        if(((value > 0) && (temp >= 100)) || ((value < 0) && (temp <= 0)))    {
            System.out.println("Can not adjust any further");
            return;
        }
        this.set(temp + value);
    }
}

/*
 *       There can be n number of controllers
 * */
public class TvApplicationV1 {
    public static void main(String[] args)  {
        VolumeControllerV1 volumeControllerV1 = new VolumeControllerV1();
        BrightnessControllerV1 brightnessControllerV1 = new BrightnessControllerV1();
        ColourControllerV1 colourControllerV1 = new ColourControllerV1();

        OUTER: while(true) {
            Scanner sc=new Scanner(System.in);
            System.out.println(" Enter your option \n Press 1 to increase volume \n Press 2 to decrease volume");
            System.out.println(" Press 3 to increase brightness \n Press 4 to decrease brightness");
            System.out.println(" Press 5 to increase color \n Press 6 to decrease color");
            System.out.println("Press any other Button to shutdown");
            int button = sc.nextInt();
            switch (button) {
                case  1:    {
                    volumeControllerV1.adjust(5);
                    break;
                }
                case 2: {
                    volumeControllerV1.adjust(-5);
                    break;
                }
                case  3:    {
                    brightnessControllerV1.adjust(5);
                    break;
                }
                case 4: {
                    brightnessControllerV1.adjust(-5);
                    break;
                }
                case  5:    {
                    colourControllerV1.adjust(5);
                    break;
                }
                case 6: {
                colourControllerV1.adjust(-5);
                break;
            }
            default:
                System.out.println("Shutting down...........");
                break OUTER;
        }

    }
    }
} 
```

现在您已经准备好部署我们的第一个工作应用程序版本。是时候分析到目前为止所做的工作了。

> TV 应用程序版本 1 中的问题

1.  Adjust(int value) 代码在所有三个类中都是重复的。您希望最小化代码重复性。（但您没有想到通用代码并将其移至某个超类以避免重复代码）

只要您的应用程序按预期工作，您就决定接受它。

> 有时，你的老板会回来找你，要求你为现有的应用程序添加重置功能。重置会将所有 3 个三个控制器设置为其各自的默认值。

您开始为新功能编写一个新类 (ResetFunctionV2)，并为这个新功能映射用户输入映射代码。

> 应用程序版本 2

```
import java.util.Scanner;
class VolumeControllerV2    {

    private int defaultValue = 25;
    private int value;

    int getDefaultValue() {
        return defaultValue;
    }
    int get()    {
        return value;
    }
    void set(int value) {
        System.out.println("Old value of VolumeController \t"+this.value);
        this.value = value;
        System.out.println("New value of VolumeController \t"+this.value);
    }
    void adjust(int value)  {
        int temp = this.get();
        if(((value > 0) && (temp >= 100)) || ((value < 0) && (temp <= 0)))    {
            System.out.println("Can not adjust any further");
            return;
        }
        this.set(temp + value);
    }
}
class  BrightnessControllerV2   {

    private int defaultValue = 50;
    private int value;
    int get()    {
        return value;
    }
    int getDefaultValue() {
        return defaultValue;
    }
    void set(int value) {
        System.out.println("Old value of BrightnessController \t"+this.value);
        this.value = value;
        System.out.println("New value of BrightnessController \t"+this.value);
    }
    void adjust(int value)  {
        int temp = this.get();
        if(((value > 0) && (temp >= 100)) || ((value < 0) && (temp <= 0)))    {
            System.out.println("Can not adjust any further");
            return;
        }
        this.set(temp + value);
    }
}
class ColourControllerV2    {

    private int defaultValue = 40;
    private int value;
    int get()    {
        return value;
    }
    int getDefaultValue() {
        return defaultValue;
    }
    void set(int value) {
        System.out.println("Old value of ColourController \t"+this.value);
        this.value = value;
        System.out.println("New value of ColourController \t"+this.value);
    }
    void adjust(int value)  {
        int temp = this.get();
        if(((value > 0) && (temp >= 100)) || ((value < 0) && (temp <= 0)))    {
            System.out.println("Can not adjust any further");
            return;
        }
        this.set(temp + value);
    }
}

class ResetFunctionV2 {

    private VolumeControllerV2 volumeControllerV2 ;
    private BrightnessControllerV2 brightnessControllerV2;
    private ColourControllerV2 colourControllerV2;

    ResetFunctionV2(VolumeControllerV2 volumeControllerV2, BrightnessControllerV2 brightnessControllerV2, ColourControllerV2 colourControllerV2)  {
        this.volumeControllerV2 = volumeControllerV2;
        this.brightnessControllerV2 = brightnessControllerV2;
        this.colourControllerV2 = colourControllerV2;
    }
    void onReset()    {
        volumeControllerV2.set(volumeControllerV2.getDefaultValue());
        brightnessControllerV2.set(brightnessControllerV2.getDefaultValue());
        colourControllerV2.set(colourControllerV2.getDefaultValue());
    }
}
/*
 *       so on
 *       There can be n number of controllers
 *
 * */
public class TvApplicationV2 {
    public static void main(String[] args)  {
        VolumeControllerV2 volumeControllerV2 = new VolumeControllerV2();
        BrightnessControllerV2 brightnessControllerV2 = new BrightnessControllerV2();
        ColourControllerV2 colourControllerV2 = new ColourControllerV2();

        ResetFunctionV2 resetFunctionV2 = new ResetFunctionV2(volumeControllerV2, brightnessControllerV2, colourControllerV2);

        OUTER: while(true) {
            Scanner sc=new Scanner(System.in);
            System.out.println(" Enter your option \n Press 1 to increase volume \n Press 2 to decrease volume");
            System.out.println(" Press 3 to increase brightness \n Press 4 to decrease brightness");
            System.out.println(" Press 5 to increase color \n Press 6 to decrease color");
            System.out.println(" Press 7 to reset TV \n Press any other Button to shutdown");
            int button = sc.nextInt();
            switch (button) {
                case  1:    {
                    volumeControllerV2.adjust(5);
                    break;
                }
                case 2: {
                    volumeControllerV2.adjust(-5);
                    break;
                }
                case  3:    {
                    brightnessControllerV2.adjust(5);
                    break;
                }
                case 4: {
                    brightnessControllerV2.adjust(-5);
                    break;
                }
                case  5:    {
                    colourControllerV2.adjust(5);
                    break;
                }
                case 6: {
                    colourControllerV2.adjust(-5);
                    break;
                }
                case 7: {
                    resetFunctionV2.onReset();
                    break;
                }
                default:
                    System.out.println("Shutting down...........");
                    break OUTER;
            }

        }
    }
} 
```

因此，您的应用程序已准备好使用重置功能。但是，现在你开始意识到

> TV 应用程序版本 2 中的问题

1.  如果产品中引入了新控制器，则必须更改重置功能代码。
2.  如果控制器的计数增长得非常高，那么您在持有控制器的引用时就会遇到问题。
3.  重置功能代码与所有控制器类的代码紧密耦合（获取和设置默认值）。
4.  重置要素类（ResetFunctionV2）可以访问控制器类（调整）的其他方法，这是不可取的。

> 同时，您听到老板说您可能需要添加一项功能，其中每个控制器在启动时需要通过互联网从公司托管的驱动程序库中检查最新版本的驱动程序。

现在您开始认为要添加的这个新功能类似于重置功能，如果您不重构应用程序，应用程序问题 (V2) 将成倍增加。

您开始考虑使用继承，以便可以利用 JAVA 的多态能力，并添加一个新的抽象类（ControllerV3）到

1.  声明 get 和 set 方法的签名。
2.  包含之前在所有控制器之间复制的调整方法实现。
3.  声明 setDefault 方法，以便可以利用多态轻松实现重置功能。

通过这些改进，您可以准备好 TV 应用程序的第 3 版。

> 应用程序版本 3

```
import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;

abstract class ControllerV3 {
    abstract void set(int value);
    abstract int get();
    void adjust(int value)  {
        int temp = this.get();
        if(((value > 0) && (temp >= 100)) || ((value < 0) && (temp <= 0)))    {
            System.out.println("Can not adjust any further");
            return;
        }
        this.set(temp + value);
    }
    abstract void setDefault();
}
class VolumeControllerV3 extends ControllerV3   {

    private int defaultValue = 25;
    private int value;

    public void setDefault() {
        set(defaultValue);
    }
    int get()    {
        return value;
    }
    void set(int value) {
        System.out.println("Old value of VolumeController \t"+this.value);
        this.value = value;
        System.out.println("New value of VolumeController \t"+this.value);
    }
}
class  BrightnessControllerV3  extends ControllerV3   {

    private int defaultValue = 50;
    private int value;

    public void setDefault() {
        set(defaultValue);
    }
    int get()    {
        return value;
    }
    void set(int value) {
        System.out.println("Old value of BrightnessController \t"+this.value);
        this.value = value;
        System.out.println("New value of BrightnessController \t"+this.value);
    }
}
class ColourControllerV3 extends ControllerV3   {

    private int defaultValue = 40;
    private int value;

    public void setDefault() {
        set(defaultValue);
    }
    int get()    {
        return value;
    }
    void set(int value) {
        System.out.println("Old value of ColourController \t"+this.value);
        this.value = value;
        System.out.println("New value of ColourController \t"+this.value);
    }
}

class ResetFunctionV3 {

    private List<ControllerV3> controllers = null;

    ResetFunctionV3(List<ControllerV3> controllers)  {
        this.controllers = controllers;
    }
    void onReset()    {
        for (ControllerV3 controllerV3 :this.controllers)  {
            controllerV3.setDefault();
        }
    }
}
/*
 *       so on
 *       There can be n number of controllers
 *
 * */
public class TvApplicationV3 {
    public static void main(String[] args)  {
        VolumeControllerV3 volumeControllerV3 = new VolumeControllerV3();
        BrightnessControllerV3 brightnessControllerV3 = new BrightnessControllerV3();
        ColourControllerV3 colourControllerV3 = new ColourControllerV3();

        List<ControllerV3> controllerV3s = new ArrayList<>();
        controllerV3s.add(volumeControllerV3);
        controllerV3s.add(brightnessControllerV3);
        controllerV3s.add(colourControllerV3);

        ResetFunctionV3 resetFunctionV3 = new ResetFunctionV3(controllerV3s);

        OUTER: while(true) {
            Scanner sc=new Scanner(System.in);
            System.out.println(" Enter your option \n Press 1 to increase volume \n Press 2 to decrease volume");
            System.out.println(" Press 3 to increase brightness \n Press 4 to decrease brightness");
            System.out.println(" Press 5 to increase color \n Press 6 to decrease color");
            System.out.println(" Press 7 to reset TV \n Press any other Button to shutdown");
            int button = sc.nextInt();
            switch (button) {
                case  1:    {
                    volumeControllerV3.adjust(5);
                    break;
                }
                case 2: {
                    volumeControllerV3.adjust(-5);
                    break;
                }
                case  3:    {
                    brightnessControllerV3.adjust(5);
                    break;
                }
                case 4: {
                    brightnessControllerV3.adjust(-5);
                    break;
                }
                case  5:    {
                    colourControllerV3.adjust(5);
                    break;
                }
                case 6: {
                    colourControllerV3.adjust(-5);
                    break;
                }
                case 7: {
                    resetFunctionV3.onReset();
                    break;
                }
                default:
                    System.out.println("Shutting down...........");
                    break OUTER;
            }

        }
    }
} 
```

尽管 V2 的问题列表中列出的大部分问题都得到了解决，除了

> TV 应用程序版本 3 中的问题

1.  重置要素类（ResetFunctionV3）可以访问控制器类（调整）的其他方法，这是不可取的。

同样，您考虑解决这个问题，因为现在您还有另一个功能（启动时更新驱动程序）要实现。如果您不修复它，它也会被复制到新功能中。

因此，您划分抽象类中定义的合同并为

1.  重置功能。
2.  驱动程序更新。

并让您的第一个具体课程如下实现它们

> 应用程序版本 4

```
import java.util.ArrayList;
import java.util.List;
import java.util.Scanner;

interface OnReset {
    void setDefault();
}
interface OnStart {
    void checkForDriverUpdate();
}
abstract class ControllerV4 implements OnReset,OnStart {
    abstract void set(int value);
    abstract int get();
    void adjust(int value)  {
        int temp = this.get();
        if(((value > 0) && (temp >= 100)) || ((value < 0) && (temp <= 0)))    {
            System.out.println("Can not adjust any further");
            return;
        }
        this.set(temp + value);
    }
}

class VolumeControllerV4 extends ControllerV4 {

    private int defaultValue = 25;
    private int value;
    @Override
    int get()    {
        return value;
    }
    void set(int value) {
        System.out.println("Old value of VolumeController \t"+this.value);
        this.value = value;
        System.out.println("New value of VolumeController \t"+this.value);
    }
    @Override
    public void setDefault() {
        set(defaultValue);
    }

    @Override
    public void checkForDriverUpdate()    {
        System.out.println("Checking driver update for VolumeController .... Done");
    }
}
class  BrightnessControllerV4 extends ControllerV4 {

    private int defaultValue = 50;
    private int value;
    @Override
    int get()    {
        return value;
    }
    @Override
    void set(int value) {
        System.out.println("Old value of BrightnessController \t"+this.value);
        this.value = value;
        System.out.println("New value of BrightnessController \t"+this.value);
    }

    @Override
    public void setDefault() {
        set(defaultValue);
    }

    @Override
    public void checkForDriverUpdate()    {
        System.out.println("Checking driver update for BrightnessController .... Done");
    }
}
class ColourControllerV4 extends ControllerV4 {

    private int defaultValue = 40;
    private int value;
    @Override
    int get()    {
        return value;
    }
    void set(int value) {
        System.out.println("Old value of ColourController \t"+this.value);
        this.value = value;
        System.out.println("New value of ColourController \t"+this.value);
    }
    @Override
    public void setDefault() {
        set(defaultValue);
    }

    @Override
    public void checkForDriverUpdate()    {
        System.out.println("Checking driver update for ColourController .... Done");
    }
}
class ResetFunctionV4 {

    private List<OnReset> controllers = null;

    ResetFunctionV4(List<OnReset> controllers)  {
        this.controllers = controllers;
    }
    void onReset()    {
        for (OnReset onreset :this.controllers)  {
            onreset.setDefault();
        }
    }
}
class InitializeDeviceV4 {

    private List<OnStart> controllers = null;

    InitializeDeviceV4(List<OnStart> controllers)  {
        this.controllers = controllers;
    }
    void initialize()    {
        for (OnStart onStart :this.controllers)  {
            onStart.checkForDriverUpdate();
        }
    }
}
/*
*       so on
*       There can be n number of controllers
*
* */
public class TvApplicationV4 {
    public static void main(String[] args)  {
        VolumeControllerV4 volumeControllerV4 = new VolumeControllerV4();
        BrightnessControllerV4 brightnessControllerV4 = new BrightnessControllerV4();
        ColourControllerV4 colourControllerV4 = new ColourControllerV4();
        List<ControllerV4> controllerV4s = new ArrayList<>();
        controllerV4s.add(brightnessControllerV4);
        controllerV4s.add(volumeControllerV4);
        controllerV4s.add(colourControllerV4);

        List<OnStart> controllersToInitialize = new ArrayList<>();
        controllersToInitialize.addAll(controllerV4s);
        InitializeDeviceV4 initializeDeviceV4 = new InitializeDeviceV4(controllersToInitialize);
        initializeDeviceV4.initialize();

        List<OnReset> controllersToReset = new ArrayList<>();
        controllersToReset.addAll(controllerV4s);
        ResetFunctionV4 resetFunctionV4 = new ResetFunctionV4(controllersToReset);

        OUTER: while(true) {
            Scanner sc=new Scanner(System.in);
            System.out.println(" Enter your option \n Press 1 to increase volume \n Press 2 to decrease volume");
            System.out.println(" Press 3 to increase brightness \n Press 4 to decrease brightness");
            System.out.println(" Press 5 to increase color \n Press 6 to decrease color");
            System.out.println(" Press 7 to reset TV \n Press any other Button to shutdown");
            int button = sc.nextInt();
            switch (button) {
                case  1:    {
                    volumeControllerV4.adjust(5);
                    break;
                }
                case 2: {
                    volumeControllerV4.adjust(-5);
                    break;
                }
                case  3:    {
                    brightnessControllerV4.adjust(5);
                    break;
                }
                case 4: {
                    brightnessControllerV4.adjust(-5);
                    break;
                }
                case  5:    {
                    colourControllerV4.adjust(5);
                    break;
                }
                case 6: {
                    colourControllerV4.adjust(-5);
                    break;
                }
                case 7: {
                    resetFunctionV4.onReset();
                    break;
                }
                default:
                    System.out.println("Shutting down...........");
                    break OUTER;
            }

        }
    }
} 
```

> 现在你面临的所有问题都得到了解决，你意识到通过使用继承和多态，你可以

1.  保持应用程序的各个部分松散耦合。（重置或驱动程序更新功能组件不需要了解实际的控制器类（音量、亮度和颜色），任何实现 OnReset 或 OnStart 的类都可以接受重置或驱动程序更新功能组件分别）。
2.  应用增强变得更容易。（新添加控制器不会影响重置或驱动程序更新功能组件，现在添加新的非常容易）
3.  保留抽象层。（现在重置功能只能看到控制器的 setDefault 方法，重置功能只能看到控制器的 checkForDriverUpdate 方法）

希望这可以帮助 ：-）

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-30T19:35:14.537

重载是当您定义 2 个名称相同但参数不同的方法时

覆盖是您通过子类中具有相同名称的函数更改基类的行为的地方。

因此，多态性与覆盖有关，但与真正的重载无关。

但是，如果有人对“什么是多态性？”这个问题给了我一个简单的“覆盖”答案。我会要求进一步解释。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-09-30T19:36:05.253

多态性是对象以多种形式出现的能力。这涉及使用继承和虚函数来构建可以互换的对象系列。基类包含虚函数的原型，可能未实现或具有应用程序要求的默认实现，并且各个派生类各自以不同的方式实现它们以影响不同的行为。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-09-30T19:44:34.497

两者都不：

重载是当你有相同的函数名但接受不同的参数时。

重写是子类用它自己的方法替换父类的方法（这本身并不构成多态性）。

多态性是后期绑定，例如基类（父）方法被调用，但直到运行时应用程序才知道实际对象是什么——它可能是一个方法不同的子类。这是因为任何子类都可以在定义了基类的地方使用。

在 Java 中，您可以通过 collections 库看到很多多态性：

```
int countStuff(List stuff) {
  return stuff.size();
} 
```

List 是基类，编译器不知道您是在计算链表、向量、数组还是自定义列表实现，只要它的行为类似于 List：

```
List myStuff = new MyTotallyAwesomeList();
int result = countStuff(myStuff); 
```

如果您超载，您将拥有：

```
int countStuff(LinkedList stuff) {...}
int countStuff(ArrayList stuff) {...}
int countStuff(MyTotallyAwesomeList stuff) {...}
etc... 
```

并且编译器会选择正确版本的 countStuff() 来匹配参数。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2016-09-16T13:37:09.097

> 什么是多态性？

来自java[教程](https://docs.oracle.com/javase/tutorial/java/IandI/polymorphism.html)

多态性的字典定义是指生物学中的一个原理，其中一个有机体或物种可以有许多不同的形式或阶段。这个原则也可以应用于面向对象的编程和像 Java 语言这样的语言。***一个类的子类可以定义它们自己独特的行为，并且共享一些与父类相同的功能。***

通过考虑示例和定义，应该接受***覆盖的答案。***

关于您的第二个查询：

> 如果您有一个抽象基类定义了一个没有实现的方法，并且您在子类中定义了该方法，那仍然是覆盖吗？

它应该被称为覆盖。

查看此示例以了解不同类型的覆盖。

1.  基类没有提供实现，子类必须覆盖完整的方法 - （抽象）
2.  基类提供默认实现，子类可以改变行为
3.  `super.methodName()`子类通过调用作为第一条语句向基类实现添加扩展
4.  基类定义算法的结构（模板方法），子类将覆盖算法的一部分

代码片段：

```
import java.util.HashMap;

abstract class Game implements Runnable{

    protected boolean runGame = true;
    protected Player player1 = null;
    protected Player player2 = null;
    protected Player currentPlayer = null;

    public Game(){
        player1 = new Player("Player 1");
        player2 = new Player("Player 2");
        currentPlayer = player1;
        initializeGame();
    }

    /* Type 1: Let subclass define own implementation. Base class defines abstract method to force
        sub-classes to define implementation    
    */

    protected abstract void initializeGame();

    /* Type 2: Sub-class can change the behaviour. If not, base class behaviour is applicable */
    protected void logTimeBetweenMoves(Player player){
        System.out.println("Base class: Move Duration: player.PlayerActTime - player.MoveShownTime");
    }

    /* Type 3: Base class provides implementation. Sub-class can enhance base class implementation by calling
        super.methodName() in first line of the child class method and specific implementation later */
    protected void logGameStatistics(){
        System.out.println("Base class: logGameStatistics:");
    }
    /* Type 4: Template method: Structure of base class can't be changed but sub-class can some part of behaviour */
    protected void runGame() throws Exception{
        System.out.println("Base class: Defining the flow for Game:");  
        while ( runGame) {
            /*
            1\. Set current player
            2\. Get Player Move
            */
            validatePlayerMove(currentPlayer);  
            logTimeBetweenMoves(currentPlayer);
            Thread.sleep(500);
            setNextPlayer();
        }
        logGameStatistics();
    }
    /* sub-part of the template method, which define child class behaviour */
    protected abstract void validatePlayerMove(Player p);

    protected void setRunGame(boolean status){
        this.runGame = status;
    }
    public void setCurrentPlayer(Player p){
        this.currentPlayer = p;
    }
    public void setNextPlayer(){
        if ( currentPlayer == player1) {
            currentPlayer = player2;
        }else{
            currentPlayer = player1;
        }
    }
    public void run(){
        try{
            runGame();
        }catch(Exception err){
            err.printStackTrace();
        }
    }
}

class Player{
    String name;
    Player(String name){
        this.name = name;
    }
    public String getName(){
        return name;
    }
}

/* Concrete Game implementation  */
class Chess extends Game{
    public Chess(){
        super();
    }
    public void initializeGame(){
        System.out.println("Child class: Initialized Chess game");
    }
    protected void validatePlayerMove(Player p){
        System.out.println("Child class: Validate Chess move:"+p.getName());
    }
    protected void logGameStatistics(){
        super.logGameStatistics();
        System.out.println("Child class: Add Chess specific logGameStatistics:");
    }
}
class TicTacToe extends Game{
    public TicTacToe(){
        super();
    }
    public void initializeGame(){
        System.out.println("Child class: Initialized TicTacToe game");
    }
    protected void validatePlayerMove(Player p){
        System.out.println("Child class: Validate TicTacToe move:"+p.getName());
    }
}

public class Polymorphism{
    public static void main(String args[]){
        try{

            Game game = new Chess();
            Thread t1 = new Thread(game);
            t1.start();
            Thread.sleep(1000);
            game.setRunGame(false);
            Thread.sleep(1000);

            game = new TicTacToe();
            Thread t2 = new Thread(game);
            t2.start();
            Thread.sleep(1000);
            game.setRunGame(false);

        }catch(Exception err){
            err.printStackTrace();
        }       
    }
} 
```

输出：

```
Child class: Initialized Chess game
Base class: Defining the flow for Game:
Child class: Validate Chess move:Player 1
Base class: Move Duration: player.PlayerActTime - player.MoveShownTime
Child class: Validate Chess move:Player 2
Base class: Move Duration: player.PlayerActTime - player.MoveShownTime
Base class: logGameStatistics:
Child class: Add Chess specific logGameStatistics:
Child class: Initialized TicTacToe game
Base class: Defining the flow for Game:
Child class: Validate TicTacToe move:Player 1
Base class: Move Duration: player.PlayerActTime - player.MoveShownTime
Child class: Validate TicTacToe move:Player 2
Base class: Move Duration: player.PlayerActTime - player.MoveShownTime
Base class: logGameStatistics: 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-30T19:33:12.093

重载一词是指具有相同名称的事物的多个版本，通常是具有不同参数列表的方法

```
public int DoSomething(int objectId) { ... }
public int DoSomething(string objectName) { ... } 
```

所以这些函数可能会做同样的事情，但您可以选择使用 ID 或名称来调用它。与继承、抽象类等无关。

正如您在问题中描述的那样，覆盖通常是指多态性

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2012-02-24T12:52:30.790

我认为你们正在混合概念。*多态性*是对象在运行时表现不同的能力。为此，您需要两个先决条件：

1.  *后期装订*
2.  *遗产。*

话虽如此，*重载与**覆盖*的含义不同，具体取决于您使用的语言。例如在 Java 中不存在*覆盖*而是*重载*。子类中提供了对其基类具有不同签名的*重载方法。*否则它们将被*覆盖*（请注意，我的意思是现在无法从对象外部调用您的基类方法）。

然而，在 C++ 中并非如此。任何*重载*的方法，无论签名是否相同（不同的数量，不同的类型）都会*被覆盖*。也就是说，显然，当从子类对象外部调用时，基类的方法在子类中不再可用。

所以答案是在谈到 Java 时使用*重载*。在任何其他语言中可能与在 c++ 中发生的情况不同

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2013-04-26T12:06:22.053

覆盖更像是通过声明与上层方法（超级方法）具有相同名称和签名的方法来隐藏继承的方法，这为类添加了多态行为。换句话说，选择要调用的最高级别方法的决定将在运行时而不是在编译时做出。这就引出了接口和实现的概念。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2013-09-15T22:37:13.643

多态性是对象的多种实现，或者您可以说对象的多种形式。假设您将类`Animals`作为抽象基类，并且它有一个称为`movement()`定义动物移动方式的方法。现在实际上我们有不同种类的动物，它们的移动方式也不同，有些有 2 条腿，有些有 4 条，有些没有腿，等等。要定义`movement()`地球上每种动物的不同之处，我们需要应用多态性。但是，您需要定义更多的类，即类`Dogs` `Cats` `Fish`等。然后您需要从基类扩展这些类，并根据您拥有的每种动物使用新的运动功能`Animals`覆盖其方法。`movement()`你也可以使用`Interfaces`实现这一目标。这里的关键字是覆盖，重载是不同的，不被认为是多态。通过重载，您可以定义多个“同名”但在同一对象或类上具有不同参数的方法。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-09-11T14:04:44.593

*就其含义*而言，多态性更有可能......在java中覆盖

这都是关于同一对象在不同情况下的不同行为（在编程方式中......你可以调用不同的参数）

我认为下面的示例将帮助您理解......虽然它不是纯 java 代码......

```
 public void See(Friend)
     {
        System.out.println("Talk");
     } 
```

但是如果我们改变 ARGUMENT ...... BEHAVIOR 将会改变......

```
 public void See(Enemy)
     {
        System.out.println("Run");
     } 
```

人（这里是“对象”）是一样的......

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-30T19:50:18.837

多态性与语言通过使用单个接口统一处理不同对象的能力有关；因此它与覆盖有关，因此接口（或基类）是多态的，实现者是覆盖的对象（同一个奖牌的两个面）

无论如何，使用其他语言（例如 c++）更好地解释这两个术语之间的区别：如果基函数是虚拟的，则 c++ 中的多态对象表现为 java 对应物，但如果方法不是虚拟的，则代码跳转是*静态*解决的，并且在运行时不检查真实类型，因此，多态性包括对象根据用于访问它的接口而表现不同的能力；让我用伪代码做一个例子：

```
class animal {
    public void makeRumor(){
        print("thump");
    }
}
class dog extends animal {
    public void makeRumor(){
        print("woff");
    }
}

animal a = new dog();
dog b = new dog();

a.makeRumor() -> prints thump
b.makeRumor() -> prints woff 
```

（假设 makeRumor 不是虚拟的）

java 并没有真正提供这种级别的多态性（也称为对象切片）。

动物 a = 新狗（）；狗 b = 新狗（）；

```
a.makeRumor() -> prints thump
b.makeRumor() -> prints woff 
```

在这两种情况下，它只会打印 woff.. 因为 a 和 b 是指类狗

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2015-07-16T13:11:24.960

```
import java.io.IOException;

class Super {

    protected Super getClassName(Super s) throws IOException {
        System.out.println(this.getClass().getSimpleName() + " - I'm parent");
        return null;
    }

}

class SubOne extends Super {

    @Override
    protected Super getClassName(Super s)  {
        System.out.println(this.getClass().getSimpleName() + " - I'm Perfect Overriding");
        return null;
    }

}

class SubTwo extends Super {

    @Override
    protected Super getClassName(Super s) throws NullPointerException {
        System.out.println(this.getClass().getSimpleName() + " - I'm Overriding and Throwing Runtime Exception");
        return null;
    }

}

class SubThree extends Super {

    @Override
    protected SubThree getClassName(Super s) {
        System.out.println(this.getClass().getSimpleName()+ " - I'm Overriding and Returning SubClass Type");
        return null;
    }

}

class SubFour extends Super {

    @Override
    protected Super getClassName(Super s) throws IOException {
        System.out.println(this.getClass().getSimpleName()+ " - I'm Overriding and Throwing Narrower Exception ");
        return null;
    }

}

class SubFive extends Super {

    @Override
    public Super getClassName(Super s) {
        System.out.println(this.getClass().getSimpleName()+ " - I'm Overriding and have broader Access ");
        return null;
    }

}

class SubSix extends Super {

    public Super getClassName(Super s, String ol) {
        System.out.println(this.getClass().getSimpleName()+ " - I'm Perfect Overloading ");
        return null;
    }

}

class SubSeven extends Super {

    public Super getClassName(SubSeven s) {
        System.out.println(this.getClass().getSimpleName()+ " - I'm Perfect Overloading because Method signature (Argument) changed.");
        return null;
    }

}

public class Test{

    public static void main(String[] args) throws Exception {

        System.out.println("Overriding\n");

        Super s1 = new SubOne(); s1.getClassName(null);

        Super s2 = new SubTwo(); s2.getClassName(null);

        Super s3 = new SubThree(); s3.getClassName(null);

        Super s4 = new SubFour(); s4.getClassName(null);

        Super s5 = new SubFive(); s5.getClassName(null);

        System.out.println("Overloading\n");

        SubSix s6 = new SubSix(); s6.getClassName(null, null);

        s6 = new SubSix(); s6.getClassName(null);

        SubSeven s7 = new SubSeven(); s7.getClassName(s7);

        s7 = new SubSeven(); s7.getClassName(new Super());

    }
} 
```

# sql-server-2000 - 我收到来自 SQL Server 2000 的“致命错误 7987”错误

> ID：154585
> 
> 赞同：1
> 
> 时间：2008-09-30T19:30:57.590
> 
> 标签：sql-server-2000

尝试从存储的过程中进行插入时发生错误。我尝试按照 Jonathan Holland 建议的 kb 文章的建议运行 DBCC CHECKDB，它返回的结果完全没有问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T19:33:10.283

无赖的家伙。

[http://support.microsoft.com/kb/828337](http://support.microsoft.com/kb/828337)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T20:37:25.853

针对受正在调用的存储过程影响的表运行 dbcc dbreindex **('tablename') 。**这迫使所有页面都被移动，这似乎已经纠正了问题。这表明这是一个 DBCC CHECKDB 没有捕获的页面损坏。

# c# - 任何人都知道制作 MP3 标签应用程序需要什么？

> ID：154587
> 
> 赞同：1
> 
> 时间：2008-09-30T19:32:09.940
> 
> 标签：c#, audio, mp3, tags

我得到了很多 FLAC 文件，并希望在转换它们后自动标记端点 MP3 文件。

我最好的接口库是什么？Vista 机器和 C# 用于我的代码库。

flac 文件带有一个用于演出的文本文件，以及执行的数字。我会以任何可能的方式进行编辑。

我将winamp用于播放器，但如果免费，我会尝试其他人。:)

TIA。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T19:42:56.267

查看 libid3tag... [http://sourceforge.net/project/showfiles.php?group_id=12349](http://en.wikipedia.org/wiki/ID3) ...

而且，实际上，ID3 标签非常简单，它只是附加在 MP3 文件前面的文本（具有固定长度的字段）......

只需确保您遵循标准，因为并非所有玩家等都这样做。有关更多信息，请查看[Wikipedia上的这篇文章](http://en.wikipedia.org/wiki/ID3)

[链接文本](http://en.wikipedia.org/wiki/ID3)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T21:27:40.617

您可能还想查看 TagLib# (google it)。它使用起来并不难，并且可以很容易地读取和写入 ID3 标签和其他元数据。

我过去曾在 ASP.NET 项目中使用它，使用上传的 mp3 和 mp4 文件的 ID3 标记中的元数据自动填充数据库记录，没有大问题。

# sql - 如何更改列和计算列

> ID：154591
> 
> 赞同：5
> 
> 时间：2008-09-30T19:32:54.057
> 
> 标签：sql, sql-server

在 SQL SERVER DB 中，我需要更改一个列`baseColumn`和一个计算列`upperBaseColumn`。上面有`upperBaseColumn`索引。

这就是桌子的样子

```
create table testTable (baseColumn varchar(10), upperBaseColumn AS (upper(baseColumn))

create index idxUpperBaseColumn ON testTable (upperBaseColumn) 
```

现在我需要增加 和 的列`baseColumn`长度`upperBaseColumn`。

最好的方法是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T19:37:41.737

我建议您删除索引，然后删除计算列。更改大小，然后重新添加计算列和索引。用你的例子....

```
create table testTable (baseColumn varchar(10), upperBaseColumn AS (upper(baseColumn)))
create index idxUpperBaseColumn ON testTable (upperBaseColumn)

Drop Index TestTable.idxUpperBaseColumn

Alter Table testTable Drop Column upperBaseColumn

Alter Table testTable Alter Column baseColumn VarChar(20)

Alter Table testTable Add upperBaseColumn As Upper(BaseColumn)

create index idxUpperBaseColumn ON testTable (upperBaseColumn) 
```

# python - 用于 wiki 标记的 Python 模块

> ID：154592
> 
> 赞同：30
> 
> 时间：2008-09-30T19:32:59.800
> 
> 标签：python, wiki, markup

是否有`Python`转换`wiki markup`为其他语言的模块（例如`HTML`）？

这里提出了一个类似的问题，[将 wiki 标记转换为 html 的最简单方法是什么](https://stackoverflow.com/questions/45991/whats-the-easiest-way-to-convert-wiki-markup-to-html)，但没有`Python`提到任何模块。

只是好奇。:) 干杯。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-30T20:11:43.310

[mwlib](https://github.com/pediapress/mwlib)提供了将 MediaWiki 格式的文本转换为 HTML、PDF、DocBook 和 OpenOffice 格式的方法。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-30T21:31:36.770

Django 使用以下库进行标记：

*   [降价](http://www.freewisdom.org/projects/python-markdown/)
*   [纺织品](http://pypi.python.org/pypi/textile)
*   [重构文本](http://docutils.sourceforge.net/rst.html)

你可以看到[它们是如何在 Django 中使用的](http://code.djangoproject.com/browser/django/trunk/django/contrib/markup/templatetags/markup.py)。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-30T20:38:04.400

您应该查看一个很好的[Creole](http://wikicreole.org/)语法解析器：[creole.py](http://wiki.sheep.art.pl/Wiki%20Creole%20Parser%20in%20Python)。它可以将克里奥尔语（这是“一种用于不同 wiki 的通用 wiki 标记语言”）转换为 HTML。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-05-11T15:23:11.683

使用 python-creole 您可以将 html 转换为 creole 并将 creole 转换为 html ...因此您可以将其他标记转换为 html 然后再转换为 creole ...

[https://code.google.com/p/python-creole/](https://code.google.com/p/python-creole/)

# c# - 有没有办法在 WinForms .NET 3.5 应用程序中为未处理的异常定义操作？

> ID：154597
> 
> 赞同：2
> 
> 时间：2008-09-30T19:33:34.930
> 
> 标签：c#, .net, exception

请注意，我意识到这已在[此处](https://stackoverflow.com/questions/944/unhandled-exception-handler-in-net-11)得到解决。那篇文章讨论了 .NET 1.1 中的异常处理，同时暗示 >.NET 2.0 有更好的解决方案，所以这个问题专门针对较新的 .NET 版本。

我有一个 Windows 窗体应用程序，预计它会频繁且意外地失去与数据库的连接，在这种情况下，它会将自身重置为其初始状态。

我已经通过自定义 DBWrapper 对象上的一组装饰器进行错误记录、重试连接等。但是，在处理完之后，我想让错误落入堆栈。一旦它到达顶部并且未处理，我希望它被吞下并执行我的 ApplicationResetter.Reset() 方法。

谁能告诉我该怎么做？

如果这是不可能的，那么是否至少有一种方法可以处理这个问题，而不会给每个可能收到此类错误的类引入对 ApplicationResetter 的依赖，并且不会实际关闭并重新启动我的应用程序（这看起来很难看）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T19:41:23.383

警告：还不熟悉 3.5，可能有更好的答案...

...但我的理解是，当事件到达未处理的异常处理程序时，应用程序可能会死掉 - 如果它没有死，它可能已经损坏到无论如何它都应该死掉

如果您已经在处理 db-not-there 案例并让其他异常通过，那么应用程序应该会死掉，因为它可能不稳定

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T19:47:02.060

也许[Application.ThreadException](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.threadexception.aspx)事件会满足您的需求：

```
static void Main()
{
    Application.ThreadException += Application_ThreadException;
    //...
 }

 static void Application_ThreadException(object sender, System.Threading.ThreadExceptionEventArgs e)
 {
     // call ApplicationResetter.Reset() here
 } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T19:48:44.910

有`System.Windows.Forms.Application.ThreadException`事件和`System.AppDomain.CurrentDomain.UnhandledException`事件。

正如 Steven 所说，这些将使您的应用程序处于未知状态。除了将可能引发异常的调用放在 try/catch 块中之外，实际上没有其他方法可以做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T19:53:36.130

最新 MSDN 问题中对未处理异常的非常深入的解释： [2008 年 9 月](http://msdn.microsoft.com/en-us/magazine/cc793966.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T20:11:45.727

对于 Windows 窗体线程（调用 Application.Run()），在 Main() 的开头分配一个 ThreadException 处理程序。另外，我发现有必要调用 SetUnhandledExceptionMode：

```
Application.SetUnhandledExceptionMode(UnhandledExceptionMode.Automatic);
Application.ThreadException += ShowUnhandledException;
Application.Run(...); 
```

这是一个示例处理程序。我知道这不是您要查找的内容，但它显示了处理程序的格式。请注意，如果您希望异常是致命的，则必须显式调用 Application.Exit()。

```
static void ShowUnhandledException(object sender, ThreadExceptionEventArgs t)
{
    Exception ex = t.Exception;
    try {
        // Build a message to show to the user
        bool first = true;
        string msg = string.Empty;
        for (int i = 0; i < 3 && ex != null; i++) {
            msg += string.Format("{0} {1}:\n\n{2}\n\n{3}", 
                first ? "Unhandled " : "Inner exception ",
                ex.GetType().Name,
                ex.Message, 
                i < 2 ? ex.StackTrace : "");
            ex = ex.InnerException;
            first = false;
        }
        msg += "\n\nAttempt to continue? (click No to exit now)";

        // Show the message
        if (MessageBox.Show(msg, "Unhandled exception", MessageBoxButtons.YesNo, MessageBoxIcon.Error) == DialogResult.No)
            Application.Exit();
    } catch (Exception e2) {
        try {
            MessageBox.Show(e2.Message, "Fatal error", MessageBoxButtons.OK, MessageBoxIcon.Stop);
        } finally {
            Application.Exit();
        }
    }
} 
```

# ruby - 替换 Ruby 的 IO.popen() 和 system()

> ID：154598
> 
> 赞同：12
> 
> 时间：2008-09-30T19:34:20.607
> 
> 标签：ruby

Ruby 中的 IO.popen() 和 system() 严重缺乏一些有用的功能，例如：

*   获取函数的返回值
*   捕获标准输出和标准错误（单独和合并）
*   在不产生额外的 cmd.exe 或 /bin/sh 进程的情况下运行

Python 有一个模块“子进程”，我正在考虑将其用作 Ruby 中类似模块的灵感。现在的问题：

*   Ruby 程序员如何解决上述问题，例如在执行 popen() 调用时获取返回值？
*   这是已经实施的吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-30T19:58:09.550

*   system() 退出状态可以被捕获`$?.exitstatus`
*   stderr 可以用类似的东西来捕获`system 'command 2>&1'`

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-30T22:36:23.353

看看标准 Ruby 库[open3](http://www.ruby-doc.org/stdlib/libdoc/open3/rdoc/index.html)。这将使您能够访问标准输入、标准输出和标准错误。

还有一个名为[open4](https://rubygems.org/gems/open4/)的外部项目，它允许您在不使用魔术变量名称的情况下获取退出状态。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T04:44:11.767

在测试 git_remote_branch 时，我觉得有必要这样做。该工具调用 shell，我想准确捕获测试运行期间显示的内容，无论 git 显示什么，也不管它是在 stdout 还是 stderr 中吐出。

我有一个完全可重用的模块，可以在[这里](http://github.com/webmat/git_remote_branch/tree/master/vendor/capture_fu.rb)观察到（MIT 许可证：随意使用，只是不要起诉我 ;-)

[您可以在此处](http://github.com/webmat/git_remote_branch/tree/master/test/helpers/shoulda_functional_helpers.rb#L40)的 git_remote_branch 测试中看到它的实际效果。

另外，我专门为[capture_fu](http://github.com/webmat/capture_fu/tree/master)建立了一个 repo ，它包括一些测试和东西。不过，该项目的设置不是很好。我没有花太多时间让它可发布;-)

# shell - /bin/sh 中的 ${1:+"$@"}

> ID：154625
> 
> 赞同：28
> 
> 时间：2008-09-30T19:41:08.390
> 
> 标签：shell

我注意到有时包装脚本将`${1:+"$@"}`用于参数，而不仅仅是`"$@"`.

例如，[http://svn.macosforge.org/repository/macports/trunk/dports/editors/vim-app/files/gvim.sh](http://svn.macosforge.org/repository/macports/trunk/dports/editors/vim-app/files/gvim.sh)使用

```
exec "$binary" $opts ${1:+"$@"} 
```

谁能分解`${1:+"$@"}`成英语并解释为什么它比普通话更有优势`"$@"`？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-30T20:50:37.663

“歇斯底里的葡萄干”，又名历史原因。

JesperE（或关于[shell 参数扩展](https://www.gnu.org/software/bash/manual/bash.html#Shell-Parameter-Expansion)的 Bash 手册页）的解释对于它的作用是准确的：

*   如果`$1`存在且不是空字符串，则替换引用的参数列表。

大约 20 年前，Bourne Shell 的一些损坏的次要变体在没有参数的情况下替换了一个空字符串，而不是当前的正确行为，即什么都不替换`""`。`"$@"`是否有任何这样的系统仍在使用中，还有待商榷。

[嗯：该扩展不适用于：

```
command '' arg2 arg3 ... 
```

在这种情况下，正确的表示法是：

```
${1+"$@"} 
```

`$1`无论是否为空参数，这都能正常工作。所以，有人记错了符号，不小心引入了一个错误。]

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T19:43:48.963

从 bash 手册页：

```
 ${parameter:+word}
          Use Alternate Value.  If parameter is null or unset, nothing  is
          substituted, otherwise the expansion of word is substituted. 
```

因此，`"$@"`被替换，除非`$1`未设置。我不明白为什么他们不能使用`"$@"`.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-10-21T16:03:17.890

**引用Jonathan Leffler**在评论中提到`man bash`的信息的相关部分：

 **> 不执行子字符串扩展时，bash 测试未*设置或 null*的参数；**省略冒号**会导致*仅对未**设置*的参数进行测试。

（强调我的）

# automated-tests - Web 服务的性能测试（Microsoft Web 应用程序压力工具？）

> ID：154629
> 
> 赞同：0
> 
> 时间：2008-09-30T19:41:52.960
> 
> 标签：automated-tests

我们需要提供一种解决方案来对驻留在我们开发环境中的 Web 服务进行性能测试。我们计划使用 Microsoft Web Application Stress Tool 的对象模型创建测试脚本。我已经研究过，但找不到任何例子。

任何人，谁可能使用这个相同的工具来实现类似的解决方案，请提供任何建议和/或示例？另外，如果其他工具可以提供更方便的解决方案，请提供任何建议。

任何帮助将非常感激。

谢谢你

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T20:04:49.317

所以一两年前我遇到了同样的问题，并且能够将我在研磨机方面的经验应用于这个问题： http: [//grinder.sourceforge.net/](http://grinder.sourceforge.net/)

我环境中的其他人使用 ACT 报告成功： [http ://en.wikipedia.org/wiki/Application_Center_Test](http://en.wikipedia.org/wiki/Application_Center_Test)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T20:13:38.483

我推荐 Webload。我用过它，它是一个很棒的工具。它提供的 IDE 允许您记录浏览器操作。在进行压力测试时，Webload 会即时绘制漂亮的图表。

编辑：这里是 webload 站点的链接：[http ://www.webload.org/](http://www.webload.org/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T15:42:42.667

我建议使用 Vordel 的新版 SOAPbox。这个工具使用起来非常简单，但提供了非常有趣的功能。你可以在这里找到它：[http ://www.vordel.com/products/soapbox/](http://www.vordel.com/products/soapbox/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T20:10:17.010

WAST 是一个非常古老的工具。查看一些更好的开源负载/性能工具可能会更好，例如：OpenSTA、JMeter、Webload、Grinder 等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-30T04:49:49.087

VSTT 为 Web 服务提供负载测试选项 - [http://blogs.msdn.com/b/nikhiln/archive/2007/02/05/performance-testing-asp-net-web-services-using-vsts.aspx](http://blogs.msdn.com/b/nikhiln/archive/2007/02/05/performance-testing-asp-net-web-services-using-vsts.aspx)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-30T19:48:29.730

您可能必须对 IIS 本身进行压力测试，因为它是 web 服务，只需循环打开 5000 请求。

# c - 推荐的 C 的 gcc 警告选项

> ID：154630
> 
> 赞同：84
> 
> 时间：2008-09-30T19:42:35.643
> 
> 标签：c, gcc, compiler-errors

除了 -Wall 之外，人们还发现哪些其他警告有用？

[http://gcc.gnu.org/onlinedocs/gcc-4.3.2/gcc/Warning-Options.html](http://gcc.gnu.org/onlinedocs/gcc-4.3.2/gcc/Warning-Options.html)

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-09-30T20:20:45.677

我经常使用：

```
 gcc -m64 -std=c99 -pedantic -Wall -Wshadow -Wpointer-arith -Wcast-qual \
        -Wstrict-prototypes -Wmissing-prototypes 
```

这个集合对于不习惯它的人来说非常有用（我第一次用这些标志编译他们的代码的人）；它很少给我带来问题（尽管 -Wcast-qual 偶尔会令人讨厌）。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-11-03T12:43:30.257

截至 2011-09-01，使用 gcc 版本 4.6.1

我目前的“发展”别名

```
gcc -std=c89 -pedantic -Wall \
    -Wno-missing-braces -Wextra -Wno-missing-field-initializers -Wformat=2 \
    -Wswitch-default -Wswitch-enum -Wcast-align -Wpointer-arith \
    -Wbad-function-cast -Wstrict-overflow=5 -Wstrict-prototypes -Winline \
    -Wundef -Wnested-externs -Wcast-qual -Wshadow -Wunreachable-code \
    -Wlogical-op -Wfloat-equal -Wstrict-aliasing=2 -Wredundant-decls \
    -Wold 样式定义 -Werror \
    -ggdb3\
    -O0\
    -fno-省略帧指针 -ffloat-store -fno-common -fstrict-aliasing \
    -lm

```

“发布”别名

```
gcc -std=c89 -pedantic -O3 -DNDEBUG -flto -lm

```

* * *

截至2009-11-03

“发展”别名

```
gcc -Wall -Wextra -Wformat=2 -Wswitch-default -Wcast-align -Wpointer-arith \
    -Wbad-function-cast -Wstrict-prototypes -Winline -Wundef -Wnested-externs \
    -Wcast-qual -Wshadow -Wwrite-strings -Wconversion -Wunreachable-code \
    -Wstrict-aliasing=2 -ffloat-store -fno-common -fstrict-aliasing \
    -lm -std=c89 -pedantic -O0 -ggdb3 -pg --coverage

```

“释放”别名

```
gcc -lm -std=c89 -pedantic -O3 -DNDEBUG --combine -fwhole-program -funroll-loops

```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-01-06T02:05:46.020

我是从 C++ 开始的，所以当我转而学习 CI 时，一定要在肛门外：

```
-f消息长度=0
-ansi -pedantic -std=c99
-错误
-墙
-Wextra
-Wwrite-strings
-Winit-self
-Wcast-对齐
-Wcast 质量
-Wpointer-arith
-Wstrict-aliasing
-W格式=2
-Wmissing-declarations
-Wmissing-include-dirs
-Wno-未使用的参数
-未初始化
-Wold-style-定义
-Wstrict-prototypes
-Wmissing 原型

```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-09-30T19:47:48.623

我喜欢-Werror。保持代码警告免费。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-11-03T12:35:49.407

获取您使用的 GCC 版本的手册，找到**所有可用的警告选项**，然后**仅**停用那些您有充分*理由*这样做的选项。（例如，不可修改的第三方标头，否则会给您很多警告。）*记录这些原因。*（在 Makefile 或您设置这些选项的任何位置。）定期检查设置，*以及每当您升级编译器时。*

编译器是你的朋友。警告是你的朋友。给编译器尽可能多的机会告诉你潜在的问题。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-30T19:49:34.113

我也使用：

> -Wstrict-溢出=5

如果我编写依赖于整数溢出行为的代码，则捕获那些*可能发生的讨厌的错误。*

和：

> -Wextra

这也启用了一些很好的选项。大多数都是针对 C++ 的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-30T19:44:12.847

我通常使用“-W -Wall -ansi -pedantic”进行编译，这有助于确保代码的最大质量和可移植性。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-30T20:26:31.323

-pedantic -Wall -Wextra -Wno-write-strings -Wno-unused-parameter

对于“伤害我很多”模式，我放弃了 -Wno ...

我喜欢让我的代码没有警告，尤其是 C++。虽然通常可以忽略 C 编译器警告，但许多 C++ 警告显示源代码中存在根本缺陷。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-21T13:07:31.853

现在我使用：

-Wall -W -Wextra -Wconversion -Wshadow -Wcast-qual -Wwrite-strings -Werror

我主要从“gcc 简介”一书中获取该列表，然后从[Ulrich Drepper](http://people.redhat.com/drepper/)关于防御性编程的推荐中获取一些列表（[http://people.redhat.com/drepper/Defensive-slides.pdf](http://people.redhat.com/drepper/Defensive-slides.pdf)）。

但我的清单背后没有任何科学依据，它只是感觉像是一个很好的清单。

/约翰

* * *

注意：虽然我不喜欢那些迂腐的旗帜......

注意：我认为 -W 和 -Wextra 或多或少是一回事。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-01T16:35:32.433

-Wredundant-decls -Wnested-externs -Wstrict-prototypes -Wextra -Werror-implicit-function-declaration -Wunused -Wno-unused-value -Wreturn-type

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-30T19:43:49.010

-迂腐错误

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-30T20:30:40.970

-Wfloat-equal, -Wshadow, -Wmissing-prototypes,

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-08-20T20:23:48.997

我一般只用

```
gcc -Wall -W -Wunused-parameter -Wmissing-declarations -Wstrict-prototypes -Wmissing-prototypes -Wsign-compare -Wconversion -Wshadow -Wcast-align -Wparentheses -Wsequence-point -Wdeclaration-after-statement -Wundef -Wpointer-arith -Wnested-externs -Wredundant-decls -Werror -Wdisabled-optimization -pedantic -funit-at-a-time -o 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-11-03T12:28:28.623

除非您指定，否则有关未初始化变量的警告将不起作用`-O`，因此我将其包含在列表中：

```
-g -O -Wall -Werror -Wextra -pedantic -std=c99 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-07-17T20:41:59.547

`-Wfatal-errors`

# java - 以编程方式嵌入 Java h2 数据库

> ID：154636
> 
> 赞同：34
> 
> 时间：2008-09-30T19:43:26.840
> 
> 标签：java, database, embedding, h2

目前我们使用[HSQLDB](http://www.hsqldb.org/)作为嵌入式数据库，但是随着数据量的增长，我们会寻找内存占用更少的数据库。

[Derby / JavaDB](http://developers.sun.com/javadb/)目前不是一个选项，因为它在系统属性中全局存储属性。所以我们想到了[h2](http://www.h2database.com/html/main.html)。

当我们使用 HSQLDB 时，我们创建了一个服务器对象，设置参数并启动它。这在[此处](http://hsqldb.org/doc/guide/ch04.html#N10BBC)进行了描述（并在 org.hsqldb.test.TestBase 类中作为示例给出）。

问题是：这也可以与 h2 数据库类似吗？你有任何代码示例吗？扫描h2-page，我没有找到一个例子。

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-09-30T22:41:32.200

是的，您可以在嵌入式模式下运行 H2。您只需使用 JDBC 驱动程序并连接到这样的嵌入式 url（他们的示例）：

> 该数据库可以在嵌入式模式下使用，也可以在服务器模式下使用。要在嵌入式模式下使用它，您需要：
> 
> ```
> * Add h2.jar to the classpath
> * Use the JDBC driver class: org.h2.Driver
> * The database URL jdbc:h2:~/test opens the database 'test' in your user home directory 
> ```

使用 JDBC 连接到嵌入式 H2 数据库的示例（改编自[http://www.h2database.com/javadoc/org/h2/jdbcx/JdbcDataSource.html](http://www.h2database.com/javadoc/org/h2/jdbcx/JdbcDataSource.html)）：

```
import org.h2.jdbcx.JdbcDataSource;
// ...
JdbcDataSource ds = new JdbcDataSource();
ds.setURL("jdbc:h2:˜/test");
ds.setUser("sa");
ds.setPassword("sa");
Connection conn = ds.getConnection(); 
```

如果您希望在纯内存/嵌入式模式下使用 H2，您也可以这样做。有关更多信息，请参阅此链接：

*   [http://www.h2database.com/html/features.html#in_memory_databases](http://www.h2database.com/html/features.html#in_memory_databases)

您只需要在普通 JDBC 代码中使用一个特殊的 URL，例如“jdbc:h2:mem:db1”。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-30T21:46:58.883

从下载中，我看到文件 tutorial.html 有这个

```
import org.h2.tools.Server;
...
// start the TCP Server
Server server = Server.createTcpServer(args).start();
...
// stop the TCP Server
server.stop(); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-09-27T18:14:27.753

如果由于某种原因您需要在服务器模式下嵌入 H2 数据库，您可以使用[http://www.h2database.com/javadoc/org/h2/tools/Server.html](http://www.h2database.com/javadoc/org/h2/tools/Server.html)上的 API 手动完成- 或附加 ;AUTO_SERVER =TRUE 到数据库 URL。

# dataflex - DataFlex 的提示/技巧

> ID：154652
> 
> 赞同：1
> 
> 时间：2008-09-30T19:46:18.160
> 
> 标签：dataflex

有人还在使用 DataFlex 吗？如果是这样，您最喜欢这款古老的 4GL 的哪些提示和技巧？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T23:20:36.570

这完全取决于您使用的 DF 版本，但这里有几个：

1.  遍历记录集时不要使用“While”。始终使用重复。（见底部示例）
2.  dataflex 新闻组 (news.dataaccess.com) 是提问的最佳场所。
3.  其他有用的网站包括[http://sture.dk/wasp](http://sture.dk/wasp)和[http://www.vdf-guidance.com](http://www.vdf-guidance.com)
4.  使用 enter_scope 而不是激活来初始化表单上的值。
5.  对于延迟模态对象，使用延迟对象上方的容器对象来传入参数。

我有更多的负载。但我只需要去躺下。我不敢相信有人问了一个 dataflex 问题。

```
clear orders
move const.complete to orders.status
find ge orders by index.2
repeat
    if orders.status ne const.complete indicate finderr true
    if (not(finderr)) begin
        send doYourStuffHere
        find gt orders by index.2
    end
until (finderr) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-08T08:36:30.043

新的数据访问全球论坛！

[http://support.dataaccess.com/forums/](http://support.dataaccess.com/forums/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-11T16:13:49.340

好久不见！

是的，DataFlex 仍然存在并且运行良好，并且被许多人和组织使用。

当前版本是“Visual”形式（即 Widows GUI）：Visual DataFlex (VDF) 14.1，虽然 v15.0 即将发布（我已经使用 alphas、betas 和 RCs 进行开发几个月了） .

字符模式产品（现在是 v3.2）仍然存在，适用于 DOS、Unix 和 Linux。

VDF 现在对 Web 应用程序、Web 服务（从 v10 起）、Ajax 库（将与 15.0 一起“装在盒子里”）、用于更好 UI 设计的 CodeJock 控件、开发环境 (VDF Studio) 有很好的支持有一段时间（自 v12.0 以来）已经如此完整，以至于我很少再走出它了（我什至在其中编写了我的 JavaScript，在为 VDF 项目执行此操作时）。它还附带一个名为 Electos 的免费 CMS（现在它本身在 v4.0 中，带有 VDF 15.0）。

它的包装盒中有用于 Pervasive、MS SQL Server、DB2 和 ODBC 数据库的连接套件，以及由 Mertech Data Systems（Riaz Merchant 的公司：www.mertechdata.com）提供的 Oracle、MySQL 和其他驱动程序。

[您可以从这里](http://www.visualdataflex.com/download.asp?pageid=845)下载免费的“个人”版本（用于非商业用途）——它是一个功能齐全的产品，但如果您从中赚钱，则需要购买犹太许可证。试一试！ **;-)**

很高兴再次收到您的来信！

迈克
（仍在与您该死的数据集的 b4stard 后代战斗！！！**；-)**）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-11T14:05:13.100

我的“工作语言”（即我作为一名受雇开发人员所从事的工作）是 Visual Dataflex，目前版本为 14.0。它不是可用的最好的语言/环境，但肯定也不是最差的。

我的第一条建议是，引用 Steve McConnell 的 Code Complete：“*用*你的语言编程，而不是*用*它。不要将你的编程思维局限在你的语言自动支持的概念上。最好的程序员会想到他们的想做，然后他们评估如何使用他们可以使用的编程工具来实现他们的目标。”

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-25T07:02:10.263

VDF/DF 提示的另一个不错的新站点是[VDF Wiki](http://www.vdfwiki.com/)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-19T12:09:38.297

vdfguidance URL 有错字，它是[http://www.vdf-guidance.com](http://www.vdf-guidance.com)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-14T16:03:59.160

mixin 继承是一个很好的特性——任何其他类的方法都可以在你的类中重用；只要您提供了它们工作所需的属性，一切都很好 = 多重继承 (MI)，没有“钻石问题”、名称冲突和其他 MI 问题

# asp.net - 关于 XMLTextWriters 和 Streams 的问题

> ID：154655
> 
> 赞同：1
> 
> 时间：2008-09-30T19:46:54.460
> 
> 标签：asp.net, stream, xmltextwriter

我们有一个第 3 方解析的 VXML 项目，为我们提供电话导航系统。我们要求他们输入一个 ID 代码来留言，稍后我们公司会对其进行审核。

我们目前的工作如下：

```
Response.Cache.SetCacheability(HttpCacheability.NoCache);
Stream m = new MemoryStream(); //Create Memory Stream - Used to create XML document in Memory
XmlTextWriter XML_Writer = new XmlTextWriter(m, System.Text.Encoding.UTF8);
XML_Writer.Formatting = Formatting.Indented;
XML_Writer.WriteStartDocument();
/* snip - writing a valid XML document */
XML_Writer.WriteEndDocument();
XML_Writer.Flush();
m.Position = 0;
byte[] b = new byte[m.Length];
m.Read(b, 0, (int)m.Length);
XML_Writer.Close();
HttpContext.Current.Response.Write(System.Text.Encoding.UTF8.GetString(b, 0, b.Length)); 
```

我只是在维护这个应用程序，不是我写的……但结尾部分对我来说似乎很复杂。

我知道它正在获取输出流并将写入的 XML 输入其中……但为什么它首先读取整个字符串？这不是低效吗？

有没有更好的方法来编写上面的代码？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T19:53:27.707

是的，只需直接写入响应`Output`（IO.StreamWriter）或`OutputStream`（IO.Stream）：

```
XmlTextWriter XML_Writer = new XmlTextWriter(HttpContext.Current.Response.OutputStream, HttpContext.Current.Response.Encoding);
//...
XML_Writer.Flush(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T19:56:04.097

之后我就可以调用 XML_Writer.Flush() 了，对吧？这会将 XML 刷新到流中吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T19:57:29.880

您可以直接写入响应流：

`Response.Cache.SetCacheability(HttpCacheability.NoCache);`

`XmlWriter XML_Writer = XmlWriter.Create(HttpContext.Current.Response.Output);`

要将设置添加到编写器，最好使用较新的[XmlWriterSettings](http://msdn.microsoft.com/en-us/library/system.xml.xmlwritersettings.aspx)类。将其作为参数提供给 XmlWriter.Create 函数。

# c++ - 用于在 Visual C++ 6.0 中查找源文件的预设位置

> ID：154661
> 
> 赞同：2
> 
> 时间：2008-09-30T19:48:08.483
> 
> 标签：c++, visual-studio, visual-c++-6

由于我们某些代码的遗留性质，我们仍在使用 Microsoft Visual 6.0 (SP6)。当我第一次附加到正在运行的进程以对其进行调试时，当我闯入该进程时，它不知道源文件的位置。因此，它要求我在给定源文件名的情况下导航到源代码树中的适当目录。它记住了这些目录，所以我不必两次进入同一个目录，但仍然很痛苦。

有没有办法用我的树中的所有源文件目录预先配置 VC6？请注意，我们的项目是使用 makefile（使用 nmake）而不是通过 DSP 构建的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T23:16:55.470

源文件的路径记录在调试信息（程序数据库，.pdb）中。使您机器上的构建树与构建它的机器相同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T00:16:33.720

是的。
进入

TOOLS
OPTIONS
DIRECTORY（选项卡）

，您可以设置 SOURCES/LIBRARIES/INCLUDE 目录位置。这些值适用于工作区中的所有项目。

我不知道设置这些值是否允许使用直接生成文件查看信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-06T05:05:45.777

绝对路径信息不会记录在我们的 PDB 文件中，因为我们故意不希望将源代码树绑定到特定的顶级目录；部署时，无法将源树放置在与构建机器上使用的位置相同的位置。

[EvilTeach](https://stackoverflow.com/users/7734/evilteach)的[解决方案](https://stackoverflow.com/questions/154661/pre-setting-locations-for-looking-for-source-files-in-visual-c-60#155689)确实提供了预期的效果，尽管我们的源代码树实际上包含数百个目录，这使得手动输入它们有些麻烦。还有一个问题是开发人员可能在任何给定时间运行多个源树，因此在调试给定可执行文件时能够在这些树之间切换是必不可少的。

我随后发现您可以通过直接更新注册表以编程方式（至少从命令行）切换一组源目录：

```
REGEDIT4

[HKEY_CURRENT_USER\Software\Microsoft\Devstudio\6.0\Build
System\Components\Platforms\Win32 (x86)\Directories]
"Source Dirs"="<path1>;<path2>" 
```

这还不算太糟糕，而且肯定会奏效。

但是，我确定的解决方案是将 SOURCE 环境变量设置为包含所有源路径（作为分号分隔的目录列表）。一个非常简单的批处理文件可以做到这一点，并允许在不同的树之间切换。然后，您从命令行运行 Visual C++，使用从环境中读取 SOURCE（以及 INCLUDE、LIB 和 PATH）的选项告诉它：

```
msdev /useenv 
```

在 Tools->Options 下查看，您会看到 SOURCE 中的目录确实已加载。然后我能够附加到正在运行的进程，并且调试器能够找到我调试的任何代码。

生活变得轻松多了！

# performance - 我可以做些什么来提高 Lua 程序的性能？

> ID：154672
> 
> 赞同：32
> 
> 时间：2008-09-30T19:51:11.660
> 
> 标签：performance, optimization, lua

我问了一个关于 Lua 性能的问题，其中一个回答[是](https://stackoverflow.com/questions/124455/how-do-you-pre-size-an-array-in-lua#152894)：

> 您是否研究过保持 Lua 高性能的一般技巧？即知道创建表，而不是创建一个新表，而是重用一个表，使用'local print=print'等来避免全局访问。

[这是一个与Lua Patterns,Tips and Tricks](https://stackoverflow.com/questions/89523/lua-patternstips-and-tricks)略有不同的问题，因为我想要特别影响性能的答案，并且（如果可能）解释为什么会影响性能。

每个答案一个提示将是理想的。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2012-10-12T18:57:36.920

针对其他一些答案和评论：

确实，作为程序员，您通常应该避免过早的优化。*但是*。对于编译器没有进行太多优化或根本没有优化的脚本语言，情况并非如此。

所以，每当你在 Lua 中写一些东西，并且经常被执行，在一个时间关键的环境中运行或者可能运行一段时间时，知道要*避免*（并避免它们）的事情是一件好事。

这是我随着时间的推移发现的集合。其中一些是我在网上发现的，但是当涉及*到互联网*时，我会怀疑我自己对所有这些都进行了测试。另外，我在 Lua.org 上阅读了 Lua 性能论文。

一些参考：

*   [Lua 性能提示](http://www.lua.org/gems/sample.pdf)
*   [Lua-users.org 优化技巧](http://lua-users.org/wiki/OptimisationTips)

# 避免全局变量

这是最常见的提示之一，但再次说明它不会受到伤害。

全局变量按其名称存储在哈希表中。访问它们意味着您必须访问表索引。虽然 Lua 有一个非常好的哈希表实现，但它仍然比访问局部变量慢很多。如果您必须使用全局变量，请将它们的值分配给局部变量，这在第二个变量访问时会更快。

```
do
  x = gFoo + gFoo;
end
do -- this actually performs better.
  local lFoo = gFoo;
  x = lFoo + lFoo;
end 
```

（并不是说简单的测试可能会产生不同的结果。例如，`local x; for i=1, 1000 do x=i; end`这里的 for 循环头实际上比循环体花费更多的时间，因此分析结果可能会被扭曲。）

# 避免创建字符串

Lua 在创建时对所有字符串进行哈希处理，这使得比较和在表中使用它们非常快，并减少了内存使用，因为所有字符串在内部只存储一次。但它使字符串创建更加昂贵。

避免过多创建字符串的一个流行选项是使用表。例如，如果您必须组装一个长字符串，创建一个表格，将各个字符串放入其中，然后使用`table.concat`它来连接*一次*

```
-- do NOT do something like this
local ret = "";
for i=1, C do
  ret = ret..foo();
end 
```

如果`foo()`只返回字符`A`，则此循环将创建一系列字符串，如`""`, `"A"`, `"AA"`,`"AAA"`等。每个字符串都将被散列并驻留在内存中，直到应用程序完成 - 看到这里的问题了吗？

```
-- this is a lot faster
local ret = {};
for i=1, C do
  ret[#ret+1] = foo();
end
ret = table.concat(ret); 
```

该方法在循环过程中根本不创建字符串，字符串是在函数中创建的`foo`，只有引用被复制到表中。之后， concat 创建第二个字符串`"AAAAAA..."`（取决于大小`C`）。请注意，您*可以*使用`i`代替，`#ret+1`但通常您没有这样有用的循环，并且您将没有可以使用的迭代器变量。

我在 lua-users.org 某处发现的另一个技巧是，如果您必须解析字符串，请使用 gsub

```
some_string:gsub(".", function(m)
  return "A";
end); 
```

乍一看，这看起来很奇怪，好处是 gsub 在 C 中“立即”创建了一个字符串，该字符串仅在 gsub 返回时将其传递回 lua 后才进行哈希处理。这避免了表的创建，但可能有更多的函数开销（不是如果你调用`foo()`，而是 if`foo()`实际上是一个表达式）

# 避免函数开销

尽可能使用语言结构而不是函数

## 功能`ipairs`

当迭代一个表时，来自 ipairs 的函数开销并不能证明它的使用是合理的。要迭代表，请改为使用

```
for k=1, #tbl do local v = tbl[k]; 
```

它在没有函数调用开销的情况下完全相同（pairs 实际上返回另一个函数，然后为表中的每个元素调用该函数，而`#tbl`只计算一次）。即使您需要价值，它也快得多。如果你不...

**Lua 5.2 的注意事项**：在 5.2 中，您实际上可以在元表中定义一个`__ipairs`字段，这在某些情况下*确实有用。*`ipairs`但是，Lua 5.2 也使该`__len`字段适用于表，因此您可能*仍然*更喜欢上面的代码，`ipairs`因为`__len`元方法只调用一次，而`ipairs`每次迭代都会得到一个额外的函数调用。

## 功能`table.insert`，`table.remove`

`table.insert`和的简单用法`table.remove`可以通过使用`#`运算符来代替。基本上这是用于简单的推送和弹出操作。这里有些例子：

```
table.insert(foo, bar);
-- does the same as
foo[#foo+1] = bar;

local x = table.remove(foo);
-- does the same as
local x = foo[#foo];
foo[#foo] = nil; 
```

对于班次（例如`table.remove(foo, 1)`），如果不希望以稀疏表结束，那么使用表函数当然更好。

# 使用表进行 SQL-IN 类似比较

您可能（也可能不会）在代码中做出如下决定

```
if a == "C" or a == "D" or a == "E" or a == "F" then
   ...
end 
```

现在这是一个完全有效的案例，但是（根据我自己的测试）从 4 个比较开始并排除表生成，这实际上更快：

```
local compares = { C = true, D = true, E = true, F = true };
if compares[a] then
   ...
end 
```

并且由于哈希表具有恒定的查找时间，因此每次额外比较都会增加性能增益。另一方面，如果“大多数时候”有一个或两个比较匹配，则使用布尔方式或组合可能会更好。

# 避免频繁创建表

这在[Lua Performance Tips](http://www.lua.org/gems/sample.pdf)中有详细的讨论。基本上问题在于 Lua 会按需分配您的表，并且这样做实际上比清理它的内容并再次填充它要花费更多的时间。

然而，这有点问题，因为 Lua 本身并没有提供从表中删除所有元素的方法，而且`pairs()`它本身也不是性能野兽。我自己还没有对这个问题进行任何性能测试。

如果可以，定义一个清除表的 C 函数，这应该是表重用的一个很好的解决方案。

# 避免一遍又一遍地做同样的事情

这是最大的问题，我想。虽然非解释性语言的编译器可以轻松优化大量冗余，但 Lua 不会。

## 记忆

在 Lua 中使用表可以很容易地完成。对于单参数函数，您甚至可以用表和 __index 元方法替换它们。尽管这会破坏透明度，但由于少了一个函数调用，缓存值的性能会更好。

这是使用元表对单个参数进行记忆化的实现。（重要提示：此变体不*支持*nil 值参数，但对于现有值来说非常快。）

```
function tmemoize(func)
    return setmetatable({}, {
        __index = function(self, k)
            local v = func(k);
            self[k] = v
            return v;
        end
    });
end
-- usage (does not support nil values!)
local mf = tmemoize(myfunc);
local v  = mf[x]; 
```

您实际上可以针对多个输入值修改此模式

## [部分应用](http://en.wikipedia.org/wiki/Partial_application)

这个想法类似于memoization，即“缓存”结果。但是这里不是缓存函数的结果，而是通过将中间值的计算放入构造函数中来缓存中间值，该构造函数在其块中定义计算函数。实际上，我只会称其为巧妙地使用闭包。

```
-- Normal function
function foo(a, b, x)
    return cheaper_expression(expensive_expression(a,b), x);
end
-- foo(a,b,x1);
-- foo(a,b,x2);
-- ...

-- Partial application
function foo(a, b)
    local C = expensive_expression(a,b);
    return function(x)
        return cheaper_expression(C, x);
    end
end
-- local f = foo(a,b);
-- f(x1);
-- f(x2);
-- ... 
```

这样就可以轻松创建灵活的函数来缓存他们的一些工作，而不会对程序流程产生太大影响。

一个极端的变体是[Currying](http://en.wikipedia.org/wiki/Currying)，但这实际上更像是一种模仿函数式编程的方法。

这是一个更广泛（“真实世界”）的示例，其中有一些代码遗漏，否则它很容易在这里占据整个页面（即`get_color_values`实际上做了很多值检查并识别接受混合值）

```
function LinearColorBlender(col_from, col_to)
    local cfr, cfg, cfb, cfa = get_color_values(col_from);
    local ctr, ctg, ctb, cta = get_color_values(col_to);
    local cdr, cdg, cdb, cda = ctr-cfr, ctg-cfg, ctb-cfb, cta-cfa;
    if not cfr or not ctr then
        error("One of given arguments is not a color.");
    end

    return function(pos)
        if type(pos) ~= "number" then
            error("arg1 (pos) must be in range 0..1");
        end
        if pos < 0 then pos = 0; end;
        if pos > 1 then pos = 1; end;
        return cfr + cdr*pos, cfg + cdg*pos, cfb + cdb*pos, cfa + cda*pos;
    end
end
-- Call 
local blender = LinearColorBlender({1,1,1,1},{0,0,0,1});
object:SetColor(blender(0.1));
object:SetColor(blender(0.3));
object:SetColor(blender(0.7)); 
```

您可以看到，一旦创建了搅拌机，该函数只需检查单个值而不是最多八个。我什至提取了差异计算，虽然它可能没有太大改进，但我希望它能显示这种模式试图实现的目标。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-28T21:15:21.697

如果您的 lua 程序真的太慢，请使用 Lua 分析器并清理昂贵的东西或迁移到 C。但是如果您不坐在那里等待，那么您的时间就被浪费了。

优化第一定律：不要。

我很乐意看到一个问题，您可以在 ipairs 和pairs 之间进行选择，并且可以衡量差异的影响。

一个容易实现的目标是记住在每个模块中使用局部变量。一般不值得做类似的事情

```
本地 strfind = string.find

```

除非你能找到一个测量结果告诉你。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-28T02:06:51.467

*   使最常用的函数本地化
*   充分利用表作为 HashSet
*   通过重用减少表创建
*   使用 luajit！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-06-26T18:37:59.897

还必须指出，使用表中的数组字段比使用任何类型的键的表要快得多。它发生（几乎）所有 Lua 实现（包括 LuaJ）在表中存储一个称为“数组部分”，由表数组字段访问，并且不存储字段键，也不查找它；）。

您甚至可以模仿其他语言的静态方面，如`struct`C++/Java`class`等。本地和数组就足够了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-28T01:40:52.250

保持表格简短，表格越大，搜索时间越长。并且在同一行中迭代数字索引表（=数组）比基于键的表快（因此 ipairs 比对快）

# linq - 具有多个聚合的 LINQ 查询

> ID：154680
> 
> 赞同：6
> 
> 时间：2008-09-30T19:52:28.987
> 
> 标签：linq, .net-3.5, linq-to-objects

如何创建等效的 Linq To Objects 查询？

```
SELECT MIN(CASE WHEN p.type = "In" THEN p.PunchTime ELSE NULL END ) AS EarliestIn,
       MAX(CASE WHEN p.type = "Out" THEN p.PunchTime ELSE NULL END ) AS LatestOUt
FROM Punches p 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T20:55:41.800

产生最小值和最大值的单个枚举（以及您想要放入其中的任何其他聚合）。这在 vb.net 中要容易得多。

我知道这不能处理空箱。这很容易添加。

```
 List<int> myInts = new List<int>() { 1, 4, 2, 0, 3 };
    var y = myInts.Aggregate(
        new { Min = int.MaxValue, Max = int.MinValue },
        (a, i) =>
        new
        {
           Min = (i < a.Min) ? i : a.Min,
           Max = (a.Max < i) ? i : a.Max
        });
    Console.WriteLine("{0} {1}", y.Min, y.Max); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T19:59:40.467

您无法在 vanilla LINQ to Objects 中有效地选择多个聚合。当然，您可以执行多个查询，但这可能效率低下，具体取决于您的数据源。

我有一个框架来解决这个问题，我称之为“Push LINQ”——这只是一种爱好（对我和 Marc Gravell 来说），但我们相信它工作得很好。它作为[MiscUtil](http://pobox.com/~skeet/csharp/miscutil)的一部分提供，您可以在[我的博客文章中了解它](http://msmvps.com/blogs/jon_skeet/archive/2008/01/04/quot-push-quot-linq-revisited-next-attempt-at-an-explanation.aspx)。

它看起来有点奇怪 - 因为您将希望结果的位置定义为“期货”，然后通过查询推送数据，然后检索结果 - 但是一旦您了解它，就可以了。我很想听听您如何使用它 - 如果您使用它，请通过 skeet@pobox.com 给我发邮件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-19T15:55:33.960

可以使用 LINQ-to-Objects 进行多个聚合，但这有点难看。

```
var times = punches.Aggregate(
    new { EarliestIn = default(DateTime?), LatestOut = default(DateTime?) },
    (agg, p) => new {
        EarliestIn = Min(
            agg.EarliestIn,
            p.type == "In" ? (DateTime?)p.PunchTime : default(DateTime?)),
        LatestOut = Max(
            agg.LatestOut,
            p.type == "Out" ? (DateTime?)p.PunchTime : default(DateTime?)) 
    }
); 
```

您还需要 DateTime 的 Min 和 Max 函数，因为这些不是可用的标准。

```
public static DateTime? Max(DateTime? d1, DateTime? d2)
{
    if (!d1.HasValue)
        return d2;
    if (!d2.HasValue)
        return d1;
    return d1.Value > d2.Value ? d1 : d2;
}
public static DateTime? Min(DateTime? d1, DateTime? d2)
{
    if (!d1.HasValue)
        return d2;
    if (!d2.HasValue)
        return d1;
    return d1.Value < d2.Value ? d1 : d2;
} 
```

# debian - 通过 exim4 指定用于邮件的远程端口

> ID：154686
> 
> 赞同：3
> 
> 时间：2008-09-30T19:53:39.780
> 
> 标签：debian, ports, mx-record, exim4

我有一个使用 Exim4 的股票 Debian Etch 系统。这些域大多是本地的，但也有一些是远程的。为了处理远程邮件的传递，我使用了 Debian 配置文件：

```
 /etc/exim4/hubbed_hosts 
```

该文件列出了域名和要传送到的远程 MX 机器。例如：

```
 example.org:  mx.example.com
  example.com:  mx2.example.com 
```

查看 exim4 配置文件，我看到它的用法如下：

```
hubbed_hosts:
  debug_print = "R: hubbed_hosts for $domain"
  driver = manualroute
  domains = "${if exists{CONFDIR/hubbed_hosts}\
                   {partial-lsearch;CONFDIR/hubbed_hosts}\
              fail}"
  route_data = ${lookup{$domain}partial-lsearch{CONFDIR/hubbed_hosts}}
  transport = remote_smtp 
```

我遇到的问题是我使用的*一些*主机需要将他们的邮件传递到非标准端口。不幸的是，如果我尝试将 Debian hubbed_hosts 文件更改为包含端口，则该文件不起作用：

```
example.org: mx1.example.org:2525
example.com: 1.2.3.4.2525 
```

是否可以动态允许指定端口？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-12-23T02:21:39.950

这实际上是默认支持的，无需对您的 exim4 配置进行任何更改。

在 hubbed_hosts 中，您使用冒号分隔主机，并使用双冒号指定端口号。前任：

```
domain1: server1:server2::port:server3
domain2: server1::port
domain3: server1:server2 
```

欲了解更多信息，请查看[http://www.exim.org/exim-html-current/doc/html/spec_html/ch20.html#SECID122](http://www.exim.org/exim-html-current/doc/html/spec_html/ch20.html#SECID122)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T20:12:45.693

我希望有一些更动态的东西 - 这个解决方案有效：

```
 port = ${if exists{/etc/exim4/ports.list}\
              {${lookup{$domain}lsearch{/etc/exim4/ports.list}\
              {$value}{25}}}{25}} 
```

然后一个简单的文件可能有一个基于每个域的端口列表：

```
 example.org: 2525
   example.com: 26 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T21:38:25.417

您可能可以使用 ${extract} 运算符来组合端口号和主机名，就像原始问题中的示例一样。

类似（未经测试）：

```
route_data = ${extract{1}{:}{${lookup{$domain}partial-lsearch{CONFDIR/hubbed_hosts}}}} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T19:59:42.323

创建一个指定端口的新传输

```
remote_hub_2525:
driver = smtp
port = 2525 
```

然后为需要非标准交付的域创建一个路由器

```
non_standard_hub:
driver = manualroute
domains = example.org : example.com
transport = remote_hub_2525
no_more 
```

# c# - 从 DataGridViewCell 获取数值？

> ID：154697
> 
> 赞同：2
> 
> 时间：2008-09-30T19:56:57.760
> 
> 标签：c#

我正在尝试从`DataGridView`. 到目前为止，我发现的唯一方法是将它们作为字符串检索并将它们转换为数字。

```
Convert.ToDouble(MyGrid.SelectedRows[0].Cells[0].Value.ToString()); 
```

必须有更简单的方法。`DataSet`该单元格最初是从一个数字字段值填充的，但由于该`DataGridViewCell`对象将其作为对象返回，因此我无法进行直接分配。我必须在这里遗漏一些简单的东西。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T03:57:20.540

实际上，我最近才处理过这个问题，`TryParse`我认为这是您在稳健性方面的最佳选择，但不要忘记检查 Cell 中的值是否为`null`，如果是，`TryParse`则会失败并引发错误。

```
double d = 0;
if(grid[col,row].Value != null)
  double.TryParse(grid[col,row].Value.ToString(), out d); 
```

我还建议避免直接转换，除非您绝对知道要转换的类型并且实际上那里会有一个值，它可能会在某些时候导致代码中的错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T20:55:32.177

With `DataGridViewCell` you can just cast the `.Value` to your known type; the following is a complete example that shows this happening (using double) from a `DataTable` (like your example). Additionally, `Convert.To{blah}(...)` and `Convert.ChangeType(...)` might be helpful.

```
using System.Data;
using System.Windows.Forms;
static class Program
{
    static void Main()
    {
        Application.EnableVisualStyles();
        DataTable table = new DataTable
        {
            Columns = {
                {"Foo", typeof(double)},
                {"Bar", typeof(string)}
            },
            Rows = {
                {123.45, "abc"},
                {678.90, "def"}
            }
        };
        Form form = new Form();
        DataGridView grid = new DataGridView {
            Dock = DockStyle.Fill, DataSource = table};
        form.Controls.Add(grid);
        grid.CurrentCellChanged += delegate
        {
            form.Text = string.Format("{0}: {1}",
                grid.CurrentCell.Value.GetType(),
                grid.CurrentCell.Value);

            if (grid.CurrentCell.Value is double)
            {
                double val = (double)grid.CurrentCell.Value;
                form.Text += " is a double: " + val;
            }
        };
        Application.Run(form);

    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T20:34:30.727

`DataGridViewCell`有财产`ValueType`。您可以使用直接将值转换为该类型，而无需先将其转换为字符串：

```
if(MyGrid.SelectedRows[0].Cells[0].ValueType!=null &&
   MyGrid.SelectedRows[0].Cells[0].ValueType == Double)
 return (Double)MyGrid.SelectedRows[0].Cells[0].Value; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T20:16:47.540

你得到什么错误？`Convert.ToDouble`有一个接受对象的重载方法，所以你不应该需要`ToString()`? 除非你正在做一个`TryParse`?

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T20:37:17.070

由于`DataGridViewCell.Value`是 Object 类型，因此您确实需要将其转换为适当的类型，`Double`或者`numeric`您的情况下的任何类型。内容`DataGridView`不是强类型的，因此您必须转换从其单元格中检索到的值。

# c# - 如何防止类在 C# 中被继承？

> ID：154698
> 
> 赞同：7
> 
> 时间：2008-09-30T19:57:00.507
> 
> 标签：c#, .net, inheritance

在java中，我可以用'final'关键字来做到这一点。我在 C# 中看不到“final”。有替代品吗？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-30T19:57:12.220

您正在寻找`sealed`关键字。它与`final`Java 中的关键字完全一样。尝试继承将导致编译错误。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-30T20:19:00.563

还要注意，“我认为没有人需要继承这个”不是使用“密封”的好理由。除非您特别需要确保使用特定的实现，否则请保持类未密封。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T20:09:02.457

正如乔尔已经建议的那样，您可以在 C#中使用`sealed`而不是。`final`

[http://en.csharp-online.net/CSharp_FAQ:_Does_CSharp_support_final_classes](http://en.csharp-online.net/CSharp_FAQ:_Does_CSharp_support_final_classes)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T23:19:56.337

`sealed`修饰符将执行Java`final`中的操作。

此外，尽管在这种情况下这可能不是您要寻找的，但将一个类标记为`static`也可以防止它被继承（它在幕后被密封）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T20:36:15.530

关键字会`sealed`起作用，但您仍然可以使用反射 IIRC 从类派生。

# asp.net-mvc - CrystalReportViewer 按钮使用 MVC 框架损坏

> ID：154702
> 
> 赞同：5
> 
> 时间：2008-09-30T19:57:43.203
> 
> 标签：asp.net-mvc, crystal-reports

我们使用 MVC 框架（第 5 版）和 CrystalReportViewer 控件来显示我们的报表。我无法让报表查看器控件顶部的任何按钮工作。

如果我正在处理“HoursSummary”报告。如果我将鼠标悬停在 IE 中报表查看器上的任何按钮上，页面底部显示的链接是“../HoursSummary”。这将创建一个 ' [http://localhost/HoursSummary](http://localhost/HoursSummary) ' 的 url。没有“HoursSummary”控制器，所以我不断收到 404 错误。

*   我相信我想重定向到“ [http://localhost/reports/HoursSummary](http://localhost/reports/HoursSummary) ”，因为我确实有一个报告控制器。如果这是正确的方法，是否有人知道我应该在 CrystalReportViewer 控件上设置哪个属性才能实现这一点？
*   有没有更简单的方法来处理这种情况？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T21:51:30.277

如果那是服务器控件，它将不起作用。ASP.NET MVC 不使用任何回发，因此大多数 webforms 服务器控件不起作用。

您可以做的是将报表查看器嵌入 iFrame 并将其输出到您的 MVC 视图中。iframe 可以指向MVC 内容*之外的页面，例如在名为 Legacy 的子文件夹中。*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-07T17:34:14.757

我们能够让报表查看器正常工作，并且过去几个月一直在生产中使用它，没有任何问题。

*   我们有一个报告控制器，它列出了指向我们要运行的报告的链接
*   单击其中一个链接将对后端进行 ajax 调用并返回一个部分页面，我们可以在其中填写我们需要的所有参数。
*   填写完参数后，我们将表单提交到'\reports\Name of Report'。
*   回到 Reports 控制器，我们调用 SQL，返回我们的数据，然后调用另一个名为“Full Report”的视图
*   “完整报表”视图只有一个水晶报表查看器控件，它会自动获取我们通过 ViewData 传递给它的报表数据，填充报表，呈现它，并将其发送给用户

一切似乎都很好。

更新

我在上面最初列出的步骤中添加了一些代码和说明。我遗漏的关键项目是最终视图背后有一些代码，因此它可以与 Crystal Reports 一起使用。后面的代码很少，但需要。为了使 Crystal Reports 正常工作，您最终会得到以下文件：

*   设计报告的布局文件.rpt
*   一个包含 Crystal Reports Report 控件的 aspx 文件。这是将包含一些代码的文件。

有关如何创建适用于 Crystal Reports 的视图的详细信息：

*   使用 Crystal Reports 设计器创建报表的布局。生成的文件将是一个 .rpt 文件。为了本示例，我们将此文件称为 AllJobsSummaryReportLayout.rpt。
*   在设计您的报告时，对于“数据库字段”，选择一个业务实体或 DTO 来保存从 SQL 返回的结果。
*   顺便说一句，我们的系统中有一些数据传输对象 (DTO)，它们仅包含标量值和字符串，这些 DTO 中没有智能。当控制器被调用时，它会调用模型，大多数这些报告的模型返回一个 DTO 列表，然后我们将其传递给要呈现的视图。这些 DTO 不知道如何查询自己、显示自己，它们只包含从 SQL 返回的实际值，然后由其他人呈现。
*   一旦布局水晶报表文件AllJobsSummaryReportLayout.rpt，我们设计我们的Controller。在控制器中，我们获取运行报告所需的任何参数，调用模型，模型返回我们的 DTO 列表，如下面的控制器片段所示：

    ```
    var reportViewData = model.AllJobsSummaryQuery(startDate, endDate);
    if (0 != reportViewData.Count())
    {
        var report = new AllJobsSummaryReportLayout();
        report.SetDataSource(reportViewData);
        report.SetParameterValue("startDate", startDate);
        report.SetParameterValue("endDate", endDate);
        ViewData["ReportData"] = report;
        returnView = "AllJobsSummaryView";
    }
    else
        returnView = "noReportView";
    return View(returnView); 
    ```

*   请注意这里的几个项目，我们正在创建一个变量“报告”，它是我们在上面创建的 Crystal Report 布局文件 AllJobsSummaryReportLayout.rpt 的一种类型。

*   一旦我们创建了“报告”变量，我们就设置了数据源值和我们需要的任何参数，并将项目捆绑到 ViewData 中。

*   现在让我们看一下AllJobsSummaryView.aspx。该文件上有一个带有 Crystal Reports 查看器的表单和一个代码隐藏文件：

> ```
> <%@ Page Title="All Jobs Summary Report" Language="C#" AutoEventWireup="true" CodeBehind="AllJobsSummaryView.aspx.cs" Inherits="V.Views.Reports.AllJobsSummaryView"%>     
> <%@ Register Assembly="CrystalDecisions.Web, Version=10.5.3700.0, Culture=neutral, PublicKeyToken=692fbea5521e1304" Namespace="CrystalDecisions.Web" TagPrefix="CR" %> 
> <form id="form1" runat="server">
> <div>
> <a href="/Reports" id="Report"><< Return to Report Main
>     Page</a><br />
> <CR:CrystalReportViewer ID="ReportViewer" runat="server" AutoDataBind="True" EnableDatabaseLogonPrompt="False"
>     EnableParameterPrompt="False" HasCrystalLogo="False" DisplayGroupTree="False" 
>     HasDrillUpButton="False" HasToggleGroupTreeButton="False" HasViewList="False" 
>     HasSearchButton="False" EnableDrillDown="False" EnableViewState="True" 
>     Height="50px" ReportSourceID="CrystalReportSource1" Width="350px" />    
> <CR:CrystalReportSource ID="CrystalReportSource1" runat="server">
>     <Report FileName="AllJobsSummaryReportLayout.rpt">
>     </Report>
> </CR:CrystalReportSource>
> </div>
> </form> 
> ```

*   以及文件背后的代码：

    ```
     using System;
     using System.Collections.Generic;
     using System.Linq;
     using System.Web;
     using System.Web.Mvc;

     namespace V.Views.Reports
     {
        public partial class AllJobsSummaryView : ViewPage
        {
            protected void Page_Init(object sender, EventArgs e)
            {
                ReportViewer.ReportSource = ViewData["ReportData"];
            }

            protected void Page_Unload(object sender, EventArgs e)
            {
                ((AllJobsSummaryReportLayout)ViewData["ReportData"]).Close();
                ((AllJobsSummaryReportLayout)ViewData["ReportData"]).Dispose();
            }
        }
     } 
    ```

*   Page_Unload 是关键，没有它，Crystal Reports 将生成错误“您已超出管理员设置的最大报告数”。

这种方法在生产环境中仍然工作了两年多。

# .net - 我可以在不引用 Microsoft.VisualBasic 的情况下以 c# VB6 样式拆分字符串吗？

> ID：154706
> 
> 赞同：2
> 
> 时间：2008-09-30T19:58:15.683
> 
> 标签：.net, .net-3.5, c#-3.0

不幸的是，似乎没有 string.Split(string separator)，只有 string.Split(char speparator)。

我想根据多字符分隔符（la VB6）分解我的字符串。在 c# 中是否有一种简单的（即，不是通过引用 Microsoft.VisualBasic 或必须学习 RegExes）方法来做到这一点？

编辑：使用 .NET Framework 3.5。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T20:01:44.893

`String.Split()`有其他重载。他们中的一些人会`string[]`争论。

```
string original = "first;&second;&third";
string[] splitResults = original.Split( new string[] { ";&" }, StringSplitOptions.None ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T20:00:14.587

用于分割字符串的正则表达式非常简单，所以我会选择这条路线。

[http://msdn.microsoft.com/en-us/library/8yttk7sy.aspx](http://msdn.microsoft.com/en-us/library/8yttk7sy.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T20:01:02.430

哪个版本的.Net？至少 2.0 及以后的版本包括以下重载：

```
.Split(string[] separator, StringSplitOptions options)  
.Split(string[] separator, int count, StringSplitOptions options) 
```

现在，如果他们只修复它以接受任何 IEnumerable<string> 而不仅仅是数组。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T20:06:07.630

正则表达式版本可能更漂亮，但这也有效：

```
string[] y = { "bar" };

string x = "foobarfoo";
foreach (string s in x.Split(y, StringSplitOptions.None))
      Console.WriteLine(s); 
```

这将打印 foo 两次。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T20:07:33.413

```
 string[] stringSeparators = new string[] {"[stop]"};
    string[] result;
result = someString.Split(stringSeparators, StringSplitOptions.None); 
```

通过[http://msdn.microsoft.com/en-us/library/tabh47cf.aspx](http://msdn.microsoft.com/en-us/library/tabh47cf.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-05T21:33:04.273

我一直在 .NET 2.0 下使用它。

```
string[] args = "first;&second;&third".Split(";&".ToCharArray(),StringSplitOptions.RemoveEmptyEntries); 
```

# mysql - 在数据库中存储媒体文件的最佳方式是什么？

> ID：154707
> 
> 赞同：66
> 
> 时间：2008-09-30T19:58:30.517
> 
> 标签：mysql, database, audio, multimedia

我想在数据库中存储大量的声音文件，但我不知道这是否是一个好习惯。我想知道这样做的利弊。

我还考虑了与这些文件建立“链接”的可能性，但也许这会带来比解决方案更多的问题。欢迎任何这方面的经验:)

注意：数据库将是 MySQL。

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-09-30T20:11:41.127

我知道的每个存储大量大文件的系统都将它们存储在数据库外部。您将文件的所有可查询数据（标题、艺术家、长度等）以及文件的部分路径存储在数据库中。当需要检索文件时，您提取文件的路径，在其前面添加一些文件根（或 URL），然后返回。

因此，您将有一个“位置”列，其中包含部分路径，例如“a/b/c/1000”，然后您将其映射到：“ [http://myserver/files/a/b/c /1000.mp3](http://myserver/files/a/b/c/1000.mp3) "

确保您有一种简单的方法将媒体数据库指向不同的服务器/目录，以防您需要它来进行数据恢复。此外，您可能需要一个将数据库与文件存档内容重新同步的例程。

此外，如果您将拥有数千个媒体文件，请不要将它们全部存储在一个巨大的目录中——这对某些文件系统来说是一个性能瓶颈。相反，将它们分解为多个平衡的子树。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-30T20:11:22.077

我认为将它们存储在数据库中是可以的，只要你使用一个好的实现。您可以阅读这篇较早但很好的文章，了解如何防止数据库中的大量数据影响性能。

[http://www.dreamwerx.net/phpforum/?id=1](http://www.dreamwerx.net/phpforum/?id=1)

我已经在 mysql 数据库中加载了 100 个演出，没有任何问题。设计和实现是关键，做错了，你会受苦。

更多数据库优势（尚未提及）： - 在负载平衡的环境中工作得更好 - 您可以构建更多的后端存储可扩展性

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-30T20:04:48.287

使用数据库的优点：

*   易于将声音文件与其他数据位连接起来。
*   避免绕过数据库安全的文件 i/o 操作。
*   删除数据库记录时无需分离操作删除声音文件。

使用数据库的缺点：

*   数据库膨胀
*   数据库可能比文件系统更昂贵

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-30T20:12:02.857

我已经在不同的项目中尝试了两种方式，我们最终决定使用文件系统也更容易。毕竟，文件系统已经针对存储、检索和索引文件进行了优化。

我对此的一个提示是仅在数据库中存储文件的“根相对”路径，然后让您的程序或查询/存储过程/中间件使用安装特定的根参数来检索文件.

例如，如果您将 XYZ.Wav 存储在 C:\MyProgram\Data\Sounds\X\ 中，则完整路径为

```
C:\MyProgram\Data\Sounds\X\XYZ.Wav 
```

但是您可以将数据库中的路径和/或文件名存储为：

```
X\XYZ.Wav 
```

在其他地方，在数据库或程序的配置文件中，存储一个根路径，如 SoundFilePath 等于

C:\MyProgram\Data\Sounds\

当然，从数据库路径中拆分根目录的位置取决于您。这样，如果您移动程序安装，您就不必更新数据库。

此外，如果有*很多*文件，请找到一些散列路径的方法，这样你就不会得到一个包含数百或数千个文件的目录（在我的小例子中，有基于第一个字符的子目录文件名，但您可以更深入或使用随机哈希）。这也使搜索索引器感到高兴。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-30T20:25:13.620

使用 blob 存储文件的一些优点

*   降低管理开销 - 使用单一工具来备份/恢复等
*   数据库和文件系统不可能不同步
*   交易能力（如果需要）

一些缺点

*   用可以用来存储行、索引等的无用垃圾来炸毁数据库服务器的 RAM
*   使您的数据库备份非常大，因此不易管理
*   不像文件系统那样方便地为客户端提供服务（例如，使用 Web 服务器）

* * *

性能呢？你的旅费可能会改变。文件系统千差万别，数据库的性能也千差万别。在某些情况下，文件系统会胜出（可能有更少的大文件）。在某些情况下，数据库可能会更好（可能有大量的小文件）。

无论如何，别担心，做当时看起来最好的事情。

一些数据库提供了一个内置的 Web 服务器来服务 Blob。在撰写本文时，MySQL 还没有。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-30T20:04:40.253

您可以将它们存储为 BLOB（或 LONGBLOB），然后在您想要实际访问媒体文件时检索数据。

或者

您可以简单地将媒体文件存储在驱动器上，并将元数据存储在数据库中。

我倾向于后一种方法。我不知道这在世界上是如何完成的，但我怀疑许多其他人也会这样做。

您可以存储链接（数据的部分路径），然后检索此信息。可以轻松地在驱动器上移动东西并仍然可以访问它。

我将每个文件的相对路径与有关文件的其他元数据一起存储在数据库中。如果我需要将实际数据重新定位到另一个驱动器（本地或通过 UNC 路径），则可以即时更改基本路径。

我就是这样做的。我相信其他人也会有想法。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-01-04T17:36:26.437

将它们存储为外部文件。然后将路径保存在 varchar 字段中。将大型二进制 blob 放入关系数据库通常效率很低 - 它们只会占用空间，并且在缓存被填充时会减慢速度，这是不可用的。而且没有任何收获 - 无法搜索 blob 本身。不过，您可能希望将媒体元数据保存到数据库中。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-30T20:01:12.320

一个简单的解决方案是将文件的相对位置存储为字符串并让文件系统处理它。我已经在一个项目中尝试过（我们将办公文件附件存储到调查中），并且效果很好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-05-06T05:44:18.050

存储音频/视频文件的最佳方式是，您可以使用本地或云端的任何分布式存储。

[https://min.io/](https://min.io/)

云：AWS S3

# regex - 使用正则表达式进行多行分组和搜索

> ID：154708
> 
> 赞同：2
> 
> 时间：2008-09-30T19:58:43.030
> 
> 标签：regex

好的，正则表达式向导。我希望能够搜索我的日志文件并找到其中包含“错误”一词的任何会话，然后返回整个会话日志条目。

我知道我可以使用字符串/数组来做到这一点，但我想学习如何使用 Regex 来做到这一点，但这是问题所在。如果我决定用 Regex 来做这件事，我[会遇到一两个问题](http://www.codinghorror.com/blog/archives/001016.html)吗？;o)

这是日志：

PS：我正在使用 perl 正则表达式引擎。

**注意**：我认为我无法在 Regex 中完成此操作。换句话说，我现在有两个问题。;o) 我已经尝试了下面的解决方案，但是由于我说我使用的是 Perl 引擎而混淆了这个问题，所以许多答案都在 Perl 中（在我的情况下不能使用）。但是，我确实在下面发布了我的解决方案。

* * *

```
2008.08.27 08:04:21 (Wed)------------Start of Session-----------------  
Blat v2.6.2 w/GSS encryption (build : Feb 25 2007 12:06:19)  
Sending stdin.txt to foo@bar.com  
Subject: test 1  
Login name is foo@bar.com  
The SMTP server does not require AUTH LOGIN.  
Are you sure server supports AUTH?  
The SMTP server does not like the sender name.  
Have you set your mail address correctly?  
2008.08.27 08:04:24 (Wed)-------------End of Session------------------  

2008.08.27 08:05:56 (Wed)------------Start of Session-----------------  
Blat v2.6.2 w/GSS encryption (build : Feb 25 2007 12:06:19)  
Error: Wait a bit (possible timeout).  
SMTP server error  
Error: Not a socket.  
Error: Not a socket.  
2008.08.27 08:06:26 (Wed)-------------End of Session------------------  

2008.08.27 08:07:58 (Wed)------------Start of Session-----------------  
Blat v2.6.2 w/GSS encryption (build : Feb 25 2007 12:06:19)  
Sending stdin.txt to foo@bar.com  
Subject: Lorem Update 08/27/2008  
Login name is foo@bar.com  
2008.08.27 08:07:58 (Wed)-------------End of Session------------------ 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-30T20:25:33.447

凯尔的回答可能是最失败的，但如果您将所有内容都放在一个字符串中并想使用单个正则表达式，这里有一个（经过测试的）解决方案：

（*第二次更新*：修正了一点，现在比以往任何时候都更具可读性；-）

```
my $re = qr{
        (           # capture in $1
         (?:
          (?!\n\n). # Any character that's not at a paragraph break
         )*        # repeated
         error
         (?:
          (?!\n\n).
         )*
        )
}msxi;

while ($s =~ m/$re/g){
    print "'$1'\n";
} 
```

丑陋，但你要求它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-30T20:05:46.053

看起来您的会话似乎由空白行分隔（除了开始/结束标记）。如果是这样的话，这是一个单行：

`perl -ne 'BEGIN{$/=""} print if /error/i' < logfile`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T20:44:47.380

```
/(?:[^\n\r]|\r?\n(?!\r|\n))*?Error:(?:[^\n\r]|\r?\n(?!\r|\n))*/g 
```

这利用了条目之间的空白行。它适用于 unix 和 windows 换行符。如果您愿意，您可以用几乎任何其他内容替换中间的文本“错误：”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T20:28:58.977

就像最后一个人说的，命令行中的 perl 可以工作。命令行中的 awk 也是如此：
`awk '/-Start of Session-/ { text=""; gotError=0; } /Error/{gotError=1;}/-End of Session-/{ if(gotError) {print text}} { text=text "\n" $0}' logFileName.txt`

基本上，在“-Start of Session-”行开始录制，在“Error”行设置标志，并在“-End of Session-”行有条件地输出。

或者把它放到errorLogParser.awk中：

```
/-会话开始-/{
    文字="";
    得到错误=0；
}
/错误/{
    得到错误=1；
}
/-会话结束-/{
    如果（得到错误）
    {
        打印文本
    }
}
{
    文本=文本“\n”$0
}

```

...并像这样调用： `awk -f errorLineParser.awk logFileName.txt`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T20:29:43.017

使用 perl 正则表达式引擎，简单的正则表达式

```
Error:.+ 
```

根据[quickrex](https://stackoverflow.com/questions/89718/is-there-anything-like-regexbuddy-in-the-open-source-world#89858)的技巧。

（使用 java regexp 引擎，需要另一个 regexp：

```
(?ms)^Error:[^\r\n]+$ 
```

)

带有捕获组的正则表达式将只允许重定向错误消息而不是“错误”本身，如：

```
Error:\s*(\S.+) 
```

第 n°1 组仅捕获“错误：”之后的内容

无论如何，对于正则表达式，请参阅[regular-Expressions.info 教程](http://www.regular-expressions.info/tutorial.html)，这是对该技术的一流介绍。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T13:13:26.637

如果您想了解或使用这些解决方案中的任何一个，我强烈建议您下载[Regex Coach](http://www.weitz.de/regex-coach/)，它可以帮助您构建和测试正则表达式

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-02T13:14:33.357

我所做的是将整个日志运行到一个字符串中，然后逐行遍历并将每一行添加到第三个变量，直到该行包含“--End of Session--”。然后我将该行也添加到第三个变量中，然后在第三个变量中搜索“错误”一词。如果它包含它，我将第三个变量添加到第四个变量，然后清除第三个变量并开始通过变量返回，日志在下一行。

它看起来像这样：

```
str a b email gp lgf
lgf.getfile( "C:\blat\log.txt")
foreach a lgf
    if(find(a "--End of Session--")>-1)
        gp.from(gp "[]" a)
        if(find(gp "error" 0 1)>-1)
            gp.trim
            email.from(email gp "[]")
        gp=""
        continue
    gp.from(gp "[]" a)
email.trim 
```

事实证明，当它不适合时，正则表达式真的可以成为实施的熊猫。有点像用螺丝刀代替锤子。它会完成工作，但需要很长时间，打破螺丝刀，并可能在此过程中伤害你。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-23T21:06:41.307

有一段时间，只有 Vim 可用（以及当时我没有掌握的 sed、awk），我做了类似的事情：

通过 Vim，我已将所有行加入 - 在你的情况下 - 会话开始/会话结束到单行：

> 1.  首先将所有行尾替换为某个特定的字符：
>     `:%s:$:#`
> 2.  然后将双输入变成其他分隔符：
>     `:%s:#\n#\n:#\r@\r`
> 3.  加入行：
>     `:%s:#\n:#`
> 4.  仅显示带有错误的行：
>     `:v/[Ee]rror/d`
> 5.  将行拆分为其原始格式：
>     `:%s:#:\r`

# email - 优先级：电子邮件中的标题

> ID：154718
> 
> 赞同：38
> 
> 时间：2008-09-30T20:01:11.900
> 
> 标签：email, header

我的 Web 应用程序经常发送电子邮件，它发送 3 种电子邮件：由用户发起，响应系统中的事件，以及自动响应应用程序收到的电子邮件。

我想确保第三种类型的电子邮件不会陷入无休止的自动回复循环中。目前，我使用标题：

```
Precedence: junk 
```

但雅虎！mail 将这些邮件视为垃圾邮件。这显然不理想，因为我们希望有人阅读我们的自动回复并做出决定，而不是不在办公室的回复。

**在不触发垃圾过滤器或自动回复的情况下发送电子邮件的最佳方式是什么？**

```
Precedence: junk?

Precedence: bulk?

Precedence: list?

X-Priority: 2? 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-19T14:03:41.723

有一个专用于自动电子邮件响应的[RFC 3834 。](https://www.rfc-editor.org/rfc/rfc3834)

简而言之，它建议：

1.  仅向包含在`Return-Path`传入消息标题中的地址发送自动回复（如果该地址是有效的电子邮件地址）。特别是消息中的“<>”（空地址）`Return-Path`意味着不能为此消息发送自动回复。

2.  发送自动回复时，MAIL FROM smtp 命令必须包含“<>”（空地址）。这将导致 Return-Path:<> 何时传递消息。

3.  使用具有“no”以外的值[的 Auto-Submitted](https://www.rfc-editor.org/rfc/rfc3834#section-5)标头来明确指示自动响应。

注意：在传出消息中显式设置 Return-Path 标头是不值得的，因为此标头必须在传递过程中由信封地址（来自 MAIL FROM smtp 命令）重写。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-30T20:12:07.723

[RFC 2076](http://www.faqs.org/rfcs/rfc2076.html)不鼓励使用优先标头。正如您所指出的，许多客户只会将其过滤掉（尤其是优先级：垃圾品种）。最好使用空路径来避免自动响应者战争：

```
Return-Path: <> 
```

最终，您可以使用优先级来尝试解决此问题，但这似乎与标题的精神背道而驰。我建议只使用 return-path 标头，并避免优先级。在某些情况下，您可能必须以某种方式编写以在您的应用程序中删除自动响应器（以避免陷入响应器战争），但我不记得使用适当的返回路径发生这种情况的情况。（我记得必须处理的大多数自动回复战争都是电子邮件格式非常糟糕的结果）

注意：`Return-Path`简而言之，标头是通知的目的地（退回、延迟传递等），并在[RFC 2821](http://www.faqs.org/rfcs/rfc2821.html)中进行了描述——因为它是 SMTP 所要求的。这也是丢弃坏邮件的一种方法（因为理论上所有好的邮件都会设置适当的返回路径）。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-01-18T10:43:21.817

您可以设置这些标题：

```
Precedence: bulk
Auto-Submitted: auto-generated 
```

资料来源：[http ://www.redmine.org/projects/redmine/repository/revisions/2655/diff](http://www.redmine.org/projects/redmine/repository/revisions/2655/diff)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T20:08:58.683

处理此问题的传统方法是使用空信封发件人（传统写为 <>）发送电子邮件。这可以防止另一端的自动回复器响应，因为没有发件人可以响应。

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2008-09-30T20:06:58.313

在您的电子邮件帐户上配置白名单怎么样？

我假设任何电子邮件关键字都可能被垃圾过滤器标记。

# performance - 谁能解释预言机“哈希组”是如何工作的？

> ID：154722
> 
> 赞同：2
> 
> 时间：2008-09-30T20:01:43.723
> 
> 标签：performance, oracle

我最近遇到了在 oracle 中执行大型查询的功能，其中更改一件事会导致查询过去需要 10 分钟，需要 3 小时。

简单总结一下，我在数据库中存储了很多坐标，每个坐标都有一个概率。然后我想将这些坐标“分箱”到 50 米的箱中（基本上将坐标四舍五入到最近的 50 米）并对概率求和。

为此，部分查询是 'select x,y,sum(probability) from .... group by x,y'

最初，我存储了大量概率为 0.1 的点，查询运行正常，每个点大约需要 10 分钟。

然后我要求更改概率的计算方式以调整分布，因此它们不是全部为 0.1，而是不同的值（例如 0.03、0.06、0.12、0.3、0.12、0.06、0.03）。运行完全相同的查询会导致大约 3 小时的查询。

改回所有 0.1 使查询恢复到 10 分钟。

查看系统的查询计划和性能，看起来问题出在“哈希组”功能上，该功能旨在加速 oracle 中的分组。我猜它正在为每个唯一的 x,y,probability 值创建哈希条目，然后为每个唯一的 x,y 值求和概率。

谁能更好地解释这种行为？

**附加信息**

感谢答案。他们允许我核实发生了什么。我目前正在运行一个查询，来自 v$sql_workarea_active 的 tempseg_size 目前为 7502561280 并且增长迅速。

鉴于我正在运行的开发服务器只有 8gb 的内存，看起来查询需要使用临时表。

我现在已经设法通过更改查询类型和预先计算一些信息来解决这个问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T22:38:12.943

散列组（和散列连接，以及诸如排序等其他操作）可以使用最优（即内存中）、单遍或多遍方法。最后两种方法使用 TEMP 存储，因此速度要慢得多。

通过增加可能项目的数量，您可能已经超过了为此类操作保留的内存中适合的项目数量。

尝试在查询运行时查看 v$sql_workarea_active ，看看是否是这种情况。或者查看 v$sql_workarea 以获取历史信息。它还会告诉您操作需要多少内存和/或临时空间。

如果结果是实际问题 - 如果可能，请尝试增加 pga_aggregate_target 初始化参数。可用于最佳哈希/排序操作的内存量通常约为 pga_aggregate_target 的 5%。

有关更多详细信息，请参阅[性能调优指南](http://download.oracle.com/docs/cd/B19306_01/server.102/b1421/memory.htm#PFGRF01401)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T03:05:25.873

“我猜测它正在为每个唯一的 x、y、概率值创建哈希条目，然后为每个唯一的 x、y 值求和概率”——几乎可以肯定，因为这是查询所需要的。

您可以使用解释计划检查需要临时 dfisk 空间来完成排序或分组（等）的查询的可能性。

```
explain plan for
select x,y,sum(probability) from .... group by x,y
/

select * from table(dbms_xplan.display)
/ 
```

如果优化器可以从统计数据中正确推断出 x 和 y 组合的近似唯一数量，那么很有可能在第二个查询的输出的 TempSpc 列中，它将向您显示多少磁盘空间（如果有）需要完成查询（无列 = 无磁盘空间要求）。

这里的信息太多了：http: [//download.oracle.com/docs/cd/B19306_01/appdev.102/b14258/d_xplan.htm#i999234](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14258/d_xplan.htm#i999234)

如果临时空间使用率很高，那么正如 CaptP 所说，可能是时候进行一些内存调整了。在执行大量排序和聚合的数据库上，通常会指定比 SGA 目标更高的 PGA 目标。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T03:21:15.493

您的*PGA_AGGREGATE_TARGET*是否被设置为零？HASH GROUPBY 本身不太可能导致问题，它可能是它之前或之后的东西。*将您的OPTIMIZER_FEATURES_ENABLE*降级到 10.1.0.4 并重新运行查询 - 您会看到现在您将获得一个 SORT GROUPBY，它几乎总是应该被 HASH GROUPBY 超越，除非您的 PGA 大小设置为 MANUAL 并且您的哈希工作区尺寸过小。

# java - 什么时候使用 Wea kHashMap 或 WeakReference？

> ID：154724
> 
> 赞同：166
> 
> 时间：2008-09-30T20:01:55.393
> 
> 标签：java, weak-references

弱引用的使用是我从未见过的实现，所以我试图弄清楚它们的用例是什么以及实现如何工作。你什么时候需要使用`WeakHashMap`or`WeakReference`以及它是如何使用的？

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2008-09-30T20:09:11.647

> 强引用的一个问题是缓存，尤其是像图像这样非常大的结构。假设您有一个必须处理用户提供的图像的应用程序，例如我使用的网站设计工具。当然，您希望缓存这些图像，因为从磁盘加载它们非常昂贵，并且您希望避免一次在内存中拥有两个（可能是巨大的）图像副本的可能性。
> 
> 因为图像缓存应该防止我们在绝对不需要时重新加载图像，所以您很快就会意识到缓存应该始终包含对任何已经在内存中的图像的引用。但是，对于普通的强引用，该引用本身将强制图像保留在内存中，这需要您以某种方式确定内存中何时不再需要图像并将其从缓存中删除，以便它可以进行垃圾回收。您被迫复制垃圾收集器的行为并手动确定对象是否应该在内存中。

[理解弱引用](https://community.oracle.com/blogs/enicholas/2006/05/04/understanding-weak-references)，Ethan Nicholas

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2008-09-30T23:00:08.333

# `WeakReference`相对`SoftReference`

要明确的一个区别是 a[`WeakReference`](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/ref/WeakReference.html)和 a之间的区别[`SoftReference`](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/ref/SoftReference.html)。

基本上，一旦被引用的对象没有对它的*硬*引用，[JVM](https://en.wikipedia.org/wiki/Java_virtual_machine)`WeakReference`就会急切地进行[GC-d](https://en.wikipedia.org/wiki/Garbage_collection_(computer_science))。另一方面，一个d 对象往往会被垃圾收集器留下，直到它真的需要回收内存。*`SoftReference`*

 ***将值**保存在s中的缓存`WeakReference`将毫无用处（在 a 中`WeakHashMap`，它是弱引用的键）。`SoftReferences`当您想要实现一个可以随可用内存增长和缩小的缓存时，将值包装起来很有用。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2008-10-15T15:17:03.373

`WeakReference`s 和s 的一种常见用途`WeakHashMap`是向对象添加属性。有时您想向对象添加一些功能或数据，但子类化和/或组合不是一种选择，在这种情况下，显而易见的事情是创建一个哈希图，将您想要扩展的对象链接到您想要添加的属性. 然后，每当您需要该属性时，您都可以在地图中查找它。但是，如果您要添加属性的对象往往会被销毁和创建很多，那么最终您的地图中可能会有很多旧对象占用大量内存。

如果您使用 a`WeakHashMap`代替，对象将在您的程序的其余部分不再使用它们时立即离开您的地图，这是所需的行为。

我必须这样做来添加一些数据来`java.awt.Component`解决 JRE 在 1.4.2 和 1.5 之间的变化，我可以通过子类化我感兴趣的每个组件来修复它 int ( `JButton`, `JFrame`, `JPanel`....) 但这太多了用更少的代码更容易。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2014-08-11T11:18:11.177

另一个有用的例子`WeakHashMap`是`WeakReference`监听器**注册实现**。

当你创建想要监听某些事件的东西时，通常你注册一个监听器，例如

```
manager.registerListener(myListenerImpl); 
```

如果`manager`将您的侦听器存储在 a`WeakReference`中，则意味着您不需要删除寄存器，例如使用 a `manager.removeListener(myListenerImpl)`，因为一旦您的侦听器或持有该侦听器的组件变得不可用，它将自动删除。

当然你仍然可以手动删除你的监听器，**但是**如果你不这样做或者你忘记了它，它不会导致内存泄漏，也不会阻止你的监听器被垃圾回收。

**出现在哪里`WeakHashMap`？**

想要将注册的监听器存储为`WeakReference`s 的监听器注册表需要一个集合来存储这些引用。标准 Java 库中没有`WeakHashSet`实现，`WeakHashMap`但我们可以轻松地使用后者来“实现”第一个的功能：

```
Set<ListenerType> listenerSet =
    Collections.newSetFromMap(new WeakHashMap<ListenerType, Boolean>()); 
```

有了这个`listenerSet`来注册一个新的监听器，你只需要将它添加到集合中，即使它没有被显式删除，如果不再引用监听器，它也会被 JVM 自动删除。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-30T22:05:10.057

这篇博文演示了这两个类的使用：[Java：在 ID 上同步](http://illegalargumentexception.blogspot.com/2008/04/java-synchronizing-on-transient-id.html)。用法是这样的：

```
private static IdMutexProvider MUTEX_PROVIDER = new IdMutexProvider();

public void performTask(String resourceId) {
    IdMutexProvider.Mutex mutext = MUTEX_PROVIDER.getMutex(resourceId);
    synchronized (mutext) {
        // look up the resource and do something with it
    }
} 
```

IdMutextProvider 提供基于 id 的对象进行同步。要求是：

*   必须返回对同一对象的引用才能同时使用等效 ID
*   必须为不同的 ID 返回不同的对象
*   无释放机制（对象不返回给提供者）
*   不得泄漏（未使用的对象有资格进行垃圾收集）

这是使用以下类型的内部存储映射来实现的：

```
WeakHashMap<Mutex, WeakReference<Mutex>> 
```

对象既是键又是值。当地图外部的任何东西都没有对该对象的硬引用时，它可以被垃圾收集。映射中的值与硬引用一起存储，因此必须将值包装在*WeakReference*中以防止内存泄漏。最后一点包含在[javadoc](http://java.sun.com/javase/6/docs/api/java/util/WeakHashMap.html)中。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-30T20:05:13.450

例如，如果您想跟踪某个类创建的所有对象。为了仍然允许这些对象被垃圾收集，您保留对对象而不是对象本身的弱引用列表/映射。

现在，如果有人可以向我解释幻影引用，我会很高兴......

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-01T07:53:00.440

如上所述，只要存在强引用，就会保留弱引用。

一个示例用法是在侦听器内部使用 Wea​​kReference，这样一旦对其目标对象的主要引用消失，侦听器就不再处于活动状态。请注意，这并不意味着 WeakReference 已从侦听器列表中删除，仍然需要进行清理，但可以执行清理，例如，在预定时间执行。这也有防止被监听的对象持有强引用的效果，并最终成为内存膨胀的来源。示例：Swing GUI 组件引用具有比窗口更长生命周期的模型。

在如上所述与听众玩耍时，我们很快意识到从用户的角度“立即”收集对象。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-30T20:09:36.920

我对 WeakReferences 的一个实际用途是，如果您有一个很少使用的非常大的对象。您不想在不需要时将其保存在内存中；但是，如果另一个线程需要相同的对象，您也不希望其中两个在内存中。您可以在某处保留对对象的弱引用，并在使用它的方法中保留硬引用；当方法都完成时，对象将被收集。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-30T21:52:23.223

我对“new WeakHashMap()”进行了谷歌代码搜索。

我从 GNU 类路径项目中得到了一堆匹配项

1.  Apache xbean 项目：[WeakHashMapEditor.java](http://grepcode.com/file/repo1.maven.org/maven2/org.apache.xbean/xbean-reflect/4.2/org/apache/xbean/propertyeditor/WeakHashMapEditor.java)
2.  Apache Lucene 项目：[CachingWrapperFilter.java](http://grepcode.com/file/repo1.maven.org/maven2/org.apache.lucene/lucene-core/4.5.0/org/apache/lucene/search/CachingWrapperFilter.java)

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-30T20:28:42.817

您可以使用weakhashmap 为扩展对象创建实现无资源缓存。

但请注意，拥有可变对象是不可取的。我用它来缓存查询结果（执行大约需要 400 毫秒）到一个很少更新的文本搜索引擎。

# c# - 表格布局面板

> ID：154726
> 
> 赞同：-1
> 
> 时间：2008-09-30T20:02:06.767
> 
> 标签：c#, .net, tablelayoutpanel

TableLayoutPanel 是否存在于 VS 2005 中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T20:03:10.100

[是](http://msdn.microsoft.com/en-us/library/system.windows.forms.tablelayoutpanel%28VS.80%29.aspx)的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T20:03:51.207

是的，它首先出现在 .NET 2.0

[http://msdn.microsoft.com/en-us/library/system.windows.forms.tablelayoutpanel(VS.80).aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.tablelayoutpanel(VS.80).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T20:04:24.403

是的，TableLayoutPanel 是 .NET 2.0 的标准组件，因此可以从 VS2k5 使用。

# java - 如何使用 ResourceBundle 避免 Java 应用程序中的硬编码配置路径？

> ID：154728
> 
> 赞同：3
> 
> 时间：2008-09-30T20:02:47.543
> 
> 标签：java, config, resourcebundle

我想在我的 Java 应用程序中消除对配置数据硬编码路径的依赖，我知道使用 ResourceBundle 将帮助我使用类加载器来查找资源。

有人能告诉我如何用适当使用 ResourceBundle 来替换资源的硬编码路径（比如类所需的 .properties 配置数据文件）吗？如果可能的话，简单清晰的例子，谢谢大家。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T20:11:11.110

您将需要检查[Resource.getBundle(String)](http://java.sun.com/javase/6/docs/api/java/util/ResourceBundle.html#getBundle(java.lang.String) "资源包 Javadoc")。您将类路径上的资源的完全限定名称传递给它以作为属性文件加载。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T22:47:39.473

在 Java 6 之前，ResourceBundle 通常允许：

*   来自一组本地化属性文件的字符串，使用[PropertyResourceBundle](http://java.sun.com/javase/6/docs/api/java/util/PropertyResourceBundle.html)
*   来自一组本地化类的对象，使用[ListResourceBundle](http://java.sun.com/javase/6/docs/api/java/util/ListResourceBundle.html)

Java 6 附带了[ResourceBundle.Control](http://java.sun.com/javase/6/docs/api/java/util/ResourceBundle.Control.html)类，它为其他资源包打开了大门，例如：

*   XML 文件（参见 Javadoc 中的示例 2）
*   数据库行

希望这可以帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T01:35:51.580

您不需要 ResourceBundle。一个简单的 Properties 对象就可以完成这项工作。只需使用类加载器为您的属性文件获取输入流并使用它来加载 de 值。如果您需要处理更复杂的用户配置，请使用[首选项 api](http://java.sun.com/j2se/1.5.0/docs/api/java/util/prefs/Preferences.html)。

亲切的问候

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T22:10:18.097

Resource.getBundle(..) 背后的技巧是使用类加载器。您可以通过 this.getClass().getClassLoader() 访问类路径中的所有内容。Resource.getBundle(..) 是在资源/定位主题中使用它的实用助手。

# c++ - 在 Windows 中从 OpenGL 窗口中捕获视频

> ID：154730
> 
> 赞同：12
> 
> 时间：2008-09-30T20:03:16.137
> 
> 标签：c++, opengl, video, screenshot, video-capture

我应该为我的用户提供一种非常简单的方法来从我的 OpenGL 应用程序的主窗口中捕获视频剪辑。我正在考虑添加按钮和/或键盘快捷键来开始和停止捕获；开始时，我可以要求提供文件名和其他选项（如果有）。它必须在 Windows (XP/Vista) 中运行，但我也不想关闭我迄今为止能够保持打开的 Linux 门。

该应用程序使用 OpenGL 片段和着色器程序，这些效果是我在最终视频中绝对需要的。

在我看来，甚至可能有几种不同的方法可以满足我的要求（但我真的不知道应该从哪里开始）：

*   具有 startRecording(filename)、stopRecording 和 captureFrame 等函数的编码库。我可以在渲染每一帧（或每第二/第三/任何）之后调用 captureFrame() 。如果这样做会使我的程序运行得更慢，那这不是问题。

*   可以从我的应用程序以编程方式控制的独立外部程序。毕竟，一个*无法*控制的独立程序几乎可以满足我的需求......但正如所说，用户操作应该非常简单，我也希望无缝; 我的应用程序通常全屏运行。此外，它应该可以作为我目前使用 NSIS 准备的应用程序安装包的一部分进行分发。

*   使用 Windows API 逐帧捕获屏幕截图，然后使用（例如）[此处提到的库之一](https://stackoverflow.com/questions/93954/how-to-programatically-create-videos)。似乎很容易找到如何在 Windows 中捕获屏幕截图的示例；但是，我希望有一个解决方案，它不会真正强迫我在 WinAPI 级别上弄得超级脏。

*   使用 OpenGL 渲染到屏幕外目标，然后使用库来生成视频。我不知道这是否可能，而且恐怕无论如何这可能不是最痛苦的道路。特别是，我不希望实际渲染根据是否捕获视频而采用不同的执行路径。此外，我会避免在正常、非捕获模式下可能降低帧速率的任何事情。

如果解决方案在任何一个意义上都是免费的，那将是很好的，但这并不是一个绝对的要求。一般来说，膨胀越少越好。另一方面，由于这个问题之外的原因，不幸的是，我无法链接任何仅 GPL 的代码。

关于文件格式，我不能指望我的用户开始搜索任何编解码器，但只要*显示*视频对于基本级别的 Windows 用户来说足够容易，我并不关心格式是什么。但是，如果可以控制输出的压缩质量，那就太好了。

澄清一下：我*不需要*从摄像机等外部设备捕获视频，我也对鼠标移动不感兴趣，即使获取它们也不会造成伤害。对音频没有要求；该应用程序不会发出任何噪音。

我使用 Visual Studio 2008 编写 C++，因为这个应用程序也利用了 GLUT 和 GLUI。我对 C++ 和库中的链接之类的东西有扎实的了解，但另一方面，OpenGL 对我来说还是很新的：到目前为止，我真的只学到了实际完成工作所需的一些知识。

我不需要非常紧急的解决方案，所以请慢慢来：）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-30T20:14:45.470

这里有两个不同的问题——如何从 OpenGL 应用程序中抓取帧，以及如何将它们转换为电影文件。

第一个问题很简单；您只需使用 glReadPixels() 抓取每一帧（如果您需要性能，请通过 PBO）。

第二个问题有点困难，因为跨平台解决方案 (ffmpeg) 往往是 GPL 或 LGPL。您的项目可以接受 LGPL 吗？执行此操作的 Windows 方式 (DirectShow) 使用起来有点令人头疼。

**编辑：**由于 LGPL 没问题，您可以使用 ffmpeg，请参阅[此处](http://www.irisa.fr/texmex/people/dufouil/ffmpegdoxy/apiexample_8c-source.html#l00190)了解如何编码视频的示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T20:50:26.867

[这](http://www.codeproject.com/KB/audio-video/avigenerator.aspx)看起来确实与合并到 AVI 非常相关（正如 Andrew 所建议的那样），但是我真的希望避免使用 LPBITMAPINFOHEADER 等。

感谢您的回答，如果有的话我会报告成功的:)

`glReadPixels`同时，将不胜感激将原始帧编码为视频剪辑的其他技巧。

**编辑：**到目前为止，Mike F 建议的 ffmpeg 似乎是要走的路。但是，我还没有进入实际的实现，但希望在不久的将来会有所改变！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T20:16:17.853

最简单的选择是从您的应用程序中保存每个渲染的帧，然后将它们合并到 AVI 中。当您拥有 AVI 时，有许多可用的库可以将其转换为更优化的格式，或者可能完全跳过 AVI 步骤。

在获取每一帧方面，您可以通过按照您的建议渲染到屏幕外纹理或直接使用后缓冲区作为源（如果您的硬件支持）来完成此操作。如果不对帧率造成严重影响，执行其中任何一项（并保存每一帧）都会很困难。

如果您的应用程序是确定性的，您可以将用户操作“记录”为一系列输入，然后使用导出模式将这些操作顺序渲染到屏幕外表面以生成 AVI。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-09-09T16:56:02.490

我必须创建一个将 OpenGL 渲染录制到视频中的演示项目。我曾经`glReadPixels`获取像素数据并使用 OpenCV 的`cvWriteFrame`. OpenCV 让您可以使用 divx 甚至 x264/vp8（编译了 ffmpeg）编写代码。

我在我的博客文章中有一个更详细的文章以及一个示例项目。 [http://tommy.chheng.com/2013/09/09/encode-opengl-to-video-with-opencv/](http://tommy.chheng.com/2013/09/09/encode-opengl-to-video-with-opencv/)

# iis-6 - 了解 IIS6 权限、ACL 和身份——如何限制访问？

> ID：154735
> 
> 赞同：0
> 
> 时间：2008-09-30T20:04:21.440
> 
> 标签：iis-6, windows-server-2003, ntfs

当一个 ASP.NET 应用程序在 Windows 2003 Server 的 IIS6.0 下运行并模拟时，什么用户帐户与决定文件读/写/执行访问权限相关？我有两种情况，我试图了解授予/撤销的访问权限。我认为最相关的用户可能是应用程序池中指定的身份，但这似乎不是全部。

第一个问题涉及通过 System.Diagnostics.Process.Start() 执行本地批处理文件——当 AppPool 设置为 IWAM_WIN2K3WEB 用户时，我不能这样做，但如果它设置为网络服务标识，它就可以正常工作。我当然确保 IWAM 用户对文件具有执行权限。

第二个涉及写入本地硬盘驱动器上的文件 - 我希望能够通过文件夹属性通过访问控制列表阻止这样做，但即使我将文件夹中的**所有**用户设置为“读取”（根本没有“写”的用户/组），我们的 ASP.NET 仍然可以写出文件没有问题。如果它没有写权限怎么办？

谷歌搜索会出现点点滴滴，但从来没有完整的故事。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T20:34:46.967

> 什么用户帐户与 [..] 文件读/写/执行访问相关

作为一项规则：始终使用应用程序/页面运行的用户帐户。

IWAM 帐户非常有限。我认为它没有启动外部进程的权限。此时文件访问权限无关紧要。

如果用户帐户（在您的情况下为网络服务）拥有一个文件（即已创建它），即使没有明确允许，它也可以对该文件执行任何操作。检查谁拥有您的文件。

[Microsoft 的Process Monitor](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)是一个很好的工具，可以追踪像这样的细微之处。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T15:27:35.037

更多搜索表明 IWAM 用户的文档没有那么好，如果我们想为该用户指定权限，我们应该坚持使用 NETWORK SERVICE 或手动提供的身份。

# msdn - MSDN 订阅的成本是否会阻碍 .NET 的采用

> ID：154748
> 
> 赞同：12
> 
> 时间：2008-09-30T20:06:20.607
> 
> 标签：msdn

我知道这个问题有点异端，但我很好奇......

当然，也有特快版。但是，当微软在 OSS 世界中有效地争夺“人心”时，向全心全意支持 .NET 的开发人员收取微软软件的高额订阅费似乎有点适得其反。很难想象，在微软的整体销售情况下，开发许可证代表了如此重要的收入来源，足以证明其不利因素是合理的。

所以我的问题是：您是否知道 MSDN 订阅率阻止团队在项目中采用 .NET 的任何情况——成本在决定转而使用 OSS 时发挥了作用？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T20:10:31.270

我认为 MS 在降低 .Net 访问和使用成本方面取得了巨大进展。使用 Visual Studio 和 Sql Server 的胜任 Express 版本，您唯一需要支付的是 Windows 本身（在您的开发环境和服务器/生产环境中）。

现在唯一阻碍.Net的是它可能不是每项工作的正确工具，无论成本如何。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T20:08:36.390

它对我有用。这让我问我是否应该尝试成为 Microsoft MVP，因为他们免费获得所有软件。

除了许可证上的最高级别之外，您无法购买 Expression Blend 和 Design，这让我很生气。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T20:19:06.927

我不这么认为，尤其是针对小型 ISV 的[授权计划](https://partner.microsoft.com/40011351)——375 美元可以获得 5 个 MSDN 许可证和其他好东西。之后是[Microsoft Action Pack](https://partner.microsoft.com/US/program/managemembership/actionpack)以及整个合作伙伴计划。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T20:42:27.963

It's not a barrier to entry, but it certainly represents a glass ceiling. You get a lot of things with the Express editions, but not EVERYTHING. There's a lot of little perks that come with the Pro versions - addins for instance +cough+ Resharper +cough+. I'd say you need Visual Studio 20xx Pro at a minimum to do any mid-range to Enterprise level development.

The cost of MS developer tools was the sole reason behind my Year of Linux. It's tough seeing all the free development tools for Linux, OS X and Java. If my job didn't depend on keeping up to date with .NET, I'd leave it for dead in a heartbeat.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T20:18:36.477

我总是获得合法、免费的 Visual Studio 副本。您可以下载能够满足大多数人需求的 Express 版本，也可以前往 Launch 活动，在那里他们会向所有出现的人分发副本。

.NET Framework 是免费下载的，所以真正剩下的就是一个运行 Windows 的盒子。我敢打赌，你已经在某个地方找到了其中一个。

没有理由购买 MSDN 订阅。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T04:00:03.127

我目前正在参加[Empower 计划](https://partner.microsoft.com/40011351)，但我会在它用完时支付全额费用，原因与我每年为 AutoCAD 订阅支付 800 澳元的原因相同 - 它很容易为我节省更多时间和麻烦，而不是长期花费让我需要的一切触手可及。

当我考虑许可证和社区时，我认为我物有所值 - 我认为其中大部分都是免费的。

我认为这是经营我的业务的合法成本，而且无论如何它是可以免税的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T15:12:34.787

我正在尝试重新开始我的职业生涯，我的生活等等，而我之前的 MSDN Universal sub 于 2005 年到期。在它到期的时候，我停止了一段时间的工作。这恰逢微软改变了该订阅计划的成本和结构。今天获得类似的订阅是不可能的。我没有资金。我目前正在使用旧技术（VB6 和 ASP）进行开发，直到我有资金购买我想要的 MSDN 子程序。我已经下载了 VS 2008 和 SQL 2008 的“express”版本，但坦率地说，任何认真的开发人员都会想要利用“express”中没有的功能。在 StackOverflow 上探讨这个问题时，我看到其他人谈论 Empower 程序。它看起来很有希望，我将对其进行调查。

但是，是的，进入的障碍是成本。希望 Empower 可以暂时降低这一点。我同意在到期后我需要支付全额票价的要求。我认为那是公平的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T20:21:17.797

在我看来，MSDN 订阅并不是一个巨大的威慑，因为不仅有快速版，还有大多数产品的试用版，而且我认为基本的 MSDN 订阅并没有那么贵。

然而，某些开发工具以及某些产品的许可成本和许可复杂性可能是一个巨大的障碍，不幸的是，在项目开始时通常没有考虑到这一点。

我知道许多项目由于许可成本和许可复杂性而选择了替代技术。

# flash - 使用不带 Flash 的 rtmp 与 Flash 服务器通信

> ID：154749
> 
> 赞同：15
> 
> 时间：2008-09-30T20:06:34.697
> 
> 标签：flash, rtmp

我想与使用 RTMP 的 Flash 服务器交谈，但我不想使用 Flash，而是使用 c# 或 java。

我在看 Red5，但他们的客户端 API 似乎有点不稳定。

有没有人有任何其他想法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-23T01:55:13.580

查看商业 JUV 客户端 ( [http://www.smaxe.com/juvclient.jsf](http://www.smaxe.com/juvclient.jsf) ) 库，它可以让您与启用 rtmp 的服务器进行通信。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-19T22:56:01.667

[“RTMP：Flash 视频流协议”](http://captsolo.net/info/blog_a.php/2009/01/19/rtmp_flash_video_streaming_protocol)讨论了与 RTMP 服务器通信的库和应用程序。

[RTMPDump 实用程序](http://rtmpdump.mplayerhq.hu/)中用于下载 RTMP 视频流的主要协议代码现在可在其自己的库 librtmp 中使用（由 FFmpeg、MPlayer 和 XBMC 媒体中心使用）。

注意：RTMPDump 实用程序最初基于 libRTMP 库，它是 XBMC 项目的一部分。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-03T17:01:53.367

[RTMP 协议RTMPy](http://rtmpy.org/)有一个 python 实现。除了 Red5 之外，我不知道任何其他 RTMP 客户端实现。（嗯，当然除了闪光灯本身）。

你用的是什么闪存服务器？其中一些还允许您与其他协议进行通信，例如基于文本或基于 XML 的协议，如果您的客户端不是基于闪存的，那么这些协议可能比 RTMP 更好用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-14T10:52:25.437

我还开始开发 C++ RTMP 服务器。我将在不久的将来制作一个 C++ 客户端库，当然还有 C#、Java 和 Lua 包装器。请继续关注[此网站](http://rtmpd.com)，或者您可以成为[这里](http://groups.google.com/group/c-rtmp-server)的群组成员并立即获得通知。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-09-15T10:38:20.680

[您可以在https://code.google.com/p/rtmp-mediaplayer/](https://code.google.com/p/rtmp-mediaplayer/)找到 ac# rtmp 实现

它经过测试可在 Windows、iOS 和 Android 上运行。您需要低音 ( [http://www.un4seen.com/bass.html](http://www.un4seen.com/bass.html) ) 来输出音频。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-08-27T12:46:07.407

如果你喜欢，你可以使用 Opencv。然后你可以进行各种实时视频处理。[我在这里](https://stackoverflow.com/questions/30096327/opencv-wont-capture-frames-from-a-rtmp-source-while-ffmpeg-does/32249336#32249336)回答了同样的问题

# eclipse - Eclipse Mylyn 中的“附加上下文”到底是什么意思

> ID：154751
> 
> 赞同：16
> 
> 时间：2008-09-30T20:06:59.420
> 
> 标签：eclipse, mylyn

Eclipse（Trac 连接器）中的 mylyn 插件包含附加选项，然后检索问题的“上下文”。附加上下文会导致将压缩的 XML 文件附加到 Trac 系统中的问题条目。但是，我不太明白这个上下文是什么。最初我认为这是所有打开的文件和这些文件中的光标位置。但显然我错了。搜索网络没有帮助。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-30T22:04:51.307

Mylyn 上下文是代码中“地标”的集合。“地标”是“有趣”的源文件或方法或资源文件（通常意味着您在任务处于活动状态时打开了它）。这篇关于 Mylyn [Mylyn 2.0，第 2 部分：自动化上下文管理](http://www.ibm.com/developerworks/java/library/j-mylyn2/)的文章可能有助于消除对上下文是什么的任何混淆。

共享上下文应该允许其他人看到您正在查看的代码的哪些部分。如果您在共享上下文时遇到问题，Mylyn[团队支持](http://wiki.eclipse.org/index.php/Mylyn_FAQ#Team_Support)常见问题解答可能会有所帮助。

# .net - 我可以使用 WMI 和 System.Management 命名空间测试软盘驱动器吗？

> ID：154754
> 
> 赞同：3
> 
> 时间：2008-09-30T20:07:17.673
> 
> 标签：.net, wmi

我会找出*软盘插入状态*：

*   没有插入软盘
*   插入了未格式化的软盘
*   已插入格式化软盘

这可以使用 System.Management 命名空间中的“WMI”来确定吗？

如果是这样，我可以在*软盘插入状态*更改时生成事件吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T18:53:54.557

这来自[脚本中心@MSDN](http://msdn.microsoft.com/en-us/library/aa394592(VS.85).aspx)：

```
strComputer = "."
Set objWMIService = GetObject( _
    "winmgmts:\\" & strComputer & "\root\cimv2")
Set colItems = objWMIService.ExecQuery _
    ("Select * From Win32_LogicalDisk Where DeviceID = 'A:'")

For Each objItem in colItems
    intFreeSpace = objItem.FreeSpace
    If IsNull(intFreeSpace) Then
        Wscript.Echo "There is no disk in the floppy drive."
    Else
        Wscript.Echo "There is a disk in the floppy drive."
    End If
Next 
```

您还可以通过检查[Win32_LogicalDisk 类](http://msdn.microsoft.com/en-us/library/aa394173(VS.85).aspx)的其他成员来判断它是否已格式化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T19:18:44.917

使用 Bob Kings 的想法，我编写了以下方法。

它适用于 CD、可移动驱动器、常规驱动器。

但是对于软盘，它总是返回“不可用”。

```
 public static void TestFloppy( char driveLetter ) {
        using( var searcher = new ManagementObjectSearcher(  @"SELECT * FROM Win32_LogicalDisk WHERE DeviceID = '" + driveLetter + ":'" ) )
        using( var logicalDisks = searcher.Get() ) {
            foreach( ManagementObject logicalDisk in logicalDisks ) {
                var fs = logicalDisk[ "FreeSpace" ];
                Console.WriteLine( "FreeSpace = " + ( fs ?? "Not Available" ) );

                logicalDisk.Dispose();
            }
        }
    } 
```

# java - 如何阻止 Eclipse 挂在长长的自动完成列表上？

> ID：154757
> 
> 赞同：1
> 
> 时间：2008-09-30T20:07:41.433
> 
> 标签：java, eclipse

我正在使用来自 JOGL 的 GL 类，它基本上包含*所有*OpenGL 函数。现在我刚刚为 JOGL 安装了 Javadoc，因为如果您不记得顺序，最好有参数名称。

但是，安装此 Javadoc 后，*每当*我键入`GL.`. 由于我进行了很多 OpenGL 调用，这非常烦人。

除了卸载或禁用 JOGL Javadoc 之外，还有什么方法可以让列表显示得更快，或者根本不显示？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T20:12:20.377

首选项 -> Java -> 编辑器 -> 内容辅助

在“自动激活”框架中尝试一些不同的设置。

# xml - 如何从 Perl 创建 XML？

> ID：154762
> 
> 赞同：28
> 
> 时间：2008-09-30T20:08:30.243
> 
> 标签：xml, perl

我需要在 Perl 中创建 XML。根据我的阅读，[XML::LibXML](http://search.cpan.org/dist/XML-LibXML)非常适合解析和使用来自其他地方的 XML。有人对 XML Writer 有什么建议吗？[XML::Writer](http://search.cpan.org/dist/XML-Writer)是否仍在维护？有人喜欢/使用它吗？

除了功能完整性之外，我还对易于使用的语法感兴趣，因此请在答案中描述语法和您喜欢该模块的任何其他原因。

请为每个答案提供一个建议，如果有人已经回答了您最喜欢的答案，请投票支持该答案。希望很容易看出什么是最受欢迎的。

谢谢！

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2010-05-29T11:23:58.957

只是为了记录，这里有一个使用 XML::LibXML 的片段。

```
#!/usr/bin/env perl

#
# Create a simple XML document
#

use strict;
use warnings;
use XML::LibXML;

my $doc = XML::LibXML::Document->new('1.0', 'utf-8');

my $root = $doc->createElement('my-root-element');
$root->setAttribute('some-attr'=> 'some-value');

my %tags = (
    color => 'blue',
    metal => 'steel',
);

for my $name (keys %tags) {
    my $tag = $doc->createElement($name);
    my $value = $tags{$name};
    $tag->appendTextNode($value);
    $root->appendChild($tag);
}

$doc->setDocumentElement($root);
print $doc->toString(); 
```

这输出：

```
<?xml version="1.0" encoding="utf-8"?>
<my-root-element some-attr="some-value">
    <color>blue</color>
    <metal>steel</metal>
</my-root-element> 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-09-30T20:44:26.913

XML::Writer 仍在维护中（至少，截至今年 2 月），它确实是最受欢迎的 Perl XML 编写器之一。

至于描述语法，最好查看模块的文档（链接已经在问题中）。以机智：

```
use XML::Writer;

my $writer = new XML::Writer();  # will write to stdout
$writer->startTag("greeting", 
                  "class" => "simple");
$writer->characters("Hello, world!");
$writer->endTag("greeting");
$writer->end();

# produces <greeting class='simple'>Hello world!</greeting> 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-01T11:10:36.130

如果您想在 Perl 中采用数据结构并将其转换为 XML，[XML::Simple](http://search.cpan.org/dist/XML-Simple)将很好地完成这项工作。

最简单的：

```
我的 $hashref = { foo => 'bar', baz => [ 1, 2, 3 ] };
使用 XML::Simple；
我的 $xml = XML::Simple::XMLout($hashref);

```

顾名思义，它的基本用法很简单；但是，如果您需要，它确实提供了很多功能。

当然，它也可以轻松解析 XML。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-30T21:33:16.157

我没有做太多 XML，但[XML::Smart](http://search.cpan.org/~gmpassos/XML-Smart-1.6.9/lib/XML/Smart.pm)看起来可能会做你想做的事。查看文档中的[创建 XML 数据](http://search.cpan.org/~gmpassos/XML-Smart-1.6.9/lib/XML/Smart.pm#CREATING_XML_DATA)部分，它看起来非常简单易用。

解释文档：

```
use XML::Smart;

## Create a null XML object:
my $XML = XML::Smart->new() ;

## Add a server to the list:
$XML->{server} = {
    os => 'Linux' ,
    type => 'mandrake' ,
    version => 8.9 ,
    address => [ '192.168.3.201', '192.168.3.202' ] ,
} ;

$XML->save('newfile.xml') ; 
```

这会将它放在 newfile.xml 中：

```
<server os="Linux" type="mandrake" version="8.9">
  <address>192.168.3.201</address>
  <address>192.168.3.202</address>
</server> 
```

凉爽的。我将不得不玩这个:)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-30T21:43:32.310

XML::Smart 看起来不错，但我不记得多年前使用[XML::Simple时它是否可用。](http://search.cpan.org/~grantm/XML-Simple-2.18/lib/XML/Simple.pm)界面不错，非常适合阅读和编写 XML。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T20:59:37.477

我喜欢[XML::TreeBuilder](http://search.cpan.org/dist/XML-TreeBuilder)因为它符合我的想法。从历史上看，我更多地将它用于解析而不是发射。

这个问题发布几周后，我有机会从 Perl 生成一些 XML。我调查了这里列出的其他模块，假设其中一个会比 XML::TreeBuilder 工作得更好，但 TreeBuilder 仍然是我想要的最佳选择。

一个缺点是无法在 XML::TreeBuilder 对象中表示处理指令和声明。

# eclipse - 您如何管理不断增长的 Eclipse 配置？

> ID：154768
> 
> 赞同：2
> 
> 时间：2008-09-30T20:08:50.447
> 
> 标签：eclipse, ide, development-environment

我使用 eclipse 做了很多工作，包括：

*   多个“实用程序”项目，其中包含我的大部分 Java 工作使用的代码
*   我定期同步和使用的各种插件相关项目（例如：[Git](http://git.or.cz/gitwiki/EclipsePlugin)插件）
*   我正在开发的插件项目
*   偶尔的 pydev / 非 java 项目
*   ETC...

保持所有这些东西都变得非常困难，特别是因为我不需要一次使用它们。我尝试过使用[Mylyn](http://www.eclipse.org/mylyn)（我正在再次尝试），但在过去它导致 eclipse 运行速度非常慢，而且我在记得告诉 mylyn 我已经切换任务时非常糟糕，所以它倾向于学习非常奇怪（而且基本上没用）的资源集。

我考虑过使用多个工作区，但是当多个项目需要存在于多个工作区中，并且当我需要跨工作区同步 eclipse 元数据目录时，这是有问题的。

在 eclipse 中管理复杂工作环境的最佳方法是什么？其他开发环境不是一个可行的选择，因为在开发 eclipse 插件时没有任何明智的选择（这是一个要求）。

（我*想*一两个月前有人问过一个非常相似的问题，但我一直没能找到它......）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T20:16:05.267

我不太清楚你的需求是什么。但是您是否尝试过在 Package Explorer 中使用工作集？

打开 Package Explorer 视图，打开其菜单，然后选择 Working Set。这使您可以为工作区中加载的所有项目的子集命名。

使用包资源管理器菜单切换工作集。使用工作集来限制搜索、错误、问题等的范围。

根据需要定义尽可能多的工作集来对项目进行分组。一个项目可以是任意数量的工作集的一部分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T20:57:41.733

这是一个关于工作集的截屏视频——这看起来确实是正确的答案。

[http://www.peterfriese.de/eclipse-working-sets-part-i/](http://www.peterfriese.de/eclipse-working-sets-part-i/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T20:11:21.203

您想使用“工作集”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T20:17:16.433

我建议使用不同的工作区，然后将公共项目添加到每个工作区（您可以将项目的位置指定为工作区之外）。我相信这会奏效，但我还没有尝试过，所以我不能确定。

正如@JesperE 和@Dennis S 所建议的那样，工作集将帮助您组织项目，但它们可能不会使 eclipse 运行得更快，因为项目仍将全部加载到工作区中。

# c++ - 有没有办法在模板类中处理可变数量的参数？

> ID：154780
> 
> 赞同：5
> 
> 时间：2008-09-30T20:10:38.727
> 
> 标签：c++, parameters, templates, arguments

我有一组回调类，用于处理带有可变数量参数的回调。现在我有大约 6 个不同的实例来处理不同数量的参数。有没有办法让一个实例可以处理可变数量的参数？最终，我希望每个参数都是 POD 类型或类指针或结构指针。有任何想法吗？

```
template <class T>
class kGUICallBackPtr
{
public:
    kGUICallBackPtr() {m_obj=0;m_func=0;}
    void Set(void *o,void (*f)(void *,T *));
    inline void Call(T *i) {if(m_func) m_func(m_obj,i);}
    inline bool IsValid(void) {return (m_func!=0);}
private:
    void *m_obj;
    void (*m_func)(void *,T *);
};

template <class T,class U>
class kGUICallBackPtrPtr
{
public:
    kGUICallBackPtrPtr() {m_obj=0;m_func=0;}
    void Set(void *o,void (*f)(void *,T *,U *));
    inline void Call(T *i, U *j) {if(m_func) m_func(m_obj,i,j);}
    inline bool IsValid(void) {return (m_func!=0);}
private:
    void *m_obj;
    void (*m_func)(void *,T *,U *j);
}; 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T20:18:38.223

语言本身还没有，但 C++0x 将支持[可变参数模板](http://en.wikipedia.org/wiki/C%2B%2B0x#Variadic_templates)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T05:55:59.380

C++0x variatdic 模板是你最好的选择，但你也需要一段时间才能使用它们。

如果您现在需要类型序列，请查看 MPL 的类型[向量](http://www.boost.org/doc/libs/1_36_0/libs/mpl/doc/refmanual/vector.html)以及其他类型序列类型。它是[Boost](http://boost.org/)库的一部分。它允许您提供一个类型序列的模板参数，而不仅仅是一个类型。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T00:07:48.623

[通过使用Boost Bind](http://www.boost.org/doc/libs/1_36_0/libs/bind/bind.html)来回避这个问题怎么样？您可以让您的代码接受单个参数，或者根本不接受，并在调用站点绑定您需要的参数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-02T04:08:24.267

我的第一选择是使用 boost::bind、boost::function 或 std::bind/std::function 和/或 c++11 lambda 来实现您的目标。但是，如果您需要滚动自己的仿函数，那么我将使用 boost fusion 创建一个采用单个模板参数的“融合仿函数”。

[http://www.boost.org/doc/libs/1_41_0/libs/fusion/doc/html/fusion/functional/generation/functions/mk_fused.html](http://www.boost.org/doc/libs/1_41_0/libs/fusion/doc/html/fusion/functional/generation/functions/mk_fused.html)

最终，所有这些库都使用预处理器宏来枚举所有可能的选项来解决缺少可变模板的问题。

# java - Java TreeNode：如何防止 getChildCount 进行昂贵的操作？

> ID：154791
> 
> 赞同：5
> 
> 时间：2008-09-30T20:11:43.637
> 
> 标签：java, swing, jtree

我正在编写一个 Java 树，其中树节点的子节点可能需要很长时间来计算（在这种情况下，它是一个文件系统，其中可能存在网络超时，从而阻止从连接的驱动器获取文件列表）。

我发现的问题是：

1.  `getChildCount()`在用户特别请求打开树的特定分支之前调用。我相信这样做是为了`JTree`知道是否在节点旁边显示 + 图标。

2.  准确计数来自的孩子`getChildCount()`需要执行潜在的昂贵操作

3.  如果我伪造 的值`getChildCount()`，那么在请求枚举子节点之前，树只会为那么多子节点分配空间。（如果我返回“1”，我只会看到列出的 1 个孩子，尽管还有更多）

孩子的枚举可能既昂贵又耗时，我可以接受。但我不`getChildCount()`同意需要知道孩子的确切数量。

有什么办法可以解决这个问题吗？

**补充：**另一个问题是，如果其中一个节点代表一个软盘驱动器（多么古老！），驱动器将在用户请求其文件之前被轮询；如果驱动器中没有磁盘，则会导致系统错误。

**更新：**不幸的是，实现`TreeWillExpand`监听器不是解决方案。这可以让您否决扩展，但显示的节点数仍受`TreeNode.getChildCount()`.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T21:50:46.863

[http://java.sun.com/docs/books/tutorial/uiswing/components/tree.html#data](http://java.sun.com/docs/books/tutorial/uiswing/components/tree.html#data)

向下滚动一点，这里有关于如何为 jtree 创建延迟加载节点的确切教程，并附有示例和文档

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T20:16:42.470

我不确定它是否完全适用，但我最近通过预先计算通常需要遍历子列表的方法的答案来解决树慢的问题。我只在添加、删除或更新孩子时重新计算它们。在我的例子中，一些方法必须递归地沿着树向下走，以找出每个节点的“存储了多少字节”之类的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T20:57:01.127

如果您需要大量访问计算成本高昂的数据结构的特定功能，那么预先计算它可能是有意义的。

在 TreeNode 的情况下，这意味着您的 TreeNode 必须存储它们的 Child 计数。更详细地解释一下：当你创建一个节点时，`n0`这个节点的 childcount ( `cc`) 为 0。当你添加一个节点`n1`作为这个节点的子节点时，你`n1.cc + cc++`.

棘手的一点是删除操作。您必须保持与父级的反向链接并向上层级减去`cc`当前节点的。

如果您只想`hasChildren`为您的节点或覆盖提供 a 功能`getChildCount`，则布尔值可能就足够了，并且不会强迫您在被删除的情况下上升整个层次结构。或者您可以删除反向链接，只是说您在删除操作上失去了精度。该`TreeNode`界面实际上并不强制您提供删除操作，但您可能还是想要一个。

好吧，就是这样。为了得出预先计算的精确值，您必须保留某种反向链接。如果你不这样做，你最好调用你的方法`hasHadChildren`或更有趣的方法`isVirgin`。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T19:42:11.187

解决方案有几个部分：

*   就像 Lorenzo Boccaccia 所说，使用[TreeWillExpandListener](http://java.sun.com/docs/books/tutorial/uiswing/components/tree.html#data)

*   **另外**，需要在树上调用nodesWereInserted，这样会显示正确数量的节点。 [看到这个代码](http://www.jroller.com/Thierry/resource/SwingX/LazyLoadingTreeNode.java)

*   我已经确定，如果你不知道孩子的数量，TreeNode.getChildCount() 至少需要返回 1（它不能返回 0）

# apache-flex - 如何判断 MXML 组件何时完全完成创建？

> ID：154800
> 
> 赞同：2
> 
> 时间：2008-09-30T20:13:00.483
> 
> 标签：apache-flex, mxml

MXML 组件可能非常复杂，包含许多嵌套控件，包括异步加载的内容，例如 Image/SWFLoader。

是否有一个我可以在我的组件上观察的事件，只有在每个控件和子组件（包括 SWF 和图像）加载时才会引发？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T22:29:08.503

如果您正在谈论加载 swf 内容或类似的任何真正外部的内容，CreationComplete 将无法解决问题。当 MXML 组件按照 MXML 中的定义（IE 嵌套组件、按钮、框、画布等）进行布局时，CreationComplete 会被触发，因此需要从外部加载的内容（图像、swf）不计算在内。

您需要做的是跟踪您正在等待的所有内容，并在所有这些元素加载后触发自定义事件。

一种可能的骇人听闻的方法是监听与每个元素相关的任何加载完成事件，然后让它们回调到相同的函数，该函数增加一个等于您正在等待的组件数量的值。这意味着如果您正在修改它，您必须更加注意它，但这也意味着您不必检查每个需要加载的元素的布尔值（IE“if (image1Loaded && image2Loaded && swfLoaded)”等）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T21:00:57.280

In some complex cases, like when your component is considered "finished" only when some data has been retrieved via HTTP or something like that, custom event is your best bet.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T20:14:13.710

onApplicationComplete 事件？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T20:22:30.100

creationComplete 事件应该可以解决问题 - 在子组件上调用 creationComplete 之后，它会在父组件上调用。

[您可以在Adob​​e 文档](http://livedocs.adobe.com/flex/3/html/help.html?content=layoutperformance_03.html)中获得有关组件生命周期的更多信息。

# c++ - C++ 运算符“&”和“->”的优先级

> ID：154802
> 
> 赞同：3
> 
> 时间：2008-09-30T20:13:02.167
> 
> 标签：c++, operators, operator-precedence

鉴于以下情况：

```
&row->count 
```

会在 C++ 中评估 &(row->count) 还是评估 (&row)->count？

编辑：这是 C++ 优先级的一个很好的[链接](http://www.cppreference.com/wiki/operator_precedence)。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-30T20:21:36.750

就优先规则而言，我一直很喜欢 Steve Oualline 在“Practical C”中提出的规则：

> C 中有 15 条优先规则（&& 在 || 之前 ?:)。实用的程序员将这些减少到两个：
> 
> 1）乘法和除法在加法和减法之前。
> 
> 2）在其他所有内容周围加上括号。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T20:16:11.303

[&(行->计数)](http://www.cppreference.com/wiki/operator_precedence)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T20:14:56.733

这已经问过了。但[这里](http://www.cppreference.com/wiki/operator_precedence)有一个链接。

编辑：好的[，这个](https://stackoverflow.com/questions/113992/c-binary-operators-order-of-precedence)问题非常相似。并且可能还有另一个。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T20:19:29.843

[这里](http://www.difranco.net/compsci/C_Operator_Precedence_Table.htm)解释了 C 运算符的优先级

根据表格， -> 的优先级高于 & 运算符，所以它是 &(row->count)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T21:36:25.400

我可以建议您使用测试程序解决这些问题吗？这样做的好处是您将确定答案对于您的实施是正确的，并且您不会面临问题回答错误的风险。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T20:15:30.650

&(行->计数)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T20:17:14.497

-> 具有比 &（地址）更高的优先级。所以你的表达式将被评估为 &(row->count)

# fonts - 渲染复杂字体的最佳选择是什么？

> ID：154808
> 
> 赞同：0
> 
> 时间：2008-09-30T20:14:19.403
> 
> 标签：fonts, rendering, arabic, persian

我正在开发一款游戏（使用 Ruby）并计划以多种语言提供它。我想知道渲染文本的最佳选择是什么。特别是，我使用的任何东西都应该能够渲染复杂的字体（尤其是阿拉伯语和波斯语）。

我一直在环顾四周，偶然发现了 freetype、graphite 和使用 windows 原生 api 函数（我很好，它不是跨平台的）等等。我应该做什么，有什么不同的权衡？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T20:34:35.373

如需跨平台解决方案，请查看[Pango](http://pango.org)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T20:25:04.183

查看 www.freetype.org 它处理非从左到右的字体。它为您生成字形，但您必须将它们渲染到设备（OpenGL/DirectX 等）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T20:25:48.987

如果您正在寻找一种将字体光栅化为位图的方法，那么 Freetype 和 Windows API 都可以很好地处理这个问题。

如果您正在寻找一种在屏幕上绘制文本的方法，请尽可能使用 Window 的原生 API；双向文本和重音符号以及所有这些东西都很难并且很耗时，因此您最好需要一个 API 来为您处理它。这对您的游戏是否可行取决于您使用的图形 API，您没有指定。

**编辑：**要栅格化整个文本字符串，您需要使用 win32 的 DrawText，这意味着您需要[稍微弄脏](http://msdn.microsoft.com/en-us/library/ms532314(VS.85).aspx)您的手。

# excel - 如何使用密码保护将文件 (Excel) 在线 (Apache 服务器) 但用户可以更改文件并保存更改？

> ID：154821
> 
> 赞同：2
> 
> 时间：2008-09-30T20:16:11.613
> 
> 标签：excel, protection, file-access

我必须在具有一些基本密码保护（基本 http auth）的 Web 服务器（Apache）上在线放置一个 excel 文件。但是，用户应该能够从 excel 中打开文件并将其更改保存回服务器。

有没有简单有效的解决方案？我对 webdav 不是很有经验。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T23:18:46.147

也许使用[Google Docs](http://docs.google.com/)来共享文档。这将是交钥匙。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T20:41:26.047

Funny enough, if you just need "basic-level" security, you can set it up in the Excel sheet itself:

Go to the Tools -> Protection menu and you can lock down the whole sheet, or just specific ranges.

*Note* This is not "really good" security and will not stand up against an even moderately-skilled attack...but it will pass muster for the most basic uses.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T19:12:52.177

Webdav 可以做到这一点。设置起来可能很麻烦。

# linq - LinqtoSQL 过滤器和按语法排序

> ID：154826
> 
> 赞同：2
> 
> 时间：2008-09-30T20:16:48.727
> 
> 标签：linq, linq-to-sql, sql-order-by

我的 Techie Bretheren（当然还有 Sisteren！），

我有一个具有以下实体的 LinqToSql 数据模型： [数据模型 http://danimal.acsysinteractive.com/images/advisor.jpg](http://danimal.acsysinteractive.com/images/advisor.jpg)

我需要检索特定办公室的所有顾问，按他们在办公室内的顺序排序。我的第一部分与连接一起工作：

```
public static List<Advisor>GetOfficeEmployees(int OfficeID)
{
    List<Advisor> lstAdvisors = null;
    using (AdvisorDataModelDataContext _context = new AdvisorDataModelDataContext())
    {
        var advisors = from adv in _context.Advisors
                       join advisoroffice in _context.OfficeAdvisors
                           on adv.AdvisorId equals advisoroffice.AdvisorId
                       where advisoroffice.OfficeId == OfficeID
                       select adv;

        lstAdvisors = advisors.ToList();

    }
    return lstAdvisors;
} 
```

但是，我似乎无法将疲惫的大脑包裹在 order by 子句中。任何人都可以提供一些建议吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-30T20:38:46.723

```
from adv in _context.Advisors
where adv.OfficeAdvisor.Any(off => off.OfficeId == officeID)
order adv by adv.OfficeAdvisor.First(off => off.OfficeId = officeID).Sequence
select adv; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T20:40:50.417

```
public static List<Advisor>GetOfficeEmployees(int OfficeID)
{
    List<Advisor> lstAdvisors = null;
    using (AdvisorDataModelDataContext _context = new AdvisorDataModelDataContext())
    {
        var advisors = from adv in _context.Advisors
                       join advisoroffice in _context.OfficeAdvisors
                           on adv.AdvisorId equals advisoroffice.AdvisorId
                       where advisoroffice.OfficeId == OfficeID
                       group adv by adv.OfficeId into g
                       order by g.Sequence
                       select g;

        lstAdvisors = advisors.ToList();

    }
    return lstAdvisors;
} 
```

* * *

**注意：**我目前无法在 Visual Studio 上对此进行测试，但应该可以。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T17:50:32.283

您可以像这样添加 order by 子句：

```
var advisors = from adv in _context.Advisors
                  join advisoroffice in _context.OfficeAdvisors
               on adv.AdvisorId equals advisoroffice.AdvisorId
               where advisoroffice.OfficeId == OfficeID
               orderby advisoroffice.Sequence //  < -----
               select adv; 
```

# c# - dll 的 App.config

> ID：154837
> 
> 赞同：11
> 
> 时间：2008-09-30T20:19:26.660
> 
> 标签：c#, dll, app-config

我们有一个“引擎”，可以动态加载 dll（无论位于某个目录中的什么），并通过反射从它们中调用 Workflow 类。

我们现在有一些需要访问数据库的新工作流，所以我想我会在 dll 目录中放置一个配置文件。

但由于某种原因，我的工作流程只是看不到配置文件。

```
<configuration>
  <appSettings>
      <add key="ConnectString" value="Data Source=officeserver;Database=mydatabase;User ID=officeuser;Password=officeuser;" />
  </appSettings>
</configuration> 
```

给定上面的配置文件，下面的代码打印一个空字符串：

```
Console.WriteLine(ConfigurationManager.AppSettings["ConnectString"]); 
```

我想我想要的只是指定一个配置文件名，但我在这里遇到了问题。我只是没有得到结果。有人有任何指示吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-30T20:38:12.233

如果您用于读取 AppSettings 的代码示例在您的 DLL 中，那么它将尝试读取应用程序的配置文件，而不是 DLL 的配置文件。这是因为您使用反射来执行代码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T20:29:47.493

有趣的是，我们正在做一些非常相似的事情，并且配置文件加载得很好。在我们的例子中，我认为每个新配置文件的名称都与其关联程序集的名称相匹配。因此 MyLibrary.dll 将有一个名为 MyLibrary.dll.config 的文件，其中包含该文件程序集的信息。此外，我方便的示例是使用 VB.Net 而不是 C#（我们各有一些），并且其中的所有设置都是针对 VB 特定的 My.Settings 命名空间，所以我们不直接使用 ConfigurationManager 类阅读它们。

设置本身如下所示：

```
<applicationSettings>
    <MyLibrary.My.MySettings>
        <setting name="SomeSetting" serializeAs="String">
            <value>12345</value>
        </setting>
    </MyLibrary.My.MySettings>
</applicationSettings> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T23:11:14.690

我为一个类似的系统写了这个。我的回忆是，我曾经`Assembly.GetExecutingAssembly`获取 DLL 的文件路径，附加`.config`到该名称，将其加载为`XmlDocument`，导航到`<appSettings>`节点并将其传递给 a`NameValueSectionHandler`的`Create`方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-02T12:32:38.453

这是一种方法 - AppDomain.CurrentDomain.SetData ("APP_CONFIG_FILE", "path to config file");

调用构造函数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T20:34:32.570

如果我没记错的话，app.config 将从您的应用程序目录加载，因此如果您从其他目录加载 dll，您需要在应用程序的配置文件中获得它们所需的密钥。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T20:42:20.227

我不完全确定，但我认为默认情况下，该类仅适用于 AppDomain 的入口方法的路径（大部分时间是 exe 的路径）。您需要首先调用 OpenExeConfiguration(string exePath)（Framework 2.0 及更高版本）以指向不同的配置文件。

# .net - 从 Object 结果继承 IEnumerable

> ID：154842
> 
> 赞同：1
> 
> 时间：2008-09-30T20:20:11.027
> 
> 标签：.net, ienumerable

我发布了对[这个问题](https://stackoverflow.com/questions/154706)的回答，包括最后关于 String.Split() 应该如何接受 IEnumerable<string> 而不是 string[] 的简短咆哮。

这让我思考。如果继承其他所有内容的基 Object 类为 IEnumerable 提供了一个默认实现，这样现在所有内容都返回一个 Enumerator 仅针对一个项目（本身）——除非它被覆盖以执行其他操作，如集合类。

这个想法是，如果像 String.Split() 这样的方法确实接受 IEnumerable 而不是数组，我可以将单个字符串传递给函数，它就可以工作，而不必过多地创建分隔符数组。

我敢肯定有各种各样的理由不这样做，其中最重要的一点是，如果所有东西都实现了 IEnumerable，那么在某些情况下，实现偏离默认值的少数类的行为可能与您预期的不同。但我仍然认为这将是一个有趣的练习：会有什么其他后果？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T20:32:23.573

```
public static IEnumerable<object> ToEnumerable(this object someObject)
{
    return System.Linq.Enumerable.Repeat(someObject, 1);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T20:26:02.357

**索引运算符 ([]) 不是 IEnumerable<T> 契约的一部分** 查看反射器中的代码后，代码大量使用索引运算符，它始终是 Array 的一部分。

好吧，简单地说，Array 总是有一个枚举器。

> 这个想法是，如果像 String.Split() 这样的方法确实接受 IEnumerable 而不是数组，我可以将单个字符串传递给函数，它就可以工作，而不必过多地创建分隔符数组。

这不是真的，字符串继承了 IEnumerable<char> 而且你没有泛型变量，所以你不能将 IEnumerable<char> 转换为 IEnumerable<string>。您将获得拆分的 IEnumerable<char> 版本，而不是所需的字符串。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T20:28:20.400

您是否考虑过使用辅助对象并为 IEnumerable 类实现拆分？

我曾经为 Enum 类制作了一个 GetDescription，以便轻松获取 DescriptionAttribute。它工作得非常好。

# php - Flash 和 PHP 脚本之间的安全通信

> ID：154844
> 
> 赞同：6
> 
> 时间：2008-09-30T20:20:19.483
> 
> 标签：php, flash, security

我对 Flash 知之甚少，但对于一个小 Flash 游戏，我必须使用 PHP 将用户的得分和成功尝试存储在数据库中。现在 Flash 在用户计算机上本地运行并连接到远程服务器。我怎样才能防止操纵游戏分数。这个用例有什么最佳实践吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-30T20:25:14.727

您可能想检查以下其他问题：

*   Q46415 将未经篡改[的数据从 Flash 应用程序传递到服务器？](https://stackoverflow.com/questions/46415/)
*   Q73947[阻止人们破解基于 PHP 的 Flash 游戏高分表的最佳方法是什么。](https://stackoverflow.com/questions/73947/)
*   Q25999[非网页游戏的安全在线高分列表](https://stackoverflow.com/questions/25999/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T20:26:20.140

你所问的本质上是不可能的。游戏在客户端上运行，因此完全受用户支配。唯一可以确定的方法是根据用户的输入（鼠标移动、按键）在服务器上运行游戏的实时模拟，这绝对是荒谬的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T20:24:46.337

这个话题已经在这里@stackoverflow，至少部分覆盖

[阻止人们破解基于 PHP 的 Flash 游戏高分表的最佳方法是什么](https://stackoverflow.com/questions/73947)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T21:20:17.187

正如 ssddw 所指出的，这基本上是不可能的。发送分数的代码在用户的计算机上运行，​​他们可以控制它以及那里运行的所有内容。

您能做的最好的事情是定期更改加密机制，以便分数操纵者需要一段时间才能再次弄清楚。你只能尽量减少损失，永远不能消除它，但在像我工作的网站上，如果我们只有一百个人发送假分数，在我们每天看到的数十万人中，我们认为这很好在可接受的范围内。（我们仍然粉碎那些我们发现作弊的人，但我们认为这不是什么大问题。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T21:39:20.213

您至少可以丢弃超出您认为合法的某个阈值的分数。它仍然为对高分列表进行更微妙的操作留下了空间，但至少有助于缓解看到无法获得高分榜首的明显挫败感。

# c# - 如果存在于 C# 中，则修剪美元符号的简单方法

> ID：154845
> 
> 赞同：4
> 
> 时间：2008-09-30T20:20:20.560
> 
> 标签：c#

我有一个 DataRow，我得到了一个带有美元符号的 Amount 元素。我在上面调用一个 toString 。是否有另一种方法可以调用它来删除美元符号（如果存在）。

**所以像：**

*dr.ToString.Substring(1, dr.ToString.Length);*

但更有条件的是，以防万一美元符号再次出现。

我试图通过明确定义另一个字符串来做到这一点。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-30T20:22:11.257

```
Convert.ToString(dr(columnName)).Replace("$", String.Empty) 
```

-- 如果您正在使用数据表，那么您必须将值（默认情况下为它的对象）拆箱为字符串，因此您已经创建了一个字符串，然后是另一个带有替换的字符串。确实没有其他方法可以绕过它，但是您只会在处理数以万计的操作时看到性能差异。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-30T20:48:46.590

你也可以使用

```
string trimmed = (dr as string).Trim('$'); 
```

或者

```
string trimmed = (dr as string).TrimStart('$'); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-30T20:35:33.800

如果您使用 C# 3.0 或更高版本，您可以使用[扩展方法](http://weblogs.asp.net/dwahlin/archive/2008/01/25/c-3-0-features-extension-methods.aspx)。

```
public static string RemoveNonNumeric(this string s)
{
   return s.Replace("$", "");
} 
```

然后您的代码可以更改为：

```
((String)dr[columnName]).RemoveNonNumeric(); 
```

这将允许您稍后更改 RemoveNonNumeric 的实现，以删除外币中的逗号或 $ 符号等内容。

此外，如果从数据库中出来的对象确实是一个字符串，则不应调用 ToString()，因为该对象已经是一个字符串。您可以改为投射它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T20:23:22.377

正则表达式会起作用。

Regex.Replace(theString, "$", "");

但是有多种方法可以解决这个问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T20:26:33.507

dr[列名].ToString().Replace("$", String.Empty)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T20:31:23.980

为什么不更新数据库查询以使其不返回美元符号？这样您就不必在 C# 代码中使用它。

# database - 如何从 Web 更新 Access 数据库？

> ID：154846
> 
> 赞同：1
> 
> 时间：2008-09-30T20:20:21.790
> 
> 标签：database, ms-access, forms

我正在寻找一种创建在线表单的方法，该表单将更新只有几个表的 Access 数据库。有谁知道一个简单的解决方案？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T20:24:47.770

ASP.NET 应该可以做得[很好](http://www.w3schools.com/aspnet/aspnet_dbconnection.asp)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T20:26:51.370

这取决于您使用的网络技术。

使用 Classic ASP，您可以将任何 Windows 机器附带的 JET DB 引擎 COM 对象连接到数据库。

使用 ASP.NET，您可以使用 OLEDB 数据连接器进行连接。

# svn - 如何删除文件夹的 Subversion 控制？

> ID：154853
> 
> 赞同：264
> 
> 时间：2008-09-30T20:21:32.740
> 
> 标签：svn

我有一个文件夹 ，`c:\websites\test`它包含从不再存在的存储库中签出的文件夹和文件。如何让 Subversion 停止跟踪该文件夹以及任何子文件夹和文件？

我知道我可以简单地删除该`.svn`文件夹，但是在许多层中有很多子文件夹。

* * *

## 回答 #1

> 赞同：262
> 
> 时间：2008-09-30T20:29:27.667

此外，如果您使用 TortoiseSVN，只需导出到当前工作副本位置，它将删除 .svn 文件夹和文件。

[http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-export.html#tsvn-dug-export-unversion](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-export.html#tsvn-dug-export-unversion)

*Subversion 1.7 的更新答案：*
在 Subversion 1.7 中，工作副本已被广泛修改。只有一个 .svn 文件夹，位于工作副本的基础中。如果您使用的是 1.7，那么只需删除 .svn 文件夹及其内容是一个简单的解决方案（无论使用 TortoiseSVN 还是命令行工具）。

* * *

## 回答 #2

> 赞同：156
> 
> 时间：2008-09-30T20:35:05.470

在 Linux 上，这将起作用：

```
 find . -iname ".svn" -print0 | xargs -0 rm -r 
```

* * *

## 回答 #3

> 赞同：119
> 
> 时间：2008-09-30T20:22:25.733

尝试[svn 导出](http://svnbook.red-bean.com/en/1.0/re10.html)。

你应该能够做这样的事情：

```
svn export /path/to/old/working/copy /path/to/plain/code 
```

然后只需删除旧的工作副本。

TortoiseSVN 还有一个[导出功能](http://tortoisesvn.net/node/343)，其行为方式相同。

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2008-09-30T20:25:37.443

如果您运行的是 Windows，那么您可以在该文件夹上进行搜索，`.svn`然后将它们全部列出。按`Ctrl`+`A`将选择所有这些，按删除将删除所有“讨厌”的 Subversion 内容。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2012-05-08T15:14:33.487

在 Linux 上，命令是：

```
svn delete --keep-local file_name 
```

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2011-02-02T22:33:42.590

我发现您甚至不需要复制到临时位置。你可以做一个

```
svn export --force . 
```

并且 .svn 文件将被*原地删除，*其他文件保持原样。非常方便，不易杂乱。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2012-09-04T14:06:19.553

在 Linux 中没有子shell 来删除`.svn`文件夹：

```
find . -name .svn -exec rm -r -f {} +

rm = remove
-r = recursive (folders)
-f = force, avoids a lot of "a your sure you want to delete file XY". 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2015-02-03T19:52:47.410

这些答案都不符合我的情况。我在 subversion 1.8 上，我有一个工作副本，`.svn`在第一个文件夹 root 中只有一个文件夹。但是，我想从工作副本中删除一些分支。

无论我做什么，每当我运行“更新”时，它都会恢复这些文件并将它们全部恢复。我不想从存储库中删除它们，只是从我的计算机中删除它们——但我需要保持工作副本的其余部分完好无损（因此不能只删除 .svn 文件夹）。

解决方案？`svn update --set-depth exclude <dir>`

这是排除特定目录的客户端“更新”。它可以在[svnbook.com](http://svnbook.red-bean.com/en/1.7/svn.advanced.sparsedirs.html)的手册中找到。简而言之，它将其描述为：

> 从 Subversion 1.6 开始，您可以采用不同的方法。首先，完整地检查目录。然后在您不关心的一个子目录上运行 svn update --set-depth exclude 。

对于 TortoiseSVN，您也可以通过右键单击不需要的文件夹来执行相同的操作，单击`Update to revision...`，然后将“更新深度”设置为`Exclude`，如下图所示：

![在此处输入图像描述](https://i.stack.imgur.com/0ceDV.png)

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2013-08-01T09:52:43.360

它对我很有效：

```
find directory_to_delete/ -type d -name '*.svn' | xargs rm -rf 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-09-30T20:24:28.223

使用`svn export`命令：

```
cd c:\websites\test
svn export c:\websites\test_copy 
```

版本控制下的所有文件都将被导出。仔细检查以确保您没有遗漏任何内容。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2011-02-15T11:10:05.230

只需删除所需文件夹中的 .svn 文件夹，然后控件将被自动删除。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-02-24T13:20:36.793

在 Windows 上，您可以为此添加一个快速链接到您的资源管理器右键菜单。只需启动此注册表脚本：

```
Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\Folder\shell\DeleteSVN]
@="Delete SVN Folders"

[HKEY_CLASSES_ROOT\Folder\shell\DeleteSVN\command]
@="cmd.exe /c \"TITLE Removing SVN Folders in %1 && COLOR 9A && FOR /r \"%1\" %%f IN (.svn) DO RD /s /q \"%%f\" \"" 
```

这将在您的右键菜单中添加一个名为“删除 SVN 文件夹”的项目。这将删除此文件夹和所有子文件夹中的所有 .svn 文件夹。

资料来源（德语）：[http ://www.sjmp.de/software/alle-svn-ordner-und-dateien-loeschen/](http://www.sjmp.de/software/alle-svn-ordner-und-dateien-loeschen/)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-30T20:23:56.417

您可以使用“svn export”来创建没有 svn 数据的该文件夹的副本，或者您可以将该文件夹添加到忽略列表

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2010-11-04T13:37:33.777

对于使用带有 SVN 的 NetBeans 的用户，有一个选项“Subversion > Export”。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2011-02-02T22:38:55.377

还有一个不错的小型开源工具，称为[SVN Cleaner](http://code.google.com/p/svn-cleaner/)，它为 Windows 资源管理器上下文菜单添加了三个选项：

*   删除所有 .svn
*   删除除 Root 之外的所有 .svn
*   删除本地回购文件

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2011-12-16T21:15:09.907

在 Windows 7 上，如果启用了隐藏文件，则只需打开项目文件夹并搜索“.svn”并删除所有找到的 .svn 文件夹。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-08-17T16:33:15.533

检查这个，[http://www.hacktrix.com/how-to-delete-svn-folders-from-your-project-on-windows-linux-and-mac](http://www.hacktrix.com/how-to-delete-svn-folders-from-your-project-on-windows-linux-and-mac)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-05-22T16:15:26.900

另一个（更简单的）Linux 解决方案：

```
rm -r `find /path/to/foo -name .svn` 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2013-05-28T09:45:56.360

答案非常简单 -**将文件夹导出到自身**！TortoiseSVN 检测到这种特殊情况并询问您是否要使工作副本无版本。如果您回答是，控制目录将被删除，您将拥有一个普通的、未版本化的目录树。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-12-11T08:54:40.547

> 最好和最简单的方法

如果你认为你可以用一个简单的魔法命令获胜，那你就失败了！SVN 真的很棘手，并且总是以某种方式在 Xcode 中返回一个新的错误消息。迟早，答应……所以你必须聪明地去做！

如您所知，Xcode 下的常规和最佳实践是删除左侧项目窗格中的文件。如果您错过了它并以某种方式在 Finder 中删除了它，那么您就有麻烦了。大麻烦！但如果你做得好，你可以解决它并节省时间。

**首先，您需要先删除对文件或文件夹的 SVN 引用，然后才能实际删除它**

1.  如果您可以将文件/文件夹从垃圾箱中放回或在删除时撤消最后一步，那么...

2.  去终端——是的，好的旧终端——然后去那个位置。最好的方法是输入**cd**然后将文件夹/文件拉到终端。你会得到类似的东西

> cd /Users/UserName/Documents/Apps_Developing/...

你可以检查你在哪里

> ls

命令列出您的文件。

3.  然后您需要使用 SVN 命令删除 svn 引用：

    svn delete --keep-local fileName_toDelete

这将从 SVN 存储库中删除该文件，但您必须在 Finder 中手动删除它。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2012-01-19T19:54:00.900

NetBeans IDE 用户可以这样做：

1.  在 IDE 中打开 SVN 项目
2.  选择项目

    > 右键单击 Subversion 导出

3.  在对话框中

    > 导出到文件夹 /var/tmp/projectname 按导出等待将显示完成会询问您是否要打开它 即时打开

4.  您现在可以切换到 Git :)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2012-09-01T14:41:26.227

我的想法是删除 .svn 文件夹，然后将所有其他文件移动到新文件夹。它是如此简单。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-04-10T13:09:26.587

我使用 rsync：

```
# copy folder src to srcStripped excluding subfolders named '.svn'. retain dates, verbose output
rsync -av --exclude .svn src srcStripped 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-07-22T10:02:42.793

当您使用 Windows 操作系统时，转到您的文件夹位置并检查隐藏文件是否打开，然后您可以在其中看到**SVN**文件夹。只需删除该文件夹。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2015-10-19T15:26:04.577

`svn export`工作正常，但我认为这是：

```
svn rm --keep-local <folder/file> 
```

它将它从您的本地存储库中删除。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2015-10-23T07:13:41.783

作为关键点，当您使用*shell*删除 .svn 文件夹时，您需要**-depth**参数来防止*find*命令进入刚刚删除的目录并显示错误消息，例如

> “查找：./.svn：没有这样的文件或目录”

因此，您可以使用如下`find`命令：

```
cd [dir_to_delete_svn_folders]
find . -depth -name .svn -exec rm -fr {} \; 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2019-03-21T15:31:03.140

从 Windows 命令行：

```
rmdir .svn /s /q 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2020-04-23T19:27:01.750

使用以下内容：

`svn rm --keep-local <folder name>`删除文件夹及其中的所有内容。

`svn rm --keep-local <folder name>/*`保留文件夹，但删除文件夹中的所有内容。

下面是一个例子：

```
~/code/web/sites/testapp $ svn rm --keep-local includes/data/*
D         includes/data/json
D         includes/data/json/index.html
D         includes/data/json/oembed
D         includes/data/json/oembed/1.0
D         includes/data/json/oembed/1.0/embed1.json
D         includes/data/json/oembed/1.0/embed2.json
D         includes/data/json/oembed/1.0/embed3.json 
```

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2016-04-27T21:54:24.243

在 Windows 10 上，我们需要转到`Windows Explorer`，然后转到`View`并选中 的复选框`View hidden files`。

然后导航到在 Windows 资源管理器上链接了 SVN 的文件夹并删除该`.svn`文件夹/文件。

# javascript - 将 JavaScript 字符串转换为全部小写

> ID：154862
> 
> 赞同：1388
> 
> 时间：2008-09-30T20:22:35.093
> 
> 标签：javascript, string

如何将 JavaScript 字符串值转换为全部小写字母？

示例：`"Your Name"`到`"your name"`

* * *

## 回答 #1

> 赞同：1796
> 
> 时间：2008-09-30T20:26:19.703

```
var lowerCaseName = "Your Name".toLowerCase(); 
```

* * *

## 回答 #2

> 赞同：427
> 
> 时间：2008-09-30T21:51:34.803

使用[String](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/String)对象的[toLowerCase](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/String/toLowerCase)或[toLocaleLowerCase](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/String/toLocaleLowerCase)方法。不同之处在于它将考虑用户/主机的当前语言环境。根据[ECMAScript 语言规范 (ECMA-262)](http://www.ecma-international.org/publications/standards/Ecma-262.htm)的第 15.5.4.17 节，……</p> `toLocaleLowerCase``toLocaleLowerCase`

> …工作原理与 toLowerCase 完全相同，只是它的结果旨在为主机环境的当前语言环境产生正确的结果，而不是独立于语言环境的结果。只有在该语言的规则与常规 Unicode 大小写映射冲突的少数情况下（例如土耳其语）才会有所不同。

例子：

```
var lower = 'Your Name'.toLowerCase(); 
```

另请注意，`toLowerCase`and`toLocaleLowerCase`函数被实现为在*任何*值类型上通用。`String`因此，您甚至可以在非对象上调用这些函数。这样做意味着在更改结果字符串值中每个字符的大小写之前自动转换为字符串值。例如，您可以直接在这样的日期*申请：* `toLowerCase`

```
var lower = String.prototype.toLowerCase.apply(new Date()); 
```

这实际上相当于：

```
var lower = new Date().toString().toLowerCase(); 
```

第二种形式通常是首选，因为它简单易读。在早期版本的 IE 中，第一个版本的好处是它可以使用`null`值。应用`toLowerCase`或`toLocaleLowerCase`打开的结果`null`将产生`null`（而不是错误条件）。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2008-09-30T20:25:09.657

是的，JavaScript 中的任何字符串都有一个`toLowerCase()`方法，该方法将返回一个新字符串，该字符串是所有小写的旧字符串。旧字符串将保持不变。

因此，您可以执行以下操作：

```
"Foo".toLowerCase();
document.getElementById('myField').value.toLowerCase(); 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2009-12-04T22:54:59.967

toLocaleUpperCase() 或小写函数的行为不像他们应该做的那样。例如，在我的系统上，使用 Safari 4、Chrome 4 Beta 和 Firefox 3.5.x，它会错误地转换带有土耳其字符的字符串。浏览器对 navigator.language 的响应分别为“en-US”、“tr”、“en-US”。

但据我所知，没有任何方法可以在浏览器中获取用户的 Accept-Lang 设置。

尽管我已将每个浏览器都配置为首选 tr-TR 区域设置，但只有 Chrome 给我带来了麻烦。我认为这些设置只影响 HTTP 标头，但我们无法通过 JavaScript 访问这些设置。

在[Mozilla 文档](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/String)中，它说“字符串中的字符在尊重当前语言环境的同时转换为 ...。对于大多数语言，这将返回与 ...相同的内容”。我认为它对土耳其语有效，如果它配置为*en*或*tr*并没有什么不同。

在土耳其语中，它应该将“DİNÇ”转换为“dinç”，将“DINÇ”转换为“dınç”，反之亦然。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2010-10-02T09:06:36.360

只是一个示例`toLowerCase()`，`toUpperCase()`以及尚未提供的原型`toTitleCase()`或`toProperCase()`：

```
String.prototype.toTitleCase = function() {
  return this.split(' ').map(i => i[0].toUpperCase() + i.substring(1).toLowerCase()).join(' ');
}

String.prototype.toPropperCase = function() {
  return this.toTitleCase();
}

var OriginalCase = 'Your Name';
var lowercase = OriginalCase.toLowerCase();
var upperCase = lowercase.toUpperCase();
var titleCase = upperCase.toTitleCase();

console.log('Original: ' + OriginalCase);
console.log('toLowerCase(): ' + lowercase);
console.log('toUpperCase(): ' + upperCase);
console.log('toTitleCase(): ' + titleCase);
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2011-09-17T06:51:35.380

我注意到很多人都在[寻找](http://www.google.com.ua/search?sourceid=chrome&ie=UTF-8&q=strtolower%20js)`strtolower()`JavaScript。他们期望与其他语言中的函数名称相同，这就是这篇文章在这里的原因。

我建议使用[本机](http://www.quirksmode.org/js/strings.html#tocase)JavaScript 函数：

`"SomE StriNg".toLowerCase()`

这是与 PHP 完全相同的函数（适用于那些将 PHP 代码移植到 JavaScript 中的人）

```
function strToLower (str) {
    return String(str).toLowerCase();
} 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2012-05-26T23:57:11.900

请注意，该函数*仅*适用于*字符串*对象。

例如，我正在使用一个插件，并且很困惑为什么会收到“extension.tolowercase is not a function”JavaScript 错误。

```
 onChange: function(file, extension)
    {
      alert("extension.toLowerCase()=>" + extension.toLowerCase() + "<="); 
```

这产生了错误“extension.toLowerCase 不是函数”。所以我尝试了这段代码，它揭示了问题！

```
alert("(typeof extension)=>" + (typeof extension) + "<=");; 
```

输出是 "(typeof extension)=>object<=" - 所以啊哈，我的输入*没有*得到字符串 var。修复很简单 - 只需将该死的东西强制转换为字符串！：

```
var extension = String(extension); 
```

演员表之后，*extension.toLowerCase()*函数运行良好。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2013-07-20T13:13:39.803

方法或函数：toLowerCase()、toUpperCase()

描述：这些方法用于覆盖从小写到大写的字符串或字母，反之亦然。例如：“和”到“与”。

转换为大写：

示例代码：

```
<script language=javascript>
    var ss = " testing case conversion method ";
    var result = ss.toUpperCase();
    document.write(result);
</script> 
```

结果：测试用例转换方法

转换为小写：

示例代码：

```
<script language=javascript>
    var ss = " TESTING LOWERCASE CONVERT FUNCTION ";
    var result = ss.toLowerCase();
    document.write(result);
</script> 
```

结果：测试小写转换功能

解释：在上面的例子中，

*   toUpperCase() 方法将任何字符串转换为“大写”字母。

*   toLowerCase() 方法将任何字符串转换为“小写”字母。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-09-15T08:54:20.440

**选项 1：使用[toLowerCase()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/toLowerCase)**

```
var x = 'ABC';
x = x.toLowerCase(); 
```

**选项 2：使用您自己的功能**

```
function convertToLowerCase(str) {
  var result = '';

  for (var i = 0; i < str.length; i++) {
    var code = str.charCodeAt(i);
    if (code > 64 && code < 91) {
      result += String.fromCharCode(code + 32);
    } else {
      result += str.charAt(i);
    }
  }
  return result;
} 
```

称它为：

```
x = convertToLowerCase(x); 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-05-30T10:12:37.967

只需使用 JS`toLowerCase()`
`let v = "Your Name" let u = v.toLowerCase();`或
`let u = "Your Name".toLowerCase();`

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-05-04T14:22:42.693

```
const str = 'Your Name';

// convert string to lowercase
const lowerStr = str.toLowerCase();

// print the new string
console.log(lowerStr); 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2019-05-16T18:51:39.420

如果您想自己构建它：

```
function toLowerCase(string) {

    let lowerCaseString = "";

    for (let i = 0; i < string.length; i++) {
        // Find ASCII charcode
        let charcode = string.charCodeAt(i);

        // If uppercase
        if (charcode > 64 && charcode < 97) {
            // Convert to lowercase
            charcode = charcode + 32
        }

        // Back to char
        let lowercase = String.fromCharCode(charcode);

        // Append
        lowerCaseString = lowerCaseString.concat(lowercase);
    }

    return lowerCaseString
} 
```

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2019-04-14T17:45:55.110

您可以在 JavaScript 字符串上使用内置的 .toLowerCase() 方法。例子：

```
var x = "Hello";
x.toLowerCase(); 
```

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2019-04-26T13:33:17.043

试试这个简短的方法：

```
var lower = (str+"").toLowerCase(); 
```

* * *

## 回答 #15

> 赞同：-4
> 
> 时间：2015-11-25T13:49:54.970

尝试

```
<input type="text" style="text-transform: uppercase">  <!-- uppercase -->
<input type="text" style="text-transform: lowercase">  <!-- lowercase --> 
```

[演示 - JSFiddle](http://jsfiddle.net/oneofthelions/z45ygobL/)

# c# - 验证和修复 xml

> ID：154885
> 
> 赞同：2
> 
> 时间：2008-09-30T20:25:22.747
> 
> 标签：c#, xml, xsd

有没有办法获得有关验证错误的更多有用信息？XmlSchemaException 提供了错误的行号和位置，这对我来说毫无意义。XML 文档毕竟不是关于它的瞬态文本表示。我想得到一个枚举错误（或错误代码），指定错误时的内容、节点名称（或 xpath）来定位问题的根源，以便我可以尝试修复它。

编辑：我说的是有效的 xml 文档——只是对特定的模式无效！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T20:47:10.790

以我的经验，你很幸运能得到一个行号和解析位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T20:50:52.607

您可能会考虑通过 DTD 进行验证，这*有时会*产生更有趣的错误，但是，在我目前从事的项目中，我们使用 XSLT 进行验证。转换检查语法并将错误报告为输出的转换文本。如果您想要更友好的错误检查，我会考虑这条路线。对我们来说，空输出意味着没有错误，否则我们会从 XSLT 处理中获得一些关于错误是什么以及在哪里的详细信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T20:28:29.243

就个人而言，我不确定如何获得更详细的错误，通常情况下，如果您打开文档并转到提到的位置，您可以轻松找到错误。

如果代码无法将文件解析为有效的 XML，则很难给出 XPATH 或其他命名的 XML 详细信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T00:11:59.893

您可以通过设置其 XmlReaderSettings 包含架构的 XmlReader，然后使用它逐节点读取输入流来完成此操作。您可以跟踪读取的最后一个节点，并在发生验证错误时很好地了解您在文档中的位置。

我认为如果你尝试这个练习，你会发现有很多验证错误（例如缺少必需的元素），其中错误节点的概念没有多大意义。是的，在这种情况下，父元素显然是错误的，但真正触发错误的是阅读器遇到结束标签而没有看到所需的元素，这就是错误线和位置指向结束标签的原因。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T10:01:54.827

看来这不是一件容易的事。罗伯特罗斯尼的答案最接近于以编程方式解决我的问题，所以我现在会接受。我将继续使用 xsl 解决方案。任何找到解决验证错误的更好方法的人都可以回复此线程。

# debugging - 如果您无法解决错误怎么办？

> ID：154897
> 
> 赞同：33
> 
> 时间：2008-09-30T20:26:59.967
> 
> 标签：debugging

您的代码中是否有过无法解决的错误？我希望我不是唯一一个有这种经历的人......

存在一些难以追踪的错误类别：

*   **与时间相关的错误**（例如，在进程间通信期间发生）
*   **与内存相关的错误**（我猜你们中的大多数人都知道合适的例子！！！）
*   **与事件相关的错误**（难以调试，因为您遇到的每个断点都会使您的 IDE 成为鼠标释放/焦点事件的目标......）
*   **操作系统相关的错误**
*   **硬件相关的错误**（发生在发布机器上，但不在开发机器上）
*   ...

老实说，有时我无法自己修复这样的错误……经过数小时（有时甚至数天）的调试后，我感到非常沮丧。

在这种情况下你会做什么（除了向别人寻求帮助，这并不总是可能的）？

你

*   使用铅笔和纸代替调试器
*   面对另一件事，稍后再回到这个错误
*   ...

请告诉我！

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-30T20:30:35.403

一些有帮助的事情：

1）休息一下，从不同的角度接近bug。

2) 更积极地跟踪和记录。

3）让另一双眼睛看着它。

4）通常的最后手段是通过改变其发生的基本条件来找出一种方法使该错误无关紧要

5）粉碎和破坏的东西。（仅缓解压力！）

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-30T21:01:27.637

我曾经在一家销售客户端-服务器应用程序的公司工作，该应用程序基本上是一个文件传输和同步工具。客户端和服务器都是我们设计的自定义应用程序。

我们有一个难以在实验室中复制的持久性错误。我们的服务器每个盒子只能处理一定数量的传入客户端连接，因此我们的许多客户会将多个服务器“集群”在一起以处理大量用户。集群的后端数据位于他们共享的文件服务器上。在此集群配置中，有一个错误会在负载下发生，我们会在涉及后端文件之一的文件共享调用中获得低级文件系统错误代码。没有人能在实验室里可靠地重复这一点，即使他们能做到，他们也无法缩小正在发生的事情的范围。

（我忘记了确切的错误，它可能是，也可能是`59 ERROR_UNEXP_NET_ERR`.`65 ERROR_NETWORK_ACCESS_DENIED`我记得它甚至不是您应该能够从我们调用的 API 获得的记录错误代码之一，这通常是锁定或解锁调用文件部分）。

由于它涉及服务器和后端文件存储之间的通信，而我是“网络传输”的人，我的任务是查看它。许多其他人都没有运气看过它。

我所拥有的一件可靠的事情是我知道在代码中的哪个位置检测到错误，但不知道该怎么做。所以我需要找到根本原因。因此，我设置了一个适当的硬件环境来复制它，并且我放置了一个服务器软件的自定义版本，用于检测相关代码部分。

仪器如下：我为麻烦的错误代码添加了一个测试，并让它在错误发生时调用一段代码将UDP数据包发送到预定的网络地址。UDP 数据包中包含一个唯一的字符串以键入。

然后我在网络上设置了一个数据包嗅探工具。（当时我正在使用[Microsoft Network Monitor](http://www.microsoft.com/downloads/details.aspx?familyid=18b1d59d-f4d8-4213-8d17-2f6dde7d7aac&displaylang=en)）。我将它放置在发送时能够“看到”这个 UDP 数据包以及集群服务器和文件服务器之间的所有通信的位置。

大多数优秀的嗅探器都有一种模式，您可以让它捕获，直到它看到特定的流量，然后停止。我打开了该模式并将其设置为查找我的代码将发送的 UDP 数据包。目标是在错误发生之前捕获所有文件服务器流量的数据包。传入和传出 UDP 数据包起源系统的最后一个网络数据包可能是关于正在发生的事情的重要线索。

我设置了“压力测试”配置，然后回家过周末。

当我周一回来时，你瞧，我有我的数据。经过数小时的运行，嗅探器正如预期的那样停止并包含捕获。在研究了捕获之后，我发现我们的服务器和文件服务器之间的[服务器消息块或 SMB](http://en.wikipedia.org/wiki/Server_Message_Block)（又名 CIFS aka [SAMBA](http://en.wikipedia.org/wiki/Samba_(software)) ）连接实际上由于服务器上的极端负载而在 TCP 级别*超时。*因为微软的所有东西都是高度分层的，它会通过文件共享堆栈作为“意外”错误进行备份，而不是返回一个更容易理解的错误代码，上面写着“嘿，你在 TCP 级别失去了连接”。

[我对 Windows 的 TCP 设置](http://support.microsoft.com/kb/314053)做了更多研究，你瞧，我们正在使用的 Windows 版本（可能是那个时代的 NT 4）的默认设置并不太慷慨。它只允许 TCP 连接和繁荣的极少数失败，你死了。一旦您失去了与文件服务器的 SMB 连接，您的所有文件锁定都将失效，并且无法恢复。

因此，我最终*为用户手册编写了一个附录*，解释了如何更改 Windows 中的 TCP 设置，以使您的集群服务器更能容忍高负载情况。就是这样。该错误的修复是*代码中的零更改*，只是一些关于如何正确配置操作系统以供该产品使用的附加文档。

我们学到了什么？

*   准备运行代码的更改版本来调查问题
*   考虑使用非传统工具来解决问题（嗅探器）
*   并非所有错误修复都需要更改代码
*   有时你可以在家里喝啤酒时诊断出虫子

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-30T20:41:47.137

我做了很多不同的事情：

*   抛开我所有的假设，从头开始。请记住，存在错误是因为看起来正确的事情实际上是错误的。即使您绝对确定正确的那些行或函数或类也可能不正确。除非你能说服自己是正确的，否则你不能假设任何事情都是正确的。

*   继续放入打印语句和断言语句以消除事物并允许我改革新的假设。

*   如果问题是控制流问题，单步调试器中的代码。不要越过函数。介入他们并检查他们执行的所有细节，以确认他们工作正常。确认参数和返回值。

*   如果某行、函数或类是可疑的，但我无法在现场证明它，那么编写一个小测试用例来完成您认为问题构造所做的事情。这可能会定位问题或提供一些关于下一步看哪里的见解。

*   停下来一天。令人惊讶的是，你的大脑会在一夜之间完成什么样的离线处理。通常，当我在做一些无意识的事情（如淋浴或开车）时，答案或关键见解会在第二天出现。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-30T20:35:17.293

创建一种自动化的方式来导致错误。要修复的最糟糕的错误是需要数小时才能重现的错误。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-30T20:34:28.793

引自“ **The Cryptonomicon** ”：

*“直觉，就像一道闪电，只持续一秒钟。它通常是在一个人被困难的破译折磨着，当一个人在脑海中回顾已经尝试过的徒劳无益的实验时，突然出现的光芒，经过几次之后，一个人发现分钟前几天的劳动无法揭示的内容。”*

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-30T20:37:26.820

我通常会请其他人看一下代码。当我解释代码应该做什么时，我有时会在我说话的时候看到错误。

当一个 bug 很棘手时，我会坐下来工作，直到找出并解决问题。有趣的是，有时捕捉神秘的错误比一切顺利进行更令人愉快。当一个 bug 被解决时，那种解脱和感觉，好吧，没有多少其他事情能比得上它（除了那些显而易见的事情）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-30T20:34:12.633

如果所有其他方法都失败了，请不要直接解决它。以更重构的方式重写问题区域代码。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-30T20:48:27.090

在找到解决方案之前，我肯定有我连续工作了 4-5 天的错误。其他错误已经在错误跟踪器中放置了几个月，因为我花了几个小时在很长一段时间内分散。我认为这种错误在任何复杂的软件项目中都是不可避免的。

一些对我有用的东西：

*   通过带有日志记录的程序流进行二进制搜索
*   使用`Trace`语句和 DbgView 来搜索在发布模式下出现的错误
*   找到在不更改代码的情况下重现错误的替代方法
*   （违反逻辑，但是......）更改代码，以便更容易重现错误（更容易实现故障条件）
*   睡在上面，明天用一双新的眼睛再试一次:)

在我看来，最糟糕的错误是并发错误，在插入日志记录时会消失。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-30T20:47:22.740

这里有很多很棒的答案。过去对我有用的一件事是问“当这个问题发生时，我能做些什么来使它完全明显？”。

例如，如果问题是数据结构中的值损坏，请尝试构建一个可以定期运行的一致性检查例程。还可以考虑通过一组记录每次更改的函数来实现对共享数据的所有访问。

或者，如果问题是“随机”内存覆盖，请使用替代 malloc()/free() 实现来捕获写入“空闲”内存（如电子围栏或 dmalloc）。

其他人提到自动化触发错误的过程。如果你能做到，那就太好了。在这些情况下，即使有一个随机锻炼程序的例程也可能会有所帮助。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-30T20:49:46.493

严重地？我按这个顺序做事。

1.  睡觉
2.  问同事
3.  重写，使该区域不受影响。
4.  问一下
5.  向您的第 3 方库供应商提出支持请求。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-30T21:01:28.930

“在这种情况下你会做什么（除了向别人寻求帮助，这并不总是可能的）？”

什么时候不能寻求帮助？

您总是可以向其他人寻求帮助——您的同事、您的老板、Stack Overflow 的朋友等等。

了解何时寻求帮助不应该令人沮丧！

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-30T21:03:53.357

这里有很多很好的提示。

我绝对不同意的一个是更改代码希望它会消失的概念。首先，您可能会引入新的错误。几秒钟后，您可以轻松地更改足以隐藏错误的内容，只是让它在下一个补丁中再次出现。

内存损坏错误特别有可能像它们出现时一样神奇地消失。但是，内存损坏错误并没有修复，只是内存的非致命区域被破坏了。

1）尝试不同的调试器。例如，我越来越频繁地使用 WinDbg。当您在调试器中加载程序时，应用程序的内存布局会略有变化。也许不同的调试器会导致错误的表现略有不同。

2) 如果你在不知道到底是什么问题的情况下更改代码，那么如果 bug 消失了，**你必须**回去了解为什么更改修复了 bug。否则，您可能只是在隐藏错误。

3) 与其他人讨论该错误，也许他们已经看到相同问题的不同版本（即其他方法来重新创建它）

4) 记录。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-30T21:09:25.590

我遇到过需要数周或数月才能找到解决方案的错误，但最终所有错误都会得到修复。除了经典的非调试器错误跟踪技术（例如在获得最小测试用例之前禁用系统的某些部分）之外，我还使用了以下技术：

*   寻找更好的调试工具。一个新的视角有很长的路要走。Xdebug 是我开始在 PHP 中使用的东西，只是因为我没有取得进展的性能错误。

*   研究错误所在的技术。这有助于调试 Outlook 加载项。它有没有意义的随机错误，而且谷歌搜索出现了zilch。通过研究 Outlook 插件最佳实践、COM 和 MAPI 编程，我们更清楚地了解了可能出现的问题，并想到了尝试修复错误的新方法，最终确实修复了它们。

*   试图加剧问题。如果有一个问题只是偶尔发生，我会努力想办法让它不断发生。这有助于在 IE 下跟踪 Web 应用程序中的错误，并缩小 Flash 插件中的崩溃错误。

*   当一切都失败时，我从头开始重写了导致问题的子系统。这可能需要几天甚至几周的时间，但是如果您遇到错误并且无法解决它，并且客户不会拒绝回答，您还能做什么？这并不总能解决问题，但如果不能解决问题，您通常会更清楚地了解问题所在。

我注意到这些错误中的一些共性，我被困了几个星期：

*   向第三方寻求帮助很少有帮助，而且等待其他人来挽救这一天通常不是一个好主意。

*   几乎所有的故障都出在某些第 3 方闭源技术中，尤其是在使用晦涩难懂的部分时。IE 在尝试使用客户端证书时遇到了令人讨厌的错误。Flash 不能很好地处理随机生成的绘图指令（其中一些是无意义的）。当您尝试从代码动态更改表单布局时，Outlook 不喜欢它。这些天来，我学会了尊重专有技术的“舒适区”。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-30T21:23:17.257

我给它更多的时间。我曾经有一个我无法弄清楚的错误（在个人项目中）。我尝试了所有我能想到的调试方法，包括谷歌，但没有成功。六个月后，我回来并在一个小时左右的时间内发现了这个错误。这不是一件简单的事情（在 Swing 内部发生了一些显然没有记录的事情），但我只是以一种我以前没有的方式看待它。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-30T20:30:11.067

我以前也遇到过这个问题，相信大家都有，我之前已经彻底放弃了，根本找不到，但是一直crash，当代码有bug的时候，我就坐下一点一点地专注于代码的每一点，直到我找到它，这很难而且需要耐心，但这是你在这种情况下所能做的。

希望这可以帮助。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-30T20:31:46.537

老实说，我不记得我无法修复的错误。它可能会导致大量重构，或者可能需要一段时间，但我从来没有一个我无法摆脱的。如果我要花一个多小时才能找到它，那么它几乎总是*非常*愚蠢和渺小的事情，比如看过去`:`应该是一个`;`，等等。

在 python 中，如果我使用的不是我的编辑器，或者它可能是其他人的代码，我`retab!`会在 vim 中使用，或者粘贴到类似 paste 的东西来检查缩进（如果我没有可用的 vim）。

如果它不是一个破坏者/交易破坏者，那么我继续前进并带着一双新的眼睛回来。

哦，你*永远**不会*有太多的日志记录。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-30T20:34:50.617

我尽可能多地添加调试（写入日志文件、消息框等），然后进行测试。

我不认为这是你能找到的最糟糕的错误。最糟糕的是那些你不能确定地重现或在测试环境中重现的那些。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-30T20:35:47.293

当无法解决错误时，我也会有些士气低落。通常当我遇到错误时，我只会记下我的发现并停止工作。我会跳到另一个更容易解决的错误，然后回到错误。通过这样做，我将有一个新的想法和态度来解决这个错误。有时，当您在错误上花费太多时间时，您可能倾向于使事情变得过于复杂。休息一下，有助于打破墙壁。

[温迪](http://www.rwendi.com)

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-30T20:37:06.027

首先，它可以重现吗？如果是这样，那将是一个巨大的优势。我希望错误总是/永远不会发生......它的间歇性错误是麻烦的。

这将取决于问题，但在我的商店，我们通常会标记团队这样的问题，认为 2 个头（或 3 个或 4 个）比 1 个更好。

有时该错误甚至不会出现在我的代码中，但通常是。有一些问题是 3rd 方库是罪魁祸首，或者特定平台上的特定实现是原因 - 那些臭味。

我将使用任何东西来至少追踪它：调试器、跟踪输出等等。

通常，如果我可以将它隔离到一个类或模块中，我将编写一个测试工具来复制现实世界并尝试在那里复制它。我通常先编写测试代码，但有时存在尚未进行测试的遗留代码（或其他开发人员的代码）。

我通常会与团队和白板大声谈论设计和问题，任何不清楚的地方。通常，一旦我们作为一个群体讨论解决方案，它就会浮出水面。

我就是做这个的。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-30T20:37:38.397

我通常，努力解决它。但是，如果这在合理的时间窗口内是不可能的，我会在我睡觉的时候把它留给脑细胞一段时间来解决它；）有时它会起作用......

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-30T20:45:49.810

我考虑在我最近经常光顾的这个名为[StackOverflow的网站上寻求帮助......](https://stackoverflow.com/)

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-10-01T00:19:07.490

这就是我今天所做的...

我调试 HW/SW 交互，它的案例日志记录（仪器）通常会更改或隐藏错误。因此，测试是“全速”执行的。我称这些虫子为“蟑螂”，因为它们会避开我能照到它们的任何光线。

所以我必须要：

找到导致错误的事务。通过日志记录列出硬件交互（此测试通过，但它说明了流程）。

Instrument 打印状态变化前后的 bug。

我现在要解决的错误当然是最坏的情况，因为硬件锁定了。硬件包括 CPU，所以它就像在一个光线充足的房间里，然后电源出现故障并且一片漆黑。

我对内存有一个特殊的后门视图，但当然这也被锁定了。我尝试重启电源，希望内存能够保持足够长的非易失性以重新启用后门。没有这样的运气。不过这是可能的。

我非常非常仔细地编写了我为描述这个错误而经历的所有步骤（什么有效，什么失败等等）。将此发送给具有类似硬件的开发人员，以验证它不是我或我的硬件。

我休息了几个小时，让这些信息得到解决，看看其他地方是否有灯泡亮着。

没有回复，这个错误是我要解决的......

这种硬件软件交互是一个循环，它进行一些设置，然后进入一个轮询循环，该循环在事务完成时读取。应该发生许多事务。哪个交易失败？是第一个吗（表明我可以调试事务而不是硬件中的一些噪音）。它总是第 N 次交易吗？是什么让第 N 个不同于第一个或第 (N-1) 个。SW 是单线程的，并且构建为可预测的。没有抢占，没有启用中断。

这个软件以前用过，有什么新的吗？所有硬件都是新的。在这种情况下，所有的硅都是新的，因为它是一个 ASIC。甚至嵌入式 CPU 也是新的和定制的，因此 ISA 是新的。

所以我怀疑一切，我是瞎子。我得偷偷靠近这只蟑螂。

我只启用了报告软件轮询硬件完成的次数的日志。通过这种方式，第一个事务快速运行，我知道我在紧密的轮询循环中接触硬件的频率。测试通过。我知道这是第 N 笔交易，并且我记录了所有交易的最高轮询次数（可能是无意义的数据）。

修改任何内容后，我必须将其放回原处以验证错误仍然存​​在。毕竟地球已经旋转了，太阳风也不那么强了；）

查看所有签到，看到一个承包商更改了一些重要的设置参数，没有任何解释。这些（外包）人员仍在评估中。这无济于事。

发现轮询循环中没有 spinwait。循环超时不好，因为没有它，超时取决于 CPU 速度。添加了spinwait，仍然没有快乐。

限制事务的数量以查看失败的地方，在 1000 之前的某个地方。

将硬件设置为运行速度较慢，仍然挂起。

讨厌让任何人读到这篇文章，但这种诽谤将不得不等到明天。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-10-01T01:26:38.857

**没有无法修复的错误，因为没有完全重写无法修复的错误。**

无法修复的错误只是您不愿意替换的错误。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-30T20:30:48.007

对于与内存相关的错误，我发现 Ants Profiler 的内存分析选项在查找错误方面帮助了我很多。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-09-30T20:31:33.310

使用更多创造性的方法来追踪错误。

在可重现的机器上使用远程调试。

使用分析工具。

向应用程序引入更多日志记录。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-09-30T20:32:40.233

我发现详细的日志记录对于捕获这些类型的错误至关重要，这些错误在您的生产机器上是“间歇性的”，但由于环境和机器负载的差异，您无法在开发机器上重现。

因此，当我遇到其中一个并且无法在合理的时间内重现/修复它时，我会用日志消息使代码的潜在区域饱和，并让它在生产中运行，直到它再次发生 - 希望我会有足够的信息日志将我指向正确的方向。

在您的生产环境中可能或可能不可用的其他技术是启用“远程调试”，这样您就可以从生产机器上运行的进程中实际调试代码 - 如果您可以摆动它，那将非常方便。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-09-30T20:35:05.673

离开一段时间然后回到问题上是我经常听到的一种常见方法。

重现错误的难易程度也是一个因素，因为如果错误只发生在程序的无数次运行中，那么通过破坏其他东西来修复它可以被认为是微不足道的收益。

还有一个问题是确定错误在哪里，它是否在某些配置中，以便它发生在服务器上，而不是我运行 IIS 5.0 的本地 XP Pro 机器上。其他一些错误可能涉及必须更改我的机器的分辨率，这可能很烦人，试图重现其他人报告的错误。

您忽略了“在另一个操作系统下发生”类别的错误，因此在 PC 上的 IE 和 Firefox 中正常的网页可能在 Mac 上的 Safari 上看起来像垃圾。在尝试使用我的机器作为服务器和在地板隔间中超过一两排的 Mac 来解决 CSS 问题时，我是不是弄脏了手才能看到这个问题，还是它的优先级太低了席卷地毯？或者，如果 Linux 上出现错误并且我附近没有任何 Linux 机器，我该怎么办？

很抱歉留下了一些问题，但这些问题有时对我来说似乎很困难。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2008-09-30T20:35:27.077

除了调试器之外，我还使用了日志记录和老式纸笔。有时我会发现非常棘手的错误，例如在调试模式下运行良好但在发布模式下中断的代码。我什至偶尔会重写完美的代码，无论出于何种原因，它都不能可靠地工作，我认为可靠比优雅更好。

我有时会尝试将其他人所说的错误重新定义为真正的功能，但这很少奏效！

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-09-30T20:41:13.660

我有一个错误，每隔几个月就会出现在客户网站上。它通常发生在凌晨 3 点，直到第二天早上客户到达他们的站点时才被发现。通常当他们发现它时，他们希望一切都立即开始工作，因此我们的支持人员通常只需重新启动计算机。多年来，它一直让我发疯。在我的测试机器或 QA 实验室中，它永远不会发生，只会在某些客户站点发生。久而久之，我

*   重构了一些我认为导致它的代码
*   在似乎崩溃的地方添加了更多调试打印输出
*   重定向标准输出，以便下次我看到它时，我可以“ `kill -3`”该过程
*   给予支持一些新工具来转储数据库锁等的当前状态。
*   添加了诊断程序，使其在发生时更加明显

几个月没有发生这种情况，我已经祈祷这次我可能会修复它，但我不指望它。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2008-09-30T20:43:59.393

如果它不重要，请不要修复它，您只会花费太多时间！

保持漏洞开放。尽可能评论/工作。以后可能会意外（或由其他人）修复它！

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2008-09-30T20:46:30.217

有时需要一点横向思考，但每个错误都是可以修复的。有时你需要离开它并在上面睡觉，有时最好让其他人快速看一下（他们可能会看到你没有看到的东西），但主要是尝试不同的事情，调用以前的经验。这可能会令人沮丧，但是当你修复它时，你得到的嗡嗡声是独一无二的！

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2008-09-30T21:32:21.947

如果 bug 很微妙，需要三天以上才能发现，那我一般会改设计，因为交付软件的重点不是三年后调用调试，所以组件之间的交互越容易，更好。

# perl - `$hash{$key} |= {}` 在 Perl 中有什么作用？

> ID：154900
> 
> 赞同：4
> 
> 时间：2008-09-30T20:27:56.843
> 
> 标签：perl, initialization, hash-reference

我正在与一些使用哈希引用的 Perl 搏斗。

最后发现我的问题是这条线：

```
$myhash{$key} |= {}; 
```

也就是说，“为 $myhash{$key} 分配一个对空哈希的引用，除非它已经有一个值”。

然而，取消引用并尝试将其用作哈希引用会导致解释器错误将字符串用作哈希引用。

将其更改为：

```
if( ! exists $myhash{$key}) {
  $myhash{$key} = {};
} 
```

... 让事情顺利进行。

所以我没有*问题*。但我很好奇发生了什么。

谁能解释一下？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-30T20:40:13.443

Perl 有速记赋值运算符。由于 Perl 具有让逻辑运算符返回最后评估的值的特性，该`||=`运算符通常用于设置变量的默认值。问题是您使用`|=`的是*按位*或而不是`||=`逻辑*或*。

从 Perl 5.10 开始，最好`//=`改用它。`//`是逻辑定义或运算符，在当前值已定义但为假的极端情况下不会失败。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-30T20:47:12.740

您看到有关使用字符串作为哈希引用的错误的原因是您使用了错误的运算符。`|=`意思是“按位或赋值”。换句话说，

```
 $foo |= $bar; 
```

是相同的

```
 $foo = $foo | $bar 
```

您的示例中发生的情况是您的新匿名哈希引用正在被字符串化，然后与`$myhash{$key}`. 更令人困惑`$myhash{$key}`的是，如果当时未定义，该值是哈希引用的简单字符串化，看起来像`HASH(0x80fc284)`. 因此，如果您对结构进行粗略检查，它可能*看起来*像一个哈希引用，但事实并非如此。以下是一些有用的输出`Data::Dumper`：

```
 perl -MData::Dumper -le '$hash{foo} |= { }; print Dumper \%hash'
   $VAR1 = {
             'foo' => 'HASH(0x80fc284)'
           }; 
```

当您使用正确的运算符时，您会得到以下结果：

```
 perl -MData::Dumper -le '$hash{foo} ||= { }; print Dumper \%hash'
  $VAR1 = {
            'foo' => {}
          }; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-30T20:41:23.287

我认为您的问题是使用“ `|=`”（按位或赋值）而不是“ `||=`”（如果为 false，则赋值）。

请注意，您的新代码并不完全相同。不同之处在于“ `$myhash{$key} ||= {}`”将用哈希引用替换现有但为假的值，但新的不会。在实践中，这可能无关紧要。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T20:30:03.187

试试这个：

```
my %myhash;
$myhash{$key} ||= {}; 
```

据我所知，您不能在子句中声明哈希*元素。*`my`您首先声明哈希，然后添加元素。

编辑：我看到你已经取出了`my`. 尝试`||=`而不是怎么样`|=`？前者是“惰性”初始化的惯用语。

# c - 不同gcc版本的语法错误？

> ID：154902
> 
> 赞同：1
> 
> 时间：2008-09-30T20:28:12.193
> 
> 标签：c, gcc, syntax-error

我用 Ubuntu Linux 用 C 语言编写了一个程序，现在我需要将它移植到 UNIX 机器（或者我认为是 UNIX 机器）上。它在我的 Ubuntu 上用 GCC 编译得很好，但是当我尝试在 UNIX 机器上用 GCC 编译它时，它给出了这个错误：

```
a.c: In function `goUpDir':
a.c:44: parse error before `char'
a.c:45: `newDir' undeclared (first use in this function)
a.c:45: (Each undeclared identifier is reported only once
a.c:45: for each function it appears in.)
a.c: In function `goIntoDir':
a.c:54: parse error before `char'
a.c:57: `newDir' undeclared (first use in this function)
a.c:57: `oldDir' undeclared (first use in this function) 
```

主要问题似乎是之前的解析错误`char`（其他相关）

```
44  char newDir[50] = ""; 
54  char* oldDir = (char*)get_current_dir_name(); 
```

这些只是简单的 C 风格的字符串声明。是否需要包含一个头文件才能使其在 UNIX 中工作？

PS查看什么版本的unix和你使用的gcc版本的命令是什么？知道这一点将使我的问题更具体。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T20:31:39.813

如果您正在编译纯 C，则必须在函数的开头声明变量。我提到这一点是因为大多数人使用 C++ 编译器编译他们的 C 程序，它提供了一些纯 C 编译器通常不可用的资源，最常见的例子是 // 注释行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T20:38:17.910

如果您想确保您的代码是可移植的，请始终使用 -pedantic 或 -pedantic-errors。

这将在您的代码偏离标准合规性时提供警告/错误。

当我们谈到这个主题时。您可能还应该打开所有警告。编译器警告您有充分的理由；当将代码从一个平台移动到另一个平台时，这些警告是潜在错误的来源，因为新硬件/操作系统/编译器的行为可能与您当前的不同。

还要使用正确的 GCC 前端可执行文件： g++ 将把 *.c 文件视为 C++ 文件，除非你明确告诉它不要。因此，如果您正在编译真正的 C，则使用 gcc 而不是 g++。

> gcc -pedantic -Wall -Werror *.c
> g++ -pedantic -Wall -Werror *.cpp

为了帮助解决您的具体问题，可能会很高兴看到第 43 行。虽然错误说第 44 行，但很多问题是由于前面的行有问题并且解析器没有检测到问题，直到您到达第一个词位在下一行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T20:34:22.413

你是怎么把文件复制过来的？是否有可能您插入了不应该存在的东西？

顺便说一句：请修正您在代码中对代码标签的使用 - 目前几乎不可能在我的浏览器中不使用“查看源代码”来阅读。

至于你结束的问题：

```
uname -a
gcc -v 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T21:41:17.027

在尝试编写可移植代码时，以下编译器标志会在您尝试在下一个平台上编译代码*之前告诉您很多问题：*

```
-std=c89 -pedantic -Wall 
```

如果您只需要在其他平台上定位 GCC，而不是任何其他编译器，那么您可以尝试：

```
-std=gnu89 -pedantic -Wall 
```

但我猜这可能允许在较旧的 GCC 上不支持的较新 GCC 上的 GNU 扩展。我不知道。

请注意，尽管 -pedantic 可以保证对所有非标准程序发出警告会很好，但事实并非如此。它仍然遗漏了一些东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T02:28:32.500

您将不得不为我们提供更多有关错误的上下文...至少一个，可能在第 44 行和第 54 行之前的几行。猜测一下，如果您在第 44 行之前给我们函数定义开头的代码（也许第 40 行左右）到第 54 行（或几行之后 - 可能是第 60 行 - 然后我们可能会提供帮助。第 44 行之前的信息出现了问题，导致它在第 44 行；第 54 行同上（可能是同样的问题）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T05:38:03.777

信息不足。上面的代码至少同样有趣，并且必须知道是否有人谈论 ANSI C89 或 ANSI C99。从广义上讲，第一个答案是错误的。

问候弗里德里希

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-01T20:11:05.830

史蒂夫，

第一条错误消息显示“ ”。char*前面*的代码是什么？是函数声明吗？它是否包括任何用户定义的类型或任何类型的东西？`parse error` **`before`** `'char'`

 *此错误最可能的来源是第 44 行*上方*的某些内容使用了在头文件中声明的类型或宏……该头文件在您自己的 Ubuntu 系统和您尝试编译的系统之间可能有所不同。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T20:33:27.500

它是什么 UNIX？AIX、Ultrix、Minix、Xenix？

GCC 有一个“--version”标志：

```
gcc --version 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T20:33:32.883

要显示 GCC 版本：

```
gcc --版本
```

显示函数可能会有所帮助，以便我们可以看到周围的代码。这通常是“解析错误之前”类型错误的问题。

# sql - 如何修复导致包在生产中失败的连接管理器错误？

> ID：154920
> 
> 赞同：1
> 
> 时间：2008-09-30T20:30:28.990
> 
> 标签：sql, sql-server, ssis

我创建了一个 SSIS 包，它在我的开发机器上运行良好。但是，当我尝试在生产服务器上运行它时，它会出错。

这是错误：

```
Error: The AcquireConection method call to the connection manager 
"DestinationConnectionOLEDB" failed with error code 0xC0202009. 
```

我已经找出原因，但不知道如何解决它。密码不在连接字符串中。但是我已经在 SSIS 项目中设置了密码。但是由于某种原因，当我在生产服务器上部署和运行它时，它不会运行，因为密码不是连接字符串的一部分。

我需要更改 SSIS 项目中的某些设置以使其正常工作吗？

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T20:33:10.497

通过将包属性中的 ProtectionLevel 设置为 DontSaveSensitive 来禁用密码。

我还建议将连接字符串移动到包变量并在连接上创建表达式。启用包配置。

然后，您可以在不更改包的情况下自由更改连接并使用或不使用集成安全性。您可以将连接字符串放在配置中，也可以在命令行中提供。

# ruby-on-rails - Apache/Rails/Passenger 显示站点索引？

> ID：154959
> 
> 赞同：6
> 
> 时间：2008-09-30T20:35:59.070
> 
> 标签：ruby-on-rails, ubuntu, apache2, passenger

我有一个使用 Mongrel 和 Webkit 成功测试的 Rails 应用程序。现在我想测试部署。我使用 Ubuntu 8.04 设置了 VMWare 映像。我已经按照这种方法[https://help.ubuntu.com/community/RubyOnRails](https://help.ubuntu.com/community/RubyOnRails)安装了 Rails ，但使用 Gems 1.3 而不是 1.2 除外。我已经配置并安装了Passenger。但是，当我访问我的站点索引（[http://some.ip.that.i'm.testing/](http://some.ip.that.i)）时，我只需获取我的 rails 站点的目录索引。我应该注意，因为我正在测试，所以我只是将我的应用程序转储到 /var/www 中。

我的 Apache2 error.log 文件仅显示此内容：

> [2008 年 9 月 30 日星期二 15:10:41] [通知] Apache/2.2.8 (Ubuntu) Phusion_Passenger/2.0.3 已配置 -- 恢复正常操作

知道什么可能导致这个问题吗？似乎Passenger配置正确，但我不确定为什么我的rails应用程序没有显示以及为什么网站的目录列表是。

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T23:59:49.517

两个问题：

1) Rails 是否在服务器上运行？乘客应该在第一次请求时自动启动 Rails - 如果你执行 ps，你看到它在运行吗？

2）您看到的是哪个目录 - 是您的 rails 目录还是 public/ 目录？如果是前者，则您的符号链接可能指向错误的位置（它应该转到 public/）。

（我以前见过这个问题，并试图记住我是如何调试它的......这是我的前两个想法。）

# database - 如何避免向表中添加时间戳字段？

> ID：154964
> 
> 赞同：14
> 
> 时间：2008-09-30T20:37:17.103
> 
> 标签：database, timestamp

我对我们在许多解决方案中看到的每条记录的两个附加列（timeCreated、timeLastUpdated）有疑问。我的问题：有更好的选择吗？

场景：您有一个巨大的数据库（就表而言，而不是记录而言），然后客户来要求您为 80% 的表添加“时间戳”。

我相信这可以通过使用单独的表（TIMESTAMPS）来完成。除了明显的时间戳列之外，该表还具有正在更新的表的表名和主键。（我在这里假设您使用 int 作为大多数表的主键，但表名很可能必须是字符串）。

为了描绘这个假设这个基本场景。我们将有两个表：

付款：-（您通常的记录）
TIMESTAMP：- {当前时间戳} + { `TABLE_UPDATED`, `id_of_entry_updated`, `timestamp_type`}

请注意，在此设计中，您不需要本机支付对象中的这两个“额外”列（顺便说一下，这可能会通过您的 ORM 解决方案实现），因为您现在正在通过`TABLE_UPDATED`and进行索引`id_of_entry_updated`。此外，`timestamp_type`它会告诉您条目是否用于插入（例如“1”）、更新（例如“2”）以及您可能想要添加的任何其他内容，例如“删除”。

我想知道你对这个设计有什么看法。我对最佳实践最感兴趣，什么随着时间的推移有效和扩展。参考、链接、博客条目非常受欢迎。我知道至少有一项专利（待批）试图解决这个问题，但目前似乎细节尚未公开。

干杯，爱德华多

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-30T20:41:50.523

当您使用它时，还要记录进行更改的用户。

分离表设计的缺陷（除了其他人强调的连接性能）是它假设*每个*表都有一个标识列作为键。这并不总是正确的。

如果您使用 SQL Server，新的 2008 版本支持他们称之为的东西，`[Change Data Capture](http://msdn.microsoft.com/en-us/library/bb522489.aspx)`这应该可以消除您所说的很多痛苦。我认为甲骨文可能也有类似的东西。

* * *

更新：显然 Oracle 将其称为与 SQL Server 相同的东西。或者更确切地说，SQL Server 将其称为与 Oracle 相同的东西，因为 Oracle 的实现首先出现；)
[http://www.oracle.com/technology/oramag/oracle/03-nov/o63tech_bi.html](http://www.oracle.com/technology/oramag/oracle/03-nov/o63tech_bi.html)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-30T20:45:02.450

我使用了一种设计，每个要审计的表都有两个表：

```
create table NAME (
  name_id int,
  first_name varchar
  last_name varchar
  -- any other table/column constraints
)

create table NAME_AUDIT (
  name_audit_id int
  name_id int
  first_name varchar
  last_name varchar
  update_type char(1) -- 'U', 'D', 'C'
  update_date datetime
  -- no table constraints really, outside of name_audit_id as PK
) 
```

`NAME_AUDIT`每次执行任何操作时都会创建一个数据库触发器来填充`NAME`。这样，您就可以记录对表所做的每一次更改以及何时更改。应用程序对此没有真正的了解，因为它是由数据库触发器维护的。

它工作得相当好，并且不需要对应用程序代码进行任何更改即可实现。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-30T20:41:39.087

我想我更喜欢将时间戳添加到各个表中。在复合键上加入时间戳表（其中一个是字符串）会更慢，如果您有大量数据，最终将成为一个真正的问题。

此外，很多时候，当您查看时间戳时，是在您调试应用程序中的问题时，您会希望数据就在此处，而不是总是必须连接到另一个表。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T22:32:50.687

您的设计的一个噩梦是每次插入、更新或删除都必须命中该表。这可能会导致主要的性能和锁定问题。概括这样的表（不仅仅是时间戳）是一个坏主意。从中获取数据也将是一场噩梦。

如果您的代码会因添加您不希望用户看到的字段而在 GUI 级别中断，则您错误地将代码写入您的 GUI，它应该只指定您需要的最小列数，并且永远不要选择 *.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T20:40:29.420

您建议的方法的优点是它使您可以选择将其他字段添加到您的 TIMESTAMP 表中，例如跟踪进行更改的用户。您还可以跟踪对敏感字段的编辑，例如谁为该合同重新定价？

在单独的文件中记录记录更改意味着您可以显示对记录的多项更改，例如：

mm/dd/yy hh:mm:ss 由 XXX 添加 mm/dd/yy hh:mm:ss 字段 PRICE 由 XXX 更改，mm/dd/yy hh:mm:ss 记录由 XXX 删除

一个缺点是将执行插入到您的 TIMESTAMPS 表中以反映主表中的更改的额外代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T20:43:28.677

如果您设置时间戳的东西来运行触发器，那么可以记录任何可以触发触发器（读取？）的操作。也可能有一些锁定优势。

（对所有这些都持保留态度，我不是 DBA 或 SQL 大师）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T20:45:13.073

是的，我喜欢这种设计，并将其与某些系统一起使用。通常，一些变体：

```
LogID  int
Action varchar(1)     -- ADDED (A)/UPDATED (U)/DELETED (D)
UserID varchar(20)    -- UserID of culprit :)
Timestamp datetime    -- Date/Time
TableName varchar(50) -- Table Name or Stored Procedure ran
UniqueID int          -- Unique ID of record acted upon
Notes varchar(1000)   -- Other notes Stored Procedure or Application may provide 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T20:41:45.843

我认为您必须执行的额外连接才能获得时间戳，这将是轻微的性能损失和颈部疼痛。除此之外，我认为没有问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T20:48:29.197

我们做了你所做的。它非常适合对象模型，并且能够以最少的代码向我们的模型添加新的图章和不同类型的图章。我们也在跟踪做出改变的用户，我们的很多逻辑都很大程度上基于这些标记。它醒得很好。

一个缺点是报告和/或在屏幕上显示许多不同的标记。如果您按照我们的方式进行操作，则会导致很多连接。此外，后端更改是一种痛苦。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-02T20:42:28.587

除了我们的“会话”表之外，我们的解决方案是维护一个“事务”表。UPDATE、INSERT 和 DELETE 指令都通过“事务”对象进行管理，一旦在数据库上成功执行，这些 SQL 指令中的每一个都将存储在“事务”表中。这个“Transaction”表还有transactiontType（I代表INSERT，D代表DELETE，U代表UPDATE）、transactionDateTime等字段，还有一个外键“sessionId”，最后告诉我们是谁发出了指令。甚至可以通过一些代码来确定谁在何时做了什么（Gus 在星期一创建了记录，Tim 在星期二更改了单价，Liz 在星期四添加了额外的折扣，等等）。

此解决方案的优点是：

1.  您可以说出“谁和什么时候”，并将其展示给您的用户！（您需要一些代码来分析 SQL 语句）
2.  如果你的数据被复制了，并且复制失败了，你可以通过这个表重建你的数据库

缺点是

1.  每月 100 000 次数据更新意味着 Tbl_Transaction 中有 100 000 条记录
2.  最后，该表往往占数据库容量的 99%

我们的选择：每天早上自动删除所有超过90天的记录

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-12-09T18:44:30.917

菲利普，

不要简单地删除那些超过 90 天的，首先将它们移动到单独的数据库或将它们写入文本文件，做一些事情来保存它们，只需将它们移出主生产数据库。

如果归根结底，通常是“拥有最多文档的人获胜”！

# .net - 以编程方式读取 .resx 文件

> ID：154993
> 
> 赞同：2
> 
> 时间：2008-09-30T20:41:34.423
> 
> 标签：.net, .net-2.0, resource-files

我有一个应用程序，其中发送的电子邮件内容存储在 .resx 文件中。
这是一个 ASP.Net 应用程序，.resx 文件位于 /App_GlobalResources

当我需要发送电子邮件时，我正在使用：

```
 HttpContext.GetGlobalResourceObject("MailContents", "EmailID").ToString 
```

现在，我需要使用来自另一个项目（不是网站）的相同邮寄方式。邮寄方法位于解决方案中所有项目共享的 DLL 中。

在另一个项目中，我显然没有 HttpContext。

我如何阅读这些资源？

我目前的方法是，在 Mailing 类中，检查 HttpContext.Current 是否为空，如果是，则使用单独的方法。
我现在正在研究的单独方法（在承认没有更好的事实之后）是将网站的 .resx 文件的路径存储在 app.config 文件中，并以某种方式读取该文件。
我开始尝试使用 System.Resources.ResourceReader，但它看起来需要一个 .resources 文件，而不是 .resx 文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T20:49:48.477

我想我回答了我自己的问题......
有一个 ResXResourceReader 类。我找不到它，因为它位于 Windows 窗体命名空间中，而我当前的 DLL 引用中不包含该命名空间。

不幸的是，这只会让我遍历结果，所以我会在它上面实现一些可爱的缓存（阅读：记忆）......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-10T06:20:01.647

> 邮寄方法位于解决方案中所有项目共享的 DLL 中。
> 
> 在另一个项目中，我显然没有 HttpContext。

是的你是。只要类库引用 System.Web，从网站调用的任何 dll 中都可以使用 HttpContext。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-30T20:47:21.697

您的资源放置有问题。

您的资源属于网站，应通过参数发送到邮件方法。

或者，您的资源属于邮件 API dll，应该保留在那里（.dll 项目也可以有 .resx 文件）。那么邮件方法在查找资源时应该没有问题，特别是如果您将其嵌入到 dll 本身中。

# iphone - 为智能手机开发网页的初学者帮助

> ID：154998
> 
> 赞同：0
> 
> 时间：2008-09-30T20:42:04.157
> 
> 标签：iphone, html, blackberry

我刚刚开始创作用于“智能手机”的网页。我需要针对 Blackberry、WinCE、iPhone 等。对于具有丰富 Web 和软件开发经验但没有为这些设备开发 UI 经验的人，您会推荐哪些资源或书籍？您会推荐哪些仿真套件，它们代表真实事物的准确度如何？

编辑：澄清一下，我在 ASP.Net 中构建了一个 Web 应用程序。我希望应用程序中可用功能的有限子集可用于移动设备。我正在编写一组单独的页面来完成此操作。我从两个简单的功能块开始。在未来，我相信我可能会收到需要移植更多功能的要求。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T12:19:55.603

查看[**WURFL - 无线通用资源文件**](http://wurfl.sourceforge.net/index.php)

> WURFL 是一个 XML 配置文件，其中包含有关许多移动设备的功能和特性的信息。
> 
> 该文件的主要范围是尽可能多地收集有关访问 WAP 页面的所有现有移动设备的信息，以便开发人员能够为用户构建更好的应用程序和更好的服务

另请查看[**无线常见问题解答**](http://www.thewirelessfaq.com/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T20:44:31.140

告诉我们您正在使用/知道的语言将非常有帮助。

从模拟器的角度来看，那里有很好的，但老实说，没有什么比拥有实际设备更好的了，是的，它很贵，但移动设备上的用户体验与任何模拟器所能说明的大不相同。如果您对此很认真，请购买一两个设备进行测试！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T20:45:41.357

可以在 Apple 的[iPhone 开发中心找到有关为 iPhone 开发网页的文档](http://developer.apple.com/iphone/)

您可以使用 iPhone 模拟器测试您的网站，以了解它在实际 iPhone 上的外观。注意：您需要一台 Mac 才能运行 iPhone 模拟器。

如果你是认真的，你真的需要在实际设备上进行测试。********~~*************