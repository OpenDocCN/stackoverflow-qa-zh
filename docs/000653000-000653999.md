# StackOverflow 问答 000653000-000653999

# c# - 在 C# 中，有没有办法始终如一地获取当前聚焦窗口的选定文本内容？

> ID：653003
> 
> 赞同：3
> 
> 时间：2009-03-17T04:10:04.050
> 
> 标签：c#, .net, winforms, winapi

在我的 c# .Net 应用程序中，我一直在尝试能够在当前聚焦的窗口中检索当前选定的文本。（注意它可以是windows中打开的任何窗口，比如word、safari）。

我能够检索到当前焦点控件的句柄。（对 user32.dll 和 kernel32.dll 使用几个互操作调用）。

但是，我一直无法始终能够取回选定的文本。

我试过使用 SENDMESSAGE 和 GET_TEXT。然而，这似乎只适用于某些应用程序（适用于简单的应用程序，如写字板，不适用于更复杂的应用程序，如 firefox 或 word）。

我试过使用 SENDMESSAGE 和 WM_COPY。但是，这似乎只适用于某些控件。（我认为 WM_COPY 会导致与手动按下 CTRL-C 完全相同的行为，但事实并非如此）。

我尝试使用 SENDMESSAGE 和 WM_KEYUP+WM_KEYDOWN 手动刺激复制命令。但这也不是一直有效。（可能与用户按下以调用我的应用程序的实际热键重叠）。

关于始终能够检索当前选定文本的任何想法？（在任何应用程序上）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-03-16T08:18:09.020

我通过结合几件事来完成这项工作。所以：

1.  等待当前按住的任何修饰符被释放。
2.  发送 control+c （使用这个答案[Trigger OS to copy (ctrl+c or Ctrl-x) programmatically](https://stackoverflow.com/questions/2886756/trigger-os-to-copy-ctrlc-or-ctrl-x-programicly)）

    ```
     bool stillHeld = true;
            int timeSlept = 0;

            do
            {
                // wait until our hotkey is released
                if ((Keyboard.Modifiers & ModifierKeys.Control) > 0 ||
                    (Keyboard.Modifiers & ModifierKeys.Alt) > 0 ||
                    (Keyboard.Modifiers & ModifierKeys.Shift) > 0)
                {
                    timeSlept += 50;
                    System.Threading.Thread.Sleep(timeSlept);
                }
                else
                {
                    stillHeld = false;
                }
            } while (stillHeld && timeSlept < 1000);

            Keyboard.SimulateKeyStroke('c', ctrl: true); 
    ```

我正在使用 WPF，所以 Keyboard.Modifiers 是 System.Windows.Input.Keyboard，而 Keyboard.SimulateKeyStroke 来自 Chris Schmick 的回答。

请注意，timeSlept 是我等待用户在继续其愉快的方式之前放开密钥的最长时间。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-18T22:56:02.957

我设法为写字板/记事本和任何支持 UI 自动化的东西获取了文本。

在某些情况下，下面的代码可能对您有用。我将开始使用 Reflector 来查看 windows 如何处理 TextBoxBase.SelectedText 属性中的文本框。

```
public static string SelectedText
{
    get
    {
        AutomationElement focusedElement = AutomationElement.FocusedElement;

        object currentPattern = null;

        if (focusedElement.TryGetCurrentPattern(TextPattern.Pattern, out currentPattern))
        {
            TextPattern textPattern = (TextPattern)currentPattern;
            TextPatternRange[] textPatternRanges = textPattern.GetSelection();
            if (textPatternRanges.Length > 0)
            {
                string textSelection = textPatternRanges[0].GetText(-1);
                return textSelection;
            }
        }
        return string.Empty;
    }
    set
    {
        AutomationElement focusedElement = AutomationElement.FocusedElement;
        IntPtr windowHandle = new IntPtr(focusedElement.Current.NativeWindowHandle);
        NativeMethods.SendMessage(windowHandle, NativeMethods.EM_REPLACESEL, true, value);
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T05:01:23.180

我可能误解了这个问题，但是您可以发送 Ctrl+c 吗？如果您知道窗口始终位于最前面并且选择了要复制的文本？

```
SendKeys.SendWait("^c"); 
```

复制到剪贴板后，以编程方式检索内容[并不](http://www.codeproject.com/KB/shell/clipboard01.aspx)难（您甚至可以在此时检查它实际上是文本）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T04:20:33.447

我不相信这是可能的，当前焦点可能不包含任何选定的文本。（它甚至可能根本不包含任何文本）。或者当前的选择可以是一个图标，或者一个图像。

也许要求用户首先将选定的文本复制到剪贴板可能是一种解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T21:24:59.347

嗯……你觉得这很容易吗？怎么来的？

SendKeys.SendWait("^c"); 的最佳替代品 我发现是这个：

[http://www.c-sharpcorner.com/Forums/ShowMessages.aspx?ThreadID=46203](http://www.c-sharpcorner.com/Forums/ShowMessages.aspx?ThreadID=46203)

但是，它仅适用于少数应用程序，例如记事本。对于网络浏览器，它只是崩溃。

有人有更好的吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T06:14:33.300

我认为创建剪贴板监视器是一个不错的选择。我建议您查看 Klipper（KDE 剪贴板模块），它复制了您在剪贴板列表中选择的所有内容，内容是文件、文件夹或一些文本。

更多细节可以在[这里](http://userbase.kde.org/Klipper)找到。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-31T18:54:51.400

在其他方法不起作用的控件上尝试[GetWindowText() API。](http://msdn.microsoft.com/en-us/library/ms633520%28VS.85%29.aspx)

# java - 这个场景适合 WeakReferences 吗？

> ID：653012
> 
> 赞同：1
> 
> 时间：2009-03-17T04:15:14.787
> 
> 标签：java, memory-management, java-me, memory-leaks, mobile

我正在通过 J2ME 查询地址簿并返回一个自定义的 Hashtable，我将其称为*pimList*。*pimList* {firstname, lastname}中的键映射到一个对象（我们称这个对象为*ContactInfo*）持有（键，值）对，例如 work1 -> 44232454545, home1 -> 44876887787

接下来我取*firstName*并将其添加到树中。树的节点包含来自*firstName*的字符。例如“Tom”将创建一个带有节点的树：

```
"T"->"o"->"m"-> ContactInfo{ "work1" -> "44232454545", "home1" -> "44876887787" } 
```

所以最后一个字符*m的子**元素指向 pimList*中的同一个对象实例。据我了解，WeakReferences 的目的是它的指针很弱，并且它指向的对象可以很容易地被 GC'ed。在像手机这样的内存限制设备中，我想确保我不会泄漏或浪费内存。因此，我是否适合做：

1.  *pimList*的值是 WeakReference
2.  节点“m”的子节点指向 WeakReference

?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T04:24:51.830

它应该工作。您将需要处理使用返回的 Hashtable 并且收集项目的情况......这可能意味着您想要重新考虑整个事情。

如果 Hashtable 是短暂的，那么可能不需要弱引用。

如果您希望在 Hashtable 的其余部分仍在使用时清理它们，则可以在完成后将它们从 Hashtable 中删除。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T08:24:51.397

不确定我是否完全理解您尝试执行的操作，但对象的可达性取决于对其的最强引用（硬引用比软引用强，软引用强于弱引用，弱引用强于幻像引用）。

硬引用的对象不会被垃圾收集。软引用对象只有在 JVM 内存不足的情况下才会被垃圾回收，弱引用对象会尽快被垃圾回收（这是理论上它取决于 JVM 和 GC 实现）。

所以通常你使用软引用来构建缓存（你希望尽可能长时间地引用信息）。您使用弱引用将信息关联到在某处硬引用的对象，因此如果不再引用硬引用的对象，则可以对关联的信息进行垃圾收集 - 为此使用弱哈希图。

希望这可以帮助...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T04:41:49.123

我不确定 WeakMap 在这里是否正确。如果您在应用程序的任何地方都没有持有强引用，则地图中的数据将几乎立即消失，因为没有人引用它。

弱地图是一件好事，如果您想再次找到仍在其他地方使用的东西，并且您只想拥有它的一个实例。

但老实说，我可能无法正确设置您的数据。

# xml - 如何检查 XML 文件中是否存在节点？

> ID：653014
> 
> 赞同：2
> 
> 时间：2009-03-17T04:16:56.267
> 
> 标签：xml

如何检查 XML 文件中是否存在节点，并计算节点数？

我有一个 XML 文件作为示例：

```
 <Employee>
  <Emp>
    <Name id="1">   A     </Name>
    <Name id="2">   C     </Name>
    <Name id="3">   D     </Name>
   </Emp>
  </Employee> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T05:01:21.337

在 c# 中使用 linq 2 xml：

```
var employee = XElement.Load(someStream);
var emp = employee.Element("Emp");
if( emp != null )
{
   int count = emp.Elements("Name").Count();
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T15:27:20.740

我假设您正在使用 XSL 来转换此文档，那么我会假设变量会提供最佳功能。你会用这个：

```
<xsl:variable name="Name_Count" select="count(//Name)"/> 
```

这将为您提供节点的数量，`Name`您可以将其更改为您想要的任何内容。显然，如果它为零，那么就没有，否则就是计数。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-12-18T10:11:28.710

```
XmlDocument _xmlDoc = new XmlDocument();

_xmlDoc.Load(Server.MapPath("~/XMLFile.xml"));

XmlNode _node = _xmlDoc.SelectSingleNode("Employee/Emp");

if (_node != null)

{

    XmlNodeList _nodeList = _node.SelectNodes("Name");

    Response.Write(_nodeList.Count);
}

else

{

    Response.Write("Emp node doesnot exist");

} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T06:36:50.890

如果您使用 Java 编程，则应该查看两个相关的库。

JDOM - [http://www.jdom.org/](http://www.jdom.org/) DOM4J - [http://www.dom4j.org/](http://www.dom4j.org/)

我现在看一下 Dom4j 2.0，因为它支持泛型、XPath，并且现在有一些更好的高级支持。我认为 Dom4j 是从早期的 jdom 中分叉出来的。

在这两种方法中，您都可以从文件、URL、字符串等中读取 XML，解析它并仅用几行代码检查节点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T20:04:04.553

LINQ 很棒。但万一您被困在 .NET 2.x 的系统上，您可能必须以“旧”（XPath）方式（其中 xmlFragment 是您上面的 XML 字符串）：

```
XPathDocument doc = new XPathDocument(new StringReader(xmlFragment));
XPathNavigator n = doc.CreateNavigator().SelectSingleNode("//Name[@id='4']");
if(n==null){//Node does not exist} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T17:37:29.673

```
int nNodeExistCount = xmlOuput.GetElementsByTagName("NodeName").Count;

if (nNodeExistCount>0)
{
    Response.write(" The NodeName exists!");
}
else
{
    Response.write(" The NodeName does not exist!");
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-05-07T09:45:03.787

如果您正在使用 XSLT 转换，请尝试以下操作：

> <xsl:选择>
> 
> <xsl:when test="//Employee/Emp">
> 
> < -- 节点存在-->
> 
> < /xsl:何时>
> 
> <xsl:否则>
> 
> < --节点不存在-->
> 
> < /xsl:否则>
> 
> < /xsl:选择>

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T04:41:23.303

作为 XPath 的替代方案，许多支持 XML DOM 的语言将允许您在 XML 文档上调用方法，例如：

```
GetAllNodesWithTagName(string tagname); 
```

您查看它是否存在的代码看起来像这样（用伪代码编写）：

```
int num_nodes = 0;
string node_name = "Name"; // want to find all of the <Name> tags
XMLNode [] nodes = GetNodesWithTagName(node_name);
num_nodes = nodes.Length; 
```

XPath 很好，但它更适合以有趣和复杂的方式轻松导航 XML 文档。此代码将比相应的 XPath 代码更简单一些。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-17T05:16:55.200

`getElementsByTagName["tagname"]`也是一种 DOM 方法，可用于获取节点。如果节点不匹配，则返回 null 的方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-17T04:33:43.837

这里至少有 4 个节点，假设您`</Emp>`的开始`<Emp>`标签匹配： `<Emp>`, `<Name>`, `ID`，并且字符串`" D "`都将表示为节点。从您的问题中不清楚您是否真的要计算**所有**这些。我也不确定您是否要确定其中一个特定的存在。

不过，最终，XPath 可能正是您要寻找的。

# perl - 如何登录 FTP 站点并删除超过 7 天的文件？

> ID：653022
> 
> 赞同：-1
> 
> 时间：2009-03-17T04:27:18.987
> 
> 标签：perl, ftp

我需要一个 shell 或 Perl 脚本来连接到 FTP 服务器并删除所有超过 7 天的文件。

干杯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T05:15:32.880

如 CPAN 文档中所述，使用[Net::FTP](http://search.cpan.org/~gbarr/libnet-1.22/Net/FTP.pm)模块连接到 ftp 服务器。要浏览站点列表，您可能必须结合**cwd** / **cdup**来处理目录（当然，除非所有文件都在根目录中）。

要获取文件的修改时间，请使用**mdtm(FILE)**方法，只需确保通过调用检查当前服务器是否支持此功能

```
if( $ftp->feature( 'MDTM' ) ) {
   ...check modification time for file...
} 
```

如果没有，那么您可以尝试调用 ' **dir** ' 方法，该方法将为您获取长格式的列表，然后从各个文件列表中提取日期信息以便比较和删除。

要比较两个日期，请使用[Date::Calc](http://search.cpan.org/~stbey/Date-Calc-5.4/Calc.pod)模块。' **Delta_Days** ' 方法应该给你两个日期之间的天数；这可以很容易地用于上面指定的任何一种方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T04:52:56.507

在 Perl 中，您需要使用[Net::FTP](http://search.cpan.org/perldoc?Net::FTP)的 ls、mdtm 和 delete 命令。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T06:03:18.817

如果它是你所追求的 shell 脚本，你最好在 crontab 中运行一个脚本。

`find /tmp -type f -mtime +7 -exec rm {} \;`

# java - 想法：在 Java 中嵌入数据/DSLs 作为注释并使用 APT 生成 Java 代码

> ID：653030
> 
> 赞同：2
> 
> 时间：2009-03-17T04:33:15.710
> 
> 标签：java, dsl

我有一个想法，我想由你运行它以获得一些反馈。请仔细阅读以下内容，让我知道您的想法，无论是积极的还是消极的。

我一直希望有一种方法可以在 Java 代码中嵌入某些数据，而不必一直遵循 Java 的规则。我最近听到了很多关于领域特定语言 (DSL) 的讨论，如果我们能够每天更多地使用它们会是多么棒。我想我知道如何以一种相当优雅的方式做到这一点。

以下是我所知道的一些事情的例子，这些事情很难用 Java 代码（和其他类似 C 的语言）来表示，我希望它能够解决：

作为字符串数组的短字符串列表

```
String[] ar = { "Item1", "Item2", "Item3", "Item4" }; 
```

长字符串列表作为字符串数组

```
String[] ar = { "The quick brown\n fox jumped over\n the lazy dog.",
"The quick brown\n fox jumped over\n the lazy dog.",
"The quick brown\n fox jumped over\n the lazy dog.",
"The quick brown\n fox jumped over\n the lazy dog.",  }; 
```

字符串表作为多维字符串数组：

```
String[][] ar = { { "InvoiceID", "Date", "SubTotal", "Tax", "Total" },
{ "1", "1/2/2009", "300, "21", "321" },
{ "2", "1/4/2008", "100", "7", "107" },
{ "3", "1/6/2008", "200", "14", "214" } }; 
```

键值对列表

```
Map states = new HashMap();
states.add("FL", "Florida");
states.add("OH", "Ohio");
states.add("GA", "Georgia");
states.add("NY", "New York");
states.add("SC", "South Carolina"); 
```

HTML 代码单字符串

```
String html = "<a href=\"www.somesite.com\">Some site</a>"; 
```

具有良好文本格式的 HTML 文本块

```
String html = "Hi, John,\r\n<br>\r\n<br>Thank you for writing to us. We do not currently carry that specific product.\r\n<br>\r\n<br>Regards,\r\n<br>"; 
```

我对以下描述的解决方案进行了一些调查，我相信可以创建一个可用的库，让您可以优雅地实现这一目标。在 Java 5 和 6 中，有一个叫做注解处理器工具 (APT) 的东西（与 Debian APT 不同）。您创建自己的源代码处理器，在编译代码时将调用该处理器，以便您有机会重写源代码。重写代码后，它像往常一样编译。

要使用 APT，必须执行以下操作： 1\. 将此库的 jar 放在 ANT 类路径中。2\. 把这个库的jar 放到项目的classpath 上。3.调用apt任务而不是javac并添加preprocessdir参数指定生成的文件必须放在哪里。

DSL 代码可以放在将放置代码结果的变量之后的注释中。当处理器运行时，它可以在代码中查找下一条注释，提取代码，通过处理器运行，生成代码并进行编译。

这是列表，这次是它的样子：

作为字符串数组的短字符串列表

```
@DslTextArray
String[] ar = null; /* Item1, Item2, Item3, Item4 */ 
```

长字符串列表作为字符串数组

```
@DslMultilineTextArray
String[] ar = null;
/*
The quick brown
fox jumped over
the lazy dog.

The quick brown
fox jumped over
the lazy dog.

The quick brown
fox jumped over
the lazy dog.

The quick brown
fox jumped over
the lazy dog.
*/ 
```

字符串表作为多维字符串数组或 JTable：

```
@DslTextTable
String[][] ar = null;
/*
InvoiceID,Date,SubTotal,Tax,Total
1,1/2/2009,300,21,321
2,1/4/2008,100,7,107
3,1/6/2008,200,14,214
*/ 
```

键值对列表

```
@DslMap
Map states = null; /* FL=Florida, OH=Ohio, GA=Georgia, NY=New York, SC=South Carolina */
// Could also put each pair on a new line 
```

HTML 代码单字符串

```
@DslText
String html = null; /* <a href="www.somesite.com">Some site</a> */ 
```

具有良好文本格式的 HTML 文本块

```
@DslText
String html = null;
/*
Hi, John,

Thank you for writing to us. We do not currently carry that specific product.

Regards,
Mike
*/ 
```

我可以为此解决方案想到的一些要求/功能：

您必须声明该变量以保存脚本将在 Java 源代码中生成的数据。这允许其余的源代码知道结果数据，即使编译器不知道它来自哪里。

*   不得违反 Java 语言，以便 IDE 和 javac 不显示错误。
*   使用您拥有的所有现有 Java 代码。无需替换任何现有代码。只需将这些片段添加到您喜欢的任何地方。
*   必须易于使用其他类型进行扩展。
*   以后必须能够对允许源代码突出显示和自动完成的 IDE 进行扩展。
*   翻译发生在编译时，因此必须生成有效的 Java 代码。
*   将列表、多行文本块（如 CSS、SQL）转换为 String 和 String[]
*   转换和编码 XML、HTML
*   重写代码时保留相同的行号。不要添加任何行，以免调试和读取错误成为痛苦。
*   在运行时运行以任何 BSF 语言编写的代码。允许它向脚本传递任何参数并将任何 Java 类或原语返回给 Java。
*   在编译时运行以任何 BSF 语言编写的代码以生成 Java 源代码。类似于在 Linux 上使用 M4 的方式。
*   稍后：允许您将多次调用的字符串结果链接在一起，以构建一个长字符串。有些可能是编译时的，有些可能是运行时的。

再一次，我真的很感激能得到一些反馈。这是一个愚蠢的想法吗？那里已经有类似的东西了吗？你会打扰使用这样的东西还是我应该把它留给自己？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-02-08T01:55:11.210

我现在会使用 google collections api，它是 guava 库[http://code.google.com/p/guava-libraries/](http://code.google.com/p/guava-libraries/)的一部分，它有很棒的列表和地图支持。它支持您尝试实现的那种构造

```
public static final ImmutableList<Color> GOOGLE_COLORS
   = new ImmutableList.Builder<Color>()
       .addAll(WEBSAFE_COLORS)
       .add(new Color(0, 191, 255))
       .build(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T07:07:43.407

这肯定是可行的，但我必须说我不太喜欢它。

它使数据结构的初始化更加容易，

但

*   我极少需要使用编译时常量来初始化这样的数据结构。所以类/java文件旁边的单独文件会更有用

*   这对开发人员来说根本不透明。没有人期望评论会转化为数据。实际上，如果遇到这样的评论，我可能会认为它评论了旧代码并立即将其删除

*   ATP 是一个强大而有趣的工具，但缺乏 IDE 集成。因此，您必须始终使用 ANT 构建和运行您的应用程序，这不如 hitten F11 或您的 IDE 为此目的提供的任何快捷方式好和快

所以基本上你在开发基础设施的复杂性上受到了巨大的打击，而打字速度的提升却很小。

这个想法仍然很有趣。我实际上会理解一种变体，其中可以定义“DSL”类型的注释，允许以注释声明定义的任意语言将代码放入该注释中。当然，这将是一个重大的语言变化，不会很快发生，而且可能根本不会发生。

# objective-c - 用 NSMutableString AppendString 连接 NSArray 内容

> ID：653035
> 
> 赞同：1
> 
> 时间：2009-03-17T04:36:38.637
> 
> 标签：objective-c, iphone, string-concatenation

当我尝试将位置 i 的数组内容连接到我的 NSMutableString 实例时，我正在尝试遍历 NSArray 并不断收到编译器错误。

它只是告诉我“之前有语法错误；” 这并没有告诉我很多。在这一行：

```
 [output appendString:[widget.children objectAtIndex:i]; 
```

我知道我的语法一定有问题..

我的功能如下

```
- (NSString *)readArray
{
    NSMutableString *output = [[NSMutableString alloc] init];
    int i;
    int arraySize = widget.children.count;
    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
    for (i = 0; i < arraySize; i++)
    {
        [output appendString:[widget.children objectAtIndex:i];  (throws error here)
    }
    [pool release];
    return output;

} 
```

提前致谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-17T06:09:37.400

`NSArray`有一种方法可以完全按照您正在做的事情：

```
- (NSString *)readArray {
    return [widget.children componentsJoinedByString:@""];
} 
```

此外，除非您在紧密循环中相当频繁地调用该函数，否则让它创建自己的自动释放池并没有太大优势。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T04:46:49.640

你最后需要一个未闭合的括号`]]`，而不是`]`

# windows - 如何通过免费演示制作共享软件程序

> ID：653046
> 
> 赞同：-1
> 
> 时间：2009-03-17T04:46:01.187
> 
> 标签：windows, demo, shareware

我有一个我想用以下系统销售的游戏：赠送一个演示（比如，前几个级别）并销售完整版。我想让用户尽可能无缝地过渡到完整版本。我以前从来没有在网上卖过任何东西，所以我不确定它是如何工作的（即使没有免费的演示）。

这似乎是一个非常普遍的问题，所以我想有一个标准的解决方案。我正在用 C++ 编写，面向 Windows，我的安装程序是由 NSIS 生成的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-23T16:08:13.027

有两种选择：

1.  单独的演示版和完整版。您的电子商务提供商会将完整版本发送给购买它的人。
2.  通过注册密钥或在线激活过程解锁的演示。注册密钥可以即时生成（或从预先生成的列表中获取）。然后，电子商务提供商可以在购买后立即将密钥发送给客户。

两种方法都有其优点和缺点。

**单独的完整版**

*   更小的演示文件，节省带宽
*   购买完整版的客户所需的技术支持较少（根据我的经验）
*   两个版本的游戏，更多的测试
*   更难将更新版本分发给客户 - 需要为每个客户保留一个登录名或在几天后过期的秘密 URL。

**解锁演示**

*   包含所有资产，可能会浪费带宽
*   更容易分发破解版（盗版者可以分发一个10KB的补丁或注册密钥并链接到你的演示文件，更多的带宽浪费）
*   单一构建，更少的测试
*   易于分发更新版本（每个人都可以下载相同的公共版本）

关于“通用”解决方案，请四处寻找商业 DRM 包装器，例如[这个](http://www.plimus.com/marketing/Plimloc/about.html)。一些游戏门户/发行商还要求您使用他们自己的包装器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T05:13:08.157

不要将您的完整产品作为可以激活的演示来发布。这样你就不会消除盗版（这仍然是你必须处理的事情），但至少你消除了某人只是下载演示、破解它并传播它的可能性（甚至只是一个破解的可执行文件） . 他们至少必须先购买完整版。

至于检查合法客户是否正在使用该软件，您确实可以按照 Danny 的建议进行一些在线身份验证，但请注意，这只会阻止人们使用您的在线服务，而且合格的破解者/逆向者通常只是时间问题确保无需购买即可使用您产品的离线功能。

通过不立即发布完整的产品，确实会使升级变得更加困难，但有一些方法可以解决这个问题，例如：仅在在线身份验证后才能使用的更新程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T05:00:34.523

如果你开发得当，你应该能够在第 X 级之后有一个检查机制。这种检查机制基本上可以命中注册表项。此注册表项可能包含一些由您的程序生成的编码信息。密钥基本上可以表示已安装机器 MAC 地址、名字和姓氏等的 MD5 散列（或 SHA-1 或 SHA-2，如果您真的关心高安全性）。当有人购买游戏时，您让他们在表单中输入该数据，然后生成代码发送给用户以解锁游戏。您甚至可以采用相同的算法并将其放在您的 ASP.NET 网站上，并在购买后自动生成密钥。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-28T12:51:11.587

我的 2 美分：

不要花太多时间设计打击盗版的方法。使用简单的串行生成器机制来解锁游戏，用户可以在执行过程中手动进入。

我想说有一个可以根据输入的序列号切换到试用模式或完整的构建。这将减少维护两个单独代码的开销。

个人观点，不管有多少盗版，真正买软件的人都会买你的游戏。因此，使注册目的尽可能简单，这将阻止普通用户破解它，同时易于使用。无论您使用什么保护措施，黑客都会破解它。否则我们将不会看到微软/adobe 产品等的盗版副本，他们花费如此多的钱使他们的产品免于盗版。不管他们收取什么费用，人们都会购买。它的产品质量将鼓励您的用户购买您的产品。

此外，尽量不要对您的软件施加锁定，例如使用 MAC 地址等生成序列号等。在线激活可能是一个好主意，但请记住，人们对您在激活时尝试传输的信息持怀疑态度。此外，如果您的客户没有 Internet 连接或在单独的 LAN 中工作，您可能必须提供一种替代机制来进行离线激活。

一旦您看到您的游戏越来越受欢迎并且您看到更多的盗版副本与用户，您可能会投入更多的时间和金钱来开发反盗版技术。

# operating-system - systeminfo 命令是否适用于 Windows 2003？

> ID：653051
> 
> 赞同：1
> 
> 时间：2009-03-17T04:52:33.667
> 
> 标签：operating-system

windows2003及以上版本是否有通用命令可以给出系统信息？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T05:26:30.857

我在 windows xp,2003 和 vista 上使用过很多次，它工作正常

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T07:16:34.697

您还可以通过 WMI 调用编写“系统信息获取”脚本。

![WMI 调用](https://i.stack.imgur.com/9jvCc.jpg)

使用**[WMIC 代码创建](http://www.microsoft.com/downloads/details.aspx?FamilyID=2cc30a64-ea15-4661-8da4-55bbc145c30e&DisplayLang=en)**器和一个[小的 VB 脚本](http://www.c-sharpcorner.com/UploadFile/scottlysle/UsingWMI04052007222505PM/UsingWMI.aspx)，您可以精确地获得您想要/需要的信息，而不是静态`systeminfo`命令。

例如：

```
public string GetHardDisks() {
    ManagementObjectSearcher searcher = new
    ManagementObjectSearcher("root\\CIMV2", "SELECT * FROM Win32_LogicalDisk"); 
    StringBuilder sb = new StringBuilder(); 
    foreach (ManagementObject wmi in searcher.Get()) {
        try {
            sb.Append("Drive Device ID: " +
            wmi.GetPropertyValue("DeviceID").ToString() +Environment.NewLine);
            sb.Append("Caption: " + wmi.GetPropertyValue("Caption").ToString() + Environment.NewLine);
            sb.Append("Volume Serial Number: " + wmi.GetPropertyValue("VolumeSerialNumber").ToString()
            + Environment.NewLine);
            sb.Append("Free Space: " + wmi.GetPropertyValue("FreeSpace").ToString() + "
            bytes free" + Environment.NewLine + Environment.NewLine);
        }
        catch {
            return sb.ToString();
        }
    }
    return sb.ToString();
} 
```

# lotus-notes - 我们如何绕过 Lotus Notes 60 Gb 数据库障碍

> ID：653061
> 
> 赞同：4
> 
> 时间：2009-03-17T04:58:06.930
> 
> 标签：lotus-notes, lotus-domino

有没有办法绕过 Notes 数据库的数据库大小上限？我们正在压缩一个大小仍接近 60 gig 的数据库。如果您能提供建议，非常感谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-17T06:33:23.300

即使您能找到超过 64GB 限制的方法，它也不是推荐的解决方案。如果您希望提高性能并保持 Domino 服务器的稳定性，那么将应用程序拆分为多个数据库会好得多。如果您认为必须将所有内容都放在同一个数据库中才能进行搜索，请在 Domino Administrator 帮助中查找域搜索和多数据库搜索。

*   也许数据的某些部分是“旧的”并且可以被放入一个或多个存档数据库中？

*   也许您有很多大附件并且可以将它们存储在一系列附件数据库中？

*   也许您有很多可以简化或消除的复杂视图，从而节省大量空间并将所有内容暂时保存在同一个数据库中？（删除不需要的列的排序，使用“单击列标题进行排序”是增加视图索引大小的可靠方法。）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-11T19:58:44.167

我假设您的数据库也很大，因为文件附件也是如此。在这种情况下，请查看 DAOS - 它将所有文件附件存储在文件系统上（服务器功能 - 对客户端和现有应用程序透明）。

作为奖励，它会发现重复项并将它们仅存储一次。

更多信息：http: [//www.ibm.com/developerworks/lotus/library/domino-green/](http://www.ibm.com/developerworks/lotus/library/domino-green/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T05:59:04.757

只是在黑暗中刺伤：

使用 DB2 存储方法而不是 Domino 服务器？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-17T14:20:37.623

我猜这个空间的 80-90% 被文件附件占用了。我的建议是将所有附件移动到文件共享，前提是每个人都可以访问该共享，或者移动到每个人都可以连接到的 FTP 服务器。

这并不理想，因为安全成为一个问题——现在您需要管理 Notes 数据库和外部文件共享的凭据——但是从 Notes 管理员的角度来看，这是值得的。

在 Notes 文档中，只需提供该文件的链接即可。如果用户通过 Notes 表单添加这些文件，也许您可​​以添加一些背景代码以在文件保存后从文档中提取文件，并将其替换为指向该文件的链接。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-03-07T12:04:32.340

64GB 实际上并不是一个绝对限制，你可以超过这个限制，我见过 80GB 甚至接近 100Gb，尽管一旦你超过 64Gb，你随时可能会遇到问题。限制实际上不是 Notes，它是底层文件系统，我在 AS400 上看到过这一点，但 Notes 的好处在于，如果您确实遇到了巨大的崩溃，您仍然可以访问所有文档并将所有内容提取到新副本中使用即使您无法再在客户端中打开视图，也可以安排代理。

最好的办法是定期存档，如果是文件附件，那么两年以上的任何东西都不需要在主系统中，只需简要概要和链接，您甚至可以有 5 年存档、2 年存档 1 年存档等，数据将继续积累并且必须进行管理，无论您使用什么平台来存储它。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-19T17:48:36.937

如果问题确实是大文件附件，我当然会建议考虑在您的服务器/数据库上实现 DAOS。它仅适用于 Domino Server 8.5 和更高版本。另一方面，如果您的数据库包含超过 100,000 多个文档，您可能需要认真考虑将数据划分为多个 NSF - 在这样数量的文档中，您需要非常小心您的视图设计、查找代码等.

DAOS 的一些成功记录： [http ://www.edbrill.com/ebrill/edbrill.nsf/dx/yet-another-daos-success-story-from-darren-duke?opendocument&comments](http://www.edbrill.com/ebrill/edbrill.nsf/dx/yet-another-daos-success-story-from-darren-duke?opendocument&comments)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-27T05:05:30.930

如果您的数据库达到 60gb.. 不要使用 Domino 解决方案，您需要切换到关系数据库。您需要跨多个数据库存档或移动文档。虽然你可以达到 60GB，但你不应该这样做。对活动数据库的性能影响很大。对于静态数据库来说问题不大。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-09-10T14:53:51.500

我还会考虑删除任何不必要的视图及其索引。查看索引可以占用 80-90% 的磁盘空间。如果您无法删除它们，请简化它们的排序安排/公式并删除任何不必要的列排序选项。通过像这样的一些简单更改，我将 50gb 减半到 25gb，几乎没有用户注意到。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-08-19T15:39:23.243

一条路径可能是从用户开始。是否所有用户都需要一直访问所有这些数据？如果没有，是时候拆分或归档了。如果是，则应用程序的设计可能存在缺陷。

从技术上讲，我会在之前的评论中添加一个建议来检查[压缩的许多选项](http://www-01.ibm.com/support/docview.wss?uid=swg21084388)。快速而肮脏：丢弃所有视图索引，但如果您不希望用户骚乱，请确保至少重建默认视图的索引。见[更新](http://www.ibm.com/support/knowledgecenter/SSKTMJ_9.0.1/admin/admn_updalloptions_r.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-02-04T11:11:18.313

还有一件事要检查：确保您已检查

> [x] 对附件使用 LZ1 压缩

在数据库属性中。

# php - 使用纯 PHP/AJAX 上传进度？

> ID：653063
> 
> 赞同：8
> 
> 时间：2009-03-17T04:59:42.840
> 
> 标签：php, ajax, upload

我确定以前有人问过这个问题，但由于我似乎找不到一个好的答案，所以我在这里，再次问...... :)

有没有什么办法，只使用 HTML、JavaScript/AJAX 和 PHP 的混合来报告文件上传的实际进度？

回复任何建议 SWFUpload 或类似内容的人：

我知道这一切。走过那条路。我正在寻找一个 100% 纯的解决方案（是的，我知道我可能不会得到它）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T11:13:37.510

使用 PHP/Javascript 监控文件上传需要 PECL 扩展：

> [上传进度](http://pecl.php.net/package/uploadprogress)

向用户显示进度所需的代码的一个很好的示例是：

> [优步上传者](http://uber-uploader.sourceforge.net/)

如果我没记错的话，它使用 JQuery 与 PHP 进行通信。

你也可以自己写，没那么复杂。

添加一个隐藏元素作为上传表单的*第一个*`UPLOAD_IDENTIFIER`元素，名为.

轮询调用`uploadprogress_get_info( UPLOAD_IDENTIFIER )` 它的 PHP 脚本返回一个包含以下内容的数组：

```
time_start - 上传开始的时间（unix 时间戳），
time_last - 进度信息最后一次更新的时间，
speed_average - 以每秒字节数为单位的平均速度，
speed_last - 最后测量的速度，以每秒字节数为单位，
bytes_uploaded - 到目前为止上传的字节数，
bytes_total - 浏览器发送的 Content-Length 标头的值，
files_uploaded - 到目前为止上传的文件数，
est_sec - 估计的剩余秒数。

```

让 PHP 将信息返回给 Javascript，您应该有足够的信息。根据受众的不同，您可能不会使用所有可用信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T08:54:05.553

如果您安装了[APC](http://www.php.net/apc)（此时，您确实应该安装；它将成为 PHP6 的标准配置），它有一个启用上传跟踪的选项。有[一些文档](http://us2.php.net/manual/en/apc.configuration.php#ini.apc.rfc1867)，Rasmus 编写了一个使用 YUI的[代码示例。](http://progphp.com/progress.phps)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T07:40:52.827

> 有没有什么办法，只使用 HTML、JavaScript/AJAX 和 PHP 的混合来报告文件上传的实际进度？

我不知道有什么方法可以监控 webserver-loaded PHP 中的纯 HTML（多部分/表单数据）文件上传。

当数据进入时，您需要访问 multipart/form-data 解析器的进度，但这看起来是不可能的，因为从 PHP（[$HTTP_RAW_POST_DATA](http://de.php.net/manual/en/ini.core.php#ini.always-populate-raw-post-data)和[php://input](http://de.php.net/manual/en/wrappers.php.php)）访问 HTTP 请求正文的方式记录为“不适用于 enctype="multipart/form-data"”。

您可以使用上传字段的[FileList](https://developer.mozilla.org/en/NsIDOMFileList)在 Firefox 中执行脚本辅助文件上传，以获取文件内容以分段或非多部分方式提交。尽管如此，仍有大量工作需要解析。

（您甚至可以使用自己的 HTTP 处理代码在另一个端口上将 PHP 脚本作为独立服务器运行，仅用于接收文件上传。但这是一项巨大的工作，收益相对较小。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T08:15:06.847

如果您能够将 PECL 包添加到 PHP 中，则可以使用[uploadprogress](http://pecl.php.net/package/uploadprogress)包。

不过，最简单的方法是只使用 swfupload。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T07:25:39.213

我建议您尝试五次[FancyUpload](http://digitarald.de/project/fancyupload/)，这是一个非常酷的进度条解决方案，它不一定附加到 php。还可以在 digitarald.de 上查看其他工具

干杯

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-17T08:14:30.407

恕我直言，这是网络浏览器应该解决的问题。我们有用于下载的进度表，那么为什么不也用于上传呢？

看看这个例子：

[http://www.fireuploader.com/](http://www.fireuploader.com/)

# asp.net - 在 ASP.NET 中创建站点搜索的最佳方法

> ID：653070
> 
> 赞同：0
> 
> 时间：2009-03-17T05:06:24.320
> 
> 标签：asp.net, search

这是为具有数百个动态页面的动态 asp.net 站点创建站点搜索引擎的最佳方法。我看过很多产品和文章

[http://www.karamasoft.com/UltimateSearch/overview.aspx](http://www.karamasoft.com/UltimateSearch/overview.aspx)

[http://www.sitesearchasp.net](http://www.sitesearchasp.net)

[http://www.easysearchasp.net/](http://www.easysearchasp.net/)

[http://msdn.microsoft.com/en-us/magazine/cc163355.aspx](http://msdn.microsoft.com/en-us/magazine/cc163355.aspx)

[http://www.codeproject.com/KB/asp/indexserver.aspx](http://www.codeproject.com/KB/asp/indexserver.aspx)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T05:38:21.310

普里扬，

另一个高质量的开源选项是 Lucene 的 .NET 端口

*   [CodeProject - Lucene 简介](http://www.codeproject.com/KB/library/IntroducingLucene.aspx)

*   [点Lucene](http://www.dotlucene.net)

*   [lucene.net](http://incubator.apache.org/lucene.net)

您还没有提到 Google 的[SiteSearch](http://www.google.com/sitesearch/) “产品”。您想自己托管搜索引擎/目录是您的要求之一吗？

Microsoft 也有一个产品[Search Server 2008 Express](http://www.microsoft.com/enterprisesearch/serverproducts/searchserverexpress/default.aspx)，尽管我不确定您是否可以将它安装在任何托管服务提供商上。

而且（免责声明：我是作者）CodeProject 上还有一个*非常基本*的开源项目，[名为 Searcharoo](http://www.codeproject.com/KB/IP/Searcharoo_7.aspx)（也在[searcharoo.net 上](http://searcharoo.net)）。它实际上是一种“演示/学习体验”——因此有六篇*如何使用的*文章——但对于一个小型动态站点来说可能就足够了。

我在一些项目中使用了 SQL Server 全文搜索 - 效果很好，但它实际上只是搜索**数据库内容**，而不是“真正的”网络爬虫会做的静态和动态 Html/Pdf/Word/Jpg 等文档的组合。

# mysql - MySQL 错误：“列 'columnname' 不能成为 FULLTEXT 索引的一部分”

> ID：653076
> 
> 赞同：15
> 
> 时间：2009-03-17T05:14:05.707
> 
> 标签：mysql, character-encoding, full-text-search

最近我将一堆列更改为 utf8_general_ci （默认的 UTF-8 排序规则），但是在尝试更改特定列时，我收到了 MySQL 错误：

```
Column 'node_content' cannot be part of FULLTEXT index 
```

在查看文档时，似乎 MySQL 在某些多字节字符集（例如 UCS-2）上的 FULLTEXT 索引存在问题，但它应该适用于 UTF-8。

我正在使用最新的稳定 MySQL 5.0.x 版本（我相信是 5.0.77）。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-03-17T05:16:29.930

哎呀，所以我找到了我的问题的答案：

FULLTEXT 索引的所有列不仅必须具有相同的字符集，而且还必须具有*相同的排序规则*。

我的 FULLTEXT 索引在其中一列上有 utf8_unicode_ci，在其他列上有 utf8_general_ci。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-05-09T06:55:57.833

只是为了补充 Thomas 的好建议：为了在 PHPMyAdmin 中解决问题，您必须同时更改所有列的字符集。

只是浪费了半天时间，一次又一次地尝试更改列，并不断收到有关 FULLTEXT 索引的错误消息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2018-11-26T10:13:40.837

对于**DBeaver** /database 工具用户。

当您使用界面修改多个列时，该工具会生成如下命令：

```
ALTER TABLE databaseName.tableName MODIFY COLUMN columnName1 text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL;
ALTER TABLE databaseName.tableName MODIFY COLUMN columnName2 varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL; 
```

这不起作用，因为您必须同时修改字符集。

因此，您必须在一个命令中手动更改它：

```
ALTER TABLE databaseName.tableName 
MODIFY COLUMN columnName1 text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL,
MODIFY COLUMN columnName2 text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL; 
```

**utf8**还是**utf8mb4**？[见这里](https://stackoverflow.com/a/30074553/4891956)。

# sql-server - SSRS 2008：将参数传递给链接报表

> ID：653078
> 
> 赞同：5
> 
> 时间：2009-03-17T05:15:48.480
> 
> 标签：sql-server, sql-server-2008, reporting-services

我有一个报告表，其中包含用户设置的参数生成的所有维度组合。每行包含 1 个组合和指向另一个带有图表的报告的链接。如何将参数/维度的组合传递给其他报告？

在该行中，我有一个文本框操作，其中有一个“转到报告”超链接。在主报告中。我看到一个选项“使用这些参数来运行报告”，我在两个报告上都用类似名称的参数填写了该选项。

在链接的报告中，用户不必再次从该组参数中选择选项。将报表参数设置为内部，用空白提示隐藏（一个空格），用空白提示可见（一个空格），并放置一个（Null）默认值仍然给出：“报表参数是只读的，不能修改. (rsReadOnlyReportParameter)"

是什么赋予了？应该如何在任一侧配置参数，以便将参数组合传递给链接的报表？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T05:32:58.627

如果它是真正的[链接报表](http://msdn.microsoft.com/en-us/library/ms190170.aspx)，那么您应该能够隐藏链接报表属性中的参数。

如果它是[钻取报告](http://msdn.microsoft.com/en-us/library/cc627584.aspx)（更有可能），那么只需将[参数设置为 hidden in 设计器](http://msdn.microsoft.com/en-us/library/aa337234.aspx)。内部意味着它根本不暴露：

> 设置隐藏和内部选项可提供不同级别的可见性。您可以在已发布报告的参数输入区域隐藏参数，但在**报告 URL** [*我的文本：这是钻取所做*的] 或订阅定义中为其设置值。如果您将参数设置为内部，则它不会以任何方式公开，除非在报表定义中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T08:39:52.887

真正问题的真正解决方案可能在其他地方，但只是从头开始重新创建报表项而不是使用转换后的（从 SSRS 2005 到 SSRS 2008）报表项解决了上述问题。钻取报告应隐藏参数。

# build-process - 在 Skype 群聊中接收构建通知的工具

> ID：653084
> 
> 赞同：3
> 
> 时间：2009-03-17T05:18:26.163
> 
> 标签：build-process, notifications, skype

我的团队使用 Skype 群聊，我希望有一个工具可以将通知发布到我们的群聊。

我想避免依赖 RSS 提要，但它可能归结为这一点。但即便如此，它似乎也很难找到——似乎有一个名为 Anothr 的工具可能已经不复存在了。

我也希望没有接收消息的第三方（Skype 之外）——例如，我不希望由第三方托管在某处服务器上的机器人，而他们的机器人坐在我们的群聊中。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-10-16T12:48:52.540

您没有说明您使用哪种构建服务器。如果您对 Jenkins 满意，可以使用一个插件：

[https://wiki.jenkins-ci.org/display/JENKINS/Skype+Plugin](https://wiki.jenkins-ci.org/display/JENKINS/Skype+Plugin)

不过，我没有检查它是否可以发送群聊消息。

# java - 标签库？

> ID：653085
> 
> 赞同：1
> 
> 时间：2009-03-17T05:19:33.073
> 
> 标签：java, jsp, struts, tags, jsp-tags

拥有标签库的目的是什么？尽管我们拥有使我们的工作变得非常简单的基本标签，但是拥有 struts-html.tld 的原因是什么。虽然我们可以通过 usebean、setProperty 和 getProperty 标签轻松调用和使用 bean，但为什么我们有 struts-bean.tld。我是新手，所以请澄清我的疑问..

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T05:26:46.627

如果您使用普通的旧 HTML 标记，您将不得不求助于 scriptlet 将值从表单 bean 中获取到 html 字段中。html 标记与 Struts 框架一起使用，从表单 bean 字段自动填充 html 字段，这导致 JSP 更干净且更易于维护。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T05:33:44.537

虽然您可以做一些基本的事情，例如访问 bean 属性并使用它来构建您的 HTML，但您通常需要在 HTML 页面中做更多的事情。Struts 提供了许多定义明确的标签，您可以直接使用这些标签来构造您的 HTML 元素，例如您的输入字段或表格等。这意味着，您不会处理 HTML 元素，而是处理 struts 标签。除了提供基本的 HTML 元素外，还有标签库可以帮助您创建更复杂的 HTML 页面。例如，对于一个特定的标签库，您可以通过提供一个迭代器和映射列标题来构建整洁的分页表。

# c# - 日期时间转换 c#

> ID：653087
> 
> 赞同：2
> 
> 时间：2009-03-17T05:20:51.807
> 
> 标签：c#, datetime

您如何将此日期转换为 c# Datetime 对象？

2009 年 3 月 16 日星期一 14:21:27 +0000

我尝试使用 format = "ddd MMM dd hh:mm:ss zzzz yyyy" 进行 parseexact，但它没有用。

我做错什么了？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T05:28:56.607

对于 24 小时，您需要 HH，而不是 hh：

```
DateTime when = DateTime.ParseExact("Mon Mar 16 14:21:27 +0000 2009",
    "ddd MMM dd HH:mm:ss zzzz yyyy",
    CultureInfo.InvariantCulture); 
```

# android - 如何使 EditText 小于默认值？

> ID：653088
> 
> 赞同：6
> 
> 时间：2009-03-17T05:21:25.067
> 
> 标签：android, android-layout, android-xml

我需要在屏幕上显示大量 EditText 控件，每个控件只允许输入 0-2 位数字。默认的 EditText 大小太宽，我无法在屏幕上显示足够的 EditText 控件，但我一直无法弄清楚如何使它们变窄。我尝试了以下属性

**XML:**

```
android:maxLength="2"
android:layout_width="20dip"
android:maxWidth="20px"
android:ems="2"
android:maxEms="2" 
```

所以问题是：如何使 EditText 小于默认值？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-17T06:23:02.467

试试这种方式，显示差异。使用指定宽度的 layout_width。

```
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="vertical"
    android:layout_width="fill_parent"
    android:layout_height="fill_parent"
    >

<EditText
    android:width="10dip"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="@string/hello"
    />

<EditText
    android:layout_width="40dip"
    android:layout_height="wrap_content"
    android:text="@string/hello"
    android:maxLength="2"
    />

</LinearLayout> 
```

[![替代文字](https://i.stack.imgur.com/FOsDq.jpg)](https://i.stack.imgur.com/FOsDq.jpg)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-01-03T06:22:19.353

嘿，一旦你尝试这个，它可能会工作....... android:textAppearance="?android:attr/textAppearanceSmall"

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-02T09:13:04.670

如果您最终在此页面上搜索如何在 Java 代码中实现相同的功能..

```
txtSample.setFilters(new InputFilter[]{new InputFilter.LengthFilter(2)}); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-18T02:09:28.943

如您所述，在表格中时， android:layout_gravity="left" 会将 EditText 折叠到 EditText 的规定大小

# post - 如何使用 PHP header() 函数发布到页面？

> ID：653090
> 
> 赞同：20
> 
> 时间：2009-03-17T05:23:17.387
> 
> 标签：post, header, http-headers

[我在这里](http://php.net/manual/en/function.header.php#89447)找到了以下代码，我认为它可以满足我的需求，但它不起作用：

```
$host = "www.example.com";
$path = "/path/to/script.php";
$data = "data1=value1&data2=value2";
$data = urlencode($data);

header("POST $path HTTP/1.1\r\n");
header("Host: $host\r\n");
header("Content-type: application/x-www-form-urlencoded\r\n");
header("Content-length: " . strlen($data) . "\r\n");
header("Connection: close\r\n\r\n");
header($data); 
```

我希望在不将用户发送到中间页面然后使用 JavaScript 重定向它们的情况下发布表单数据。我也不想使用 GET，所以使用后退按钮并不容易。

这段代码有问题吗？或者有没有更好的方法？

**编辑**我在想标题函数会做什么。我在想我可以让浏览器将数据发回服务器，但这不是它的本意。相反，我在我的代码中找到了一种方法，可以完全避免发布帖子（不会中断，只是继续切换到下一个案例）。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-17T05:31:59.283

标头函数用于将 HTTP 响应标头发送回用户（即您不能使用它来创建请求标头。

请问你为什么要这样做？为什么要模拟 POST 请求，因为您可以就在那儿，然后以某种方式对数据采取行动？我当然假设 script.php 驻留在您的服务器上。

要创建 POST 请求，请使用 fsockopen() 打开与主机的 TCP 连接，然后在 fsockopen() 返回的处理程序上使用 fwrite()，并使用您在 OP 中的标头函数中使用的相同值。或者，您可以使用 cURL。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2015-02-07T20:30:53.963

今天非常需要这个问题的答案，因为不是每个人都想使用 cURL 来使用 Web 服务。PHP也允许使用以下代码进行此操作

```
function get_info()
{
    $post_data = array(
        'test' => 'foobar',
        'okay' => 'yes',
        'number' => 2
    );

    // Send a request to example.com
    $result = $this->post_request('http://www.example.com/', $post_data);

    if ($result['status'] == 'ok'){

        // Print headers
        echo $result['header'];

        echo '<hr />';

        // print the result of the whole request:
        echo $result['content'];

    }
    else {
        echo 'A error occured: ' . $result['error'];
    }

}

function post_request($url, $data, $referer='') {

    // Convert the data array into URL Parameters like a=b&foo=bar etc.
    $data = http_build_query($data);

    // parse the given URL
    $url = parse_url($url);

    if ($url['scheme'] != 'http') {
        die('Error: Only HTTP request are supported !');
    }

    // extract host and path:
    $host = $url['host'];
    $path = $url['path'];

    // open a socket connection on port 80 - timeout: 30 sec
    $fp = fsockopen($host, 80, $errno, $errstr, 30);

    if ($fp){

        // send the request headers:
        fputs($fp, "POST $path HTTP/1.1\r\n");
        fputs($fp, "Host: $host\r\n");

        if ($referer != '')
            fputs($fp, "Referer: $referer\r\n");

        fputs($fp, "Content-type: application/x-www-form-urlencoded\r\n");
        fputs($fp, "Content-length: ". strlen($data) ."\r\n");
        fputs($fp, "Connection: close\r\n\r\n");
        fputs($fp, $data);

        $result = '';
        while(!feof($fp)) {
            // receive the results of the request
            $result .= fgets($fp, 128);
        }
    }
    else {
        return array(
            'status' => 'err',
            'error' => "$errstr ($errno)"
        );
    }

    // close the socket connection:
    fclose($fp);

    // split the result header from the content
    $result = explode("\r\n\r\n", $result, 2);

    $header = isset($result[0]) ? $result[0] : '';
    $content = isset($result[1]) ? $result[1] : '';

    // return as structured array:
    return array(
        'status' => 'ok',
        'header' => $header,
        'content' => $content);

} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T05:57:20.253

除了 Salaryman 所说的，看看[PEAR](http://pear.php.net)中的类，即使您的 PHP 发行版中没有安装 cURL 扩展，您也可以使用那里的 HTTP 请求类。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-11-03T10:54:31.907

有一个很好的课程可以做你想做的事。可在以下网址下载：http: [//sourceforge.net/projects/snoopy/](http://sourceforge.net/projects/snoopy/)

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-05-18T09:32:20.107

```
private function sendHttpRequest($host, $path, $query, $port=80){
    header("POST $path HTTP/1.1\r\n" );
    header("Host: $host\r\n" );
    header("Content-type: application/x-www-form-urlencoded\r\n" );
    header("Content-length: " . strlen($query) . "\r\n" );
    header("Connection: close\r\n\r\n" );
    header($query);
} 
```

这会让你马上

# xml - 如何在 C# 中检索 XML 节点属性

> ID：653092
> 
> 赞同：0
> 
> 时间：2009-03-17T05:25:52.013
> 
> 标签：xml

如何导航 XML 文件并获取所有节点列表以访问它们的属性并计算学生标记中的节点数。

例如 ：

任何人都可以简要介绍我。怎么办？给出任何示例代码来做到这一点。？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T05:44:08.193

您可以像这样从和 XmlDocument 中获取 XmlNodes 的集合

```
XmlNodeList nodes = document.GetElementsByTagName("MyNodeName");
foreach (XmlNode node in nodes)
{
    // do stuff with each node
} 
```

XmlNode 类有一个 Attributes 属性，它是属性的集合。您可以遍历它们并匹配您正在寻找的属性。

# flash-cs3 - 如何在 Flash 输入文本字段中放置水印

> ID：653093
> 
> 赞同：1
> 
> 时间：2009-03-17T05:26:08.673
> 
> 标签：flash-cs3, watermark, textinput

我对 Flash AS3 有疑问，我的要求是如何在 Flash 输入文本字段中放置水印，以便如果任何用户单击输入文本字段，那么已经出现的文本不应该是可见的。我希望我能从你们中的任何人那里得到更好的答案谢谢——詹妮弗。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T11:53:53.797

为了稍微改进什维拉姆所写的内容：

```
public static const PROMPT:String = "Type your text here...";
public static const PROMPT_COLOR:Number = 0x999999;

txt = new TextField();
txt.text = PROMPT;
txt.textColor = PROMPT_COLOR;
txt.addEventListener(FocusEvent.FOCUS_IN, focusHandler);
txt.addEventListener(FocusEvent.FOCUS_OUT, focusHandler);
this.addChild(txt);

// the Listen function
private  function focusHandler(event:FocusEvent):void
{
     switch (event.type) {
     case FocusEvent.FOCUS_IN:
         if (txt.text == PROMPT) {
            txt.text = "";
            txt.textColor = 0xFFFFFF;
         }
         break;
     case FocusEvent.FOCUS_OUT:
         if (txt.text == "") {
             txt.text = PROMPT;
             txt.textColor = PROMPT_COLOR;
         }
         break;
} 
```

（未经测试。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T05:44:37.070

您实际要查找的术语称为 cuebanner，而不是水印。我对Flash不熟悉，所以我不能告诉你怎么做。但是，如果您使用 Google cuebanner，您可能会比搜索水印时获得更好的信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T06:07:15.797

是的，您可以这样做 创建一个文本文件 输入文本 addEventListener 监听用户的 CLICK 并在函数中清除文本字段的内容

```
txt = new TextField();
txt.text = "clikc me";
txt.addEventListener(MouseEvent.CLICK,onTxtClick);
this.addChild(txt);

// the Listen function
private  function onTxtClick(evt:MouseEvent):void
{
     txt.text = "";
} 
```

# linux - 如何释放 Inode 使用量？

> ID：653096
> 
> 赞同：317
> 
> 时间：2009-03-17T05:27:35.643
> 
> 标签：linux, unix, memory-management, inode

我有一个磁盘驱动器，其中 inode 使用率为 100%（使用`df -i`命令）。但是在大量删除文件后，使用率仍然是 100%。

那么正确的方法是什么？

磁盘空间使用率较低的磁盘驱动器怎么可能比磁盘空间使用率较高的磁盘驱动器具有更高的 Inode 使用率？

如果我压缩大量文件会减少使用`inode`次数，是否有可能？

* * *

## 回答 #1

> 赞同：230
> 
> 时间：2012-02-22T00:22:45.557

如果你很不走运，你已经使用了大约 100% 的所有 inode 并且无法创建 scipt。您可以使用`df -ih`.

那么这个 bash 命令可以帮助你：

```
sudo find . -xdev -type f | cut -d "/" -f 2 | sort | uniq -c | sort -n 
```

是的，这需要时间，但您可以找到文件最多的目录。

* * *

## 回答 #2

> 赞同：185
> 
> 时间：2009-03-17T06:22:42.797

即使磁盘不是很满，磁盘也很容易使用大量 inode。

一个 inode 被分配给一个文件，因此，如果您有大量文件，每个文件都是 1 个字节，那么您将在磁盘用完之前很久就用完 inode。

如果文件有多个硬链接，删除文件也可能不会减少 inode 计数。正如我所说，inode 属于文件，**而不是**目录条目。如果一个文件有两个链接到它的目录条目，删除一个不会释放 inode。

此外，您可以删除目录条目，但如果正在运行的进程仍然打开文件，则不会释放 inode。

我最初的建议是删除所有可以删除的文件，然后重新启动机器以确保没有进程保持打开文件。

如果您这样做了，但仍然有问题，请告诉我们。

顺便说一句，如果您正在寻找包含大量文件的目录，此脚本可能会有所帮助：

```
#!/bin/bash
# count_em - count files in all subdirectories under current directory.
echo 'echo $(ls -a "$1" | wc -l) $1' >/tmp/count_em_$$
chmod 700 /tmp/count_em_$$
find . -mount -type d -print0 | xargs -0 -n1 /tmp/count_em_$$ | sort -n
rm -f /tmp/count_em_$$ 
```

* * *

## 回答 #3

> 赞同：77
> 
> 时间：2015-11-06T08:46:37.380

我的情况是我的 inode 用完了，我已经删除了我能删除的所有内容。

```
$ df -i
Filesystem     Inodes  IUsed  IFree IUse% Mounted on
/dev/sda1      942080 507361     11  100% / 
```

我在 ubuntu 12.04LTS 上，无法删除占用大约 400,000 个 inode 的旧 linux 内核，因为 apt 由于缺少软件包而损坏。而且我无法安装新软件包，因为我没有 inode，所以我被卡住了。

我最终手动删除了一些旧的 linux 内核以释放大约 10,000 个 inode

```
$ sudo rm -rf /usr/src/linux-headers-3.2.0-2* 
```

这足以让我安装丢失的软件包并修复我的 apt

```
$ sudo apt-get install linux-headers-3.2.0-76-generic-pae 
```

然后用 apt 删除其余的旧 linux 内核

```
$ sudo apt-get autoremove 
```

现在情况好多了

```
$ df -i
Filesystem     Inodes  IUsed  IFree IUse% Mounted on
/dev/sda1      942080 507361 434719   54% / 
```

* * *

## 回答 #4

> 赞同：58
> 
> 时间：2014-12-12T16:56:45.697

我的解决方案：

尝试查找这是否是 inode 问题：

```
df -ih 
```

尝试查找具有大量 inode 数的根文件夹：

```
for i in /*; do echo $i; find $i |wc -l; done 
```

尝试查找特定文件夹：

```
for i in /src/*; do echo $i; find $i |wc -l; done 
```

如果这是 linux 头文件，请尝试删除最旧的：

```
sudo apt-get autoremove linux-headers-3.13.0-24 
```

我个人将它们移动到一个已安装的文件夹（因为对我来说最后一个命令失败）并安装了最新的：

```
sudo apt-get autoremove -f 
```

这解决了我的问题。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2016-02-29T00:18:09.540

我有同样的问题，通过删除 php 的目录会话来修复它

```
rm -rf /var/lib/php/sessions/ 
```

`/var/lib/php5`如果您使用的是较旧的 php 版本，则可能会出现这种情况。

使用以下权限重新创建它

```
mkdir /var/lib/php/sessions/ && chmod 1733 /var/lib/php/sessions/ 
```

显示 Debian 目录的默认权限`drwx-wx-wt`(1733)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-11-12T08:37:19.307

在垃圾邮件攻击之后，我们在 HostGator 帐户（对所有主机设置 inode 限制）上遇到了这种情况。它在 /root/.cpanel/comet 中留下了大量的队列记录。如果发生这种情况并且您发现没有可用的 inode，您可以通过 shell 运行此 cpanel 实用程序：

```
/usr/local/cpanel/bin/purge_dead_comet_files 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-06-03T07:26:16.643

您可以使用 RSYNC 删除大量文件

```
rsync -a --delete blanktest/ test/ 
```

创建包含 0 个文件的空白测试文件夹，命令会将您的测试文件夹与大量文件同步（我使用此方法删除了近 500 万个文件）。

感谢[http://www.slashroot.in/which-is-the-fastest-method-to-delete-files-in-linux](http://www.slashroot.in/which-is-the-fastest-method-to-delete-files-in-linux)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2020-06-15T11:57:54.023

迟到的答案：就我而言，这是我的会话文件

```
/var/lib/php/sessions 
```

使用 Inodes。
我什至无法打开我的 crontab 或创建新目录，更不用说触发删除操作了。由于我使用 PHP，我们有这个[指南](https://www.php.net/manual/en/function.session-gc.php)，我在其中复制了示例 1 中的代码并设置了一个 cronjob 来执行该部分代码。

```
<?php
// Note: This script should be executed by the same user of web server 
process.

// Need active session to initialize session data storage access.
session_start();

// Executes GC immediately
session_gc();

// Clean up session ID created by session_gc()
session_destroy();
?> 
```

如果您想知道我是如何设法打开我的 crontab，那么我通过 CLI 手动删除了一些会话。

希望这可以帮助！

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-04-01T20:17:45.390

eaccelerator 可能会导致问题，因为它将 PHP 编译成块......我在一个负载很重的站点上的 Amazon AWS 服务器上遇到了这个问题。如果您仍然遇到问题，请通过删除 /var/cache/eaccelerator 中的 eaccelerator 缓存来释放 Inode。

```
rm -rf /var/cache/eaccelerator/* 
```

（或任何你的缓存目录）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-04-01T07:01:07.020

我们最近遇到了类似的问题，如果一个进程引用了一个被删除的文件，inode不会被释放，所以需要检查lsof /，kill/restart进程会释放inode。

如果我在这里错了，请纠正我。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-08-17T18:07:08.513

如前所述，如果有很多小文件，文件系统可能会用完 inode。我在这里提供了一些方法来查找包含大多数文件的[目录](https://stackoverflow.com/a/39379847/4414935 "我对另一个问题的回答")。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-08-02T16:39:10.870

在上述答案之一中，有人建议会话是 inode 用完的原因，而在我们的情况下，情况正是如此。尽管我建议检查 php.ini 文件并确保`session.gc_probability = 1`还添加到该答案`session.gc_divisor = 1000`， 但`session.gc_maxlifetime = 1440`. 在我们的例子中 session.gc_probability 等于 0 并导致了这个问题。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-09-29T09:48:39.377

这篇文章拯救了我的一天： [https ://bewilderedoctothorpe.net/2018/12/21/out-of-inodes/](https://bewilderedoctothorpe.net/2018/12/21/out-of-inodes/)

```
find . -maxdepth 1 -type d | grep -v '^\.$' | xargs -n 1 -i{} find {} -xdev -type f | cut -d "/" -f 2 | uniq -c | sort -n 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2020-12-11T13:48:06.330

在 Raspberry Pi 上，我遇到了`/var/cache/fontconfig`包含大量文件的 dir 问题。删除它花了一个多小时。当然会`rm -rf *.cache*`引发`Argument list too long`错误。我用了下面一个

```
find . -name '*.cache*' | xargs rm -f 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-06-17T02:01:53.620

你可以看到这个信息

```
for i in /var/run/*;do echo -n "$i "; find $i| wc -l;done | column -t 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2022-01-31T09:30:58.317

首先，获取 inode 存储使用情况：

```
df -i 
```

下一步是找到这些文件。为此，我们可以使用一个小脚本来列出目录及其上的文件数量。

```
for i in /*; do echo $i; find $i |wc -l; done 
```

从输出中，您可以看到使用大量文件的目录，然后对该目录重复此脚本，如下所示。重复此操作，直到您看到可疑目录。

```
for i in /home/*; do echo $i; find $i |wc -l; done 
```

当您发现可疑目录包含大量不需要的文件时。只需删除该目录中不需要的文件并通过以下命令释放一些 inode 空间。

```
rm -rf /home/bad_user/directory_with_lots_of_empty_files 
```

您已成功解决问题。现在再次使用 df -i 命令检查 inode 使用情况，您可以看到这样的差异。

```
df -i 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2017-09-17T17:52:05.033

到目前为止，这个问题有很多答案，以上所有内容似乎都是具体的。我认为你在使用时会很安全`stat`，但是取决于操作系统，你可能会遇到一些 inode 错误。因此，实现您自己的`stat`呼叫功能`64bit`以避免任何溢出问题似乎相当兼容。

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2019-03-25T04:11:44.230

如果您使用 docker，请删除所有图像。他们使用了很多空间......

**停止所有容器**

```
docker stop $(docker ps -a -q) 
```

**删除所有容器**

```
docker rm $(docker ps -a -q) 
```

**删除所有图像**

```
docker rmi $(docker images -q) 
```

对我有用

# asp.net - 用户会话过期时如何清除浏览器中的 SSL 状态？

> ID：653097
> 
> 赞同：2
> 
> 时间：2009-03-17T05:28:16.717
> 
> 标签：asp.net, ssl, certificate

我正在开发一个 ASP.NET 应用程序，我们的用户使用客户端证书通过 HTTPS 进行身份验证。我们的用户只使用 IE7。

一旦客户端证书用于成功验证，它就会保留在浏览器的 SSL 缓存中，直到进程关闭或用户手动清除 SSL 缓存。我们希望能够在用户注销或会话到期时清除 SSL 缓存，以提高系统的安全性。

我们的客户已经使用智能卡来访问系统，当智能卡从客户端计算机中移除时，系统会自动卸载证书，但这根本不会清除浏览器缓存，从而为其他有权访问相同的用户留下了潜在的攻击途径机为正版用户。

我发现了如何从 JavaScript 中进行实际的缓存清除：

document.execCommand("ClearAuthenticationCache");

当用户显式注销时，这非常有效，因为我们可以在允许用户再次登录之前在客户端上执行脚本。

注意：IE7 仅允许在 Web 服务器上禁用 HTTP Keep-Alives 时以编程方式清除缓存。

这是棘手的一点 - 如果客户端的会话过期，在用户尝试再次登录之前，我不知道有什么方法可以在浏览器中处理这个问题。当他们到达登录页面时，我无法清除状态，因为我需要在页面在服务器上执行之前清除状态并选择新证书。

有任何想法吗？为问题的长度道歉，但背景对于这个问题很重要。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T23:24:53.823

没关系，我想出了一个很好的解决方案：

*   当用户成功登录时，我们会创建一个额外的会话 cookie，该 cookie 在浏览器关闭之前不会过期。

*   如果用户稍后返回登录页面并且请求未经身份验证，我们检查会话 cookie 的存在 - 如果存在，我们知道用户之前有过会话，因此我们显式将它们注销，就像我们为用户发起的注销做。如果会话 cookie 不存在，那么我们会尝试使用他们的证书自动登录用户。

*   每次显式注销都会删除自定义会话 cookie，并在每次成功登录时重新填充。

这为我们提供了最佳的用户体验，并保证只有在会话仍然有效（15 分钟，滑动）时才会缓存证书。此外，用户无法删除会话 cookie，因此无法绕过此行为。他们也不能在不接受会话 cookie 的情况下使用该网站。

# sql-server - 如何将我的 MS Access 数据导出到 SQL Server？

> ID：653101
> 
> 赞同：2
> 
> 时间：2009-03-17T05:29:59.350
> 
> 标签：sql-server, ms-access

我有一个 MS Access 数据库，我想将其转换为在 MS SQL Server 上运行。

我怎样才能导出它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T09:06:00.547

您还可以使用 SQL Server Integration Services 导入 SQL Server (2005)，而不是导出。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T05:35:35.843

工具..选项...升迁向导，如果我没记错的话。

严格来说，你总是需要软件来完成它，除非你有来自 ETL 仙女的 3 个愿望。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T10:53:31.943

如果您的 SQL Server 是**SQL Server 2000**或**SQL Server 7**，[Miles D](https://stackoverflow.com/users/3898/miles-d)提到的[SQL Server Integration Services](http://msdn.microsoft.com/en-us/library/ms141026.aspx)称为[Data Transformation Services](http://msdn.microsoft.com/en-us/library/cc917688.aspx)。顺便说一句：我喜欢这个工具。这很棒。

如果由于某种原因你不能（或不想）使用这些工具中的任何一个，你总是可以编写一段很短的代码（用 Java、C# 或任何你觉得舒服的语言）来完成同样的事情你的具体问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-25T14:09:10.487

使用免费的*[Microsoft SQL Migration Assistant for Access](http://www.microsoft.com/sqlserver/2008/en/us/migration.aspx)* (SSMA)：它的目的是将 Access 应用程序转换为 SQL：它很棒而且是免费的。

我写了一篇关于它的博客文章：http:
[//blog.nkadesign.com/2009/ms-access-upsizing-to-sql-server-2008/](http://blog.nkadesign.com/2009/ms-access-upsizing-to-sql-server-2008/)

# linux - 为可以具有多个实例的应用程序的消息队列创建唯一键

> ID：653119
> 
> 赞同：2
> 
> 时间：2009-03-17T05:46:47.657
> 
> 标签：linux, ipc, message-queue, ftok

我制作了一个 Linux CUI 应用程序，它通过消息队列在进程之间进行通信。

只要是单例就没有问题。但是，当同一个应用程序有多个实例时，队列中的消息会被发送到错误的实例。

我知道这可以通过给 msgget 函数一个唯一的键来避免。使用 ftok() 创建密钥，但由于变量相同，它们会产生相同的密钥。

有人可以指导我如何为每个实例设置一个唯一的密钥吗？

我现在唯一的想法是随机分配给 ftok 的变量，我知道这不可能。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T06:00:04.927

您可以尝试使用进程ID。我的 google foo 得到了[这个](http://ubuntuforums.org/showthread.php?t=665362)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T06:12:04.803

小心ftok！

这仅对于给定的文件系统是唯一的，并且仅当文件系统未被大量使用时才唯一。fttok 由文件系统中的文件条目号驱动。

这曾经是获得独特价值的好方法，但几年前时间和摩尔定律赶上了它。它适用于文件编号的低 8 位，但实际文件编号现在是 32 位，并且每个文件系统重新开始编号。

进程 ID 是一个不错的选择，它们确实会被重新循环，但只要进程还活着就不会。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T06:16:36.227

查找全局唯一 ID，通常称为 Guid 或 Uuid。必须有一个可以用来生成它们的库。它们是由您的网卡地址、当前时间和随机数组成的唯一字符串。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-02T07:56:10.877

时钟呢？ [维基百科](http://en.wikipedia.org/wiki/Time_Stamp_Counter)说它比 RDTSC（和 SMP 安全）更好。

`CLOCK_MONOTONIC`“在 Linux 下，通过使用 POSIX clock_gettime 函数读取时钟的值来提供类似的功能。”

# .net - 什么时候应该使用 <%# ... %> 和 <%= ... %>？

> ID：653122
> 
> 赞同：6
> 
> 时间：2009-03-17T05:48:23.627
> 
> 标签：.net, asp.net

我最近一直在使用预编译的 .NET3.5 应用程序做一些工作，所以我不得不编写很多内联代码，我只是想知道在做内联代码时 # 和 = 以及 niether 的用法？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-17T05:59:07.457

*   <%=[相当于 Response.Write()](http://msdn.microsoft.com/en-us/library/6dwsdcf5.aspx)
*   <%# 用于数据绑定控件上的[绑定表达式。](http://msdn.microsoft.com/en-us/library/ms178366.aspx)
*   [<%$](http://msdn.microsoft.com/en-us/library/d5bd1tad.aspx) 用于访问应用程序配置和资源文件中包含的 AppSettings、ConnectionStrings 和其他值

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T05:57:07.180

我在这里发布了一个类似的问题，这可能会给你一些东西看：

[ASP.NET “特殊”标签](https://stackoverflow.com/questions/649428/asp-net-special-tags)

特别是这个页面：

[http://quickstarts.asp.net/QuickStartv20/aspnet/doc/pages/syntax.aspx](http://quickstarts.asp.net/QuickStartv20/aspnet/doc/pages/syntax.aspx)

# wcf - 使用 QTP 进行 WCF Web 服务测试

> ID：653126
> 
> 赞同：3
> 
> 时间：2009-03-17T05:52:06.223
> 
> 标签：wcf, automated-tests, qtp

我想使用 QTP 的 WebServices 插件自动测试 WCF Web 服务（通过 TCP）。但是，当我指定 WSDL 的路径时，它会给我错误。有没有人尝试过使用QTP？或我可以用于测试的任何其他工具？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T05:55:49.383

据我所知，QTP 不能用于使用 NetTcpBinding 测试 WCF 服务。他们应该使用普通的 BasicHttpBinding 才能工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-08T20:54:11.110

当我调用 web 服务时，我为 QTP 规定了 3 个强制性参数，然后是实际 web 服务本身的参数。这每次都有效（除了 web 服务没有运行）

这是一个例子：

```
'=============================================================================
' Define WebService
qtpP1 = "wsdl:=http://172.16.69.84:8080/testframeworkwebapp/services/STFSQLExecutionService?WSDL"
' Define service & port
qtpP2 = "service:=GenericSQLExecutorService"
qtpP3= "port:=STFSQLExecutionService"
' Define Webservice calling parameters
wsP1 = "Select Count(*) From PERSON_TABLE"

'====================================================================
' Call to the WebService
executeSQLByDBName = WebService(qtpP1, qtpP2, qtpP3).executeSQLByDBName(wsP1)

If WebService(qtpP1, qtpP2, qtpP3).GetLastError > "" Then
  MsgBox "WebService Issue"
Else
  MsgBox "WebServices Call Worked OK"
End If
'==================================================================== 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-12T19:31:09.577

您可以使用[`QEngine`](http://qengine.wiki.zoho.com/). 这是测试 WCF 和其他类型服务的好方法。

# perl - 如何使用 Perl 的 Archive::Tar 压缩大于物理内存的文件？

> ID：653127
> 
> 赞同：6
> 
> 时间：2009-03-17T05:53:25.363
> 
> 标签：perl, archive, tar

我正在使用 Perl 的[Archive::Tar](http://search.cpan.org/dist/Archive-Tar)模块。问题在于它将所有内容都拉到内存中并进行归档，然后写入文件系统，因此可以归档的最大文件大小受到限制。大多数时候它说内存不足。在 GNU tar 的情况下，它会获取文件块，将其归档并将其写入内存，以便它可以处理任何大小的文件。如何使用 Perl 的 Archive::Tar 模块做到这一点。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-17T16:43:38.607

看起来[Archive::Tar::Wrapper](http://search.cpan.org/perldoc?Archive::Tar::Wrapper)是你最好的选择。我自己没有尝试过，但它使用您系统的`tar`可执行文件并且不会将文件保存在内存中。

与查斯相反。Owen 的回答[Archive::Tar::Streamed](http://search.cpan.org/perldoc?Archive::Tar::Streamed) **确实**将文件保存在内存中，**并且不**使用您系统的`tar`. 它实际上在内部使用[Archive::Tar](http://search.cpan.org/perldoc?Archive::Tar)，但它一次处理一个文件（利用 tar 档案可以连接的事实）。这意味着 Archive::Tar::Streamed 可以处理大于内存的存档，只要存档中的每个单独文件都适合内存。但这不是你要求的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T07:24:05.567

看起来有一个不同的模块不使用内存结构：[Archive::Tar::Streamed](http://search.cpan.org/dist/Archive-Tar-Streamed/lib/Archive/Tar/Streamed.pm)。缺点是它需要 tar 在运行它的系统上可用。尽管如此，它还是比你自己用木偶串焦油要好。

# c# - 如何获取程序集的命名空间？

> ID：653128
> 
> 赞同：37
> 
> 时间：2009-03-17T05:53:29.030
> 
> 标签：c#, .net, assemblies, namespaces

考虑我有一个使用以下代码加载的程序集（类库 dll），

```
Assembly a = Assembly.LoadFrom(@"C:\Documents and Settings\E454935\My Documents\Visual Studio 2005\Projects\nunit_dll_hutt\for_hutt_proj\bin\Debug\asdf.dll"); 
```

我需要得到大会的类型。为了获得**类型**，我需要程序集的命名空间。

```
Type t = asm.GetType("NAMESPACE.CLASSNAME",false,true); 
```

我怎样才能获得上述行中的命名空间。？！为了获得**命名空间**，我需要获得类型..？

```
Type.Namespace; 
```

即我需要获取可用于获取其类型的程序集的命名空间。

提前致谢

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-03-17T06:04:51.967

采用

```
Assembly.GetTypes(); 
```

这将为您提供所有类型的集合，然后您可以获得每个类型的 Namespace 属性。

然后我想你可以简单地检查所有类型是否具有相同的命名空间值并使用这个值。否则添加一些其他逻辑来检测哪些命名空间被认为是主要的。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-17T06:04:56.553

一个程序集可以包含多个命名空间。我认为您真正想问的是如何在不指定命名空间的情况下从程序集中获取类型。

我不知道是否有更好的方法，但您可以尝试寻找这样的特定类型（添加 - 使用 linq;）：

```
myassembly.GetTypes().SingleOrDefault(t => t.Name == "ClassName") 
```

如果在不同的命名空间下有超过 1 个具有该名称的类，这将有效地抛出（因为 Single 方法确保只有 1 个）。

对于该类的命名空间列表，您可以：

```
Assembly.Load("ClassName").GetTypes().Select(t => t.Namespace).Distinct(); 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2015-05-06T13:14:01.860

***更新：***

**如果****`assembly name`**&**`assembly namespace`**在您的项目中相同**并且**您确定保持主题相同**并且**您想要获取*当前执行的程序集的名称空间，* **那么**您可以使用它：

```
var namespace = Assembly.GetExecutingAssembly().GetName().Name; 
```

对于您加载的程序集：

```
var namespace = myAssembly.GetName().Name; 
```

* * *

但是**如果**`assembly name`&在你的项目中`assembly namespace` **不**一样，那么你可以使用这种方式：

```
// Like @eglasius answer >>
// Find all namespaces in the target assembly where a class with the following name is exists:
var namespaceList=Assembly.Load("MyClassName").GetTypes().Select(t => t.Namespace).Distinct(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-10-29T16:29:06.737

`Assembly.GetName().Name`将为您提供默认命名空间

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-12-11T10:28:22.993

使用 Mono/Xamarin，您无权访问“NameSpace”属性。您可以改用以下内容：

```
var str = typeof(ATypeInTheAssembly).AssemblyQualifiedName;
return str.Split(',')[1].Trim(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-04-13T13:32:26.180

要仅采用命名空间，请遵循以下代码：

```
 var assembly = System.Reflection.Assembly.GetAssembly(this.GetType());//Get the assembly object
  var nameSpace = assembly.GetType().Namespace;//Get the namespace 
```

**或者**

```
public string GetNamespace(object obj)
{
    var nameSpace = obj.GetType().Namespace;//Get the namespace

    return nameSpace;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-07-18T22:40:53.313

### 得到一个程序集必须包含几乎一个类（或任何其他类型，例如接口）并且它们必须包含在一个命名空间中，该命名空间必须在程序集命名空间内开始，它们中最短的将是最后一个。

所以，这是我找到的解决方案：

```
public string GetAssemblyNamespace(Assembly asm)
{
    string ns = @"";
    foreach (Type tp in asm.Modules.First().GetTypes()) //Iterate all types within the specified assembly.
        if (ns.Length == 0 ? true : tp.Namespace.Length < ns.Length) //Check whether that's the shortest so far.
            ns = tp.Namespace; //If it's, set it to the variable.
    return ns; //Now it is the namespace of the assembly.
} 
```

*我只是在所需程序集中找到所有类型，然后搜索名称最短的命名空间中包含的类型。*

# c# - C# 正则表达式从 pl/sql 代码中获取注释块

> ID：653143
> 
> 赞同：1
> 
> 时间：2009-03-17T06:02:44.343
> 
> 标签：c#, regex, parsing, plsql

我想从字符串中提取注释作为一个块。

例如，我有一个 PL/SQL 代码：

> ```
> --comment1
> select * from t_table;
> --i want comment 2;
> /*i want comment
> 3 */
> --i want comment 4
> OPEN data_cur; 
> ```

在这里，我想要 OPEN data_cur 之前的所有单行和多行注释；但是在从 t_table 中选择 * 之后；

即我想要两个PL/SQL 语句之间的完整注释块。

我希望正则表达式匹配字符串并将组形成为：

1.  SQL 语句
2.  整个评论块

可以使用任何正则表达式来完成吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T06:59:34.220

```
(?ms)^\s*([^\-/\s][^;]+;)((?:(?:\s+/\*(?:.(?!\*/))+.\*/)|(?:\s+\-\-[^\r\n]+))*) 
```

应该做得很好。
（注意：`(?ms)`是 Java 中指定“多行”“全点”模式的方式，但我已经[在 RETester 上进行了测试](http://regexlib.com/RETester.aspx)，它可以工作）

它可以检测到 0 条或更多条评论`select`。由于在非捕获组中使用了[正向前瞻](http://www.regular-expressions.info/lookaround.html)，
因此接受多行注释`/*``*/` `(?:.(?!\*/))+`

更新：修改它以检测 0 或许多评论之前的任何“非评论”行。

* * *

要检测comment1，然后是语句，然后是评论：

```
(?ms)((?:(?:\s+/\*(?:.(?!\*/))+.\*/)|(?:\s+\-\-[^\r\n]+))*)\s*^\s*([^\-/\s][^;]+;)((?:(?:\s+/\*(?:.(?!\*/))+.\*/)|(?:\s+\-\-[^\r\n]+))*) 
```

注意：我在两个正则表达式（开头的那个和这个）中都更新了语句检测部分：

```
\s*([^\-/][^;]+;) 
```

到

```
\s*([^\-/\s][^;]+;) 
```

注意之二：只会`comments - statement - comments`检测到第一个“ ”。
下一个块也将被检测到，但仅是：“ `statement - comments`”，然后是“ `statement - comments`”，依此类推。（声明上方的评论是上一条声明*下方**评论*的一部分）

 *# c++ - 等价的 和

> ID：653150
> 
> 赞同：3
> 
> 时间：2009-03-17T06:05:56.533
> 
> 标签：c++, c, stl, standards, limits

1.  这是否保证总是正确的：

    ```
    std::numeric_limits<int>::max() == INT_MAX 
    ```

    C++ 标准对此有何评论？我在标准中找不到任何明确说明这一点的参考资料，但我一直在读那些应该是等价的。

2.  `long long`对于同时实现 C99（至少部分）和 C++98的编译器，不在 C++98 标准中的 C99 类型呢？我不确定是否有任何保证这始终成立：

    ```
    std::numeric_limits<unsigned long long>::max() == ULLONG_MAX 
    ```

    这是一个合理的假设吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T06:15:04.517

我的 C++ 2003 标准副本说`numeric_limits<>::max()`and`min()`模板将返回值：

> 相当于`CHAR_MIN, SHRT_MIN, FLT_MIN, DBL_MIN,`等
> 
> 相当于`CHAR_MAX, SHRT_MAX, FLT_MAX, DBL_MAX,`等

但是，这些都在脚注中。ISO/IEC 指令第 3 部分：“[脚注] 不应包含要求。” 尽管表格或图表的脚注可能是要求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T06:14:08.777

第一个应该保证是真的：`std::numeric_limits<int>::max() == INT_MAX`.

但是，对于 unsigned long long，没有任何保证，因为编译器/库不需要支持它们。但...

如果您的编译器和库支持 unsigned long long，它应该是相等的，因为无论您如何询问，类型的限制都是相同的。

是的，这是一个合理的假设。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T11:31:10.310

C++ 中显然不能保证 long long 数据类型，因为 long long 数据类型在 C++ 中尚不存在。它们的行为方式（如果存在以及何时存在）取决于编译器，并且应该由编译器记录。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T06:18:16.583

虽然据我所知，它不是任何一个标准的一部分，但它肯定是一个合理的假设，特别是如果您拥有来自同一套件或供应商的编译器。例如，G++ 4.3 仅使用`<limits>`in 中的 #defined 值`<climits>`。

# c# - 如何找到引用数据类型

> ID：653154
> 
> 赞同：1
> 
> 时间：2009-03-17T06:08:06.060
> 
> 标签：c#

public static void Refer(ref int a,ref int b)
在这我如何发现这些变量是程序引用变量..我如何找到它们的类型

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T06:29:11.080

你的意思是你想通过反射知道方法参数是by-ref吗？

您用于[`MethodBase.GetParameters`](http://msdn.microsoft.com/en-us/library/system.reflection.methodbase.getparameters.aspx)获取方法的参数，然后[`ParameterInfo.ParameterType`](http://msdn.microsoft.com/en-us/library/system.reflection.parameterinfo.parametertype.aspx)查找参数的类型并[`Type.IsByRef`](http://msdn.microsoft.com/en-us/library/system.type.isbyref.aspx)检查它是否通过引用传递。

这是一个简单的例子：

```
using System;
using System.Reflection;

public class Test
{
    public static void Refer(ref int a,ref int b)
    {
    }

    static void Main()
    {
        MethodInfo method = typeof(Test).GetMethod("Refer");
        ParameterInfo[] parameters = method.GetParameters();
        foreach (ParameterInfo parameter in parameters)
        {
            Console.WriteLine("{0} is ref? {1}",
                              parameter.Name,
                              parameter.ParameterType.IsByRef);
        }
    }
} 
```

`a.GetType()`对于使用or`typeof(a)`等​​的变量，您不能以“强”的方式执行此操作。`GetType()`找到 的*值*的类型`a`，这只是一个`int`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T06:16:21.593

由于 C# 是强类型的，因此您可以`int`安全地使用任何方法，`a`并且`b`必须是`ints`. 但是，如果您`Type`在运行时需要，请使用[`typeof`](http://msdn.microsoft.com/en-us/library/58918ffs.aspx)运算符。

```
Type intType = typeof(a); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T06:31:57.593

您在 parameterInfo.ParameterType 上有[IsByRef](http://msdn.microsoft.com/en-us/library/system.type.isbyref.aspx)属性。

```
MethodInfo refer = typeof(MyClass).GetMethod("Refer");
ParameterInfo [] parameters = refer.GetParameters();
foreach (ParameterInfo parameter in parameters)
{
        Console.WriteLine("Parameter: {0}, Type: {1}, ByRef: {2}", parameter.Name,
        parameter.ParameterType.Name,
        parameter.ParameterType.IsByRef);
} 
```

# string-matching - 一种更好的变长字符串相似度排序算法

> ID：653157
> 
> 赞同：158
> 
> 时间：2009-03-17T06:10:48.457
> 
> 标签：string-matching, ranking, similarity, fuzzy-search

我正在寻找一种字符串相似性算法，它在可变长度字符串上产生比通常建议的更好的结果（levenshtein distance、soundex 等）。

例如，

给定字符串 A：“Robert”，

然后是字符串 B：“Amy Robertson”

会比

字符串 C：“理查德”

此外，最好该算法应该与语言无关（也适用于英语以外的语言）。

* * *

## 回答 #1

> 赞同：159
> 
> 时间：2009-03-17T06:15:31.830

Catalysoft 的 Simon White 写了一篇关于比较相邻字符对的非常聪明的算法的文章，该算法非常适合我的目的：

[http://www.catalysoft.com/articles/StrikeAMatch.html](http://www.catalysoft.com/articles/StrikeAMatch.html)

Simon 有一个 Java 版本的算法，下面我写了一个 PL/Ruby 版本（取自 Mark Wong-VanHaren 在相关论坛条目评论中完成的普通 ruby​​ 版本），以便我可以在我的 PostgreSQL 查询中使用它：

```
CREATE FUNCTION string_similarity(str1 varchar, str2 varchar)
RETURNS float8 AS '

str1.downcase! 
pairs1 = (0..str1.length-2).collect {|i| str1[i,2]}.reject {
  |pair| pair.include? " "}
str2.downcase! 
pairs2 = (0..str2.length-2).collect {|i| str2[i,2]}.reject {
  |pair| pair.include? " "}
union = pairs1.size + pairs2.size 
intersection = 0 
pairs1.each do |p1| 
  0.upto(pairs2.size-1) do |i| 
    if p1 == pairs2[i] 
      intersection += 1 
      pairs2.slice!(i) 
      break 
    end 
  end 
end 
(2.0 * intersection) / union

' LANGUAGE 'plruby'; 
```

奇迹般有效！

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2009-11-02T21:14:06.863

[marzagao的回答](https://stackoverflow.com/a/653165/2607840)很棒。我将它转换为 C#，所以我想我会把它贴在这里：

[Pastebin 链接](http://pastebin.com/EfcmR3Xx)

```
/// <summary>
/// This class implements string comparison algorithm
/// based on character pair similarity
/// Source: http://www.catalysoft.com/articles/StrikeAMatch.html
/// </summary>
public class SimilarityTool
{
    /// <summary>
    /// Compares the two strings based on letter pair matches
    /// </summary>
    /// <param name="str1"></param>
    /// <param name="str2"></param>
    /// <returns>The percentage match from 0.0 to 1.0 where 1.0 is 100%</returns>
    public double CompareStrings(string str1, string str2)
    {
        List<string> pairs1 = WordLetterPairs(str1.ToUpper());
        List<string> pairs2 = WordLetterPairs(str2.ToUpper());

        int intersection = 0;
        int union = pairs1.Count + pairs2.Count;

        for (int i = 0; i < pairs1.Count; i++)
        {
            for (int j = 0; j < pairs2.Count; j++)
            {
                if (pairs1[i] == pairs2[j])
                {
                    intersection++;
                    pairs2.RemoveAt(j);//Must remove the match to prevent "GGGG" from appearing to match "GG" with 100% success

                    break;
                }
            }
        }

        return (2.0 * intersection) / union;
    }

    /// <summary>
    /// Gets all letter pairs for each
    /// individual word in the string
    /// </summary>
    /// <param name="str"></param>
    /// <returns></returns>
    private List<string> WordLetterPairs(string str)
    {
        List<string> AllPairs = new List<string>();

        // Tokenize the string and put the tokens/words into an array
        string[] Words = Regex.Split(str, @"\s");

        // For each word
        for (int w = 0; w < Words.Length; w++)
        {
            if (!string.IsNullOrEmpty(Words[w]))
            {
                // Find the pairs of characters
                String[] PairsInWord = LetterPairs(Words[w]);

                for (int p = 0; p < PairsInWord.Length; p++)
                {
                    AllPairs.Add(PairsInWord[p]);
                }
            }
        }

        return AllPairs;
    }

    /// <summary>
    /// Generates an array containing every 
    /// two consecutive letters in the input string
    /// </summary>
    /// <param name="str"></param>
    /// <returns></returns>
    private string[] LetterPairs(string str)
    {
        int numPairs = str.Length - 1;

        string[] pairs = new string[numPairs];

        for (int i = 0; i < numPairs; i++)
        {
            pairs[i] = str.Substring(i, 2);
        }

        return pairs;
    }
} 
```

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2011-07-28T13:18:52.397

这是[marzagao](https://stackoverflow.com/users/10997/marzagao)答案的另一个版本，这个是用Python编写的：

```
def get_bigrams(string):
    """
    Take a string and return a list of bigrams.
    """
    s = string.lower()
    return [s[i:i+2] for i in list(range(len(s) - 1))]

def string_similarity(str1, str2):
    """
    Perform bigram comparison between two strings
    and return a percentage match in decimal form.
    """
    pairs1 = get_bigrams(str1)
    pairs2 = get_bigrams(str2)
    union  = len(pairs1) + len(pairs2)
    hit_count = 0
    for x in pairs1:
        for y in pairs2:
            if x == y:
                hit_count += 1
                break
    return (2.0 * hit_count) / union

if __name__ == "__main__":
    """
    Run a test using the example taken from:
    http://www.catalysoft.com/articles/StrikeAMatch.html
    """
    w1 = 'Healed'
    words = ['Heard', 'Healthy', 'Help', 'Herded', 'Sealed', 'Sold']

    for w2 in words:
        print('Healed --- ' + w2)
        print(string_similarity(w1, w2))
        print() 
```

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2013-01-31T17:07:59.920

[约翰·拉特利奇](https://stackoverflow.com/a/6859596/5813544)答案的简短版本：

```
def get_bigrams(string):
    '''
    Takes a string and returns a list of bigrams
    '''
    s = string.lower()
    return {s[i:i+2] for i in xrange(len(s) - 1)}

def string_similarity(str1, str2):
    '''
    Perform bigram comparison between two strings
    and return a percentage match in decimal form
    '''
    pairs1 = get_bigrams(str1)
    pairs2 = get_bigrams(str2)
    return (2.0 * len(pairs1 & pairs2)) / (len(pairs1) + len(pairs2)) 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2012-09-04T11:43:27.910

这是我建议的 StrikeAMatch 算法的 PHP 实现，作者 Simon White。优点（如链接中所说）是：

*   **词汇相似性的真实反映**——差异很小的字符串应该被认为是相似的。特别是，显着的子字符串重叠应该指向字符串之间的高度相似性。

*   **对词序变化的鲁棒性**——包含相同词但顺序不同的两个字符串应该被认为是相似的。另一方面，如果一个字符串只是另一个字符串中包含的字符的随机字谜，那么它应该（通常）被认为是不同的。

*   **语言独立性**——该算法不仅适用于英语，而且适用于许多不同的语言。

```
<?php
/**
 * LetterPairSimilarity algorithm implementation in PHP
 * @author Igal Alkon
 * @link http://www.catalysoft.com/articles/StrikeAMatch.html
 */
class LetterPairSimilarity
{
    /**
     * @param $str
     * @return mixed
     */
    private function wordLetterPairs($str)
    {
        $allPairs = array();

        // Tokenize the string and put the tokens/words into an array

        $words = explode(' ', $str);

        // For each word
        for ($w = 0; $w < count($words); $w++)
        {
            // Find the pairs of characters
            $pairsInWord = $this->letterPairs($words[$w]);

            for ($p = 0; $p < count($pairsInWord); $p++)
            {
                $allPairs[] = $pairsInWord[$p];
            }
        }

        return $allPairs;
    }

    /**
     * @param $str
     * @return array
     */
    private function letterPairs($str)
    {
        $numPairs = mb_strlen($str)-1;
        $pairs = array();

        for ($i = 0; $i < $numPairs; $i++)
        {
            $pairs[$i] = mb_substr($str,$i,2);
        }

        return $pairs;
    }

    /**
     * @param $str1
     * @param $str2
     * @return float
     */
    public function compareStrings($str1, $str2)
    {
        $pairs1 = $this->wordLetterPairs(strtoupper($str1));
        $pairs2 = $this->wordLetterPairs(strtoupper($str2));

        $intersection = 0;

        $union = count($pairs1) + count($pairs2);

        for ($i=0; $i < count($pairs1); $i++)
        {
            $pair1 = $pairs1[$i];

            $pairs2 = array_values($pairs2);
            for($j = 0; $j < count($pairs2); $j++)
            {
                $pair2 = $pairs2[$j];
                if ($pair1 === $pair2)
                {
                    $intersection++;
                    unset($pairs2[$j]);
                    break;
                }
            }
        }

        return (2.0*$intersection)/$union;
    }
} 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2010-09-13T05:10:46.467

这个讨论真的很有帮助，谢谢。我将算法转换为 VBA 以便与 Excel 一起使用，并编写了几个版本的工作表函数，一个用于简单比较一对字符串，另一个用于将一个字符串与一个字符串范围/字符串数组进行比较。strSimLookup 版本将最后一个最佳匹配作为字符串、数组索引或相似度度量返回。

此实现产生的结果与 Simon White 网站上的亚马逊示例中列出的结果相同，但在低分比赛中存在一些小例外；不确定差异在哪里蔓延，可能是 VBA 的 Split 函数，但我没有调查，因为它对我的目的工作正常。

```
'Implements functions to rate how similar two strings are on
'a scale of 0.0 (completely dissimilar) to 1.0 (exactly similar)
'Source:   http://www.catalysoft.com/articles/StrikeAMatch.html
'Author: Bob Chatham, bob.chatham at gmail.com
'9/12/2010

Option Explicit

Public Function stringSimilarity(str1 As String, str2 As String) As Variant
'Simple version of the algorithm that computes the similiarity metric
'between two strings.
'NOTE: This verision is not efficient to use if you're comparing one string
'with a range of other values as it will needlessly calculate the pairs for the
'first string over an over again; use the array-optimized version for this case.

    Dim sPairs1 As Collection
    Dim sPairs2 As Collection

    Set sPairs1 = New Collection
    Set sPairs2 = New Collection

    WordLetterPairs str1, sPairs1
    WordLetterPairs str2, sPairs2

    stringSimilarity = SimilarityMetric(sPairs1, sPairs2)

    Set sPairs1 = Nothing
    Set sPairs2 = Nothing

End Function

Public Function strSimA(str1 As Variant, rRng As Range) As Variant
'Return an array of string similarity indexes for str1 vs every string in input range rRng
    Dim sPairs1 As Collection
    Dim sPairs2 As Collection
    Dim arrOut As Variant
    Dim l As Long, j As Long

    Set sPairs1 = New Collection

    WordLetterPairs CStr(str1), sPairs1

    l = rRng.Count
    ReDim arrOut(1 To l)
    For j = 1 To l
        Set sPairs2 = New Collection
        WordLetterPairs CStr(rRng(j)), sPairs2
        arrOut(j) = SimilarityMetric(sPairs1, sPairs2)
        Set sPairs2 = Nothing
    Next j

    strSimA = Application.Transpose(arrOut)

End Function

Public Function strSimLookup(str1 As Variant, rRng As Range, Optional returnType) As Variant
'Return either the best match or the index of the best match
'depending on returnTYype parameter) between str1 and strings in rRng)
' returnType = 0 or omitted: returns the best matching string
' returnType = 1           : returns the index of the best matching string
' returnType = 2           : returns the similarity metric

    Dim sPairs1 As Collection
    Dim sPairs2 As Collection
    Dim metric, bestMetric As Double
    Dim i, iBest As Long
    Const RETURN_STRING As Integer = 0
    Const RETURN_INDEX As Integer = 1
    Const RETURN_METRIC As Integer = 2

    If IsMissing(returnType) Then returnType = RETURN_STRING

    Set sPairs1 = New Collection

    WordLetterPairs CStr(str1), sPairs1

    bestMetric = -1
    iBest = -1

    For i = 1 To rRng.Count
        Set sPairs2 = New Collection
        WordLetterPairs CStr(rRng(i)), sPairs2
        metric = SimilarityMetric(sPairs1, sPairs2)
        If metric > bestMetric Then
            bestMetric = metric
            iBest = i
        End If
        Set sPairs2 = Nothing
    Next i

    If iBest = -1 Then
        strSimLookup = CVErr(xlErrValue)
        Exit Function
    End If

    Select Case returnType
    Case RETURN_STRING
        strSimLookup = CStr(rRng(iBest))
    Case RETURN_INDEX
        strSimLookup = iBest
    Case Else
        strSimLookup = bestMetric
    End Select

End Function

Public Function strSim(str1 As String, str2 As String) As Variant
    Dim ilen, iLen1, ilen2 As Integer

    iLen1 = Len(str1)
    ilen2 = Len(str2)

    If iLen1 >= ilen2 Then ilen = ilen2 Else ilen = iLen1

    strSim = stringSimilarity(Left(str1, ilen), Left(str2, ilen))

End Function

Sub WordLetterPairs(str As String, pairColl As Collection)
'Tokenize str into words, then add all letter pairs to pairColl

    Dim Words() As String
    Dim word, nPairs, pair As Integer

    Words = Split(str)

    If UBound(Words) < 0 Then
        Set pairColl = Nothing
        Exit Sub
    End If

    For word = 0 To UBound(Words)
        nPairs = Len(Words(word)) - 1
        If nPairs > 0 Then
            For pair = 1 To nPairs
                pairColl.Add Mid(Words(word), pair, 2)
            Next pair
        End If
    Next word

End Sub

Private Function SimilarityMetric(sPairs1 As Collection, sPairs2 As Collection) As Variant
'Helper function to calculate similarity metric given two collections of letter pairs.
'This function is designed to allow the pair collections to be set up separately as needed.
'NOTE: sPairs2 collection will be altered as pairs are removed; copy the collection
'if this is not the desired behavior.
'Also assumes that collections will be deallocated somewhere else

    Dim Intersect As Double
    Dim Union As Double
    Dim i, j As Long

    If sPairs1.Count = 0 Or sPairs2.Count = 0 Then
        SimilarityMetric = CVErr(xlErrNA)
        Exit Function
    End If

    Union = sPairs1.Count + sPairs2.Count
    Intersect = 0

    For i = 1 To sPairs1.Count
        For j = 1 To sPairs2.Count
            If StrComp(sPairs1(i), sPairs2(j)) = 0 Then
                Intersect = Intersect + 1
                sPairs2.Remove j
                Exit For
            End If
        Next j
    Next i

    SimilarityMetric = (2 * Intersect) / Union

End Function 
```

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2015-02-26T13:51:24.540

对不起，答案不是作者发明的。这是一种众所周知的算法，最早由 Digital Equipment Corporation 提出，通常被称为 shingling。

[http://www.hpl.hp.com/techreports/Compaq-DEC/SRC-TN-1997-015.pdf](http://www.hpl.hp.com/techreports/Compaq-DEC/SRC-TN-1997-015.pdf)

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2011-11-20T17:50:36.103

我将 Simon White 的算法翻译成 PL/pgSQL。这是我的贡献。

```
<!-- language: lang-sql -->

create or replace function spt1.letterpairs(in p_str varchar) 
returns varchar  as 
$$
declare

    v_numpairs integer := length(p_str)-1;
    v_pairs varchar[];

begin

    for i in 1 .. v_numpairs loop
        v_pairs[i] := substr(p_str, i, 2);
    end loop;

    return v_pairs;

end;
$$ language 'plpgsql';

--===================================================================

create or replace function spt1.wordletterpairs(in p_str varchar) 
returns varchar as
$$
declare
    v_allpairs varchar[];
    v_words varchar[];
    v_pairsinword varchar[];
begin
    v_words := regexp_split_to_array(p_str, '[[:space:]]');

    for i in 1 .. array_length(v_words, 1) loop
        v_pairsinword := spt1.letterpairs(v_words[i]);

        if v_pairsinword is not null then
            for j in 1 .. array_length(v_pairsinword, 1) loop
                v_allpairs := v_allpairs || v_pairsinword[j];
            end loop;
        end if;

    end loop;

    return v_allpairs;
end;
$$ language 'plpgsql';

--===================================================================

create or replace function spt1.arrayintersect(ANYARRAY, ANYARRAY)
returns anyarray as 
$$
    select array(select unnest($1) intersect select unnest($2))
$$ language 'sql';

--===================================================================

create or replace function spt1.comparestrings(in p_str1 varchar, in p_str2 varchar)
returns float as
$$
declare
    v_pairs1 varchar[];
    v_pairs2 varchar[];
    v_intersection integer;
    v_union integer;
begin
    v_pairs1 := wordletterpairs(upper(p_str1));
    v_pairs2 := wordletterpairs(upper(p_str2));
    v_union := array_length(v_pairs1, 1) + array_length(v_pairs2, 1); 

    v_intersection := array_length(arrayintersect(v_pairs1, v_pairs2), 1);

    return (2.0 * v_intersection / v_union);
end;
$$ language 'plpgsql'; 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2013-06-03T14:10:59.927

漂亮的 Scala 版本：

```
 def pairDistance(s1: String, s2: String): Double = {

    def strToPairs(s: String, acc: List[String]): List[String] = {
      if (s.size < 2) acc
      else strToPairs(s.drop(1),
        if (s.take(2).contains(" ")) acc else acc ::: List(s.take(2)))
    }

    val lst1 = strToPairs(s1.toUpperCase, List())
    val lst2 = strToPairs(s2.toUpperCase, List())

    (2.0 * lst2.intersect(lst1).size) / (lst1.size + lst2.size)

  } 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2009-03-17T07:22:48.300

[字符串相似度度量](http://www.dcs.shef.ac.uk/~sam/stringmetrics.html)包含字符串比较中使用的许多不同度量的概述（[维基百科](http://en.wikipedia.org/wiki/String_metric)也有概述）。这些指标中的大部分都是在库[simmetrics](http://sourceforge.net/projects/simmetrics/)中实现的。

未包含在给定概述中的另一个度量示例是[压缩距离](http://www.c-sharpcorner.com/UploadFile/acinonyx72/NCD01202009071004AM/NCD.aspx)（试图近似[Kolmogorov 的复杂性](http://en.wikipedia.org/wiki/Kolmogorov_complexity)），它可用于比您提供的文本更长的文本。

您还可以考虑查看更广泛的[自然语言处理](http://en.wikipedia.org/wiki/Natural_language_processing)主题。[这些](http://cran.r-project.org/web/views/NaturalLanguageProcessing.html)R 包可以让您快速入门（或至少提供一些想法）。

最后一次编辑 - 在 SO 上搜索有关此主题的其他问题，有很多相关问题。

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2013-03-14T13:20:36.813

该算法的更快的 PHP 版本：

```
/**
 *
 * @param $str
 * @return mixed
 */
private static function wordLetterPairs ($str)
{
    $allPairs = array();

    // Tokenize the string and put the tokens/words into an array

    $words = explode(' ', $str);

    // For each word
    for ($w = 0; $w < count($words); $w ++) {
        // Find the pairs of characters
        $pairsInWord = self::letterPairs($words[$w]);

        for ($p = 0; $p < count($pairsInWord); $p ++) {
            $allPairs[$pairsInWord[$p]] = $pairsInWord[$p];
        }
    }

    return array_values($allPairs);
}

/**
 *
 * @param $str
 * @return array
 */
private static function letterPairs ($str)
{
    $numPairs = mb_strlen($str) - 1;
    $pairs = array();

    for ($i = 0; $i < $numPairs; $i ++) {
        $pairs[$i] = mb_substr($str, $i, 2);
    }

    return $pairs;
}

/**
 *
 * @param $str1
 * @param $str2
 * @return float
 */
public static function compareStrings ($str1, $str2)
{
    $pairs1 = self::wordLetterPairs(mb_strtolower($str1));
    $pairs2 = self::wordLetterPairs(mb_strtolower($str2));

    $union = count($pairs1) + count($pairs2);

    $intersection = count(array_intersect($pairs1, $pairs2));

    return (2.0 * $intersection) / $union;
} 
```

对于我拥有的数据（大约 2300 次比较），我使用[Igal](https://stackoverflow.com/a/12262795/881736) Alkon 解决方案的运行时间为 0.58 秒，而我的运行时间为 0.35 秒。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2014-08-27T11:52:38.107

这是R版本：

```
get_bigrams <- function(str)
{
  lstr = tolower(str)
  bigramlst = list()
  for(i in 1:(nchar(str)-1))
  {
    bigramlst[[i]] = substr(str, i, i+1)
  }
  return(bigramlst)
}

str_similarity <- function(str1, str2)
{
   pairs1 = get_bigrams(str1)
   pairs2 = get_bigrams(str2)
   unionlen  = length(pairs1) + length(pairs2)
   hit_count = 0
   for(x in 1:length(pairs1)){
        for(y in 1:length(pairs2)){
            if (pairs1[[x]] == pairs2[[y]])
                hit_count = hit_count + 1
        }
   }
   return ((2.0 * hit_count) / unionlen)
} 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2015-09-06T03:38:34.797

[受这些](https://en.wikibooks.org/wiki/Algorithm_Implementation/Strings/Dice's_coefficient)算法的启发，在 C99 中发布[marzagao 的答案](https://stackoverflow.com/a/653165/2607840)

```
double dice_match(const char *string1, const char *string2) {

    //check fast cases
    if (((string1 != NULL) && (string1[0] == '\0')) || 
        ((string2 != NULL) && (string2[0] == '\0'))) {
        return 0;
    }
    if (string1 == string2) {
        return 1;
    }

    size_t strlen1 = strlen(string1);
    size_t strlen2 = strlen(string2);
    if (strlen1 < 2 || strlen2 < 2) {
        return 0;
    }

    size_t length1 = strlen1 - 1;
    size_t length2 = strlen2 - 1;

    double matches = 0;
    int i = 0, j = 0;

    //get bigrams and compare
    while (i < length1 && j < length2) {
        char a[3] = {string1[i], string1[i + 1], '\0'};
        char b[3] = {string2[j], string2[j + 1], '\0'};
        int cmp = strcmpi(a, b);
        if (cmp == 0) {
            matches += 2;
        }
        i++;
        j++;
    }

    return matches / (length1 + length2);
} 
```

基于[原始文章](http://www.catalysoft.com/articles/strikeamatch.html)的一些测试：

```
#include <stdio.h>

void article_test1() {
    char *string1 = "FRANCE";
    char *string2 = "FRENCH";
    printf("====%s====\n", __func__);
    printf("%2.f%% == 40%%\n", dice_match(string1, string2) * 100);
}

void article_test2() {
    printf("====%s====\n", __func__);
    char *string = "Healed";
    char *ss[] = {"Heard", "Healthy", "Help",
                  "Herded", "Sealed", "Sold"};
    int correct[] = {44, 55, 25, 40, 80, 0};
    for (int i = 0; i < 6; ++i) {
        printf("%2.f%% == %d%%\n", dice_match(string, ss[i]) * 100, correct[i]);
    }
}

void multicase_test() {
    char *string1 = "FRaNcE";
    char *string2 = "fREnCh";
    printf("====%s====\n", __func__);
    printf("%2.f%% == 40%%\n", dice_match(string1, string2) * 100);

}

void gg_test() {
    char *string1 = "GG";
    char *string2 = "GGGGG";
    printf("====%s====\n", __func__);
    printf("%2.f%% != 100%%\n", dice_match(string1, string2) * 100);
}

int main() {
    article_test1();
    article_test2();
    multicase_test();
    gg_test();

    return 0;
} 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2013-07-12T16:09:56.900

我的 JavaScript 实现采用一个字符串或字符串数​​组，以及一个可选的下限（默认下限为 0.5）。如果你传递一个字符串，它会根据字符串的相似度分数是否大于或等于下限返回真或假。如果你传递一个字符串数组，它将返回一个由相似度分数大于或等于下限的字符串组成的数组，按分数排序。

例子：

```
'Healed'.fuzzy('Sealed');      // returns true
'Healed'.fuzzy('Help');        // returns false
'Healed'.fuzzy('Help', 0.25);  // returns true

'Healed'.fuzzy(['Sold', 'Herded', 'Heard', 'Help', 'Sealed', 'Healthy']);
// returns ["Sealed", "Healthy"]

'Healed'.fuzzy(['Sold', 'Herded', 'Heard', 'Help', 'Sealed', 'Healthy'], 0);
// returns ["Sealed", "Healthy", "Heard", "Herded", "Help", "Sold"] 
```

这里是：

```
(function(){
  var default_floor = 0.5;

  function pairs(str){
    var pairs = []
      , length = str.length - 1
      , pair;
    str = str.toLowerCase();
    for(var i = 0; i < length; i++){
      pair = str.substr(i, 2);
      if(!/\s/.test(pair)){
        pairs.push(pair);
      }
    }
    return pairs;
  }

  function similarity(pairs1, pairs2){
    var union = pairs1.length + pairs2.length
      , hits = 0;

    for(var i = 0; i < pairs1.length; i++){
      for(var j = 0; j < pairs2.length; j++){
        if(pairs1[i] == pairs2[j]){
          pairs2.splice(j--, 1);
          hits++;
          break;
        }
      }
    }
    return 2*hits/union || 0;
  }

  String.prototype.fuzzy = function(strings, floor){
    var str1 = this
      , pairs1 = pairs(this);

    floor = typeof floor == 'number' ? floor : default_floor;

    if(typeof(strings) == 'string'){
      return str1.length > 1 && strings.length > 1 && similarity(pairs1, pairs(strings)) >= floor || str1.toLowerCase() == strings.toLowerCase();
    }else if(strings instanceof Array){
      var scores = {};

      strings.map(function(str2){
        scores[str2] = str1.length > 1 ? similarity(pairs1, pairs(str2)) : 1*(str1.toLowerCase() == str2.toLowerCase());
      });

      return strings.filter(function(str){
        return scores[str] >= floor;
      }).sort(function(a, b){
        return scores[b] - scores[a];
      });
    }
  };
})(); 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2013-08-11T22:46:01.180

基于 Michael La Voie 的出色 C# 版本，根据将其设为扩展方法的请求，这就是我想出的。这样做的主要好处是您可以按匹配百分比对通用列表进行排序。例如，假设您的对象中有一个名为“City”的字符串字段。用户搜索“Chester”，您希望按匹配的降序返回结果。例如，您希望 Chester 的文字匹配显示在 Rochester 之前。为此，请向您的对象添加两个新属性：

```
 public string SearchText { get; set; }
    public double PercentMatch
    {
        get
        {
            return City.ToUpper().PercentMatchTo(this.SearchText.ToUpper());
        }
    } 
```

然后在每个对象上，将 SearchText 设置为用户搜索的内容。然后，您可以使用以下内容轻松对其进行排序：

```
 zipcodes = zipcodes.OrderByDescending(x => x.PercentMatch); 
```

这是使其成为扩展方法的轻微修改：

```
 /// <summary>
    /// This class implements string comparison algorithm
    /// based on character pair similarity
    /// Source: http://www.catalysoft.com/articles/StrikeAMatch.html
    /// </summary>
    public static double PercentMatchTo(this string str1, string str2)
    {
        List<string> pairs1 = WordLetterPairs(str1.ToUpper());
        List<string> pairs2 = WordLetterPairs(str2.ToUpper());

        int intersection = 0;
        int union = pairs1.Count + pairs2.Count;

        for (int i = 0; i < pairs1.Count; i++)
        {
            for (int j = 0; j < pairs2.Count; j++)
            {
                if (pairs1[i] == pairs2[j])
                {
                    intersection++;
                    pairs2.RemoveAt(j);//Must remove the match to prevent "GGGG" from appearing to match "GG" with 100% success

                    break;
                }
            }
        }

        return (2.0 * intersection) / union;
    }

    /// <summary>
    /// Gets all letter pairs for each
    /// individual word in the string
    /// </summary>
    /// <param name="str"></param>
    /// <returns></returns>
    private static List<string> WordLetterPairs(string str)
    {
        List<string> AllPairs = new List<string>();

        // Tokenize the string and put the tokens/words into an array
        string[] Words = Regex.Split(str, @"\s");

        // For each word
        for (int w = 0; w < Words.Length; w++)
        {
            if (!string.IsNullOrEmpty(Words[w]))
            {
                // Find the pairs of characters
                String[] PairsInWord = LetterPairs(Words[w]);

                for (int p = 0; p < PairsInWord.Length; p++)
                {
                    AllPairs.Add(PairsInWord[p]);
                }
            }
        }

        return AllPairs;
    }

    /// <summary>
    /// Generates an array containing every 
    /// two consecutive letters in the input string
    /// </summary>
    /// <param name="str"></param>
    /// <returns></returns>
    private static  string[] LetterPairs(string str)
    {
        int numPairs = str.Length - 1;

        string[] pairs = new string[numPairs];

        for (int i = 0; i < numPairs; i++)
        {
            pairs[i] = str.Substring(i, 2);
        }

        return pairs;
    } 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2012-11-29T01:28:25.920

Dice 系数算法（Simon White / marzagao 的答案）在 Ruby 中的 amatch gem 中的 pair_distance_similar 方法中实现

[https://github.com/flori/amatch](https://github.com/flori/amatch)

该 gem 还包含许多近似匹配和字符串比较算法的实现：Levenshtein 编辑距离、Sellers 编辑距离、Hamming 距离、最长公共子序列长度、最长公共子串长度、对距离度量、Jaro-Winkler 度量.

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2015-01-09T08:44:20.843

Haskell 版本——请随意提出修改建议，因为我没有做过多少 Haskell。

```
import Data.Char
import Data.List

-- Convert a string into words, then get the pairs of words from that phrase
wordLetterPairs :: String -> [String]
wordLetterPairs s1 = concat $ map pairs $ words s1

-- Converts a String into a list of letter pairs.
pairs :: String -> [String]
pairs [] = []
pairs (x:[]) = []
pairs (x:ys) = [x, head ys]:(pairs ys)

-- Calculates the match rating for two strings
matchRating :: String -> String -> Double
matchRating s1 s2 = (numberOfMatches * 2) / totalLength
  where pairsS1 = wordLetterPairs $ map toLower s1
        pairsS2 = wordLetterPairs $ map toLower s2
        numberOfMatches = fromIntegral $ length $ pairsS1 `intersect` pairsS2
        totalLength = fromIntegral $ length pairsS1 + length pairsS2 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2015-05-03T13:50:10.517

Clojure：

```
(require '[clojure.set :refer [intersection]])

(defn bigrams [s]
  (->> (split s #"\s+")
       (mapcat #(partition 2 1 %))
       (set)))

(defn string-similarity [a b]
  (let [a-pairs (bigrams a)
        b-pairs (bigrams b)
        total-count (+ (count a-pairs) (count b-pairs))
        match-count (count (intersection a-pairs b-pairs))
        similarity (/ (* 2 match-count) total-count)]
    similarity)) 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-03-17T06:46:19.587

Levenshtein 距离除以第一个字符串的长度（或者除以我的两个字符串的最小/最大/平均长度）怎么样？到目前为止，这对我有用。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2012-01-13T14:19:25.253

嘿伙计们，我在 javascript 中试了一下，但我是新手，有人知道更快的方法吗？

```
function get_bigrams(string) {
    // Takes a string and returns a list of bigrams
    var s = string.toLowerCase();
    var v = new Array(s.length-1);
    for (i = 0; i< v.length; i++){
        v[i] =s.slice(i,i+2);
    }
    return v;
}

function string_similarity(str1, str2){
    /*
    Perform bigram comparison between two strings
    and return a percentage match in decimal form
    */
    var pairs1 = get_bigrams(str1);
    var pairs2 = get_bigrams(str2);
    var union = pairs1.length + pairs2.length;
    var hit_count = 0;
    for (x in pairs1){
        for (y in pairs2){
            if (pairs1[x] == pairs2[y]){
                hit_count++;
            }
        }
    }
    return ((2.0 * hit_count) / union);
}

var w1 = 'Healed';
var word =['Heard','Healthy','Help','Herded','Sealed','Sold']
for (w2 in word){
    console.log('Healed --- ' + word[w2])
    console.log(string_similarity(w1,word[w2]));
} 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2016-07-11T18:57:32.077

这是基于 Sørensen–Dice 索引（marzagao 的答案）的另一个版本的相似性，这是用 C++11 编写的：

```
/*
 * Similarity based in Sørensen–Dice index.
 *
 * Returns the Similarity between _str1 and _str2.
 */
double similarity_sorensen_dice(const std::string& _str1, const std::string& _str2) {
    // Base case: if some string is empty.
    if (_str1.empty() || _str2.empty()) {
        return 1.0;
    }

    auto str1 = upper_string(_str1);
    auto str2 = upper_string(_str2);

    // Base case: if the strings are equals.
    if (str1 == str2) {
        return 0.0;
    }

    // Base case: if some string does not have bigrams.
    if (str1.size() < 2 || str2.size() < 2) {
        return 1.0;
    }

    // Extract bigrams from str1
    auto num_pairs1 = str1.size() - 1;
    std::unordered_set<std::string> str1_bigrams;
    str1_bigrams.reserve(num_pairs1);
    for (unsigned i = 0; i < num_pairs1; ++i) {
        str1_bigrams.insert(str1.substr(i, 2));
    }

    // Extract bigrams from str2
    auto num_pairs2 = str2.size() - 1;
    std::unordered_set<std::string> str2_bigrams;
    str2_bigrams.reserve(num_pairs2);
    for (unsigned int i = 0; i < num_pairs2; ++i) {
        str2_bigrams.insert(str2.substr(i, 2));
    }

    // Find the intersection between the two sets.
    int intersection = 0;
    if (str1_bigrams.size() < str2_bigrams.size()) {
        const auto it_e = str2_bigrams.end();
        for (const auto& bigram : str1_bigrams) {
            intersection += str2_bigrams.find(bigram) != it_e;
        }
    } else {
        const auto it_e = str1_bigrams.end();
        for (const auto& bigram : str2_bigrams) {
            intersection += str1_bigrams.find(bigram) != it_e;
        }
    }

    // Returns similarity coefficient.
    return (2.0 * intersection) / (num_pairs1 + num_pairs2);
} 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2016-12-01T05:30:27.767

我正在寻找@marzagao 的答案所指示的算法的纯红宝石实现。不幸的是，@marzagao 指示的链接已损坏。在@s01ipsist 的回答中，他指出 ruby​​ gem [amatch](https://github.com/flori/amatch)的实现不在纯 ruby​​ 中。所以我搜索了一下，发现[gemfuzzy_match在](https://github.com/seamusabshere/fuzzy_match)[这里](https://github.com/seamusabshere/fuzzy_match/blob/master/lib/fuzzy_match/score/pure_ruby.rb)有纯 ruby​​ 实现（虽然这个 gem 使用`amatch`）。我希望这会帮助像我这样的人。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2021-03-31T17:29:28.150

为什么不针对 JavaScript 实现，我还解释了算法。

### 算法

*   输入：`France`和`French`。
*   将它们都映射到它们的大写字符（使算法对大小写差异不敏感），然后将它们分成它们的字符对：

```
FRANCE: {FR, RA, AN, NC, CE}
FRENCH: {FR, RE, EN, NC, CH} 
```

*   找到那里的交叉点：

> ![路口](https://i.stack.imgur.com/MKOKn.gif)

*   结果：

> ![算法](https://i.stack.imgur.com/fKxQX.gif)

### 执行

```
function similarity(s1, s2) {
    const
        set1 = pairs(s1.toUpperCase()), // [ FR, RA, AN, NC, CE ]
        set2 = pairs(s2.toUpperCase()), // [ FR, RE, EN, NC, CH ]
        intersection = set1.filter(x => set2.includes(x)); // [ FR, NC ]
    // Tips: Instead of `2` multiply by `200`, To get percentage.
    return (intersection.length * 2) / (set1.length + set2.length);
}
function pairs(input) {
    const tokenized = [];
    for (let i = 0; i < input.length - 1; i++)
        tokenized.push(input.substring(i, 2 + i));

    return tokenized;
}
console.log(similarity("FRANCE", "FRENCH"));
```

### 排名结果（字 - 相似度）

1.  密封 - 80%
2.  健康 - 55%
3.  听说 - 44%
4.  放牧 - 40%
5.  帮助 - 25%
6.  已售出 - 0%

来自相同的原始[来源](http://www.catalysoft.com/articles/StrikeAMatch.html)。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-01-12T02:07:55.613

```
**I've converted marzagao's answer to Java.**

import org.apache.commons.lang3.StringUtils; //Add a apache commons jar in pom.xml

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

public class SimilarityComparator {
public static void main(String[] args) {
    String str0 = "Nischal";
    String str1 = "Nischal";
    double v = compareStrings(str0, str1);
    System.out.println("Similarity betn " + str0 + " and " + str1 + " = " + v);

}

private static double compareStrings(String str1, String str2) {
    List<String> pairs1 = wordLetterPairs(str1.toUpperCase());
    List<String> pairs2 = wordLetterPairs(str2.toUpperCase());

    int intersection = 0;
    int union = pairs1.size() + pairs2.size();

    for (String s : pairs1) {
        for (int j = 0; j < pairs2.size(); j++) {
            if (s.equals(pairs2.get(j))) {
                intersection++;
                pairs2.remove(j);
                break;
            }
        }
    }
    return (2.0 * intersection) / union;
}

private static List<String> wordLetterPairs(String str) {
    List<String> AllPairs = new ArrayList<>();
    String[] Words = str.split("\\s");
    for (String word : Words) {
        if (StringUtils.isNotBlank(word)) {
            String[] PairsInWord = letterPairs(word);
            Collections.addAll(AllPairs, PairsInWord);
        }
    }
    return AllPairs;
}

private static String[] letterPairs(String str) {
    int numPairs = str.length() - 1;
    String[] pairs = new String[numPairs];
    for (int i = 0; i < numPairs; i++) {
        try {
            pairs[i] = str.substring(i, i + 2);
        } catch (Exception e) {
            pairs[i] = str.substring(i, numPairs);
        }
    }
    return pairs;
  }
} 
```

# xml - XSD：向强类型“简单”元素添加属性

> ID：653158
> 
> 赞同：15
> 
> 时间：2009-03-17T06:11:37.783
> 
> 标签：xml, excel, xsd

是否有一些明智的方法可以让元素具有强类型的简单类型和属性？

好的，我有一个 XSD 架构，其中有一百万（呃，一百）可能看起来像这样的元素：

```
<xsd:element name="DocumentDescription" type="xsd:string" />
<xsd:element name="DocumentDateTime" type="xsd:dateTime" />
<xsd:element name="DocumentSize" type="xsd:int" /> 
```

那是花花公子。但是，我真的希望所有这些元素也有一些共同的属性，比如“格式”和“isVisible”。即有一个像这样的模式：

```
<DocumentDescription isVisible="true">doc description</DocumentDescription>
<DocumentDateTime format="dd/mm/yyyy" isVisible="true">1/1/2008</DocumentDescription>
<DocumentSize format="0.00 KB" isVisible="false">5403</DocumentSize> 
```

我可以手动完成，可怕的是，在生成 XSD 时将所有此类属性添加到 XSD，如下所示：

```
<xsd:element name="DocumentDescription" />
  <xsd:complexType>
    <xsd:simpleContent>
      <xsd:extension base="xsd:string">
        <xsd:attribute name="format" type="xsd:string" />
        <xsd:attribute name="isVisible" type="xsd:boolean" />
      </xsd:extension>
    </xsd:simpleContent>
  </xsd:complexType>
<xsd:element name="DocumentDateTime" />
   ... etc 
```

...但在理想的世界中，我宁愿将其定义为 complexType：

```
<xsd:complexType name="customType">
  <xsd:complexContent>
    <xsd:extension base="???">
      <xsd:attribute name="format" type="xsd:string" />
      <xsd:attribute name="isVisible" type="xsd:boolean" /> 
```

...这意味着我可以这样做：

```
<xsd:element name="DocumentDescription" type="customType" baseType="xsd:string" />
<xsd:element name="DocumentDateTime" type="customType" baseType="xsd:dateTime" />
<xsd:element name="DocumentSize" type="customType" baseType="xsd:int" /> 
```

我的“理想世界”代码的问题在于：

**a）**我没有有效的`<xsd:extension base-"???"`>，因为我真的不在乎我在扩展什么；我想扩展所有类型。似乎“xsd：anyType”是合适的，但是元素变成了弱类型容器，不是吗？

**b)**我不能再在`<xsd:element`> 上指定简单类型，因为现在类型是我定义的复杂“customType”。因此，我放在那里的想象中的“baseType”属性......

那么我可以以一种不笨拙的方式向简单类型添加属性吗？或者我是否需要定义十几个除了它们扩展的简单类型之外都相同的复杂类型？

强类型元素不仅可以更合理地描述数据，而且当我将它们用于 Excel 中的 XML 映射时（这就是这些东西背后的全部目的），强类型意味着 Excel 根据类型正确设置单元格格式.

我可能看错了！任何建议表示赞赏。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-01-24T09:20:14.030

尚不清楚您认为手动解决方案的哪个方面很糟糕；如果只是因为它们需要扩展*n 个不同的基本类型而必须定义**n*个不同的类型，那么你就被困住了。

 *如果它的想法是必须为and属性有*n 个*不同的声明，那么您可能会发现使用命名的属性组来保存这些定义并不那么可怕：`format``isVisible`

```
<xs:attributeGroup name="globals">
  <xs:attribute name="format" type="xs:string"/>
  <xs:attribute name="isVisible" type="xs:boolean"/>
</xs:attributeGroup> 
```

您需要的各种复杂类型的声明仍然是重复的，但现在稍微不那么冗长了：

```
<xs:complexType name="string">
  <xs:simpleContent>
    <xs:extension base="xs:string">
      <xs:attributeGroup ref="my:globals"/>
    </xs:extension>
  </xs:simpleContent>
</xs:complexType>
<xs:complexType name="dateTime">
  <xs:simpleContent>
    <xs:extension base="xs:dateTime">
      <xs:attributeGroup ref="my:globals"/>
    </xs:extension>
  </xs:simpleContent>
</xs:complexType>
<xs:complexType name="int">
  <xs:simpleContent>
    <xs:extension base="xs:int">
      <xs:attributeGroup ref="my:globals"/>
    </xs:extension>
  </xs:simpleContent>
</xs:complexType> 
```

你的元素的声明现在比你的“理想”情况稍微简单一些：

```
<xs:element name="DocumentDescription" type="my:string" />
<xs:element name="DocumentDateTime" type="my:dateTime" />
<xs:element name="DocumentSize" type="my:int" /> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T06:19:34.630

> > [quote]可以手动完成，可怕的是，在我生成 XSD 时将所有这些属性添加到 XSD，如下所示：[/quote]

恐怕这是您唯一的“正确”、兼容 XSD 架构的方式。

XSD 有时可能会让作者感到困惑 - 但它有助于保持安全:-)

马克

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-06-29T12:33:58.300

XSD 的目的是描述您的数据。XSD 的类型属性的目的是描述或定义一个元素。您要做的是更改元素的定义。如果您要更改描述，请更改类型。你试图做的就像给一个想法装上轮子。“但我*希望*我的思想有轮子！” “对不起，没办法。”

# c# - “无法在 dll 中找到名为 [function] 的入口点”（c++ 到 c# 类型转换）

> ID：653178
> 
> 赞同：24
> 
> 时间：2009-03-17T06:26:41.493
> 
> 标签：c#, c++, dll, dllimport, extern

我有一个来自第三方的 dll，它是用 C++ 编写的。以下是来自 dll 文档的一些信息：

```
//start documentation

RECO_DATA{
wchar_t Surname[200];
wchar_t Firstname[200];
} 
```

描述：接收函数结果的数据结构。所有函数结果都将存储为 Unicode (UTF-8)。

方法：

```
bool recoCHN_P_Name(char *imgPath,RECO_DATA *o_data); 
```

输入：

```
char * imgPath 
```

此函数要识别的图像位置的完整路径

```
RECO_DATA * o_data 
```

用于接收函数结果的数据对象。函数返回：成功则返回真，否则返回假。

```
//end documentation 
```

我正在尝试从我的 C# 应用程序中调用 recoCHN_P_Name。为此，我想出了这段代码：

导入dll的代码：

```
 public class cnOCRsdk
{
    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]
    public struct RECO_DATA{
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst=200)]
        public string FirstName;
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 200)]
        public string Surname;
        }

    [DllImport(@"cnOCRsdk.dll", EntryPoint="recoCHN_P_Name")]
    public static extern bool recoCHN_P_Name(byte[] imgPath, RECO_DATA o_data);
} 
```

调用函数的代码：

```
 cnOCRsdk.RECO_DATA recoData = new cnOCRsdk.RECO_DATA();

        string path = @"C:\WINDOWS\twain_32\twainrgb.bmp";

        System.Text.ASCIIEncoding encoding = new System.Text.ASCIIEncoding();
        byte[] bytes = encoding.GetBytes(path);

        bool res = cnOCRsdk.recoCHN_P_Name(bytes, recoData); 
```

我得到的错误是““无法在 DLL 'cnOCRsdk.dll' 中找到名为 'recoCHN_P_Name' 的入口点。”我怀疑我在将类型从 C++ 转换为 C# 时出错。但是究竟在哪里……？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-03-17T06:32:49.947

首先确保函数实际被导出：

在 Visual Studio 命令提示符中，使用`dumpbin /exports whatever.dll`

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-03-17T07:13:44.250

C# 不支持 C++ 名称修改，您要么需要声明 C++ 函数

```
extern "C" {...} 
```

（如果它们来自第三方，则可能不是一个选项），或者如果您可以使其正常工作，则直接调用损坏的名称。让第三方为功能提供未损坏的接口可能更容易。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-03-17T23:09:25.037

解决了 - 至少到程序不会中断并且实际上返回一个布尔值的程度。

我猜，关键是将入口点指定为“损坏的”名称

```
 [DllImport(@"cnOCRsdk.dll", EntryPoint="?recoCHN_P_Name@CcnOCRsdk@@QAE_NPADPAURECO_DATA@@@Z")]
    public static extern bool recoCHN_P_Name(ref string imgPath, ref RECO_DATA o_data); 
```

之后我遇到了一些其他错误，但“无法找到入口点”消失了。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2017-07-21T18:13:50.990

我在这些步骤中解决了同样的问题：

**步骤 1）**如果您使用 Visual Studio 在 C++ 中编写自定义 DLL，则在项目的属性页中将`Common Language Runtime Support (/clr)`参数设置为`Common Language Runtime Support (/clr)`.

**步骤 2）**在`.h`文件中使用`__declspec(dllexport)`如下关键字来实现减速：

```
__declspec(dllexport) double Sum(int a,int b); 
```

**步骤 3)**构建并导出 DLL 文件，然后使用**Dependency Walker**软件获取您的函数**EntryPoint**。

**step4)**在 C# 项目中导入 DLL 文件并设置**EntryPoint**和**CallingConvention**变量，如下所示：

```
[DllImport("custom.dll", EntryPoint = "?Sum@@YAXHHHHHHNNN@Z", CallingConvention = CallingConvention.Cdecl)]

    public static extern double Sum(int a,int b); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-17T08:08:07.207

我会使用 C++/CLI 编写一个包装器。此包装器将能够包含 .h 文件并链接到您从第三方供应商处获得的 .lib 文件。然后，为您的 C# 程序编写托管接口既简单又安全。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-09-24T10:12:24.237

可以在主非托管 dll 随附的“.lib”文件中找到正确的**EntryPoint字符串。**

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-06-14T08:10:04.490

当我们想要访问 DB 并通过将 EF 核心更改为 EF 6.4.4 来解决这个问题时，我们遇到了这个问题。可能是您遇到了这样的问题，需要更改或降级您的 EF 版本（如果您使用过 EF）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-06-14T08:43:19.817

我们遇到了这个问题。我们将 EntityFramework.core 更改为 EntityFrameWork 6.4.4，之后程序运行良好。你最改变的是框架版本。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-03-24T23:00:22.700

您可以在 DllImport 中指定 CallingConvention 时尝试使用未损坏的名称

# drupal-6 - 不显示“用户登录”块

> ID：653184
> 
> 赞同：0
> 
> 时间：2009-03-17T06:30:27.443
> 
> 标签：drupal-6

我不希望为非管理员用户显示用户登录块。

我只希望它显示给管理员用户（在我的例子中是sitadmin，uid：1）和未登录的用户（uid：0）

在块的配置页面 (/admin/build/block/configure/user/0) 中，在页面特定设置下，我选择了“显示以下 PHP 代码是否返回 TRUE（PHP 模式，仅限专家）”。并给出以下代码：

```
<?php
global $user;

if($user->uid===1 or $user->uid===0)
  return TRUE;
else
  return FALSE;

?> 
```

但是，即使对于 uid 3,4 等的用户，它仍然可见。我尝试清除缓存，但无济于事。另一方面，如果我简单地说

```
<?php return FALSE;?> 
```

匿名用户不显示用户块。

注意：角色特定的可见性设置似乎对此没有影响。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T12:04:50.290

也可能是在`$user`数组中，uid 实际上是一个字符串。因此，当您给它时，`===`它也会尝试比较类型。你可以做`$user->uid==="1"`或`$user->uid==1`

编辑：

你也可以尝试检查他们的用户角色

`!in_array('authenticated user', array_values($user->roles))`.

我认为这就是你想要的逻辑。我不确定您是否为登录块定义了除标准行为之外的任何其他内容……它仅在有人未登录时才显示？这和正常有什么区别？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T06:57:39.560

```
<?php   
global $user;

if($user->uid==1 || $user->uid==0)
  return TRUE;
else
  return FALSE;
 ?> 
```

会成功的。

如果您不确定，请始终执行简单的回显并显示该块。例如：

```
<?php   
global $user;

if($user->uid==1)
  echo "Hello world!";
 ?> 
```

# javascript - 我想通过java脚本获取diff Controls Id？？因为可以在表单脚本上添加任何控件将返回控件的类型及其 ID

> ID：653185
> 
> 赞同：0
> 
> 时间：2009-03-17T06:30:30.750
> 
> 标签：javascript

我想通过 java 脚本获取差异控件 ID？用户可以在表单上添加任何控件 java 脚本将返回前文本框、标签及其 ID 的控件类型

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T07:00:42.580

通过控件，我假设您的意思是表单输入控件。要获取元素的 id，您可以调用`.getAttribute('id')`对象。要获取表单元素的类型，请访问“type”属性。

例如，如果您想要`id`页面上第一个表单中输入的属性和类型，其中输入具有`name`属性“title”：

```
var titleInput = document.forms[0].getElementsByName('title')[0];
alert("id = '" + titleInput.getAttribute('id') + "'\ntype = '" = titleInput.type + "'"); 
```

# .net - .net 在 Intranet 中优于 java 的优势

> ID：653190
> 
> 赞同：1
> 
> 时间：2009-03-17T06:34:13.627
> 
> 标签：.net, asp.net-membership, intranet

我们公司拥有一个内联网，其中包含 30,000 多个网页和 160 多个 Web 应用程序。5000 多名员工正在使用它。

我们还拥有 150 多个 Web 应用程序和 100 多个网站的互联网。Internet 和 Intranet 都是 7 年以上，它们运行在经典的 ASP 上。

最近，一些**“技术架构师”**提出了一个从 ASP 迁移到 JAVA 的绝妙想法，结果通常需要 2/3 个月的项目在 java 中需要 6/9 个月。原因是我们有 100 多个可重复使用的定制 VB 组件，而 Java 团队发现很难迁移所有这些组件，而且它们需要大量时间。

在 Intranet 中的 160 多个 Web 应用程序中，其中大多数并非所有人都可以使用。这意味着我们有一个 VB 组件，用于检查登录用户并允许进入特定应用程序。我们还有权限管理页面，允许我们向应用程序添加/删除用户（就像 ASP 成员控制一样）。

我想向管理层展示使用 .net 成员控制很容易将 Intranet 应用程序移动到 .net 并且“Windows Authenticaion”更好。

与 java 相比，你能帮我收集一些使用 .net 作为 Intranet 的优势吗？请记住，我们现有的应用程序是基于 Windows 的。

在阅读 SO 中的类似问题后，我收集了一些要点。但我需要一些更具体的 Intranet。

**注意：**我不是来讨论关于 java 和 .net 的。java 是一门很棒的语言，但[在迁移之前考虑这些因素，](http://phonghao.wordpress.com/2008/08/20/should-you-use-net-or-java-on-a-new-project/)很清楚将我们的应用程序迁移到 .net 更好，但我的“技术架构师”做出了错误的决定。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T06:56:32.963

这取决于情况。在您的情况下，如果如您所描述的那样，去 Java 的决定并没有经过深思熟虑。您显然对 Microsoft 堆栈进行了大量投资。我认为没有令人信服的理由放弃所有遗留代码并经历所有这些痛苦只是为了使用 Java。

我可能会被激怒，但并不是说你从 Java 中获得的力量比从 .NET 中获得的力量要大得多来证明这种痛苦是正当的。我认为您当前的代码投资是继续使用 Microsoft 堆栈的充分理由。您可以与 COM 进行互操作，并且所有这些事情都可以从 .NET 中更轻松地进行。虽然，诚然，即使在转至 .NET 时，您也会有较大的代码更改。不过，这将是一个更容易的挑战；您的许多代码可以与新的 .NET 代码并存；你只需要做一些工作来管理像 Session 这样的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T06:59:53.673

我的 2c 是，如果您已经进入一个项目 9 个月，那么无论 .Net/Java 辩论多么有效，您最不想做的就是丢弃工作代码。

我认为一旦你的 Java 程序员掌握了 VB 对象如何工作的速度（即学习 VB），那么他们将大大提高他们在 Java 中重新编码对象的能力。

除此之外，如果您使用的是 Windows 和 Microsoft 技术，那么您将获得很大的好处，即能够回退到您现有的域基础架构上。

ASP.Net 不会神奇地变得安全，因为尽管您在域中，但您仍然必须在应用程序级别手动编写大量安全性代码。但是，如果您使用基于 MSSQL 的系统，使用 .net 会给您带来很多好处。此外，如果您在一家大公司，编写一些办公室互操作工具可能会更容易，用于生成报告等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T07:03:31.543

有一家公司 MainSoft（来自以色列）允许在 Java 系统上运行 .net 程序集。几年前，我的上一家公司有人用它来将某些 .net Web 应用程序迁移到 Tomcat 的 corp 标准。我认为有关字节/代码转换的一些事情，但我不确定。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T21:02:52.600

我也在 BigCo 工作......我们有一个不断增长的 .NET 曲线，从 VB6 和 Java 开始。这里已经并且将会有很多 Java 编写，这很棒。我真的认为“我们将成为 100% 技术 X”是错误的。我理解人们为什么要那样做，但在典型的大商店里，这似乎太局限了。

我建议不要试图与 Java 大打出手，而只是寻找 .NET 的机会，它显然更适合特定项目。即，如果您正在编写一个小型应用程序来执行一些由 10 个或更少用户使用的 CRUD，那么在我看来，使用 WinForms 而不是作为 Webapp 来执行它是很有意义的，因为编写它们要快得多，而且很少用户您没有分配问题。如果您也使用 AD，您还可以获得完整的集成安全功能。这就是我们在这里所采用的方法，它允许 .NET 渗透到所有地方。在其他项目中，使用 Java 显然更好（特殊要求、团队经验等），太好了——去做吧。任何大公司都会有很多微软和很多 Javaesque 硬件来运行东西，所以它不会 在我看来，在 BigCo 中，您选择两个大型企业平台中的哪一个并不重要。有时 .NET 更好，有时它是 Java。我认为一个大商店应该培养两者。

我认为几年后，我们也会将 Python（可能更像 IronPython）或 Ruby 视为可行的替代方案。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-27T21:29:48.447

问题不在于一种架构相对于另一种架构的技术优势；当您尝试为新项目决定平台时，您会问这个问题。问题是您将现有代码迁移到 Java 与 .NET 相比有多容易。如果您对 MS 堆栈了解得那么深，那么坚持使用 MS 堆栈是有意义的，只是为了便于迁移。

如果您有更适合 Java 的*新*项目，请务必使用 Java。或者 Ruby，或者 Python，或者任何合适的。

# c# - 如何在运行时找到dll的命名空间

> ID：653191
> 
> 赞同：1
> 
> 时间：2009-03-17T06:34:17.933
> 
> 标签：c#

> **可能重复：**
> [如何获取程序集的命名空间？](https://stackoverflow.com/questions/653128/how-to-get-namespace-of-an-assembly)

当我加载一个程序集时，我如何找到它的命名空间假设如果我加载一个exam.dll，我如何找到它的命名空间

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T06:36:02.217

首先，一个程序集可以包含许多命名空间。通常是 1 个程序集 == 1 个命名空间，但这根本不是必需的。

要查找程序集中的命名空间，只需获取程序集中的所有类型。有关如何执行此操作的详细信息，请参阅[Assembly.GetTypes 。](http://msdn.microsoft.com/en-us/library/system.reflection.assembly.gettypes.aspx)

从类型中，您可以获得完全限定的类型名称和类型的命名空间。

# iphone - 编写简单的时钟应用程序有哪些方法？

> ID：653194
> 
> 赞同：1
> 
> 时间：2009-03-17T06:35:24.903
> 
> 标签：iphone, optimization, time, clock

我正在编写一个小程序来显示 iPhone 上的当前时间（学习：D）。我遇到了这种困惑。

每秒调用 currentSystemTime （例如：stringFromDate: ），解析它并在屏幕上打印时间好吗？

调用一次上述例程并在计时器的每个滴答声中手动更新解析的秒会更有效吗？（比如说 ++seconds；写一些 if 循环来调整分钟和小时）。

第二种方法是否会导致与实际时间不同步？如果处理器负载增加左右？

考虑到这一切，这将是最好的方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T07:07:48.897

我怀疑与用于更新显示的 CPU 周期相比，查询系统时间的开销会很明显。设置一个 NSTimer 以触发您想要更新时钟显示的频率，并以这种方式更新您的显示。在您让应用程序正常工作之前，不要担心对其进行优化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T06:57:02.510

我会完全放弃秒数，只打印剩下的时间，然后你只需要每分钟解析一次。

那就是如果你想要一个时钟而不是秒表。说真的，我不记得上次我没有秒数看着时钟并想“天哪，我不知道现在是 12:51:00 还是 12:51:59。我将如何安排下一次约会？” ）。

如果您想确保在更新分钟时相对准确，请按照以下步骤操作：

*   获得全职（HHMMSS）。
*   显示精确到分钟分辨率 (HH:MM)。
*   从 61 中减去 SS 并休眠那么多秒。
*   回到第一步。

# c# - 如何将 mp3 文件拆分为多个可单独播放的部分？

> ID：653202
> 
> 赞同：6
> 
> 时间：2009-03-17T06:41:05.217
> 
> 标签：c#, vb.net, asp.net-2.0, mp3

如何将大型 mp3 文件拆分为一个或多个 mp3 文件，并且每个部分仍可在媒体播放器中播放？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T07:17:37.860

将一个 mp3 文件分解为单独的可播放 mp3 文件可能不是一件容易的事。mp3 文件中有标题信息，您需要将其包含在所有拆分文件中。您可能需要买一本[书](http://oreilly.com/catalog/mp3/chapter/ch02.html)或查找有关 mp3 的文件规范，这样您就知道自己在处理什么。

您最好寻找一个可以处理 mp3 文件的库，而不是尝试自己使用 FileStream 来处理。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T08:17:34.563

实际上，将 MP3 文件分解为单独的可播放 MP3 文件非常容易。MP3 文件由许多 iirc 1500 字节的单独帧组成，每个帧都有自己的标题。无效数据将被玩家忽略。

但是，如果您在帧边界上分割文件，创建正确的 mp3 文件，那会好很多。关于帧头的更多信息可以在这个网站上找到：[http ://www.mp3-tech.org/programmer/frame_header.html](http://www.mp3-tech.org/programmer/frame_header.html)

还请考虑音乐前面和/或附加各种元标记的可能性，如 ID3、APE 和歌词。

# .net - 在 app.config 文件中配置条件编译符号

> ID：653205
> 
> 赞同：1
> 
> 时间：2009-03-17T06:43:09.020
> 
> 标签：.net, app-config, compilation

我们可以在 app.config 文件中配置条件编译符号吗？如果可能的话，让我们知道如何去做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T06:48:47.647

它们在不同的时间完成——一个在编译时，一个在运行时。如果您在运行时编译代码（例如动态创建代码），那么您可以使用简单的[appSetting](http://www.odetocode.com/Articles/345.aspx)。最后还有一个选项，您可以在 VBPROJ/CSPROJ/MSBUILD 文件中添加一个条目来解析配置文件并使用 CreateProperty 任务添加适当的符号。

# c++ - 引用计数指针的 STL 类？

> ID：653211
> 
> 赞同：12
> 
> 时间：2009-03-17T06:46:20.867
> 
> 标签：c++, stl, smart-pointers, reference-counting

这应该是微不足道的，但我似乎找不到它（除非不存在这样的类！）

智能指针的 STL 类（或类集）是什么？

**更新**

感谢您的回复，
我必须说我很惊讶没有标准实施。

我最终使用了这个： http: [//archive.gamedev.net/reference/articles/article1060.asp](http://archive.gamedev.net/reference/articles/article1060.asp)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-17T06:54:52.250

除了已经提到的 TR1 shared_ptr 之外，STL 中没有引用计数指针。

我建议你使用 boost::shared_ptr （下载 boost 就足够了，没有什么要编译的，它的实现是 header-only）。

您可能还想看看 Loki 库中的智能指针（同样，仅头文件实现）。

有关可用智能指针的概述，请[参见](http://www.ddj.com/cpp/184403837)。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-17T06:49:59.313

如果你不想/不能使用 Boost**并且**你的编译器实现了[TR1](http://en.wikipedia.org/wiki/Technical_Report_1)，你可以使用`shared_ptr`（从 Boost 借来的）：

```
#include <tr1/memory>

...

std::tr1::shared_ptr<Foo> ptr(new Foo); 
```

`std::auto_ptr`否则，不，除了vanilla STL之外没有智能指针。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-11-22T00:41:09.787

时间在流逝，在 C++11 中：

```
std::shared_ptr
std::weak_ptr 
```

等等

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T06:52:32.583

对于 COM 对象，使用[CComPtr<>](http://msdn.microsoft.com/en-us/library/ezzw7k98(vs.80).aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-25T18:20:28.573

在 STL PLUS 中实施了一段时间的替代方案，请参阅[源代码伪造](http://stlplus.sourceforge.net/stlplus3/docs/smart_ptr.html)

`"STLplus was originally intended as a library to extend the STL by providing missing container data structures such as smart-pointers, matrices, trees and graphs."`

# c# - 使用荧光笔突出显示短语查询

> ID：653229
> 
> 赞同：1
> 
> 时间：2009-03-17T06:53:17.857
> 
> 标签：c#, lucene, lucene.net

我正在使用[这个](http://lucene.apache.org/java/2_2_0/api/org/apache/lucene/search/highlight/package-summary.html)版本的 Lucene highlighter.net API。我只想在搜索结果中出现一个短语时突出显示它的所有单词。但是，我不能这样做......例如，如果我的输入搜索字符串是“领先的电信公司”，那么如果结果不包含“领先”和“公司”字样，API 只会在结果中突出显示“电信”...

这是我正在使用的代码：

```
SimpleHTMLFormatter htmlFormatter = new SimpleHTMLFormatter();

var appData = (string)AppDomain.CurrentDomain.GetData("DataDirectory");
var folderpath = System.IO.Path.Combine(appData, "MyFolder");

indexReader = IndexReader.Open(folderpath);

Highlighter highlighter = new Highlighter(htmlFormatter, new QueryScorer(finalQuery.Rewrite(indexReader)));

highlighter.SetTextFragmenter(new SimpleFragmenter(800));

int maxNumFragmentsRequired = 5;

string highlightedText = string.Empty;

TokenStream tokenStream = this._analyzer.TokenStream(fieldName, new System.IO.StringReader(fieldText));

highlightedText = highlighter.GetBestFragments(tokenStream, fieldText, maxNumFragmentsRequired, "...");

return highlightedText; 
```

请帮忙！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T16:20:19.270

看看[荧光笔单元测试](https://github.com/apache/lucene-solr/blob/master/lucene/highlighter/src/test/org/apache/lucene/search/highlight/HighlighterTest.java)——你的用例可能就在其中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T21:21:52.723

查看[这个问题](https://stackoverflow.com/questions/82151/is-there-a-fast-accurate-highlighter-for-lucene)的答案。就像现在一样，荧光笔不理解短语查询。它只使用 a[`QueryTermExtractor`](http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/search/highlight/QueryTermExtractor.html)并获取要突出显示的单词列表。

# vb.net - 打开 Access DB 时如何避免链接表管理器消息

> ID：653231
> 
> 赞同：0
> 
> 时间：2009-03-17T06:54:35.043
> 
> 标签：vb.net, ms-access

我的应用程序 (Vb.Net) 是扫描 Access DB 表单并找出 Activx 控件（如果存在）并且工作正常。但我的问题是...

在某些数据库中，我们有映射路径到特定位置的表（表属性->链接表管理器），当我们重新定位这些数据库时，我们需要手动更改路径，否则它将显示重新链接的消息（访问数据库消息）在打开数据库时。而且我在扫描我的工具时也面临同样的问题，我的过程停止了，只能通过手动干预继续。

我是否要捕获按摩事件并在日志文件或报告中向用户发送一些特定于用户的消息并继续进一步扫描？

谁能帮我？？？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T20:31:43.873

我认为这是由检查链接表的启动宏引起的。打开数据库时，您应该禁用启动表单和宏。

要禁用启动表单或自动执行 - 看这里

[How-do-i-bypass-ms-access-startup-when-using-ole](https://stackoverflow.com/questions/441126/how-do-i-bypass-ms-access-startup-when-using-ole/441223#441223)

或者

[http://www.mvps.org/access/api/api0068.htm](http://www.mvps.org/access/api/api0068.htm)

# uiimageview - 绘制 UIImage / 内存问题-objective-c

> ID：653247
> 
> 赞同：0
> 
> 时间：2009-03-17T07:00:22.720
> 
> 标签：uiimageview, release

问候，

我正在尝试在地图上画一个圆圈。这个项目的所有独立部分都是独立工作的，但是当我把它们放在一起时，它就坏了。

我在 viewDidLoad 中设置了我的 UI，保留了大部分。

然后我使用触摸事件来调用我的刷新地图方法：

```
-(void)refreshMap{

NSString *thePath = [NSString stringWithFormat:@"http://maps.google.com/staticmap?center=%f,%f&zoom=%i&size=640x640&maptype=hybrid",viewLatitude, viewLongitude, zoom];
NSURL *url = [NSURL URLWithString:thePath];
NSData *data = [NSData dataWithContentsOfURL:url];
UIImage *mapImage = [[UIImage alloc] initWithData:data];

mapImage = [self addCircle:(mapImage) influence:(70) latCon:(320) lonCon:(320)];
NSLog(@"-- mapimageview retaincount %i",[mapImage retainCount]);    

mapImageView.image = mapImage;
[mapImage release];} 
```

像这样的设置它会加载一次带有圆圈的地图，但如果再次刷新地图，它会崩溃。

如果我注释掉 mapImage 版本，它会重复工作，但会导致内存泄漏。

我正在使用的 addCircle 方法：

```
-(UIImage *)addCircle:(UIImage *)img radius:(CGFloat)radius latCon:(CGFloat)lat lonCon:(CGFloat)lon{
int w = img.size.width;
int h = img.size.height; 
lon = h - lon;
CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB();
CGContextRef context = CGBitmapContextCreate(NULL, w, h, 8, 4 * w, colorSpace, kCGImageAlphaPremultipliedFirst);

//draw the circle
CGContextDrawImage(context, CGRectMake(0, 0, w, h), img.CGImage);
CGRect leftOval = {lat- radius/2, lon - radius/2, radius, radius};
CGContextSetRGBFillColor(context, 0.0, 0.0, 1.0, 0.3);
CGContextAddEllipseInRect(context, leftOval);
CGContextFillPath(context);

CGImageRef imageMasked = CGBitmapContextCreateImage(context);
CGContextRelease(context);
CGColorSpaceRelease(colorSpace);

return [UIImage imageWithCGImage:imageMasked];} 
```

非常感谢任何见解/建议！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T07:21:22.187

```
UIImage *mapImage = [[UIImage alloc] initWithData:data];
mapImage = [self addCircle:(mapImage) influence:(70) latCon:(320) lonCon:(320)]; 
```

这不好。当您在第二行重新分配 mapImage 的内容时，您将丢失对它的引用。如果可能只是添加一个附加变量，那么解决此问题的最简单方法是，这样您就可以跟踪两个图像。

# python - 在Python中迭代附加到字符串的有效方法？

> ID：653259
> 
> 赞同：2
> 
> 时间：2009-03-17T07:04:05.443
> 
> 标签：python, string, split, append, generator

我正在编写一个 Python 函数来将文本拆分为单词，而忽略指定的标点符号。这是一些工作代码。我不相信从列表中构造字符串（代码中的 buf = [] ）是有效的。有没有人建议更好的方法来做到这一点？

```
def getwords(text, splitchars=' \t|!?.;:"'):
    """
    Generator to get words in text by splitting text along specified splitchars
    and stripping out the splitchars::

      >>> list(getwords('this is some text.'))
      ['this', 'is', 'some', 'text']
      >>> list(getwords('and/or'))
      ['and', 'or']
      >>> list(getwords('one||two'))
      ['one', 'two']
      >>> list(getwords(u'hola unicode!'))
      [u'hola', u'unicode']
    """
    splitchars = set(splitchars)
    buf = []
    for char in text:
        if char not in splitchars:
            buf.append(char)
        else:
            if buf:
                yield ''.join(buf)
                buf = []
    # All done. Yield last word.
    if buf:
        yield ''.join(buf) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T07:08:57.443

[http://www.skymind.com/~ocrow/python_string/](http://www.skymind.com/~ocrow/python_string/)讨论了 Python 中连接字符串的几种方法，并评估了它们的性能。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T07:08:48.100

你不想使用 re.split 吗？

```
import re
re.split("[,; ]+", "coucou1 ,   coucou2;coucou3") 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T07:36:10.000

你可以使用 re.split

```
re.split('[\s|!\?\.;:"]', text) 
```

但是，如果文本非常大，则生成的数组可能会消耗太多内存。那么你可以考虑re.finditer：

```
import re
def getwords(text, splitchars=' \t|!?.;:"'):
  words_iter = re.finditer(
    "([%s]+)" % "".join([("^" + c) for c in splitchars]),
    text)
  for word in words_iter:
    yield word.group()

# a quick test
s = "a:b cc? def...a||"
words = [x for x in getwords(s)]
assert ["a", "b", "cc", "def", "a"] == words, words 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T07:25:01.477

您可以使用以下方法拆分输入[`re.split()`](http://docs.python.org/library/re.html#re.split)：

```
>>> splitchars=' \t|!?.;:"'
>>> re.split("[%s]" % splitchars, "one\ttwo|three?four")
['one', 'two', 'three', 'four']
>>> 
```

编辑：如果您`splitchars`可能包含特殊字符，例如`]`or `^`，您可以使用`re.escpae()`

```
>>> re.escape(splitchars)
'\\ \\\t\\|\\!\\?\\.\\;\\:\\"'
>>> re.split("[%s]" % re.escape(splitchars), "one\ttwo|three?four")
['one', 'two', 'three', 'four']
>>> 
```

# speech-recognition - 在给定大量单词的情况下，如何有效地创建用于语音识别的语法文件？

> ID：653262
> 
> 赞同：1
> 
> 时间：2009-03-17T07:05:14.113
> 
> 标签：speech-recognition

只用 50 个单词编写用于语音识别的语法文件很容易，因为您可以手动完成。如果你有 10,000 或 100,000 个单词，最简单、最有效的方法是什么？

示例：
假设我们有“RC 可乐”和“百事可乐”。我们将有包含 2 条规则的语法文件：
DRINK: (COLANAME ?[coke cola soda])
COLANAME: [rc pepsi]
它会识别“RC”、“RC Coke”、“RC Cola”、“RC Soda”、“百事可乐”、“百事可乐”、“百事可乐”和“百事苏打”。

编辑：我说的是语音识别的语法。语音识别系统需要一个随附的语法文件，以便它们知道要识别什么（gsl、grxml）。我实际上也在考虑的不仅仅是任何单词，还有一些你无法分类的名字。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T09:05:57.130

现在我明白了。你的意思是语法。您指定的语法格式是上下文无关语法的近亲。围绕上下文无关语法的自动学习存在一个研究领域。[概率上下文无关文法](http://en.wikipedia.org/wiki/PCFG)是该领域的核心。请参阅[Roni](http://www.cs.cmu.edu/~roni/11761-s01/PreviousYearsHandouts/pcfg-notes.ps) Rosenfeld 的关于学习 PCFG 的笔记 (PostScript)、[贝叶斯版本（压缩后记）](http://www.cs.cmu.edu/~sfc/papers/acl95.ps.gz)和[无监督 PCFG 学习 (PDF)](http://www.demarcken.org/carl/papers/sigdat.pdf)。这是一个活跃的研究领域，自从这些论文发表以来已经发生了变化。[Eugene Charniak](http://www.informatik.uni-trier.de/~ley/db/indices/a-tree/c/Charniak:Eugene.html)是该领域的多产研究员。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-18T20:38:06.717

对于 50 到 10 万字的词典，几乎可以肯定的是，构建听写语法比尝试构建上下文无关语法更好。微软免费提供他们的[听写资源工具包](http://www.microsoft.com/downloads/details.aspx?FamilyID=b5920ef3-ff03-453f-902c-eae618987ff9&DisplayLang=en)；我没用过，所以不能评价它的实用性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T08:08:26.910

我假设您的意思是词性标记；最快的方法是使用自动标记器并手动验证（和更正）结果。即使标注器的命中率低至 60-70%，它仍然会显着减少工作量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T06:53:50.627

我没有可以解决我的问题的答案，但 Yuval 的回答清楚地表明这是一个仍在开发中的主题，它还不是一个足够成熟的主题。我知道现在可能没有简单的语法修复（至少在研究实验室之外）。现在做好语法的唯一解决方案可能是不断学习用户输入和敏捷重构语法文件。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-17T07:18:14.677

我头脑中完全随机/模糊的想法：

- 您可以尝试将单词分类（名词、动词等），然后根据单词的类别为整个陈述/句子形成可能正确的形式。然后，您可以尝试根据单词及其使用顺序将新测试数据拟合到先前定义的模型中。

-我也很好奇使用某种机器学习算法来学习基于某种训练数据或文献的单词的正确使用。一旦你训练了你的算法，你可以尝试根据以前的结果对新的传入数据进行分类。

# winapi - 以编程方式添加主机（Windows 下的名称解析）

> ID：653271
> 
> 赞同：2
> 
> 时间：2009-03-17T07:09:16.303
> 
> 标签：winapi, dns

我想以编程方式向 Windows 添加名称/IP 关联，以便可以在本地解析此名称。这不必在重新启动之间保持不变。

我现在唯一的方法是在“主机”文件中添加一个条目，但这感觉很hacky，特别是因为我想自动化它。

有没有办法使用命令行工具或 Win32 API 来做到这一点？也许通过添加一个条目到 Windows DNS 缓存或类似的东西？

哦，请说明此解决方案是否与 Vista 兼容。

问候。

编辑：谢谢，伙计。可悲的是，您的所有答案确实涉及 DNS 或其他服务器。我正在寻找一个可以在“标准”Windows 安装上运行的纯本地解决方案。不过，这样的事情似乎并不存在。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T07:28:26.727

[此页面](http://msdn.microsoft.com/en-us/library/ms682129%28VS.85%29.aspx)列出了一组用于对 DNS 服务执行各种操作的脚本，包括为其添加名称。这似乎是[Windows Management Instrumentation](http://msdn.microsoft.com/en-us/library/ms682125%28VS.85%29.aspx)系统的一部分，恐怕我对此一无所知。

编辑：还有[这个功能](http://msdn.microsoft.com/en-us/library/ms682012%28VS.85%29.aspx)，它说它可以向DNS添加记录。不确定这是否意味着它实际上修改了 DNS 服务器的状态，或者它是否谈论本地解析器。它还需要 Windows 2000 Server 或更高版本，所以它可能太窄了。

# .net - SSIS 中的调试

> ID：653274
> 
> 赞同：21
> 
> 时间：2009-03-17T07:13:42.457
> 
> 标签：.net, sql-server, debugging, ssis

如何调试在 SSIS 包的脚本任务中编写的 .NET 代码？开发环境允许放置断点，但是在调试时不会像在常规 .NET 编程中那样将我带到代码中。

另外，我不知道如何将 SSIS 包变量添加到调试监视窗口？

目前我想到的一件事是使用 msgbox。但这并不能替代使用开发环境进行的全面调试。任何帮助表示赞赏。谢谢。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2010-08-27T21:17:17.247

注意：如果您在 x64 上运行，则必须将项目 (SSIS) 调试属性 Run64BitRuntime 更改为 false。

之后，您将能够在 .net 中调试脚本任务，并在脚本中中断代码。

顺便说一句，John Sansom 似乎没有阅读过问题的这一部分：如何调试在 SSIS 包中**的脚本任务中编写的 .NET 代码？**它是一个脚本任务，不是正常的 SSIS 调试。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-17T09:02:31.117

在 BIDS 环境中调试 SSIS 包与使用 Visual Studio 不同。

您可能会发现参考[Debugging How-To-Topics(SSIS)很有用](http://msdn.microsoft.com/en-us/library/ms137880.aspx)

如果您已经开发了自己的自定义组件，即在 Visual Studio 中，那么您应该能够在 Visual Studio 环境中调试该组件的特定功能，然后才能在 BIDS 中使用该组件。

您无法在 BIDS 中调试构成任何其他内置 SSIS 组件（即 FTP 任务）的内部 .NET 代码，因此我怀疑自定义组件会有所不同。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T21:11:09.410

我认为 SSIS 确实支持并在脚本任务中的断点处停止（在控制流中）。它不支持脚本转换（在数据流中）。这确实是非常不幸的限制。

当您在断点处停止时，SSIS 在监视窗口中显示变量值。我不确定脚本断点，但 SSIS 断点（预执行等）可以工作。但是你需要一个断点——你不能在没有断点的随机时刻观察变量值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-18T21:15:02.640

您可以将调试器附加到（几乎）任何您正在为其编写 .NET 代码的进程，方法是[`Debugger.Break`](http://msdn.microsoft.com/en-us/library/system.diagnostics.debugger.break.aspx)在源代码的适当位置嵌入调用。

引用 MSDN：

> 如果没有附加调试器，则会询问用户是否要附加调试器。如果是，则启动调试器。如果附加了调试器，调试器会收到用户断点事件的信号，并且调试器会暂停进程的执行，就像遇到了调试器断点一样。

我用它来调试各种东西，包括嵌入在 SSIS 中的 C# 代码。

**更新**：修改了措辞，因为这不再是一种理论技术，而是我使用过的一种。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-29T10:30:13.250

尽管数据流任务中的脚本组件除了定期编写进度、消息框等变通方法外，不允许任何形式的调试

脚本任务控制流项将允许开发人员调试 SSIS 代码

最近发现了这个。:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-05T09:08:48.110

确保您还运行完整的软件包。包断点的调试器在你这样做之前不会启动。

调试脚本任务的工作方式类似。

# c# - 从表单获取可用控件

> ID：653284
> 
> 赞同：0
> 
> 时间：2009-03-17T07:22:45.663
> 
> 标签：c#, winforms

如何使用 C#从[Windows 窗体窗体中获取可用控件？](http://en.wikipedia.org/wiki/Windows_Forms)

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-19T21:07:33.310

或者，ProfK 的可枚举语法解决方案：

```
public static IEnumerable<Control> GetControls(Control form) {
    foreach (Control childControl in form.Controls) {   // Recurse child controls.
        foreach (Control grandChild in GetControls(childControl)) {
            yield return grandChild;
        }
        yield return childControl;
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-19T20:55:02.373

在您的表单中尝试此方法。它将递归地获取表单上的所有控件及其子控件：

```
public static List<Control> GetControls(Control form)
{
    var controlList = new List<Control>();

    foreach (Control childControl in form.Controls)
    {
        // Recurse child controls.
        controlList.AddRange(GetControls(childControl));
        controlList.Add(childControl);
    }
    return controlList;
} 
```

然后使用以下命令调用它：

```
List<Control> availControls = GetControls(this); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T07:47:59.660

我认为您的意思是表单上的所有控件。因此，您可以简单地`Controls`在表单对象中使用属性。

```
foreach(Control c in this.Controls)
{
   //TODO:
} 
```

# c - C中的位移

> ID：653289
> 
> 赞同：1
> 
> 时间：2009-03-17T07:27:06.527
> 
> 标签：c, bit-manipulation

如果对应于有符号整数的位模式向右移动，则

```
1   vacant bit will be filled by the sign bit   
2   vacant bit will be filled by 0  
3   The outcome is implementation dependent 
4   none of the above 
```

这个问题的答案是第三个选项.. 任何人都可以解释这个，，

还给出一些基本概念，关于 C 编程中左移和右移运算符背后的理论。例如

执行任何操作时在空位上填充的内容。我检查并注意到左移将空位填充0，右移填充1。请清除逻辑...

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T07:34:05.137

我必须检查规范以了解究竟是什么依赖于实现的问题。然而，我在（咕哝）多年的嵌入式系统项目中使用的每一个实现都是明智的：

*   左移总是在低位移入 0。没有其他值是有意义的。

*   右移取决于数据类型。有符号整数的右移会复制高位，因为它将其余部分右移。这被称为“算术移位”，并且具有很好的特性（至少在二进制补码算术中），它将值除以二，同时保留原始数字的符号。

    无符号整数的右移将 0 移到高位，通常称为“逻辑移位”。

实现提供两种转换是有意义的，因为两者都很有用，并且使用有符号/无符号来选择意味着是一个明智的选择。

**编辑：**至少绝对依赖于实现的一件事是C标准没有（完全）指定整数的底层实现及其存储。例如，可以为使用补码算法的机器构建兼容的 C 编译器。也有可能（我认为）为一台机器构建一个兼容的编译器，它的本机存储是有符号 BCD 大小的。（不，我错了，见下文。）

在实践中，世界几乎已经确定了 CPU 的二进制补码，并且一些迂腐的问题正在讨论中。

所以问题的一部分实际上是：如何以稳定的方式定义 << 和 >> 运算符的含义，而不管使用的底层算术系统如何。

IIRC, 的定义`n<<1`是有效`n*2`的,`n>>1`是有效`n/2`的, 具有超过 1 的自然扩展(但不超过 31...那里有未定义的龙...) 并且`>>`操作员将保留如果对有符号值进行操作，则为符号。

**编辑 2：** Pete Kirkham 在他的好回答中指出，C 标准确实特别禁止整数的 BCD 表示的可怕情况，无论它是有符号的幅度还是十的补码。我确信这是一件好事，即使 Knuth 在早期版本的[The Art of Computer Programming](http://www-cs-faculty.stanford.edu/~knuth/taocp.html)中确实使用（可选）BCD 机器作为他的示例代码。

在那些 BCD 是正确答案的罕见用例中，然后将它们存储在无符号长整数（8 位十位补码）或无符号 64 位整数（16 位十位补码或 15 位加号和标志的空间）中，并使用精心设计的算术库来操作它们是有意义的。

当然，在实践中，C 实现将操作符按照标准允许的方式直接映射到 CPU 的本机机器指令。编写标准的人*非常*注意存在许多方法来实现甚至简单的事情，比如整数值的表示，而 C 标准反映了这一点，通过允许足够的实现定义的行为来让运算符在每个机器。

替代方案迅速导致所有数学运算都完全指定的世界，并且无法在任何机器上有效地实现。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T07:30:14.880

C 不保证存在符号位，或者关于整数的位级表示的任何内容，这就是原因。

对于[二进制补码](http://en.wikipedia.org/wiki/Two%27s_complement)，您通常会看到符号位被移入，但这取决于实现。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T10:20:58.777

ISO C99 在表示的某处需要一个符号位，但提供了各种补码/符号和幅度方案之间的选项，并允许填充位，所有这些都会影响`>>`.

> 第 6.2.6.2 节（整数类型）
> 
> 对于有符号整数类型，对象表示的位应分为三组：值位、填充位和符号位。不需要任何填充位；应该只有一个符号位。

和

> 第 6.5.7 节（按位移位运算符）
> 
> E1 >> E2 的结果是 E1 右移 E2 位位置。如果 E1 具有无符号类型或 E1 具有有符号类型和非负值，则结果的值是 E1 / 2 ^(E2)的商的整数部分。如果 E1 具有带符号类型和负值，则结果值是实现定义的。

它没有指定使用 1 的补码、2 的补码或符号和幅度中的哪一个，也没有指定符号位是在值位的左边还是右边，或者任何填充在哪里，所有这些都会影响`>>`运算符的输出签署的底片。

在回答 Rberteig 的查询时，C99 排除了整数的 BCD 表示：

> 第 6.2.6.2 节（整数类型）
> 
> 如果有 N 个值位，每个位应表示 1 和 2 N -1 之间的 2 的不同幂，以便该类型的对象应能够使用纯二进制表示表示从 0 到 2 N - 1 的值；这应称为值表示。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T07:47:37.007

C 语言实现倾向于将位移操作直接映射到相应的机器代码指令上。由于不同的硬件架构在历史上做了不同的事情，C 规范倾向于保留定义的实现，以便 C 实现可以利用硬件提供的任何东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T07:55:06.427

结果取决于实现。然而，在实践中，我曾经使用过的每一个 x86、PPC 和 MIPS 编译器都遵循以下规则来右移：

1.  如果操作数是有符号整数，则空位用符号位（实际上是最高有效位）填充

2.  如果操作数是无符号整数，则空位用零填充。

正如 RBerteig 所说，对于有*符号*整数，正负 n 的 n >> 1 = n/2（向下舍入），对于*无*符号*整数*，即使 n > 2^，n >> 1 = n/2 31（在 32 位架构上）。

对应的硬件指令是算术（符号扩展）和逻辑（非符号扩展）移位；编译器根据操作数是有符号还是无符号在它们之间进行选择。

# php - 通过模块创建的新内容类型的问题

> ID：653292
> 
> 赞同：2
> 
> 时间：2009-03-17T07:28:05.043
> 
> 标签：php, drupal, content-management-system, drupal-6

我试图写一个drupal模块。我正在关注“学习 Drupal 6 模块开发”一书。我在模块中创建了一个新的内容类型（mybio）。我能够为新内容类型创建新节点和编辑节点，它工作正常，但在查看节点时我无法看到 mybio 内容类型的新字段。我已将 mybio_info.tpl.php 文件放在模块文件夹和主题文件夹中，但没有任何效果。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T07:58:44.967

你实现了[负载钩子](http://api.drupal.org/api/function/hook_load/6)和[视图钩子](http://api.drupal.org/api/function/hook_view/6)吗？

每当您创建新的内容类型时，您需要提供所有用于更改/加载节点的钩子，例如 hook_delete()、hook_insert()、hook_load()、hook_update()、hook_validate() 和 hook_view()。

如果这不起作用，您确定正在使用您的模板吗？如果不确定，请将其所有内容替换为“1”之类的简单内容，然后查看是否显示。如果您没有看到，那么它根本没有被使用；尝试重命名为 node-mybio.tpl.php。

对于模板命名，请查看[核心模板和建议](http://drupal.org/node/190815#template-suggestions)手册页面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T13:39:26.273

看起来您没有实现[hook_theme](http://api.drupal.org/api/function/hook_theme)，因此系统不知道您正在为它提供此内容类型的模板。

[您可以通过使用devel.module](http://drupal.org/project/devel)显示主题注册表来检查这是否是问题，或者进一步使用 theme_developer 模块来检查屏幕上的所有内容都使用了哪个模板。

# apache-flex - 如何在里面做填充 ?

> ID：653303
> 
> 赞同：1
> 
> 时间：2009-03-17T07:32:17.403
> 
> 标签：apache-flex, list

我有一个列表，我需要在项目和列表边距之间留一些空间。列表中的项目是从其他文件呈现的。但是当我添加填充时，我看不到任何区别。

像这样的东西：

```
<mx:List id="List" selectionColor="red"     itemRenderer="renderers.List" 
                    doubleClick="Handler()"  width="500" cornerRadius="4"  
                     textAlign="center" height="335"> 
```

此外，当鼠标悬停时，只有项目必须突出显示，不包括填充。

有什么建议么？示例代码将非常有用。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-08-13T20:23:08.743

您正在寻找 useRollOver 来添加翻转。

```
<mx:List useRollOver="true" /> 
```

至于填充，您需要在自定义项目渲染器中执行此操作。

这是一篇很好的文章，可以帮助您开始制作自定义项目渲染器：

[http://www.adobe.com/devnet/flex/articles/itemrenderers_pt1.html](http://www.adobe.com/devnet/flex/articles/itemrenderers_pt1.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T08:58:54.543

下面的列表的左右边缘与列表中的项目之间已经有空间，它们被布置在列表的中心。这是使用默认的 itemRenderer。

```
<?xml version="1.0" encoding="utf-8"?>
<mx:WindowedApplication xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute">

    <mx:List id="List" selectionColor="red" width="500" cornerRadius="4"  
     textAlign="center" height="335">
        <mx:Array >
            [1,2,3,4]
        </mx:Array>
     </mx:List>

</mx:WindowedApplication> 
```

您是在渲染文本还是图像？

至于只选择项目而不是额外空间，我不太确定那个。

# c# - 如何设置密码来保护文件和目录

> ID：653304
> 
> 赞同：0
> 
> 时间：2009-03-17T07:32:18.480
> 
> 标签：c#, security, passwords

如何在 C# 中使用密码保护文件和目录？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T07:48:35.943

如果您需要保护文件和文件夹，您有多种选择：

1.  使用 ACL（访问控制列表）控制操作系统级别的权限，以便只有计算机上的授权用户才能访问这些对象。这不会为该文件创建新密码，而只会拒绝每个未经授权的用户的访问。缺点是这需要在机器（或 Active Directory 域）级别上完成。因此，如果您将文件复制到另一台机器，则保护不再有效。

2.  您可以使用压缩算法（如 zip 或 rar）来压缩受保护的文件并指定解压缩所需的密码。即使您将 zip 文件复制到其他机器，这也有效。如果您只需要保护文件而不关心减小文件大小，则可以不使用压缩因子打包文件。您可以在线找到几个用于 .NET 的开源 zip 库。其中之一是[http://www.icsharpcode.net/OpenSource/SharpZipLib/](http://www.icsharpcode.net/OpenSource/SharpZipLib/)

3.  或者，您可以使用 中的类执行文件加密`System.Security.Cryptography`，使用对称算法，其中密码密钥将是您的密码，或使用证书的非对称加密，其中密码将是证书的私钥密码。这通常比 zip 加密提供更强的安全性，但您必须编写更多代码并管理用户的证书。

您的具体安全和授权要求是什么？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T07:43:25.473

查看[C# 加密示例](http://www.example-code.com/csharp/encryption.asp)。您可以将其中之一与~~[此递归目录搜索示例](http://www.devsource.com/c/a/Languages/Recursive-Directory-Searches-in-C-Part-1/)~~（死链接）结合起来，以加密目录（及其子目录，如果需要）中的所有文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T03:55:56.273

您可以创建一个文件，在其上创建一个加密文件系统，然后环回挂载它。

# mysql - MySQL 查询

> ID：653309
> 
> 赞同：0
> 
> 时间：2009-03-17T07:34:16.323
> 
> 标签：mysql, stored-procedures

我是 MySQL 语法的新手。

我创建了一个程序并运行了它，但它显示了一些语法问题，你能帮帮我吗？

我的程序如下：

```
**DELIMITER $$
CREATE PROCEDURE TestAdd(
    in mODE varchar(10),
    in Id int,
    in AttName varchar(10),
    in AttValues Varchar(10)
)
IF EXISTS (SELECT * FROM AttTable WHERE id=Id) THEN
    SET Mode='Modify'
ELSE 
    SET Mode='Add'
    Start Transaction
    BEGIN
        IF (mODE='Add') THEN
            insert into atttable values (Id, AttName, AttValue);
        ELSE (if Mode='Modify') then
            update AttTable set AttName=AttName, AttValue= AttValue where Id=Id;
        END IF 
    END
$$
Delimiter ;** 
```

我在哪里做错了？？提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T15:05:31.510

您需要`BEGIN`在开头的参数列表后面加上一个右边，并`END`在过程结束时匹配：

```
create procedure TestAdd(blah...)
BEGIN
  ...

END$$ 
```

您的第一个`IF`电话缺少`THEN`和`END IF`：

```
if exists ( select * from AttTable where  id=Id) THEN
  set...
ELSE
  set...
END IF 
```

每个语句都需要以`;`

```
set Mode='Modify';
set Mode='Add';
Start Transaction; 
```

# c# - 将控制从后台线程转移到主线程

> ID：653313
> 
> 赞同：1
> 
> 时间：2009-03-17T07:36:36.097
> 
> 标签：c#, multithreading

我有监视设备状态的线程（使用 i/o ）。这会将事件触发到有关连接状态（已连接、已断开、故障）的几个 UI（表单/对话框..）部分。基于此状态，表单和对话框被销毁、创建、启用和禁用。

我的问题 ：

```
 I getting Cross-Thread exception because the thread doing the operations like Dispose the from, create the from .... .  I using smart client, forms and dialogs are part of the WorkItemController and i just terminating that. 
```

我不希望你使用 Invoke 或 BeginInvoke 。我希望这个线程继续只监视状态。这样该线程必须将其控制权交给主线程，并且主线程将关闭表单或创建表单。

只是我想如何将控制从一个线程转移到另一个线程。有什么办法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T07:56:39.123

最好的解决方案是使用 Invoke 切换回您的主线程。

或者如果您可以使用在主线程和后台线程之间共享的全局变量，但这意味着您的主线程应该在循环中检查变量，这可能会挂起 GUI。

或者在主线程中执行时使用 System.Windows.Forms.Timer。

# c# - 为什么我们使用无成员接口？

> ID：653315
> 
> 赞同：7
> 
> 时间：2009-03-17T07:37:30.247
> 
> 标签：c#, .net, oop, interface

编写没有成员的界面有什么意义？

[INamingContainer](http://msdn.microsoft.com/en-us/library/system.web.ui.inamingcontainer.aspx)是 .NET Framework 中的一个示例。它在 MSDN 中被描述为：

> 标识在 Page 对象的控件层次结构中创建新 ID 命名空间的容器控件。这只是一个标记界面。

它是否仅用于这种块：

```
if (myControl is INamingContainer)
{
    // do something
} 
```

或者它还有其他优点吗？

**编辑：**它被称为[标记界面模式](http://en.wikipedia.org/wiki/Marker_interface_pattern)（感谢 Preet）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-17T07:40:53.840

无成员接口用于在 C# 中提供类似 mixin 的功能。所以给定一个A类：

```
class A : B { ... } 
```

你可以通过定义一个接口 IStuff 来赋予它额外的功能（a-la 多重继承）：

```
interface IStuff {} 
```

然后在A中“实现”它：

```
class A : B, IStuff { ... } 
```

然后添加额外的功能

```
class Methods {
  public static void Something(this IStuff stuff) {
    // some functionality here
  }
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-17T07:40:08.367

这是为了确保您可以将对象集合视为同一类型，然后对该类型执行一些操作（您知道它必须从对象继承）。

把它想象成属性。它是类型元数据。

您可能还想对已知类型（例如 System.Web.UI.Control）执行操作，但仅当类型继承自某个接口（例如 INamingContainer）时才执行该操作。

```
foreach(var ctrl in this.Controls)
{
    if (ctrl is INamingContainer)
    {
        // Do something on the control
    }
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-17T07:41:18.007

它是一个标记界面。它可用于装饰类型，以便您可以在运行时发现类型是否正确，而无需使用反射。我们使用它来确保被调用者中的泛型类型是正确的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-17T09:50:54.560

让那些认为鸭式打字很酷的 Python 爱好者感到困惑。

# c# - ADO.NET 实体框架：使用静态创建方法 (C#) 创建对象

> ID：653316
> 
> 赞同：0
> 
> 时间：2009-03-17T07:39:15.063
> 
> 标签：c#, entity-framework, ado.net

我写了这个：

```
 using (GuiaMovilEntities guiaEntity = new GuiaMovilEntities())
{
   try
   {
     Cliente cliente = 
        Cliente.CreateCliente(-1, datosCliente.Email, datosCliente.Password);
   }
   catch
   {
   }
} 

```

它未完成。

如果表 Cliente（由 Cliente 对象表示）将其第一行 (clienteID) 作为 IDENTITY 列。

将 -1 作为 clienteID 值是否正确？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T07:42:52.417

身份参数是自动生成的——您不需要自己指定值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T12:08:03.153

这是另一种选择：

```
Cliente cliente = new Cliente
{
    Email = datosCliente.Email,
    Password = datosCliente.Password
}; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T07:41:44.370

不，您不需要设置 ID。从工厂方法中删除参数并将 Id 值保留为默认值（我想在这种情况下为零）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T08:10:44.097

如果您真的想要一个非 0 的未定义 id，例如 -1，您可以为您的实体实现默认构造函数并将其设置在那里。

# stress-testing - 压力测试开发服务器/生产服务器

> ID：653329
> 
> 赞同：5
> 
> 时间：2009-03-17T07:47:17.587
> 
> 标签：stress-testing

我对压力测试很陌生，我只是在努力学习。所以我的问题是：

1.  如果我有一个在软件方面相同但在硬件方面的规格比生产服务器低得多的开发服务器，是否值得对开发服务器进行压力测试以识别明显的软件缺陷？

2.  在不危及用户体验的情况下，如何最好地对实时生产服务器进行压力测试？或者应该避免对实时生产服务器进行压力测试。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T08:08:42.167

以下是各种提示/建议：

*   如果您的应用程序是新的，因此您不知道它是否可以处理生产中的负载，那么您需要进行“容量”测试。您应该对生产硬件进行容量测试，因为它还没有“上线”，所以不会影响用户。

*   如果您的应用程序是已经部署在生产环境中的现有应用程序，那么您应该做的是“性能回归”测试。

*   性能回归测试包括对开发服务器上的所有单个“功能”（无论这对您的应用程序意味着什么）进行压力测试，以测量其性能。您将结果记录作为您的“基线”。

*   当您对应用程序进行更改时，重新运行性能回归测试以查看是否有任何结果与基线相比发生了显着变化（并将新数字记录为新基线）。

*   如果您的开发服务器上的性能回归结果与基线相比没有太大变化，那么您应该可以安全地部署到生产环境，而无需更改服务器利用率（即过载）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T08:01:49.360

我认为你应该避免任何工作，包括在生产机器上进行压力测试，除非你知道你有一个无法在测试环境中重现的问题——也就是说，也许你*知道*你的用户在夜间不使用系统？如果测试是非侵入/只读的，那么我会说这是一个额外的选择。

至于在周末机器上的分析性能，它并没有那么糟糕 - 大多数瓶颈是由系统的不良架构引起的，并且应该在不同的硬件配置上可见，只是在不同的负载场景下 - 可能更容易注意到问题weeker machine 所以我会说对你的开发系统进行压力测试和优化，你会知道至少理论上你的生产系统应该更好。

# c++ - 字节缓冲区应该是有符号还是无符号字符缓冲区？

> ID：653336
> 
> 赞同：62
> 
> 时间：2009-03-17T07:52:04.313
> 
> 标签：c++, c, char, buffer

字节缓冲区应该是有符号字符还是无符号字符，还是只是一个字符缓冲区？C和C++之间有什么区别吗？

谢谢。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-03-17T11:53:46.650

如果您打算存储任意二进制数据，您应该使用`unsigned char`. 它是 C 标准保证没有填充位的唯一数据类型。每种其他数据类型都可能在其对象表示中包含填充位（即包含对象的所有位，而不是仅包含确定值的位）。填充位的状态未指定，不用于存储值。因此，如果您使用`char`一些二进制数据进行读取，则会将内容缩减到 char 的值范围（通过仅解释值位），但可能仍有一些位被忽略但仍然存在并由`memcpy`. 很像真实结构对象中的填充位。类型`unsigned char`保证不包含那些。这来自`5.2.4.2.1/2`（C99 TC2，这里的 n1124）：

> 如果 char 类型的对象的值在表达式中使用时被视为有符号整数，则 的值`CHAR_MIN`应与 的值相同，`SCHAR_MIN`的值应与 的值`CHAR_MAX`相同`SCHAR_MAX`。否则， 的值 `CHAR_MIN`应为 0， 的值`CHAR_MAX`应与 的值相同 `UCHAR_MAX`。*该值`UCHAR_MAX`应等于`2^CHAR_BIT − 1`*

从最后一句可以看出，没有任何空间可供任何填充位使用。如果您使用`char`缓冲区的类型，您还会遇到溢出问题：将任何值显式分配给`8`位范围内的一个此类元素-因此您可能期望这样的分配是可以的-但不在范围内a `char`，即`CHAR_MIN`.. `CHAR_MAX`，这样的转换会溢出并导致实现定义的结果，包括信号的提升。

即使与上述有关的任何问题可能不会在实际实现中显示（将是*非常*差的实现质量），您最好从一开始就使用正确的类型，即`unsigned char`.

但是，对于字符串，选择的数据类型是`char`，字符串和打印函数可以理解。用于`signed char`这些目的对我来说似乎是一个错误的决定。

有关更多信息，请阅读[`this proposal`](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1310.htm)其中包含对下一版本 C 标准的修复，该版本最终`signed char`也不需要任何填充位。它已被纳入[工作文件](http://www.open-std.org/JTC1/SC22/WG14/www/docs/n1362.pdf)。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2011-02-20T15:46:53.617

> 字节缓冲区应该是有符号字符还是无符号字符，还是只是一个字符缓冲区？C和C++之间有什么区别吗？

语言如何处理它的细微差别。约定如何处理它的**巨大**差异。

*   `char`= ASCII（或 UTF-8，但有符号阻碍）**文本**数据
*   `unsigned char`= 字节
*   `signed char`= 很少使用

并且有代码*依赖*于这种区别。就在一两周前，我遇到了一个错误，即 JPEG 数据被破坏，因为它被传递给`char*`我们的 Base64 编码函数的版本——它“有用地”替换了“字符串”中所有无效的 UTF-8。更改为`BYTE`aka`unsigned char`即可修复它。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-03-17T08:03:26.253

这取决于。

如果缓冲区旨在保存文本，那么将其声明为数组`char`并让平台为您决定默认情况下是有符号还是无符号可能是有意义的。例如，这将使您在将数据传入和传出实现的运行时库时遇到的麻烦最少。

如果缓冲区旨在保存二进制数据，则取决于您打算如何使用它。例如，如果二进制数据确实是数据样本的打包数组，这些数据样本是有符号的 8 位定点 ADC 测量值，那么`signed char`最好。

在大多数实际情况下，缓冲区只是一个缓冲区，并且您并不真正关心各个字节的类型，因为您在批量操作中填充了缓冲区，并且您即将将其传递给解析器来解释复杂的数据结构并做一些有用的事情。在这种情况下，以最简单的方式声明它。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-17T09:49:02.770

如果它实际上是 8 位字节的缓冲区，而不是机器默认语言环境中的字符串，那么我会使用`uint8_t`. 并不是说在很多机器上 char 不是字节（或字节不是八位字节），而是说“这是八位字节的缓冲区”而不是“这是一个字符串”通常是有用的文档。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-17T11:08:26.260

您应该使用*char*或*unsigned char*但从不使用*signed char*。该标准在 3.9/2 中有以下内容

> 对于 POD 类型 T 的任何对象（基类子对象除外），无论该对象是否拥有类型 T 的有效值，构成该对象的底层字节 (1.7) 都可以复制到 char 或 unsigned 数组中char。如果将 char 或 unsigned char 数组的内容复制回对象，则该对象随后应保持其原始值。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-17T08:01:18.877

最好将其定义为无符号字符。事实上 Win32 类型 BYTE 被定义为无符号字符。这之间没有C和C++之间的区别。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-17T10:05:31.967

为了获得最大的可移植性，请始终使用无符号字符。有几个例子可以发挥作用。立即想到在具有不同字节序类型的系统之间共享的序列化数据。当执行移位或位掩码时，这些值是另一个值。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-17T14:44:36.193

int8_t 与 uint8_t 的选择类似于将 ptr 与 NULL 进行比较。

* * *

从功能的角度来看，与 NULL 比较与与 0 比较是一样的，因为 NULL 是 0 的 #define。

但就个人而言，从编码风格的角度来看，我选择将我的指针与 NULL 进行比较，因为 NULL #define 意味着维护您正在检查错误指针的代码的人......

VS

当有人看到与 0 的比较时，表示您正在检查特定值。

* * *

由于上述原因，我会使用 uint8_t。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-17T07:55:25.617

如果您将一个元素提取到一个更广泛的变量中，那么它当然会被符号扩展或不扩展。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-17T08:01:02.980

应该而且应该......我更*喜欢*`ints`无符号，因为如果我想强调数据的二进制性，它感觉更“原始”，而不是说“嘿，这只是一堆小”。

我不认为我曾经使用显式`signed char`来表示字节缓冲区。

当然，第三种选择是`void *`尽可能多地表示缓冲区。许多常见的 I/O 函数都与 . 一起使用`void *`，因此有时可以完全封装使用哪种整数类型的决定，这很好。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-17T08:03:08.467

几年前，我遇到了一个 C++ 控制台应用程序的问题，该应用程序为 128 以上的 ASCII 值打印彩色字符，通过从 char 切换到 unsigned char 解决了这个问题，但我认为它在保持 char 类型的同时也是可以解决的。

目前，大多数 C/C++ 函数都使用 char，而且我现在对这两种语言的理解要好得多，所以我在大多数情况下都使用 char。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-17T08:06:58.803

你真的在乎吗？如果你不这样做，只需使用默认值 (char) 并且不要用无关紧要的事情弄乱你的代码。否则，未来的维护者会想知道你为什么使用有符号（或无符号）。让他们的生活更简单。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-03-17T14:57:30.437

如果你对编译器撒谎，它会惩罚你。

如果缓冲区包含刚刚通过的数据，并且您不会以任何方式操作它们，那没关系。

但是，如果您必须对缓冲区内容进行操作，那么正确的类型声明将使您的代码更简单。没有“int val = buf[i] & 0xff;” 废话。

因此，请考虑数据实际上是什么以及您需要如何使用它。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2009-03-17T15:10:11.983

```
typedef char byte; 
```

现在你可以让你的数组是`byte`s 的。每个人都清楚您的意思，并且您不会丢失任何功能。

我知道这有点傻，但它使您的代码按照您的预期 100% 阅读。

# sql - SQL - 计算数字列值的百分比增加

> ID：653337
> 
> 赞同：3
> 
> 时间：2009-03-17T07:53:41.407
> 
> 标签：sql, sqlite

我想根据我在 SQL 数据库中获得的值计算一些趋势。特别是我有兴趣获得一列中值的百分比增加（如果值减少，该值应该为负）

有人可以建议我该怎么做吗？

我不能使用存储过程。

谢谢。

**我的表有以下列**

日期（数字）、月份（数字）、订单（数字）、价格（实际）

**我想计算从一个月到下个月收到的订单数量的变化百分比。我还希望将方向作为考虑因素，即返回的值应该是 -ve，以防销售额下降。**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T09:16:10.837

我不确定 sqllite 是否允许变量，但这是我在 MySQL 中的方式。我刚刚对此进行了测试，并像一个魅力一样工作：打印 100% 增加 10 到 20，-13.04% 减少 46 到 40。

希望它在 sqllite 中是相似的：

```
SELECT
  CONCAT(
    FORMAT(
      IF(@prev AND SUM(orders) <> @prev,
          -1 * 100 * (1 - SUM(orders) / @prev),
          0
        )
      , 2)
  , '%') AS variation,
    @prev := SUM(orders) AS orders
FROM
    (SELECT @prev := NULL) init,
    product
GROUP BY
  id_product
ORDER BY
  month 
```

当然，您需要根据需要调整输出。这目前将百分比格式化为 2 位小数，并在末尾附加一个“%”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T08:03:33.520

为了计算趋势，您需要存储您感兴趣的值的历史数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T08:17:04.673

如果您有一个带有年+月 (YYYYMM) 的整数列，应该很有用

```
cast(
     cast(year(date) as nvarchar) + 
     replicate('0',2-len(cast(month(date) as nvarchar))) +
     cast(month(date) as nvarchar)
as int) 
```

然后你只需要分组，获取先前的值并计算。

```
select yearmonth, 
       sum(t.orders), 
       (sum(t.orders)/(select top 1 sum(orders) 
                       from table 
                       where yearmonth<t.yearmonth 
                       group by yearmonth 
                       order by yearmonth desc)-1)*100\. as pct 
from table t 
group by yearmonth 
```

*T-SQL语法，希望你可以在sqlite中使用*

PS：必须进行除零检查以避免进一步的问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T09:11:06.947

不确定日期列，但如果每个月只有 1 行，答案可能是（我没有 sqlite，但我认为这个答案是 ANSI sql）：

```
select t.date
,      t.month
,      t.orders
,      case when t2.orders = 0 then
          99999.0
       else
          100.0 * (t.orders - t2.orders) / t2.orders
       end  "increase"
from   t
left join t t2 on t2.month = t.month - 1
order by t.month 
```

# vb.net - 在 Asp.net Gridview 中获取行的索引

> ID：653342
> 
> 赞同：0
> 
> 时间：2009-03-17T07:56:53.117
> 
> 标签：vb.net

我使用了这段代码。它显示一个错误：Dim row As GridViewRow = CType(CType(e.CommandSource, Control).NamingContainer, GridViewRow)

错误如下：

FFK.DLL 中出现“System.InvalidCastException”类型的异常，但未在用户代码中处理

附加信息：无法将“System.Web.UI.WebControls.ContentPlaceHolder”类型的对象转换为“System.Web.UI.WebControls.GridViewRow”类型。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T17:39:53.893

我假设您想要的是 GridView 的*选定*行的索引？

如果是这样，您可以尝试以下操作：

```
Me.GridView1.SelectedIndex 
```

...这将为您提供 GridView 中行的从零开始的索引位置。

希望这可以帮助，

# c# - 您如何在其实例中的类中定义方法？

> ID：653343
> 
> 赞同：2
> 
> 时间：2009-03-17T07:57:03.427
> 
> 标签：c#, .net, oop

这可能很容易，但我很难过。我想创建一个通用类，它将在我的程序中多次使用。我希望它非常轻巧且超快。

对于 C# 中的一个非常简单的示例：

```
public class SystemTest
{ 
   public TestMethod(string testString)
   {
      if(testString == "blue")
      {
         RunA();
      }
      else if(testString == "red")
      {
         RunB();
      }
      else if(testString == "orange")
      {
         RunA();
      }
      else if(testString == "pink")
      {
         RunB();
      }
   }

   protected void RunA() {}
   protected void RunB() {}       
} 
```

我希望 RunA() 和 RunB() 由实例化此类的对象定义和控制。这将完全取决于对象实例化 SystemTest 类来确定 RunA() 和 RunB() 将做什么。你怎么做到这一点？

我不希望实例对象总是继承这个 SystemTest 类，我希望它运行得非常快。我唯一想到的是复杂的、处理器密集型的东西。我知道有一种更简单的方法可以做到这一点。

* * *

编辑：通常，哪个运行得更快，下面的答案是委托还是接口方法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-17T08:03:48.920

你可以：

```
public class SystemTest
{ 
   Action RunA;
   Action RunB;
   public SystemTest(Action a, Action b)
   {
      RunA = a;
      RunB = b;
   }
   //rest of the class
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T08:03:20.650

听起来您想要一个界面，例如：

```
interface ITestable {
    void RunA();
    void RunB();
} 
```

然后你把它传递给（要么给`SystemTest`ctor，要么给`TestMethod`）。调用类可以（例如）实现 ITestable 并调用 TestMethod(this, someString)。

或者，也许是一种扩展方法？顺便说一句，`string`arg 可能是一个枚举？

```
public interface ITestable {
    void RunA();
    void RunB();
}
public static class SystemTest
{ 
   public static void TestMethod(this ITestable item, string testString)
   {
      if(testString == "blue")
      {
         item.RunA();
      }
      else if(testString == "red")
      {
          item.RunB();
      }
      else if(testString == "orange")
      {
          item.RunA();
      }
      else if(testString == "pink")
      {
          item.RunB();
      }
   }
} 
```

然后调用者只需实现 ITestable，任何人都可以调用`foo.SomeMethod(color);`实例`foo`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T09:04:36.010

另一个未提及的选项是将 RunA 和 RunB 更改为事件而不是方法。.net 中的事件相当轻巧且快速，并且可能与您的使用模型相匹配，而无需构建新类来定义每个实例/使用的行为。

鉴于您想要基于实例的行为，您将需要重新设计它以使用委托或事件，或者传入单个基类或接口并直接在其上调用方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T08:37:04.750

如果只有有限的颜色选择，如蓝色、红色、橙色和粉红色。您可以创建一个枚举，例如

```
public enum Color 
{
   Blue,
   Red,
   Orange,
   Pink
} 
```

并将此枚举与`switch`此处提到的任何解决方案的声明一起使用。编译器将枚举视为整数 & 因为您需要性能。整数比较比字符串比较更有效。

```
switch (color)
{
case Color.Blue:
case Color.Orange: 
                   RunA();
                   break;
case Color.Red:
case Color.Pink:   RunB();
                   break;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T10:14:33.550

将 RunA、RunB 方法公开为事件，以便任何调用者都可以附加到它们。前任。：

```
public class SystemTest
{ 
   public TestMethod(string testString)
   {
      if(testString == "blue")
      {
         RunA();
      }
      else if(testString == "red")
      {
         RunB();
      }
      else if(testString == "orange")
      {
         RunA();
      }
      else if(testString == "pink")
      {
         RunB();
      }
   }

   protected event Action RunA;
   protected event Action RunB;       
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T18:34:27.157

当你只需要一个数据结构时，为什么要使用一个类？

```
Dictionary<string, Action> MethodMap = new Dictionary<string, Action>
{
   { "red", RedMethod },
   { "blue", BlueMethod },
   { "green", GreenMethod },
   { "yellow", YellowMethod }
}; 
```

那么你不需要一个类来运行该方法；简单地

```
Method[key]; 
```

会做。

# xcode - 这是什么“前进/后退”的东西？........和文件切换

> ID：653345
> 
> 赞同：1
> 
> 时间：2009-03-17T08:00:57.507
> 
> 标签：xcode, editor

您知道在 Xcode 中，您可以按**选项 - 命令 - 左/右箭头**在多个文件之间切换。但是这些文件是什么？

他们似乎是那些已经打开的。但是有没有办法检查它们是什么？并关闭一些不需要的。

或者，您知道在文件之间切换的任何其他方式？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T09:52:27.863

[替代文字 http://img19.imageshack.us/img19/8724/picture4asx.png](http://img19.imageshack.us/img19/8724/picture4asx.png)

*   如果您单击`untitled.m`它会显示“历史记录”，尽管它的功能更像是每个窗口打开多个文档。
*   它左侧的 2 个箭头相当于`command`+ `option`+`arrow`
*   `command`++`shift`将`W`关闭当前打开的文档并打开最近的文档

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T08:25:45.507

我非常想念 ctrl+tab 来查看 Visual Studio、Eclipse 等最近的文档列表。他们使用应用程序切换器来实现，那么为什么不在他们的编辑器中呢？“Command + Option + Shift + T”快捷键是怎么回事？切换到 Mac 后我注意到的一件事是使用了诸如“按 cmd+ctrl+option+]+k 来打开 bla bla”这样的蹩脚快捷方式。有苹果开发者4手之类的吗？如果我想缩进多行，它应该只是制表符。Apple 和第 3 方开发人员似乎不像他们在 Windows 世界中那样遵循标准，每个应用程序都有自己的做事方式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T09:43:28.087

你的猜测

> 它们似乎是那些已经打开的

是正确的。

以下是一些可用于在文件之间切换的方法。

**^1 个弹出窗口加载的文件**

Command + Option + Up 在声明文件和实现文件之间切换。
Command + Shift + D 快速打开项目相关文件。
Command + Option + Shift + T 在组列表中显示您的文件。然后选择相关的。

“包含文件的弹出”也是浏览与当前文件相关的文件的好方法。

“查看 -> 智能组 -> 所有文件 | 符号 | 等”，然后按 Tab 并键入首字母。标签。并选择一个你想要的。为此绑定一些键。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-03-16T11:45:52.950

最简单：两根手指在触控板上左右滑动。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-08-13T11:37:41.730

Command + Option + 左/右箭头 - 折叠代码

Command + Ctrl + 上/下箭头 - 在 .h 和 .m 之间切换

Command + Ctrl + 左/右箭头 - 向后/向前移动

# ethernet - 我如何从以太网访问原始数据？

> ID：653347
> 
> 赞同：1
> 
> 时间：2009-03-17T08:01:11.327
> 
> 标签：ethernet

我想从以太网访问原始值，实际上是通过一些硬件编程我通过以太网向系统发送一个值，但是无法访问我要发送的确切内容

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-05T06:07:10.683

听起来您需要的是协议分析器。在 Windows 上，查看[Microsoft 的网络监视器](http://www.microsoft.com/downloads/details.aspx?FamilyID=983b941d-06cb-4658-b7f6-3088333d062f&displaylang=en)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T21:34:00.217

您可以使用像 Wireshark 这样的数据包嗅探器，在源系统或目标系统上运行。这将让您在数据包离开或进入时分别检查它们。

# c# - C# 正则表达式用另一个分隔符替换一个分隔符

> ID：653348
> 
> 赞同：0
> 
> 时间：2009-03-17T08:01:15.680
> 
> 标签：c#, regex, parsing, plsql, csv

我正在处理要替换 ';' 的 pl/sql 代码 用'〜'注释。

例如

如果我有一个代码：

> ```
> --comment 1 with;
> select id from t_id;
> --comment 2 with ;
> select name from t_id;
> /*comment 3 
> with ;*/ 
> ```

然后我希望我的结果文本为：

> ```
> --comment 1 with~
> select id from t_id;
> --comment 2 with ~
> select name from t_id;
> /*comment 3 
> with ~*/ 
> ```

可以在 C# 中使用正则表达式来完成吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T08:30:44.207

正则表达式：

```
((?:--|/\*)[^~]*)~(\*/)? 
```

使用它的 C# 代码：

```
string code = "all that text of yours";
Regex regex = new Regex(@"((?:--|/\*)[^~]*)~(\*/)?", RegexOptions.Multiline);
result = regex.Replace(code, "$1;$2"); 
```

未使用 C# 测试，但正则表达式和替换在 RegexBuddy 中与您的文本一起工作 =)

注意：我不是一个非常出色的正则表达式编写者，所以它可能会写得更好。但它有效。并使用以 -- 开头的单行注释以及使用 /* */ 开头的多行注释来处理您的情况

编辑：阅读您对另一个答案的评论，因此删除了`^`锚点，以便它处理不从新行开始的评论。

编辑2：认为它可以简化一点。还发现它在没有结尾 $ 锚的情况下也能正常工作。

**解释：**

```
// ((?:--|/\*)[^~]*)~(\*/)?
// 
// Options: ^ and $ match at line breaks
// 
// Match the regular expression below and capture its match into backreference number 1 «((?:--|/\*)[^~]*)»
//    Match the regular expression below «(?:--|/\*)»
//       Match either the regular expression below (attempting the next alternative only if this one fails) «--»
//          Match the characters “--” literally «--»
//       Or match regular expression number 2 below (the entire group fails if this one fails to match) «/\*»
//          Match the character “/” literally «/»
//          Match the character “*” literally «\*»
//    Match any character that is NOT a “~” «[^~]*»
//       Between zero and unlimited times, as many times as possible, giving back as needed (greedy) «*»
// Match the character “~” literally «~»
// Match the regular expression below and capture its match into backreference number 2 «(\*/)?»
//    Between zero and one times, as many times as possible, giving back as needed (greedy) «?»
//    Match the character “*” literally «\*»
//    Match the character “/” literally «/» 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T08:13:33.590

正则表达式并不是真正需要的——您可以在行上进行迭代，找到以“--”开头的行并替换“;” 上面有“~”。

[`String.StartsWith("--")`](http://msdn.microsoft.com/en-us/library/system.string.startswith.aspx)- 确定 String 实例的开头是否与指定的字符串匹配。

[`String.Replace(";", "~")`](http://msdn.microsoft.com/en-us/library/system.string.replace.aspx)- 返回一个新字符串，其中在此实例中出现的所有指定 Unicode 字符或字符串都替换为另一个指定的 Unicode 字符或字符串。

# delphi - Delphi ClientDataset 只读

> ID：653350
> 
> 赞同：3
> 
> 时间：2009-03-17T08:01:31.000
> 
> 标签：delphi, delphi-2007, readonly

我目前正在测试：

1.  指向 IB 数据库的 SQLConnection。
2.  将 SQLConnection 字段设置为上述字段的 SQLDataset。
3.  将 (2) 中的 SQLDataset 作为其 Dataset 字段值的 DatasetProvider。
4.  一个 ClientDataset，其中 ProviderName 字段指向 (3) 中的提供者。

我使用以下方法（从 Alister Christie 借来的）来获取数据...

```
function TForm1.GetCurrEmployee(const IEmployeeID: integer): OleVariant; 
const 
  SQLSELEMP = 'SELECT E.* FROM EMPLOYEE E WHERE E.EMPLOYEEID = %s'; 
begin 
  MainDM.SQLDataset1.CommandText := Format(SQLSELEMP, [Edit1.Text]); 
  Result := MainDM.DataSetProvider1.Data; 
end; 
```

它只用一条记录填充 DBGrid。但是，当我手动编辑记录时，单击发布，然后尝试提交更改，使用

```
MainDM.ClientDataset1.ApplyUpdates(0); // <<<<<< 
```

它会爆炸，并显示消息“SQLDataset1：无法修改只读数据集”。

我检查了 Provider 和 ClientDataset 的 ReadOnly 属性，并且 SQL 没有连接。

什么可能导致错误？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-07-10T20:19:11.413

您的 ClientDataSet.Data 属性似乎是从 DataSetProvider 的 Data 属性中填充的。通过您描述的设置，您应该能够简单地调用 ClientDataSet.Open，它将从 DataSetProvider 获取数据。

顺便说一句，当您调用 ClientDataSet.ApplyUpdates 方法时，DataSetProvider 的默认行为是将 SQL 查询发送到连接对象，而不是从中获取数据的 DataSet（假设是同类查询）。确保您的 DataSetProvider.ResolveToDataSet 属性未设置为 true。

最后，在一个不相关的注释中，您上面的代码似乎对 SQL 注入攻击开放（尽管我没有对此进行测试）。使用参数来定义 WHERE 子句更安全。如果有人在 Edit1 中输入以下内容，您可能会遇到麻烦（假设 InterBase 使用 drop table 语法）： 1;drop table employee;

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-10T02:17:20.950

检查. `LiveMode`_`TIBDataSet`

# .net - .NET 的 HTML 解析库

> ID：653357
> 
> 赞同：4
> 
> 时间：2009-03-17T08:03:45.330
> 
> 标签：.net, html, dom, parsing

我正在寻找库来解析 HTML 以提取链接、表单、标签等。

*   [http://www.majestic12.co.uk/projects/html_parser.php](http://www.majestic12.co.uk/projects/html_parser.php)
*   [http://www.netomatix.com/Products/DocumentManagement/HtmlParserNet.aspx](http://www.netomatix.com/Products/DocumentManagement/HtmlParserNet.aspx)
*   [http://www.developer.com/net/csharp/article.php/2230091](http://www.developer.com/net/csharp/article.php/2230091)

LGPL 或任何其他商业开发友好的许可证是可取的。

您对其中一个库有任何经验吗？或者你能推荐另一个类似的图书馆吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-17T08:08:30.763

[HTML Agility Pack](http://www.codeplex.com/htmlagilitypack)有这种类型的示例，并使用 xpath 进行熟悉的查询 - 例如（从主页），查找所有链接很简单：

```
foreach(HtmlNode link in doc.DocumentElement.SelectNodes("//a@href")) {
    //...
} 
```

* * *

**编辑**

*自 2012 年 6 月 19 日起，上面的代码以及**[HTML 敏捷包示例](http://htmlagilitypack.codeplex.com/wikipage?title=Examples)**页面上显示的唯一代码示例将无法正常工作。只需要稍作调整，如下所示。*

```
HtmlDocument doc = new HtmlDocument();
doc.Load("file.htm");

foreach (HtmlNode link in doc.DocumentNode.SelectNodes("//a[@href]"))
{
  HtmlAttribute att = link.Attributes["href"];
  att.Value = Foo(att); // fix the link
}
doc.Save("file.htm"); 
```

# ruby - 相当于其他语言的ruby方法名的感叹号

> ID：653360
> 
> 赞同：9
> 
> 时间：2009-03-17T08:06:53.763
> 
> 标签：ruby, naming-conventions

在 Ruby 中，具有副作用的方法或更改作为参数传递的对象的方法具有“！” 作为后缀。

例如：

`"SomeString".gsub!(/S/, "s")`
将更改 String 对象，同时
`"SomeString".gsub(/S/, "s")`
将处理 String 对象的副本，并且不会更改方法之外的任何对象的状态。

我喜欢这个约定，我也想在用其他语言编程时使用它。

我的问题：

*   真正的 Ruby 程序员（我不是；-)）真的使用这个约定吗？如果不是，为什么不呢？*   Java、PHP、Perl、Cobol 中的命名方法是否有等效约定？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T11:53:03.173

Bang 方法并不意味着“更换接收器”。

[http://www.wobblini.net/bang.txt](http://www.wobblini.net/bang.txt)

如您所见，Matz 的意思是“比没有感叹号的版本更危险”。只是一个一般的仅供参考，到目前为止看到的大多数答案都提到了更换接收器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T09:06:40.280

在 Scheme 中，具有副作用的方法或更改作为参数传递的对象的方法带有“！” 作为后缀。作为谓词的方法有一个“？”。其他 lisp 有时也使用这种约定。

在 Java 中，通常有`void`一个过程的返回类型会改变它的接收者，而返回一个不改变接收者的函数的计算值。（例如： String.toLowerCase() 返回一个新字符串， Collections.sort(List) 就地排序并且不返回值）。然而，这不是一个严格的习惯用法，因为经常变异的过程也需要返回一个值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T08:15:51.183

我只能谈论我使用过的语言，但是……我不熟悉 Python、Perl、Java、PHP、Javascript 或 Bash (shell) 脚本中的任何此类约定。

一些程序员可能会发现在函数名称上放置一些前缀或后缀来指示那些改变其参数的那些与创建参数的新“版本”并返回它们的那些是有用的。如果你是这些人中的一员，请继续前进。但同样，我不知道任何标准（除了`const`Steven 在 C 和 C++ 中提到的东西）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T08:13:34.557

在其他语言（特别是 C++）中标记参数有一个约定。调用方法时，用 const 标记不会改变的参数：例如

```
void doSomething( const int &parameter ) 
```

# algorithm - 查找多个区间之间的重叠

> ID：653365
> 
> 赞同：1
> 
> 时间：2009-03-17T08:08:39.327
> 
> 标签：algorithm, binary-tree, interval-tree

假设我有一个区间（或范围）列表（例如 10-15、5-7、9-12 ..）。问题是找到重叠的范围子集。当然，我可以为此使用[区间树](http://en.wikipedia.org/wiki/Interval_tree)。

我遇到的实际问题是有多个范围。最好用一个例子来解释：

1.  10-15、5-7、9-12
2.  1-2、3-6、14-15
3.  3-5、9-15、10-15

在上述情况下，（1）和（2）在第二范围内有重叠，在（3）和（1）、（2）之间在第三范围内有重叠。

基本上，我需要找到项目列表之间的*所有重叠。*

也许我可以使用 3 个单独的区间树来找出答案。有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T08:28:18.563

您可以只构建一个包含所有间隔的间隔树。您只需要跟踪区间所属的范围，例如：

```
{
  int range;
  int intervalFrom;
  int intervalTo;
} 
```

您可以将该结构放在间隔树中并检查是否重叠。当您得到有问题的间隔时，您将能够分辨出每个间隔属于哪个范围。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-04-20T00:08:47.393

区间 [a0, b0] 和 [a1, b1] 重叠当且仅当 min(b1,b0) > max(a1,a0)

# python - 如何创建一个可以使用或不使用参数的装饰器？

> ID：653368
> 
> 赞同：113
> 
> 时间：2009-03-17T08:10:19.760
> 
> 标签：python, decorator

我想创建一个可以与参数一起使用的 Python 装饰器：

```
@redirect_output("somewhere.log")
def foo():
    .... 
```

或没有它们（例如，默认将输出重定向到 stderr）：

```
@redirect_output
def foo():
    .... 
```

这有可能吗？

请注意，我不是在寻找重定向输出问题的不同解决方案，它只是我想要实现的语法示例。

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2013-01-19T09:24:01.933

我知道这个问题很老，但有些评论是新的，虽然所有可行的解决方案基本上都是一样的，但它们中的大多数都不是很干净或易于阅读。

就像 thobe 的回答所说，处理这两种情况的唯一方法是检查这两种情况。最简单的方法是简单地检查是否有一个参数并且它是 callabe （注意：如果你的装饰器只接受 1 个参数并且它恰好是一个可调用对象，则需要额外的检查）：

```
def decorator(*args, **kwargs):
    if len(args) == 1 and len(kwargs) == 0 and callable(args[0]):
        # called as @decorator
    else:
        # called as @decorator(*args, **kwargs) 
```

在第一种情况下，您执行任何普通装饰器所做的事情，返回传入函数的修改或包装版本。

在第二种情况下，您返回一个“新”装饰器，它以某种方式使用通过 *args、**kwargs 传入的信息。

这很好，但是必须为您制作的每个装饰器都写出来可能会很烦人并且不那么干净。相反，能够自动修改我们的装饰器而不必重新编写它们会很好......但这就是装饰器的用途！

使用以下装饰器装饰器，我们可以装饰我们的装饰器，以便它们可以带或不带参数使用：

```
def doublewrap(f):
    '''
    a decorator decorator, allowing the decorator to be used as:
    @decorator(with, arguments, and=kwargs)
    or
    @decorator
    '''
    @wraps(f)
    def new_dec(*args, **kwargs):
        if len(args) == 1 and len(kwargs) == 0 and callable(args[0]):
            # actual decorated function
            return f(args[0])
        else:
            # decorator arguments
            return lambda realf: f(realf, *args, **kwargs)

    return new_dec 
```

现在，我们可以使用@doublewrap 来装饰我们的装饰器，它们可以使用和不使用参数，但需要注意一点：

我在上面提到过，但应该在这里重复一遍，这个装饰器中的检查对装饰器可以接收的参数进行了假设（即它不能接收单个可调用的参数）。由于我们现在使它适用于任何生成器，因此需要牢记它，或者如果它会发生矛盾则对其进行修改。

下面演示了它的用法：

```
def test_doublewrap():
    from util import doublewrap
    from functools import wraps    

    @doublewrap
    def mult(f, factor=2):
        '''multiply a function's return value'''
        @wraps(f)
        def wrap(*args, **kwargs):
            return factor*f(*args,**kwargs)
        return wrap

    # try normal
    @mult
    def f(x, y):
        return x + y

    # try args
    @mult(3)
    def f2(x, y):
        return x*y

    # try kwargs
    @mult(factor=5)
    def f3(x, y):
        return x - y

    assert f(2,3) == 10
    assert f2(2,5) == 30
    assert f3(8,1) == 5*7 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-03-17T09:13:19.033

使用具有默认值的关键字参数（如 kquinn 所建议）是一个好主意，但需要您包含括号：

```
@redirect_output()
def foo():
    ... 
```

如果你想要一个在装饰器上没有括号的版本，你必须在你的装饰器代码中考虑这两种情况。

如果您使用的是 Python 3.0，则可以为此使用仅关键字参数：

```
def redirect_output(fn=None,*,destination=None):
  destination = sys.stderr if destination is None else destination
  def wrapper(*args, **kwargs):
    ... # your code here
  if fn is None:
    def decorator(fn):
      return functools.update_wrapper(wrapper, fn)
    return decorator
  else:
    return functools.update_wrapper(wrapper, fn) 
```

在 Python 2.x 中，这可以用 varargs 技巧来模拟：

```
def redirected_output(*fn,**options):
  destination = options.pop('destination', sys.stderr)
  if options:
    raise TypeError("unsupported keyword arguments: %s" % 
                    ",".join(options.keys()))
  def wrapper(*args, **kwargs):
    ... # your code here
  if fn:
    return functools.update_wrapper(wrapper, fn[0])
  else:
    def decorator(fn):
      return functools.update_wrapper(wrapper, fn)
    return decorator 
```

这些版本中的任何一个都允许您编写如下代码：

```
@redirected_output
def foo():
    ...

@redirected_output(destination="somewhere.log")
def bar():
    ... 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2013-09-26T01:35:52.387

我知道这是一个老问题，但我真的不喜欢提出的任何技术，所以我想添加另一种方法。我看到 django 在他们的[`login_required`装饰器中`django.contrib.auth.decorators`](https://github.com/django/django/blob/1.5.4/django/contrib/auth/decorators.py#L44)使用了一种非常干净的方法。正如您在[装饰器的文档](https://docs.djangoproject.com/en/1.5/topics/auth/default/#the-login-required-decorator)中看到的那样，它可以单独用作`@login_required`或与参数一起使用，`@login_required(redirect_field_name='my_redirect_field')`.

他们这样做的方式非常简单。他们在装饰器参数之前添加一个`kwarg`( )。`function=None`如果单独使用装饰器，`function`它将是它正在装饰的实际函数，而如果使用参数调用它，`function`它将是`None`.

**例子：**

```
from functools import wraps

def custom_decorator(function=None, some_arg=None, some_other_arg=None):
    def actual_decorator(f):
        @wraps(f)
        def wrapper(*args, **kwargs):
            # Do stuff with args here...
            if some_arg:
                print(some_arg)
            if some_other_arg:
                print(some_other_arg)
            return f(*args, **kwargs)
        return wrapper
    if function:
        return actual_decorator(function)
    return actual_decorator 
```

* * *

```
@custom_decorator
def test1():
    print('test1')

>>> test1()
test1 
```

* * *

```
@custom_decorator(some_arg='hello')
def test2():
    print('test2')

>>> test2()
hello
test2 
```

* * *

```
@custom_decorator(some_arg='hello', some_other_arg='world')
def test3():
    print('test3')

>>> test3()
hello
world
test3 
```

我发现 django 使用的这种方法比这里提出的任何其他技术都更优雅、更容易理解。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2016-09-05T17:59:30.373

这里的几个答案已经很好地解决了您的问题。`functools.partial`然而，就风格而言，我更喜欢使用David Beazley 的*Python Cookbook 3*中的建议来解决这个装饰器困境：

```
from functools import partial, wraps

def decorator(func=None, foo='spam'):
    if func is None:
         return partial(decorator, foo=foo)

    @wraps(func)
    def wrapper(*args, **kwargs):
        # do something with `func` and `foo`, if you're so inclined
        pass

    return wrapper 
```

虽然是的，但你可以这样做

```
@decorator()
def f(*args, **kwargs):
    pass 
```

没有时髦的解决方法，我觉得它看起来很奇怪，我喜欢选择简单地用`@decorator`.

至于次要任务目标，此[Stack Overflow 帖子](https://stackoverflow.com/questions/4675728/redirect-stdout-to-a-file-in-python)中解决了重定向函数输出的问题。

* * *

如果您想深入了解，请查看*Python Cookbook 3*中的第 9 章（元编程） ，该书可免费[在线阅读](http://chimera.labs.oreilly.com/books/1230000000393/ch09.html)。

其中一些材料在 Beazley 的精彩 YouTube 视频[Python 3 Metaprogramming](https://youtu.be/sPiWg5jSoZI)中进行了现场演示（还有更多！） 。

快乐编码:)

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-03-17T09:25:42.263

您需要检测这两种情况，例如使用第一个参数的类型，并相应地返回包装器（不带参数使用时）或装饰器（带参数使用时）。

```
from functools import wraps
import inspect

def redirect_output(fn_or_output):
    def decorator(fn):
        @wraps(fn)
        def wrapper(*args, **args):
            # Redirect output
            try:
                return fn(*args, **args)
            finally:
                # Restore output
        return wrapper

    if inspect.isfunction(fn_or_output):
        # Called with no parameter
        return decorator(fn_or_output)
    else:
        # Called with a parameter
        return decorator 
```

使用`@redirect_output("output.log")`语法时，`redirect_output`使用单个参数调用`"output.log"`，它必须返回一个装饰器，接受要作为参数装饰的函数。当用作 时`@redirect_output`，直接使用要装饰的函数作为参数调用它。

或者换句话说：`@`语法后面必须跟一个表达式，其结果是一个函数，接受一个要被修饰的函数作为它的唯一参数，并返回被修饰的函数。表达式本身可以是函数调用，`@redirect_output("output.log")`. 令人费解，但真实:-)

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-03-17T09:41:39.697

根据您是否给它参数，python 装饰器的调用方式完全不同。装饰实际上只是一个（语法限制的）表达式。

在您的第一个示例中：

```
@redirect_output("somewhere.log")
def foo():
    .... 
```

该函数`redirect_output`使用给定的参数调用，该参数预期返回一个装饰器函数，该装饰器函数本身`foo`作为参数调用，（终于！）预期返回最终的装饰函数。

等效代码如下所示：

```
def foo():
    ....
d = redirect_output("somewhere.log")
foo = d(foo) 
```

第二个示例的等效代码如下所示：

```
def foo():
    ....
d = redirect_output
foo = d(foo) 
```

所以你*可以*做你想做的事，但不是以一种完全无缝的方式：

```
import types
def redirect_output(arg):
    def decorator(file, f):
        def df(*args, **kwargs):
            print 'redirecting to ', file
            return f(*args, **kwargs)
        return df
    if type(arg) is types.FunctionType:
        return decorator(sys.stderr, arg)
    return lambda f: decorator(arg, f) 
```

这应该没问题，除非您希望将函数用作装饰器的参数，在这种情况下，装饰器会错误地认为它没有参数。如果将此装饰应用于另一个不返回函数类型的装饰，它也会失败。

另一种方法是要求始终调用装饰器函数，即使它没有参数。在这种情况下，您的第二个示例将如下所示：

```
@redirect_output()
def foo():
    .... 
```

装饰器函数代码如下所示：

```
def redirect_output(file = sys.stderr):
    def decorator(file, f):
        def df(*args, **kwargs):
            print 'redirecting to ', file
            return f(*args, **kwargs)
        return df
    return lambda f: decorator(file, f) 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-07-16T18:39:43.573

事实上，@bj0 的解决方案中的警告案例可以很容易地检查：

```
def meta_wrap(decor):
    @functools.wraps(decor)
    def new_decor(*args, **kwargs):
        if len(args) == 1 and len(kwargs) == 0 and callable(args[0]):
            # this is the double-decorated f. 
            # Its first argument should not be a callable
            doubled_f = decor(args[0])
            @functools.wraps(doubled_f)
            def checked_doubled_f(*f_args, **f_kwargs):
                if callable(f_args[0]):
                    raise ValueError('meta_wrap failure: '
                                'first positional argument cannot be callable.')
                return doubled_f(*f_args, **f_kwargs)
            return checked_doubled_f 
        else:
            # decorator arguments
            return lambda real_f: decor(real_f, *args, **kwargs)

    return new_decor 
```

下面是这个故障安全版本的一些测试用例`meta_wrap`。

```
 @meta_wrap
    def baddecor(f, caller=lambda x: -1*x):
        @functools.wraps(f)
        def _f(*args, **kwargs):
            return caller(f(args[0]))
        return _f

    @baddecor  # used without arg: no problem
    def f_call1(x):
        return x + 1
    assert f_call1(5) == -6

    @baddecor(lambda x : 2*x) # bad case
    def f_call2(x):
        return x + 1
    f_call2(5)  # raises ValueError

    # explicit keyword: no problem
    @baddecor(caller=lambda x : 100*x)
    def f_call3(x):
        return x + 1
    assert f_call3(5) == 600 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-10-10T14:41:00.753

要完成其他答案：

> “有没有办法构建一个既可以带参数也可以不带参数的装饰器？”

**不**，没有通用的方法，因为目前 python 语言中缺少一些东西来检测两个不同的用例。

但是，**是**的，正如其他答案（例如[`bj0`s](https://stackoverflow.com/a/14412901/7262247) ）已经指出的那样，有一个**笨拙的解决方法**是检查收到的第一个位置参数的类型和值（并检查是否没有其他参数具有非默认值）。如果您保证用户**永远不会**将可调用对象作为装饰器的第一个参数传递，那么您可以使用此解决方法。请注意，这对于类装饰器是相同的（替换上一句中的按类调用）。

为了确定上述内容，我做了很多研究，甚至实现了一个名为的库，该库[`decopatch`](https://smarie.github.io/python-decopatch/)使用上面引用的所有策略（以及更多策略，包括内省）的组合来执行“最智能的解决方法”，具体取决于根据您的需要。它捆绑了两种模式：嵌套模式和平面模式。

在“嵌套模式”中，您总是返回一个函数

```
from decopatch import function_decorator

@function_decorator
def add_tag(tag='hi!'):
    """
    Example decorator to add a 'tag' attribute to a function. 
    :param tag: the 'tag' value to set on the decorated function (default 'hi!).
    """
    def _apply_decorator(f):
        """
        This is the method that will be called when `@add_tag` is used on a 
        function `f`. It should return a replacement for `f`.
        """
        setattr(f, 'tag', tag)
        return f
    return _apply_decorator 
```

在“平面模式”中，您的方法直接是应用装饰器时将执行的代码。它被注入了装饰的函数对象`f`：

```
from decopatch import function_decorator, DECORATED

@function_decorator
def add_tag(tag='hi!', f=DECORATED):
    """
    Example decorator to add a 'tag' attribute to a function.
    :param tag: the 'tag' value to set on the decorated function (default 'hi!).
    """
    setattr(f, 'tag', tag)
    return f 
```

但坦率地说，最好的办法是在这里不需要任何库，直接从 python 语言中获取该功能。如果像我一样，您认为遗憾的是，python 语言目前还不能为这个问题提供一个简洁的答案，**请不要犹豫，在 python bugtracker 中支持这个想法**：[https://bugs.python .org/issue36553](https://bugs.python.org/issue36553)！

非常感谢您帮助使 python 成为更好的语言 :)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-03-23T00:13:13.607

这可以毫不费力地完成工作：

```
from functools import wraps

def memoize(fn=None, hours=48.0):
  def deco(fn):
    @wraps(fn)
    def wrapper(*args, **kwargs):
      return fn(*args, **kwargs)
    return wrapper

  if callable(fn): return deco(fn)
  return deco 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-10-30T15:19:37.243

由于没有人提到这一点，因此还有一个使用可调用类的解决方案，我觉得它更优雅，特别是在装饰器很复杂并且可能希望将其拆分为多个方法（函数）的情况下。该解决方案利用`__new__`魔术方法基本上完成了其他人指出的事情。首先检测装饰器的使用方式，然后适当调整返回。

```
class decorator_with_arguments(object):

    def __new__(cls, decorated_function=None, **kwargs):

        self = super().__new__(cls)
        self._init(**kwargs)

        if not decorated_function:
            return self
        else:
            return self.__call__(decorated_function)

    def _init(self, arg1="default", arg2="default", arg3="default"):
        self.arg1 = arg1
        self.arg2 = arg2
        self.arg3 = arg3

    def __call__(self, decorated_function):

        def wrapped_f(*args):
            print("Decorator arguments:", self.arg1, self.arg2, self.arg3)
            print("decorated_function arguments:", *args)
            decorated_function(*args)

        return wrapped_f

@decorator_with_arguments(arg1=5)
def sayHello(a1, a2, a3, a4):
    print('sayHello arguments:', a1, a2, a3, a4)

@decorator_with_arguments()
def sayHello(a1, a2, a3, a4):
    print('sayHello arguments:', a1, a2, a3, a4)

@decorator_with_arguments
def sayHello(a1, a2, a3, a4):
    print('sayHello arguments:', a1, a2, a3, a4) 
```

如果装饰器与参数一起使用，则等于：

```
result = decorator_with_arguments(arg1=5)(sayHello)(a1, a2, a3, a4) 
```

可以看到参数`arg1`被正确地传递给了构造函数，并且被装饰的函数被传递给了`__call__`

但如果装饰器不带参数使用，则等于：

```
result = decorator_with_arguments(sayHello)(a1, a2, a3, a4) 
```

您会看到，在这种情况下，装饰函数直接传递给构造函数，并且`__call__`完全省略了对的调用。`__new__`这就是为什么我们需要在魔术方法中使用逻辑来处理这种情况。

为什么我们不能使用`__init__`而不是`__new__`？原因很简单：python 禁止返回 None 以外的任何其他值`__init__`

**警告**

这种方法有一个副作用。它不会保留函数签名！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-09-16T14:55:14.167

这对我有用：

```
def redirect_output(func=None, /, *, output_log='./output.log'):
    def out_wrapper(func):
        def wrapper(*args, **kwargs):
            res = func(*args, **kwargs)
            print(f"{func.__name__} finished, output_log:{output_log}")
            return res

        return wrapper

    if func is None:
        return out_wrapper  # @redirect_output()
    return out_wrapper(func)  # @redirect_output

@redirect_output
def test1():
    print("running test 1")

@redirect_output(output_log="new.log")
def test2():
    print("running test 2")

test1()
print('-----')
test2() 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2009-03-17T08:19:36.773

您是否尝试过使用默认值的关键字参数？就像是

```
def decorate_something(foo=bar, baz=quux):
    pass 
```

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2009-03-17T08:18:44.297

通常，您可以在 Python 中提供默认参数...

```
def redirect_output(fn, output = stderr):
    # whatever 
```

不过，不确定这是否也适用于装饰器。我不知道为什么它不会。

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2009-03-17T08:53:57.113

基于 vartec 的回答：

```
imports sys

def redirect_output(func, output=None):
    if output is None:
        output = sys.stderr
    if isinstance(output, basestring):
        output = open(output, 'w') # etc...
    # everything else... 
```

# msbuild - Perforce 作为 w2k3x64 上的集成和构建服务器？

> ID：653370
> 
> 赞同：2
> 
> 时间：2009-03-17T08:10:51.243
> 
> 标签：msbuild, build-process, continuous-integration, perforce

我们正在从 TFS 2005 迁移到 Perforce，并为我们的软件转向更简单的 TDD 类型的过程。您是否有任何资源可以将 Perforce 设置为集成和构建服务器？

看了这个问题[构建管理/持续集成最佳实践](https://stackoverflow.com/questions/419181/build-management-continous-integration-best-practices)

它还链接到 CI [http://www.martinfowler.com/articles/continuousIntegration.html](http://www.martinfowler.com/articles/continuousIntegration.html)上的 Martin Fowler 。

我的问题是关于 Perforce 和 W2k3 x64 上的 MSBuild。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T10:44:42.353

Perforce 不是集成或构建服务器，它只是扮演 CI 过程的源存储库的角色。因此，对于您的 CI 工具（如果它的 MSBuild、Hudson、CruiseControl 等），拥有一个适配器（一个 perforce 适配器）以从存储库中获取最新更改非常重要。适配器应该是可配置的（URL、用户名、密码等），这就是 Perforce 和 CI。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T10:57:39.470

只是对此进行了更多研究，并得出了相同的结论...

可能遇到此问题的人的链接

Cruise Control.Net - 集成服务器[http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET](http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET)

使用 Perforce [http://confluence.public.thoughtworks.org/display/CCNET/Perforce+Source+Control+Block](http://confluence.public.thoughtworks.org/display/CCNET/Perforce+Source+Control+Block)

最后使用 MSBuild [http://confluence.public.thoughtworks.org/display/CCNET/Using+CruiseControl.NET+with+MSBuild](http://confluence.public.thoughtworks.org/display/CCNET/Using+CruiseControl.NET+with+MSBuild)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-01T21:48:48.140

我刚刚为我们的 CI 服务器评估了 TeamCity（替换了自定义脚本）。我非常喜欢它，它与 Perforce 完美配合。

[http://www.jetbrains.com/teamcity/](http://www.jetbrains.com/teamcity/)

# image - 将 PDF 转换为 PNG

> ID：653380
> 
> 赞同：86
> 
> 时间：2009-03-17T08:18:51.707
> 
> 标签：image, pdf, png, imagemagick, ghostscript

我正在尝试将 PDF 转换为 PNG 图像（至少是一个的封面）。我正在使用 pdftk 成功提取 PDF 的第一页。我正在使用 imagemagick 进行转换：

```
convert cover.pdf cover.png 
```

这可行，但不幸的是，cover.png 渲染不正确（PDF 中的某些 alpha 对象未正确渲染）。我知道 ImageMagick 使用 GhostScript 进行转换，如果我直接使用 gs 进行转换，我可以获得所需的结果，但我宁愿使用转换库，因为它还有其他我想利用的工具。

GhostScript 中的此命令可完成所需的图像：

```
gs -sDEVICE=pngalpha -sOutputFile=cover.png -r144 cover.pdf 
```

我想知道有什么方法可以通过转换为 GhostScript 传递参数，还是我坚持直接调用 GhostScript？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2010-07-31T20:14:02.793

如果第一个命令可以将其输出写入标准输出，并且第二个命令可以从标准输入读取其输入，则可以使用一个命令行与通过管道连接的两个命令 ( `gs`, )。`convert`

1.  幸运的是，gs 可以写入标准输出 ( `... -o %stdout ...`)。
2.  幸运的是，convert 可以从 stdin ( `convert -background transparent - output.png`) 中读取。

问题解决了：

*   GS 用于处理特殊图像的 alpha 通道，
*   用于创建透明背景的转换，
*   管道用于避免写出磁盘上的临时文件。

***完整的解决方案：***

```
gs -sDEVICE=pngalpha       \
   -o %stdout              \
   -r144 cover.pdf         \
   |                       \
convert                    \
   -background transparent \
   -                       \
    cover.png 
```

* * *

## 更新

如果您希望每个 PDF 页面有一个单独的 PNG，您可以使用以下`%d`语法：

```
gs -sDEVICE=pngalpha -o file-%03d.png -r144 cover.pdf 
```

`page-000.png`这将创建名为, , ... 的PNG 文件`page-001.png`（请注意，`%d`-counting 是从零开始的 -`file-000.png`对应于 PDF 的第 1`001`页，第 2 页...

或者，如果您想保留透明背景，对于 100 页的 PDF，请执行

```
for i in {1..100}; do        \
                             \
  gs -sDEVICE=pngalpha       \
     -dFirstPage="${i}"      \
     -dLastPage="${i}"       \
     -o %stdout              \
     -r144 input.pdf         \
     |                       \
  convert                    \
     -background transparent \
     -                       \
      page-${i}.png ;        \
                             \
done 
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2013-03-18T18:59:30.967

在所有可用的替代方案中，我发现 Inkscape 在将 PDF 转换为 PNG 时产生最准确的结果。特别是当源文件有透明层时，Inkscape 成功了 Imagemagick 和其他工具失败的地方。

这是我使用的命令：

```
inkscape "$pdf" -z --export-dpi=600 --export-area-drawing --export-png="$pngfile" 
```

在这里它是在一个脚本中实现的：

```
#!/bin/bash

while [ $# -gt 0 ]; do

pdf=$1
echo "Converting "$pdf" ..."
pngfile=`echo "$pdf" | sed 's/\.\w*$/.png/'`
inkscape "$pdf" -z --export-dpi=600 --export-area-drawing --export-png="$pngfile"
echo "Converted to "$pngfile""
shift

done

echo "All jobs done. Exiting." 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2015-11-04T17:52:10.553

要将 pdf 转换为图像文件，请使用以下命令：

**对于 PNG** `gs -sDEVICE=png16m -dTextAlphaBits=4 -r300 -o a.png a.pdf`

**对于 JPG** `gs -sDEVICE=jpeg -dTextAlphaBits=4 -r300 -o a.jpg a.pdf`

如果您有多个页面添加到名称**%03d** `gs -o a%03d.jpg a.pdf`

每个选项的含义：

*   sDEVICE={jpeg,pngalpha,png16m...} - 文件类型
*   -o - 输出文件（%stdout 到 stdout）
*   -dTextAlphaBits=4 - 字体抗锯齿。
*   -r300 - 300 dpi

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2017-09-23T13:24:24.030

还可以使用`poppler-utils`包中包含的命令行实用程序：

```
sudo apt-get install poppler-utils
pdftoppm --help
pdftocairo --help 
```

例子：

```
pdftocairo -png mypage.pdf mypage.png 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2015-03-17T19:50:05.950

无法获得公认的答案。然后发现实际上解决方案要简单得多，因为 Ghostscript 不仅原生支持 PNG，而且甚至支持[多种不同的“编码”](http://ghostscript.com/doc/current/Devices.htm#PNG)：

*   `png256`
*   `png16`
*   `pnggray`
*   `pngmono`
*   ...

对我有用的 shell 命令是：

```
gs -dNOPAUSE -q -sDEVICE=pnggray -r500 -dBATCH -dFirstPage=2 -dLastPage=2 -sOutputFile=test.png test.pdf 
```

它将使用`pnggray`编码和 500 DPI 将 test.pdf 的第 2 页保存到 test.png。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-07-11T12:04:44.367

我会添加我的解决方案，即使他的线程很旧。也许这无论如何都会对某人有所帮助。

首先，我需要生成 PDF。我为此使用[XeLaTeX](http://tug.org/xetex/)：

```
xelatex test.tex 
```

现在，[ImageMagick](http://www.imagemagick.org/script/index.php)和[GraphicMagic](http://www.graphicsmagick.org/)都从左到右解析参数，因此最左边的参数将首先执行。我最终使用此序列进行优化处理：

```
gm convert -trim -transparent white -background transparent -density 1200x1200 -resize 25% test.pdf test.png 
```

它在透明背景上提供漂亮的图形，修剪到页面上的实际内容。`-density`和`-resize`参数，提供更好的粒度，并提高整体分辨率。

我建议检查是否可以为您降低密度。它将减少转换时间。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-09-02T07:00:16.040

对于 ImageMagick 给出的颜色不准确的 PDF，我发现 GraphicsMagick 做得更好：

```
$ gm convert -quality 100 -thumbnail x300 -flatten journal.pdf\[0\] cover.jpg 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-06-28T16:09:19.173

由于此页面还列出了替代工具，因此我将提到**[xpdf](http://www.xpdfreader.com/)**，它具有为 Linux/Windows/Mac 编译的命令行工具。支持透明度。可免费用于商业用途 - 与 Ghostscript 相比，它的定价*确实离谱。*

在一个巨大的 PDF 文件的测试中，它比 Ghostscript 快 7.5%。

（它也有 PDF 到文本和 HTML 转换器）

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-08-05T01:37:18.043

尝试提取单个页面。

$页 = 4

```
gs -sDEVICE=pngalpha -dFirstPage="$page" -dLastPage="$page" -o thumb.png -r144 input.pdf 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-11-16T13:41:00.557

我的解决方案更简单、更直接。至少它在我的 PC 上以这种方式工作（具有以下规格）：

```
me@home: my.folder$ uname -a
Linux home 3.2.0-54-generic-pae #82-Ubuntu SMP Tue Sep 10 20:29:22 UTC 2013 i686 i686 i386 GNU/Linux 
```

和

```
me@home: my.folder$ convert --version
Version: ImageMagick 6.6.9-7 2012-08-17 Q16 http://www.imagemagick.org
Copyright: Copyright (C) 1999-2011 ImageMagick Studio LLC
Features: OpenMP 
```

所以，这就是我在我的`file.pdf`：

```
me@home: my.folder$ convert -density 300 -quality 100 file.pdf file.png 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-06-28T16:16:11.760

您可以使用 ImageMagick，而无需将 PDF 的第一页与其他工具分开。做就是了

```
convert -density 288 cover.pdf[0] -resize 25% cover.png 
```

这里我将标称密度增加 400% (72*4=288)，然后调整 1/4 (25%)。这为生成的 png 提供了更好的质量。

但是，如果 PDF 是 CMYK，则 PNG 不支持。它需要转换为 sRGB，特别是如果它具有透明度，因为 Ghostscript 无法处理带有 alpha 的 CMYK。

```
convert -density 288 -colorspace sRGB -resize 25% cover.pdf[0] cover.png 
```

# verilog - 用于测试平台的 verilog 或 systemc

> ID：653384
> 
> 赞同：1
> 
> 时间：2009-03-17T08:22:46.847
> 
> 标签：verilog, hardware, systemc, register-transfer-level

我的任务是验证一些基于 Verilog 的 RTL 代码。现在，使用verilog 对RTL 测试平台进行编码似乎非常困难（对我而言）。所以我想尝试以下方法之一。- 尝试为 RTL 提供 PLI 接口，从而调用'C 函数进行测试 - 使用系统'C 连接'C 函数

PS：我已经有一个广泛的'C 代码用于测试行为模型。我是硬件编程领域的新手。任何指针将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T08:38:11.987

如果您已经拥有用于测试行为模型的大量 C 代码，那么要做的就是添加一个 PLI（或 DPI）接口，允许您从 verilog 调用该 C 代码。

SystemC 基本上是 C++，有很多类可以让你对硬件进行建模。我看不出你会如何从学习 SystemC 来完成你正在尝试的任务中受益，因为你已经有一个可用的 C 模型，你可以根据它来测试硬件。学习 SystemC 可能对于您正在尝试做的事情来说太过分了。

供参考。如果您想学习当今行业中大量使用的东西，那么我建议您学习 SystemVerilog。现在的 SystemVerilog，基本上是 Verilog，内置了一堆高​​级软件语言功能；连同“VMM”，一种“验证方法”（即一堆库），似乎在硬件验证领域风靡一时。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T09:27:45.207

如果不知道您的 DUV（正在验证的设备）或您拥有的 C 代码，这个问题就不容易回答。您需要刺激和检查您的设计的方法，在这里您可能需要从/到事务级别（C 数据结构）到/从引脚级别转换。SystemVerilog 接口或 SystemC 可能是一种方法。我还没有使用过 DPI/PLI 接口。

要拥有“最先进的”测试平台，您应该考虑使用其中一种测试平台方法，即[VMM](http://www.vmm-sv.org/)或[OVM](http://www.ovmworld.org/)。他们还将为您提供如何开始的文档。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-14T08:03:05.710

听起来您应该获得像 Mentor 或 Cadence 的模拟器这样的工具，将 RTL 和 SystemC 代码结合在一个系统下。当然不是免费的，但它们是实践中存在的解决方案。

您需要的结构正确的解决方案是让 C 或 SystemC 调用 RTL，而不是相反。这样做意味着将一些 RTL 模拟器与您的 C 程序或 SystemC 程序集成。这当然是可行的，但这是一项相当大的任务。

另外，我认为使用 SystemVerilog 很有意义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-24T04:30:11.010

我已经使用 SystemC 和 System Verilog/VMM 进行验证，答案是，这取决于。当我在一家预算有限的初创公司试图推出他们的第一个 ASIC 时，SystemC 是一个自然的选择，因为它运行在我们的低预算模拟器上，而 SystemVerilog 没有。使用 SystemC，您无需使用 PLI 或 DPI。您实际上将 SystemC 模型实例化为测试平台中的一个组件，这很有趣。

然而，SystemC 是一个没有非常直观的语法的 C++ 库。在尝试学习 SystemC 库之前，您应该具有良好的 C++ 背景。除了 David Black 的“SystemC from the Ground Up”之外，可用的书籍大多很烂。

那就是说，据我所见，SystemC自然是一种高级建模语言，而不是一种验证语言，没有任何预算购买真正的模拟器的人不再使用SystemC进行验证。从一般职业发展的角度来看，如果您可以使用 System Verilog，我会使用它。此外，您始终可以使用 DPI 连接到您的 C 模型以进行输出检查，该模型仍然使用以 SV/VMM 编写的生成器、监视器和记分板。

# sql-server - 如何使用正确的对象顺序编写 MS SQL Server 数据库脚本？

> ID：653391
> 
> 赞同：5
> 
> 时间：2009-03-17T08:28:06.707
> 
> 标签：sql-server, database, sql-server-2005, schema

我正在尝试将 MS SQL Server 2005 数据库编写到单个文件中。到目前为止，我已经尝试过使用 SQL Management Studio 和 MS 数据库发布向导。

这两个工具都可以毫无问题地为数据库对象编写脚本，尽管这两个工具都没有按照正确的创建顺序编写对象脚本。例如，该脚本可能会编写一个视图，该视图需要一个表，该表要到稍后才会创建。

您知道如何使用正确的对象创建顺序编写数据库模式脚本吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T08:38:39.850

我们使用它来创建数据库脚本，我必须再次运行它以确保它首先创建对象依赖项......但我还没有遇到问题。 [http://www.red-gate.com/products/SQL_Compare/index.htm](http://www.red-gate.com/products/SQL_Compare/index.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T08:59:46.663

我的回答会有点复杂，而且它只有在你编写整个数据库的脚本时才有效（即，将所有内容都保存在 SQL 脚本中）。我们在一个大型项目中所做的是将脚本组织成以下结构：

*   **_ddl** : 保存表的变化，例如新的列、索引、关系等。
*   **_fn** : 存储函数
*   **_prc** : 存储过程
*   **_static**：显然，“静态数据”，或者部署时必须在数据库中的数据
*   **_tab** : 表（创建脚本）
*   **_trg** : 触发器
*   **_views** : 查看脚本

文件夹名称当然是我们的随机选择，您总是可以以不同的方式排列。之后，我们创建了一个批处理脚本，按以下顺序将所有这些文件合并到一个 SQL 中：

*   _标签
*   _ddl
*   _trg
*   _views
*   _fn
*   _prc
*   _静止的

关键技巧是以一种可以运行一千次的方式编写脚本。这意味着：在创建过程之前删除它们，在创建表之前检查表是否存在，在静态添加之前检查行是否存在，等等。

它并不完美，但它可以完成工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-13T13:53:06.983

有一种简单但出奇有效的方法可以解决排序问题：继续运行每个脚本。单个脚本最终会工作（在首先运行其他脚本之后）或失败 > # of scripts（在这种情况下，它是一个坏脚本）。您可能能够更快/更轻松地检测到错误的脚本 - 但我从来不需要这样做。

如果你有 1 个巨大的脚本，它可能被 GO 语句分割。只要有唯一的 GO 语句，运行它就足够了。任何创建已存在对象的尝试都将失败，并中止批处理。下一批将不间断地运行。最终，您创建了必要的对象 - 重新运行整个脚本将创建依赖对象（并在已经创建的独立对象上失败）。但是，您永远不会让脚本在没有错误的情况下运行。

如果你想更花哨一点，你可以将巨大的脚本分成单独的批次并单独运行。现在，您可以跟踪使它们工作所需的顺序。只需按该顺序重新组合它们，然后输出新脚本。它应该运行没有错误。

或者，花 500 美元购买一个已经可以做到这一点的工具（RedGate、Visual Studio Ultimate/Database Edition 等）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T17:55:17.453

莱克特有一个很好的方法。您可以使用 powershell 脚本（或其他语言）连接这些脚本

运行脚本：

```
PS builddir:\> .\buildsql.ps1 -currentbuilddir "C:\Documents and Settings\sam\My Documents\svn\ticketing" -buildfile "sqlbuild.sql" -teardownfile
"teardown.sql" 
```

PowerShell脚本：

```
param($currentbuilddir,$buildfile1,$teardownfile)

new-psdrive -name builddir -PSProvider filesystem -Root (resolve-path $currentbuilddir)

cd builddir:

rm $buildfile1
rm $teardownfile

Get-item Scripts_Build_1* | ForEAch-object {cat $_ >> $buildfile1; "GO --SYSTEM INSERTED GO--------------" >> $buildfile1} 

Get-item Scripts_Build_3* | ForEAch-object {cat $_ >> $teardownfile; "GO --SYSTEM INSERTED GO------------" >> $teardownfile} 
```

在这里，我正在删除构建文件并拆除文件 - 我实际上正在将 sql 本机加密应用于数据库，因此拆除可能不适用。我将所有脚本都放在一个目录中，因此我认为您可能必须更改此脚本以进行递归。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T12:19:51.963

[您可以在http://www.xsqlsoftware.com/Product/Sql_Schema_Compare.aspx](http://www.xsqlsoftware.com/Product/Sql_Schema_Compare.aspx)尝试 xSQL 对象， 它对我很有用。尽可能以正确的顺序创建脚本（在某些情况下生成的脚本无法直接执行，但在大多数情况下它可以工作）

# asp.net - ASP.NET 形式的控制流

> ID：653393
> 
> 赞同：1
> 
> 时间：2009-03-17T08:28:57.330
> 
> 标签：asp.net, user-controls, master-pages

你好，

我正在尝试开发一个具有一些用户控件的表单，这些控件基本上是下拉列表，将加载静态列表值列表和母版页。我在后面的页面中编写了代码来将值绑定到非选择列表字段。

我发现控件的流程在运行时是这样的：-

1) 首先运行页面后面的代码，将数据绑定到控件 2) 母版页代码运行 3) 运行后面的用户控件代码，将选择列表值绑定到下拉列表。

我原以为流量通常应该是 3、2 和 1。

谁能解释一下？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T08:32:32.767

这取决于您要跟踪的事件。例如，Init 将在其他页面之前触发。然后 Load 在页面上触发，然后递归地对页面上的每个控件执行相同的操作。加载后，页面将继续触发更多事件等。

这是[Microsoft 的一个页面，它很好地描述了页面生命周期](http://msdn.microsoft.com/en-us/library/ms178472.aspx)。

# antivirus - 防病毒程序如何检测 EICAR 测试病毒？

> ID：653396
> 
> 赞同：11
> 
> 时间：2009-03-17T08:30:13.083
> 
> 标签：antivirus, virus, heuristics

EICAR 测试病毒用于测试反病毒程序的功能。为了将其检测为病毒，

防病毒程序是否应具有测试病毒的病毒定义

或者

启发式将其检测为可疑模式并将其检测为病毒。

（我见过一个 AV 程序在下载时删除文件但没有将病毒识别为 EICAR 测试病毒的情况。就像一个可疑对象--> 即如果它有定义它应该识别病毒名称、详细信息等不是'是吗？）

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-17T08:37:18.900

恕我直言，测试病毒的重点是拥有已知无害且被接受为病毒的东西，以便最终用户可以验证 AV 软件是否已打开，并且可以看到病毒识别的效果。想想防火练习，用于 AV 软件。

我想大多数人都有一个签名，并直接认出它。

如果实际 EICAR 测试的位模式碰巧包含闻起来像可疑活动操作码的位模式，我不会感到惊讶，但我不知道是否是这种情况。如果是，那么它可能是对简单启发式病毒识别器的有效测试。然而，由于 EICAR 测试已经存在了*很长时间*，我还可以想象，任何缓存它的启发式方法都不足以在野外捕获任何东西。

我不认为识别 EICAR 可以证明任何比“安装了 AV 并扫描预期扫描的内容”更强大的声明，如果开发一个 AV 系统，我不会尝试对此做出任何更强有力的声明。

**更新：**

实际的 EICAR 测试病毒是以下字符串：

```
X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-标准-抗病毒-测试文件！$H+H*

```

它经过精心设计（根据[Wikipedia 文章](http://en.wikipedia.org/wiki/Eicar_test_file)）具有几个有趣的属性。

首先，它只包含可打印的 ASCII 字符。它通常会在末尾包含空格和/或换行符，但这对其识别或功能没有影响。

这就引出了第二个属性：它实际上是一个 8086 CPU 的可执行程序。它可以（例如通过记事本）保存在扩展名为 .COM 的文件中，并且可以在 MSDOS、大多数 MSDOS 克隆甚至 Windows 命令提示符的 MSDOS 兼容模式下运行（包括在 Vista、但不是在任何 64 位 Windows 上，因为他们认为与 16 位实模式的兼容性不再是优先事项。）

运行时，它会生成字符串“EICAR-STANDARD-ANTIVIRUS-TEST-FILE！”作为输出。然后退出。

他们为什么要这样做？显然，研究人员想要一个已知可以安全运行的程序，部分原因是可以测试实时扫描仪，而无需捕获真正的病毒并冒真正感染的风险。他们还希望通过传统和非传统方式轻松分发它。由于事实证明有一个有用的 x86 实模式指令集子集，其中每个字节都满足它也是可打印的 ASCII 字符的限制，因此他们实现了这两个目标。

wiki 文章有一个链接，该链接指向程序实际工作原理的详细[解释](http://thestarman.pcministry.com/asm/eicar/eicarcom.html)，这也是一个有趣的阅读。更复杂的是，打印到控制台或在 DOS 实模式下退出程序的唯一方法是发出软件中断指令，其操作码 (0xCD) 不是可打印的 7 位 ASCII 字符。此外，这两个中断都需要一个一字节的立即参数，其中一个需要是空格字符。由于自我强加的规则是不允许空格，因此程序的所有最后四个字节（字符串中的“H+H*”）在指令指针到达那里执行它们之前都被修改到位。

在我的 XP 机器上的命令提示符下使用 DEBUG 命令反汇编和转储 EICAR.COM，我看到：

```
0C32:0100 58 流行斧
0C32:0101 354F21 XOR AX,214F
0C32:0104 50 推斧
0C32:0105 254041 和 AX,4140
0C32:0108 50 推斧
0C32:0109 5B 流行音乐 BX
0C32:010A 345C XOR AL,5C
0C32:010C 50 推斧
0C32:010D 5A 流行音乐 DX
0C32:010E 58 POP AX
0C32:010F 353428 XOR AX,2834
0C32:0112 50 推斧
0C32:0113 5E POP SI
0C32:0114 2937 SUB [BX],SI
0C32:0116 43 INC BX
0C32:0117 43 INC BX
0C32:0118 2937 SUB [BX],SI
0C32:011A 7D24 JGE 0140

0C32:0110 45 49 43 41 EICA
0C32:0120 52 2D 53 54 41 4E 44 41-52 44 2D 41 4E 54 49 56 R-STANDARD-ANTIV
0C32:0130 49 52 55 53 2D 54 45 53-54 2D 46 49 4C 45 21 24 IRUS-测试文件！$

0C32:0140 12 月 48 日轴
0C32:0141 2B482A 子 CX,[BX+SI+2A]

```

执行到 的指令后`JGE 0140`，最后两条指令修改为：

```
0C32:0140 CD21 INT 21
0C32:0142 CD20 INT 20

```

大多数 DOS 系统调用是通过指定要执行的函数的or寄存器`INT 21`的值来分派的。在这种情况下，是 0x09，它是打印字符串函数，它打印从偏移量 0x011C 开始的字符串，以美元符号终止。（在纯 DOS 中，您必须使用不同的技巧打印一个美元符号。）该调用会在超过该点的任何额外字节被执行之前终止进程。`AH``AX``AH``INT 20`

自修改代码是早期的病毒技巧，但在这里它用于保留对可在字符串中使用的字节值的限制。在现代系统中，如果在运行 COM 文件的 MSDOS 兼容模式下强制执行，数据执行保护功能可能会捕获修改。

# delphi - 我的组件崩溃（TCustomEdit 后代）

> ID：653404
> 
> 赞同：1
> 
> 时间：2009-03-17T08:34:27.333
> 
> 标签：delphi, debugging, components

我正在尝试创建一个组件，例如 Delphi 2009 的 TButtonedEdit。它是一个自定义 TEdit，左右有 2 个按钮。

在我的版本中，我使用 2 个 TSpeedButton 对象作为左右按钮。

请看下面我的简单代码。

可以安装它，我可以在组件托盘中看到它。

但是，由于某些未知原因，我无法保存我的应用程序。一旦我添加了组件，并开始更改属性或编写事件，Delphi 将立即退出（崩溃？）。

我不知道出了什么问题……但这是我确定不正确的第一个组件。

你能找出问题所在吗？

如果我使用这个组件，Delphi 7.0 似乎在保存 .dfm 时遇到问题。

当我将此组件添加到表单中时，保存它，Delphi 会要求保存“Unit1.pas”，然后立即退出。

谢谢你。

```
unit MyButtonedEdit;

interface

uses
  Windows, Buttons, Classes, Controls, Forms, Graphics, Messages, StdCtrls;

type
  TMyCustomButtonedEdit = class(TCustomEdit)
  private
     FLeftButton: TSpeedButton;
     FRightButton: TSpeedButton;

     procedure LeftButtonClick(Sender: TObject);
     procedure RightButtonClick(Sender: TObject);

     function  GetLeftGlyph: TBitmap;
     function  GetRightGlyph: TBitmap;

     procedure SetLeftGlyph(const g: TBitmap);
     procedure SetRightGlyph(const g: TBitmap);

  protected
     procedure CreateParams(var Params: TCreateParams); override;
     procedure DoLeftButtonClick; virtual; abstract;
     procedure DoRightButtonClick; virtual; abstract;
     function  GetEnabled: boolean; override;
     procedure SetEnabled(e: boolean); override;
     procedure WMSize(var Message: TWMSize); message WM_SIZE;
     property  LeftButton: TSpeedButton read FLeftButton write FLeftButton;
     property  RightButton: TSpeedButton read FRightButton write FRightButton;
     property  Enabled: boolean read GetEnabled write SetEnabled;
     property  LeftGlyph: TBitmap read GetLeftGlyph write SetLeftGlyph;
     property  RightGlyph: TBitmap read GetRightGlyph write SetRightGlyph;

  public
     constructor Create(AOwner: TComponent); override;
     destructor Destroy; override;
  published
  end;

  TMyButtonedEdit = class(TMyCustomButtonedEdit)
  private
     FOnLeftButtonClick: TNotifyEvent;
     FOnRightButtonClick: TNotifyEvent;
  protected
     procedure DoLeftButtonClick; override;
     procedure DoRightButtonClick; override;
  public
  published
     property LeftButton;
     property RightButton;
     property AutoSelect;
     property BorderStyle;
     property Color;
     property Ctl3d;
     property DragCursor;
     property DragMode;
     property Enabled;
     property Font;
     property LeftGlyph;
     property RightGlyph;
     property HideSelection;
     property ParentColor;
     property ParentCtl3D;
     property ParentFont;
     property ParentShowHint;
     property PopupMenu;
     property ReadOnly;
     property ShowHint;
     property TabOrder;
     property Text;
     property Visible;
     property OnLeftButtonClick: TNotifyEvent read FOnLeftButtonClick write FOnLeftButtonClick;
     property OnRightButtonClick: TNotifyEvent read FOnRightButtonClick write FOnRightButtonClick;       
     property OnChange;
     property OnClick;
     property OnDblClick;
     property OnDragDrop;
     property OnDragOver;
     property OnEndDrag;
     property OnEnter;
     property OnExit;
     property OnKeyDown;
     property OnKeyPress;
     property OnKeyUp;
     property OnMouseDown;
     property OnMouseMove;
     property OnMouseUp;
     property OnStartDrag;
  end;  

procedure Register;

implementation

procedure Register;
begin
   RegisterComponents('MyComponents',[TMyButtonedEdit]);
end;

{ TMyCustomButtonedEdit }

constructor TMyCustomButtonedEdit.Create(AOwner: TComponent);
begin
  inherited;
  ControlStyle := ControlStyle - [csSetCaption];

  FLeftButton := TSpeedButton.Create(self);
  with FLeftButton do begin
     Parent := self;
     TabStop := false;
     Visible := true;
     OnClick := LeftButtonClick;
  end;

  FRightButton := TSpeedButton.Create(self);
  with FRightButton do begin
     Parent := self;
     TabStop := false;
     Visible := true;
     OnClick := RightButtonClick;
  end;
end;

destructor TMyCustomButtonedEdit.Destroy;
begin
  FLeftButton.Free;
  FRightButton.Free;
  inherited;
end;

procedure TMyCustomButtonedEdit.CreateParams(var Params: TCreateParams);
begin
  inherited CreateParams(Params);
  Params.Style := Params.Style or WS_CLIPCHILDREN;
end;

function TMyCustomButtonedEdit.GetEnabled: boolean;
begin
  result := inherited Enabled;
end;

function TMyCustomButtonedEdit.GetLeftGlyph: TBitmap;
begin
  result := FLeftButton.Glyph;
end;

function TMyCustomButtonedEdit.GetRightGlyph: TBitmap;
begin
  result := FRightButton.Glyph;
end;

procedure TMyCustomButtonedEdit.LeftButtonClick(Sender: TObject);
begin
  DoLeftButtonClick;
  SetFocus;
end;

procedure TMyCustomButtonedEdit.RightButtonClick(Sender: TObject);
begin
  DoRightButtonClick;
  SetFocus;
end;

procedure TMyCustomButtonedEdit.SetEnabled(e: boolean);
begin
  inherited Enabled := e;
  FLeftButton.Enabled := e;
  FRightButton.Enabled := e;
end;

procedure TMyCustomButtonedEdit.SetLeftGlyph(const g: TBitmap);
begin
  FLeftButton.Glyph := g;
end;

procedure TMyCustomButtonedEdit.SetRightGlyph(const g: TBitmap);
begin
  FRightButton.Glyph := g;
end;

procedure TMyCustomButtonedEdit.WMSize(var Message: TWMSize);
var
  b: integer;
begin
  if (BorderStyle = bsSingle) and not Ctl3d then
     b := 1
  else
     b := 0;
  FLeftButton.Top    := b;
  FLeftButton.Height := ClientHeight - b * 2;
  FLeftButton.Width  := FLeftButton.Height;
  FLeftButton.Left   := b;

  FRightButton.Top    := b;
  FRightButton.Height := ClientHeight - b * 2;
  FRightButton.Width  := FRightButton.Height;
  FRightButton.Left   := ClientWidth - FRightButton.Width - b;
end;

{ TMyButtonedEdit }

procedure TMyButtonedEdit.DoLeftButtonClick;
begin
  inherited;
  if Assigned(FOnLeftButtonClick) then
    FOnLeftButtonClick(Self);
end;

procedure TMyButtonedEdit.DoRightButtonClick;
begin
  inherited;
  if Assigned(FOnRightButtonClick) then
    FOnRightButtonClick(Self);
end;

end. 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T08:57:39.303

你的问题是你打电话来启用。恰当地，您在崩溃之前实际收到的错误是

```
Project Project1a.exe raised exception class EStackOverflow with message 
'Stack overflow'. Process stopped. Use Step or Run to continue. 
```

你让自己陷入了无限循环。

要调试组件，最好的办法是在运行时创建它们。这比在设计时尝试要容易得多。为了在运行时调试，我这样做了。

```
var
BE : TMyButtonedEdit;
begin
BE :=  TMyButtonedEdit.Create(self);
be.Parent := self;
be.Visible := true; 
```

当我创建你的控件时，它花了很长时间然后我得到了 stackoverflow 错误，这通常意味着一个无限循环。我还没有完全弄清楚为什么，但我正在努力。

解决方案。

你不能继承属性（你可以 - 查看评论），所以你的电话

```
inherited Enabled; 
```

实际上是在呼唤自己。你需要做的是

```
 inherited GetEnabled; 
```

谢谢你的心理锻炼。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T08:56:48.870

很久没做组件开发了，不过我好像记得一个组件的owner一般应该是parent的owner，而不是parent本身，所以

```
 FLeftButton := TSpeedButton.Create(self); 
```

应该：

```
 FLeftButton := TSpeedButton.Create( AOwner); 
```

# c# - 创建具有多个字符的快捷键

> ID：653417
> 
> 赞同：0
> 
> 时间：2009-03-17T08:44:08.713
> 
> 标签：c#, .net

我想设计一个快捷键框架。比如Alt+CA、Alt+CI这样的第二个快捷键选项是多个字符的组合。有什么办法可以做到这一点。

问候， 苛刻的苏曼

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T08:51:39.240

这个有可能 -

您需要有一种方法来添加事件处理程序来跟踪多个按键或按键事件。您将无法仅将其视为单个按键，您需要保存按键事件之间的状态。

我看到的最大困难将是确定一个关键事件何时是一个旧的键组合，或者开始一个新的组合。（当用户按下 Alt+CDE 并且 Alt+DE 是一个“组合”时会发生什么？）如果您要求您的组合始终是修饰符 + 一次或修饰符 + 两次击键，这将变得更容易管理，但如果您希望它完全通用，可能更难。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-02T02:20:24.560

如果您使用的是 WPF，您可以使用 KeyBinding 类：http: [//msdn.microsoft.com/en-us/library/system.windows.input.keybinding.aspx](http://msdn.microsoft.com/en-us/library/system.windows.input.keybinding.aspx)

# python - 如何在 Python 中分析多线程程序？

> ID：653419
> 
> 赞同：72
> 
> 时间：2009-03-17T08:45:24.747
> 
> 标签：python, multithreading, profiling

我正在用 Python 开发一个固有的多线程模块，我想知道它在哪里花费时间。cProfile 似乎只分析主线程。有没有办法分析计算中涉及的所有线程？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-11-01T22:09:51.857

请参阅[yappi](https://pypi.python.org/pypi/yappi/) (Yet Another Python Profiler)。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-03-17T09:21:43.583

`cProfile`您可以在每个线程中运行单独`cProfile`的实例，而不是运行一个，然后组合统计信息。`Stats.add()`自动执行此操作。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-17T13:22:20.463

如果您愿意做一些额外的工作，您可以编写自己的分析类来实现`profile(self, frame, event, arg)`. 每当调用函数时都会调用它，并且您可以相当容易地设置一个结构来从中收集统计信息。

然后，您可以使用[`threading.setprofile`](http://docs.python.org/2/library/threading.html#threading.setprofile)在每个线程上注册该函数。调用该函数时，您可以使用`threading.currentThread()`它来查看它在哪个上运行。更多信息（和准备运行的配方）在这里：

[http://code.activestate.com/recipes/465831/](http://code.activestate.com/recipes/465831/)

[http://docs.python.org/library/threading.html#threading.setprofile](http://docs.python.org/library/threading.html#threading.setprofile)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T21:19:20.387

鉴于您的不同线程的主要功能不同，您可以从[这里](https://translate.svn.sourceforge.net/svnroot/translate/src/trunk/virtaal/devsupport/profiling.py)`profile_func()`使用非常有用的装饰器。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2020-05-15T21:34:14.793

`mtprof`从 Dask 项目中查看：

[https://github.com/dask/mtprof](https://github.com/dask/mtprof)

如果您的线程以通常的方式启动并在您的主线程之前完成，则它是一个替代品`cProfile`，会将它们的统计信息汇总到相同的报告统计信息中。对我来说就像一个魅力。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-12-02T14:31:16.517

从 2019 年开始：我喜欢 vartec 的建议，但我真的很喜欢代码示例。因此我建立了一个——实施起来并不难，但你确实需要考虑一些事情。这是一个工作示例（Python 3.6）：

您可以看到结果考虑了 Thread1 和 thread2 调用 thread_func() 所花费的时间。

您需要在代码中进行的唯一更改是子类 threading.Thread，覆盖其 run() 方法。以简单的方式分析线程的最小更改。

```
import threading
import cProfile
from time import sleep
from pstats import Stats
import pstats
from time import time
import threading
import sys

# using different times to ensure the results reflect all threads
SHORT = 0.5
MED = 0.715874
T1_SLEEP = 1.37897
T2_SLEEP = 2.05746
ITER = 1
ITER_T = 4

class MyThreading(threading.Thread):
    """ Subclass to arrange for the profiler to run in the thread """
    def run(self):
        """ Here we simply wrap the call to self._target (the callable passed as arg to MyThreading(target=....) so that cProfile runs it for us, and thus is able to profile it. 
            Since we're in the current instance of each threading object at this point, we can run arbitrary number of threads & profile all of them 
        """
        try:
            if self._target:
                # using the name attr. of our thread to ensure unique profile filenames
                cProfile.runctx('self._target(*self._args, **self._kwargs)', globals=globals(), locals=locals(), filename= f'full_server_thread_{self.name}')
        finally:
            # Avoid a refcycle if the thread is running a function with
            # an argument that has a member that points to the thread.
            del self._target, self._args, self._kwargs

def main(args):
    """ Main func. """
    thread1_done =threading.Event()
    thread1_done.clear()
    thread2_done =threading.Event()
    thread2_done.clear()

    print("Main thread start.... ")
    t1 = MyThreading(target=thread_1, args=(thread1_done,), name="T1" )
    t2 = MyThreading(target=thread_2, args=(thread2_done,), name="T2" )
    print("Subthreads instances.... launching.")

    t1.start()          # start will call our overrident threading.run() method
    t2.start()

    for i in range(0,ITER):
        print(f"MAIN iteration: {i}")
        main_func_SHORT()
        main_func_MED()

    if thread1_done.wait() and thread2_done.wait():
        print("Threads are done now... ")
        return True

def main_func_SHORT():
    """ Func. called by the main T """
    sleep(SHORT)
    return True

def main_func_MED():
    sleep(MED)
    return True

def thread_1(done_flag):
    print("subthread target func 1 ")
    for i in range(0,ITER_T):
        thread_func(T1_SLEEP)
    done_flag.set()

def thread_func(SLEEP):
    print(f"Thread func")
    sleep(SLEEP)

def thread_2(done_flag):
    print("subthread target func 2 ")
    for i in range(0,ITER_T):
        thread_func(T2_SLEEP)
    done_flag.set()

if __name__ == '__main__':

    import sys
    args = sys.argv[1:]
    cProfile.run('main(args)', f'full_server_profile')
    stats = Stats('full_server_profile')
    stats.add('full_server_thread_T1')
    stats.add('full_server_thread_T2')
    stats.sort_stats('filename').print_stats() 
```

* * *

## 回答 #7

> 赞同：-6
> 
> 时间：2009-03-17T09:16:20.290

我不知道任何支持 python 的分析应用程序 - 但是您可以编写一个 Trace-class 来写入日志文件，您可以在其中输入操作何时开始、何时结束以及操作时间的信息消耗。

这是解决您问题的简单快速的方法。

# c# - 如何从 NameValueCollection 的逗号分隔字符串中获取特定值？

> ID：653420
> 
> 赞同：0
> 
> 时间：2009-03-17T08:45:46.540
> 
> 标签：c#

我有一个 POST 请求

```
firstname=1&lastname=10&firstname=2&lastname=20&firstname=3&lastname=30. 
```

然后我得到逗号分隔的名称和值列表

```
Request.Form["firstname"] // 1,2,3
Request.Form["lastname"] //10,20,30 
```

似乎 NameValueCollection 不包含直接访问指定名字值的方法？

该任务看起来很标准，就像 ASP 中的 Request.Form 索引属性。

当然，我可以实现自定义帮助器枚举器或以某种方式简单地解析字符串，但我不确定是否有任何标准解决方案。

老实说，我更愿意直接访问每个名字-姓氏对，但我不能问不可能:)。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T08:59:24.900

`GetValues()`将返回一个`string[]`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T08:54:07.783

但是你怎么能指定第二个名字呢？

在这种情况下，它们并不具体。所以你应该编写自己的辅助方法来获得你想要的。

或者将键替换为 firstname1、firstname2 之类的内容。

或者，如果您从单选列表控件或列表框控件中获取这些值，只需使用控件实例来获取值，我认为这是更好的解决方案。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-17T08:53:26.257

拆分字符串，然后您将收到一个包含值的数组。

```
string[] firstnames = Request.Form["firstname"].Split(",");
string[] lastnames = Request.Form["lastname"].Split(","); 
```

虽然我必须承认我觉得这有点丑陋的解决方案......这是脆弱的恕我直言。

# asp.net-mvc - 带有 Windows 身份验证和 SQL Server 基于角色的提供程序的 Asp .Net MVC

> ID：653422
> 
> 赞同：2
> 
> 时间：2009-03-17T08:46:44.603
> 
> 标签：asp.net-mvc, windows-authentication, roleprovider

有人让 MVC + Windows Auth + SQL Server 基于角色的提供程序在 IIS 7.0 上工作吗？任何指针都会有所帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-04-13T06:39:01.723

今天发布的 MVC 3 工具更新有一个 Windows 身份验证模板，可能会有所帮助。

# c++ - 指向类中对象的指针，C++ 新手问题

> ID：653423
> 
> 赞同：1
> 
> 时间：2009-03-17T08:47:20.857
> 
> 标签：c++, class, pointers, oop

为什么在 C++ 中，对于对象 A、B

```
//interface, case #1
class A {

B bb;
}

A::A()
{ //constructor
bb = B();
}

//interface, case #2
class A {

B *bb;
}

A::A()
{ //constructor
bb = new B();
} 
```

为什么案例 #2 有效但 #1 无效？

编辑：我现在明白了。但是对于案例 #1，如果 A 的一个实例被释放，它的 bb 也会被**自动**释放吗？案例#2 你必须显式调用 bb = NULL 对吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T09:41:12.023

两者都有语法错误，因此“不起作用”并不特定于其中一个。您还没有声明`A::A`构造函数，因此当您尝试定义它时会出现语义错误。

如果 B 的完整声明在类 A 的声明之前可用，那么它将编译：

```
class B {};

//interface
class A {
    A();

    B bb;
};

A::A()
{ //constructor
    bb = B();
} 
```

在该`bb=B()`行中，bb 已经被构造，因为它是 A 的成员。然后您正在构造另一个 B，然后将该 B 的值复制到 bb。这有点浪费。如果要将参数传递给 bb 的构造函数，请使用初始化程序。

另一方面，如果您不想将 B 的定义放在 A 的定义之前，并且只对它进行前向引用，则编译器无法计算出 B 对象的大小。它需要知道 B 有多大才能确定 A 中允许 bb 有多少空间。所以没有 B 就无法编译 A。

在第二种情况下，您改为使用指向 B 的指针。指针的大小相同，无论它们指向什么。这样，编译器可以计算出 A 有多大，并且只需要在实际使用 B 之前完整声明 B，例如通过在`new B()`表达式中调用 B 的构造函数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T08:52:57.833

在 C++ 中，如果您声明一个对象，则不需要对其进行初始化。声明时调用构造函数。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T08:53:09.767

因为在编译时，创建 B 对象所需的内存量是未知的。因此，必须使用指向对象的指针，以便动态分配内存（当您调用 new 时）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T08:54:10.967

显示的代码太不完整了。除非你给出 B 的定义，否则恐怕没人能回答。我的疯狂猜测是 B 类是不可复制的（例如私有运算符 =）。使用可复制的 B 类，您给出的示例应该可以工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T09:01:24.227

看起来您的“B”类隐藏了 operator=。否则，你写的应该编译。

但是，这不是必需的。这应该有效：

```
`A::A() : bb()
{ //constructor
}` 
```

`但是，由于您调用的是默认构造函数，因此无需显式声明它。这很容易是：`

 ````
`A::A() // bb is automatically constructed, since it's a member variable and not a pointer.
{ 
}` 
```

* * *

 `## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T09:41:48.123

如果 B 类的定义（不是声明）出现在 A 类的声明之前，那么您的 case#1 应该可以正常编译。

正如[Oxley](https://stackoverflow.com/questions/653423/pointer-to-objects-within-a-class-c-newbie-question/653431#653431)指出的那样，其原因是 C++ 需要知道 B 对象需要多少内存，如果没有 B 的定义，它就无法做到这一点。

但是，如果您使用指针（如案例#2），所需的内存量是已知的，因为所有指针占用相同的内存量（32 位或 64 位，具体取决于系统）。

因此，对于案例#2，您只需要在 A 的定义之前声明 B。（注意：声明，而不是定义！当然，拥有定义也不会受到伤害，但不一定需要）。

只是为了确保我不会混淆任何人，（嘿，也许我没有 C++ 术语）

声明：声明一个类或函数的存在，但没有说明它是什么。

例如

```
class A; //forward declaration

class C
{
   A * a;
   // .....
}; 
```

定义：实际上定义了类或函数。虽然对于一个类，它不一定完全定义它，但它定义了它的所有成员。

```
class A
{
   int a;
   int b;
   void some_method(); //not defined here, only declared, but it's ok
}; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T09:34:16.860

我认为案例 A 必须有效，因为如果没有定义，编译器会提供一个复制构造函数。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-17T08:59:17.927

**我**的问题是如何制作

```
A::A()
{ //constructor
bb = new B();
} 
```

但没有新的。而且我认为问题中的代码不是真正的代码。只是为什么“新”有效，而简单的分配却无效。

我**的回答**如下。如果我以错误的方式理解问题或答案本身是错误的 - 请告诉我。

改变

```
A::A()
{ //constructor
bb = B();
} 
```

到

```
A::A():
    bb()
{
   // some logic
} 
```

并且要在“新”的情况下保持一致，最好像这样实施

```
A::A():
    bb( new B() )
{
    // some logic
} 
```

在这两种情况下，当“某些逻辑”开始执行时，您可以确定对象 bb 要么已初始化，要么将引发异常。

为了使您的案例可编译，B 应该已经实现了分配运算符。

**对您的编辑：**您对案例 1 的猜测是正确的。在情况 2 中，您必须在类析构函数中调用 delete bb。

请留言**'-1'原因**。我真的很困惑。

# vb.net - 从 VB.NET 源代码生成数据流图？

> ID：653424
> 
> 赞同：0
> 
> 时间：2009-03-17T08:47:23.290
> 
> 标签：vb.net, dataflow

是否有任何工具可以直接从 VB.NET 源代码生成[数据流图](http://en.wikipedia.org/wiki/Data_flow_diagram)和[实体关系图？](http://en.wikipedia.org/wiki/Entity-relationship_model)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T08:54:00.997

[Doxygen](http://www.doxygen.org/)并不能完全满足您的需求，它在这方面针对几种常用语言提供了一些功能。它使用[Graphviz](http://www.graphviz.org/)包。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T09:05:43.450

[Doxygen](http://www.doxygen.org/)可以直接从源代码创建实体关系图。如果你一直在用 Doxygen 的标记风格注释源代码，它将是最强大的。我衷心推荐将 Doxygen 用于 C/C++ 语言开发项目......

它不（至少不是我检查的最后一个）做数据流图。

它的所有图表实际上都是通过用 AT&T 的[Graphviz](http://www.graphviz.org/)包可以理解的点语言描述它们而产生的。

使用graphviz 绘制数据流图当然是可能的，但要从源代码自动绘制，您首先必须有足够的解析器才能找到数据流。GCC 有一个 XML 后端，它可能提供实现它所需的信息，但它肯定不是一个简单的项目。

我在 graphviz 中手工制作了很多图表。当我有一个事实袋并且需要找到一些关于它们如何关联的可视化时，我发现它最有价值。最近最复杂的是一个复杂的、长期运行的法律案件中的所有玩家的绘图。在列出大约 20 个方中的每一个之后，只需在 dot 源文件中为每一对标识它们的连接添加一行即可。Graphviz 处理了所有令人讨厌的布局，生成的图形使解释为什么这个案例很有趣变得容易得多。

# delphi - delphi如何开发绘图应用程序

> ID：653425
> 
> 赞同：1
> 
> 时间：2009-03-17T08:47:50.873
> 
> 标签：delphi, drawing, delphi-7

我需要在 Delphi 中开发一个应用程序，其中我有一个 TDrawGrid 控件，并且根据我选择的布局类型在网格的单元格中显示图像。我在单元格的画布上画了一条线。我需要提供的功能是画一条线，在单元格旁边的一个图像上画多条线，选择任何一条线并移动它，展开它，删除它。

有什么方法可以在运行时将线条作为控件，以便它们都响应鼠标事件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T19:33:57.460

我建议不要将您的绘图对象实现为非窗口 VCL 控件。您不会从中获得太多收益，但有些事情（如命中测试）会比您自己编写代码要困难得多。

VCL 控件是矩形的，因此对于平行对角线，一个控件至少部分位于另一个之上。通常鼠标事件仅到达 Z 顺序中最顶层的控件。这是您必须在自己的代码中更正的内容。

选定的线应标记端点，以便用户知道在何处抓取它们以进行移动或调整大小。同样，自定义控件不提供的东西（在运行时），因此您必须对此进行编码。

我可能会简单地创建一个线对象类，并自己实现创建、绘制、选择、移动和调整大小、删除线的所有功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T09:07:11.467

您可以创建自定义控件。（请务必查看组件编写器手册，因为有一些问题）。

您可以开始查看 TShape 控件。它用于简单的形状。也许您可以扩展它以支持线路。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T01:50:48.613

在过去，我创建了一个使用形状、文本和连接线的网络设计应用程序。我使用了 DevExpress 的[ExpressFlowChart](http://devexpress.com/Products/VCL/ExFlowChart/)产品，虽然它有一些缺点，但使任务相对简单。

正如 mghie 所提到的，命中测试是一个特别有问题的痛点。很高兴有人为你做一些繁重的工作。

# c# - NotifyIcon 的问题：“隐藏非活动图标”不起作用

> ID：653428
> 
> 赞同：0
> 
> 时间：2009-03-17T08:52:39.130
> 
> 标签：c#, winforms, notifyicon, systray

我正在使用 C# (.NET 3.5) 并使用 NotifyIcon 启用“最小化到系统托盘”。一切都很好，除了当您查看开始菜单属性 - >“隐藏非活动图标”时，shell 注册了标题为“无标题”的系统托盘图标。

此外，将系统托盘图标的设置更改为“始终显示”或“始终隐藏”不会在图标被移除并放回系统托盘后立即被记住。

知道如何以可以保留此设置的方式注册系统托盘图标吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T09:12:58.533

它应该使用 NotifyIcon 的“文本”属性中的文本用作通知区域中的工具提示以及隐藏非活动图标（等）的列表

如果您将 text 属性设置为空白，它可能不会记住您的设置（如果没有看到您的代码，很难确定）

# php - Zend Framework: Getting started with Zend_Test

> ID：653438
> 
> 赞同：4
> 
> 时间：2009-03-17T08:55:39.060
> 
> 标签：php, unit-testing, zend-framework, testing, phpunit

Has anyone had any success setting up Zend_Test? What was your method/approach and how do you run your tests/test suites?

I already have PHPUnit installed and working. Now I'm trying to write some simple controller tests. The Zend Framework documentation assumes that autoloading is setup, which I haven't done. What method do **you** use to autoload the appropriate files? I do so in my normal bootstrap file, but I don't want to clutter up my Test with a bunch of includes and setting up paths. Would an abstract controller test case class be the way to go?

What about the bootstrap plugin like the documentation uses...is that how you bootstrap your tests, or do you like to do it a different way? I would like to re-use as much of the regular bootstrap file as I can. How should I DRY up my bootstrap for testing and normal use?

Here's my test so far:

```
<?php

class IndexControllerTest extends Zend_Test_PHPUnit_ControllerTestCase
{
    public function setUp()
    {
        $this->bootstrap = array($this, 'appBootstrap');
        parent::setUp();
    }

    public function appBootstrap()
    {
        $this->frontController->registerPlugin(new Bootstrapper('testing'));
    }

    public function testIndexAction()
    {
        $this->dispatch('/index');
            $this->assertController('index');
            $this->assertAction('index');
    }

}

//straight from the documentation
class Bootstrapper extends Zend_Controller_Plugin_Abstract
{
    /**
     * @var Zend_Config
     */
    protected static $_config;

    /**
     * @var string Current environment
     */
    protected $_env;

    /**
     * @var Zend_Controller_Front
     */
    protected $_front;

    /**
     * @var string Path to application root
     */
    protected $_root;

    /**
     * Constructor
     *
     * Initialize environment, root path, and configuration.
     *
     * @param  string $env
     * @param  string|null $root
     * @return void
     */
    public function __construct($env, $root = null)
    {
        $this->_setEnv($env);
        if (null === $root) {
            $root = realpath(dirname(__FILE__) . '/../../../');
        }
        $this->_root = $root;

        $this->initPhpConfig();

        $this->_front = Zend_Controller_Front::getInstance();
    }

    /**
     * Route startup
     *
     * @return void
     */
    public function routeStartup(Zend_Controller_Request_Abstract $request)
    {
        $this->initDb();
        $this->initHelpers();
        $this->initView();
        $this->initPlugins();
        $this->initRoutes();
        $this->initControllers();
    }

    // definition of methods would follow...
} 
```

What should I do?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T22:34:57.820

Here's what I did to get it to work:

First, we need to resolve the autoloading issue. We'll do this by creating a file that all the tests will include, and put it in the tests directory. Note: I pretty much copied all of this from my /public/index.php.

```
# /tests/loader.php

<?php

define('APPLICATION_PATH', realpath(dirname(__FILE__) . '/../application/'));

set_include_path( APPLICATION_PATH . '/../library' . PATH_SEPARATOR .
                  APPLICATION_PATH . '/models' . PATH_SEPARATOR .
                  APPLICATION_PATH . '/forms' . PATH_SEPARATOR .
                  get_include_path() );

require_once "Zend/Loader.php";
Zend_Loader::registerAutoload(); 
```

Second, we need to include this file in our test. Our test file is in /tests/application/controllers/ . I'm not going to use my bootstrap as a plugin since my bootstrap file works the same way as the [QuickStart tutorial](http://framework.zend.com/docs/quickstart "QuickStart tutorial"). I'll just link to it by setting the location as the public $bootstrap. When `Zend_Test_PHPUnit_ControllerTestCase` constructs, it will look for the bootstrap file that we set here.

```
<?php

require_once '../../loader.php';

class IndexControllerTest extends Zend_Test_PHPUnit_ControllerTestCase
{
    public $bootstrap = '../../../application/bootstrap.php';

    public function testIndexAction()
    {
        $this->dispatch('/index');
        $this->assertController('index');
        $this->assertAction('index');
    }

} 
```

And that's it! If my bootstrap file was already a plugin, this might be a little more complicated, but since it's not, it's super easy.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-24T12:09:44.967

Instead of using

```
require_once "Zend/Loader.php";
Zend_Loader::registerAutoload(); 
```

change it into

```
require_once 'Zend/Loader/Autoloader.php';
Zend_Loader_Autoloader::getInstance(); 
```

registerAutoLoad() is deprecated as of 1.8.0

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T09:22:25.250

I always use a simple TestHelper.php that does some basic initialization stuff. This file is included in every test-case file. One of the things I do, is registering the Zend Framework autoloader as I experienced major dependency problems especially when using filters, validators and forms. It's nearly impossible to keep track of all the required files and include them manually in the test-cases.

You can perhaps move the autoloading initialization and the setup of the include paths into your bootstrapping plugin as this procedure should be the same for the real application.

# hyperlink - 如何创建强制 MS Word 在 webdav 服务器上编辑文档的 HTML 链接

> ID：653442
> 
> 赞同：19
> 
> 时间：2009-03-17T08:58:41.547
> 
> 标签：hyperlink, ms-word, ms-office, document, webdav

假设我有启用 WebDAV 的服务器，其中有一堆 Office 文档。我想生成具有文档链接的网页，以便单击该链接将打开 Microsoft Word。Word 会依次从 WebDAV 服务器下载文档，当用户完成文档编辑后，MS Word 会将其上传回来。

我知道 MS Word（和其他 Office 程序）支持编辑存储在 WebDAV 服务器上的文档。我不知道的是如何生成链接，该链接将触发 MS Word 自行下载此文档。

是否可以？也许使用一些特殊的方案？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2014-09-10T12:42:57.887

嗯，你也可以使用这样的东西：

```
<a href="ms-word:ofe|u|http://some_WebDav_enabled_address.com/some_Word_document.docx">Open Document in Word</a> 
```

与上述答案的不同之处在于，这将不再需要 ActiveX，并且它至少可以在 IE 8+、Chrome 和 Firefox 中运行，只要它是从 Windows 机器上打开的，对于 Office 2010+（不是 100% 肯定这个虽然）。

说明：该`ms-word:ofe`部分是在安装 Office 时安装在客户端计算机上的协议。我不知道这`|u|`部分到底是做什么的。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-02-18T11:20:35.743

Confluence 使用 SharePoint.OpenDocuments ActiveX 控件的[EditDocument](http://msdn.microsoft.com/en-us/library/cc264013.aspx)方法。

Javascript 中的示例：

```
new ActiveXObject("SharePoint.OpenDocuments.1").EditDocument("http://example.com/test.doc") 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-17T09:23:45.873

据我记得，实现这一点的唯一方法是通过 ActiveX 显式实例化 Word，并将 URL 传递给它以打开。

这可以在 HTML 页面中完成（其中需要 IE），或者使用需要为新的 mime 类型注册的外部应用程序（参见[http://greenbytes.de/tech/webdav/rfc4709 .html#rfc.section.B.1](http://greenbytes.de/tech/webdav/rfc4709.html#rfc.section.B.1)为例）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T11:25:55.937

我发现 Confluence 可以做到这一点。他们有特殊的 Firefox 插件，但它应该可以在 Internet Explorer 上正常工作。

*   [在 Office 应用程序中编辑 Confluence 页面](http://confluence.atlassian.com/display/DOC/Editing+a+Confluence+Page+in+an+Office+Application)
*   [为 Office 连接器安装 Firefox 插件](http://confluence.atlassian.com/display/DOC/Installing+the+Firefox+Add-On+for+the+Office+Connector)

事实上，当我开始使用它时，事实证明 IE 确实直接从 WebDAV 打开文档。好像 IE 下载了页面，将其传递给 MS Word，但与 URL 一起。然后 MS Word 可以将文件保存回来（嗯，有时它会将文件视为只读文件，并且不允许保存回来，但允许以不同的名称上传）。

还在调查。

# wpf - 如何让唯一的 DockPanel 子元素停靠在顶部

> ID：653445
> 
> 赞同：-1
> 
> 时间：2009-03-17T08:59:07.537
> 
> 标签：wpf, xaml, dockpanel

下面我在菜单上说“ **DockPanel.Top ”，但它****停靠在中间**。（？）

如果我将高度属性从菜单中取出，它会停靠在顶部，但高度约为 200 像素。（？）

我认为这就是 LastChildFill 的用途。

如何让**DockPanel 的这个子元素停靠在顶部**，而停靠面板中没有其他项目？

```
<Window x:Class="TestContainer1.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="480" Width="600" Loaded="Window_Loaded">

    <DockPanel HorizontalAlignment="Stretch" 
               Margin="0,0,0,0" 
               Width="Auto" 
               LastChildFill="True">

        <Menu x:Name="panelMenuTop" 
              Width="Auto" 
              Height="25" 
              DockPanel.Dock="Top">

            <MenuItem Header="File">
                <MenuItem Header="Close" 
                          Click="CloseApplication_Click"/>
            </MenuItem>
        </Menu>

    </DockPanel>
</Window> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T13:41:14.660

您的菜单填满了整个区域，因此它看起来居中。正如 Henk 所说，您可以只给 Menu 一个 VerticalAlignment="Top" 或给 DockPanel 更多的孩子。

# sharepoint - 如何在 Sharepoint 2007 中删除 SPNavigationNodes 的缓存？

> ID：653450
> 
> 赞同：0
> 
> 时间：2009-03-17T08:59:32.310
> 
> 标签：sharepoint, sharepoint-2007

我在 Sharepoint 有一个网站。

如您所知，在设置中，用户可以在探索中根据需要对站点和页面进行排序，然后您可以使用以下命令获取这些项目：

```
SPWeb web = CurrentSite.OpenWeb(currentSite);
 SPNavigation nav = web.Navigation;
 SPNavigationNodeCollection nodeColl = nav.QuickLaunch; 
```

我遇到的问题是有一个缓存，每次用户添加网页时，我通过 web.Navigation.QuickLaunch 获得的列表与以前相同。

删除缓存的唯一方法是进入探索并更改项目的顺序，然后重新建立并接受表格。

有人可以告诉我是否可以用另一种方式做到这一点吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T09:43:20.753

我不是 100% 确定，但尝试检索 SPWeb 对象的新副本，而不是使用当前上下文中的一个：

```
using ( SPSite l_site = new SPSite(SPContext.Current.Site.Url); )
{
  using ( SPWeb l_web = l_site.OpenWeb() )
  {
    ..
  }
} 
```

# porting - 我将如何为 WiiBrew 制作 Flight Gear 端口？

> ID：653453
> 
> 赞同：1
> 
> 时间：2009-03-17T09:00:11.107
> 
> 标签：porting, wii, homebrew

我将如何为 WiiBrew制作[Flight Gear端口？](http://www.flightgear.org/)或者，更好的是，我将如何说服其他人？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T20:04:20.833

> 我将如何为 WiiBrew 制作 Flight Gear 端口？

“移植”任何重要的应用程序至少有两个方面：从技术上讲，您首先必须获取所有依赖项的源代码，以便为您的目标平台编译所有内容，即通过使用交叉编译器和模拟器/模拟器来实际测试您的可执行文件。

因此，您将需要一个完整的构建/测试环境来为您的平台构建和运行可执行文件：首先，编译所有必需的依赖项（其中一些可能有自己的依赖项！），这似乎主要归结为：

*   [plib](http://plib.sourceforge.net/)
*   [SDL](http://www.libsdl.org/)
*   （pthreads：linux）
*   [开放式](http://connect.creativelabs.com/openal)
*   [开放场景图](http://www.openscenegraph.org/)
*   [同机](http://www.simgear.org)

可以在[此处](http://wiki.flightgear.org/index.php/Building_FlightGear)、[此处](http://wiki.flightgear.org/index.php/Building_Flightgear_-_Windows)和[此处找到构建 FlightGear 的说明](http://www.oflebbe.de/FlightGear/index.html)

***但是***，除了编译源代码之外，您还需要确保应用程序可以实际运行在目标平台上：（ [wii 硬件规范](http://en.wikipedia.org/wiki/Wii#Technical_specifications)）。

然而，这在 FlightGear 的情况下似乎并不简单：FlightGear[硬件建议](http://wiki.flightgear.org/index.php/FlightGear_1.0_Hardware_Recommendations)读取“基于 OpenGL 的硬件加速”、“256 MB 专用图形内存”、“1-2 ghz CPU”、“512-1024 MB RAM", "400-500 MB 磁盘空间"

因此，即使您要为您的目标平台编译源代码，这个特定的目标平台在这种情况下看起来也不适合这个应用程序 - 由于它的运行时硬件要求。

事实上，搜索 FlightGear 论坛会引发有关在嵌入式（游戏控制台/移动）平台上运行 FlightGear的[相关讨论。](http://flightgear.org/forums/viewtopic.php?f=6&t=1833&p=13982)

该讨论的摘要将显示为“FlightGear 未针对在此类受限环境中的使用进行优化”。基本上，这似乎远非微不足道：即使您设法编译所有依赖项，FlightGear 本身仍需要进行重大修改/重新设计以供嵌入式使用。

此外，仅仅能够在技术上编译和运行代码（具有可接受的性能/帧率）仍然不够：从可用性的角度来看，FlightGear 是一款专为个人计算机设计的飞行模拟器，存在某些外围设备 -换句话说，它基本上依赖于键盘和鼠标，以及其他输入硬件（操纵杆/踏板）。

因此，即使您设法将 FlightGear 移植到可行的目标平台，仍需要对其进行修改以供非 PC 使用。

如果只使用前面提到的“基础/数据包”（存储风景、飞机等的地方）的某个子集，磁盘空间需求可能会显着降低。

> 或者，更好的是，我将如何说服其他人？

这绝对是一项不容易完成的不平凡的任务，所以虽然它肯定是可能的，但它需要大量的时间或**金钱**。

因此，如果您有可用的资金，您可以尝试使用诸如[rentacoder](http://www.rentacoder.com/) / [elance](http://www.elance.com)等自由职业者网站将这项工作外包 - 事实上，您可以尝试请求此类定制的报价。

如果您没有任何可用资金，您可以尝试与可以从此类努力中受益的目标平台制造商取得联系。也许他们甚至愿意帮助赞助/支持这样的努力？

事实上，所需的大部分重新设计不会只针对一种设备，但通常对于将 FlightGear 移植到非 PC 平台相关的所有工作都是有用的，无论是任天堂 wii、索尼 playstation 还是苹果 iphone。 ..

一般来说，联系 FlightGear 开发团队并与他们讨论您的想法可能是一个好主意，他们可能是了解此类工作的可行性的最佳信息来源。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T09:14:01.340

您将[下载源代码](http://www.flightgear.org/Downloads/source.shtml)（我猜是“基础包”），获得[WiiBrew](http://wiibrew.org/wiki/Main_Page)的开发环境，然后开始工作。FlightGear 是使用 SDL、OpenAL 和 OpenGL 用 C++ 编写的，因此调查对这些基本包的平台支持是一个方便的第一步。需要移植的依赖项越少，移植就越容易。

不确定如何评估系统要求，Flight Gear 似乎面向高端 PC（[他们提到](http://www.flightgear.org/hardwarereq.html)了 2-3 GHz 的 CPU 速度），Wii[并不完全](http://en.wikipedia.org/wiki/Wii#Technical_specifications)在那个范围内。

令人信服的部分几乎不是技术问题，更多的是关于社交黑客。:)

# git - 如何在不使用 .gitignore 的情况下让 Git 忽略文件？

> ID：653454
> 
> 赞同：175
> 
> 时间：2009-03-17T09:00:13.540
> 
> 标签：git, version-control

由于外部奇怪的限制，我无法修改`.gitignore`我的存储库。除了修改 a 之外，有没有办法忽略文件​​和目录`.gitignore`？即使它是一个全局解决方案，例如将应用于我所有存储库的全局配置。

* * *

## 回答 #1

> 赞同：212
> 
> 时间：2009-03-17T09:21:06.253

不要忘记，根据[gitignore](http://git-scm.com/docs/gitignore)，Git 考虑的不同“忽略模式源”中存在优先顺序：

*   从命令行读取支持它们的命令的模式。
*   从与路径相同的目录或任何父目录中的 .gitignore 文件读取的模式，较高级别文件（直到根目录）中的模式被低级别文件中的模式覆盖，直到包含该文件的目录。
*   模式读取自`$GIT_DIR/info/exclude`.
*   从配置变量指定的文件中读取的模式`core.excludesfile`。

最后两个可以解决您的问题，但是：

*   它们不会复制到远程存储库
*   他们可以让其他来源覆盖他们的模式

（另见这个[问题](https://stackoverflow.com/questions/640449/git-dont-show-me-pyc-in-the-list-of-untracked-files/640668#640668)）

* * *

其他两种解决方案涉及更新索引 ( [`git update-index`](http://git-scm.com/docs/git-update-index))：

*   `git update-index --assume-unchanged`：请参阅“ [Git：仅在本地存储库中取消跟踪文件并将其保存在远程存储库中](https://stackoverflow.com/a/6793752/6309)”。[Elijah Lynn](https://stackoverflow.com/users/292408/elijah-lynn)在[评论](https://stackoverflow.com/questions/653454/how-do-you-make-git-ignore-files-without-using-gitignore/653495#comment39345310_653495)
    中提到了这一点。
    *   您甚至可以忽略文件夹内容：“ [`git update-index --assume-unchanged`on directory](https://stackoverflow.com/a/12288918/6309) ”。
    *   用于`--no-assume-unchange`反转效果：请参阅“[是否有可能对`git add`当前受保护的文件`assume-unchanged`？](https://stackoverflow.com/a/23189283/6309) ”。

但是，当您签出另一个分支或您时`git pull`，“忽略”状态可能会被重置。因此，另一种选择：

*   `git update-index --skip-worktree`; 看：
    *   “[忽略我对文件的更改，但不要从远程代表中删除它们](https://stackoverflow.com/a/23011156/6309)”和
    *   “[在分支签出之间保留 git --assume-unchanged 文件](https://stackoverflow.com/a/9816844/6309)”。

两者的区别在“ [Git - ' `assume-unchanged`' 和 ' `skip-worktree`'](https://stackoverflow.com/q/13630849/6309)之间的区别”中进行了解释。

* * *

## 回答 #2

> 赞同：194
> 
> 时间：2009-03-17T09:03:00.400

如果您可以修改`.git/info/exclude`，您可以将相同的规则放在那里。但该文件仅在您的本地存储库中。

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2009-03-17T09:19:23.200

有三种方法可以告诉 GIT 忽略哪些文件：

*   `.gitignore`文件
*   `$GIT_DIR/.git/info/exclude`
*   `core.excludesfile`通过设置指向的文件

后两点可以解决你的问题。

有关详细信息，请参阅[gitignore(5)](http://git-scm.com/docs/gitignore)。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2018-04-26T17:22:22.443

我也遇到过类似的情况，所以我添加了我没有提到的首选解决方案。在这种情况下，问题`git update-index --assume-unchanged`在于您不能对未跟踪的文件执行此操作。你说

> 我无法修改存储库的 .gitignore。

我将假设您的意思是您不能将任何更改推`.gitignore`送到原点。如果是这种情况，您可以做的是将未跟踪的文件添加到您的 local `.gitignore`，然后这样`git update-index --assume-unchanged .gitignore`做，您的更改`.gitignore`永远不会被推送。现在您忽略（可能）未跟踪的文件，并且不影响远程`.gitignore`文件。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2014-08-11T22:02:44.173

忽略对跟踪文件的本地更改： `git update-index --assume-unchanged my-file.php`

取消忽略对跟踪文件的本地更改： `git update-index --no-assume-unchanged my-file.php`

来源：`git help update-index`

```
--[no-]assume-unchanged
           ...
           This option can be also used as a coarse file-level mechanism to ignore uncommitted changes in tracked
           files (akin to what .gitignore does for untracked files). Git will fail (gracefully) in case it needs to
           modify this file in the index e.g. when merging in a commit; thus, in case the assumed-untracked file is
           changed upstream, you will need to handle the situation manually. 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2015-03-05T20:43:06.447

如果您只想在存储库中有一些本地文件并且子目录位置很灵活，您可以将文件放入`tracked_dir1/tracked_dir2/untracked_dir/`，然后添加`tracked_dir1/tracked_dir2/untracked_dir/.gitignore`如下内容：

`*`

IE

```
$ cat > tracked_dir1/tracked_dir2/untracked_dir/.gitignore
*
<Ctrl+D> 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2019-06-20T23:33:06.420

其他方式：

*   编辑本地`.gitignore`
*   然后`git update-index --assume-unchanged .gitignore`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-04-02T22:02:47.467

您可以使用全局 gitignore 方法，而不是在项目中修改 [https://help.github.com/articles/ignoring-files/#create-a-global-gitignore](https://help.github.com/articles/ignoring-files/#create-a-global-gitignore)

# c - 阅读 Zend Engine API 代码：##（双哈希）是什么意思？

> ID：653466
> 
> 赞同：21
> 
> 时间：2009-03-17T09:06:07.413
> 
> 标签：c, php-internals

出于好奇，我正在阅读 Zend Engine API 代码，并在他们的#define 中遇到了相当多的##。例如，在 /usr/lib/php5/Zend/zend_API.h：

```
#define ZEND_FN(name) zif_##name
#define ZEND_MN(name) zim_##name 
```

这两行中的##（双哈希）符号是什么意思？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-03-17T09:12:49.113

## 将 ## 之前的内容与之后的内容连接起来。所以在你的例子中，这样做`ZEND_FN(foo)`会导致`zif_foo`

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T10:00:14.457

Echo RvV 的回答。

请注意，在连接文字字符串时，您可能会发现预处理器/编译器之间存在一些不一致。有些需要##

```
#define STR_CAT(s1, s2)   s1 ## s2 
```

如在

```
const char s[] = STR_CAT("concat", "enation") 
```

而其他人会犹豫不决，而是只要求编译器将两个文字连接起来（而不是预处理器），所以需要

```
#define STR_CAT(s1, s2)   s1 s2 
```

高温高压

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T09:14:14.333

[http://www.cppreference.com/wiki/preprocessor/sharp](http://www.cppreference.com/wiki/preprocessor/sharp)

# java - 在 if isDebugEnabled() 中包含对 debug() 的调用：一个好的策略？

> ID：653469
> 
> 赞同：25
> 
> 时间：2009-03-17T09:07:12.340
> 
> 标签：java, performance, logging, coding-style

我们的团队有这样的日志记录政策

```
if (LOGGER.isDebugEnabled()) {  
  LOGGER.debug("model[" + model + "]");
} 
```

而不是像这样简单地调用日志记录方法：

```
LOGGER.debug("model[" + model + "]"); 
```

这种做法能够带来一些[性能改进](https://stackoverflow.com/questions/545844/biggest-performance-improvement-youve-had-with-the-smallest-change/#546409)，但另一方面它使代码库更加复杂。我们的应用程序没有性能问题，可能永远不会，引入策略的理由很简单，它是一个很好的实践，所以每次我们做日志时都应该使用它。

你认为这是一个好政策吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-17T11:32:38.200

您应该使用*SLF4J*并使*log4j*成为您的实现。使用*SLF4J*，您可以`isDebugEnabled()`使用参数化消息完全消除。

请参阅[slf4j 常见问题解答中有关日志记录性能的部分](http://www.slf4j.org/faq.html#logging_performance)

> 以下两行将产生完全相同的输出。但是，在禁用日志记录语句的情况下，第二种形式的性能至少比第一种形式高出 30 倍。
> 
> `logger.debug("The new entry is " + entry + ".");`
> 
> `logger.debug("The new entry is {}.", entry);`

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-03-17T09:15:32.757

对于您正在构建的日志字符串实际上会显着影响性能的情况，这是一个很好的策略。这可能有两个原因：

*   构建字符串需要做很多工作（例如，它必须进行查找，或者从许多非常小的片段构建一个非常大的字符串）
*   它在一个没有做很多其他工作的循环中（但经常被调用），所以即使是一个简单的日志字符串也花费的时间*比例*更高

这不应该是一揽子规则，我希望这两种情况都*相对*罕见。

当然，我们真正想要的是能够说，“调用调试方法，传入一个不是调试字符串本身的参数，而是知道如何*构建*调试字符串的东西，当且仅当它是必要的。” 如果没有简洁的闭包，这在 Java 中会很丑陋。（即使在具有 lambda 表达式形式的闭包的语言中，捕获相关变量在某些情况下也可能很重要，这取决于语言如何处理捕获。）

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-17T09:12:05.883

[我同意Michael A. Jackson](http://en.wikiquote.org/wiki/Michael_A._Jackson)的名言：

> 程序优化的第一条规则：不要这样做。
> 
> 程序优化的第二条规则——仅适用于专家：暂时不要这样做。

我认为在大多数情况下，如果不确定性能提升是否显着/显着，就不值得让代码库变得更复杂。

我知道性能改进，但我认为个人程序员有责任决定在特定情况下是否值得添加这些额外的代码行。在大多数情况下，额外的行只是增加了复杂性，而在性能方面没有任何明显的收益。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T09:22:52.443

我认为在编写日志消息之前进行 isDebugEnabled() 调用是有意义的。之后您可以轻松地更新您的日志消息。我们使用以下代码使日志消息更加灵活。

```
if (LOGGER.isDebugEnabled()) {  
  String msg = "A Message {0} you can put {1} differet Objects in {2}"; //$NON-NLS-1$
  Object[] args = new Object[] {file1.toString(),new Integer(23),anObject};
  LOGGER.debug(MessageFormat.format(msg,args));
} 
```

当你没有 if 语句时，你会浪费时间。请记住...您的项目变得更大，并且您的日志消息也变得更大。

日志消息不应减慢您的代码速度！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T17:43:04.080

我在网上找不到参考资料（也许我在一本书中读过），但是有一个 BIOS 调用的示例，它在屏幕上写入了一个字符串。

将字符串写入屏幕的代码检查以确保字符串不会离开屏幕，然后调用函数将字符写入屏幕。

检查将字符写入屏幕的函数以确保字符不会从屏幕上写出。

从将字符写入屏幕的函数中删除检查代码会大大提高速度。这是因为打印每个字符经常发生。他们还提供了一种方法，可以检查调用前未检查屏幕位置的情况。

因此，如果您可以在高级别进行检查并避免在低级别进行检查，则可以显着加快速度。

在您提供的情况下，如果代码处于循环中或者如果有很多日志记录语句，那么将会有一个明显的好处，因为您将：

*   删除字符串创建（以及相关的 GC）
*   减少 if 语句的数量（尽管热点很可能会优化它们）。

我会说，一般来说，如果有一个简单的解决方法，你不应该添加任何已知的昂贵的东西。这显然属于这种情况 - 添加 if 语句并不难，但稍后再添加会很痛苦，并且它提供了明确的速度/内存改进。

我认为这与过早优化之间的区别在于，众所周知这总是代价高昂，所以问题归结为您是否要添加到程序中的累积成本？成本几乎是恒定的，并且在编写代码时就知道了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T09:22:06.423

如果“模型”是已知的，那么仅仅记录它并不是那么昂贵。但是，如果应该只为如下所示的日志记录而获取“模型”，那么简单性可能会受到影响。

```
LOGGER.debug("model[" + proxy.getModel() + "]"); 
```

# obfuscation - 有没有办法避免让我的混淆应用程序看起来像病毒

> ID：653472
> 
> 赞同：9
> 
> 时间：2009-03-17T09:11:20.393
> 
> 标签：obfuscation, antivirus

当我混淆我的应用程序时，防病毒软件会为混淆的应用程序发出病毒警报。

我能做些什么来避免这种情况？

我在 Windows XP Professional 上使用 Visual Studio 2008 和 .NET Reactor 3.9.8.0。

Windows 和应用程序是最新的，并且防病毒软件在运行完整扫描时什么也找不到。

编辑：Avast Antivirus 发出警报。MS Forefront 没有。

编辑 2：更改控制流混淆级别修复了它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T09:16:49.773

一些 EXE 压缩器/混淆器/其他工具被防病毒程序视为恶意软件，因为它们通常用于压缩/加密/隐藏病毒。尝试使用不同的程序进行混淆。如果问题仍然存在，您还可以尝试稍微更改您的代码，也许您的代码模式之一看起来对防病毒程序很可疑。

编辑：快速搜索后，我没有发现其他用户对 .NET Reactor 的误报报告——您也可以尝试将问题报告给[EZIRIZ 支持人员](http://www.eziriz.com/support.htm)——也许他们对此了解更多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-01-17T13:12:48.883

我遇到了同样的情况，这次是使用 Avast 和 REACTOR 4.7.0。取消选中控制流混淆什么也没做。

它是 NATIVE EXE 文件选项（注入 WIN32 启动代码以替换标准 CLR 启动代码）。向 EZIRIZ 和 AVAST 报告。

奇怪的是，exe 文件（在停用 Avast 时获得）被 Avast 扫描并声明为干净……。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T09:19:16.023

一个反病毒软件或多个反病毒软件会出现问题吗？您也可以将您的应用程序发送到病毒实验室，他们会尝试更新他们的签名，以便将来不会匹配。当然，如果世界上每个反病毒软件都将您的软件识别为病毒，这将是有问题的；）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-11-12T16:53:12.823

防止此类问题的可靠方法是使用商业代码签名证书对您的软件进行签名。反病毒引擎对此类签名文件的评价要高得多。如果您拥有证书，则可以在 .NET Reactor 中定义它。这样 .NET Reactor 将在保护后自动签署您的软件。

或者，您也可以向相应的防病毒软件供应商发送误报报告，他们通常会在 48 小时内更正特征库。

# c# - ASP.Net 条件数据绑定

> ID：653486
> 
> 赞同：9
> 
> 时间：2009-03-17T09:16:58.993
> 
> 标签：c#, asp.net

```
<% if(Convert.ToInt32(Eval("NbrOrders"))>=Config.MAX_ENQUIRY_SALES) {  %>
...  

<% } else { %>
...                                        

<% } %> 
```

给我一个 InvalidOperationException？如何在 ASP 中编写条件 html 生成？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-17T09:57:19.910

按照 John_ 的说法使用内联语句，或者，在您的代码中创建一个执行所需逻辑的函数。

```
protected string MyFunction(int nbrOrders)
{
    if(nbrOrders>=Config.MAX_ENQUIRY_SALES)
    {
        return "TrueResult";
    }
    else
    {
        return "FalseResult";
    }
} 
```

然后按如下方式使用它

```
<%# MyFunction(Convert.ToInt32(Eval("NbrOrders"))) %> 
```

编辑：我刚刚阅读了另一篇文章的评论，指出您希望根据此结果显示不同的 HTML。在这种情况下，您可以尝试使用包含您的代码的占位符的 Visible 标志。如：

```
<asp:PlaceHolder id="PlaceHolder1" runat="server" visible='<%# (Convert.ToInt32(Eval("NbrOrders"))>=Config.MAX_ENQUIRY_SALES)%>'>
    <div>My True Html Here</div>
</asp:PlaceHolder>
<asp:PlaceHolder id="PlaceHolder2" runat="server" visible='<%# !(Convert.ToInt32(Eval("NbrOrders"))>=Config.MAX_ENQUIRY_SALES)%>'>
    <div>My FalseHtml Here</div>
</asp:PlaceHolder> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T09:36:14.313

我不确定你可以为条件绑定添加括号，我知道这样做的唯一方法是使用这样的内联语句：

```
<%# Convert.ToInt32(Eval("NbrOrders"))>=Config.MAX_ENQUIRY_SALES) ? Eval("IfTrueValue") : Eval("IfFalseValue") %> 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-07-09T10:44:46.693

@Robin Day 的答案的问题是，如果您有数据绑定的子项，在给定您正在呈现的任何内容的当前状态下，这些子项可能有也可能没有数据，则以下代码将失败。如果您有一个复杂的对象图，有时很难绕过可为空的数据绑定代码。

例如，考虑：

```
 <asp:PlaceHolder runat="server" Visible="<%# VisibleCondition() %>">

        <%# ((string)null).ToString("c") %> //an object that may have null data
                                            //given the visible condition
    </asp:PlaceHolder> 
```

如果`VisibleCondition()`返回`false`，子控件仍然会被调用，`DataBind()`这可能会导致`NullReferenceException`上面示例中的 a 。

* * *

这是一个更好的方法，恕我直言：

```
public class ConditionalPlaceHolder : PlaceHolder
{
    protected override void DataBindChildren()
    {
        if( this.Visible )
        {
            base.DataBindChildren();
        }
    }
} 
```

并以下列方式使用：

```
<web:ConditionalPlaceHolder runat="server" Visible="<%# VisibleCondition1() %>">
    //whatever databound code
    <%# ((string)notNullGivenVisibleCondition1).ToString() %>
    <p>But could be given visible condition 2</p>
</web:ConditionalPlaceHolder>

<web:ConditionalPlaceHolder runat="server" Visible="<%# VisibleCondition2() %>">
    //whatever databound code
    <%# ((string)notNullGivenVisibleCondition2).ToString() %>
    <p>But could be given visible condition 1</p>
</web:ConditionalPlaceHolder> 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-17T09:21:59.247

我在您的句子中找不到错误，但是您在 Config.MAX_ENQUIRY_SALES 和 Convert.ToInt32(Eval("NbrOrders")) 之间进行了比较。这些运算符是否属于同一类型？你能在你的网页中显示每一个的类型吗？

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-17T10:33:00.183

if/else 块在 ASP .NET 中按您期望的那样工作。以下工作正常。

```
<% if(DateTime.Now.Second % 2 == 0) {  %>
<div>Even</div>
<% } else { %>
<div>Odd</div>
<% } %> 
```

也许您示例中的条件逻辑正在引发异常？

# wpf - WPF：ListBox 或 Panel 是否负责鼠标滚轮导航？

> ID：653490
> 
> 赞同：3
> 
> 时间：2009-03-17T09:19:51.717
> 
> 标签：wpf, listbox, navigation, mouse, panel

我有一个自定义列表框，它使用自定义面板作为 ItemsHost。我想控制鼠标滚轮输入，以便转动滚轮更改单个选定项目。

我相信最好的方法是处理 OnPreviewMouseWheel 事件（尽管这只是我想要的，因为它不提供水平轮数据）。

现在的大问题是：是否有处理 OnPreviewMouseWheel 的最佳实践？在 ListBox 中（默认情况下不知道 Panel 的子元素的排列）还是在 Panel 中（默认情况下不知道其子元素的“IsSelected”属性）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T15:45:30.040

我认为你应该从`ListBox`. `ListBox`继承自[Selector](http://msdn.microsoft.com/en-us/library/system.windows.controls.primitives.selector.aspx)，它处理与选择有关的一切。

鼠标滚轮选择行为可以应用于任何类型`Panel`（首先使用标准实现它甚至可能是一个好主意`ListBox`），并且您可能希望使用选择逻辑没有意义的`Panel`地方之外的某个地方。`ListBox`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T11:58:26.643

它应该从 ListBox 完成，因为它只知道当前选择的项目。面板不想或不需要知道它是否被选中。

我建议将此作为附加行为实现，以便您可以多次重复使用该功能。

为此：
- 创建一个带有名为 MouseWheelChangesSelection (true/false) 的附加属性的新类（可能称为 ListBoxSelector）。
- 添加一个 PropertyNotifyChangedEvent 并在属性更改时为 PreviewMouseWheel / MouseWheel 事件注册一个事件侦听器。

您可以通过以下任一方式更改当前选定的项目：
- 增加选定的索引；或
- 使用集合视图源的 move prev/next

# c++ - gdiplus 从字符串构造图像

> ID：653491
> 
> 赞同：3
> 
> 时间：2009-03-17T09:19:55.897
> 
> 标签：c++, gdi+

我正在使用 MySQL++ API 从 MySQL 数据库中提取图像。我将图像作为 mysqlpp::sql_mediumblob 获取，它是字符串的表示形式。现在我想使用 GDI+ 旋转一些图片，但我不知道如何使用这个构造函数：

```
Image::Image(IStream*,BOOL) - Creates an Image object based on a stream. 
```

与保存在 blob 中的图像。提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T15:19:06.750

如此处所述：http: [//msdn.microsoft.com/en-us/library/aa378980 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa378980(VS.85).aspx)

```
HGLOBAL hMem = ::GlobalAlloc(GMEM_MOVEABLE,iSize);
if (!hMem)
    AfxThrowMemoryException();
LPVOID pImage = ::GlobalLock(hMem);
... // Fill memory pointed by pImage, reading it from MySQL
::GlobalUnlock(hMem);

// Convert internal data if there is any
CComPtr<IStream> spStream;
HRESULT hr = ::CreateStreamOnHGlobal(hMem,FALSE,&spStream); 
```

然后将 spStream 传递给 Gdiplus::Image 构造函数。

# python - 如何在 Python 中对图进行聚类？

> ID：653496
> 
> 赞同：16
> 
> 时间：2009-03-17T09:21:07.750
> 
> 标签：python, sorting, matrix, cluster-analysis, graph-theory

设 G 为图。所以 G 是一组节点和一组链接。我需要找到一种快速划分图形的方法。我现在正在处理的图表只有 120*160 个节点，但我可能很快就会在另一个上下文（不是医学，而是网站开发）中处理一个具有数百万个节点的等效问题。

所以，我所做的是将所有链接存储到一个图形矩阵中：

```
M=numpy.mat(numpy.zeros((len(data.keys()),len(data.keys())))) 
```

现在，如果节点 s 连接到节点 t，则 M 在位置 s,t 中保持 1。我确保 M 是对称的 M[s,t]=M[t,s] 并且每个节点都链接到自身 M[s,s]=1。

如果我记得很清楚，如果我将 M 与 M 相乘，结果是一个矩阵，它表示连接通过两个步骤到达的顶点的图。

所以我继续将 M 与自身相乘，直到矩阵中零的数量不再减少。现在我有了连接组件的列表。现在我需要对这个矩阵进行聚类。

到目前为止，我对算法非常满意。我认为它简单、优雅且相当快。我在这部分遇到了麻烦。

本质上，我需要将此图拆分为其连接的组件。

我可以遍历所有节点，看看它们连接到什么。

但是如何对矩阵进行排序以重新排序行。但我不知道是否有可能做到这一点。

以下是到目前为止的代码：

```
def findzeros(M):
    nZeros=0
    for t in M.flat:
        if not t:
            nZeros+=1
    return nZeros

M=numpy.mat(numpy.zeros((len(data.keys()),len(data.keys()))))    
for s in data.keys():
    MatrixCells[s,s]=1
    for t in data.keys():
        if t<s:
            if (scipy.corrcoef(data[t],data[s])[0,1])>threashold:
                M[s,t]=1
                M[t,s]=1

nZeros=findzeros(M)
M2=M*M
nZeros2=findzeros(M2)

while (nZeros-nZeros2):
    nZeros=nZeros2
    M=M2
    M2=M*M
    nZeros2=findzeros(M2) 
```

* * *

### 编辑：

有人建议我使用 SVD 分解。这是 5x5 图上的问题的简单示例。我们将使用它，因为在 19200x19200 方阵中不容易看到簇。

```
import numpy
import scipy

M=numpy.mat(numpy.zeros((5,5)))

M[1,3]=1
M[3,1]=1
M[1,1]=1
M[2,2]=1
M[3,3]=1
M[4,4]=1
M[0,0]=1

print M

u,s,vh = numpy.linalg.linalg.svd(M)
print u
print s
print vh 
```

这里基本上有 4 个集群：(0),(1,3),(2),(4) 但我仍然看不到 svn 在这种情况下如何提供帮助。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-17T10:50:17.957

为什么不使用真正的图形库，例如[Python-Graph](http://code.google.com/p/python-graph/)？它具有[确定连接组件的功能](http://www.linux.ime.usp.br/~matiello/python-graph/docs/graph.algorithms.accessibility-module.html#connected_components)（尽管没有提供示例）。我想一个专用库会比你编写的任何临时图形代码更快。

编辑：[NetworkX](http://networkx.github.io/)似乎比 python-graph 更好；它的[文档（这里是连接组件功能）](https://networkx.github.io/documentation/latest/reference/algorithms/generated/networkx.algorithms.components.connected_components.html?highlight=connected_components#networkx-algorithms-components-connected-components)当然是。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-17T09:37:00.207

在 SciPy 中，您可以使用[稀疏矩阵](http://docs.scipy.org/doc/scipy/reference/sparse.html)。另请注意，有更有效的方法可以将矩阵自身相乘。无论如何，您尝试做的事情可以通过 SVD 分解来完成。

[带有有用链接的介绍](http://expertvoices.nsdl.org/cornell-cs322/2008/04/06/svd-and-graph-partitioning-can-life-get-more-exciting-than-this/)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-04-26T19:37:21.873

还有[graph_tool](http://graph-tool.skewed.de/)和[networkit](http://networkit.iti.kit.edu/)具有用于连接组件的高效例程，并且都有效地存储网络。如果您要使用数百万个节点，networkx 可能还不够（它是纯 python afaik）。这两个工具都是用 C++ 编写的，因此可以以合理的运行时间处理大图的分析。

正如 Phil 指出的那样，您的方法对于大型图（我们说的是几天、几周、几个月……）的计算时间将非常长，并且您对一百万个节点的图的表示将需要大约一百万 GB 的内存！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-09-21T22:25:38.350

找到一个最优的图分区是一个 NP-hard 问题，所以无论算法是什么，它都将是一个近似值或启发式算法。毫不奇怪，不同的聚类算法会产生（非常）不同的结果。

纽曼模块化算法的Python实现： [模块化](http://perso.crans.org/aynaud/communities/index.html)

另外：[MCL](http://www.micans.org/mcl/)、[MCODE](http://baderlab.org/Software/MCODE)、[CFinder](http://www.cfinder.org/)、[NeMo](http://chianti.ucsd.edu/cyto_web/plugins/displayplugininfo.php?name=NeMo)、[clusterONE](http://www.paccanarolab.org/software/cluster-one/index.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T14:57:04.993

这是一些简单的实现，它使用[深度优先搜索](http://en.wikipedia.org/wiki/Depth_first_search)找到连接的组件，我前段时间写过。虽然它很简单，但它可以很好地扩展到一万个顶点和边......

```
 import sys
from operator import gt, lt

class Graph(object):
    def __init__(self):
        self.nodes = set()
        self.edges = {}
        self.cluster_lookup = {}
        self.no_link = {}

    def add_edge(self, n1, n2, w):
        self.nodes.add(n1)
        self.nodes.add(n2)
        self.edges.setdefault(n1, {}).update({n2: w})
        self.edges.setdefault(n2, {}).update({n1: w})

    def connected_components(self, threshold=0.9, op=lt):
        nodes = set(self.nodes)
        components, visited = [], set()
        while len(nodes) > 0:
            connected, visited = self.dfs(nodes.pop(), visited, threshold, op)
            connected = set(connected)
            for node in connected:
                if node in nodes:
                    nodes.remove(node)

            subgraph = Graph()
            subgraph.nodes = connected
            subgraph.no_link = self.no_link
            for s in subgraph.nodes:
                for k, v in self.edges.get(s, {}).iteritems():
                    if k in subgraph.nodes:
                        subgraph.edges.setdefault(s, {}).update({k: v})
                if s in self.cluster_lookup:
                    subgraph.cluster_lookup[s] = self.cluster_lookup[s]

            components.append(subgraph)
        return components

    def dfs(self, v, visited, threshold, op=lt, first=None):
        aux = [v]
        visited.add(v)
        if first is None:
            first = v
        for i in (n for n, w in self.edges.get(v, {}).iteritems()
                  if op(w, threshold) and n not in visited):
            x, y = self.dfs(i, visited, threshold, op, first)
            aux.extend(x)
            visited = visited.union(y)
        return aux, visited

def main(args):
    graph = Graph()
    # first component
    graph.add_edge(0, 1, 1.0)
    graph.add_edge(1, 2, 1.0)
    graph.add_edge(2, 0, 1.0)

    # second component
    graph.add_edge(3, 4, 1.0)
    graph.add_edge(4, 5, 1.0)
    graph.add_edge(5, 3, 1.0)

    first, second = graph.connected_components(op=gt)
    print first.nodes
    print second.nodes

if __name__ == '__main__':
    main(sys.argv) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-18T03:39:18.323

正如其他人指出的那样，没有必要重新发明轮子。对优化聚类技术进行了很多思考。[这](http://www.micans.org/mcl/)是一个著名的聚类程序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T11:34:58.723

看起来有一个库[PyMetis](http://mathema.tician.de/software/pymetis)，它会为你划分你的图表，给定一个链接列表。通过将链接节点的原始列表（不是矩阵乘法派生的节点）传递给它，从图表中提取链接列表应该相当容易。

重复执行 M' = MM 对于 M 的大阶不会有效。对于 N 阶矩阵的完整矩阵乘法将花费 N 次乘法和 N-1 次加法每个元素，其中有 N ²，即 O(N ³ ) 操作。如果您将其缩放到“数百万个节点”，那将是每个矩阵-矩阵乘法的 O(10 ^(18) ) 操作，您想要执行几个操作。

简而言之，您不想这样做。Vartec的[SVD 建议](https://stackoverflow.com/questions/653496/clustering-a-graph-in-python/653539#653539)将是那里唯一合适的选择。您最好的选择就是使用 PyMetis，而不是尝试重新发明图形分区。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-18T02:28:41.707

SVD 算法在这里不适用，但除此之外 Phil H 是正确的。

# iphone - 在 OpenGL ES 中设置 glFrustumf

> ID：653498
> 
> 赞同：1
> 
> 时间：2009-03-17T09:21:53.240
> 
> 标签：iphone, graphics, opengl-es

我在 OpenGL ES 中设置透视图时遇到了一些麻烦。有人有任何提示吗？我的正交项目看起来像这样： glOrthof(-8.0f, self.frame.size.width, -12.0f, self.frame.size.height, -8.0f, 20.0f);

如何使用 glFrustumf 进行类似的设置？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T11:58:02.553

OpenGL ES 中没有像 gluLookAt 这样的东西，假设这是关于 iPhone 和 OpenGL ES 的。这是如何实施的？

请记住，相机位置是 (0,0,0)，并且您的正方形也在该 z 平面上。如果你调用 glLoadIdentity()，glTranslatef(0.0f, 0.0f, 0.0f) 不会做任何改变。

也许您可以考虑在设置方法中移动大部分设置部分。即：GlEnable 调用和相机设置。确保使用 glMatrixMode 以便对 Projection 或 Modelview 矩阵进行操作。设置可以是：

```
- (void) setupView {
  glViewport(0, 0, backingWidth, backingHeight);
  glMatrixMode(GL_PROJECTION);
  glLoadIdentity();
  // think about the box where all the vertices are.
  glFrustum(-8.0f, 8.0f, -12.0f, 12.0f, -8.0f, 20.0f); 
  // .. all sort of glEnable
} 
```

在 drawView 中，通过对它们应用一些平移，确保您的顶点位于相机前面。还为您的顶点提供颜色。

```
- (void) drawView {
  glMatrixMode(GL_MODELVIEW);
  glLoadIdentity();
  glTranslatef(0, 0, 5.0f); // move in front

  glVertexPointer(3, GL_FLOAT, 0, squareVertices);

  // maybe you want to attach colors to your vertices
  const GLubyte squareColors[] = {
            255, 255,   0, 255,
            0,   255, 255, 255,
            0,     0,   0,   0,
            255,   0, 255, 255,
  };
  glColorPointer(4, GL_UNSIGNED_BYTE, 0, squareColors);
  glEnableClientState(GL_COLOR_ARRAY);

  glDrawArrays(GL_TRIANGLE_STRIP, 0, 4);
  // .. some other loadidentity and translate and vertex pointer setup and draw
} 
```

OpenGL ES 参考也可能有用： [http ://www.khronos.org/opengles/sdk/1.1/docs/man/](http://www.khronos.org/opengles/sdk/1.1/docs/man/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T18:39:59.077

```
 - (void)drawView {

    // Replace the implementation of this method to do your own custom drawing

    const GLfloat squareVertices[] = {
        -5.0f, -5.0f, 0.0f,
        5.0f,  -5.0f, 0.0f,
        -5.0f,  5.0f, 0.0f,
        5.0f,   5.0f, 0.0f,
    };

    [EAGLContext setCurrentContext:context];
    glBindFramebufferOES(GL_FRAMEBUFFER_OES, viewFramebuffer);
    glViewport(0, 0, backingWidth, backingHeight);
    glEnable(GL_TEXTURE_2D);
    glEnableClientState(GL_VERTEX_ARRAY);
    glLoadIdentity();
    glTranslatef(0.0f, 0.0f, 0.0f);
    //glOrthof(-8.0f, self.frame.size.width, -12.0f, self.frame.size.height, -8.0f, 20.0f);
    glEnable(GL_DEPTH_TEST);
    perspective(85, 480/320, 0.1,20);
    gluLookAt(0.0f, 0.0f, -5.0f,

              1.0f,  1.0f,  1.0f,

              1.0f,  1.0f,  1.0f);  
    glClearColor(0.0f, 0.0f, 0.0f, 1.0f);
    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
    glEnable(GL_DEPTH_TEST);
    glDepthFunc(GL_LEQUAL);
    glDepthMask(GL_TRUE);
    glEnable(GL_CULL_FACE);
    glClearDepthf(1.0f);
    glColor4f(0.0f, 0.0f, 1.0f, .90f);

    //glTranslatef(2.5f, 2.5f, 0.0f);
    glVertexPointer(3, GL_FLOAT, 0, squareVertices);

    glDrawArrays(GL_TRIANGLE_STRIP, 0, 4);

    glBindRenderbufferOES(GL_RENDERBUFFER_OES, viewRenderbuffer);
    [context presentRenderbuffer:GL_RENDERBUFFER_OES];
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T09:53:38.267

我一直在用 iphone 处理 opengl es 中的投影问题。上面示例代码中 glfrustum 的参数不起作用（-8.0f，20.f），它们会给出无效参数错误。zNear 似乎“需要”是积极的。

只是想分享知识，因为我一直在努力弄清楚为什么更改这些参数对渲染没有任何影响！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T07:18:21.150

尽管 gluLookAt 不是 openGlE 的一部分，但大多数人只是获取源代码并将其放入他们的项目中。它不是很多代码。至少它会给出一个很好的例子来说明 glFrustum 发生了什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T09:30:33.470

这是一篇[使用 glFrustumf 的透视函数](http://forums.macrumors.com/showpost.php?s=1d9ca12fcdb179228063d11eaa778ac3&p=6299492&postcount=5)以及如何将 glOrthof 调用转换为它的帖子，也许它会有所帮助。

请注意，您可能必须在之后调用 glTranslatef 才能使相机居中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T19:48:02.917

不确定我从 Apple 的 XCode 模板为 OpenGL ES 应用程序创建的投影中出现了什么问题，但这里有一个漂亮的模板，它实际上适用于深度和透视：

[http://iphonedevelopment.blogspot.com/2008/12/updated-opengl-es-xcode-project.html](http://iphonedevelopment.blogspot.com/2008/12/updated-opengl-es-xcode-project.html)

感谢 schnaader 提供的所有帮助。

# c# - 如何将额外信息添加到从 C# 中的数据集 Writexml 生成的 XML 中？

> ID：653504
> 
> 赞同：1
> 
> 时间：2009-03-17T09:22:49.493
> 
> 标签：c#, .net, xml, dataset

```
ds.WriteXml(strXmlTestCasePath, XmlWriteMode.IgnoreSchema); 
```

ds 是一个`dataset`。我想在这个 XML 中添加额外的一行或额外的信息。我该怎么做？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T09:32:30.063

使用 an`XmlWriter`来编写您的`DataSet`. 然后，您可以使用相同的对象来编写其他 XML。

说明性代码：

```
 System.Data.DataSet ds;
            System.Xml.XmlWriter x;
            ds.WriteXml(x);
            x.WriteElementString("test", "value"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T18:50:59.470

您不能简单地将更多 XML 写入 serialized 的末尾`DataSet`，因为如果这样做，您将生成一个包含多个顶级元素的 XML 文档。使用`XmlWriter`，您需要执行以下操作：

```
using (XmlWriter xw = XmlWriter.Create(strXmlTestCasePath));
{
   xw.WriteStartElement("container");
   ds.WriteXml(xw, XmlWriteMode.IgnoreSchema);
   // from here on, you can use the XmlWriter to add XML to the end; you then
   // have to wrap things up by closing the enclosing "container" element:
   ...
   xw.WriteEndElement();
} 
```

但是，如果您尝试*在*序列化的`DataSet`. 为此，您需要序列化`DataSet`​​，将其读入`XmlDocument`，然后使用 DOM 方法来操作 XML。

或者，或者，`DataTable`在序列化之前创建并填充一个新的权限`DataSet`，然后在完成后将其删除。这实际上取决于您的实际要求。

# asp.net - Jquery：Jquery 在 onunload 事件中不起作用

> ID：653506
> 
> 赞同：0
> 
> 时间：2009-03-17T09:22:53.957
> 
> 标签：asp.net, ajax, jquery

我正在尝试在页面的 onunload 事件中发送 ajax 请求。我正在使用 jquery 的 $.post 函数，但是当事件实际触发时，我收到此错误：“Microsoft JScript 运行时错误：'$' 未定义”

这是否意味着 jquery 库在调用 $.post 函数之前已被引用，因此我将不再能够使用 Jquery？

我应该用什么方法来解决这个问题？我在一个 Asp.net 2.0 web 应用程序项目中这样做。以下是页面上的 JS 脚本。

```
<script type="text/javascript">

function RemoveFromOnlineUsers()
{
   debugger;
   if ($.browser.msie) 
   {
        alert("this is msie!");
   }

   $.post("../Main/FloatingWindowAjax.aspx", {REMOVEONLINEUSER : "<%=Master.UserId.ToString() %>" });       

    return false;
}
        window.onunload = RemoveFromOnlineUsers;

    </script> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T10:07:43.363

试试这个.. [http://docs.jquery.com/Events/unload](http://docs.jquery.com/Events/unload)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T19:54:48.910

对不起，我的愚蠢错误。我刚刚发现母版页中的 jquery 引用无法加载到我有 unload 事件的页面上，因此在使用 Page.ResolveUrl 正确解析 jquery 引用后，unload 事件中的 jquery 现在就像一个魅力！

# python - 打破嵌套循环

> ID：653509
> 
> 赞同：374
> 
> 时间：2009-03-17T09:24:17.587
> 
> 标签：python, loops, nested-loops

有没有比抛出异常更容易摆脱嵌套循环的方法？（在 Perl 中，您可以为每个循环指定标签，并至少继续一个外部循环。）

```
for x in range(10):
    for y in range(10):
        print x*y
        if x*y > 50:
            "break both loops" 
```

即，有没有比以下更好的方法：

```
class BreakIt(Exception): pass

try:
    for x in range(10):
        for y in range(10):
            print x*y
            if x*y > 50:
                raise BreakIt
except BreakIt:
    pass 
```

* * *

## 回答 #1

> 赞同：903
> 
> 时间：2009-03-17T12:27:02.140

```
for x in xrange(10):
    for y in xrange(10):
        print x*y
        if x*y > 50:
            break
    else:
        continue  # only executed if the inner loop did NOT break
    break  # only executed if the inner loop DID break 
```

这同样适用于更深的循环：

```
for x in xrange(10):
    for y in xrange(10):
        for z in xrange(10):
            print x,y,z
            if x*y*z == 30:
                break
        else:
            continue
        break
    else:
        continue
    break 
```

* * *

## 回答 #2

> 赞同：192
> 
> 时间：2009-03-17T09:27:09.077

至少有人建议过，但也[拒绝](http://www.python.org/dev/peps/pep-3136/)过。我认为除了重复测试或重新组织代码之外，没有其他方法。有时有点烦人。

在[拒绝信息](http://mail.python.org/pipermail/python-3000/2007-July/008663.html)中，van Rossum 先生提到 using `return`，这真的很明智，我个人需要记住这一点。:)

* * *

## 回答 #3

> 赞同：85
> 
> 时间：2009-03-17T12:37:59.680

如果您能够将循环代码提取到函数中，`return`则可以随时使用语句退出最外层循环。

```
def foo():
    for x in range(10):
        for y in range(10):
            print(x*y)
            if x*y > 50:
                return
foo() 
```

如果难以提取该函数，您可以使用内部函数，正如@bjd2385 建议的那样，例如

```
def your_outer_func():
    ...
    def inner_func():
        for x in range(10):
            for y in range(10):
                print(x*y)
                if x*y > 50:
                    return
    inner_func()
    ... 
```

* * *

## 回答 #4

> 赞同：59
> 
> 时间：2011-10-26T17:47:19.470

使用 itertools.product！

```
from itertools import product
for x, y in product(range(10), range(10)):
    #do whatever you want
    break 
```

这是 python 文档中指向 itertools.product 的链接：http: [//docs.python.org/library/itertools.html#itertools.product](http://docs.python.org/library/itertools.html#itertools.product)

您还可以循环遍历包含 2 个 fors 的数组推导，并随时中断。

```
>>> [(x, y) for y in ['y1', 'y2'] for x in ['x1', 'x2']]
[
    ('x1', 'y1'), ('x2', 'y1'),
    ('x1', 'y2'), ('x2', 'y2')
] 
```

* * *

## 回答 #5

> 赞同：46
> 
> 时间：2011-05-16T20:50:55.047

有时我使用布尔变量。天真，如果你愿意的话，但我觉得它阅读起来非常灵活和舒适。测试一个变量可以避免再次测试复杂的条件，也可以从内部循环中的几个测试中收集结果。

```
 x_loop_must_break = False
    for x in range(10):
        for y in range(10):
            print x*y
            if x*y > 50:
                x_loop_must_break = True
                break
        if x_loop_must_break: break 
```

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2012-08-14T00:31:38.450

如果要引发异常，可能会引发[StopIteration 异常](http://docs.python.org/library/exceptions.html#exceptions.StopIteration)。这至少会使意图显而易见。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-03-17T10:29:00.207

您还可以重构代码以使用生成器。但这可能不是所有类型的嵌套循环的解决方案。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-17T09:58:34.040

在这种特殊情况下，您可以使用 itertools.product 将循环与现代 python（3.0 和可能 2.6）合并。

我自己将此作为经验法则，如果您嵌套了太多循环（例如，超过 2 个），您通常可以将其中一个循环提取到不同的方法中或将循环合并为一个，如下所示案子。

# c# - 内部接口——暴露我的无知

> ID：653512
> 
> 赞同：0
> 
> 时间：2009-03-17T09:25:59.470
> 
> 标签：c#, interface, access-modifiers

我知道[这](https://stackoverflow.com/questions/367457/internal-member-in-an-interface) [两个](https://stackoverflow.com/questions/516148/why-cant-i-have-protected-interface-members)问题解释了为什么我不能在接口中使用受保护/私有方法，我想要解决的是如何控制*从哪里*调用我的方法，简单地说：

```
public class EditField : IEditField
{
    public EditField() {}
    public EditField(IStateMachine stateMachine) {}
    public void Action_Commit() {}
    public void Action_Undo() {}
} 
```

消费者可以使用默认的 IStateMachine，或者自己滚动。

我想知道是否有任何方法可以确保仅从 IStateMachine 中调用 Action_ 方法，这样消费者就不会开始弄乱状态的东西。我怀疑没有办法做到这一点，但想知道我是否遗漏了什么。我不是设计模式大师。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T09:32:41.263

嗯，您可以做的是通过显式实现这些方法来“隐藏” Action_ 方法。

如果这样做，用户只能在将类转换回接口时调用这些方法。然而，它不会阻止他们调用这些方法，但也许它会让它变得不那么明显。

```
public class EditField : IEditField
{
    public EditField( IStateMachine stateMachine ) {}

    void IEditField.Action_Commit() {}

    void IEditField.Action_Undo() {}

} 
```

通过像这样实现这些方法，用户将无法做到这一点：

```
EditField ef = new EditField();
ef.Action_Commit(); // compile-error 
```

但是，如果他们这样做，则可以调用这些方法：

```
IEditField ef = new EditField();
ef.Action_Commit(); 
```

或者

```
EditField ef = new EditField()
((IEditField)ef).Action_Commit(); 
```

但是，将这些 Commit & Undo 方法作为 IStateMachine 的一部分不是更好的解决方案/可能吗？

而且，如果您不能修改设计以使这些 Commit & Undo 方法成为 IStateMachine 的一部分，那么也许您可以创建一个抽象类而不是 IEditField 接口？
在那个抽象类中，您可以保护那些 Action_ 方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T09:35:20.103

虽然您不能在接口上使用访问修饰符，但这是隐藏成员的一种方法，但让 IStateMachine 实现者可以访问它们。

```
public interface IEditActions
{
  void Action_Commit() {}
  void Action_Undo() {}
}

public interface IStateMachine
{
  void Initialize(IEditActions editActions);
}

public class EditField : IEditField
{
  private class EditActions : IEditActions
  {
    EditField _editField;

    public EditActions(EditField editField)
    {
      _editField = editField;
    }

    public void Action_Commit()
    {
      _editField.Action_Commit();
    }
    public void Action_Undo()
    {
      _editField.Action_Undo();
    }
  }

  public EditField() {}
  public EditField(IStateMachine stateMachine)
  {
    stateMachine.Initialize(new EditActions(this));
  }

  private void Action_Commit() {}
  private void Action_Undo() {}
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T09:32:09.253

我不确定我明白你想要做什么。但是为了隐藏东西，我通常会显式地实现接口。如果有人需要访问某些东西而不是其他东西，您还应该将界面分成两个或其他东西。

# visual-c++ - vc++ 安装创建者

> ID：653513
> 
> 赞同：2
> 
> 时间：2009-03-17T09:26:02.263
> 
> 标签：visual-c++, installation, visual-c++-6

VC++ 6.0 项目

完成我的项目后，我使用 Create Installer 创建了项目 EXE，

但问题是没有 vc++ 6.0 软件它不会执行 EXE 项目，

它显示错误：

此应用程序无法启动，因为未找到 MFC42.DLL，重新安装应用程序可能会解决此问题。

当我安装 vc++ 6.0 软件时，它不会出错。

请任何人帮助我，在没有 vc++ 6.0 s/w 的情况下必须执行该项目。

或者请告诉我如何制作项目 EXE（设置）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T07:45:26.717

您可能需要考虑迁移到使用更广泛的安装实用程序。许多开源项目（以及相当数量的商业项目）使用[InnoSetup](http://www.innosetup.com/isinfo.php)来构建安装程序。

无论您使用哪种工具，一般过程都是相同的。

1.  创建程序的发布版本。
2.  确定所有需要安装的文件。（尝试`depends.exe`使用 Visual Studio 附带的工具来了解所需的 DLL。）不要忘记帮助文件和示例。
3.  列出文件和其他安装时任务（创建快捷方式、注册 DLL 等）。
4.  构建并测试安装包。

测试安装可能很困难，实际上应该是另一个问题的主题。请注意，可以卸载已安装的内容，并且再次运行安装程序会做一些明智的事情。确保您有办法检测用户是否在旧副本仍在运行时尝试安装更新，并在发生这种情况时采取适当的措施，这也是一个好主意。（它会。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T09:43:10.803

检查 mfc42.dll 是否可以自由分发。我认为它是 Microsoft 运行时库的一部分，因此重新分发应该是合法的，但您需要验证这一点（除非其他人可以验证它）。

然后只需在您的设置中包含该 dll，以便该 dll 位于启动 exe 的同一文件夹中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-04-16T11:25:54.937

如果您的应用程序依赖于 Visual C++ 运行时，您可以将它们作为安装程序的一部分包含在内，以简化最终用户的安装体验。本文介绍了如何将 Visual C++ 运行时合并模块包含到您的安装程序中，并解释了您将看到的预期 ICE 警告。

第 1 步：获取正确的 Visual C++ 运行时合并模块 Visual C++ 运行时合并模块随 Visual Studio 一起安装，位于 \Program Files\Common Files\Merge Modules。Visual C++ 8.0 运行时文件是 Microsoft_VC80_CRT_x86.msm。这个相同的 MSM 用于 Visual C++ 8.0 SP1 运行时，但是它由 Visual Studio 2005 SP1 安装程序就地更新。Visual Studio 9.0 运行时文件是 Microsoft_VC90_CRT_x86.msm。通常不需要将策略 MSM 作为安装的一部分。

第 2 步：在安装程序中包含合并模块 要在安装程序中包含合并模块，请使用 and 元素。以下示例说明了如何使用这些元素。

Merge 元素确保合并模块包含在最终的 Windows Installer 程序包中。使用 Id 属性分配唯一的 id。SourceFile 属性指向您机器上合并模块的位置。DiskId 属性应与项目的 Media 元素中指定的 DiskId 匹配。Language 属性应始终为 0。

MergeRef 元素在 Feature 元素中用于实际安装合并模块。在上面的示例中，创建了特定于运行时的功能并将其标记为隐藏，以防止它显示在您的安装程序可能使用的任何 UI 中。MergeRef 通过其唯一 id 引用合并模块。

# asp.net - ASP.NET MVC 模型绑定 IList<> 参数

> ID：653514
> 
> 赞同：27
> 
> 时间：2009-03-17T09:26:04.260
> 
> 标签：asp.net, asp.net-mvc, model-binding

**[我自己解决了这个问题，请参阅我的答案]**

我无法在正确设置的控制器方法中获取 IList<> 参数的表单值。

我的控制器类如下所示：

```
public class ShoppingBasketController : Controller {

    public ActionResult Index() {
        return View();
    }

    [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult Add(IList<ShoppingBasketItem> items) {
        Session["basket"] = items; // for testing
        return RedirectToAction("Index");
    }
}
public class ShoppingBasketItem {
     public int ItemID;
     public int ItemQuantity;
} 
```

略微修剪的形式：

```
<% using (Html.BeginForm("Add", "ShoppingBasket")) { %>
    <% int codeIndex = 0;
    foreach (Product product in products) { %>
        <%= Html.Hidden("items[" + codeIndex + "].ItemID", product.Id) %>
        <%= Html.TextBox("items[" + codeIndex + "].ItemQuantity", "0", new { size = "2"}) %>
        <% codeIndex++;
    }
} %> 
```

这会产生如下标记：

```
<form action="/Basket/Add" method="post">
    <input id="items[0]_ItemID" name="items[0].ItemID" type="hidden" value="1" />
    <input id="items[0]_ItemQuantity" name="items[0].ItemQuantity" size="2" type="text" value="0" />

    <input id="items[1]_ItemID" name="items[1].ItemID" type="hidden" value="2" />
    <input id="items[1]_ItemQuantity" name="items[2].ItemQuantity" size="2" type="text" value="0" />

    <input id="items[2]_ItemID" name="items[2].ItemID" type="hidden" value="3" />
    <input id="items[2]_ItemQuantity" name="items[2].ItemQuantity" size="2" type="text" value="0" />
</form> 
```

我检查了提交的表单值，它们是正确的。正确数量的`ShoppingBasketItem`s 也被放入`Session["basket"`] 中，但是每个的`ItemID`和`ItemQuantity`都为零。它似乎正确解码了表单值列表，但没有获取属性本身。

我正在使用 MVC RC2，根据[Scott Hanselman 的一篇文章，](http://www.hanselman.com/blog/ASPNETWireFormatForModelBindingToArraysListsCollectionsDictionaries.aspx)我很确定我的代码是正确的。我错过了什么吗？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-03-17T10:59:35.657

**解决方案**

下载 MVC 源代码后，我仍然不明白为什么它不起作用，所以我推测它一定与我尝试绑定的类型有关。果然，与属性相反，作为成员变量的值是罪魁祸首。这是因为模型绑定器使用反射来设置属性，而通过调用`TypeDescriptor.GetProperties(Type)`.

将值类更新为此解决了它（经过数小时的撞墙后，我应该添加！！）：

```
public class ShoppingBasketItem {
    public int ItemID { get; set; }
    public int ItemQuantity { get; set; }
} 
```

# java - 带有自动完成和上下文菜单的 Java Swing 组合框

> ID：653516
> 
> 赞同：3
> 
> 时间：2009-03-17T09:26:51.747
> 
> 标签：java, swing, autocomplete, jcombobox

我按照这篇文章自动完成了一个 JCombobox 工作：

[http://today.java.net/pub/a/today/2007/07/19/adding-auto-completion-to-swing-comboboxes.html](http://today.java.net/pub/a/today/2007/07/19/adding-auto-completion-to-swing-comboboxes.html)

我正在使用 SwingX 库。

现在我想为组合框中的项目添加持久性支持。基本上，当您右键单击一个项目时，会出现一个上下文菜单，您可以删除该项目。删除键也是如此。

要添加一个项目，用户只需键入一个尚未在列表中的新条目。

我还没有找到连接上下文菜单的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T09:37:27.087

您可以在组合框中添加键侦听器以查找删除键。至于弹出窗口，您必须自己实现它。

# java - Oracle 将空字符串转换为 null 但 JPA 没有相应地更新实体缓存

> ID：653521
> 
> 赞同：4
> 
> 时间：2009-03-17T09:28:14.613
> 
> 标签：java, oracle, jpa, jakarta-ee

众所周知，Oracle 将空字符串视为 null。

但是，由于 JPA 的缓存，由于这种行为，我遇到了问题。

首先，我坚持使用 JPA（Toplink Essentials）一个实体，它有一个空字符串作为一个字段。Oracle 在存储该值时将其转换为 null。

但是，当我获取实体时，JPA 似乎从缓存中返回它，该字段仍然是一个空字符串。JPA 似乎不知道，存储到数据库中的实际上是一个空值，这种不连贯性会导致问题。

有没有办法在 JPA 或应用服务器 (Oracle AS) 配置级别解决这个问题？这是我不想在应用程序级别修复的东西（但如果有必要会这样做）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T07:54:37.470

我们已经迁移到支持@ReturnInsert 和@ReturnUpdate 注释的EclipseLink。这些有助于使用实际存储到数据库中的值刷新字段。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-03-17T10:44:44.320

我认为问题在于 Oracle 不会将字符串存储为空值，而是将其存储为“未设置”值（我们称之为超级空值）。因此，如果您尝试选择为空的值，您将不会检索该项目，因为它未设置且不为空。您是否尝试过专门插入 null 而不是空字符串？

我曾经有一个项目 - 我遇到了类似的问题，解决方案是将 null 专门存储到数据库列中而不是 string.empty ，因为它被视为未设置而不是 null ......

# c++ - 用 C/C++ 编写的网络编程示例项目

> ID：653522
> 
> 赞同：4
> 
> 时间：2009-03-17T09:29:06.140
> 
> 标签：c++, c, network-programming, filesystems, system

有没有好的C/C++写的P2P文件共享系统或分布式文件系统的开源项目？</p>

我需要一个项目来开始网络编程。

谁能给我任何建议？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-17T09:31:47.273

boost.org 上的 Boost asio 示例是一个非常好的开始。

[http://www.boost.org/doc/libs/1_37_0/doc/html/boost_asio/examples.html](http://www.boost.org/doc/libs/1_37_0/doc/html/boost_asio/examples.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T13:07:31.840

[Rasterbar libtorrent](http://www.rasterbar.com/products/libtorrent)可能是**未知（谷歌）**要链接的内容。它在很大程度上基于 Boost，对所有网络代码使用 Boost.Asio。这是 Halite 和许多其他人使用的库（但不是 rTorrent，它使用了不同的库，也称为 libtorrent）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T10:00:44.893

~~[libTorrent](http://libtorrent.rakshasa.no/)~~ [libTorrent](http://www.rasterbar.com/products/libtorrent) - 用 C++ 编写，广泛使用 Boost（以及 Mykola 提到的 asio）。如果您想查看使用~~libTorrent~~的客户端应用程序，那么对于 libTorrent 有 rTorrent - 例如 Halite[（](http://sourceforge.net/projects/halite/)也使用 Boost）。

编辑：感谢 Daniel Wallin 发现不同 libTorrent 的混淆。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T10:05:08.223

我认为这将有助于熟悉这些概念。

[http://www.flazx.com/category95.php](http://www.flazx.com/category95.php)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T10:42:30.207

看看[传输](http://www.transmissionbt.com/)。

# jquery - jQuery 事件参数通过链

> ID：653523
> 
> 赞同：0
> 
> 时间：2009-03-17T09:29:27.357
> 
> 标签：jquery, events, javascript-events

```
function first(a){
  if (a == 'a'){
    return false;
  }
}

function second(){
  return 'a';
}

$('.c').click(first).click(second); 
```

如何向其他连锁事件发送消息？还是阻止其他人？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T09:39:45.443

要阻止下一次点击的发生，您可以使用[stopImmediatePropagation](http://docs.jquery.com/Events/jQuery.Event#event.stopImmediatePropagation.28.29)方法：

```
$("p").click(function(event){
  event.stopImmediatePropagation();
});
$("p").click(function(event){
  // This function won't be executed
}); 
```

要在回调之间发送消息，除了使用外部变量之外，我不知道任何其他方式。

实际上，这几乎是[jQuery 多事件处理程序的欺骗 - 如何取消？](https://stackoverflow.com/questions/652495/jquery-multiple-event-handlers-how-to-cancel)...

# c# - 在列表框中选择文本框项不会更改列表框的选定项

> ID：653524
> 
> 赞同：47
> 
> 时间：2009-03-17T09:29:46.420
> 
> 标签：c#, wpf, xaml, listbox, selecteditem

我有一个显示文本框列表的 wpf 列表框。当我单击文本框时，列表框选择不会改变。我必须单击 TextBox 旁边的以选择列表框项。我需要为文本框设置一些属性以将点击事件转发到列表框吗？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-05-14T12:55:11.313

我们使用以下样式来设置一个 PreviewGotKeyboardFocus 来处理 TextBox 控件和 ComboBoxes 等的所有事件：

```
 <ListView.ItemContainerStyle>
        <Style TargetType="ListViewItem">
            <EventSetter Event="PreviewGotKeyboardFocus" Handler="SelectCurrentItem"/>
        </Style>
    </ListView.ItemContainerStyle> 
```

然后我们选择后面代码中的行：

```
 protected void SelectCurrentItem(object sender, KeyboardFocusChangedEventArgs e)
    {
        ListViewItem item = (ListViewItem) sender;
        item.IsSelected = true;
    } 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2011-11-03T05:03:42.350

请务必使用适当的 TargetType：ListViewItem、ListBoxItem 或 TreeViewItem。

```
<Style TargetType="ListViewItem">
    <Style.Triggers>
        <Trigger Property="IsKeyboardFocusWithin" Value="true">
            <Setter Property="IsSelected" Value="true" />
        </Trigger>
    </Style.Triggers>
</Style> 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-12-23T01:07:43.480

我没有足够的代表发表评论，所以我发布我的评论作为答案。Grazer 的上述解决方案在您有另一个控件（例如 a`Button`需要`SelectedItem`. 这是因为根据，当您单击该 时`Style Trigger`，变为假，而变为空。`IsKeyboardFocusWithin``Button``SelectedItem`

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-11-09T22:34:36.660

我使用了类似于罗伯特的解决方案，但没有后面的代码（使用附加行为）。

为此，

第一的。创建单独的类 FocusBehaviour：

```
 using System.Windows;
using System.Windows.Controls;
using System.Windows.Media;

namespace MyBehaviours
{
    public class FocusBehaviour
    {
        #region IsFocused
        public static bool GetIsFocused(Control control)
        {
            return (bool) control.GetValue(IsFocusedProperty);
        }

        public static void SetIsFocused(Control control, bool value)
        {
            control.SetValue(IsFocusedProperty, value);
        }

        public static readonly DependencyProperty IsFocusedProperty = DependencyProperty.RegisterAttached(
            "IsFocused", 
            typeof(bool),
            typeof(FocusBehaviour), 
            new UIPropertyMetadata(false, IsFocusedPropertyChanged));

        public static void IsFocusedPropertyChanged(DependencyObject sender, DependencyPropertyChangedEventArgs e)
        {
            var control = sender as Control;
            if (control == null || !(e.NewValue is bool))
                return;
            if ((bool)e.NewValue && !(bool)e.OldValue)
                control.Focus();
        }

        #endregion IsFocused

        #region IsListBoxItemSelected

        public static bool GetIsListBoxItemSelected(Control control)
        {
            return (bool) control.GetValue(IsListBoxItemSelectedProperty);
        }

        public static void SetIsListBoxItemSelected(Control control, bool value)
        {
            control.SetValue(IsListBoxItemSelectedProperty, value);
        }

        public static readonly DependencyProperty IsListBoxItemSelectedProperty = DependencyProperty.RegisterAttached(
            "IsListBoxItemSelected", 
            typeof(bool),
            typeof(FocusBehaviour), 
            new UIPropertyMetadata(false, IsListBoxItemSelectedPropertyChanged));

        public static void IsListBoxItemSelectedPropertyChanged(DependencyObject sender, DependencyPropertyChangedEventArgs e)
        {
            var control = sender as Control;
            DependencyObject p = control;
            while (p != null && !(p is ListBoxItem))
            {
                p = VisualTreeHelper.GetParent(p);
            } 

            if (p == null)
                return;

            ((ListBoxItem)p).IsSelected = (bool)e.NewValue;
        }

        #endregion IsListBoxItemSelected
    }
} 
```

第二。在资源部分添加一个样式（我的样式在焦点上是圆形的黑色）。注意 FocusBehaviour.IsListBoxItemSelected 属性的设置器。你应该参考它`xmlns:behave="clr-namespace:MyBehaviours"`

`

```
 <Style x:Key="PreviewTextBox" BasedOn="{x:Null}" TargetType="{x:Type TextBox}">
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="Padding" Value="1"/>
        <Setter Property="AllowDrop" Value="true"/>
        <Setter Property="Background" Value="White"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type TextBox}">
                    <Border
                        Margin="6,2,0,4"
                        BorderBrush="#FFBDBEBD"
                        BorderThickness="1"
                        CornerRadius="8"
                        Background="White"
                        VerticalAlignment="Stretch"
                        HorizontalAlignment="Stretch"
                        MinWidth="100"
                        x:Name="bg">
                        <ScrollViewer 
                            x:Name="PART_ContentHost" 
                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsKeyboardFocusWithin" Value="True">
                            <Setter Property="Background" TargetName="bg" Value="Black"/>
                            <Setter Property="Background" Value="Black"/><!-- we need it for caret, it is black on black elsewise -->
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="behave:FocusBehaviour.IsListBoxItemSelected" Value="True"/>
                        </Trigger>

                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style> 
```

`

第三。（可选，用于反向任务）

您将遇到（如果没有的话）反向任务 - 当 ListBoxItem 被选中时专注于 TextBox。我建议使用 Behavior 类的另一个属性 IsFocused。这是一个示例模板`ListBoxItem`，请注意`Property="behave:FocusBehaviour.IsFocused"`和`FocusManager.IsFocusScope="True"`

```
 <DataTemplate x:Key="YourKey" DataType="{x:Type YourType}">
            <Border
            Background="#FFF7F3F7"
            BorderBrush="#FFBDBEBD"
            BorderThickness="0,0,0,1"
            FocusManager.IsFocusScope="True"
            x:Name="bd"
            MinHeight="40">
                <TextBox
                    x:Name="textBox"
                    Style="{StaticResource PreviewTextBox}"
                    Text="{Binding Value}" />
        </Border>
        <DataTemplate.Triggers>
            <DataTrigger
                Binding="{Binding IsSelected,RelativeSource={RelativeSource AncestorType=ListBoxItem}}"
                Value="True">
                <Setter
                    TargetName="textBox"
                    Property="behave:FocusBehaviour.IsFocused" 
                    Value="True" />
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-06-16T02:01:22.797

我使用类处理程序来设置此行为。这样做将修复应用程序中的所有列表视图。我不知道为什么这不是默认行为。

在您的 App.xaml.cs 中，将以下内容添加到 OnStartup：

```
protected override void OnStartup(StartupEventArgs e)
    {
        EventManager.RegisterClassHandler(typeof (ListViewItem), 
                                          ListViewItem.PreviewGotKeyboardFocusEvent,
                                          new RoutedEventHandler((x,_) => (x as ListViewItem).IsSelected = true));
    } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-17T16:01:09.443

> 我需要为文本框设置一些属性以将点击事件转发到列表框吗？

这不是一个简单的属性，但您可以在[`GotFocus`](http://msdn.microsoft.com/en-us/library/system.windows.uielement.gotfocus.aspx)上处理事件`TextBox`，然后使用[VisualTreeHelper](http://msdn.microsoft.com/en-us/library/system.windows.media.visualtreehelper.aspx)查找`ListBoxItem`并选择它：

```
private void TextBox_GotFocus(object sender, RoutedEventArgs e)
{
    TextBox myTextBox = sender as TextBox;
    DependencyObject parent = VisualTreeHelper.GetParent(myTextBox);
    while (!(parent is ListBoxItem))
    {
        parent = VisualTreeHelper.GetParent(parent);
    }
    ListBoxItem myListBoxItem = parent as ListBoxItem;
    myListBoxItem.IsSelected = true;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-10-27T10:03:38.163

这是您正在寻找的答案：[当其内部 ComboBox 聚焦时选择一个 ListBoxItem](https://stackoverflow.com/questions/1459786/selecting-a-listboxitem-when-its-inner-combobox-is-focused/1459885#1459885)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-04T00:26:34.310

我能找到的最简单的方法是使用 PreviewMouseDown 事件并设置模板化父级的 IsSelected 属性。由于预览事件冒泡，一旦用户单击文本框、组合框或您设置事件的任何其他控件，ListBoxItem 就会处理该事件。

关于这一点的一件好事是，您可以对所有类型的控件使用相同的事件，因为它们都派生自 Framework 元素。此外，当您将列表框的 SelectionMode 设置为“扩展”时，设置 IsSelected（而不是设置 SelectedItem）将导致选择多个项目，这可能是也可能不是您要查找的内容。

IE：

c# 代码

```
private void Element_PreviewMouseDown(object sender, MouseButtonEventArgs e)
{
    ((sender as FrameworkElement).TemplatedParent as ListBoxItem).IsSelected = true;
} 
```

xml

```
 ...
    <ComboBox PreviewMouseDown="Element_PreviewMouseDown"/>
    <TextBox PreviewMouseDown="Element_PreviewMouseDown"/>
    ... 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-01-08T22:02:19.343

旧的讨论，但也许我的回答对其他人有帮助....

Ben 的解决方案与 Grazer 的解决方案存在相同的问题。不好的是，选择取决于文本框的 [keyboard] 焦点。如果您的对话框上有另一个控件（即按钮），则单击按钮时焦点会丢失，并且列表框项变为未选中（SelectedItem == null）。因此，单击项目（在文本框外）和单击文本框有不同的行为。这处理起来很繁琐，看起来很奇怪。

我很确定对此没有纯 XAML 解决方案。为此，我们需要代码隐藏。解决方案与 Mark 建议的很接近。

（在我的示例中，我使用 ListViewItem 而不是 ListBoxItem，但该解决方案适用于两者）。

代码隐藏：

```
private void Element_PreviewMouseDown(object sender, MouseButtonEventArgs e)
    {
        var frameworkElement = sender as FrameworkElement;
        if (frameworkElement != null)
        {
            var item = FindParent<ListViewItem>(frameworkElement);
            if (item != null)
                item.IsSelected = true;
        }
    } 
```

使用 FindParent（取自[http://www.infragistics.com/community/blogs/blagunas/archive/2013/05/29/find-the-parent-control-of-a-specific-type-in ​​-wpf-and -silverlight.aspx](http://www.infragistics.com/community/blogs/blagunas/archive/2013/05/29/find-the-parent-control-of-a-specific-type-in-wpf-and-silverlight.aspx)）：

```
public static T FindParent<T>(DependencyObject child) where T : DependencyObject
    {
        //get parent item
        DependencyObject parentObject = VisualTreeHelper.GetParent(child);

        //we've reached the end of the tree
        if (parentObject == null) return null;

        //check if the parent matches the type we're looking for
        T parent = parentObject as T;
        if (parent != null)
            return parent;

        return FindParent<T>(parentObject);
    } 
```

在我的数据模板中：

```
<TextBox Text="{Binding Name}"
        PreviewMouseDown="Element_PreviewMouseDown"/> 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-01-31T20:50:27.177

以下是@Ben 的答案的简化，无需覆盖DataTemplate。它甚至可以用作静态样式。使用包含`GridView > GridViewColumn > TextBox`.

例子：

```
<ListView.Resources>
    <Style TargetType="{x:Type ListViewItem}">
        <Style.Triggers>
            <Trigger Property="IsKeyboardFocusWithin" Value="True">
                <Setter Property="IsSelected" Value="True"></Setter>
            </Trigger>
        </Style.Triggers>
    </Style>
</ListView.Resources> 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-11-16T17:46:55.450

基于[Arcturus Answer](https://stackoverflow.com/a/863167/4394435)的附加行为，使其可重用并且不隐藏在后面的代码中。

## 创建具有附加行为的文件（= 附加属性）

```
public static class SelectListBoxItemWhenControlInsideTheItemIsClickedBehavior
{
    public static readonly DependencyProperty EnableProperty = DependencyProperty.RegisterAttached(
        "Enable",
        typeof(bool),
        typeof(SelectListBoxItemWhenControlInsideTheItemIsClickedBehavior),
        new FrameworkPropertyMetadata(false, OnEnableChanged));

    public static bool GetEnable(FrameworkElement frameworkElement)
    {
        return (bool)frameworkElement.GetValue(EnableProperty);
    }

    public static void SetEnable(FrameworkElement frameworkElement, bool value)
    {
        frameworkElement.SetValue(EnableProperty, value);
    }

    private static void OnEnableChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        if ( d is ListBoxItem listBoxItem)
            listBoxItem.PreviewGotKeyboardFocus += ListBoxItem_PreviewGotKeyboardFocus;
    }

    private static void ListBoxItem_PreviewGotKeyboardFocus(object sender, System.Windows.Input.KeyboardFocusChangedEventArgs e)
    {
        var listBoxItem = (ListBoxItem)sender;
        listBoxItem.IsSelected = true;
    }
} 
```

## 将其添加到您喜欢的资源中。

例如`<Windows.Resources>`

```
<Window.Resources>
    <Style TargetType="ListViewItem">
        <Setter Property="myBehavior:SelectListBoxItemWhenControlInsideTheItemIsClickedBehavior.Enable" Value="true"/>
    </Style>
</Window.Resources> 
```

## 添加命名空间

如果 Visual Studio 不够聪明，无法自动添加它。例如，当您的项目名为“MyApp”并且您将文件保存在文件夹“MyBehaviors”中时，命名空间将位于 Window 下：

```
<Window
    xmlns:myBehavior="clr-namespace:MyApp.MyBehaviors"
    > 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-26T02:03:25.623

您对您的初始情况不是很具体。但我假设您使用 DataBinding 和 ItemTemplate。这是一种简单的方法，如果你是这个主题的初学者。这应该有效：

```
<ListBox ItemsSource="{Binding someDataCollection}" Name="myListBox">
   <ListBox.ItemTemplate>
      <DataTemplate>
         <TextBox Text="{Binding datafield}" Tag="{Binding .}"
                  GotFocus="TextBox_GotFocus"/>
      </DataTemplate>
   </ListBox.ItemTemplate>
</ListBox> 
```

* * *

```
private void TextBox_GotFocus(object sender, RoutedEventArgs e)
{
   myListBox.SelectedItem = (sender as TextBox).Tag; /* Maybe you need to cast to the type of the objects contained in the collection(bound as ItemSource above) */
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-20T16:44:36.443

我不完全确定您是否要按照上一个答案中的描述直接设置选择，因为我认为它会破坏多选和其他一些场景

. 您可能想尝试重新设置如下按钮的样式，看看会发生什么。

```
<Button ClickMode="Pressed" Focusable="False">
<Button.Template>
    <ControlTemplate>  // change the template to get rid of all the default chrome 
        <Border Background="Transparent"> // Button won't be clickable without some kind of background set
            <ContentPresenter />
        </Border>
    </ControlTemplate>
</Button.Template>
<TextBox /> 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-17T09:34:22.257

列表框处理项目选择，但不知道嵌入其中的文本框的焦点。如果您想在文本框获得输入焦点时更改选择，那么您需要手动更改列表框选择，afaik。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-06-28T06:00:36.787

试试这个代码：

```
foreach (object item in this.listBox1.Items) {
    if (textbox1.text.equals(item.toString())) {
        //show error message; break
    }
} 
```

# asp.net-mvc - ASP.NET MVC 生产力？

> ID：653534
> 
> 赞同：7
> 
> 时间：2009-03-17T09:34:23.817
> 
> 标签：asp.net-mvc

虽然，我仍然是 ASP.NET MVC 的新手，但我的经理要求我提供一份关于 ASP.NET MVC 生产力的报告。实际上，我们正计划使用 ASP.NET MVC 开发一个真实的、有点大的系统。问题是：
1-对于一个相当大的系统来说，它真的是goona scale吗？
2- 开发人员在“几周”内上手容易吗？
3- 是否有任何使用 ASP.NET MVC 构建的现实生活系统？“除了 NerdDinner”
4- MVC 如何通过 ASP.NET 节省一些开发时间？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-17T10:15:03.237

如果通过生产力你的经理真的意味着“编写功能 X 需要多长时间？” 那么你很可能在短期内不会像 ASP.NET MVC 那样高效。然而，与 webforms 相比，框架中更好的关注点分离意味着更容易测试和编写结构良好的代码。

这将提高您的长期生产力，但可能以牺牲短期生产力为代价。如果你能让你的经理看到这一点，那么你就是赢家。祝一切顺利！

要回答您的直接问题：

1.  它会扩展吗？
    *   毫无疑问，它建立在高性能的 ASP.NET 框架之上，并没有带来太多的 Webforms 包袱。
2.  开发者会不会很容易在短时间内“数周”上手？
    *   取决于您的开发人员当前的技能。如果他们熟悉**Web**开发和 MVC 模式，应该很容易上手。如果他们只熟悉 ASP.NET Webforms 拖放和一些代码隐藏，那么他们将有一个全新的范例来学习，这需要时间。
3.  是否有任何使用 ASP.NET MVC 构建的现实生活系统？
    *   这个网站就是一个很好的例子。
4.  MVC 如何通过 ASP.NET 节省一些开发时间？
    *   涵盖在我最初的答案中。但是，从长远来看，它也可以节省时间，因为您并不真正依赖框架，因此您不会将自己编码到 Webforms 经常发生的变通办法的角落。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T09:39:42.213

要回答 #3 - 是的，您现在正在使用一个 :o) [Stack Overflow 是用什么构建的？](https://blog.stackoverflow.com/2008/09/what-was-stack-overflow-built-with/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T09:40:36.020

1.  是的，它可以很好地扩展到大型系统，当然比 Forms 更好。
2.  视情况而定，已经被 ASP.NET 表单很好地灌输的开发人员可能会发现过渡很困难。经典的 ASPers 可能会发现它在某些方面非常熟悉。如果开发人员对 HTTP 的工作原理和通用 MVC 方法的好处有充分的了解，那应该不是什么大问题。
3.  你正在使用一个
4.  使用单元测试是从 MVC 中获得最大收益的关键，它将为您节省大量调试时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T09:46:47.923

在我看来，最有趣的问题是 #4 - 使用 ASP.NET MVC 如何节省开发时间？

它可以通过允许您构建一个应用程序框架来构建您的所有特性和功能。

Ayende 有一篇关于此的非常有趣[的帖子。](http://ayende.com/Blog/archive/2009/03/06/application-structure-concepts-amp-features.aspx)

我想很多 ASP.NET MVC 开发人员都会同意我的观点，即 ASP.NET MVC 还没有准备好构建复杂应用程序的功能——你必须付出一些努力来使框架适合你的应用程序，然后你才能开始实际使用它获得优势。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-06T15:50:32.497

它肯定可以扩展。但是与网络表单相比，生产力？除非您真的不擅长网络表单，否则毫无疑问，网络表单在 RAD 方面的速度要快数光年。

是的，ASP.NET MVC 的 TDD 不错，但是您必须意识到您正在测试很多内置于 web 表单（例如 gridview）的东西，以及所有这些不错的拖放自定义控件。当您在 MVC 中创建自己的 Web 表单时，您不必测试那些内置控件，您可以节省大量时间，是的，您最好编写更多代码来测试它们。因此，可测试性的收益实际上是一种错觉。

在我看到类似于 RAD 的 gridview 类型的东西之前，我不会跳入 MVC。

如果您了解 CodeSmith 并且可以自动化 MVC 中所有繁琐、重复的代码，这也会有所帮助。TDD 代码一次，然后创建一个 CodeSmith 模板，然后您只需生成代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-05-12T16:32:51.620

这是我的观点。

它会扩展吗？事实是，没有人发布一个体面的基准测试与等效架构进行比较。只是没有测试的单词。

开发者会不会很容易在短时间内“数周”上手？可能是基本的东西，但硬的东西不是。

是否有任何使用 ASP.NET MVC 构建的现实生活系统？如前所述，是的。

MVC 如何通过 ASP.NET 节省一些开发时间？人们说，因为代码“更好地分离了关注点”，所以神奇的事情突然发生了，生产力突然出现了。我很久以前用 Turbo Pascal 编程过。我使用 MVC 的“外观和感觉”让我想起了过去使用 DOS 和 Pascal 的经历。在设计时没有一个屏幕的良好视觉参考。您拥有一个充满文件的对象资源管理器，而不是一个在 Visual Studio 中带有一些控件的 Web 表单。在这个时候，我无法弄清楚这种模式如何能更有效地提供“更好的关注点分离”。

# c# - C# 3.0+ 中属性和字段的区别

> ID：653536
> 
> 赞同：142
> 
> 时间：2009-03-17T09:35:35.250
> 
> 标签：c#, properties, c#-3.0, field, automatic-properties

我意识到它似乎与[C# 中的字段和属性有什么区别？](https://stackoverflow.com/questions/295104/what-is-the-difference-between-a-field-and-a-property-in-c)但我的问题略有不同（从我的角度来看）：

一旦我知道

*   我不会将我的课程与“仅适用于属性的技术”一起使用，并且
*   我不会在 getter/setter 中使用验证代码。

是否有任何区别（样式/未来开发的除外），例如设置属性时的某种类型的控件？

是否有任何额外的区别：

```
public string MyString { get; set; } 
```

和

```
public string myString; 
```

（我知道，第一个版本需要 C# 3.0 或更高版本，并且编译器确实创建了私有字段。）

* * *

## 回答 #1

> 赞同：165
> 
> 时间：2009-03-17T11:15:57.007

字段和属性看起来相同，但实际上并非如此。属性是方法，因此属性不支持某些事情，并且某些事情可能会发生在属性上，但绝不会发生在字段的情况下。

以下是差异列表：

*   字段可以用作`out/ref`参数的输入。属性不能。
*   一个字段在多次调用时总是会产生相同的结果（如果我们忽略了多个线程的问题）。诸如此类的属性`DateTime.Now`并不总是等于其自身。
*   属性可能会抛出异常——字段永远不会那样做。
*   属性可能有副作用或需要很长时间才能执行。字段没有副作用，并且对于给定类型总是尽可能快。
*   属性支持 getter/setter 的不同可访问性 - 字段不支持（但可以制作字段`readonly`）
*   使用反射时，属性和字段被视为不同`MemberTypes`，因此它们的位置不同（例如`GetFields`vs ）`GetProperties`
*   与字段访问相比，JIT 编译器可能会以非常不同的方式处理属性访问。然而，它可以编译成相同的本机代码，但存在差异的范围。

* * *

## 回答 #2

> 赞同：119
> 
> 时间：2009-03-17T09:38:05.120

封装。

在第二个实例中，您刚刚定义了一个变量，在第一个实例中，变量周围有一个 getter / setter。因此，如果您决定要在以后验证变量 - 这会容易得多。

此外，它们在 Intellisense 中的显示方式也不同 :)

**编辑：**更新 OPs 更新问题 - 如果您想忽略此处的其他建议，另一个原因是它根本不是好的 OO 设计。如果您没有很好的理由这样做，请**始终**选择公共变量/字段上的属性。

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2009-03-17T09:39:37.580

几个快速，明显的区别

1.  属性可以具有访问器关键字。

    ```
    public string MyString { get; private set; } 
    ```

2.  可以在后代中覆盖属性。

    ```
    public virtual string MyString { get; protected set; } 
    ```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-03-17T09:46:46.580

根本区别在于，字段是内存中存储指定类型数据的位置。一个属性表示一个或两个代码单元，它们被执行以检索或设置指定类型的值。通过使用看起来像字段的成员（因为它可以出现在赋值操作的任一侧），这些访问器方法的使用在语法上是隐藏的。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2013-12-24T12:12:03.050

访问器不仅仅是字段。其他人已经指出了几个重要的区别，我将再添加一个。

属性参与接口类。例如：

```
interface IPerson
{
    string FirstName { get; set; }
    string LastName { get; set; }
} 
```

可以通过多种方式满足该接口。例如：

```
class Person: IPerson
{
    private string _name;
    public string FirstName
    {
        get
        {
            return _name ?? string.Empty;
        }
        set
        {
            if (value == null)
                throw new System.ArgumentNullException("value");
            _name = value;
        }
    }
    ...
} 
```

在这个实现中，我们既保护`Person`类不进入无效状态，又保护调用者不从未分配的属性中获取空值。

但我们可以进一步推动设计。例如，接口可能不处理 setter。可以说`IPerson`interface 的使用者只对获取属性感兴趣，而不是对设置它感兴趣：

```
interface IPerson
{
    string FirstName { get; }
    string LastName { get; }
} 
```

该类的先前实现`Person`满足此接口。从消费者（消费者）的角度来看，它让调用者也设置属性的事实是没有意义的`IPerson`。例如，builder 会考虑具体实现的附加功能：

```
class PersonBuilder: IPersonBuilder
{
    IPerson BuildPerson(IContext context)
    {

        Person person = new Person();

        person.FirstName = context.GetFirstName();
        person.LastName = context.GetLastName();

        return person;

    }
}

...

void Consumer(IPersonBuilder builder, IContext context)
{
    IPerson person = builder.BuildPerson(context);
    Console.WriteLine("{0} {1}", person.FirstName, person.LastName);
} 
```

在这段代码中，消费者不知道属性设置器——知道它不是他的事。消费者只需要getter，他从接口，即从合约中获取getter。

另一个完全有效的实现`IPerson`是不可变的人员类和相应的人员工厂：

```
class Person: IPerson
{
    public Person(string firstName, string lastName)
    {

        if (string.IsNullOrEmpty(firstName) || string.IsNullOrEmpty(lastName))
            throw new System.ArgumentException();

        this.FirstName = firstName;
        this.LastName = lastName;

    }

    public string FirstName { get; private set; }

    public string LastName { get; private set; }

}

...

class PersonFactory: IPersonFactory
{
    public IPerson CreatePerson(string firstName, string lastName)
    {
        return new Person(firstName, lastName);
    }
}
...
void Consumer(IPersonFactory factory)
{
    IPerson person = factory.CreatePerson("John", "Doe");
    Console.WriteLine("{0} {1}", person.FirstName, person.LastName);
} 
```

在此代码示例中，消费者再次不知道填充属性。Consumer 只处理 getter 和具体实现（以及它背后的业务逻辑，比如测试 name 是否为空）留给专门的类 - 构建器和工厂。所有这些操作对于字段来说是完全不可能的。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-03-17T09:38:41.810

第一个：

```
public string MyString {get; set; } 
```

是财产；第二个 ( `public string MyString`) 表示一个字段。

不同之处在于，某些技术（用于实例的 ASP.NET 数据绑定）仅适用于属性，而不适用于字段。XML 序列化也是如此：只有属性被序列化，字段不被序列化。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-17T10:09:53.140

在许多情况下，属性和字段可能看起来相似，但事实并非如此。对于字段不存在的属性存在限制，反之亦然。

正如其他人所提到的。您可以通过将访问器设为私有来将属性设为只读或只写。你不能用一个字段来做到这一点。属性也可以是虚拟的，而字段则不能。

将属性视为 getXXX()/setXXX() 函数的语法糖。这就是它们在幕后实现的方式。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-05-07T18:38:29.447

字段和属性之间还有另一个重要区别。

使用 WPF 时，只能绑定到公共属性。绑定到公共字段将**不起作用**。即使没有实施也是如此`INotifyPropertyChanged`（即使你总是应该这样做）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-01-27T23:20:26.740

在其他答案和示例中，我认为这个示例在某些情况下很有用。

例如，假设您有以下类似内容：**`OnChange`** `property`

```
public Action OnChange { get; set; } 
```

如果您想使用委托，则需要将其更改**`OnChange`**为`field`：

```
public event Action OnChange = delegate {}; 
```

在这种情况下，我们会保护我们的领域免受不必要的访问或修改。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-08-09T15:32:33.153

对于任何公共字段，您应该始终使用属性而不是字段。这可确保您的库能够在将来需要时对任何字段实施封装，而不会破坏现有代码。如果您将字段替换为现有库中的属性，那么所有使用您的库的依赖模块也需要重建。

# c# - 将xml转换为排序字典

> ID：653540
> 
> 赞同：3
> 
> 时间：2009-03-17T09:37:13.810
> 
> 标签：c#, xml

我有一个类似这样的 xml 文件：

```
<?xml version="1.0" encoding="UTF-8"?>
<data>
    <resource key="123">foo</resource>
    <resource key="456">bar</resource>
    <resource key="789">bar</resource>

</data> 
```

我想把它作为键值对放入字典（排序）中。即：123：foo，456：bar ...等

钥匙是未知的。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-17T09:58:10.437

这看起来像是 Linq to Xml 的工作

```
 static void Main(string[] args)
    {            
        XDocument yourDoc = XDocument.Load("the.xml");
        var q = from c in yourDoc.Descendants("resource")
                orderby (int) c.Attribute("key")
                select c.Attribute("key").Value + ":" + c.Value;

        foreach (string s in q)
            Console.WriteLine(s);                            
        Console.ReadLine();
    } 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T10:04:02.110

试试这个，

```
string s = "<data><resource key=\"123\">foo</resource><resource key=\"456\">bar</resource><resource key=\"789\">bar</resource></data>";
XmlDocument xml = new XmlDocument();
xml.LoadXml(s);
XmlNodeList resources = xml.SelectNodes("data/resource");
SortedDictionary<string,string> dictionary = new SortedDictionary<string,string>();
foreach (XmlNode node in resources){
   dictionary.Add(node.Attributes["key"].Value, node.InnerText);
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-17T18:40:24.537

这实际上更容易不使用 Linq 而只使用`XmlDocument`：

```
SortedDictionary<string, string> myDict = new SortedDictionary<string, string>();
foreach (XmlElement e in myXmlDocument.SelectNodes("/data/resource"))
{
   myDict.Add(e.GetAttribute("key"), e.Value);
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T18:48:58.383

使用 LINQ：

装入文档`XDocument.Load`或`XDocument.Parse`：

```
var xml = XDocument.Load(...); 
```

遍历有序序列：

```
var sequence = from e in xml.Root.Elements() 
               let key = (string)e.Attribute("key")
               order by key
               select new { 
                 Key = key, 
                 Value = (string)e 
               }; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T10:03:21.847

我会通过 XSLT 转换来做到这一点。你需要用 C# 来完成这项工作吗？如果不是，您可以简单地制作一个 XSLT 文档，该文档解析所有资源标签并为您整理输出 key:value。非常容易完成。这是您想要的解决方案吗？

# c# - 保持你的源代码和你的单元测试更接近

> ID：653545
> 
> 赞同：4
> 
> 时间：2009-03-17T09:39:11.373
> 
> 标签：c#, unit-testing, nunit

当我第一次开始使用单元测试时，我遇到了两个问题。首先是能够测试私有方法和字段，其次是在快速开发发生时使单元测试保持最新。因此，我采用以下方法进行单元测试。

```
#if UNITTEST
using NUnit.Framework;
#endif

public class MyBlackMagic
{
   private int DoMagic()
   {
      return 1;
   }

   #if UNITTEST

   [TestFixture]
   public class MyBlackMagicUnitTest
   {
        [TestFixtureSetUp]
        public void Init()
        {
             log4net.Config.BasicConfigurator.Configure();
        }

        [Test]
        public void DoMagicTest()
        {
             Console.WriteLine(System.Reflection.MethodBase.GetCurrentMethod().Name);
             Assert.IsTrue(DoMagic() == 1, "You are not a real magician!");
         }
     }

     #endif
 } 
```

我发现这种方法克服了我的两个问题，它是一个预编译器开关的轻弹，以确保所有单元测试都能编译。

我现在的问题是我正在转移到一个新项目，其中的话题是使用单独的程序集来进行单元测试。在我深入并开始阐述如上所示的内部类方法的优点之前，我想知道是否有人认为它有任何缺点？

编辑：

只是围绕一些提到的弱点添加几点：

*   单元测试代码永远不会影响生产代码，因为 UNITTEST 预编译器标志被关闭，
*   单元测试代码不会降低主代码的可读性，因为它位于每个类的底部并包装在 Visual Studio 区域指令中，
*   我发现内部单元测试类意味着主类实际上更简单，因为没有为了测试而必须公开的额外方法或属性。总会有这样的情况，你迟早要测试一个类的一些内部状态作为单元测试的一部分......

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-17T09:44:56.257

我觉得这种方法非常丑陋，因为它用测试方法混淆了你的真实逻辑，使你的源代码更难阅读。

除此之外，您还拥有对项目本身中的 NUnit 程序集的依赖项（引用）。尽管在没有 unit_test 条件定义的情况下编译时不需要依赖，但这很丑陋且不必要。

如果你想跟上你的单元测试，我建议你先写测试，然后实现真正的代码。

编写单元测试不仅仅是测试；它也是关于设计代码的。

通过首先编写测试，您将考虑 API / 类的接口，或者您希望如何使用这些类。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-17T09:55:46.387

您不应该单独测试私有方法，因为它们（应该！）从公共方法或可能的构造函数中使用 - 因此公共方法依赖于私有方法来成功完成分配。

如果私有方法不工作，这些公共方法/构造函数将（应该！）失败。因此，您的方法实际上是编写单元测试的不好方法。

并迭代以前的答案 - 在编写方法之前编写单元测试。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-17T09:53:30.013

如果您不能始终保持所有测试成功（由于开发截止日期），那么我认为您没有非常认真地进行单元测试，并且在进行估算时应该考虑到测试的维护。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-17T10:01:38.573

我发现将我的单元测试保存在他们自己的程序集中效果很好，并且在使用它时没有遇到任何问题。

但是，如果您发现自己需要测试某个类的私有成员，那可能意味着您的类正在做很多事情。您最好将这些私有成员提取到一个新类中。然后，您可以直接通过其公共方法测试该新类。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-17T18:22:01.867

并且，请告诉您，您如何在设置`UNITTEST`为 false 的任何构建上运行单元测试？

我是一个蹩脚、懒惰的 TDD 实施者。我没有写任何接近足够测试的地方，我也不会太频繁地运行它们。但即使我测试我的发布版本。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T09:44:47.163

我认为这不是单元测试的设计目的。如果您已经快速开发了代码并且您的单元测试落后了，那么它们当然会失败，但这不应该导致您使用黑魔法，而是编写单元测试。如果您不喜欢这种方式，那么您根本不应该使用单元测试。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T10:04:06.960

将测试代码保留在自己的单独程序集中的基本原理是因为测试代码不应该被用户“使用”。单元测试仅用于验证代码是否执行指定的操作。通常的做法是将测试代码放在自己的程序集中，这样生产代码就不会依赖于测试代码和单元测试框架。

从这个代码示例中，我不清楚您要测试什么。似乎您正在尝试测试未与环境完全隔离的东西。当 xUnit 测试运行器可以为您记录测试结果时，为什么还需要记录器？

内部类很难测试，因为您需要一个内部类正在实现的公共接口（或抽象类），并且您需要与创建它的类一起测试它。更明确的单元测试应该检查一个特定类的行为，如果一个内部类以某种方式返回，那么你需要检查它是否以正确的方式返回。

# ant - Windows下如何安装ant contrib？

> ID：653552
> 
> 赞同：7
> 
> 时间：2009-03-17T09:41:13.943
> 
> 标签：ant

**前奏：** Ant-Contrib 为安装和启动提供了一个很好解释的 wiki 页面（[ [http://ant-contrib.sourceforge.net/#install][1]](http://ant-contrib.sourceforge.net/#install][1])）。

事实上，只需要两个步骤： - 构建 ant-contrib-0.3.jar（通过 ant dist...）， - 将构建的 .jar 移动到 Ant 安装的 lib 目录中，

通过在您自己的项目中编写来使用它：

```
<taskdef resource="net/sf/antcontrib/antcontrib.properties"/> 
```

**我的问题：** 我成功构建了.jar（构建成功是写的）。但是我在构建的 jar 中找不到任何“antcontrib.properties”！

**请求：** 我忘记了重要的事情是什么？搜索任何已经构建的 ant-contrib-0.3.jar 会更好吗？谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2011-07-01T02:59:27.910

如果你有更高版本的 1.0b3 版本..
来自[http://sourceforge.net/projects/ant-contrib/](http://sourceforge.net/projects/ant-contrib/)
或[http://ant-contrib.sourceforge.net](http://ant-contrib.sourceforge.net)

我相信您必须将这个用于 ANT 1.6 及更高版本：

```
<taskdef resource="net/sf/antcontrib/antlib.xml"/> 
```

而不是 antlib.properties 文件。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-02-22T20:19:30.717

[我制作了一个名为WinAnt](http://code.google.com/p/winant/)的简单安装程序，它将为您安装 Ant 和 Ant-contrib。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T10:04:42.623

如果您下载此文件[http://www.java2s.com/Code/JarDownload/ant-contrib-0.6.jar.zip](http://www.java2s.com/Code/JarDownload/ant-contrib-0.6.jar.zip)，其中包含一个 antcontrib.properties。因此，安装说明或 ant 构建文件可能已过时。您是否尝试过使用 Maven 构建 Ant-Contrib？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-06-30T21:16:45.123

我使用我的自定义 in-build.xml 安装程序。这个坏男孩会检测你的 ant lib 目录中是否有它，如果没有，则下载并初始化它。

您需要做的就是向您的目标添加一个depends="init-ant-contrib"，然后bam。无论何时何地部署，您都拥有 ant-contrib——只要 sourceforge 不带走 dl 链接。

```
 <!-- ANT-CONTRIB autoinstaller -->
  <available property="ant-contrib-exists"
             file="${ant.library.dir}/ant-contrib-1.0b3.jar" />
  <target name="download-ant-contrib" unless="ant-contrib-exists">
    <mkdir dir="${ant.library.dir}" />
    <get src="http://downloads.sourceforge.net/project/ant-contrib/ant-contrib/1.0b3/ant-contrib-1.0b3-bin.zip?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fant-contrib%2Ffiles%2Fant-contrib%2F1.0b3%2F&amp;use_mirror=cdnetworks-us-1"
         dest="${ant.library.dir}/ant-contrib-1.0b3-bin.zip"
         username="true" />
    <unzip src="${ant.library.dir}/ant-contrib-1.0b3-bin.zip"
           dest="${ant.library.dir}"
           overwrite="no" />
    <move todir="${ant.library.dir}">
      <fileset file="${ant.library.dir}/ant-contrib/*.jar" />
      <fileset file="${ant.library.dir}/ant-contrib/lib/*.jar" />
    </move>
    <delete file="${ant.library.dir}/ant-contrib-1.0b3-bin.zip" />
    <delete dir="${ant.library.dir}/ant-contrib" />
  </target>
  <target name="init-ant-contrib" depends="download-ant-contrib">
    <taskdef resource="net/sf/antcontrib/antcontrib.properties">
      <classpath>
        <pathelement location="${ant.library.dir}/ant-contrib-1.0b3.jar" />
      </classpath>
    </taskdef>
  </target> 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-04-08T19:22:59.427

需要下载[ant-contrib-1.0b3](http://sourceforge.net/projects/ant-contrib/files/ant-contrib/1.0b3/)最新版本（1.0b5）不包含ant-contrib-1.0b3.jar

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-19T11:45:32.077

这是您可以找到二进制 ant-contrib 发行版的地方：http: [//sourceforge.net/project/showfiles.php ?group_id=36177&package_id=28636](http://sourceforge.net/project/showfiles.php?group_id=36177&package_id=28636)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-28T10:04:51.113

这应该有帮助：

```
<taskdef resource="net/sf/antcontrib/antcontrib.properties" classpath="${lib.dir}/ant-contrib-1.0b3/ant-contrib-1.0b3.jar"/> 
```

# sql-server - 为什么 count() 函数需要一个参数？

> ID：653560
> 
> 赞同：11
> 
> 时间：2009-03-17T09:44:34.683
> 
> 标签：sql-server

该`count()`函数计算行数，并且经常用作`count(*)`. 如果我有一张带有 phoneNo 和 firstName 的表，则`count(phoneNumber)`返回与`count(*)`. 如果未填充，所有列始终存在于每一行中。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-17T09:48:08.480

有细微的差别。

如果您指定一个字段，count(fieldname) 将计算该字段具有*非空*值的记录。count(*) 会给你总行数。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-17T09:50:53.060

另一方面，您可以计算不同的值。count(distinct firstName) 可能会提供与 count(distinct phoneNumber) 不同的结果，并且两者都可能与 count() 不同。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-17T09:49:18.383

见[MSDN](http://msdn.microsoft.com/en-us/library/ms175997.aspx)

Count(phoneNo) 将返回 phoneNo 不为空的记录数。Count(*) 无论如何都返回数字或行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T09:49:23.423

`COUNT(*)`将计算每一行。`COUNT(yourColumn)`不包括行 where `yourColumn`is `NULL`。

例如，如果您的表中有 20 行并且该`phoneNumber`列`NULL`在其中的 5 行中，`COUNT(*)`则将返回 20 而`COUNT(phoneNumber)`将返回 15。

# c# - 在 C# 中传递命令行参数

> ID：653563
> 
> 赞同：19
> 
> 时间：2009-03-17T09:45:43.027
> 
> 标签：c#, command-line-arguments

我正在尝试将命令行参数传递给 C# 应用程序，但我在传递类似这样的东西时遇到问题

```
"C:\Documents and Settings\All Users\Start Menu\Programs\App name" 
```

即使我加入`" "`了论点。

这是我的代码：

```
 public ObjectModel(String[] args)
    {
        if (args.Length == 0) return; //no command line arg.
        //System.Windows.Forms.MessageBox.Show(args.Length.ToString());
        //System.Windows.Forms.MessageBox.Show(args[0]);
        //System.Windows.Forms.MessageBox.Show(args[1]);
        //System.Windows.Forms.MessageBox.Show(args[2]);
        //System.Windows.Forms.MessageBox.Show(args[3]);
        if (args.Length == 3)
        {
            try
            {
                RemoveInstalledFolder(args[0]);
                RemoveUserAccount(args[1]);
                RemoveShortCutFolder(args[2]);
                RemoveRegistryEntry();
            }
            catch (Exception e)
            {
            }
        }
        } 
```

这就是我要传递的内容：

```
C:\WINDOWS\Uninstaller.exe  "C:\Program Files\Application name\"  "username"  "C:\Documents and Settings\All Users\Start Menu\Programs\application name" 
```

问题是我可以正确获取第一个和第二个参数，但最后一个参数是`C:\Documents`.

有什么帮助吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-17T10:22:53.467

我只是进行了检查并验证了问题。它让我感到惊讶，但它是第一个参数中的最后一个 \ 。

```
"C:\Program Files\Application name\" <== remove the last '\' 
```

这需要更多解释，有人有想法吗？我倾向于称其为错误。

* * *

第 2 部分，我又进行了一些测试，然后

```
"X:\\aa aa\\" "X:\\aa aa\" next 
```

变成

```
X:\\aa aa\
X:\\aa aa" next 
```

[从乔恩·加洛韦 (Jon Galloway) 的博客中，](http://weblogs.asp.net/jgalloway/archive/2006/10/05/_5B002E00_NET-Gotcha_5D00_-Commandline-args-ending-in-_5C002200_-are-subject-to-CommandLineToArgvW-whackiness.aspx) Google 的一些小动作给出了一些见解，基本规则是：

*   反斜杠是转义字符
*   总是转义引号
*   仅在引号之前转义反斜杠。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T09:54:42.303

添加伊恩坎普的答案

如果您的程序集名为“myProg.exe”并且您传入字符串“C:\Documents and Settings\All Users\Start Menu\Programs\App name”链接，那么

```
C:\>myprog.exe "C:\Documents and Settings\All Users\Start Menu\Programs\App name" 
```

字符串“C:\Documents and Settings\All Users\Start Menu\Programs\App name”

将在 args[0]。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T10:00:04.833

添加到其他人已经说过的话，这可能是一个逃避问题。你应该用另一个反斜杠来转义你的反斜杠。

应该是这样的：

C:\>myprog.exe "C:\\Documents and Settings\\所有用户\\开始菜单\\程序\\应用程序名称"

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-05T10:51:19.663

我最近注意到了同样令人讨厌的问题，并决定自己编写一个解析器来解析命令行参数数组。

注意：问题在于传递给静态 void Main(string[] args) 函数的 .NET CommandLine Arguments 转义了 \" 和 \\。这是设计使然，因为您实际上可能希望传递一个带有引号或反斜杠.一个例子：

假设您想将以下内容作为单个参数传递：

> -msg：嘿，“你在哪里？”

例如。

> sampleapp -msg:"嘿，\"你在哪里？\""

将是如何以默认行为发送它。

如果您没有看到任何人必须为您的程序转义引号或反斜杠的理由，您可以使用自己的解析器来解析命令行，如下所示。

IE。[程序].exe "C:\test\" arg1 arg2

会有一个 args[0] = c:\test" arg1 arg2

你所期望的是 args[0]=c:\test\ 然后是 args[1]=arg1 和 args[2]=arg2。

下面的函数将参数解析为具有这种简化行为的列表。

请注意，arg[0] 是使用以下代码的程序名称。（您调用 List.ToArray() 将结果列表转换为字符串数组。）

```
protected enum enumParseState : int { StartToken, InQuote, InToken };
public static List<String> ManuallyParseCommandLine()
{
    String CommandLineArgs = Environment.CommandLine.ToString();

    Console.WriteLine("Command entered: " + CommandLineArgs);

    List<String> listArgs = new List<String>();

    Regex rWhiteSpace = new Regex("[\\s]");
    StringBuilder token = new StringBuilder();
    enumParseState eps = enumParseState.StartToken;

    for (int i = 0; i < CommandLineArgs.Length; i++)
    {
        char c = CommandLineArgs[i];
    //    Console.WriteLine(c.ToString()  + ", " + eps);
        //Looking for beginning of next token
        if (eps == enumParseState.StartToken)
        {
            if (rWhiteSpace.IsMatch(c.ToString()))
            {
                //Skip whitespace
            }
            else
            {
                token.Append(c);
                eps = enumParseState.InToken;
            }

        }
        else if (eps == enumParseState.InToken)
        {
            if (rWhiteSpace.IsMatch(c.ToString()))
            {
                Console.WriteLine("Token: [" + token.ToString() + "]");
                listArgs.Add(token.ToString().Trim());
                eps = enumParseState.StartToken;

                //Start new token.
                token.Remove(0, token.Length);
            }
            else if (c == '"')
            {
               // token.Append(c);
                eps = enumParseState.InQuote;
            }
            else
            {
                token.Append(c);
                eps = enumParseState.InToken;
            }

        }
            //When in a quote, white space is included in the token
        else if (eps == enumParseState.InQuote)
        {
            if (c == '"')
            {
               // token.Append(c);
                eps = enumParseState.InToken;
            }
            else
            {
                token.Append(c);
                eps = enumParseState.InQuote;
            }

        }

    }
    if (token.ToString() != "")
    {
        listArgs.Add(token.ToString());
        Console.WriteLine("Final Token: " + token.ToString());
    }
    return listArgs;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-17T21:14:56.860

在回应 WWC 的回答时，Jamezor 评论说，如果第一个字符是引号，他的代码将失败。

要解决该问题，您可以将 StartToken 案例替换为：

```
 if (eps == enumParseState.StartToken)
            {
                if (rWhiteSpace.IsMatch(c.ToString()))
                {
                    //Skip whitespace
                }
                else if (c == '"')
                {
                    eps = enumParseState.InQuote;
                }
                else
                {
                    token.Append(c);
                    eps = enumParseState.InToken;
                }
            } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T09:49:29.883

究竟是什么问题？无论如何，这里有一些一般性建议：

确保您的 Main 方法（在 Program.cs 中）定义为：

```
void Main(string[] args) 
```

然后 args 是一个包含命令行参数的数组。

# jsp - 在jsp页面中隐藏地址栏和状态栏

> ID：653567
> 
> 赞同：0
> 
> 时间：2009-03-17T09:47:48.140
> 
> 标签：jsp

我需要隐藏一个jsp页面的地址栏和状态栏，“demo.jsp”

我的代码是

```
 <html>
 <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Welcome</title>
</head>

    <frameset cols="10%,90%">
        <frame src="actions.jsp" name="page1"></frame>
        <frame src="default.jsp" name="page2"></frame>
    </frameset>

</html>
all i need to do is display the same page without address bar and status bar. 
```

我试着做

window.open("login.jsp", "eTIMS", "工具栏=0,位置=0,目录=0,状态=0,菜单栏=0,滚动条=1,可调整大小=0,宽度=1014,高度=714 ,left=0,top=0") 在同一页面内。但它一直在迭代。上一页也还在。我也不知道如何关闭上一页。任何解决方案？

更多信息：

tis 是我的 jsp 页面，我通过访问数据库来检查用户名和密码。我使用 <% if (EmpBean.login()==0){response.sendRedirect("welcome.jsp"); 验证这一点 } else{ response.sendRedirect("login.jsp?ch=2");} %> 如果正确则转到welcome.jsp。

我不希望welcome.jsp 的用户返回我的登录页面。我想保持它尽可能抽象。请帮我解决这个问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T11:51:07.827

Gareth 是对的，至少对于所有浏览器，您根本无法做到这一点：例如，Firefox 将始终显示菜单栏和状态栏，至少作为安全功能（因此您不能将 Web 窗口伪装成系统）窗口）并且还允许用户保持控制。
另外，我看不出这样做会如何防止返回（按退格键，使用上下文菜单等）。

您无法阻止用户返回（浏览器）历史记录，很多人都尝试过但没有成功，您将找不到任何禁止这样做的网站。您应该尝试另一种解决方法。

此外，由于您生成页面，您应该进行无框架设计：使用框架是如此 - 20 世纪...... :-) 搜索一下网络以了解为什么使用框架是一个坏主意，至少出于可用性原因。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T09:50:13.063

你正在尝试的事情是不可能的。您不能使用 javascript 关闭未打开的窗口。而且您绝对无法控制我的浏览器如何显示我已经打开的窗口

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-01T05:17:21.950

```
window.open(document.location+'?newwin=true',name,'fullscreen=no,width=1000%,height=700,toolbar=no,menubar=no,statusbar=no,scrollbars=yes,addressbar=no,resizable=yes,directories=no,location=no,left=' + left + ',top=' + top); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-22T11:16:27.020

[http://labs.mozilla.com/prism/](http://labs.mozilla.com/prism/)

Prism 是一种有趣的方法，它本质上是一个没有任何任务栏的浏览器。

# visual-studio-2008 - 在本地调试 .NET Compact Framework 应用程序（无需模拟器或设备）

> ID：653577
> 
> 赞同：3
> 
> 时间：2009-03-17T09:50:47.023
> 
> 标签：visual-studio-2008, debugging, compact-framework, windows-ce

我目前正处于一个新项目的准备阶段，该项目将使用 .NET Compact Framework（我们将看到 2.0 或 3.5）开发，并将在定制的 Windows CE 6 硬件上运行。但是，有一件事我无法工作：

似乎只能使用物理设备或模拟器进行调试。但是当我刚刚从资源管理器启动应用程序时，它在我的桌面上愉快地运行（因为，当然，CF 安装在我的开发机器上。所以，实际的问题是：

如何使用在桌面 CF 框架上运行的应用程序在桌面系统上调试我的 .NET CF 应用程序？或者这是不可能的？如果是后者，我该怎么做？创建一个非CF项目进行调试？我知道我应该在设备上进行调试，这对于应用程序的后端来说是必不可少的，但是 GUI 可以在桌面上进行调试。由于它使用 OpenGL，它的运行速度比在模拟器中快得多（设备具有 OpenGL 加速）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-12T16:12:16.650

按照 Daniel Moth 的指南设置“我的电脑”部署目标：

[“飞蛾：部署到我的电脑”](http://www.danielmoth.com/Blog/2005/01/deploy-to-my-computer.html)

然后选择它作为您的智能设备项目的部署目标并按 F5。尽量远离任何特定于平台的模块/方法等。

如果您是 Compact Framework 开发人员，Moth 先生的博客中有很多很棒的博客条目。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-20T15:45:01.923

通常我会创建 2 个项目，一个用于桌面，一个用于 CF。桌面版本是只引用 CF .dlls 的桌面 exe（这很好）。显然，您需要将您的主应用程序推送到库中，并使您的实际 .exe 只是一个非常轻的包装器（但无论如何这是一个非常好的设计）

它实际上不是在 CF 上运行，而是在 FF 上运行，因此您可能会在不同的实现中注意到一些兼容性问题。

另一种选择是使用 Visual Studio 中的调试选项来“附加到进程”。这样，您可以通过双击运行应用程序，然后附加到该进程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T12:42:54.693

我知道您在调试 CF 应用程序时模拟器性能低下的意思。

不幸的是，我不认为这是开箱即用的。如果您注意到，VS 中的调试器总是会检查您连接的设备是什么，以确定是否应该部署您的应用程序，具体取决于您自上次部署以来是否有任何更改。

如果有人想在模拟器或设备以外的东西上进行调试，他们应该尝试在该列表中添加另一个“模拟器”，这可能不是典型的模拟器，而是桌面本身。不幸的是，我认为这是不可能的。

当然，我已准备好由在 CF 开发方面更有经验的人纠正。如果存在这种调试 CF 应用程序的技术，我会非常感兴趣！

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2013-06-07T13:17:15.447

**准备连接设备**

1.  使用与设备的任何连接，将以下文件复制到设备上的 \Windows\ 文件夹。这些文件默认位于开发计算机上的 \Program Files\Common Files\Microsoft Shared\CoreCon\1.0\Target\wce400\。Clientshutdown.exe ConmanClient2.exe CMaccept.exe eDbgTL.dll TcpConnectionA.dll
2.  从设备上的命令提示符运行 conmanclient2.exe。
3.  确定设备的 IP 地址。

**准备 Visual Studio 进行连接**

1.  在 Visual Studio 工具菜单上，单击选项，然后单击设备工具，然后单击设备。
2.  选择 Windows CE 设备，然后单击属性。
3.  在传输框的右侧，单击配置。
4.  在配置 TCP/IP 传输对话框中，选择使用特定 IP 地址，然后键入设备 IP 地址。

**设置安全性并建立连接** 1\. 在设备的命令提示符处，运行 cMaccept.exe。

# svn - 从旧的 Subversion 备份中恢复文件

> ID：653583
> 
> 赞同：4
> 
> 时间：2009-03-17T09:53:12.027
> 
> 标签：svn

我有一个旧的颠覆服务器的 tar 备份，该服务器早已死亡。该服务器管理的所有源代码都是遗留代码，将不再需要......除了这个项目。

tar 文件中充满了诸如“conf”、“dav”、“db”之类的小目录……

有没有办法从这个备份中提取单个项目的最终源代码？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T10:00:57.717

您只需从 tar 存档中提取整个存储库目录：

```
tar xvf oldSubversionServer.tar path/to/subversion/repository 
```

`svn`然后，您可以使用`file:`访问方法浏览存储库或使用客户端创建项目的工作副本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T09:59:40.357

创建一个新的颠覆服务器。将备份恢复到新服务器。将您需要的代码复制到当前的颠覆服务器中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T10:15:07.120

您可以将整个备份加载到新服务器

```
tar xvf oldSubversionServer.tar | svnadmin load /var/svn/repos/temp 
```

然后只转储该项目

```
svnadmin dump /var/svn/repos/temp/project | gzip -9 > dump.gz 
```

将转储的内容加载到存储库中

```
gunzip -c dump.gz | svnadmin load /var/svn/repos/your_import_repo 
```

这样您就可以保留对该项目的修订。

# visual-studio-2008 - VS2008 TFS：是否可以更改工作项的默认签入操作？

> ID：653586
> 
> 赞同：6
> 
> 时间：2009-03-17T09:53:43.880
> 
> 标签：visual-studio-2008, version-control, tfs

当我将代码签入到我们的 Team Foundation Server 时，我有时（可能比我实际做的更多……）应该将我的签入与我正在处理的任务或错误相关联。当我标记任务或签入时，它会将签入操作设置为解决。但几乎总是，我只想把它当作助理。结果是我经常最终将任务标记为错误地解决。当我标记任务时，有没有办法将关联设置为默认值？

解决错误或任务应该是我主动选择的。就像，这个工作项与我的签到有关，现在已经解决了。不，这个工作项和我的签到有关，顺便说一句，我还没有完全修复它......

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-07-18T00:49:03.893

TFS **2010**没有 UI 来更改工作项的默认签入操作。我在[MS Connect中提出了建议](https://connect.microsoft.com/VisualStudio/feedback/details/576101/provide-ability-to-specify-default-work-item-association)

但是请参阅帖子 [http://blogs.msdn.com/b/mitrik/archive/2010/12/03/how-to-make-associate-the-default-action-for-work-items.aspx](http://blogs.msdn.com/b/mitrik/archive/2010/12/03/how-to-make-associate-the-default-action-for-work-items.aspx)

> 要使“关联”成为默认操作（而不是“解决”），请将注册表项“HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\10.0\TeamFoundation\SourceControl\Behavior\ResolveAsDefaultCheckinAction”设置为“False”。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T15:38:00.560

可悲的是，没有办法使解析和关联都可用，但默认为关联。因此，对您来说最安全的选择可能是完全删除签入操作，并记住在完成与工作项的关联后更新工作项。有关更多信息，请参阅我不久前写的以下博客文章。

[TFS 重要提示 #3：从工作项中删除解决签入操作](http://www.woodwardweb.com/vsts/top_tfs_tip_3_r.html)

# flash - AS3，挂钩您的活动

> ID：653593
> 
> 赞同：0
> 
> 时间：2009-03-17T09:58:01.420
> 
> 标签：flash, actionscript-3, events, hook

有没有人有挂钩事件的经验。所以我们可以修改那里的行为而不改变它的初始值。

因此，假设我们想要修改每次单击某组菜单按钮的行为，如果单击它们，您将在调用原始回调之前等待 30 秒。

我正在开发一个项目，该项目将在现有 Air 应用程序之上创建一个层，该层将允许 Manage 以允许小额支付的方式构建，以实现对某些功能的完全访问。

我的猜测是使用挂钩来捕获您的事件，因此我们不必编辑我们的应用程序，只需扩展它即可。（如果我错了，请纠正我:-)）我

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-23T17:37:33.420

是的，这应该可以通过一些修改来实现。

而不是处理事件，您可以在它到达原始目标之前停止它，克隆它，然后在延迟后重新触发克隆。

如果您不知道 Flash 中显示列表（您可以看到的任何内容）中的事件如何工作，让我先解释一下。

当您单击一个按钮时，将触发 MouseEvent，它从捕获阶段开始，在舞台上开始按照注册侦听器时设置的优先级顺序调用为“CLICK”事件注册的所有事件侦听器。如果侦听器具有相同的优先级（默认值为 0），则以随机顺序调用（正确地按照它们注册的顺序）。一旦调用了舞台的所有侦听器，就会调用按钮祖先列表中的下一个 displayObject，并且同样的事情再次发生。这一直持续到允许鼠标事件的最里面的显示对象（可能是按钮内的文本字段标签）。捕获阶段到此结束，目标阶段开始。在目标阶段调用最内层对象上的所有侦听器。然后开始冒泡阶段，

应该注意的是，在闪存中，目标阶段是作为冒泡阶段的一部分处理的。

我们如何使用它？

好吧，当您注册和事件侦听器时，您可以指定阶段和优先级。默认值为冒泡阶段和优先级 0。因此，如果我们在舞台上为捕获阶段注册一个单击事件侦听器，其优先级为 int.MAX_VALUE，我们将在任何其他侦听器之前获取事件，除了可能是另一个相同的侦听器。以下代码将阻止其他侦听器注册单击事件。

```
stage.addEventListener(MouseEvent.CLICK, stageClick, true, int.MAX_VALUE);

function stageClick(e:MouseEvent):void
{
    e.stopImmediatePropagation();
} 
```

这引发了其他一些问题，首先你不想为所有事情都这样做。

*   一种解决方案是列出所有应该修改其事件的按钮，并使用 e.target 对其进行检查。
*   另一种解决方案是让所有需要延迟的按钮实现一个接口（我们称之为 IButtonDelay）。然后简单检查 e.target 是否为 IButtondelay。
*   第三种解决方案是仅侦听包含父项（如菜单栏）上的事件，因为无论如何您都不太可能在事件到达该父项之前使用该事件。

对于前两个解决方案，您应该阻止按钮子级的鼠标交互以简化检测（DisplayObjectContainer.mouseChildren = false）。无论您在这里选择什么，接下来您都必须使用简单的 Timer 进行延迟。然后在延迟后再次触发事件。

```
e.target.dispatchEvent(e.clone()); 
```

这引发了不延迟重新触发事件的问题。我的建议是触发从 MouseEvent 继承的事件对象，而不是简单的克隆。MouseEvent 很容易复制，它只有几个属性。因此，当您第二次捕获它时，您可以检查它是正常的鼠标点击还是重复的。

使用按钮上带​​有界面的解决方案，它将类似于：

```
stage.addEventListener(MouseEvent.CLICK, stageClick, true, int.MAX_VALUE);

function stageClick(e:MouseEvent):void
{
    if(e.target is IDelayButton && !e is DelayedMouseEvent)
    {
        e.stopImmediatePropagation();
        DelayEvent(e);
    }
}

function DelayEvent(e:MouseEvent):void
{
    //You code for the delaying, cloning and refiring the event here
} 
```

您可能需要侦听更多类型的事件（键盘事件），但大多数代码可以变得足够通用以包含它们。

希望对长期阅读有所帮助和抱歉。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T11:10:43.447

我认为您无法在不实际更改应用程序的情况下以这种方式更改事件系统（如果您可以更改应用程序，那么制作启用此行为的自定义按钮并不难）

最简单的解决方案可能是在要阻止的按钮上添加另一个 Sprite/Button —— 这样您就不必对应用程序进行太多更改并且阻止很简单。唯一的缺点：原始按钮上的鼠标悬停行为将不起作用，因为它没有获得任何鼠标事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T11:04:20.357

在我的脑海中，我认为你可以这样做：对事件使用事件处理程序`click`并使用 a`Timer`等待只要你愿意或调用做一些处理，然后在后者完成时，调用对应于的操作`click`. _

或者，我有什么遗漏吗？

# c# - 如何有条件地从 .NET 集合中删除项目

> ID：653596
> 
> 赞同：17
> 
> 时间：2009-03-17T09:58:11.343
> 
> 标签：c#, .net, collections, extension-methods

我正在尝试在 .NET 中编写一个扩展方法，该方法将对通用集合进行操作，并从集合中删除与给定条件匹配的所有项目。

这是我的第一次尝试：

```
public static void RemoveWhere<T>(this ICollection<T> Coll, Func<T, bool> Criteria){
    foreach (T obj in Coll.Where(Criteria))
        Coll.Remove(obj);
} 
```

但是，这会引发 InvalidOperationException，“集合已修改；枚举操作可能无法执行”。这确实是有道理的，所以我再次尝试使用第二个集合变量来保存需要删除的项目并迭代它：

```
public static void RemoveWhere<T>(this ICollection<T> Coll, Func<T, bool> Criteria){
    List<T> forRemoval = Coll.Where(Criteria).ToList();

    foreach (T obj in forRemoval)
        Coll.Remove(obj);
} 
```

这会引发相同的异常；我不确定我是否真的理解为什么“Col”不再是被迭代的集合，那么为什么不能修改它呢？

如果有人对我如何让它发挥作用有任何建议，或者有更好的方法来实现这一点，那就太好了。

谢谢。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-03-17T10:00:34.787

对于`List<T>`，这已经存在，因为`RemoveAll(Predicate<T>)`。因此，我建议您保留名称（允许熟悉和优先）。

基本上，您不能在迭代时删除。有两种常见的选择：

*   使用基于索引器的迭代 ( `for`) 和删除
*   缓冲要删除的项目，并在之后删除`foreach`（正如您已经完成的那样）

所以也许：

```
public static void RemoveAll<T>(this IList<T> list, Func<T, bool> predicate) {
    for (int i = 0; i < list.Count; i++) {
        if (predicate(list[i])) {
            list.RemoveAt(i--);
        }
    }
} 
```

或更一般地，对于任何`ICollection<T>`：

```
public static void RemoveAll<T>(this ICollection<T> collection, Func<T, bool> predicate) {
    T element;

    for (int i = 0; i < collection.Count; i++) {
        element = collection.ElementAt(i);
        if (predicate(element)) {
            collection.Remove(element);
            i--;
        }
    }
} 
```

这种方法的优点是避免了列表的大量额外副本。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-17T10:03:39.693

正如 Marc 所说，`List<T>.RemoveAll()`这是获取列表的方法。

我很惊讶你的第二个版本没有工作，因为你在通话`ToList()`后接到了`Where()`电话。没有`ToList()`调用它肯定是有意义的（因为它会被懒惰地评估），但它应该没问题。您能否展示一个简短但完整的失败示例？

编辑：关于您在问题中的评论，我仍然无法让它失败。这是一个简短但*完整*的示例，它有效：

```
using System;
using System.Collections.Generic;
using System.Linq;

public class Staff
{
    public int StaffId;
}

public static class Extensions
{
    public static void RemoveWhere<T>(this ICollection<T> Coll,
                                      Func<T, bool> Criteria)
    {
        List<T> forRemoval = Coll.Where(Criteria).ToList();

        foreach (T obj in forRemoval)
        {
            Coll.Remove(obj);
        }
    }
}

class Test
{
    static void Main(string[] args)
    {
        List<Staff> mockStaff = new List<Staff>
        {
            new Staff { StaffId = 3 },
            new Staff { StaffId = 7 }
        };

       Staff newStaff = new Staff{StaffId = 5};
       mockStaff.Add(newStaff);
       mockStaff.RemoveWhere(s => s.StaffId == 5);

       Console.WriteLine(mockStaff.Count);
    }
} 
```

如果您可以提供一个类似的*完整*示例但失败了，我相信我们可以找出原因。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T10:02:35.623

我刚刚对其进行了测试，并且您的第二种方法可以正常工作（应该如此）。肯定有其他问题，您能否提供一些显示问题的示例代码？

```
List<int> ints = new List<int> { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };

ints.RemoveWhere(i => i > 5);
foreach (int i in ints)
{
    Console.WriteLine(i);
} 
```

获取：

```
1
2
3
4
5 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T10:04:03.357

我刚刚尝试了您的第二个示例，它似乎工作正常：

```
Collection<int> col = new Collection<int>() { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };
col.RemoveWhere(x => x % 2 != 0);

foreach (var x in col)
    Console.WriteLine(x);
Console.ReadLine(); 
```

我没有例外。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T14:22:35.733

Marcs RemoveAll 的另一个版本：

```
public static void RemoveAll<T>(this IList<T> list, Func<T, bool> predicate)
{
    int count = list.Count;
    for (int i = count-1; i > -1; i--)
    {
        if (predicate(list[i]))
        {
            list.RemoveAt(i);
        }
    }
} 
```

# gis - 如何使用 UMN 地图服务器在图层中获得透明背景？

> ID：653607
> 
> 赞同：2
> 
> 时间：2009-03-17T10:00:57.077
> 
> 标签：gis, mapserver, umn-mapserver, umn

我想在 mapclient 中包含不同的地图来源。一个来源是我为自己提供了一个由 UMN-mapserver 呈现的自写地图文件。问题是，UMN 将背景（没有特征的地方）渲染为白色，如果我在 mapclient 中结合它，这会将所有图层隐藏在后面。我在地图文件中写入什么，背景是透明的？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-25T08:39:20.373

同样在您的 MAP 对象中，您可以将 TRANSPARENT ON 和 IMAGECOLOR 设置为适合的内容

笔记：

图像颜色 [r] [g] [b]

用于初始化地图的颜色（即背景颜色）。当为 8 位伪彩色地图生成的典型情况启用透明度 (TRANSPARENT ON) 时，此颜色将在输出文件调色板中标记为透明。使用此颜色绘制的任何其他地图组件也将是透明的，因此对于具有透明度的地图生成，最好使用其他未使用的颜色作为背景颜色。

来自 [http://mapserver.org/mapfile/map.html](http://mapserver.org/mapfile/map.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T00:17:53.507

[在此页面](http://mapserver.org/mapfile/outputformat.html#outputformat)上的“透明”下查看。对 IMAGECOLOR 的引用位于[MAP 部分](http://mapserver.org/mapfile/map.html)。

# azman - 从 AuthorizationManager (AzMan) 检索任务列表时出现问题

> ID：653612
> 
> 赞同：3
> 
> 时间：2009-03-17T10:03:26.853
> 
> 标签：azman, authorizationmanager

我在我的一个应用程序中使用授权管理器，我的要求是将 AzMan 商店从一个位置复制到另一个位置。我的源位置是活动目录，目标是 xml，我有这两个路径。

当我创建一个 AzMan 存储并使用源链接进行初始化以获取对象句柄时，源存储应用程序中的任务数似乎包括 Tasks + Roles。任何人都可以指出这是AzMan中的错误还是我犯了一些错误。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-07-27T19:53:18.703

角色定义（如在 AzMan GUI 中看到的，而不是 API）实际上是一种任务定义。您可以通过检查 IAzTask.IsRoleDefinition 属性来区分它们。

IAzRole 用于角色分配，如 AzMan API 中所示。

# wpf - 在 WPF 中，动态加载的元素如何访问其父元素？

> ID：653614
> 
> 赞同：1
> 
> 时间：2009-03-17T10:03:41.987
> 
> 标签：wpf, xaml, dependency-injection, inversion-of-control

在**Window1.xaml**我有菜单和显示区域：

```
<Menu x:Name="TheMenu" Width="Auto" Height="25" DockPanel.Dock="Top"/>
<ItemsControl x:Name="MainContent" DockPanel.Dock="Top"/> 
```

在**Window1.xaml.cs**我动态加载一个菜单项：

```
MenuItem menuItemEmployees = new MenuItemEmployees(this);
TheMenu.Items.Add(menuItemEmployees); 
```

在**MenuItemEmployees.xaml.cs**我注入 Window1 但我如何访问它的元素？

```
using System.Windows.Controls;
using System.Windows;

namespace TestContainer1
{
    public partial class MenuItemEmployees : MenuItem
    {
        public MenuItemEmployees(Window1 window1)
        {
            InitializeComponent();
        }

        private void Create_Employee(object sender, System.Windows.RoutedEventArgs e)
        {
            TextBlock textBlock = new TextBlock();
            textBlock.Text = "New Customer";

            //how can I access my ItemsControl element in "Window1" here?
            //pseudo code:
            Window1.Children["MainContent"].Add(textBlock);
        }
    }
} 
```

## 回答：

好的，我想通了，这只是一个疏忽，我忘了为 window1 创建一个内部变量。但我将把这段代码留在这里，可能很有趣，很容易将主窗口向下传递到控件中，以便动态添加的控件可以访问窗口上的其他元素，这是一种没有接口的穷人依赖注入：

```
using System.Windows.Controls;
using System.Windows;

namespace TestContainer1
{
    public partial class MenuItemEmployees : MenuItem
    {
        private Window1 _window1;

        public MenuItemEmployees(Window1 window1)
        {
            InitializeComponent();
            _window1 = window1;
        }

        private void Create_Employee(object sender, System.Windows.RoutedEventArgs e)
        {
            TextBlock textBlock = new TextBlock();
            textBlock.Text = "New Customer";

            _window1.MainContent.Items.Add(textBlock);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T10:10:07.133

尝试这样的事情

```
Menu yourMenu = ItemContainerGenerator.ContainerFromItem(this) as Menu;
Window yourWindow = Menu.Parent as Window; 
```

`ContainerFromItem`是一种静态方法，可以满足您的需求，请参阅[此处](http://msdn.microsoft.com/en-us/library/system.windows.controls.itemcontainergenerator.containerfromitem.aspx)的 Microsoft 简介。

# sql-server - 通过在 group by 子句中使用的字段设置索引来提高性能？

> ID：653632
> 
> 赞同：1
> 
> 时间：2009-03-17T10:11:20.093
> 
> 标签：sql-server, database, performance, database-design, indexing

我创建了一个包含许多连接的视图。我想按我选择的一些字段对结果集进行分组。

在这些字段上设置索引是否会提高查询的性能？我正在使用 MS SQL Server，但对于所有 dbs，它应该几乎相同，不是吗？

```
SELECT table1.field1, table1.field2, table2.field1
FROM table1
INNER JOIN table2 ON table1.primkey = table2.tablekey
GROUP BY table1.field1, table1.field2, table2.field1 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T10:25:24.537

如果您在打开“显示执行计划”的情况下运行查询，您可以要求 MS SQL 服务器建议索引。它将通过在它认为有问题的列上创建一个假设索引并将其与您的查询进行比较来向您指示潜在的优化索引。

# internationalization - 为什么有些国家用点作为小数分隔符而有些国家用逗号？

> ID：653634
> 
> 赞同：1
> 
> 时间：2009-03-17T10:11:58.190
> 
> 标签：internationalization, nlp

为什么在某些国家/地区有逗号分隔符而在某些点中？你知道这是什么原因吗？每次检查是否应该使用这个或这个非常烦人。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-17T10:15:13.643

我建议阅读有关小数分隔符历史的[维基百科条目](http://en.wikipedia.org/wiki/Decimal_separator#History)。基本上，它归结为在排版以前手写的内容时做出的不同选择。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-17T10:15:11.520

这就是文化发生的方式。说真的，与其他文化问题（时区、年表、从左到右与从右到左以及日期格式）相比，这是一个相对容易的问题......

如果我们围绕让开发人员的生活变得理智的东西来构建我们的世界，生活肯定会更轻松：

*   没有精神错乱的一次性系统（太多问题无法提及）
*   一种货币
*   一种书写数字、日期等的方法
*   一种测量系统
*   一个相对较小的字符集（适合单个字节会很方便）
*   一种写作模式
*   一种语言

另一方面，我认为这样我们会错过很多*丰富*的生活……

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-17T10:18:36.740

所以不要。System.Globalization 是您的朋友，请使用[NumberDecimalSeparator](http://msdn.microsoft.com/en-us/library/system.globalization.numberformatinfo.numberdecimalseparator.aspx)属性。这只是国际化的另一个方面，与翻译字符串或其他任何内容相同。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-17T10:17:41.560

出于同样的原因，我们有不同的语言、日期格式，而且美国拒绝使用公制，恐怕。

我住在瑞典，出于某种原因，默认分隔符是逗号——我认为这完全是愚蠢的。:-( 另一方面，我们使用日期格式 yyyy-mm-dd，这是表示日期的逻辑方式，因为它是位置的，因此在排序时将直接进行字符串比较！:-)

# c# - 在 C# windows 窗体上处理多个按键事件

> ID：653636
> 
> 赞同：1
> 
> 时间：2009-03-17T10:13:24.847
> 
> 标签：c#, winforms, keyboard

有没有办法处理 C# windows 窗体上的多个按键事件，比如`Ctrl`+ `E`？

这是我的代码：

```
private void frmDataEntry_KeyDown(object sender, KeyEventArgs e)  
{  
   if (Control.ModifierKeys == Keys.Control && e.KeyCode == Keys.E)
   {  
          //Code  
   }              
} 
```

这种情况总是错误的..为什么？我按`Ctrl`+`E`并且 e.KeyCode 为假而 Control.ModifierKeys 为真？我究竟做错了什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T10:16:25.043

它应该是：

```
if (e.Modifiers == Keys.Control && e.KeyCode == Keys.E) {
    //Code
} 
```

Control.ModifierKeys 用于`onClick`事件等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T10:20:12.007

我认为你正在寻找的条件是

```
if (e.Control && e.KeyCode == Keys.E)
{
    // code
} 
```

# java - 重置 JButton 标签数组并使所有标签再次处于活动状态

> ID：653665
> 
> 赞同：0
> 
> 时间：2009-03-17T10:23:29.223
> 
> 标签：java, jbutton

当我玩我的游戏时，我允许用户单击按钮，然后将 ao 或 x 设置为标签，然后每个按钮都处于活动状态，以不允许用户一次又一次地单击它

然而，当我到 9 点时，它是一个平局，弹出一个消息框并说平局，但我似乎无法让按钮恢复到原始状态以允许新一轮

你有什么建议

编辑：

我不知道为什么我没有创建一个循环来做这个干杯伙计们我会试试这个

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T10:29:30.987

当您没有向我们展示任何代码时，这当然很难，您尝试了什么不起作用？

我认为一个普通的旧循环应该可以解决问题。

```
JButton buttons[];

for(JButton b : buttons)
{
  b.setText("");
  b.setEnabled(true);
} 
```

我希望这是正确的循环语法，自从我使用 Java 以来已经有一段时间了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T10:29:15.480

[按钮](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/JButton.html)。[setText("")](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/AbstractButton.html#setText(java.lang.String)) , [JComponent](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/JComponent.html)。[设置启用（真）](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/JComponent.html#setEnabled(boolean))。

# javascript - 进行xml转换时如何指向目标html？

> ID：653670
> 
> 赞同：0
> 
> 时间：2009-03-17T10:27:34.953
> 
> 标签：javascript, html, xslt

我想通过 xsl 从 xml 生成树视图。在输出 html 中，有 2 个框架：treeframe 用于树视图，而 contentframe 用于在我单击树时显示节点的内容。

我写了一个tree.xsl来从xml生成树，一个result.html，它构造框架集并具有js函数，populateFrames()自动进行转换并输出到treeframe中。

我还写了一个 content.xsl 文件来提取每个指定节点的内容，以及一个 content.js 文件，它的功能是 displayContent 来做 content.xsl 对 xml 的转换。

然后在tree.xsl中，在onclick事件中，我调用displayContent函数。

我的问题就在这里。我不知道如何将目标设置为内容框架。我可以在 tree.xsl 中执行此操作，还是在 content.js 中执行此操作会更好，或者有其他解决方案。

谢谢您的帮助。

艾伦

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T10:38:00.170

将 displayContent 函数放在包含页面的代​​码中，而不是放在树框架的 HTML 中。让节点调用 top.displayContent。现在 displayContent 可以用它需要显示的 URL 来指示内容框架。

或者，使用 XSL 中的锚点并指定目标属性以指向内容框架。

# syntax - C# 3.0 自动属性 - 有什么区别？

> ID：653674
> 
> 赞同：0
> 
> 时间：2009-03-17T10:29:29.520
> 
> 标签：syntax, c#-3.0

0 以下有什么区别？

```
public class MyClass
{
    public bool MyProperty;
}

public class MyClass
{
    public bool MyProperty { get; set; }
} 
```

它只是语义吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T10:35:12.953

除了语义之外，字段和属性还有许多不同之处。

1.  可以覆盖属性以在后代中提供不同的实现。
2.  属性可以帮助缓解版本控制问题。即，将字段更改为库中的属性需要重新编译依赖于该库的任何内容。
3.  属性对于 getter 和 setter 可以有不同的可访问性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T10:32:42.383

“只是语义”在我看来总是矛盾的。是的，它改变了代码的含义。不，这不是我会用“只是”这个词来形容的事情。

第一类有一个公共领域。第二类有一个公共属性，由一个私有字段支持。它们不是一回事：

*   如果您稍后更改该属性的实现，您将保持二进制兼容性。如果将字段更改为属性，则会失去二进制*和*源代码兼容性。
*   数据绑定看不到字段；属性是
*   字段访问不能在托管代码中设置断点（AFAIK）
*   暴露一个字段会暴露你的类型的*实现*——暴露一个属性只是谈论你的类型的*契约*。

有关这方面的更多详细信息，请参阅[我关于属性的优点的文章。](http://csharpindepth.com/Articles/Chapter8/PropertiesMatter.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T10:34:20.007

在那种情况下，是的，它主要是语义。它对反射等有影响。

但是，如果您想进行更改，以便在设置 MyProperty 时触发一个事件，例如，您可以轻松地修改后者来做到这一点。前者你不能。您也可以在界面中指定后者。

由于沿着房产路线走的差异很小，但有几个潜在的优势，我认为您应该始终沿着房产路线走。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T10:33:47.560

第一个只是一个公共字段，第二个是所谓的自动属性。C# 编译器将自动属性更改为具有支持字段的常规属性。

公共字段和属性在 C# 语法中是相同的，但在 IL 中它们是不同的（最近在德国论坛上阅读此内容，无法提供源代码，抱歉）。

马蒂亚斯

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T10:39:05.770

最大的不同是你可以给属性添加访问修饰符，例如像这样

```
public class MyClass
{
    public bool MyProperty { get; protected set; }
} 
```

对 CLR 字段和属性的访问也不同。因此，如果您有一个字段并且您想稍后将其更改为属性（例如，当您想向 setter 添加代码时）接口将发生变化，您将需要重新编译访问该字段的所有代码。使用 Autoproperty，您就没有这个问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T11:30:22.057

**我假设您没有编写将由 3rd 方开发人员调用的代码，这些开发人员在您更改代码时无法重新编译他们的代码。** （例如，您不为 Microsoft 编写自己的 .Net 框架，或 DevExpress 编写控制工具包）。请记住，Microsoft 的 .NET 框架编码标准适用于编写框架的人员，并试图避免很多问题，如果您不编写供第三方开发人员使用的框架，这些问题甚至都不是问题。

第二种情况定义了适当性，这样做的唯一真正好处是数据绑定不适用于字段。然而，使用专有技术有一个很大的政治优势，你从其他开发人员那里得到的无效投诉要少得多。

目前，您对专有性的所有其他优势（在您的问题的其他答案中有很好的解释）不感兴趣，因为任何使用您的代码的程序员都可以稍后根据需要将该字段更改为专有性，然后重新编译您的解决方案.

但是，您不太可能因使用礼节而被堆积，因此您也总是使用公共礼节而不是领域。

# java - 如何覆盖 PropertyResourceBundle 中的一些资源

> ID：653682
> 
> 赞同：4
> 
> 时间：2009-03-17T10:33:17.797
> 
> 标签：java, resourcebundle

我有一个现有的 Java/JSF 网站，屏幕上的所有文本都来自属性文件，通过 <f:loadBundle basename="org.example.applicaltion" var="applicaltion" /> 从 applicaltion.properties 中提取文本。

对于这些的运行时可配置子集，我想从其他地方（通过 Web 服务的 CMS）提取字符串。查看 ResourceBundle 类，它似乎有一个基础设施，用于与此类似的东西，并委托给父 ResourceBundle。

我想要这样的东西

```
public class Applicaltion extends ResourceBundle{
    @Override
protected Object handleGetObject(String key) {
    if(overridenKey(key)){
        return overridedValue(key);
    }
    return null; // ResourceBundle.getObject will delegate to parent 
             // if we return null
}
} 
```

我已经尝试过了，并且 parent 为空，我认为这更多地用于默认 -> en -> en_GB 的情况。

我正在考虑一个不太吸引人的选项，即让属性文件与自定义 resourceBundle 的名称不同，然后从 CustomResourceBundle.handleGetObject(key) 中委托 ResourceBundle.getBundle(PROPERTY_FILE_NAME).getString(key) 的完整堆栈。

有更好的想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T09:41:09.810

我最终通过检查我们是否有一个覆盖值来解决这个问题，如果我们确实返回了它，否则委托给标准资源包

```
public class UILabels extends ResourceBundle {

private ResourceBundle getFileResources(){
    return ResourceBundle.getBundle("com.example.web.UILabelsFile", this.getLocale());
}

public Enumeration<String> getKeys() {
    return getFileResources().getKeys();
}

protected Object handleGetObject(String key) {
    if(overrideValue(key)){
        return getOverridenValue(key);
    }
    return getFileResources().getObject(key);
}

} 
```

请注意，名称类的细微差别是 UILabels，这是所有客户端将使用的文件是 UILabelsFile，因此 ResourceBundle 加载器不会递归。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T10:59:06.173

您可以编写一个自定义的 PropertyResolver，然后让它执行从何处提取属性值的逻辑。

例如，您可以定义一个名为的 bean`messageSource`并加载 application.properties，加上您的 CMS 属性或您拥有的任何东西。

然后编写一个自定义`PropertyResolver`（这里有一个如何使用 Spring 的 MessageSource 执行此操作的示例[）](http://www.jroller.com/RickHigh/entry/spring_jsf_contribution_round_1)并将其链接到您的`faces-config.xml`使用如下所示的内容：

```
<application>  
<property-resolver>  
      com.package.MessageSourcePropertyResolver  
   </property-resolver>  
</application> 
```

# c# - MVC 扩展方法

> ID：653687
> 
> 赞同：0
> 
> 时间：2009-03-17T10:36:25.447
> 
> 标签：c#, model-view-controller, selectlist

我正在尝试编写一个简单的扩展方法，该方法允许我通过文本而不是值来选择 MVC SelectList 中的项目。

这就是我想出的，但是尽管在调试时将该项目设置为选中，但返回的 SelectList 的所有项目都带有 selected = false。

有任何想法吗？

```
 public static SelectList SelectByText(this SelectList list, string TextValue)
        {
            foreach (var item in list)
            {
                if (item.Text == TextValue)
                {
                    item.Selected = true;
                }
            }
            return list;
        } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-14T06:29:04.483

尝试在他的文本上选择项目而不是值是不明智的

无论如何，您似乎有不止一项满足您的 if 语句

为确保只选择一项，您可以在满足以下条件时休息一下：

```
if(item.Text == TextValue)
{
  item.Selected = true;
  break;
} 
```

干杯

# apache - 使用 apache 位置指令列出来自 trac 的文件夹

> ID：653694
> 
> 赞同：0
> 
> 时间：2009-03-17T10:38:27.020
> 
> 标签：apache, installation, location, trac

我有以下目录结构：

```
--var
----trac
------company1
--------project1
--------project2
------company2
--------project3
--------project4 
```

我想知道当我转到 domain.com/trac 时是否有办法在 httpd.conf 中指定列出目录。目前我写道：

```
<Location /trac>
    Options Indexes
</Location> 
```

但我不知道如何将文档根指定到 /var/trac。我试着做

```
PythonOption TracEnvParentDir "/var/trac"
PythonOption TracUriRoot "/trac 
```

但我收到错误 500，我相信这是因为 /var/trac 中的文件夹不是 trac 环境。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T11:21:07.773

我想你是正确的。您需要找到一种方法，让 Apache 在没有 Python 和 trac 帮助的情况下处理对“/”的请求。

给你建议有点困难，因为我不知道你的 httpd.conf 现在是什么样子，但是我的 trac-setup 使用`<LocationMatch>`指令来捕获不应该由 trac 处理的所有内容，以便 Apache 可以处理它。

所以你可以做这样的事情：

```
<LocationMatch "^/trac/.+">
    # Your trac directives here
    PythonHandler trac.web.modpython_frontend
    ....
</Location>

Alias /trac "/var/trac"
<Directory "/var/trac">
    Options Indexes
    Order allow,deny
    Allow from all
</Directory> 
```

# dll - 将函数指针作为参数传递给 dll 函数并从 dll 内部调用它们是否安全？

> ID：653697
> 
> 赞同：6
> 
> 时间：2009-03-17T10:39:29.420
> 
> 标签：dll, memory-management, function-pointers

我想将一些（dll 与否）函数指针作为参数传递给某些 dll 函数，并从 dll 内部调用它们。我想知道它是否安全，因为我在[http://publib.boulder.ibm.com/infocenter/zos/v1r10/index.jsp?topic=/com.ibm.zos.r10.cbcpx01/fpref 上找到了信息。 htm](http://publib.boulder.ibm.com/infocenter/zos/v1r10/index.jsp?topic=/com.ibm.zos.r10.cbcpx01/fpref.htm)那：

*在 DLL 代码中，假定函数指针指向函数描述符。函数指针调用首先通过解引用指针获得函数地址；然后，分支到函数入口。当非 DLL 函数指针传递给 DLL 代码时，它直接指向函数入口。尝试通过此类指针取消引用会产生未定义的函数地址。随后分支到未定义地址可能会导致异常。*

此规则是否也适用于 Visual Studio 和其他编译器？

我真正想做的是解决各种dll和非dll函数之间的内存分配和释放问题。我的想法是在一些初始化（例如 Initialize(&malloc, &free)）中将两个函数指针（用于常见的分配和释放函数）传递给每个 dll，然后使用这些常见且始终兼容的函数进行所有内存管理。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T10:44:42.073

这不是真的。DLL 代码以与非 DLL 代码完全相同的方式处理函数指针。如果不是这种情况，就不能在 DLL 中使用标准库函数，如 qsort()（它需要一个函数指针参数）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T11:03:02.717

将函数指针传递给 DLL 已经进行了几代人。

GUI 编程中使用的所有回调函数（例如进度条更新）都使用函数指针。

使用 WIN32 进行开发时，是否有理由要使用指向 malloc/free 的函数指针？为什么不直接使用 malloc/free？

这就是我过去一直这样做的方式。并不是说这保证它是正确的方法。
事实上，你可能会认为这是最糟糕的方式:)

# c# - OOGenerics 设计注意事项

> ID：653698
> 
> 赞同：2
> 
> 时间：2009-03-17T10:39:35.470
> 
> 标签：c#, generics, oop

这是我试图找到合适设计的情况。

我需要存储数字配置文件。配置文件只是一系列数字。它们可以是 int、float 或 decimal 类型。每个配置文件都有一个基于枚举的 ProfileDescription 字段。

每个 Profile 都有一个 ProfileVersion 对象的集合。每个 ProfileVersion 对象都有一个 ProfileValue 对象的集合。这些 ProfileValue 对象是存储所需类型的实际数值的地方。

我最初的设计想法是让 Profile、ProfileVersion 和 ProfileValue 通用。当我想要一个不同类型的配置文件列表时，我遇到了一个问题，而我没有。我可以使用 ArrayList 代替，但是我将不得不丢弃其中的数据。

我虽然可以只使 ProfileVersion 和 ProfileValue 通用，然后让 Profile 对象根据 ProfileDescription 字段的值为 ProfileVersion 分配一个类型，但我找不到这样做的方法。

另一个想法是我应该使用 ProfileBase 类，然后使用 GenericProfileClass 或 IntProfile、FloatProfile 和 DecimalProfile 对其进行子类化，但这并不会真正给我任何让每个类都是通用类的优势，因为我必须抛弃子类反正每次。

对于这种情况下的最佳设计方法，我将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T10:52:51.617

Grzenio 的想法是正确的。您的每个配置文件类都可以成为`IProfile`对象的实现，然后您的容器可以是：

```
class ProfileList : IList<T> where T: IProfile 
```

因此，您将拥有的唯一约束是接口，而不是特定类型或强制转换的基类。

至于：

> 另一个想法是我应该使用 ProfileBase 类，然后使用 GenericProfileClass 或 IntProfile、FloatProfile 和 DecimalProfile 对其进行子类化，但这并不会真正给我任何让每个类都是通用类的优势，因为我必须抛弃子类反正每次。

好处实际上取决于您为类所做的抽象级别。如果设计得当，理想情况下，您可以拥有可以接受任何这些基本类型（再次通过泛型）的操作/业务逻辑/或管理器类，而无需知道具体的演员表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T10:43:27.927

我不确定我是否正确理解了您的问题（粘贴不起作用的代码会有所帮助），但我认为您可以尝试创建接口`IProfile`等`IProfileVersion`并使泛型类继承接口`Profile<T>:IProfile`。

无论如何，您要做的事情并不容易，因为遗憾的是，C# 中没有基本的数字类型。

# c# - 在 c# 中使用正则表达式突出显示单词列表

> ID：653700
> 
> 赞同：4
> 
> 时间：2009-03-17T10:40:07.920
> 
> 标签：c#, regex

我有一些包含缩写的网站内容。我有一个该网站公认的缩写列表，以及它们的解释。我想创建一个正则表达式，它允许我用一些标记替换在内容中找到的所有可识别的缩写。

例如：

内容：

```
这只是对成员的一个小测试，看看它是否被拾取。
当然，Deb 也应该被抓到这里。
```

缩写：

```
会员=会员；deb = 首次亮相；
```

结果：

```
这只是对 [a title="Member"]memb[/a] 的一个小测试，看看它是否被拾取。
[a title="Debut"]Deb[/a] 当然也应该在这里捕获。
```

（为简单起见，这只是示例标记）。

谢谢。

编辑：

CraigD 的答案几乎就在那里，但存在一些问题。我只想匹配整个单词。我还想保留每个替换单词的正确大小写，以便 deb 仍然是 deb，并且根据原文，Deb 仍然是 Deb。例如，这个输入：

```
这只是对成员的一个小测试。
还有另一个成员，但不是阿姆巴。
Deb 当然也应该在这里抓到。deb！

```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-17T10:53:42.693

首先，您需要[`Regex.Escape()`](http://msdn.microsoft.com/en-us/library/system.text.regularexpressions.regex.escape.aspx)所有输入字符串。

然后您可以在字符串中查找它们，并用您想到的标记迭代地替换它们：

```
string abbr      = "memb";
string word      = "Member";
string pattern   = String.Format("\b{0}\b", Regex.Escape(abbr));
string substitue = String.Format("[a title=\"{0}\"]{1}[/a]", word, abbr);
string output    = Regex.Replace(input, pattern, substitue); 
```

编辑：我问一个简单的[`String.Replace()`](http://msdn.microsoft.com/en-us/library/system.string.replace.aspx)是否不够 - 但我可以看到为什么正则表达式是可取的：您只能通过制作使用单词边界锚点的模式来使用它来强制“整个单词”替换。

您可以从所有转义的输入字符串中构建单个模式，如下所示：

```
\b(?:{abbr_1}|{abbr_2}|{abbr_3}|{abbr_n})\b 
```

然后使用[匹配评估器](http://msdn.microsoft.com/en-us/library/cft8645c.aspx)找到正确的替代品。这样，您可以避免多次迭代输入字符串。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T11:01:30.647

不确定这将如何扩展到一个大单词列表，但我认为它应该提供您想要的输出（尽管在您的问题中，“结果”似乎与“内容”相同）？

无论如何，让我知道这是否是你所追求的

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.RegularExpressions;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            var input = @"This is just a little test of the memb to see if it gets picked up. 
Deb of course should also be caught here.";
            var dictionary = new Dictionary<string,string>
            {
                {"memb", "Member"}
                ,{"deb","Debut"}
            };
            var regex = "(" + String.Join(")|(", dictionary.Keys.ToArray()) + ")";
            foreach (Match metamatch in Regex.Matches(input
               , regex  /*@"(memb)|(deb)"*/
               , RegexOptions.IgnoreCase | RegexOptions.ExplicitCapture))
            { 
                input = input.Replace(metamatch.Value, dictionary[metamatch.Value.ToLower()]);
            }
            Console.Write (input);
            Console.ReadLine();
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T13:53:45.287

对于任何感兴趣的人，这是我的最终解决方案。它适用于 .NET 用户控件。正如 Tomalak 所建议的，它使用带有匹配评估器的单个模式，因此没有 foreach 循环。这是一个优雅的解决方案，它为我提供了样本输入的正确输出，同时为匹配的字符串保留了正确的大小写。

```
public partial class Abbreviations : System.Web.UI.UserControl
{
    private Dictionary<String, String> dictionary = DataHelper.GetAbbreviations();

    protected void Page_Load(object sender, EventArgs e)
    {
        string input = "This is just a little test of the memb. And another memb, but not amemba to see if it gets picked up. Deb of course should also be caught here.deb!";

        var regex = "\\b(?:" + String.Join("|", dictionary.Keys.ToArray()) + ")\\b";

        MatchEvaluator myEvaluator = new MatchEvaluator(GetExplanationMarkup);

        input = Regex.Replace(input, regex, myEvaluator, RegexOptions.IgnoreCase);

        litContent.Text = input;
    }

    private string GetExplanationMarkup(Match m)
    {
        return string.Format("<b title='{0}'>{1}</b>", dictionary[m.Value.ToLower()], m.Value);
    }
} 
```

输出看起来像这样（下图）。请注意，它只匹配完整的单词，并且从原始字符串中保留了大小写：

```
This is just a little test of the <b title='Member'>memb</b>. And another <b title='Member'>memb</b>, but not amemba to see if it gets picked up. <b title='Debut'>Deb</b> of course should also be caught here.<b title='Debut'>deb</b>! 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T10:59:52.397

我怀疑它会比仅仅执行普通的 string.replace 表现更好，所以如果性能是关键衡量标准（重构一点以使用编译的正则表达式）。您可以将正则表达式版本执行为：

```
var abbrsWithPipes = "(abbr1|abbr2)";
var regex = new Regex(abbrsWithPipes);
return regex.Replace(html, m => GetReplaceForAbbr(m.Value)); 
```

您需要实现 GetReplaceForAbbr，它接收正在匹配的特定 abbr。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T13:33:12.107

我正在做的正是你在我的应用程序中寻找的东西，这对我有用：参数 str 是你的内容：

```
public static string GetGlossaryString(string str)
        {
            List<string> glossaryWords = GetGlossaryItems();//this collection would contain your abbreviations; you could just make it a Dictionary so you can have the abbreviation-full term pairs and use them in the loop below 

            str = string.Format(" {0} ", str);//quick and dirty way to also search the first and last word in the content.

            foreach (string word in glossaryWords)
                str = Regex.Replace(str, "([\\W])(" + word + ")([\\W])", "$1<span class='glossaryItem'>$2</span>$3", RegexOptions.IgnoreCase);

            return str.Trim();
        } 
```

# jquery - jQuery：对对象数组执行操作？

> ID：653701
> 
> 赞同：2
> 
> 时间：2009-03-17T10:40:24.923
> 
> 标签：jquery

我有 4 个 jQuery 对象（即通过 构造的东西`$("ObjectID")`），我想以优雅的方式对所有对象执行相同的操作。我原以为这样的事情会起作用，但似乎没有：

```
$([obj1, obj2, obj3, obj4]).change(function() { otherObj.show(); });
$([obj1, obj2, obj3, obj4]).attr("disabled", "disabled"); 
```

有没有一个好的语法？这似乎是一个有点盲目的疏忽。目前我看到的最好的是

```
$([obj1, obj2, obj3, obj4]).each(
    function() { this.change(function() { otherObj.show(); })); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T10:44:26.257

你的意思是你有：

```
var obj1 = $("...");
var obj2 = $("...");
var obj3 = $("...");
var obj4 = $("..."); 
```

?

如果是这样，您可以将它们变成一个集合：

```
var complete = obj1.add(obj2).add(obj3).add(obj4); 
```

然后只需使用最后一组：

```
complete.change(function() {
  otherObj.show();
}).attr("disabled", true); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T10:43:36.757

在创建对象时尝试将类附加到对象并执行

```
$(".class")
    .change(function(){otherObj.show();})
    .attr("disabled","disabled"); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T10:49:56.493

这将适用于 id：

```
$("#obj1,#obj2,#obj3,#obj4") 
```

它也适用于任何选择器。您可以在逗号分隔列表中组合任何内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T10:52:25.987

使用[each](http://docs.jquery.com/Core/each)命令当然是解决它的一种方法，但是还有其他方法。

您可以[剥离 jQuery 对象以获取一个数组](http://www.learningjquery.com/2008/12/peeling-away-the-jquery-wrapper-and-finding-an-array)，对数组执行您需要执行的任何操作，然后将其包装回 jQuery 对象。

还有一些[带有数组方法和枚举的插件](http://www.learningjquery.com/2009/02/implementing-prototypes-array-methods-in-jquery)，允许您操作数组和 jQuery 对象。

# sql-server - 向 MSSQL 表添加自动版本信息的最简单方法是什么？

> ID：653706
> 
> 赞同：0
> 
> 时间：2009-03-17T10:42:44.917
> 
> 标签：sql-server, versioning

该信息应该是 2 个日期时间列（插入/更新），精度为毫秒，并且应该在有人插入或更新一行时由服务器自动更新。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T10:52:25.737

在表格中添加列

```
ALTER TABLE yourTable ADD
    Inserted datetime NULL,
    Updated datetime NULL
GO 
```

创建更新和插入触发器以更新列

```
CREATE TRIGGER yourTableInsertTrigger 
   ON  yourTable
   AFTER INSERT
AS 
BEGIN
    Update yourTable Set Inserted = getdate()
    from Inserted 
    Where yourTable.Key = Inserted.Key
END
GO

CREATE TRIGGER yourTableUpdateTrigger 
   ON  yourTable
   AFTER UPDATE AS 
BEGIN
    Update yourTable Set Updated = getdate()
    from Updated
    Where yourTable.Key = Updated.Key
END
GO 
```

现在，如果您想要真正干净，您将确保这两个列不能通过使用视图而不是直接表访问来更改/更新，以便您对数据进行其他访问。此外，如果您的主键不一致，并且您有很多表，我建议您使用 CodeGeneration 来创建 sql。[MyGeneration](http://www.mygenerationsoftware.com)会做得很好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-23T20:57:46.153

我认为插入的触发器已过时。只需将 getdate() 作为默认值而不是 null 添加到插入的列中。

# c# - Visual Studio Addin - 将命令添加到文件->新菜单

> ID：653708
> 
> 赞同：0
> 
> 时间：2009-03-17T10:43:35.697
> 
> 标签：c#, visual-studio, visual-studio-addins

我在工具菜单中有一个菜单项，但它需要进入文件->新菜单，但是即使在预生成的 Visual Studio 代码中将“工具”更改为“文件”也不会产生预期的结果！！！ ?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T11:00:25.047

您还需要更改 eventlistner 代码。检查代码顶部的自动生成的代码段。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T11:01:00.130

以下代码（不是防弹的！）在 Addin OnConnection 方法中对我来说很好：

```
_applicationObject = (DTE2)application;
_addInInstance = (AddIn)addInInst;
if (connectMode == ext_ConnectMode.ext_cm_UISetup)
{
    object[] contextGUIDS = new object[] { };
    Commands2 commands = (Commands2)_applicationObject.Commands;

    CommandBars commandBars = (CommandBars)_applicationObject.CommandBars;
    CommandBar menuBarCommandBar = commandBars["MenuBar"];

    CommandBarPopup filePopup = menuBarCommandBar.Controls["File"] as CommandBarPopup;
    CommandBarPopup newPopup = filePopup.CommandBar.Controls["New"] as CommandBarPopup;

    Command command = commands.AddNamedCommand2(_addInInstance, "MyAddin1", "MyAddin1", 
        "Executes the command for MyAddin1", true, 59, ref contextGUIDS, 
        (int)(vsCommandStatus.vsCommandStatusSupported | vsCommandStatus.vsCommandStatusEnabled),
        (int)vsCommandStyle.vsCommandStylePictAndText, vsCommandControlType.vsCommandControlTypeButton);

    if (command != null && newPopup != null)
    {
        command.AddControl(newPopup.CommandBar, 1);
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T12:08:34.133

您是否尝试过在命令行运行 devenv.exe /resetaddin Your.AddIn.Name（例如 devenv.exe /resetaddin MyAddin1.Connect）？

# sql - 将存储过程的结果插入临时表

> ID：653714
> 
> 赞同：1729
> 
> 时间：2009-03-17T10:45:26.080
> 
> 标签：sql, sql-server, sql-server-2005, tsql, stored-procedures

我该怎么做`SELECT * INTO [temp table] FROM [stored procedure]`？没有`FROM [Table]`和没有定义`[temp table]`？

`Select``BusinessLine`into的所有数据都`tmpBusLine`可以正常工作。

```
select *
into tmpBusLine
from BusinessLine 
```

我正在尝试相同的方法，但是使用`stored procedure`返回数据的 a 并不完全相同。

```
select *
into tmpBusLine
from
exec getBusinessLineHistory '16 Mar 2009' 
```

**输出消息：**

> 消息 156，级别 15，状态 1，第 2 行关键字“exec”附近的语法不正确。

我已经阅读了几个创建与输出存储过程具有相同结构的临时表的示例，它工作正常，但最好不提供任何列。

* * *

## 回答 #1

> 赞同：745
> 
> 时间：2009-08-04T15:27:34.140

您可以为此使用[OPENROWSET 。](http://msdn.microsoft.com/en-us/library/ms190312%28v=sql.100%29.aspx)看一看。我还包含了 sp_configure 代码以启用 Ad Hoc 分布式查询，以防它尚未启用。

```
CREATE PROC getBusinessLineHistory
AS
BEGIN
    SELECT * FROM sys.databases
END
GO

sp_configure 'Show Advanced Options', 1
GO
RECONFIGURE
GO
sp_configure 'Ad Hoc Distributed Queries', 1
GO
RECONFIGURE
GO

SELECT * INTO #MyTempTable FROM OPENROWSET('SQLNCLI', 'Server=(local)\SQL2008;Trusted_Connection=yes;',
     'EXEC getBusinessLineHistory')

SELECT * FROM #MyTempTable 
```

* * *

## 回答 #2

> 赞同：697
> 
> 时间：2009-03-17T14:08:11.117

如果您想在不首先声明临时表的情况下执行此操作，则可以尝试创建用户定义函数而不是[存储过程](http://en.wikipedia.org/wiki/Stored_procedure)，并使该用户定义函数返回一个表。或者，如果您想使用存储过程，请尝试以下操作：

```
CREATE TABLE #tmpBus
(
   COL1 INT,
   COL2 INT
)

INSERT INTO #tmpBus
Exec SpGetRecords 'Params' 
```

* * *

## 回答 #3

> 赞同：311
> 
> 时间：2009-03-17T10:50:17.240

在 SQL Server 2005 中，您可以使用`INSERT INTO ... EXEC`将存储过程的结果插入到表中。来自[MSDN 的`INSERT`文档](http://msdn.microsoft.com/en-us/library/aa933206(SQL.80).aspx)（实际上是针对 SQL Server 2000）：

```
--INSERT...EXECUTE procedure example
INSERT author_sales EXECUTE get_author_sales 
```

* * *

## 回答 #4

> 赞同：201
> 
> 时间：2009-08-04T17:11:38.113

这是对您问题的略微修改版本的答案。如果您可以放弃对用户定义函数使用存储过程，则可以使用内联表值用户定义函数。这本质上是一个存储过程（将接受参数），它返回一个表作为结果集；因此可以很好地放置一个 INTO 语句。

这是一篇关于它和其他用户定义函数的[快速文章。](http://www.sqlteam.com/article/user-defined-functions)如果您仍然需要存储过程，则可以使用存储过程包装内联表值用户定义函数。存储过程仅在从内联表值用户定义函数调用 select * 时传递参数。

因此，例如，您将有一个内联表值用户定义函数来获取特定区域的客户列表：

```
CREATE FUNCTION CustomersByRegion 
(  
    @RegionID int  
)
RETURNS TABLE 
AS
RETURN 
  SELECT *
  FROM customers
  WHERE RegionID = @RegionID
GO 
```

然后你可以调用这个函数来得到你的结果：

```
SELECT * FROM CustomersbyRegion(1) 
```

或者做一个SELECT INTO：

```
SELECT * INTO CustList FROM CustomersbyRegion(1) 
```

如果您仍然需要存储过程，则将函数包装为：

```
CREATE PROCEDURE uspCustomersByRegion 
(  
    @regionID int  
)
AS
BEGIN
     SELECT * FROM CustomersbyRegion(@regionID);
END
GO 
```

我认为这是获得预期结果的最“无黑客”的方法。它使用现有的功能，因为它们的使用目的是没有额外的复杂性。通过将内联表值用户定义函数嵌套在存储过程中，您可以通过两种方式访问​​该功能。加！对于实际的 SQL 代码，您只有一个维护点。

有人建议使用 OPENROWSET ，但这不是 OPENROWSET 函数的用途（来自联机丛书）：

> 包括从 OLE DB 数据源访问远程数据所需的所有连接信息。此方法是访问链接服务器中的表的一种替代方法，是一种使用 OLE DB 连接和访问远程数据的一次性即席方法。要更频繁地引用 OLE DB 数据源，请改用链接服务器。

使用 OPENROWSET 可以完成工作，但会产生一些额外的开销来打开本地连接和编组数据。它也可能不是在所有情况下都是一个选项，因为它需要一个特别的查询权限，这会带来安全风险，因此可能是不希望的。此外，OPENROWSET 方法将排除使用返回多个结果集的存储过程。在单个存储过程中包装多个内联表值用户定义函数可以实现此目的。

* * *

## 回答 #5

> 赞同：141
> 
> 时间：2009-03-17T10:50:44.120

```
Select @@ServerName
EXEC sp_serveroption @@ServerName, 'DATA ACCESS', TRUE

SELECT  *
INTO    #tmpTable
FROM    OPENQUERY(YOURSERVERNAME, 'EXEC db.schema.sproc 1') 
```

* * *

## 回答 #6

> 赞同：130
> 
> 时间：2015-03-13T19:38:34.537

> ## 最简单的解决方案：
> 
> ```
> CREATE TABLE #temp (...);
> 
> INSERT INTO #temp
> EXEC [sproc]; 
> ```

如果您不知道架构，那么您可以执行以下操作。*请注意，此方法存在严重的安全风险。*

```
SELECT * 
INTO #temp
FROM OPENROWSET('SQLNCLI', 
                'Server=localhost;Trusted_Connection=yes;', 
                'EXEC [db].[schema].[sproc]') 
```

* * *

## 回答 #7

> 赞同：119
> 
> 时间：2009-03-17T14:06:03.930

当存储过程返回很多列并且您不想手动“创建”一个临时表来保存结果时，我发现最简单的方法是进入存储过程并在最后一个 select 语句并将 1=0 添加到 where 子句。

运行存储过程一次，然后返回并删除您刚刚添加的 SQL 代码。现在，您将有一个与存储过程的结果匹配的空表。您可以为临时表“将表作为创建脚本”，也可以直接插入到该表中。

* * *

## 回答 #8

> 赞同：70
> 
> 时间：2011-03-24T07:15:08.290

```
declare @temp table
(
    name varchar(255),
    field varchar(255),
    filename varchar(255),
    filegroup varchar(255),
    size varchar(255),
    maxsize varchar(255),
    growth varchar(255),
    usage varchar(255)
);
INSERT @temp  Exec sp_helpfile;
select * from @temp; 
```

* * *

## 回答 #9

> 赞同：52
> 
> 时间：2012-07-31T17:09:22.960

如果您的存储过程的结果表过于复杂，无法手动键入“create table”语句，并且您不能使用 OPENQUERY OR OPENROWSET，您可以使用 sp_help 为您生成列和数据类型的列表。获得列列表后，只需对其进行格式化以满足您的需要。

**第 1 步：将“into #temp”添加到输出查询（例如“select [...] into #temp from [...]”）。**

最简单的方法是直接在 proc 中编辑输出查询。如果您无法更改存储过程，您可以将内容复制到新的查询窗口并在那里修改查询。

**第 2 步：在临时表上运行 sp_help。（例如“exec tempdb..sp_help #temp”）**

创建临时表后，对临时表运行 sp_help 以获取列和数据类型的列表，包括 varchar 字段的大小。

**第 3 步：将数据列和类型复制到创建表语句中**

我有一张 Excel 表，用于将 sp_help 的输出格式化为“创建表”语句。您不需要任何花哨的东西，只需复制并粘贴到您的 SQL 编辑器中即可。使用列名、大小和类型来构造“Create table #x [...]”或“declare @x table [...]”语句，您可以使用它们来插入存储过程的结果。

**第 4 步：插入到新创建的表中**

现在，您将获得一个类似于此线程中描述的其他解决方案的查询。

```
DECLARE @t TABLE 
(
   --these columns were copied from sp_help
   COL1 INT,
   COL2 INT   
)

INSERT INTO @t 
Exec spMyProc 
```

此技术还可用于将临时表 ( `#temp`) 转换为表变量 ( `@temp`)。虽然这可能比`create table`您自己编写语句需要更多的步骤，但它可以防止手动错误，例如大型流程中的拼写错误和数据类型不匹配。调试错字可能比一开始编写查询花费更多时间。

* * *

## 回答 #10

> 赞同：48
> 
> 时间：2009-08-06T07:28:23.533

您的存储过程是否只检索数据或修改它？如果仅用于检索，则可以将存储过程转换为函数并使用公用表表达式 (CTE)，而无需声明它，如下所示：

```
with temp as (
    select * from dbo.fnFunctionName(10, 20)
)
select col1, col2 from temp 
```

但是，任何需要从 CTE 检索的内容都应仅在一个语句中使用。您不能`with temp as ...`在几行 SQL 之后执行并尝试使用它。对于更复杂的查询，您可以在一个语句中包含多个 CTE。

例如，

```
with temp1020 as (
    select id from dbo.fnFunctionName(10, 20)
),
temp2030 as (
    select id from dbo.fnFunctionName(20, 30)
)
select * from temp1020 
where id not in (select id from temp2030) 
```

* * *

## 回答 #11

> 赞同：39
> 
> 时间：2014-02-05T16:21:29.947

如果 OPENROWSET 导致您出现问题，那么从 2012 年开始还有另一种方法；使用 sys.dm_exec_describe_first_result_set_for_object，如此处所述：[Retrieve column names and types of a stored procedure?](https://stackoverflow.com/questions/14574773/retrieve-column-names-and-types-of-a-stored-procedure)

首先，创建这个存储过程来为临时表生成 SQL：

```
CREATE PROCEDURE dbo.usp_GetStoredProcTableDefinition(
    @ProcedureName  nvarchar(128),
    @TableName      nvarchar(128),
    @SQL            nvarchar(max) OUTPUT
)
AS
SET @SQL = 'CREATE TABLE ' + @tableName + ' ('

SELECT @SQL = @SQL + '['+name +'] '+ system_type_name +''  + ','
        FROM sys.dm_exec_describe_first_result_set_for_object
        (
          OBJECT_ID(@ProcedureName), 
          NULL
        );

--Remove trailing comma
SET @SQL = SUBSTRING(@SQL,0,LEN(@SQL))    
SET @SQL =  @SQL +')' 
```

要使用该过程，请按以下方式调用它：

```
DECLARE     @SQL    NVARCHAR(MAX)

exec dbo.usp_GetStoredProcTableDefinition
    @ProcedureName='dbo.usp_YourProcedure',
    @TableName='##YourGlobalTempTable',@SQL = @SQL OUTPUT

INSERT INTO ##YourGlobalTempTable
EXEC    [dbo].usp_YourProcedure

select * from ##YourGlobalTempTable 
```

请注意，我使用的是全局临时表。这是因为使用 EXEC 运行动态 SQL 会创建自己的会话，因此普通临时表将超出任何后续代码的范围。如果全局临时表有问题，您*可以*使用普通临时表，但任何后续 SQL 都需要是动态的，即也由 EXEC 语句执行。

* * *

## 回答 #12

> 赞同：32
> 
> 时间：2010-02-11T19:39:46.630

Quassnoi 让我大部分时间都在那里，但缺少一件事：

## ****我需要在存储过程中使用参数。****

## 并且 OPENQUERY 不允许这种情况发生：

所以我找到了一种工作系统的方法，也不必使表定义如此严格，并在另一个存储过程中重新定义它（当然要冒险它可能会破坏）！

是的，您可以使用带有虚假变量的 OPENQUERY 语句动态创建从存储过程返回的表定义（只要*NO RESULT SET*返回与具有良好数据的数据集相同数量的字段和相同位置）。

创建表后，您可以整天使用 exec 存储过程进入临时表。

* * *

## 并且要注意（如上所述）您必须启用数据访问，

```
EXEC sp_serveroption 'MYSERVERNAME', 'DATA ACCESS', TRUE 
```

* * *

## 代码：

```
declare @locCompanyId varchar(8)
declare @locDateOne datetime
declare @locDateTwo datetime

set @locDateOne = '2/11/2010'
set @locDateTwo = getdate()

--Build temporary table (based on bogus variable values)
--because we just want the table definition and
--since openquery does not allow variable definitions...
--I am going to use bogus variables to get the table defintion.

select * into #tempCoAttendanceRpt20100211
FROM OPENQUERY(DBASESERVER,
  'EXEC DATABASE.dbo.Proc_MyStoredProc 1,"2/1/2010","2/15/2010 3:00 pm"')

set @locCompanyId = '7753231'

insert into #tempCoAttendanceRpt20100211
EXEC DATABASE.dbo.Proc_MyStoredProc @locCompanyId,@locDateOne,@locDateTwo

set @locCompanyId = '9872231'

insert into #tempCoAttendanceRpt20100211
EXEC DATABASE.dbo.Proc_MyStoredProc @locCompanyId,@locDateOne,@locDateTwo

select * from #tempCoAttendanceRpt20100211
drop table #tempCoAttendanceRpt20100211 
```

感谢最初提供的信息...... **是的，最后我不必**在使用来自另一个存储过程或数据库的数据时创建所有这些虚假（严格）的表定义，**是**的，您也可以使用参数。

搜索参考标签：

*   SQL 2005 存储过程到临时表

*   带有存储过程和变量的 openquery 2005

*   带变量的openquery

*   在临时表中执行存储过程

更新：**这不适用于临时表**，所以我不得不求助于手动创建临时表。

**糟糕的通知**：这不适用于**临时表**，[http://www.sommarskog.se/share_data.html#OPENQUERY](http://www.sommarskog.se/share_data.html#OPENQUERY)

参考：接下来就是定义LOCALSERVER。在示例中它可能看起来像一个关键字，但实际上它只是一个名称。这就是你的做法：

```
sp_addlinkedserver @server = 'LOCALSERVER',  @srvproduct = '',
                   @provider = 'SQLOLEDB', @datasrc = @@servername 
```

要创建链接服务器，您必须具有 ALTER ANY SERVER 权限，或者是任何固定服务器角色 sysadmin 或 setupadmin 的成员。

OPENQUERY 打开到 SQL Server 的新连接。这有一些含义：

您使用 OPENQUERY 调用的过程不能引用在当前连接中创建的临时表。

新连接有自己的默认数据库（使用 sp_addlinkedserver 定义，默认为 master），因此所有对象规范都必须包含数据库名称。

如果您有一个打开的事务并且在您调用 OPENQUERY 时持有锁，则被调用的过程无法访问您锁定的内容。也就是说，如果你不小心，你会阻止自己。

连接不是免费的，因此会降低性能。

* * *

## 回答 #13

> 赞同：28
> 
> 时间：2016-02-26T11:05:06.447

如果您有幸拥有 SQL 2012 或更高版本，则可以使用`dm_exec_describe_first_result_set_for_object`

我刚刚编辑了gotqn提供的sql。谢谢gotqn。

这将创建一个名称与过程名称相同的全局临时表。临时表可以稍后根据需要使用。只是不要忘记在重新执行之前删除它。

```
 declare @procname nvarchar(255) = 'myProcedure',
            @sql nvarchar(max) 

    set @sql = 'create table ##' + @procname + ' ('
    begin
            select      @sql = @sql + '[' + r.name + '] ' +  r.system_type_name + ','
            from        sys.procedures AS p
            cross apply sys.dm_exec_describe_first_result_set_for_object(p.object_id, 0) AS r
            where       p.name = @procname

            set @sql = substring(@sql,1,len(@sql)-1) + ')'
            execute (@sql)
            execute('insert ##' + @procname + ' exec ' + @procname)
    end 
```

* * *

## 回答 #14

> 赞同：24
> 
> 时间：2011-09-26T16:04:54.863

这个存储过程完成了这项工作：

```
CREATE PROCEDURE [dbo].[ExecIntoTable]
(
    @tableName          NVARCHAR(256),
    @storedProcWithParameters   NVARCHAR(MAX)
)
AS
BEGIN
    DECLARE @driver         VARCHAR(10)
    DECLARE @connectionString   NVARCHAR(600)
    DECLARE @sql            NVARCHAR(MAX)
    DECLARE @rowsetSql      NVARCHAR(MAX)

    SET @driver = '''SQLNCLI'''

    SET @connectionString = 
        '''server=' + 
            CAST(SERVERPROPERTY('ServerName') AS NVARCHAR(256)) + 
            COALESCE('\' + CAST(SERVERPROPERTY('InstanceName') AS NVARCHAR(256)), '') + 
        ';trusted_connection=yes'''

    SET @rowsetSql = '''EXEC ' + REPLACE(@storedProcWithParameters, '''', '''''') + ''''

    SET @sql = '
SELECT
    *
INTO 
    ' + @tableName + ' 
FROM
    OPENROWSET(' + @driver + ',' + @connectionString + ',' + @rowsetSql + ')'

    EXEC (@sql)
END
GO 
```

这是对此的轻微修改：[将存储过程结果插入表中](http://sqlserverplanet.com/sql/insert-stored-procedure-results-into-table/)，以便它实际工作。

如果您希望它与临时表一起使用，那么您将需要使用一个`##GLOBAL`表并在之后删除它。

* * *

## 回答 #15

> 赞同：18
> 
> 时间：2013-10-05T04:03:38.677

1.  我正在使用以下架构和数据创建一个表。

2.  创建一个存储过程。

3.  现在我知道我的过程的结果是什么，所以我正在执行以下查询。

    ```
     CREATE TABLE [dbo].[tblTestingTree](
         [Id] [int] IDENTITY(1,1) NOT NULL,
         [ParentId] [int] NULL,
         [IsLeft] [bit] NULL,
         [IsRight] [bit] NULL,
     CONSTRAINT [PK_tblTestingTree] PRIMARY KEY CLUSTERED
     (
         [Id] ASC
     ) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
     ) ON [PRIMARY]
     GO
     SET IDENTITY_INSERT [dbo].[tblTestingTree] ON
     INSERT [dbo].[tblTestingTree] ([Id], [ParentId], [IsLeft], [IsRight]) VALUES (1, NULL, NULL, NULL)
     INSERT [dbo].[tblTestingTree] ([Id], [ParentId], [IsLeft], [IsRight]) VALUES (2, 1, 1, NULL)
     INSERT [dbo].[tblTestingTree] ([Id], [ParentId], [IsLeft], [IsRight]) VALUES (3, 1, NULL, 1)
     INSERT [dbo].[tblTestingTree] ([Id], [ParentId], [IsLeft], [IsRight]) VALUES (4, 2, 1, NULL)
     INSERT [dbo].[tblTestingTree] ([Id], [ParentId], [IsLeft], [IsRight]) VALUES (5, 2, NULL, 1)
     INSERT [dbo].[tblTestingTree] ([Id], [ParentId], [IsLeft], [IsRight]) VALUES (6, 3, 1, NULL)
     INSERT [dbo].[tblTestingTree] ([Id], [ParentId], [IsLeft], [IsRight]) VALUES (7, 3, NULL, 1)
     INSERT [dbo].[tblTestingTree] ([Id], [ParentId], [IsLeft], [IsRight]) VALUES (8, 4, 1, NULL)
     INSERT [dbo].[tblTestingTree] ([Id], [ParentId], [IsLeft], [IsRight]) VALUES (9, 4, NULL, 1)
     INSERT [dbo].[tblTestingTree] ([Id], [ParentId], [IsLeft], [IsRight]) VALUES (10, 5, 1, NULL)

     SET IDENTITY_INSERT [dbo].[tblTestingTree] OFF
     VALUES (10, 5, 1, NULL)
     SET IDENTITY_INSERT [dbo].[tblTestingTree] On

     create procedure GetDate
     as
     begin
         select Id,ParentId from tblTestingTree
     end

     create table tbltemp
     (
         id int,
         ParentId int
     )
     insert into tbltemp
     exec GetDate

     select * from tbltemp; 
    ```

* * *

## 回答 #16

> 赞同：18
> 
> 时间：2015-06-03T11:47:50.610

为了将存储过程的第一个记录集插入到临时表中，您需要了解以下内容：

1.  只有存储过程的第一行集可以插入到临时表中
2.  存储过程不得执行动态 T-SQL 语句 ( `sp_executesql`)
3.  你需要先定义临时表的结构

以上可能看起来是限制，但恕我直言，这完全有道理 - 如果您正在使用`sp_executesql`，您可以一次返回两列，一次返回十列，如果您有多个结果集，您也不能将它们插入到多个表中 - 您可以插入最大值在一个 T-SQL 语句中的两个表中（使用`OUTPUT`子句并且没有触发器）。

所以，问题主要是如何在执行`EXEC ... INTO ...`语句之前定义临时表结构。

*   [sys.dm_exec_describe_first_result_set_for_object](https://msdn.microsoft.com/en-us/library/ff878236.aspx)
*   [sys.dm_exec_describe_first_result_set](https://msdn.microsoft.com/en-us/library/ff878258.aspx)
*   [sp_describe_first_result_set](https://msdn.microsoft.com/en-us/library/ff878602.aspx)

第一个适用`OBJECT_ID`于 Ad-hoc 查询，而第二个和第三个也适用于 Ad-hoc 查询。我更喜欢使用 DMV 而不是 sp，因为您可以`CROSS APPLY`同时为多个过程使用和构建临时表定义。

```
SELECT p.name, r.* 
FROM sys.procedures AS p
CROSS APPLY sys.dm_exec_describe_first_result_set_for_object(p.object_id, 0) AS r; 
```

另外，请注意该`system_type_name`字段，因为它非常有用。它存储列完整定义。例如：

```
smalldatetime
nvarchar(max)
uniqueidentifier
nvarchar(1000)
real
smalldatetime
decimal(18,2) 
```

在大多数情况下，您可以直接使用它来创建表定义。

所以，我认为在大多数情况下（如果存储过程符合某些条件），您可以轻松构建动态语句来解决此类问题（创建临时表，将存储过程结果插入其中，对数据执行所需的操作） .

* * *

[请注意，在某些情况下](https://msdn.microsoft.com/en-us/library/ff878258.aspx#Anchor_3)，如执行动态 T-SQL 语句或在存储过程中使用临时表时，上述对象无法定义第一个结果集数据。

* * *

## 回答 #17

> 赞同：15
> 
> 时间：2015-09-07T11:37:14.343

如果查询不包含参数，请使用`OpenQuery`else use `OpenRowset`。

基本的事情是根据存储过程创建模式并插入到该表中。例如：

```
DECLARE @abc TABLE(
                  RequisitionTypeSourceTypeID INT
                , RequisitionTypeID INT
                , RequisitionSourcingTypeID INT
                , AutoDistOverride INT
                , AllowManagerToWithdrawDistributedReq INT
                , ResumeRequired INT
                , WarnSupplierOnDNRReqSubmission  INT
                , MSPApprovalReqd INT
                , EnableMSPSupplierCounterOffer INT
                , RequireVendorToAcceptOffer INT
                , UseCertification INT
                , UseCompetency INT
                , RequireRequisitionTemplate INT
                , CreatedByID INT
                , CreatedDate DATE
                , ModifiedByID INT
                , ModifiedDate DATE
                , UseCandidateScheduledHours INT
                , WeekEndingDayOfWeekID INT
                , AllowAutoEnroll INT
                )
INSERT INTO @abc
EXEC [dbo].[usp_MySp] 726,3
SELECT * FROM @abc 
```

* * *

## 回答 #18

> 赞同：13
> 
> 时间：2011-03-10T18:30:05.090

**代码**

```
CREATE TABLE #T1
(
    col1 INT NOT NULL,
    col2 NCHAR(50) NOT NULL,
    col3 TEXT NOT NULL,
    col4 DATETIME NULL,
    col5 NCHAR(50) NULL,
    col6 CHAR(2) NULL,
    col6 NCHAR(100) NULL,
    col7 INT NULL,
    col8 NCHAR(50) NULL,
    col9 DATETIME NULL,
    col10 DATETIME NULL
)

DECLARE @Para1 int
DECLARE @Para2 varchar(32)
DECLARE @Para3 varchar(100)
DECLARE @Para4 varchar(15)
DECLARE @Para5 varchar (12)
DECLARE @Para6 varchar(1)
DECLARE @Para7 varchar(1)

SET @Para1 = 1025
SET @Para2 = N'6as54fsd56f46sd4f65sd'
SET @Para3 = N'XXXX\UserName'
SET @Para4 = N'127.0.0.1'
SET @Para5 = N'XXXXXXX'
SET @Para6 = N'X'
SET @Para7 = N'X'

INSERT INTO #T1
(
    col1,
    col2,
    col3,
    col4,
    col5,
    col6,
    col6,
    col7,
    col8,
    col9,
    col10,
)
EXEC [dbo].[usp_ProcedureName] @Para1, @Para2, @Para3, @Para4, @Para5, @Para6, @Para6 
```

我希望这有帮助。请酌情给予资格。

* * *

## 回答 #19

> 赞同：11
> 
> 时间：2009-08-06T07:49:38.623

我发现*[Passing Arrays/DataTables into Stored Procedures](http://www.codeproject.com/KB/database/PassingArraysIntoSPs.aspx)*这可能会给你另一个关于如何解决问题的想法。

该链接建议使用**Image**类型参数传递到存储过程。然后在存储过程中，将图像转换为包含原始数据的表变量。

也许有一种方法可以与临时表一起使用。

* * *

## 回答 #20

> 赞同：10
> 
> 时间：2014-08-18T09:11:12.483

我遇到了同样的问题，这是我根据[Paul 的建议](https://stackoverflow.com/a/15438582/835239 "保罗的建议")所做的。这里的主要部分是`NEWID()`为了避免多个用户同时运行存储过程/脚本，全局临时表的痛苦。

```
DECLARE @sql varchar(max) = '', 
@tmp_global_table varchar(255) = '##global_tmp_' + CONVERT(varchar(36), NEWID())
SET @sql = @sql + 'select * into [' + @tmp_global_table + '] from YOURTABLE'
EXEC(@sql)

EXEC('SELECT * FROM [' + @tmp_global_table + ']') 
```

* * *

## 回答 #21

> 赞同：9
> 
> 时间：2009-08-11T12:46:05.500

另一种方法是创建一个类型并使用 PIPELINED 传回您的对象。然而，这仅限于了解列。但它的优势在于能够做到：

```
SELECT * 
FROM TABLE(CAST(f$my_functions('8028767') AS my_tab_type)) 
```

* * *

## 回答 #22

> 赞同：8
> 
> 时间：2017-01-27T11:52:46.857

这可以在 SQL Server 2014+ 中完成，前提是存储过程只返回一个表。如果有人找到为多个表执行此操作的方法，我很想知道。

```
DECLARE @storedProcname NVARCHAR(MAX) = ''
SET @storedProcname = 'myStoredProc'

DECLARE @strSQL AS VARCHAR(MAX) = 'CREATE TABLE myTableName '

SELECT @strSQL = @strSQL+STUFF((
SELECT ',' +name+' ' + system_type_name 
FROM sys.dm_exec_describe_first_result_set_for_object (OBJECT_ID(@storedProcname),0)
FOR XML PATH('')
),1,1,'(') + ')'

EXEC (@strSQL)

INSERT INTO myTableName

EXEC ('myStoredProc @param1=1, @param2=2')

SELECT * FROM myTableName

DROP TABLE myTableName 
```

这会从系统表中提取返回表的定义，并使用它为您构建临时表。然后，您可以如前所述从存储过程中填充它。

还有一些变体也可以与动态 SQL 一起使用。

* * *

## 回答 #23

> 赞同：7
> 
> 时间：2019-06-13T18:26:56.330

在四处搜索后，我找到了一种为任何存储过程动态创建临时表的方法，而无需使用`OPENROWSET`或`OPENQUERY`使用存储过程结果定义的通用模式，尤其是当您不是数据库管理员时。

Sql server 有一个内置的`sp_describe_first_result_set`过程，可以为您提供任何过程结果集的模式。我根据此过程的结果创建了一个模式表，并手动将所有字段设置为 NULLABLE。

```
declare @procname varchar(100) = 'PROCEDURENAME' -- your procedure name
declare @param varchar(max) = '''2019-06-06''' -- your parameters 
declare @execstr nvarchar(max) = N'exec ' + @procname
declare @qry nvarchar(max)

-- Schema table to store the result from sp_describe_first_result_set.
create table #d
(is_hidden  bit  NULL, column_ordinal   int  NULL, name sysname NULL, is_nullable   bit  NULL, system_type_id   int  NULL, system_type_name nvarchar(256) NULL,
max_length  smallint  NULL, precision   tinyint  NULL,  scale   tinyint  NULL,  collation_name  sysname NULL, user_type_id  int NULL, user_type_database    sysname NULL,
user_type_schema    sysname NULL,user_type_name sysname NULL,assembly_qualified_type_name   nvarchar(4000),xml_collection_id    int NULL,xml_collection_database    sysname NULL,
xml_collection_schema   sysname NULL,xml_collection_name    sysname NULL,is_xml_document    bit  NULL,is_case_sensitive bit  NULL,is_fixed_length_clr_type  bit  NULL,
source_server   sysname NULL,source_database    sysname NULL,source_schema  sysname NULL,source_table   sysname NULL,source_column  sysname NULL,is_identity_column bit NULL,
is_part_of_unique_key   bit NULL,is_updateable  bit NULL,is_computed_column bit NULL,is_sparse_column_set   bit NULL,ordinal_in_order_by_list   smallint NULL,
order_by_list_length    smallint NULL,order_by_is_descending    smallint NULL,tds_type_id   int  NULL,tds_length    int  NULL,tds_collation_id  int NULL,
tds_collation_sort_id   tinyint NULL)

-- Get result set definition of your procedure
insert into #d
EXEC sp_describe_first_result_set @exestr, NULL, 0

-- Create a query to generate and populate a global temp table from above results
select 
@qry = 'Create table ##t(' +
stuff(  
    (select ',' + name + ' '+ system_type_name + ' NULL'
    from #d d For XML Path, TYPE)
    .value(N'.[1]', N'nvarchar(max)')
, 1,1,'')
+ ')

insert into ##t 
Exec '+@procname+' ' + @param

Exec sp_executesql @qry

-- Use below global temp table to query the data as you may
select * from ##t

-- **WARNING** Don't forget to drop the global temp table ##t.
--drop table ##t
drop table #d 
```

> 在 Sql Server 版本上开发和测试 - Microsoft SQL Server 2016 (RTM) - 13.0.1601.5(Build 17134:)

您可以调整您正在使用的 SQL Server 版本的架构（如果需要）。

* * *

## 回答 #24

> 赞同：6
> 
> 时间：2019-04-27T10:48:09.333

这是一个简单的两步过程： - 创建临时表 - 插入临时表。

执行相同操作的代码：

```
CREATE TABLE #tempTable (Column1 int, Column2 varchar(max));
INSERT INTO #tempTable 
EXEC [app].[Sproc_name]
@param1 = 1,
@param2 =2; 
```

* * *

## 回答 #25

> 赞同：4
> 
> 时间：2015-03-24T09:01:55.600

如果您知道要传递的参数并且您无权访问 make sp_configure，则使用这些参数编辑存储过程，并且可以将其存储在##global 表中。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2020-06-15T11:49:09.580

这是我的带参数的 T-SQL

```
--require one time execution if not configured before
sp_configure 'Show Advanced Options', 1
GO
RECONFIGURE
GO

--require one time execution if not configured before
sp_configure 'Ad Hoc Distributed Queries', 1
GO
RECONFIGURE
GO

--the query
DECLARE @param1 int = 1, @param2 int = 2
DECLARE @SQLStr varchar(max) = 'SELECT * INTO #MyTempTable
                                FROM OPENROWSET(''SQLNCLI'',  
''Server=ServerName;Database=DbName;Trusted_Connection=yes'',
''exec StoredProcedureName '+ CAST(@param1 AS varchar(15)) +','+ CAST(@param2 AS varchar(15)) +''') AS a ;
 select * from #MyTempTable;
 drop table #MyTempTable        
';
EXECUTE(@SQLStr); 
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2019-09-20T21:16:34.907

这个问题迟到了几年，但我需要这样的东西来生成一些快速而肮脏的代码。我相信正如其他人所说，预先定义临时表更容易，但这种方法应该适用于简单的存储过程查询或 sql 语句。

这会有点复杂，但它借鉴了这里的贡献者以及来自 DBA Stack Exchange 的 Paul White 的解决方案[Get stored procedure result column-types](https://dba.stackexchange.com/questions/135365/get-stored-procedure-result-column-types)。再次重申，这种方法和示例不是为多用户环境中的流程设计的。在这种情况下，表定义会在全局临时表中设置一小段时间，以供代码生成模板过程参考。

**我尚未对此进行全面测试，因此可能会有一些警告，因此您可能需要访问 Paul White 答案中的 MSDN 链接。这适用于 SQL 2012 及更高版本。**

首先使用类似于Oracle 的描述 的存储过程***sp_describe_first_result_set 。***

这将评估第一个结果集的第一行，因此如果您的存储过程或语句返回多个查询，它将仅描述第一个结果。

我创建了一个存储过程来分解返回单个字段以从中选择以创建临时表定义的任务。

```
CREATE OR ALTER PROCEDURE [dbo].[sp_GetTableDefinitionFromSqlBatch_DescribeFirstResultSet]
(
     @sql NVARCHAR(4000)
    ,@table_name VARCHAR(100)
    ,@TableDefinition NVARCHAR(MAX) OUTPUT
)
AS
BEGIN
    SET NOCOUNT ON
    DECLARE @TempTableDefinition NVARCHAR(MAX)
    DECLARE @NewLine NVARCHAR(4) = CHAR(13)+CHAR(10)

    DECLARE @ResultDefinition TABLE (  --The View Definition per MSDN
      is_hidden         bit NOT NULL
    , column_ordinal    int NOT NULL
    , [name]            sysname NULL
    , is_nullable       bit NOT NULL
    , system_type_id    int NOT NULL
    , system_type_name  nvarchar(256) NULL
    , max_length        smallint NOT NULL
    , [precision]       tinyint NOT NULL
    , scale             tinyint NOT NULL
    , collation_name    sysname NULL    
    , user_type_id      int NULL
    , user_type_database    sysname NULL    
    , user_type_schema  sysname NULL
    , user_type_name    sysname NULL    
    , assembly_qualified_type_name      nvarchar(4000)  
    , xml_collection_id         int NULL
    , xml_collection_database   sysname NULL    
    , xml_collection_schema     sysname NULL    
    , xml_collection_name       sysname NULL
    , is_xml_document           bit NOT NULL            
    , is_case_sensitive         bit NOT NULL            
    , is_fixed_length_clr_type  bit NOT NULL    
    , source_server             sysname NULL            
    , source_database           sysname NULL
    , source_schema             sysname NULL
    , source_table              sysname NULL
    , source_column             sysname NULL
    , is_identity_column        bit NULL
    , is_part_of_unique_key     bit NULL
    , is_updateable             bit NULL
    , is_computed_column        bit NULL
    , is_sparse_column_set      bit NULL
    , ordinal_in_order_by_list  smallint NULL   
    , order_by_is_descending    smallint NULL   
    , order_by_list_length      smallint NULL
    , tds_type_id               int NOT NULL
    , tds_length                int NOT NULL
    , tds_collation_id          int NULL
    , tds_collation_sort_id     tinyint NULL
    )

    --Insert the description into table variable    
    INSERT @ResultDefinition
    EXEC sp_describe_first_result_set @sql

    --Now Build the string to create the table via union select statement
    ;WITH STMT AS (
        SELECT N'CREATE TABLE ' + @table_name + N' (' AS TextVal
        UNION ALL

        SELECT 
         CONCAT(
                CASE column_ordinal
                    WHEN 1 THEN '     ' ELSE '   , ' END  --Determines if comma should precede
                , QUOTENAME([name]) , '   ', system_type_name  -- Column Name and SQL TYPE
                ,CASE is_nullable 
                    WHEN 0 THEN '   NOT NULL' ELSE '   NULL' END --NULLABLE CONSTRAINT          
               ) AS TextVal
        FROM @ResultDefinition WHERE is_hidden = 0  -- May not be needed
        UNION ALL

        SELECT N');' + @NewLine
    ) 

    --Now Combine the rows to a single String
    SELECT @TempTableDefinition = COALESCE (@TempTableDefinition + @NewLine + TextVal, TextVal) FROM STMT

    SELECT @TableDefinition = @TempTableDefinition
END 
```

难题是您需要使用全局表，但您需要使其足够独特，以便您可以频繁地从它删除和创建，而不必担心冲突。
在示例中，我使用 Guid (FE264BF5_9C32_438F_8462_8A5DC8DEE49E) 作为全局变量，用下划线替换连字符

```
DECLARE @sql NVARCHAR(4000) = N'SELECT @@SERVERNAME as ServerName, GETDATE() AS Today;'
DECLARE @GlobalTempTable VARCHAR(100) = N'##FE264BF5_9C32_438F_8462_8A5DC8DEE49E_MyTempTable'

--@sql can be a stored procedure name like dbo.foo without parameters

DECLARE @TableDef NVARCHAR(MAX)

DROP TABLE IF EXISTS #MyTempTable
DROP TABLE IF EXISTS ##FE264BF5_9C32_438F_8462_8A5DC8DEE49E_MyTempTable

EXEC [dbo].[sp_GetTableDefinitionFromSqlBatch_DescribeFirstResultSet] 
    @sql, @GlobalTempTable, @TableDef OUTPUT

--Creates the global table ##FE264BF5_9C32_438F_8462_8A5DC8DEE49E_MyTempTable
EXEC sp_executesql @TableDef 

--Now Call the stored procedure, SQL Statement with Params etc.
INSERT ##FE264BF5_9C32_438F_8462_8A5DC8DEE49E_MyTempTable
    EXEC sp_executesql @sql 

--Select the results into your undefined Temp Table from the Global Table
SELECT * 
INTO #MyTempTable
FROM ##FE264BF5_9C32_438F_8462_8A5DC8DEE49E_MyTempTable

SELECT * FROM #MyTempTable

DROP TABLE IF EXISTS #MyTempTable
DROP TABLE IF EXISTS ##FE264BF5_9C32_438F_8462_8A5DC8DEE49E_MyTempTable 
```

同样，我仅使用简单的存储过程查询和简单查询对其进行了测试，因此您的里程可能会有所不同。希望这可以帮助某人。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2018-07-10T14:58:39.970

好吧，您确实必须创建一个临时表，但它不必具有正确的架构....我创建了一个存储过程来修改现有的临时表，以便它具有所需的列和正确的数据类型和顺序（删除所有现有列，添加新列）：

```
GO
create procedure #TempTableForSP(@tableId int, @procedureId int)  
as   
begin  
    declare @tableName varchar(max) =  (select name  
                                        from tempdb.sys.tables 
                                        where object_id = @tableId
                                        );    
    declare @tsql nvarchar(max);    
    declare @tempId nvarchar(max) = newid();      
    set @tsql = '    
    declare @drop nvarchar(max) = (select  ''alter table tempdb.dbo.' + @tableName 
            +  ' drop column ''  + quotename(c.name) + '';''+ char(10)  
                                   from tempdb.sys.columns c   
                                   where c.object_id =  ' + 
                                         cast(@tableId as varchar(max)) + '  
                                   for xml path('''')  
                                  )    
    alter table tempdb.dbo.' + @tableName + ' add ' + QUOTENAME(@tempId) + ' int;
    exec sp_executeSQL @drop;    
    declare @add nvarchar(max) = (    
                                select ''alter table ' + @tableName 
                                      + ' add '' + name 
                                      + '' '' + system_type_name 
                           + case when d.is_nullable=1 then '' null '' else '''' end 
                                      + char(10)   
                              from sys.dm_exec_describe_first_result_set_for_object(' 
                               + cast(@procedureId as varchar(max)) + ', 0) d  
                                order by column_ordinal  
                                for xml path(''''))    

    execute sp_executeSQL  @add;    
    alter table '  + @tableName + ' drop column ' + quotename(@tempId) + '  ';      
    execute sp_executeSQL @tsql;  
end         
GO

create table #exampleTable (pk int);

declare @tableId int = object_Id('tempdb..#exampleTable')
declare @procedureId int = object_id('examplestoredProcedure')

exec #TempTableForSP @tableId, @procedureId;

insert into #exampleTable
exec examplestoredProcedure 
```

**请注意**，如果 sys.dm_exec_describe_first_result_set_for_object 无法确定存储过程的结果（例如，如果它使用临时表），这将不起作用。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2019-11-29T16:09:17.740

如果您让动态 SQL 创建一个临时表，则该表属于动态 SQL 连接，而不是调用存储过程的连接。

```
DECLARE @COMMA_SEPARATED_KEYS varchar(MAX);
DROP TABLE IF EXISTS KV;
CREATE TABLE KV (id_person int, mykey varchar(30), myvalue int);
INSERT INTO KV VALUES
(1, 'age', 16),
(1, 'weight', 63),
(1, 'height', 175),
(2, 'age', 26),
(2, 'weight', 83),
(2, 'height', 185);
WITH cte(mykey) AS (
    SELECT DISTINCT mykey FROM KV
) 
SELECT @COMMA_SEPARATED_KEYS=STRING_AGG(mykey,',') FROM cte;
SELECT @COMMA_SEPARATED_KEYS AS keys; 
```

[![在此处输入图像描述](https://i.stack.imgur.com/DJAzL.png)](https://i.stack.imgur.com/DJAzL.png)

```
DECLARE @ExecuteExpression varchar(MAX);

DROP TABLE IF EXISTS #Pivoted;

SET @ExecuteExpression = N'
SELECT * 
INTO #Pivoted
FROM
(
    SELECT
        mykey,
        myvalue,
        id_person
    FROM KV
) AS t
PIVOT(
    MAX(t.myvalue) 
    FOR mykey IN (COMMA_SEPARATED_KEYS)
) AS pivot_table;
';

SET @ExecuteExpression = REPLACE(@ExecuteExpression, 'COMMA_SEPARATED_KEYS', @COMMA_SEPARATED_KEYS);

EXEC(@ExecuteExpression);

SELECT * FROM #Pivoted; 
```

消息 208，级别 16，状态 0 无效的对象名称“#Pivoted”。这是因为 #Pivoted 归动态 SQL 连接所有。所以最后一条指令

```
SELECT * FROM #Pivoted 
```

失败。

避免遇到此问题的一种方法是确保对 #Pivoted 的所有引用都是从动态查询本身内部进行的：

```
DECLARE @COMMA_SEPARATED_KEYS varchar(MAX);
DROP TABLE IF EXISTS KV;
CREATE TABLE KV (id_person int, mykey varchar(30), myvalue int);
INSERT INTO KV VALUES
(1, 'age', 16),
(1, 'weight', 63),
(1, 'height', 175),
(2, 'age', 26),
(2, 'weight', 83),
(2, 'height', 185);
WITH cte(mykey) AS (
    SELECT DISTINCT mykey FROM KV
) 
SELECT @COMMA_SEPARATED_KEYS=STRING_AGG(mykey,',') FROM cte;
SELECT @COMMA_SEPARATED_KEYS AS keys;

DECLARE @ExecuteExpression varchar(MAX);

DROP TABLE IF EXISTS #Pivoted;

SET @ExecuteExpression = N'
SELECT * 
INTO #Pivoted
FROM
(
    SELECT
        mykey,
        myvalue,
        id_person
    FROM KV
) AS t
PIVOT(
    MAX(t.myvalue) 
    FOR mykey IN (COMMA_SEPARATED_KEYS)
) AS pivot_table;
SELECT * FROM #Pivoted;
';

SET @ExecuteExpression = REPLACE(@ExecuteExpression, 'COMMA_SEPARATED_KEYS', @COMMA_SEPARATED_KEYS);

EXEC(@ExecuteExpression); 
```

[![在此处输入图像描述](https://i.stack.imgur.com/rvRYS.png)](https://i.stack.imgur.com/rvRYS.png)

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2021-06-17T23:21:31.840

首先，修改您的存储过程以将最终结果保存到临时表中。通过这样做，我们正在创建一个与 SP 输出字段匹配的表。然后有一个选择语句将该临时表保存到任何表名。然后按照步骤 2 中的说明执行 SP

第 1 步：修改存储过程以将最终结果保存到临时表中

```
[your stored procedure] 

into #table_temp //this will insert the data to a temp table

from  #table_temp 

select * into SP_Output_Table_1 from #table_temp //this will save data to a actual table 
```

第 2 步：执行下面的 SP，将记录插入到您的表中

```
Insert SP_Output_Table_1
EXE  You_SP_Nane @Parameter1 = 52, @parameter2 =1 
```

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2022-02-14T09:01:53.743

1.  首先选择一个空的结果集到 temptable 中，只是为了创建它。
2.  将 exec SP 运行到 TABLE 中

```
SELECT TOP 0 * INTO [temp_table] FROM [Table]; 

EXEC [StoredProcedure] INTO [temp_table]; 
```

* * *

## 回答 #32

> 赞同：-5
> 
> 时间：2014-08-19T19:12:14.297

我会做以下事情

1.  创建（将 SP 转换为）UDF（表值 UDF）。

2.  `select * into #tmpBusLine from dbo.UDF_getBusinessLineHistory '16 Mar 2009'`

# c# - SharePoint 2007 从头开始

> ID：653715
> 
> 赞同：0
> 
> 时间：2009-03-17T10:46:06.970
> 
> 标签：c#, sharepoint-2007

在接下来的几个月里，我必须快速了解[Microsoft SharePoint 2007 。](http://www.microsoft.com/Sharepoint/default.mspx)我需要从头开始，所以我需要知道它是什么以及如何使用它来构建站点。然后我需要知道如何使用 C# 进行开发（web-parts 等）。

谁能推荐一系列涵盖 MOSS 的创建、管理和开发方面的好文章或书籍？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T11:06:32.863

除了任何书籍或资源外，您还可以直接从 Microsoft 获取完整的 MOSS 2007 服务器的免费 VHD 来玩。这些带有 30 天的自毁功能，但请注意。

[http://www.microsoft.com/downloads/details.aspx?FamilyID=67f93dcb-ada8-4db5-a47b-df17e14b2c74&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=67f93dcb-ada8-4db5-a47b-df17e14b2c74&displaylang=en)

编辑：我发现这对那些没有意识到 MOSS 不像 ASP.NET 或 WSS 那样免费的人很有用。您的情况可能会有所不同，但这对于实验非常有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T10:49:33.327

这是您正在搜索的资源。希望它们有用。

[Sharepoint 电子书](http://www.flazx.com/category202.php)

# c# - GC.Collect 在一个循环中？

> ID：653730
> 
> 赞同：21
> 
> 时间：2009-03-17T10:51:48.017
> 
> 标签：c#, .net, garbage-collection

我使用 Reflector 在 System.Web.ISAPIRuntime 中找到了这段代码

```
public void DoGCCollect()
{
    for (int i = 10; i > 0; i--)
    {
        GC.Collect();
    }
} 
```

任何人都可以对此发表评论吗？有理由在循环中执行 GC.Collect() 吗？为什么是 10 次而不是 3、5 或 20 次？分析表明它没有在.net框架中使用，但它是公共的，所以我想IIS可以调用它......

**编辑 ：**

仅出于澄清目的：我从未调用过 GC.Collect，也无意使用它。我知道在大多数（如果不是全部）情况下这是一个坏主意。问题是为什么 .net 框架会这样做。感谢您的所有回答。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-17T11:04:20.887

是的，这太可怕了。首先，您根本不需要这样做。但是，如果您真的想尽可能地强制垃圾收集，并等待它完成，您可能应该使用：

```
GC.Collect(GC.MaxGeneration, GCCollectionMode.Forced);
GC.WaitForPendingFinalizers();
// Collect anything that's just been finalized
GC.Collect(GC.MaxGeneration, GCCollectionMode.Forced); 
```

虽然真的不是一个好主意。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-17T10:57:03.230

看起来真的很可怕:)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-17T11:15:26.853

我认为您不会得到更好的解释，即“微软的一位程序员非常无能，而且显然，在签入之前没有其他人会费心查看他的代码”。;)

不过看起来确实很吓人。

这是对您不理解的错误的相当普遍的反应。无论出于何种原因，您试图调用 GC，并且不知何故，调用它似乎并不能解决您的问题（也许真正的问题只是您应该等待终结器线程或其他东西），所以天真的解决方案是显然“好吧，我会继续打电话给它”。

类似于反复按“打印”直到您的文档被打印。

不过，也许您应该将其提交给 thedailywtf.com。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T15:02:08.587

难道不应该向微软指出这样的事情吗？在 Connect 网站上发布这个有什么好处吗？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-06-14T20:43:33.313

我真的很喜欢这个方法的 Mono 实现：

```
public void DoGCCollect ()
{
  // Do nothing.
} 
```

可能开发人员打算写类似的东西，这只是一个错字。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-17T10:58:15.677

看起来像一个有世界末日情结的人写的内容是他们将用 10 秒计时器结束世界......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T11:00:11.927

这不是一个好主意，因为您确实应该相信垃圾收集器可以在不被您的代码专门调用的情况下完成其工作。

99.9% 的时间你不需要从你的代码中调用 GC。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T11:08:48.880

首先，打电话不是一个好主意`GC.Collect()`。多次调用它几乎没有效果。

但是，您有时会看到调用`Collect()`, then`WaitForPendingFinalizers()`和 finally的模式`Collect()`。这背后的想法是确保带有终结器的实例也被回收，因为它们将在第一个集合中存活。请记住，这将导致应用程序延迟，并且*很少*需要它。

# python - Django Forms，为 request.user 设置一个初始值

> ID：653735
> 
> 赞同：14
> 
> 时间：2009-03-17T10:53:00.417
> 
> 标签：python, django-forms

有什么方法可以使以下内容成为可能，还是应该在其他地方完成？

```
class JobRecordForm(forms.ModelForm):
    supervisor = forms.ModelChoiceField(
        queryset    = User.objects.filter(groups__name='Supervisors'), 
        widget      = forms.RadioSelect,
        initial     = request.user # is there some way to make this possible?
    )    
    class Meta:
        model = JobRecord 
```

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-07-27T13:58:31.697

如果您在 view.py 中执行此操作：

```
form = JobRecordForm( initial={'supervisor':request.user} ) 
```

然后你不会触发验证。

请参阅[http://docs.djangoproject.com/en/dev/ref/forms/api/#dynamic-initial-values](http://docs.djangoproject.com/en/dev/ref/forms/api/#dynamic-initial-values)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T11:04:13.790

您可能希望在视图函数中处理此问题。由于您的视图函数必须创建初始表单，并且您的视图函数知道用户。

```
form = JobRecordForm( {'supervisor':request.user} ) 
```

这将触发对此输入的验证，顺便说一句，因此您不能以这种方式提供提示值。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-08-05T13:06:58.737

另一个使用中间件的解决方案并节省重写：使用中间件解决方案您可以在任何地方调用“请求”。

* * *

"""中间件"""

```
 # coding: utf-8 
from django.utils.thread_support import currentThread 
_requests = {}

def get_request():
    return _requests[currentThread()]

class GlobalRequestMiddleware(object):
    def process_request(self, request):  
        _requests[currentThread()] = request 
```

* * *

"""保存重写"""

```
class Production(models.Model):
    creator = models.ForeignKey(User, related_name = "%(class)s_creator")
    creation_date = models.DateTimeField(auto_now_add = True)
    modification_date = models.DateTimeField(auto_now = True)

    def save(self, force_insert = False, force_update = False):

        self.creator = get_request().user
        super(Production, self).save(force_insert = force_insert, force_update = force_update)
        return 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-01-18T15:47:15.903

要获得完整的答案，这里是 CBV 解决方案：

```
class MyFormView(TemplateView, FormMixin):
    def get_initial(self):
        self.initial.update({'your_field': self.request.user})
        return super(MyFormView, self).get_initial() 
```

# c# - 用于 Excel 克隆的正确数据结构

> ID：653738
> 
> 赞同：2
> 
> 时间：2009-03-17T10:56:08.847
> 
> 标签：c#, data-structures, .net-2.0

假设我正在使用 C# 进行 Excel 克隆。我的网格表示如下：

```
private struct CellValue
{
    private int column;
    private int row;
    private string text;
}
private List<CellValue> cellValues = new List<CellValue>(); 
```

每次用户添加文本时，我只是将其打包为 CellValue 并将其添加到 cellValues 中。给定一个 CellValue 类型，我可以在 O(1) 时间内确定它的行和列，这很棒。但是，给定一列和一行，我需要遍历整个 cellValues 以查找该列和行中的文本，这非常慢。另外，给定一个文本，我也需要遍历整个内容。是否有任何数据结构可以在 O(1) 时间内完成所有 3 个任务？

更新：浏览一些答案，我认为我没有找到我喜欢的答案。我可以吗：

1.  不要保留超过 2 个 CellValue 副本，以避免同步它们。在 C 世界中，我会很好地使用指针。
2.  可以动态添加行和列（与 Excel 不同）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T11:22:05.027

我会选择一个稀疏数组（链表的链表）以提供最大的灵活性和最小的存储空间。

在此示例中，您有一个行的链接列表，其中每个元素都指向该行中的单元格的链接列表（您可以根据需要反转单元格和行）。

```
 |
 V
+-+    +---+             +---+
|1| -> |1.1| ----------> |1.3| -:
+-+    +---+             +---+
 |
 V
+-+             +---+
|7| ----------> |7.2| -:
+-+             +---+
 |
 = 
```

每个行元素都有行号，每个单元格元素都有一个指向其行元素的指针，因此从单元格中获取行号是 O(1)。

同样，每个单元格元素都有其列号，也就是 O(1)。

没有简单的方法可以让 O(1) 立即找到给定行/列中的单元格，但是除非您为每个可能的单元格预先分配信息以便可以进行索引查找，否则稀疏数组的速度会尽可能快在阵列上 - 这在存储方面会非常浪费。

您可以做的一件事是使一维非稀疏，例如使列成为主数组（而不是链表）并将它们限制为 1,000 - 这将使列查找索引（快速），然后搜索稀疏行。

我认为您*永远*不会仅仅因为文本可以在多个单元格中重复（与行/列不同）而获得 O(1) 的文本查找。我仍然相信稀疏数组将是搜索文本的最快方法，除非您在另一个数组中维护所有文本值的排序索引（同样，这可以使其更快，但会以大量内存为代价）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-16T01:11:28.330

这有过早优化的味道。

也就是说，excel 的一些功能对于选择良好的结构很重要。

首先是excel以适度非线性的方式使用单元格。解析公式的过程涉及以有效的随机顺序遍历电子表格。该结构将需要一种机制来轻松地廉价地查找随机键的值，将它们标记为脏、已解决或由于循环引用而无法解决。它还需要一些方法来知道何时没有更多未解析的单元格，以便它可以停止工作。任何涉及链表的解决方案都可能不是最佳解决方案，因为它们需要线性扫描才能获得这些单元格。

另一个问题是excel一次显示一系列单元格。这可能看起来微不足道，在很大程度上确实如此，但如果应用程序可以一次性提取绘制一系列单元格所需的所有数据，那肯定是理想的。其中一部分可能是跟踪行和列的显示高度和宽度，以便显示系统可以在范围内迭代，直到收集到所需的单元格宽度和高度。需要以这种方式进行迭代可能会排除使用散列策略来稀疏存储单元格。

最重要的是，电子表格的代表性模型存在一些弱点，可以通过采用稍微不同的方法来更有效地解决这些弱点。

例如，列聚合有点笨拙。列总计很容易在 excel 中实现，但它有一种神奇的行为，大部分时间都有效，但并非所有时间都有效。例如，如果您在聚合区域中添加一行，则对该聚合的进一步计算可能会继续有效，也可能不有效，具体取决于您添加它的方式。如果您复制并插入一行（并替换值）一切正常，但如果您将单元格剪切并粘贴一行，事情就不会那么顺利了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T11:01:06.090

我认为您应该使用其中一个索引集合来使其工作得相当快，完美的一个是[KeyedCollection](http://msdn.microsoft.com/en-us/library/ms132438.aspx)

您需要通过扩展此类来创建自己的集合。这样，您的对象仍将包含行和列（因此您不会丢失任何内容），但您将能够搜索它们。可能您必须创建一个封装（行，列）的类并将其设为键（因此使其不可变并覆盖等于并获取哈希码）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T11:06:27.873

我会创建

```
 Collection<Collection<CellValue>> rowCellValues = new Collection<Collection<CellValue>>(); 
```

和

```
Collection<Collection<CellValue>> columnCellValues = new Collection<Collection<CellValue>>(); 
```

外部集合的每一行或每一列都有一个条目，由行号或列号索引，内部集合具有该行或列中的所有单元格。这些集合应作为创建新 CellValue 对象的过程的一部分进行填充。

```
rowCellValues[newCellValue.Row].Add(newCellValue);
columnCellValues[newCellValue.Column].Add(newCellValue); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-16T01:03:54.323

如果我没记错的话，有一篇关于 Visicalc 是如何做到的文章，可能在 80 年代初的 Byte Magazine 上。我相信这是某种稀疏数组。但我认为上下和左右都有链接，因此任何给定的单元格都有一个指向其上方单元格的指针（无论可能有多少单元格），在它的下方，在它的左侧，在它的右边。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-16T00:32:58.547

如果可以“动态”添加行和列，则不应将行/列存储为单元格的*数字*属性，而应将其存储为对行或列对象的引用。

例子：

```
private struct CellValue
{
  private List<CellValue> _column;
  private List<CellValue> _row;
  private string text;

  public List<CellValue> column {
     get { return _column; }
     set {
         if(_column!=null) { _column.Remove(this); }
         _column = value;
         _column.Add(this);
        }
     }

  public List<CellValue> row {
     get { return _row; }
     set {
         if(_row!=null) { _row.Remove(this); }
         _row = value;
         _row.Add(this);
        }
     }
}

private List<List<CellValue>> MyRows    = new List<List<CellValue>>;
private List<List<CellValue>> MyColumns = new List<List<CellValue>>; 
```

每个 Row 和 Column 对象都实现为 CellValue 对象的列表。这些是**无序**的——特定行中单元格的顺序与列索引不对应，反之亦然。

每个工作表都有一个行列表和一个列列表，按工作表的顺序排列（如上所示为 MyRows 和 MyColumns）。

这将允许您重新排列和插入新的行和列，而无需循环和更新任何单元格。

删除行应遍历行上的单元格，并在删除行本身之前将它们从各自的列中删除。反之亦然。

要查找特定的 Row 和 Column，请找到适当的 Row 和 Column 对象，然后找到它们共同包含的 CellValue。

例子：

```
public CellValue GetCell(int rowIndex, int colIndex) {
  List<CellValue> row = MyRows[rowIndex];
  List<CellValue> col = MyColumns[colIndex];
  return row.Intersect(col)[0];
  } 
```

（我对 .NET 3.5 中的这些扩展方法有点模糊，但这应该在球场上。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-17T10:59:48.013

鉴于数据是二维的，我将有一个二维数组来保存它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-17T11:00:53.423

好吧，您可以将它们存储在三个字典中：两个`Dictionary<int,CellValue>`对象用于行和列，一个`Dictionary<string,CellValue>`用于文本。但是，您必须小心地保持所有三个同步。

我不确定我不会只使用一个大的二维数组......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-17T11:03:38.643

如果它是一个精确的克隆，那么一个数组支持的 CellValue[256] 数组列表。Excel 有 256 列，但行数可以增长。

# javascript - jQuery动画滞后

> ID：653744
> 
> 赞同：0
> 
> 时间：2009-03-17T10:58:12.773
> 
> 标签：javascript, jquery, html

我有这个 jQuery 代码，它可以向上、悬停和向下滑动“em”标签：

```
$(".entries a").hover(
  function () {
   $(this).find("em").animate( { height:"100%"}, 500 )

  }, 
  function () {
  $(this).find("em").animate( { height:"0%"}, 500 )
  }
); 
```

html代码

```
<div class="entries">
<a href="http://www.website.com"> 
<em>Description</em> 
<img src="thumb.jpg"/> 
</a>
<a href="http://www.website.com"> 
<em>Description</em> 
<img src="thumb.jpg"/> 
</a> 
<a href="http://www.website.com"> 
<em>Description</em> 
<img src="thumb.jpg"/> 
</a> 
</div> 
```

当我将鼠标移到 a 标签之外时，em 标签向下跳了几个像素，然后开始滑动。这会产生一种滞后效应。

有没有更好的方法来写这个？

就像使用 var 来缓存`$(this).find("em")`?

任何有关性能和代码风格的提示将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T11:06:39.680

尝试使用它，我认为这是您想要的效果，并且它使用更平滑的过渡。

```
$(".entries a").hover(
  function () {
   $(this).find("em").slideDown(500);
  }, 
  function () {
  $(this).find("em").slideUp(500);
  }
); 
```

**编辑**：
如果你想要一些真正有效的东西，你可能希望避免使用 jQuery 进行选择，而只是使用`$(this.childNodes[1])`它来选择它。
`[1]`是因为空格是元素 0

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T11:07:12.923

不是针对您的具体问题的直接答案，但我建议您查看 JQuery UI。它具有类似于您在此处尝试的动画效果。

# symfony1 - 如何在本地服务器中配置 symfony 项目？

> ID：653760
> 
> 赞同：1
> 
> 时间：2009-03-17T11:02:13.047
> 
> 标签：symfony1

我是 symfony 的初学者。我必须配置使用 symfony 构建的已经开发的项目。我更改了数据库信息，但浏览 localhost/myproject/web 时没有显示任何内容。我该怎么做才能在本地服务器中配置项目。我也创建了数据库。希望得到帮助。谢谢 ..........

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T11:18:29.043

您需要将 apache 指向 symfony 项目中的 web 文件夹。或者，如果您的项目位于 apache web 根目录中，您可以使用：

**[http://localhost/myproject/web/index.php](http://localhost/myproject/web/index.php)**但不会显示任何错误。你可以使用：

[http://localhost/myproject/web/](http://localhost/myproject/web/) **frontend** _dev.php 其中**frontend**是前端控制器的名称（此文件位于 web/ 文件夹中）。

如果那时您没有得到任何输出，请查看您的 apache 服务器错误日志以找出项目无法正常工作的原因。

几个解决方案：

当在 symfony 项目根目录中时，在命令提示符下执行：

```
php symfony cache:clear
php symfony fix-perms 
```

然后尝试上面的 url。

更多信息[在这里](http://www.symfony-project.org/tutorial/1_2/my-first-project)

# sql-server - DTS断开编辑中列的数据类型

> ID：653761
> 
> 赞同：3
> 
> 时间：2009-03-17T11:02:27.507
> 
> 标签：sql-server, dts

通过断开连接的编辑查看 DTS 包时，转换数据任务中的目标或源列具有 DataType 属性，其值类似于 129、130、131、135。

我在哪里可以找到这些值的含义的列表？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T11:07:35.623

我认为它是 OLE DB 类型的[DataTypeEnum](http://msdn.microsoft.com/en-us/library/ms675318.aspx)。

# python - Python - 根据列表中的位置/索引从字典中获取值

> ID：653765
> 
> 赞同：1
> 
> 时间：2009-03-17T11:03:54.523
> 
> 标签：python, list, dictionary

从 MySQL 查询中，我得到放入字典“d”的数据：

> d = {0: (datetime.timedelta(0, 25200),), 1: (datetime.timedelta(0, 25500),), 2: (datetime.timedelta(0, 25800),), 3: (datetime. timedelta(0, 26100),), 4: (datetime.timedelta(0, 26400),), 5: (datetime.timedelta(0, 26700),)}

我有一个列表“m”，其中包含以下数字：

> m = [3, 4, 1, 4, 7, 4]

我想测试“m”，如果有数字“4”，我想收到另一个列表“h”，小时数来自“d”，其中列表“m”中的索引将与字典中的键对应“ d"，所以： m[1], m[3], m[5] 会让我在列表 "h" 中分配给 d[1], d[3], d[5] 的小时数：

> h = [7:05:00、7:15:00、7:25:00]

我会很感激你的意见...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T11:27:11.050

我不完全确定这是否是您正在寻找的，但我会试一试：

```
>>> indices = [index for index, i in enumerate(m) if i == 4]
>>> h = [d[i][0] for i in indices] 
```

然后，您必须根据需要处理时间增量。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T11:28:08.523

```
deltas = [str(d[i][0]) for i, j in enumerate(m) if j == 4] 
```

将增量表示列表生成为字符串。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-11T19:48:39.253

所以在每个索引处都有一个对的 n 元组`timedeltas`？假设，从代码中，每个索引可能有不止一个`timedelta`。导入日期时间

```
import datetime

d = {0: (datetime.timedelta(0, 25200),), 1: (datetime.timedelta(0, 25500),), 2: (datetime.timedelta(0, 25800),), 3: (datetime.timedelta(0, 26100),), 4: (datetime.timedelta(0, 26400),), 5: (datetime.timedelta(0, 26700),)}
m = [3, 4, 1, 4, 7, 4]

def something(m, d):
  h = {}
  for index in m:
    if index in d and index not in h:
      for dt in d[index]:
        total = sum([dt.seconds for dt in d[index]])
        hours = total / 3600
        minutes = (total - (3600 * hours)) / 60
        seconds = (total - (3600 * hours) - (60 * minutes))
        h[index] = "%d:%02d:%02d" % (hours, minutes, seconds)
  return h.values()

print something(m, d) # returns exactly what you asked for 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-17T11:26:13.190

你是否要求

```
def hms( td ):
    h = dt.seconds // 3600
    m = dt.seconds%3600 // 60
    s = dt.seconds%60
    return h+td.days*24, m, s

[ hms(d[ m[i] ]) for i in m ] 
```

?

# capistrano - Capistrano 符号链接问题？

> ID：653774
> 
> 赞同：1
> 
> 时间：2009-03-17T11:06:56.373
> 
> 标签：capistrano, symlink

我有这个 capistrano 命令。

```
  任务：symlink_shared 做
        运行“rm -rf #{current_path}/config/database.yml”
        运行“ln -nfs #{shared_pa​​th}/config/database.yml #{release_path}/config/database.yml”
        运行“rm -rf #{current_path}/config/app_config.yml”
        运行“ln -nfs #{shared_pa​​th}/config/app_config.yml #{release_path}/config/app_config.yml”

        运行“rm -rf #{current_path}/public/records”
        运行“ln -nsf #{shared_pa​​th}/uploads/records #{release_path}/public/records”
        运行“rm -rf #{current_path}/public/documents”
        运行“ln -nsf #{shared_pa​​th}/uploads/documents #{release_path}/public/documents”
        运行“rm -rf #{current_path}/public/pdf_xmls”
        运行“ln -nsf #{shared_pa​​th}/uploads/pdf_xmls #{release_path}/public/pdf_xmls”
        运行“rm -rf #{current_path}/public/pdf_xml_files”
        运行“ln -nsf #{shared_pa​​th}/uploads/pdf_xml_files #{release_path}/public/pdf_xml_files”
    结尾

```

一切正常，符号链接也被创建。但是最后一个命令 symlink 在其中一步创建符号链接 pdf_xml_files 。即，它创建一个名为 pdf_xml_files 的目录，并在其中创建 pdf_xml_files 符号链接。需要一些帮助？？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-02T08:37:54.683

看起来 /home/deploy/weddingcards/releases/20090325105337/public/pdf_xml_files 目录已经存在。

ln 命令正在查找该目录并强制它在目录中创建指向您的目标的符号链接。

如果您删除 /home/deploy/weddingcards/releases/20090325105337/public/pdf_xml_files 然后运行相同的命令它应该做你想做的事。

或者，您可以将命令更改为：

```
run "ln -nsf #{shared_path}/uploads/pdf_xml_files #{release_path}/public/" 
```

它将在公共目录中创建符号链接。

# python - 一个简单的冻结行为装饰器

> ID：653783
> 
> 赞同：2
> 
> 时间：2009-03-17T11:08:54.340
> 
> 标签：python, testing, decorator, freeze

我正在尝试为 Python 编写一个冻结装饰器。

思路如下：

**（针对两条评论）**

我可能错了，但我认为测试用例有两个主要用途。

*   一种是测试驱动开发：理想情况下，开发人员在编写代码之前先编写案例。它通常有助于定义架构，因为该规则强制在开发之前定义真实的接口。人们甚至可能会认为，在某些情况下，在开发人员之间分配工作的人正在编写测试用例并用它来有效地说明他所考虑的规范。我没有任何使用这种测试用例的经验。

*   第二个想法是，所有规模不错的项目和几个程序员都遭受代码损坏的困扰。以前可以正常工作的东西可能会因为看起来像无辜重构的变化而被破坏。虽然架构不错，但组件之间的松散耦合可能有助于对抗这种现象；如果您编写了一些测试用例以确保没有任何东西会破坏程序的行为，那么您晚上会睡得更好。

然而，没有人可以否认编写测试用例的开销。在第一种情况下，人们可能会争辩说测试用例实际上是在指导开发，因此不应被视为开销。

坦率地说，我是一个非常年轻的程序员，如果我是你，我在这个主题上的话并不真正有价值......无论如何，我认为大多数公司/项目都不是这样工作的，并且主要使用单元测试在第二种情况下...

换句话说，它的目的不是确保程序正常工作，而是检查它将来是否会正常工作。

通过使用这种冻结装饰器，无需编写测试成本即可满足此需求。

假设你有一个函数

```
def pow(n,k):
    if n == 0:  return 1
    else:       return n * pow(n,k-1) 
```

它非常好，您想将其重写为优化版本。这是一个大项目的一部分。您希望它为几个值返回相同的结果。与其经历测试用例的痛苦，不如使用某种冻结装饰器。

第一次运行装饰器时，装饰器使用定义的 args（低于 0 和 7）运行函数并将结果保存在映射中（ f --> args --> result ）

```
@freeze(2,0)
@freeze(1,3)
@freeze(3,5)
@freeze(0,0)
def pow(n,k):
    if n == 0:  return 1
    else:       return n * pow(n,k-1) 
```

下次执行程序时，装饰器将加载此映射并检查此函数对这些 args 的结果是否未更改。

我已经很快写了装饰器（见下文），但伤害了一些我需要你建议的问题......

```
from __future__ import with_statement
from collections import defaultdict
from types import GeneratorType
import cPickle

def __id_from_function(f):
    return ".".join([f.__module__, f.__name__])

def generator_firsts(g, N=100):
    try:
        if N==0:
            return []
        else:
            return  [g.next()] + generator_firsts(g, N-1)
    except StopIteration :
        return []

def __post_process(v):
    specialized_postprocess = [
        (GeneratorType, generator_firsts),
        (Exception,     str),
    ]
    try:
        val_mro = v.__class__.mro()
        for ( ancestor, specialized ) in specialized_postprocess:
            if ancestor in val_mro:
                return specialized(v)
        raise ""
    except:
        print "Cannot accept this as a value"
        return None

def __eval_function(f):
    def aux(args, kargs):
        try:
            return ( True, __post_process( f(*args, **kargs) ) )
        except Exception, e:
            return ( False, __post_process(e) )
    return aux

def __compare_behavior(f, past_records):
    for (args, kargs, result) in past_records:
        assert __eval_function(f)(args,kargs) == result

def __record_behavior(f, past_records, args, kargs):
    registered_args = [ (a, k) for (a, k, r) in past_records ]
    if (args, kargs) not  in registered_args:
        res = __eval_function(f)(args, kargs)
        past_records.append( (args, kargs, res) )

def __open_frz():
    try:
        with open(".frz", "r") as __open_frz:
            return cPickle.load(__open_frz)
    except:
        return defaultdict(list)

def __save_frz(past_records):
    with open(".frz", "w") as __open_frz:
        return cPickle.dump(past_records, __open_frz)

def freeze_behavior(*args, **kvargs):
    def freeze_decorator(f):
        past_records = __open_frz()
        f_id = __id_from_function(f)
        f_past_records = past_records[f_id]
        __compare_behavior(f, f_past_records)
        __record_behavior(f, f_past_records, args, kvargs)
        __save_frz(past_records)
        return f
    return freeze_decorator 
```

*   结果的转储和比较对于所有类型来说都不是微不足道的。现在我正在考虑使用一个函数（我在这里称之为后处理）来解决这个问题。基本上，我不是存储 res，而是存储 postprocess(res)，然后比较 postprocess(res1)==postprocess(res2)，而不是比较 res1 res2。让用户重载预定义的后处理函数很重要。我的第一个问题是： **你知道检查对象是否可转储的方法吗？**

*   为修饰的函数定义一个键是一件痛苦的事情。在以下片段中，我使用了功能模块及其名称。** 你能想出一个更聪明的方法来做到这一点。**

*   下面的片段有点工作，但在测试和录制时打开和关闭文件。这只是一个愚蠢的原型......但是你知道打开文件，处理所有功能的装饰器，关闭文件的好方法......

*   我打算为此添加一些功能。例如，添加定义一个可迭代对象以浏览一组参数、记录实际使用的参数等的可能性。您为什么期望这样的装饰器？

*   一般来说，你会使用这样的功能，知道它的局限性......尤其是在尝试将它与 POO 一起使用时？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T15:04:36.007

**“一般来说，你会使用这样的功能，知道它的局限性......？”**

坦率地说——从来没有。

在任何情况下，我都不会以这种方式“冻结”函数的结果。

用例似乎基于两个错误的想法：（1）单元测试要么困难，要么复杂或昂贵；(2) 编写代码可能更简单，“冻结”结果并以某种方式使用冻结的结果进行重构。这没有帮助。事实上，冻结错误答案的真实可能性使这成为一个坏主意。

首先，关于“一致性与正确性”。使用简单的映射比使用一组复杂的装饰器更容易保存。

这样做而不是编写冻结装饰器。

```
print "frozen_f=", dict( (i,f(i)) for i in range(100) ) 
```

创建的字典对象将作为冻结结果集完美运行。没有装饰师。没有复杂性可言。

第二，关于“单元测试”。

单元测试的重点**不是**“冻结”一些随机结果。单元测试的重点是将真实结果与另一个开发的结果进行比较（更简单、更明显、性能不佳的方式）。通常单元测试会比较手工开发的结果。其他时候，单元测试使用明显但非常慢的算法来产生一些关键结果。

拥有测试数据的意义不在于它是“冻结”的结果。拥有测试数据的意义在于它是一个独立的结果。以不同的方式完成——有时由不同的人——确认该功能有效。

对不起。在我看来，这不是一个好主意。看起来它颠覆了单元测试的意图。

* * *

**“但是，没有人可以否认编写测试用例的开销”**

实际上，许多人会否认“开销”。在浪费时间和精力的意义上，这不是“开销”。对于我们中的一些人来说，单元测试是必不可少的。没有它们，代码可能会起作用，但只是偶然。有了他们，我们有充分的证据表明它确实有效；以及它适用的具体情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T14:59:44.893

您是否希望实现**不变量**或后置条件？

您应该明确指定结果，这将消除大多数问题。

# c++ - Direct3D10：没有 32 位 ARGB 格式？

> ID：653787
> 
> 赞同：2
> 
> 时间：2009-03-17T11:09:22.390
> 
> 标签：c++, direct3d, direct3d10

我开始添加 d3d10 支持以配合我现有的 d3d9 图形后端。

问题是所有现有代码（在几个应用程序中......）都使用 ARGB 格式的颜色，但是我找不到与 d3d10 匹配的格式模式。d3d10 根本不支持 ARGB 颜色格式还是我错过了什么？如果我没有错过什么是在它们之间进行转换的好方法，它只需要将第一个字节移到末尾，这似乎是一个非常简单的概念，但是除了将颜色分解成它的组件之外，我无论如何都看不到这样做并重建它......例如：

```
//unsigned colIn, colOut
unsigned char
    a = (colIn & 0xFF000000) >> 24,
    r = (colIn & 0x00FF0000) >> 16,
    g = (colIn & 0x0000FF00) >> 8,
    b = (colIn & 0x000000FF);
colOut = (r << 24) | (g << 16) | (b << 8) | a; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T11:23:31.513

在我看来，该格式已丢失，因此您需要重新排序数据。但是，如果您要使用 RGBA，则不需要像示例那样分离所有颜色，因为 R、G 和 B 仍然连续保持相同的顺序，您可以将这 3 个通道作为一个块移动。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T11:17:48.797

查看相关的[enum type](http://msdn.microsoft.com/en-us/library/bb173059.aspx)，我（也）找不到任何 AxRxGxBx 格式。所以看来你需要自己做调酒，然后。

这当然非常适合[SSE 优化](http://en.wikipedia.org/wiki/Streaming_SIMD_Extensions)，检查您的编译器是否能够将代码优化为使用 SSE 的东西并且性能应该没问题。

编写此代码时请考虑字节顺序问题，很容易出错，并且如果不关心字节顺序，则很难编写此代码。

# java-me - 如何在 J2ME 中创建浏览器窗口？

> ID：653788
> 
> 赞同：6
> 
> 时间：2009-03-17T11:09:32.420
> 
> 标签：java-me

如何在 J2ME 中创建一个可以在应用程序中显示网页的浏览器组件？有没有可用的API？或者这真的可能吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-11-05T16:11:07.503

我的经历：

1.  J2MEPolish 有 HTML 浏览器。每个应用程序的费用为 990 欧元，您需要使用 J2MEPolish 才能使用它。但请注意：他们的 HTML 浏览器有很多问题，它支持表单和其他高级元素，但是如果您尝试获得您喜欢的内容，那么渲染质量就会很差（例如，没有间距，默认为中心视图等）。提供免费评估/GPL。
2.  PocketLearn J2ME HTML 组件 - [http://www.j2mehtml.com/](http://www.j2mehtml.com/)似乎功能较少但渲染质量要好得多。这也不是免费的，而且他们不提供任何有用的评估下载或公共许可费用信息。
3.  J2ME cHTML 浏览器是免费和开源的，但没有文档（也可能没有质量）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T12:13:00.067

在浏览器中显示网页的唯一可移植方式是：

```
MIDlet.platformRequest(String URL); 
```

但在某些移动设备上，这将终止 J2ME 应用程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T14:14:14.457

内容处理 API 正是您要寻找的。

那是 JSR 211。

不幸的是，为了做你想做的事，你需要找到一个包含完整且正确的 JSR211 实现的手机。

据我所知，这还不存在。

据我所知，唯一可以让您启动 Web 浏览器窗口（在 MIDlet 之外）的 J2ME 仿真器是诺基亚 Series60 仿真器。这没有 JSR 211 的完整实现。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-13T17:36:56.130

据我所知，唯一用 J2ME 编写的浏览器是 Opera Mini（不要与 Opera Mobile 混淆，这是另一回事）。即使在非常低端的手机上它也能运行得非常好，但大多数 HTML 处理是在 Opera 托管的特殊服务器上完成的，客户端会得到优化、预格式化的二进制数据来显示。

使用 Java 在手机上做所有事情可能很困难，甚至是不可能的。您可以编写一个显示非常基本的 HTML 页面的浏览器，但由于内存和 CPU 有限，在 J2ME 上即使对更复杂的页面也能正确编写代码似乎是不可能的。

我可以想象一些高端手机带有自定义 API 来将本地浏览器嵌入到您的 Midled 中，但标准的 J2ME 绝对没有这个。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-07-14T02:50:52.853

试试这个 [http://sourceforge.net/projects/fire-j2me/](http://sourceforge.net/projects/fire-j2me/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-30T12:02:06.773

不幸的是，Java ME 中没有用于呈现 html 的内置组件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-02T14:32:55.467

您可以尝试 j2mePolish 工具包 (www.j2mepolish.org) 的 htmlBrowser 组件

# asp.net-mvc - 优雅地减少 ASP.NET MVC 控制器中的依赖项数量

> ID：653789
> 
> 赞同：5
> 
> 时间：2009-03-17T11:09:34.510
> 
> 标签：asp.net-mvc, dependency-injection, dependencies, inversion-of-control

我们正在开发正在成为一个相当大的 ASP.NET MVC 项目，并且代码气味开始出现。

每个控制器都有 5 个或更多依赖项，其中一些依赖项仅用于控制器上的一种操作方法，但显然是为控制器的每个实例创建的。

我正在努力想出一种减少为 90% 的调用不必要地创建的对象数量的好方法。

以下是我正在玩弄的一些想法：

1.  将控制器拆分成更小、更有针对性的控制器。
    *   目前我们每个域实体大致有一个控制器，这导致了我们想要模拟的漂亮的 URL，这意味着我们最终会得到一个更复杂的路由方案。
2.  传入一个包装 IoC 容器的接口。
    *   这意味着只有在明确需要时才会创建对象。然而，这就像给猪涂口红一样。
3.  以某种方式扩展框架以实现两者的某种疯狂组合。

我觉得其他人一定遇到过同样的问题；那么你是如何解决这个问题的，或者你只是忍受它，因为它在你眼中并不是那么大的问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T13:23:04.360

我一直在思考这个问题的解决方案，这就是我想出的：

将您的依赖项直接注入控制器操作，而不是注入控制器构造函数。这样你只注入你需要的东西。

我真的只是把它搅了起来，所以它有点天真，没有经过愤怒的测试，但我打算尽快实施这个来尝试一下。欢迎提出建议！

它当然是特定于 StructureMap 的，但您可以轻松地使用不同的容器。

在 global.asax 中：

```
protected void Application_Start()
{
    ControllerBuilder.Current.SetControllerFactory(
            new StructureMapControllerFactory());
} 
```

这是结构映射控制器工厂：

```
public class StructureMapControllerFactory : DefaultControllerFactory
{
    protected override IController GetControllerInstance(Type controllerType)
    {
        try
        {
            var controller = 
                    ObjectFactory.GetInstance(controllerType) as Controller;
            controller.ActionInvoker = 
                    new StructureMapControllerActionInvoker();
            return controller;
        }
        catch (StructureMapException)
        {
            System.Diagnostics.Debug.WriteLine(ObjectFactory.WhatDoIHave());
            throw;

        }
    }
} 
```

和 structuremapcontrolleractioninvoker（可以更智能一点）

```
public class StructureMapControllerActionInvoker : ControllerActionInvoker
{
    protected override object GetParameterValue(
            ControllerContext controllerContext, 
            ParameterDescriptor parameterDescriptor)
    {
        object parameterValue;
        try
        {
            parameterValue = base.GetParameterValue(
                    controllerContext, parameterDescriptor);
        }
        catch (Exception e)
        {
            parameterValue = 
                    ObjectFactory.TryGetInstance(
                            parameterDescriptor.ParameterType);
            if (parameterValue == null)
                throw e;
        }
        return parameterValue;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T12:34:08.003

“服务定位器”的概念已被添加到像 Prism 这样的作品中。它的优点是减少了开销。

但是，正如你所说，它只是把东西藏在地毯下。依赖关系并没有消失，你只是让它们变得不那么明显，这违背了使用 DI 的目标之一（清楚地说明你依赖什么），所以我会小心不要过度使用它。

也许通过委派一些工作会更好地为您服务。如果您打算以某种方式重新分区控制器，您可能只想创建该类并让您的控制器通过 DI 获取它的实例。它不会降低创建成本，因为依赖关系仍然会在创建时解决，但至少您可以通过功能隔离这些依赖关系并保持路由方案简单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-17T13:41:08.560

**我会分别考虑依赖问题*和*依赖*对象的创建*。**依赖关系只是控制器源代码引用某种类型的事实。这有代码复杂性的成本，但没有运行时成本可言。另一方面，对象的实例化具有运行时成本。

减少代码依赖数量的唯一方法是分解控制器。正如您所说，其他任何事情都只是使依赖关系更漂亮一些。但是使依赖项（与依赖对象的实例化相反，我将在稍后介绍）更漂亮可能足以成为您不需要分解控制器的解决方案。因此，我认为 IoC 是一个不错的解决方案。

回复：创建对象，您写道，“......其中一些依赖项仅用于控制器上的一种操作方法，但显然是为控制器的每个实例创建的。” 这让我觉得*真正的*问题，而不是依赖，*本身*. 因为随着项目的扩展，它只会变得更糟。您可以通过更改对象的实例化来解决此问题，以便在需要它们之前不会发生。一种方法是使用延迟实例化的属性。另一种方法是使用模型绑定器的操作方法的参数来实例化您需要的对象。另一种方法是编写返回所需实例的函数。如果不知道您使用的对象的目的，很难说哪种方式最好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T22:17:46.067

你的控制器可能变得太“胖”了。我建议创建一个位于控制器下方的应用层。应用层可以封装很多在控制器动作中进行的编排，并且更易于测试。它还将帮助您组织代码，而不受指定操作方法的约束。

使用 ServiceLocation 也会有所帮助（是的，我本质上是在重申 Denis Troller 的答案——这可能不好，但我确实投票支持他的答案）。

# java - 使用 Java 解析 HTML 文件

> ID：653794
> 
> 赞同：3
> 
> 时间：2009-03-17T11:12:55.640
> 
> 标签：java

如何使用 Java 从 html 文件中删除注释和注释内容，其中注释的编写方式如下：

```
<!-- 
```

对此需要任何想法或帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T11:23:29.657

看看[JTidy](http://sourceforge.net/projects/jtidy)，它是 HTML Tidy 的 java 端口。您可以覆盖 PPrint 对象的打印方法以忽略注释标记。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T11:24:26.970

如果您没有有效的 xhtml，发布的评论让我想起了，您应该首先应用[jtidy](http://jtidy.sourceforge.net/)来整理 html 并使其成为有效的 xhtml。

有关 jtidy 的示例代码，请参见[this](http://dhillersjavanotes.blogspot.com/2009/03/using-jtidy-to-clean-up-non-valid-html.html)。

然后我会将 html 转换为 DOM 实例。

像这样：

```
final DocumentBuilderFactory newFactory = DocumentBuilderFactory.newInstance();
final DocumentBuilder documentBuilder = newFactory.newDocumentBuilder();
Document document = documentBuilder.parse( new InputSource( new StringReader( string ) ) ); 
```

然后，我将浏览文档树并根据需要修改节点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T11:25:23.100

尝试一个简单的正则表达式

```
String commentless = pageString.replaceAll("<!--[\w\W]*?-->", ""); 
```

编辑：解释正则表达式：

*   `<!--`匹配文字注释开始
*   `[\w\W]`匹配注释中的每个字符（甚至换行符）
*   `*?`匹配多个“任意字符”，但匹配可能的最小数量（不贪心）
*   `-->`关闭评论

# mysql - SQL/MySQL SELECT 和某些值的平均值

> ID：653800
> 
> 赞同：0
> 
> 时间：2009-03-17T11:16:02.607
> 
> 标签：mysql, select, average

我必须使用一个分析工具来测量每小时对服务器的 Web 服务调用。这些测量值被插入到数据库中。以下是此类测量的片段：

```
mysql> SELECT * FROM sample s LIMIT 4;  
+---------+------+-------+  
| service | hour | calls |  
+---------+------+-------+  
| WS04    |   04 |    24 |  
| WS12    |   11 |    89 |  
| WSI64   |   03 |    35 |  
| WSX52   |   01 |    25 |  
+---------+------+-------+  
4 rows in set (0.00 sec) 
```

作为最终结果，我想知道每天每小时完成的所有 Web 服务的总和。显然，这可以通过 SUM() 和 GROUP BY 轻松完成：

```
mysql> SELECT hour, SUM(calls) FROM sample s GROUP BY hour;  
+------+------------+  
| hour | SUM(calls) |  
+------+------------+  
|   00 |        634 |  
|   01 |        642 |  
|   02 |        633 |  
|   03 |        624 |  
|   04 |        420 |  
|   05 |        479 |  
|   06 |        428 |  
|   07 |        424 |  
|   08 |        473 |  
|   09 |        434 |  
|   10 |        485 |  
|   11 |        567 |  
|   12 |        526 |  
|   13 |        513 |  
|   14 |        555 |  
|   15 |        679 |  
|   16 |        624 |  
|   17 |        796 |  
|   18 |        752 |  
|   19 |        843 |  
|   20 |        827 |  
|   21 |        774 |  
|   22 |        647 |  
|   23 |        533 |  
+------+------------+  
12 rows in set (0.00 sec) 
```

我的问题是，在旧集合中，已经汇总了 [00-11] 小时内的 Web 服务调用。因此，上面列出的简单语句将导致

```
mysql> SELECT hour, SUM(calls) FROM sample s GROUP BY hour;  
+------+------------+  
| hour | SUM(calls) |  
+------+------------+  
|   00 |       6243 | <------ sum of hours 00-11!  
|   12 |        526 |  
|   13 |        513 |  
|   14 |        555 |  
|   15 |        679 |  
|   16 |        624 |  
|   17 |        796 |  
|   18 |        752 |  
|   19 |        843 |  
|   20 |        827 |  
|   21 |        774 |  
|   22 |        647 |  
|   23 |        533 |  
+------+------------+  
13 rows in set (0.00 sec) 
```

这是不希望的结果。为了使旧集 [00,12,...,23] 与新集 [00,01,...,23] 具有可比性，我希望有一个语句可以平均 [00] 的值并分配它在错过的时间，例如：

```
+------+------------+  
| hour | SUM(calls) |  
+------+------------+  
|   00 |    6243/11 |  
|   01 |    6243/11 |  
            [...]  
|   12 |        526 |  
            [...]  
|   23 |        533 |  
+------+------------+ 
```

我可以使用临时表或视图轻松地做到这一点，但没有它们我不知道如何做到这一点。

有任何想法吗？因为这让我发疯：P

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T11:24:58.623

您可能最好使用临时表/视图来执行此操作（我建议在临时表上使用视图），否则您最终会得到一个令人讨厌的特定于案例的语句，随着时间的推移，这将是一场噩梦。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T11:35:17.460

您需要一个包含 12 行的行集来进行连接。

最简单的解决方案是`SELECT`在一个联合中组合 12 条语句：

```
SELECT  COALESCE(morning.hour, sample.hour), 
        SUM(CASE WHEN morning.hour IS NULL THEN calls ELSE calls / 12 END) AS calls
FROM    sample
LEFT JOIN
        (
        SELECT 0 AS hour
        UNION ALL
        SELECT 1
        ...
        UNION ALL
        SELECT 11
        ) AS morning
ON      sample.hour = 0 AND sample.service IN ('old_service1', 'old_service2')
GROUP BY
        1 
```

# c# - .Net 基于云的存储解决方案

> ID：653802
> 
> 赞同：3
> 
> 时间：2009-03-17T11:16:36.850
> 
> 标签：c#, web-hosting, cloud-platform

我现在在没有一些帮助的情况下无法进一步发展。我正在尝试在云上托管文件，然后通过代码（C#）访问这些文件。到目前为止，我已经尝试过 Rapidshare 和 Skydrive，但根本无法让它们工作。以下是我正在尝试做的一些事情，或者说必须能够用云存储做的事情。

1.  我需要的是一个在互联网上托管文件的地方（很明显）。
2.  这些文件的大小范围从 10 兆到 100 兆。
3.  我必须能够通过代码下载文件以及通过代码上传。

只要价格不荒谬，我真的不介意付钱。任何帮助都将不胜感激。

谢谢潜行者

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-17T11:32:58.603

你为什么不看看[Amazon S3](http://aws.amazon.com/s3/)，他们做你想做的事，价格便宜，并且有一个 C# API 包装他们的 Web 服务（但[ThreeSharp](http://www.codeplex.com/ThreeSharp)更好）。

# wcf - 请求正文应该是什么样子？

> ID：653803
> 
> 赞同：5
> 
> 时间：2009-03-17T11:16:53.727
> 
> 标签：wcf, json, request, fiddler

我有一个 WCF 服务，它的方法看起来像这样（返回 null 以使用调试器进行测试，我现在只关心获取数据）：

```
[OperationContract]
[WebInvoke(Method = "POST", UriTemplate = "fares", RequestFormat = WebMessageFormat.Json, ResponseFormat = WebMessageFormat.Json, BodyStyle = WebMessageBodyStyle.WrappedRequest)]
public List<Fare> GetFares(Dictionary<int, int> itineraries, decimal? threshold, bool includeInternational)
{
    return null;
} 
```

我正在尝试使用 Fiddler 向该方法发出请求，但无法弄清楚正确的请求正文应该是什么。如果效果更好，我可以将 Dictionary 参数更改为其他参数。

在请求标头中，我通过：

> User-Agent: Fiddler
> Content-Type: application/json; 字符集=utf-8

我应该在身体里放什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T11:48:30.797

我想这就是你所追求的。

```
{
"itineraries" : [{"Key":1,"Value":2},{"Key":2,"Value":3}],
"threshold" : 1.0,
"includeInternational" : true
} 
```

字典序列化为键值数组。

# nhibernate - 为 NHibernate 中的一个属性执行自定义 sql

> ID：653805
> 
> 赞同：1
> 
> 时间：2009-03-17T11:17:18.517
> 
> 标签：nhibernate, nhibernate-mapping

据我了解，NHibernate 内置了对时间戳的支持。但是，您似乎只能指示 NHibernate 永远不要更新该属性或始终更新它。

在我目前正在处理的项目中，有几个表同时具有“ `created_time`”和“ `updated_time`”，它们都将由数据库生成。

我不知道如何指示 NHibernate仅在插入“ ”以及插入和更新“ ”时将“ `getdate()`”用于两个属性螺母。`created_time``updated_time`

这可能吗？

PS：我正在使用旧数据库，并且不允许更改它，因此触发器等不是可能的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T11:34:58.973

您可以通过创建一个设置这些值的拦截器来解决此问题，但是当然，这些值不是由 DBMS 生成的...

这可能是一种解决方法，因为我也不知道如何确保数据库填充这些值，但我也对此问题的另一种解决方案感兴趣。:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T16:49:28.873

您使用的是哪个版本的 NHibernate？

在 2.0 中，属性上的“生成”标记具有三个有效值：

*   从不（不言自明）
*   插入（将仅在插入时检索生成的值）
*   总是（总是检索生成的值）。

# c - 确定 C 可执行文件名

> ID：653807
> 
> 赞同：59
> 
> 时间：2009-03-17T11:17:58.030
> 
> 标签：c, gcc, compilation, executable, linkage

当我们编译 C 程序时，输出存储在 a.out 中。我们如何将编译后的输出重定向到另一个文件？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-03-17T11:27:41.877

大多数 C 编译器`-o`为此提供了选项，例如：

```
gcc -o gentext gentext.c
cc  -o mainprog -Llib -lmymath firstbit.c secondbit.o
xlc -o coredump coredump.c 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-17T11:20:21.693

`-ofilename`将`filename`代替`a.out`.

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-03-17T11:22:11.953

根据手册：

```
-o <file>  Place the output into <file> 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-17T11:31:00.903

在 C 语言起源的 Unix 中，C 程序通常是逐个模块编译的，然后将编译后的模块链接到可执行文件中。对于由模块`foo.c`和组成的项目，`bar.c`命令如下：

```
cc -c foo.c
cc -c bar.c
cc -o myprog foo.o bar.o 
```

（使用 -c 时，输出文件名成为源文件，后缀为 .o。）

这允许您只重新编译那些已更改的模块，这可以为大型程序节省大量时间，但也可能变得非常棘手。（这部分通常使用 自动化`make`。）

对于单模块程序，首先编译为 .o 文件，然后进行链接没有任何意义，因此一个命令就足够了：

```
cc -o foo foo.c 
```

对于单模块程序，习惯上将生成的可执行程序称为与不带 .c 后缀的 C 源文件相同的程序。对于多模块程序，输出是否以具有 main 函数的文件命名并没有硬性规定，因此您可以自由地发明任何您喜欢的东西。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2018-12-12T11:01:21.907

带`-o`选项。

```
gcc main.c -o myCoolExecutable.o 
```

如果您的程序由单个文件组成，这没关系。如果您有更多文件，我建议您使用`make`：创建一个`Makefile`然后运行该命令`make`。

A`Makefile`是一个包含一些编译规则的文件。示例如下（`#`表示该行是注释）：

```
CXX = gcc

#CXXFLAGS = -std=c++11
#INC_PATH = ...
#LIBS = ...

SOURCEDIR := yourSourceFolder
SOURCES := $(wildcard $(SOURCEDIR)/*.c)
OBJDIR=$(SOURCEDIR)/obj

OBJECTS := $(patsubst $(SOURCEDIR)/%.c,$(OBJDIR)/%.o, $(SOURCES))
DEPENDS := $(patsubst $(SOURCEDIR)/%.c,$(OBJDIR)/%.d, $(SOURCES))

# ADD MORE WARNINGS!
WARNING := -Wall -Wextra

# .PHONY means these rules get executed even if
# files of those names exist.
.PHONY: all clean

# The first rule is the default, ie. "make",
# "make all" and "make parking" mean the same
all: yourExecutableName

clean:
    $(RM) $(OBJECTS) $(DEPENDS) yourExecutableName

# Linking the executable from the object files
# $^   # "src.c src.h" (all prerequisites)
yourExecutableName: $(OBJECTS)
    $(CXX) $(WARNING) $^ -o $@
    #$(CXX) $(WARNING) $(CXXFLAGS) $(INC_PATH) $^ -o $@ $(LIBS)

-include $(DEPENDS)

$(OBJDIR):
    mkdir -p $(OBJDIR)

$(OBJDIR)/%.o: $(SOURCEDIR)/%.c Makefile | $(OBJDIR)
    $(CXX) $(WARNING) -MMD -MP -c $< -o $@ 
```

很快`CXX`变量定义了你的编译器（gcc，g++），`with CXXFLAGS`你可以为你的编译定义标志（即`-std=c++11`）。然后您可以包含并定义自定义（`INC_PATH`和`LIBS`：示例中未设置）。`SOURCEDIR`您可以指定您的源代码目录（`*.c`文件所在的位置）。然后`SOURCES`基本上告诉编译的源文件是所有具有扩展名的文件`*.c`。

`Makefile`包含一组规则，其结构如下：

```
output: inputs
    commandToExecute 
```

生成可执行文件的规则是

```
yourExecutableName: $(OBJECTS)
    $(CXX) $(WARNING) $^ -o $@ 
```

这相当于`gcc -Wall -Wextra $(OBJECTS) -o yourExecutableName`。

`$(OBJECTS)`是编译产生的目标文件。当上面的规则被执行时，如果没有找到，make 会继续扫描文件寻找规则来生成它们。在这种情况下，生成这些文件的规则是：

```
$(OBJDIR)/%.o: $(SOURCEDIR)/%.c Makefile | $(OBJDIR)
    $(CXX) $(WARNING) -MMD -MP -c $< -o $@ 
```

如果需要更多信息，请告诉我。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2018-12-12T10:09:39.817

如果`foo`将是您的可执行文件并且`bar.c`是您的源文件，那么命令是：

```
gcc -o foo bar.c 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-08-09T08:20:31.013

编译使用：

```
cc -o <opfilename> <filename.c> 
```

执行使用：

```
./<opfilename> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-12-25T10:25:31.800

**C语言中根据用户选择给出.exe文件名的格式**

****第 1 步**：-**在终端上以以下格式运行 gcc（或您拥有的编译器）

```
 gcc -o put_your_name_you_want_to_give (space) your_file_name_you_want_to_execute 
```

注意：- 如果您正在运行**“Vs Code”**，请使用“Tab”键自动完成。

****第 2 步**：-**以格式记下程序的名称

```
 .\the_name_you_have_given.exe 
```

你完成了！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-05-03T08:16:12.160

假设你在 ubuntu

**第 1 步：**使用这些命令运行 gcc 进行编译`filename.c`

`gcc filename.c -o filename.out`

*   `filename.out`将被创建，（它可能会或可能不会显示其他文件的存储位置）

**步骤 2：**执行`filename.out`by

`./filename.out`

**第三步**：等待输出

就是这样，你完成了

# php - Zend Framework 和 Django 之间在现实世界中的区别是什么？

> ID：653809
> 
> 赞同：10
> 
> 时间：2009-03-17T11:19:05.017
> 
> 标签：php, django, zend-framework

当谈到 Web 应用程序时，我是一个长期的 PHP 用户，并且最喜欢它。但是，我有一个半大型项目，其维护/可扩展性已达到生命周期的终点。我在权衡不同的 PHP 框架（项目起源时没有），因为它是这个项目的方式，我得出的结论是，ebst 选择是使用 Zend 框架来完成。

*   Symfony 似乎很复杂（我不喜欢那样设置数据库模型
*   CakePHP 看起来很模糊
*   一开始我很喜欢 Igniter，但后来在我看来它更像是 Zend，功能更少，背后没有 Zend
*   Zend 我喜欢这个系统，我可以只使用我喜欢的东西，而不是绑定到特定的目录结构中，当然它背后有 Zend。性能是可能困扰我的

现在，在选择 Zend 背后的这个小理由之后，我认为在选择框架时有几件事情会破坏交易。

*   过去我没有使用过 ORM，因为我非常喜欢直接编写 SQL，所以我仍然需要被说服使用 ORM
*   没有太多的抽象从胆量发生
*   灵活的目录结构

只要这个项目要重新编写，我就可以用 Python/Django 编写它，因为我非常熟悉 Python，但不熟悉 Django。所以，我想知道是否有人同时使用 Zend 框架和 Django 框架，是否可以概述一些关键点差异？

我还必须说，这个项目是作为标准站点/管理员双重项目制作的。也就是说，它基本上是两个站点合二为一。一个用于前端和用户，另一个用于后端的数据管理。我必须并且将自己构建后端，一些脚手架方法会很酷，但在这种情况下，全自动脚手架就像没有一样好。

我仍然很不确定一种方法是如何在一个目录结构中构建两个应用程序的，应该是一个应用程序。您是否只是制作了两个单独的应用程序并从那里开始依赖 URL 方案将它们分开？www.example.com 和所有 /* 是一个应用程序，而 www.example.com/admin/* 是第二个应用程序。

抱歉，问题很长，但正如您所见 - 一切都与一个问题密切相关 - 我需要重新开始一个项目，它已经建立了我可以改造的数据库+数据，但想保留它至少是一种工作。

* * *

好的，谢谢大家 - 看起来我会尝试用 Zend 来实现这些东西，这给了我最大的灵活性（我对两者都做了测试），我们会看看它是如何进行的。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-17T11:27:58.443

好吧，Django 比 Zend 更全栈框架。它比 Zend 更类似于 symfony。

Django 可以将您的数据库反向工程为 ORM 类。并且有一个 cli 工具可以帮助你做一些事情（管理员和模型生成器，项目骨架生成等）

Zend 更像是一个组件框架。它有自己的 MVC 和 ORM 实现，但你需要单独编写这些东西。它的方法是只使用你需要的东西而不强加一些目录结构。

在您的情况下，Django 将具有一些优势，因为它具有出色的管理生成器模块，并且 Django 本身非常快（比大多数 PHP 框架快）。

我个人使用 symfony 和 Zend 框架来处理我需要的一些东西（邮件、OpenID、Lucene 搜索），但我也玩过 Django，我喜欢它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-17T12:01:31.173

Zend 不包含真正的 ORM。它提供了一些帮助类，但您主要靠自己对数据库进行建模和编写自己的 SQL 查询。所以你在那里会有完全的自由。正如 Deresh 所说，Zend 是模块化的，因此您可以挑选所需的部分。

就我个人而言，我将 Zend 与来自 PEAR 的 DB_DataObjects 一起使用，就像 ORM 一样。它可以自动生成你的骨架代码。这是处理简单查询的一个非常简单的解决方案，但我总是可以在必要时编写自定义 SQL。

关于两个管理员和前端的分离，我建议将它们放在不同的域中，例如：admin.yoursite.com（后端）和 www.yoursite.com（前端）。您可能可以将它们都放在同一个 URL 上，但这并不是 Django 或 Zend 支持的真正用例。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T19:54:18.267

我对 Django 的经验不是很丰富，但从我所读到的内容来看，它似乎并不是你想要的（太多的“胆量抽象”）。Zend 框架没有为您提供 ORM。它为您提供了一些可能有助于代码可维护性的工具（例如，在 Zend_Db_Table_Row 对象上执行 $user->save() 然后手动键入等效的 SQL 字符串要容易得多）。如果您更习惯于使用 SQL，那非常酷，Zend 对此进行了深入研究……请注意，在此过程中可能会遇到更多维护问题。我建议使用“命名查询”方法，将查询存储在外部资源中并“按需”加载它们。Zend 有一个非常灵活的目录结构...... 推荐的仅有助于使事情变得更容易。您可以使用轻松拉出您的管理部分网址[模块](http://framework.zend.com/manual/en/zend.controller.modular.html)和路由......这是 Zend 中非常常见的用例。

底线是，Zend 主要是一个“表示框架”。这就是它擅长的地方。它为您提供了一种清晰的方式来组织向用户显示的演示文稿（屏幕）并有助于维护。

从数据的角度来看，它对您没有多大帮助。这取决于您，并且可能是需要完成的工作的 90% 才能变得“可维护”。

目标是您的业务逻辑内容和数据访问内容应该在任何“框架”中运行，即使没有 Web 服务器！否则，您只会将无法维护的混乱从您拥有的任何东西转移到 Zend。

另外，我不关心性能......通过良好的缓存策略可以解决棘手的问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T22:23:57.330

我无法在 Zend 和 Django 之间进行比较，但我可以告诉你，让 Django “管理”应用程序在不同的域（虚拟命名服务器）上运行是完全可能的，而且你不需要复制任何代码。您只需像往常一样构建您的 Django 应用程序，但将管理应用程序和 url 放在共享公共数据库服务器/集群的不同虚拟服务器中。

Django 管理应用程序确实有限制，但它对于几乎免费的东西来说非常强大。

最后，当我第一次开始使用 Django 时，我对 ORM 有很多不屑，但我现在接受它们作为工具箱中的有用工具。

# linux - 为什么我的 iptables 条目不阻止 ping Xen 虚拟机？

> ID：653812
> 
> 赞同：0
> 
> 时间：2009-03-17T11:20:18.790
> 
> 标签：linux, iptables, xen

我正在编写一个 bash 脚本来为 Xen 添加简单的防火墙。

这是实际的防火墙配置：

```
Chain INPUT (policy ACCEPT)
target     prot opt source               destination
RH-Firewall-1-INPUT  all  --  anywhere             anywhere

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination
RH-Firewall-1-INPUT  all  --  anywhere             anywhere

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination

Chain RH-Firewall-1-INPUT (2 references)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
ACCEPT     icmp --  anywhere             anywhere            icmp any
ACCEPT     esp  --  anywhere             anywhere
ACCEPT     ah   --  anywhere             anywhere
ACCEPT     udp  --  anywhere             224.0.0.251         udp dpt:mdns
ACCEPT     udp  --  anywhere             anywhere            udp dpt:ipp
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:ipp
ACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED
ACCEPT     udp  --  anywhere             anywhere            state NEW udp dpt:ha-cluster
ACCEPT     tcp  --  anywhere             anywhere            state NEW tcp dpt:ssh
ACCEPT     tcp  --  anywhere             anywhere            state NEW tcp dpt:http
ACCEPT     tcp  --  anywhere             anywhere            state NEW tcp dpt:https
REJECT     all  --  anywhere             anywhere            reject-with icmp-host-prohibited 
```

我想为我的每个虚拟机添加一个新链（每个虚拟机都有一个名为 vif1.0、vif2.0 等的虚拟接口）。输出接口（桥接）是xenbr0。

这是我所做的（例如阻止 ping 'in'to domU1, vif1.0）：

```
iptables -N domUFirewall
iptables -I FORWARD -j domUFirewall
iptables -I INPUT -j domUFirewall
iptables -A domUFirewall -i vif1.0 -p icmp -j DROP 
```

但是..它不起作用，我仍然能够ping入/出domU。

一定是真的“愚蠢”，但我不知道出了什么问题。

有什么线索吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T15:21:53.797

由于您将 XEN 与桥接网络一起使用，因此在普通 iptables 命令影响它们之前，数据包会被拦截。因此，您可能需要使用该`ebtables`命令以您想要的方式影响数据包路由。

*   [基于 Linux 的网桥上的 ebtables/iptables 交互](http://ebtables.sourceforge.net/br_fw_ia/br_fw_ia.html)
*   [ebtables(8) - Linux 手册页](http://linux.die.net/man/8/ebtables)
*   [Xen Wiki * XenNetworking](http://wiki.xensource.com/xenwiki/XenNetworking)

下面留下的原始答案适用于其他配置，但不适用于具有桥接网络的 XEN。

我将假设 IP 地址`vif1.0`是 192.168.1.100。

我会重做逻辑，不检查输入设备，而是按 IP 地址检查。在输入链上，数据包来自（比如说） device `eth0`，而不是来自`vif1.0`。因此，这条规则：

```
iptables -I INPUT -i vif1.0 -j domUFirewall 
```

我之前提出的永远不会匹配任何数据包。但是，如果您执行以下操作，它应该执行您想要的操作：

```
iptables -I INPUT -d 192.168.1.100 -j domUFirewall 
```

在这种情况下，链`domUFirewall`由以下方式设置：

```
iptables -N domUFirewall
iptables -F domUFirewall
iptables -A domUFirewall -p icmp -j DROP 
```

如果给定的链是针对单个设备的，那么您希望在跳入链**之前**`-j chainName`根据带有“ ”操作的规则进行此检查。然后，在链本身中，您无需检查设备或 IP 地址。

其次，我总是会刷新（清空）脚本中的链，以防万一你重新运行脚本。请注意，当您重新运行脚本时，您可能会`-N`在线收到投诉。没关系。

还有其他方法可以做到这一点，但举一个不同的例子，我需要具体了解你的虚拟机是如何设置的——桥接网络？NAT？等等。但是我在这里给出的例子应该可以在任何这些模式下工作。

以下是一些对未来有用的链接：

*   [Quick HOWTO，第 14 章：使用 iptables 的 Linux 防火墙](http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO_:_Ch14_:_Linux_Firewalls_Using_iptables)
*   [使用 iptables 沙箱化 VMware 虚拟机](http://lonnieolson.com/blog/2007/08/27/sandbox-a-vmware-virtual-machine-with-iptables/)

# sql - 在 MySQL 中使用 SUM() 进行更新

> ID：653826
> 
> 赞同：5
> 
> 时间：2009-03-17T11:26:08.527
> 
> 标签：sql, mysql

### 我的桌子：

```
ID 名称 COST PAR P_val S_val
1×5 0 1 0
1 年 5 0 2 0
1 z 5 0 0 5
2 XY 4 0 4 4

```

我需要`PAR`使用按 ID 分组的 更新字段`SUM(S_val)`：

*   对于 ID 1`PAR`应该是`SUM(SVAL) WHERE ID=1`
*   对于 ID 2`PAR`应该是`SUM(SVAL) WHERE ID=2`

### 预期输出：

```
ID 名称 COST PAR P_val S_val
1×5 5 1 0
1 年 5 5 2 0
1 z 5 5 0 5     
2 XY 4 4 4 4

```

我怎么能`UPDATE`值`PAR`？

### 我的代码：

```
UPDATE Table_Name SET PAR = (SELECT SUM(S_val) FROM Table_Name WHERE ID=1) 
FROM   Table_Name 
```

这不起作用。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-17T12:38:37.277

不幸的是，您无法更新在`MySQL`.

您需要创建一个函数作为解决方法：

```
DELIMITER $$

CREATE FUNCTION `fn_get_sum`(_id INT) RETURNS int(11)
READS SQL DATA
BEGIN
      DECLARE r INT;
      SELECT  SUM(s_val)
      INTO    r
      FROM    table_name
      WHERE   id = _id;
      RETURN r;
END $$

DELIMITER ;

UPDATE  table_name
SET     par = fn_get_sum(id) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T11:29:53.930

尝试：

```
UPDATE Table_NAme SET PAR= summedValue
FROM   TAble_NAME t
JOIN (
  SELECT ID, SUM(S_val) as summedvalue 
  FROM TABLE_NAME GROUP BY ID
  ) s on t.ID = s.ID 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-12T11:46:30.167

```
UPDATE Table_Name SET PAR = (SELECT SUM(S_val) FROM Table_Name WHERE ID=1) 
FROM   Table_Name 
```

检查写作。删除“FROM Table_Name”行。

TRUE 命令是：

```
UPDATE Table_Name SET PAR = (SELECT SUM(S_val) FROM Table_Name WHERE ID=1) 
```

# nhibernate - 是否可以在 NHibernate 中急切加载两个一对多的关系？

> ID：653833
> 
> 赞同：1
> 
> 时间：2009-03-17T11:29:23.417
> 
> 标签：nhibernate, eager

给定一个对象层次结构，如下所示：

```
class Category
{
    List<SubCategory> SubCategories;
}

class SubCategory
{
    List<Product> Products;
}

class Product
{
} 
```

是否可以使用 NHibernate 急切加载整个层次结构？我想执行一个查询来加载所有带有子类别的类别和急切加载的产品。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T11:45:40.850

是的，有可能……但是，您不认为这会对性能产生一些影响吗？您可能会检索到大量数据。

为此，您必须使用 ICriteria 的“SetFetchMode”方法来检索实例。

像这样的东西：

```
ICriteria crit = session.CreateCriteria (typeof(Category));

crit.SetFetchMode ("SubCategories", FetchMode.Eager); 
```

或者，也许通过使用 CreateAlias：

```
ICriteria crit = session.CreateCriteria (typeof(Category));

crit.CreateAlias ("SubCategories", "sc", JoinType.LeftOuterJoin);
crit.CreateAlias ("sc.Products", "p", JoinType.InnerJoin); 
```

也许您将不得不根据您的情况/您想要的内容对可能的 JoinTypes 进行一些操作。

# .net - 您如何通过 .Net 代码截取网站的屏幕截图？

> ID：653834
> 
> 赞同：15
> 
> 时间：2009-03-17T11:29:53.387
> 
> 标签：.net, web, screenshot

是否可以使用 .Net 代码截取任何给定 URL 的屏幕截图？

最简单的方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T13:54:06.563

刚刚偶然发现：http: [//pietschsoft.com/post/2008/07/C-Generate-WebPage-Thumbmail-Screenshot-Image.aspx](http://pietschsoft.com/post/2008/07/C-Generate-WebPage-Thumbmail-Screenshot-Image.aspx)

也许你可以使用的东西？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T11:37:17.597

我建议为此使用第三方方法，而不是自己做。但是，如果您坚持，那么严厉的方法是使用`System.Diagnostics.Process`启动浏览器，然后`GetDesktopImage`获取屏幕截图。

我确信有一种更简单的方法，但看起来像这样：

```
using System;
using System.Drawing;
using System.Drawing.Imaging;
using System.Runtime.InteropServices;

public class PlatformInvokeGDI32
{
    public  const int SRCCOPY = 13369376;

    [DllImport("gdi32.dll",EntryPoint="DeleteDC")]
    public static extern IntPtr DeleteDC(IntPtr hDc);

    [DllImport("gdi32.dll",EntryPoint="DeleteObject")]
    public static extern IntPtr DeleteObject(IntPtr hDc);

    [DllImport("gdi32.dll",EntryPoint="BitBlt")]
    public static extern bool BitBlt(IntPtr hdcDest, int xDest, int yDest, int wDest, int hDest, IntPtr hdcSource, int xSrc, int ySrc, int RasterOp);

    [DllImport ("gdi32.dll",EntryPoint="CreateCompatibleBitmap")]
    public static extern IntPtr CreateCompatibleBitmap(IntPtr hdc,int nWidth, int nHeight);

    [DllImport ("gdi32.dll",EntryPoint="CreateCompatibleDC")]
    public static extern IntPtr CreateCompatibleDC(IntPtr hdc);

    [DllImport ("gdi32.dll",EntryPoint="SelectObject")]
    public static extern IntPtr SelectObject(IntPtr hdc,IntPtr bmp);
}

public class PlatformInvokeUSER32
{
    public const int SM_CXSCREEN = 0;
    public const int SM_CYSCREEN = 1;

    [DllImport("user32.dll", EntryPoint="GetDesktopWindow")]
    public static extern IntPtr GetDesktopWindow();

    [DllImport("user32.dll",EntryPoint="GetDC")]
    public static extern IntPtr GetDC(IntPtr ptr);

    [DllImport("user32.dll",EntryPoint="GetSystemMetrics")]
    public static extern int GetSystemMetrics(int abc);

    [DllImport("user32.dll",EntryPoint="GetWindowDC")]
    public static extern IntPtr GetWindowDC(Int32 ptr);

    [DllImport("user32.dll",EntryPoint="ReleaseDC")]
    public static extern IntPtr ReleaseDC(IntPtr hWnd,IntPtr hDc);
}

public class CaptureScreen
{
    public static Bitmap GetDesktopImage()
    {
        //In size variable we shall keep the size of the screen.
        SIZE size;

        //Variable to keep the handle to bitmap.
        IntPtr hBitmap;

        //Here we get the handle to the desktop device context.
        IntPtr  hDC = PlatformInvokeUSER32.GetDC(PlatformInvokeUSER32.GetDesktopWindow());

        //Here we make a compatible device context in memory for screen device context.
        IntPtr hMemDC = PlatformInvokeGDI32.CreateCompatibleDC(hDC);

        //We pass SM_CXSCREEN constant to GetSystemMetrics to get the
        //X coordinates of the screen.
        size.cx = PlatformInvokeUSER32.GetSystemMetrics(PlatformInvokeUSER32.SM_CXSCREEN);

        //We pass SM_CYSCREEN constant to GetSystemMetrics to get the Y coordinates of the screen.
        size.cy = PlatformInvokeUSER32.GetSystemMetrics (PlatformInvokeUSER32.SM_CYSCREEN);

        //We create a compatible bitmap of the screen size and using the screen device context.
        hBitmap = PlatformInvokeGDI32.CreateCompatibleBitmap(hDC, size.cx, size.cy);

        //As hBitmap is IntPtr, we cannot check it against null.
        //For this purpose, IntPtr.Zero is used.
        if(hBitmap != IntPtr.Zero)
        {
            //Here we select the compatible bitmap in the memeory device
            //context and keep the refrence to the old bitmap.
            IntPtr hOld = (IntPtr) PlatformInvokeGDI32.SelectObject(hMemDC, hBitmap);

            //We copy the Bitmap to the memory device context.
            PlatformInvokeGDI32.BitBlt(hMemDC, 0, 0, size.cx, size.cy, hDC, 0, 0, PlatformInvokeGDI32.SRCCOPY);

            //We select the old bitmap back to the memory device context.
            PlatformInvokeGDI32.SelectObject(hMemDC, hOld);

            //We delete the memory device context.
            PlatformInvokeGDI32.DeleteDC(hMemDC);

            //We release the screen device context.
            PlatformInvokeUSER32.ReleaseDC(PlatformInvokeUSER32.GetDesktopWindow(), hDC);

            //Image is created by Image bitmap handle and stored in local variable.
            Bitmap bmp = System.Drawing.Image.FromHbitmap(hBitmap);

            //Release the memory to avoid memory leaks.
            PlatformInvokeGDI32.DeleteObject(hBitmap);

            //This statement runs the garbage collector manually.
            GC.Collect();

            //Return the bitmap
            return bmp;
        }

        //If hBitmap is null, retun null.
        return null;
    }
}

//This structure shall be used to keep the size of the screen.
public struct SIZE
{
  public int cx;
  public int cy;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T11:45:07.297

有几个 3rd 方组件可以做到这一点。显然这不是微不足道的，因为例如 Flash 之类的东西并不容易捕获。

我过去使用过[HTMLSnapshot](http://www.guangmingsoft.net/htmlsnapshot/help.htm)并且对它很满意（它不是免费的，但相当便宜）。

我衷心建议您不要浪费太多时间自己实施此操作，因为您最终必然会重做这些 3rd 方解决方案已经处理的许多最终案例。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-11-28T05:50:04.830

我进行了广泛搜索以找到解决此问题的方法，而使用 WebBrowser 和其他建议的问题是您需要大量访问该框。

迄今为止，这是我能找到的最好的第三方工具：

[http://www.websitesscreenshot.com/](http://www.websitesscreenshot.com/)

他们的 SEO 很糟糕，但我相信我是在论坛甚至 Stack 上找到他们的……我确实拥有一个许可证，而你得到的只是一个可以参考的 DLL。将许可证传递给构造函数会删除它们的水印。

在快速浏览 ILSpy 之后，我相信它的作用是解释 HTML 并转储图像以供您查看。

**用法**

*保存网址*

```
WebsitesScreenshot.WebsitesScreenshot  _Obj;
_Obj = new WebsitesScreenshot.WebsitesScreenshot ();
WebsitesScreenshot.WebsitesScreenshot.Result _Result;
_Result = _Obj.CaptureWebpage("http://www.google.com");
if (_Result == WebsitesScreenshot.WebsitesScreenshot.Result.Captured)
{
    _Obj.ImageFormat = WebsitesScreenshot.
        WebsitesScreenshot.ImageFormats.PNG;
    _Obj.SaveImage ("c:\\google.png");
}            
_Obj.Dispose(); 
```

*保存原始 HTML 字符串*

```
WebsitesScreenshot.WebsitesScreenshot _Obj;
_Obj=new WebsitesScreenshot.WebsitesScreenshot();
WebsitesScreenshot.WebsitesScreenshot.Result _Result;
_Result = _Obj.CaptureHTML(
"<html><body><h1> Hello world </h1></body></html>");
if (_Result == WebsitesScreenshot.WebsitesScreenshot.Result.Captured)
{
    _Obj.ImageFormat = WebsitesScreenshot.
        WebsitesScreenshot.ImageFormats.GIF;
    _Obj.SaveImage("c:\\test.gif");
}
_Obj.Dispose(); 
```

您可以在他们的使用页面上找到更多信息。在这里找到：

[http://www.websitesscreenshot.com/Usage.html](http://www.websitesscreenshot.com/Usage.html)

希望这可以帮助 ！

干杯！！

# windows-mobile - windows mobile中通过com端口发送数据（紧凑框架）

> ID：653838
> 
> 赞同：1
> 
> 时间：2009-03-17T11:30:49.107
> 
> 标签：windows-mobile, compact-framework, serial-port

我需要创建一个虚拟 com 端口，以便当设备（windows mobile）usb 端口连接到跟踪盒串行端口时，将引线放入其中，将一个 com 端口添加到设备中。我想使用 gprs 通过 com 端口将数据发送到我们在跟踪框中设置的指定地址和端口号

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T12:11:18.467

[SerialPort](http://msdn.microsoft.com/en-us/library/system.io.ports.serialport.aspx) t 类应该支持这一点。[在MSDN](http://msdn.microsoft.com/en-us/library/system.io.ports.serialport.aspx)上查看它。

正如版本信息所示，它符合 .NET CF 3.5 & 2.0

# c - C 宏有什么用？

> ID：653839
> 
> 赞同：78
> 
> 时间：2009-03-17T11:30:50.357
> 
> 标签：c, macros, c-preprocessor, language-design, language-features

我已经写了一点 C 语言，我可以很好地阅读它以大致了解它在做什么，但是每次我遇到一个宏时，它都让我彻底崩溃。我最终不得不记住宏是什么，并在阅读时将其替换在脑海中。我遇到的那些直观易懂的总是像小函数一样，所以我一直想知道为什么它们不只是函数。

我可以理解需要在预处理器中为调试或跨平台构建定义不同的构建类型，但定义任意替换的能力似乎只会使已经很难理解的语言变得更加难以理解。

为什么要为 C 引入如此复杂的预处理器？有没有人有一个使用它的例子，这会让我明白为什么它似乎仍然用于#debug 样式条件编译以外的其他目的？

编辑：

阅读了许多答案，我仍然不明白。最常见的答案是内联代码。如果 inline 关键字不这样做，那么要么它有充分的理由不这样做，要么实现需要修复。我不明白为什么需要一种完全不同的机制，这意味着“真正内联这段代码”（除了在内联之前编写的代码之外）。我也不理解提到的“如果它太愚蠢而不能放入函数中”的想法。当然，任何接受输入并产生输出的代码都最好放在函数中。我想我可能没有得到它，因为我不习惯编写 C 的微优化，但预处理器感觉就像是一些简单问题的复杂解决方案。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-03-17T11:46:50.130

> 我最终不得不记住宏是什么，并在阅读时将其替换在脑海中。

这似乎很难反映宏的命名。`log_function_entry()`如果预处理器是宏 ，我会假设您不必模拟预处理器。

> 我遇到的那些直观易懂的总是像小函数一样，所以我一直想知道为什么它们不只是函数。

通常它们应该是，除非它们需要对泛型参数进行操作。

```
#define max(a,b) ((a)<(b)?(b):(a)) 
```

将适用于任何类型的`<`操作员。

不仅仅是函数，宏允许您使用源文件中的符号执行操作。这意味着您可以创建一个新的变量名称，或引用宏所在的源文件和行号。

在 C99 中，宏还允许您调用可变参数函数，例如`printf`

```
#define log_message(guard,format,...) \
   if (guard) printf("%s:%d: " format "\n", __FILE__, __LINE__,__VA_ARGS_);

log_message( foo == 7, "x %d", x) 
```

格式的工作方式类似于`printf`. 如果守卫为真，它会输出消息以及打印消息的文件和行号。如果它是一个函数调用，它不会知道你从中调用它的文件和行，并且使用 a`vaprintf`会多一些工作。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-03-18T00:26:56.130

通过比较`C`宏的几种使用方式以及如何在`D`.

[从 DigitalMars.com 复制](http://www.digitalmars.com/d/2.0/pretod.html)

> 早在`C`发明之时，编译器技术还很原始。在前端安装文本宏预处理器是添加许多强大功能的简单直接的方法。程序的规模和复杂性不断增加，这表明这些特性伴随着许多固有的问题。`D`没有预处理器；但`D`提供了一种更具可扩展性的方法来解决相同的问题。

## 宏

预处理器宏为`C`. 但它们有一个缺点：

*   宏没有范围的概念；它们从定义点到源代码结束都是有效的。他们对 .h 文件、嵌套代码等进行了广泛`#include`的处理。当编写数万行宏定义时，避免无意中的宏扩展会成为问题。
*   调试器不知道宏。尝试使用符号数据调试程序会被调试器破坏，只知道宏扩展，而不知道宏本身。
*   宏使得无法对源代码进行标记，因为早期的宏更改可以任意重做标记。
*   宏的纯文本基础导致任意和不一致的使用，使得使用宏的代码容易出错。（一些尝试解决这个问题的方法是在 中引入了模板`C++`。）
*   宏仍然用于弥补语言表达能力的不足，例如头文件周围的“包装”。

下面列举了宏的常见用途，以及 D 中的相应功能：

1.  定义文字常量：

    *   预`C`处理器方式

        ```
        #define VALUE 5 
        ```

    *   `D`方式_

        ```
        const int VALUE = 5; 
        ```

2.  创建值或标志列表：

    *   预`C`处理器方式

        ```
        int flags:
        #define FLAG_X  0x1
        #define FLAG_Y  0x2
        #define FLAG_Z  0x4
        ...
        flags |= FLAG_X; 
        ```

    *   `D`方式_

        ```
        enum FLAGS { X = 0x1, Y = 0x2, Z = 0x4 };
        FLAGS flags;
        ...
        flags |= FLAGS.X; 
        ```

3.  设置函数调用约定：

    *   预`C`处理器方式

        ```
        #ifndef _CRTAPI1
        #define _CRTAPI1 __cdecl
        #endif
        #ifndef _CRTAPI2
        #define _CRTAPI2 __cdecl
        #endif

        int _CRTAPI2 func(); 
        ```

    *   `D`方式_

        可以在块中指定调用约定，因此无需为每个函数更改它：

        ```
        extern (Windows)
        {
            int onefunc();
            int anotherfunc();
        } 
        ```

4.  简单的泛型编程：

    *   预`C`处理器方式

        根据文本替换选择要使用的函数：

        ```
        #ifdef UNICODE
        int getValueW(wchar_t *p);
        #define getValue getValueW
        #else
        int getValueA(char *p);
        #define getValue getValueA
        #endif 
        ```

    *   `D`方式_

        `D`启用作为其他符号别名的符号声明：

        ```
        version (UNICODE)
        {
            int getValueW(wchar[] p);
            alias getValueW getValue;
        }
        else
        {
            int getValueA(char[] p);
            alias getValueA getValue;
        } 
        ```

[DigitalMars 网站](http://www.digitalmars.com/d/2.0/pretod.html)上有更多示例。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-05-14T11:03:56.480

它们是 C 之上的一种编程语言（一种更简单的语言），因此它们对于在编译时进行元编程很有用......换句话说，您可以编写宏代码，以更少的行数和时间生成 C 代码直接用C写。

它们对于编写“多态”或“重载”的“函数式”表达式也非常有用；例如，一个 max 宏定义为：

```
#define max(a,b) ((a)>(b)?(a):(b)) 
```

适用于任何数字类型；在 C 中你不能写：

```
int max(int a, int b) {return a>b?a:b;}
float max(float a, float b) {return a>b?a:b;}
double max(double a, double b) {return a>b?a:b;}
... 
```

即使你想要，因为你不能重载函数。

更不用说条件编译和文件包括（也是宏语言的一部分）......

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2011-11-09T07:00:33.467

宏允许某人在编译期间修改程序行为。考虑一下：

*   C 常量允许在开发时修复程序行为
*   C 变量允许在执行时修改程序行为
*   C 宏允许在编译时修改程序行为

在编译时意味着未使用的代码甚至不会进入二进制文件，并且构建过程可以修改这些值，只要它与宏预处理器集成即可。示例：make ARCH=arm（假设转发宏定义为 cc -DARCH=arm）

简单例子：（来自glibc limits.h，定义long的最大值）

```
#if __WORDSIZE == 64
#define LONG_MAX 9223372036854775807L
#else
#define LONG_MAX 2147483647L
#endif 
```

如果我们正在编译 32 位或 64 位，则在编译时验证（使用#define __WORDSIZE）。使用 multilib 工具链，使用参数 -m32 和 -m64 可能会自动更改位大小。

（POSIX 版本请求）

```
#define _POSIX_C_SOURCE 200809L 
```

编译期间的请求 POSIX 2008 支持。标准库可能支持许多（不兼容的）标准，但使用此定义，它将提供正确的函数原型（例如：getline()、无gets() 等）。例如，如果库不支持该标准，它可能会在编译时给出#error，而不是在执行期间崩溃。

（硬编码路径）

```
#ifndef LIBRARY_PATH
#define LIBRARY_PATH "/usr/lib"
#endif 
```

在编译期间定义硬代码目录。例如，可以使用 -DLIBRARY_PATH=/home/user/lib 进行更改。如果那是一个 const char *，你会在编译期间如何配置它？

（pthread.h，编译时的复杂定义）

```
# define PTHREAD_MUTEX_INITIALIZER \
  { { 0, 0, 0, 0, 0, 0, { 0, 0 } } } 
```

可能会声明大量文本，否则可能不会被简化（总是在编译时）。使用函数或常量（在编译时）是不可能做到这一点的。

为了避免真正使事情复杂化并避免暗示糟糕的编码风格，我不会给出在不同的、不兼容的操作系统中编译的代码示例。为此使用您的交叉构建系统，但应该清楚的是，预处理器允许在没有构建系统帮助的情况下实现这一点，也不会因为缺少接口而中断编译。

最后，考虑条件编译在嵌入式系统上的重要性，在嵌入式系统中，处理器速度和内存有限，系统非常异构。

现在，如果您问，是否可以用正确的定义替换所有宏常量定义和函数调用？答案是肯定的，但它不会简单地消除在编译期间改变程序行为的需要。仍然需要预处理器。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-03-17T11:39:07.637

请记住，宏（和预处理器）来自 C 的早期。它们曾经是执行内联“函数”的唯一方法（因为，当然，内联是一个非常新的关键字），它们仍然是强制内联的唯一方法。

此外，宏是您可以在编译时执行诸如将文件和行插入字符串常量之类的技巧的唯一方法。

这些天来，宏曾经是唯一方法的许多事情通过更新的机制得到了更好的处理。但他们仍然有自己的位置，有时。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-03-17T12:22:43.243

除了内联提高效率和条件编译外，宏还可用于提高低级 C 代码的抽象级别。C 并没有真正让您远离内存和资源管理以及数据的精确布局的细节，并且支持非常有限的信息隐藏形式和其他管理大型系统的机制。使用宏，您不再局限于仅使用 C 语言中的基本结构：您可以定义自己的数据结构和编码结构（包括类和模板！），同时仍然名义上编写 C！

预处理器宏实际上提供了在编译时执行的[图灵完备语言。](http://en.wikipedia.org/wiki/Turing_complete)一个令人印象深刻（也有点吓人）的例子在 C++ 端结束了：[Boost 预处理器](http://www.boost.org/doc/libs/1_38_0/libs/preprocessor/doc/index.html)库使用[C99](http://en.wikipedia.org/wiki/C_(programming_language)) / [C++98](http://en.wikipedia.org/wiki/C_Plus_Plus)预处理器来构建（相对）安全的编程结构，然后将其扩展到任何底层声明和代码您输入，无论是 C 还是 C++。

在实践中，我建议将预处理器编程作为最后的手段，当您没有自由在更安全的语言中使用高级构造时。但有时，如果你的背靠在墙上，而黄鼠狼正在逼近……，知道你能做什么是件好事！

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2011-11-09T07:04:55.090

来自[计算机愚蠢](http://www.rinkworks.com/stupid/cs_programming.shtml)：

> 我在许多适用于 UNIX 的免费软件游戏程序中看到了这段代码摘录：
> 
> /*
> * 位值。
> */
> #define BIT_0 1
> #define BIT_1 2
> #define BIT_2 4
> #define BIT_3 8
> #define BIT_4 16
> #define BIT_5 32
> #define BIT_6 64
> #define BIT_7 128
> #define BIT_8 256
> #define BIT_9 512
> #define BIT_10 1024
> #define BIT_11 2048
> #define BIT_12 4096
> #define BIT_13 8192
> #define BIT_14 16384
> #define BIT_15 32768
> #define BIT_16 65536
> #define BIT_17 131072
> #define BIT_18 262144
> #define BIT_19 524288
> #define
> BIT_19752BIT_10425
> #define
> bit_24 8388608
> #define bit_24 16777216
> #define bit_26
> 67108864
> #define
> bit_28 268435456
> #define bit_29 536870912
> #define bit_301073741824
> #define bit_31 2147483648
> 
> 实现这一点的一个更简单的方法是：
> 
> #define bit_0 0x00000001
> #define bit_1 0x00000002
> #define bit_2 0x00000004
> #define bit_3 0x00000008
> #define bit_4 0x00000010
> ...
> #define bit_28 0x10000000
> #define bit_29 0x20000000
> #define bit_30 0x4000000000
> #define bit_31 0x4000000000
> 
> 更简单的方法仍然是让编译器进行计算：
> 
> #define BIT_0 (1)
> #define BIT_1 (1 << 1)
> #define BIT_2 (1 << 2)
> #define BIT_3 (1 << 3)
> #define BIT_4 (1 << 4)
> ...
> #define BIT_28 (1 << 28)
> #define BIT_29 (1 << 29)
> #define BIT_30 (1 << 30)
> #define BIT_31 (1 << 31)
> 
> 但是为什么要费心去定义 32 个常量呢？C 语言也有参数化的宏。您真正需要的是：
> 
> #define BIT(x) (1 << (x))
> 
> 无论如何，我想知道编写原始代码的人是使用计算器还是只是在纸上计算出来。

这只是宏的一种可能用途。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2014-10-13T18:58:49.890

我将补充已经说过的内容。

因为宏适用于文本替换，它们允许您做非常有用的事情，而这些事情是使用函数无法做到的。

以下是宏真正有用的几种情况：

```
/* Get the number of elements in array 'A'. */
#define ARRAY_LENGTH(A) (sizeof(A) / sizeof(A[0])) 
```

这是一个非常流行且经常使用的宏。例如，当您需要遍历数组时，这非常方便。

```
int main(void)
{
    int a[] = {1, 2, 3, 4, 5};
    int i;
    for (i = 0; i < ARRAY_LENGTH(a); ++i) {
        printf("a[%d] = %d\n", i, a[i]);
    }
    return 0;
} 
```

在这里，如果另一个程序员在声明中再添加五个元素并不重要`a`。`for`-loop 将始终**遍历**所有元素。

C 库用于比较内存和字符串的函数很难使用。

你写：

```
char *str = "Hello, world!";

if (strcmp(str, "Hello, world!") == 0) {
    /* ... */
} 
```

或者

```
char *str = "Hello, world!";

if (!strcmp(str, "Hello, world!")) {
    /* ... */
} 
```

检查是否`str`指向`"Hello, world"`. 我个人认为这两种解决方案看起来都非常丑陋和令人困惑（尤其是`!strcmp(...)`）。

这是一些人（包括我）在需要使用`strcmp`/比较字符串或内存时使用的两个简洁的宏`memcmp`：

```
/* Compare strings */
#define STRCMP(A, o, B) (strcmp((A), (B)) o 0)

/* Compare memory */
#define MEMCMP(A, o, B) (memcmp((A), (B)) o 0) 
```

现在您可以编写如下代码：

```
char *str = "Hello, world!";

if (STRCMP(str, ==, "Hello, world!")) {
    /* ... */
} 
```

这里的意图更清楚了！

这些是宏用于功能无法完成的事情的情况。宏不应该用来替换函数，但它们还有其他很好的用途。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-03-17T11:46:50.693

宏真正发挥作用的一种情况是使用它们进行代码生成。

我曾经在一个旧的 C++ 系统上工作，该系统使用插件系统以他自己的方式将参数传递给插件（使用自定义的类似地图的结构）。一些简单的宏被用来处理这个怪癖，并允许我们在插件中使用带有普通参数的真实 C++ 类和函数而不会出现太多问题。所有由宏生成的胶水代码。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-03-18T01:07:23.087

鉴于您问题中的评论，您可能不完全理解调用函数可能需要相当多的开销。参数和键寄存器可能必须在传入的过程中复制到堆栈中，而堆栈在传出的过程中展开。较旧的英特尔芯片尤其如此。宏让程序员（几乎）保持函数的抽象，但避免了函数调用的昂贵开销。inline 关键字是建议性的，但编译器可能并不总是正确。“C”的优点和危险在于您通常可以根据自己的意愿弯曲编译器。

在你的面包和黄油中，日常应用程序编程这种微优化（避免函数调用）通常更糟糕，没有用，但如果你正在编写一个由操作系统内核调用的时间关键函数，那么它可以产生巨大的影响。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2013-06-20T10:23:20.277

与常规函数不同，您可以在宏中执行控制流（if、while、for、...）。这是一个例子：

```
#include <stdio.h>

#define Loop(i,x) for(i=0; i<x; i++)

int main(int argc, char *argv[])
{
    int i;
    int x = 5;
    Loop(i, x)
    {
        printf("%d", i); // Output: 01234
    } 
    return 0;
} 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-03-17T11:35:27.897

它有利于内联代码并避免函数调用开销。如果您想稍后更改行为而不编辑很多地方，也可以使用它。它对复杂的事情没有用，但对于你想要内联的简单代码行，它还不错。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-11-05T18:57:28.697

通过利用 C 预处理器的文本操作，可以构建多态数据结构的 C 等价物。使用这种技术，我们可以构建一个可靠的原始数据结构工具箱，可以在任何 C 程序中使用，因为它们利用了 C 语法而不是任何特定实现的细节。

这里给出了如何使用宏来管理数据结构的详细解释 - [http://multi-core-dump.blogspot.com/2010/11/interesting-use-of-c-macros-polymorphic.html](http://multi-core-dump.blogspot.com/2010/11/interesting-use-of-c-macros-polymorphic.html)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-11-20T16:35:22.823

**宏可以让您摆脱复制粘贴的片段，这是您无法以任何其他方式消除的。**

例如（真正的代码，VS 2010 编译器的语法）：

```
for each (auto entry in entries)
{
        sciter::value item;
        item.set_item("DisplayName",    entry.DisplayName);
        item.set_item("IsFolder",       entry.IsFolder);
        item.set_item("IconPath",       entry.IconPath);
        item.set_item("FilePath",       entry.FilePath);
        item.set_item("LocalName",      entry.LocalName);
        items.append(item);
    } 
```

这是您将同名字段值传递到脚本引擎的地方。这是复制粘贴的吗？是的。`DisplayName`用作脚本的字符串和编译器的字段名称。那不好吗？是的。如果您重构您的代码并重命名`LocalName`为`RelativeFolderName`（就像我所做的那样）并且忘记对字符串执行相同的操作（就像我所做的那样），那么脚本将以您不期望的方式工作（实际上，在我的示例中它取决于你是不是忘记在单独的脚本文件中重命名字段，但是如果脚本用于序列化，那将是一个 100% 的错误）。

如果为此使用宏，则该错误将没有空间：

```
for each (auto entry in entries)
{
#define STR_VALUE(arg) #arg
#define SET_ITEM(field) item.set_item(STR_VALUE(field), entry.field)
        sciter::value item;
        SET_ITEM(DisplayName);
        SET_ITEM(IsFolder);
        SET_ITEM(IconPath);
        SET_ITEM(FilePath);
        SET_ITEM(LocalName);
#undef SET_ITEM
#undef STR_VALUE
        items.append(item);
    } 
```

不幸的是，这为其他类型的错误打开了大门。您可以在编写宏时打错字，并且永远不会看到损坏的代码，因为编译器在所有预处理后都不会显示它的外观。其他人可以使用相同的名称（这就是我使用 尽快“发布”宏的原因`#undef`）。所以，明智地使用它。如果您看到另一种摆脱复制粘贴代码（例如函数）的方法，请使用这种方法。如果您发现使用宏删除复制粘贴的代码不值得，请保留复制粘贴的代码。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-03-17T11:36:41.810

一个明显的原因是，通过使用宏，代码将在编译时扩展，并且您会得到一个没有调用开销的伪函数调用。

否则，您也可以将其用于符号常量，这样您就不必在多个地方编辑相同的值来更改一件小事。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-17T11:33:12.177

宏 .. 当您的 &#(*$& 编译器拒绝内联某些内容时。

那应该是一张励志海报，不是吗？

严肃地说，谷歌[预处理器滥用](http://www.google.com/search?q=preprocessor+abuse&ie=utf-8&oe=utf-8&aq=t&rls=com.ubuntu:en-US:official&client=firefox-a)（你可能会看到一个与#1 结果类似的 SO 问题）。如果我正在编写一个超出 assert() 功能的宏，我通常会尝试查看我的编译器是否真的会内联类似的函数。

其他人会反对使用#if 进行条件编译.. 他们宁愿你：

```
if (RUNNING_ON_VALGRIND) 
```

而不是

```
#if RUNNING_ON_VALGRIND 
```

.. 出于调试目的，因为您可以在调试器中看到 if() 但看不到 #if。然后我们深入研究#ifdef 与#if。

如果它的代码少于 10 行，请尝试内联它。如果不能内联，试着优化一下。如果它太傻而不能成为一个函数，那就做一个宏。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-17T11:42:05.977

虽然我不是宏的忠实粉丝并且不再倾向于编写太多 C，但根据我目前的任务，这样的事情（显然可能有一些副作用）很方便：

```
#define MIN(X, Y)  ((X) < (Y) ? (X) : (Y)) 
```

现在我已经好几年没有写过这样的东西了，但是这样的“函数”遍布我在职业生涯早期维护的代码中。我想扩展可以被认为是方便的。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-12-22T16:54:42.660

关于宏之类的功能，我没有看到任何人提到这一点，例如：

`#define MIN(X, Y) ((X) < (Y) ? (X) : (Y))`

通常建议在不必要时避免使用宏，原因有很多，可读性是主要问题。所以：

> 什么时候应该在函数上使用这些？

几乎从来没有，因为有一个更具可读性的替代方案`inline`，请参阅[https://www.greenend.org.uk/rjk/tech/inline.html](https://www.greenend.org.uk/rjk/tech/inline.html) 或[http://www.cplusplus.com/articles/2LywvCM9/](http://www.cplusplus.com/articles/2LywvCM9/)（第二个链接是一个 C++ 页面，但据我所知，这一点适用于 c 编译器）。

现在，细微的差别是宏由预处理器处理，而内联由编译器处理，但现在没有实际区别。

> 什么时候适合使用这些？

适用于小型功能（最多两个或三个衬垫）。目标是在程序的运行时获得一些优势，因为像宏（和内联函数）这样的函数是在预处理（或内联的情况下编译）期间完成的代码替换，而不是存在于内存中的真实函数，所以没有函数调用开销（链接页面中的更多详细信息）。

# iphone - 我可以使用 cocos2d 在 iphone 应用程序中显示图像的一部分吗？

> ID：653840
> 
> 赞同：1
> 
> 时间：2009-03-17T11:30:59.967
> 
> 标签：iphone, cocos2d-iphone

我想显示图像的一部分而不是显示整个图像。首先显示完整图像，但在延迟时间后显示该图像的一部分。我不明白我该怎么做。就像我们可以通过固定标签的尺寸来显示部分文本一样。但是在图像的情况下，我如何使用精灵或其他方式来做到这一点。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-02-01T13:54:58.300

在 CCSprite 上设置纹理矩形。

```
//create a sprite, e.g. myFile is 128x128 pixels
CCSprite* mySprite = [CCSprite spriteWithFile:@"myFile.png"];

//position it somewhere
[mySprite setPosition:ccp(xPos,yPos)];

//show only the first 64x64 square
[mySprite setTextureRect:CGRectMake(0, 0, 64, 64)];

//add it to the root
[self addChild:mySprite]; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T11:38:05.363

```
[someImage drawInRect:CGRectMake(0, 0, 30, 30)]; 
```

# c# - 如何在循环外访问字符串数组

> ID：653855
> 
> 赞同：3
> 
> 时间：2009-03-17T11:35:59.987
> 
> 标签：c#, arrays, loops

```
for (int z = 0; z < alParmValues.Count; z++)
{
   //string[] def;
   string[] asd = alParmValues[z].ToString().Split(',');//this is of type string.collections and u cant cast it to a arraylist or array 
   //if (HUTT.clsParameterValues.bCustomObj == false)

   string[] def = alMethSign[z].ToString().Substring(alMethSign[z].ToString().IndexOf('(') + 1, alMethSign[z].ToString().IndexOf(')') - (alMethSign[z].ToString().IndexOf('(') + 1)).Split(',');
} 
```

我必须访问循环外的两个字符串数组。有没有更好的解决方案？我不能使用 ArrayList 或将它们声明为公共，那么我该如何访问它们？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T11:41:59.940

要访问循环外的内容，只需在循环外声明它，然后在循环处理完成后使用它：

```
string[] arr = ...

for (int z = 0; z < alParmValues.Count; z++)
{
  // work with arr...
}

var item = arr[3]; // Accessed outside of loop. 
```

但是，您的代码似乎有一些问题。我建议您多考虑一下循环体以及您要在那里做的事情。考虑这一行，例如：

```
for (int z = 0; z < alParmValues.Count; z++)
{
  // ...
  string[] asd = alParmValues[z].ToString().Split(',');

  // There aren't any more references to asd after this point in the loop,
  //   so this assignment serves no purpose and only keeps its last assigned
  //   value.
} 
```

这个任务是没有意义的；每次你通过循环时，你只是覆盖之前的值`asd`，并且你永远不会在循环的后面使用它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T11:39:42.300

`asd`两者的范围`def`都仅限于`for`循环体。如果您必须访问它们，则需要在循环之外声明它们。把它们放出来有问题吗？

查看 MSDN 上的[集合类教程](http://msdn.microsoft.com/en-us/library/aa288462(VS.71).aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T11:42:34.680

'asd' 和 'def' 都是字符串数组，其范围仅限于 for 循环。您不能在循环之外访问它们。如果您想这样做，请尝试在 for 循环之外声明它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T12:19:21.877

首先，如果您想访问在循环内提​​取/计算的数据，您必须为循环*外*的结果声明一个容器，然后在循环*内*填充其值。

其次，不要考虑*转换*从`split`方法返回的数组，而要考虑*处理它们的内容*。

假设您希望将原始`alParmValues`数组的所有元素的组合结果放在一对结果中，我将使用类似于以下伪代码的内容。当然，您需要填写`alParmValues`和`alMethSign`元素的类型，添加分号等。（因为您的问题没有解释循环中正在处理的两个数组之间的内容和关系，所以我刚刚处理了它们独立。）这不是完整的代码，而只是帮助您入门的草图：

```
ArrayList allValues = new ArrayList()
foreach (??? parameter in alParmValues) {
    foreach (String value in parameter.ToString().Split(',')) {
        allValues.add(value)
    }
}

ArrayList allMethSignValues = new ArrayList()
foreach (??? methSign in alMethSign) {
    String thisString = methSign.toString()
    int open = thisString.indexOf('(')
    int close = thisString.indexOf(')')
    String parenPart = thisString.substring(open + 1, close - open - 1)
    foreach (String value in parenPart.split(',')) {
        allMethSignValues.add(value)
    }
} 
```

# asp.net - 在 asp.net 2008 中实现 Gridview 分页

> ID：653856
> 
> 赞同：0
> 
> 时间：2009-03-17T11:36:06.567
> 
> 标签：asp.net, visual-studio-2008

我正在使用 asp.net 2008，并且我已经实现了内置的 Gridview Paging。但是它没有工作。那么我该如何实现 Gridview Paging？我使用的是 sql server 2005。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T11:47:57.413

将 GridView.AllowPaging 属性设置为 true。确保您的数据源支持分页。

# java - 从 Java 中加入两个 WAV 文件？

> ID：653861
> 
> 赞同：17
> 
> 时间：2009-03-17T11:37:53.350
> 
> 标签：java, audio, javasound

在 Java 1.6中连接两个[WAV文件的最简单方法是什么？](http://en.wikipedia.org/wiki/WAV)（相同的频率和所有，没有什么花哨的。）

（这可能很简单，但我的[Google-fu](http://en.wiktionary.org/wiki/Google-fu)今天在这个问题上似乎很弱。）

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-03-17T22:35:40.220

这是准系统代码：

```
import java.io.File;
import java.io.IOException;
import java.io.SequenceInputStream;
import javax.sound.sampled.AudioFileFormat;
import javax.sound.sampled.AudioInputStream;
import javax.sound.sampled.AudioSystem;

public class WavAppender {
    public static void main(String[] args) {
        String wavFile1 = "D:\\wav1.wav";
        String wavFile2 = "D:\\wav2.wav";

        try {
            AudioInputStream clip1 = AudioSystem.getAudioInputStream(new File(wavFile1));
            AudioInputStream clip2 = AudioSystem.getAudioInputStream(new File(wavFile2));

            AudioInputStream appendedFiles = 
                            new AudioInputStream(
                                new SequenceInputStream(clip1, clip2),     
                                clip1.getFormat(), 
                                clip1.getFrameLength() + clip2.getFrameLength());

            AudioSystem.write(appendedFiles, 
                            AudioFileFormat.Type.WAVE, 
                            new File("D:\\wavAppended.wav"));
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T11:41:38.723

WAV 标头应该不太难解析，如果我正确阅读[了此标头描述](http://ccrma.stanford.edu/courses/422/projects/WaveFormat/)，您可以从第二个 WAV 中剥离前 44 个字节，并将这些字节附加到第一个。之后，您当然应该更改第一个 WAV 的某些标头字段，以便它们包含正确的新长度。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-17T12:27:24.027

我通过[此处的“代码示例和应用程序”链接找到](http://java.sun.com/products/java-media/sound/)[了这个](http://www.jsresources.org/examples/AudioConcat.html)（AudioConcat） 。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T06:16:54.183

但是，如果两个 WAV 文件在波头中的格式不完全相同，则会出现您的挑战。

如果两个文件上的波形格式不同，您将不得不找到一种方法来变形它们以使它们匹配。

这可能涉及 MP3 转码或其他类型的转码（如果其中一种是用 MP3 编解码器编码的）。

# wpf - WPF改变亮度

> ID：653868
> 
> 赞同：4
> 
> 时间：2009-03-17T11:40:04.203
> 
> 标签：wpf, brightness

好吧，我有一个黑白应用程序，我需要一个降低亮度的功能，我该怎么做？所有的白色都来自保存在 ResourceDictionary(Application.xaml) 中的 SolidColorBrush，我当前的解决方案是放一个空窗口，它的不透明度为 80%，但这不允许我使用底层窗口。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T11:49:55.787

如果您所有的 UI 元素都使用相同的`Brush`，为什么不直接修改`Brush`以降低亮度？例如：

```
public void ReduceBrightness()
{
    var brush = Application.Resources("Brush") as SolidColorBrush;
    var color = brush.Color;
    color.R -= 10;
    color.G -= 10;
    color.B -= 10;
    brush.Color = color;
} 
```

**在您对`Brush`被冻结发表评论后进行编辑：**

如果您使用的是内置画笔之一（通过`Brushes`类），那么它将被冻结。不要使用其中之一，而是声明自己的`Brush`而不冻结它：

```
<SolidColorBrush x:Key="Brush">White</SolidColorBrush> 
```

**在罗伯特对应用程序级资源发表评论后进行编辑：**

罗伯特是对的。如果在关卡中添加的资源`Application`可冻结，则它们会自动冻结。即使您明确要求不要冻结它们：

```
<SolidColorBrush x:Key="ForegroundBrush" PresentationOptions:Freeze="False" Color="#000000"/> 
```

我可以看到有两种解决方法：

1.  正如罗伯特建议的那样，将资源放在资源树中的较低级别。例如，在 a`Window`的`Resources`集合中。但是，这使得分享变得更加困难。
2.  将资源放在不可冻结的包装器中。

作为#2 的示例，请考虑以下内容。

*应用程序.xaml*：

```
<Application.Resources>
    <FrameworkElement x:Key="ForegroundBrushContainer">
        <FrameworkElement.Tag>
            <SolidColorBrush PresentationOptions:Freeze="False" Color="#000000"/>
        </FrameworkElement.Tag>
    </FrameworkElement>
</Application.Resources> 
```

*Window1.xaml*：

```
<StackPanel>
    <Label Foreground="{Binding Tag, Source={StaticResource ForegroundBrushContainer}}">Here is some text in the foreground color.</Label>
    <Button x:Name="_button">Dim</Button>
</StackPanel> 
```

*Window1.xaml.cs*：

```
public partial class Window1 : Window
{
    public Window1()
    {
        InitializeComponent();
        _button.Click += _button_Click;
    }

    private void _button_Click(object sender, RoutedEventArgs e)
    {
        var brush = (FindResource("ForegroundBrushContainer") as FrameworkElement).Tag as SolidColorBrush;
        var color = brush.Color;
        color.R -= 10;
        color.G -= 10;
        color.B -= 10;
        brush.Color = color;
    }
} 
```

它不是那么漂亮，但它是我现在能想到的最好的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T12:46:39.877

通过更改我的根元素的不透明度而不是尝试修改画笔解决了这个问题，但是如果有人告诉我是否可以这样做或不可能做到这一点，那仍然会很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T16:20:08.117

`SolidColorBrush`如果将其添加到较低级别的资源中，Kent 的解决方案将起作用。Freezables 添加到`Application.Resources`.

# .net - .Net 数据库消息代理

> ID：653869
> 
> 赞同：2
> 
> 时间：2009-03-17T11:40:59.350
> 
> 标签：.net, messages, service-broker, eai

我正在寻找一种简单可靠的机制来从数据库级别执行应用程序消息代理。我基本上需要在两个不同的应用程序中进行更改以相互生成消息，以指示它们的公共对象之间发生了更改。困难在于两个系统都有自己独特的数据库模式来定义这些公共对象。

是否值得追求 BizTalk 解决方案来创建消息代理服务，或者是否有更简单的方法可以使用标准 .Net 方法或商业组件来实现相同的目标？

谢谢，

布赖恩。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T12:29:55.020

什么是数据库？如果是 SQL Server，您是否考虑过[Service Broker](http://msdn.microsoft.com/en-us/library/ms345108.aspx)吗？这在（根据要求）数据库级别提供了强大的消息传递......

消息与数据库模式无关，因此这不成问题。

# silverlight - Windows Server 2003 上的 Silverlight 问题

> ID：653874
> 
> 赞同：0
> 
> 时间：2009-03-17T11:41:55.773
> 
> 标签：silverlight, windows-server-2003

我在 windows server 2003 上安装了 silverlight 2。但是当我浏览 silverlight 站点时，什么都没有显示。请帮我？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T11:45:45.530

确保您已在浏览器中安装[Silverlight 插件。](http://www.microsoft.com/silverlight/resources/install.aspx)它与 Windows Server 2003 操作系统没有任何关系，因为它是一个跨平台、跨浏览器的 .NET 插件。

如果您使用的是 IE7 浏览器并遇到问题，那么您可能需要查看 Silverlight 论坛上的此主题“ [Silverlight will not work with IE 7](https://silverlight.net/forums/p/66153/162070.aspx) ”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T11:45:53.237

在 Windows 2003 上，当出现此类问题时，我首先查看的是查看与站点相关的浏览器权限。可能是您的 IE 设置不允许它使用 silverlight 控件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-27T05:30:26.547

事实证明，防火墙软件会导致此问题。

# javascript - 将我的 .net MVC 视图中的布尔值传递给 javascript，但 JS 不接受 True，想要 true

> ID：653878
> 
> 赞同：16
> 
> 时间：2009-03-17T11:43:05.397
> 
> 标签：javascript, asp.net-mvc, view

我正在将一个布尔值传递给我的 .net mvc 操作页面中的一个 javascript 函数。

问题是，它输出的是 True 值，而 javascript 显然只接受 'true' （小写）。

我不想破解变量并将其设为字符串并将其转换为小写，但看起来我别无选择？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-17T11:46:23.843

如果您在 .NET 布尔值上使用 ToString() 方法将值发送到 Javascript，请尝试将其替换为类似

```
(myBoolean ? "true" : "false") 
```

以便将其作为所需布尔值的适当字符串表示形式发送到 Javascript。

**编辑：**注意之间的区别：

```
<script type="text/javascript">
var myBoolean = <%= (myBoolean ? "true" : "false") %>;
</script> 
```

和

```
<script type="text/javascript">
var myBoolean = '<%= (myBoolean ? "true" : "false") %>';
</script> 
```

在第一个示例中，您最终得到：

```
var myBoolean = false; 
```

这是一个字面的布尔错误。在第二个中，您最终得到：

```
var myBoolean = 'false'; 
```

在 JavaScript 中，'false' 是一个非空字符串，因此如果在布尔上下文中求值，它将为真。嗯，真实的。:)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-05-14T22:00:29.680

我创建了一个扩展方法来在模型的任何布尔属性中使用它。

```
 public static class GeneralExtensions
    {
    public static string GetValueForJS(this bool argValue)
        {
            return argValue ? "true" : "false"; 
        }
     } 
```

现在在一个视图中，我可以简单地使用：

```
<script type="text/javascript">
    var variable = @Model.IsFoo.GetValueForJS();
</script> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-05-28T21:42:42.580

如果您需要经常这样做，只需将其添加到 javascript（或您的 js 库文件等）的顶部即可

```
var True = true; False = false; 
```

在一个简单的一次性案例中使用：

```
var x = ('<%= boolValue %>'=='True' ); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-29T14:04:30.460

您可以使用javascript`Boolean()`方法

```
if (Boolean(value)) {} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-17T11:59:45.793

你想用这个：

(.NET 3.5) System.Web.Script.Serialization.JavaScriptSerializer.Serialize

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-09-07T13:28:27.893

对我来说，这种方法有效（MVC4）

```
<script type="text/javascript">

if (@{if (Model.IsSubmitted) { @Html.Raw("true"); } else { @Html.Raw("false"); } } == true)
{
// code
}

</script> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-10-05T06:40:38.923

我写了一个公共 js 方法，当我需要从 javaScript 中的操作中检查传递的布尔变量时，只需将原始值发送到该方法进行解析。

```
function GetBooleanValue(value) {
if (value == undefined) return false;

var parsedValue = value.toLowerCase();

if (parsedValue === "false") return false;
else if (parsedValue === "true") return true;
else return false;
} 
```

# c# - 异常处理问题

> ID：653882
> 
> 赞同：1
> 
> 时间：2009-03-17T11:45:30.663
> 
> 标签：c#, exception-handling

我正在尝试编写一些代码来捕获特定异常并抛出更有用的代码来处理调用堆栈更高的事情，同时捕获更一般的异常并处理它们。

代码是这样的：

```
try
{
    // Do stuff
}
catch (SomeException e)
{
    throw new SomeExceptionWithContextInfo();
}
catch (Exception e)
{
    // Handle unexpected exception gracefully
} 
```

我遇到的问题是一般异常正在捕获我的新异常。有没有办法避免这种情况？

我当前的解决方案包括检查异常的类型，如果它的类型是我刚刚创建的，则再次抛出它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-17T11:52:04.253

您发布的代码应该可以工作，如此测试应用程序所示：

```
using System;

class OtherException : Exception {}

class Test
{
    static void Main(string[] args)
    {
        try
        {
            Foo();
        }
        catch (OtherException)
        {
            Console.WriteLine("Caught OtherException");
        }
    }

    static void Foo()
    {
        try
        {
            string x = null;
            int y = x.Length;
        }
        catch (NullReferenceException)
        {
            throw new OtherException();
        }
        catch (Exception)
        {
            Console.WriteLine("Caught plain Exception");
        }
    }
} 
```

这只是打印“Caught OtherException”而不是“Caught plain Exception”。您确定您的真实代码中没有嵌套的 try 块吗？您能否发布一个简短但完整的示例来说明您的问题？

你真的需要在你的方法中捕获异常吗？这很少是一个好主意。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T11:50:02.090

您发布的代码是执行此操作的方法（必须首先出现捕获更具体的异常）。

我建议再次查看代码，因为它们不是按那个顺序排列的，或者代码实际上并没有抛出那个异常类型。

这是 msdn 上关于 try-catch 的链接：http: [//msdn.microsoft.com/en-us/library/0yd65esw (VS.80).aspx](http://msdn.microsoft.com/en-us/library/0yd65esw(VS.80).aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-17T11:56:21.917

你做对了。一般异常不会捕获特定异常。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T11:52:53.423

不捕获一般异常可能是答案？找出可以抛出的异常并分别捕获它们。

```
try { // Outer try/catch
    DoSomething();

    try {
        /* */
    } catch(NotGeneralException e) {
        /* */
    } catch(AnotherNotGeneralException e) {
        throw new SomeOtherException("Exception message");
    }
} catch(SomeOtherException e) {
    /* */
} 
```

或者只捕获一般异常并重新抛出 SomeOtherExcepion

```
try {

} catch(Exception e) {
    throw new SomeOtherException("Exception message");
} 
```

# python - 等价于 Python 中的 LinkedHashMap

> ID：653887
> 
> 赞同：28
> 
> 时间：2009-03-17T11:46:11.223
> 
> 标签：python

[LinkedHashMap](http://java.sun.com/j2se/1.5.0/docs/api/java/util/LinkedHashMap.html)是具有可预测迭代顺序的类似 Hashtable 的数据结构（Python 中的 dict）的 Java 实现。这意味着在遍历所有键期间，它们按插入排序。这是通过维护插入顺序的附加链表完成的。

是否有与 Python 中的等价物？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-17T12:21:59.920

如果您使用的是 Python 2.7 或 Python >=3.1，则可以在标准库中使用[collections.OrderedDict 。](https://docs.python.org/2/library/collections.html#collections.OrderedDict)

[这个问题](https://stackoverflow.com/questions/60848/how-do-you-retrieve-items-from-a-dictionary-in-the-order-that-theyre-inserted/61031#61031)的答案[如何按照插入的顺序从字典中检索项目？](https://stackoverflow.com/questions/60848/how-do-you-retrieve-items-from-a-dictionary-in-the-order-that-theyre-inserted)包含有序 dict 的实现，以防您不使用 Python 3.x 并且不想让自己依赖于第三方[ordereddict 模块](http://www.xs4all.nl/~anthon/Python/ordereddict/)。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-17T11:50:44.270

尽管您可以通过维护一个列表来跟踪插入顺序来做同样的事情，但[Python 2.7](https://docs.python.org/2/library/collections.html)和[Python >=3.1](https://docs.python.org/3/library/collections.html)在集合模块中有一个 OrderedDict 类。

在 2.7 之前，您可以`dict` [按照这个配方](http://code.activestate.com/recipes/576693/)进行子类化。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T11:53:21.643

我不确定这是否是您要求的：

```
>>> dic = {1: 'one', 2: 'two'}
>>> for k, v in dic.iteritems():
...     print k, v 
```

[您可以使用ordereddict](http://www.xs4all.nl/~anthon/Python/ordereddict/)模块按插入顺序对dic 进行排序。

```
d = ordereddict(dic, relax=True) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-17T11:51:35.657

我不这么认为；你必须使用一个字典和一个列表。但是您可以很容易地将其包装在一个类中，并定义`keys`, `__getitem__`,`__setitem__`等以使其按照您想要的方式工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-03-30T12:25:07.113

除了经过验证的评论；

从 Python 3.7 开始，`dict`保留插入顺序。

[这个答案](https://stackoverflow.com/a/51777540/11953327)详细说明了这一点。

# visual-studio-2008 - Visual Studio 设计时间和固定布局表 - 你的意见

> ID：653892
> 
> 赞同：0
> 
> 时间：2009-03-17T11:47:04.763
> 
> 标签：visual-studio-2008, design-time

我即将向 Microsoft 提交一个错误。

以下 html 在浏览器中显示良好，但在 VS 设计器中，它使整个页面可滚动 - 因为表格没有被 div 剪切：

```
<div style="width: 800px; height: 100px; overflow: scroll;">
    <table style="table-layout:fixed">
        <tr>
            <td style="width:1600px">1</td>
        </tr>
    </table>
</div> 
```

也许您知道已经报告了类似的错误？
或者，也许您知道如何与之抗争？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-04-12T21:02:20.517

这个问题似乎是 Visual Studio Web Designer 的限制。已向微软提交了相应的请求：

[在 VS2008 网页设计器中，固定布局的表格不会被溢出属性设置为“滚动”的 div 裁剪 | 微软连接](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=424421)

# .net - 在.NET中交换鼠标左键和右键

> ID：653911
> 
> 赞同：7
> 
> 时间：2009-03-17T11:53:28.273
> 
> 标签：.net, mouse, user32

如何在 .NET（最好是 C#）中交换鼠标左键和右键？基本上，结果应该与用户通过控制面板选中鼠标属性中的“切换主要和次要按钮”复选框相同。我正在处理 Windows XP，以防万一。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-17T11:57:53.317

您可以使用 Windows API 调用`SwapMouseButton`：

```
using System.Runtime.InteropServices;

// ...

[DllImport("user32.dll")]
public static extern Int32 SwapMouseButton(Int32 bSwap);

// ...

// Swap it.
SwapMouseButton(1); 

// Back to normal.
SwapMouseButton(0); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-17T12:09:00.797

像这样的东西：

```
using Microsoft.Win32;

var key = Registry.CurrentUser.CreateSubKey("Control Panel\\Mouse\\");
var newValue = key.GetValue("SwapMouseButtons");

if (newValue == null) newValue = "1";
else                  newValue = Int32.Parse(newValue) == 1 ? "0" : "1";

key.SetValue("SwapMouseButtons", newValue, RegistryValueKind.String); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T11:58:18.497

[这是执行此操作的代码片段](http://www.daniweb.com/code/snippet826.html)。

# c# - 如何检测是否从 C# 为 Firefox 安装了 flash？

> ID：653914
> 
> 赞同：3
> 
> 时间：2009-03-17T11:55:14.353
> 
> 标签：c#, flash, server-side

有没有办法从服务器上的 C# 代码检查是否在 Firefox 中安装了 flash？例如，当客户端浏览器是 IE 时，您可以检查
Request.Headers["accept"].Contains ("application/x-shockwave-flash")
但 Firefox 请求不包含相同的标头。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T12:09:16.177

鉴于您已将其标记为“服务器端”并谈论客户端的机器，那么您可能会感到失望。

检查这一点的唯一方法是使用在您正在检查的主机（即客户端）上运行的代码 - 当然，您可以这样做并将答案传输到服务器（例如，存储在会话中）

编辑：还值得记住的是，您收到（或依赖于接收）的任何标头都可能被中间代理删除，或者只是简单地撒谎（可能是机器人）

# ruby-on-rails - 在我看来使用会话变量

> ID：653916
> 
> 赞同：5
> 
> 时间：2009-03-17T11:56:04.180
> 
> 标签：ruby-on-rails, variables

有人告诉我，我不应该`params[:user_id]`在我的视图文件中使用变量。相同的规则是否适用于`session`变量？

如果没有，那我该怎么办？首先将其分配给实例变量，然后在视图中使用它？这似乎很烦人，因为我必须为我的每一个动作都这样做。我想我可以把这个重复的代码放在一个方法中，该方法会被该类中的所有其他操作调用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-17T14:04:30.410

此建议来自构成 Rails 应用程序的不同组件之间“关注点分离”的最佳实践。确定当前用户的最佳位置是在您的控制器中。您可以在此处访问参数和/或会话以确定是否有人直接或通过身份验证插件间接登录。然后，如果您在视图中需要此信息，只需将其存储在变量中，例如 @user，该变量将自动在您的视图中用于显示目的。这样做，如果您稍后更改身份验证机制，您可以在不触及视图的情况下这样做，这很好地表明您在应用程序中的不同组件之间有很好的分离。

同样针对您问题的第二部分：

> 我想我可以把这个重复的代码放在一个方法中，该方法会被该类中的所有其他操作调用。

这可以通过控制器中的 :before_filter 轻松完成，您可以将其指向检查身份验证并创建任何必要的实例变量以在控制器中的操作之间共享的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T12:17:26.593

您肯定想在每个页面加载`params[:user_id]`时进行验证。`session[:user_id]`如果您的会话被劫持，您可能会将不需要的代码放入您的视图中并允许跨站点脚本攻击。

也就是说，`authenticated_system`插件中使用的正确方法是引用允许您检索`current_user.user_id`.

此外，如果您在调用数据库时使用 user_id，您仍应通过在视图和控制器操作中 调用`@selected_user = User.find(params[:user_id]`和使用来验证它。`@selected_user.id`

您将获得更多的控制和保护。

# css - 'em' 单元的 WPF 类比

> ID：653918
> 
> 赞同：9
> 
> 时间：2009-03-17T11:56:41.947
> 
> 标签：css, wpf, units-of-measurement

[CSS em](http://www.w3.org/TR/CSS21/syndata.html#length-units)单元的 WPF 类比是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2011-06-15T09:34:50.000

这就是我所做的。创建了一个 MarkupExtension，它根据 Window 上分配的字体将字体大小转换为 EM。

我要感谢 [http://10rem.net/blog/2011/03/09/creating-a-custom-markup-extension-in-wpf-and-soon-silverlight](http://10rem.net/blog/2011/03/09/creating-a-custom-markup-extension-in-wpf-and-soon-silverlight)

和

[http://tomlev2.wordpress.com/tag/markup-extension/](http://tomlev2.wordpress.com/tag/markup-extension/)

用于提供所需的知识。

```
[MarkupExtensionReturnType(typeof(double))]
public class EmFontSize : MarkupExtension
{
    public EmFontSize() { }

    public EmFontSize(double size)
    {
        Size = size;
    }

    [ConstructorArgument("size")]
    public double Size { get; set; }

    public override object ProvideValue(IServiceProvider serviceProvider)
    {
        if (serviceProvider == null)
            return null;

        // get the target of the extension from the IServiceProvider interface
        IProvideValueTarget ipvt = (IProvideValueTarget)serviceProvider.GetService(typeof(IProvideValueTarget));
        if (ipvt.TargetObject.GetType().FullName == "System.Windows.SharedDp")
            return this;

        DependencyObject targetObject = ipvt.TargetObject as DependencyObject;

        var window = TryFindParent<Window>(targetObject);
        if (window != null)
        {
            return window.FontSize * Size;
        }
        return 12 * Size;
    }

    public static T TryFindParent<T>(DependencyObject child) where T : DependencyObject
    {
        //get parent item
        DependencyObject parentObject = GetParentObject(child);

        //we've reached the end of the tree
        if (parentObject == null) return null;

        //check if the parent matches the type we're looking for
        T parent = parentObject as T;
        if (parent != null)
        {
            return parent;
        }
        else
        {
            //use recursion to proceed with next level
            return TryFindParent<T>(parentObject);
        }
    }

    public static DependencyObject GetParentObject(DependencyObject child)
    {
        if (child == null) return null;

        //handle content elements separately
        ContentElement contentElement = child as ContentElement;
        if (contentElement != null)
        {
            DependencyObject parent = ContentOperations.GetParent(contentElement);
            if (parent != null) return parent;

            FrameworkContentElement fce = contentElement as FrameworkContentElement;
            return fce != null ? fce.Parent : null;
        }

        //also try searching for parent in framework elements (such as DockPanel, etc)
        FrameworkElement frameworkElement = child as FrameworkElement;
        if (frameworkElement != null)
        {
            DependencyObject parent = frameworkElement.Parent;
            if (parent != null) return parent;
        }

        //if it's not a ContentElement/FrameworkElement, rely on VisualTreeHelper
        return VisualTreeHelper.GetParent(child);
    }
} 
```

示例使用

```
xmlns:my="clr-namespace:FontSizeExample"
<TextBlock Text="Sample Font" FontSize="{my:EmFontSize 1.1}"/>
<TextBlock Text="Sample Font" FontSize="{my:EmFontSize .9}"/> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-17T15:53:42.003

em size是当前字体中大写字母M的宽度，Wpf中没有字体依赖的大小方法

顺便说一句，WPF 使用始终为 1/96 英寸的“设备无关像素”（因为这是当今显示器上的一个像素），因此：

*   1 像素是 1/96 英寸
*   96 像素一英寸
*   1.33333 像素是一个点
*   3.779 像素是一毫米

这些在显示器上非常不准确，因为几乎所有显示器都报告 96DPI 分辨率并忽略实际像素大小，但在打印时非常有用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-17T12:25:11.193

```
<ScaleTransform ScaleX="1.2" ScaleY="1.2"></ScaleTransform> 
```

似乎或多或少是 1.2em 的替代品。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T12:00:46.213

AFAIK，现在没有。但是你可以在[这里](http://blogs.msdn.com/jstegman/archive/2008/12/27/update-on-feature-requests.aspx)表达你对这个的渴望。

一种替代方法（我也不知道这是否可能）是测量所需字体的大小，然后将其作为您的“ems”单位，然后使用这些“单位”进行缩放。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-17T13:56:28.167

不幸的是，在 em 单元的 WPF 中没有等价物。您所有的字体大小等始终以像素设置。

# javascript - 仅使用 var 在 JavaScript 中声明布尔值

> ID：653921
> 
> 赞同：94
> 
> 时间：2009-03-17T11:58:46.530
> 
> 标签：javascript, boolean

如果我像这样声明一个 JavaScript 布尔变量：

```
var IsLoggedIn; 
```

然后用`true`or初始化它`1`，这样安全吗？或者将它初始化为`1`使变量成为数字？

* * *

## 回答 #1

> 赞同：173
> 
> 时间：2009-03-17T12:03:02.883

类型取决于您的初始化：

```
var IsLoggedIn1 = "true"; //string
var IsLoggedIn2 = 1; //integer
var IsLoggedIn3 = true; //bool 
```

但是看看这个例子：

```
var IsLoggedIn1 = "true"; //string
IsLoggedIn1 = true; //now your variable is a boolean 
```

您的变量类型取决于 JavaScript 中的赋值。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-17T12:00:30.393

不，这不安全。你可以稍后再做 var`IsLoggedIn = "Foo";`并且 JavaScript 不会抛出错误。

有可能做

```
var IsLoggedIn = new Boolean(false);
var IsLoggedIn = new Boolean(true); 
```

您还可以将非布尔变量传递给`new Boolean()`，它将使 IsLoggedIn 成为布尔值。

```
var IsLoggedIn = new Boolean(0); // false
var IsLoggedIn = new Boolean(NaN); // false
var IsLoggedIn = new Boolean("Foo"); // true
var IsLoggedIn = new Boolean(1); // true 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-03-26T13:35:49.393

正如这个[非常有用的教程](https://github.com/airbnb/javascript)所说：

```
var age = 0;

// bad
var hasAge = new Boolean(age);

// good
var hasAge = Boolean(age);

// good
var hasAge = !!age; 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-17T12:01:57.317

如果您想`IsLoggedIn`被视为布尔值，则应按如下方式初始化：

```
var IsLoggedIn=true; 
```

如果你用`var IsLoggedIn=1;`then 初始化它，它将被视为一个整数。

但是，在任何时候，变量`IsLoggedIn`都可以引用不同的数据类型：

```
 IsLoggedIn="Hello World"; 
```

这不会导致错误。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-17T13:06:31.453

您至少*可以使用和测试未初始化变量的“定义性”。*像这样：

```
var iAmNotDefined;
alert(!iAmNotDefined); //true
//or
alert(!!iAmNotDefined); //false 
```

此外，还有很多可能性：如果您对精确类型不感兴趣，请使用 '==' 运算符（或 ![variable] / !![variable]）进行比较（这就是 Douglas Crockford 所说的 'truthy' 或 '假的'我认为）。在这种情况下，将 true 或 1 或 '1' 分配给未初始化的变量总是在询问时返回 true。否则 [如果您需要类型安全比较] 使用 '===' 进行比较。

```
var thisMayBeTrue;

thisMayBeTrue = 1;
alert(thisMayBeTrue == true); //=> true
alert(!!thisMayBeTrue); //=> true
alert(thisMayBeTrue === true); //=> false

thisMayBeTrue = '1';
alert(thisMayBeTrue == true); //=> true 
alert(!!thisMayBeTrue); //=> true
alert(thisMayBeTrue === true); //=> false
// so, in this case, using == or !! '1' is implicitly 
// converted to 1 and 1 is implicitly converted to true)

thisMayBeTrue = true;
alert(thisMayBeTrue == true); //=> true
alert(!!thisMayBeTrue); //=> true
alert(thisMayBeTrue === true); //=> true

thisMayBeTrue = 'true';
alert(thisMayBeTrue == true); //=> false
alert(!!thisMayBeTrue); //=> true
alert(thisMayBeTrue === true); //=> false
// so, here's no implicit conversion of the string 'true'
// it's also a demonstration of the fact that the 
// ! or !! operator tests the 'definedness' of a variable. 
```

PS：您无法测试不存在变量的“定义性”。所以：

```
alert(!!HelloWorld); 
```

给出一个参考 Error ('HelloWorld is not defined')

（“定义性”有更好的词吗？请原谅我的荷兰语；~）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-17T12:06:12.813

Javascript 中的变量没有类型。非零、非空、非空且`true`为“真”。零、空、未定义、空字符串并且`false`是“假”。

但是有一个布尔类型，文字`true`和`false`.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-06-20T15:23:36.377

像这样的东西怎么样：

```
var MyNamespace = {
    convertToBoolean: function (value) {
        //VALIDATE INPUT
        if (typeof value === 'undefined' || value === null) return false;

        //DETERMINE BOOLEAN VALUE FROM STRING
        if (typeof value === 'string') {
            switch (value.toLowerCase()) {
                case 'true':
                case 'yes':
                case '1':
                    return true;
                case 'false':
                case 'no':
                case '0':
                    return false;
            }
        }

        //RETURN DEFAULT HANDLER
        return Boolean(value);
    }
}; 
```

然后你可以像这样使用它：

```
MyNamespace.convertToBoolean('true') //true
MyNamespace.convertToBoolean('no') //false
MyNamespace.convertToBoolean('1') //true
MyNamespace.convertToBoolean(0) //false 
```

我还没有测试过它的性能，但是从一个类型转换到另一个类型不应该经常发生，否则你打开你的应用程序很不稳定！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-17T12:05:43.347

该变量将成为您分配给它的任何类型。最初是`undefined`. 如果您分配它`'true'`，它将成为一个字符串，如果您分配它`true`，它将成为一个布尔值，如果您分配它`1`，它将成为一个数字。随后的赋值可能会在以后更改变量的类型。

# database - 强制完整性的表关系的最佳模式设计

> ID：653922
> 
> 赞同：6
> 
> 时间：2009-03-17T11:58:48.573
> 
> 标签：database, schema-design

给定一个模型表“A”，它可以有多个子模型“B”，其中“B”将有一个或多个子模型“C”。这听起来很简单，但是我需要为每个“A”强制执行'，任何“B”都必须有一个唯一的“C”集合。例如，C 不能是属于同一父“A”的两个“B”的子代。但“C”可以是子代鉴于每个 'B' 的父 'A' 是不同的..

这有意义还是我应该不混淆我的场景？提前喝彩！

请注意，我知道此策略将在应用程序中强制执行，但我不希望数据库处于无效状态是不可能的。

编辑：大家好，很棒的反馈，所以首先我必须感谢大家与我分享你的知识。

只是为了澄清情况，我将解释这个场景，但这里有一些注意事项：

'A' 有零个或多个'B'，'B' 隐含地与'A' 相关联，因此总是只有一个'A' 的孩子。“C”在某种程度上是与许多“B”以及数据库中的其他元素相关联的根实体。

* * *

这是真实的故事：

这是一个包含许多简报（A）和许多成员（C）的网站，一个简报可以有许多提交（B），其中一个提交总是有一个或多个关联成员。这个想法是，提交实际上可以是一种协作，每个成员都没有比任何其他成员更多的“权力”，但是会有一个不同的系统来验证成员如何一起工作的政策。

因此，每个简报，一个成员只能提交一个提交，而一个提交可以有多个成员（合作者）。

希望这会有所帮助，但我认为您已经给了我很多帮助！

史蒂夫。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-17T12:41:59.467

我想我已经在这里捕捉到了你的关系模型；如果不是，那么我投票支持非混淆：

*   A [ {AID}, ... ]
*   B [ {出价}，援助，...]
*   C [ {CID}, ... ]
*   B_C_Link [ {BID, CID}, AID ]
    *   (AID, CID) 上的附加唯一索引

该表示法使用 {} 主键指示符。所以 As 可以有多个 B（通过在 B 上放置 AID），B 可以有 Cs（通过使用多对多表 B_C_Link），并且多个 C 不能属于同一个 A（通过将 AID 添加到多-对多表和强制（AID，CID）唯一性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-17T13:22:47.717

我认为您需要 SQL 标准断言，这些断言（不幸的是）在很大程度上没有被实际的 DBMS 实现。

所有答案都同意存在三个名为 TableA、TableB 和 TableC 的主表，每个表都包含自己的 ID 列：

```
TableA (A_ID PRIMARY KEY, ...)
TableB (B_ID PRIMARY KEY, ...)
TableC (C_ID PRIMARY KEY, ...) 
```

从问题的描述中并不清楚单个B值是否可以有多个A父条目。很明显，单个 C 可以有多个 B 父条目。如果 B 与单个 A 绑定，则 TableB 的设计可以修改为：

```
TableB (B_ID, ..., A_ID REFERENCES TableA) 
```

如果一个 B 可以与多个不同的 A 相关联，则连接最好由连接表表示：

```
A_and_B (A_ID REFERENCES TableA,
         B_ID REFERENCES TableB,
         PRIMARY KEY (A_ID, B_ID)
        ) 
```

从描述中也不清楚与 B 关联的 C 是否对于与 B 关联的每个 A 都必须相同，或者不同的 A 是否可以引用相同的 B，以及与 B 关联的 C 的集合对于 A1可以不同于与 A2 的 B 相关联的 C 的集合。（当然，如果一个 B 只能与一个 A 关联，这个问题就没有实际意义了。）

出于此答案的目的，我将假设任何 B 都与单个 A 相关联，因此 TableB 的结构包含 A_ID 作为外键。由于单个 C 可以与多个 B 相关联，因此相关结构是一个新的连接表：

```
B_and_C (B_ID REFERENCES TableB,
         C_ID REFERENCES TableC,
         PRIMARY KEY (B_ID, C_ID)
        ) 
```

简化（通过省略有关可延迟性和即时性的规则）断言看起来像：

```
CREATE ASSERTION assertion_name CHECK ( <search_condition> ) 
```

因此，一旦我们有了一组设计决策，我们就可以编写一个断言来验证数据。给定表 TableA、TableB（带有外键 A_ID）、TableC 和 B_and_C，要求给定 C_ID 在完整 A 中出现的次数为 1。

```
CREATE ASSERTION only_one_instance_of_c_per_a CHECK
(
     NOT EXISTS (
         SELECT A_ID, COUNT(C_ID)
             FROM TableB JOIN B_and_C USING (C_ID)
             GROUP BY A_ID
             HAVING COUNT(C_ID) > 1
     )
) 
```

[*修正*：我认为这更准确：

```
CREATE ASSERTION only_one_instance_of_c_per_a CHECK
(
     NOT EXISTS (
         SELECT A_ID, C_ID, COUNT(*)
             FROM TableB JOIN B_and_C USING (C_ID)
             GROUP BY A_ID, C_ID
             HAVING COUNT(*) > 1
     )
) 
```

]

连接条件集随表连接方式的其他规则而异，但总体约束结构保持不变 - 对于特定 A_ID，对给定 C_ID 的引用不得超过一个。

* * *

在下面的评论中，meandmycode 注释：

> 我觉得我的设计有缺陷。我的真实世界逻辑是“B”总是至少有一个孩子“C”。鉴于“B”必须在其子项可以附加之前存在，这没有任何意义。数据库目前允许在没有至少一个“C”的情况下将“B”附加到“A”。孩子，我将修改“B”，以便它有一个引用它的字段主要的孩子'C'，以及有一个额外的'C'的子集合，但现在我有一个集合，它还可以包括由'B'指定的主要'C'，这将是..错误的。
> 
> 是否有一种数据库模式可以推断出“一个或多个孩子”规则，而不是零个或多个？

我认为你的模型确实有问题。如果必须已经存在引用新创建的 B 的 C，则很难创建 B，尤其是如果 C 必须仅引用现有的 B。想到“鸡和蛋”这句话。因此，通常情况下，您允许 B 在这样的上下文中有零个或多个 C。

您还没有规定 TableB 是否有 A_ID 外键，或者您是否有像 A_and_B 这样的链接表。如果它有一个外键，那么在你创建它所引用的 A 之前，你可能无法创建 B。

我不认为在表 B 中包含一个 C ID 是一个好主意——它会导致非对称处理（更难的 SQL）。这也意味着如果你需要删除那个 C，你必须更新一些东西，以便从它当前所在的表中删除其他 C 引用之一，然后更新 B 记录中的值。太麻烦了，礼貌点。

我认为您需要修改您的问题以定义您正在查看的实际表结构 - 沿着各种答案中显示的路线；您可以使用三个点来表示其他但不相关的列。我建议的断言可能必须作为某种触发器来实现——它进入特定于 DBMS 的符号。

* * *

从简报 (A)、提交 (B) 和成员 (C) 的修改描述中，很明显单个提交仅适用于一个简报，因此提交可以有一个简单的外键来标识它是提交的简报为了。并且成员只能就特定简报的一个提交进行协作。将有一个“submission_collaborators”表，其中包含用于标识提交和成员的列，组合是主键，每列是一个外键。

```
Briefs(Brief_ID, ...)
Submissions(Submission_ID, Brief_ID REFERENCES Briefs, ...)
Members(Member_ID, ...)
Submission_Collaborators(Submission_ID REFERENCES Submissions,
                         Member_ID REFERENCES Members,
                         PRIMARY KEY (Submission_ID, Member_ID)
                        ) 
```

因此，要求是以下查询必须不返回任何行：

```
SELECT s.brief_id, c.member_id, COUNT(*)
    FROM submissions AS s JOIN submission_collaborators AS c
         ON s.submission_id = c.submission_id
    GROUP BY s.brief_id, c.member_id
    HAVING COUNT(*) > 1 
```

这是我在 CREATE ASSERTION（第二个变体）中嵌入的相同查询。您也可以挖掘出额外的信息（简短标题、提交标题、成员名称、各种日期等），但问题的核心是显示的查询必须不返回任何数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T12:03:31.120

将TableA的ID添加到TableB，并添加到主键，对TableB和TableC做同样的事情。

编辑：

我相信这个答案的第一部分将适用于 A 到 B 约束。但是，然后我会在 B 和 C 之间放置一个链接表，该表也包含 A 的 PK。这样你在 A:B 之间就有了一个 1:N，然后你的约束就会被强制执行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-17T12:09:59.403

你所拥有的是**三元关系**。您需要做的是有一个表，将 A 和 B 和 C 联系在一起的主键。由于主键不能重复，这将强制每个 A 和每个 B 只有一个 C。这将创建您正在寻找的唯一集合。

您将获得以下表结构：

```
A's({A_ID}, ...)
B's({B_ID}, ...)
C's({C_ID}, ...)
A_B_C_Relation({[A_ID], [B_ID], [C_ID]}, ...) 
```

主键在大括号中，外键在括号中。

[在这里](http://db.grussell.org/section004.html#_Toc67114396)查看更多信息。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-17T12:05:44.657

我认为您无法通过简单的声明性参照完整性约束来做到这一点。执行逻辑的最佳方式可能是使用触发器来实现业务约束，并回滚任何违反规则的插入或更新。

# cocoa - 在可可中使用while循环创建数组

> ID：653937
> 
> 赞同：0
> 
> 时间：2009-03-17T12:04:38.717
> 
> 标签：cocoa, arrays, loops

我创建了一个 while 循环，其中创建了临时字符串（每次循环执行时都会更新字符串）。如何从这些临时字符串中创建一个数组？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T12:08:01.937

听起来你正在寻找这样的东西：

```
NSMutableArray *array = [[NSMutableArray alloc] init];

while(foo) {
    // create your string
    [array addObject:string];
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T12:16:45.223

```
-(NSArray*) makeArray
{
    NSMutableArray* outArr = [NSMutableArray arrayWithCapacity:512]; // outArr is autoreleased
    while(notFinished)
    {
      NSString* tempStr = [self makeTempString];
      [outArr addObject:tempStr]; // will incr retain count on tempStr
    }
    return [outArr copy]; // return a non-mutable copy
} 
```

# entity-framework - 使用实体框架将多个相关实体插入数据库，我做错了什么？

> ID：653954
> 
> 赞同：0
> 
> 时间：2009-03-17T12:09:41.777
> 
> 标签：entity-framework

我有 3 个实体

*   打印机
*   服务器
*   司机

打印机具有服务器和驱动程序属性

在我的代码中，我设置了一个 IEnumerable<Printer> ，其中每个打印机实例都拥有自己的服务器和驱动程序实体。

现在，当我尝试将其提交到数据库时，我正在使用以下代码：

```
foreach (Printer p in printers)
  {
   printmanEntities _dc = new printmanEntities();
   p.Driver = _dc.DriverSet.FirstOrDefault(d => d.Name == p.Driver.Name) ?? p.Driver;
   p.Server = _dc.ServerSet.FirstOrDefault(s => s.Name == p.Server.Name) ?? p.Server;

   _dc.AddToPrinterSet(p);

   _dc.SaveChanges();  
   } 
```

假设我将为每个打印机对象获取一条记录，并为每个唯一的驱动程序和服务器名称获取一条记录。但实际结果是相当连贯的。

上面的代码为每个唯一的 Driver 对象生成一个记录，但没有明显的原因为每个唯一的服务器创建多个记录。并且所有打印机记录都指向单个服务器记录。

此外，如果我首先分配 p.Server，那么我只会获得服务器实体的唯一记录，但会获得驱动程序实体的多条记录。

我究竟做错了什么？

更新：将 EF 替换为 LINQ2SQL，它的工作方式与我预期的一样。每个唯一实体的一行，仅此而已。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T13:53:42.917

这表明 dc.ServerSet.FirstOrDefault(s => s.Name == p.Server.Name) 返回 null，但 Driver 调用返回一条记录。为什么？我不知道。查看 SQL Profiler 并查看从数据库服务器返回的内容。不过，它会解释你的结果。

**更新：**我想我可能已经弄清楚这里发生了什么。尝试如下更改您的代码。如果它有效，我会解释原因。

```
printmanEntities _dc = new printmanEntities();
_dc.AddToPrinterSet(p);

p.Driver = _dc.DriverSet.FirstOrDefault(d => d.Name == p.Driver.Name) ?? p.Driver;
p.Server = _dc.ServerSet.FirstOrDefault(s => s.Name == p.Server.Name) ?? p.Server;

_dc.SaveChanges(); 
```

请注意，我在这里所做的唯一一件事就是更改操作顺序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-15T20:49:14.883

奇怪的是，DataContainer 不会返回您附加到图形但没有作为查询结果提交给 db 的实体。所以你不能得到你添加的实体，但 Select() 不允许。)-:

# c - 没有条件、循环和算术运算符的 C 中的阶乘

> ID：653961
> 
> 赞同：13
> 
> 时间：2009-03-17T12:12:49.240
> 
> 标签：c, algorithm, puzzle

如何在 C 中找到数字（从 1 到 10）的阶乘，而不使用：

*   for、while 和 do while 等循环语句；
*   条件运算符，例如 if 和 case；和
*   算术运算符，如 + 、 − 、 * 、 % 、 / 、 ++ 、 −−?

仅供参考：我在 C aptitude 中发现了这个问题。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-03-17T12:14:19.427

由于它只有 1 到 10，因此只需预先计算它并将其存储在一个大小为 11 的简单 int 数组中。对于数组中的第一个元素，放入 1。它不是您的问题的有效输入范围，但也可能是正确的。

我们需要存储 11 个元素而不是我们需要的 10 个元素，否则我们需要使用操作“-”来获取正确的索引。但是，您的问题中不允许减法。

```
int factorial(int x)
{
  return precomputedArray[x];
} 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-17T16:03:08.890

这是一个没有循环、算术或条件且不诉诸预计算的解决方案。**它也不使用短路条件，例如`&&`或`||`在实践中等效于`if`.** 所以这似乎是第一个完全没有任何条件的正确解决方案。现在在没有 C++ 特性的适当 C 中:)

```
#include <stdio.h>
#define uint unsigned int

void A(uint *a, uint *b)
{
    uint tmp = *a & *b;
    *a = (*a | *b) & ~tmp;
    *b = tmp << 1;
}

#define REPEAT32(s) \
s s s s s s s s s s s s s s s s s s s s s s s s s s s s s s s s

uint add(uint a, uint b)
{
    REPEAT32(A(&a, &b);) return a;
}

uint bitexpand(uint b)
{
    b = (b << 1)  | b; b = (b << 2)  | b; b = (b << 4)  | b;
    b = (b << 8)  | b; b = (b << 16) | b;
    return b;
}

void M(uint *acc, uint *a, uint *b)
{
    *acc = add(*acc, *a & bitexpand(*b & 1));
    *a <<= 1;
    *b >>= 1;
}

uint mult(uint a, uint b)
{
    uint acc = 0;
    REPEAT32(M(&acc, &a, &b);) return acc;
}

uint factorial(int n)
{
    uint k = 1;
    uint result = 0;
    result |= (bitexpand(n == 1) & k);
    k = mult(k, 2); result |= (bitexpand(n == 2) & k);
    k = mult(k, 3); result |= (bitexpand(n == 3) & k);
    k = mult(k, 4); result |= (bitexpand(n == 4) & k);
    k = mult(k, 5); result |= (bitexpand(n == 5) & k);
    k = mult(k, 6); result |= (bitexpand(n == 6) & k);
    k = mult(k, 7); result |= (bitexpand(n == 7) & k);
    k = mult(k, 8); result |= (bitexpand(n == 8) & k);
    k = mult(k, 9); result |= (bitexpand(n == 9) & k);
    k = mult(k, 10); result |= (bitexpand(n == 10) & k);
    return result;
}

int main(int argc, char **argv)
{
    uint i;
    /* Demonstration loop, not part of solution */
    for (i = 1; i <= 10; i++)
    {
        printf("%d %d\n", i, factorial(i));
    }
} 
```

更新：讨论包含这样的声明，即在不使用 if 的解决方案中，像 && 这样的短路条件是可以接受的。这是一个简单的宏，它使用 && 模拟双向“if”，显然使整个问题变得不那么有趣：

```
#define IF(i, t, e) \
(void)((i) && (goto then##__LINE__, 1)); goto else##__LINE__;
then##__LINE__: t; goto cont##__LINE__; \
else##__LINE__: e; cont##__LINE__: ((void)0); 
```

然后你可以定义

```
#define WHILE(c, s) \
loop##__LINE__: IF(c, s; goto loop##__LINE__, ((void)0))) 
```

然后剩下的问题就变得微不足道了。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-03-17T12:21:29.097

```
#include <stdio.h>

static const int factorial[] = {
    1,
    1,
    2,
    6,
    24,
    120,
    720,
    5040,
    40320,
    362880,
    3628800,
};

/* Test/demo program. */
int main(void)
{
    int i;

    for (i = 0; i <= 10; ++i)
        printf("%d %d\n", i, factorial[i]);

    return 0;
} 
```

（任何使用这个答案来回答家庭作业问题的人要么失败，要么有一位幽默感很强的老师。）

（呸，我很慢。其他人已经给出了这个答案。请随意投票他们的答案。）

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-03-17T13:49:20.257

也许我正在解决某人的家庭作业，但这看起来像是一个有趣的挑战，无论如何，这是我的解决方案（编译时带有警告，但如果不让它看起来很丑（呃）就无法帮助那些人）

**编辑：**我更改了程序以使其支持更长的阶乘（最多 20 个左右），并通过删除内部的查找表使代码更整洁`prev()`。

```
#include <stdio.h>
#include <stdlib.h>

#define _if(CND, OP1, OP2) (((CND) && ((OP1) || 1)) || (OP2))

long long int add(long long int x, long long int y){
    long long int r = x ^ y;
    long long int c = x & y;
        c = c << 1;    
    _if(c != 0, r = add(r, c), 1);

    return r;
}

long long int prev(long long int x){
    return add(x, -1);
}                           

long long int mult(long long int x, long long int y){
    long long int r;

    _if(x == 0,
         r = 0,
       _if(x == 1, 
            r = y, 
            r = add(y, mult(prev(x), y))));

    return r;
}

long long int fac(long long int x){
    long long int r;

    _if(x < 2,
        r = 1,
        r = mult(x, fac(prev(x))));

    return r;
}

int main(int argc, char**argv){
    long long int i;

    for(i = 0; i <= 20; i++)
        printf("factorial(%lli) => %lli\n", i, fac(i));

    return 0;
} 
```

样品运行：

```
[dsm@localhost:~/code/c]$ gcc -o proc proc.c
[dsm@localhost:~/code/c]$ ./proc #/
factorial(0) => 1
factorial(1) => 1
factorial(2) => 2
factorial(3) => 6
factorial(4) => 24
factorial(5) => 120
factorial(6) => 720
factorial(7) => 5040
factorial(8) => 40320
factorial(9) => 362880
factorial(10) => 3628800
factorial(11) => 39916800
factorial(12) => 479001600
factorial(13) => 6227020800
factorial(14) => 87178291200
factorial(15) => 1307674368000
factorial(16) => 20922789888000
factorial(17) => 355687428096000
factorial(18) => 6402373705728000
factorial(19) => 121645100408832000
factorial(20) => 2432902008176640000
[dsm@localhost:~/code/c]$ 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-03-17T12:59:59.660

“+”、“-”和“*”是明确禁止的，但“+=”、“-=”和“*=”不是，所以递归实现变成了……</p>

```
int factorial( int arg )
{
    int argcopy = arg;
    argcopy -= 1;
    return arg == 1 ? arg : arg *= factorial( argcopy );
} 
```

VC7 在“编译为 C 源代码模式”时拒绝编译上述内容——抱怨“*=”的 const L 值，但这里有另一个相同的变体：

```
int factorial( int arg )
{
    int argcopy1 = arg;
    int argcopy2 = arg;
    argcopy1 -= 1;
    argcopy2 *= arg == 1 ? 1 : fact( argcopy1 );
    return argcopy2;
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-03-18T16:30:26.987

这不是一个完整的答案，而只是不同的方法`add()`和`mult()`功能：

```
#define add(a, b)  sizeof (struct { char x[a]; char y[b]; })
#define mult(a, b) sizeof (struct { char x[a][b]; }) 
```

（我相信 C 与 C++ 不同，它允许在 a 中定义新类型`sizeof`。）

这是`add()`基于指针算法的另一种（完全不可移植的）实现：

```
int add(int x, int y) {
    return (int) &((char*) x)[y];
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-05-17T15:45:36.660

这是一个解决方案（迄今为止*唯一的一个），它在所需的限制下实际解决了问题。*

```
int fac( int n )
{
    /* The is the binary representation of the function: */
    /* 0000 => 0000000000000000001 */
    /* 0001 => 0000000000000000001 */
    /* 0010 => 0000000000000000010 */
    /* 0011 => 0000000000000000110 */
    /* 0100 => 0000000000000011000 */
    /* 0101 => 0000000000001111000 */
    /* 0110 => 0000000001011010000 */
    /* 0111 => 0000001001110110000 */
    /* 1000 => 0001001110110000000 */
    /* 1001 => 1011000100110000000 */
    int bit0 = n & 1;
    int bit1 = (n & 2) >> 1;
    int bit2 = (n & 4) >> 2;
    int bit3 = (n & 8) >> 3;
    int notbit0 = bit0 ^ 1;
    int notbit1 = bit1 ^ 1;
    int notbit2 = bit2 ^ 1;
    int notbit3 = bit3 ^ 1;
    return
    (bit0 & notbit1 & notbit2 & bit3) << 18 |
    (bit0 & notbit1 & notbit2 & bit3) << 16 |
    (notbit1 & notbit2 & bit3) << 15 |
    (notbit1 & notbit2 & bit3) << 11 |
    (notbit1 & notbit2 & bit3) << 8 |
    (notbit1 & notbit2 & bit3) << 7 |
    (notbit0 & notbit1 & notbit2 & bit3) << 12 |
    (notbit0 & notbit1 & notbit2 & bit3) << 10 |
    (bit0 & bit1 & bit2 & notbit3) << 12 |
    (bit1 & bit2 & notbit3) << 9 |
    (bit0 & bit1 & bit2 & notbit3) << 8 |
    (bit1 & bit2 & notbit3) << 7 |
    (bit0 & bit2 & notbit3) << 5 |
    (bit2 & notbit3) << 4 |
    (notbit0 & bit1 & bit2 & notbit3) << 6 |
    (bit0 & notbit1 & bit2 & notbit3) << 6 |
    (notbit1 & bit2 & notbit3) << 3 |    
    (bit0 & bit1 & notbit2 & notbit3) << 2 |    
    (bit1 & notbit2 & notbit3) << 1 |    
    (notbit1 & notbit2 & notbit3);
} 
```

这是一个测试程序：

```
#include <stdio.h>

int main()
{
    int i, expected, j;
    for( i = 0; i < 10; ++i )
    {
        expected = 1;
        for( j = 2; j <= i; ++j )
        {
            expected *= j;
        }
        if( expected != fac( i ) )
        {
            printf( "FAILED: fac(%d) = %d, expected %d\n", i, fac( i ), expected );
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-17T12:42:52.180

用于`asm`编写汇编代码。

或者，预编译一个程序并从您的程序中执行它。

你为什么要对你的代码施加这样的限制？

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-08-31T08:27:43.463

这是一个解决方案，它使用指针算术进行算术运算，将函数指针用于条件。

```
#include <stdio.h>

int fact(int n);

int mul(int a, int b)
{
        struct s {
                char _v[b];
        };
        struct s *p = (struct s*)0;
        return (int) &p[a];
}

int add(int a, int b)
{
        return (int) (&((char *)a)[b]);
}

int is_0(int n)
{
        return (n == 0);
}

int fact_0(int n)
{
        return 1;
}

int fact_n(int n)
{
        return mul(n, fact(add(n,-1)));
}

int (*facts[2])(int) = {fact_n, fact_0};

int fact(int n)
{
        return facts[is_0(n)](n);
}

int main(int argc, char **argv)
{
        int i;
        for(i = 0; i<=10; i++) {
                printf("fact %d = %d\n", i, fact(i));
        }
} 
```

样品运行：

```
 ~ > gcc -std=c99 fact.c 
 ~ > ./a.out 
fact 0 = 1
fact 1 = 1
fact 2 = 2
fact 3 = 6
fact 4 = 24
fact 5 = 120
fact 6 = 720
fact 7 = 5040
fact 8 = 40320
fact 9 = 362880
fact 10 = 3628800 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-17T12:17:07.763

生成一组巨大的三元运算符，为每个允许的输入返回一个预先计算的值。使用宏来计算值。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-17T12:17:47.390

计算阶乘是您第一次（对很多人来说也是最后一次）使用递归。标准实现是

```
long fact(int x)
{
   if (x < 2)
     return 1L;
   else
     return fact(x - 1) * x;
} 
```

有些人会争辩说最后一条语句应该是“x * fact(x-1)”，以便编译器可以识别它是尾递归。就个人而言，我怀疑任何编译器都足够聪明，可以以那种形式看到它，而不能以另一种形式看到它。

但是，由于您已将其限制为不使用“if”或“-”，我不知道您将如何做到这一点。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-17T12:24:35.673

粗略的草图（已经被别人提出了！）

```
int[] factorials = {1,1,2,6,24, 120,720, ..etc };
return factorials[i]; 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-17T12:28:40.983

我也尝试将值放入数组中。在这里，我使用了 if 条件和 while 循环，但不涉及算术运算符。！尝试我是否也可以删除它们。

```
#include <stdio.h>

int add(int a, int b)
{
int t1, t2, ab, bb, cb=0, orb=1, ans=0;

do {
    t1 = a >> 1; 
    t2 = t1 << 1;

    if (a==t2) ab=0; else ab=1;

    t1 = b >> 1;
    t2 = t1 << 1; 

    if (b==t2) bb=0; else bb=1;

    if (ab==1 && bb==1) { 
        if (cb==1) ans=ans | orb; 
        cb = 1; 
        }

    if ( ab!=bb ) { 
        if (cb==0) ans = ans | orb; 
        }

    if (ab==0 && bb==0) {
        if (cb==1) { 
        ans = ans | orb;
        cb=0;
                }
        }

    orb = orb << 1; 
    a = a >> 1;
    b = b >> 1;

    } while (a!=0 || b!=0);

if (cb==1) ans = ans | orb;

return ans;
}

int multiply(int x,int y)
{
    int result = 0, i = 0 , j=0;

    while((i=add(i,1)) <= y)
        result = add(result,x);

    return result;

}

int factorial(int x)
{
    if(x==1)
        return 1;
    else
        return multiply(x,factorial(x-1));

}

int main()
{
    int x;
    printf("Enter a number between 0 and 10: ");
    scanf("%d" , &x);
    printf("\nFactorial: %d\n" , factorial(x));
    return 0;
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-01-21T22:39:03.410

让我们看看我们是否可以做一些半优雅的事情，而不依赖于*1 <= n <= 10*。

*   我们当然不会使用循环，而是使用递归。
*   **我们将使用函数指针数组来**代替 if 来终止递归！
    （我们仍然需要比较运算符，例如`<`and `==`。）

**编辑：** damaru 首先使用了函数指针技巧。

这给出了： [*所有代码都未经测试，手头没有 C 编译器！*]

```
typedef int (*unary_fptr)(int);

int ret_1(int n) {
    return 1;
}

int fact(int n) {
    unary_fptr ret_1_or_fact[] = {ret_1, fact};
    return multiply(ret_1_or_fact[n > 1](sub_1(n)), n);
} 
```

我们仍然需要实现`sub_1`和`multiply`。让我们从 开始`sub_1`，这是对位的简单递归，直到进位停止（如果您不理解这一点，最后的类似`add_1`内容更容易考虑）：

```
int identity(int n) {
    return n;
}

int sub_1(int n) {
    unary_fptr sub_1_or_identity[] = {sub_1, identity};
    int lsb = n & 1;
    int rest = sub_1_or_identity[lsb](n >> 1);
    return (rest << 1) | (lsb ^ 1);
} 
```

`multiply`：我能想到的最简单的是[俄罗斯农民乘法](http://en.wikipedia.org/wiki/Ancient_Egyptian_multiplication#Peasant_multiplication)，它将它简化为二进制移位和加法。使用条件，递归公式将如下所示：

```
 /* If we could use conditionals */
int multiply(int a, int b) {
    int subproduct;
    if(a <= 1) {
       subproduct = 0;
    } else {
       subproduct = multiply(a >> 1, b << 1);
    }

    if(a & 1) {
       return add(b, subproduct);
    } else {
       return subproduct;
    }
} 
```

如果没有条件，我们必须使用两次调度数组技巧：

```
typedef int (*binary_fptr)(int, int);

int ret_0(int a, int b) {
    return 0;
}

int multiply(int a, int b) {
    binary_fptr ret_0_or_multiply = {ret_0, multiply};
    int subproduct = ret_0_or_multiply[a >= 2](a >> 1, b << 1);

    binary_fptr ret_0_or_add = {ret_0, add};
    return ret_0_or_add[a & 1](subproduct, b);
} 
```

现在我们想念的是`add`. 您现在应该猜到它会如何进行 - 同时递归两个数字的位，这将问题减少到移位和`add_1`：

```
int add(int a, int b) {
    int lsb = (a & 1) ^ (b & 1);
    int carry = (a & 1) & (b & 1);

    binary_fptr ret_0_or_add = {ret_0, add};
    int subsum = ret_0_or_add[(a >= 2) & (b >= 2)](a >> 1, b>> 1);

    unary_fptr identity_or_add_1 = {identity, add_1};
    return identity_or_add_1[carry](subsum << 1);
} 
```

并且`add_1`是对位的简单递归，直到进位停止：

```
int add_1(int n) {
    unary_fptr identity_or_add_1[] = {identity, add_1};
    int lsb = n & 1;
    int rest = identity_or_add_1[lsb](n >> 1);
    return (rest << 1) | (lsb ^ 1);
} 
```

我想就是这样！[*如上所述，所有代码都未经测试！*]

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-17T12:18:19.133

如果您不能使用递归或算术并且输入范围有限，则可以将结果硬编码为数组查找，

所以：

```
return factorials[x]; 
```

您已预先填写`factorials`相关值的位置

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-19T14:54:47.847

如果我们必须计算 1 到 100 的阶乘怎么办。如何存储这么大的数字？

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-05-17T12:26:50.923

```
#include<stdio.h>
void main()
{
    unsigned long int num,fact,counter;
    while(counter<=num)
    {
        printf("Enter the number");
        scanf("%d",&num);
        fact=fact*counter;
        counter++;
        printf("The factorial of number entered is %lu",fact);
    }
    printf("press any key to exit...");
    getch();
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-11-12T16:00:01.497

因为它没有说不使用库函数：

```
#include    <stdlib.h>
#include    <stdio.h>
#include    <math.h>

int main( int argc, char** argv)
{
    printf( "%d\n", (int)round( exp( lgamma(2))));
    printf( "%d\n", (int)round( exp( lgamma(3))));
    printf( "%d\n", (int)round( exp( lgamma(4))));
    printf( "%d\n", (int)round( exp( lgamma(5))));
    printf( "%d\n", (int)round( exp( lgamma(6))));
    printf( "%d\n", (int)round( exp( lgamma(7))));
    printf( "%d\n", (int)round( exp( lgamma(8))));
    printf( "%d\n", (int)round( exp( lgamma(9))));
    printf( "%d\n", (int)round( exp( lgamma(10))));
    printf( "%d\n", (int)round( exp( lgamma(11))));

    return 0;
} 
```

# .net - 控制台应用程序 (.NET) 中的 SOAP 请求超时

> ID：653963
> 
> 赞同：3
> 
> 时间：2009-03-17T12:13:02.987
> 
> 标签：.net, soap, request-timed-out

我在控制台应用程序中添加了一个 SOAP Web 服务，每次我进行特定调用时，它都会超时。其他电话工作正常。如何增加控制台应用程序中的超时长度？似乎目前大约是 90 秒。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T12:32:18.803

您可以通过设置[Timeout](http://msdn.microsoft.com/en-us/library/system.web.services.protocols.webclientprotocol.timeout.aspx)属性来设置 Web 服务客户端超时。默认值为 100000 毫秒（100 秒）。

例如：

```
MyWebServices.Webservice svc = new MyWebServices.Webservice();
// Set timeout to 200 seconds
svc.Timeout = 200000;
svc.DoWork(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T12:31:53.253

这应该允许您更改超时，然后验证它是否已更改。

公共 int 超时 { 获取；放; }

[Transaction(Timeout=30)] public class TransactionAttribute_Timeout : ServicedComponent { public void TimeoutExample() { // 获取应用到类的 TransactionAttribute。TransactionAttribute 属性 = (TransactionAttribute)Attribute.GetCustomAttribute(this.GetType(), typeof(TransactionAttribute), false);

```
 // Display the current value of the attribute's Timeout property.
    Console.WriteLine("TransactionAttribute.Timeout: {0}",
        attribute.Timeout);

    // Set the Timeout property value of the attribute to sixty
    // seconds.
    attribute.Timeout = 60;

    // Display the new value of the attribute's Timeout property.
    Console.WriteLine("TransactionAttribute.Timeout: {0}",
        attribute.Timeout);
} 
```

}

# java - 为什么在使用 context.lookup("java:comp/env/MyBean") 时会出现 NameNotFoundExcpetion

> ID：653966
> 
> 赞同：1
> 
> 时间：2009-03-17T12:14:55.413
> 
> 标签：java, jakarta-ee, ejb

为什么我在使用`context.lookup("java:comp/env/MyBean")`时会得到 NameNotFoundException 而在使用时却没有`context.lookup(MyBean.class.getName())`？

错误报告“No object bound for java:comp/env/MyBean”如何绑定名称，为什么`class.getName()`仍然有效？为什么我要使用 java:comp/env ？

我正在使用 Netbeans 6.5、Glassfish 2.1。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-17T12:20:08.193

**java:comp/env**前缀用于称为资源引用的东西。它是您正在查找的资源与资源的实际 JNDI 名称之间的抽象。它允许您更改底层资源的位置（即不同的服务器和上下文），而不会影响您的查找代码。

我只在 WAS 中使用过它，但想法是为需要访问资源的每个模块创建对现有资源（JMS、JDBC、EJB ...）的引用。它是您的部署配置的一部分。

[来自 Sun 的教程](http://java.sun.com/j2ee/tutorial/1_3-fcs/doc/Resources2.html)和[Glassfish 示例在这里。](http://forums.java.net/jive/message.jspa?messageID=242010)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-24T21:52:44.750

我不确定这是否适用于 Glassfish，但在 JBOSS 的情况下，如果您打开 DEBUG，您会注意到将使用的 jndi 名称。

例如，在部署名为 DemoBean 的会话 bean 期间，您将在 server.log 文件中看到以下日志：-

2009-07-24 09:08:18,747 调试 [org.jboss.ejb3.stateless.StatelessDelegateWrapper] 创建 jboss.j2ee:jar=SessionBeanDemo.jar,name=DemoBean,service=EJB3 2009-07-24 09:08:18,747 DEBUG [org.jboss.ejb3.ProxyDeployer] 没有声明远程绑定：DemoBean 2009-07-24 09:08:18,747 DEBUG [org.jboss.ejb3.ProxyDeployer] DemoBean 2009-07-24 09 有远程接口： 08:18,747 DEBUG [org.jboss.ejb3.ProxyDeployer] 默认远程绑定的 jndiName 为***DemoBean/remote***

然后在您的客户端代码中，您可以像这样查找它：-

```
 InitialContext ctx;
        try {
            ctx = new InitialContext();
            DemoBeanRemote demo = (DemoBeanRemote) ctx.lookup("DemoBean/remote");
            System.out.println(demo.sayHello());
        } catch (NamingException e) {
            e.printStackTrace();
        } 
```

# c# - Visual Studio 有断点插件吗？

> ID：653974
> 
> 赞同：17
> 
> 时间：2009-03-17T12:18:35.217
> 
> 标签：c#, .net, visual-studio, visual-studio-2008, plugins

### 背景

在一些足够大的应用程序中，与实际调试相比，您可以花更多的时间来确定如何深入到各个层：我现在正在开发的一个软件就是这种情况。除了关注点的布局/分离问题，最好有一个断点插件，它允许您根据正在处理的 Bugzilla/Jira/Fogbugz/SVN 缺陷条目加载断点。

### 问题

是否存在任何适用于 Visual Studio 的插件，允许您将切换的断点“保存”到文件中，允许您根据正在处理的错误加载各种断点？

作为该问题的补充；如果没有任何此类插件，谁能指出我为 Visual Studio 创建插件的“好”（相当主观的术语，但在这种情况下，我的意思是解释性和有用的）资源？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-17T12:23:27.610

这个怎么样：“[调试器设置 Visual Studio 插件——在机器之间轻松复制断点](https://www.wintellect.com/debugger-settings-visual-studio-add-in-easily-copy-breakpoints-between-machines/)”？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-02-01T09:44:29.330

似乎 Visual Studio 2010 (Professional) 添加了“将断点导出到文件”功能。（您可以在断点窗口中找到它。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-22T16:19:22.993

我根据最近的谷歌搜索找到了这个：

[Rick Schott](http://blog.devlpr.net/)的[断点工作区](http://bpworkspaces.codeplex.com/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-17T12:25:00.803

查看[Visual Studio 的断点分析器](http://intuitlabs.com/apps/breakpoint-analyzer-for-microsoft-visual-studio)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T07:20:03.527

断点分析器是调试大型项目的非常有用的工具。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-04-05T17:55:33.413

我在网上搜索答案时偶然发现了这一点。由于这个问题已经很老了，我想我会提供一个更新的答案。

现在，您实际上可以从断点窗口 ( `ctrl`++ `alt`)在 Visual Studio`b`中导入和导出断点

[https://msdn.microsoft.com/en-us/library/dd293657(v=vs.100).aspx](https://msdn.microsoft.com/en-us/library/dd293657(v=vs.100).aspx)

# javascript - 在关闭浏览器窗口之前调用 URL

> ID：653976
> 
> 赞同：4
> 
> 时间：2009-03-17T12:19:09.337
> 
> 标签：javascript, jquery

我想在网页的卸载功能中调用 URL，但在卸载功能中，获取请求不起作用。我的代码如下所示：

```
$(window).unload( function () { 
   jQuery.get("someurl")
} ); 
```

我们希望收到有关关闭某些用户操作记录的窗口的通知。有可能吗？

如果我在 jQuery.get() 之后添加一个 alert()，则 Get-Request 有足够的时间来执行此操作，但这不是我们喜欢的。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-17T12:29:23.087

采用：-

```
jQuery.ajax({url:"someurl", async:false}) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-17T12:35:27.923

您需要直接使用 onbeforeunload 事件。在这种情况下，您可以触发 ajax 调用。这是 jQuery 还没有真正有用的地方。几点注意事项：

不要从 onbeforeunload 事件返回任何内容，否则浏览器将向用户显示“您确定要离开此页面”弹出窗口

如果您使 ajax 调用同步，它将在运行时停止页面卸载。如果您将其设为异步，则页面将在调用运行时更改（您只是不能为该调用提供 javascript 事件处理程序）。由于 jQuery 连接了事件处理程序，因此它的 ajax 支持在这里没有那么有用。

```
window.onbeforeunload = function() {
   var URL = 'someplace';
   var request = null;

    if (window.XMLHttpRequest){
        request = new XMLHttpRequest();
    } else if (window.ActiveXObject) {
        request = new ActiveXObject("Microsoft.XMLHTTP");
    }

    if (request) {
        request.open("GET", URL, false);
        request.send();
    }
} 
```

# c++ - 常用 C++ 优化技术列表

> ID：653980
> 
> 赞同：22
> 
> 时间：2009-03-17T12:20:32.857
> 
> 标签：c++, c, optimization, gcc, g++

我可以列出一份常见的 C++ 优化实践吗？

我所说的优化是指您必须修改源代码才能更快地运行程序，而不是更改编译器设置。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-17T12:58:02.177

我将回应其他人所说的：更好的算法将在性能提升方面获胜。

也就是说，我从事图像处理工作，作为一个问题域，它可能更具粘性。例如，很多年前我有一段代码看起来像这样：

```
void FlipBuffer(unsigned char *start, unsigned char *end)
{
    unsigned char temp;

    while (start <= end) {
        temp = _bitRev[*start];
        *start++ = _bitRev[*end];
        *end-- = temp;
    }
 } 
```

它将 1 位帧缓冲区旋转 180 度。_bitRev 是一个 256 字节的反转位表。这段代码尽可能地紧凑。它在 8MHz 68K 激光打印机控制器上运行，打印一张合法大小的纸大约需要 2.5 秒。为了省去你的细节，客户不能忍受2.5秒。解决方案是与此相同的算法。不同之处在于

1.  我使用了一个 128K 的表，对字而不是字节进行操作（68K 对字更满意）
2.  我使用 Duff 的设备展开循环，使其尽可能适合短分支
3.  我进行了优化以跳过空白词
4.  我终于在汇编中重写了它，以利用 sobgtr 指令（减一并在更大的方向上分支）并在正确的位置有“自由”的后增量和预减量。

所以 5x：没有算法改变。

关键是您还需要了解您的问题域以及瓶颈的含义。在图像处理中，算法仍然是王道，但是如果您的循环正在做额外的工作，那么将该工作乘以几百万，这就是您付出的代价。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-17T12:31:37.870

编写更好程序的两种方法：

**充分利用语言**

1.  史蒂夫·麦康奈尔完成的代码
2.  有效的 C++
3.  卓越的 C++

**分析您的应用程序**

1.  确定哪些代码区域花费了多少时间
2.  看看你是否可以使用更好的数据结构/算法来让事情变得更快

没有太多语言特定的优化可以做 - 它仅限于使用语言结构（从＃1中学习）。主要的好处来自上面的#2。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-03-17T12:35:48.967

不要忘记一些事情：
-“我们应该忘记小的效率，比如大约 97% 的时间：过早的优化是万恶之源。” (c) Donald Knuth
- 如果我们优化算法而不是代码，我们可以获得更多。**- 我们将仅优化现有**
代码 的慢速部分，这些部分将被分析器或其他特殊工具检测到。

 *** * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-17T12:42:31.603

Agner Fog 在分析几个编译器关于 C++ 结构的输出方面做得很好。你可以在这里找到他的作品：[http](http://www.agner.org/optimize/) ://www.agner.org/optimize/ 。

英特尔也提供了一个很棒的文档——“英特尔® 64 和 IA-32 架构优化参考手册”，您可以在[http://www.intel.com/products/processor/manuals/index.htm](http://www.intel.com/products/processor/manuals/index.htm)找到该文档。虽然它主要针对 IA-32 架构，但它包含可应用于大多数平台的一般建议。显然，它和 Agner Fog 的指南确实有一点交叉。

正如其他答案中所提到的，在分析和算法选择之后，微优化显然是您想要使程序更快的最后一步。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-10-13T22:28:01.540

您可能对此感兴趣：[优化 C++ Wikibook](http://en.wikibooks.org/wiki/Optimizing_C%2B%2B)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-17T12:24:40.320

我没有想到一个网站，但是 Sutter 的“Exceptional C++”一书对于 C/C++ 开发来说是极好的。我强烈建议每位 C++ 程序员阅读这本书，因为它不仅对优化而且对语言的智能使用提供了深刻的见解，因此您将编写出真正出色的程序。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-17T13:04:47.213

在其他工程学科中，为系统的组件分配预算是很常见的。例如，垂直起降飞机的发动机设计为提供一定的升力，因此重量必须在限制范围内。在较高的水平上，飞机的每个部分都被赋予了它应该满足的一部分重量预算。

之所以这样做是自上而下，而不是等到它太臃肿而无法从甲板上下来，然后称重每个零件并从最重的部分锉掉一点，部分原因是更换制造组件的成本。但很大一部分原因是，如果你创建的系统到处都超出预算，你就不能只在一个地方修复它。

经典的软件示例是[SGI Indy Irix 5.1](http://catless.ncl.ac.uk/Risks/15.80.html#subj4)，这也是图形密集型用户现在拥有 Mac 和 Windows 机器而不是 SGI 机器的部分原因。

*“5.1 的表现最可怕的是没人知道它到底去了哪里。如果你开始四处打听，你会得到很多指责和理论，但事实却很少。在 5 月的报告中，我提出了一个“5% 理论” ，其中指出我们添加的每个小东西（Motif、国际化、拖放、DSO、多种字体等）大约花费机器的 5%。在其中 15 或 20 个之后，大部分性能都消失了。”*

经常在讨论性能时，据说5%微不足道，建议是等到出现问题后再寻找单个瓶颈。对于大型系统，等到出现问题可能只会让您失去主要业务。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-17T13:04:01.397

++p 通常比 p++ 快，而 --p 比 p-- 快，尤其是对于具有重载前缀和后缀递增和递减运算符的类型的对象，因为前缀形式只是递增或递减某些内容并返回新值，而后缀形式增加或减少某些东西，但必须将旧值保留在某个地方才能返回它。也就是说，而不是（在此处将 int 替换为您最喜欢的类）

```
for ( int i ( 0); i < x; i++) 
```

总是写

```
for ( int i ( 0); i < x; ++i) 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-17T13:54:26.440

您要求提供包含优化智慧的站点/资源。

已经推荐了一些好的。

我可能会补充一点，他们几乎都会说，如果不是定位性能问题的唯一方法，分析是最好的。

我不确定这种民间智慧的起源或它的合理性，但[有更好的方法](https://stackoverflow.com/questions/375913/what-can-i-use-to-profile-c-code-in-linux/378024#378024)。

添加：

确实，“错误的算法”会降低性能，但这肯定不是唯一的方法。

我做了很多性能调整。在大型软件上，通常会影响性能的是太多的数据结构和太多的抽象层。

对抽象对象的看似无辜的单行方法调用会诱使您忘记该调用可能会花费您什么。将这种趋势乘以几个抽象层，你会发现，例如，当带有索引的简单数组已经足够（并且同样可维护）但不太“合适”时，将所有时间都花在分配和收集迭代器和集合类之类的东西上”。

这就是“常识”的问题。它往往与智慧完全相反。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-17T21:28:15.140

大多数技术是特定于*编译器*的，因为不同的编译器优化不同。

如果您想要一些与编译器无关的优化技巧，这里有两个适合您：

1.  不要这样做。
2.  （仅限专家！）：不要这样做。

[（向迈克尔·杰克逊](http://en.wikipedia.org/wiki/Michael_A._Jackson)道歉）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-17T12:34:14.090

大多数优化与语言无关。了解您的代码，了解您正在运行的硬件，您可以进行大多数低级优化。

了解您的问题域和合适的算法，您可以进行任何高级优化。

我能想到的唯一特定于 C++ 的优化建议是“了解您的代码的含义”。了解 C++ 何时复制临时对象，了解何时调用了哪些构造函数和析构函数。

并且更喜欢函子而不是函数指针，因为前者可以由编译器内联。一般来说，尽可能多地转移到编译时而不是运行时。使用模板来完成繁重的工作。

*当然，在您分析并发现 1) 优化是必要的，以及 2) 需要优化什么*之前，不要尝试优化。

*编辑*：一条评论询问了内联的仿函数与函数指针。这是解释：

函数通常是单独编译的。那么编译器对以函数指针 FP 作为参数的函数 F 了解多少呢？没什么，它必须查找调用 F 的位置，*也许*在那里它可以找到关于 FP 指向哪个函数的明确线索。*如果*它可以确定当从这里调用时，FP 将*始终*指向函数 G，那么是的，它可以为这个特定的调用站点制作一个内联版本的 F，其中内联 G。但它不能简单地内联 G 而不内联 F，因为 F 也可能从其他地方调用，在那里它被传递一个不同的函数指针。即便如此，它也需要一些昂贵的全局优化来确定任何东西都可以内联。

想象一下，你传递了一个这样的函子：

```
struct Ftor {
  void operator()() { ... }
}; 
```

所以函数 F 看起来像这样：

```
void F(const FTor& ft) {
  ...
  ft();
  ...
} 
```

现在编译器知道调用了哪个函数：函数中的第 2 行调用 Ftor::operator() *。*因此可以轻松地内联调用。

当然，在实践中，您通常会对其进行模板化，因此可以使用任何函子类型调用该函数：

```
template <typename F>
void F(const F& ft) {
  ...
  ft();
  ...
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-17T12:35:44.787

1.  分析您的代码以查找实际花费最多的时间
2.  确保您使用正确的算法
3.  如果您要进行大量数字运算，请对缓存友好，并尝试一次对一大块数据做所有可能的事情，这样就不必多次将其加载到缓存中。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-17T21:40:31.523

抱歉，我没有任何参考资料可供您参考，但我确实有另一个轶事要补充。

我使用 Microsoft 的 CString 对象作为键生成了一个相当大的 std::map。性能是不可接受的。由于我的所有字符串的长度都相同，因此我围绕老式的固定大小的字符数组创建了一个类包装器，以模拟 CString 的接口。不幸的是，我不记得确切的加速，但它很重要，并且由此产生的性能绰绰有余。

有时您需要了解一些您所依赖的库结构。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-02-13T07:52:54.670

模板元编程可用于从动态多态转移到编译时多态，在此过程中生成极其优化的代码。Alexandrescu 的[Modern C++ Design](http://erdani.com/index.php/books/modern-c-design/)是一本深入介绍 TMP 的好书。并非每一页都与优化有关，但它是程序设计中经常出现的考虑因素。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2016-09-29T18:06:50.037

与许多人所说的相反，您可以进行许多特定于语言的优化。[这是 Wikibooks 上的极好资源](https://en.m.wikibooks.org/wiki/Optimizing_C%2B%2B)。在设计代码时请记住这一点，然后是配置文件、配置文件、配置文件。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-17T12:32:46.103

可以得到的最佳优化是重新审视设计，并在分析应用程序的性能相关部分/算法之后。这通常不是特定于语言的。

我的意思是（只是一个想法）如果您通过选择稍微更好的算法（或集合/容器类）可以获得 30% 的性能提升，那么您可以从 C++ 相关的重构中获得的提升最多为 2%。设计改进可以为您带来 30% 以上的收益。

如果您有一个具体的应用程序，最好的策略是测量和分析该应用程序。分析通常可以最直接地了解哪些部分与性能相关。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-17T15:14:12.410

这里有几个捕获所有优化路径。

优化问题没有**一种**方法……它们总是根据硬件/软件/系统考虑因素进行手动调整。

* * *

假设你有最好的算法：

1.  使用“显示程序集输出”和“最高优化”进行编译
2.  查看汇编输出
3.  识别破坏编译器优化或缓存不良的低效率
4.  重新编码片段
5.  如果它仍然是坏的循环回到 2。
6.  完毕

此处看到的示例：[在 C 中交换值的最快方法是什么？](https://stackoverflow.com/questions/36906/what-is-the-fastest-way-to-swap-values-in-c/615995#615995)

* * *

一般提示：

[http://www.ceet.niu.edu/faculty/kuo/exp/exp6/figuree6-1.jpg](http://www.ceet.niu.edu/faculty/kuo/exp/exp6/figuree6-1.jpg)：

*   先用浮点数试试
*   定点秒试
*   如果你真的很不同并且有很多时间和金钱，请在组装中尝试

[http://www.asc.edu/seminars/optimization/fig1.gif](http://www.asc.edu/seminars/optimization/fig1.gif)：

*   检查它是否受内存、I/O 或 CPU 限制
*   攻击是限制因素

* * *

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-06-29T04:42:01.283

您可以做很多事情来优化 C++ 代码。上面列出了一些更广泛的建议。

几个具体的例子是：

1.  使用数组结构而不是结构数组（DOP 与 OOP 的经典示例）
2.  当您知道两个指针不会指向相同的内存位置时，在 C++ 中使用**限制**

一般来说，遵循诸如面向数据编程之类的基本编程范式将产生更高的性能，因为 DOP 是专门为关注性能而制定的（在所有形式中：内存布局、缓存一致性、运行时成本等）

更多信息：[https ://people.cs.clemson.edu/~dhouse/courses/405/papers/optimize.pdf](https://people.cs.clemson.edu/~dhouse/courses/405/papers/optimize.pdf)

# java - 将 int 转换为 String 的最有效方法是什么？

> ID：653990
> 
> 赞同：66
> 
> 时间：2009-03-17T12:23:11.510
> 
> 标签：java, string

说我有：

```
int someValue = 42; 
```

现在我想将该 int 值转换为字符串。哪种方式更有效？

```
// One
String stringValue = Integer.toString(someValue);

// Two
String stringValue = String.valueOf(someValue);

// Three
String stringValue = someValue + ""; 
```

我只是好奇是否有任何真正的区别或者一个比另一个更好？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-03-17T12:32:39.693

对 10 号的 1000 万个任务进行了测试

```
One:
real    0m5.610s
user    0m5.098s
sys     0m0.220s

Two:
real    0m6.216s
user    0m5.700s
sys     0m0.213s

Three:
real    0m12.986s
user    0m11.767s
sys     0m0.489s 
```

一个似乎赢了

编辑：JVM 是 Mac OS X 10.5 下的标准 '/usr/bin/java'

```
java版本“1.5.0_16”
Java(TM) 2 运行时环境，标准版（内部版本 1.5.0_16-b06-284）
Java HotSpot(TM) Client VM（build 1.5.0_16-133，混合模式，共享）

```

更多编辑：

按要求编码

```
public class One {
    public static void main(String[] args) {
        int someValue = 10;
        for (int i = 0; i < 10000000; i++) {
            String stringValue = Integer.toString(someValue);
        }
    }
} 
```

案例 2 和 3 类似地
使用

```
javac *.java; time java One; time java Two; time java Three 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-03-17T12:38:28.337

尽管根据[cobbal 的测量](https://stackoverflow.com/questions/653990/what-is-the-most-efficient-way-to-convert-an-int-to-a-string/654031#654031)，#1 似乎是最快的，但我强烈建议使用`String.valueOf()`. 我这样做的原因是这个调用没有明确包含参数的类型，所以如果你以后决定将它从 int 更改为 double，则不需要修改这个调用。与#2 相比，#1 的速度提升微乎其微，众所周知，“过早的优化是万恶之源”。

第三种解决方案是不可能的，因为它隐式创建 a`StringBuilder`并将组件（在本例中为数字和空字符串）附加到它，最后将其转换为字符串。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-17T12:28:27.050

查看 JRE 的源代码，您可能会发现不同之处。或者没有。实际上 Strinv.valueOf(int foo) 的实现如下：

```
public static String valueOf(int i) {
    return Integer.toString(i, 10);
} 
```

和 Integer.toString(int foo, int radix)

```
public static String toString(int i, int radix) {
   ...
   if (radix == 10) {
   return toString(i);
   }
   ...
} 
```

这意味着如果您使用基数 10，您最好直接调用 Integer.toString(int foo)。对于其他情况，使用 Integer.toString(int foo, int radix)。

concat 解决方案首先将 int 值转换为 String，然后与空 String 连接。这显然是最昂贵的案例。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-17T12:29:11.637

前两个示例实际上是相同的，因为 String.valueOf(int) 使用 Integer.toString(int) 方法。第三个是丑陋的，并且可能效率较低，因为 Java 中的连接速度很慢。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-17T12:43:53.097

（大卫·哈纳克对面。）

尽管根据 cobbal 的测量，#1 似乎是最快的，但我强烈建议使用 Integer.toString()。我这样做的原因是这个调用明确地包含了参数的类型，所以如果你以后决定将它从 int 更改为 double，很明显这个调用已经改变了。如果它是二进制格式，您也会这样做，不是吗？与#2 相比，#1 的速度提升微乎其微，众所周知，“过早的优化是万恶之源”。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-17T12:43:25.080

`"" + int`正如上面大卫哈纳克所示，速度较慢。

`String.valueOf()`反过来电话`Integer.toString()`。因此，使用`Integer.toString()`更好。

所以，`Integer.toString()`是最快的..

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-10-15T10:37:12.310

我**对 JDK 11 的微基准测试结果**与当前接受的答案非常不同，显示出**最小的运行时差异**，并且根本没有内存使用/分配差异：

```
 t (ms)   method

 12,30    "" + j
 12,57    Integer.toString(j)
 12.58    String.valueOf(j) 
```

实际上，我[写这个](https://stackoverflow.com/a/69583126/15472)微基准是为了解决[一个不同的问题](https://stackoverflow.com/q/69580732/15472)；一位评论者建议我也在这里发帖。重现代码（也来自该帖子）如下：

```
package org.example;

import com.google.caliper.BeforeExperiment;
import com.google.caliper.Benchmark;
import com.google.caliper.Param;
import com.google.caliper.runner.CaliperMain;

public class Main {

    @Param({"10", "100", "1000"})
    int size;

    private String[] output;

    @BeforeExperiment
    void setUp() {
        output = new String[size];
    }

    @Benchmark void quote(int reps) {
        for (int i = 0; i < reps; i++) {
            for (int j = 0; j < size; j++) {
                output[j] = "" + j;
            }
        }
    }

    @Benchmark void toString(int reps) {
        for (int i = 0; i < reps; i++) {
            for (int j = 0; j < size; j++) {
                output[j] = Integer.toString(j);
            }
        }
    }

    @Benchmark void valueOf(int reps) {
        for (int i = 0; i < reps; i++) {
            for (int j = 0; j < size; j++) {
                output[j] = String.valueOf(j);
            }
        }
    }

    /*
    must have com.google.caliper:caliper:1.0-beta-3 in pom.xml; run with:
    mvn clean compile exec:java -Dexec.mainClass="com.google.caliper.runner.CaliperMain" -Dexec.args="org.example.Main"
     */
    public static void main(String[] args) {
        CaliperMain.main(Main.class, args);
    }
} 
```**``**