# StackOverflow 问答 000600000-000600999

# .net - 是否可以从 vbscript 执行 .NET 程序集（dll）？

> ID：600012
> 
> 赞同：6
> 
> 时间：2009-03-01T16:03:06.860
> 
> 标签：.net, dll, com, vbscript, assemblies

我想以同步方式从 vbscript 执行 .NET dll 文件 - 这可能吗？如果是，是否可以执行 GAC 程序集？

谢谢，奥弗

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-01T16:14:04.413

我认为您必须首先通过在 AssemblyInfo.cs 文件中包含 ComVisible 属性来使 .NET 程序集 COM 可见：

```
[ComVisible(true)] 
```

请参阅 MSDN 上的此页面：[为 COM 打包程序集](http://msdn.microsoft.com/en-us/library/bctyca52(VS.71).aspx#cpconpackagingassemblyforcomanchor1)

然后在 VBScript 中，您可以通过访问 COM 组件的相同方式访问这些组件，即使用 CreateObject 或 Server.CreateObject，如下所示：

```
Set testObj = CreateObject("MyNamespace.MyType") 
```

我认为 GAC 甚至可能强制从 VBScript 访问它，但我没有这样做，所以我不确定。

为什么要在 VBScript 中这样做？为什么不直接制作一个 .NET 控制台应用程序来完成您的 VBScript 所要做的事情呢？由于 DLL 已经在 .NET 上，这应该不是问题，对吧？

* * *

**编辑：**执行此操作的另一种方法可能是创建控制台 EXE 而不是 DLL（或包装 DLL 的 EXE），您可以像普通可执行程序一样从 VBScript 调用并检查返回结果。根据许多因素，这可能比维护 COM 代码更灵活。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-01T16:08:50.183

VBScript 只能执行来自 COM 对象的代码，因此您需要为您的 .NET 代码创建一个 COM 包装器，然后您应该能够调用您的 .NET 代码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-01T16:09:10.307

不是直接的。

如果 .NET 程序集作为 COM 组件公开，那么它可能是。

# c# - TextReader.ReadLine 返回不完整的行

> ID：600022
> 
> 赞同：0
> 
> 时间：2009-03-01T16:09:05.613
> 
> 标签：c#, networking

我正在使用 a`Socket`通过 TCP 接收数据，并`TextReader.ReadLine`从连接中读取行。有一个问题是没有收到完整的行——`TextReader.ReadLine`返回一个不完整的字符串。我希望它返回`null`，表示无法读取整行。我怎样才能做到这一点？

基本上，我收到了这些数据：

```
"hello\nworld\nthis is a test\n" 
```

当我跑步时，`ReadLine`我会得到这些回报：

```
"hello"
"world"
"this is a te"
<null>
<socket gets more data>
"st"
<null> 
```

我不希望返回“this is a te”。相反，我希望“这是一个测试”等到收到整条线。

代码：

```
var endPoint = ...;
var socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.IP);
socket.Connect(endPoint);

var stream = new NetworkStream(socket, true);

var messageBuffer = new StringBuilder();

// Data received async callback (called several times).
int bytesRead = stream.EndRead(result);
string data = Encoding.UTF8.GetString(readBuffer.Take(bytesRead).ToArray());
messageBuffer.Append(data);

using(var reader = new StringReader(messageBuffer.ToString()))
{
    // This loop does not know that Message.Read reads lines.  For all it knows, it could read bytes or words or the whole stream.

    while((Message msg = Message.Read(reader)) != null)  // See below.
    {
        Console.WriteLine(msg.ToString());    // See example input/echo above.
    }

    messageBuffer = new StringBuilder(reader.ReadToEnd());
}

// Method of Message.
public static Message Read(TextReader reader)
{
    string line = reader.ReadLine();

    if(line == null)
        return null;

    return Message.FromRawString(line);
} 
```

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T16:16:45.267

听起来数据正在发送一些额外的分隔符。假设您在网络流上使用 StreamReader，它的行为应该完全符合您的预期。我建议您使用 Wireshark 查看您的套接字正在接收的确切数据。

我也怀疑它是否返回 null 然后另一行 - 你确定你不是说它返回一个空字符串然后另一行吗？

编辑：现在您已经发布了代码，原因更清楚了 - 您一次只解码一个缓冲区。这真的行不通，并且可能以更严重的方式中断。缓冲区甚至可能不会在*字符*边界处中断。

老实说，同步阅读和使用`StreamReader`. 异步执行此操作，如果需要，您应该使用`System.Text.Decoder`可以存储任何先前状态（从先前缓冲区的末尾）的 a。您还必须存储读取的前一行的大部分内容 - 我怀疑您根本无法使用`TextReader`，或者至少您必须对最终字符为 ' 的情况进行特殊处理\r' 或'\n'。请记住，一个缓冲区可以以“\r”结尾，而下一个缓冲区可以以“\n”开头，表示它们之间有一个换行符。看看它有多难？

你肯定，肯定需要异步处理吗？

编辑：听起来你可以做一些基本上可以将数据转储到的事情，并附加一个“LineCompleted”事件处理程序。您可以先附加事件处理程序，然后继续将数据转储到其中，直到没有更多数据为止（此时您需要告诉它数据已完成）。如果这听起来合适，我可能会尝试为 MiscUtil 开设这样的课程——但我不太可能在下周内完成它（我现在真的很忙）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-01T16:17:49.990

有一个缓冲区（开始为空），每次阅读

*   如果缓冲区中有一个 \n，则删除所有内容，包括它并返回它
*   阅读你能读到的，并将你读到的附加到缓冲区
*   如果由于 eof 导致读取失败，则返回并清除内容，除非缓冲区为空，在这种情况下传播 eof。
*   如果您阅读的内容中有 \n，请从顶部重试，否则返回 null

请注意，这将满足您的要求，但是，对于任何此类方案，您现在必须担心如何处理对于您的缓冲区来说太长的行。

——马库斯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T16:45:00.440

请参阅我对[之前非常相似的问题的回答](https://stackoverflow.com/questions/524818/what-is-a-good-method-to-handle-line-based-network-i-o-streams/524954#524954)。它以类似流的方式与异步套接字 I/O 和读取行相关。希望有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T23:53:04.310

这里可以看到几个问题：

1.  单个 Unicode 代码点可以跨数据包拆分，因此您需要保留自己的 Utf8Encoding 实例。或者将完整的消息缓冲为 byte[] 并在您知道它完成时一次性转换。

2.  您需要一种确定何时收到完整消息的方法。您需要继续阅读直到完成（并处理在同一个 Read 调用中开始接收下一个数据包的情况。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T02:49:48.833

我决定编写我自己的 ReadLine 解析器式的东西。这是代码：

```
// Async callback.
Message message;

while((message = Message.ReadBytes(messageBuffer)) != null)
{
    OnMessageReceived(new MessageEventArgs(message));
}

// Message class.
public static Message ReadBytes(List<byte> data)
{
    int end = data.FindIndex(b => b == '\n' || b == '\r');

    if(end == -1)
        return null;

    string line = Encoding.UTF8.GetString(data.Take(end).ToArray());

    data.RemoveRange(0, end + 1);

    if(line == "")
        return ReadBytes(data);

    if(line == null)
        return null;

    return Message.FromRawString(line);
} 
```

非常感谢 @Jon Skeet、@Noldorin 和 @Richard 提供的非常有用的建议。您的共同努力使我找到了最终解决方案。=]

# command-line - 水平滚动基于文本的/控制台程序

> ID：600051
> 
> 赞同：0
> 
> 时间：2009-03-01T16:34:31.153
> 
> 标签：command-line, console, console-application

我正在尝试使用 TestDisk（分区和文件恢复程序）来恢复我丢失的一些文件。TestDisk 作为基于文本的/控制台程序运行，并打印一长串已删除文件，每行一个。每个文件都作为它的路径列出，因为我是从一个救援 live linux cd 运行它，所以我仅限于 80 个字符的控制台。

我需要通过这个文件列表选择我想要取消删除的文件，但是我只能看到每个路径的开头和..

```
...cuments and Settings\kin
...cuments and Settings\kin
...cuments and Settings\kin 
```

...没有给我太多信息（这个列表可能超过一百个条目）。

我一直在考虑在屏幕会话中运行 TestDisk，并希望增加虚拟终端的宽度，然后简单地水平向右滚动。但屏幕似乎不支持这样的东西。

有什么可以做的吗？

我应该澄清一下 TestDisk 是一个交互式控制台程序。因此，我无法获取输出并用其他东西解析它。此外，我需要交互性，因为当我找到要取消删除的文件时，我需要在 TestDisk 中进行选择，然后在 TestDisk 中继续下一步。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T16:36:45.797

滚动锁定？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T16:41:12.947

通过 emacs 运行输出。然后你就可以拥有你想要的所有功能！

# algorithm - PageRank 算法如何处理链接？

> ID：600065
> 
> 赞同：0
> 
> 时间：2009-03-01T16:41:30.417
> 
> 标签：algorithm, pagerank

我们在我的算法课上讨论了 Google 的 PageRank 算法。我们讨论的是该算法将网页表示为图形并将它们放入邻接矩阵中，然后进行一些矩阵调整。

唯一的问题是，在我们讨论的算法中，如果我链接到一个网页，该网页也被认为是链接回我。这似乎使矩阵乘法更简单。这仍然是 PageRank 的工作方式吗？如果是这样，为什么不是每个人都链接到 slashdot.com、yahoo.com 和 microsoft.com 只是为了提高他们的页面排名？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-01T16:46:42.480

如果您阅读[PageRank 论文](http://infolab.stanford.edu/~backrub/google.html)，您会发现链接不是双向的，至少对于 PageRank 算法而言。事实上，如果你可以通过链接*到*一个高价值的网站来提高你的页面的 PageRank，那是没有意义的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T16:48:10.057

如果您链接到该网页，则该网页的 pagerank 编号会根据您的网站页面排名而增加。

反过来也行不通。链接不是双向的。因此，如果您链​​接到 slashdot，您的 pagerank 不会增加，如果 slashdot 链接到您，您的 pagerank 会增加。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-01T16:49:45.170

它是一个谜，超出了我们对 backrub 的起源和 avi 链接的论文的了解。

我最喜欢的（个人）理论涉及大量仓鼠，每分钟轮转数严重影响任何特定页面的排名。我不知道他们给仓鼠什么……可能比 LSD 温和得多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T20:45:22.147

请参阅论文“250 亿美元的特征向量” [http://www.rose-hulman.edu/~bryan/googleFinalVersionFixed.pdf](http://www.rose-hulman.edu/~bryan/googleFinalVersionFixed.pdf)

# algorithm - 布尔表达式的最小化是 NP-Complete 吗？

> ID：600068
> 
> 赞同：7
> 
> 时间：2009-03-01T16:42:23.660
> 
> 标签：algorithm, complexity-theory, np-complete, simplification, satisfiability

我知道布尔可满足性是 NP-Complete 的，但它是布尔表达式的最小化/简化，我的意思是采用符号形式的给定表达式并以符号形式产生等效但简化的表达式，NP-Complete？我不确定从可满足性到最小化是否有减少，但我觉得可能有。有人有确切消息么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-01T16:45:11.563

好吧，这样看：使用最小化算法，您可以将任何不可满足的表达式压缩为文字`false`，对吗？这有效地解决了SAT。所以至少一个完整的最小化算法必然是~~NP完全~~NP难。

# common-lisp - 如何在 Common Lisp 中将字节数组转换为字符串？

> ID：600070
> 
> 赞同：24
> 
> 时间：2009-03-01T16:44:25.527
> 
> 标签：common-lisp, sbcl

我正在调用一个返回字节数组的有趣 API，但我想要一个文本流。有没有一种简单的方法可以从字节数组中获取文本流？现在我只是拼凑起来：

```
(defun bytearray-to-string (bytes)
  (let ((str (make-string (length bytes))))
    (loop for byte across bytes
       for i from 0
       do (setf (aref str i) (code-char byte)))
    str)) 
```

然后将结果包装在 with-input-from-string 中，但这不是最好的方法。（另外，它的效率非常低。）

在这种情况下，我知道它始终是 ASCII，因此将其解释为 ASCII 或 UTF-8 都可以。我正在使用支持 Unicode 的 SBCL，但我更喜欢便携式（甚至仅 ASCII）解决方案，而不是 SBCL-Unicode 特定的解决方案。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-03-01T18:56:38.703

FLEXI-STREAMS ( [http://weitz.de/flexi-streams/](http://weitz.de/flexi-streams/) ) 具有便携转换功能

```
(flexi-streams:octets-to-string #(72 101 108 108 111) :external-format :utf-8)

=>

"Hello" 
```

或者，如果你想要一个流：

```
(flexi-streams:make-flexi-stream
   (flexi-streams:make-in-memory-input-stream
      #(72 101 108 108 111))
   :external-format :utf-8) 
```

将返回一个从字节向量读取文本的流

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-02T12:32:24.017

此转换有两个可移植库：

*   flexi-streams，已经在另一个答案中提到过。

    该库较旧且具有更多功能，尤其是可扩展流。

*   [Babel](http://common-lisp.net/project/babel/)，一个专门用于字符编码和解码的库

    Babel 相对于 flexi-streams 的主要优势是速度。

为获得最佳性能，如果 Babel 具有您需要的功能，请使用它，否则回退到弹性流。低于说明速度差异的（略微不科学的）微基准。

对于这个测试用例，Babel 的速度提高了**337 倍**，所需的内存减少了 200 倍。

```
(asdf:operate 'asdf:load-op :flexi-streams)
(asdf:operate 'asdf:load-op :babel)

(defun flexi-streams-test (bytes n)
  (loop
     repeat n
     collect (flexi-streams:octets-to-string bytes :external-format :utf-8)))

(defun babel-test (bytes n)
  (loop
     repeat n
     collect (babel:octets-to-string bytes :encoding :utf-8)))

(defun test (&optional (data #(72 101 108 108 111))
                       (n 10000))
  (let* ((ub8-vector (coerce data '(simple-array (unsigned-byte 8) (*))))
         (result1 (time (flexi-streams-test ub8-vector n)))
         (result2 (time (babel-test ub8-vector n))))
    (assert (equal result1 result2))))

#|
CL-USER> (test)
Evaluation took:
  1.348 seconds of real time
  1.328083 seconds of user run time
  0.020002 seconds of system run time
  [Run times include 0.12 seconds GC run time.]
  0 calls to %EVAL
  0 page faults and
  126,402,160 bytes consed.
Evaluation took:
  0.004 seconds of real time
  0.004 seconds of user run time
  0.0 seconds of system run time
  0 calls to %EVAL
  0 page faults and
  635,232 bytes consed.
|# 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-03-04T15:25:21.557

如果您不必担心 UTF-8 编码（本质上意味着“纯 ASCII”），您可以使用 MAP：

> (map 'string #'code-char #(72 101 108 108 111))

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-06-18T06:45:59.467

我说使用建议的 flexistream 或 babel 解决方案。

但为了完整性和未来 googlers 到达此页面的利益，我想提一下 sbcl 自己的 sb-ext:octets-to-string：

```
 SB-EXT:OCTETS-TO-STRING is an external symbol in #<PACKAGE "SB-EXT">.
   Function: #<FUNCTION SB-EXT:OCTETS-TO-STRING>
   Its associated name (as in FUNCTION-LAMBDA-EXPRESSION) is
     SB-EXT:OCTETS-TO-STRING.
   The function's arguments are:  (VECTOR &KEY (EXTERNAL-FORMAT DEFAULT) (START 0)
                                          END)
   Its defined argument types are:
     ((VECTOR (UNSIGNED-BYTE 8)) &KEY (:EXTERNAL-FORMAT T) (:START T) (:END T))
   Its result type is:
     * 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-01T17:57:28.487

SBCL 支持所谓的[灰色流](http://www.sbcl.org/manual/Gray-Streams.html)。这些是基于 CLOS 类和通用函数的可扩展流。您可以创建一个从字节数组中获取字符的文本流子类。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-01T16:50:23.063

试试这个`FORMAT`功能。 `(FORMAT NIL ...)`以字符串形式返回结果。

# c++ - istringstream "get" 方法实现

> ID：600077
> 
> 赞同：0
> 
> 时间：2009-03-01T16:46:11.903
> 
> 标签：c++, stream

“方法”实现说[istringstream get](http://www.cplusplus.com/reference/iostream/istream/get.html)

```
int get();
Extracts a character from the stream and returns its value (casted to an integer). 
```

我想看看它的实现。

编辑：删除了我要移植的部分

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-01T17:42:50.707

您会`std::istringstream`在标题中找到`<sstream>`。但不是`get()`方法。该`get()`成员继承自`basic_istream<_Elem, _Traits>`您可以在 header 中找到的模板。这是我的 VS2005 安装中的实现：

```
int_type __CLR_OR_THIS_CALL get()
    {   // extract a metacharacter
    int_type _Meta = 0;
    ios_base::iostate _State = ios_base::goodbit;
    _Chcount = 0;
    const sentry _Ok(*this, true);

    if (!_Ok)
        _Meta = _Traits::eof(); // state not okay, return EOF
    else
        {   // state okay, extract a character
        _TRY_IO_BEGIN
        _Meta = _Myios::rdbuf()->sbumpc();

        if (_Traits::eq_int_type(_Traits::eof(), _Meta))
            _State |= ios_base::eofbit | ios_base::failbit; // end of file
        else
            ++_Chcount; // got a character, count it
        _CATCH_IO_END
        }

    _Myios::setstate(_State);
    return (_Meta);
    } 
```

# git - 如何仅克隆 Git 存储库的子目录？

> ID：600079
> 
> 赞同：1716
> 
> 时间：2009-03-01T16:46:32.527
> 
> 标签：git, repository, subdirectory, git-clone, sparse-checkout

我有我的 Git 存储库，它在根目录下有两个子目录：

```
/finisht
/static 
```

当它在[SVN](http://en.wikipedia.org/wiki/Apache_Subversion)中时，`/finisht`在一个地方签出，而`/static`在其他地方签出，如下所示：

```
svn co svn+ssh://admin@domain.com/home/admin/repos/finisht/static static 
```

有没有办法用 Git 做到这一点？

* * *

## 回答 #1

> 赞同：1682
> 
> 时间：2012-12-06T07:37:21.387

您正在尝试做的事情称为**sparse checkout**，该功能已添加到 git 1.7.0（2012 年 2 月）中。进行稀疏*克隆*的步骤如下：

```
mkdir <repo>
cd <repo>
git init
git remote add -f origin <url> 
```

这将使用您的遥控器创建一个空存储库，并获取所有对象但不检出它们。然后做：

```
git config core.sparseCheckout true 
```

现在您需要定义要实际签出的文件/文件夹。这是通过在 中列出它们来完成的`.git/info/sparse-checkout`，例如：

```
echo "some/dir/" >> .git/info/sparse-checkout
echo "another/sub/tree" >> .git/info/sparse-checkout 
```

最后但同样重要的是，使用远程状态更新您的空仓库：

```
git pull origin master 
```

您现在将在文件系统上“签出”`some/dir`文件`another/sub/tree`（这些路径仍然存在），并且不存在其他路径。

您可能想查看[扩展教程](http://jasonkarns.com/blog/subdirectory-checkouts-with-git-sparse-checkout/)，并且您可能应该阅读[稀疏结帐](https://git-scm.com/docs/git-sparse-checkout)和[read-tree](https://schacon.github.io/git/git-read-tree.html#_sparse_checkout)的官方文档。

作为一个函数：

```
function git_sparse_clone() (
  rurl="$1" localdir="$2" && shift 2

  mkdir -p "$localdir"
  cd "$localdir"

  git init
  git remote add -f origin "$rurl"

  git config core.sparseCheckout true

  # Loops over remaining args
  for i; do
    echo "$i" >> .git/info/sparse-checkout
  done

  git pull origin master
) 
```

用法：

```
git_sparse_clone "http://github.com/tj/n" "./local/location" "/bin" 
```

* * *

请注意，这仍然会从服务器下载整个存储库——只是结帐的大小减小了。目前不可能只克隆一个目录。但是，如果您不需要存储库的历史记录，您至少可以通过创建浅层克隆来节省带宽。有关如何结合浅[克隆](https://git-scm.com/docs/git-clone)和稀疏结帐的信息，请参阅下面[的 udondan 答案。](https://stackoverflow.com/a/28039894/962603)

* * *

从 git 2.25.0（2020 年 1 月）开始，在 git 中添加了一个实验性的[sparse-checkout](https://www.git-scm.com/docs/git-sparse-checkout)命令：

```
git sparse-checkout init
# same as: 
# git config core.sparseCheckout true

git sparse-checkout set "A/B"
# same as:
# echo "A/B" >> .git/info/sparse-checkout

git sparse-checkout list
# same as:
# cat .git/info/sparse-checkout 
```

* * *

## 回答 #2

> 赞同：918
> 
> 时间：2018-09-11T06:32:29.677

**`git clone --filter`来自 git 2.19 现在可以在 GitHub 上运行（测试 2021-01-14，git 2.30.0）**

此选项是与远程协议的更新一起添加的，它确实可以防止从服务器下载对象。

`d1`例如，仅克隆此最小测试存储库所需的对象： [https](https://github.com/cirosantilli/test-git-partial-clone) ://github.com/cirosantilli/test-git-partial-clone我可以这样做：

```
git clone \
  --depth 1  \
  --filter=blob:none  \
  --sparse \
  https://github.com/cirosantilli/test-git-partial-clone \
;
cd test-git-partial-clone
git sparse-checkout set d1 
```

这是[https://github.com/cirosantilli/test-git-partial-clone-big-small](https://github.com/cirosantilli/test-git-partial-clone-big-small)

```
git clone \
  --depth 1  \
  --filter=blob:none  \
  --sparse \
  https://github.com/cirosantilli/test-git-partial-clone-big-small \
;
cd test-git-partial-clone-big-small
git sparse-checkout set small 
```

该存储库包含：

*   一个包含 10 个 10MB 文件的大目录
*   一个包含 1000 个大小为 1 字节的文件的小目录

所有内容都是伪随机的，因此不可压缩。

在我的 36.4 Mbps 互联网上克隆时间：

*   满：24s
*   部分：“瞬时”

不幸的是，这`sparse-checkout`部分也是需要的。您也可以只下载某些更易于理解的文件：

```
git clone \
  --depth 1  \
  --filter=blob:none  \
  --no-checkout \
  https://github.com/cirosantilli/test-git-partial-clone \
;
cd test-git-partial-clone
git checkout master -- d1 
```

但是由于某种原因，该方法会[非常缓慢地逐个下载文件](https://github.com/isaacs/github/issues/1888)，除非目录中的文件很少，否则无法使用。

**分析最小存储库中的对象**

克隆命令仅获得：

*   带有分支尖端的单个[提交对象](https://stackoverflow.com/questions/22968856/what-is-the-file-format-of-a-git-commit-object-data-structure/37438460#37438460)`master`
*   存储库的所有 4 个[树对象](https://stackoverflow.com/questions/14790681/what-is-the-internal-format-of-a-git-tree-object)：
    *   提交的顶级目录
    *   三个目录`d1`,,,`d2``master`

然后，该`git sparse-checkout set`命令仅从服务器获取丢失的 blob（文件）：

*   `d1/a`
*   `d1/b`

更好的是，稍后在 GitHub 上可能会开始支持：

```
 --filter=blob:none \
  --filter=tree:0 \ 
```

从[`--filter=tree:0`Git 2.20 开始](https://github.com/git/git/blob/master/Documentation/RelNotes/2.20.0.txt#L132)，将防止不必要地`clone`获取所有树对象，并允许将其推迟到`checkout`. 但是在我的 2020-09-18 测试中失败了：

```
fatal: invalid filter-spec 'combine:blob:none+tree:0' 
```

大概是因为`--filter=combine:`复合过滤器（在 Git 2.24 中添加，由 multiple 暗示`--filter`）尚未实现。

我观察了哪些对象被提取：

```
git verify-pack -v .git/objects/pack/*.pack 
```

如前所述：[如何列出数据库中的所有 git 对象？](https://stackoverflow.com/questions/7348698/git-how-to-list-all-objects-in-the-database/18793029#18793029)它并没有给我一个非常清楚的指示每个对象到底是什么，但它确实说明了每个对象的类型（`commit`, `tree`, `blob`），并且由于那个最小的 repo 中的对象非常少，我可以明确地推断出每个对象是什么.

`git rev-list --objects --all`确实产生了带有树/blob 路径的更清晰的输出，但不幸的是，当我运行它时它会获取一些对象，这使得很难确定何时获取了什么，如果有人有更好的命令，请告诉我。

TODO 找到 GitHub 的公告，上面写着他们何时开始支持它。[https://github.blog/2020-01-17-bring-your-monorepo-down-to-size-with-sparse-checkout/](https://github.blog/2020-01-17-bring-your-monorepo-down-to-size-with-sparse-checkout/)从 2020-01-17 已经提到`--filter blob:none`。

**`git sparse-checkout`**

我认为这个命令旨在管理一个设置文件，上面写着“我只关心这些子树”，以便将来的命令只会影响这些子树。但是有点难以确定，因为当前的文档有点……稀疏;-)

它本身并不能阻止获取 blob。

如果这种理解是正确的，那么这将是对`git clone --filter`上述描述的一个很好的补充，因为如果您打算在部分克隆的 repo 中执行 git 操作，它将防止无意获取更多对象。

当我尝试使用 Git 2.25.1 时：

```
git clone \
  --depth 1 \
  --filter=blob:none \
  --no-checkout \
  https://github.com/cirosantilli/test-git-partial-clone \
;
cd test-git-partial-clone
git sparse-checkout init 
```

它不起作用，因为`init`实际上获取了所有对象。

但是，在 Git 2.28 中，它并没有按需要获取对象。但是，如果我这样做：

```
git sparse-checkout set d1 
```

`d1`没有被提取和检出，即使这明确表示它应该：[https ://github.blog/2020-01-17-bring-your-monorepo-down-to-size-with-sparse-checkout/#sparse-带有免责声明的结帐和部分克隆](https://github.blog/2020-01-17-bring-your-monorepo-down-to-size-with-sparse-checkout/#sparse-checkout-and-partial-clones)：

> 请留意部分克隆功能是否会普遍可用[1]。
> 
> [1]：GitHub 仍在内部评估此功能，同时它已在少数几个存储库（包括本文中使用的示例）上启用。随着该功能的稳定和成熟，我们会及时通知您其进展情况。

所以，是的，目前很难确定，这部分归功于 GitHub 是封闭源代码的乐趣。但让我们密切关注它。

**命令分解**

服务器应配置：

```
git config --local uploadpack.allowfilter 1
git config --local uploadpack.allowanysha1inwant 1 
```

命令分解：

*   `--filter=blob:none`跳过所有 blob，但仍获取所有[树对象](https://stackoverflow.com/questions/14790681/what-is-the-internal-format-of-a-git-tree-object/37105125#37105125)

*   `--filter=tree:0`跳过不需要的树：[https ://www.spinics.net/lists/git/msg342006.html](https://www.spinics.net/lists/git/msg342006.html)

*   `--depth 1`已经暗示`--single-branch`，另请参阅：[如何在 Git 中克隆单个分支？](https://stackoverflow.com/questions/1778088/how-to-clone-a-single-branch-in-git)

*   `file://$(path)`需要克服`git clone`协议恶作剧：[如何用相对路径浅克隆本地 git 存储库？](https://stackoverflow.com/questions/47307578/how-to-shallow-clone-a-local-git-repository-with-a-relative-path)

*   `--filter=combine:FILTER1+FILTER2`是一次使用多个过滤器的语法，由于某种原因试图通过`--filter`失败：“多个过滤器规格无法组合”。这是在 Git 2.24 的 e987df5fe62b8b29be4cdcdeb3704681ada2b29e “list-objects-filter：实现复合过滤器”中添加的

    编辑：在 Git 2.28 上，我通过实验看到它也有同样的效果，因为 GitHub到 2020-09-18`--filter=FILTER1 --filter FILTER2`还没有实现并且抱怨。TODO在哪个版本推出？`combine:``fatal: invalid filter-spec 'combine:blob:none+tree:0'`

的格式`--filter`记录在`man git-rev-list`.

Git 树上的文档：

*   [https://github.com/git/git/blob/v2.19.0/Documentation/technical/partial-clone.txt](https://github.com/git/git/blob/v2.19.0/Documentation/technical/partial-clone.txt)
*   [https://github.com/git/git/blob/v2.19.0/Documentation/rev-list-options.txt#L720](https://github.com/git/git/blob/v2.19.0/Documentation/rev-list-options.txt#L720)
*   [https://github.com/git/git/blob/v2.19.0/t/t5616-partial-clone.sh](https://github.com/git/git/blob/v2.19.0/t/t5616-partial-clone.sh)

**在本地测试一下**

以下脚本可重现地在本地生成[https://github.com/cirosantilli/test-git-partial-clone](https://github.com/cirosantilli/test-git-partial-clone)存储库，执行本地克隆，并观察克隆的内容：

```
#!/usr/bin/env bash
set -eu

list-objects() (
  git rev-list --all --objects
  echo "master commit SHA: $(git log -1 --format="%H")"
  echo "mybranch commit SHA: $(git log -1 --format="%H")"
  git ls-tree master
  git ls-tree mybranch | grep mybranch
  git ls-tree master~ | grep root
)

# Reproducibility.
export GIT_COMMITTER_NAME='a'
export GIT_COMMITTER_EMAIL='a'
export GIT_AUTHOR_NAME='a'
export GIT_AUTHOR_EMAIL='a'
export GIT_COMMITTER_DATE='2000-01-01T00:00:00+0000'
export GIT_AUTHOR_DATE='2000-01-01T00:00:00+0000'

rm -rf server_repo local_repo
mkdir server_repo
cd server_repo

# Create repo.
git init --quiet
git config --local uploadpack.allowfilter 1
git config --local uploadpack.allowanysha1inwant 1

# First commit.
# Directories present in all branches.
mkdir d1 d2
printf 'd1/a' > ./d1/a
printf 'd1/b' > ./d1/b
printf 'd2/a' > ./d2/a
printf 'd2/b' > ./d2/b
# Present only in root.
mkdir 'root'
printf 'root' > ./root/root
git add .
git commit -m 'root' --quiet

# Second commit only on master.
git rm --quiet -r ./root
mkdir 'master'
printf 'master' > ./master/master
git add .
git commit -m 'master commit' --quiet

# Second commit only on mybranch.
git checkout -b mybranch --quiet master~
git rm --quiet -r ./root
mkdir 'mybranch'
printf 'mybranch' > ./mybranch/mybranch
git add .
git commit -m 'mybranch commit' --quiet

echo "# List and identify all objects"
list-objects
echo

# Restore master.
git checkout --quiet master
cd ..

# Clone. Don't checkout for now, only .git/ dir.
git clone --depth 1 --quiet --no-checkout --filter=blob:none "file://$(pwd)/server_repo" local_repo
cd local_repo

# List missing objects from master.
echo "# Missing objects after --no-checkout"
git rev-list --all --quiet --objects --missing=print
echo

echo "# Git checkout fails without internet"
mv ../server_repo ../server_repo.off
! git checkout master
echo

echo "# Git checkout fetches the missing directory from internet"
mv ../server_repo.off ../server_repo
git checkout master -- d1/
echo

echo "# Missing objects after checking out d1"
git rev-list --all --quiet --objects --missing=print 
```

[GitHub 上游](https://github.com/cirosantilli/test-git-web-interface/blob/296dc8b8edc051299bfa5404bb84f79e69ea1cde/other-test-repos/partial-clone.sh).

Git v2.19.0 中的输出：

```
# List and identify all objects
c6fcdfaf2b1462f809aecdad83a186eeec00f9c1
fc5e97944480982cfc180a6d6634699921ee63ec
7251a83be9a03161acde7b71a8fda9be19f47128
62d67bce3c672fe2b9065f372726a11e57bade7e
b64bf435a3e54c5208a1b70b7bcb0fc627463a75 d1
308150e8fddde043f3dbbb8573abb6af1df96e63 d1/a
f70a17f51b7b30fec48a32e4f19ac15e261fd1a4 d1/b
84de03c312dc741d0f2a66df7b2f168d823e122a d2
0975df9b39e23c15f63db194df7f45c76528bccb d2/a
41484c13520fcbb6e7243a26fdb1fc9405c08520 d2/b
7d5230379e4652f1b1da7ed1e78e0b8253e03ba3 master
8b25206ff90e9432f6f1a8600f87a7bd695a24af master/master
ef29f15c9a7c5417944cc09711b6a9ee51b01d89
19f7a4ca4a038aff89d803f017f76d2b66063043 mybranch
1b671b190e293aa091239b8b5e8c149411d00523 mybranch/mybranch
c3760bb1a0ece87cdbaf9a563c77a45e30a4e30e
a0234da53ec608b54813b4271fbf00ba5318b99f root
93ca1422a8da0a9effc465eccbcb17e23015542d root/root
master commit SHA: fc5e97944480982cfc180a6d6634699921ee63ec
mybranch commit SHA: fc5e97944480982cfc180a6d6634699921ee63ec
040000 tree b64bf435a3e54c5208a1b70b7bcb0fc627463a75    d1
040000 tree 84de03c312dc741d0f2a66df7b2f168d823e122a    d2
040000 tree 7d5230379e4652f1b1da7ed1e78e0b8253e03ba3    master
040000 tree 19f7a4ca4a038aff89d803f017f76d2b66063043    mybranch
040000 tree a0234da53ec608b54813b4271fbf00ba5318b99f    root

# Missing objects after --no-checkout
?f70a17f51b7b30fec48a32e4f19ac15e261fd1a4
?8b25206ff90e9432f6f1a8600f87a7bd695a24af
?41484c13520fcbb6e7243a26fdb1fc9405c08520
?0975df9b39e23c15f63db194df7f45c76528bccb
?308150e8fddde043f3dbbb8573abb6af1df96e63

# Git checkout fails without internet
fatal: '/home/ciro/bak/git/test-git-web-interface/other-test-repos/partial-clone.tmp/server_repo' does not appear to be a git repository
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.

# Git checkout fetches the missing directory from internet
remote: Enumerating objects: 1, done.
remote: Counting objects: 100% (1/1), done.
remote: Total 1 (delta 0), reused 0 (delta 0)
Receiving objects: 100% (1/1), 45 bytes | 45.00 KiB/s, done.
remote: Enumerating objects: 1, done.
remote: Counting objects: 100% (1/1), done.
remote: Total 1 (delta 0), reused 0 (delta 0)
Receiving objects: 100% (1/1), 45 bytes | 45.00 KiB/s, done.

# Missing objects after checking out d1
?8b25206ff90e9432f6f1a8600f87a7bd695a24af
?41484c13520fcbb6e7243a26fdb1fc9405c08520
?0975df9b39e23c15f63db194df7f45c76528bccb 
```

结论：来自外部的所有 blob`d1/`都丢失了。例如`0975df9b39e23c15f63db194df7f45c76528bccb`，`d2/b`退房后不存在`d1/a`。

请注意`root/root`和`mybranch/mybranch`也丢失了，但从`--depth 1`丢失的文件列表中隐藏了它。如果您删除`--depth 1`，则它们会显示在丢失文件列表中。

**我有一个梦想**

这个特性可能会彻底改变 Git。

想象一下，将您企业的所有代码库都[放在一个存储库](https://cacm.acm.org/magazines/2016/7/204032-why-google-stores-billions-of-lines-of-code-in-a-single-repository/fulltext)中，而无需[像`repo`](https://stackoverflow.com/questions/1809774/how-to-compile-the-android-aosp-kernel-and-test-it-with-the-android-emulator/48310014#48310014).

想象一下[，在没有任何丑陋的第三方扩展的情况下，直接在 repo 中存储巨大的 blob](https://stackoverflow.com/questions/540535/managing-large-binary-files-with-git/53652983#53652983)。

想象一下，如果 GitHub 允许[每个文件/目录的元数据](https://github.com/isaacs/github/issues/49)，如星号和权限，那么您可以将所有个人资料存储在一个存储库中。

想象一下，如果[子模块被完全视为常规目录](https://stackoverflow.com/questions/34037219/why-were-gnu-binutils-and-gdb-merged-as-one-package)：只需请求树 SHA，[类似 DNS 的机制会解析您的请求](https://github.com/ipfs/ipfs)，首先查看您的[本地`~/.git`](https://stackoverflow.com/questions/2350996/how-can-one-safely-use-a-shared-object-database-in-git)，然后首先查看更接近的服务器（您的企业的镜像/缓存）并最终在 GitHub 上。

* * *

## 回答 #3

> 赞同：742
> 
> 时间：2009-03-01T18:00:23.660

**编辑**：从 Git 2.19 开始，这终于成为可能，正如可以在这个[答案](https://stackoverflow.com/a/52269934/2988)中看到的那样。

考虑支持该答案。

注意：在 Git 2.19 中，仅实现了客户端支持，仍然缺少服务器端支持，因此仅在克隆本地存储库时有效。另请注意，大型 Git 托管服务商，例如 GitHub，实际上并不使用 Git 服务器，它们使用自己的实现，因此即使 Git 服务器中出现支持，也并不意味着它自动适用于 Git 托管服务商。（OTOH，因为他们不使用 Git 服务器，所以他们可以在自己的实现中更快地实现它，然后它才会出现在 Git 服务器中。）

* * *

不，这在 Git 中是不可能的。

在 Git 中实现这样的东西将是一项巨大的努力，这意味着客户端存储库的完整性将不再得到保证。如果您有兴趣，请在 git 邮件列表中搜索有关“稀疏克隆”和“稀疏获取”的讨论。

一般来说，Git 社区的共识是，如果你有几个总是独立签出的目录，那么它们实际上是两个不同的项目，应该存在于两个不同的存储库中。[您可以使用Git Submodules](https://book.git-scm.com/book/en/v2/Git-Tools-Submodules)将它们粘合在一起。

* * *

## 回答 #4

> 赞同：436
> 
> 时间：2015-01-20T07:33:05.847

您可以结合*稀疏结帐*和*浅克隆*功能。*浅克隆*会切断历史记录，而稀疏*检出*只会提取与您的模式匹配的文件。

```
git init <repo>
cd <repo>
git remote add origin <url>
git config core.sparsecheckout true
echo "finisht/*" >> .git/info/sparse-checkout
git pull --depth=1 origin master 
```

你需要最低 git 1.9 才能工作。仅使用 2.2.0 和 2.2.2 自己测试过。

这样你仍然可以**推送**，这是不可能的`git archive`。

* * *

## 回答 #5

> 赞同：189
> 
> 时间：2016-09-04T13:02:24.217

对于***只想***从 github 下载文件/文件夹的其他用户，只需使用：

```
svn export <repo>/trunk/<folder> 
```

例如

```
svn export https://github.com/lodash/lodash.com/trunk/docs 
```

（是的，这里是 svn。显然在 2016 年你仍然需要 svn 来简单地下载一些 github 文件）

礼貌：[从 GitHub 存储库下载单个文件夹或目录](https://stackoverflow.com/questions/7106012/download-a-single-folder-or-directory-from-a-github-repo)

**重要**- 确保更新 github URL 并替换`/tree/master/`为“/trunk/”。

作为 bash 脚本：

```
git-download(){
    folder=${@/tree\/master/trunk}
    folder=${folder/blob\/master/trunk}
    svn export $folder
} 
```

**注意** 此方法下载一个文件夹，而不是克隆/签出它。您无法将更改推送回存储库。另一方面 - 与稀疏结帐或浅结帐相比，这会导致下载量更小。

* * *

## 回答 #6

> 赞同：77
> 
> 时间：2009-03-01T21:17:53.623

如果您从不打算与从中克隆的存储库进行交互，您可以`git clone`使用

```
git filter-branch --subdirectory-filter <subdirectory> 
```

这样，至少历史将被保留。

* * *

## 回答 #7

> 赞同：68
> 
> 时间：2014-09-10T17:03:33.467

[这](https://www.kernel.org/pub/software/scm/git/docs/git-archive.html)看起来要简单得多：

```
git archive --remote=<repo_url> <branch> <path> | tar xvf - 
```

* * *

## 回答 #8

> 赞同：63
> 
> 时间：2010-05-18T21:15:04.130

Git 1.7.0 有“稀疏检出”。[*请参阅git config*手册页](http://git-scm.com/docs/git-config)中的“core.sparseCheckout”、[*git read-tree*手册页](http://www.kernel.org/pub/software/scm/git/docs/git-read-tree.html#_sparse_checkout)中的“Sparse checkout”和[*git update-index*手册页](http://www.kernel.org/pub/software/scm/git/docs/git-update-index.html#_skip_worktree_bit)中的“Skip-worktree bit” 。

该接口不如 SVN 方便（例如，在初始克隆时无法进行稀疏检出），但现在可以使用可以构建更简单接口的基本功能。

* * *

## 回答 #9

> 赞同：40
> 
> 时间：2016-03-22T23:06:20.680

仅使用 Git 无法克隆子目录，但以下是一些解决方法。

### 过滤器分支

您可能希望重写存储库以使其看起来像是`trunk/public_html/`其项目根目录，并丢弃所有其他历史记录（使用[`filter-branch`](https://git-scm.com/docs/git-filter-branch)），尝试已签出分支：

```
git filter-branch --subdirectory-filter trunk/public_html -- --all 
```

^(注意：`--`将过滤器分支选项与修订选项分开，并`--all`重写所有分支和标签。包括原始提交时间或合并信息在内的所有信息都将被**保留**。此命令尊重命名空间`.git/info/grafts`中的文件和引用`refs/replace/`，因此如果您定义了任何移植或替换`refs`，运行此命令将使它们永久化。)

> 警告！重写的历史对于所有对象将具有不同的对象名称，并且不会与原始分支收敛。您将无法在原始分支之上轻松推送和分发重写的分支。如果您不知道全部含义，请不要使用此命令，并且无论如何都避免使用它，如果一个简单的单个提交就足以解决您的问题。

* * *

### 稀疏结帐

以下是[稀疏检出](https://git-scm.com/docs/git-read-tree)方法的简单步骤，它将稀疏地填充工作目录，因此您可以告诉 Git 工作目录中的哪些文件夹或文件值得检出。

1.  像往常一样克隆存储库（`--no-checkout`可选）：

    ```
    git clone --no-checkout git@foo/bar.git
    cd bar 
    ```

    ^(如果您已经克隆了存储库，则可以跳过此步骤。)

    提示：对于大型存储库，考虑[浅克隆](https://git-scm.com/docs/git-read-tree)( `--depth 1`) 以仅签出最新版本或/且`--single-branch`仅签出。

2.  启用`sparseCheckout`选项：

    ```
    git config core.sparseCheckout true 
    ```

3.  为稀疏结帐指定文件夹（末尾**没有空格）：**

    ```
    echo "trunk/public_html/*"> .git/info/sparse-checkout 
    ```

    或编辑`.git/info/sparse-checkout`。

4.  签出分支（例如`master`）：

    ```
    git checkout master 
    ```

现在您应该已经在当前目录中选择了文件夹。

如果您有太多级别的目录或过滤分支，则可以考虑使用符号链接。

* * *

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2019-03-22T04:01:45.077

这将克隆特定文件夹并删除与其无关的所有历史记录。

```
git clone --single-branch -b {branch} git@github.com:{user}/{repo}.git
git filter-branch --subdirectory-filter {path/to/folder} HEAD
git remote remove origin
git remote add origin git@github.com:{user}/{new-repo}.git
git push -u origin master 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2014-01-23T18:49:47.570

我刚刚为[GitHub](http://en.wikipedia.org/wiki/GitHub)[写了一个脚本](https://github.com/mfbx9da4/git-sub-dir)。

用法：

```
python get_git_sub_dir.py path/to/sub/dir <RECURSIVE> 
```

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2020-03-05T18:17:04.603

只是为了澄清这里的一些很好的答案，许多答案中概述的步骤假设您已经在某个地方拥有一个远程存储库。

**给定：**一个现有的 git 存储库，例如`git@github.com:some-user/full-repo.git`，具有一个或多个您希望*独立*于 repo 的其余部分提取的目录，例如名为`app1`和的目录`app2`

假设您有一个如上所述的 git 存储库...

**然后：**您可以运行以下步骤以**仅从**该较大的存储库中提取特定目录：

```
mkdir app1
cd app1
git init
git remote add origin git@github.com:some-user/full-repo.git
git config core.sparsecheckout true
echo "app1/" >> .git/info/sparse-checkout
git pull origin master 
```

我错误地认为必须在原始存储库上设置稀疏签出选项，但事实并非如此：您在从远程提取之前定义了本地想要的目录。远程仓库不知道也不关心您只想跟踪仓库的一部分。

希望这个澄清对其他人有所帮助。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2018-03-08T19:39:46.547

这是我为单个子目录稀疏结帐的用例编写的 shell 脚本

## coSubDir.sh

```
localRepo=$1
remoteRepo=$2
subDir=$3

# Create local repository for subdirectory checkout, make it hidden to avoid having to drill down to the subfolder
mkdir ./.$localRepo
cd ./.$localRepo
git init
git remote add -f origin $remoteRepo
git config core.sparseCheckout true

# Add the subdirectory of interest to the sparse checkout.
echo $subDir >> .git/info/sparse-checkout

git pull origin master

# Create convenience symlink to the subdirectory of interest
cd ..
ln -s ./.$localRepo/$subDir $localRepo 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2019-12-11T00:31:15.050

使用 Linux？并且只想要易于访问和清洁工作树？无需打扰您机器上的其余代码。尝试**符号链接**！

```
git clone https://github.com:{user}/{repo}.git ~/my-project
ln -s ~/my-project/my-subfolder ~/Desktop/my-subfolder 
```

测试

```
cd ~/Desktop/my-subfolder
git status 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2021-08-15T19:29:50.940

这就是我所做的

```
git init
git sparse-checkout init
git sparse-checkout set "YOUR_DIR_PATH"
git remote add origin https://github.com/AUTH/REPO.git
git pull --depth 1 origin <SHA1_or_BRANCH_NAME> 
```

## 简单的笔记

*   [稀疏结帐](https://www.git-scm.com/docs/git-sparse-checkout#_commands)

*   `git sparse-checkout init`许多文章会告诉你设置`git sparse-checkout init --cone`如果我添加`--cone`会得到一些我不想要的文件。

*   `git sparse-checkout set "..."`将`.git\info\sparse-checkout`文件内容设置为`...`

    假设您不想使用此命令。相反，您可以打开`git\info\sparse-checkout`然后编辑。

* * *

## 例子

假设我想获得**2 个**文件夹^(完整[repo](https://github.com/chromium/chromium)大小>10GB↑ (包括 git))，如下图^(总大小 < 2MB)

1.  [铬/通用/扩展/API](https://github.com/chromium/chromium/tree/2d4a97f1ed2dd875557849b4281c599a7ffaba03/chrome/common/extensions/api)
2.  [铬/通用/扩展/权限](https://github.com/chromium/chromium/tree/2d4a97f1ed2dd875557849b4281c599a7ffaba03/chrome/common/extensions/permissions)

```
git init
git sparse-checkout init
// git sparse-checkout set "chrome/common/extensions/api/"
start .git\info\sparse-checkout    open the "sparse-checkut" file

/* .git\info\sparse-checkout  for example you can input the contents as below 
chrome/common/extensions/api/
!chrome/common/extensions/api/commands/      ! unwanted : https://www.git-scm.com/docs/git-sparse-checkout#_full_pattern_set
!chrome/common/extensions/api/devtools/
chrome/common/extensions/permissions/
*/

git remote add origin https://github.com/chromium/chromium.git
start .git\config

/* .git\config
[core]
    repositoryformatversion = 1
    filemode = false
    bare = false
    logallrefupdates = true
    symlinks = false
    ignorecase = true
[extensions]
    worktreeConfig = true
[remote "origin"]
    url = https://github.com/chromium/chromium.git
    fetch = +refs/heads/*:refs/remotes/Github/*
    partialclonefilter = blob:none  //  Add this line, This is important. Otherwise, your ".git" folder is still large (about 1GB)
*/
git pull --depth 1 origin 2d4a97f1ed2dd875557849b4281c599a7ffaba03
// or
// git pull --depth 1 origin master 
```

* * *

*   `partialclonefilter = blob:none`

    我知道要添加这一行，因为我知道：`git clone --filter=blob:none`它将写下这一行。所以我模仿它。

git版本：`git version 2.29.2.windows.3`

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2019-07-26T23:48:05.443

我写了一个`.gitconfig` `[alias]`用于执行“稀疏结帐”。看看（不是双关语）：

在 Windows 上运行`cmd.exe`

```
git config --global alias.sparse-checkout "!f(){ [ $# -eq 2 ] && L=${1##*/} L=${L%.git} || L=$2; mkdir -p \"$L/.git/info\" && cd \"$L\" && git init --template= && git remote add origin \"$1\" && git config core.sparseCheckout 1; [ $# -eq 2 ] && echo \"$2\" >> .git/info/sparse-checkout || { shift 2; for i; do echo $i >> .git/info/sparse-checkout; done }; git pull --depth 1 origin master;};f" 
```

除此以外：

```
git config --global alias.sparse-checkout '!f(){ [ $# -eq 2 ] && L=${1##*/} L=${L%.git} || L=$2; mkdir -p "$L/.git/info" && cd "$L" && git init --template= && git remote add origin "$1" && git config core.sparseCheckout 1; [ $# -eq 2 ] && echo "$2" >> .git/info/sparse-checkout || { shift 2; for i; do echo $i >> .git/info/sparse-checkout; done }; git pull --depth 1 origin master;};f' 
```

**用法**：

```
# Makes a directory ForStackExchange with Plug checked out
git sparse-checkout https://github.com/YenForYang/ForStackExchange Plug

# To do more than 1 directory, you have to specify the local directory:
git sparse-checkout https://github.com/YenForYang/ForStackExchange ForStackExchange Plug Folder 
```

为了`git config`方便和存储，命令被“缩小”，但这里是扩展的别名：

```
# Note the --template= is for disabling templates.
# Feel free to remove it if you don't have issues with them (like I did)
# `mkdir` makes the .git/info directory ahead of time, as I've found it missing sometimes for some reason
f(){
    [ "$#" -eq 2 ] && L="${1##*/}" L=${L%.git} || L=$2;
    mkdir -p "$L/.git/info"
        && cd "$L"
        && git init --template=
        && git remote add origin "$1"
        && git config core.sparseCheckout 1;
    [ "$#" -eq 2 ]
        && echo "$2" >> .git/info/sparse-checkout
        || {
            shift 2;
            for i; do
                echo $i >> .git/info/sparse-checkout;
            done
        };
    git pull --depth 1 origin master;
};
f 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2020-01-25T14:07:29.297

如果您实际上只对目录的最新修订文件感兴趣，Github 允许您将存储库下载为 Zip 文件，其中不包含历史记录。所以下载速度要快得多。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2021-04-08T13:15:33.360

这里有很多很好的回应，但我想补充一点，在 Windows Sever 2016 上使用目录名称周围的引号对我来说失败了。文件根本没有被下载。

代替

```
"mydir/myfolder" 
```

我不得不使用

```
mydir/myfolder 
```

此外，如果您只想下载所有子目录，只需使用

```
git sparse-checkout set * 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-01-07T13:52:04.793

虽然我讨厌在处理 git repos 时实际上必须使用 svn：/ 我一直都在使用它；

```
function git-scp() (
  URL="$1" && shift 1
  svn export ${URL/blob\/master/trunk}
) 
```

这允许您从 github url 复制而无需修改。用法;

```
--- /tmp » git-scp https://github.com/dgraph-io/dgraph/blob/master/contrib/config/kubernetes/helm                                                                                                                  1 ↵
A    helm
A    helm/Chart.yaml
A    helm/README.md
A    helm/values.yaml
Exported revision 6367.

--- /tmp » ls | grep helm
Permissions Size User    Date Modified    Name
drwxr-xr-x     - anthony 2020-01-07 15:53 helm/ 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2021-03-08T12:52:44.913

上面有很多好的想法和脚本。我忍不住将它们组合成一个带有帮助和错误检查的 bash 脚本：

```
#!/bin/bash

function help {
  printf "$1
Clones a specific directory from the master branch of a git repository.

Syntax:
  $(basename $0) [--delrepo] repoUrl sourceDirectory [targetDirectory]

If targetDirectory is not specified it will be set to sourceDirectory.
Downloads a sourceDirectory from a Git repository into targetdirectory.
If targetDirectory is not specified, a directory named after `basename sourceDirectory`
will be created under the current directory.

If --delrepo is specified then the .git subdirectory in the clone will be removed after cloning.

Example 1:
Clone the tree/master/django/conf/app_template directory from the master branch of
git@github.com:django/django.git into ./app_template:

\$ $(basename $0) git@github.com:django/django.git django/conf/app_template

\$ ls app_template/django/conf/app_template/
__init__.py-tpl  admin.py-tpl  apps.py-tpl  migrations  models.py-tpl  tests.py-tpl  views.py-tpl

Example 2:
Clone the django/conf/app_template directory from the master branch of
https://github.com/django/django/tree/master/django/conf/app_template into ~/test:

\$ $(basename $0) git@github.com:django/django.git django/conf/app_template ~/test

\$ ls test/django/conf/app_template/
__init__.py-tpl  admin.py-tpl  apps.py-tpl  migrations  models.py-tpl  tests.py-tpl  views.py-tpl

"
  exit 1
}

if [ -z "$1" ]; then help "Error: repoUrl was not specified.\n"; fi
if [ -z "$2" ]; then help "Error: sourceDirectory was not specified."; fi

if [ "$1" == --delrepo ]; then
  DEL_REPO=true
  shift
fi

REPO_URL="$1"
SOURCE_DIRECTORY="$2"
if [ "$3" ]; then
  TARGET_DIRECTORY="$3"
else
  TARGET_DIRECTORY="$(basename $2)"
fi

echo "Cloning into $TARGET_DIRECTORY"
mkdir -p "$TARGET_DIRECTORY"
cd "$TARGET_DIRECTORY"
git init
git remote add origin -f "$REPO_URL"
git config core.sparseCheckout true

echo "$SOURCE_DIRECTORY" > .git/info/sparse-checkout
git pull --depth=1 origin master

if [ "$DEL_REPO" ]; then rm -rf .git; fi 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2021-09-27T08:56:50.367

您仍然可以使用`svn`：

```
svn export https://admin@domain.com/home/admin/repos/finisht/static static --force 
```

到“ `git clone`”一个子目录，然后到“ `git pull`”这个子目录。

（它不打算提交和推送。）

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2022-02-12T14:17:16.430

> degit 制作 git 存储库的副本。[当你运行 degit some-user/some-repo 时，它会在https://github.com/some-user/some-repo](https://github.com/some-user/some-repo)上找到最新的提交 并将相关的 tar 文件下载到 ~/.degit/some-user/ some-repo/commithash.tar.gz 如果它在本地不存在。（这比使用 git clone 快得多，因为您没有下载整个 git 历史记录。）

```
degit <https://github.com/user/repo/subdirectory> <output folder> 
```

了解更多[https://www.npmjs.com/package/degit](https://www.npmjs.com/package/degit)

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2022-02-19T12:12:51.597

*   ## 如果你想`clone`

    ```
    git clone --no-checkout <REPOSITORY_URL>
    cd <REPOSITORY_NAME> 
    ```

    1.  现在设置您希望拉入*工作目录的特定文件/目录*：

        ```
        git sparse-checkout set <PATH_TO_A_SPECIFIC_DIRECTORY_OR_FILE_TO_PULL> 
        ```

    2.  之后，您应该将您的*工作目录*硬重置为您希望提取的提交。

        > 例如，我们将其重置为默认`origin/master`的 HEAD 提交。

        ```
        git reset --hard HEAD 
        ```

*   ## 如果你想`git init`然后`remote add`

    ```
    git init
    git remote add origin <REPOSITORY_URL> 
    ```

    1.  现在设置您希望拉入*工作目录的特定文件/目录*：

        ```
        git sparse-checkout set <PATH_TO_A_SPECIFIC_DIRECTORY_OR_FILE_TO_PULL> 
        ```

    2.  拉最后一次提交：

        ```
        git pull origin master 
        ```

> 笔记：
> 
> 如果您想将另一个目录/文件添加到您的*工作目录*，您可以这样做：
> 
> ```
> git sparse-checkout add <PATH_TO_ANOTHER_SPECIFIC_DIRECTORY_OR_FILE_TO_PULL> 
> ```
> 
> 如果要将所有存储库添加到*working-directory*，请这样做：
> 
> ```
> git sparse-checkout add * 
> ```
> 
> 如果要清空*工作目录*，请这样做：
> 
> ```
> git sparse-checkout set empty 
> ```

如果需要，您可以通过运行以下命令查看您指定的跟踪文件的状态：

```
git status 
```

如果要退出*稀疏*模式并克隆所有存储库，则应运行：

```
git sparse-checkout set *
git sparse-checkout set init
git sparse-checkout set disable 
```

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2020-04-23T17:34:23.427

所以我尝试了这方面的一切，但对我没有任何效果......结果是在 Git 的 2.24 版本（在这个答案时随 cpanel 一起提供的版本），你不需要这样做

```
echo "wpm/*" >> .git/info/sparse-checkout 
```

您只需要文件夹名称

```
wpm/* 
```

所以简而言之，你这样做

```
git config core.sparsecheckout true 
```

然后，您编辑 .git/info/sparse-checkout 并在末尾添加文件夹名称（每行一个）和 /* 以获取子文件夹和文件

```
wpm/* 
```

保存并运行结帐命令

```
git checkout master 
```

结果是我的 repo 中的预期文件夹，如果这对你有用，没有别的 Upvote

# backup - 备份策略

> ID：600085
> 
> 赞同：0
> 
> 时间：2009-03-01T16:49:57.557
> 
> 标签：backup

我刚刚加入了一家使用 Server 2003 Small Business Server 的公司。该公司只有少数员工，需要一个备份系统。

我想将磁带备份（包括系统状态、Exchange 服务器等）恢复到第二台服务器。目的是拥有一组经过验证的备份，并能够在必要时交换服务器。

我是否认为第二台服务器不能在 SBS 网络上？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-09T18:10:23.717

无论您选择哪种方法，请务必使用您保留在现场的实际备份媒体来测试恢复过程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-01T19:16:04.557

您有几个使用 SBS 的选项，您可以在 SBS 域中拥有其他服务器，例如 win2003 服务器。您只能在同一域上拥有额外的 SBS 服务器，期限为 7 天，这是针对迁移情况。

在您的情况下，我将有一个额外的 win2003 服务器连接到域以充当备份域控制器，然后如果您的 SBS 系统出现故障，您仍然可以执行 Active Directory 身份验证。并访问仍在您的网络上的任何资源。

我们创建 SBS 服务器的基本 acronis 映像，然后如果出现任何问题，您可以恢复 acronis 映像，然后应用备份文件（我们使用 SBS 中提供的 NTBackup）以使您保持最新状态。使用 acronis 和备份的组合可以显着缩短恢复时间。

希望这可以帮助。

# javascript - 为什么我的嵌套 for 循环没有按预期工作？

> ID：600086
> 
> 赞同：1
> 
> 时间：2009-03-01T16:50:05.810
> 
> 标签：javascript

我现在无法处理我的 for 循环，我正在尝试比较两个数据，基本上它会比较 2 个项目，然后它会在网页上写入匹配项和不匹配项。

我设法在网页上写了比赛，效果很好。但是我的不匹配比较中有一个错误。

它在网页上写了X次所有数据，这是我的JS代码：

```
function testItems(i1, i2) {
    var newArray = [];
    var newArray2 = [];
    var count = 0;
    var count2 = 0;
    for(var i = 0; i < i1.length; i++) {
        for(var j = 0; j < i2.length; j++) {
            if(i1[i] == i2[j]) {
                newArray.push(i1[i]);
                count++;
            } if (i1[i] !== i2[j]) {
                newArray2.push(i1[i]);
                count2++;
            }
        }
    }
    count-=2;
    count2-=2
    writeHTML(count,count2, newArray, newArray2);
} 
```

不匹配的结果是可怕的：

[替代文字 http://www.picamatic.com/show/2009/03/01/07/44/2523028_672x48.jpg](http://www.picamatic.com/show/2009/03/01/07/44/2523028_672x48.jpg)

我期待它显示错误，而不是所有字符串。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T17:04:34.683

您看到的问题是由于嵌套的 for 循环。您实际上是在进行交叉比较：对于 i1 中的每个项目，您都将其与 i2 中的每个项目进行比较（请记住，每次 i 前进时 j 从 0 重新开始......这两个循环不会并行运行）。

由于我从下面的评论中了解到您希望能够将一个数组与另一个数组进行比较，即使每个数组中的项目顺序不同，我也编辑了我的原始建议。请注意，下面的代码片段不会标准化两个数组之间大小写的差异......不知道这是否是一个问题。另请注意，它仅将 i1 与 i2 进行比较...而不是 i1 与 i2 和 i2 与 i1 进行比较，这会使任务更具挑战性。

```
function testItems(i1, i2) {

    var newArray = [];
    var newArray2 = [];

    for (var i = 0; i < i1.length; i++) {
        var found = false;
        for (var j = 0; j < i2.length; j++) {
            if (i1[i] == i2[j]) found = true;
        }
        if (found) {
            newArray.push(i1[i])
        } else {
            newArray2.push(i1[i])
        }
    }
} 
```

作为替代方案，您可以考虑使用哈希表来索引 i1/i2，但由于您评论中的字符串示例包含空格，而且我不知道您是否使用任何 javascript 帮助程序库，所以最好坚持使用嵌套的 for 循环。该片段也没有尝试清除重复项。

您可能会考虑的另一个优化是您的 newArray 和 newArray2 数组包含它们自己的长度属性，因此您不需要将计数传递给您的 HTML 编写器。当 writer 收到数组时，它可以向每个数组询问 .length 属性以了解每个数组的大小。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T17:00:51.493

与问题没有直接关系，但您应该看到： [Google techtalks about javascript](http://www.youtube.com/watch?v=hQVTIJBZook)

也许它会启发你:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-02T03:27:26.793

关于你的问题的几件事。首先你应该使用 '!=' 而不是 '!==' 来检查不等式。其次，我不确定您为什么要将计数减少 2，这表明数组中可能存在重复项？！无论如何，您的逻辑是错误的，后来 Jarrett 纠正了这一点，但这也不是一个完全正确/完整的答案。提前阅读。

您的任务听起来像“给定两组数组 i1 和 i2 以找到 i1 {intersection} i2 和 i1{dash} {UNION} i2{dash})（群论符号）。即您想在 newArray 和 uncommon 中列出常见元素newArray2 中的元素。

你需要这样做。

1）删除两个数组中的重复项。（为了以后提高程序效率）（这不是必须得到想要的结果 - 你可以跳过它）

```
i1 = removeDuplicate(i1);
i2 = removeDuplicate(i2); 
```

（没有给出 removeDuplicate 的实现）。

2）通过i1，找到i1{dash}和i1{intersection}i2。

```
 var newArray = []; 
    var newArray2 = [];

    for (var i = 0; i < i1.length; i++) 
    {
        var found = false;
        for (var j = 0; j < i2.length; j++) 
        {
            if (i1[i] == i2[j]) 
           { 
              found = true;
              newArray.push(i1[i]); //add to i1 {intersection} i2.
              count++;
              break; //once found don't check the remaining items
           } 
        }

        if (!found)         
        {
            newArray2.push(i1[i]); //add i1{dash} to i1{dash} {UNION} i2{dash}
            count2++;[           
        }
    } 
```

3) 通过 i2 并将 i2{dash} 附加到 i1{dash}

```
 for(var x=0; x<i2.length; x++)
{
    var found = false;

    //check in intersection array as it'd be faster than checking through i1
    for(var y=0; y<newArray.length; y++)    {
      if( i2[x] == newArray[y])
      {
         found = true;
         break;
      } 
   }

   if(!found) 
   {   
       newArray2.push(i2[x]); //append(Union) a2{dash} to a1{dash}
       count2++;
   }
}   

writeHTML(count,count2, newArray, newArray2); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T16:57:28.537

我有一种感觉，这与您使用“！==”而不是“！=”的第二次比较有关

"!==" 是 "===" 的倒数，而不是 "=="。!== 是一个更严格的比较，它不进行任何类型转换。

例如 (5 != '5') 为假，而 (5 !== '5') 为真。这意味着您可能会在嵌套循环中向两个数组推送，因为 if(i1[i] == i2[j]) 和 if(i1[i] !== i2[j]) 都可能为真同时。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-01T17:53:37.017

这里的根本问题是一对嵌套循环*不是*正确的方法。

您需要通过每个数据集遍​​历指针。 *一个*循环，根据需要推进两者。

请注意，找出在不匹配的情况下要推进的问题比简单地遍历它们要大得多。找到第一个不匹配不是问题，找到它后回到正轨是相当困难的。

# linux - libpcap 可以重新组装 TCP 段吗

> ID：600087
> 
> 赞同：3
> 
> 时间：2009-03-01T16:50:11.020
> 
> 标签：linux, networking, capture, pcap

我需要将 TCP 流量嗅探到我的应用程序中。

libpcap 可以重新组装 TCP 段还是我必须手动完成？

主页上写着“以手册页格式提供源包的完整文档”。之后我`sudo apt-get install libpcap-dev`只找到一个男人 pcap。是所有可用的文档还是我错过了什么？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-01T21:20:48.267

pcap(3) 中没有提到数据包或流的重组。

如果我没记错的话，**dsniff**工具使用**libnids**来重组 IP 数据包和 TCP 流。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-03T20:20:23.353

三年前我使用了 libpcap，我不得不自己重新组装 TCP 流，这不是很困难，但它充满了极端情况。

如果许可证 (GPLv2) 适合您的项目，您可以查看wireshark 解析器和«follow TCP stream» 选项。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-01T16:59:49.500

在我的（稍旧的）系统上：

```
root@tower:~/desktop/ccan/ccan/tap # dpkg -L libpcap0.7-dev
/.
/usr
/usr/lib
/usr/lib/libpcap.a
/usr/include
/usr/include/net
/usr/include/net/bpf.h
/usr/include/pcap.h
/usr/include/pcap-namedb.h
/usr/share
/usr/share/man
/usr/share/man/man3
/usr/share/man/man3/pcap.3.gz 
```

嗯，似乎他们应该在那里：

```
root@tower:~/desktop/ccan/ccan/tap # man 3 pcap
Reformatting pcap(3), please wait... 
```

你*应该*有 man/3 文档，我看了我的，格式很糟糕。我通过 apt-get source 获取了库的源代码，看起来无论哪种方式捆绑的唯一文档都是手册页。

你可以试试他们的邮件列表，如果你这样做了，一定要在这里回答你的问题:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-10-19T20:15:58.947

不，libpcap 不会进行 TCP 段重组 - libpcap 捕获数据包，但*处理*数据包数据由应用程序或应用程序使用的库决定。

至于手册页，旧版本的 libpcap 只有 pcap(3) 手册页，新版本除了 pcap(3PCAP) 之外，还有一堆其他特定例程的手册页。

# jquery - jquery标签回发问题

> ID：600089
> 
> 赞同：9
> 
> 时间：2009-03-01T16:50:27.260
> 
> 标签：jquery, tabs

我在我的项目中使用 jquery 库。我对 jquery 选项卡有严重的问题。解决方案是，当我在第三个选项卡中时，我发回我的表单，重新加载选项卡并转到第一个选项卡。我一直在寻找解决问题的方法。

```
<script type="text/javascript">
    $(document).ready(function() {
        $("#example > ul").tabs({ remote: true, cache: true });
    });       
</script> 
```

那么我如何解决这个问题呢？谢谢你的回答。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-10-05T04:55:50.457

您没有指定是否使用 ASP.NET，但如果是，则可以将当前选定的选项卡存储在 <asp:HiddenField /> 中，而不是 cookie：

```
<script type="text/javascript" language="javascript">
    $(function() {
        $("#example").tabs({
            show: function() {
                var sel = $('#example').tabs('option', 'selected');
                $("#<%= hidLastTab.ClientID %>").val(sel);
            },
            selected: <%= hidLastTab.Value %>
        });
    });
</script>
<asp:HiddenField runat="server" ID="hidLastTab" Value="0" /> 
```

如果不是 ASP.NET，您可能会做类似的事情。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-01T16:56:45.170

选项卡可以使用 cookie 来存储当前选项卡。查看标签[文档](http://docs.jquery.com/UI/API/1.7/Tabs)。在选项列表下方有一个如何使用 cookie 存储当前选项卡的示例：

```
$('.selector').tabs({ cookie: { expires: 30 } }); 
```

这需要包含[jquery cookies 插件](http://plugins.jquery.com/project/cookie)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-08-07T23:09:17.963

我尝试使用 joelsand 发布的解决方案。但是，jQuery 选项卡选项和事件已更改。当前文档位于[http://api.jqueryui.com/tabs/](http://api.jqueryui.com/tabs/)。

而不是“显示”事件，我使用了“激活”事件。我使用了“活动”选项，而不是“选定”选项。我没有使用隐藏字段，而是使用了 JavaScript 变量（在 UpdatePanel 之外声明）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-30T06:58:58.740

我有同样的问题，通过将以下内容添加到 jquery 选项卡选择事件处理程序来解决：

```
$("div.ui-tabs-panel").html(""); 
```

它有效地清除所有现有面板以防止表单堆叠。

# spring - 将 applicationContext 拆分为多个文件

> ID：600095
> 
> 赞同：60
> 
> 时间：2009-03-01T16:57:10.630
> 
> 标签：spring, configuration

将 Spring 的配置拆分为多个 xml 文件的正确方法是什么？

目前我有

*   `/WEB-INF/foo-servlet.xml`
*   `/WEB-INF/foo-service.xml`
*   `/WEB-INF/foo-persistence.xml`

我`web.xml`的有以下几点：

```
<servlet>
    <description>Spring MVC Dispatcher Servlet</description>
    <servlet-name>intrafest</servlet-name>
    <servlet-class>
        org.springframework.web.servlet.DispatcherServlet
    </servlet-class>
    <init-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>
            /WEB-INF/foo-*.xml
        </param-value>
    </init-param>
    <load-on-startup>2</load-on-startup>
</servlet>

<context-param>
    <param-name>contextConfigLocation</param-name>
    <param-value>
            /WEB-INF/foo-*.xml
    </param-value>
</context-param>

<listener>
    <listener-class>
        org.springframework.web.context.ContextLoaderListener
    </listener-class>
</listener> 
```

实际问题：

*   这种方法*是否正确/最好*？
*   我真的需要在`DispatcherServlet` *AND*`context-param`部分中指定配置位置吗？

我需要记住什么才能引用`foo-servlet.xml`from中定义的 bean `foo-service.xml`？这与指定`contextConfigLocation`in有关系`web.xml`吗？

**更新1：**

我正在使用*Spring*框架 3.0。据我了解，我不需要像这样进行资源导入：

```
 <import resource="foo-services.xml"/> 
```

这是一个正确的假设吗？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-03-01T17:56:47.677

我发现以下设置最简单。

使用[DispatcherServlet](http://static.springframework.org/spring/docs/2.5.x/reference/mvc.html#mvc-servlet)的默认配置文件加载机制：

> 在初始化 DispatcherServlet 时，框架将在您的 Web 应用程序的 WEB-INF 目录中查找名为 [servlet-name]-servlet.xml 的文件并创建在那里定义的 bean（覆盖使用在全局范围内同名）。

`intrafest-servlet.xml`在您的情况下，只需在`WEB-INF`dir中创建一个文件，不需要在`web.xml`.

在`intrafest-servlet.xml`文件中，您可以使用[import](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-xml-import)来编写 XML 配置。

```
<beans>
  <bean id="bean1" class="..."/>
  <bean id="bean2" class="..."/>

  <import resource="foo-services.xml"/>
  <import resource="foo-persistence.xml"/>
</beans> 
```

请注意，Spring 团队实际上更喜欢在创建 (Web)ApplicationContext 时加载多个配置文件。如果您仍然想这样做，我认为您不需要同时指定上下文参数（`context-param`）*和*servlet 初始化参数（`init-param`）。两者之一就可以了。您还可以使用逗号指定多个配置位置。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2013-12-24T11:07:07.760

Mike Nereson 在他的博客上这样说：

[http://blog.codehangover.com/load-multiple-contexts-into-spring/](http://blog.codehangover.com/load-multiple-contexts-into-spring/)

> 有几种方法可以做到这一点。
> 
> **1\. web.xml 上下文配置位置**
> 
> 您的第一个选择是通过 ContextConfigLocation 元素将它们全部加载到您的 Web 应用程序上下文中。假设您正在编写一个 Web 应用程序，那么您已经在这里拥有了主要的 applicationContext。您需要做的就是在下一个上下文的声明之间放置一些空格。
> 
> ```
>  <context-param>
>       <param-name> contextConfigLocation </param-name>
>       <param-value>
>           applicationContext1.xml
>           applicationContext2.xml
>       </param-value>
>   </context-param>
> 
>   <listener>
>       <listener-class>
>           org.springframework.web.context.ContextLoaderListener
>       </listener-class>
>   </listener> 
> ```
> 
> 以上使用回车。或者，你可以只放一个空格。
> 
> ```
>  <context-param>
>       <param-name> contextConfigLocation </param-name>
>       <param-value> applicationContext1.xml applicationContext2.xml </param-value>
>   </context-param>
> 
>   <listener>
>       <listener-class> org.springframework.web.context.ContextLoaderListener </listener-class>
>   </listener> 
> ```
> 
> **2\. applicationContext.xml 导入资源**
> 
> 您的另一个选择是将您的主要 applicationContext.xml 添加到 web.xml，然后在该主要上下文中使用 import 语句。
> 
> 在`applicationContext.xml`你可能有...</p>
> 
> ```
>  <!-- hibernate configuration and mappings -->
>   <import resource="applicationContext-hibernate.xml"/>
> 
>   <!-- ldap -->
>   <import resource="applicationContext-ldap.xml"/>
> 
>   <!-- aspects -->
>   <import resource="applicationContext-aspects.xml"/> 
> ```
> 
> **您应该使用哪种策略？**
> 
> **1.**我总是喜欢通过**web.xml**加载。
> 
> 因为，这使我可以将所有上下文相互隔离。通过测试，我们可以只加载运行这些测试所需的上下文。这使得开发也更加模块化，因为组件保持不变`loosely coupled`，因此将来我可以提取一个包或垂直层并将其移动到自己的模块中。
> 
> **2.**如果您将上下文加载到 中`non-web application`，我会使用该`import`资源。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2015-02-24T10:58:55.377

我们正在处理两种类型的上下文：

**1**：根上下文（父上下文。通常包括所有jdbc（ORM，Hibernate）初始化和其他与spring安全相关​​的配置）

**2**：单个 servlet 上下文（子上下文。通常是 Dispatcher Servlet 上下文并初始化所有与 spring-mvc 相关的 bean（控制器、URL 映射等））。

这是一个包含多个应用程序上下文文件的 web.xml 示例

```
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://java.sun.com/xml/ns/javaee"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
                            http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd">

    <display-name>Spring Web Application example</display-name>

    <!-- Configurations for the root application context (parent context) -->
    <listener>
        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
    </listener>
    <context-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>
            /WEB-INF/spring/jdbc/spring-jdbc.xml <!-- JDBC related context -->
            /WEB-INF/spring/security/spring-security-context.xml <!-- Spring Security related context -->
        </param-value>
    </context-param>

    <!-- Configurations for the DispatcherServlet application context (child context) -->
    <servlet>
        <servlet-name>spring-mvc</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>
                /WEB-INF/spring/mvc/spring-mvc-servlet.xml
            </param-value>
        </init-param>
    </servlet>
    <servlet-mapping>
        <servlet-name>spring-mvc</servlet-name>
        <url-pattern>/admin/*</url-pattern>
    </servlet-mapping>

</web-app>
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-03-16T21:34:36.387

@eljenso：如果应用程序使用 SPRING WEB MVC，将使用 intrafest-servlet.xml webapplication context xml。

否则@kosoant 配置很好。

如果您不使用 SPRING WEB MVC，但想使用 SPRING IOC 的简单示例：

在 web.xml 中：

```
<context-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>classpath:application-context.xml</param-value>
</context-param> 
```

然后，您的 application-context.xml 将包含：`<import resource="foo-services.xml"/>` 这些导入语句以加载各种应用程序上下文文件并放入主 application-context.xml。

谢谢，希望这会有所帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-06-07T19:50:30.177

我是[modules-spring-contexts](https://gitlab.com/SpaceTrucker/modular-spring-contexts)的作者。

[这是一个小型实用程序库，与使用基于 XML 的配置元数据组合](http://docs.spring.io/spring/docs/4.1.x/spring-framework-reference/htmlsingle/#beans-factory-xml-import)实现的相比，它允许对 spring 上下文进行更模块化的组织。`modular-spring-contexts`通过定义模块来工作，这些模块基本上是独立的应用程序上下文，并允许模块从其他模块导入 bean，这些模块在其原始模块中导出。

那么关键点是

*   控制模块之间的依赖关系
*   控制导出哪些 bean 以及在何处使用它们
*   减少 bean 命名冲突的可能性

一个简单的示例如下所示：

文件`moduleDefinitions.xml`：

```
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:module="http://www.gitlab.com/SpaceTrucker/modular-spring-contexts"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                        http://www.gitlab.com/SpaceTrucker/modular-spring-contexts xsd/modular-spring-contexts.xsd
                        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

    <context:annotation-config />

    <module:module id="serverModule">
        <module:config location="/serverModule.xml" />
    </module:module>

    <module:module id="clientModule">
        <module:config location="/clientModule.xml" />
        <module:requires module="serverModule" />
    </module:module>

</beans> 
```

文件`serverModule.xml`：

```
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:module="http://www.gitlab.com/SpaceTrucker/modular-spring-contexts"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                        http://www.gitlab.com/SpaceTrucker/modular-spring-contexts xsd/modular-spring-contexts.xsd
                        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

    <context:annotation-config />

    <bean id="serverSingleton" class="java.math.BigDecimal" scope="singleton">
        <constructor-arg index="0" value="123.45" />
        <meta key="exported" value="true"/>
    </bean>

</beans> 
```

文件`clientModule.xml`

```
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:module="http://www.gitlab.com/SpaceTrucker/modular-spring-contexts"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                        http://www.gitlab.com/SpaceTrucker/modular-spring-contexts xsd/modular-spring-contexts.xsd
                        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

    <context:annotation-config />

    <module:import id="importedSingleton" sourceModule="serverModule" sourceBean="serverSingleton" />

</beans> 
```

# php - 从循环中插入值

> ID：600099
> 
> 赞同：0
> 
> 时间：2009-03-01T16:58:47.257
> 
> 标签：php

```
$sql1 = "SELECT SIDno FROM class WHERE SubjID='$SubjName' and SecID='$SecName'";
$result1 = mysql_query($sql1);
while ($row1 = mysql_fetch_assoc($result1)){
    $IDno = $row1["SIDno"];
    $sql2="INSERT INTO registered ( ServiceID, IDno, Stype)VALUES('$RecCode','$IDno','$Stype')";
} 
```

这是我的代码。它的工作，但它只插入一个数据到数据库中。如何才能从循环中插入所有可能的数据。谁能帮我？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T17:02:40.913

您可能在循环之后执行查询，因此只插入最后一条记录。

尝试在循环结束时执行插入查询：

```
while ($row1 = mysql_fetch_assoc($result1)) {
    $IDno = $row1["SIDno"];
    $sql2 = "INSERT INTO registered (ServiceID, IDno, Stype) VALUES ('".mysql_real_escape_string($RecCode)."', '".mysql_real_escape_string($IDno)."', '".mysql_real_escape_string($Stype)."')";
    mysql_query($sql2);
} 
```

或者您首先收集所有数据，然后执行一个查询以插入所有记录：

```
$values = array();
while ($row1 = mysql_fetch_assoc($result1)) {
    $IDno = $row1["SIDno"];
    $values[] = "('".mysql_real_escape_string($RecCode)."', '".mysql_real_escape_string($IDno)."', '".mysql_real_escape_string($Stype)."')";
}
if (!empty($values)) {
    $sql2 = "INSERT INTO registered (ServiceID, IDno, Stype) VALUES ".implode(',', $values);
    mysql_query($sql2);
} 
```

但不要忘记为查询准备值（参见[`mysql_real_escape_string`函数](http://docs.php.net/mysql_real_escape_string)）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-01T17:11:24.120

如果您不打算对获取的数据做任何事情，您可以使用 INSERT .. SELECT .. 语句。

例子：

```
INSERT INTO registered (ServiceID, IDno, Stype)
SELECT field1, field2, field3
FROM class
WHERE SubjID='$SubjName' and SecID='$SecName'" 
```

就像在我之前写的那样，逃避你的变量......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-01T17:05:32.917

*注意：确保您使用[`mysql_real_escape_string`](http://us3.php.net/manual/en/function.mysql-real-escape-string.php).*

```
$sql1 = "SELECT SIDno FROM class WHERE SubjID='$SubjName' and SecID='$SecName'";
$result1 = mysql_query($sql1);

$sql2 = "INSERT INTO registered (ServiceID, IDno, Stype) VALUES ";

$addComma = false;
while ($row1 = mysql_fetch_assoc($result1)){
    $IDno = $row1["SIDno"];
    $sql2 .= ($addComma ? ", " : "") . "('$RecCode','$IDno','$Stype')";
    $addComma = true;
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-01T17:02:49.413

更改此行：

```
$sql2="INSERT INTO registered..." 
```

对此：

```
$sql2 .= "INSERT INTO registered..." 
```

循环内。您每次都会不小心覆盖插入语句。如果您使用**`.=`**，您会将下一个语句附加到前一个语句，创建一批插入脚本，每个记录一个。

# c# - C#：不使用按钮时如何发送对话框的 OK 或 Cancel 返回消息？

> ID：600107
> 
> 赞同：59
> 
> 时间：2009-03-01T17:03:01.893
> 
> 标签：c#

C#：不使用按钮时如何发送对话框的 OK 或 Cancel 返回消息？

当用户按下 Enter 时，您将如何在文本框的条件下返回 OK 消息，并在用户按下 Ctrl+Q 时发送 Cancel ？

忽略：solution-this.dialogresult = dialogresult.ok 或 dialogresult.cancel。

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2009-03-01T20:09:44.833

设置表格的`DialogResult`：

```
this.DialogResult = DialogResult.OK;
this.Close(); 
```

这将导致任何打开此表单的开启者`ShowDialog()`获得给定`DialogResult`的结果。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-03-01T17:07:18.373

我假设您正在使用 Windows 窗体...

有几种方法。

对于 OK - 将表单上的 AcceptButton 设置为 OK 按钮。对于取消 - 将表单上的 Cancelbutton 设置为取消按钮。

或者，您可以手动将表单 DialogResult 设置为 DialogResult.OK 或 DialogResult.Cancel，然后以编程方式关闭表单。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-05-30T08:34:02.827

直接，在按钮本身的属性中，有DialogResult属性可以设置为OK/Cancel/Yes/No/etc...正如其他人所说，这个也可以通过程序来设置。

在按钮打开的窗体的属性中，将 AcceptButton 属性设置为您的按钮。这也会做一些事情，比如当你按下回车键时触发按钮，并突出显示按钮。

# c# - 在与开发语言环境不同的语言环境中部署应用程序

> ID：600112
> 
> 赞同：1
> 
> 时间：2009-03-01T17:05:41.780
> 
> 标签：c#, .net, datetime, culture

我的 .Net .exe 用于读取文件并将信息存储在 sql DB 中。在开发系统上，我们在美国语言环境中有默认设置和文件，一切正常。

我使用相同的 .exe 并部署到我们的 Prod 服务器上，其中默认设置和文件位于英国语言环境中。

我使用了 Datetime.Parse，它应该以本地系统的格式解析日期，即美国 MM/dd/yyyy 和英国 dd/MM/yyyy。

但是，在以英国格式解析日期时，它给出了一个例外，有人可以帮我找出我在哪里做错了。

我还注意到一些奇怪的事情，当我将 dev machine 的默认设置更改为 UK 然后编译 .exe 并部署它时它工作。

您能否也让我知道它为什么起作用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T17:08:03.927

您必须为您的 DateTime.Parse() 方法提供一个 iformatprovider（即 System.Globalization.CultureInfo 的一个实例）。顺便说一句，我建议使用 TryParse，或者如果您确切知道日期时间字符串是如何到达的，请使用 TryParseExact，因为它们要快得多。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-01T17:13:20.543

最好的解决方案是在 app.config 中指定区域设置，覆盖机器的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T17:39:24.133

很难说没有更多细节，但也许应用程序服务器**和**sql 服务器运行在另一种语言设置上，而不是您预期的。即使您在应用程序服务器上正确设置了文化设置，sql server 上的日期时间格式仍然不如预期。

# c# - 可空的 困惑

> ID：600115
> 
> 赞同：10
> 
> 时间：2009-03-01T17:07:19.170
> 
> 标签：c#, generics, nullable

为什么禁止以下内容？

```
Nullable<Nullable<int>> 
```

然而

```
struct MyNullable <T>
{

}

MyNullable<Nullable<int>> 
```

不是

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-01T17:19:05.630

这是因为结构约束实际上意味着[“不可为空”](http://msdn.microsoft.com/en-us/library/fsdhc71f(VS.80).aspx)，因为尽管 Nullable 是一个结构，但它是可以为空的（可以接受 null 值），`Nullable<int>`它不是外部 Nullable 的有效类型参数。

[这在约束文档](http://msdn.microsoft.com/en-us/library/d5x73970.aspx)中明确说明

> 其中 T: struct
> 类型参数必须是值类型。可以指定除 Nullable 之外的任何值类型。
> 有关更多信息，请参阅使用 Nullable 类型（C# 编程指南）。

如果您想要这样做的理由，您将需要我找不到的实际语言设计者对此的评论。但是我会假设：

1.  以当前形式实现 Nullable 所需的编译器和平台更改非常广泛（并且是 2.0 版本中相对最后一分钟的补充）。
2.  他们有几个可能令人困惑的边缘情况。

允许相当于 int?? 只会混淆这一点，因为该语言没有提供区分 Nullable`<Nullable<null>>`和 Nullable的方法，`<null>`也没有任何明显的解决方案。

```
Nullable<Nullable<int>> x = null;
Nullable<int> y = null;
Console.WriteLine(x == null); // true
Console.WriteLine(y == null); // true
Console.WriteLine(x == y); // false or a compile time error! 
```

在涉及 Nullable 类型的许多操作中，使该返回为真将是**非常**复杂且显着的开销。

CLR 中的某些类型是“特殊的”，例如字符串和原语，因为编译器和运行时对彼此使用的实现有很多了解。Nullable 在这种情况下也很特殊。由于它已经在其他领域特殊外壳特殊外壳，所以这`where T : struct`方面没什么大不了的。这样做的好处是处理泛型类中的结构，因为除了 Nullable 之外，它们都不能与 null 进行比较。这意味着 jit 可以安全地认为`t == null`总是错误的。

在语言被设计为允许两个非常不同的概念交互的地方，你往往会变得奇怪、混乱或危险的边缘情况。例如，考虑 Nullable 和相等运算符

```
int? x = null;
int? y = null;
Console.WriteLine(x == y); // true
Console.WriteLine(x >= y); // false! 
```

通过在使用 struct 泛型约束时防止 Nullables，可以避免许多讨厌（且不清楚）的边缘情况。

[至于从第 25.7 节](http://en.csharp-online.net/ECMA-334:_25.7_Constraints)（强调我的）中强制执行此操作的规范的确切部分：

> 值类型约束指定用于类型参数的类型参数必须是值类型（第 25.7.1 节）。任何具有值类型约束的不可为空的结构类型、枚举类型或类型参数都满足此约束。具有值类型约束的类型参数也不应具有构造函数约束。System.Nullable 类型为 T 指定不可为空的值类型约束。 **因此，T?? 形式的递归构造类型 和 Nullable `<`Nullable `<`T`>>`是被禁止的。**

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-01T17:10:52.517

我相信您只能在`Nullable`s 中使用不可为空的值类型。由于`Nullable`本身可以为空，因此禁止以这种方式嵌套。

来自[http://msdn.microsoft.com/en-us/library/kwxxazwb.aspx](http://msdn.microsoft.com/en-us/library/kwxxazwb.aspx)

> ```
> public Nullable(
>     T value
> ) 
> ```
> 
> 类型：TA值类型。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-01T17:45:58.733

Nullable 是特殊的，因为 CLR 中内置了对 Nullable 类型的装箱和拆箱的显式支持：

如果您`box`对 a 使用 MSIL 指令`Nullable<T>`，您实际上会得到 a`null`作为结果。没有其他值类型会在装箱时产生空值。

对拆箱有类似且对称的支持。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-01T17:12:11.763

Nullable 的泛型类型参数本身必须是不可为空的类型（即值类型）。这是我得到的 C# 编译器警告，它似乎是有道理的。告诉我，你为什么要做这样的事情？我个人认为这样的声明没有用，甚至没有什么意义。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-01T17:13:25.350

Nullable 允许您采用值类型并将其设为引用类型，即该值存在或不存在（为空）。由于引用类型已经可以为空，因此是不允许的。

引用自[MSDN](http://msdn.microsoft.com/en-us/library/b3h38hb0.aspx)：

> Nullable(T) 结构仅支持将值类型用作可空类型，因为引用类型在设计上可以为空。

# variables - 静态类型是否意味着如果要更改变量的类型就必须强制转换？

> ID：600126
> 
> 赞同：0
> 
> 时间：2009-03-01T17:18:10.487
> 
> 标签：variables, types, dynamic-languages, static-typing

除了“强制转换”之外，还有其他方法可以在 Java 和 C++ 等静态类型语言中更改变量类型吗？

我试图弄清楚动态类型和静态类型在实际方面的主要区别是什么，并不断寻找非常学术的定义。我想知道就我的代码的外观而言这意味着什么。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-01T18:28:39.583

确保您不会将静态类型与动态类型与强类型与弱类型相混淆。

*   静态类型：每个变量、方法参数、返回类型等都有一个在编译时已知的类型，无论是声明的还是推断的。
*   动态类型：类型在编译时被忽略/不存在
*   强类型：每个对象在运行时都有一个特定的类型，你只能对它执行那些为该类型定义的操作。
*   弱类型化：运行时对象要么没有显式类型，要么系统尝试在必要时自动转换类型。

这两个对立面可以自由组合：

*   Java 是静态和强类型的
*   C 是静态和弱类型的（指针算术！）
*   Ruby 是动态且强类型的
*   JavaScript 是动态弱类型的

通常，静态类型意味着编译器会捕获很多错误，这些错误是动态类型语言中的运行时错误——但这也意味着您花费大量时间担心类型，在许多情况下是不必要的（参见接口与鸭子打字）。

强类型意味着类型之间的任何转换都必须是显式的，要么通过强制转换，要么通过使用转换方法（例如，将字符串解析为整数）。这意味着更多的键入工作，但具有让您控制事物的优势，而当系统执行一些模糊的隐式转换时，弱类型通常会导致混乱，这会给您留下一个完全错误的变量值，从而导致严重破坏十个方法调用线。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-01T17:21:35.220

在 C++/Java 中，您不能更改变量的类型。

**静态类型**：变量在编译类型时分配了一种类型并且不会改变。

**动态类型**：变量的类型可以在运行时改变，例如在 JavaScript 中：

```
js> x="5" <-- String
5
js> x=x*5 <-- Int
25 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-01T17:23:42.220

主要区别在于，在动态类型语言中，直到您在运行时使用方法时才知道该方法是否存在。在静态类型语言中，检查是在编译时进行的，如果方法不存在，则编译失败。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-01T17:26:23.600

> 我想知道就我的代码的外观而言这意味着什么。

类型系统不一定对代码的外观有任何影响，例如，具有静态类型、类型推断和隐式转换的语言（例如 Scala）看起来很像动态类型语言。另请参阅：[辩论类型系统之前要了解的内容](http://www.pphsg.org/cdsmith/types.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-01T17:24:13.590

您*不需要*显式转换。在许多情况下，**隐式转换**有效。

例如：

```
int i = 42;
float f = i; // f ~= 42.0
int b = f;   // i == 42

class Base {
};

class Subclass : public Base {
};

Subclass *subclass = new Subclass();
Base *base = subclass;  // Legal

Subclass *s = dynamic_cast<Subclass *>(base); // == subclass.  Performs type checking.  If base isn't a Subclass, NULL is returned instead.  (This is type-safe explicit casting.) 
```

但是，您不能更改变量的类型。不过，您可以在 C++ 中使用联合来实现某种动态类型。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-01T17:30:49.097

让我们看看 Java 的静态类型语言和 JavaScript 的动态。在 Java 中，对于对象，变量是对对象的引用。对象具有运行时类型，引用具有类型。引用的类型必须是运行时对象的类型或其祖先之一。这就是多态性的工作原理。您必须强制转换以向上引用类型的层次结构，但不能向下。编译器确保满足这些条件。在像 JavaScript 这样的语言中，你的变量就是一个变量。你可以让它指向你想要的任何对象，并且在你检查之前你不知道它的类型。

但是，对于转换，有很多方法，如 Java 中的 toInteger 和 toFloat 来进行转换并生成具有相同相对值的新类型的对象。在 JavaScript 中也有转换方法，但它们也会生成新对象。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-01T19:30:06.270

无论您是否使用静态类型语言，您的代码实际上应该看起来并没有太大的不同。仅仅因为您可以在动态类型语言中更改变量的数据类型，并不意味着这样做是个好主意。

例如，在 VBScript 中，匈牙利符号通常用于指定变量的首选数据类型。这样你就可以很容易地发现代码是否混合了类型。（这不是匈牙利符号的原始用法，但它非常有用。）

通过保持相同的数据类型，您可以避免难以判断代码实际做什么的情况，以及代码根本无法正常工作的情况。例如：

```
Dim id
id = Request.QueryString("id") ' this variable is now a string
If id = "42" Then
  id = 142 ' sometimes turned into a number
End If
If id > 100 Then ' will not work properly for strings 
```

使用匈牙利符号，您可以发现混合类型的代码，例如：

```
lngId = Request.QueryString("id") ' putting a string in a numeric variable

strId = 42 ' putting a number in a string variable 
```

# apache - 为什么 modRewrite 将自动 .php 应用于这个简单的规则？

> ID：600127
> 
> 赞同：1
> 
> 时间：2009-03-01T17:18:21.997
> 
> 标签：apache, .htaccess, mod-rewrite

好吧，伙计们，我可能有一个愚蠢的问题，但我可能很愚蠢:)

我有这个简单的.htaccess：

```
Options +FollowSymlinks
RewriteEngine on
RewriteBase /

RewriteRule ^news/([^/]+)$               news-inside.php?n=$1 [L]
RewriteRule ^news/?$                  news.php [L]

RewriteCond %{REQUEST_FILENAME} !-f 
```

每次我尝试通过输入以下网址来进入第一条规则时：

[http://host/news/something](http://host/news/something)

我被重定向到文件news.php，而不是带有查询字符串的news-inside.php！

查看到达页面的 $_GET 和 $_SERVER，结果如下：

```
$_GET => empty

$_SERVER (some)

  'REQUEST_METHOD' => string 'GET' (length=3)
  'QUERY_STRING' => string '' (length=0)
  'REQUEST_URI' => string '/news/something' (length=15)
  'SCRIPT_NAME' => string '/news.php' (length=9)
  'PATH_INFO' => string '/something' (length=10)
  'PATH_TRANSLATED' => string '/var/www/rolo/something' (length=23)
  'PHP_SELF' => string '/news.php/something' (length=19) 
```

有任何想法吗？？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-01T17:23:49.020

尝试禁用[`MultiViews`](http://httpd.apache.org/docs/2.2/content-negotiation.html#multiviews)：

```
Options -MultiViews 
```

# .net - 我的项目最好的 CMS/网站入门套件是什么？

> ID：600135
> 
> 赞同：1
> 
> 时间：2009-03-01T17:24:14.543
> 
> 标签：.net, asp.net, web-applications, web

我需要建立一个公司简介网站，其中将包含该公司之前设计的图片库，并将包含正常的东西，例如关于我们，联系我们，快速导航的菜单，还需要给这家公司一个自己编辑网站的方式，那么您为我推荐哪个 CMS/网站模板？- 免费会更好

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-01T17:49:06.357

由于此问题已标记`.NET`，请查看[N2](http://n2cms.com/) -

> **N2 开源 ASP.NET CMS**
> 
> N2 是一个轻量级的 CMS 框架，可帮助您构建任何人都可以更新的出色网站。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T17:34:10.587

试试[OpenSourceCMS.com](http://www.opensourcecms.com/)。它可以让您演示很多 CMS，因此您可以尝试一些，然后选择最适合您需要的一个。他们有开源和商业 CMS、博客、论坛和 wiki 的示例，并且有用于 .NET 和 PHP 的示例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-01T17:35:58.260

看看 Blogengine.net ( [http://www.dotnetblogengine.net/](http://www.dotnetblogengine.net/) )。它兼作 CMS 和博客引擎。
Community Server ( [http://communityserver.com/](http://communityserver.com/) ) 可作为满足您所有需求的解决方案，但许可条款可能不适合您。
Das Blog( [http://www.dasblog.info/](http://www.dasblog.info/) ) 是另一个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T18:09:56.570

我推荐[DotNetNuke](http://www.dotnetnuke.com)。有一个非常大的活跃社区。[这](http://www.loadedtech.com.au/web_solutions/web_design_development/dotnetnuke.aspx)是一个包含一些很好的编辑功能演示的站点。我建议使用 DotNetNuke Community Edition 4.9.2。它是免费的并且非常稳定。（专业版与直接支持相同。）它提供了您需要的所有基本功能，并且有许多免费和付费的[第三方](http://marketplace.dotnetnuke.com/) [模块](http://www.snowcovered.com/snowcovered2/)和皮肤可用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-25T10:51:59.967

检查[http://graffiticms.codeplex.com/](http://graffiticms.codeplex.com/)

> 描述：
> 
> 创建和维护网站从未如此简单。Graffiti CMS 允许您快速发布和维护动态内容网站，而无需或几乎没有 Web 编程知识。公告
> 
> 第一个开源稳定版本将是 Graffiti CMS 1.3。已在源代码存储库中为此创建了一个分支。1.3 的目标之一是使数据库更改为零，因此从旧版本升级将非常简单。这个分支需要围绕新的 url 路由功能进行测试和一些简化。即将推出的功能列表... 不要将 2.0 分支用于您的生产网站，现在使用 1.3 分支。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-03-28T00:19:30.647

我建议[DotNetNuke](http://www.dotnetnuke.com/)。它是最好的开源。当前社区版本是免费的 4.92。后端数据库易于管理。

# c# - 如何获取刚刚插入的记录的 pkey 值（自动增量）？

> ID：600136
> 
> 赞同：4
> 
> 时间：2009-03-01T17:24:15.883
> 
> 标签：c#, asp.net, mysql

我随后在两个表中插入一条记录。第一次插入时，我将记录放在生成主键值的主表中。现在我需要把这条记录的一些字段放在另一个表中，包括主表的键值。我该怎么做呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T17:29:50.443

" `SELECT LAST_INSERT_ID();`" 将返回最后生成的自动增量 ID。

# c# - C#：如何调节窗体只允许按宽度而不是按高度调整大小？

> ID：600137
> 
> 赞同：3
> 
> 时间：2009-03-01T17:24:47.007
> 
> 标签：c#

C#：如何调节窗体只允许按宽度而不是按高度调整大小？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-01T17:31:11.983

使用[`MinimumSize`](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.minimumsize(VS.80).aspx)和[`MaximumSize`](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.maximumsize(VS.80).aspx)属性。将最小高度设置为等于最大高度。无需代码。

# sql-server - 将数据从本地数据库复制到远程数据库

> ID：600143
> 
> 赞同：0
> 
> 时间：2009-03-01T17:30:42.560
> 
> 标签：sql-server, database

我正在编写一个系统，需要将数据从客户端本地托管的 SQL 数据库复制到托管的服务器数据库。本地数据库中的大部分数据都被复制到实时数据库中，尽管进行了优化以减少需要发送的实际数据量。

将此数据从一个数据库发送到另一个数据库的最佳方式是什么？目前我可以看到一些可能的选择，但它们都还没有成为主要候选人。

*   复制，虽然这并不理想，但我们不能期望它在我们在托管环境中使用的 SQL 版本中得到支持。
*   链接服务器，直接复制数据 - 一种缓慢且有点不安全的方法
*   用于传输数据的 Web 服务
*   将我们需要的数据导出为 XML 并传输到服务器以批量导入。

复制的数据进入表的副本，没有标识字段，因此可以插入/更新数据而不会在这方面出现任何违规行为。这种数据传输不必在数据库级别完成，它可以从 .net 或其他工具完成。

**更多信息**

更新的频率将根据记录的更新频率完全不同。但基本思想是，如果记录发生更改，则用户可以将其发布到实时数据库。或者，我们将记录更改并以可配置的频率批量发送。

目前，对于核心表（产品目录），我们正在谈论的记录量约为每表 4000 行，但这完全取决于我们部署到的客户端，因为每个客户端都有自己的产品目录，范围从100 到 1000 种产品。为了澄清，每个客户端都在一个单独的本地/托管数据库组合上，它们没有组合到一个系统中。

除了单独发布项目外，我们还需要按需完成数据的完全重新同步。

该系统的另一个方面是从本地服务器复制的一些数据存储在辅助数据库中，因此我们有效地将来自两个数据库的数据合并到一个实时数据库中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T21:36:35.310

嗯，我有偏见。我必须承认。我想催眠你为 SQL Compare 做这件事。我一直面临着这种开放式的可怕问题。我得到了一份 SQL Compare 的副本，再也没有回头。SQL Compare 实际上是一个用于同步数据库的软件的愚蠢名称，一旦您有了一个工作项目以及所有正确的旋钮和按钮，它也会从命令行执行此操作。当然，您只能对相当小的数据库执行此操作，但如果没有它，我确实不想在公共场合看到它。

我对您的要求唯一关心的是您从多个客户那里收集产品目录。如果它们都在不同的表中，那么一切都很好，而如果它们都在同一个表中，那么这会使事情变得更加复杂。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-01T17:48:00.710

你在说多少数据？有多少个“客户”数据库？它需要多久发生一次？这些问题的答案将对您应该走的道路产生重大影响。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T17:54:04.597

这个问题几乎有无数种解决方案。为了缩小范围，您必须告诉我们一些您的要求和优先事项。

批量操作可能会涵盖广泛的场景，您应该将其添加到列表的顶部。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T18:40:11.833

我建议为此使用数据转换服务 (DTS)。您可以创建一个用于附加的 DTS 包和一个用于重新创建数据的 DTS 包。

可以从您的代码中调用 DTS 包操作，因此您可能希望创建一个包装器来控制您可以从应用程序调用的包。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-11T00:14:19.160

最后，我选择了一组触发器来捕获对更改日志表的数据修改。然后有一个应用程序轮询该表并生成 XML 文件以提交到在远程位置运行的 Web 服务。

# java - 运行打包在jar文件中的exe

> ID：600146
> 
> 赞同：30
> 
> 时间：2009-03-01T17:31:35.553
> 
> 标签：java, jar, exe

我正在通过我的 java 程序执行一个 exe。路径是用 Java 硬编码的。

我已将我的 exe 打包在 jar 中。

但是我卡住了，因为我在 Java 文件中硬编码了路径名，所以我无法将我的 jar 作为独立程序执行。

打包此类 jar 的任何提示，即内部有一个 exe 并能够将其作为独立程序运行？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-01T18:05:13.650

这将提取`.exe`到本地磁盘上的本地文件。当 Java 程序存在时，该文件将被删除。

```
import java.io.Closeable;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.URI;
import java.net.URISyntaxException;
import java.net.URL;
import java.security.CodeSource;
import java.security.ProtectionDomain;
import java.util.zip.ZipEntry;
import java.util.zip.ZipException;
import java.util.zip.ZipFile;

public class Main
{
    public static void main(final String[] args)
        throws URISyntaxException,
               ZipException,
               IOException
    {
        final URI uri;
        final URI exe;

        uri = getJarURI();
        exe = getFile(uri, "Main.class");
        System.out.println(exe);
    }

    private static URI getJarURI()
        throws URISyntaxException
    {
        final ProtectionDomain domain;
        final CodeSource       source;
        final URL              url;
        final URI              uri;

        domain = Main.class.getProtectionDomain();
        source = domain.getCodeSource();
        url    = source.getLocation();
        uri    = url.toURI();

        return (uri);
    }

    private static URI getFile(final URI    where,
                               final String fileName)
        throws ZipException,
               IOException
    {
        final File location;
        final URI  fileURI;

        location = new File(where);

        // not in a JAR, just return the path on disk
        if(location.isDirectory())
        {
            fileURI = URI.create(where.toString() + fileName);
        }
        else
        {
            final ZipFile zipFile;

            zipFile = new ZipFile(location);

            try
            {
                fileURI = extract(zipFile, fileName);
            }
            finally
            {
                zipFile.close();
            }
        }

        return (fileURI);
    }

    private static URI extract(final ZipFile zipFile,
                               final String  fileName)
        throws IOException
    {
        final File         tempFile;
        final ZipEntry     entry;
        final InputStream  zipStream;
        OutputStream       fileStream;

        tempFile = File.createTempFile(fileName, Long.toString(System.currentTimeMillis()));
        tempFile.deleteOnExit();
        entry    = zipFile.getEntry(fileName);

        if(entry == null)
        {
            throw new FileNotFoundException("cannot find file: " + fileName + " in archive: " + zipFile.getName());
        }

        zipStream  = zipFile.getInputStream(entry);
        fileStream = null;

        try
        {
            final byte[] buf;
            int          i;

            fileStream = new FileOutputStream(tempFile);
            buf        = new byte[1024];
            i          = 0;

            while((i = zipStream.read(buf)) != -1)
            {
                fileStream.write(buf, 0, i);
            }
        }
        finally
        {
            close(zipStream);
            close(fileStream);
        }

        return (tempFile.toURI());
    }

    private static void close(final Closeable stream)
    {
        if(stream != null)
        {
            try
            {
                stream.close();
            }
            catch(final IOException ex)
            {
                ex.printStackTrace();
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-01T17:33:51.027

操作系统不关心或知道 .jar 文件，因此您必须`.exe`在执行之前将该文件解压缩到某个临时位置。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-04-04T12:13:25.317

```
//gets program.exe from inside the JAR file as an input stream
InputStream is = getClass().getResource("program.exe").openStream();
//sets the output stream to a system folder
OutputStream os = new FileOutputStream("program.exe");

//2048 here is just my preference
byte[] b = new byte[2048];
int length;

while ((length = is.read(b)) != -1) {
    os.write(b, 0, length);
}

is.close();
os.close(); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-09-07T11:51:13.217

虽然其他用户已正确回答问题，但提取并运行然后清理。要考虑的另一点是完全原生化。

您已经在使用本机二进制文件来完成特定任务。为什么不创建一个本机安装程序来安装您的应用程序，并将二进制文件安装到操作系统特定位置（Win32 上的程序文件）并创建合适的快捷方式。

这样，您的应用程序会感觉更加原生，这意味着您无需编写或管理代码即可绕过这一事实。目前，Jar 看起来像一个跨平台的代码（Jar 可以在任何地方运行，对吗？），但它包含一个不会在任何地方运行的本机二进制文件。这感觉很矛盾。

对于安装人员，我可以推荐 Nullsoft 安装系统 (NSIS)，因为他们有许多优秀的教程和代码示例可供学习。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-02-08T13:37:40.463

采用

```
getClass().getResource(what).openStream() 
```

并复制到磁盘中的另一个文件。

* * *

## 回答 #6

> 赞同：-5
> 
> 时间：2009-03-01T17:39:07.097

您可以编写一个简单的 java 程序来使用 Runtime.exec() 启动 exe。然后，您可以将 jar 的“Main-Class”属性设置为该启动器类。然后用户可以运行你的 jar，它会运行 exe。

# localization - 哪种多语言 Web 架构效果最好（多视图/单视图）？

> ID：600166
> 
> 赞同：1
> 
> 时间：2009-03-01T17:44:20.953
> 
> 标签：localization

我只想支持 2 种语言。不需要任何额外的语言。在考虑易用性和可维护性之后，最好的方法是什么：

(a) 每个视图对每种语言都有一个单独的页面，它们将共享控制器和模型 dll

(b) 两种语言都将资源注入同一个视图模板

现在请不要担心 url 结构。我将欣赏关于利弊的理论论述的真实经验。谢谢你的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-01T17:51:37.113

多个视图显然更加灵活，如果您只有 2 个，那么这是一种可能性，但仍然很痛苦。

然而，只需要担心 2 而不是 N 意味着您可以在首先创建视图时将两者都考虑在内。因此，创建多个视图会创建一个使用资源并以两种语言工作的单一视图。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T17:51:52.387

取决于您期望本地化版本获得的不同程度。如果您非常有信心它们将始终几乎相同，每个占位符中的单词都不同，那么单个视图模型可能就是要走的路。

但是，我发现当两者混合时（即一些视图是相同的，只是翻译了；其他的最终有所不同）是在每个视图和子视图中构建一个提供者模型，所以当视图引擎去加载一个视图，在提供者工厂中有一个独立的逻辑来确定，对于那个特定的视图，是对两种语言使用相同的还是切换。

# c# - OnMouseDown、OnMouseMove 和自定义控件

> ID：600170
> 
> 赞同：0
> 
> 时间：2009-03-01T17:49:27.540
> 
> 标签：c#, windows-mobile, mouseevent

我正在为**windows mobile**开发一个应用程序。我有自己的控件，可以在其中移动图片。我已经覆盖了**OnMouseDown**和**OnMouseMove**来重绘用户移动它的图片。

我只在 Windows Mobile 6.1 Professional 模拟器上测试它。它有效，但我有一个问题：

我单击图像，用鼠标移动它，停止移动按住鼠标左键，等待几秒钟，然后释放按钮而不移动鼠标，图像再次移动。这是怎么回事？

我认为事件**OnMouseMove**是与事件 OnMouseUp 一起触发的，**但**我不确定。

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-01T17:59:11.417

我从来没有在 windows mobile 上尝试过一些东西，但是如果您不确定这些事件，那么制作一个多行文本框并在每次触发偶数时添加一些文本，这样您应该知道它什么时候触发..

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-01T18:50:03.620

鼠标消息非常一致，您可能会时不时地看到不必要的移动，但那是相同的坐标。

那为什么你的照片会动呢？没有更多信息是不可能回答的。

猜测：您将 EventArgs.X/Y 与 MousePosition.X/Y 混合。后者在屏幕坐标中。

# c++ - 用于 stl 算法的 C++“智能”谓词

> ID：600175
> 
> 赞同：2
> 
> 时间：2009-03-01T17:52:24.320
> 
> 标签：c++, templates, stl, sfinae

我需要为 stl 算法设计谓词，例如 find_if、count_if。

```
namespace lib
{
    struct Finder
    {
        Finder( const std::string& name ):
            name_( name )
        {
        }

        template< typename TElement >
        bool operator( const TElement& element )
        {
            return element.isPresent( name_ );
        }

        /* template< typename TElement >
        bool operator( const TElement& element )
        {
            const Data& data = element.getData();
            return data.isPresent( name_ );
        }*/ 
    };
} 
```

但是我需要它根据 TElement 中某些特定方法的存在而具有不同的运算符 ()。就像它有“getData”一样，我想检查该数据，如果没有，我会做一些其他的动作。

我知道 SFINAE。但我没有 boost:: 项目。所以要么有一些简单的模板“has_method”实现，要么你知道一些其他的设计解决方案。

我不能指向特定类型并简单地重载，因为我想将此 Predicate 放在项目库之一中，该项目库不知道那些具有“getData”方法的特定类。

只要没有命名空间，具有类特征的解决方案就很好。“lib”命名空间中的谓词查找器和具有“getData”的类位于“program”命名空间中。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T18:48:09.117

为什么要使用模板方法？如果有很多类类型，只需使用您想要基于它的特定类或公共基类。

例如

```
struct Finder
{
    Finder( const std::string& name ):
        name_( name )
    {
    }

    bool operator( const IsPresentBaseClass& element )
    {
        return element.isPresent( name_ );
    }

    bool operator( const GetDataBaseClass& element )
    {
        const Data& data = element.getData();
        return data.isPresent( name_ );
    } 
 }; 
```

如果这种模式在不同的类类型中经常发生，并且您在使用谓词之前就知道类型，那么您可以模板化谓词本身。

例如

```
template<class T1, class T2>
struct Finder
{
    Finder( const std::string& name ):
        name_( name )
    {
    }

    bool operator( const T1& element )
    {
        return element.isPresent( name_ );
    }

    bool operator( const T2& element )
    {
        const Data& data = element.getData();
        return data.isPresent( name_ );
    } 
 }; 
```

或者您可以使用的另一种方法是使用某种类特征来保存信息。

例如

```
struct UseIsPresent
{
    template<class T>
    static bool CompareElement( const T& element, const std::string& name )
    {
        return element.isPresent( name );
    }
};

struct UseGetData
{
    template<class T>
    static bool CompareElement( const T& element, const std::string& name )
    {
        const Data& data = element.getData();
        return data.isPresent( name );
    } 
};

// default to using the isPresent method
template <class T>
struct FinderTraits
{
    typedef UseIsPresent FinderMethodType;
};

// either list the classes that use GetData method
// or use a common base class type, e.g. UseGetData
template <>
struct FinderTraits<UseGetData>
{
    typedef UseGetData FinderMethodType;
};

struct Finder
{
    Finder( const std::string& name )
    : name_( name )
    {
    }

    template<class T>
    bool operator()( const T& element )
    {
        return FinderTraits<T>::FinderMethodType::CompareElement<T>(element, name_);
    }

    std::string name_;
}; 
```

所有这些方法的缺点是在某些时候您需要知道类型才能将它们拆分为要使用的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T17:59:50.307

您可以查看[Veldhuizen 的](http://ubiety.uwaterloo.ca/~tveldhui/papers/Template-Metaprograms/meta-art.html)模板`switch`主页。您可能可以使用它来选择确切的运算符？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T18:03:42.217

让您的类型派生自“功能类型”（例如类型“has_function1”），它将作为 java 接口工作，您就有机会，因为 SFINAE 可用于测试一种类型是否可以转换为另一种类型。

如果您有兴趣，我可以研究一下并给您更详细的答案。

**编辑：** 我知道你说你没有可用的 Boost 库，但是有什么阻止你获得让 boost::is_convertible 工作所需的几个文件吗？不会有任何特别要编译的东西！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T09:37:09.180

升压不是魔法；使用 SFINAE 相当简单：

```
 template< typename TElement >
    bool operator( const TElement& element, ... )
    {
        return element.isPresent( name_ );
    }

    template< typename TElement >
    bool operator( const TElement& element, const Data& data = element.getData())
    {
        return data.isPresent( name_ );
    } 
```

如果 SFINAE 无法编译，它将删除第二个重载。重载解决方案将选择第二个，如果它确实编译，因为 ... 是一个更糟糕的匹配。

# python - 在模块和类之间进行选择

> ID：600190
> 
> 赞同：23
> 
> 时间：2009-03-01T18:00:39.183
> 
> 标签：python, oop, module

在我的应用程序中，我必须维护一些全局应用程序状态和全局应用程序范围的方法，例如当前连接的用户、答案总数、创建应用程序配置文件等。有两个选项：

1.  使用全局变量创建一个单独的 appstate.py 文件，并在它们之上添加函数。最初看起来不错，但似乎我在代码的清晰度方面遗漏*了一些东西*。

2.  在 appstate.py 文件中使用类函数创建一个类 AppState，所有其他模块已由其特定作业定义。这看起来不错。但现在我必须写更长的行，比如 appstate.AppState.get_user_list()。而且，这些方法彼此之间并没有太大的关系。我可以创建单独的类，但这将是太多的类。

编辑：如果我使用类，我将使用类方法。我认为不需要将类实例化为对象。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-01T18:06:47.887

听起来像经典的难题:-)。

在 Python 中，如果这是最好的方法，选择使用模块并没有什么肮脏或可耻的。毕竟，模块、函数等实际上是语言中的一等公民，并且提供了许多其他编程语言仅通过使用对象才能提供的内省和属性。

您描述您的选项的方式，听起来有点像在这种情况下您对基于类的方法并不太疯狂。

我不知道您是否使用过 Django 框架，但如果没有，请查看有关它如何处理设置的文档。它们是应用程序范围的，它们在一个模块中定义，并且在全球范围内可用。它解析选项并在全球范围内公开它们的方式非常优雅，您可能会发现这种方法可以激发您的需求。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-01T18:19:17.203

*仅当您将应用程序状态存储在 AppState实例*中时，第二种方法与第一种方法显着不同，在这种情况下您的投诉不适用。如果您只是将内容存储在一个类中并使用静态/类方法，那么您的类与模块没有什么不同，而实际上将它作为一个模块将是 Pythonic。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-01T18:05:34.460

第二种方法似乎更好。我只会将第一个用于配置文件或其他东西。

无论如何，为了避免这个问题，你总是可以：

```
from myapp.appstate import AppState 
```

这样你就不必再写长线了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-01T19:17:16.707

为什么不使用该类的实例呢？这样，您以后甚至可以运行 2 个不同的“会话”，具体取决于您使用的实例。它可能会使其更加灵活。也许`get_appstate()`向模块添加一些方法，以便它实例化一次类。稍后，如果您可能需要多个实例，您可以更改此方法以最终获取参数并使用一些字典等来存储这些实例。

顺便说一句，您还可以使用属性装饰器来使内容更具可读性，并可以灵活地存储它的方式和存储位置。

我同意使用模块方法而不是类方法会更加pythonic。

顺便说一句，我不太喜欢通过某种“魔法”在全球范围内获得东西。我宁愿使用一些明确的调用来获取该信息。然后我知道事情是从哪里来的，以及当事情失败时如何调试它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-01T19:47:52.513

考虑这个例子：

```
configuration
|
+-> graphics
|   |
|   +-> 3D
|   |
|   +-> 2D
|
+-> sound 
```

真正的问题是：这个层次结构中的类和模块之间有什么区别，因为它可以通过两种方式表示？

类代表类型。如果您使用类而不是模块来实现您的解决方案，您可以检查图形对象的正确类型，但可以编写通用图形函数。

使用类，您可以生成参数化值。这意味着可以使用构造函数对*声音*类进行不同的初始化，但很难使用不同的参数初始化模块。

The point is, that you really something different from the modeling standpoint.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-01T18:05:58.297

我会选择课程路线，因为它可以更好地组织您的代码。请记住，为了便于阅读，您可以这样做：

```
from appstate import AppSate 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-01T18:08:45.543

我肯定会选择第二个选项：已经使用了第一个选项，我现在被迫重构，因为我的应用程序不断发展并且必须支持更多的模块化结构，所以我现在需要处理多个同时的“配置”。

第二种方法是，IMO，更灵活且面向未来。为了避免更长的代码行，您可以使用`from appstate import AppState`而不是`import appstate`.

# ruby-on-rails - 编辑表单不返回所选值

> ID：600192
> 
> 赞同：1
> 
> 时间：2009-03-01T18:01:47.027
> 
> 标签：ruby-on-rails, forms, edit

我在 Rails 中创建了一个网络表单，询问某人是否有孩子？如果我提交表单，它就可以插入到数据库中。当我编辑表单时，它没有显示它被选中。

例如，该字段是

每当我选择“否”然后再次编辑表单时，它都会将此字段显示为“是”。在数据库中，它被保存为值 1。是因为表单无法将值 0 或 1 与“是”或“否”相关联吗？我在表格中遗漏了什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-02T02:13:48.513

为什么你甚至为此使用选择？一个简单的复选框就足够了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-01T19:57:36.873

我假设您使用 MySql 作为数据库？

如果是这样，那是因为 mysql 没有`bool`类型。相反，它使用`TINYINT`并将 1 设置`true`为`0`false。

当您将数据重新加载回您的网络表单时，它应该可以正常工作，但我建议您只是制作`yes = 1`-`no = 0`这是“标准”，无缘无故地违反它只会在未来造成混乱和痛苦.

# php - 了解 PHP &（与号，按位与）运算符

> ID：600202
> 
> 赞同：66
> 
> 时间：2009-03-01T18:06:53.207
> 
> 标签：php, operators, bit-manipulation, bitwise-operators

我经常`($var & 1)`在我的代码中使用，如果`$var`是奇数则返回 true，如果是偶数则返回 false。

但是“&”实际上是做什么的呢？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-03-01T18:11:58.140

& 是二进制的`and`。如果你有一个二进制值，而你`and`有另一个二进制值，那么结果将是两者的按位`and`。一个例子：

```
 01101010
& 01011001
= 01001000 
```

最右边的位要么是 1（在这种情况下，数字是奇数），要么是 0，在这种情况下，数字是偶数。如果你`&`是一个带 1 的数字，你只看最低有效位，if 检查数字是 1 还是 0。正如其他人提到的，查看位运算符以了解它们如何工作的信息。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-03-02T05:26:43.510

二进制系统的两个基本运算是 OR 和 AND。

OR 表示“如果 A 开启或 B 开启”。一个真实的例子是两个并联的开关。如果任一允许电流通过，则电流通过。

AND 表示“如果 A 和 B 都打开”。现实世界的例子是两个串联的开关。只有当两者都允许电流通过时，电流才会通过。

在计算机中，这些不是物理开关而是半导体，它们的功能被称为[逻辑门](http://en.wikipedia.org/wiki/Logic_gate)。它们做与开关相同的事情——对电流或无电流作出反应。

当应用于整数时，一个数字中的每一位都与另一个数字中的每一位相结合。因此，要了解按位运算符 OR 和 AND，您需要将数字转换为二进制，然后对每对匹配位进行 OR 或 AND 运算。

因此：

```
00011011 (odd number)
AND
00000001 (& 1)
== 
00000001 (results in 1) 
```

然而

```
00011010 (even number)
AND
00000001 (& 1)
==
00000000 (results in 0) 
```

因此，(& 1) 操作使用 AND 逻辑将最右边的位与 1 进行比较。所有其他位都被有效地忽略了，因为任何东西都不是什么。二进制的偶数也是十进制的偶数（10 是 2 的倍数）。

二进制系统的其他基本操作包括 NOT 和 XOR。NOT 表示“如果 A 关闭”，并且是唯一一种只接受一个信号或“参数”而不是两个的逻辑门形式。XOR 的意思是“如果 A 或 B 开启，但不是两者都开启”。然后是 NAND、NOR 和 NXOR，它们基本上只是不与 AND、OR 和 XOR 组合，即 NAND 表示“如果 A 和 B*不*都打开”。

在编程中，操作员

```
& means AND,
| means OR, 
~ means NOT, and
^ means XOR. 
```

其他的可以通过组合这些来组成，例如：

```
~ (a & b) is equivalent to a NAND operation 
```

**PHP 具体说明**

位运算符不适用于浮点值，并且在 PHP 中，浮点值将首先隐式转换为整数。超出可以表示为整数的范围的数字将被截断为零 - 也就是说，PHP_INT_MAX 上的所有数字在表达式中看起来都是“偶数” `($num & 1)`）。如果你想支持 PHP_INT_MIN/PHP_INT_MAX 之外的数字，你需要`fmod($num, 2)`. *但是，如果您使用的是 64 位 PHP，那么您的整数将比浮点数具有更高的精度。*

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-03-01T18:13:32.117

了解按位和 PHP 也很有趣：

```
/**
 * Regular
 */
echo (true && true); // 1
echo (true && false); // nothing

echo (true || false); // 1
echo (false || false); // nothing

echo (true xor false); // 1
echo (false xor false); // nothing

/**
 * Bitwise
 */
echo (true & true); // 1
echo (true & false); // 0

echo (true | false); // 1
echo (false | false); // 0

echo (true ^ false); // 1
echo (false ^ false); // 0 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-03-16T21:50:16.727

我知道您的问题是关于理解按位运算符，并且接受的答案很好地解释了它。但是对于您给出的示例，我不禁建议您改用模运算符：

```
($var % 2) /* instead of */ ($var & 1) 
```

因为它清楚地表明您正在检查数字是否为奇数（不能被 2 整除），并且它更通用，所以您可以以相同的方式使用 ($var % 3) 并推断它对任何 N 的工作方式。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2010-01-31T19:25:14.913

除了其他答案，值得注意的是

```
if(func1() && func2()) 
```

只会`func2()`在`func1()`返回 true 时调用（“惰性求值”），而

```
if(func1() & func2()) 
```

无论如何都会调用这两个函数，但两者的真值表将是相同的（假设它们返回布尔值）。

* * *

thomasrutter 指出（在下面的评论中）你可能不应该在实践中做后者。`(A & B)`不一定具有与 相同的真实性`(A && B)`，尤其是当`A`和`B`是整数时。例如，如果 A=1 且 B=2（均为真），则 A & B 将为假，而 A && B 为真。此外，另一位开发人员可能会认为这是一个错字，并将其“更正”为两个与号。

# android - 如何检查服务是否在 Android 上运行？

> ID：600207
> 
> 赞同：1025
> 
> 时间：2009-03-01T18:09:09.397
> 
> 标签：android, android-service

如何检查后台服务是否正在运行？

我想要一个切换服务状态的 Android 活动——它让我在它关闭时打开它，如果它打开则关闭它。

* * *

## 回答 #1

> 赞同：1759
> 
> 时间：2011-05-07T12:54:46.370

我在活动中使用以下内容：

```
private boolean isMyServiceRunning(Class<?> serviceClass) {
    ActivityManager manager = (ActivityManager) getSystemService(Context.ACTIVITY_SERVICE);
    for (RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {
        if (serviceClass.getName().equals(service.service.getClassName())) {
            return true;
        }
    }
    return false;
} 
```

我称之为：

```
isMyServiceRunning(MyService.class) 
```

这很可靠，因为它基于 Android 操作系统通过[ActivityManager#getRunningServices](http://developer.android.com/reference/android/app/ActivityManager.html#getRunningServices%28int%29)提供的有关运行服务的信息。

所有使用 onDestroy 或 onSometing 事件或 Binder 或静态变量的方法都不会可靠地工作，因为作为开发人员，您永远不知道 Android 何时决定终止您的进程或调用或不调用哪个回调。请注意Android 文档中[生命周期事件表](http://developer.android.com/reference/android/app/Activity.html#ActivityLifecycle)中的“可杀死”列。

* * *

## 回答 #2

> 赞同：311
> 
> 时间：2009-03-03T22:58:35.127

不久前我遇到了同样的问题。由于我的服务是本地的，我最终只是使用服务类中的静态字段来切换状态，如 hackbod[所述](http://groups.google.com/group/android-developers/browse_thread/thread/8c4bd731681b8331/bf3ae8ef79cad75d)

**编辑（备案）：**

这是hackbod提出的解决方案：

> 如果您的客户端和服务器代码是同一个 .apk 的一部分，并且您使用具体的 Intent（指定确切服务类的意图）绑定到服务，那么您可以简单地让您的服务在运行时设置一个全局变量您的客户可以检查。
> 
> 我们故意没有 API 来检查服务是否正在运行，因为几乎没有失败，当您想做类似的事情时，您的代码中会出现竞争条件。

* * *

## 回答 #3

> 赞同：80
> 
> 时间：2011-02-12T04:42:52.107

知道了！

您**必须**要求`startService()`您的服务正确注册并且通过是`BIND_AUTO_CREATE`不够的。

```
Intent bindIntent = new Intent(this,ServiceTask.class);
startService(bindIntent);
bindService(bindIntent,mConnection,0); 
```

现在是 ServiceTools 类：

```
public class ServiceTools {
    private static String LOG_TAG = ServiceTools.class.getName();

    public static boolean isServiceRunning(String serviceClassName){
        final ActivityManager activityManager = (ActivityManager)Application.getContext().getSystemService(Context.ACTIVITY_SERVICE);
        final List<RunningServiceInfo> services = activityManager.getRunningServices(Integer.MAX_VALUE);

        for (RunningServiceInfo runningServiceInfo : services) {
            if (runningServiceInfo.service.getClassName().equals(serviceClassName)){
                return true;
            }
        }
        return false;
     }
} 
```

* * *

## 回答 #4

> 赞同：62
> 
> 时间：2011-05-20T10:58:23.227

一个小的补充是：

我的目标是知道一个服务是否正在运行，如果它没有运行，它实际上没有运行它。

调用 bindService 或调用可以被服务捕获的意图不是一个好主意，因为如果服务没有运行，它将启动服务。

所以，正如miracle2k建议的那样，最好在服务类中有一个静态字段来知道服务是否已经启动。

为了更简洁，我建议将服务转换为单例，并使用非常非常懒惰的获取：也就是说，完全没有通过静态方法对单例实例进行[实例化。](http://en.wikipedia.org/wiki/Singleton_pattern)您的服务/单例的静态 getInstance 方法仅返回单例的实例（如果已创建）。但它实际上并没有启动或实例化单例本身。该服务仅通过正常的服务启动方法启动。

然后修改单例设计模式以将令人困惑的 getInstance 方法重命名为类似`isInstanceCreated() : boolean`方法的名称会更加简洁。

代码将如下所示：

```
public class MyService extends Service
{
   private static MyService instance = null;

   public static boolean isInstanceCreated() {
      return instance != null;
   }//met

   @Override
   public void onCreate()
   {
      instance = this;
      ....
   }//met

   @Override
   public void onDestroy()
   {
      instance = null;
      ...
   }//met
}//class 
```

此解决方案很优雅，但仅当您有权访问服务类并且仅适用于服务的应用程序/包之外的类时才有意义。如果您的类在服务应用程序/包之外，那么您可以使用 Pieter-Jan Van Robays 强调的限制查询 ActivityManager。

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2010-09-23T17:01:57.360

您可以使用它（我还没有尝试过，但我希望它有效）：

```
if(startService(someIntent) != null) {
    Toast.makeText(getBaseContext(), "Service is already running", Toast.LENGTH_SHORT).show();
}
else {
    Toast.makeText(getBaseContext(), "There is no service running, starting service..", Toast.LENGTH_SHORT).show();
} 
```

如果有一个已经在运行的服务，startService 方法会返回一个 ComponentName 对象。如果不是，则返回 null。

请参阅*[公共抽象 ComponentName startService（意图服务）](http://developer.android.com/reference/android/content/Context.html#startService%28android.content.Intent%29)*。

这不像是我认为的检查，因为它是启动服务，所以你可以`stopService(someIntent);`在代码下添加。

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2014-07-14T03:23:52.953

```
/**
 * Check if the service is Running 
 * @param serviceClass the class of the Service
 *
 * @return true if the service is running otherwise false
 */
public boolean checkServiceRunning(Class<?> serviceClass){
    ActivityManager manager = (ActivityManager) getSystemService(ACTIVITY_SERVICE);
    for (RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE))
    {
        if (serviceClass.getName().equals(service.service.getClassName()))
        {
            return true;
        }
    }
    return false;
} 
```

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2016-09-19T17:48:29.593

**Android**文档的摘录：

> 与[sendBroadcast(Intent)](https://developer.android.com/reference/androidx/localbroadcastmanager/content/LocalBroadcastManager.html#sendBroadcast(android.content.Intent))类似，但如果 Intent 有任何接收者，此函数将阻塞并在返回之前立即分派它们。

*将此 hack 视为“ping”`Service`* . 由于我们可以同步广播，我们可以在 UI 线程上*同步*广播并获得结果。

## `Service`

```
@Override
public void onCreate() {
   LocalBroadcastManager
     .getInstance(this)
     .registerReceiver(new ServiceEchoReceiver(), new IntentFilter("ping"));
     //do not forget to deregister the receiver when the service is destroyed to avoid
     //any potential memory leaks 
}

private class ServiceEchoReceiver extends BroadcastReceiver {
    public void onReceive (Context context, Intent intent) {
      LocalBroadcastManager
         .getInstance(this)
         .sendBroadcastSync(new Intent("pong"));
    }
} 
```

## `Activity`

```
 bool serviceRunning = false;

    protected void onCreate (Bundle savedInstanceState){
        LocalBroadcastManager.getInstance(this).registerReceiver(pong, new IntentFilter("pong"));
        LocalBroadcastManager.getInstance(this).sendBroadcastSync(new Intent("ping"));
        if(!serviceRunning){
           //run the service
        }
    }

    private BroadcastReceiver pong = new BroadcastReceiver(){
        public void onReceive (Context context, Intent intent) {
          serviceRunning = true;   
        }
    } 
```

在许多应用程序中，赢家当然是设置为`true`in`Service.onCreate()`和 to `false`in的服务上的静态布尔字段，`Service.onDestroy()`因为它要简单得多。

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2016-10-29T20:15:06.563

检查服务是否正在运行的正确方法是简单地询问它。在您的服务中实现一个 BroadcastReceiver 来响应来自您的活动的 ping。服务启动时注册BroadcastReceiver，服务销毁时注销。从您的活动（或任何组件）中，向服务发送[本地广播](https://developer.android.com/reference/android/support/v4/content/LocalBroadcastManager.html)意图，如果它响应，您就知道它正在运行。请注意下面代码中 ACTION_PING 和 ACTION_PONG 之间的细微差别。

```
public class PingableService extends Service {
    public static final String ACTION_PING = PingableService.class.getName() + ".PING";
    public static final String ACTION_PONG = PingableService.class.getName() + ".PONG";

    public int onStartCommand (Intent intent, int flags, int startId) {
        LocalBroadcastManager.getInstance(this).registerReceiver(mReceiver, new IntentFilter(ACTION_PING));
        return super.onStartCommand(intent, flags, startId);
    }

    @Override
    public void onDestroy () {
        LocalBroadcastManager.getInstance(this).unregisterReceiver(mReceiver);
        super.onDestroy();
    }

    private BroadcastReceiver mReceiver = new BroadcastReceiver() {
        @Override
        public void onReceive (Context context, Intent intent) {
            if (intent.getAction().equals(ACTION_PING)) {
                LocalBroadcastManager manager = LocalBroadcastManager.getInstance(getApplicationContext());
                manager.sendBroadcast(new Intent(ACTION_PONG));
            }
        }
    };
}

public class MyActivity extends Activity {
    private boolean isSvcRunning = false;

    @Override
    protected void onStart() {
        LocalBroadcastManager manager = LocalBroadcastManager.getInstance(getApplicationContext());
        manager.registerReceiver(mReceiver, new IntentFilter(PingableService.ACTION_PONG));
        // the service will respond to this broadcast only if it's running
        manager.sendBroadcast(new Intent(PingableService.ACTION_PING));
        super.onStart();
    }

    @Override
    protected void onStop() {
        LocalBroadcastManager.getInstance(this).unregisterReceiver(mReceiver);
        super.onStop();
    }

    protected BroadcastReceiver mReceiver = new BroadcastReceiver() {
        @Override
        public void onReceive (Context context, Intent intent) {
            // here you receive the response from the service
            if (intent.getAction().equals(PingableService.ACTION_PONG)) {
                isSvcRunning = true;
            }
        }
    };
} 
```

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2016-07-13T14:26:04.143

我稍微修改了上面介绍的解决方案之一，但传递了类而不是通用字符串名称，以确保比较来自同一方法的字符串`class.getName()`

```
public class ServiceTools {
    private static String LOG_TAG = ServiceTools.class.getName();

    public static boolean isServiceRunning(Context context,Class<?> serviceClass){
        final ActivityManager activityManager = (ActivityManager)context.getSystemService(Context.ACTIVITY_SERVICE);
        final List<RunningServiceInfo> services = activityManager.getRunningServices(Integer.MAX_VALUE);

        for (RunningServiceInfo runningServiceInfo : services) {
            Log.d(Constants.TAG, String.format("Service:%s", runningServiceInfo.service.getClassName()));
            if (runningServiceInfo.service.getClassName().equals(serviceClass.getName())){
                return true;
            }
        }
        return false;
    }
} 
```

进而

```
Boolean isServiceRunning = ServiceTools.isServiceRunning(
                    MainActivity.this.getApplicationContext(),
                    BackgroundIntentService.class); 
```

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2019-10-16T01:26:17.447

使用 kotlin 的另一种方法。受到其他用户回答的启发

```
fun isMyServiceRunning(serviceClass: Class<*>): Boolean {
    val manager = getSystemService(Context.ACTIVITY_SERVICE) as ActivityManager
    return manager.getRunningServices(Integer.MAX_VALUE)
            .any { it.service.className == serviceClass.name }
} 
```

**作为 kotlin 扩展**

```
fun Context.isMyServiceRunning(serviceClass: Class<*>): Boolean {
    val manager = this.getSystemService(Context.ACTIVITY_SERVICE) as ActivityManager
    return manager.getRunningServices(Integer.MAX_VALUE)
            .any { it.service.className == serviceClass.name }
} 
```

**用法**

```
context.isMyServiceRunning(MyService::class.java) 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2012-09-16T16:54:06.190

我只想在@Snicolas 的答案中添加注释。以下步骤可用于检查是否调用停止服务`onDestroy()`。

1.  `onDestroy()`调用：转到设置 -> 应用程序 -> 运行服务 -> 选择并停止您的服务。

2.  `onDestroy()`未调用：转到设置 -> 应用程序 -> 管理应用程序 -> 选择并“强制停止”您的服务正在其中运行的应用程序。但是，由于您的应用程序在这里停止，所以服务实例肯定也会停止。

最后，我想提一下，那里提到的在单例类中使用静态变量的方法对我有用。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2011-02-12T04:26:54.580

`onDestroy`并不总是在服务中调用，所以这是没用的！

例如：只需在 Eclipse 中进行一次更改，再次运行该应用程序。使用 SIG: 9 强制退出应用程序。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2011-03-30T14:56:30.447

首先，您不应该使用[`ActivityManager`](https://developer.android.com/reference/android/app/ActivityManager). （[在这里](http://groups.google.com/group/android-developers/browse_thread/thread/8c4bd731681b8331/bf3ae8ef79cad75d)讨论）

服务可以单独运行，也可以绑定到 Activity 或两者兼而有之。如果您的 Service 正在运行，则检查 Activity 的方法是创建一个接口（扩展 Binder），在该接口中声明 the`Activity`和 the都`Service`可以理解的方法。您可以通过在您声明的地方创建自己的接口来做到这一点，例如“ `isServiceRunning()`”。然后，您可以将您的 Activity 绑定到您的服务，运行 isServiceRunning() 方法，服务将检查自己是否正在运行，并向您的 Activity 返回一个布尔值。

您还可以使用此方法停止您的服务或以其他方式与之交互。

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2014-08-06T23:41:37.983

同样，如果人们使用待处理的意图，人们可能会发现另一种更清洁的选择（例如`AlarmManager`：

```
public static boolean isRunning(Class<? extends Service> serviceClass) {
    final Intent intent = new Intent(context, serviceClass);
    return (PendingIntent.getService(context, CODE, intent, PendingIntent.FLAG_NO_CREATE) != null);
} 
```

Where`CODE`是您在类中私下定义的常量，用于标识与您的服务关联的待处理意图。

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2018-01-19T14:08:18.150

下面是一个优雅的 hack，涵盖了所有`Ifs`. 这仅适用于本地服务。

```
 public final class AService extends Service {

        private static AService mInstance = null;

        public static boolean isServiceCreated() {
            try {
                // If instance was not cleared but the service was destroyed an Exception will be thrown
                return mInstance != null && mInstance.ping();
            } catch (NullPointerException e) {
                // destroyed/not-started
                return false;
            }
        }

        /**
         * Simply returns true. If the service is still active, this method will be accessible.
         * @return
         */
        private boolean ping() {
            return true;
        }

        @Override
        public void onCreate() {
            mInstance = this;
        }

        @Override
        public void onDestroy() {
            mInstance = null;
        }
    } 
```

然后稍后：

```
 if(AService.isServiceCreated()){
        ...
    }else{
        startService(...);
    } 
```

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2016-06-13T19:00:22.793

Xamarin C# 版本：

```
private bool isMyServiceRunning(System.Type cls)
{
    ActivityManager manager = (ActivityManager)GetSystemService(Context.ActivityService);

    foreach (var service in manager.GetRunningServices(int.MaxValue)) {
        if (service.Service.ClassName.Equals(Java.Lang.Class.FromType(cls).CanonicalName)) {
            return true;
        }
    }
    return false;
} 
```

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2013-05-28T09:55:23.910

对于这里给出的用例，我们可以简单地使用`stopService()`方法的返回值。`true`如果存在指定的服务并被杀死，则返回。否则返回`false`。因此，如果结果是，您可以重新启动服务，`false`否则可以确保当前服务已停止。:) 如果你看看[这个](http://developer.android.com/reference/android/content/Context.html#stopService%28android.content.Intent%29)会更好。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2018-03-23T21:43:10.453

> geekQ 的响应，但在 Kotlin 类中。感谢极客Q

```
fun isMyServiceRunning(serviceClass : Class<*> ) : Boolean{
    var manager = getSystemService(Context.ACTIVITY_SERVICE) as ActivityManager
    for (service in manager.getRunningServices(Integer.MAX_VALUE)) {
        if (serviceClass.name.equals(service.service.className)) {
            return true
        }
    }
    return false
} 
```

通话

```
isMyServiceRunning(NewService::class.java) 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2019-02-08T13:05:01.223

在您的服务子类中使用静态布尔值来获取服务的状态，如下所示。

我的服务.kt

```
class MyService : Service() {
    override fun onCreate() {
        super.onCreate()
        isServiceStarted = true
    }
    override fun onDestroy() {
        super.onDestroy()
        isServiceStarted = false
    }
    companion object {
        var isServiceStarted = false
    }
} 
```

MainActivity.kt

```
class MainActivity : AppCompatActivity(){
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        val serviceStarted = FileObserverService.isServiceStarted
        if (!serviceStarted) {
            val startFileObserverService = Intent(this, FileObserverService::class.java)
            ContextCompat.startForegroundService(this, startFileObserverService)
        }
    }
} 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2019-07-24T06:29:38.110

对于 kotlin，您可以使用以下代码。

```
fun isMyServiceRunning(calssObj: Class<SERVICE_CALL_NAME>): Boolean {
    val manager = requireActivity().getSystemService(Context.ACTIVITY_SERVICE) as ActivityManager
    for (service in manager.getRunningServices(Integer.MAX_VALUE)) {
        if (calssObj.getName().equals(service.service.getClassName())) {
            return true
        }
    }
    return false
} 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2015-10-23T18:35:09.317

在 TheServiceClass 内部定义：

```
 public static Boolean serviceRunning = false; 
```

然后在 onStartCommand(...)

```
 public int onStartCommand(Intent intent, int flags, int startId) {

    serviceRunning = true;
    ...
}

 @Override
public void onDestroy()
{
    serviceRunning = false;

} 
```

然后，`if(TheServiceClass.serviceRunning == true)`从任何班级打电话。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2017-03-11T17:11:43.577

~~**简单地使用绑定与不创建自动**~~- 见 ps。并更新...

```
public abstract class Context {

 ... 

  /*
  * @return {true} If you have successfully bound to the service, 
  *  {false} is returned if the connection is not made 
  *  so you will not receive the service object.
  */
  public abstract boolean bindService(@RequiresPermission Intent service,
        @NonNull ServiceConnection conn, @BindServiceFlags int flags); 
```

例子 ：

```
 Intent bindIntent = new Intent(context, Class<Service>);
    boolean bindResult = context.bindService(bindIntent, ServiceConnection, 0); 
```

为什么不使用？**获取运行服务（）**

```
List<ActivityManager.RunningServiceInfo> getRunningServices (int maxNum)
Return a list of the services that are currently running. 
```

**注意：此方法仅用于调试或实现服务管理类型的用户界面。**

* * *

**附言。android 文档具有误导性，我在 google tracker 上打开了一个问题以消除任何疑问：**

[https://issuetracker.google.com/issues/68908332](https://issuetracker.google.com/issues/68908332)

正如我们所看到的，绑定服务实际上通过 ActivityManager 绑定器通过服务缓存绑定器调用事务 - 我试图跟踪哪个服务负责绑定，但我们可以看到绑定的结果是：

```
int res = ActivityManagerNative.getDefault().bindService(...);
return res != 0; 
```

交易是通过活页夹进行的：

```
ServiceManager.getService("activity"); 
```

下一个：

```
 public static IBinder getService(String name) {
    try {
        IBinder service = sCache.get(name);
        if (service != null) {
            return service;
        } else {
            return getIServiceManager().getService(name); 
```

这是通过以下方式在 ActivityThread 中设置的：

```
 public final void bindApplication(...) {

        if (services != null) {
            // Setup the service cache in the ServiceManager
            ServiceManager.initServiceCache(services);
        } 
```

这在 ActivityManagerService 中的方法中调用：

```
 private final boolean attachApplicationLocked(IApplicationThread thread,
            int pid) {
    ...
    thread.bindApplication(... , getCommonServicesLocked(),...) 
```

然后：

```
 private HashMap<String, IBinder> getCommonServicesLocked() { 
```

但是没有“活动”只有窗口包和警报..

所以我们需要回去打电话：

```
 return getIServiceManager().getService(name);

    sServiceManager = ServiceManagerNative.asInterface(BinderInternal.getContextObject()); 
```

这通过以下方式拨打电话：

```
 mRemote.transact(GET_SERVICE_TRANSACTION, data, reply, 0); 
```

这导致 ：

```
BinderInternal.getContextObject() 
```

这是本机方法....

```
 /**
     * Return the global "context object" of the system.  This is usually
     * an implementation of IServiceManager, which you can use to find
     * other services.
     */
    public static final native IBinder getContextObject(); 
```

我现在没有时间挖掘 c，所以在我剖析休息电话之前，我暂停我的回答。

**但是检查服务是否正在运行的最佳方法**是创建绑定（如果未创建绑定，则服务不存在）-并通过绑定查询服务的状态（使用存储在其状态上的内部标志）。

## 更新 23.06.2018

我发现那些很有趣：

```
/**
 * Provide a binder to an already-bound service.  This method is synchronous
 * and will not start the target service if it is not present, so it is safe
 * to call from {@link #onReceive}.
 *
 * For peekService() to return a non null {@link android.os.IBinder} interface
 * the service must have published it before. In other words some component
 * must have called {@link android.content.Context#bindService(Intent, ServiceConnection, int)} on it.
 *
 * @param myContext The Context that had been passed to {@link #onReceive(Context, Intent)}
 * @param service Identifies the already-bound service you wish to use. See
 * {@link android.content.Context#bindService(Intent, ServiceConnection, int)}
 * for more information.
 */
public IBinder peekService(Context myContext, Intent service) {
    IActivityManager am = ActivityManager.getService();
    IBinder binder = null;
    try {
        service.prepareToLeaveProcess(myContext);
        binder = am.peekService(service, service.resolveTypeIfNeeded(
                myContext.getContentResolver()), myContext.getOpPackageName());
    } catch (RemoteException e) {
    }
    return binder;
} 
```

简而言之 ：）

**“为已绑定的服务提供绑定器。此方法是同步的，如果目标服务不存在，则不会启动它。”**

public IBinder peekService(Intent service, String resolvedType, String callingPackage) 抛出 RemoteException；

> *

```
public static IBinder peekService(IBinder remote, Intent service, String resolvedType)
             throws RemoteException {
    Parcel data = Parcel.obtain();
    Parcel reply = Parcel.obtain();
    data.writeInterfaceToken("android.app.IActivityManager");
    service.writeToParcel(data, 0);
    data.writeString(resolvedType);
    remote.transact(android.os.IBinder.FIRST_CALL_TRANSACTION+84, data, reply, 0);
    reply.readException();
    IBinder binder = reply.readStrongBinder();
    reply.recycle();
    data.recycle();
    return binder;
} 
```

> *

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2019-08-04T04:47:20.740

在 kotlin 中，您可以在伴生对象中添加布尔变量，并从您想要的任何类中检查其值：

```
companion object{
     var isRuning = false

} 
```

创建和销毁服务时更改它的值

```
 override fun onCreate() {
        super.onCreate()
        isRuning = true
    }

override fun onDestroy() {
    super.onDestroy()
    isRuning = false
    } 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2014-03-27T08:11:45.283

可以有多个具有相同类名的服务。

我刚刚创建了两个应用程序。第一个应用程序的包名称是`com.example.mock`. 我创建了一个`lorem`在应用程序中调用的子包和一个名为`Mock2Service`. 所以它的全称是`com.example.mock.lorem.Mock2Service`.

然后我创建了第二个应用程序和一个名为`Mock2Service`. 第二个应用的包名是`com.example.mock.lorem`. 服务的完全限定名称`com.example.mock.lorem.Mock2Service`也是 。

这是我的 logcat 输出。

```
03-27 12:02:19.985: D/TAG(32155): Mock-01: com.example.mock.lorem.Mock2Service
03-27 12:02:33.755: D/TAG(32277): Mock-02: com.example.mock.lorem.Mock2Service 
```

一个更好的主意是比较`ComponentName`实例，因为`equals()`比较`ComponentName`包名和类名。并且不能在设备上安装两个具有相同包名称的应用程序。

的 equals() 方法`ComponentName`。

```
@Override
public boolean equals(Object obj) {
    try {
        if (obj != null) {
            ComponentName other = (ComponentName)obj;
            // Note: no null checks, because mPackage and mClass can
            // never be null.
            return mPackage.equals(other.mPackage)
                    && mClass.equals(other.mClass);
        }
    } catch (ClassCastException e) {
    }
    return false;
} 
```

[组件名称](http://developer.android.com/reference/android/content/ComponentName.html)

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2019-04-09T08:46:35.890

请使用此代码。

```
if (isMyServiceRunning(MainActivity.this, xyzService.class)) { // Service class name
    // Service running
} else {
    // Service Stop
}

public static boolean isMyServiceRunning(Activity activity, Class<?> serviceClass) {
        ActivityManager manager = (ActivityManager) activity.getSystemService(Context.ACTIVITY_SERVICE);
        for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {
            if (serviceClass.getName().equals(service.service.getClassName())) {
                return true;
            }
        }
        return false;
    } 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2020-08-10T09:57:05.177

检测服务是否正在运行的唯一*有效/最快/干净的方法是创建 PING/PONG 功能。*

在服务中实现 Messenger 或 AIDL 方法：`isAlive()`- 返回服务的状态。

不要实施广播，因为它们可能会被错过**。**

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2021-12-06T06:46:12.577

如果您有一个多模块应用程序，并且您想知道该服务是否正在运行，而该模块不依赖于包含该服务的模块，则可以使用此功能：

```
fun isServiceRunning(context: Context, serviceClassName: String): Boolean {

    val manager = ContextCompat.getSystemService(
        context,
        ActivityManager::class.java
    ) ?: return false

    return manager.getRunningServices(Integer.MAX_VALUE).any { serviceInfo ->
        serviceInfo.service.shortClassName.contains(vpnServiceClassName)
    }
} 
```

服务用途`MyService`：

```
isServiceRunning(context, "MyService") 
```

> 如果服务类名称发生变化而调用函数没有相应变化，则该函数可能无法正常工作。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2012-08-03T20:32:49.850

这更适用于 Intent Service 调试，因为它们会产生一个线程，但也可能适用于常规服务。感谢 Binging，我找到了这个帖子

就我而言，我使用了调试器并找到了线程视图。它有点像 MS Word 中的项目符号图标。无论如何，您不必处于调试器模式即可使用它。单击该过程，然后单击该按钮。任何 Intent 服务都会在它们运行时出现，至少在模拟器上是这样。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2013-08-04T11:14:41.827

如果服务属于其他进程或 APK，则使用基于 ActivityManager 的解决方案。

如果您可以访问其源代码，只需使用基于静态字段的解决方案。但是我建议使用一个布尔值而不是使用一个 Date 对象。在服务运行时，只需将其值更新为“现在”，并在完成后将其设置为空。从活动中，您可以检查它是否为空或日期是否太旧，这意味着它没有运行。

您还可以从您的服务发送广播通知，指示该通知正在运行进一步的信息，如进度。

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2019-03-15T13:58:37.593

`ActivityManager::getRunningServices`我对基于答案的 kotlin 转换。将此功能放入活动中-

```
private fun isMyServiceRunning(serviceClass: Class<out Service>) =
    (getSystemService(ACTIVITY_SERVICE) as ActivityManager)
        .getRunningServices(Int.MAX_VALUE)
        ?.map { it.service.className }
        ?.contains(serviceClass.name) ?: false 
```

* * *

## 回答 #31

> 赞同：-5
> 
> 时间：2013-07-02T20:46:08.207

伙计们，放轻松... :)

`SharedPreferences`我认为最合适的解决方案是在服务是否正在运行时保存一个键值对。

逻辑很直；在您的服务级别中的任何所需位置；放置一个布尔值，作为服务是否正在运行的标志。然后在应用程序中的任意位置读取此值。

我在我的应用程序中使用的示例代码如下：

在我的服务类（音频流的服务）中，我在服务启动时执行以下代码；

```
private void updatePlayerStatus(boolean isRadioPlaying)
{
        SharedPreferences sharedPref = this.getSharedPreferences(getString(R.string.str_shared_file_name), Context.MODE_PRIVATE);
        SharedPreferences.Editor editor = sharedPref.edit();
        editor.putBoolean(getString(R.string.str_shared_file_radio_status_key), isRadioPlaying);
        editor.commit();
} 
```

然后在我的应用程序的任何活动中，我都在以下代码的帮助下检查服务的状态；

```
private boolean isRadioRunning() {
        SharedPreferences sharedPref = this.getSharedPreferences(getString(R.string.str_shared_file_name), Context.MODE_PRIVATE);

        return sharedPref.getBoolean(getString(R.string.str_shared_file_radio_status_key), false);
} 
```

没有特殊权限，没有循环......简单的方法，干净的解决方案:)

如果您需要更多信息，请参阅[链接](http://developer.android.com/training/basics/data-storage/shared-preferences.html)

希望这可以帮助。

* * *

## 回答 #32

> 赞同：-5
> 
> 时间：2019-11-06T16:58:33.670

您可以使用 Android 开发人员选项中的此选项来查看您的服务是否仍在后台运行。

```
1\. Open Settings in your Android device.
2\. Find Developer Options.
3\. Find Running Services option.
4\. Find your app icon.
5\. You will then see all the service that belongs to your app running in the background. 
```

# project-management - 如何说服经理让你偿还技术债务？

> ID：600215
> 
> 赞同：13
> 
> 时间：2009-03-01T18:13:58.480
> 
> 标签：project-management, technical-debt

虽然最近的[Coding Horror 博客文章](http://www.codinghorror.com/blog/archives/001230.html)不是我第一次听说这个概念，但当我阅读它时，我忍不住将它应用到我自己的项目中。

我正在处理的代码库是一个正在进行的项目，现在大约有 3 年了，项目早期阶段的大部分代码是由开发人员编写的，他们几乎没有监督，这导致了很多代码重复、性能不佳等。在与管理层的讨论中，我试图说明有几个关键组件迫切需要重构，这样做可以在未来的迭代中节省大量时间和添加新功能时的麻烦并修复这些关键领域的错误。虽然他们似乎相信我重构这些组件会很好，但他们不想给我这样做的余地。请注意，我不是在谈论对整个代码库的重写或任何戏剧性的事情，只是对几个核心领域的重写，这将花费大约 2-3 周的时间。

那么问题来了，作为一名开发人员，您如何向您的经理推销这些领域需要解决的问题，并提出商业案例以便现在有时间解决这些问题，而不必只是在这里和那里逐步改进？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-01T19:08:03.233

作为*经理*，我愿意为以下三个具体业务案例之一进行代码重构/重写：减少技术支持、添加新功能和提高安全性。

作为一名*开发人员*，我看到了另外两个“近在咫尺”的案例，我将重构/偿还债务。你可能会发现你的经理对这些持开放态度，或者他可能只是给你“那种表情”，告诉你他不太相信。

首先，有时仅仅为了提高添加新功能的*能力*而进行重构是有意义的。例如，如果您可以看到需要您的系统更加灵活和适应性更强的业务，那么您可能需要重新考虑一些原始架构的承诺。这是偿还债务的好时机。

其次，当正在编写与已经存在的组件相关的新代码时，偿还一些债务是有意义的。例如，如果您要添加一个新类，该类在逻辑上是现有类的兄弟类，那么将公共代码重构为父类是有意义的。当你这样做时，你也有一个很好的机会来偿还债务。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-01T18:26:18.903

与往常一样，答案是“给我钱”，例如 - 为您提出的解决方案展示一个商业案例。传统上，这将通过计算与不合格代码相关的服务任务或帮助台票来完成。您的具体案例将很困难，因为您似乎在谈论一个不在生产中的项目。

仅基于您所写的内容以及您的项目仍在开发中的事实，我会提醒您记住格言“更好是完成的敌人”。（我相信它是由 Michael Lopp 创造或至少推广的。）在项目生命周期中可能会有更好的时间来重构代码。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-01T18:34:40.987

如果管理层表示同情，但不愿给您 2-3 周的时间进行全面检修，那么折衷方案是修复这些组件中的错误，编写一些测试并进行一些有限的重构，然后随着时间的推移改进代码。

您可以这样做，或者您可以要求将 10% 添加到用于该目的的这些区域中的错误/功能的估计中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-01T18:21:38.710

您链接中的主要文章已经有了完美的答案。这个技术债的描述非常好：

> 技术债务是 Ward Cunningham 为帮助我们思考这个问题而提出的一个绝妙的比喻。在这个比喻中，快速而肮脏的做事方式给我们带来了技术债务，这类似于金融债务。就像金融债务一样，技术债务也会产生利息，这是由于快速而肮脏的设计选择，我们必须在未来的开发中付出额外努力的形式。我们可以选择继续支付利息，也可以通过将快速而肮脏的设计重构为更好的设计来偿还本金。尽管偿还本金需要付出代价，但我们会通过减少未来的利息支付来获得收益。
> 
> 这个比喻还解释了为什么采取快速而肮脏的方法可能是明智的。就像企业为了利用市场机会而承担一些债务一样，开发人员可能会承担技术债务以赶上重要的最后期限。最普遍的问题是，发展组织让他们的债务失控，并将他们未来的大部分发展努力花在支付严重的利息上。

如果项目要去任何地方，项目经理必须从一开始就关心它。如果他关心他的项目，那么仅此描述就足以让他看到他可能从未想过的想法。只需帮助他设置一种方法来管理代码库中需要改进的所有地方。可能是您的问题跟踪系统中的组票或父票。这样，您就可以承担责任并列出需要改进的内容。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-02-17T15:24:40.687

In my humble opinion, paying off on your technical debt is something you should do in small bits every time you submit code, not taking time off to do two or three weeks a year.

Continuous improvement in small chunks will work wonders in the end.

No need to ask for permission then. :-)

/Roger

# f# - 访问 F# 元组中的特定成员

> ID：600216
> 
> 赞同：49
> 
> 时间：2009-03-01T18:17:32.370
> 
> 标签：f#, tuples

在 F# 代码中，我有一个元组：

```
let myWife=("Tijana",32) 
```

我想分别访问元组的每个成员。例如，这是我想通过 I can't 实现的

```
Console.WriteLine("My wife is {0} and her age is {1}",myWife[0],myWife[1]) 
```

这段代码显然不起作用，我认为您可以收集我想要实现的目标。

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2009-03-01T18:33:43.330

你想通过让她的年龄不可变来防止你的妻子变老吗？:)

对于只包含两个成员的元组，您可以`fst`提取`snd`对的成员。

```
let wifeName = fst myWife;
let wifeAge = snd myWife; 
```

对于更长的元组，您必须将元组解包到其他变量中。例如，

```
let _, age = myWife;;
let name, age = myWife;; 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-01T22:05:08.457

另一个非常有用的事情是模式匹配（就像使用“let”绑定提取元素时一样）可以在其他情况下使用，例如在编写函数时：

```
let writePerson1 person =
  let name, age = person
  printfn "name = %s, age = %d" name age

// instead of deconstructing the tuple using 'let', 
// we can do it in the declaration of parameters
let writePerson2 (name, age) = 
  printfn "name = %s, age = %d" name age

// in both cases, the call is the same
writePerson1 ("Joe", 20)
writePerson2 ("Joe", 20) 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2010-07-16T14:32:57.553

您可以使用函数 fst 获取第一个元素，使用 snd 获取第二个元素。您还可以编写自己的“第三个”函数：

```
let third (_, _, c) = c 
```

在此处阅读更多内容：[F# 语言参考，元组](http://msdn.microsoft.com/en-us/library/dd233200.aspx)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2017-01-30T08:58:08.377

您还可以编写一定长度的解包函数：

```
let unpack4 tup4 ind =
    match ind, tup4 with
    | 0, (a,_,_,_) -> a
    | 1, (_,b,_,_) -> b
    | 2, (_,_,c,_) -> c
    | 3, (_,_,_,d) -> d
    | _, _ -> failwith (sprintf "Trying to access item %i of tuple with 4 entries." ind) 
```

或者

```
let unpack4 tup4 ind =
    let (a, b, c, d) = tup4
    match ind with
    | 0 -> a
    | 1 -> b
    | 2 -> c
    | 3 -> d
    | _ -> failwith (sprintf "Trying to access item %i of tuple with 4 entries." ind) 
```

# html - 如何允许用户选择多个文件进行上传？

> ID：600218
> 
> 赞同：4
> 
> 时间：2009-03-01T18:19:03.413
> 
> 标签：html, upload, gmail

Gmail 刚刚发布了对其界面的更新，允许用户使用 CTRL 按钮选择多个文件进行上传。他们是怎么做到的？您可以阅读有关新功能的信息并在此处查看屏幕截图：

[http://gmailblog.blogspot.com/2009/02/updates-to-attachments-multi-select-and.html](http://gmailblog.blogspot.com/2009/02/updates-to-attachments-multi-select-and.html)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-01T18:25:55.737

您将需要找到基于闪存的解决方案，就像 Google 对 Gmail 所做的那样。你可以试试这个提供的 jQuery 插件：[jQuery File Upload Plugin](http://www.ronniesan.com/articles/jquery-multiple-file-upload.php)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-01T18:23:09.020

[Adobe Flash 播放器](http://www.adobe.com/products/flashplayer/)。

这是我使用的一个很好的库：[SWFUpload](http://code.google.com/p/swfupload/)

当然，这是一个*JavaScript*库，而不是一个*jQuery*插件，因此更便于移植。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T18:28:34.827

看看[RFC 1867](http://www.ietf.org/rfc/rfc1867.txt)它定义了如何使用多部分/混合编码通过 HTTP 上传文件。您可以使用 Apache Commons [FileUpload](http://commons.apache.org/fileupload/using.html)库在 Java 中执行此操作。我不知道 Google 是如何做到的，但您可以通过页面中的 JavaScript 处理来管理多项选择。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-01T18:26:05.160

不是 Gmail 使用的方法，而是以下链接，结合一些 jquery，您可以允许同时上传无限数量的文件：[链接](http://www.phpeasystep.com/workshopview.php?id=2)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-01T18:30:22.917

Google 没有使用 Flash，但实际上是一些聪明的 javascript（嗯，这就是他们的全部内容：-)）。使用 javascript 和 css，您可以创建一个文件选择器，让用户选择要上传的文件。然后，您使用隐藏的 iframe。将表单与您的上传文件一起发布的行为以隐藏的 iframe 为目标，以便服务器成功返回的结果进入该隐藏的 iframe。使用 javascript，监视该 iframe 的文档正文以了解文件何时上传。

此链接似乎是基本概念的一个快速示例：[http ://www.seemysites.net/projFolder/uploader/](http://www.seemysites.net/projFolder/uploader/)

# python - 如何让 Satchmo 在 Google App Engine 中工作

> ID：600225
> 
> 赞同：4
> 
> 时间：2009-03-01T18:22:33.357
> 
> 标签：python, google-app-engine, e-commerce, satchmo

我知道数据存储存在很大差异，但肯定因为 django 是捆绑的，并且它从 Satchmo 中抽象出数据存储，所以可以做些什么吗？

事实是我不是 Python 人，到目前为止主要是 Java/PHP，但我愿意学习。

另外，如果这在今天是不可能的，让我们联合起来形成一个新的开源项目来“扩展”satchmo 或者分支它，以实现兼容性？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T18:25:18.950

你不能。Satchmo 中有很多依赖项不允许您在 AppEngine 上安装。

请参阅此线程：[http ://groups.google.com/group/satchmo-users/browse_thread/thread/509265ccd5f5fc1e?pli=1](http://groups.google.com/group/satchmo-users/browse_thread/thread/509265ccd5f5fc1e?pli=1)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T15:57:57.467

在以下情况下可能：

*   有人将通用 ORM 写入 Bigtable 映射器。最有可能的是，[Appengine 补丁专家](http://code.google.com/appengine/articles/app-engine-patch.html)

*   有人重写了 Satchmo 的视图和模型以删除现有的 ORM 查询并使用补丁项目提供的 ORM 的最小功能，应该是你或 Satchmo 人。

*   有人经常使用[django helper project](http://code.google.com/appengine/articles/appengine_helper_for_django.html)，只能是帮助项目的人。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T10:11:27.737

没有什么是不可能的——这只需要付出很多努力——如果有人希望这样做——为什么不呢？但获得 Django 友好托管可能更容易（更便宜），而不是花费数小时破解代码。

# c++ - 在 C++ 中创建/打开事件并检查它们是否被触发

> ID：600228
> 
> 赞同：1
> 
> 时间：2009-03-01T18:23:26.803
> 
> 标签：c++, windows, multithreading, events

我有两个线程使用事件进行同步。在每个线程中，他们使用相同的调用：

```
::CreateEvent( NULL,TRUE,FALSE,tcEventName ) 
```

生产者线程首先进行调用，而消费者线程最后进行调用，所以它在技术上是开放的，而不是创建事件......我假设。

但是，当在生产者线程中调用 SetEvent 时，在消费者线程中永远不会触发相同的事件（我正在使用 WaitForMultipleObjects()）

有没有工具可以告诉我事件是否真的被正确触发了。

另外，当我在每个线程中调用 CreateEvent() 时，每个返回的句柄值都不同......它们应该相同吗？

有没有更好的方法来确保它能够工作？

这是在使用 Visual Studio 2005 的 Windows XP 上

**编辑：** 我做了更多检查，发现在生产者线程（第二个调用 CreateEvent）中调用 CreateEvent 将 LastError 设置为 183（ERROR_ALREADY_EXISTS），但是 CreateEvent 仍然返回事件的句柄......给出了什么？它怎么会出错，因为它已经存在但仍然返回一个句柄？还是应该这样做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T19:03:29.967

如果您只是在一个进程中使用多个线程，为什么不将事件句柄从一个传递到另一个？据我所知，创建命名内核对象是为了在进程之间共享它们。

您也可以尝试使用 OpenEvent 函数打开已创建的事件。这可能会给出一些想法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T21:58:34.773

根据[CreateEvent](http://msdn.microsoft.com/en-us/library/ms682396(VS.85).aspx)的 MSDN 文档，

> 如果函数成功，则返回值是事件对象的句柄。如果指定的事件对象在函数调用之前存在，则函数返回现有对象的句柄，GetLastError 返回 ERROR_ALREADY_EXISTS。

根据您的描述，我认为您的操作没有问题。我没有看到任何迹象表明你做错了什么。不过，对我来说，我通常使用 CreateEvent() 创建一次事件，然后将句柄传递给我希望由该事件发出信号的线程。但是您的方法在技术上没有任何问题。

您确实意识到 WaitForMultipleObjects() 返回句柄数组中第一个信号句柄的索引，对吗？例如，如果您的命名事件是列表中的第二个事件，但第一个句柄在绝大多数时间都发出信号（例如，通过快速作用线程或发出信号但从不重置的手动重置事件），WaitForMultipleObjects () 将始终返回 WAIT_OBJECT_0。换句话说，您的消费者线程永远不会看到您的命名事件已发出信号这一事实，因为第一个句柄“总是”发出信号。如果是这种情况，请将您的命名事件放在列表的首位。

您不会碰巧将 WaitForMultipleObjects() 的 bWaitAll 参数设置为 TRUE，对吗？如果你这样做了，那么在函数返回之前，handles 数组中的所有句柄都已发出信号。

谁为您的命名事件调用 ResetEvent()？应该是消费者。它不会被某些第三方线程意外调用，是吗？

这些只是一些需要仔细检查的事情。如果事件仍未按预期运行，请将 WaitForMultipleObjects() 替换为 WaitForSingleObject() 以查看您的命名事件是否正确地向使用者线程发出信号。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T18:30:05.460

您的代码应该像您描述的那样工作。如果在您尝试创建事件时该事件已经存在，您将获得现有事件的句柄。

每个线程的句柄都不同，因此您不必担心它们是否不同（它们应该不同）。

我建议您稍微简化一下，看看事情是否按您期望的方式工作。您使用 WaitForMultipleObjects() 的事实告诉我您还有其他事情要做。如果您认为它不起作用，请摆脱其他东西，看看您是否可以解决。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T20:25:34.483

在单个进程中，您只需调用一次 CreateEvent 并共享所有线程中返回的句柄。

此外，您不需要命名事件，除非您希望外部进程使用 OpenEvent 访问事件。事实上，如果你给事件命名，你的程序只有一个副本能够成功调用 CreateEvent。

# silverlight - 强制 Firefox 获取最新版本的 Silverlight 应用程序

> ID：600230
> 
> 赞同：4
> 
> 时间：2009-03-01T18:25:12.773
> 
> 标签：silverlight, firefox

这个问题[之前已经被问过，](https://stackoverflow.com/questions/307709/how-do-you-force-firefox-to-not-cache-or-re-download-a-silverlight-xap-file)但是 1）用户从未接受过答案 2）他们中没有一个比其他人更好（投票）和 3）提问者似乎已经忘记了它。所以我要再问一次，这样我才能得到一个可以接受的答案。线程中的一些用户表示某些解决方案不起作用。很抱歉把这个地方弄得乱七八糟，但我保证会追根究底。

前几天我在 Firefox 中查看我的 Silverlight 应用程序时遇到了这个问题。我更改了图像的位置，但它没有移动。我以为我做错了，但后来我查看了 IE7，图像在正确的位置。原来 Firefox 正在显示文件的缓存版本；我所做的更改没有出现。

这是一个更大的问题：如果我更改了我的应用程序（假设这是一个紧急的错字更正），我如何强制最终用户查看我的 Silverlight 应用程序的最新版本？[隔离存储（Heuer 的博客）](http://timheuer.com/blog/archive/2008/09/24/silverlight-isolated-storage-caching.aspx)真的是从服务器端强制更新的唯一方法吗？清除 Firefox 缓存不适用于推送更新；我需要在最终用户不做任何事情的情况下传播更新。

更新：[Dino Esposito](http://msdn.microsoft.com/en-us/magazine/2009.01.cuttingedge.aspx)有一些关于控制它的想法，特别是使用 Response 对象的 Expires 属性。还没有机会尝试这个。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-01T19:26:33.547

您可以在文件名中编码版本号或时间戳吗？这样，如果页面发生变化，Firefox 会注意到它指向了一个完全不同的资源并重新加载它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-02T01:50:24.310

首先，您需要在每次布局或代码更改后构建您的应用程序。Silverlight 不是 HTML，它是在本地运行的代码。

其次，这个问题的实际解决方案：

1.  `page.xaml`加载，在位于底层页面的 Web 服务上启动异步
2.  网络服务检测到 Firefox
3.  如果是 Firefox，告诉响应它立即过期

    ```
    [OperationContract]
    public bool DetectFirefox()
    {
        if ((HttpContext.Current.Request.Browser.Browser == "Firefox") &&
             ((HttpContext.Current.Request.Browser.MajorVersion >= 2)))
        {
            HttpContext.Current.Response.Expires = -1;
        }
        return true;
    } 
    ```

唯一需要注意的是，您需要先添加该代码，然后才能启动它。否则 FF3 将运行没有响应过期的旧版本代码。

# mysql - 计算表中的行数

> ID：600233
> 
> 赞同：3
> 
> 时间：2009-03-01T18:25:53.147
> 
> 标签：mysql, count

获取 MySQL 数据库中特定表中总行数的语法是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-01T18:27:41.100

我一直做

```
SELECT count(*) FROM table 
```

以上将为您提供所有行的总数。

您可以轻松地添加 WHERE 子句来获取某个子集的计数

```
SELECT count(*) FROM table WHERE foo = 'bar' 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-01T18:28:21.377

```
SELECT count(*)
FROM table_name 
```

# javascript - VS2008 的 onerror 处理

> ID：600253
> 
> 赞同：0
> 
> 时间：2009-03-01T18:39:19.853
> 
> 标签：javascript, exception, settimeout, onerror

```
function testFun() {
    onerror = function() { log("caught the error"); return true; };
    setTimeout(function() { throw "bad bad bad"; }, 300);
}; 
```

这是示例代码，但它演示了一个问题。如果我在 FF 或 IE7 中运行它，它会打印出合理的“捕获错误”消息（假设一个合理的“日志”功能）。

但是，如果我在 VS2008 中调试代码，调试器会在抛出时停止并显示以下消息：“Microsoft JScript 运行时错误：抛出异常且未捕获”。如果我说“继续”或“忽略”，则不会生成日志消息。

这是一个问题，因为我正在使用的实际代码比这大得多，而且我偶尔会想要调试一些东西。所以两个问题：

1.  任何人都知道为什么，我可以用一些我不知道的标志来修改这种行为吗？
2.  我是否在此代码中做我认为我正在做的事情（设置全局“onerror”处理程序）？如果不是，那么捕获此类错误的适当模式是什么？

注意：如果我使用 window.onerror 代替，这个问题没有区别。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-01T20:01:51.590

根据[这个](http://my.safaribooksonline.com/0596101996/jscript5-CHP-14-SECT-7)定义，全局`onerror`函数在 IE 中不起作用。他们可能在谈论 IE6 或更早版本，所以也许 MS 已经为 IE7 修复了它——但我不希望这会自动流向 VS 调试器。

无论如何，尝试使用`window.onerror = function`而不仅仅是`onerror`.

如果这不起作用，`try/catch`我猜你将不得不在你的定时器函数中使用一个块。

PS：获取firefox并使用firebug。调试器（和其他所有东西）*比*VS 调试更好更好用

# model-view-controller - 使用 Cron 请求网页

> ID：600254
> 
> 赞同：1
> 
> 时间：2009-03-01T18:39:23.677
> 
> 标签：model-view-controller, unix, cron

我有一个 MVC 架构，因为我已经有一个动作，如果每隔一小时左右自动调用一次，它会特别有用，我想知道是否有办法将它设置为 cron 作业？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-01T18:46:07.107

不知道周期性网页请求与 mvc 有什么关系，但您可以通过在 crontab 中添加以下行（1 小时周期）来实现这一点：

```
0 0/1 * * * wget <web_page_url> 
```

翻译为：使用命令在零分钟时每小时`wget`请求一次。`<web_page_url>`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-01T18:42:51.797

您可以使用

```
curl http://example.com 
```

或者，如果您使用的语言有像 PHP 这样的 CLI 客户端，您可以像这样运行脚本

```
php /var/www/example.com/index.php 
```

编辑：对于 MCV 应用程序，使用 curl 可能是最简单的

# wcf - 通过 WCF 双工通道长期运行的回调合同 - 替代设计模式？

> ID：600256
> 
> 赞同：8
> 
> 时间：2009-03-01T18:42:20.470
> 
> 标签：wcf, design-patterns, duplex, publish-subscribe

我有一个 Windows 服务，可以将雷达枪的速度读数记录到数据库中。此外，我将该服务设为 WCF 服务器。我有一个订阅服务的表单和一个 CF 客户端，只要有满足特定标准的读数就会被回调。

这原则上有效，但一段时间后通道超时。长时间运行的连接似乎存在一些基本问题（请参阅 [http://blogs.msdn.com/drnick/archive/2007/11/05/custom-transport-retry-logic.aspx](http://blogs.msdn.com/drnick/archive/2007/11/05/custom-transport-retry-logic.aspx)）和双工 HTTP 回调可能不是正确的解决方案。还有其他方法可以使用 WCF 实现发布/订阅模式吗？

编辑：即使有 2 小时的超时，频道最终也会受到影响。我收到此错误：

无法完成“SignalSpeedData”操作，因为会话通道等待接收消息时超时。要增加超时，请在配置文件中的绑定上设置 receiveTimeout 属性，或直接在 Binding 上设置 ReceiveTimeout 属性。

这发生在最后一次成功通话后 15 分钟。我想知道是否可以为每次通话重新建立一个新的会话，而不是保持会话打开。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-01T18:54:24.483

可靠的消息传递将满足您的需求。如果出现问题，通道会自行重新建立。WSDualHTTPBinding 为 http 绑定提供了这个，并且还有一个允许这个的 tcp 绑定。如果您在同一台计算机上，命名管道绑定将默认提供此功能。

# c# - Windows 窗体的 C# 财务图表库？

> ID：600259
> 
> 赞同：9
> 
> 时间：2009-03-01T18:44:02.230
> 
> 标签：c#, winforms, charts, financial

我需要一个可以为学生项目制作财务图表的开源/免费 C# 工具或库。它需要能够绘制开-高-低-收盘图表，并且能够绘制我计算的各种技术指标，所有这些都来自 Windows 窗体。

有什么建议吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-01T18:48:00.083

尝试[ZedGraph](http://sourceforge.net/projects/zedgraph/)。你几乎可以用那个库做任何事情。

注意：它是免费和开源的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-01T20:08:21.700

Microsoft 已经发布了.NET 3.5 的[图表控件](http://www.microsoft.com/downloads/details.aspx?FamilyId=130F7986-BF49-4FE5-9CA8-910AE6EA442C&displaylang=en)。您可以在[此论坛上获得支持。](http://social.msdn.microsoft.com/Forums/en-US/MSWinWebChart/threads/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T18:47:32.750

[SoftwareFX](http://www.softwarefx.com)的ChartFx非常好。它们不是免费的，但确实提供了可能适用于学生项目的 30 天试用版。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T18:48:59.083

它不是完全开源的，但它是免费的（如果您拥有有效的 Office 许可证）。您可以使用 Office Web Components 创建*几乎*任何 Excel 可以的图表。

[http://www.codeproject.com/KB/aspnet/owc11article.aspx](http://www.codeproject.com/KB/aspnet/owc11article.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-03T10:01:57.590

这可以让您清楚而简单地了解如何使用免费源的图表。

[http://www.codeproject.com/KB/graphics/charting.aspx](http://www.codeproject.com/KB/graphics/charting.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-01-24T02:00:26.573

我们使用[www.modulusfe.com](http://www.modulusfe.com)的 StockChartX - 有 COM、WPF 和 Silverlight 版本。还有Flash、HTML5等。

# python - Python 中的 mkdir -p 功能

> ID：600268
> 
> 赞同：949
> 
> 时间：2009-03-01T18:49:39.313
> 
> 标签：python, path, directory-structure, mkdir

`mkdir -p`有没有办法从 Python中获得类似于 shell 的功能。我正在寻找系统调用以外的解决方案。我确定代码少于 20 行，我想知道是否有人已经编写了它？

* * *

## 回答 #1

> 赞同：1306
> 
> 时间：2009-03-01T21:51:46.710

对于 Python ≥ 3.5，请使用[`pathlib.Path.mkdir`](https://docs.python.org/library/pathlib.html#pathlib.Path.mkdir)：

```
import pathlib
pathlib.Path("/tmp/path/to/desired/directory").mkdir(parents=True, exist_ok=True) 
```

该`exist_ok`参数是在 Python 3.5 中添加的。

* * *

对于 Python ≥ 3.2，[`os.makedirs`](https://docs.python.org/library/os.html#os.makedirs)有一个[可选的第三个参数`exist_ok`](https://docs.python.org/3/library/os.html?highlight=exist_ok#os.makedirs)，当 时`True`，启用该`mkdir -p`功能-<em>除非`mode`提供了并且现有目录具有与预期不同的权限；在这种情况下，`OSError`如前所述：

```
import os
os.makedirs("/tmp/path/to/desired/directory", exist_ok=True) 
```

* * *

对于更旧版本的 Python，您可以使用`os.makedirs`并忽略该错误：

```
import errno    
import os

def mkdir_p(path):
    try:
        os.makedirs(path)
    except OSError as exc:  # Python ≥ 2.5
        if exc.errno == errno.EEXIST and os.path.isdir(path):
            pass
        # possibly handle other errno cases here, otherwise finally:
        else:
            raise 
```

* * *

## 回答 #2

> 赞同：327
> 
> 时间：2012-06-19T13:21:48.183

在 Python >=3.2 中，这是

```
os.makedirs(path, exist_ok=True) 
```

在早期版本中，使用[@tzot 的答案](https://stackoverflow.com/a/600612/11343)。

* * *

## 回答 #3

> 赞同：158
> 
> 时间：2009-03-02T00:48:58.733

这比捕获异常更容易：

```
import os
if not os.path.exists(...):
    os.makedirs(...) 
```

**免责声明**这种方法需要两个系统调用，这在某些环境/条件下更容易受到竞争条件的影响。如果您正在编写比在受控环境中运行的简单一次性脚本更复杂的东西，那么您最好使用只需要一个系统调用的公认答案。

**更新 2012-07-27**

我很想删除这个答案，但我认为下面的评论线程很有价值。因此，我将其转换为 wiki。

* * *

## 回答 #4

> 赞同：48
> 
> 时间：2013-01-15T21:39:43.257

最近，我发现了这个[distutils.dir_util.mkpath](http://docs.python.org/2/distutils/apiref.html#distutils.dir_util.mkpath)：

```
In [17]: from distutils.dir_util import mkpath

In [18]: mkpath('./foo/bar')
Out[18]: ['foo', 'foo/bar'] 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2009-03-02T00:09:10.420

`mkdir -p`如果文件已存在，则会给您一个错误：

```
$ touch /tmp/foo
$ mkdir -p /tmp/foo
mkdir: cannot create directory `/tmp/foo': File exists 
```

因此，对先前建议的改进是如果返回（检查时）重新`raise`异常。`os.path.isdir``False``errno.EEXIST`

（更新）另见这个[高度相似的问题](https://stackoverflow.com/questions/273192/python-best-way-to-create-directory-if-it-doesnt-exist-for-file-write)；我同意接受的答案（和警告），但我会推荐`os.path.isdir`而不是`os.path.exists`.

（更新）根据评论中的建议，完整功能如下所示：

```
import os
def mkdirp(directory):
    if not os.path.isdir(directory):
        os.makedirs(directory) 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2016-02-08T17:02:36.813

使用python3 标准库中的[Pathlib](https://docs.python.org/3/library/pathlib.html#pathlib.Path.mkdir)：

```
Path(mypath).mkdir(parents=True, exist_ok=True) 
```

> 如果 parents 为真，则根据需要创建此路径的任何缺少的 parent；它们是使用默认权限创建的，不考虑模式（模仿 POSIX mkdir -p 命令）。如果 exists_ok 为 false（默认值），如果目标目录已存在，则会引发 FileExistsError。
> 
> 如果exist_ok 为真，FileExistsError 异常将被忽略（与 POSIX mkdir -p 命令的行为相同），但前提是最后一个路径组件不是现有的非目录文件。
> 
> **在 3.5 版更改:**添加了 exists_ok 参数。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2012-08-08T08:31:24.557

正如在其他解决方案中提到的，我们希望能够在模仿`mkdir -p`. 我不认为这是可能的，但我们应该尽可能接近。

先上代码，后解释：

```
import os
import errno

def mkdir_p(path):
    """ 'mkdir -p' in Python """
    try:
        os.makedirs(path)
    except OSError as exc:  # Python >2.5
        if exc.errno == errno.EEXIST and os.path.isdir(path):
            pass
        else:
            raise 
```

正如@tzot 回答的评论表明，在实际创建目录之前检查是否可以创建目录存在问题：您无法判断是否有人同时更改了文件系统。这也符合 Python 请求宽恕而不是许可的风格。

所以我们应该做的第一件事是尝试创建目录，然后如果出错，找出原因。

正如 Jacob Gabrielson 指出的那样，我们必须寻找的一种情况是文件已经存在于我们试图放置目录的情况。

与`mkdir -p`：

```
$ touch /tmp/foo
$ mkdir -p /tmp/foo
mkdir: cannot create directory '/tmp/foo': File exists 
```

Python 中的类似行为是引发异常。

所以我们必须弄清楚是否是这种情况。不幸的是，我们不能。无论目录存在（好）还是存在阻止创建目录（坏）的文件，我们都会从 makedirs 得到相同的错误消息。

解决问题的唯一方法是再次检查文件系统以查看那里是否有目录。如果存在，则静默返回，否则引发异常。

唯一的问题是文件系统现在可能处于与调用 makedirs 时不同的状态。例如：一个文件存在导致 makedirs 失败，但现在一个目录在它的位置。这并不重要，因为该函数只会在最后一次文件系统调用时目录存在时静默退出而不会引发异常。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-03-01T21:47:58.777

我认为 Asa 的回答基本上是正确的，但是您可以将其扩展一点，使其更像`mkdir -p`，或者：

```
import os

def mkdir_path(path):
    if not os.access(path, os.F_OK):
        os.mkdirs(path) 
```

或者

```
import os
import errno

def mkdir_path(path):
    try:
        os.mkdirs(path)
    except os.error, e:
        if e.errno != errno.EEXIST:
            raise 
```

这些都处理路径已经静默存在但让其他错误冒泡的情况。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2014-12-22T22:06:56.683

函数声明；

```
import os
def mkdir_p(filename):

    try:
        folder=os.path.dirname(filename)  
        if not os.path.exists(folder):  
            os.makedirs(folder)
        return True
    except:
        return False 
```

用法 ：

```
filename = "./download/80c16ee665c8/upload/backup/mysql/2014-12-22/adclient_sql_2014-12-22-13-38.sql.gz"

if (mkdir_p(filename):
    print "Created dir :%s" % (os.path.dirname(filename)) 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-08-06T09:47:43.473

```
import os
import tempfile

path = tempfile.mktemp(dir=path)
os.makedirs(path)
os.rmdir(path) 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2017-03-15T02:28:07.477

我个人在以下方面取得了成功，但我的函数可能应该被称为“确保此目录存在”：

```
def mkdirRecursive(dirpath):
    import os
    if os.path.isdir(dirpath): return

    h,t = os.path.split(dirpath) # head/tail
    if not os.path.isdir(h):
        mkdirRecursive(h)

    os.mkdir(join(h,t))
# end mkdirRecursive 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-05-11T15:35:12.823

```
import os
from os.path import join as join_paths

def mk_dir_recursive(dir_path):

    if os.path.isdir(dir_path):
        return
    h, t = os.path.split(dir_path)  # head/tail
    if not os.path.isdir(h):
        mk_dir_recursive(h)

    new_path = join_paths(h, t)
    if not os.path.isdir(new_path):
        os.mkdir(new_path) 
```

基于@Dave C's answer但修复了部分树已经存在的错误

# flash - Flash，在实际加载文件之前访问 totalBytes

> ID：600271
> 
> 赞同：1
> 
> 时间：2009-03-01T18:50:07.207
> 
> 标签：flash, actionscript-3, loading

我正在寻找一种简单的方法来查找我计划加载的文件的文件大小，而无需加载它们。我基本上是在制作一批需要加载的文件，如果我能事先确定总负载有多大，那将非常有用。

Flash 中的 Loader 对象有一个 totalBytes 属性，但它只会在您已经加载文件时返回一个值。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-02T23:58:07.303

加载，你的意思是完全加载，还是没有加载调用？如果可以接受加载调用，则以下内容可能很有用。进度事件在第一次触发时给出传入数据的总大小。我们只是让给定的进度事件触发，获取当前加载项的总值并将其添加到我们自己的 _total 变量中；我们继续这样做，直到我们的数据提供者（数组、xml 等）为空。到最后，您将获得所有资产总额的总和。

```
package
{
    import flash.display.Sprite;
    import flash.display.Loader;
    import flash.events.Event;
    import flash.events.ProgressEvent;
    import flash.URLLoader;
    import flash.URLRequest;

    public class ExampleDocumentClass extends Sprite
    {
        private var _urlLoader:URLLoader;
        private var _loader:Loader;
        private var _request:URLRequest;
        private var _total:Number;
        private var _array:Array;

        public function ExampleDocumentClass():void
        {
            if(stage) _init;
            else addEventListener(Event.ADDED_TO_STAGE, _init);
        }
        private function _init(e:Event = null):void
        {
            _array = [{type:"nonDisplay", path:"path/to/file"},{type:"display", path:"path/to/file"}];
            _urlRequest = new URLRequest();

            //Non display asset
             _urlLoader = new URLLoader();
            _urlLoader.addEventListener(ProgressEvent.PROGRESS, _onProgress);

            //Display asset
            _loader = new Loader();

            loadAsset();
        }
        private function loadAsset():void
        {
            if(_array.length > 0)
            {
                var pObj:Object = _array[0];
                if(pObj.type == "nonDisplay")
                {
                    loadNonDisplayAsset(pObj.path);
                }
                else
                {
                    loadDisplayAsset(pObj.path);
                }
                //Remove this item from the array;
                _array.shift();
            }
        }
        private function loadNonDisplayAsset(pAsset:String):void
        {
            _urlRequest.url = pAsset;
            _urlLoader.load(_urlRequest);
        }
        private function loadDisplayAsset(pAsset:String):void
        {
            _urlRequest.url = pAsset;
            _loader.contentLoaderInfo.addEventListener(ProgressEvent.PROGRESS, _onProgress);
            _loader.load(_urlRequest);
        }
        private function _onProgress(e:ProgressEvent):void
        {
            _total += e.bytesTotal;
            _loader.contentLoaderInfo.removeEventListener(ProgressEvent.PROGRESS, _onProgress);
            _urlLoader.removeEventListener(ProgressEvent.PROGRESS, _onProgress);
        }
    }
} 
```

因此，我们加载了一个足够长的资产，以将其总大小追加到我们自己的 _total 变量中，然后我们调用数组中的下一项并追加它的总和，直到数据提供者为空。显然，这可以使用 XML 来完成，或者无论如何，我在练习中使用了一个数组。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T19:00:13.720

之前没有办法从`Actionscript 3`. 一个简单的解决方案是向服务器添加一个小脚本，该脚本扫描所有文件并将它们的名称和大小返回给 swf（作为`JSON`或`XML`其他）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T19:01:31.143

在 ActionScript 中没有办法做到这一点。您需要一些服务器端代码来执行此操作。您可以创建一个采用文件名并返回总字节数的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T19:02:00.157

我不知道您将如何使用 actionscript（我不是 Guru）来执行此操作，但我的第一个猜测是使用 PHP 脚本（或您选择的任何其他脚本语言）来获取文件大小并返回值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T22:26:01.050

另一种（可能是矫枉过正）的方法是创建一些简单地向服务器询问文件头（包括文件大小）的东西。可以通过简单地开始下载文件并在您具有文件大小（应该非常快）或使用（如前所述）其他方式向服务器询问文件大小时关闭流来实现相同的目的（如果您正在加载多个文件，并且需要在加载之前知道文件大小）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-04-20T00:04:39.243

我已经尝试了 Brian Hodge 提供的方法，以及另一种方法，其中我将变量（文件夹位置作为来自 XML 的字符串）发送到 PHP，以便获取特定文件夹中所有文件的组合大小并将数据返回到闪光。

我在预加载天堂之旅中遇到的一个主要问题是，Flash Player 在文件大小方面似乎产生了不一致的结果！即使我两次加载完全相同的文件，Flash 也会告诉我它们的大小不同……有时。

这也导致了备用（PHP）方法的问题，因为 PHP 脚本会产生（看似）准确的文件大小结果，这些结果与 Flash 产生的结果不一致，导致我的加载器达到 85% 或 128%，这取决于缓存和Flash的心情：/

我放弃了这两种方法，转而使用一个名为[bulk-loader](http://code.google.com/p/bulk-loader/)的好类，它允许对多个项目进行排队加载和进度跟踪，等等：D

请注意，它会显着增加您的 swf 文件大小......多么讽刺

# c - Autoconf 和 A utotools 的替代品？

> ID：600274
> 
> 赞同：60
> 
> 时间：2009-03-01T18:52:10.620
> 
> 标签：c, autotools, autoconf

我是 GNU [Autotools](http://en.wikipedia.org/wiki/GNU_build_system)（主要是[Autoconf](http://en.wikipedia.org/wiki/Autoconf)，偶尔是[Libtool](http://en.wikipedia.org/wiki/GNU_Libtool)）的一个非常频繁的用户。我正在从事一个项目，其中可移植性将成为一个症结。然而，团队的其他成员只是不习惯使用[m4](http://en.wikipedia.org/wiki/M4_%28computer_language%29#Free_software_implementations)。我[在](http://xkcd.com/297/)收件箱中收到的不是一个人，而是四个人：

![m4 不是口齿不清，该死！](https://imgs.xkcd.com/comics/lisp_cycles.png)

无论如何，也许有人可以推荐一些基于 Python 或 PHP 的东西？我正在研究一棵更大的树的 C 端；我可以肯定 Python 或 PHP 5 都会出现，因为它们是先决条件。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-07-13T18:56:30.353

我冒着被否决的机会，但我必须承认，不幸的是，没有真正的自动工具替代品。CMake、SCons、bjam 都不错，但是，当涉及到严肃的工作时……很明显，自动工具更胜一筹，不是因为 CMake 不能做同样的事情，而是因为用它来做这件事要困难得多.

例如，最流行的自动工具替代品 CMake 有以下缺点：

*   不支持gettext。当您需要管理大量翻译和已翻译的源代码时，这可能是一个真正的问题。
*   不支持卸载目标。发现无法卸载已安装的程序，真是令人不快。
*   不会自动构建共享库和静态库*。*
*   文档**非常**有限而且很糟糕。

等等。

还有很多其他的点。不幸的是，没有真正高质量的自动工具替代品。另一方面，如果您在 Windows*和*Visual Studio 上进行开发，则不能使用自动工具，您需要选择提供此类工具的 CMake。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-03-01T18:53:42.190

我在[SCons](http://www.scons.org)上取得了很好的成功。它是用 Python 构建的，构建脚本实际上是 Python 脚本本身，它具有很强的表现力。从网站：

> SCons 是一种开源软件构建工具，即下一代构建工具。将 SCons 视为经典`Make`实用程序的改进的跨平台替代品，其集成功能类似于`autoconf/automake`编译器缓存（如`ccache`. 简而言之，SCons 是一种更简单、更可靠、更快速的软件构建方式。

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2009-03-01T18:54:43.747

我听说过[CMake](http://www.cmake.org/)试图解决相同问题的好消息。[这](http://en.wikipedia.org/wiki/CMake)是维基百科的文章

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-03-02T18:22:05.473

有很多不同的替代 Makefile 生成器和构建系统：

*   [制作](http://cmake.org)
*   [斯康斯](http://scons.org)
*   [华夫](http://code.google.com/p/waf/)
*   [Boost Build](http://www.boost.org/doc/tools/build/index.html)（又名 BJam，C++）

也可用，但不严格针对 C/C++：

*   [预制](http://industriousone.com/premake)
*   [蚂蚁](http://ant.apache.org/)（Java）
*   [耙子](http://rake.rubyforge.org/)（对于 Ruby）
*   （当然更多，我只是不认识他们......）

但是在列出所有这些之后，autotools 的巨大优势是不需要最终用户的任何其他依赖项。配置脚本仅由开发人员生成一次，并且不需要在用户端进行任何特殊处理，因为它是一个 shell 脚本。必须先安装上面列出的工具，然后任何人都可以构建您的源代码，他们甚至可能自己有依赖项。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-10-11T17:01:41.770

简单地使用[Make](http://www.gnu.org/software/make)和[pkg-config](http://pkg-config.freedesktop.org/wiki/)怎么样？

这是一个让您入门的[Makefile 模板。](http://git.suckless.org/surf/tree/Makefile)

少就是多的人。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-09-27T12:27:57.273

另一个自动* 替换 - [mk-configure](http://sourceforge.net/projects/mk-configure/)。文档可以在[这里找到](http://www.mova.org/~cheusov/pub/mk-configure/)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-01T19:17:23.973

我看过 CMake，除非您进行交叉编译，否则它看起来是一个不错的选择。如果你在做原生编译，你应该试试

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-01T19:33:39.473

Mozilla 正在创建一个 python 版本的 make - [pymake](http://benjamin.smedbergs.us/blog/2009-02-13/pymake/) - 它可能支持跨平台使用。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-07-13T18:47:11.560

对于从 ANT 或 maven 构建 C/C++ 软件，您可能对[terp](http://codemesh.com/products/terp/)感兴趣。它包括一个可移植的 C++ 编译器任务，可与许多平台上的许多 C++ 编译器一起使用。

# iphone - iPhone SDK：锁定方向

> ID：600284
> 
> 赞同：3
> 
> 时间：2009-03-01T18:56:35.147
> 
> 标签：iphone, objective-c, orientation

我在以前的应用程序中看到过（忘记了应用程序名称），您可以在其中锁定屏幕的当前方向。

有没有一种简单的方法可以做到这一点，例如，只需使用一个按钮。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-01T19:00:01.800

只需将 ivar 添加到您的应用程序委托中，即可通过按下锁定按钮进行设置。然后在所有视图控制器中，您只需检查应用程序委托中的 ivar 并响应

```
- (BOOL)shouldAutorotateToInterfaceOrientation:(UIInterfaceOrientation)interfaceOrientation 
```

根据您的方向发送消息 ivar

# c# - 如何检查一个数字是否是2的幂

> ID：600293
> 
> 赞同：663
> 
> 时间：2009-03-01T19:01:29.753
> 
> 标签：c#, algorithm, math

今天我需要一个简单的算法来检查一个数字是否是 2 的幂。

该算法需要是：

1.  简单的
2.  对任何`ulong`值都正确。

我想出了这个简单的算法：

```
private bool IsPowerOfTwo(ulong number)
{
    if (number == 0)
        return false;

    for (ulong power = 1; power > 0; power = power << 1)
    {
        // This for loop used shifting for powers of 2, meaning
        // that the value will become 0 after the last shift
        // (from binary 1000...0000 to 0000...0000) then, the 'for'
        // loop will break out.

        if (power == number)
            return true;
        if (power > number)
            return false;
    }
    return false;
} 
```

但后来我想：如何检查 log [2] x 是否是一个整数？当我检查 2^63+1 时，`Math.Log()`由于四舍五入而返回正好 63。所以我检查了 2 的 63 次方是否等于原始数字，因为计算是在`double`s 中完成的，而不是在确切的数字中。

```
private bool IsPowerOfTwo_2(ulong number)
{
    double log = Math.Log(number, 2);
    double pow = Math.Pow(2, Math.Round(log));
    return pow == number;
} 
```

这返回`true`给定的错误值：`9223372036854775809`。

有更好的算法吗？

* * *

## 回答 #1

> 赞同：1398
> 
> 时间：2009-03-01T19:06:25.873

这个问题有一个简单的技巧：

```
bool IsPowerOfTwo(ulong x)
{
    return (x & (x - 1)) == 0;
} 
```

请注意，此函数将报告`true`，`0`这不是 的幂`2`。如果你想排除它，方法如下：

```
bool IsPowerOfTwo(ulong x)
{
    return (x != 0) && ((x & (x - 1)) == 0);
} 
```

### 解释

首先是 MSDN 定义中的按位二进制 & 运算符：

> 二进制 & 运算符是为整数类型和 bool 预定义的。对于整数类型， & 计算其操作数的逻辑按位与。对于 bool 操作数， & 计算其操作数的逻辑与；也就是说，当且仅当它的两个操作数都为真时，结果才为真。

现在让我们看看这一切是如何发生的：

该函数返回布尔值 (true / false) 并接受一个 unsigned long 类型的传入参数（在本例中为 x）。为简单起见，让我们假设有人传递了值 4 并像这样调用函数：

```
bool b = IsPowerOfTwo(4) 
```

现在我们用 4 替换每次出现的 x：

```
return (4 != 0) && ((4 & (4-1)) == 0); 
```

好吧，我们已经知道 4 != 0 评估为真，到目前为止一切都很好。但是关于：

```
((4 & (4-1)) == 0) 
```

这当然转化为：

```
((4 & 3) == 0) 
```

但究竟是`4&3`什么？

4 的二进制表示是 100，3 的二进制表示是 011（记住 & 采用这些数字的二进制表示）。所以我们有：

```
100 = 4
011 = 3 
```

想象一下这些值就像基本加法一样堆叠起来。运算符表示，`&`如果两个值都等于 1，则结果为 1，否则为 0。所以`1 & 1 = 1`, `1 & 0 = 0`, `0 & 0 = 0`, 和`0 & 1 = 0`。所以我们做数学：

```
100
011
----
000 
```

结果只是 0。所以我们回过头来看看我们的 return 语句现在翻译成什么：

```
return (4 != 0) && ((4 & 3) == 0); 
```

现在翻译为：

```
return true && (0 == 0); 
```

```
return true && true; 
```

我们都知道这`true && true`是简单`true`的，这表明对于我们的示例，4 是 2 的幂。

* * *

## 回答 #2

> 赞同：104
> 
> 时间：2009-03-01T20:52:33.357

一些记录和解释这个和其他一些小技巧的网站是：

*   [http://graphics.stanford.edu/~seander/bithacks.html](http://graphics.stanford.edu/~seander/bithacks.html)
    ( [http://graphics.stanford.edu/~seander/bithacks.html#DetermineIfPowerOf2](http://graphics.stanford.edu/~seander/bithacks.html#DetermineIfPowerOf2) )
*   [http://bits.stephan-brumme.com/](http://bits.stephan-brumme.com/)
    ( [http://bits.stephan-brumme.com/isPowerOfTwo.html](http://bits.stephan-brumme.com/isPowerOfTwo.html) )

还有他们的祖父[，小亨利·沃伦（Henry Warren, Jr.）的《黑客的喜悦》一书](https://rads.stackoverflow.com/amzn/click/com/0201914654)：

*   [http://www.hackersdelight.org/](http://www.hackersdelight.org/)

正如[Sean Anderson 的页面](http://graphics.stanford.edu/~seander/bithacks.html#DetermineIfPowerOf2)所解释的，该表达式`((x & (x - 1)) == 0)`错误地表明 0 是 2 的幂。他建议使用：

```
(!(x & (x - 1)) && x) 
```

来纠正这个问题。

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2009-06-17T13:25:25.783

`return (i & -i) == i`

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2009-11-26T16:37:51.057

```
bool IsPowerOfTwo(ulong x)
{
    return x > 0 && (x & (x - 1)) == 0;
} 
```

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2015-09-03T21:23:51.863

已接受答案的以下附录可能对某些人有用：

以二进制表示时，2 的幂总是看起来像*1 后跟 n 个零*，其中 n 大于或等于 0。例如：

```
Decimal  Binary
1        1     (1 followed by 0 zero)
2        10    (1 followed by 1 zero)
4        100   (1 followed by 2 zeroes)
8        1000  (1 followed by 3 zeroes)
.        .
.        .
.        . 
```

等等。

当我们从这些数字中减去`1`时，它们变成*0，然后是 n 个 1*，并且 n 再次与上面相同。前任：

```
Decimal    Binary
1 - 1 = 0  0    (0 followed by 0 one)
2 - 1 = 1  01   (0 followed by 1 one)
4 - 1 = 3  011  (0 followed by 2 ones)
8 - 1 = 7  0111 (0 followed by 3 ones)
.          .
.          .
.          . 
```

等等。

来到症结所在

> 当我们对一个数字进行按位与运算时会发生什么`x`，它是 2 的幂，并且`x - 1`？

*一个`x`与 的零对齐，`x - 1`所有的零`x`与 的一个对齐`x - 1`，导致按位与结果为 0。*这就是我们如何得到上面提到的单行答案是正确的。

* * *

## 进一步增加了上述公认答案的美感-

所以，我们现在有一个财产可供我们使用：

> 当我们从任何数字中减去 1 时，在二进制表示中，最右边的 1 将变为 0，而最右边的 1 左侧的所有零现在将变为 1。

这个属性的一个很棒的用途是找出 -**在给定数字的二进制表示中存在多少个 1？**对给定整数执行此操作的简短代码`x`是：

```
byte count = 0;
for ( ; x != 0; x &= (x - 1)) count++;
Console.Write("Total ones in the binary representation of x = {0}", count); 
```

* * *

可以从上面解释的概念证明的数字的另一个方面是**“每个正数都可以表示为 2 的幂的和吗？”** .

是的，每个正数都可以表示为 2 的幂的总和。对于任何数字，取其二进制表示。例如：取数`117`。

```
The binary representation of 117 is 1110101

Because  1110101 = 1000000 + 100000 + 10000 + 0000 + 100 + 00 + 1
we have  117     = 64      + 32     + 16    + 0    + 4   + 0  + 1 
```

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2010-08-25T19:53:03.063

这是一个简单的[C++](http://en.wikipedia.org/wiki/C++)解决方案：

```
bool IsPowerOfTwo( unsigned int i )
{
    return std::bitset<32>(i).count() == 1;
} 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2009-03-01T19:06:50.863

发布问题后，我想到了以下解决方案：

我们需要检查其中一个二进制数字是否恰好是一。因此，我们只需将数字一次右移一位，`true`如果它等于 1，则返回。如果在任何时候我们得到一个奇数 ( `(number & 1) == 1`)，我们就知道结果是`false`。这证明（使用基准）比（大）真值的原始方法略快，而对于假或小值则快得多。

```
private static bool IsPowerOfTwo(ulong number)
{
    while (number != 0)
    {
        if (number == 1)
            return true;

        if ((number & 1) == 1)
            // number is an odd number and not 1 - so it's not a power of two.
            return false;

        number = number >> 1;
    }
    return false;
} 
```

* * *

当然，Greg 的解决方案要好得多。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2014-02-14T02:37:22.177

```
 bool IsPowerOfTwo(int n)
    {
        if (n > 1)
        {
            while (n%2 == 0)
            {
                n >>= 1;
            }
        }
        return n == 1;
    } 
```

这是一个通用算法，用于确定一个数字是否是另一个数字的幂。

```
 bool IsPowerOf(int n,int b)
    {
        if (n > 1)
        {
            while (n % b == 0)
            {
                n /= b;
            }
        }
        return n == 1;
    } 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2010-09-03T18:36:51.557

```
bool isPow2 = ((x & ~(x-1))==x)? !!x : 0; 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2012-12-21T11:49:06.253

```
return ((x != 0) && !(x & (x - 1))); 
```

如果`x`是 2 的幂，则其唯一的 1 位在 position `n`。这意味着`x – 1`position 有一个 0 `n`。要了解原因，请回想二进制减法的工作原理。当从 中减去 1 时`x`，借位一直传播到 position `n`；位`n`变为 0，所有低位变为 1。现在，由于`x`与 没有共同的 1 位`x – 1`，`x & (x – 1)`因此为 0，并且`!(x & (x – 1))`为真。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2012-02-15T15:53:24.600

```
bool isPowerOfTwo(int x_)
{
  register int bitpos, bitpos2;
  asm ("bsrl %1,%0": "+r" (bitpos):"rm" (x_));
  asm ("bsfl %1,%0": "+r" (bitpos2):"rm" (x_));
  return bitpos > 0 && bitpos == bitpos2;
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-09-19T20:12:08.633

```
int isPowerOfTwo(unsigned int x)
{
    return ((x != 0) && ((x & (~x + 1)) == x));
} 
```

这真的很快。检查所有 2^32 个整数大约需要 6 分 43 秒。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2016-05-29T17:45:11.210

对于 2 的任何幂，以下也成立。

## n&(-n)==n

注意： n=0 失败，因此需要检查它的
原因是：
-n 是 n 的 2s 补码。-n 将与 n 相比，将 n 的最右边设置位左侧的每一位翻转。对于 2 的幂，只有一个设置位。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2010-03-31T11:46:04.887

查找给定数字是否为 2 的幂。

```
#include <math.h>

int main(void)
{
    int n,logval,powval;
    printf("Enter a number to find whether it is s power of 2\n");
    scanf("%d",&n);
    logval=log(n)/log(2);
    powval=pow(2,logval);

    if(powval==n)
        printf("The number is a power of 2");
    else
        printf("The number is not a power of 2");

    getch();
    return 0;
} 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2012-01-12T09:57:09.337

如果一个数字仅包含 1 个设置位，则它是 2 的幂。我们可以使用这个属性和泛型函数`countSetBits`来判断一个数是否是 2 的幂。

这是一个 C++ 程序：

```
int countSetBits(int n)
{
        int c = 0;
        while(n)
        {
                c += 1;
                n  = n & (n-1);
        }
        return c;
}

bool isPowerOfTwo(int n)
{        
        return (countSetBits(n)==1);
}
int main()
{
    int i, val[] = {0,1,2,3,4,5,15,16,22,32,38,64,70};
    for(i=0; i<sizeof(val)/sizeof(val[0]); i++)
        printf("Num:%d\tSet Bits:%d\t is power of two: %d\n",val[i], countSetBits(val[i]), isPowerOfTwo(val[i]));
    return 0;
} 
```

**我们不需要明确检查 0 是否是 2 的幂，因为它也会为 0 返回 False。**

**输出**

```
Num:0   Set Bits:0   is power of two: 0
Num:1   Set Bits:1   is power of two: 1
Num:2   Set Bits:1   is power of two: 1
Num:3   Set Bits:2   is power of two: 0
Num:4   Set Bits:1   is power of two: 1
Num:5   Set Bits:2   is power of two: 0
Num:15  Set Bits:4   is power of two: 0
Num:16  Set Bits:1   is power of two: 1
Num:22  Set Bits:3   is power of two: 0
Num:32  Set Bits:1   is power of two: 1
Num:38  Set Bits:3   is power of two: 0
Num:64  Set Bits:1   is power of two: 1
Num:70  Set Bits:3   is power of two: 0 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2013-04-25T13:51:51.483

这是我设计的另一种方法，在这种情况下使用`|`代替`&`：

```
bool is_power_of_2(ulong x) {
    if(x ==  (1 << (sizeof(ulong)*8 -1) ) return true;
    return (x > 0) && (x<<1 == (x|(x-1)) +1));
} 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2021-10-25T16:13:43.367

现在在 .Net 6 中非常容易。

```
using System.Numerics;

bool isPow2 = BitOperations.IsPow2(64); // sets true 
```

[这](https://docs.microsoft.com/en-us/dotnet/api/system.numerics.bitoperations.ispow2?view=net-6.0)是文档。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2015-07-28T06:03:04.837

**例子**

```
0000 0001    Yes
0001 0001    No 
```

**算法**

1.  使用位掩码，将`NUM`变量除以二进制

2.  `IF R > 0 AND L > 0: Return FALSE`

3.  否则，`NUM`变为非零

4.  `IF NUM = 1: Return TRUE`

5.  否则，转到步骤 1

**复杂**

时间 ~二进制位数`O(log(d))`在哪里`d`

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2017-07-05T19:18:58.060

改进@user134548 的答案，无需位算术：

```
public static bool IsPowerOfTwo(ulong n)
{
    if (n % 2 != 0) return false;  // is odd (can't be power of 2)

    double exp = Math.Log(n, 2);
    if (exp != Math.Floor(exp)) return false;  // if exp is not integer, n can't be power
    return Math.Pow(2, exp) == n;
} 
```

这适用于：

```
IsPowerOfTwo(9223372036854775809) 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2019-12-09T11:51:48.140

如果您有 .NET Core 3 [System.Runtime.Intrinsics.X86.Popcnt.PopCount](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.popcnt?view=netcore-3.0) ， Mark Gravell 建议[这样做](https://stackoverflow.com/questions/59247510/generic-single-flag-enumeration-for-bitmask-enums/59247843#59247843)

```
public bool IsPowerOfTwo(uint i)
{
    return Popcnt.PopCount(i) == 1
} 
```

单指令，比速度更快，`(x != 0) && ((x & (x - 1)) == 0)`但可移植性较差。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2020-02-22T22:43:18.313

在 C 语言中，我测试了这个`i && !(i & (i - 1)`技巧，并将它与`__builtin_popcount(i)`Linux 上的 gcc 和 -mpopcnt 标志进行了比较，以确保使用 CPU 的 POPCNT 指令。我的测试程序计算了 0 到 2^31 之间的整数个数，它们是 2 的幂。

起初我认为这`i && !(i & (i - 1)`快了 10%，尽管我验证了 POPCNT 用于我使用的反汇编中`__builtin_popcount`。

然而，我意识到我已经包含了一个 if 语句，并且分支预测在 bit twiddling 版本上可能做得更好。正如预期的那样，我删除了 if 并且 POPCNT 最终更快。

结果：

**Intel(R) Core(TM) i7-4771 CPU 最高 3.90GHz**

```
Timing (i & !(i & (i - 1))) trick
30

real    0m13.804s
user    0m13.799s
sys     0m0.000s

Timing POPCNT
30

real    0m11.916s
user    0m11.916s
sys     0m0.000s 
```

**AMD Ryzen Threadripper 2950X 16 核处理器最高 3.50GHz**

```
Timing (i && !(i & (i - 1))) trick
30

real    0m13.675s
user    0m13.673s
sys 0m0.000s

Timing POPCNT
30

real    0m13.156s
user    0m13.153s
sys 0m0.000s 
```

请注意，这里的 Intel CPU 似乎比 AMD 稍微慢一点，但 POPCNT 快得多；AMD POPCNT 没有提供那么多的提升。

popcnt_test.c:

```
#include "stdio.h"

// Count # of integers that are powers of 2 up to 2^31;
int main() {
  int n;
  for (int z = 0; z < 20; z++){
      n = 0;
      for (unsigned long i = 0; i < 1<<30; i++) {
       #ifdef USE_POPCNT
        n += (__builtin_popcount(i)==1); // Was: if (__builtin_popcount(i) == 1) n++;
       #else
        n += (i && !(i & (i - 1)));  // Was: if (i && !(i & (i - 1))) n++;
       #endif
      }
  }

  printf("%d\n", n);
  return 0;
} 
```

运行测试：

```
gcc popcnt_test.c -O3 -o test.exe
gcc popcnt_test.c -O3 -DUSE_POPCNT -mpopcnt -o test-popcnt.exe

echo "Timing (i && !(i & (i - 1))) trick"
time ./test.exe

echo
echo "Timing POPCNT"
time ./test-opt.exe 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-06-09T14:51:59.657

我看到很多答案都建议返回 n && !(n & (n - 1)) 但根据我的经验，如果输入值为负数，它会返回错误值。我将在这里分享另一种简单的方法，因为我们知道两个数字的幂只有一个设置位，所以我们将简单地计算设置位的数量，这将花费 O(log N) 时间。

```
while (n > 0) {
    int count = 0;
    n = n & (n - 1);
    count++;
}
return count == 1; 
```

检查这篇文章[算不算。设置位](https://www.geeksforgeeks.org/count-set-bits-in-an-integer/)

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2020-07-09T01:37:50.243

这也是另一种方法

```
package javacore;

import java.util.Scanner;

public class Main_exercise5 {
    public static void main(String[] args) {
        // Local Declaration
        boolean ispoweroftwo = false;
        int n;
        Scanner input = new Scanner (System.in);
        System.out.println("Enter a number");
        n = input.nextInt();
        ispoweroftwo = checkNumber(n);
        System.out.println(ispoweroftwo);
    }

    public static boolean checkNumber(int n) {
        // Function declaration
        boolean ispoweroftwo= false;
        // if not divisible by 2, means isnotpoweroftwo
        if(n%2!=0){
            ispoweroftwo=false;
            return ispoweroftwo;
        }
        else {
            for(int power=1; power>0; power=power<<1) {
                if (power==n) {
                    return true;
                }
                else if (power>n) {
                    return false;
                }
            }
        }
        return ispoweroftwo;
    }
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2020-08-05T06:35:35.343

在这种方法中，您可以检查整数中是否只有 1 个设置位并且整数 > 0 (c++)。

```
bool is_pow_of_2(int n){
    int count = 0;
    for(int i = 0; i < 32; i++){
        count += (n>>i & 1);
    }
    return count == 1 && n > 0;
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2021-07-24T18:56:48.457

如果数字是最多 64 值的 2 的幂（您可以在 for 循环条件中更改它（“6”表示 2^6 为 64），则返回此值；

```
const isPowerOfTwo = (number) => {
  let result = false;
  for (let i = 1; i <= 6; i++) {
    if (number === Math.pow(2, i)) {
      result = true;
    }
  }
  return result;
};

console.log(isPowerOfTwo(16));
console.log(isPowerOfTwo(10));
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2022-02-25T08:00:17.190

.NET 6 中有一个衬里

```
// IsPow2 evaluates whether the specified Int32 value is a power of two.
Console.WriteLine(BitOperations.IsPow2(128));            // True 
```

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2009-07-21T20:29:18.790

```
private static bool IsPowerOfTwo(ulong x)
{
    var l = Math.Log(x, 2);
    return (l == Math.Floor(l));
} 
```

# visual-studio - 在 ATL 对话框中添加变量时如何解决“需要对象”错误

> ID：600302
> 
> 赞同：0
> 
> 时间：2009-03-01T19:05:10.820
> 
> 标签：visual-studio, visual-c++, atl

我正在使用 Visual Studio .NET 2003 在非托管 Visual C++ 中开发 COM ATL 应用程序。

我创建了一个 ATL Dialag，每当我尝试为控件添加变量时，向导都会显示“需要对象”消息。

我尝试了以下替代方案：

*   右键单击控件以从那里调用“添加变量”：这样向导不会发送消息但不会创建变量。
*   [这篇文章](http://www.codeguru.com/forum/showthread.php?t=441693)，但它是针对 VS2005 的。

有谁知道这个问题的任何解决方法？或者向导实际上做了什么，所以我可以手动完成？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-04T15:51:52.087

[这](http://support.microsoft.com/kb/323515)可能会有所帮助。这是在添加课程时。同样的事情可能适用于添加变量。

# nhibernate - ArgumentOutOfRangeException : 索引超出范围

> ID：600308
> 
> 赞同：5
> 
> 时间：2009-03-01T19:07:03.063
> 
> 标签：nhibernate, fluent-nhibernate

每当我使用 PersitenceSpecification 类来验证具有对值对象的引用的实体时，我都会收到这个奇怪的 ArgumentOutOfRangeException。

```
 public class CatalogItem : DomainEntity
    {
        internal virtual Manufacturer Manufacturer { get; private
set; }
        internal virtual String Name { get; private set; }

        protected CatalogItem()
        {}

        public CatalogItem(String name, String manufacturer)
        {
            Name = name;
            Manufacturer = new Manufacturer(manufacturer);
        }
    }

    public class CatalogItemMapping : ClassMap<CatalogItem>
    {
        public CatalogItemMapping()
        {
            Id(catalogItem => catalogItem.Id);

            Component<Manufacturer>(category => category.Manufacturer,
                                    m => m.Map(manufacturer =>
manufacturer.Name));

            Map(catalogItem => catalogItem.Name);
            Map(Reveal.Property<CatalogItem>("Price"));
        }
    }

    [TestFixture]
    public class When_verifying_the_class_mapping_of_a_catalog_item
        : NHibernateSpecification
    {
        [Test]
        public void Then_a_catalog_object_should_be_persistable()
        {
            new PersistenceSpecification<CatalogItem>(Session)
                .VerifyTheMappings();
        }
    }

    [TestFixture]
    public class NHibernateSpecification
        : Specification
    {
        protected ISession Session { get; private set; }

        protected override void Establish_context()
        {
            var configuration = new SQLiteConfiguration()
                .InMemory()
                .ShowSql()
                .ToProperties();

            var sessionSource = new SessionSource(configuration, new
RetailerPersistenceModel());
            Session = sessionSource.CreateSession();

            sessionSource.BuildSchema(Session);
            ProvideInitialData(Session);

            Session.Flush();
            Session.Clear();
        }

        protected override void Dispose_context()
        {
            Session.Dispose();
            Session = null;
        }

        protected virtual void ProvideInitialData(ISession session)
        {}
    } 
```

这是我得到的错误：

> 未执行测试用例“Then_a_catalog_object_should_be_persistable”：System.ArgumentOutOfRangeException：索引超出范围。必须是非负数且小于集合的大小。参数名称：System.ThrowHelper.ThrowArgumentOutOfRangeException 处的索引（ExceptionArgument 参数，ExceptionResource 资源）处 System.ThrowHelper.ThrowArgumentOutOfRangeException() 处 System.Collections.Generic.List`1.get_Item(Int32 index) at System.Data.SQLite.SQLiteParameterCollection.GetParameter(Int32 index) at System.Data.Common.DbParameterCollection.System.Collections.IList.get_Item (Int32 index) at NHibernate.Type.GuidType.Set(IDbCommand cmd, Object value, Int32 index) at NHibernate.Type.NullableType.NullSafeSet(IDbCommand cmd, Object value, Int32 index) at NHibernate.Type.NullableType.NullSafeSet(IDbCommand st, Object value, Int32 index, ISessionImplementor session) at NHibernate.Persister.Entity.AbstractEntityPersister.Dehydrate (Object id, Object[] fields, Object rowId, Boolean[] includeProperty, Boolean[][] includeColumns, Int32 table, IDbCommand statement, ISessionImplementor session, Int32 index) at NHibernate.Persister.Entity.AbstractEntityPersister.Insert(Object id, Object[] fields, Boolean[] notNull, Int32 j, SqlCommandInfo sql, Object obj, ISessionImplementor session) at NHibernate.Persister.Entity.AbstractEntityPersister.Insert(Object id, Object[] fields, Object obj, ISessionImplementor session) at NHibernate.Action.EntityInsertAction.Execute() at NHibernate.Engine.ActionQueue.Execute(IExecutable executable) at NHibernate.Engine.ActionQueue.ExecuteActions(IList list) at NHibernate.Engine.ActionQueue.ExecuteActions() at NHibernate.Event.Default.AbstractFlushingEventListener.PerformExecutions (IEventSource session) at NHibernate.Event.Default.DefaultFlushEventListener.OnFlush (FlushEvent event) at NHibernate.Impl.SessionImpl.Flush() at NHibernate.Transaction.AdoTransaction.Commit() d:\Builds\FluentNH\src\FluentNHibernate\Testing \PersistenceSpecification.cs(127,0): at FluentNHibernate.Testing.PersistenceSpecification`1.TransactionalSave (Object propertyValue) d:\Builds\FluentNH\src\FluentNHibernate\Testing\PersistenceSpecification.cs(105,0): 在 FluentNHibernate.Testing.PersistenceSpecification`1.VerifyTheMappings() C:\Source\SupplyChain\Tests\ Retailer.IntegrationTests\Mappings\CatalogItemMappingSpecifications.cs(14,0)：在 SupplyChain.Retailer.IntegrationTests.Mappings.When_verifying_the_class_mapping_of_a_catalog_item.Then_a_catalog_object_should_be_persistable ()

很抱歉这篇长文，但这一篇让我忙了几个小时。这可能不是由 FNH 引起的，因为我发现这张 NH 本身的 JIRA 票中提到了类似的内容：

[http://forum.hibernate.org/viewtopic.php?p=2395409](http://forum.hibernate.org/viewtopic.php?p=2395409)

我仍然希望我在我的代码中做错了什么:-)。任何想法？

提前致谢

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-06T21:28:24.493

我找到了解决这个问题的方法，这首先是我自己的愚蠢造成的。当我从流畅的 NH 映射生成 hbm 文件时，这一切都变得清晰起来。

```
<class name="CatalogItem" table="`CatalogItem`" xmlns="urn:nhibernate-
mapping-2.2" optimistic-lock="version">
    ...

    <property name="Name" length="100" type="String">
      <column name="Name" />
    </property>

    ...

    <component name="Manufacturer" insert="false" update="true">
      <property name="Name" length="100" type="String">
        <column name="Name" />
      </property>
    </component>
  </class> 
```

请注意，Name 属性的列和 Manufacturer 组件的列都映射到同一列。这就是导致 ArgumentOutOfRangeException 的原因，因为参数比列名多。我通过明确指定组件映射的列名解决了这个问题：

组件（catalogItem => catalogItem.Manufacturer，m => m.Map（manufacturer => Manufacturer.Name，“制造商”））；

另一个教训。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-29T01:28:42.300

就我而言，我使用 . 将两个属性映射到同一列`Fluent NHibernate`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T20:46:30.827

您`CatalogItem`似乎没有`Price`属性，当您使用`Reveal`帮助器时这似乎很奇怪。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T06:35:52.907

是的，我删除了那个以减少一些噪音。我想我也忘了从映射中删除它。在进行了更多调查后，我注意到它与将制造商映射为组件有关。当我使用普通的旧字符串而不是单独的类时，一切正常。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-22T10:00:41.697

在我的特殊情况下，我在同一个 .NET 属性上添加属性和 ID（使用属性）。这导致了同样的错误。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-05-23T12:21:01.867

老问题，但如果有人遇到和我一样的问题，知道[这个 Fluent Nhibernate 问题（ColumnPrefix 仅应用于 ComponentMap 内的第一个组件映射）](https://github.com/jagregory/fluent-nhibernate/issues/261)可能会给出相同的异常，因为列前缀并不总是适用.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-09-18T07:01:54.497

这个问题的其他答案是正确的。但是还有另一种情况，NHibernate 输出具有不同堆栈跟踪的相同消息。堆栈跟踪可以在这个[问题](https://stackoverflow.com/q/13690785/3383833)中找到。

由于这是我在网上搜索确切错误消息时弹出的首要问题之一，我认为其他人知道我如何修复它会有所帮助。在 NHibernate 的 GitHub 存储库中，有一个针对此错误的记录问题。这是链接 - [https://github.com/nhibernate/nhibernate-core/issues/1319](https://github.com/nhibernate/nhibernate-core/issues/1319)。

在撰写此答案时，该错误已在最新的 NHibernate 中得到修复。对于旧版本，例如 3.1.0（我遇到错误时正在使用的版本），在文件中将`format_sql`属性设置为 false可以解决问题。`nhibernate.config`有关错误和解决方法的更多详细信息可以在 GitHub 问题和[NHibernate 文档](https://nhibernate.info/doc/nhibernate-reference/session-configuration.html)中找到。

# iphone - 从视图控制器中删除一些视图

> ID：600315
> 
> 赞同：1
> 
> 时间：2009-03-01T19:09:43.073
> 
> 标签：iphone, cocoa-touch

我想从我的根视图控制器中删除当前子视图（添加 atIndex:0）并在其位置插入一个新视图。

目前我只能找到显示使用 removeFromSuperView 卸载视图的代码片段，这需要您知道当前加载了哪些 viewcontrollers 视图。

唯一需要注意的另一件事是，我在 rootcontrollers 视图中插入了另一个子视图，我不想卸载它。所以删除任何和所有子视图的代码是不够的

谢谢，

米

```
if(self.firstscr == nil)
    {
        firstscreen *f = [[firstscreen alloc] initWithNibName:@"firstscreenview" bundle:nil];
        self.firstscr = f;
        [f release];
    }

    ///This is my attempt at getting to the currently loaded view :P
  [[self.view subviews atIndex:0].view removeFromSuperView];

    [self.view insertSubview:firstscr.view atIndex:0]; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T21:20:42.510

这是怎么做的（我想通了，是的，我！）

```
if(self.firstscr == nil)
    {
        firstscreen *f = [[firstscreen alloc] initWithNibName:@"firstscreenview" bundle:nil];
        self.firstscr = f;
        [f release];
    }

    //Remove whatever view is currently loaded at index 0, this index is only to be used by "page" views
    UIView *v = [self.view.subviews objectAtIndex:0];
    [v removeFromSuperview];

    [self.view insertSubview:firstscr.view atIndex:0]; 
```

# django - 新手 Django 问题：找不到我以为我在表单中预设的数据

> ID：600317
> 
> 赞同：1
> 
> 时间：2009-03-01T19:12:35.030
> 
> 标签：django

我仍然在掌握 Django，尤其是 Forms。

我创建了 MyForm 子类 forms.Form ，我在其中定义了这样的字段：

所有者 = forms.CharField(widget=forms.HiddenInput)

当我创建表单的一个新的空白实例时，我想用创建者的个人资料预先填写它，我正在这样做：

form = MyForm( {'owner' : request.user.get_profile()} )

我想将表单的所有者字段设置为 request.user 的 ID。（ models.Model*类*中对应“owner”字段的类型为Profile的ForeignKey。）

在呈现表单之前，我需要检查有关所有者的一条信息。所以我尝试访问form.owner，但表单对象似乎没有“所有者”属性。我也尝试过 form.instance.owner，但同样没有运气。

我究竟做错了什么？我误解了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T20:08:17.800

您可以通过表单的数据字典访问此值：

form.data.get('所有者')

# iphone - 如果没有服务，我可以用 iPhone 做什么？

> ID：600318
> 
> 赞同：1
> 
> 时间：2009-03-01T19:12:35.500
> 
> 标签：iphone, ipod-touch

我有兴趣为 iPhone 相机开发软件，但我目前没有 iPhone，也不想为服务付费。如果我只是做一般的应用程序开发，我可能会选择一个 iPod Touch，但 Touch 没有摄像头。

我知道我可以走进 AT&T 商店，购买一部 iPhone，然后立即取消服务。但是我能用得到的 iPhone 做什么呢？我可以吗：

1.  ... 使用原生 SDK 为其开发应用程序？
2.  ... 从应用商店下载应用（通过 wifi）？
3.  ... 将它用于我可以用 iPod Touch 做的所有事情？

更一般地说，这只是出于其他原因的一个坏主意吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-01T19:52:49.083

您可以将其越狱并将其用于非标准计划并支付更少的钱。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-02T05:11:13.097

越狱后你仍然可以在手机上开发。解锁后，您仍然可以在手机上进行开发。区别很重要：

越狱：您可以安装应用商店中没有的应用程序。

解锁：您可以在默认运营商以外的其他网络上运行手机（在美国时为 AT&T）。

请注意，您目前无法解锁运行 2.2.1 的 iPhone 3g，如果您购买新的几乎肯定会解锁。您可以越狱 iPhone 和 iPhone 3G。

另请注意，如果您购买新手机，AT&T 将向您收取 200 美元的费用，以解除您的新合同。我认为每月下降 10 或 20 美元，因此一年后，退出计划的成本要低得多。

What I suggest is buying a first generation iPhone on ebay or craigslist. First generation iPhones can all be unlocked, irrespective of whether the previous owner put 2.2.1 on them. Also they are much cheaper, have the camera and are totally fine for software development. I was able to find decent first generation iPhones in Seattle just 2 months ago for about $250 - $350 dollars depending on details. Unlocking/Jailbreaking takes a matter of minutes with QuickPwn, and the phone works great as a development platform.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T19:32:23.033

我相信您的 iPhone 必须被激活才能在 xcode 中用作目标设备。虽然它会在购买后激活，但如果您取消帐户然后需要在某个时候恢复它，您会遇到问题。

如果您确实希望支持相机，则可以在 iPod Touch 上开发 - 拍照的机制与从库中选择图片相同，您指定源（相机/库），其余由操作系统处理您的代码接收最终图片。

如果您的应用程序将非常以相机为中心，您应该投资一部 iPhone，但如果它是为了次要功能，您可能只需触摸一下即可。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-30T21:48:16.760

> I believe your iPhone must be activated to be used as a target device in xcode. While it would be activated after purchase you would have problems if you cancelled your account and then needed to restore it at somepoint.

No it does not. You can jailbreak to start and it will work fine.

# ssl - 如何保护身份验证但不保护有效负载？

> ID：600329
> 
> 赞同：1
> 
> 时间：2009-03-01T19:18:15.453
> 
> 标签：ssl, hash, http-authentication

我正在寻找用于保护身份验证的现有 HTTP 协议，但不是随后的有效负载。我希望服务器为每个用户存储用户名、散列密码和不同的盐。

HTTP 摘要式身份验证无法满足这些要求，因为所有帐户都使用相同的盐。SSL 失败是因为它加密了整个连接。

**编辑添加：**

*这适用于与 Web 服务对话的桌面客户端（不涉及浏览器）*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-01T19:34:49.673

流行的方案是让登录表单受 SSL 保护，而站点的其余部分不使用 SSL。参见例如流行的社交网站。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T19:22:16.757

OpenID 怎么样？是否有理由必须存储身份验证信息？

编辑添加

抱歉没有发现它是一个桌面应用程序。[OAuth](http://oauth.net/)怎么样？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-01T19:22:23.870

为什么不让您的身份验证机制受 SSL 保护，然后转发到在正常 HTTP 下运行的应用程序的其余部分？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-01T20:30:21.973

有没有办法可以构造原始请求 URL 以指示用户？然后，服务器可以对 HTTP 摘要身份验证响应中的每个用户使用不同的域（充当“盐”）进行响应。例如，请求表单的 URL`http://user.y.com/service`或`http://www.y.com/user/service`会导致质询响应，例如：

```
WWW-Authenticate: Digest realm="user@y.com", nonce="oqa9hvq49krprkphtqc" 
```

* * *

你能解释一下是什么推动了“不加密”的要求吗？如果您受到中间人攻击，您需要保护整个请求的完整性。在那里，SSL 将非常有帮助。如果您绝对不能进行加密，那么使用未加密密码套件的 SSL 是否可以接受？

# visual-studio - Visual Studio 2005：出于未知原因跳过构建？

> ID：600332
> 
> 赞同：4
> 
> 时间：2009-03-01T19:20:09.583
> 
> 标签：visual-studio, visual-studio-2005

我有一个包含许多项目的视觉工作室解决方案。配置管理器经过精心配置，可以构建除一个之外的所有项目（跳过的是测试项目）。在命令行中构建解决方案后，我得到以下信息：

“构建 XXX 调试|x64”

------ 跳过构建：项目：AAA ------

------ 跳过构建：项目：BBB，配置：调试 Win32 ------

未选择为此解决方案配置构建项目

------ 构建开始：项目：CCC，配置：YYY Debug ia64 ------

<这里开始构建>

如您所见，项目 BBB 被跳过，因为它没有在配置管理器中选择，项目 CCC 和其余构建正常，项目 AAA 被跳过，没有给出任何理由。任何人都知道为什么 Visual Studio 可能会无缘无故地跳过项目构建？所有配置名称（XXX、YYY Debug、Debug）和平台（x64 / Win32 / ia64）都在配置管理器中正确配置。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T19:29:44.677

是否选择了项目 AAA 进行配置 Debug|x64 ？

当新下载的解决方案（没有 .soa 文件）具有默认配置到 Itanium 时，我也遇到了同样的情况，因此所有没有它支持的系统都跳过了所有解决方案项目来构建。只有在手动选择 win32 后才能正确构建。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-01T22:30:45.430

使用 MSBUILD.exe 从命令行运行项目并设置日志记录（详细程度）= 详细或诊断的参数。然后你应该让我得到更多的输出，告诉你为什么 msbuild 考虑跳过有问题的那个。例如

msbuild XXXX.csproj /详细：详细

NB。诊断输出非常非常冗长

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T22:37:33.353

Visual Studio 中的正常构建是增量的：如果 Visual Studio 认为没有任何源文件被更改，它将跳过构建项目 - 请注意，它只检查代码文件，而不是资源或其他“东西”。

尝试通过选择`Build|Clean Solution`then进行干净的构建`Build|Rebuild Solution`，看看是否得到相同的结果。

您可能需要手动清理每个项目的构建工件（默认情况下，每个项目目录中的`\Bin\`和`\Obj\`子目录）。

# c# - C#：哪个是用于全局监控多键快捷键的最佳钩子？

> ID：600334
> 
> 赞同：1
> 
> 时间：2009-03-01T19:20:27.710
> 
> 标签：c#

C#：哪个是用于全局监控多键快捷键的最佳钩子？

有 LowLevelKeyboardProc 和 KeyboardProc。我想在 Windows 中全局监视诸如 Alt+Q 之类的组合键，并根据按下的 Alt+Q 执行操作。哪个钩子是最好的选择，我将如何继续检测热键中的所有键当前是否都被按住，而不是在钩子回调中一个一个地监视每个键？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-01T19:42:40.730

你别无选择，WH_KEYBOARD_LL 是唯一可以用 C# 编写的。WH_KEYBOARD 需要编写一个可以注入另一个进程的 DLL。托管代码不可能，CLR 无法正确初始化。

还要考虑 RegisterHotKey()。示例代码[在那里](http://social.msdn.microsoft.com/Forums/en-US/Vsexpressvb/thread/2622427d-1e15-4f30-b01d-57b0ba054f5c/)，您会在页面下方找到 C#。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-01-24T13:47:40.557

正如 Hans Passant 的回答中所述，从技术上讲，除了连接到`WH_KEYBOARD_LL`钩子上之外别无他法。尽管如此，还是有一个托管库[MouseKeyHook 作为 nuget](https://www.nuget.org/packages?q=MouseKeyHook)，它为您提供了一个方便的托管包装器。[github 上的源代码](https://github.com/gmamaladze/globalmousekeyhook)。

最近添加了对检测快捷键、组合键和序列的支持。这是一个使用示例：

```
void DoSomething()
{
    Console.WriteLine("You pressed UNDO");
}

Hook.GlobalEvents().OnCombination(new Dictionary<Combination, Action>
{
    {Combination.FromString("Control+Z"), DoSomething},
    {Combination.FromString("Shift+Alt+Enter"), () => { Console.WriteLine("You Pressed FULL SCREEN"); }}
}); 
```

有关更多信息，请参阅：[检测键组合和序列](https://github.com/gmamaladze/globalmousekeyhook/blob/vNext/keycomb.md)

# asp.net-mvc - 如何将控制器和相关视图放在 ASP.NET MVC 中的单独文件夹中

> ID：600344
> 
> 赞同：0
> 
> 时间：2009-03-01T19:25:32.520
> 
> 标签：asp.net-mvc

我想将所有具有相关视图的控制器分组在单独的文件夹中。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-02T01:46:28.347

1.  不。
2.  但如果必须，编写一个自定义 ViewEngine 来定位视图。[我在这里](http://blogs.teamb.com/craigstuntz/2008/07/31/37827/)写了一个（现在已经过时的）示例。ViewLocator 已重命名为 ViewEngine。
3.  见（1）

更新：如果您实际上是在寻找“区域”功能，请试试[这个](http://blog.codeville.net/2008/11/05/app-areas-in-aspnet-mvc-take-2/)。

# c# - 使用 OpenFileDialog 作为目录，而不是 FolderBrowserDialog

> ID：600346
> 
> 赞同：13
> 
> 时间：2009-03-01T19:26:19.537
> 
> 标签：c#, wpf, windows, winforms

我想在我的应用程序中有一个文件夹浏览器，但**我**不想使用 FolderBrowserDialog。（有几个原因，比如使用起来很痛苦）

我想使用标准的 OpenFileDialog，但针对目录进行了修改。

例如，[µTorrent](http://utorrent.com/)有一个很好的实现（Preferences/Directories/Put new downloads in:)。标准的打开文件对话框使用户能够：

*   在底部的文本字段中粘贴完整路径
*   在 Vista 上使用“收藏链接”栏
*   在 Vista 上使用搜索
*   自动记住最后一个目录
*   更多的...

有人知道如何实施吗？在 C# 中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-01-04T01:25:42.017

我不确定 uTorrent 但这听起来很像带有 FOS_PICKFOLDERS 选项的新 Vista 的[IFileDialog 。](http://msdn.microsoft.com/en-us/library/windows/desktop/bb775966%28v=vs.85%29.aspx)它的通用 C# 代码将类似于：

```
var frm = (IFileDialog)(new FileOpenDialogRCW());
uint options;
frm.GetOptions(out options);
options |= FOS_PICKFOLDERS;
frm.SetOptions(options);

if (frm.Show(owner.Handle) == S_OK) {
    IShellItem shellItem;
    frm.GetResult(out shellItem);
    IntPtr pszString;
    shellItem.GetDisplayName(SIGDN_FILESYSPATH, out pszString);
    this.Folder = Marshal.PtrToStringAuto(pszString);
} 
```

完整的代码可以在[这里](http://www.jmedved.com/2011/12/openfolderdialog/)找到。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-06-16T13:37:31.727

[WindowsAPICodePack](https://www.nuget.org/packages/WindowsAPICodePack/1.1.0)

```
var dlg = new Microsoft.WindowsAPICodePack.Dialogs.CommonOpenFileDialog();
dlg.IsFolderPicker = true; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-06-09T15:13:03.830

请参阅[leetNightShade的](https://stackoverflow.com/users/353094/leetnightshade)[此答案](https://stackoverflow.com/a/15456640/117870)以获取有效的解决方案。

我相信有三件事使这个解决方案比其他所有解决方案都好得多。

1.  **使用简单。** 它只需要您在项目中包含两个文件（无论如何都可以合并为一个）。
2.  在 XP 或更旧的系统上使用时，它会退回到标准的[FolderBrowserDialog 。](http://msdn.microsoft.com/en-us/library/system.windows.forms.folderbrowserdialog.aspx "FolderBrowserDialog 类 (System.Windows.Forms)")
3.  作者允许将代码用于您认为合适的任何目的。

    > 没有许可证，您可以随意获取和使用代码。

[在此处](http://www.lyquidity.com/devblog/?p=136 ".NET Win 7 风格的文件夹选择对话框")下载代码。

# security - URL检索服务的最佳实践？如何避免成为攻击媒介？

> ID：600349
> 
> 赞同：4
> 
> 时间：2009-03-01T19:27:01.830
> 
> 标签：security, webproxy

我正在修改一个网络工具，给定一个 URL，它将检索文本并为用户提供有关内容的一些统计信息。

我担心为用户提供一种从我的盒子向网络上任意 URL 发起 GET 请求的方法可能会成为攻击的载体（例如 to `http://undefended.box/broken-sw/admin?do_something_bad`）。

有没有办法将这种风险降到最低？提供公共 URL 检索能力时有什么最佳实践吗？

我想过的一些想法：

*   尊重`robots.txt`
*   仅接受或拒绝某些 URL 模式
*   检查适当网站的黑名单/白名单（如果存在这样的事情）
*   通过知名的第 3 方的公共网络代理工作，假设他们已经内置了这些保护措施

谢谢你的帮助。

编辑：它将仅评估 HTML 或文本内容，而不下载或评估链接脚本、图像等。如果是 HTML，我将使用 HTML 解析器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-01T19:57:48.963

统计数据是否*仅*与文档中的文本有关？您打算使用 HTML 解析器对其进行评估吗？

如果只是您要分析的文本，即不下载更多链接、评估脚本等，那么风险就不那么严重了。

通过防病毒程序传递您下载的每个文件可能不会有什么坏处。您还应该将 GET 限制为某些内容类型（即不要下载二进制文件；确保它是某种文本编码）。

# autocomplete - 我需要自动完成文本输入的城市列表和相应的时区

> ID：600359
> 
> 赞同：2
> 
> 时间：2009-03-01T19:33:38.570
> 
> 标签：autocomplete

我在哪里可以找到城市/时区数据来填充我的自动完成文本输入。

文本输入将用于输入城市，然后在幕后我将使用城市来获取时区......

我宁愿将它保存在应用程序本身中，而不是实时获取它。

这将适用于 iphone 应用程序。

谢谢，

米

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-01T20:05:42.533

如果您在资源文件夹中下载 windows mobile SDK 是两个包含城市和时区信息的 csv 文件。这些文件可以免费重新分发。

[http://msdn.microsoft.com/en-us/library/aa458853.aspx](http://msdn.microsoft.com/en-us/library/aa458853.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-01-17T12:37:30.787

如果您需要地球上**任何**城市/城镇的此信息，则需要使用网络服务；没有这样的清单。查看这篇文章以获得一些建议：[Web 服务 - 一个城市的当前时区？](https://stackoverflow.com/questions/55901/web-service-current-time-zone-for-a-city)

我看不到上面提到的 csv，但是，如果你在一个时区和该区域内的几个相关城市之后，PHP 有一个[DateTimeZone 类](http://uk.php.net/manual/en/class.datetimezone.php)

这将返回像这样的所有标识符：

```
$data = DateTimeZone::listIdentifiers(); 
```

# gold-parser - GOLD Parse，您如何实际实现您的代码？

> ID：600366
> 
> 赞同：2
> 
> 时间：2009-03-01T19:36:50.340
> 
> 标签：gold-parser

我不太确定如何在生成骨架后实现我的代码。我没有只使用 const，我确实有主文件，并且我尝试了几个 c(++) 版本以及 c#，但我仍然不明白。我不认为他们中的任何一个都可以加载文件并解析测试文件（我知道黄金生成器可以解析我的测试文件）。

Kessels C 骨架看起来很完整。但不是，它使用结构和成员（Token->Reduction->TokenStack）但是当我搜索 TokenStack 时，我找不到定义它的地方，只能使用。我觉得我错过了什么。我在任何地方都找不到 Kessels 的其他代码。

我的问题是我如何实现我的身体？（有没有你更喜欢的骨架），还有其他我忽略的下载吗？我尝试查看这些下载，但我不明白如何处理它们。它看起来更像是示例源代码，然后是模板[http://www.devincook.com/goldparser/engine/c/index.htm](http://www.devincook.com/goldparser/engine/c/index.htm)

PS：我不介意做一个 C# 实现，我用 c(++) 更好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-03T12:47:46.580

我使用了[Calitha C# Engine](http://www.devincook.com/goldparser/engine/c-sharp/index.htm)。如果您仍然需要答案，请告诉我（通过对此答案发表评论），我可以使用我对该 C# 引擎的知识来回答。

> 我的问题是我如何实现我的身体？（有没有你更喜欢的骨架），还有其他我忽略的下载吗？

Calitha Engine 下载包括引擎的源代码和一个示例程序（名为“TextCalc”），它说明了如何使用它。

# asp.net-mvc - 注册模型绑定器

> ID：600367
> 
> 赞同：0
> 
> 时间：2009-03-01T19:37:26.453
> 
> 标签：asp.net-mvc, modelbinders

我刚刚从 beta 产品更新到 RC1 MVC。

我的 Application_start 中有以下代码（在 global.ascx 中）

```
System.Web.Mvc.ModelBinders.Binders[typeof(Shared.DO.Gig)] = new GigModelBinder(); 
```

这导致以下异常....

> 找不到方法：System.Collections.Generic.IDictionary`2 System.Web.Mvc.ModelBinders.get_Binders()'。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-01T20:52:57.833

您是否重新构建了项目。Binder 是 ModelBinderDictionary，它不是 IDictionary，很可能是在 RC1 之前。

# css - CSS 中的像素 (px) 是什么？

> ID：600374
> 
> 赞同：17
> 
> 时间：2009-03-01T19:42:36.597
> 
> 标签：css, graphics

我正在阅读一本 ASP.NET 书籍，它引用了 CSS 文件并讨论了像素。但我从来没有从分辨率、布局等角度理解它。例如，CSS 文件定义中的以下内容是什么意思？

```
#header
{
    padding: 0px;
    margin: 0px;
} 
```

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-02T00:22:42.603

这有点超出您目前的位置，但 CSS 像素*不一定*与显示器上的单个像素大小完全相同。根据[规范](http://www.w3.org/TR/CSS21/syndata.html#pixel-units)：

> 如果输出设备的像素密度与典型的计算机显示器的像素密度有很大不同，用户代理应该重新调整像素值。建议参考像素为像素密度为96dpi、距离阅读器一臂远的设备上一个像素的视角。

因此，如果您拥有一种不属于“典型”的极其昂贵的超高分辨率显示器，浏览器和/或操作系统可能会选择重新定义“像素”是什么。

就 CSS 创作而言，'px' 的有用定义是：'px' 是等于未缩放的 HTML <img> 或 CSS 'background-image' 中的像素的长度量。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-01T19:55:03.777

像素通常被认为是数字图像的最小单个组件。

图像中的像素数称为分辨率。

屏幕分辨率是屏幕可以显示的每个维度中不同像素的数量。

在您发布的 css 片段中，您将 0 像素的边距和填充应用于 id="header" 的元素。

[![](https://i.stack.imgur.com/r7uWo.gif)](https://i.stack.imgur.com/r7uWo.gif)
[（来源：[functionx.com](http://www.functionx.com/win32/images/pixel1.gif)）]

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-01T21:34:35.657

“[像素不是小方块](http://alvyray.com/Memos/CG/Microsoft/6_pixel.pdf)”很好地讨论了像素是什么。

它可能与您的特定问题无关，但如果其他人发现此线程与计算机图形相关的问题，这是很好的阅读。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-01T19:46:30.520

这意味着一个尺寸，以屏幕上的像素为单位。例如

```
width: 200px; 
```

表示一个元素是 200 像素宽。

像素是“图片元素”，意思是屏幕上的一个彩色点，可能很像这句话末尾的句号。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-01T19:45:17.933

[像素](http://en.wikipedia.org/wiki/Pixel)是屏幕上的一个点。您的示例设置命名的元素`header`没有填充或边距。要理解这一点，您还需要了解页面布局的[CSS 框模型](http://www.w3.org/TR/CSS2/box.html)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-01T20:58:44.730

正如其他人所说，像素只是一个与数据电子显示直接相关的可测量单位——单个像素是屏幕上物体的最小尺寸。屏幕分辨率越大，它可以表示的像素就越多。

关于给出的示例的注释 - 0px 的值实际上不需要作为零值，并且在 CSS 中更好地表示为 0（它同样可以是 0% 或 0em，它们的含义都相同）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-01T19:57:18.340

至少就 CSS 而言，像素是一个度量单位。还有pt，em，百分比……还有其他几个。每个人都有自己的长处。

[W3schools](http://www.w3schools.com/)充满了参考资料，请查看[CSS](http://www.w3schools.com/css/default.asp)上的参考资料。

我建议下载 Firebug 并尝试更改像素宽度/高度。

# python - 使用 urllib.open 时出现 Python 错误

> ID：600389
> 
> 赞同：25
> 
> 时间：2009-03-01T19:56:54.877
> 
> 标签：python, urllib

当我运行这个：

```
import urllib

feed = urllib.urlopen("http://www.yahoo.com")

print feed 
```

我在交互式窗口（PythonWin）中得到这个输出：

```
<addinfourl at 48213968 whose fp = <socket._fileobject object at 0x02E14070>> 
```

我期待获得上述 URL 的来源。我知道这在其他计算机（比如学校的计算机）上也有效，但这是在我的笔记本电脑上，我不确定这里有什么问题。另外，我根本不理解这个错误。这是什么意思？添加信息？fp? 请帮忙。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-03-01T20:00:08.600

尝试这个：

`print feed.read()`

[在此处](http://docs.python.org/library/urllib.html)查看 Python 文档。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-01T20:00:35.120

urllib.urlopen 实际上返回一个类似文件的对象，以便检索您需要使用的内容：

```
import urllib

feed = urllib.urlopen("http://www.yahoo.com")

print feed.read() 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-01T22:11:58.830

在 python 3.0 中：

```
import urllib
import urllib.request

fh = urllib.request.urlopen(url)
html = fh.read().decode("iso-8859-1")
fh.close()

print (html) 
```

# performance - 以下约束的最佳数据结构？

> ID：600395
> 
> 赞同：6
> 
> 时间：2009-03-01T20:00:22.483
> 
> 标签：performance, language-agnostic, optimization, data-structures

以下是我需要的数据结构的一些限制。似乎没有一个常见的数据结构（我将在下面提到我想到的那些）适合所有这些。谁能推荐一个我可能没有想到的？

1.  我需要能够通过无符号整数键执行查找。
2.  要存储的项目是用户定义的结构。
3.  这些索引将是稀疏的，通常非常稀疏。常规数组已出。
4.  每个索引的频率将具有非均匀分布，小索引比大索引更频繁。
5.  N 通常很小，可能不大于 5 或​​ 10，但我不想过分依赖它，因为它有时可能会大得多。
6.  常数项很重要。当 N 很小时，我需要非常快速的查找。我已经尝试过通用哈希表，根据经验，它们太慢了，**即使 N=1，也意味着没有冲突**，可能是因为涉及的间接数量。但是，我愿意接受有关利用提到的其他约束的专用哈希表的建议。
7.  只要检索时间快，插入时间**并不重要。**即使 O(N) 插入时间也足够好。
8.  空间效率并不是非常重要，尽管重要的是不要只使用常规数组。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-01T20:04:44.313

当 N 较小时，使用键 + 值作为有效负载的简单数组或单链表*非常*有效。即使N变大时不是最好的。

你得到 O(N) 查找时间，这意味着查找需要`k * N`时间。AO(1) 查找需要固定`K`时间。因此，您可以使用 O(N) for 获得*更好*的性能`N < K/k`。这里`k`非常小，因此您可以获得有趣的 N 值。请记住，大 O 表示法仅描述*大* `N`s 的行为，而不是您所追求的。对于小桌子

```
void *lookup(int key_to_lookup)
{
  int n = 0;
  while (table_key[n] != key_to_lookup)
    n++;
  return table_data[n];
} 
```

可能很难被击败。

对哈希表、平衡树和简单数组/链表进行基准测试，看看它们在 N 的哪个值开始变得更好。然后你就会知道哪个更适合你。

我差点忘了：将经常访问的键放在数组的开头。鉴于您的描述，这意味着保持排序。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-01T20:39:11.733

该建议假设现代 CPU 具有：

*   快速缓存
*   与时钟速度相比，内存延迟要慢得多。
*   合理的分支预测（在最新的桌面/服务器处理器中真的很神奇）

我建议混合结构很可能胜过单一结构。

如前所述，使用基于简单数组的键值对和 O(N) 访问，但常数因子非常低，缓存行为非常好。这个初始结构应该很小（可能不大于 16 和可能 8 个值）以避免超出单个高速缓存行。遗憾的是，您需要自己调整一个参数。

一旦超过该数字，您将希望退回到具有更好 O(N) 行为的结构，我建议您尝试使用一个像样的哈希表，因为这在 16 到数千范围内可能是合理的，如果您倾向于更频繁地查找相似的值将倾向于停留在更快的缓存中。

如果您还*删除*和插入，则必须注意不要在两种状态之间来回颠簸。要求计数缩小到“升级”到二级结构的截止值的一半应该可以防止这种情况发生，但请记住，任何确定性的交叉行为都容易受到最坏情况下的行为输入的影响。
如果您试图防御恶意输入数据，这可能是一个问题。如果是这样，在决策中使用随机因素可以防止它发生。不过，您可能并不关心这一点，因为您没有提及它。

如果您愿意，可以尝试对初始主数组进行排序，允许进行 O(log(N)) 的二进制搜索，但代价是更复杂的搜索代码。我认为简单的数组遍历实际上会击败它，但是您可能希望针对不同的 N 值对此进行基准测试，它可能允许您更长时间地坚持使用主数组，但我认为这是大小的函数缓存行大小大于 O(N) 行为。

其他选项包括：

*   以不同的方式处理所有 < 256 的键值并将它们存储在字节`->`结构数组对中，从而节省键空间（并可能在切换到二级结构时允许它们保留在那里），由于需要解压缩，这可能会导致性能不佳动态数组到本机字长。
*   使用类似 trie 的结构在密钥的时间执行一个字节。我怀疑它的复杂性会使其在实践中表现良好

我将再次重复 kmkaplan 的非常好的建议。对它进行基准测试，彻底避免微基准测试。在这种分析中，实数可能与理论惊人地不同......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-01T20:11:00.913

哈希表查找的速度几乎可以达到：

它与常规数组查找的唯一区别是哈希的计算和（如果您的哈希函数足够好，或者您在插入期间花费足够的时间来生成最佳哈希函数，这将使您的插入花费 O(N) ) 然后本质上是一个数组查找。

本质上，因为它可能会发生（除非您使用最佳散列函数），您必须重新散列或遵循一个非常小的链表。

由于用于哈希表的大多数哈希函数都是 k*c_1 % c_2，因此在相当稀疏和/或最佳哈希表中查找数组的区别在于一个间接、两个乘法、一个减法和一个除法（一种有效的模实现使用 cpus 功能可能会通过减法和乘法来减少它）和数组查找。

它根本不会比这更快。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-01T20:10:02.727

您可能会尝试结合两全其美：如果键很小，则将其放入类似数组的数据结构中，该结构不会比预定义的最大键大。如果密钥很大，请将其放入哈希表中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-01T23:28:17.943

对于所描述的问题，我能看到的唯一解释是哈希函数太复杂了。我倾向于采用两阶段方法：

1）对于小键，一个简单的指针数组。没有哈希或任何东西。

2）对于大于您分配的表大小的键：

一个非常简单的散列函数将分散聚集的键怎么样：

左序 5 位（我假设是 32 位整数。如果是 64 位，则再加一位。）是实际包含数据的位数，其余的只是总和（丢弃进位）原始密钥切成块，无论您为此目的使用多少位，然后加在一起。

请注意，可以部分预先计算有效位的数量——建立一个 64k 的高位值表。如果高位字不为零，则将其用作表的索引并加16，否则将低位字用作索引。对于 64 位整数，您显然必须使用 4 步而不是 2 步。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-01T23:34:36.523

您可以考虑[Judy Arrays](http://judy.sourceforge.net/)：

> Judy 是一个 C 库，提供了实现稀疏动态数组的最先进的核心技术。Judy 数组简单地用一个空指针声明。Judy 数组仅在填充时才消耗内存，但如果需要，它可以增长以利用所有可用内存...... Judy 可以替换许多常见的数据结构，例如数组、稀疏数组、哈希表、B 树、二叉树、线性列表、跳过列表、其他排序和搜索算法以及计数函数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-02T08:49:19.843

我会在这里推荐一个[跳过列表](http://en.wikipedia.org/wiki/Skip_list)。如果你喜欢的话，java.util.concurrent 包有一个很好的实现。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-01T20:14:14.213

我会考虑使用自平衡二叉树而不是简单的链接来处理哈希冲突的哈希表。您应该能够对所有键进行 O(1) 分期查找和 O(logN) 的最坏情况查找。由于您的密钥分布是倾斜的，因此您可能会与索引值较低的冲突，并且树查找将在那里真正得到回报。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-01T22:51:39.297

如果您的 N 通常很小，您可以尝试使用二次探测而不是单独链接的开放寻址哈希。如果您遇到罕见的 N 情况会溢出它，您需要从 32 的初始大小重新分配到更大的宽度。如果您可以使整个结构适合几个缓存行，线性探测或布谷鸟哈希将为您提供良好的性能。

老实说，我很惊讶即使是标准的哈希表也会给你带来如此糟糕的性能。也许您可以对其进行剖析以查看导致它如此缓慢的原因——如果它是哈希函数本身，请使用一个简单的函数，例如二的幂模（例如，key & (N-1) 其中 N 已知为 2^x)，这将有利于以 0 为中心的分布。如果是追逐单独链的 dcache 未命中，请编写一个实现，将每个存储桶中的前四个元素存储在存储桶本身中，以便您至少快速获取它们。N=1 有多慢？

我会将指向结构的指针而不是结构本身存储在存储桶链中：如果结构很大，那么遍历它们的链将有很多缓存未命中。另一方面，您可以在单个缓存行上放置大约 16 个键/指针对，并且只有在找到正确元素时才为未命中付费。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-02T00:15:25.350

这是散列函数的一般概念。你说插入可能很昂贵。

散列键，它是一个整数，具有简单的模数，与散列表的每个实例一起存储

如果插入会导致冲突，请通过计算合理范围内每个模数可能发生的冲突次数来重新优化哈希表，例如，通过某个常数倍数计算地图中的元素数。

显然，如果您最小化分配，您的插入实际上会变得非常昂贵，大约为 O(n^2)，但是您可能能够通过单个整数除法和单个指针间接实现查找，并且您知道，因为您在插入时间，最坏情况的查找将是什么。

# vhdl - 显示 ASCII 字符的计数器输出

> ID：600399
> 
> 赞同：1
> 
> 时间：2009-03-01T20:03:06.003
> 
> 标签：vhdl

我有以下代码可以计算到 59。它开始时很好，但在 31 之后，开始显示 ASCII 字符，如 '('、'$'、'#' 等，而不是数字。知道我哪里出错了?

```
LIBRARY ieee;
USE ieee.std_logic_1164.all;
USE ieee.numeric_std.all;

entity counter is 
    port(clk: IN STD_LOGIC;
         secs:OUT INTEGER RANGE 0 to 59);
end counter;

architecture counter_behav of counter is
signal countSVal: INTEGER RANGE 0 to 59:=0;
begin

process(clk)
begin
if(rising_edge(clk)) then
    if(countSVal>=59) then
        countSVal <= 0;     
    else
        countSVal <= countSVal + 1;     
    end if;
    secs <= countSVal;
end if;
end process;
end counter_behav; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T16:57:24.097

由于您没有打印任何内容，因此我假设您正在波形查看器中查看此内容。将显示的类型设置为整数，您可能会像 AnthonyWJones 所说的那样将其设置为 ASCII。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T20:10:16.983

我不知道 vhdl 是什么，但是，您用来观察输出的东西似乎最有可能**没有**向您显示 32 之前的 ASCII 字符，因为那些将是控制字符，所以它只是妥协并向您显示它们的值. 由于 32 及以上是可打印字符，因此它会切换到使用这些字符，因为这就是工具认为的值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-21T14:42:39.693

插入附加信号：

```
signal my_char: character; 
```

然后进行从整数到字符的转换：

```
my_char <= character'val(countSVal); 
```

在调试器或波形查看器中检查 my_char 信号，您将看到 ASCII 字符。我已经用 Aldec Active-HDL 6.1 对其进行了检查。

# c++ - 数据库结构和硬盘寻道时间混乱

> ID：600400
> 
> 赞同：3
> 
> 时间：2009-03-01T20:03:25.440
> 
> 标签：c++, hardware, hard-drive

有人可以帮助我了解硬盘搜索的工作原理吗？

我有一个小的二进制数据库文件，它的读取性能是绝对必要的。如果我需要跳过文件中的几个字节，使用 seek() 还是 read() 会更快，然后丢弃不需要的数据。

如果硬盘的平均寻道时间为 10ms，读取速度为 300MB/s，我计算出 read() 比值小于 3MB 的 seek() 更快。是真的？执行新搜索时是否有开销，而读取现有流没有？

您认为哪种文件结构更适合索引。

```
Entry1:Value:PointerIntoToData
Entry2:Value:PointerIntoToData
Entry3:Value:PointerIntoToData
Data, Data, Data

Or

Entry1:Value:Data
Entry2:Value:Data
Entry3:Value:Data 
```

读取条目时，如果值不正确，它将被忽略。因此，当流式传输文件时，它更快： 1\. 当不需要条目时使用 seek() 跳过它 2\. 当不需要条目时读取它然后丢弃数据 3\. 或使用第一个结构，当最后需要将 seek() 输入到数据存储库中。

条目是 4 个字节，值是 8 个字节，数据是 12KB

干杯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-01T21:19:18.720

所有*seek*系统调用所做的就是改变文件中下一次读取的位置。它不移动驱动头。当读取或写入数据时，驱动器磁头会移动，并且您无法直接控制操作系统接下来会做什么。

读取大量不需要的数据会产生影响，因为所有读取的数据都需要操作系统缓冲区中的空间，并导致旧数据被丢弃。因此，对大文件使用搜索将减少文件系统缓存的混乱。

* * *

我在下面写的所有内容都假设您无法将整个数据库放入内存中。如果可以，就这样做。阅读所有内容并尝试在文件末尾附加新的和更改的数据。不要担心浪费空间，只是偶尔做一些压缩。

* * *

如果您的数据库太大：

数据以块（或页）的形式读取和写入物理驱动器。同样，操作系统中磁盘 IO 的基本单位是页。如果操作系统从磁盘缓存数据，它也在整个页面中。因此，考虑是否需要使用 seek 或 read 向前移动几个字节是没有意义的。如果你想让它变得更快，你需要考虑磁盘 IO 的真正工作原理。

首先，nobugz 已经提到，参考的位置。如果您在每个操作中使用的数据在文件中的位置很接近，那么您的操作系统将需要读取或写入更少的页面。另一方面，如果您传播数据，则需要一次读取或写入许多页面，这总是很慢。

至于索引的数据结构。通常它们被组织为[B-trees](http://en.wikipedia.org/wiki/B-tree)。它是一种数据结构，专门用于通过分页读取和写入有效地搜索存储在内存中的大量数据。

两种组织数据的策略都在实践中使用。例如，MS SQL Server 默认以第一种方式存储数据：数据单独存储，索引仅包含来自索引列的数据和文件中数据行的物理地址。但是，如果您定义聚集索引，那么所有数据都将存储在该索引中。所有其他索引将通过聚集索引键而不是物理地址指向数据。第一种方法更简单，但如果您经常基于聚集索引扫描数据范围，则另一种方法可能更有效。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-01T20:21:24.617

寻求访问权有多“绝对必要”？您是否使用非最佳解决方案测试了您的应用程序？在该测试期间，您是否进行了基准测试以确定**真正的**瓶颈在哪里？如果你没有，你会对结果感到惊讶。

接下来，尝试不同的方法并比较运行时间。在不同的系统负载下进行测试（即，当系统空闲时（除了您的应用程序）和忙碌时）。

考虑到当一个新的、更快的硬盘具有不同的内部优化时，您基于当前硬盘的优化可能会变得不正确，从而将您的工作抛到窗外。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-01T20:25:42.267

顺序读取总是比需要磁头查找（而不是位置查找）的读取要快。用于顺序读取的典型硬盘驱动器性能为 50-60 MB/秒，寻找将其降至最坏情况下约 0.4 MB/秒。一旦驱动头被定位，您基本上可以免费获得气缸中的数据。文件系统缓存通过从柱面预读取扇区来利用这一点。

但是，您无法控制数据在磁盘柱面上的位置。您也无法猜测驱动器的几何形状。请注意，当卷碎片化时，吞吐量会随着时间的推移而显着变差。您需要通过在内存中缓存数据来寻找性能。那时，您担心[参考的位置。](http://en.wikipedia.org/wiki/Locality_of_reference)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T02:30:18.847

您始终可以将文件映射到内存中，然后通过指针等访问它。这通常会使您的访问更简单*、*更快捷。

# python - *完美* Python 调试器有哪些特性？

> ID：600401
> 
> 赞同：2
> 
> 时间：2009-03-01T20:04:20.243
> 
> 标签：python, ide, debugging

请告诉我您希望当前的 Python 调试器具有哪些功能。我正在创建一个新的 Python IDE/调试器，并期待着挑战请求！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-01T20:23:28.747

原谅我无耻的函数式编程插件，但是......

*后退*的能力。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-01T20:50:13.860

我使用[winpdb](http://winpdb.org/)，我非常喜欢它。我认为一个新的调试器至少需要具备它的特性。虽然它有一些 GUI 麻烦，所以也许你修复它或从中获取一些想法来编写你自己的。

[Winpdb](http://winpdb.org/)是一个**独立于平台**的图形化 GPL Python 调试器，支持网络远程调试、多线程、命名空间修改、嵌入式调试、加密通信，比 pdb 快 20 倍。

特征：

*   GPL 许可证。Winpdb 是免费软件。
*   与 CPython 2.3 到 2.6 和 Python 3000 兼容
*   与 wxPython 2.6 到 2.8 兼容
*   独立于平台，并在 Ubuntu Gutsy 和 Windows XP 上测试。
*   用户界面：rpdb2 是基于控制台的，而 winpdb 需要 wxPython 2.6 或更高版本。

[![截屏](https://i.stack.imgur.com/epmmm.jpg)](https://i.stack.imgur.com/epmmm.jpg)
[（来源：[winpdb.org](http://winpdb.org/images/screenshot_winpdb_small.jpg)）]

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-01T20:22:05.443

对我来说，#1 的调试功能（我当前的 IDE，Wing 恰好有）是能够在断点处放入 python 解释器并运行任意 python 代码。让我想起了以前使用 Smalltalk。

在局部范围内执行代码的能力非常有用，尤其是与在 C++ 中工作相比，有时检查局部变量可能是一场斗争。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-06-14T11:35:50.887

能够像在 Thonny ( [http://thonny.org](http://thonny.org) )中那样逐步完成表达式评估和调用堆栈的直观可视化

# php - Zend Framework PDF 生成 unicode 问题

> ID：600420
> 
> 赞同：3
> 
> 时间：2009-03-01T20:13:14.060
> 
> 标签：php, zend-framework, pdf, unicode, utf-8

我在使用 Zend Framework 的 PDF 时遇到问题

当我创建 PDF 文件时，我需要使用 UTF-8 作为编码。这是我用来生成简单 pdf 文件的代码。我总是显示这个错误。它没有在 pdf 文件中看到“Faktúra”，而是给了我“Faktú”而不是在 pdf 文件中看到“Dodávateľ:”，而是给了我“Dodáva”

```
$pdf = new Zend_Pdf();    
$pdf->pages[] = ($page1 = $pdf->newPage('A4'));    
$font = Zend_Pdf_Font::fontWithPath('C:\WINDOWS\Fonts\TIMES.TTF');    
$page1->setFont($font, 20);    
$page1->drawText('Faktúra', 40, 803, 'UTF-8');    
$page1->drawText('Dodaváteľ:', $width_left, $height, 'UTF-8'); 
```

所以我尝试从 Windows 目录加载字体

```
$font = Zend_Pdf_Font::fontWithPath('C:\WINDOWS\Fonts\TIMES.TTF'); 
```

但这给了我错误：

> 致命错误：未捕获的异常 'Zend_Pdf_Exception' 带有消息 'Insufficient data to read 2 bytes'

这真的让我发疯，我相信你们中的一些人会对我有一点提示：）解决错误将是最好的解决方案......

非常感谢提前

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-11T13:17:48.467

尝试使用**utf8_decode()**

例如：

```
$pdf = new Zend_Pdf();    
$pdf->pages[] = ($page1 = $pdf->newPage('A4'));    
$font = Zend_Pdf_Font::fontWithPath('C:\WINDOWS\Fonts\TIMES.TTF');    
$page1->setFont($font, 20);    
$page1->drawText(utf8_decode('Faktúra'), 40, 803, 'UTF-8');    
$page1->drawText(utf8_decode('Dodaváteľ:'), $width_left, $height, 'UTF-8'); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T21:25:21.063

您是否将 php 源文件保存为 UTF-8？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-03T12:40:19.177

Zend pdf 功能还不是很复杂。在[http://www.starmind.com](http://www.starmind.com)我们使用基于[fpdf](http://www.tecnick.com/public/code/cp_dpage.php?aiocp_dp=tcpdf)的 tcpdf 。两者都可以免费使用。

# character-encoding - 存储需要翻译的资源文本文件的首选编码是什么？

> ID：600427
> 
> 赞同：2
> 
> 时间：2009-03-01T20:18:04.797
> 
> 标签：character-encoding

为什么？

你遇到了什么字符编码问题，你是如何解决的？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-01T20:40:39.797

UTF-8 应该是最好的选择。将适用于所有语言，并且在应用程序中得到很好的支持。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-01T20:21:38.750

翻译意味着您希望添加其他语言的资源文本文件，这意味着您将希望使用某种形式的 unicode。使用 Windows，您可能会决定使用 UTF16，尽管 UTF8 也很常见。

# c++ - 为字符缓冲区实现 istream get？

> ID：600428
> 
> 赞同：1
> 
> 时间：2009-03-01T20:19:26.167
> 
> 标签：c++, stream

我想实现以下有一个字符缓冲区，我试图移植的代码将此字符缓冲区放在一个流中，然后像这样

```
 char *buffer; //this is initialized
 int bufferSize;  //this is initlized
 std::istringstream inputStream (std::string(buffer, bufferSize));
 int getVal = inputStream.get(); 
```

编辑：上面的代码是最优的，其中对于 getVal 你将整个缓冲区复制到一个流中，然后在流上做一个 get 。

如何从缓冲区本身获取 getVal 值。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T21:01:03.693

我不相信它是最优的，仅仅因为构造一个 std::string 可能会导致整个缓冲区的副本。然而，istingstream 的用法看起来不错。

要直接从缓冲区中获取，您可以执行以下操作：

```
int bufferPos = 0;

char getFromBuffer ()
{
  if (bufferPos < bufferSize)
  {
    return buffer[bufferPos++];
  }
  else
  {
    return 0;
  }
} 
```

不过，您可能希望为此提供更好的界面。也可能有一种更好的方法来构造带有 char* 的 istringstream，但我在快速浏览文档时没有看到。

# css - CSS 隐藏 INPUT BUTTON 值文本

> ID：600438
> 
> 赞同：53
> 
> 时间：2009-03-01T20:25:19.227
> 
> 标签：css, internet-explorer, drupal, input, transparency

我目前正在`<input type='button'/>`使用以下 CSS 设置元素的样式：

```
background: transparent url(someimage);
color: transparent; 
```

我希望按钮显示为图像，但我不希望`value`文本显示在其顶部。正如预期的那样，这适用于 Firefox。但是，在 Internet Explorer 6 和 Internet Explorer 7 上，我仍然可以看到文本。

我尝试了各种技巧来隐藏文本，但没有成功。是否有使 Internet Explorer 正常运行的解决方案？

（我被限制使用`type=button`，因为这是一个 Drupal 表单，它的表单 API 不支持图像类型。）

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-06-22T11:21:34.947

我用

```
button {text-indent:-9999px;}
* html button{font-size:0;display:block;line-height:0}  /* ie6 */
*+html button{font-size:0;display:block;line-height:0}  /* ie7 */ 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-04-03T20:15:31.247

我遇到了相反的问题（在 Internet Explorer 中工作，但在 Firefox 中没有）。对于 Internet Explorer，您需要添加左填充，对于 Firefox，您需要添加透明色。所以这是我们针对 16px x 16px 图标按钮的组合解决方案：

```
input.iconButton
{
    font-size: 1em;
    color: transparent; /* Fix for Firefox */
    border-style: none;
    border-width: 0;
    padding: 0 0 0 16px !important; /* Fix for Internet Explorer */
    text-align: left;
    width: 16px;
    height: 16px;
    line-height: 1 !important;
    background: transparent url(../images/button.gif) no-repeat scroll 0 0;
    overflow: hidden;
    cursor: pointer;
} 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-06-22T08:37:09.070

好：

`font-size: 0; line-height: 0;`

为我工作真棒！

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-01T20:39:46.897

您是否尝试过将 text-indent 属性设置为 -999em 之类的？这是“隐藏”文本的好方法。

或者您可以将字体大小设置为 0，这也可以。

[http://www.productivedreams.com/ie-not-intepreting-text-indent-on-submit-buttons/](http://www.productivedreams.com/ie-not-intepreting-text-indent-on-submit-buttons/)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-01T20:33:36.990

为什么要包含该`value`属性？从记忆中，您不需要指定它（尽管 HTML 标准可能会说您这样做 - 不确定）。如果您确实需要一个`value`属性，为什么不只是 state `value=""`？

如果您确实采用这种方法，您的 CSS 将需要额外的背景图像高度和宽度属性。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-01-21T17:30:17.487

你们中的一些人在不同 IE 中工作或不工作的解决方案中看到的差异可能是由于打开或关闭了兼容模式。**在 IE8 中，除非**打开兼容模式，否则text-indent 可以正常工作。如果打开兼容模式，则 font-size 和 line-height 可以解决问题，但会弄乱 Firefox 的显示。

所以我们可以使用css hack让firefox忽略我们的ie规则......就像这样......

```
text-indent:-9999px;
*font-size: 0px; line-height: 0; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-12T16:43:40.627

`font-size: 0.1px;`在 Firefox、Internet Explorer 6、Internet Explorer 7 和 Safari 中，应用到按钮对我有用。我发现的其他解决方案都不适用于所有浏览器。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-04-28T08:30:43.537

在 HTML 文档的顶部使用条件语句：

```
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]--> 
```

然后在CSS中添加

```
.ie7 button { font-size:0;display:block;line-height:0 } 
```

取自 HTML5 Boilerplate - 更具体地说是[paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/](http://paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-03-20T13:20:56.127

我从某个地方注意到了这一点：

将文本转换添加到输入以将其删除

```
input.button {
    text-indent:-9999px;
    text-transform:capitalize;
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-02-17T22:30:09.270

写入您的 CSS 文件：

```
#your_button_id 
    {
        color: transparent;
    } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-09-24T16:11:54.800

这适用于 Firefox 3、Internet Explorer 8、Internet Explorer 8 兼容模式、Opera 和 Safari。

*注意：包含这个的表格单元格有`padding:0`和`text-align:center`。

```
background: none;
background-image: url(../images/image.gif);
background-repeat:no-repeat;
overflow:hidden;
border: NONE;
width: 41px; /*width of image*/
height: 19px; /*height of image*/
font-size: 0;
padding: 0 0 0 41px;
cursor:pointer; 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-09-28T14:21:29.780

`overflow:hidden`并且`padding-left`对我来说工作正常。

对于火狐：

```
width:12px;
height:20px;
background-image:url(images/arrow.gif);
color:transparent;
overflow:hidden;
border:0; 
```

对于 IE：

```
padding-left:1000px; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-05-31T10:14:17.370

```
color:transparent;  /* For FF */
*padding-left:1000px ;  /* FOR IE6,IE7 */ 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-01-04T09:43:33.167

我有同样的问题。正如许多其他帖子所报道的那样：填充技巧仅适用于 IE。

`font-size:0px`仍然显示一些小点。

唯一对我有用的是做相反的事情

```
font-size:999px 
```

...但我只有 25x25 像素的按钮。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-04-16T04:39:24.647

相反，只需执行 a`hook_form_alter`并将按钮设置为图像按钮，您就完成了！

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-02-10T21:54:29.980

以下对我来说效果最好：

**HTML**：

```
<input type="submit"/> 
```

**CSS**：

```
input[type=submit] {
    background: url(http://yourURLhere) no-repeat;
    border: 0;
    display: block;
    font-size:0;
    height: 38px;
    width: 171px;
} 
```

如果您未设置`value`，`<input type="submit"/>`它将在您的按钮内放置默认文本“提交”。所以，只需`font-size: 0;`在您的提交上设置，然后确保为您的输入类型设置一个`height`和`width`，以便您的图像将显示。如果您需要，请不要忘记提交的媒体查询，例如：

**CSS：**

```
@media (min-width:600px) {
  input[type=submit] {
    width:200px;
    height: 44px;
  }
} 
```

**这意味着当屏幕的宽度正好为 600 像素或更大时，按钮将改变它的尺寸**

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2010-02-19T17:39:11.020

`color:transparent;`然后任何`text-transform`属性也可以解决问题。

例如：

```
color: transparent;
text-transform: uppercase; 
```

# c# - 为每个后面的代码添加附加属性的 DataBinding

> ID：600441
> 
> 赞同：8
> 
> 时间：2009-03-01T20:28:16.817
> 
> 标签：c#, data-binding, code-behind, attached-properties

我想为附加的属性添加每个 Codebehind 的 DataBinding，并希望`Canvas.Left`在 TextBox 中显示该属性。如何添加此属性？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-01T21:36:49.600

您的问题有些不清楚，但我认为您是在问如何绑定到附加属性`Canvas.Left`并将其显示在 TextBox 中。我假设您希望它用于 TextBox 以外的控件。

```
<Canvas>
   <TextBox x:Name="textBox" Text="{Binding ElementName=button, Path=(Canvas.Left)}" />
   <Button x:Name="button" Content="Press me" />
</Canvas> 
```

请注意附加属性周围的括号。

编辑：要在代码中执行等效操作，请使用以下命令：

```
Binding binding = new Binding();
binding.Source = button;
binding.Path = new PropertyPath(Canvas.LeftProperty);
textBox.SetBinding(TextBlock.TextProperty, binding); 
```

# sql - 如何返回表的列名？

> ID：600446
> 
> 赞同：264
> 
> 时间：2009-03-01T20:30:58.383
> 
> 标签：sql, sql-server, tsql

如何使用 SQL Server 2008 返回表的列名？即一个表包含这些列 - id、名称、地址、国家，我想将这些作为数据返回。

* * *

## 回答 #1

> 赞同：437
> 
> 时间：2009-03-01T20:35:46.157

不确定 2008 版是否有更简单的方法。

```
USE [Database Name]
SELECT COLUMN_NAME,* 
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'YourTableName' AND TABLE_SCHEMA='YourSchemaName' 
```

* * *

## 回答 #2

> 赞同：123
> 
> 时间：2012-07-12T19:24:32.383

这是最简单的方法

```
exec sp_columns [tablename] 
```

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2009-03-01T20:34:44.927

像这样的东西？

```
sp_columns @table_name=your table name 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-03-01T20:37:41.490

一种方法是查询系统列：

```
select
   syscolumns.name as [Column],
   syscolumns.xusertype as [Type],
   sysobjects.xtype as [Objtype]
from 
   sysobjects 
inner join 
   syscolumns on sysobjects.id = syscolumns.id
where sysobjects.xtype = 'u'
and   sysobjects.name = 'MyTableName'
order by syscolumns.name 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2016-05-20T12:51:43.310

试试这个

```
select * from <tablename> where 1=2 
```

..................................................

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2013-06-04T20:09:13.420

这似乎比上面的建议更容易，因为它使用**OBJECT_ID()**函数来定位表的 id。具有该 id 的任何列都是表的一部分。

```
SELECT * 
  FROM syscolumns 
 WHERE id=OBJECT_ID('YOUR_TABLE') 
```

我通常使用类似的查询来查看我知道是较新版本的一部分的列是否存在。这是在 where 子句中添加 {AND name='YOUR_COLUMN'} 的相同查询。

```
IF EXISTS (
        SELECT * 
          FROM syscolumns 
         WHERE id=OBJECT_ID('YOUR_TABLE') 
           AND name='YOUR_COLUMN'
        )
BEGIN
    PRINT 'Column found'
END 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-09-17T10:55:20.367

以下似乎类似于上面第一个建议的查询，但有时您必须指定数据库才能使其工作。请注意，查询也应该在不指定 TABLE_SCHEMA 的情况下工作：

```
SELECT COLUMN_NAME
FROM   YOUR_DB_NAME.INFORMATION_SCHEMA.COLUMNS
WHERE  TABLE_NAME = 'YOUR_TABLE_NAME' AND TABLE_SCHEMA = 'YOUR_DB_NAME' 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-11-19T15:29:29.420

我用

```
SELECT st.NAME, sc.NAME, sc.system_type_id
FROM sys.tables st
INNER JOIN sys.columns sc ON st.object_id = sc.object_id
WHERE st.name LIKE '%Tablename%' 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-10-22T17:33:23.933

为什么不试试这个：

> 右键单击表-> 将表编写为-> 创建到-> 新查询编辑器窗口？

脚本中给出了完整的列列表。复制它并根据需要使用字段。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2015-06-11T06:37:12.470

`USE[Database] SELECT TABLE_NAME,TABLE_SCHEMA,[Column_Name],[Data_type] FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA='dbo'`

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-05-18T19:30:20.663

我不确定 syscolumns.colid 值是否与作为 sp_columns 的一部分返回的 'ORDINAL_POSITION' 值相同，但在接下来的内容中，我就是这样使用它的——希望我没有误导......

这是我发现的其他一些答案的细微变化-我使用它是因为表中列的“位置”或顺序在我的应用程序中很重要-我基本上需要知道“什么是列 (n) ？

sp_columns 返回一大堆无关紧要的东西，而且我使用 select 比 T-SQL 函数更方便，所以我走这条路：

```
select    
  syscolumns.name, 
  syscolumns.colid    
from     
  sysobjects, syscolumns  
where 
  sysobjects.id = syscolumns.id and   
  sysobjects.xtype = 'u' and   
  sysobjects.name = '<YOUR_TABLE>' 
order by syscolumns.colid 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-03-22T04:45:47.333

```
CREATE PROCEDURE [dbo].[Usp_GetColumnName]      
        @TableName varchar(50)
AS
BEGIN   
    BEGIN
        SET NOCOUNT ON
        IF (@TableName IS NOT NULL) 
            select ORDINAL_POSITION OrderPosition,COLUMN_NAME ColumnName from information_schema.columns 
             where table_name =@TableName
             order by ORDINAL_POSITION
    END
END 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-11-10T03:16:47.877

虽然@Gulzar Nazim 的回答很好，但在查询中包含*数据库名称*可能更容易，这可以通过以下 SQL 来实现。

```
SELECT COLUMN_NAME, *
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'you-table-name' AND TABLE_CATALOG='your-database-name' 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-05-08T20:01:18.327

您可以使用以下代码打印所有列名；您还可以修改代码以您喜欢的任何格式打印其他详细信息

```
 declare @Result varchar(max)='
            '
            select @Result=@Result+''+ColumnName+'
            '
            from
            (
                select
                    replace(col.name, ' ', '_') ColumnName,
                    column_id ColumnId
                from sys.columns col
                    join sys.types typ on
                        col.system_type_id = typ.system_type_id AND col.user_type_id = typ.user_type_id
                where object_id = object_id('tblPracticeTestSections')
            ) t
            order by ColumnId
            print @Result 
```

**输出**

```
column1
column2
column3
column4 
```

要使用与 C# 类相同的代码来打印表及其列名，请使用以下代码：

```
 declare @TableName sysname = '<EnterTableName>'
    declare @Result varchar(max) = 'public class ' + @TableName + '
    {'

    select @Result = @Result + '
        public static string ' + ColumnName + ' { get { return "'+ColumnName+'"; } }
    '
    from
    (
        select
            replace(col.name, ' ', '_') ColumnName,
            column_id ColumnId
        from sys.columns col
            join sys.types typ on
                col.system_type_id = typ.system_type_id AND col.user_type_id = typ.user_type_id
        where object_id = object_id(@TableName)
    ) t
    order by ColumnId

    set @Result = @Result  + '
    }'

    print @Result 
```

**输出：**

```
 public class tblPracticeTestSections
 {
   public static string column1 { get { return "column1"; } }

   public static string column2{ get { return "column2"; } }

   public static string column3{ get { return "column3"; } }

   public static string column4{ get { return "column4"; } }

 } 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2017-11-29T16:25:45.300

```
DECLARE @col NVARCHAR(MAX);
SELECT @col= COALESCE(@col, '') + ',' + COLUMN_NAME
FROM INFORMATION_SCHEMA.COLUMNS WHERE  Table_name = 'MxLocations';
SELECT @col; 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-05-14T02:27:32.840

如果您正在使用 postgresql，那么在这种情况下，可能会有多个架构具有相同名称的表，请应用以下查询

```
SELECT column_name, data_type 
FROM information_schema.columns
WHERE table_name = 'your_table_name' AND table_schema = 'your_schema_name’; 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2014-09-08T13:51:13.050

我只是使用像 Martin Smith 提到的查询，只是更短一点：

```
SELECT COLUMN_NAME 
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'YourTableName' 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-10-17T06:43:54.207

```
SELECT *
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = N'TableName' 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-12-28T00:05:22.207

由于[SysColumns 已弃用](https://msdn.microsoft.com/en-us/library/ms187997.aspx)，请使用[`Sys.All_Columns`](https://msdn.microsoft.com/en-us/library/ms188021.aspx)：

```
Select  
 ObjectName       = Object_Name(Object_ID)  
,T.Name  
,C.*  
,T.*  
From   
           Sys.All_Columns C  
Inner Join Sys.Types       T  On T.User_Type_Id = C.User_Type_Id  
Where [Object_ID] = Object_ID('Sys.Server_Permissions')  
--Order By Name Asc 
```

`Select * From Sys.Types`将产生 `user_type_id = ID`类型。这在数据库中是唯一的。对于系统数据类型：`user_type_id = system_type_id`.

* * *

## 回答 #20

> 赞同：-3
> 
> 时间：2013-11-14T20:50:44.637

```
set fmtonly on
select * from yourTable 
```

# networking - 从程序员到系统管理员

> ID：600455
> 
> 赞同：5
> 
> 时间：2009-03-01T20:35:23.117
> 
> 标签：networking, sysadmin

我是网络程序员，我处理 html、css、javascript、php 和 asp.net。

是否有一些好书/网站可以用来成为系统管理员？通过系统管理员，我的意思是了解 TCP/IP、Linux/Win 网络等。

请不要说“谷歌是你的朋友”，我知道它是，但我只想要好的网站或书籍，而不是谷歌给我的数万亿个链接。

我知道这不是一个简单的步骤，但也不是不可能的，对吧？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-01T20:44:28.710

不知道任何网站，因为我在有网络之前就学习了大部分系统管理知识。:-(

以下是我学到的一些非技术性的东西来帮助你入门：

*   备份是您的朋友，但前提是您验证它们。
*   跟踪您对系统所做的每一次更改。
*   测试环境对系统管理员和开发人员一样重要。
*   习惯在其他人都睡着的时候工作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-01T20:46:21.267

除了 tvanfosson 的回答，我还要补充：

记录**一切**——即使是你认为你永远不会忘记的东西。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-03-23T05:11:06.260

我将您的问题发送给了这里的团队中的一些成员。

这就是我们想出的。

*   使用 puppet、cfengine 学习配置管理
*   学习并记住常见的突袭级别。你需要交换磁盘，你需要知道什么时候可以，什么时候不能。您还需要知道为什么您使用一个突袭级别而不是另一个。
*   增加您对不同 FS 类型 ext3/ext4 等的熟悉程度。
*   了解linux启动过程
*   提高您对 Linux 内核的熟悉程度，特别是虚拟内存、分页、内存分配、进程创建。
*   从内到外学习你的包管理器。了解如何使用您的 pkg 管理器从源代码或二进制文件恢复、应用、更新和安装软件包。
*   了解如何读取“iostat, vmstat, free, valgrind, top, traceroute, ping, netstat, route and chkconfig（如果你使用的话）”中包含的数据
*   了解如何阅读 strace 输出。我不能强调这一点。一点也不难读。
*   了解 Unix 和 Linux 之间的区别
*   学习脚本语言 X，其中 X 是你喜欢的任何东西（我使用 Perl 和 Python）
*   学习一些 C。真的，当您解决奇怪的内存问题时，它会有所帮助。
*   了解如何启动、停止、启用和禁用服务。
*   从不同的人那里学习故障排除方法。系统管理员不是一个人的军队，他们在团队中工作。了解自己的弱点，承认并加强该领域。
*   学习如何在停电的情况下在工作中获得很多乐趣。我希望这永远不会发生在你身上。
*   培养您管理项目和截止日期的能力。
*   学会说“不”
*   批判性地思考，即使有人告诉你“我的代码不可能使服务器崩溃”，无论如何都要调查它。
*   学习如何管理 apache、邮件服务器（我推荐 postfix）
*   了解如何添加 ips、路由等，并通过引导使它们持久化。
*   学习、爱、记忆、吃、睡和喝灾难恢复，成为一个伟大的计划者和组织者。如果你不擅长这些事情，那就去努力吧。
*   培养维护正常运行时间和用户隐私的责任感。这是系统管理员最重要的价值。在我看来，做正确的事的真诚愿望对于成为一名优秀的系统管理员至关重要。
*   阅读，阅读，阅读并充满热情。刻意练习会让你变得很棒！
*   学会保持冷静。Panic 不会让您的服务恢复正常运行。- 由生产运营经理 Eric Ericson 供稿 - Baynote, Inc
*   评估和了解不同的身份验证，例如 NIS/LDAP/AD 与本地身份验证 - 由高级系统管理员 Truong Pham 提供 - Baynote, Inc
*   在 LISA 或其他一些系统管理员组中处于活动状态。并在系统管理员论坛/博客/新闻列表中闲逛。- 由匿名者提供 - Baynote, Inc. 必读：

[http://en.wikipedia.org/wiki/Man_page#Manual_sections](http://en.wikipedia.org/wiki/Man_page#Manual_sections) - 认真阅读手册页上的整个 wiki 页面。

Cricket Liu's DNS & Bind - 你必须阅读这本书并学会爱上它。

O'Reilly 的基本系统管理 - 一本非常适合新手的书

有一个名为[http://www.linux-tutorial.info/modules.php?name=MContent&pageid=89](http://www.linux-tutorial.info/modules.php?name=MContent&pageid=89) 的站点 该站点上的一些数据已经过时，但最好通读一遍，因为有些商店仍然使用非常旧的发行版在生产中。

我自己订阅了 O'Reilly 图书馆。

你知道吗！我喜欢成为系统管理员。我也喜欢写代码。作为一名系统管理员，我可以和很多人一起工作，这是我非常喜欢的。我也喜欢当我没有多少信息但我可以通过分析和批判性思维来确定问题的根本原因时。我喜欢在所有的起起落落中成为一名系统管理员。

我不确定您是否希望以此为职业，但作为系统管理员，我在财务上做得很好。我希望你喜欢阅读。如果您愿意，请随时与我联系。我喜欢与人交谈，尤其是那些与我一样热衷于保持长时间正常运行和帮助他人的人。

很抱歉这篇文章很长。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-01T20:45:43.327

在虚拟机中安装 Linux 或租用服务器。购买一本关于您选择的发行版的好书。将服务器设置为您的网络服务器。安装 Jabber/XMPP 服务器。使用 SMTP/IMAP 等安装邮件服务器。学习 OSI 模型。用 C 或 CPP 之类的系统语言编写一个简单的服务器，它使用套接字与某物进行通信。

...为自己设定一些目标并开始黑客攻击。最好的学习方法是设定一个目标并努力工作直到完成。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-01T20:47:01.497

与其试图从书本中学习，如果这是你想做的职业转变，那就不要贪便宜。

查找您居住的地方提供的一些好的计算机培训课程，这将为您提供所需的系统管理员培训。愿意为此花几百到几千美元。

您会以十倍的速度学习所有内容，并会获得参考资料供您阅读和建议购买的书籍。

您将能够立即获得答案，然后在有不清楚或没有意义的情况下回答您提出的问题。

如果你想开始你的职业生涯，从一些培训开始是非常值得的。在你的简历中添加正式的培训也没有什么坏处。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-01T21:38:49.143

您要使用的材料取决于您可能选择的系统管理专业。大多数系统管理员一开始就属于 Unix 阵营或 Windows 阵营作为主要专业。对于这些，您可以做的最好的事情是获得一个带有操作系统的虚拟机，并试验和学习它们的功能。一旦您觉得自己能够胜任基本的系统管理员任务（编写脚本、安装应用程序服务器、配置网络、补丁等），我建议您获得您想要被聘用的任何“核心”技术的认证。

如果你是一个体面的自学者，你会发现大多数 UNIX 和 Windows 证书都增加了一些晦涩的知识，但大多缺乏很多实用领域。没关系，因为证书不会使您成为系统管理员；他们只声称您在某些领域的能力最低，如果您没有该领域的经验，则在被雇用时会给您带来一点优势。这些通常很贵，但有一些是物有所值的（稍后您也许可以让您的雇主为您支付费用）。

一旦你真正进入你就会发现，在实践中，技术部分并不是很困难（它主要是阅读手册并记住操作系统功能的足够子集），但是在与你的雇主打交道时你会陷入困境/需要扑灭火灾时的客户/最终用户，这意味着您必须学习如何处理高压力情况，并能够说服人们实施技术上优越的解决方案，从而使您免于日后的额外工作。

非常确定为什么要进行此跳跃。根据我的经验，系统管理是 IT 中压力最大的职业，涉及的时间最长（一次 24/7 全天候待命），在某些情况下，大脑活动最少，因为日常操作涉及琐碎的任务和等待系统响应。最重要的技能真正归结为能够说不并在与几位高管在脖子上呼吸以​​启动生产服务器的通话中保持冷静。

从好的方面来说，你可以玩一些很酷的玩具，而且钱也很好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-04T23:19:41.980

来自系统管理员转为系统工程师的一些想法。

学习和使用配置管理系统。[Chef](http://wiki.opscode.com/display/chef/Home)或[Puppet](http://reductivelabs.com/trac/puppet/wiki)是非常强大的选择（我喜欢 Chef），它们都是用 Ruby 编写的。如果那是您的平台，则不确定 Windows；Chef 计划在明年内支持 Windows。

充分利用您的软件控制技能。使用 Git 或 Subversion（或其他）存储库维护您的配置。我喜欢 Git，因为每个签出/克隆都是一个完整的存储库，所以备份很容易 :-)。

尽可能使用开源工具。您可以通过改进他们来使用您的开发人员技能。

阅读 Tom Limoncelli 的“[系统和网络管理实践](https://rads.stackoverflow.com/amzn/click/com/0321492668)”——这是一本很好的书，涵盖了端到端的系统管理领域，而不是特定于平台的。

为您的平台查找本地用户组。加入 Twitter，寻找谈论你兴趣的人。进入 Freenode 网络上的 IRC 并与其他管理员讨论系统管理。

# silverlight - 是否有任何用 Silverlight 编写的开源地图/GIS 框架？

> ID：600458
> 
> 赞同：3
> 
> 时间：2009-03-01T20:36:18.123
> 
> 标签：silverlight, open-source, mapping, gis

[我一直在寻找一个类似于 OpenLayers](http://openlayers.org/)但用 Silverlight 编写的开源地图/GIS 框架。不幸的是，我一直找不到。

最好它能够使用来自主要地图/GIS 提供商的服务（例如，地图、图块、地理编码服务），包括（按优先顺序）：

*   [地图服务器](http://mapserver.org/)
*   [谷歌地图](http://code.google.com/apis/maps/)
*   [虚拟地球](http://dev.live.com/Virtualearth/sdk/)
*   [ArcGIS 服务器](http://resources.esri.com/arcgisserver/)

是否有任何用 Silverlight 编写的开源 GIS 框架，具有与[OpenLayers](http://openlayers.org/)或[ArcGIS Server Flex ADF](http://resources.esri.com/arcgisserver/apis/flex/)类似的功能？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-01T20:54:05.553

有[DeepEarth](http://www.codeplex.com/deepearth)。[您可以在此处](http://deepearth.soulsolutions.com.au/)找到演示站点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T20:43:16.733

[ESRI Silverlight Control](http://weblogs.asp.net/albertpascual/archive/2008/08/14/esri-silverlight-control-up-on-the-code-gallery.aspx)怎么样？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-14T17:40:41.187

[azukiMap](http://azukimap.codeplex.com/)可以是其中之一。貌似不稳定，但是开发者经常更新。我认为这将是一个很好的解决方案。

# iphone - 空时如何重新加载 UITableView？

> ID：600461
> 
> 赞同：0
> 
> 时间：2009-03-01T20:38:34.747
> 
> 标签：iphone, cocoa-touch, uitableview

`[self.tableView reloadData]`添加新行或删除行时调用工作正常。删除所有行并希望查看空表时，`reloadData`没有影响。在重新启动应用程序之前，所有幻像行仍然存在。我在 上执行此操作`RootViewController`，这是一个`UITableViewController`. 在这种情况下是否有另一种方法来刷新表格？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T20:44:03.110

你应该尝试使用

```
- (void)deleteRowsAtIndexPaths:(NSArray *)indexPaths 
              withRowAnimation:(UITableViewRowAnimation)animation 
```

...在删除某些行时在 UITableView 上，因此您在删除时也会获得动画

否则一个

```
[tableView setNeedsDisplay]; 
```

...可能有帮助

# apache-flex - 您是否使用架构框架进行 Flex/AIR 开发？

> ID：600469
> 
> 赞同：0
> 
> 时间：2009-03-01T20:41:34.803
> 
> 标签：apache-flex, architecture, actionscript, frameworks, air

鉴于 Flex 仍然是一项相对年轻的技术，已经有很多架构框架可用于 Flex/AIR（和 Flash）开发，主要是 Cairngorm 和 PureMVC。与其他技术相比，架构框架的数量非常可观。

**我想知道你们中有多少人使用架构框架进行 Flex 开发。如果是这样，为什么，或者如果你不使用，为什么不使用？**

* * *

分享我自己的经验和观点：我在各种项目中使用了 Cairngorm（和用于 Flash 开发的 ARP），发现有时我们需要编写额外的代码来适应框架，这显然没有感觉对。虽然我没有在很多场合使用过 PureMVC，但在查看示例应用程序后，我有同样的直觉。

建筑框架在某种程度上等同于宗教。大多数追随者相信他们的框架是 THE 框架，并且在使用其他框架时并不开放或非常怀疑。（我也发现自己对检查新框架感到犹豫和怀疑，但这主要是因为我宁愿等到炒作结束。）

总之，我认为最好掌握可以在应用程序中应用的模式和实践的知识，而不是选择框架并坚持下去。根本没有对错之分，我不相信会有一个被认为是圣杯的框架。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-10T12:18:54.483

我在许多项目中使用过 PureMVC，但也使用过 Swiz、Mate 和 MVCS。我研究过 Cairngorm，但没有将它用于任何实际项目。

您的帖子的结论肯定是正确的：确实“对模式和实践有充分的了解”比简单地“选择一个框架并坚持它”要好。

**但是**，当与经验较少的开发人员一起工作时，通过说“这个项目是建立在框架 X 上，阅读框架文档”来让他们加快速度要容易得多（也更快），而不是期望他们掌握理论在合理的时间范围内应用良好的模式和做法。

我认为这些框架很好地介绍了应用程序设计和关注点分离，并发现它们在团队环境中非常有用。**也就是说，我相信一个好的 IoC 容器和一些设计模式可以实现相同的结果，同时更加轻量和灵活。**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-03T16:20:04.133

I use [Mate](http://mate.asfusion.com/). It is lightweight and very easy to setup and understand. Like Spring, it is non-obtrusive and is pretty well documented. If Cairngorm is a sledgehammer, then Mate is a Leatherman. It has benefit for even trivial applications, if only to eliminate a lot of the boilerplate code.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-02T01:49:26.870

Flex 本身是一个非常好的组件框架，而 Flash 有一个非常简单的事件模型。仅这两件事就可以让您在开发 Flex 应用程序时走得更远。

我在 Flex 2 天内用 Cairngorm 编写了两个大型应用程序，我不能推荐它。它臃肿、过于抽象，甚至需要太多的代码来完成简单的事情。我认为人们已经为 Cairngorm 编写了代码生成工具这一事实证明了这点太多了。Cairngorm 也存在问题，因为它严重依赖 Singleton，这基本上是在 OOP 中使用全局变量的一种令人讨厌的方式。MVC 不需要那么难，归根结底，它只是一些有助于代码组织和将业务逻辑排除在 UI 代码之外的模式。通过锻炼一些纪律，这可以很容易地在没有框架的情况下完成。

对我来说非常有趣的是 IoC 解决方案开始在社区中渗透。我认为 Flex 框架需要发展，以便 IoC/DI 容器能够更轻松地插入组件生命周期。与您希望获得的 MVC 框架相比，这些工具可以提供的价值是巨大的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-02T04:08:04.963

在我的 Java 时代，我一直都在使用框架，但在过去的两年中，我开发了许多不同的基于 Flex 的产品，其中没有一个正式的架构“框架”——主要工程师只是勤奋地坚持到好的设计。Flex（在很大程度上得益于 MXML 的表现力）非常适合应用程序的适当分层。

话虽如此，我必须全心全意地同意 brd6644 - 我曾多次希望我们拥有 IoC/DI 容器提供的一些功能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-01T23:14:36.527

首先，评分帖子，我必须说我使用 PureMVC 已经一年多了，我不得不说我对结果感到非常高兴。你是对的，坚持框架是不好的，但你必须知道什么时候使用框架，什么时候不使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-03-15T22:44:34.917

Swiz 是目前最轻量级的选择。我见过的所有其他东西（主要是 Cairngorm/PureMVC/Mate）仍然有很多代码或 XML 膨胀，这是我想要避免的。我不相信用 XML 膨胀代替代码膨胀，只要给我一些工具来用更少的工作完成工作！

# ruby - 如何将haml与heroku一起使用？

> ID：600487
> 
> 赞同：5
> 
> 时间：2009-03-01T20:48:28.920
> 
> 标签：ruby, sinatra, heroku, haml, gem

我尝试在没有 gem 的情况下使用 sinatra 让 haml 工作（据我所知，Heroku 不允许安装 gem）

到目前为止我所做的：

*   在我的项目中克隆haml git repo

*   添加：需要 'haml/lib/haml.rb' 到我的 sinatra 主文件

以下作品：

```
get '/test' do
  Haml::Engine.new('%p test').render
end 
```

但以下没有：

```
get '/test2' do
  haml :my_template
end 
```

我得到错误：

NoMethodError - 未定义的方法`each' for nil:NilClass (haml):20:in`渲染'

./haml/lib/haml/engine.rb:152:in `render'

./haml/lib/haml/engine.rb:152:in `instance_eval'

./haml/lib/haml/engine.rb:152:in `render' ...

还有其他文件需要吗？有任何想法吗 ？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-07-25T13:23:28.813

Heroku 支持通过在项目的根目录中创建`.gems`文件并将其添加到 Git 来安装 gem。在您下次推送时，将安装其中所需的 gem。要安装 Haml，该文件将包含以下行：

```
haml --version '>= 2.2.0' 
```

更多信息可以在这里找到：http: [//docs.heroku.com/gems](http://docs.heroku.com/gems)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-01T21:30:37.023

两个最明显的可能性（按概率排列）：

1.  您的 Haml 文件中的某些 Ruby 代码存在错误。如果您可以在 Sinatra 之外尝试相同的代码，那里的渲染是否正常？
2.  文件 my_template.haml 不存在或命名不正确。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-10-28T18:45:13.763

正如 StuFF mc 所指出的，作为对 petergassner 的回答，现在执行此操作的正确方法是使用您的应用程序的 Gemfile。在那个 Gemfile 你会做

```
gem "haml", ">= 2.2.0" 
```

Heroku 知道您何时推送应用程序以安装 gemfile 中提到的 gem。

请注意，如果您想使用`sass`as well `haml`，您可能需要跳过几圈才能进行设置。传统上的工作方式`haml`涉及将编译后的`css`文件写入磁盘，这是 heroku 的只读文件系统上的一个问题。最终有人编写了一个插件/gem 来解决这种情况（sass-on-herku 或类似的）。

目前，`haml-rails`gem 似乎使用资产管道来解决这个问题，但如果您使用的是 Sinatra，这可能对您不起作用。因此，您要么想看看其中一个宝石是否仍在运行，要么接受 heroku[目前](https://devcenter.heroku.com/articles/using-sass)似乎支持的建议。这篇文章也是特定于 Rails 的，但是您应该能够让 Sinatra 正常工作而没有太多困难。（基本上，在这里总结一下，heroku 现在确实支持写入 tmp 目录，所以只要你可以配置 sass gem 和 Sinatra 应用程序来使用一些 tmp 位置，你应该很好。）

# delphi - 如何使用通过 shell open 调用的 Delphi 程序打开多个文件

> ID：600490
> 
> 赞同：2
> 
> 时间：2009-03-01T20:51:22.267
> 
> 标签：delphi, command-line, parameters, filenames

我目前正在使用：

```
if ParamStr(1)<>'%1' then
begin
  address.Text:=ParamStr(1);
  autoconfigfile;
end; 
```

获取用于通过文件关联打开文件的文件的名称。

我现在想开发对多个文件进行操作的能力。即，如果我选择 5 个文件并右键单击并选择使用“EncryptionSystem”打开。我有注册表项：

```
 reg.OpenKey('*\shell\Encrypt\command', true);
  reg.WriteString('','C:\Program Files\EncryptionSystem\EncryptionSystem.exe "%1"');
  reg.CloseKey; 
```

为所有文件添加右键打开功能。然后我想要检测的能力

1.  多少个文件
2.  每个文件的路径名

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-02T06:58:01.967

除此之外，您应该使用 %l 而不是 %1。这样，您的程序将获得文件的完整（长）名称，而不是短名称（DOS 8.3）。

编辑：在评论中回答 Rob 的问题

似乎几乎不可能使用 Google 或 MSDN 搜索来搜索“%l”和“%1”（包括百分号）。[:( 但是，我在The Old New Thing](http://blogs.msdn.com/oldnewthing/archive/2004/10/20/245072.aspx "还有什么地方？")中找到了一个很好的描述 - '%1' 自动检测您的程序是否支持长文件名并传递短名称或长名称。似乎所有现代系统都传递长名称*，除非您的 exe 不能发现*（至少我是这么理解雷蒙德的暴露的）。

如果您在评论中进一步向下滚动（在页面上搜索“%l”），您会发现所有受支持参数的列表，这些参数取自某个不再存在的页面（但我在[Internet 上找到了一个旧副本存档](http://web.archive.org/web/20020208233905/%68ttp://users.lia.net/chris/win32/explorer.asp)）。该页面也不包含对 Microsoft 文档的引用，因此我无法为您提供权威链接 :(

Rob，谢谢你的提问 - 我现在比以前更了解 %1/%l :) +1。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-02T05:21:08.563

如果您尝试一次打开多个文件，您通常会获得注册程序的多个实例，每个实例都打开一个文件。

现在从你最近的问题来看

[如何判断我的程序的一个实例是否正在运行？](https://stackoverflow.com/questions/459554/how-do-i-tell-if-one-instance-of-my-program-is-running)
[如何将字符串从我的 Delphi 程序的一个实例发送到另一个实例？](https://stackoverflow.com/questions/512366/how-do-i-send-a-string-from-one-instance-of-my-delphi-program-to-another)

您不希望允许程序的多个实例，因此您需要重新考虑该设计决策，或实施第二个问题的答案中概述的方法之一，以发送程序辅助实例的命令行参数到一审。请注意，时间在这里很重要，因为第一个实例可能还没有准备好从其他实例接收数据。尤其是使用主窗体的窗口句柄或某种形式的基于管道或文件的通信机制的解决方案将涉及等待第一个实例准备好。因此，简单地允许程序的多个实例可能会容易得多。

您可能还想查看[此 Microsoft 知识库条目](http://support.microsoft.com/kb/122787)或搜索有关**DDE 执行**命令的更多信息。

**编辑：**您也可以尝试在注册表项中使用“%*”而不是“%1”，如[gabr](https://stackoverflow.com/questions/600490/how-to-open-multiple-files-with-delphi-program-invoked-via-shell-open/601478#601478)提到的答案的“旧新事物”评论中所述。我还没有测试过这个，但它看起来可以工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T21:21:10.730

不确定你真正想要什么。但是您可以通过以下方式找到参数的数量：

```
ParamCount; 
```

然后找到每个参数

```
ParamStr(1);
ParamStr(2);
ParamStr(3); 
```

直到 ParamCount。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T01:36:01.427

我注意到您只是在 %1 注册它。

我会在注册表中尝试 %1 %2 %3 %4 %5 等。

我从来没有玩过 shell 扩展来看看还有什么可能导致这个失败。我所做的只是注册文件关联，它们的行为完全符合我的预期。

# git - 使用 git diff 为部署创建文件列表的问题

> ID：600491
> 
> 赞同：2
> 
> 时间：2009-03-01T20:52:32.093
> 
> 标签：git, bash, deployment, shell, release-management

我想使用类似以下命令来创建要部署的 tarball：

```
tar cjvf ~/deploy.tar.bz2 `git diff --name-only 0abc 1def` 
```

当我单独运行它时，内部 git diff 命令会生成一个包含相对路径的文件列表。

我遇到了两个问题，我需要能够在输出中自动转义空格，所以 tar 不会抱怨包含空格的文件，~~并且当 tar 确实被创建时，所有文件都有一个重复的“隐藏文件”前面有一个“。” 不会出现在 ls -al~~中。这些是 kch 所指出的 OSX 特定的元文件。

无论如何，有没有人知道这些问题的解决方案，或者是否有一种更简单的方法来编写脚本？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-02T01:44:56.197

我使用 sed 确定了以下解决方案。

```
tar cjf ~/deploy.tar.bz2 \
`git diff --name-only 0abc 1def|sed -e "s/ /\\\ /g"` 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-02T01:31:44.183

隐藏的点文件，它们是点下划线文件吗？

如果`foo`你有另一个文件`._foo`，并且你在 Mac 上，点下划线文件是保存文件资源叉/元数据的地方。

至于 git 输出，可以尝试通过管道传输`sed`或`perl`引用。我相信`xargs`在这里也可以提供帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-02T14:50:28.680

为什么不使用tar 的`--files-from=FILE`or`-T FILE`选项，其中 FILE 可以是 '-' 来表示标准输入？

```
 git diff --name-only 0abc 1def | tar -T - cjf ~/deploy.tar.bz2 
```

您不应该对文件名中的空格或制表符、单引号、反引号或反斜杠有问题（我认为您的解决方案会在文件名中出现单引号“'”的问题）。文件名中的换行符可能有问题，就像在 IFS 解决方案中一样。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T21:10:07.153

如果大小无关紧要，您可以使用**git archive**。

我不确定是否可以创建一个仅包含两个提交之间差异的 tarball。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-01T22:15:22.940

你可以试试

```
eval tar cjvf ~/deploy.tar.bz2 `git diff --name-only 0abc 1def | while read x; do echo "'""$x""'"; done` 
```

或使用 sed 尝试相同的操作，或

```
IFS='
' tar cjvf ~/deploy.tar.bz2 `git diff --name-only 0abc 1def` 
```

请注意，IFS 中只有一个换行符。

但是，如果您的文件名包含换行符，那么您注定要失败。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-02T08:04:25.190

这是另一个更优雅的解决方案，可以解决文件名中的转义空格

```
git diff --name-only 0abc 1def | \
    tr '\n' '\0' | \
    xargs -0 tar -rjvf ~/deploy.tar.bz2 
```

正如 jpalecek 指出的那样，不想多次运行“tar -c ...”，最好使用 -r。

# jquery - jQuery：在页面卸载时自动中止 AjaxRequests？

> ID：600494
> 
> 赞同：13
> 
> 时间：2009-03-01T20:53:35.803
> 
> 标签：jquery, ajax

谢谢阅读。

我注意到，如果我有一个打开了一个或多个 ajax 请求的页面，并且我单击一个链接离开页面或刷新它，它将等待 ajax 请求完成后再卸载。

这通常不是问题，但如果请求需要一段时间，则可以。

我正在寻找类似的东西：

```
$(window).bind("beforeunload", function() {AjaxRequest.abort();}); 
```

在卸载之前自动中止请求，但不太确定如何找到 ajax 请求。他们会在某个地方的窗户下吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-01T21:07:46.877

[$.ajax()](http://docs.jquery.com/Ajax/jQuery.ajax#options) jQuery方法返回 XMLHttpRequest 对象。这意味着您可以在对象上应用标准方法，例如 abort()。

要卸载使用内置的[卸载](http://docs.jquery.com/Events/unload)jQuery 事件方法。

```
var myajax = $.ajax(...); 
$(window).unload( function () { myajax.abort(); } ); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2015-09-08T02:08:03.100

以下代码经过测试，并在 Chrome 中中止页面卸载时所有未完成的 jQuery ajax 请求，但 Edge 和 IE 也使用客户端使用它而不会出错。

将以下内容作为第一个 jQuery`ready`处理程序：

```
$(onPageLoaded) 
```

并将其放在可访问的地方：

```
function onPageLoaded() {
    var jqxhrs = [];

    $(window).bind("beforeunload", function (event) {
        $.each(jqxhrs, function (idx, jqxhr) {
            if (jqxhr)
                jqxhr.abort();
        });
    });

    function registerJqxhr(event, jqxhr, settings) {
        jqxhrs.push(jqxhr);
    }

    function unregisterJqxhr(event, jqxhr, settings) {
        var idx = $.inArray(jqxhr, jqxhrs);
        jqxhrs.splice(idx, 1);
    }

    $(document).ajaxSend(registerJqxhr);
    $(document).ajaxComplete(unregisterJqxhr);
}; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-05-07T01:26:39.420

我刚刚遇到了这个问题，我在 PHP 中进行了一个长循环，它是从 $.ajax 调用的。我的解决方案是添加 session_write_close(); 在长循环之前。

我的理论是，Chrome 在取消任何后台 ajax 请求*之前*会请求下一页。如果您的 ajax 请求与您要离开 AND TO 的页面的 _SESSION 相同，那么在您的第一行 PHP 代码被命中之前，您就会出现死锁。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-01-22T15:12:12.073

您必须坚持所有 ajax 请求，并且在重新加载页面时中止所有请求。样本

```
var _requests = [];

var _abortAllRequests = function () {
    $(_requests).each(function (i, xhr) { xhr.abort(); });

    _requests = [];
}

$(window).on("beforeunload", function () { 
    _abortAllRequests();
}); 
```

在您的代码中的某处

```
 _requests.push($.ajax(...)) 
```

此外，您可以使用带有事件 ajaxStart ajaxStop 的 $.ajaxSetup 弹出完成的请求，但这取决于您

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-01T21:06:29.937

认为您需要**window.onunload**事件加上每个请求的**AjaxRequestX = $.get(...) ，也许将对象保存在数组中并在卸载时通过它们。**

# ruby-on-rails - Ruby on Rails - 具有部分视图的实例变量范围

> ID：600498
> 
> 赞同：3
> 
> 时间：2009-03-01T20:55:36.407
> 
> 标签：ruby-on-rails, scope, partial-views

我不明白如何在局部视图中正确使用实例变量，我希望这里有人能启发我。例如：

```
class MainController < ApplicationController

  def index
    @item_list = Item.find_all_item
  end

  def detail_display
    @current_selected = @item= Item.find(params[:id])
      redirect_to :action => :index
  end
end 
```

`detail_display`当用户单击列表中的项目时调用。当索引被重定向到时，该变量`@current_selected`对调用的局部视图不可用。我该如何补救？

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-01T21:13:47.657

当您进行重定向时，浏览器会发送一个全新的请求，因此前一个请求中的所有数据都无法访问。您可能不想在这里进行重定向；当您通过控制器查看单独的运行时，没有任何范围可以帮助您。

稍微想想你的设计——你想做什么？如果选择是粘性的，也许它应该在会话中进行。如果只是部分更改，也许您应该使用 Ajax 调用。也许解决方案就像渲染`index`模板而不是重定向到`index`动作一样简单。

# c++ - C/C++ 编译器会优化这个 if 语句吗？

> ID：600502
> 
> 赞同：3
> 
> 时间：2009-03-01T20:58:53.107
> 
> 标签：c++, c, optimization, compiler-construction, performance

我有这样的代码，我发现它有点难以阅读：

```
// code1
if( (expensiveOperation1() && otherOperation() && foo()) 
     || (expensiveOperation2() && bar() && baz()) {
  // do something
} 
```

我只是将其更改为以下内容，以使其更具可读性：

```
// code2
const bool expr1 = expensiveOperation1() && otherOperation() && foo();
const bool expr2 = expensiveOperation2() && bar() && baz();
if(expr1 || expr2){
   // one of the conditions met
} 
```

但是我现在应该关注效率吗？

我的意思是`code1`，如果第一个连接子句得到满足，那么它甚至不会费心去看第二个，因为很明显该陈述将是正确的。

但在我更具可读性的示例中，两者`cond1`和`cond2`都必须计算。或者，如果 expr2 没有在其他任何地方使用，编译器是否足够聪明，可以将 my 更改`code2`为？`code1`

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-01T21:02:20.307

我会说不应该，因为如果任何功能有副作用，它们在逻辑上就不等效。

然而，以下内容是等价的，它的优点是允许您为测试函数提供描述性名称，从而使代码更具自我记录性：

```
// code3
inline bool combinedOp1()
{
    return expensiveOperation1() && otherOperation() && foo();
}

inline bool combinedOp2()
{
    return expensiveOperation2() && bar() && baz();
} 
```

然后按如下方式调用它：

```
if (combinedOp1() || combinedOp2())
{
    // do something
} 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-01T21:01:22.413

也许吧，但为什么不让你的第二张支票包含第一张呢？

```
// code3
bool expr = expensiveOperation1() && otherOperation() && foo();
expr = expr || (expensiveOperation2() && bar() && baz());
if(expr){
   // one of the conditions met
} 
```

更好的是，扭转局面，使成本最低的检查首先出现在每个列表中，利用惰性评估完全跳过昂贵的操作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-01T21:02:22.333

好吧，如果条件有副作用，编译器通常不会重新排序 && 和 ||。一些非常聪明的编译器可能能够静态验证它们的独立性，但这种情况很少见。

如果可能的话，重新排列你的条件，让廉价的操作优先，这样它就可以把昂贵的操作短路。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T12:39:27.007

这里的最佳答案是用“不应该”和“也许”来回答这个问题！这不是一个确定的答案来吧！

如果您想知道您的编译器是否正在优化这一小段代码，请使用“显示汇编输出”标志编译您的代码。在 GCC 上，该标志是“-S”。然后查看输出程序集，它会 100% 准确地显示正在编译的内容。

然后，您可以将您的第一个代码片段与“therefromhere”中的代码片段进行比较，并快速尝试大量代码更改，直到找到编译器优化得最好的代码（即最少周期）。

查看 asm 输出听起来既复杂又可怕，但实际上只需要大约 5 分钟即可完成。我在这里做了一个例子：[在 C 中交换值的最快方法是什么？](https://stackoverflow.com/questions/36906/what-is-the-fastest-way-to-swap-values-in-c/615995#615995)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-01T21:05:37.397

这个问题的答案当然取决于编译器。确定的检查方法是查看编译器为此函数生成的程序集。大多数（全部？）编译器都有办法做到这一点，例如`gcc`有`-S`选项。如果出于某种奇怪的原因，大多数调试器不能向您展示函数的反汇编，或者还有其他工具可以做到这一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T12:11:57.777

很好的答案。

我只想补充一点，我不喜欢编译器在优化方面如此激进，以至于重新排序我的代码。

我只想要一个编译器来做它被告知的事情。

如果它能够智胜我，它也可以智胜自己。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-27T17:17:27.337

如果编译器知道 cond2 中的函数（expensiveOperation2()、bar() 和 baz()）是纯函数（即没有副作用），则它可以进行优化。如果它们是纯的，确保编译器知道它的最简单方法是使它们成为内联函数。

即使您不知道，编译器也有*可能*知道，但这不太可能，因为昂贵的Operation2() 可能做了很多工作。

FWIW，如果这些函数是纯函数，您可能应该重新排序它们，以便 bar() 和 baz() 在昂贵的Operation2() 之前运行（对于 cond1 中的排序也是如此）。

# installation - 在 Linux Debian 上安装 SciPy

> ID：600504
> 
> 赞同：3
> 
> 时间：2009-03-01T21:00:28.517
> 
> 标签：installation, debian, scipy

我是 Linux n00b，我想安装 SciPy 来帮助我完成家庭作业。

这个[页面](http://www.scipy.org/Installing_SciPy/Linux#head-d437bf93b9d428c6efeb08575f631ddf398374ea)让我感到困惑而不是帮助我。

我一直在指导自己使用从 sourceforge 获得的 INSTALL.txt 文件，该文件说

```
PREREQUISITES
=============

SciPy requires the following software installed:

1) Python__ 2.4.x or newer

   Debian packages: python python-dev

   Make sure that the Python package distutils is installed before
   continuing. For example, in Debian GNU/Linux, distutils is included
   in the python-dev package.

   Python must also be compiled with the zlib module enabled.

__ http://www.python.org

2) NumPy__ 1.2.0 or newer

   Debian package: python-numpy

__ http://www.numpy.org/

3) Complete LAPACK__ library (see NOTES 1, 2, 3)

   Debian/Ubuntu packages (g77): atlas3-base atlas3-base-dev

   Various SciPy packages do linear algebra computations using the LAPACK
   routines. SciPy's setup.py scripts can use number of different LAPACK
   library setups, including optimized LAPACK libraries such as ATLAS__ or
   the Accelerate/vecLib framework on OS X. The notes below give
   more information on how to prepare the build environment so that
   SciPy's setup.py scripts can use whatever LAPACK library setup one has.

__ http://www.netlib.org/lapack/
__ http://math-atlas.sourceforge.net/ 
```

通过 Synaptic 包管理器，我下载了所有这些 + IPython。

我想我会在你们回答我的第一个问题和最终启动并运行这件事之间陷入困境，我将多次更新这篇文章。

[第一个问题：通过这个链接](http://www.rexx.com/~dkuhlman/scipy_course_01.html#on-unix-linux)引导自己，我用 scipy 下载了 sourceforge .tar 文件。

我在 /home/antonio/Desktop/Downloads 上提取了它的内容

我运行了链接上显示的命令：

```
jajaja:/home/antonio/Desktop/Downloads# cd scipy-?.?.?
jajaja:/home/antonio/Desktop/Downloads/scipy-0.7.0# setup.py build
bash: setup.py: command not found 
```

**^ 为什么？？**

为什么会出现command not found？我应该在其他地方提取 .tar 文件的内容吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-01T21:52:53.307

我最近在我的 Debian/Lenny 系统上安装了 scipy。我所做的只是安装（使用 aptitude）Debian 软件包

*   [python-scipy](http://packages.debian.org/lenny/python-scipy)
*   [python-matplotlib](http://packages.debian.org/lenny/python-matplotlib)
*   [蟒蛇](http://packages.debian.org/lenny/ipython)

在终端启动`ipython -pylab`，一切都很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-01T21:52:21.480

为什么不直接安装 SciPy？它不是最新版本，但也许 0.6 足以满足您的需求？

```
# apt-get install python-scipy 
```

作为根，或

```
$ sudo apt-get install python-scipy 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-01T21:11:45.633

该链接告诉您执行

```
python setup.py build 
```

但你正在执行

```
setup.py build 
```

由于您是 n00b，因此您必须严格按照说明进行*操作*。

# groovy - 我可以在 groovy 中使用映射强制来模拟具有带参数的构造函数的类吗？

> ID：600512
> 
> 赞同：11
> 
> 时间：2009-03-01T21:03:27.433
> 
> 标签：groovy, mocking, coercion

**正在测试的 Java 示例类**

```
public class Sample {
    public void printPie() {
        System.out.println("Pie.");
    }
}

public class SampleCont {
    String _PIE;

    public SampleCont() {
        _PIE = "pie";
    }
    public void printPie() {
        System.out.println(_PIE);
    }
}

public class SampleContArg {
    String _PIE;

    public SampleContArg(String pie) {
        _PIE = pie;
    }
    public void printPie() {
        System.out.println(_PIE);
    }
} 
```

**groovy 测试类**

```
public class TestPie extends GroovyTestCase{

    void test_Sample()
    {
        def mock = [printPie: {print "NotPie"}] as Sample
        mock.printPie()
    }

    void test_SampleCont()
    {
        def mock = [printPie: {print "NotPie"}] as SampleCont
        mock.printPie()
    }

    void test_SampleContArg()
    {
        def mock = [printPie: {print "NotPie"}] as SampleContArg
        mock.printPie()
    }
} 
```

前两个测试编译并运行良好。后一个测试由于异常而无法运行：

```
java.lang.ArrayIndexOutOfBoundsException: 0
    at SampleContArg_groovyProxy.<init>(Script1.groovy:4)
    at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
    at sun.reflect.NativeConstructorAccessorImpl.newInstance(Unknown Source)
    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(Unknown Source)
    at java.lang.reflect.Constructor.newInstance(Unknown Source)
    at org.codehaus.groovy.runtime.MetaClassHelper.doConstructorInvoke(MetaClassHelper.java:595)
    at groovy.lang.MetaClassImpl.doConstructorInvoke(MetaClassImpl.java:2359)
    at groovy.lang.MetaClassImpl.invokeConstructor(MetaClassImpl.java:1255)
    at groovy.lang.MetaClassImpl.invokeConstructor(MetaClassImpl.java:1185)
    at org.codehaus.groovy.runtime.InvokerHelper.invokeConstructorOf(InvokerHelper.java:809)
    at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.invokeNewN(ScriptBytecodeAdapter.java:230)
    at Script1.run(Script1.groovy:9)
    at groovy.lang.GroovyShell.evaluate(GroovyShell.java:543)
    at groovy.lang.GroovyShell.evaluate(GroovyShell.java:518)
    at groovy.util.ProxyGenerator.instantiateAggregate(ProxyGenerator.java:201)
    at groovy.util.ProxyGenerator.instantiateAggregateFromBaseClass(ProxyGenerator.java:70)
    at groovy.util.ProxyGenerator.instantiateAggregateFromBaseClass(ProxyGenerator.java:66)
    at org.codehaus.groovy.runtime.DefaultGroovyMethods.asType(DefaultGroovyMethods.java:3811)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
    at java.lang.reflect.Method.invoke(Unknown Source)
    at org.codehaus.groovy.runtime.metaclass.ReflectionMetaMethod.invoke(ReflectionMetaMethod.java:51)
    at org.codehaus.groovy.runtime.metaclass.NewInstanceMetaMethod.invoke(NewInstanceMetaMethod.java:54)
    at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:230)
    at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:912)
    at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:756)
    at org.codehaus.groovy.runtime.InvokerHelper.invokePojoMethod(InvokerHelper.java:766)
    at org.codehaus.groovy.runtime.InvokerHelper.invokeMethod(InvokerHelper.java:754)
    at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.invokeMethodN(ScriptBytecodeAdapter.java:170)
    at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.asType(ScriptBytecodeAdapter.java:622)
    at com.hp.vse.cp.cli.agentless.ssh.TestPie.test_SampleContArg(TestPie.groovy:24)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
    at java.lang.reflect.Method.invoke(Unknown Source)
    at junit.framework.TestCase.runTest(TestCase.java:154)
    at junit.framework.TestCase.runBare(TestCase.java:127)
    at junit.framework.TestResult$1.protect(TestResult.java:106)
    at junit.framework.TestResult.runProtected(TestResult.java:124)
    at junit.framework.TestResult.run(TestResult.java:109)
    at junit.framework.TestCase.run(TestCase.java:118)
    at junit.framework.TestSuite.runTest(TestSuite.java:208)
    at junit.framework.TestSuite.run(TestSuite.java:203)
    at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:130)
    at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196) 
```

在上面第三类的情况下，我还可以使用 groovy map coercion 来模拟类吗？如果是这样，我做错了什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-01T22:59:00.213

ProxyGenerator.instantiateAggregateFromBaseClass 方法可以接受构造函数参数。但不幸的是， as 运算符不会为您调用它。

所以，目前的答案是否定的。

仅供参考，“as”将调用 DefaultGroovyMethods.asType() 方法之一，但它们都没有调用您想要的 instantiateAggregateFromBaseClass。

# active-directory - 连接失败时如何从 Active Directory 中删除服务器？

> ID：600514
> 
> 赞同：0
> 
> 时间：2009-03-01T21:04:56.713
> 
> 标签：active-directory, registry, windows-server-2008, bdc

我有一个服务器，其 AD 帐户发疯了；登录需要几个小时，而且并非所有 DC 都显示计算机帐户。现在它只有在与网络断开连接时才会启动。我正在尝试将其从域中删除，但会超时，或者如果它已连接，则会收到错误消息“此线程的远程过程调用已在进行中”。我从域中删除了计算机帐户。

我尝试使用“netdom remove computername /force”并删除注册表中的机器帐户（HKLM/security/secrets/$machine.acc），但服务器仍保留在域中。

是否有记录的方法可以从不再可用的域中删除服务器（或工作站）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-01T21:17:14.793

在 Active Directory 用户和计算机中的 PDC 上，从计算机列表中删除该条目。

编辑：那将在 Server 2003 上，但毫无疑问，2008 服务器上有相应的工具。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-01T21:19:44.757

这只发生在这台电脑上吗？从 ADUC 中删除计算机帐户应该可以。此服务器上正在运行什么（交换？域控制器？dns？）

**编辑添加：**

我会尝试强制在 DC 之间进行复制。打开 ADUC。转到站点/您的站点/NTDS 设置。右键单击详细信息窗格中的连接，然后选择立即复制。

您是否说计算机仍显示在 ADUC 中，这有点令人困惑。如果强制复制没有任何改变，那么恐怕您将不得不重新映像这台计算机。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T08:49:06.890

没有任何效果...

我重新格式化了服务器。

它确实是因为域复制问题而开始的，我想如果我在弄乱计算机帐户并强制删除之前强制复制，这将得到解决。

# css - IE7 和 Firefox 3 渲染差异

> ID：600518
> 
> 赞同：1
> 
> 时间：2009-03-01T21:06:59.390
> 
> 标签：css, internet-explorer-7, firefox-3

这是我正在开发的页面的大纲。

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <link rel="stylesheet" href="../css/test.css" />
    <title>Prosperity Login</title>
  </head>
  <body>
    <div id="banner">
    </div>
    <div id="subbanner">
    </div>
    <div id="body">
      <div id="colA">
      </div>
      <div id="colB">
        <div id="B1">
        </div>
        <div id="B2">
        </div>
      </div>
      <div id="colC">
      </div>
      <div id="colD">
      </div>
    </div>
    <div id="footer">
    </div>
  </body>
</html> 
```

和CSS：

```
* {
  margin: 0px;
  padding: 0px;
}

div {
  border: 1px dotted;
}

#banner {
  height: 70px;
  width: 100%;
}

#subbanner {
  height: 30px;
  width: 100%;
}

#body {
  background-color: #CCFFCC;
  width: 80%;
}

#colA{
  float: left;
  height: 120px;
  width: 24%;
}

#colB{
  float: left;
  height: 80px;
  width: 24%;
}
#colC{
  float: left;
  height: 120px;
  width: 24%;
}
#colD{
  float: left;
  height: 120px;
  width: 24%;
}

#B1{
  float: right;
  height: 48px;
  width: 80%;
}

#B2{
  float: right;
  height: 28px;
  width: 80%;
}
#footer{
  height: 30px;
  width: 100%;
} 
```

在 Firefox 3 中，body div（带有绿色背景）被压缩到几乎没有，而 IE7 完美地呈现了页面。根据我对 CSS 2.1 标准的了解（通过 Meyer 的 O'Reilly 书），浮动 div 应该在其容器块内浮动，这在 Firefox 3 中显然不是这种情况。

所以如果 Firefox 的渲染是兼容的，我错过了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-01T21:37:45.370

您的问题是 IE7 清除了父元素，以便它包含浮动子元素。这不是它应该呈现的方式。其他海报更好的解释。

简单修复：适用`overflow: hidden;`于您的`#body`：

```
#body {
    overflow: hidden;
} 
```

请参阅[此帖子](http://www.sitepoint.com/blogs/2005/02/26/simple-clearing-of-floats/)以获取解释。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-01T21:37:14.527

与往常一样，当页面在 Internet Explorer 和 Firefox 中呈现不同时，Firefox 会正确呈现页面。

身体 div 不应该有任何高度。它只包含浮动元素，因此其中没有任何东西可以赋予它任何高度。浮动元素不会影响其父元素的大小。IE 执行此操作并扩展元素以包含它的子元素。这是众所周知的 IE 渲染错误之一。

从代码中删除 xml 标记。文档类型必须在页面中排在第一位，否则 IE 将忽略它。

如果您在 IE 8 beta 中查看该页面，它将完全按照 Firefox 的方式呈现该页面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-01T21:37:41.983

没有为 id="body" 的 div 分配重量或体积。放置在 div 内的任何文本都会赋予它体积并将颜色背景渲染为适当的大小。这个问题也会出现在基于 Webkit 的浏览器（Chrome、Safari）中。

要么在主体 div 中放置文本以赋予其权重，要么添加一种溢出样式：隐藏；到 id=body 的 div。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T23:32:07.293

谢谢大家的回答。

还有另一种解决方案也可以解决我的问题：浮动父 div (id="body")。这直接来自迈耶的书，所以我不知道我是怎么错过的。另一个例子就是学习！另一件事是，这也解决了另一个我没有说明的问题：我如何在正文和页脚之间设置一个边距？由于在 Firefox 中，清除页脚不允许使用边距来在正文和页脚之间留出空间。然而，浮动父元素确实如此。

# c++ - 矢量调整大小 - 检测的便携方式

> ID：600519
> 
> 赞同：0
> 
> 时间：2009-03-01T21:06:59.483
> 
> 标签：c++, cross-platform, vector

我有一个向量，我正在加载已知数量的元素 (N)。

该处理动态地创建新元素，这些元素被附加到向量中。

我预计要创建大约 2 * N 个附加元素，因此我将向量的大小调整为 3 * N。

如果额外的元素超过了，我想要一个程序中止，而不是向量的动态扩展。

**有没有办法检测到，可以在 AIX/TRU64/Linux 之间移植？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T21:27:19.387

检测什么？矢量是否会调整大小？是否已经？

实现这一点的唯一真正方法是在自定义分配器或将元素添加到向量的函数中提供检查功能。

例如

```
template<class T> 
void add_element(std::vector<T>& container, T const& v)
{
  if (container.capacity()+1 >= 3*N)
  {
    // terminate/exception/whatever
  }

 container.push_back(v);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-02T15:38:19.733

为什么要使用向量？向量的重点是在需要时动态扩展。

与其创建一个类来委托给向量，不如创建一个类来委托给一个简单的数组。让您的 push_back 检查大小并在需要时中止。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-01T21:30:13.267

创建您自己的类，该类将委托给向量。并在您自己的 push_back 中检查大小。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-01T21:52:52.027

如果您在编译时知道大小，也许使用 std::tr1::array （或[boost::array](http://www.boost.org/doc/libs/1_38_0/doc/html/array.html)）会是更好的选择。它保持固定大小并像 std::vector 一样检查访问。

但是，如果您只在运行时知道它，正如其他人所说，您应该将您的向量封装在一个具有特定函数的类中，这些函数将检查您想要的条件（例如通过断言）。

在最后一种方法中，我建议，如果您可以知道向量创建时的最大大小，则在封装类构造函数（或初始化函数）中保留（ std::vector::reserve() ）向量的最大大小. 这样，向量本身将不再进行内存操作（仅当向量元素构造函数/析构函数进行此类操作时）。然后，添加一个简单的断言来检查向量容量（ std::vector::capacity() ）在类的所有函数的开始和结束时从未改变，这将帮助您确保它的内存不会移动。

例如（假设 DATA_MAX_SIZE 是在某处定义的默认最大大小）：

```
template< typename MyType >
class MyData
{
public:
    MyData( unsigned long max_size = DATA_MAX_SIZE )
        : m_max_size( max_size )
        { m_data.reserve( m_max_size ); }

    void add( const MyType& value ) { check_capacity(); m_data.push_back( value ); check_capacity(); }

private:

    std::vector< MyType > m_data;
    const unsigned long m_max_size;

    void check_capacity() { if( m_data.capacity() != m_max_size ) throw Exception("Useful error message here!" ); }

}; 
```

或类似的东西...

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-02T15:51:16.583

每次插入元素时，std 类都会使用一个分配器。您可以编写一个继承自 std::alocator 的新分配器，并添加您需要的所有类型的检查/跟踪。

（我以前这样做过，但我花了一段时间来编写工作代码。）

# bash - 当进程死亡时执行命令

> ID：600524
> 
> 赞同：3
> 
> 时间：2009-03-01T21:09:31.803
> 
> 标签：bash

我想在进程死亡时执行命令。我已经有了一个解决方案，但我正在寻找是否有更好的方法来做这件事作为进一步学习 BASH 的一种方式。这是我所拥有的：

```
$ ps -e | grep scp
 7673 pts/1    00:01:17 scp
$ while [ $( ps 7673 2>&1 >/dev/null; echo $? ) = 0 ]; do sleep 1; done; echo "Scp doesn't exist any more" 
```

它有效，我见过更丑陋的解决方案。:-) 你对这个或另一个更优雅的解决方案有什么改进吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-01T21:14:31.727

`$ (commandToWaitOn; commandToRunAfter) &`?

其中可选的 '&' 并将该对置于后台。

或者如果命令是独立启动的，找到 PID 并使用

```
wait PID; commandToRunAfter 
```

# c# - C# 泛型：引用类型与值类型

> ID：600525
> 
> 赞同：8
> 
> 时间：2009-03-01T21:09:40.273
> 
> 标签：c#, generics

*在编写我的 API 时，关于泛型引用类型与泛型值类型之间的差异，我遇到了很多困惑。*

两者在约束和功能（最重要/容易被忽视）方面有什么区别？

```
class ReferenceGeneric <T> where ???
{

} 
```

和

```
struct ValueGeneric <T>: where ???
{

} 
```

**编辑#1**只是为了澄清问题和我所追求的：我想知道你可以用通用引用类型做什么并且不能用通用值类型做什么（反之亦然）

**编辑#2**进一步说明：如果泛型类型是引用类型或值类型，如何限制 T？每种类型的约束方式是否存在差异？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-01T21:34:09.090

请注意，任何声明为结构的内容*始终*是值类型，而任何声明为类的内容*始终*是引用类型。换句话说，`List<int>`仍然是一个引用类型，如果你有：

```
struct Foo<T>
{
    T value;
} 
```

then`Foo<string>`仍然是一个值类型。

至于你可以用泛型类型*做*什么——它们实际上只是遵循值类型和引用类型的正常规则；至于您可以对类型`T` *中*的类型值做什么，这取决于是否/如何`T`受到约束。它不会根据泛型类型本身是结构还是类而有所不同。

编辑：萨沙`Nullable<T>`在评论中提到。我不确定这里的“异常”是什么意思——除了`Nullable<T>`不满足“ `where T : struct`”或“ `where T : class`”约束。尽管如此，它仍然是一个值类型（这是重点的一部分）。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-02T14:07:03.807

响应Edit2：您可以通过以下方式限制允许引用或值的类型：

参考：

```
class ReferenceGeneric <T> where T: class
{

} 
```

价值：

```
struct ValueGeneric <T> where T: struct 
{

} 
```

从 MSDN 上的以下页面 [http://msdn.microsoft.com/en-us/library/d5x73970.aspx](http://msdn.microsoft.com/en-us/library/d5x73970.aspx)

# c - 简单的开源绘画程序

> ID：600530
> 
> 赞同：0
> 
> 时间：2009-03-01T21:11:55.727
> 
> 标签：c, open-source, gtk, paint

我正在尝试扩展类似绘画的程序，为其添加自定义功能。你能推荐一个用 C 语言编写并使用我可以扩展的 GTK+ 库的简单开源画图类程序吗？它应该在 Linux 和 Windows 中编译（使用 MinGW）。谢谢。

编辑：

我找到[了这个](http://mtpaint.sourceforge.net/)，它看起来像我正在寻找的东西，但如果它存在，我想要更简单的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T21:33:10.293

我从来没有这种冲动，但我 4 岁的女儿喜欢[TuxPaint](http://www.tuxpaint.org/)。我相信它使用 GTK+。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-08T19:34:29.413

如果您想要一些*非常*简单的东西，我认为遵循[官方涂鸦教程](http://library.gnome.org/devel/gtk-tutorial/2.17/c2424.html)将是最佳选择。这是生成代码的[链接](http://git.gnome.org/cgit/gtk+/tree/examples/scribble-simple/scribble-simple.c)：您可以在 GTK+ 源代码压缩包中的 examples/ 下找到它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-12-03T04:14:04.550

[这是使用 GTK+ http://www.gtk.org/tutorial1.2/gtk_tut-23.html](http://www.gtk.org/tutorial1.2/gtk_tut-23.html)绘制的非常示例

源代码：[http ://www.gtk.org/tutorial1.2/gtk_tut-30.html#ss30.3](http://www.gtk.org/tutorial1.2/gtk_tut-30.html#ss30.3)

我希望这可以帮助你和其他人

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T21:43:42.220

这是 Sourceforge 软件浏览器的多媒体 -> 图形 -> 编辑器部分的链接，按最活跃的降序排列：

[http://sourceforge.net/softwaremap/trove_list.php?stquery=&sort=percentile&sortdir=desc&offset=0&form_cat=106](http://sourceforge.net/softwaremap/trove_list.php?stquery=&sort=percentile&sortdir=desc&offset=0&form_cat=106)

只需单击“过滤器”并为 C 添加一个编程语言过滤器，您就可以得到一组非常简洁的结果。

# python - 为什么 Google 搜索会返回 HTTP 错误 403？

> ID：600536
> 
> 赞同：18
> 
> 时间：2009-03-01T21:16:25.653
> 
> 标签：python, google-search

考虑以下 Python 代码：

```
30 url = "http://www.google.com/search?hl=en&safe=off&q=Monkey"
 31 url_object = urllib.request.urlopen(url);
 32 打印（url_object.read（））；

```

运行时，抛出异常：

```
File "/usr/local/lib/python3.0/urllib/request.py", line 485, in http_error_default
   raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)
urllib.error.HTTPError: HTTP Error 403: Forbidden 
```

但是，当将其放入浏览器时，搜索会按预期返回。这里发生了什么？我该如何克服这个问题，以便以编程方式搜索 Google？

有什么想法吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-12T20:46:05.080

这应该可以解决问题

```
user_agent = 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.7) Gecko/2009021910 Firefox/3.0.7'

url = "http://www.google.com/search?hl=en&safe=off&q=Monkey"
headers={'User-Agent':user_agent,} 

request=urllib2.Request(url,None,headers) //The assembled request
response = urllib2.urlopen(request)
data = response.read() // The data u need 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-01T21:22:09.043

如果您想通过编程接口“正确”地进行 Google 搜索，请查看[Google API](http://code.google.com/more/)。这些不仅是搜索谷歌的官方方式，如果谷歌改变他们的结果页面布局，它们也不太可能改变。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-04T06:22:55.503

正如[lacqui 所建议](https://stackoverflow.com/questions/600536/why-does-google-search-return-http-error-403/600551#600551)的，[Google API](http://code.google.com/more/)是他们希望您从代码中发出请求的方式。不幸的是，我发现他们的文档针对的是编写 AJAX 网页的人，而不是发出原始 HTTP 请求。我使用[LiveHTTP Headers](http://livehttpheaders.mozdev.org/)来跟踪示例发出的 HTTP 请求，我发现[ddipaolo 的博客文章](http://blog.ghcoders.net/2007/09/07/google-apis-no-soap-key-no-problem/)很有帮助。

还有一件事让我感到困惑：它们将您限制为查询的**前 64 个结果**。如果您只是为网络用户提供搜索框，这通常不是问题，但如果您尝试使用 Google 进行数据挖掘，则无济于事。我猜他们不希望您使用他们的 API 进行数据挖掘。64 这个数字随着时间的推移而变化，并且在搜索产品之间有所不同。

**更新：**看来他们绝对不希望您进行数据挖掘。最终，您会收到一个 403 错误，其中包含指向此[API 访问通知](http://code.google.com/apis/errors/)的链接。

> 请查看您正在使用的 API 的使用条款（链接在右侧栏中）并确保合规。我们可能会因以下违反使用条款之一而阻止您：我们收到了自动请求，例如抓取和预取。禁止自动请求；所有请求都必须是最终用户操作的结果。

他们还列出了其他违规行为，但我认为那是触发我的违规行为。我可能不得不调查雅虎的 BOSS 服务。好像没有那么多限制。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T21:20:45.893

你这样做太频繁了。谷歌有一些限制，以防止被搜索机器人淹没。您还可以尝试将用户代理设置为更类似于普通浏览器的内容。

# python - BOO 与 IronPython

> ID：600539
> 
> 赞同：16
> 
> 时间：2009-03-01T21:17:30.067
> 
> 标签：python, clr, ironpython, boo

[IronPython](http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython)和[BOO](http://boo.codehaus.org/)有什么区别？是否需要 2 种类似 Python 的语言？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-02T02:41:34.047

[IronPython](http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython)旨在成为 .NET 平台上 Python 的忠实实现。版本 1 以 Python 2.4 为目标以实现兼容性，版本 2 以 2.5 版本为目标（尽管不支持大多数用 C 实现的 Python 标准库模块）。

[Boo](http://boo.codehaus.org/)的既定目标是成为“用于 CLI 的手腕友好 [动态] 语言”。它从 Python 中汲取了很多灵感，但在四个要点上存在分歧：

1.  它专为充分利用 .NET 平台而设计
2.  设计师偏离了 Python 语法，他不同意设计决策（最明显的是，缺乏明确的自我）
3.  该语言被明确设计为“手腕友好” - 即最大限度地减少使用 Shift 键或其他多键组合的需要。
4.  Boo 默认是静态类型的，但允许可选的鸭子类型。

在实现/性能方面还有一些其他细微差别，但上述不同的设计目标应该（IMO）告知您选择的语言。

另外需要考虑的两件事是成熟度和社区。Python 比 Boo 成熟得多，并且拥有更大的社区。IronPython 也得到了微软的明确支持。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-01T21:22:36.933

IronPython 是一个 python 实现，而 Boo 是另一种具有 python 式语法的语言。一个主要区别是 Boo 默认是静态类型的。

我敢肯定还有更多的不同，我只是简单地看了 Boo，但我一直想更深入地研究一下（这么多语言，时间太少了！）。

以下是 Python 程序员的 Boo 陷阱列表，它很好地总结了这些差异：

*   [http://boo.codehaus.org/Gotchas+for+Python+Users](http://boo.codehaus.org/Gotchas+for+Python+Users)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-01T21:30:55.887

IronPython 是 Python。Boo 看起来像 Python。

他们有不同的目标，虽然 IronPython 的目标是像 Python 一样，但 Boo 却没有。Boo 并不像 IronPython 那样担心与 Python 的兼容性……

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-04-11T16:54:33.513

简而言之，Boo 声名鹊起的是它应该为您提供 Python 优雅、简洁的语法和非常高级的抽象的大部分好处，但不会牺牲（大部分）静态类型语言（如 C#）的速度优势.

# eclipse - 在 Eclipse JDT 中，如何最有效地在工作区中找到与完全限定名称相对应的 typeroot？

> ID：600550
> 
> 赞同：0
> 
> 时间：2009-03-01T21:21:51.680
> 
> 标签：eclipse, eclipse-jdt

JavaCore 类包含一个 create 方法，该方法允许我获取 ITypeRoot（类文件或编译单元的表示形式），给定一个体现文件位置的句柄标识符。

但是，我试图找到对应于特定全名的 typeroot（如果有的话）。

我能想到的唯一实现是扫描系统中的所有类型，获取每个类型的根（甚至不知道如何做到这一点），然后比较 FQN。

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-01T22:51:50.027

从 JavaCore 单例中，尝试：

```
ITypeHierarchy myHierarchy = newTypeHierarchy(IRegion region, WorkingCopyOwner owner, IProgressMonitor monitor); 
```

一旦有了层次结构，就可以很容易地以 IType 的形式遍历类文件层次结构。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-01-19T06:16:42.533

我假设你有一个`IJavaProject`参考。如果不是，那么您将不得不遍历工作区中的所有项目，因为 IType 会根据您所在的项目而有所不同，即使它们具有相同的限定名称。

你可以这样做：

```
ITypeRoot root = javaProject.findType(qualifiedName).getTypeRoot(); 
```

注意事项：

1.  `findType`可能返回null，所以需要检查一下
2.  该方法的此变体`findType`假定类型是顶级类型，而不是内部或非公共类型。如果您需要检查这些，则必须使用此变体：`IType findType(String fullyQualifiedName, IProgressMonitor progressMonitor)`

# iphone - 你如何获得 UITabBarController 中的可用边界

> ID：600561
> 
> 赞同：3
> 
> 时间：2009-03-01T21:27:51.133
> 
> 标签：iphone, user-interface

使用 UITabBarController 时，如何获取底部标签栏的大小？同样，您如何知道标签视图内有多少空间用于内容？我看到很多例子，人们将他们的标签子视图调整为 [[UIScreen mainScreen] applicationFrame]，这是不正确的，因为标签栏占据了屏幕底部的一些空间。

另外，是否可以修改标签栏的大小？

谢谢瑞恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-04-17T19:52:25.770

老问题，但无论如何：

如果您不从 NIB 加载视图，请在 loadView 函数中设置自动调整大小标志；像这样的东西：

```
self.view.autoresizingMask = UIViewAutoresizingFlexibleHeight |
                             UIViewAutoresizingFlexibleWidth; 
```

如果这样做，您可以使用 [[UIScreen mainScreen] applicationFrame] 来指定视图的框架；如果存在标签栏，它将自动调整大小。

如果您的视图有一个 NIB，则接口生成器会自动设置 autoresizingMask。

马库斯

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T01:31:07.820

如果您可以了解如何调整 UITabBar 的大小，那么您可以调整 UITabBarController 的 UITabBar 的大小。您可以通过以下方式访问该对象

```
[[UITabBarController subviews] objectAtIndex:0] 
```

但在文档中建议您不要直接访问该对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-03T11:59:32.187

您可以使用 applicationFrame 的原因是 UITabBarController 调整其子控制器的视图大小，因此只要您的视图支持正确调整大小，一切都会解决。

您可以通过访问标签栏控制器的 tabBar 属性并查看其框架来获取标签栏的大小。选项卡栏的总大小加上视图的区域可以通过查看选项卡栏控制器的视图属性的框架来找到，所以一点减法就会得到你正在寻找的数字：

```
CGFloat myViewHeight = tabBarController.view  .size.height
                     - tabBarController.tabBar.size.height; 
```

# .net - WinForms WebBrowser 控件：强制所有链接在新 (IE) 窗口中从外部打开

> ID：600564
> 
> 赞同：6
> 
> 时间：2009-03-01T21:30:24.810
> 
> 标签：.net, winforms, webbrowser-control

我认为标题涵盖了所有内容。我使用该控件显示一些带有一些标记的基本 HTML，其中可能还有链接。我想要做的是强制单击任何链接以在新的 IE 窗口中打开此链接，而不是导航到控件本身中的该页面。

任何的想法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-01T21:49:07.400

您可以处理 Navigating 事件，将 WebBrowserNavigatingEventArgs 的 Cancel 属性设置为 true，并使用 Process.Start 在 IE 中打开 URL。

像这样的东西：

```
private void webBrowser1_Navigating(object sender, WebBrowserNavigatingEventArgs e)
{
    // prevents WebBrowser to navigate
    if (e.Url.Host.Length > 0)    // Otherwise the default about:blank when you init the control doesn't work
    {
        e.Cancel = true;

        // Open the URL in an IE window 
        System.Diagnostics.Process process = new System.Diagnostics.Process();
        process.StartInfo.FileName = e.Url.ToString();
        process.Start();
    }
} 
```

# ruby - 字符串 count() 方法

> ID：600574
> 
> 赞同：8
> 
> 时间：2009-03-01T21:35:42.037
> 
> 标签：ruby

忙着学习Ruby...文档有一个例子：

返回 2 的 "hello world".count("lo", "o") 怎么返回 2？

在我的示例中，我有： puts "Lennie".count("Le", "ie") 返回 2。

count 在这方面是如何工作的？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-01T21:54:54.423

`"hello world".count("lo")`返回五个。它匹配了第三个、第四个、第五个、第八个和第十个字符。让我们称这一套。

`"hello world".count("o")`返回两个。它匹配了第五个和第八个字符。让我们称这组为二。

`"hello world".count("lo", "o")`计算第一组和第二组的交集。

[交集](http://en.wikipedia.org/wiki/Intersection_%28set_theory%29)是第三个集合，它包含了集合 2 的所有元素，这些元素也在集合 1 中。在我们的示例中，集合 1 和 2 都包含字符串中的第五个和第八个字符。总共是两个字符。所以，`count`返回两个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-01T21:57:48.847

如果你给 count 多个参数，它只计算所有参数中的字母。所以在你的第一个例子中，它只计算 o。在你的第二个例子中，它只计算 e。

# watin - 如何使用 watiN 单击表格标签？

> ID：600590
> 
> 赞同：0
> 
> 时间：2009-03-01T21:39:10.483
> 
> 标签：watin

这是我需要点击的表格标签。我想这是调用一些 JS 函数。我不知道如何解决它。

table id="btnTbl_compose:send_message" class="buttonTable axsButton" cellpadding="0" title="发送此消息 (Ctrl+Enter) | 发送此消息并保留现有草稿 (Shift+Click)" boid="messageToolbar_compose:send_message " cmd="compose:send_message" state="normal" style="" onmouseover="Uo.Z(event, this)" unselectable="on"> 发送

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-08-06T14:53:17.103

我认为（就我的问题而言）这条线对你有用：

```
ie.Table("btnTbl_compose:send_message").Click() 
```

# web-services - Delphi Web Service Importer 和 NonAscii 字符问题

> ID：600591
> 
> 赞同：0
> 
> 时间：2009-03-01T21:39:56.533
> 
> 标签：web-services, delphi

我正在使用 Delphi 2009 更新 2。Borland WSDLIMP 版本 2.3 - $Rev: 16699 $

**为什么标识符 rápido 显示为 r_pido ？**
**角色á去哪儿了？**
这是 WSDLIMP 错误还是 MS XML 错误？

感谢您的回复

**文件.XSD**

```
<?xml version="1.0" encoding="UTF-8"?>
....
....
....
<xs:simpleType name="displayName">
<xs:restriction base="st">
<xs:enumeration value="rápido"/> //-----> attention !!!
<xs:enumeration value="lento"/>
....
....
.... 
```

**命令提示符 -->**

```
wsdlimp -Oe- -Ow+ -P -= "c:\myWsdlFile.wsdl"=myService.pas 
```

**我的服务.pas**

```
.....
.....
unit myService.pas;

interface

uses InvokeRegistry, SOAPHTTPClient, Types, XSBuiltIns;
......
.....
displayName = (
r_pido, //---> attention!!! á Where did it go?
lento); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-02T07:55:08.897

我看到你几周前[在 Embarcadero 论坛上](https://forums.codegear.com/thread.jspa?messageID=79311)问过这个问题。

我怀疑 WSDLImp 实用程序尚未针对 Delphi 2009 的 Unicode 支持进行更新。相反，它会继续生成与早期版本相同的 Delphi 源文件，从而确保任何 Delphi 版本都可以使用生成的源文件。该实用程序尚未收到重大更新的一个线索是，它仍然将自己列为 Borland 产品，而不是 CodeGear 或 Embarcadero。仅仅因为它被重新编译并且具有不同的版本号（2.2 与 2.3）并不意味着它得到了与编译器和 IDE 相同的大修，这对于生成 Unicode 源文件是必要的。

要检查的一件事是您的文件确实被编码为 UTF-8。文字`á`字符在 UTF-8 中被编码为两个字节，因此它不一定会在编辑器中显示为该字符。确保文件具有该字符应位于的字节 C3 A1。如果没有，那么您可能只是看到 WSDLImp 如何处理输入文件中的无效字节。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T08:45:23.597

> 我怀疑 WSDLImp 实用程序尚未更新为 Delphi 2009 的 Unicode 支持

c:\Program files\codegear\rad studio\6.0\source\win32\soap\wsdlimporter\WSDLImp.dpr 再次使用 delphi 2009 编译。

> 要检查的一件事是您的文件确实被编码为 UTF-8

file.xsd 用记事本打开。另存为--> 编码--> UTF8--> 保存

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T21:46:26.597

不完全确定您的意思，但我怀疑 á 在 rápido。尝试在 rapido 中使用“a”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T07:39:41.523

rápido 是 delphi 2009 的正确标识符（delphi 2009 完全支持 unicode）

# c# - 在 C# 中反序列化 XML 时如何获取对父对象的引用？

> ID：600597
> 
> 赞同：1
> 
> 时间：2009-03-01T21:42:24.890
> 
> 标签：c#, .net, serialization, parent-child

我似乎无法正常工作，这是我的（精简版）代码：-

```
[XmlRoot("report")]
public class Report
{
    [XmlArray("sections"), XmlArrayItem("section")]
    public List<Section> Sections;
}

public class Section
{
    public Report Report;
} 
```

我错过了什么吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-01T21:44:45.383

[您的对象包含XmlSerializer](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlserializer.aspx)类不支持的循环引用。您可以改为查看[支持](http://www.jameskovacs.com/blog/GoingAroundInCirclesWithWCF.aspx)此类场景的[DataContractSerializer 。](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.datacontractserializer.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T00:38:26.760

你应该确保你知道你希望这些类如何序列化和反序列化。编写您想要的 XML 作为结果，并弄清楚您希望对象如何成为 XML，反之亦然。这不是一件容易的事。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T08:35:02.730

这是我的解决方案。它可能没有你想象的那么优雅：

```
public class Report
{
  //...

  void PostLoad()
  {
    foreach(Section s in Sections)
    {
      s.Report = this;
    }
  }

  public static Report Load(string filename)
  {
    // Load using an XmlSerializer
    Report report = ...;

    report.PostLoad();

    return report;
  }
} 
```

# java - Java 出现挂起

> ID：600604
> 
> 赞同：7
> 
> 时间：2009-03-01T21:46:41.527
> 
> 标签：java, debugging, freeze, java-service-wrapper

我在自定义应用程序中使用 Java 服务包装器已经有一段时间了，它运行良好。由于最近几天将我们的应用程序更新到新版本，JVM 开始挂起，然后包装器在日志中打印：JVM 出现挂起：等待来自 JVM 的信号超时。

然后它会自动终止 JVM 并再次启动应用程序。这发生在运行大约 10 小时后，这使得调试变得更加困难。

当然，我将查看我们所做的更改，但没有进行我怀疑会导致此类问题的重大更改。

我在哪里可以尝试找出正在发生的事情？来自应用程序的调试消息并不表示任何有趣的事情。如果 JVM 只是崩溃，它通常会创建一个转储，这有助于调试它，但它会挂起，所以它不会创建一个转储。如果我让它不自动重新启动服务，在重新启动它之前我可以做些什么来从 JVM 中获取一些有用的信息？

在我看来，JVM 不应该因典型的编程错误而挂起。在此之前您遇到过什么会导致 JVM 挂起的情况？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-01T21:55:10.303

阅读[wrapper.ping.timeout 属性](http://wrapper.tanukisoftware.org/doc/english/prop-ping-timeout.html)。包装器软件经常与您的 JVM 通信，以确保它处于活动状态。如果该通信由于某种原因失败，则包装器认为该进程已挂起并尝试重新启动它。

根据您的应用程序的架构方式，当包装器尝试“ping”它时，您的 JVM 可能正忙于处理其他事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-01T23:47:33.373

看看你是否可以使用[Visual VM](https://visualvm.dev.java.net/)来看看发生了什么。让 Visual VM 全程监控应用程序，当它停止工作时，您或许可以确定问题所在。

如果 VM 挂起，您可以获取线程的状态...我认为 Visual VM 将使它比通常的 ctrl-break （或任何组合键）更容易一些。

（根据评论编辑）

> 试过这个。上次它挂起的线程数和正在使用的内存量都非常低，所以这些都没有导致问题。不幸的是，在它挂起并且包装器终止它之后，您无法获得线程转储。

有没有什么方法可以在没有包装器的情况下运行它来调试它？此外，如果您使用 NetBeans 分析器，它可能会给您一个在它停止时处理它的机会（我将在今天晚些时候检查，看看我是否能发现它的行为是否会有所不同）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-01T21:54:34.690

你在什么环境？操作系统、JVM 版本、硬件架构？

这听起来确实像一个错误，并且考虑到它需要很多小时，这听起来像是某种资源耗尽错误。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-09T14:01:40.720

我在类路径（JBPM）上有几个不同版本的库。使用 wrapper，您可以使用通配符来包含 jar。不过要小心这一点，因为您可能不小心包含了超出您应有的内容。

这是一篇 IBM 文章，其中提供了有关[在 Java 中调试挂起的](http://publib.boulder.ibm.com/infocenter/javasdk/v1r4m2/index.jsp?topic=/com.ibm.java.doc.diagnostics.142j9/html/debughangwin.html)信息。它基本上说有两件事会导致挂起：

1.  无限循环，
2.  一个僵局。

从那以后，我不得不调试其他悬挂问题。在 linux 上，您可以向 JVM 发送 QUIT 信号，使其向控制台执行线程转储。这确实有助于找出问题所在。使用这个命令来做到这一点：kill -QUIT

2017 年 6 月 13 日编辑

这些天我使用JDK中包含的jmap来转储程序的整个内存。然后我使用 Eclipse Memory Analyzer 来查看程序崩溃时的确切状态。您可以查看活动线程列表，然后检查每个堆栈帧中的变量。

```
/usr/java/latest/bin/jmap -dump:file=/tmp/app-crash.hprof <PID> 
```

其中 PID 是 java 进程的进程 ID。

# c# - .Net/C#：整数的实际大小是多少？

> ID：600607
> 
> 赞同：3
> 
> 时间：2009-03-01T21:48:16.017
> 
> 标签：c#, integer

在 .Net 中，整数是值类型，这意味着它存储在堆栈中。整数也是类（通常是 System.Int32）。它们有CompareTo、Equals、...等方法。因此，它们应该在堆栈上占用超过四个字节。然而，下面的示例显示它们恰好占用 4 个字节：

```
unsafe static void Main()
{
    int a = 2, b = 4;
    Console.WriteLine("Adress of a : {0}", (int)&a);
    Console.WriteLine("Adress of b : {0}", (int)&b);
    Console.WriteLine("Size of integer: {0}", (int)(&a) - (int)(&b));
} 
```

输出：

```
Adress of a : 1372876
Adress of b : 1372872
Size of integer: 4 
```

CLR 是否对整数和其他值类型（float、long、double、...）进行了特殊处理？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-01T21:52:42.230

不，它们是值类型这一事实并不意味着它们存储在堆栈中。这意味着它们存储[在变量所在的任何地方](http://pobox.com/~skeet/csharp/memory.html)。

但是，嘿，让我们继续使用局部变量业务，此时（没有捕获等）它们*确实*存在于堆栈中。它们占用 4 个字节。为什么他们会拿更多？堆栈上不需要 vtable，因为元数据已经指定了类型：对于将调用哪些虚拟方法等没有歧义。

编辑：正如肖恩在评论中指出的那样（但我想让它更明显），[System.Int32](http://msdn.microsoft.com/en-us/library/system.int32.aspx)是一个结构，而不是一个类。（事实上​​，CLR 将创建一个影子引用类型来覆盖 int 的装箱值，但这是另一回事。）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-01T21:52:37.657

> 因此，它们应该在堆栈上占用四个以上的字节。

这不遵循。编译器*和*运行时知道确切的类型。值类型不能进一步子类型化，因此不需要“vtable”或其他特定于对象的动态调度机制。

当值类型被装箱以将它们放在堆上时，需要正常的 .NET Object 标头。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-01T22:17:05.323

如果值类型是方法中的局部变量，则在堆栈上分配值类型。如果一个值类型是一个类的成员，它将作为对象在堆上的内存区域的一部分进行分配。

值类型变量不需要任何额外的数据来跟踪类型，就像引用类型一样。编译器总是知道值类型变量在哪里以及它们的类型是什么，因此除了实际数据之外不需要额外的数据。Int32 变量总是四个字节。

在堆上分配了一个引用类型，并且它有一个（或更多）指向它的引用。引用本身实际上是一个值类型，所以它只是一个指针，编译器会跟踪它在哪里以及它是什么类型。引用的类型不必与它所指向的对象的类型相同，因此对象需要额外的信息来跟踪类型。例如，指向 StringBuilder 类实例的对象引用：

```
object o = new StringBuilder(); 
```

在这里，编译器跟踪引用的类型是对象，因此它只是一个指针（在 32 位应用程序中为 4 个字节）。StringBuilder 对象存储在堆上，它有两个额外的指针来跟踪实际类型。

值类型也可以被装箱，即作为对象存储在堆上。当您将值类型转换为 Object 时会发生这种情况：

```
object p = 42; 
```

这将在堆上分配一个对象并将整数的值复制到其中。该对象将需要额外的类型信息来跟踪类型，因此它将在堆上使用 12 个字节而不是 4 个字节（在 32 位应用程序中）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-20T12:47:43.053

类型定义和为该类型的实例存储的值之间存在差异，例如......

```
// type definition
public class Bla {}
// instance of type bla
public Bla myBla = new Bla(); 
```

本质上，一个 int 的大小就像它看起来的那样（4 个字节），但正如您所知道的，这就是它需要声明的内存空间的大小。

类型定义存储在其他地方，像 CompareTo 这样的方法仅以这种方式声明一次，而不是为您声明的该类型的每个实例声明一次，并且由于它们是作为框架库本身的一部分加载的，因此对于您的应用程序而言，这些定义有效地占用0空间。

# php - file_get_contents 创建一个空文件

> ID：600611
> 
> 赞同：3
> 
> 时间：2009-03-01T21:51:03.467
> 
> 标签：php

在 if 子句中用作测试条件时，如何防止 file_get_contents 创建空文件？

无论如何都会创建一个空文件，这会导致后续以不同的方法调用 getimagesize() 失败。

问题是，因为我有我的代码设置，第一次调用它将决定保存图像或显示以前保存的图像。这部分取决于文件的存在。由于创建了一个空文件，这会在随后调用我的代码时导致问题。

添加检查文件是否存在并且大于0的最简单方法是什么？

不管我的代码是否有效，file_get_contents 仍然会输出错误。这个错误被解释和处理（通过我的 if 条件），所以我想尽可能避免错误中断我的应用程序的输出。有没有办法在不隐藏实际错误的情况下关闭它？

```
if (file_put_contents($imageDir . $pk . '.jpg', file_get_contents($pic_url))) 
{
        return $imageDir . $pk . '.jpg'; 
} 
else 
{
        return 'removed.jpg';
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T21:52:49.950

使用以下命令检查文件是否存在[`file_exists`](http://docs.php.net/file_exists)：

```
if (file_exists($pic_url)) {
    $contents = file_get_contents($pic_url);
    if (!empty($contents)) {
        file_put_contents($imageDir . $pk . '.jpg', $contents);
        return $imageDir . $pk . '.jpg';
    }
}
return 'removed.jpg'; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-02T01:24:23.250

创建空文件的不是 file_get_contents()，而是 file_put_contents()。

即使第二个参数为空，file_put_contents() 也会创建一个文件。因此，空文件。

您需要先检查文件是否存在。

最简单的解决方法是将 file_put_contents() 移动到条件中，以便它仅在有内容时才创建文件。

```
if (($filecontents = file_get_contents($pic_url)) !== false) 
{
    file_put_contents($imageDir . $pk . '.jpg', $filecontents);
    return $imageDir . $pk . '.jpg'; 
} 
else 
{
    return 'removed.jpg';
} 
```

现在，这仍然给你留下了一堆问题。

*   除非您正确验证 $pic_url，否则您将面临安全漏洞。如果用户输入本地文件的相对路径怎么办？
*   如果找不到文件，file_get_contents() 将引发警告。通常，您会通过首先检查 file_exists() 来处理这个问题，但这在这里是不可能的，因为 http: 包装器不支持 file_exists()。因此，您可以在 file_get_contents() 之前使用 @ 来抑制错误。在大多数情况下，应避免抑制此类错误。
*   即使你用 '@' 抑制错误，对 file_get_contents() 的调用仍可能需要一些时间 - 如果地址错误，可能会导致服务器没有回复，这将导致它超时（可能30 秒）在此期间您的脚本不会运行，因此最终用户无法获得任何反馈。在您的应用程序中应该考虑到这一点。

# .net - 制作基于网络的 2 人文本游戏

> ID：600621
> 
> 赞同：3
> 
> 时间：2009-03-01T21:53:51.773
> 
> 标签：.net, javascript, python, ajax

我正在制作一个简单的基于网络的回合制游戏，并试图确定存在哪些模块来帮助我完成这项任务。

这是我要构建的网络应用程序：

*   用户访问主页，点击“玩游戏”链接
*   这会将用户带到一个“游戏室”，在那里他要么加入一直在等待伙伴一起玩的其他人，要么等待某人加入他的行列
*   只要房间里有两个用户，游戏就开始了。这是一款非常简单的回合制文字游戏。一个用户输入一个数字，然后另一个用户通过输入另一个数字来响应，以此类推，直到满足某些条件并且游戏结束；每个玩家都会看到他们的最终得分。

我的默认计划是使用 Django 和 AJAX 来执行此操作。是否有任何现有的模块/框架可以节省我从头开始编写的一些工作？（注意：如果有一些很棒的 .NET 库，我也许可以协商在 .NET 中完成这项工作。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-02T13:08:22.153

如果您不打算拥有大量并发用户或希望快速完成，我会选择在服务器上保持游戏状态并通过 Ajax 进行轮询。

您选择的 js 库将使轮询更容易。

如果您希望它更大更复杂，您可以查看[Strophe](http://code.stanziq.com/strophe/)，这是一个用于编写 XMPP 客户端的 js 库——它有一些示例站点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T22:10:31.297

试试[Jabber](http://www.jabber.org)协议……它非常适用于 IM，但也适用于其他类型的系统，并且由于 Python变得如此流行，因此已经有一组[绑定。](http://xmpppy.sourceforge.net/)

# sql - 最完整的支持 LINQ 的 ORM？

> ID：600622
> 
> 赞同：13
> 
> 时间：2009-03-01T21:54:26.967
> 
> 标签：sql, linq-to-sql, orm

我正在寻找一个提供完整或接近完整 LINQ 支持的 ORM。

LINQ to SQL
- 支持 LINQ 内部的所有内容（.Contains、Math.Log 等）
- 在不创建新数据上下文的情况下无法急切加载关系属性

ADO.NET Entity Framework
- 糟糕的 LINQ 支持（很多缺失的功能）。
- 出色的映射功能 - 可以使用 ObjectQuery<> 上的 .Include 方法按需加载

LightSpeed
- 出色的 LINQ 支持缺少某些功能（.Contains 包含在 Where 中）
- 生成的某些 SQL 效率非常低。

这些似乎都不是完美的，老实说，我希望我能从每一个中提取点点滴滴。我个人非常喜欢 ADO.NET EF，只是它缺少的功能使它使用起来令人沮丧。

我知道有些人赞美 NHibernate 上下，我没有敲它，但我花了今天尝试它，没关系，但它的 LINQ 支持不是那么好。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-07-31T12:24:00.243

试试 DataObjects.NET。我是 DO 开发人员之一。我在该项目中的最新活动是为 DataObjects 实现 LINQ。所以我可以简单描述一下：

*   支持几乎所有 LINQ 方法，除了 Last/LastOrDefault/Aggregate/Reverse/TakeWhile/SkipWhile 等以及具有 .NET 特定参数的方法 - 例如 IComparer（没有人支持它们）。
*   支持几乎所有字符串和数学方法（您可以编写自己的函数映射！）。
*   GroupBy\SelectMany\Contains\Single\etc 的复杂场景。支持子查询和相关子查询。

我们有大约 1000 次 LINQ 实现测试，其中 99% 通过。所以我可以说当前的实现接近 EF。有些方法不适用于 EF，有些方法适用于我们的框架。检查此简要说明[http://www.x-tensive.com/Products/DO/](http://www.x-tensive.com/Products/DO/)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-01T22:57:10.157

Llblgen 似乎有很好的 linq 支持。Frans 有一系列关于他开发的博客文章[http://weblogs.asp.net/fbouma/archive/2007/09/11/developing-linq-to-llblgen-pro-day-0.aspx](http://weblogs.asp.net/fbouma/archive/2007/09/11/developing-linq-to-llblgen-pro-day-0.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-01T22:59:46.453

OpenAccess [http://www.telerik.com/products/orm.aspx](http://www.telerik.com/products/orm.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-08T11:33:56.430

[DataObjects.Net](http://dataobjects.net)具有近乎完整的 LINQ 支持。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-31T12:33:05.847

SubSonic 的最新版本 3.0 已围绕 Linq 的使用完全重写 - [http://subsonicproject.com/docs/3.0_Summary](http://subsonicproject.com/docs/3.0_Summary)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-01T22:46:28.090

我对EF也有同样的问题。我想将它用于它的映射，但由于缺乏良好的 linq 支持而放弃了它。

我不确定急切加载关系属性是什么意思，但您可以使用普通的 linq-2-sql 急切加载。

你用`LoadOptions.LoadWith<T>(expression).`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-11T11:58:16.193

Signum Framework 有一个 linq 提供程序，[http://www.signumframework.com/DatabaseQuery.ashx](http://www.signumframework.com/DatabaseQuery.ashx)，并且有一个完全不同的加载实体的方式。没有数据上下文。

它只适用于新应用程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-11T12:08:26.293

NHibernate 与 Linq 到 NHibernate

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-03T18:38:03.260

[基因组](http://www.genom-e.com/)。

> Genome O/RM 使用 LINQ 生成数据访问层，将 Microsoft SQL Server、Oracle 和 IBM DB2 等关系数据库系统连接到您的 .NET 企业应用程序。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-10-10T19:55:57.213

EntityFramework 5.0 只是摇滚，虽然它与 nhibernate 相比缺少一些功能，但在 LINQ 支持方面它非常完整，比 nhibernate 好得多。Nhibernate 有 SessionFactory 和 Session 的概念，而 entityframework 有 DbContext 的概念，它类似于 nhibernate 的会话，但更容易设置和管理，您可以连接到许多数据库，您只需要为每个数据库定义一个 DbContext 和实例化 SpecificDbContext 以开始和编写针对特定 DB 的 LINQ 查询。

# iphone - 提高简单动画的平滑度

> ID：600636
> 
> 赞同：4
> 
> 时间：2009-03-01T22:08:00.930
> 
> 标签：iphone, animation

我正在开发我的第一个 iPhone 应用程序，并且我已经通过了“机械”，现在我正在总结适合和完成的细节。

我的设置窗格有一个从屏幕底部滑入的视图。视图本身的不透明度为 0，内部有一个 UIImageView 视图，其中一个 PNG 在控件后面为视图创建实际背景。我正在使用 UIView 的内置动画调用，如下所示；

```
[self.view addSubview:settingsViewController.view];

[UIView beginAnimations:nil context:nil];
[UIView setAnimationDuration:0.5];
[UIView setAnimationCurve:UIViewAnimationCurveEaseOut];

frame.origin.y = 200.0;
settingsViewController.view.frame = frame;

[UIView commitAnimations]; 
```

不幸的是，设备上的动画不连贯。我用作背景的 PNG 仅在其宽度的最上面 30 个像素中是透明的。如果我使用没有透明度的 PNG，则动画很流畅。

应用程序本身是高度图形化的，因此视图在充满其他 PNG 的屏幕上显示动画。

如果设备不能流畅地处理这种类型的动画，我会感到非常惊讶，这让我相信我需要改进我的方法。到目前为止我的想法包括：

也许我需要直接使用核心动画？在动画之前缓存设置窗格后面的视图会有所帮助吗？

这对我来说是一个新领域，我知道必须有优化的方法被认为是好的做法。谢谢你的时间！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-03T05:18:54.347

如果您“直接”使用 Core Animation 或为 center 属性设置动画，这并不重要：它是不稳定的，因为图形硬件必须在动画的每一帧上将透明图像与背景合成。您自己说过，使用完全不透明的 PNG 可使动画流畅。

尝试在 Instruments 下运行应用程序，Core Animation 工具有一些复选框可以实时突出显示合成区域，这可能会给你一些关于重新绘制的提示。

如果只需要顶部的 30 个像素是透明的，则可能值得将背景分成两个视图，一个位于顶部的 30 像素条（透明），其余的（不透明）。如果它在每一帧合成整个视图，那么这种变化可能足以让它知道它只需要合成顶部的 30 个像素。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T22:21:24.827

过去我在为框架设置动画时遇到了一些问题，请尝试为 center 属性设置动画。

另外，您需要背景图像的透明度做什么？您是否可以只使用该图像作为包含视图的背景并消除对 UIImageView 的需要？

# oop - 没有初始化的 OCaml 数据成员

> ID：600637
> 
> 赞同：2
> 
> 时间：2009-03-01T22:08:41.613
> 
> 标签：oop, ocaml, data-members

我想使用 OCaml 创建一个带有数据成员的对象，但不一定要为数据成员指定初始值。许多示例似乎使用列表，但我想使用我创建的对象类型的单个实例。这可能吗？谢谢。

```
class bar = object end;;

class foo =
object (self)
val myDataMember = ((* ??? *) : bar)
end;; 
```

此外，我尝试了 option 关键字无济于事：

```
class bar = 
object (self) 
    method doIt = Printf.printf "Doing it!"
end;;

class foo bar =
object (self)
  val mutable myDataMember = (None : bar option)
  method get = myDataMember
end;;

let f = new foo (new bar);;
f#get#bar#doIt;; 
```

在这里，当我希望将数据成员指定为 bar 类型时，编译器会抱怨该数据成员具有“bar option”类型。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-02T01:31:52.640

您必须使用可选类型：

```
class foo =
object (self)
val myDataMember = (None : bar option)
end;; 
```

当然，要使其可用，您可能必须使用可变的：

```
class foo =
object (self)
  val mutable myDataMember = (None : bar option)
  method set t = myDataMember <- (Some t)
  method get () =
    match myDataMember with
    Some x -> x
    None -> failwith "not initialized"
end;; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T15:36:45.343

> f#get#bar#doIt;;
> 
> 在这里，当我希望将数据成员指定为 bar 类型时，编译器会抱怨该数据成员具有“bar option”类型。

回答你的新问题。您没有将其指定为 type `bar`，而是将其指定为 of `bar option`（恰好在您键入 时`(None : bar option)`）。要访问它，您需要匹配 -- 这在`get`方法中可能会更好，但这一点是有效的。

```
match f#get#bar with
  | Some x -> x#doIt
  | None -> failwith "value not initialized" 
```

我不知道`bar`你写的时候是什么意思`class foo bar`，但它是类`foo`（功能对象）的参数，与类无关`bar`。看一下 的类型定义`foo`。

```
'a -> object val mutable data : bar option method get : bar option end 
```

这是一个对象，它接受一个任何类型的参数并构造该对象的一个​​实例。总体而言，我认为您不希望将选项类型作为解决方案，而是利用功能对象，如下所示：

```
class bar = object (self)
    method doIt = Printf.printf "Doing it"
end

class foo (arg1:bar) = object (self)
    val mutable data = arg1
    method get = data
    method set new_data = data <- new_data
end 
```

# c# - 为什么 C# 的编译速度比 C++ 快得多？

> ID：600639
> 
> 赞同：14
> 
> 时间：2009-03-01T22:09:23.657
> 
> 标签：c#, c++, compiler-construction

我注意到在同一台机器上，C# 的编译时间比 C++ 少得多。为什么？

注1：我没有做过任何科学基准。

注意2：在有人说这与编程无关之前，我正在实现一个解析器，我正在寻找从一开始就可以做些什么来提高编译速度。

NOTE3：我有一个类似的问题[为什么编译需要这么长时间？](https://stackoverflow.com/questions/588884/why-do-compilations-take-so-long). 这个问题是询问从 C/C++ 到 C# 的具体区别。很明显，简单的语言比复杂的语言编译起来更快，但是 C 和 C# 都是复杂的语言。

我的外卖：1）C/C++ 从预处理器和头文件来看很慢。2）很多标题会导致更多数据解析。特别是当每个文件都可以使用预处理器时可以更改代码 3）C# 将一些编译推迟到程序启动 4）IL 指令很简单，机器不是

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-01T22:43:32.310

有两个单独的问题需要考虑 - 处理阶段的数量和定位的复杂性。

典型的 C++ 编译涉及多个阶段（尽管这些可能同时运行），其中预处理器处理指令和宏，然后 C++ 编译器本身处理生成的代码。预处理器生成更大的输出是很常见的，所有代码都需要由实际的编译器解析和处理。

另外，请记住，C++ 编译器将针对 x86 或 x64 机器语言 - 预先处理所有优化，并尝试充分利用在 OO 样式开发中未真正优化的硬件。

相比之下，C# 编译器的目标是 Microsoft 中间语言 (MSIL)，这是一种更高级别的类似机器代码的平台，旨在用于 OO 开发。C# 提供的许多结构直接映射到 IL 指令，使编译变得非常容易。相当多的优化和其他活动被推迟到实际程序启动时，此时它针对确切的可用机器进行了优化。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-01T22:12:44.007

因为 C++ 编译为机器码，而 C# 编译为字节码。首次启动 .NET 程序时，您是否注意到*滞后。*这是字节码被 JITed（编译为机器码）的时候。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-01T22:36:39.800

我认为这可能是因为它必须解析的数量，而不是解析器本身的速度。

C++ 通常使用 C 预处理器，它会引入大量包含文件（正如其他人所建议的那样，另一个问题包含许多类似的答案）。这会增加要解析的代码量。

因此，如果您出于编写解析器的目的比较它们...请了解您不应该拥有 .h 样式的包含文件 :)

# erlang - 如何在 Erlang 中连接两个二进制文件？

> ID：600642
> 
> 赞同：54
> 
> 时间：2009-03-01T22:11:30.360
> 
> 标签：erlang, binaries

如何在 Erlang 中连接两个二进制文件？

例如，假设我有：

```
B1 = <<1,2>>.
B2 = <<3,4>>. 
```

如何连接 B1 和 B2 以创建二进制 B3，即 <<1,2,3,4>>？

我问这个的原因是因为我正在编写代码来为某些网络协议编码一个数据包。我通过为数据包中的字段编写编码器来实现这一点，我需要连接这些字段以构建整个数据包。

也许我这样做是错误的。我应该将数据包构建为整数列表并在最后一刻将列表转换为二进制吗？

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2009-03-02T07:03:48.630

```
28> B1= <<1,2>>.
<<1,2>>
29> B2= <<3,4>>.
<<3,4>>
30> B3= <<B1/binary, B2/binary>>.
<<1,2,3,4>>
31> 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-03-01T23:40:41.720

您可以使用位语法连接二进制文件：

```
1> B1 = <<1,2>>.
<<1,2>>
2> B2 = <<3,4>>.
<<3,4>>
3> B3 = <<B1/binary, B2/binary>>.
<<1,2,3,4>> 
```

在许多情况下，特别是在数据发往网络的情况下，您可以通过构建 io_list 来避免串联。

```
B3 = [B1, B2],
gen_tcp:send(Socket, B3). 
```

这是 O(1)，因为它避免了复制任何一个二进制文件。`gen_tcp:send`将接受深度列表并遍历结构以进行输出。（两个元素列表占用的额外内存非常少，因此内存开销很小。）

在某些情况下（重复附加到同一个二进制文件），Erlang 现在进行了优化，可以避免复制附加到的二进制文件，因此使用 io_lists 可能不太相关：[http ://erlang.org/doc/efficiency_guide/binaryhandling.html#constructing-二进制文件](http://erlang.org/doc/efficiency_guide/binaryhandling.html#constructing-binaries)

* * *

历史记录：我最初只建议 io_list 解决方案，并且很多评论者正确指出我没有回答这个问题。希望现在接受的答案是完整的。（11 年后！）

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2014-02-19T15:38:14.090

要使用 io_list，您可以执行以下操作：

```
erlang:iolist_to_binary([<<"foo">>, <<"bar">>]) 
```

这是好的和易读的。如果更方便的话，你也可以在其中使用列表和东西。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-12-17T19:54:41.487

以最后一个答案为基础：

```
bjoin(List) ->
    F = fun(A, B) -> <<A/binary, B/binary>> end,
    lists:foldr(F, <<>>, List). 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-03-01T22:14:59.197

使用 erlang 函数 list_to_binary(List) 你可以在这里找到文档： [http ://www.erlang.org/documentation/doc-5.4.13/lib/kernel-2.10.13/doc/html/erlang.html#list_to_binary /1](http://www.erlang.org/documentation/doc-5.4.13/lib/kernel-2.10.13/doc/html/erlang.html#list_to_binary/1)

# ruby-on-rails - RoR mySQL 错误

> ID：600647
> 
> 赞同：1
> 
> 时间：2009-03-01T22:13:31.883
> 
> 标签：ruby-on-rails

我正在使用`Netbeans 6.5`并启动一个 Rails 项目，但收到以下错误，但我已经安装了 mySQL。运行 Windows XP。

> TestController#index 中的 LoadError
> 
> 126：找不到指定的模块。-c:/ruby/lib/ruby/gems/1.8/gems/mysql-2.7.3-x86-mswin32/ext/mysql.so
> 
> RAILS_ROOT：C:/Temp/RailsApplication1 应用程序跟踪 | 框架跟踪 | 全跟踪
> 
> c:/ruby/lib/ruby/gems/1.8/gems/mysql-2.7.3-x86-mswin32/ext/mysql.so c:/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:36 :in `require' c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:153:in`要求'c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:521:in`new_constants_in' c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:153:in`要求'c:/ruby/lib/ruby/gems/1.8 /gems/activesupport-2.2.2/lib/active_support/core_ext/kernel/requires.rb:7:in `require_library_or_gem' c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/core_ext/kernel/reporting.rb:11:in` quiet_warnings' c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support /core_ext/kernel/requires.rb:5:in `require_library_or_gem' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/mysql_adapter.rb:63:in` mysql_connection' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:223:in `send' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:223:in` new_connection' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:245:in `checkout_new_connection' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:188:in` 结帐' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:184:in `loop' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:184:in` checkout' c:/ruby/lib/ruby/1.8 /monitor.rb:242:in `synchronize' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:183:in` checkout' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:98:in `connection' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:326:in` retrieve_connection' c: /ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_specification.rb:121:in `retrieve_connection' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_specification.rb:113:in` connection' c:/ruby/lib/ruby/gems/1.8/gems /activerecord-2.2.2/lib/active_record/query_cache.rb:8:in `cache' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/caching/sql_cache.rb:12:in` perform_action' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/base.rb:524 ：在 `send' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/base.rb:524:in` process_without_filters' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/filters.rb:606:in `process_without_session_management_support' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/session_management.rb:134:in` process' c:/ruby/lib/ruby/gems/1.8/gems /actionpack-2.2.2/lib/action_controller/base.rb:392:in `process' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:183:in` handle_request' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:110 :in `dispatch_unlocked' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:123:in` dispatch' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:122:in `synchronize' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:122:in` dispatch' c:/ruby/lib/ruby/gems/1.8 /gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:132:in `dispatch_cgi' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:39:in` dispatch' c:/ruby/lib/ruby/gems/1.8/gems/rails-2.2.2/lib/webrick_server.rb:103 :in `handle_dispatch' c:/ruby/lib/ruby/gems/1.8/gems/rails-2.2.2/lib/webrick_server.rb:74:in` service' c:/ruby/lib/ruby/1.8/webrick/httpserver.rb:104:in `service' c:/ruby/lib/ruby/1.8/webrick/httpserver.rb:65:in`run' c:/ruby/lib/ruby/1.8/webrick/server.rb:173:in`start_thread' c:/ruby/lib/ruby/1.8/webrick/server.rb:162:in`开始'c:/ruby/lib/ruby/1.8/webrick/server.rb:162:in `start_thread' c:/ruby/lib/ruby/1.8/webrick/server.rb:95:in`start'c:/ruby/lib/ruby/1.8/webrick/server.rb:92:in start'c: `each' c:/ruby/lib/ruby/1.8/webrick/server.rb:92:in`/ruby /lib/ruby/1.8/webrick/server.rb:23:in `start' c:/ruby/lib/ruby/1.8/webrick/server.rb:82:in`start' c:/ruby/lib/ruby/gems/1.8/gems/rails-2.2.2/lib/webrick_server.rb:60:in `dispatch' c:/ruby/lib/ruby/gems/1.8/gems/rails-2.2.2/lib/commands/servers/webrick.rb:66 c:/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in` gem_original_require' c:/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require' c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:153:in`require' c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies .rb:521:in`new_constants_in' c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:153:in`需要'c:/ruby/lib/ruby/gems/1.8/gems/rails-2.2.2/lib/commands/server.rb:49 c:/ruby/lib/ruby/site_ruby/1.8 /rubygems/custom_require.rb:31:in `gem_original_require' c:/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in` 需要'脚本/服务器:3
> 
> c:/ruby/lib/ruby/gems/1.8/gems/mysql-2.7.3-x86-mswin32/ext/mysql.so c:/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:36 :in `require' c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:153:in`要求'c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:521:in`new_constants_in' c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:153:in`要求'c:/ruby/lib/ruby/gems/1.8 /gems/activesupport-2.2.2/lib/active_support/core_ext/kernel/requires.rb:7:in `require_library_or_gem' c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/core_ext/kernel/reporting.rb:11:in` quiet_warnings' c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support /core_ext/kernel/requires.rb:5:in `require_library_or_gem' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/mysql_adapter.rb:63:in` mysql_connection' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:223:in `send' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:223:in` new_connection' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:245:in `checkout_new_connection' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:188:in` 结帐' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:184:in `loop' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:184:in` checkout' c:/ruby/lib/ruby/1.8 /monitor.rb:242:in `synchronize' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:183:in` checkout' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:98:in `connection' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_pool.rb:326:in` retrieve_connection' c: /ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_specification.rb:121:in `retrieve_connection' c:/ruby/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/connection_adapters/abstract/connection_specification.rb:113:in` connection' c:/ruby/lib/ruby/gems/1.8/gems /activerecord-2.2.2/lib/active_record/query_cache.rb:8:in `cache' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/caching/sql_cache.rb:12:in` perform_action' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/base.rb:524 ：在 `send' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/base.rb:524:in` process_without_filters' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/filters.rb:606:in `process_without_session_management_support' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/session_management.rb:134:in` process' c:/ruby/lib/ruby/gems/1.8/gems /actionpack-2.2.2/lib/action_controller/base.rb:392:in `process' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:183:in` handle_request' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:110 :in `dispatch_unlocked' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:123:in` dispatch' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:122:in `synchronize' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:122:in` dispatch' c:/ruby/lib/ruby/gems/1.8 /gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:132:in `dispatch_cgi' c:/ruby/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:39:in` dispatch' c:/ruby/lib/ruby/gems/1.8/gems/rails-2.2.2/lib/webrick_server.rb:103 :in `handle_dispatch' c:/ruby/lib/ruby/gems/1.8/gems/rails-2.2.2/lib/webrick_server.rb:74:in` service' c:/ruby/lib/ruby/1.8/webrick/httpserver.rb:104:in `service' c:/ruby/lib/ruby/1.8/webrick/httpserver.rb:65:in`run' c:/ruby/lib/ruby/1.8/webrick/server.rb:173:in`start_thread' c:/ruby/lib/ruby/1.8/webrick/server.rb:162:in`开始'c:/ruby/lib/ruby/1.8/webrick/server.rb:162:in `start_thread' c:/ruby/lib/ruby/1.8/webrick/server.rb:95:in`start'c:/ruby/lib/ruby/1.8/webrick/server.rb:92:in start'c: `each' c:/ruby/lib/ruby/1.8/webrick/server.rb:92:in`/ruby /lib/ruby/1.8/webrick/server.rb:23:in `start' c:/ruby/lib/ruby/1.8/webrick/server.rb:82:in`start' c:/ruby/lib/ruby/gems/1.8/gems/rails-2.2.2/lib/webrick_server.rb:60:in `dispatch' c:/ruby/lib/ruby/gems/1.8/gems/rails-2.2.2/lib/commands/servers/webrick.rb:66 c:/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in` gem_original_require' c:/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `require' c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:153:in`require' c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies .rb:521:in`new_constants_in' c:/ruby/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:153:in`需要'c:/ruby/lib/ruby/gems/1.8/gems/rails-2.2.2/lib/commands/server.rb:49 c:/ruby/lib/ruby/site_ruby/1.8 /rubygems/custom_require.rb:31:in `gem_original_require' c:/ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in` 需要'脚本/服务器:3

加载以下文件时发生此错误：

> mysql
> 
> 要求
> 
> 参数：
> 
> 没有任何
> 
> 显示会话转储
> 
> --- flash: !map:ActionController::Flash::FlashHash {}
> 
> 回复
> 
> 标题：
> 
> {"cookie"=>[], "Content-Type"=>"", "Cache-Control"=>"no-cache"}

请指教。

**更新：**

我尝试再次安装 mySQL，得到：

> 已成功安装 mysql-2.7.3-x86-mswin32 1 个 gem 安装 mysql-2.7.3-x86-mswin32 的 ri 文档...正在为 mysql-2.7.3-x86-mswin32 安装 RDoc 文档... 错误：生成时mysql-2.7.3-x86-mswin32 的文档 ... MESSAGE:
> Unhandled special: Special: type=17, text="" ... RDOC args: --op c:/ruby/lib/ruby/gems/1.8 /doc/mysql-2.7.3-x86-mswin32/rdoc --exclude ext --main README --quiet ext README docs/README.html（继续安装的其余部分）

然后我的应用程序启动时出现相同的 mySQL 错误。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T22:32:40.557

在我看来，您缺少 mysql gem。

尝试

```
gem install mysql 
```

# java - 在 Java 中通过引用传递和在 C 中传递指针有什么区别？

> ID：600651
> 
> 赞同：15
> 
> 时间：2009-03-01T22:16:39.737
> 
> 标签：java, c, pointers, pass-by-reference

我已经学习 Java 几个月了，现在开始学习 C。

我有点困惑，我的印象是通过引用传递对象和传递指向该对象的指针是一回事：我认为不同之处在于，在 Java 中，所有对象的传递都是使用指针自动完成的，如C 一个人实际上必须在这里和那里撒上小星号和＆符号。最近，在谈话中，我确信这是有区别的！

通过引用传递和传递指针有什么区别？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-03-01T22:30:20.283

Java*和*C 都没有传递引用。它们都是严格按值传递的。

引用传递语义意味着当您更改方法中参数的值时，调用者将看到参数中的更改。

现在，您可能会想：“但在 Java 中就是这种情况！如果我在方法期间更改对象，调用者会看到该更改。” *对象不是参数。*参数*只是*变量 - 如果您更改该变量的值，调用者将看不到它。例如：

```
public void foo(Object x)
{
    x = null;
}

public void caller()
{
    Object y = new Object();
    foo(y);
    // y is still not null!
} 
```

如果参数*真的是*通过引用传递的，`y`那么之后将为空。相反， 的值`y`只是一个引用，并且该引用是按值传递的。这很令人困惑，因为“参考”一词在这两个术语中都有，但它们是不同的东西。

您可能想查看[我关于 C# 参数传递的文章，](http://pobox.com/~skeet/csharp/parameters.html)以了解如果 Java*确实*具有按引用传递语义会发生什么，就像 C# 在（且仅当）您使用`ref`关键字时所做的那样。

您可能还想查看与该主题相关的[我的 Stack Overflow 答案的评论。](https://stackoverflow.com/questions/423823/whats-your-favorite-programmer-ignorance-pet-peeve/423833#423833)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-01T22:41:53.077

> 我认为不同之处在于，在 Java 中，所有对象的传递都是通过指针自动完成的，而在 C 中，实际上必须在这里和那里撒上小星号和 & 号。

概念性的，说的很对。如果我们是迂腐的（这是一件好事），我们甚至可以说在 Java 中根本不传递对象。传递的只是“指针”，在 Java 中称为引用。所有间接都是自动完成的。因此，当您在 C 中执行“objref->foo”而不是“objref.foo”并且由于使用指针而不能使用点时，在 Java 中您仍然可以使用点，因为它不知道任何其他内容无论如何访问成员。在 C 中，您可以传递指针（这里*实际上*称为指针）*，*也可以传递对象本身，在这种情况下传递一个副本。在 C 中，您可以使用星号或“->”间接访问指针所引用的对象。在 Java 中，

如果我们再次迂腐（现在再次变得更重要），那么在 Java 和 C 中都没有“按引用传递”。我们在 Java 中传递的是对象的引用/指针，而在 C 中，我们要么传递对象的副本（很明显），要么再次传递指向对象的指针的副本。所以在这两种情况下——Java 和 C——我们传递的是对象的地址。不谈论在 Java 和 C 中复制的原始 Java 类型 - 即使您也可以在 C 中传递它们的地址，聚合类型（即结构）和 C 中的“原始类型”之间没有*区别*看待。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-01T22:23:23.187

差异是微妙的。在汇编级别，在这两种情况下，对象的地址都被传递给函数。但是，在指针的情况下，参数是一个独立的指针，可用于修改目标对象 (*pch = 'x') 或可用于访问不同的对象 (pch = "newstr")。在参考情况下，参数会自动间接指向目标对象。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-01T22:25:09.780

一些东西

*   C 没有引用（尽管有 C++）
*   Java没有指针
*   指针和引用之间的区别在于，指针实际上是您可以计算的内存地址。无法计算参考
*   Java和C按值传递（Java中传递对象时，将引用复制到函数中）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-01T22:25:33.523

我相信指针是一个包含引用的变量。使用 & 可以获得内存方向（参考），使用 * 可以获得内存方向的内容。我推荐这本书[The C programming Language](http://en.wikipedia.org/wiki/The_C_Programming_Language_(book))。

问候

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-01T22:26:21.837

真正[的传递引用](http://www.brpreiss.com/books/opus4/html/page593.html)意味着您可以为引用分配一个新值，并且这个新值将在调用上下文中可见，就像在被调用方法内部一样。

在 Java 中，这是不可能的，因为[对象引用是按值传递的](http://www.javaworld.com/javaworld/javaqa/2000-05/03-qa-0526-pass.html)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-01T22:23:55.023

如果您正在学习 C（而不是 C++），则没有参考资料。

C 中的术语“按引用传递”仅表示您将指针作为存储值的地址传递，以便函数可以更改其值。否则，您将按值传递，这意味着在堆栈上生成变量的副本并且修改没有影响。

在许多方面，这与您在 Java 中看到的相似，只是在 Java 中您不必显式地将事物转换为指针或取消引用它们。换句话说，当你传递一个指针时，地址被复制到堆栈上，所以如果你的函数改变了指针（而不是它指向的数据），当你完成函数时，更改就会消失。类似地，当您在Java 中传递对象引用时，您可以更改对象的内容（例如，通过调用函数），但是一旦您离开，将变量更改为指向另一个对象将不起作用。

如果您使用的是 C++（看起来像 C），那么您可以通过引用传递，在这种情况下您不需要处理指针，并且函数中变量的更改实际上会直接更改外部值（除了您不能让它指向别的东西）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-01T22:28:29.647

Eric Lippert 最近有一篇关于此的文章。他是 C# 编译器的程序员，但无论他说什么，都具有足够的通用性，可以扩展到其他 GC 语言，例如 Java：

[http://blogs.msdn.com/ericlippert/archive/2009/02/17/references-are-not-addresses.aspx](http://blogs.msdn.com/ericlippert/archive/2009/02/17/references-are-not-addresses.aspx)

引用文章：

> 严格来说，指针比引用“更强大”；你可以用引用做任何事情，你可以用指针做任何事情。[...]
> 
> 指针通常实现为地址。地址是一个数字，它是“字节数组”的偏移量，“字节数组”是进程的整个虚拟地址空间。[...]
> 
> 由于所有这些原因，我们没有将引用描述为规范中的地址。规范只是说引用类型的变量“存储了对对象的引用”，并且对于如何实现它完全模糊。类似地，指针变量存储对象的“地址”，这又是非常模糊的。我们没有说引用与地址相同。
> 
> 因此，在 C# 中，引用是一些模糊的东西，可以让您引用一个对象。除了取消引用之外，您不能对引用做任何事情，并将其与另一个引用进行比较以获得相等性。在 C# 中，指针被标识为地址。
> 
> 与引用相比，使用包含地址的指针可以做更多事情。地址可以用数学方法进行操作；您可以从另一个中减去一个，您可以向它们添加整数，等等。它们的合法操作表明它们是索引到作为进程虚拟地址空间的“数组”的“花哨数字”。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-07-08T18:23:29.027

那些熟悉 C/C++ 的读者可能已经注意到对象引用看起来类似于指针。这种怀疑基本上是正确的。对象引用类似于内存指针。主要区别——也是 Java 安全的关键——是不能像操作实际指针那样操作引用。因此，您不能使对象引用指向任意内存位置或像整数一样操作它。

*   java 不支持 & 运算符，那么如何在 java 中获取对象地址。
*   在 java 中，引用是由对象完成的，例如

MyClass object1 = new MyClass();

我的类 object2 = object1;

即，您可能认为 object1 和 object2 指的是独立且不同的对象。然而，这是错误的。相反，在这个片段执行之后，object1 和 object2 都将引用同一个对象。如果你改变任何一种效果。

*初始化后不能更改对象的地址 ie MyClass obj =new MyClass(); 作为 c++ 中的参考，使用 object 您只能更改对象实例值

注意：java提供了一个特殊的特性object1已经被设置为null，但是object2仍然指向原来的对象。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-01T22:52:02.070

我不确定 java 但在 C# 或 VB.net 中你可以通过值或引用传递

引用传递的例子

```
 static void Main(string[] args)
    {
        int x = 1;
        Foo(ref x);
        Console.WriteLine(x.ToString());//this will print 2
    }

    private static void Foo(ref int x)
    {
        x++;
    } 
```

请注意，x 等于 1，但是当您调用方法 Foo 并在 Foo 中 x 增加 1 时通过引用传递 x 时，原始值也会增加

# windows - 删除文本文件的第一行

> ID：600653
> 
> 赞同：18
> 
> 时间：2009-03-01T22:17:18.770
> 
> 标签：windows, batch-file, cmd, scripting, text-files

我需要一个 cmd 脚本来删除我的文本文件中的第一行。场景如下：我每天从 FTP 获取一个 txt 文件，问题是它的顶部有空行，然后是文件的标题。由于我将该文件自动导入到访问表中，因此该空白行给我带来了问题。

所以，我需要一个删除空白行并保存文件的脚本。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-01T22:32:47.657

窗口/命令提示符：

```
more +1 filename.ext > otherfilename.ext 
```

这似乎工作正常，但是这似乎也将制表符转换为多个空格。我需要在导入 postgres 之前删除制表符分隔文件的第一行。由于更多...自动将制表符转换为空格，这失败了

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-01T22:19:31.790

您没有指定平台。以下是在任何 *NIX 环境（和 Windows+Cygwin）中执行此操作的方法：

```
sed -i~ 1d target-file 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-01T22:26:58.793

要删除第一行，我会使用

```
tail -n +2 source-file > target-file 
```

如果您想在 Windows 上使用此功能，请下载 gnu utils 以获取 tail 命令。+2 表示“从第二行开始”。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-01T22:36:40.547

在没有额外工具的窗口中：

```
findstr /V /R "^$" filename.whatever 
```

无需额外工具

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2015-07-08T15:06:13.207

我注意到一些评论询问如何使用 Preet Sangha 的解决方案。由于我没有足够的代表来添加评论，我想在这里发布一个更完整的解决方案。

您可以使用 Preet Sangha 的解决方案，如下所示。此脚本将创建一个没有输入文件第一行的新文本文件。

```
findstr /V /R "^$" InputFile.txt > OutputFileNameWithFirstLineRemoved.txt 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-09-07T15:57:25.010

我今天需要做类似的事情，这就是我想出的：

```
FOR /F "tokens=* skip=1" %A IN ('type "input_file.ext"') DO @echo %A>>"output_file.ext" 
```

`more +1`与解决方案相比，这具有将保留制表符字符的优势。但是，在大文件上，这种方法比其他方法慢很多。此外 - 前导空格将被左修剪，这可能是也可能不是问题。

# objective-c - IconRef 来自的文件

> ID：600660
> 
> 赞同：1
> 
> 时间：2009-03-01T22:24:16.083
> 
> 标签：objective-c, cocoa

有没有办法找出 IconRef 引用或已加载的 .icns 文件？或者甚至是包含捆绑包的 ID（如果有的话）？

我了解并非所有图标都是直接从文件（例如复合图标）加载的，因此这不会一直有效。

我要回答的问题是“Finder 为文件 X 显示的图标来自哪里？” 请注意，我对文件系统中图标的来源感兴趣，而不是图标的图像数据。据我所知，从文件路径到图标背后的工作原理 - 例如。GetIconRefFromFileInfo 和 NSWorkspace.iconForFile - 相当不透明。

如果需要的话，我对无证/私人解决方案持开放态度。

@millenomi：是的，避免使用 Apple 的图标是练习的重点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T23:27:54.403

Launch Services 具有用于遍历其捆绑注册数据库的私有 API，您可以通过这种方式找到 .icns 文件。您可以使用 LaunchServices.framework/Support 中的 lsregister 工具查看此信息；使用 lsregister -dump 查看完整的数据库。

强制性 UndocumentedGoodness 警告：如果您使用这些功能，您的应用程序迟早会崩溃。（并且解析 lsregister -dump 的输出是一个更糟糕的主意！）

此外，您似乎已经意识到这一点，但我还是要指出：并非所有图标都来自 .icns 文件。有些在资源文件中，例如在旧式 Carbon 应用程序中。另一种情况是自定义（粘贴到 Finder 的信息窗口）图标，它们是一个或多个 ID 为 -16455 的资源。（经典图标位于“icl8”、“ics8”等类型的多个资源中，而现代图标位于“icns”类型的单个资源中。）

不幸的是，我没有玩过这个私有 API，所以我不能更具体。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T01:41:00.713

回答我自己...

以下内容并没有完成最初的问题——找出哪个文件位于 IconRef 后面——但它确实实现了我的目标，即在不完全放弃特定于文件的图标的情况下避免使用 Apple 拥有的图标。

诀窍是确定哪个应用程序将打开文件，并假设文件的图标将由该应用程序提供。

使用 LSGetApplicationForItem 找出将用于打开文件的应用程序。如果它不是 Apple 应用程序（检查捆绑 ID），我认为使用文件的图标是安全的（由 GetIconRefFromFileInfo 返回）。

我还需要处理一些特殊情况——避免使用通用文档、文件夹、应用程序和捆绑图标以及“特殊”文件夹，如 Documents 和 Music。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-01T23:05:50.383

这是因为，一旦加载，系统不会保留对图标来源的图标文件的引用。

不幸的是，最好的办法是在 中搜索`*.icns`文件。`/System`请注意，这些图标受 Apple 的版权保护，您不应重复使用它们（通过它们的 API 加载时除外）。

# c# - 如何使用“当前”值绑定到 WPF 中的枚举

> ID：600661
> 
> 赞同：3
> 
> 时间：2009-03-01T22:24:35.257
> 
> 标签：c#, wpf, data-binding, xaml, enums

我有一个简单的 .Net 枚举。我还有一个视图模型对象，它具有我的枚举类型的“CurrentValue”属性。此属性可以是数据绑定的（对象实现 INotifyPropertyChanged）。现在，我想以特定顺序为枚举的每个值显示一个 UI 元素，并突出显示“CurrentValue”（粗体）。我希望声明类似于：

```
<StackPanel Orientation="Vertical">               
    <ContentControl Content="{x:Static MyEnum.Value1}" />
    <ContentControl Content="{x:Static MyEnum.Value2}" Margin="10" />
    <ContentControl Content="{x:Static MyEnum.Value3}" />
</StackPanel> 
```

我想单独声明每个值以指定顺序，还因为我希望某些元素具有特定的边距值。此外，稍后我将希望为每个值显示特定图标。

现在我不知道如何声明我希望与 CurrentValue 关联的控件为粗体。我尝试在模板中使用通用 DataTrigger 来检查 CurrentValue 的内容，但似乎触发器的值不能是绑定。

我也考虑过使用禁用的列表框，但我不能为特定项目设置特定的边距。或者我可以吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T23:18:43.363

试穿这个尺寸...

```
<ListBox>
  <ListBoxItem><local:MyEnum>Value1</local:MyEnum></ListBoxItem>
  <ListBoxItem Margin="10"><local:MyEnum>Value2</local:MyEnum></ListBoxItem>
  <ListBoxItem><local:MyEnum>Value3</local:MyEnum></ListBoxItem>
</ListBox> 
```

您需要将`local`xmlns 映射到您的 CLR 命名空间。

# c# - 数据库表到 C# 实体类 - FluentNHibernate 的生成器？

> ID：600669
> 
> 赞同：1
> 
> 时间：2009-03-01T22:31:36.207
> 
> 标签：c#, nhibernate

我计划在我的下一个项目中使用 NHibernate，并通过 FluentNHibernate 进行映射。我已经有一个数据库，所以我必须为映射到数据库表的实体生成 C# 类。

你会推荐什么工具（如果有的话？）用于从 MS SQL 数据库为 NH 自动生成 C# 类？

感谢分享。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-01T22:35:07.040

[NConstruct Lite](http://www.nconstruct.com/App/NConstructLite.aspx?PageId=12)将免费生成类和 hbm 映射文件，即使它不支持流畅的 NHibernate，也不会使用一些新的 C# 3.0 功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-02T01:49:05.373

不。

对象关系映射的重点是……嗯……映射。

如果您从数据库中生成类，您也可以使用类型化数据集。

考虑一下您希望您的类在对象世界中的样子，然后使用 NHibernate 将其映射到您的数据库模式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-01T22:35:53.950

检查[城堡项目 ActiveRecord](http://www.castleproject.org/activerecord/index.html)。

# apache-flex - 最大化时重新定位 Air NativeWindow？

> ID：600680
> 
> 赞同：0
> 
> 时间：2009-03-01T22:37:01.233
> 
> 标签：apache-flex, air, flex3

最大化时如何设置本机窗口位置？

我已经尝试在 DISPLAY_STATE_CHANGE 事件上重新定位它，这有点工作 - 但窗口在重新定位之前以最大化大小闪烁，更重要的是窗口的“最大化”按钮仍然处于活动状态。

我想要实现的只是一个固定宽度的窗口，它在最大化时“停靠”在屏幕右侧，同时仍然使用恢复/最大化本机窗口按钮功能。

我应该注意到我已经设置了 maxSize 和 minSize 并且工作正常。

在此先感谢-b

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-06T17:12:59.767

尝试使用 NativeWindowDisplayStateEvent.DISPLAY_STATE_CHANGING

# ruby - Ruby headscratcher - 不输出实例变量

> ID：600683
> 
> 赞同：1
> 
> 时间：2009-03-01T22:37:50.763
> 
> 标签：ruby, syntax, instance-variables

我可能正在做一些愚蠢的事情，但我无法弄清楚它是什么。

我从这个程序看到的输出是

```
foo

test 
```

我期待看到的是

```
foo
abc
test 
```

有没有人在这里看到任何明显的错误？

```
class Foo

    def initialize(l)
    @label = l
    end

    def label
    @label
    end

    def abc
    @abc
    end

    def abc=(abc)
    @abc
    end

end

foo = Foo.new("foo")
foo.abc=("abc")
puts foo.label
puts foo.abc
puts "test" 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-01T22:40:28.790

你从来没有在你的`abc=`方法中设置@abc。它应该看起来像

```
def abc=(val)
  @abc = val
end 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-02T10:06:31.920

除了告诉您错误是什么的 Logan 的回答之外，以下是该错误一开始就不会发生的方式：

```
class Foo
  def initialize(l)
    @label = l
  end

  attr_reader :label
  attr_accessor :abc
end 
```

# php - 关系数据库中的面向对象的结构

> ID：600684
> 
> 赞同：9
> 
> 时间：2009-03-01T22:37:57.847
> 
> 标签：php, mysql, database, oop

伙计们，

连续第 n 次，我又遇到了同样的老问题。它是关于“我如何以一种轻松的方式将 OOP 结构映射到数据库表”。

这是一个场景：我的系统中有几种类型的“参与者”——工人、雇主、联系人。它们具有某些共同的功能；其他作品则大不相同。所有参与者处理的实体是“通信”、“笔记”（管理员喜欢给客户留下笔记）等等。每个参与者类型都处理大量其他实体类型，而其他实体则不处理。

目前，我的数据库架构包括以下表格：

演员：

*   工人
*   雇主
*   接触

实体：

*   沟通
*   笔记
*   等等

实体和参与者之间的关联表：

*   工人沟通协会
*   雇主沟通协会
*   工人笔记-assn
*   等等，你得到了演习。

这对我来说就像是一种“代码味道”。每当客户改变他们的角色（即从“联系人”提升为“雇主”）时，就需要运行一堆疯狂的脚本。糟糕...另一方面，如果我在一个纯粹的 OOP 驱动的世界中操作，这会容易得多 - 为所有具有公共属性的实体创建一个基类，然后完成它......

在 DB 世界中，该选项在理论上似乎是可行的，但听起来很混乱……即，如果我理解正确，我将有一个新的 base_actor 表，并且每个其他参与者都有一个 base_actor_id，然后关联将介于base_actor 和实体......但是，我该如何进行反向关联查询？即“向我展示与工人类型演员的所有沟通”？

有什么建议吗？关于“将 OOP 结构映射到关系数据库”主题的任何一般性想法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-01T23:10:26.737

> .. 它是关于“我如何以一种轻松的方式将 OOP 结构映射到数据库表”。

你没有。

面向对象和关系代数是两种根本不同的范式。如果没有主观解释，您就无法在它们之间转换。这被称为阻抗失配，被称为[计算机科学的越南](https://web.archive.org/web/20180122225838/http://blogs.tedneward.com/post/the-vietnam-of-computer-science/)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-01T22:44:53.477

它被称为[ORM 或对象关系映射](http://en.wikipedia.org/wiki/Object-relational_mapping)。有数十种产品声称可以帮助您将 OO 结构映射到关系表。例如，Ruby on Rails 提供了 Active Record 来帮助弥合鸿沟。对于 PHP，你有[Propel](http://propel.phpdb.org/trac/)、[Doctrine](http://www.doctrine-project.org/)和[Porte](http://porte.adaltas.com/)等等。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-02T00:01:57.940

这是我大约 10 年前提出的一个解决方案。使用这种设计的系统仍在运行，所以它运行得很好，比我的大多数代码存活的时间更长。;) 今天我可能会使用 Scott 提到的 ORM 包之一，但直接使用 SQL 并没有什么大问题。

1.  将所有继承关系建模为表之间的连接。系统中的每个表都将保存特定类的属性。

2.  使用合成对象 ID (oid) 作为所有对象的主键。生成 oid 值需要序列生成器或自动增量列。

3.  所有继承的类必须使用与其父类相同的 oid 类型。将 oid 定义为具有级联删除的外键。父表获取自动增量 oid 列，子表获取普通 oid 列。

4.  对最终类的查询在相应的表上进行。您可以将所有父类表加入到查询中，或者只是延迟加载您需要的属性。如果你的继承层次很深并且你有很多类，那么 ORM 包可以真正简化你的代码。我的系统只有不到 50 个类，最大继承深度为 3。

5.  跨子类的查询（即对父类的查询）可以在每个实例的基础上延迟加载子属性，或者您可以对每个与基类连接的子类重复查询。基于父类查询的延迟加载子属性需要您知道对象的类型。您可能已经在父类中有足够的信息，但如果没有，您需要添加类型信息。同样，这是 ORM 包可以提供帮助的地方。

在表结构中可以跳过没有成员属性的虚拟类，但您将无法根据这些类进行查询。

这就是“向我展示与工人类型的演员的所有通信”的样子。

```
select * from comm c, worker w where c.actor=w.oid; 
```

如果您有通信的子类，并且您想立即加载所有子类属性（也许您的系统不允许部分构造），最简单的解决方案是对所有可能的类进行 Eager Join。

```
select * from comm c, worker w, missive m where c.actor=w.oid and c.oid=m.oid;
select * from comm c, worker w, shoutout s where c.actor=w.oid and c.oid=s.oid; 
```

最后一件事。确保您有一个良好的数据库和正确的索引。如果您的数据库无法优化这些连接，性能可能是一个严重的问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-01T22:43:39.767

你建议的方法对我来说似乎是合理的。您可以在您的演员基表中添加一个演员类型列，以区分不同类型的演员。每个特定actor表的PK将是actorbase表的FK，以避免“多毛”查询并模拟类似继承的“is-a”关系。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-01T22:59:30.260

我见过的最好的答案是： [http ://en.wikipedia.org/wiki/The_Third_Manifesto](http://en.wikipedia.org/wiki/The_Third_Manifesto)

不幸的是，它不适合stackoverflow上的单个答案空间。我将在这里尝试对其进行缩写，但我警告您，这样的缩写不会准确反映第三个宣言。请将对此解决方案的所有批评重定向到实际阅读该死的东西，而不是假设您通过阅读缩写完全理解它。好的，就到这里。

定义三个新的列类型，名为 worker、employees 和 contact。将每种类型的对象存储在它们各自类型的列中。遵循数据模型其余部分的标准规范化规则。

我的感觉是，当前流行的数据库技术实际上并不支持做这些事情的“正确”方式，（具体来说，许多数据库系统不允许定义新类型）。所以不管你做什么，你总是会被迫陷入妥协的境地。但是在阅读了第三份宣言之后，至少你会知道你在妥协什么。

ORM 目前是该问题最流行的解决方案，但我不认为它是正确的解决方案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-02T00:24:05.313

可能值得您花时间熟悉[此问题](https://stackoverflow.com/questions/354999/visiomodeler-object-role-modeling-the-other-orm-who-uses-it)中讨论的对象角色建模。我看到的最大问题是，没有现有的公认方法可以就关系数据进行概念设计讨论。您能做的最好的事情就是逻辑建模（通常是 ERM）。对象角色建模为该讨论提供了基础。我希望您会从类似的 OOP 设计讨论中看到可识别的工件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-01T23:16:04.057

在我看来，您的数据模型似乎缺少一个级别。我会更像这样设置它：

**人员**表-（仅有关实际人员的信息）

**角色**表 - （人们可以拥有的角色类型，即工人、雇主、联系人 - 以及特定于该角色的信息）

**PeopleRoles**表 -（people_id、role_id、可能开始/修改日期等）

**实体**表 - （定义不同类型的实体）

**RoleEntities**表 -（role_id、entity_id 等）

然后将一个人从一个角色更改为另一个角色（或允许他们拥有多个角色）是一个简单的更新。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-01T23:42:26.473

许多 RDBMS 提供表继承特性，它将父表链接到子表，其方式与类继承非常相似。不同供应商的实现略有不同，但它可以减轻实现类似概念的一些痛苦。

此外，大多数 RDBMS 都有一些触发器、存储视图和存储过程的组合，可以将行为与实现分开。在许多情况下，例如 PostgreSQL 的规则（视图的泛化）提供了非常复杂的封装并且非常易于使用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-01T23:42:44.633

一些人已经注意到对象关系阻抗不匹配。最好的解决方案是简单地放弃[RDBMS](http://en.wikipedia.org/wiki/RDBMS)以支持最近重新流行的[OODBMS 。](http://en.wikipedia.org/wiki/OODBMS)

也就是说，据我所知，在纯 PHP 中没有任何带有 API 的对象数据库。快速搜索产生了[这个结果](http://freshmeat.net/projects/podb/)，但它已经多年没有更新了。另一方面，我听说过很多其他语言的对象数据库，包括[Hibernate](http://www.hibernate.org/)、[db4o](http://developer.db4o.com/)和[ZODB](http://new.zope.org/projects/zodb)。

# mysql - 为什么不使用记录的创建时间作为主键呢？

> ID：600693
> 
> 赞同：4
> 
> 时间：2009-03-01T22:41:47.667
> 
> 标签：mysql, database, database-design

我有一个表，它有一个自动递增的 PK 和 creation_date 字段，这是 unix 时间戳。
我想知道为什么不丢失自动递增字段并使用创建日期字段作为 PK，因为它是唯一的（我使用的是 1/1000 秒的精度）。

对于：我正在杀死一个索引行。
反对：重复的可能性很小（非常非常小），但是很容易处理这种非常罕见的事件。

数据库是mysql。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-01T22:51:41.993

一般的答案是您的数据可能会改变（没有意义的 id 永远不会改变）......当您意识到您将时间存储在本地区域并且 DST 开始时会发生什么？如果您想针对 UTC 和/或针对特定时区进行存储？有关更多订购注意事项，请参阅[wcoenen 的回答](https://stackoverflow.com/questions/600693/why-not-use-the-creation-time-of-a-record-as-a-primary-key/600933#600933)。

如果您开始每秒创建 1000 行，并且您必须弄乱数据以“使其工作”做一些它不打算做的事情。也许您会添加一个消歧列，使您的索引更大更慢......

然后，当您的项目变得非常受欢迎并且人们开始尝试运行报告/查询并且“它使用日期作为 PK ？？？！！！”

还可以考虑使用允许在非主列上使用聚集索引的数据库。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-01T22:51:21.980

因为索引的大小（宽度）。时间戳很宽；除非您的表包含一堆行，否则您不需要 bigint 作为 PK 的数据类型。主键列越薄，您可以一次保存在内存中的索引块的大小就越大，查询速度就越快。所以不要这样做。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-01T22:52:36.343

坏主意，因为“时区”。

如果托管您的服务器的国家/地区观察到与“夏令时”计划相关的时间变化，那么每年一次，时间将被调回一小时。

然后一个小时，它会生成重复的密钥。

我在一家公司工作，该公司有一个带有类似时间戳键的数据库，每小时记录来自半导体制造工厂设备的数千次测量。它是在韩国开发的（没有夏令时转换）。

当他们在美国安装它时……***我们不得不每年关闭整个工厂一小时——为了不丢失在那一小时内进行的测量。***:-)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-02T00:44:30.147

PC 或服务器将[其时钟与时间服务器同步](http://www.ntp.org/)是很常见的。因此，您不能依靠系统时钟保持稳定的前进速度。它随时可能稍微向后或向前跳跃。

因此，如果您必须能够重建创建记录的顺序，您将需要一个自动递增的 PK。您不能依赖时间戳。这听起来可能很理论上，但它已经咬住了我们。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-01T22:43:52.560

**如果没有**自动递增的 PK，你会得到什么？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-01T22:52:09.137

因为：

> 反对：重复的可能性很小（非常非常小），但是很容易处理这种非常罕见的事件。

您不能保证您的密钥始终是唯一的，因此信息不适合主键。

如果您必须批量插入 10 或 100 条记录怎么办？你会在插入之间插入暂停以确保你有唯一的主键吗？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-01T22:55:19.007

时间不够精细，如果同时插入两条记录，可能会导致插入失败。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-01T23:13:24.673

> 对于：我正在杀死一个索引行。

反对： ...赞成另一个索引行，由于其长度大大增加，如果比以前更频繁地使用，将导致显着增加的开销。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-02T19:58:45.833

基本答案是它不能扩展。它现在可能可以工作，但是随着计算机变得更快，并且您获得更多用户，它迟早会开始发生冲突并限制系统的吞吐量。

正如其他人指出的那样，还有很多基本的技术原因。

# javascript - JQuery/Javascript 重新排序行

> ID：600700
> 
> 赞同：8
> 
> 时间：2009-03-01T22:44:33.243
> 
> 标签：javascript, jquery

我有一个看起来像这样的 aspx 页面：

```
<tr id="Row1">
  <td>Some label</td>
  <td>Some complex control</td>
</tr>
<tr id="Row2">
  <td>Some label</td>
  <td>Some complex control</td>
</tr>
<tr id="Row3">
  <td>Some label</td>
  <td>Some complex control</td>
</tr> 
```

加载页面后，我想根据用户先前选择的顺序（存储在数据库中）对这些行重新排序

我将如何使用 JQuery/JS 来完成此任务？

编辑：

我遇到了 appendTo 代码的性能问题。一个 10 行的表需要 400 毫秒，这确实是不可接受的。谁能帮我调整它的性能？

```
function RearrangeTable(csvOrder, tableId)
{
  var arrCSVOrder = csvOrder.split(','); 

  //No need to rearrange if array length is 1
  if (arrCSVOrder.length > 1)
  {
    for (var i = 0; i < arrCSVOrder.length; i++)
    {
      $('#' + tableId).find('[fieldname = ' + arrCSVOrder[i] + ']').eq(0).parents('tr').eq(0).appendTo('#' + tableId);
    }
  }
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-01T22:50:55.397

为什么不在服务器端对行进行排序？如果您打算在页面加载后立即使用 JQuery 对它们进行重新排序，那么在服务器代码中执行此工作会更有效，尤其是当用户选择的订单存储在数据库中时。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-01T22:52:32.740

试试 jQuery [tablesorter 插件](http://tablesorter.com/docs/)。

当文档加载时，您可以通过指定要排序的列索引来对表进行排序（并且它允许按多列排序）：

```
$(document).ready(function() 
    { 
        $("#myTable").tablesorter( {sortList: [[0,0], [1,0]]} ); 
    } 
); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-06T00:50:44.640

只需执行以下操作：

假设你有这样的表：

```
<table id='table'>
    <tr id='row1'><td> .... </td></tr>
    <tr id='row2'><td> .... </td></tr>
    <tr id='row3'><td> .... </td></tr>
    <tr id='row4'><td> .... </td></tr>
</table> 
```

还有一个新顺序的数组，如下所示：

```
NewOrder[1] = 3;
NewOrder[2] = 4;
NewOrder[3] = 2; 
```

然后，做一些这样的事情（未经测试，所以你可能需要调整代码，但这就是想法）：

```
for ( i=1; i<=NewOrder.length; i++ ) {
    $('#row'+i).appendTo( '#table' );
} 
```

这样，它们将按顺序移动到表格的末尾。

所以你将有 3 个移到最后，然后 4 个移到它后面，然后 2 个移到那个后面，等等。在它们**全部**附加到表的末尾之后，第一个将成为第一行，其余的将在它背后的正确顺序。

**编辑：**

使表格样式='display:none;' 然后做 $('#table').show(); 在启动时。

**再次编辑：** 你可以围绕整个正文内容做一个 div，比如

```
<body>
<div id='everything' style='display:none;'>
....
</div>
</body> 
```

这样整个页面将在加载和排序表格所需的几分之一秒内被隐藏（只是空白）。

然后你会使用：

```
$(function(){
    $('#everything').show();
} 
```

DOM 准备好后立即显示整个页面。页面加载将花费几分之一秒的时间，但它会立即加载，因此不会出现任何丢失的表格等。只要所有内容都在#everything中，它就会看起来就像加载的页面一样 - 对查看者应该是透明的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-01T22:53:47.933

检查 jQuery [TableSorter Plugin](http://tablesorter.com/docs/)，它非常强大，它可以检测列的底层数据类型，并且您可以通过编程方式对表列进行排序：

```
$("#yourTable").tablesorter( {sortList: [[0,0]]} );  
// This will sort "yourTable" using 
// the first column, ascending [columnIndex, 0=ASC or 1 = DESC] 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-09T18:56:24.987

请记住，在客户端重新排序会以三种方式让您对问题持开放态度。

1.  如果客户端计算机速度很慢，无论您​​做什么，都可能会看到这种重新排序。
2.  数据表越大，此操作就越慢，重新排序就越明显。
3.  客户端可能禁用了 JS，这会破坏您的重新排序。

尽管您现在似乎想在客户端进行此操作以节省您现在在服务器端编程方面的一些麻烦，但从长远来看，从长远来看，现在在此投入一些时间来获得服务器端将避免这些麻烦。

如果您在让服务器端代码与您的自定义控件一起正常工作时遇到问题，请发布它，我们会为您提供帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-13T14:29:57.970

工作示例。只需遍历包含新订单的列表（大概是您从数据库中读取的），构建新表。然后将表 html() 设置为新表 html。

```
<html>
<head>
    <script type="text/javascript"
    src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script>
jQuery.fn.outer = function(){
  return $( $('<div></div>').html(this.clone()) ).html();
}
$(function(){
    newtbl = "";
    neworder = [2,3,1];
    for(i=0;i<neworder.length;i++){
        newtbl += $("#Row"+neworder[i]).outer();
    }
    $("#tbl").html("<table id=\"tbl\">" + newtbl + "</table>")
});
</script>       
</head>
<body>
<table id="tbl">
<tr id="Row1">
  <td>label 1</td>
  <td>Some complex control</td>
</tr>
<tr id="Row2">
  <td>label 2</td>
  <td>Some complex control</td>
</tr>
<tr id="Row3">
  <td>label 3</td>
  <td>Some complex control</td>
</tr>
</table>
</body>
</html> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-02T14:24:12.173

如果用户完成的最后一次排序存储为包含行 id 的列表，您可以这样做：

```
loop through list from db {
    $("#"+rowId).appendTo("#tableId")
} 
```

这样，行将被从它们的当前位置中取出，并按照它们在数据库中的存储顺序在表中替换。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-12T23:34:28.887

> 编辑 appendTo 方法有效。但是，在客户端重新排列行的短暂延迟中，我在重新排序完成之前看到原始顺序中的行大约半秒。由于页面不使用回发，因此这种 UI 行为更加突出。有什么解决方法吗？

用 css 在桌子上设置 display:none。当文档就绪事件触发时使用 appendTo 方法。确实显示在桌子上。您可以在里面的表格上设置另一个带有 display:block 的样式标签，`<noscript>`以防 js 被禁用。

# gcc - “一个声明中的多种类型”但没有；失踪

> ID：600707
> 
> 赞同：2
> 
> 时间：2009-03-01T22:48:42.577
> 
> 标签：gcc, types

我尝试使用 Code::Blocks （gcc 编译器）编译我的程序。我得到一个错误：这是它抱怨的源文件：

```
#ifndef BOT_H
#define BOT_H

#include "player.h"
#include "timer.h"

class BOTS; // forward decalaration of BOTS

class BOT : public PLAYER
{
public:
    enum BotStatus{BotMoving,BotPursue,BotChasePowerup};
    enum BotMovDir{Up,Down,Left,Right,Forward,Backward};
    enum BotSkill{Easy,Normal,Hard,Expert,Insane};
protected:
    BotStatus Status;  // this is the line it complaining about
    BotMovDir CurrentMov;
    TIMER CTimer;
    bool Stucked;
    BotSkill Skill;
    VECTOR3D AimTarget;
//  VECTOR3D ShotTarget;
    PLAYER *PursueObj;
    bool SameLevel;
    BOTS *Owner;
    bool PlayerHitMe;
    void OnDamage(double dmg,const wchar_t *Shooter,bool s);
    void OnReset();
public:
    BOT(BOTS *o,const wchar_t *botname) : PLAYER(botname), PlayerHitMe(false), Status(BotMoving), Skill(Easy), Owner(o)
    {
        PlayerInit();
    }
    void SetSkill(BotSkill bs) {Skill=bs;}
    void BotControl();
    void SetSameLevel(bool s) {SameLevel=s;}
    virtual ~BOT() {}
};

#endif 
```

它抱怨第 16 行“一个声明中的多种类型”，这让我发疯。我搜索了很多，但常见的解决方案是“找到丢失的分号”。问题是根本没有缺少分号。它总是指向第 16 行（至少在受保护之后），即使有注释甚至超出 eof（当我删除所有字段以使文件变小）。

（这个问题可能很琐碎，我现在可能很累，所以我必须睡觉。我希望明天早上有人能给我一些建议。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-01T22:53:36.310

你有一个名为的类或其他 UDT`Status`吗？如果您将成员的名称更改为`Status_`怎么办？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-01T22:54:12.783

“ `Status`” 是宏还是在其中一个标题（或它们包含的任何内容）中声明/定义？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-03T09:01:23.017

我是一个傻瓜...

Code::Blocks 有时在开始编译文件之前不会保存源文件。MSVC++ 总是在编译前保存它。那是真正的问题。

似乎代码中的某处有一个状态宏。但这不是我自己的类型。可能是来自 wxwidgets 标头的宏...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-01T23:05:04.303

您向我们展示的文件是一个*头*文件。您遇到的问题是在某个*源*文件的第 16 行，该文件是`#include`该标头。您可以复制+粘贴您收到的**确切**错误消息，以及错误消息中引用的文件的相关部分吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-02T05:40:31.027

*在上一个*类声明中缺少一个分号，而不是它抱怨的那个。错误可能在“timer.h”中，但也可能在“player.h”中

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2012-06-19T12:36:19.637

错误可能是因为在第一类定义之前不需要第二类前向声明​​。

# file - 自定义文件结构的最佳实践

> ID：600708
> 
> 赞同：5
> 
> 时间：2009-03-01T22:49:21.517
> 
> 标签：file

我目前对其他程序员如何将数据组织到文件中非常好奇。任何人都可以推荐任何关于创建文件结构的最佳实践的好文章或书籍吗？

例如，如果您出于任何目的创建了自己的软件，您是否将保存的数据保留为纯文本、序列化、编码为 xml，为什么要这样做？

有什么我错过的秘密吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-01T22:55:27.397

一般来说，至少在开始时，选择最简单的可行的方法。例如，考虑 UNIX，其中大多数配置文件只不过是空格分隔的字段，或由另一个字符分隔的字段（例如 /etc/passwd，它使用“:”分隔符，因为 GCOS 字段可以包含空格。）

如果您的数据需要更多结构，那么问问自己“我可以轻松使用哪些工具？” 例如，Python 和 Ruby 有 JSON 和 YAML。

如果您已经拥有大量基于 XML 的内容，或者您​​希望将 XML 转换为浏览器中可显示的表单，那么 XML 基本上是有用的。否则，对于您从中获得的东西，它通常是非常重量级的（代码大小、复杂性）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-01T22:56:50.733

无论您选择哪种格式，请记住在其中存储某种版本号（我很确定您必须进行一些更改）。

格式很大程度上取决于应用程序和数据量。对于某些应用程序，XML 是合适的，对于其他应用程序，存储在二进制文件中的固定大小的结构是好的。

我根据情况使用许多不同的格式，例如：

*   用于存储 Matlab 和 R 分析数据集的纯文本文件（分隔）
*   二进制文件 - 用于存储固定大小的结构（在动态大小的情况下，如果不为元素维护单独的偏移量数组，随机访问会变得很困难）。您获得了性能和空间效率的好处之一（为什么大多数数据库都以二进制格式存储数据？），但这对人类来说并不是很好。记住字节序。
*   XML - 通常用于配置数据或我想提供给其他用户应用程序的数据（连同 XSD）。另一方可以编写漂亮的 XSLT 转换或以其他方式使用数据（当然，他们可以对纯文本或二进制数据执行相同的操作，给定格式描述）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-01T23:06:04.363

除非您有独特的要求，否则请使用已经有成熟库的东西，这样您就可以避免编写自己的解析代码。就像人们所说的那样，这意味着 XML/JSON 等。

另一个不错的是 Google 的协议缓冲区（[http://code.google.com/p/protobuf](http://code.google.com/p/protobuf)）。在那里您编写一个通用消息定义，并且协议缓冲区编译器为您生成用于填充、序列化和反序列化数据的对象。通常格式是二进制的，但您也可以使用他们的 TextFormat 类来编写类似 JSON 的纯文本。protobufs 的好处是可以为您生成版本控制代码。在您的文件格式的版本 2 中，您所要做的就是将字段添加到 .proto 定义文件。新版本可以读取旧文件格式，只是将新字段留空。这并不是 protobufs 的设计目的，但它们为自定义消息提供了一种简单、高效的二进制文件格式，并且为您生成了代码。

另请参阅 Facebook 的[Thrift](http://incubator.apache.org/thrift/)，现在在 Apache 孵化器中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-01T23:07:30.707

随着岁月的流逝，我发现自己越来越喜欢文字，除非它根本不可能。CPU 的速度已经足够快，我们可以足够快地对其进行解码。

显然，当您必须经常更新大文件中的少量信息时，这不是一种选择——但它很可能描述了一个数据库。

在这一点上，我需要一个不寻常的情况才能让我选择这两个选项之一以外的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-01T23:10:13.947

+1 用于 XML。有一点开销，但易于解析、读取和调试。如果您使用的是模式，可以是严格的。易于使用 XSLT 进行转换，并且非常便携（有线或仅在 pendrive 中：）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-01T23:11:30.980

这实际上取决于具体情况。您需要根据各种问题的答案来考虑您的选择：

*   您需要存储多少数据？您是否需要针对紧凑表示进行优化？
*   读/写的性能是否重要？您是否需要针对磁盘访问和低影响的序列化和反序列化进行优化？
*   您需要在文件中进行随机访问吗？您是否需要优化结构以在数据中查找？
*   这些数据是否将在不同的系统中使用，可能具有不同的字符编码？您是否需要针对可移植性进行优化？

数据本身的性质会产生影响。它是平面列表结构吗？它是一棵树吗？是循环图吗？记录是固定宽度还是可变宽度？

一旦知道了这些问题的答案，您就可以在选项中进行选择，使其尽可能简单。通常流行的选项（XML、CSV、YAML）会适合您的目的。如果没有，那么您将不得不开发自己的格式以及您自己的写作和阅读程序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-02T00:01:39.830

有这么多可能，但最务实的还是XML

*   几乎每个开发平台都有不错的 XML 库
*   大多数平台都允许使用几行代码进行对象图序列化，因此 XML 实现起来很轻松
*   大多数平台都有内存和/或流式阅读器，因此您可以处理非常大的文件而不会占用太多内存
*   大多数平台都提供 XSLT 转换器，因此您可以将文件从一种格式移动到另一种格式，甚至从 XML 到非 XML
*   XML 的索引扩展也可以处理非常大的文件
*   XML 有 XSD 在您尝试阅读之前验证格式
*   XML 能够表示任何简单或复杂的对象
*   如果您担心文件大小，只需压缩最终的 XML。此技术用于 Microsoft Office 等
*   XML 仍然是人类可读的
*   XML 是一种通用标准

# php - 如何配置 WAMP (localhost) 以使用 Gmail 发送电子邮件？

> ID：600725
> 
> 赞同：46
> 
> 时间：2009-03-01T22:54:52.143
> 
> 标签：php, gmail, localhost, wamp

我想使用本地主机中的 mail() 函数。我安装了 WAMP 和一个 Gmail 帐户。我知道 Gmail 的 SMTP 是 smtp.gmail.com，端口是 465（[来自 gmail 的更多信息](http://mail.google.com/support/bin/answer.py?answer=78799)）。我需要在 WAMP 中配置什么才能使用 mail() 函数？

谢谢！！

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-01T23:04:09.950

Gmail 服务器使用 SSL 或 TLS 下的 SMTP 身份验证。我认为在这种情况下无法使用该`mail()`功能，因此您可能需要检查以下替代方案：

*   [梨::邮件](http://pear.php.net/package/Mail)
*   [phpMailer](http://sourceforge.net/projects/phpmailer/)
*   [内特\邮件](https://github.com/nette/mail)

它们都支持 SSL 下的 SMTP 身份验证。

您需要`php_openssl`在 php.ini 中启用扩展。

其他资源：

*   [如何使用 SMTP 身份验证从 PHP 脚本发送电子邮件](http://email.about.com/od/emailprogrammingtips/qt/et073006.htm)（使用`PEAR::Mail`）
*   [使用 PHP 和 Gmail 发送电子邮件](http://deepakssn.blogspot.com/2006/06/gmail-php-send-email-using-php-with.html) （使用*phpMailer*）
*   [邮寄](https://doc.nette.org/en/2.3/mailing)使用`Nette\Mail`

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2013-05-29T12:47:46.483

我在这里回答了这个问题：[（WAMP/XAMP）使用 SMTP localhost 发送邮件](https://stackoverflow.com/questions/16830673/wamp-xamp-send-mail-using-smtp-localhost)（不仅适用于 GMAIL，也适用于其他人）。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-08-01T03:08:36.033

如果你在 wamp 中打开 php.ini 文件，你会发现这两行：

```
smtp_server
smtp_port 
```

为您的主机添加服务器和端口号（您可能需要联系他们以获取详细信息）

以下两行不存在：

```
auth_username
auth_password 
```

因此，您需要添加它们才能从需要身份验证的服务器发送邮件。所以一个例子可能是：

```
smtp_server = mail.example.com
smtp_port = 26
auth_username = example_username@example.com
auth_password = example_password 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-04-09T22:46:43.160

这很简单。（为方便起见调整语法）

```
public $smtp = array(
    'transport' => 'Smtp',
    'from' => 'your_email@gmail.com',
    'host' => 'ssl://smtp.gmail.com',
    'port' => 465,
    'timeout' => 30,
    'username' => 'your_email@gmail.com',
    'password' => '*****'
) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-04-18T12:00:30.853

作为 PHPMailer、Pear's Mail 和其他人的替代品，您可以使用[Zend 的库](https://framework.zend.com/manual/1.12/en/zend.mail.sending.html)

```
 $config = array('auth' => 'login',
                   'ssl' => 'ssl',
                   'port'=> 465,
                   'username' => 'XXXX@gmail.com',
                   'password' => 'XXXXXXX');

 $transport = new Zend_Mail_Transport_Smtp('smtp.gmail.com', $config);
 $mail = new Zend_Mail();
 $mail->setBodyText('This is the text of the mail.');
 $mail->setFrom('XXXX@gmail.com', 'Some Sender');
 $mail->addTo('kazifriend@gmail.com', 'Some Recipient');
 $mail->setSubject('TestSubj');
 $mail->send($transport); 
```

那是我在 localhost 服务器中的设置，我可以看到收到的邮件到我的邮箱。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-01T23:04:49.903

我知道在 XAMPP 中我可以配置 sendmail.ini 来转发本地电子邮件。需要设置

```
smtp_sever
smtp_port
auth_username
auth_password 
```

这在使用我自己的服务器时有效，而不是 gmail 所以不能肯定你没有问题

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-04-27T10:19:54.997

在您的服务器上使用 stunnel，使用 gmail 发送。去谷歌上查询。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-01T23:00:06.390

我很肯定它也需要 SMTP 身份验证凭据。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-03-01T15:47:08.113

[PEAR：Mail](http://pear.php.net/package/Mail)对我从 Gmail 发送电子邮件有用。此外，说明： [How to Send Email from a PHP Script Using SMTP Authentication](http://email.about.com/od/emailprogrammingtips/qt/et073006.htm) (Using PEAR::Mail) 帮助很大。谢谢，CMS！

# java - 使用Java使用正则表达式查找更大字符串的子字符串

> ID：600733
> 
> 赞同：151
> 
> 时间：2009-03-01T22:58:05.410
> 
> 标签：java, regex, string

如果我有这样的字符串：

```
FOO[BAR] 
```

我需要一种通用的方法来从字符串中取出“BAR”字符串，这样无论方括号之间是什么字符串，它都可以得到该字符串。

例如

```
FOO[DOG] = DOG
FOO[CAT] = CAT 
```

* * *

## 回答 #1

> 赞同：269
> 
> 时间：2009-03-01T22:59:57.293

您应该能够使用非贪婪量词，特别是 *?。您可能需要以下内容：

```
Pattern MY_PATTERN = Pattern.compile("\\[(.*?)\\]"); 
```

这将为您提供一个与您的字符串匹配的模式，并将文本放在第一组的方括号内。查看[Pattern API 文档](http://download.oracle.com/javase/6/docs/api/java/util/regex/Pattern.html)以获取更多信息。

要提取字符串，您可以使用如下内容：

```
Matcher m = MY_PATTERN.matcher("FOO[BAR]");
while (m.find()) {
    String s = m.group(1);
    // s now contains "BAR"
} 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-03-01T23:02:01.313

非正则表达式方式：

```
String input = "FOO[BAR]", extracted;
extracted = input.substring(input.indexOf("["),input.indexOf("]")); 
```

或者，为了更好的性能/内存使用（感谢 Hosam）：

```
String input = "FOO[BAR]", extracted;
extracted = input.substring(input.indexOf('['),input.lastIndexOf(']')); 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2011-12-15T04:44:43.020

这是一个工作示例：

正则表达式示例.java

```
package org.regexp.replace;

import java.util.ArrayList;
import java.util.List;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class RegexpExample
{
    public static void main(String[] args)
    {
        String string = "var1[value1], var2[value2], var3[value3]";
        Pattern pattern = Pattern.compile("(\\[)(.*?)(\\])");
        Matcher matcher = pattern.matcher(string);

        List<String> listMatches = new ArrayList<String>();

        while(matcher.find())
        {
            listMatches.add(matcher.group(2));
        }

        for(String s : listMatches)
        {
            System.out.println(s);
        }
    }
} 
```

它显示：

```
value1
value2
value3 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-10-28T16:55:58.787

```
import java.util.*;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public static String get_match(String s, String p) {
    // returns first match of p in s for first group in regular expression 
    Matcher m = Pattern.compile(p).matcher(s);
    return m.find() ? m.group(1) : "";
}

get_match("FOO[BAR]", "\\[(.*?)\\]")  // returns "BAR"

public static List<String> get_matches(String s, String p) {
    // returns all matches of p in s for first group in regular expression 
    List<String> matches = new ArrayList<String>();
    Matcher m = Pattern.compile(p).matcher(s);
    while(m.find()) {
        matches.add(m.group(1));
    }
    return matches;
}

get_matches("FOO[BAR] FOO[CAT]", "\\[(.*?)\\]")) // returns [BAR, CAT] 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-02T10:50:50.503

如果您只需要获取 之间的任何内容`[]`，则可以`\[([^\]]*)\]`像这样使用：

```
Pattern regex = Pattern.compile("\\[([^\\]]*)\\]");
Matcher m = regex.matcher(str);
if (m.find()) {
    result = m.group();
} 
```

如果您需要它的形式，*`identifier + [ + content + ]`*那么您可以限制仅在标识符是字母数字时提取内容：

```
[a-zA-Z][a-z-A-Z0-9_]*\s*\[([^\]]*)\] 
```

这将验证诸如`Foo [Bar]`，或之类的东西`myDevice_123["input"]`。

**主要问题**

主要问题是当你想提取这样的内容时：

```
FOO[BAR[CAT[123]]+DOG[FOO]] 
```

正则表达式不起作用，将返回`BAR[CAT[123`and `FOO`。
如果我们将 Regex 更改为`\[(.*)\]`then 我们就可以了，但是，如果您尝试从更复杂的内容中提取内容，例如：

```
FOO[BAR[CAT[123]]+DOG[FOO]] = myOtherFoo[BAR[5]] 
```

没有一个正则表达式将起作用。

在所有情况下提取正确内容的最准确的正则表达式会复杂得多，因为它需要平衡`[]`对并为您提供内容。

**更简单的解决方案**

如果您的问题变得复杂并且内容随意，您可以使用普通的旧代码而不是正则表达式`[]`来平衡对并提取字符串：`[]`

```
int i;
int brackets = 0;
string c;
result = "";
for (i = input.indexOf("["); i < str.length; i++) {
    c = str.substring(i, i + 1);
    if (c == '[') {
        brackets++;
    } else if (c == ']') {
        brackets--;
        if (brackets <= 0) 
            break;
    }
    result = result + c;
} 
```

这比真实代码更像是伪代码，我不是 Java 编码器，所以我不知道语法是否正确，但它应该很容易改进。
重要的是这段代码应该可以工作并允许您提取 的内容`[]`，无论它多么复杂。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-01T23:02:37.303

我认为你的正则表达式看起来像：

```
/FOO\[(.+)\]/ 
```

假设 FOO 将保持不变。

所以，把它放在Java中：

```
Pattern p = Pattern.compile("FOO\\[(.+)\\]");
Matcher m = p.matcher(inputLine); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-02T10:59:59.030

```
String input = "FOO[BAR]";
String result = input.substring(input.indexOf("[")+1,input.lastIndexOf("]")); 
```

这将返回第一个'['和最后一个']'之间的值

Foo[Bar] => 酒吧

Foo[Bar[test]] => Bar[test]

注意：如果输入字符串格式不正确，您应该添加错误检查。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-01T23:03:06.723

假设其中不允许有其他右方括号， /FOO\[([^\]]*)\]/

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-01T23:04:40.200

我会定义我想要在`[`和之间有最大数量的非] 字符`]`。这些需要用反斜杠转义（在Java中，这些需要再次转义），并且non-]的定义是一个字符类，因此在`[`和`]`（即`[^\\]]`）内部。结果：

```
FOO\\[([^\\]]+)\\] 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-04-18T04:33:01.483

如果你想解析一些来自 mYearInDB.toString() =[2013] 的字符串，它会像这样工作，它会给出 2013

```
Matcher n = MY_PATTERN.matcher("FOO[BAR]"+mYearInDB.toString());
while (n.find()) {
 extracredYear  = n.group(1);
 // s now contains "BAR"
    }
    System.out.println("Extrated output is : "+extracredYear); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-04-03T06:48:05.150

这个正则表达式对我有用：

```
form\[([^']*?)\] 
```

例子：

```
form[company_details][0][name]
form[company_details][0][common_names][1][title] 
```

输出：

```
Match 1
1\.  company_details
Match 2
1\.  company_details 
```

[在http://rubular.com/](http://rubular.com/)上测试

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-08-27T15:12:43.520

```
"FOO[DOG]".replaceAll("^.*?\\[|\\].*", ""); 
```

这将返回一个字符串，该字符串仅包含方括号内的字符串。

这会从方括号中删除所有字符串。

你可以在线测试这个java示例代码：http: [//tpcg.io/wZoFu0](http://tpcg.io/wZoFu0)

您可以从这里测试这个正则表达式： [https ://regex101.com/r/oUAzsS/1](https://regex101.com/r/oUAzsS/1)

# java - 高请求场景下的 Java Threadpool vs. new Thread

> ID：600734
> 
> 赞同：8
> 
> 时间：2009-03-01T22:58:38.687
> 
> 标签：java, sockets, threadpool

我有一些用于 REST 服务的旧 Java 代码，它为每个传入请求使用单独的线程。即主循环将在 socket.accept() 上循环并将套接字移交给一个 Runnable，然后它将启动它自己的后台线程并在其自身上调用 run。这在一段时间内工作得非常好，直到最近我注意到在高负载下接受处理请求的延迟将变得不可接受。当我说得非常好时，我的意思是它每秒处理 100-200 个请求而没有显着的 CPU 使用率。只有当其他守护进程也增加负载并且只有一次负载超过 5 时，性能才会下降。当机器处于来自其他进程组合的高负载（5-8）时，从接受到处理的时间会变得非常长（ 500 毫秒到 3000 毫秒），而实际处理保持在 10 毫秒以下。

已经习惯了 .NET 上的线程池，我认为线程创建是罪魁祸首，我想我会在 java 中应用相同的模式。现在我的 Runnable 使用 ThreadPool.Executor 执行（并且池使用和 ArrayBlockingQueue）。同样，它在大多数情况下都非常有效，除非机器负载变高，然后从创建可运行对象到调用 run() 的时间显示出同样荒谬的时间。但更糟糕的是，在线程池逻辑到位的情况下，系统负载几乎翻了一番（10-16）。所以现在我在双倍负载下遇到了同样的延迟问题。

我的怀疑是队列的锁竞争比之前没有锁的新线程启动成本更糟糕。任何人都可以分享他们对新线程与线程池的经验。如果我的怀疑是正确的，那么任何人都有另一种方法来处理没有锁争用的线程池？

我很想将整个系统设为单线程，因为我不知道我的线程有多大帮助，而且 IO 似乎不是问题，但我确实收到了一些长期存在的请求，然后阻止一切。

谢谢，阿恩

更新：我切换到`Executors.newFixedThreadPool(100);`它，虽然它保持相同的处理能力，但负载几乎立即翻了一番，运行 12 小时显示负载始终保持在 2 倍。我想在我的情况下，每个请求一个新线程更便宜。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-04T07:34:20.537

配置如下：

```
new ThreadPoolExecutor(10, 100, 30, TimeUnit.SECONDS, 
        new ArrayBlockingQueue<Runnable>(100)) 
```

那么一旦有 10 个线程同时处理请求，就将进一步的请求添加到队列中，除非队列中达到 100 个请求，此时会开始创建新的线程，除非已经有 100 个线程，此时该命令的处理将被拒绝。

（复制如下）的[javadocs`ThreadPoolExecutor`](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ThreadPoolExecutor.html)部分可能值得一读。

基于它们，以及您显然愿意运行 100 个线程，以及您希望接受所有请求并最终处理它们。我建议尝试以下变体：

```
new ThreadPoolExecutor(100, 100, 0, TimeUnit.SECONDS, 
        new LinkedBlockingQueue<Runnable>()) 
```

顺便说一句，这就是你从中得到的`Executors.newFixedThreadPool(100);`

* * *

> ## 排队
> 
> 任何 BlockingQueue 都可以用来传输和保存提交的任务。此队列的使用与池大小交互：
> 
> *   如果运行的线程少于 corePoolSize，则 Executor 总是更喜欢添加新线程而不是排队。
> *   如果 corePoolSize 或更多线程正在运行，Executor 总是更喜欢排队请求而不是添加新线程。
> *   如果请求无法排队，则会创建一个新线程，除非这将超过 maximumPoolSize，在这种情况下，该任务将被拒绝。
> 
> 排队的一般策略有以下三种：
> 
> 1.  直接交接。工作队列的一个很好的默认选择是 SynchronousQueue，它将任务交给线程而不用其他方式保留它们。在这里，如果没有立即可用的线程来运行任务，则尝试将任务排队将失败，因此将构造一个新线程。在处理可能具有内部依赖关系的请求集时，此策略可避免锁定。直接切换通常需要无限的 maximumPoolSizes 以避免拒绝新提交的任务。这反过来又承认了当命令的平均到达速度超过了它们的处理速度时，可能会出现无限线程增长。
> 2.  无界队列。当所有 corePoolSize 线程都忙时，使用无界队列（例如没有预定义容量的 LinkedBlockingQueue）将导致新任务在队列中等待。因此，不会创建超过 corePoolSize 个线程。（因此maximumPoolSize的值没有任何影响。）当每个任务完全独立于其他任务时，这可能是合适的，因此任务不会影响彼此的执行；例如，在网页服务器中。虽然这种排队方式在平滑请求的瞬时突发方面很有用，但它承认当命令平均到达速度快于处理速度时，工作队列可能会无限增长。
> 3.  Bounded queues. A bounded queue (for example, an ArrayBlockingQueue) helps prevent resource exhaustion when used with finite maximumPoolSizes, but can be more difficult to tune and control. Queue sizes and maximum pool sizes may be traded off for each other: Using large queues and small pools minimizes CPU usage, OS resources, and context-switching overhead, but can lead to artificially low throughput. If tasks frequently block (for example if they are I/O bound), a system may be able to schedule time for more threads than you otherwise allow. Use of small queues generally requires larger pool sizes, which keeps CPUs busier but may encounter unacceptable scheduling overhead, which also decreases throughput.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-01T23:05:50.617

测量，测量，测量！它把时间花在哪里？创建 Runnable 时必须发生什么？Runnable 是否有任何可能在实例化过程中阻塞或延迟的内容？延迟期间发生了什么？

实际上，我非常相信从总体上考虑问题，但是这种情况，像这样的意外行为，只需要进行一些测量。

什么是运行时环境、JVM 版本和架构？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-02T12:56:31.933

Sun 的 实现`Thread`虽然比以前快得多，但确实具有锁定功能。IIRC，`ArrayBlockingQueue`忙碌时根本不应该锁定。因此它是分析器时间（甚至只是几秒`ctrl-\`或几秒`jstack`）。

系统负载只是告诉你有多少线程排队。它不一定很有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T23:43:13.897

我*只是*用我自己的一些代码做到了这一点。我使用 Netbeans 分析器来转换我正在使用的线程池实现。你应该可以用[Visual VM](https://visualvm.dev.java.net/)做同样的事情，但我还没有尝试过。

# c# - 全屏应用程序 WM6 C#

> ID：600735
> 
> 赞同：4
> 
> 时间：2009-03-01T22:58:47.220
> 
> 标签：c#, windows-mobile

谁能指出如何在 C# 中为 Windows Mobile 6 创建全屏应用程序的方向？

我正在尝试实现与 Tom Tom 等应用程序类似的显示，其中所有操作系统元素（如开始/任务栏）都被隐藏，我的应用程序完全填满了屏幕。

我正在使用 .Net 3.5 的 VS 2008

提前致谢！

OneSHOT

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T23:15:15.603

我不知道它在 WM6 中是否有任何不同，但在 WM2003 中，我可以通过在我的应用程序中的所有表单上简单地将 WindowState 设置为 Maximized 来“隐藏”任务栏等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T23:21:37.303

就像马特汉密尔顿所说的那样，但有时在（这是 WM5 和 .NET 2）上形成个人经验，您可能需要重新设置`this.WindowState = FormWindowState.Maximized;`。对我来说，它有时会被覆盖，因此当我在设备上执行多任务或开始监听 COM 端口时，任务栏可以显示。

# css - 如何让 div 高度自动调整为背景大小？

> ID：600743
> 
> 赞同：320
> 
> 时间：2009-03-01T23:01:20.083
> 
> 标签：css, html, background, height

如何让 div 自动调整到我为其设置的背景大小而不为其设置特定高度（或最小高度）？

* * *

## 回答 #1

> 赞同：616
> 
> 时间：2014-03-05T23:52:48.870

有一种很好很酷的方法可以让背景图像像一个`img`元素一样工作，因此它会`height`自动调整它。你需要知道图像`width`和`height`比例。将`height`容器的 设置为 0 并`padding-top`根据图像比例设置百分比。

它将如下所示：

```
div {
    background-image: url('http://www.pets4homes.co.uk/images/articles/1111/large/feline-influenza-all-about-cat-flu-5239fffd61ddf.jpg');
    background-size: contain;
    background-repeat: no-repeat;
    width: 100%;
    height: 0;
    padding-top: 66.64%; /* (img-height / img-width * container-width) */
                /* (853 / 1280 * 100) */
} 
```

你刚刚得到一个具有自动高度的背景图像，它就像一个 img 元素一样工作。这是一个工作原型（您可以调整大小并检查 div 高度）：http: [//jsfiddle.net/8m9ur5qj/](http://jsfiddle.net/8m9ur5qj/)

* * *

## 回答 #2

> 赞同：287
> 
> 时间：2012-08-23T18:59:41.860

另一个可能效率低下的解决方案是将图像包含在`img`设置为 的元素下`visibility: hidden;`。然后使`background-image`周围 div 的 与图像相同。

这会将周围的 div 设置为`img`元素中图像的大小，但将其显示为背景。

```
<div style="background-image: url(http://your-image.jpg);">
 <img src="http://your-image.jpg" style="visibility: hidden;" />
</div> 
```

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2009-03-01T23:09:08.397

无法使用 CSS 自动调整背景图像大小。

正如其他人所提到的，您可以通过测量服务器上的背景图像然后将这些属性应用于 div 来解决它。

您还可以破解一些 javascript 来根据图像大小调整 div 的大小（一旦下载了图像） - 这基本上是同一件事。

如果你需要你的 div 来自动适应图像，我可能会问你为什么不在你`<img>`的 div 里面放一个标签呢？

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2015-08-11T02:16:37.013

这个答案与其他答案相似，但总体上对于大多数应用程序来说是最好的。您需要事先知道图像大小，这与您通常做的一样。这将允许您添加覆盖文本、标题等，而无需图像的负填充或绝对定位。他们的关键是设置填充百分比以匹配图像纵横比，如下例所示。我使用[了这个答案](https://stackoverflow.com/a/12121309/2089133)，基本上只是添加了一个图像背景。

```
.wrapper {
  width: 100%;
  /* whatever width you want */
  display: inline-block;
  position: relative;
  background-size: contain;
  background: url('https://upload.wikimedia.org/wikipedia/en/thumb/6/67/Wiki-llama.jpg/1600px-Wiki-llama.jpg') top center no-repeat;
  margin: 0 auto;
}
.wrapper:after {
  padding-top: 75%;
  /* this llama image is 800x600 so set the padding top % to match 600/800 = .75 */
  display: block;
  content: '';
}
.main {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  left: 0;
  color: black;
  text-align: center;
  margin-top: 5%;
}
```

```
<div class="wrapper">
  <div class="main">
    This is where your overlay content goes, titles, text, buttons, etc.
  </div>
</div>
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-03-01T23:12:11.837

也许这会有所帮助，它不完全是背景，但你明白了：

```
<style>
div {
    float: left;
    position: relative;
}
div img {
    position: relative;
}

div div {
    position: absolute;
    top:0;
    left:0;
}
</style>

<div>
    <img src="http://antwrp.gsfc.nasa.gov/apod/image/0903/omegacen_davis.jpg" />
    <div>Hi there</div>
</div> 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2020-05-24T18:24:40.727

我查看了一些解决方案，它们很棒，但我认为我找到了一个非常简单的方法。

首先，我们需要从背景图像中获取比例。我们只是将一个维度划分为另一个维度。然后我们得到例如 66.4%

当我们有图像比例时，我们可以简单地通过将比例乘以视口宽度来计算 div 的高度：

```
height: calc(0.664 * 100vw); 
```

对我来说，它可以正常工作，正确设置 div 高度并在调整窗口大小时更改它。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2015-06-14T02:07:09.493

很确定这将永远不会在这里看到。但如果你的问题和我的一样，这就是我的解决方案：

```
.imaged-container{
  background-image:url('<%= asset_path("landing-page.png") %> ');
  background-repeat: no-repeat;
  background-size: 100%;
  height: 65vw;
} 
```

我想在图像的中心有一个 div，这将允许我这样做。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2016-05-06T08:49:47.957

有一个其他答案错过的纯 CSS 解决方案。

“content:”属性主要用于向元素中插入文本内容，但也可用于插入图像内容。

```
.my-div:before {
    content: url("image.png");
} 
```

这将导致 div 将其高度调整为图像的实际像素大小。要调整宽度，请添加：

```
.my-div {
    display: inline-block;
} 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-03-01T23:05:25.673

您可以在服务器端进行：通过测量图像然后设置 div 大小，或者使用 JS 加载图像，读取它的属性，然后设置 DIV 大小。

这里有一个想法，将相同的图像放在 div 中作为 IMG 标签，但赋予它可见性：隐藏 + 使用相对位置播放 + 给这个 div 图像作为背景。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2017-03-17T15:06:53.943

我遇到了这个问题并找到了 Hasanavi 的答案，但是在宽屏幕上显示背景图像时出现了一个小错误 - 背景图像没有扩展到整个屏幕宽度。

所以这是我的解决方案 - 基于 Hasanavi 的代码，但更好......这应该适用于超宽屏幕和移动屏幕。

```
/*WIDE SCREEN SUPPORT*/
@media screen and (min-width: 769px) { 
    div {
        background-image: url('http://www.pets4homes.co.uk/images/articles/1111/large/feline-influenza-all-about-cat-flu-5239fffd61ddf.jpg');
        background-size: cover;
        background-repeat: no-repeat;
        width: 100%;
        height: 0;
        padding-top: 66.64%; /* (img-height / img-width * container-width) */
                    /* (853 / 1280 * 100) */
    }
}

/*MOBILE SUPPORT*/
@media screen and (max-width: 768px) {
    div {
        background-image: url('http://www.pets4homes.co.uk/images/articles/1111/large/feline-influenza-all-about-cat-flu-5239fffd61ddf.jpg');
        background-size: contain;
        background-repeat: no-repeat;
        width: 100%;
        height: 0;
        padding-top: 66.64%; /* (img-height / img-width * container-width) */
                    /* (853 / 1280 * 100) */
    }
} 
```

您可能已经注意到，该`background-size: contain;`属性不适合超宽屏幕，并且该`background-size: cover;`属性也不适合移动屏幕，因此我使用此`@media`属性来调整屏幕尺寸并修复此问题。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2021-09-09T18:52:40.597

最近[引入的 CSS`aspect-ratio`属性](https://developer.mozilla.org/en-US/docs/Web/CSS/aspect-ratio)（~2020-2021）是一种无需填充黑客的好方法，并且在所有常青浏览器上都受支持。

由于我们需要提前知道图像的纵横比，并且在许多用例中，您将能够提前预先确定图像尺寸比（但并非总是针对用户生成的内容），您可以硬编码单个样式或在必要时内联 css。

`aspect-ratio`将在指定宽度时根据提供的比率计算高度（或计算宽度，如果指定了高度）。

```
div {
    aspect-ratio: 3 / 2; /*common ratio, like an 800*600px image */

    width: 200px; /* computed height will be 133.33px, which is width/aspect-ratio */
    background: red; /* so any image bleed is shown*/
    background-image: url('https://images.unsplash.com/photo-1631163190830-8770a0ad4aa9?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=200&q=80');
}
```

```
<div></div>
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2017-08-09T06:20:43.793

如果它是单个预定的背景图像，并且您希望 div 在不扭曲背景图像的纵横比的情况下做出响应，您可以首先计算图像的纵横比，然后通过执行以下操作创建一个保留其纵横比的 div ：

假设你想要一个 4/1 的纵横比并且 div 的宽度是 32%：

```
div {
  width: 32%; 
  padding-bottom: 8%; 
} 
```

这是因为填充是根据包含元素的宽度计算的。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2020-09-01T16:09:37.350

这对我有用：

```
background-image: url("/assets/image_complete_path");
background-position: center; /* Center the image */
background-repeat: no-repeat; /* Do not repeat the image */
background-size: cover;
height: 100%; 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-06-13T21:42:46.817

这个怎么样 ：）

```
.fixed-centered-covers-entire-page{
    margin:auto;
    background-image: url('https://i.imgur.com/Ljd0YBi.jpg');
    background-repeat: no-repeat;background-size:cover;
    background-position: 50%;
    background-color: #fff;
    left:0;
    right:0;
    top:0;
    bottom:0;
    z-index:-1;
    position:fixed;
}
```

```
<div class="fixed-centered-covers-entire-page"></div>
```

**演示：http:** [//jsfiddle.net/josephmcasey/KhPaF/](http://jsfiddle.net/josephmcasey/KhPaF/)

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2020-07-04T13:03:30.080

我会做相反的事情并将图像放在主 div 内，宽度为 100%，这将使 div 和图像都响应屏幕尺寸，

然后在主 div 内的宽度和高度为 100% 的绝对定位 div 中添加内容。

```
<div class="main" style="position: relative; width: 100%;">
    <img src="your_image.png" style="width: 100%;">
    <div style="position: absolute; width: 100%; height: 100%; display: flex...">
            YOUR CONTENT
    </div>
</div> 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2020-11-10T04:23:16.043

添加到原始接受的答案只需添加样式**宽度：100%;** 到**内部图像**，因此它将为移动设备自动缩小/扩展，并且最终不会在移动视图中占据较大的顶部或底部边距。

```
<div style="background-image: url(http://your-image.jpg);background-position:center;background-repeat:no-repeat;background-size: contain;height: auto;">
 <img src="http://your-image.jpg" style="visibility: hidden; width: 100%;" />
</div>
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2015-12-18T03:45:37.967

可能这会有所帮助，它不完全是背景，但你明白了

```
 <style>
div {
    float: left;
    position: relative;
}
div img {
    position: relative;
}

div div {
    position: absolute;
    top:0;
    left:0;
}
</style>

<div>
    <img src="http://www.planwallpaper.com/static/images/recycled_texture_background_by_sandeep_m-d6aeau9_PZ9chud.jpg" />
    <div>Hello</div>
</div> 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2018-11-06T16:41:55.627

你可以做这样的事情

```
<div style="background-image: url(http://your-image.jpg); position:relative;">
 <img src="http://your-image.jpg" style="opacity: 0;" />
<div style="position: absolute;top: 0;width: 100%;height: 100%;">my content goes here</div>
</div> 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-02-05T13:14:00.033

如果您在构建时知道图像的比例，想要基于窗口高度的高度并且您可以[针对现代浏览器（IE9+）](http://caniuse%20viewport%20units)，那么您可以为此使用视口单位：

```
.width-ratio-of-height {
  overflow-x: scroll;
  height: 100vh;
  width: 500vh; /* width here is 5x height */
  background-image: url("http://placehold.it/5000x1000");
  background-size: cover;
} 
```

不完全是 OP 的要求，但可能非常适合许多查看此问题的人，因此想在这里提供另一种选择。

*小提琴：[https ://jsfiddle.net/6Lkzdnge/](https://jsfiddle.net/6Lkzdnge/)*

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2020-06-03T09:35:37.300

假设你有这样的事情：

```
<div class="content">
    ... // inner HTML
</div> 
```

并且您想为其添加背景，但您不知道图像的尺寸。

我有一个类似的问题，我通过使用网格解决了它：

**HTML**

```
<div class="outer">
    <div class="content">
        ... // inner HTML
    </div>
    <img class="background" />
</div> 
```

**CSS**

```
.outer{
    display: grid;
    grid-template: auto / auto;
    // or you can assign a name for this block
}
.content{
    grid-area: 1 / 1 / 2 / 2;
    z-index: 2;
}
.background{
    grid-area: 1 / 1 / 2 / 2;
    z-index: 1;
} 
```

`z-index`只是为了将图像实际放置在背景中，您当然可以放置`img.background`在`div.content`.

**注意**：它可能会导致`div.content`图片具有相同的高度，因此如果`div.content`有任何根据其高度放置的孩子，您可能需要设置一个数字，而不是像“自动”这样的数字。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2021-03-11T16:57:00.387

受最喜欢的答案的启发，我最终想出了一个使用 min-height 和 'vw' 单位的解决方案

我的图像比例非常不寻常

通过实验我最终使用

```
 min-height: 36vw; 
```

该值必须根据您的图像比例发生变化

我的实际页面使用的 css 代码：

```
 background:url('your-background-image-adress') center center no-repeat;
    background-size: 100%;
    background-position: top center;
    margin-top: 50px;
    width: 100%;
    min-height: 36vw; 
```

代码笔示例[https://codepen.io/viniciusrad/pen/GRNPXoL](https://codepen.io/viniciusrad/pen/GRNPXoL)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2013-09-03T21:44:08.340

Umbraco CMS 有这个问题，在这种情况下，您可以使用类似这样的 div 的“样式”属性将图像添加到 div：

```
style="background: url('@(image.mediaItem.Image.umbracoFile)') no-repeat scroll 0 0 transparent; height: @(image.mediaItem.Image.umbracoHeight)px" 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2014-06-13T21:34:33.773

我一直在处理这个问题，并决定编写一个 jquery 插件来解决这个问题。这个插件将找到所有具有“show-bg”类的元素（或者你可以传递你自己的选择器）并计算它们的背景图像尺寸。您所要做的就是包含此代码，用 class="show 标记所需的元素

享受！

[https://bitbucket.org/tomeralmog/jquery.heightfrombg](https://bitbucket.org/tomeralmog/jquery.heightfrombg)

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2017-08-09T07:13:44.330

我能想到的最佳解决方案是以百分比指定宽度和高度。这将允许您根据显示器尺寸调整屏幕大小。它更多的是响应式布局..

例如。你有

```
<br/>
<div> . //This you set the width percent to %100
    <div> //This you set the width percent to any amount . if you put it by 50% , it will be half
    </div>
 </div> 
```

如果您想要响应式布局，这是最好的选择，我不推荐 float ，在某些情况下可以使用 float 。但在大多数情况下，我们避免使用浮点数，因为当您进行跨浏览器测试时，它会影响很多事情。

希望这可以帮助 ：）

* * *

## 回答 #25

> 赞同：-2
> 
> 时间：2013-04-04T03:22:15.753

如果你可以在Photoshop上制作一个主层不透明度为1左右并且基本上是透明的图像，把那个img放在div中，然后将真实的图片作为背景图像。然后将 img 的不透明度设置为 1 并添加所需的尺寸。

那张照片就是这样完成的，你甚至不能将不可见的图像拖出页面，这很酷。

* * *

## 回答 #26

> 赞同：-2
> 
> 时间：2015-08-23T15:54:33.597

实际上，当您知道如何操作时，这很容易：

```
<section data-speed='.618' data-type='background' style='background: url(someUrl) 
top center no-repeat fixed;  width: 100%; height: 40vw;'>
<div style='width: 100%; height: 40vw;'>
</div>
</section> 
```

诀窍就是将封闭的 div 设置为普通 div，其尺寸值与背景尺寸值相同（在本例中为 100% 和 40vw）。

* * *

## 回答 #27

> 赞同：-2
> 
> 时间：2016-05-04T18:55:07.430

我使用 jQuery 解决了这个问题。在新的 CSS 规则本身允许这种类型的行为之前，我发现这是最好的方法。

**设置你的 div**

下面是您希望背景出现的 div（“hero”），然后是您想要覆盖在背景图像之上的内部内容/文本（“inner”）。您可以（并且应该）将内联样式移动到您的英雄类。我将它们留在这里，以便快速轻松地查看应用了哪些样式。

```
<div class="hero" style="background-image: url('your-image.png'); background-size: 100%; background-repeat: no-repeat; width: 100%;">
    <div class="inner">overlay content</div>
</div> 
```

**计算图像纵横比**

接下来通过将图像的高度除以宽度来计算图像的纵横比。例如，如果您的图像高度为 660，宽度为 1280，则您的纵横比为 0.5156。

**设置一个 jQuery 窗口调整大小事件来调整高度**

最后，添加一个用于调整窗口大小的 jQuery 事件侦听器，然后根据纵横比计算英雄 div 的高度并更新它。由于使用纵横比的计算不完善，此解决方案通常会在底部留下一个额外的像素，因此我们将 -1 添加到结果大小。

```
$(window).on("resize", function ()
{
    var aspect_ratio = .5156; /* or whatever yours is */
    var new_hero_height = ($(window).width()*aspect_ratio) - 1;
    $(".hero").height(new_hero_height);
} 
```

**确保它适用于页面加载**

您应该在页面加载时执行上面的调整大小调用，以便在一开始就计算图像大小。如果你不这样做，那么在你调整窗口大小之前，英雄 div 不会调整。我设置了一个单独的函数来进行调整大小调整。这是我使用的完整代码。

```
function updateHeroDiv()
{
    var aspect_ratio = .5156; /* or whatever yours is */
    var new_hero_height = ($(window).width()*aspect_ratio) - 1;
    $(".hero").height(new_hero_height);
}

$(document).ready(function() 
{       
    // calls the function on page load
    updateHeroDiv(); 

    // calls the function on window resize
    $(window).on("resize", function ()
    {
        updateHeroDiv();        
    }
}); 
```

* * *

## 回答 #28

> 赞同：-4
> 
> 时间：2013-06-26T03:33:38.883

只需添加到`div`

```
style="overflow:hidden;" 
```

# c# - 当你做错所有事情时追踪内存泄漏的策略

> ID：600757
> 
> 赞同：7
> 
> 时间：2009-03-01T23:06:12.787
> 
> 标签：c#, memory-leaks

唉，我的程序在某处有内存泄漏，但如果我知道它是什么，我会被诅咒的。

它的工作是读取一堆约 2MB 的文件，进行一些解析和字符串替换，然后以各种格式输出它们。自然，这意味着很多字符串，因此进行内存跟踪表明我有很多字符串，这正是我所期望的。程序的结构是一系列类（每个类都在自己的线程中，因为我是个*白痴*），它们作用于代表内存中每个文件的对象。（每个对象都有一个在两端使用锁的输入队列。虽然这意味着我可以并行运行这个简单的处理，但这也意味着我有多个 2MB 的对象位于内存中。）每个对象的结构都由一个模式对象定义.

我的处理类在完成处理后引发事件，并传递对包含我所有字符串的大对象的引用，以将其添加到下一个处理对象的队列中。将事件替换为添加到队列的函数调用不会阻止泄漏。其中一种输出格式要求我使用非托管对象。在类上实现 Dispose() 并不能阻止泄漏。我已经用索引名称替换了对架构对象的所有引用。没有骰子。我不知道是什么原因造成的，也不知道去哪里找。内存跟踪没有帮助，因为我看到的只是一堆正在创建的字符串，而且我看不到引用在内存中的位置。

在这一点上，我们几乎要放弃并回滚，但我病态地需要确切地知道我是如何搞砸的。我知道 Stack Overflow 无法准确梳理我的代码，但是您可以建议哪些策略来跟踪此泄漏？我可能会在自己的时间里做这件事，所以任何方法都是可行的。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-01T23:11:19.623

我会尝试的一种技术是系统地减少演示问题所需的代码量，而不会使问题消失。这被非正式地称为“分而治之”，是一种强大的调试技术。一旦你有一个演示相同问题的*小*例子，你就会更容易理解。也许到那时内存问题会变得更加清晰。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-01T23:12:06.313

只有一个人可以帮助你。那个人的名字是[苔丝·费兰德斯](http://blogs.msdn.com/tess/)。（沉默）

不过实话说。阅读她的博客（第一篇文章非常中肯）。看看她如何调试这些东西会让你深入了解你的问题发生了什么。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-01T23:13:36.077

我喜欢 Microsoft 的[CLR Profiler](http://en.wikipedia.org/wiki/CLR_Profiler)。它提供了一些很好的工具来可视化托管堆和跟踪泄漏。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-01T23:15:23.730

我使用[dotTrace](http://www.jetbrains.com/profiler/)分析器来跟踪内存泄漏。它比方法论的反复试验更具确定性，并且更快地得出结果。

对于系统执行的任何操作，我拍摄一个快照，然后运行该函数的几次迭代，然后拍摄另一个快照。比较两者将显示所有在两者之间创建但未释放的对象。然后，您可以在创建时查看堆栈帧，从而确定哪些实例没有被释放。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-01T23:19:34.563

得到这个：[http ://www.red-gate.com/Products/ants_profiler/index.htm](http://www.red-gate.com/Products/ants_profiler/index.htm)

内存和性能分析很棒。能够实际看到正确的数字而不是猜测使优化非常快。我在工作中使用了很多它来减少我们主应用程序的内存占用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-01T23:13:49.647

1.  将代码添加到非托管对象的构造函数中，以便在它被引导时进行记录，并对唯一 ID 进行排序。当对象再次被销毁时使用该唯一 ID，您至少可以分辨出哪些对象会误入歧途。
2.  Grep 为您构造新对象的每个地方的代码；按照该代码路径查看是否有匹配的销毁。
3.  添加指向构造对象的链接指针，因此您可以链接到在当前对象之前和之后构造的对象。然后你可以稍后扫过它们。
4.  添加引用计数器。
5.  是否有可用的“调试 malloc”？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-01T23:15:10.800

[SoS](http://msdn.microsoft.com/en-us/magazine/cc164138.aspx) （罢工之子）中的托管调试添加对于跟踪托管内存“泄漏”非常强大，因为根据定义，它们可以从 gc 根中发现。

它可以在 WinDbg 或 Visual Studio 中工作（尽管它在许多方面更容易在 WinDbg 中使用）

掌握它并不容易。这是一个[教程](http://www.develop.com/media/pdfs/developments_archive/SOS.pdf)

我也会支持查看 Tess Fernandez 的博客的建议。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-01T23:17:25.677

你怎么知道你实际上有内存泄漏？

另一件事：您写道您的处理类正在使用事件。如果您注册了一个事件处理程序，它将使拥有该事件的对象保持活动状态——即 GC 无法收集它。如果您希望您的对象被垃圾收集，请确保取消注册所有事件处理程序。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-01T23:35:53.167

如果您的非托管对象确实是泄漏的原因，您可能希望`AddMemoryPressure`在它分配非托管内存时调用它，并`RemoveMemoryPressure`在`Finalize`//`Dispose`释放非托管内存的地方调用它。这将使 GC 更好地处理这种情况，因为它可能没有意识到需要安排收集。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-02T00:35:44.070

小心你如何定义“泄漏”。“使用更多内存”甚至“使用太多内存”与“内存泄漏”不同。在垃圾收集环境中尤其如此。可能只是 GC 不需要收集您看到使用的额外内存。还要注意虚拟内存使用和物理内存使用之间的差异。

最后，并非所有“内存泄漏”都是由“内存”类问题引起的。我曾经被告知（没有被要求）修复导致 IIS 频繁重启的紧急内存泄漏。事实上，我进行了分析，发现我通过 StringBuilder 类使用了很多字符串。我为 StringBuilders 实现了一个对象池（来自 MSDN 文章），内存使用量大幅下降。

IIS 仍然像以前一样频繁地重新启动。这是因为没有内存泄漏。相反，有一些非托管代码声称是线程安全的，但实际上并非如此。在 Web 服务（多线程）中使用它会导致它在整个 C 运行时库堆中写入。由于没有人在寻找非托管异常，所以直到我碰巧使用自动化 QA 的 AQtime 进行了一些分析之前，没有人看到这一点。它碰巧有一个事件窗口，恰好显示来自 C 运行时库的痛苦呼喊。

在对非托管代码的调用周围加锁，“内存泄漏”就消失了。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-02T15:02:20.990

你提到你使用的事件。完成对象后，您是否从这些事件中删除处理程序？我发现如果你添加一堆处理程序而不在完成后删除它们，那么“松散”的事件处理程序会导致很多内存泄漏问题。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-02T16:00:24.580

.Net 最好的内存分析工具是这样的：

[http://memprofiler.com](http://memprofiler.com)

此外，当我在这里时，.Net 的最佳性能分析器是这样的：

[http://www.yourkit.com/dotnet/download/index.jsp](http://www.yourkit.com/dotnet/download/index.jsp)

它们也物超所值，开销低且易于使用。任何认真对待 .Net 开发的人都应该立即考虑将这两者视为个人投资和购买。他们俩都有免费试用。

我使用 C# 编写的超过 70 万行代码的实时游戏引擎工作，并且使用这两个工具花费了数百个小时。我从 2002 年开始使用 Sci Tech 产品和 YourKit！在过去的三年里。虽然我已经尝试了很多其他的，但我总是回到这些。

恕我直言，他们都非常出色。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-01-27T23:42:36.467

与 Charlie Martin 类似，您可以执行以下操作：

```
static unigned __int64 _foo_id = 0;
foo::foo()
{
    ++_foo_id;
    if (_foo_id == MAGIC_BAD_ALLOC_ID)
        DebugBreak();
    std::werr << L"foo::foo @ " << _foo_id << std::endl;
}
foo::~foo()
{
    --_foo_id;
    std::werr << L"foo::~foo @ " << _foo_id << std::endl;
} 
```

如果您可以重新创建它，即使使用相同的分配 id 甚至一次或两次，这将让您查看当时正在发生的事情（显然，如果需要，还必须处理 TLS/线程，但我把它留了下来明晰）。

# php - 在 php 中创建一个 rss 提要（在 mamp 中查看）

> ID：600758
> 
> 赞同：0
> 
> 时间：2009-03-01T23:06:14.267
> 
> 标签：php, rss, mamp

我已经使用下面的代码在 php 中创建了一个 rss 提要。我已经仔细检查了所有变量（即用户名和密码）并且它们是正确的。mysql 也设置正确。当我尝试使用 mamp 在我的计算机上本地查看此内容时，我只是得到一个空白页。任何帮助将不胜感激..此代码看起来是否正确，除了mamp之外，我还应该使用其他东西来查看它吗？

```
<? header('Content-type: text/xml'); ?>

<?php
$dbhost = "localhost"; // almost always localhost.
$dbname = "links"; // Database Name
$dbuser = "root"; // Database Username
$dbpass = "password"; // Databse Password

$connect = mysql_connect("$dbhost","$dbuser","$dbpass");// Connecting to Database
mysql_select_db($dbname) or die (mysql_error()); // Selecting Database
?> 

<rss version="2.0">
<channel>
    <title> </title>
    <description> </description>
    <link></link>

<?
$sql = "SELECT * FROM news limit 5";
$result = mysql_query($sql);
while($row = mysql_fetch_assoc($result)){
?>

<item>
     <title><?=$row['title']; ?></title>
     <author><?=$row['author']; ?></author>
     <link>http://MYSITE.com/news.php?id=<?=$row['id']; ?></link>
</item>

<?
}
?>

</channel>
</rss> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T23:13:17.293

有几件事可以尝试：

1.  检查日志。
2.  在输出之前将调用移到`header()`顶部。
3.  删除`<blockquote>`标签。
4.  在元素`<?xml version="1.0"?>`之前的顶部添加处理指令 ( )。`<rss>`
5.  `content-type`将标题从更改`text/xml`为`application/xml`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-01T23:18:42.367

当我复制此代码并更改 MySQL 设置以使用实际存在的用于我的 MAMP 设置的数据库时，这对我来说很好，因为该表在数据库中不存在，所以有 0 个项目。换句话说，您的 MAMP 设置似乎有问题，而不是您的代码。你确定你的 MySQL 服务器正在运行并且你有正确的信息来连接它吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T00:03:17.797

在 MAMP 中，您可以通过打开 MAMP 面板并单击服务器 > PHP > 查看日志来访问 PHP 错误日志。根据您的设置，当发生错误时，您可能会得到空白输出。该错误可能会帮助您朝着正确的方向前进。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T01:31:01.643

我想知道您的所有输出是否都正确转义。您的 mysql 表中的数据是否包含任何需要特殊处理的字符？

如果您安装了 PHP cli，您可能会尝试使用它来进行测试。有时您会看到通过 Web 浏览器或 RSS 客户端看不到的内容。

我使用 feedcreator [http://feedcreator.org/](http://feedcreator.org/)在 PHP 下生成所有 RSS。我通常发现使用库更容易。[我在这里](https://stackoverflow.com/questions/257339/how-do-you-generate-an-rss-feed/257987#257987)发布了一个例子。

您可能还需要考虑禁用 short_tags。因为您实际上是在尝试输出 XML，所以实际上您可能会感到困惑。特别是如果您尝试在页面顶部发送类似“”的内容。

# c# - Winforms Designer：修改（并保留）子对象中的属性

> ID：600759
> 
> 赞同：1
> 
> 时间：2009-03-01T23:06:49.820
> 
> 标签：c#, winforms, custom-controls, designer

对于 WinForms 控件，我想将某些设置移动到子对象中。其中一个是包含所有 UI 字符串的自定义类，另一个是 OpenFileDialog：

```
class MyControl: Control
{
  // ...
  private OpenFileDialog m_dlgOpen = new OpenFileDialog();
  public OpenFileDialog DialogOpen
  {
     get { return m_dlgOpen; }
  }
} 
```

这会将子对象添加到设计器，并允许编辑其属性（例如标题、默认扩展名、过滤器）。但是，更改不会添加到`InitalizeComponent`方法中，因此会丢失。

是否可以使该属性在`InitializeComponent`方法中“持续存在”？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-02T22:37:55.763

告诉设计者序列化对象本身：

```
 [DesignerSerializationVisibility(DesignerSerializationVisibility.Content)]
  public OpenFileDialog DialogOpen {
    get { return m_dlgOpen; }
  } 
```

# asp.net-mvc - Jquery.Validate 和 MVC 框架

> ID：600761
> 
> 赞同：0
> 
> 时间：2009-03-01T23:09:00.190
> 
> 标签：asp.net-mvc, jquery-validate

好吧，这个问题让我有点发疯。

我的表单上有一个复选框，如下所示：

```
<%=Html.CheckBox("Agreement", false)%>Yes, I agree to the terms 
```

然后我有一个 js 文件，在加载 jquery 和 jquery.validate 后加载到浏览器中，如下所示：

```
$.validator.setDefaults({
submitHandler: function() { alert("submitted!"); }
    });

    $().ready(function() {

        // validate signup form on keyup and submit
        $("#campForm").validate({
            rules: {
                Agreement: "required"
            },
            messages: {
                Agreement: "Please accept our policy"
            }
        });

    }); 
```

因此，阅读文档应该可以，但它永远不会。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-01T23:14:48.320

我认为语法应该是：

```
rules: {
    Agreement: {required: true}
} 
```

不过我可能是错的。这只是我的想法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T23:11:42.117

您是否在表单提交时返回验证？只是猜测...

# javascript - 检查变量是否包含Javascript中的数值？

> ID：600763
> 
> 赞同：13
> 
> 时间：2009-03-01T23:10:10.827
> 
> 标签：javascript

在 PHP 中，这很简单：

```
is_numeric(23);//true
is_numeric("23");//true
is_numeric(23.5);//true
is_numeric(true);//false 
```

但是我如何在 Javascript 中做到这一点？我可以使用正则表达式，但是有这个功能吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-03-01T23:18:58.963

关于什么：

```
function isNumber(n){
    return typeof(n) != "boolean" && !isNaN(n);
} 
```

isNaN[内置](http://www.w3schools.com/jsref/jsref_isNaN.asp)函数用于检查值是否**不是**数字。

**更新：** Christoph 是对的，在 JavaScript 中布尔类型可以转换为数字，返回 1 表示真，0 表示假，所以如果你评估`1 + true`结果将是 2。

考虑到这种行为，我更新了函数以防止将布尔值转换为其数字表示。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-02T10:25:53.027

到目前为止，我认为任何建议都没有真正奏效。例如

```
!isNaN(parseFloat(foo)) 
```

不是因为`parseFloat()`忽略尾随的非数字字符。

要解决此问题，您可以将返回的值与通过强制转换返回的值进行比较`Number()`（或等效地使用 unary `+`，但我更喜欢显式强制转换）：

```
parseFloat(foo) === Number(foo) 
```

如果两个函数都返回，这仍然有效，`NaN`因为`NaN !== NaN`is `true`。

另一种可能性是先转换为字符串，然后转换为数字，然后检查`NaN`，即

```
!isNaN(Number(String(foo))) 
```

或等效，但可读性较差（但很可能更快）

```
!isNaN(+('' + foo)) 
```

如果要排除无穷大值，请使用`isFinite()`而不是`!isNaN()`，即

```
isFinite(Number(String(foo))) 
```

显式转换 via`Number()`实际上是不必要的，因为`isNan()`and`isFinite()`隐式转换为数字 - 这就是为什么`!isNaN()`不起作用的原因！

因此，我认为最合适的解决方案是

```
isFinite(String(foo)) 
```

* * *

正如 Matthew 指出的那样，第二种方法不能正确处理仅包含空格的字符串。

不难修复 - 使用 Matthew 评论中的代码或

```
isFinite(String(foo).trim() || NaN) 
```

您必须决定这是否比比较 和 的结果`parseFloat()`更好`Number()`。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-01T23:19:29.290

要检查 javascript 中的类型，您可以使用`typeof`运算符：

```
js> var x = 1;
js> typeof(x);
number 
```

所以：

```
if (typeof(x) === 'number') {
   // Do something
} 
```

如果要将变量的值强制为整数，可以使用`parseInt(x, 10)`which 将值解析为以 10 为底的整数。同样，`parseFloat`如果需要浮点值，可以使用。但是，无论类型如何，这些都将始终强制，因此传递`null`,`true`等将始终返回一个数字。但是，您可以通过调用来检查其是否为有效号码`isNaN`。

所以，把它们放在一起：

```
!isNaN(parseFloat(23)) // true
!isNaN(parseFloat('23')) // true
!isNaN(parseFloat(23.5)) // true
!isNaN(parseFloat(true)) // false 
```

或者

```
function isNumber(x) {
    return !isNaN(parseFloat(x));
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-01T23:16:50.920

这将检查数值，包括负数和浮点数。

```
function is_numeric(val){
    return val && /^-?\d+(\.\d+)?$/.test(val + '');
} 
```

* * *

@Vordreller：我更正了正则表达式。它现在应该可以正常工作了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-01T23:16:06.087

```
function is_numeric(val) {
  return ((+val) == val);
} 
```

这应该够了吧。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-12-15T02:27:44.990

这是我想出的：

```
value = "2.34";
if (parseFloat(value).toString() === value) {
    alert("number");
} 
```

这应该适用于浮点数和整数，正数和负数。正如上面的一些答案所讨论的那样，我不知道无穷大。

如果您的值实际上可能是一个数字而不总是一个字符串，您可以将 === 更改为 ==，它会同时处理这两种情况。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-07-18T23:41:02.540

这是 isNaN 与 isFinite 和 typeof === "number" 的一些基准

[http://jsperf.com/isnan-vs-isfinite-vs/3](http://jsperf.com/isnan-vs-isfinite-vs/3)

显然 typeof === "number" 大约快 5 倍

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-01-31T21:55:01.083

运行代码片段以查看有关此主题的热门答案的比较。

一些测试用例没有突出显示（并且不有助于总结）。这些情况被标记为模棱两可，因为不清楚给定值是否应该被视为数字。

```
// Each of these functions should output a truthy/falsy value if the input is
// a number
const solutionsToTest = [
  v => parseFloat(v),
  v => Number(v),
  v => !isNaN(v),
  v => typeof v != "boolean" && !isNaN(v),
  v => isFinite(String(v)),
  v => !isNaN(parseFloat(v)) && isFinite(v)
];

const testCases = [
  //[ Test Name, Test Value, Expected Output, Is Ambiguous ]

  // Whitespace
  ['""', "", false, false],
  ['"\\t"', "\t", false, false],
  ['" "', " ", false, false],

  // Infinity
  ['"Infinity"', "Infinity", false, true],
  ['"+Infinity"', "Infinity", false, true],
  ["-Infinity", -Infinity, false, true],
  ["Infinity", Infinity, false, true],

  // Numbers mixed with symbols
  ['"123abc"', "123abc", false, true],
  ['"abc123"', "abc123", false, false],
  ['".0."', ".0.", false, false],
  ['"1."', "1.", true, true],
  ['"."', ".", false, true],
  ['"01"', "01", true, true],
  ['"-0"', "-0", true, true],
  ["+1", +1, true, true],
  ["-1", -1, true, true],

  // Other js types
  ["'null'", "null", false, false],
  ["'true'", "true", false, false],
  ["'false'", "false", false, false],
  ["null", null, false, false],
  ["true", true, false, false],
  ["false", false, false, false],
  ["NaN", NaN, false, false],
  ["[]", [], false, false],
  ["{}", {}, false, false],
  ["/./", /./, false, false],
  ["() => {}", () => {}, false, false]
];

const styles = {
  code: {
    fontFamily: "monospace",
    fontSize: 16
  },
  success: {
    backgroundColor: "#00ff5478"
  },
  failure: {
    backgroundColor: "#ff00008c"
  }
};

class TestCaseTable extends React.Component {
  static renderTableHeader(solutionsToTest) {
    return (
      <tr>
        <th>
          <p>Test Case</p>
        </th>
        {solutionsToTest.map(f => (
          <th key={f.toString()}>
            <p style={styles.code}>{f.toString()}</p>
          </th>
        ))}
      </tr>
    );
  }
  static renderTableRow(testCase, solutionsToTest) {
    const [testName, input, expectedOutput, isAmbiguous] = testCase;
    return (
      <tr key={testName}>
        <td style={styles.code}>{testName}</td>
        {solutionsToTest.map(f => {
          const output = Boolean(f(input));
          const style = isAmbiguous
            ? {}
            : output == expectedOutput ? styles.success : styles.failure;
          return (
            <td style={style} key={f.toString()}>
              <p>{output + ""}</p>
            </td>
          );
        })}
      </tr>
    );
  }
  render() {
    // Sort test cases, put the ambiguous ones after (but maintain stable sort
    // order)
    let sortedCases = [
      ...testCases.filter(([a, b, c, ambiguous]) => !ambiguous),
      ...testCases.filter(([a, b, c, ambiguous]) => ambiguous)
    ];
    return (
      <table>
        <thead>{TestCaseTable.renderTableHeader(solutionsToTest)}</thead>
        <tbody>
          {sortedCases.map(tc =>
            TestCaseTable.renderTableRow(tc, solutionsToTest)
          )}
        </tbody>
      </table>
    );
  }
}
class TestCaseSummaryTable extends React.Component {
  renderTableHeader(solutionsToTest) {
    return (
      <tr>
        <th>Summary</th>
        {solutionsToTest.map(f => (
          <th key={f.toString()}>
            <p style={styles.code}>{f.toString()}</p>
          </th>
        ))}
      </tr>
    );
  }
  renderSuccessRateRow(solutionsToTest, testCases) {
    // Ignore potentially ambiguous test cases
    testCases = testCases.filter(
      ([name, input, expected, ambiguous]) => !ambiguous
    );

    const numSuccess = testSolution =>
      testCases.reduce((succeeded, [name, input, expected]) => {
        return succeeded + (Boolean(testSolution(input)) == expected ? 1 : 0);
      }, 0);

    return (
      <tr>
        <td>
          <p>Test Success</p>
        </td>
        {solutionsToTest.map(f => (
          <td>
            <p>
              {numSuccess(f)} / {testCases.length}
            </p>
          </td>
        ))}
      </tr>
    );
  }
  render() {
    return (
      <table>
        <thead>{this.renderTableHeader(solutionsToTest)}</thead>
        <tbody>{this.renderSuccessRateRow(solutionsToTest, testCases)}</tbody>
      </table>
    );
  }
}

const root = () => {
  return (
    <div>
      <TestCaseSummaryTable />
      <TestCaseTable />
    </div>
  );
};

ReactDOM.render(root(), document.querySelector("#application"));
```

```
td {
  text-align: center;
  vertical-align: middle;
}
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.1.0/react.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.1.0/react-dom.min.js"></script>
<div id="application"></div>
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-03-11T16:04:17.783

## 这是我的解决方案：ES6/2015

***免责声明*：** **此解决方案仅在用户发送数字类型作为输入时才有效。例如：23 是数字类型，但 '23' 不是数字类型，它是字符串类型。**

```
function isValidNumber(value) {
  return typeof value === 'number' && Number.isNaN(value) === false;
} 
```

> 测试用例

```
isValidNumber(10) // true
isValidNumber(10.34) // true
isValidNumber('geo10') // false
isValidNumber('10geo') // false
isValidNumber('') // false
isValidNumber(NaN) // false
isValidNumber(true) // false
isValidNumber(false) // false 
```

# maven-2 - 如何使用 Cargo 将 WAR 部署到现有的 Tomcat 6 实例上？

> ID：600766
> 
> 赞同：3
> 
> 时间：2009-03-01T23:10:41.463
> 
> 标签：maven-2, tomcat6, pom.xml, cargo

我很久以前使用 Windows 安装程序安装了 Tomcat，它在我的开发笔记本电脑上作为服务运行良好。现在我正在开发我的项目，并想使用 Cargo（或类似的东西）将更新的 WAR 部署到本地 Tomcat 上。

我找不到任何完整的 POM 文件示例，其中包含正确的 XML 来执行此操作，并且正在努力处理 Cargo 网站上的部分示例。

有没有人有他们可以发布的 POM 或知道他们可以链接到的野外示例？

* * *

FWIW 我得到的错误是这样的——尽管我尝试了许多不同的参数组合：

> 无法创建配置。参数没有注册配置（容器[id = [tomcat6x]，类型= [本地]]，配置类型[现有]）。实际上没有为此配置注册的有效类型。也许你拼错了？

我什至不确定我首先确切地知道错误的“类型”是什么意思！

**更新**：我最终找到了 m2eclipse WTP 集成插件，坦率地说，它很震撼！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-11T09:36:59.463

有理由只使用货物吗？

您可以尝试使用 maven tomcat 插件来将您的战争部署到 tomcat。请参阅有关[配置](http://mojo.codehaus.org/tomcat-maven-plugin/configuration.html)和[部署](http://mojo.codehaus.org/tomcat-maven-plugin/deployment.html)的说明。

# iphone - 我应该保存 NSLocalizedString() 返回的字符串吗？

> ID：600770
> 
> 赞同：5
> 
> 时间：2009-03-01T23:11:33.553
> 
> 标签：iphone, cocoa, cocoa-touch

我正在开发一个 iPhone 应用程序，我们正在为我们的初始版本进行英语和日语本地化。我们经常调用`NSLocalizedString()`加载适当的本地化字符串进行显示。下次我们需要时将本地化字符串保存在实例变量中通常会更好，还是我在这里进行微优化，我是否应该在每次需要时重新加载字符串？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-01T23:31:09.573

微优化。首先让它工作，然后让它正确，然后让它快速。当您进入第 3 步时，运行 Shark（或 Instruments），然后按照它的指导进行操作。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-01T23:36:47.300

这是那些“取决于”的答案之一。

调用 NSLocalizedString 涉及在包中执行查找。这些查找非常快，但不是免费的。是缓存这个返回值还是仅仅方便调用 NSLocalizedString 将取决于它的使用方式。

1.  如果您将返回值传递给 UILabel 或 UITableViewCell 之类的文本字段，则仅在您首次设置属性时才会进行查找。

2.  如果您在 drawRect 调用中使用它，那么查找只会在您的视图需要重新绘制时发生，这可能是经常、不经常或从不。

3.  如果您在每帧重绘屏幕的游戏 UI 中使用它，那么对于一些 UI 元素，这些查找可能每秒发生数百次。

我会说对于像#3 这样的东西，你应该从缓存结果开始。

对于其他人，以最方便的方式编写它们，如果您在 UI 中遇到性能问题，请使用 Instruments 来缩小原因。如果它是 NSLocalizedString 则相应地对其进行优化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-01T23:30:48.467

我怀疑您不会对性能造成太大影响。NSLocalizedString(key, comment) 是一个宏，可以转换为

```
[[NSBundle mainBundle] localizedStringForKey:(key) value:@"" table:nil] 
```

如果没有基准测试，我不知道这有多贵，但我怀疑这还不错。我的感觉是，这对您来说不会成为性能瓶颈，但是您始终可以运行 Shark 或 Instruments，并在设备上运行应用程序时亲自查看。

# multithreading - 异步与多线程 - 有区别吗？

> ID：600795
> 
> 赞同：141
> 
> 时间：2009-03-01T23:18:01.540
> 
> 标签：multithreading, language-agnostic, asynchronous

异步调用是否总是创建一个新线程？两者有什么区别？

异步调用是否总是创建或使用新线程？

[维基百科说](http://en.wikipedia.org/wiki/Asynchrony)：

> 在计算机编程中，异步事件是独立于主程序流发生的事件。异步动作是在非阻塞方案中执行的动作，允许主程序流继续处理。

我知道异步调用可以在单线程上完成？这怎么可能？

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2009-03-02T01:15:33.660

只要需要异步发生的操作不需要 CPU 工作，就可以在不产生另一个线程的情况下完成该操作。例如，如果异步操作是 I/O，则 CPU 不必等待 I/O 完成。它只需要启动操作，然后可以在 I/O 硬件（磁盘控制器、网络接口等）执行 I/O 工作时继续其他工作。硬件通过中断 CPU 让 CPU 知道何时完成，然后操作系统将事件传递给您的应用程序。

通常更高级别的抽象和 API 不会公开操作系统和底层硬件可用的底层异步 API。在这些情况下，创建线程来执行异步操作通常更容易，即使生成的线程只是在等待 I/O 操作。

如果异步操作需要 CPU 完成工作，那么通常该操作必须在另一个线程中进行才能真正实现异步。即使那样，如果有多个执行单元，它实际上只会是异步的。

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2009-03-01T23:23:00.017

这个问题太笼统了，无法回答。

在一般情况下，异步调用不一定会创建新线程。这是实现它的一种方式，预先存在的线程池或外部进程是其他方式。它在很大程度上取决于语言、对象模型（如果有的话）和运行时环境。

异步只是意味着调用线程不会坐下来等待响应，也不会在调用线程中发生异步活动。

除此之外，您将需要更具体。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-11-19T17:39:39.507

不，异步调用并不总是涉及线程。

他们通常会启动某种与调用者并行继续的操作。但该操作可能由另一个进程、操作系统、其他硬件（如磁盘控制器）、网络上的其他计算机或人类来处理。线程并不是并行完成事情的唯一方法。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-03-10T07:19:43.470

JavaScript 是单线程和异步的。例如，当您使用 XmlHttpRequest 时，您为其提供了一个回调函数，该回调函数将在响应返回时异步执行。

[John Resig 对定时器如何在 JavaScript](http://ejohn.org/blog/how-javascript-timers-work/)中工作的相关问题有很好的解释。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2012-04-20T11:58:57.610

多线程是指在同一进程中发生多个操作。而异步编程跨进程传播。例如，如果我的操作调用 Web 服务，线程不需要等到 Web 服务返回。这里我们使用异步编程，它允许线程不等待另一台机器上的进程完成。当它开始从 web 服务获得响应时，它可以中断主线程，说 web 服务已经完成了对请求的处理。现在主线程可以处理结果。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2009-03-01T23:28:09.223

自非抢占时代（版本 2.13、3.0、3.1 等）使用消息循环以来，Windows 始终具有异步处理，远在支持真正线程之前。所以要回答你的问题，不，没有必要创建一个线程来执行异步处理。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-03-02T01:00:49.780

异步调用甚至不需要与调用调用的系统/设备发生在同一系统/设备上。所以如果问题是，异步调用是否需要当前进程中的线程，答案是否定的。但是，必须在某处处理异步请求的执行线程。

执行线程是一个模糊的术语。在诸如早期的 Macintosh 和 Windows 操作系统等协作任务系统中，执行线程可能只是使请求运行另一个堆栈、指令指针等的同一进程......然而，当人们通常谈论异步调用时，它们通常表示如果它是进程内（即在同一进程内）由另一个线程处理的调用，或者如果它是进程间则由另一个进程处理。

*请注意，进程间（或进程间）通信（IPC）通常被概括为包括进程内通信，因为锁定和同步数据的技术通常是相同的，而不管单独的执行线程在哪个进程中运行。*

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-03-01T23:31:10.823

某些系统允许您利用内核中的并发性来使用回调的某些功能。对于一个相当模糊的实例，异步 IO 回调用于在 Mac System 6-8 的非抢占式多任务处理时代实现非阻塞互联网服务器。

这样，您就可以在没有线程*的*情况下“在”您的程序中拥有并发执行流。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-03-01T23:29:10.953

异步只是意味着您不会阻止程序等待某事（函数调用、设备等）完成。它可以在单独的线程中实现，但也很常见的是使用专用线程执行同步任务并通过某种事件系统进行通信，从而实现类似异步的行为。

有单线程异步程序的例子。就像是：

```
...do something
...send some async request
while (not done)
    ...do something else
    ...do async check for results 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-01T23:40:32.157

异步调用的本质是，如果您希望应用程序在调用过程中继续运行，您将需要**生成**一个新线程，或者至少**使用**您创建的另一个线程，该线程仅用于处理异步回调。

有时，根据具体情况，您可能希望调用异步方法，但要让用户觉得它是同步的（即阻塞，直到异步方法发出信号表明它已完成）。这可以通过诸如[WaitForSingleObject](http://msdn.microsoft.com/en-us/library/ms687032.aspx)之类的 Win32 API 来实现。

# model-view-controller - 现在我已经在我的网站上设置了表单身份验证，样式表将无法加载！

> ID：600799
> 
> 赞同：1
> 
> 时间：2009-03-01T23:19:10.633
> 
> 标签：model-view-controller, authentication, forms, styles

我在我的 ASP.NET MVC 网站上设置了表单身份验证，包括在 web.config 中设置适当的条目。

现在，对我网站的每个请求都会重定向到登录页面以验证用户身份。

问题是，即使我的页面尝试访问主样式表（在 Content 文件夹中），也会发生这种情况，因此它们最终会在没有样式的情况下呈现。

如何覆盖表单身份验证以便呈现我的样式表？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-01T23:32:17.683

您需要在 web.config 中从安全性中排除样式表：

```
 <location path="App_Themes">
        <system.web>
            <authorization>
                <allow users="*"/>
            </authorization>
        </system.web>
    </location> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T23:40:48.617

如果您只处理一个 css 文件，那么您可以在 web.config 上添加一个异常，类似于 Chris KL 所写的内容，但使用 css 文件名：

```
 <location path="yourstyle.css">
        <system.web>
                <authorization>
                        <allow users="*"/>
                </authorization>        
</system.web>
</location> 
```

# django - 如何测试使用 django 模板块？

> ID：600806
> 
> 赞同：5
> 
> 时间：2009-03-01T23:25:52.100
> 
> 标签：django, django-templates

我想做以下事情：

```
{% if appnav %}
<hr />
<div id="appnav">
    <ul class="tabs">
        {% block appnav %}{% endblock %}
    </ul>
</div>
{% endif %} 
```

...但是，在继承链的下游测试当前对模板块的使用似乎不起作用。

是否有其他条件可以做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-06T16:51:43.143

模板语言并不能准确地提供您正在寻找的内容。子模板可以用 调用父块`{{ block.super }}`，但父模板不能引用子模板。

您最好的选择可能是编写自定义模板标签。模板手册中有两个部分可供查看。

首先，[解析直到另一个块标记](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/#parsing-until-another-block-tag)。这将为您提供如何解析的基础知识。

其次，[解析直到另一个块标签并保存内容](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/#parsing-until-another-block-tag-and-saving-contents)。通过在自定义标签内放置一个块标签，您可以检测内容并根据需要对其进行包装。这应该可行，因为我相信内部块标签将首先被解析。如果这不起作用，请将 django 提供的现有块模板标签子类化以实现您的特殊魔法。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2020-06-20T15:59:10.083

如果您正在寻找一个简单的解决方案。您可以将元素隐藏为默认 html。

```
<div id="appnav">
    <ul class="tabs">
        {% block appnav %}
            <script>document.getElementById("appnav").style.display = "none"</script>
        {% endblock %}
    </ul>
</div> 
```

# html - HTML 是否允许通过流对图像进行嵌入式编码？

> ID：600807
> 
> 赞同：5
> 
> 时间：2009-03-01T23:26:02.410
> 
> 标签：html, image

例子：

```
<div id="sampleimage">

***Stream or Serialize JPEG Image from Server Here w/o Sending another Request***

</div> 
```

所以基本上，在一个响应中发送所有内容。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-01T23:30:06.223

在某些浏览器中（在 FF、Chrome 和显然是 IE8 中），您可以使用[数据 URL 方案](http://www.ietf.org/rfc/rfc2397.txt)在 HTML 中嵌入图像文件。

它看起来像这样（取自 RFC）：

```
<IMG
   SRC="data:image/gif;base64,R0lGODdhMAAwAPAAAAAAAP///ywAAAAAMAAw
   AAAC8IyPqcvt3wCcDkiLc7C0qwyGHhSWpjQu5yqmCYsapyuvUUlvONmOZtfzgFz
   ByTB10QgxOR0TqBQejhRNzOfkVJ+5YiUqrXF5Y5lKh/DeuNcP5yLWGsEbtLiOSp
   a/TPg7JpJHxyendzWTBfX0cxOnKPjgBzi4diinWGdkF8kjdfnycQZXZeYGejmJl
   ZeGl9i2icVqaNVailT6F5iJ90m6mvuTS4OK05M0vDk0Q4XUtwvKOzrcd3iq9uis
   F81M1OIcR7lEewwcLp7tuNNkM3uNna3F2JQFo97Vriy/Xl4/f1cf5VWzXyym7PH
   hhx4dbgYKAAA7"
   ALT="Larry"> 
```

您可以看到图像的数据以[base64](http://en.wikipedia.org/wiki/Base64)编码。我相信您也可以使用这种格式在 javascript 中分配图像并在 CSS 中使用它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-01T23:30:56.050

是的，有可能：[见这里](http://www.faqs.org/rfcs/rfc2397.html)

# .net - SQL 编写库

> ID：600819
> 
> 赞同：0
> 
> 时间：2009-03-01T23:30:45.770
> 
> 标签：.net, sql, oop

有人知道.Net 的 SQL 编写库之类的东西吗？我认为它将是用于以面向对象样式生成查询的包装器。可能类似于以下内容：

```
class SelectQuery : BaseQuery
{
    List<Column> SelectedColumns { get; set; }
    Table MainTable { get; set; }
    List<Join> Joins { get; set; }
    List<Condition> Conditions { get; set; }
    List<Column> Order { get; set; }

    string Write() { }
} 
```

没关系我为什么要找东西来做这件事。而且，这对我来说没有具体的问题，我只是有兴趣看到这样的事情。

请注意，我不是在寻找 O/RM，而是一种编写 SQL 并用对象表示查询的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-01T23:46:42.813

nHibernate 正在进行一个名为 Antlr 的新项目，它是用于 SQL 查询的抽象语法树。我没有看过它，但它可能有你想要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T23:32:58.213

LINQ to SQL 执行此操作。
nHibernate 就是这样做的。LINQ to Entities 执行此操作。

基本上，您似乎在寻找一个 O/R 映射器，其中有大量的竞争产品。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T00:26:21.080

请参阅有关对象角色建模的[讨论。](https://stackoverflow.com/questions/354999/visiomodeler-object-role-modeling-the-other-orm-who-uses-it)这是我见过的唯一可用的工具，用于对关系数据库设计进行概念性讨论。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-02T17:58:15.023

我专门为此启动了一个项目。它被称为[海鹌鹑](http://seaquail.codeplex.com/)。

# modeling - 有哪些方法、过程和工具可用于设计和建模非面向对象的应用程序？

> ID：600827
> 
> 赞同：1
> 
> 时间：2009-03-01T23:31:49.993
> 
> 标签：modeling

我非常熟悉用于建模面向对象应用程序的 UML。但是，我不熟悉任何专门为设计和/或建模程序、功能或任何其他范例而设计的东西。您如何设计或建模用非面向对象语言编写的应用程序？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T23:35:41.310

哦，天哪，过去发生了爆炸。

我们曾经使用过[流程图](http://en.wikipedia.org/wiki/Flowchart)、[伪代码](http://en.wikipedia.org/wiki/Pseudocode)、[数据流程图](http://en.wikipedia.org/wiki/Data_flow_diagram)、[结构图](http://en.wikipedia.org/wiki/Structure_chart)、[Hierarchy-IPO](http://yourdon.com/strucanalysis/wiki/index.php?title=Chapter_15)、“衣架图”（实际上是流程图的变体）、[Nassi-Schneiderman 图](http://en.wikipedia.org/wiki/Nassi-Shneiderman_diagram)。其中。

哦，[SADT](http://en.wikipedia.org/wiki/Structured_Analysis_and_Design_Technique)是另一个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-02T00:15:30.327

[SSADM](http://en.wikipedia.org/wiki/Structured_Systems_Analysis_and_Design_Methodology) - 我想我的认证仍然在某个地方的盒子里......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-24T05:39:50.597

UML 也可用于建模非 OO 语言。我使用 UML 对任何东西进行建模。公平地说，UML 的核心是面向对象的，但大部分行为、实例级别和不太常见的结构类型都适用于非 OO 语言。但是，UML 用于面向对象的设计而不是实现，您的构建块/对象只是不同的、模块或诸如此类的东西。

Charlie Martin 提到的许多图表类型都有类似的 UML 表示。更好的是它是一个模型，而不仅仅是一个图表/视图。

示例：LISP 不是基于 OO 的。因此，为函数类创建关键字或立体类型。属性是参数，因为它没有状态。这并不完美，但却是最平易近人的。

示例：COBOL/JCL 不是基于 OO 的。让每个 PACBASE 包成为一个组件，并将结构组件作为您的 COBOL。工件可以是您的 JCL。

让 UML 广泛且松散地定义为您的利益和重新利用 UML 部分的事实。您始终可以使用 UML 配置文件对其进行形式化。在我工作的地方，这一直是讨论的焦点。大型机程序员并不认为 OO 设计和 OO-UML 是相关的，但这只是部分正确，因为核心或大多数人使用它的程度只是针对面向 OO 的类/结构材料和用例。

# java - 在 Eclipse 插件中，是否存在与 markerAnnotationSpecification 扩展点等效的程序？

> ID：600834
> 
> 赞同：0
> 
> 时间：2009-03-01T23:33:38.943
> 
> 标签：java, eclipse, editor, eclipse-rcp, eclipse-pde

扩展点`org.eclipse.ui.editors.markerAnnotationSpecification`用于更改某些用户定义的文本注释在编辑器中的显示方式。

有没有办法从插件以编程方式创建或修改或覆盖这些？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-03T20:27:20.560

请参阅[http://www.ibm.com/developerworks/opensource/library/os-ecl-dynext/](http://www.ibm.com/developerworks/opensource/library/os-ecl-dynext/)

它讨论了使用 addContribution() 以编程方式添加扩展。

# inheritance - 继承一个非平凡类的案例？

> ID：600839
> 
> 赞同：0
> 
> 时间：2009-03-01T23:38:59.133
> 
> 标签：inheritance

我正在阅读 C# 中的 seal 关键字。我不记得上次从标准库继承是什么时候了。在 c++ 中，我记得继承了一个 std 接口，该接口 typedef 几种类型并使用了我的一些参数。但那是 1) 微不足道的 2) 接口

从我的脑海中，我不记得我继承的任何没有期望被继承的虚函数的类。谁能告诉我你需要继承一个不是接口的非平凡类的情况？

我什至可以说，除非它有虚函数，否则不要继承一个类是一个很好的经验法则。这是一个好的经验法则吗？

注意：我使用 operator SomeClass& SomeClass() { return m_someClass; 在我需要将我的对象作为另一个类传递的情况下。它运作良好。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-01T23:47:08.507

我认为面向对象编程的关键概念是多态性。如果从特定类继承不允许您利用多态性，那么继承的意义何在？因此，如果没有要覆盖的方法，则不要子类化。您只会增加代码的复杂性。如果您想要很多相同的功能，只需将现有类包装在您自己的类中即可。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T00:00:11.907

它实际上在 C++ 中使用，用于所有这些不是一种继承（例如，继承一个实现、mixins、boost::noncopyable，你从它继承并使你的类不可复制，你继承的 boost::operators来自某个类，它会在你的类中添加一些运算符）。此外，在使用 C++ 类型进行元编程时，从另一种类型继承是组合类型的最简单方法之一。

从没有虚函数但充当“某种”接口的类继承的另一种情况是静态多态性（诸如 CRTP 之类的技术，其中类 ConcreteA : BaseA）。他们不需要虚函数，因为一切都是在编译时解决的。

然而，如果你想以运行时多态的方式对待你的类，你真的应该让至少一个方法是虚拟的，那就是析构函数。有例外，但很少见。

即使你有一个多态的层次结构，你有时也会从具体的类中派生出来。一个示例是从 TextEdit 派生的 SingleLineEdit。但是，这有点危险，因为它破坏了父类的封装（例如，它的方法可能需要一些实现细节，并且您必须在子类中尊重并保留它们 - 这可能很棘手，因为它们是可能的实现细节在下一个版本等中更改，恕不另行通知）

# asp.net - 使用 VB.NET、MYSQL 和 ASP.NET 进行网络广播/广播

> ID：600843
> 
> 赞同：0
> 
> 时间：2009-03-01T23:40:48.973
> 
> 标签：asp.net, mysql, vb.net, binaryfiles

我目前正在进行我的项目网络广播，我的概念是将主机的桌面捕获为图像/jpeg 文件并将其保存到数据库中，通过一个通用数据库 VB.NET 和 ASP.NET 可以连接。最后，从数据库中获取图像并将其渲染到 ASP.NET。

1.) VB.NET -> 捕获图像 2.) MYSQL -> 将图像写入 BLOB 3.) ASP.NET-> 二进制写入网页

我的问题是在 ASP.NET 上渲染的图片断断续续和闪烁，您知道我可以消除这些问题并在不牺牲设备性能的情况下提供更流畅的图片动画的任何方法或方法吗？？？？？ ?

我真的很感激任何提示或建议。(^_^).,

* * *

这是我在网页上输出图片的方式：

If dr.HasRows Then

```
dr.Read()
Response.ContentType = "image/jpeg"   'gets or sets the type of output stream
Response.BinaryWrite(dr.Item("file")) 'writes a stream of binary characters to the http output stream 
```

别的

我设置了 1 秒来刷新页面，但是我刷新页面越多，我得到的闪烁就越多。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-02T00:27:40.470

您是否正在尝试创建具有实时视图的伪屏幕录像机？

如果是这样，从屏幕捕获到 DB 并渲染回 ASP.NET Web 应用程序的体系结构，有太多的层在等待对方完成，你不会得到一个真正流畅的视图.

我的建议是看看 LogMeIn 是如何做到这一点的（www.logmein.com）——需要启动某种活动对象（WinForms 应用程序、ActiveX 控件、Silverlight 应用程序等）来建立直接连接到“源”PC；这是您可以将图像“流式传输”到客户端并提供合理体验的唯一方法。

至少，您需要在 AJAX 中做一些事情来后台刷新图像，然后在 ASP.NET 前端平滑地替换它，或者创建一个活动的可执行文件，它将为您建立一个直接流或轮询数据库。希望能有所帮助...

# python - 使用python下载时如何优雅地超时

> ID：600848
> 
> 赞同：10
> 
> 时间：2009-03-01T23:44:38.560
> 
> 标签：python, exception-handling, download

我正在循环下载大量文件，其中包含以下代码：

```
try:
    urllib.urlretrieve(url2download, destination_on_local_filesystem)
except KeyboardInterrupt:
    break
except:
    print "Timed-out or got some other exception: "+url2download 
```

如果连接刚开始时服务器在 URL url2download 上超时，则正确处理最后一个异常。但有时服务器响应，并开始下载，但服务器太慢了，即使一个文件也需要几个小时，最终它返回如下内容：

```
Enter username for Clients Only at albrightandomalley.com:
Enter password for  in Clients Only at albrightandomalley.com: 
```

并且只是挂在那里（尽管如果通过浏览器下载相同的链接，则不会询问用户名/密码）。

在这种情况下，我的意图是——跳过这个文件并转到下一个文件。问题是——如何做到这一点？python中有没有办法指定下载一个文件可以工作多长时间，如果已经花费了更多时间，请中断并继续？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2014-10-20T02:36:10.557

尝试：

`import socket`

`socket.setdefaulttimeout(30)`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-01T23:55:47.690

如果您不限于开箱即用的 python 附带的内容，那么[urlgrabber](http://linux.duke.edu/projects/urlgrabber/)模块可能会派上用场：

```
import urlgrabber
urlgrabber.urlgrab(url2download, destination_on_local_filesystem,
                   timeout=30.0) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-01T23:50:43.553

[这里](http://www.voidspace.org.uk/python/articles/urllib2.shtml#sockets-and-layers)有一个讨论。警告（除了他们提到的）：我没有尝试过，他们正在使用`urllib2`，而不是`urllib`（这对你来说会是个问题吗？）（实际上，现在我考虑一下，这种技术可能会起作用也为`urllib`）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-02T01:33:51.137

这个问题对于函数超时更普遍： [How to limit execution time of a function call in Python](https://stackoverflow.com/questions/366682/how-to-limit-execution-time-of-a-function-call-in-python)

我已经使用我的答案中描述的方法编写了一个等待文本功能，该功能超时以尝试自动登录。如果您想要类似的功能，可以在此处参考代码：

[http://code.google.com/p/psftplib/source/browse/trunk/psftplib.py](http://code.google.com/p/psftplib/source/browse/trunk/psftplib.py)

# database - 伏地魔与沙发数据库

> ID：600851
> 
> 赞同：6
> 
> 时间：2009-03-01T23:46:46.120
> 
> 标签：database, couchdb, voldemort

我正在尝试决定是否将 voldemort 或 couchdb 用于即将进行的医疗保健项目。我想要一个具有高可用性、容错性并且可以扩展以适应大量数据的存储系统。

每个的优点/缺点是什么？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-02T11:35:21.813

[伏地魔计划](http://project-voldemort.com/)看起来不错，但到目前为止我还没有深入研究它。

在当前状态下，CouchDB 可能不适合“大量数据”。在节点之间分配数据并相应地路由查询已在路线图上，但目前尚未实施。已知最大的 CouchDB 生产设置使用大约 200G 的“表”（在沙发上说“数据库”）。

CouchDB 本身不支持 HA，但可以轻松构建：所有 CouchDB 节点都在多主设置中相互复制数据库节点。我们在 CouchDB 机器前面放置了两个[Varnish 代理](http://varnish.projects.linpro.no/)，并且 Varnish 盒与[CARP](http://en.wikipedia.org/wiki/Common_Address_Redundancy_Protocol)冗余。CouchDB 的“从 Web 构建”设计使这些事​​情变得非常容易。

[我们设置](https://stackoverflow.com/questions/28975/anyone-using-couchdb/411024#411024)中最紧迫的问题是，将大型（多 MB）附件复制到 CouchDB 文档仍然存在问题。

我建议你也检查一下传统的 RDBMS 路线。RDBMS 方法之外的可用人才[存在巨大问题，Oracle & Co 提供了非常强大的产品。](https://stackoverflow.com/questions/348939/eventual-consistency/411176#411176)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-15T09:35:40.417

从您的问题中了解的不够多，我仍然会说 Project Voldemort 或像 CouchDB 这样的分布式哈希表 ( **DHT** ) 通常是解决您的 HA 问题的方法。

这些 DHT 非常适合高可用性，但在一致性方面比传统的关系数据库 (RDBMS) 更难编写代码。

它们非常适合存储文档类型信息，这可能非常适合您的医疗保健项目，但会使数据开发更加困难。

*   大多数存储的最大限制是它们**不是事务安全**的（有关事务安全存储，请参阅**Scalaris**），您需要自己确保数据一致性 - 大多数通过合并冲突数据来使用读取时间一致性）。RDBMS 更容易用于数据一致性 (ACID)
*   加入数据也更加困难。在 RDBM 中，您可以轻松地查询多个表的数据，您需要在 CouchDB 中编写代码来聚合数据。对于其他商店，**Hadoop**可能是聚合信息的不错选择。

阅读关于一致性与可用性的**BASE**和**CAP定理。**

看

*   [http://www.metabrew.com/article/anti-rdbms-a-list-of-distributed-key-value-stores/](http://www.metabrew.com/article/anti-rdbms-a-list-of-distributed-key-value-stores/)
*   [http://queue.acm.org/detail.cfm?id=1394128](http://queue.acm.org/detail.cfm?id=1394128)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-02T00:04:47.857

**memcacheDB**是一个选项吗？我听说 Digg 就是这样处理 HA 问题的。

# nhibernate - Fluent NHibernate 通过附加表进行一对一映射

> ID：600854
> 
> 赞同：0
> 
> 时间：2009-03-01T23:47:37.443
> 
> 标签：nhibernate, fluent, mappings

我有一个表 A，它通过第三个表 C 引用了表 B。C 包含 A 和 B 的主键。对于每个 A，C 中最多有一条记录。当我尝试为 A 创建映射时这样我引用 B，我使用 References 函数，但它不允许我指定映射通过另一个表而不是直接。这样做的正确方法是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-02T01:10:42.720

我知道的唯一可以做到这一点的映射是 A 映射中的 HasManyToMany ：

```
HasManyToMany(x => x.B)
    .WithTableName("C")
    .WithParentKeyColumn("A_Id")  
    .WithChildKeyColumn("B_Id"); 
```

问题是映射是针对具有 B 列表的 A，而不仅仅是一个。我不知道你怎么能做到以干净的方式只得到一个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-11T06:56:22.237

我相信我已经在谷歌代码示例中找到了答案。在映射类中，可以编写一个附加的：

```
WithTable("SomeTable", c => { c.Map(x => x.Col1); }); 
```

# ruby-on-rails - Rails：处理导航的优雅方式？

> ID：600857
> 
> 赞同：12
> 
> 时间：2009-03-01T23:49:27.423
> 
> 标签：ruby-on-rails

现在我有一个看起来像这样的导航部分（x10 按钮）......

```
<% if current_controller == "territories" %>
    <li><%= link_to "Territories", {:controller => 'territories'}, :class => 'active'  %></li>
<% else %>
    <li><%= link_to "Territories", {:controller => 'territories'}  %></li>
<% end %>
<% if current_controller == "contacts"  %>
    <li><%= link_to "Contacts", {:controller => 'Contacts'}, :class => 'active'  %></li>
<% else %>
    <li><%= link_to "Contacts", {:controller => 'Contacts'}  %></li>
<% end %> 
```

有没有更优雅/干燥的解决方案来做到这一点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-02T01:24:06.153

与查克所说的类似：

```
<% TARGETS.each do |target| %>
  <li>
    <%= link_to target.humanize, 
      { :controller => target }, 
      class => ('active' if current_controller == target)) %>
  </li>
<% end %> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-02T01:15:34.410

很容易看出重复在哪里。这都是一般形式：

```
<% if current_controller == XXXXX %>
  <li><%= link_to XXXXX, {:controller => XXXXX}, CLASS %></li>
<% else %>
  [do the same stuff minus ":class => 'active'"]
<% end %> 
```

所以我们希望 XXXXX 和 CLASS 是变量（因为它们是唯一改变的东西），其余的可以是一个简单的模板。

所以，我们可以这样做：

```
%w(Contacts Territories).each |place|
  <% class_hash = current_controller == place ? {:class => 'active'} : {}
  <li><%= link_to place, {:controller => place}, class_hash)</li> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-02T08:09:34.133

查看github 上的[rails-widgets 。](http://github.com/paolodona/rails-widgets/tree/master)除了导航之外，它还为 Rails UI 的东西（tabnavs、工具提示、tableizers、显示隐藏切换、简单的 css 进度条）提供了大量便利的帮助器。

这是[文档](http://wiki.github.com/paolodona/rails-widgets)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-01T23:53:37.603

退房[`link_to_unless_current`](http://api.rubyonrails.org/classes/ActionView/Helpers/UrlHelper.html#M001567)。不完全是你要求的，但它很接近。

此外，您可以将这种逻辑放在帮助程序中以将其从视图中抽象出来。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-02T07:54:27.477

带有 link_to_unless_current 的稍微不同的版本：

```
<ul>
<% links.each do |link| -%>
<li><%= link_to_unless_current link.humanize, { :controller => target } %></li>
<% end -%>
</ul> 
```

rails docs 是此类内容的好资源。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-07-27T18:04:06.320

查看[简单导航插件](http://github.com/andi/simple-navigation)。这是一个“易于使用”的 rails 插件，用于为您的 rails 应用程序创建导航。

# c# - 过滤 nHibernate 中的连接

> ID：600865
> 
> 赞同：4
> 
> 时间：2009-03-01T23:57:05.113
> 
> 标签：c#, nhibernate

我正在尝试构建一个 nHibernate 标准表达式来执行搜索。

给定以下数据模型：

*   一个操作可能有零个或多个会话。
*   一个操作可以是零个或多个操作类型。

我想根据以下条件搜索所有会话：

*   （强制）如果操作 IsActive 标志为真，IsPublished 标志为真

o（可选）并且操作状态/结束日期在用户指定的日期范围内

o（可选）并且会话 regionid 与用户指定的 id 匹配

o（可选）并且会话划分与用户指定的 id 匹配

o（可选）并且 Operation.OperationTypes 在用户指定的类型 ID 列表中

我将在 sql 中将其表示为（鉴于已提供所有可选参数）：

```
SELECT     
    [Session].*
FROM         
    [OperationTypeOperation] 
LEFT OUTER JOIN
    [Operation] ON [OperationTypeOperation].[OperationId] = [Operation].[OperationId]
RIGHT OUTER JOIN
    [Session] ON [Operation].[OperationId] = [Session].[OperationId]
WHERE
    ([Operation].[IsPublished] = 1) 
AND 
    ([Operation].[IsActive] = 1) 
AND 
    ([Session].[RegionId] = 66)
AND 
    ([Session].[DivisionId] = 99)
AND 
    ([Operation].[AdvertisingStartDate] < GETDATE()) 
AND 
    ([Operation].[AdvertisingEndDate] > GETDATE()) 
AND 
    ([OperationTypeOperation].[OperationTypeId] IN (1, 2, 3)) 
```

在我的 nHibernate 查询中：

```
public PagedResult<Session> Search(int? regionId, int? divisionId, DateTime? startDate, DateTime? endDate, IList<int> operationTypeId, int itemsPerPage, int page)
        {

            var criteria = _session.CreateCriteria(typeof(Session))
                .Add(Expression.Eq("IsActive", true))
                .Add(Expression.Eq("AcceptingApplications", true))
                .AddOrder(new Order("StartDate", false))
                ;

            if (regionId.HasValue)
                criteria.Add(Expression.Eq("Region.Id", regionId.Value));

            if (divisionId.HasValue)
                criteria.Add(Expression.Eq("Division.Id", divisionId.Value));

            if (startDate.HasValue)
                criteria.Add(Expression.Ge("StartDate", startDate.Value));

            if (endDate.HasValue)
                criteria.Add(Expression.Le("EndDate", endDate.Value));

            //Add the operation types
            if (operationTypeId.Count > 0)
            {
                var operationTypes = new Collection<OperationType>();
                foreach (int id in operationTypeId)
                {
                    operationTypes.Add(_session.Get<OperationType>(id));
                }
                //Join on the operations
                criteria.CreateCriteria("Operation")
                .Add(Expression.Eq("IsPublished", true))
                .Add(Expression.Eq("IsActive", true))
                .Add(Expression.Le("AdvertisingStartDate", DateTime.Now))
                .Add(Expression.Ge("AdvertisingEndDate", DateTime.Now))
                .CreateAlias("OperationTypes", "operationTypes", JoinType.InnerJoin)
                .Add(Expression.In("OperationTypes", operationTypes))
                .SetResultTransformer(new DistinctRootEntityResultTransformer())
                ;
            }
            else
            {
                //Join on the operations
                criteria.CreateCriteria("Operation")
                .Add(Expression.Eq("IsPublished", true))
                .Add(Expression.Eq("IsActive", true))
                .Add(Expression.Le("AdvertisingStartDate", DateTime.Now))
                .Add(Expression.Ge("AdvertisingEndDate", DateTime.Now))
                ;
            }

            return criteria.ToPagedResult<Session>(itemsPerPage, page);
        } 
```

我的 nHibernate 函数抱怨操作类型并抛出异常“不能使用 InExpression 集合”。另外，我不确定我是否正确过滤了连接的表。任何人都可以以正确的方式权衡将上述 sql 编写为 nHibernate 表达式吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-15T06:48:03.290

我假设这`OperationType`是一个实体类（不是枚举）。您不能`In`与实体列表一起使用。您可以使用 id 加入。

```
criteria
  .CreateCriteria("Operation")
  // add other expressions
  .CreateCriteria("OperationTypes", "operationTypes", JoinType.LeftOuterJoin)
  .Add(Expression.In("operationTypes.Id", operationTypeId)) 
```

我假设 _session.Get(id) 执行数据库查询。无论如何，您应该避免这种情况。

PS：如果 OperationType 被映射为复合集合（带有`<composite-element>`标签），那么不幸的是，您不能使用条件加入它。我不确定是否有解决方法。但是有一个补丁待定。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-05T11:58:04.623

我认为有比写作更好的方法：

```
criteria
  .CreateCriteria("Operation")
  // add other expressions
  .CreateCriteria("OperationTypes", "operationTypes", JoinType.LeftOuterJoin)
  .Add(Expression.In("operationTypes.Id", operationTypeId)) 
```

因为额外的连接是在`"Operation"`

你可以简单地写：

```
criteria.Add(Expression.In("OperationTypes", operationTypeId))
.CreateCriteria("Operation")
                        .Add(Expression.Eq("IsPublished", true))
                        .Add(Expression.Eq("IsActive", true))
                        .Add(Expression.Le("AdvertisingStartDate", DateTime.Now))
                        .Add(Expression.Ge("AdvertisingEndDate", DateTime.Now))
                        .SetResultTransformer(new DistinctRootEntityResultTransformer()) 
```

# ios - Cocoa 编程的概念或技术问题

> ID：600866
> 
> 赞同：2
> 
> 时间：2009-03-01T23:57:41.977
> 
> 标签：ios, objective-c, cocoa, cocoa-touch

我发现自己需要从视图访问视图控制器。

这是方法

```
-(void)changePageView:(UIViewController*)newviewcont withtransitiontype:(int)t andtransitionspeed:(int)s
{
    //Remove whatever view is currently loaded at index 0, this index is only to be used by "page" views
    UIView *oldview = [self.view.subviews objectAtIndex:0];

    [UIView beginAnimations:@"View Flip" context:nil];
    [UIView setAnimationDuration:s];
    [UIView setAnimationCurve:UIViewAnimationCurveEaseInOut];
    [UIView setAnimationTransition:UIViewAnimationTransitionFlipFromLeft forView:self.view cache:YES];
    [newviewcont viewWillAppear:YES];
    //[oldview viewWillDisappear:YES];
    [oldview removeFromSuperview];
    [self.view insertSubview:newviewcont.view atIndex:0];
    //[oldview viewDidDisappear:YES];
    [newviewcont viewDidAppear:YES];

} 
```

基本上，我正在尝试编写一个由根控制器调用的通用视图切换方法，以从根控制器视图中换出 subviewcontorllers 视图。

我传入了一个子视图控制器，并且能够删除当前的子视图。但是为了做正确的视图切换动画，我需要访问当前的视图视图控制器。这是错误的方法吗？可以做到吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-02T01:21:24.677

我向根控制器添加了一个成员，该成员保留当前子视图控制器（currentController）并在控制器交换完成时引用它

```
-(void)changePageView:(UIViewController*)newviewcont withtransitiontype:(int)t andtransitionspeed:(int)s
{

    [UIView beginAnimations:@"View Flip" context:nil];
    [UIView setAnimationDuration:s];
    [UIView setAnimationCurve:UIViewAnimationCurveEaseInOut];
    [UIView setAnimationTransition:UIViewAnimationTransitionFlipFromLeft forView:self.view cache:YES];
    [newviewcont viewWillAppear:YES];
    [self.currentController viewWillDisappear:YES];
    [self.currentController.view removeFromSuperview];
    [self.view insertSubview:newviewcont.view atIndex:0];
    [self.currentController viewDidDisappear:YES];
    [newviewcont viewDidAppear:YES];
    [UIView commitAnimations];

    self.currentController = newviewcont;

} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T00:16:19.683

该`changeView()`方法属于视图控制器。它会解决你让视图知道它的控制器（它不应该）的问题，而且它更有意义。

此外，除非您正在做一些`changeView()`无法使用`UIViewController`对象中的方法完成的花哨的事情，否则您应该只使用它，如果需要实现您自己的视图切换方法，那么您可以扩展 UIViewController 而不是实现部分在您的视图中查看控制器。

我的 2 美分 :)

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-03-02T00:09:40.123

我相信你的方法是错误的。我相信你应该看看 UINavigationController 。

# .net - WCF 服务连接问题 - 也许是安全性？

> ID：600868
> 
> 赞同：2
> 
> 时间：2009-03-01T23:58:59.087
> 
> 标签：.net, wcf, security

我正在尝试调试 WCF 服务。该客户端过去可以连接，但现在无法连接。该服务部署到服务器。我可以使用浏览器访问服务器的服务页面，然后我会看到生成客户端的说明。我使用 svcutil 重新生成了客户端代理和配置文件。

客户端启动，但对服务的第一次调用在 1 分钟超时后返回错误。同时，我可以附加到服务器上运行的服务并单步执行那里的代码。我可以看到我的客户从未注册过。此调用的服务器代码中的断点不会被命中。由于某种原因，我无法进入服务器代码（但我可以将调试器附加到服务器上的服务）：

```
Unable to automatically step into the server. 
Connecting to the server machine 'shuttle' failed. 
Please install the Visual Studio 2008 Remote Debugger on the 
server to enable this functionality. 
```

远程调试器已安装并运行，或课程。长时间超时后我收到此错误：

```
Client is unable to finish the security negotiation within the 
configured timeout (00:00:00).  The current negotiation leg is 1 (00:00:00). 
```

当我设置安全模式=无，并增加超时，错误变为

```
The open operation did not complete within the allotted timeout of 00:02:00.
The time allotted to this operation may have been a portion of a 
longer timeout. 
```

我没有运行任何防火墙，我看到请求进入 Ethereal 的服务器。我正在查看 TCP 流，但我无法说出协商失败的原因。事件日志中没有任何相关内容。我已经筋疲力尽了，希望能得到提示。

客户端 app.config 包含 svcutil 生成的部分：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
    <system.serviceModel>
        <bindings>
            <wsDualHttpBinding>
                <binding name="WSDualHttpBinding_SportRadarDCS" 
                    closeTimeout="00:01:00" openTimeout="00:01:00" 
                    receiveTimeout="00:10:00" sendTimeout="00:01:00"
                    bypassProxyOnLocal="false" transactionFlow="false" 
                    hostNameComparisonMode="StrongWildcard"
                    maxBufferPoolSize="524288" 
                    maxReceivedMessageSize="65536"
                    messageEncoding="Text" textEncoding="utf-8" 
                    useDefaultWebProxy="true">
                      <readerQuotas 
                       maxDepth="32" maxStringContentLength="8192"  
                       maxArrayLength="16384"
                       maxBytesPerRead="4096" 
                       maxNameTableCharCount="16384" />
                    <reliableSession ordered="true" 
                       inactivityTimeout="00:10:00" />
                    <security mode="Message">
                        <message clientCredentialType="Windows" 
                           negotiateServiceCredential="true"
                           algorithmSuite="Default" />
                    </security>
                </binding>
            </wsDualHttpBinding>
        </bindings>
        <client>
            <endpoint
                 address="...."
                binding="wsDualHttpBinding" 
                    bindingConfiguration="WSDualHttpBinding_SportRadarDCS"
                    contract="SportRadarDCS" 
                    name="WSDualHttpBinding_SportRadarDCS">
                <identity>
                    <userPrincipalName value=".. my domain user ..." />
                </identity>
            </endpoint>
        </client>
    </system.serviceModel>
</configuration> 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-02T00:30:22.100

看看 WCF 跟踪。如果您在服务主机上运行它，它将为您提供正在发生的各个 WCF 调用，并且应该足以让您找出配置的哪一部分被占用。

我特别发现连接问题是解决原因的唯一方法。

[WCF 上的 MSDN 跟踪您的应用程序](http://msdn.microsoft.com/en-us/library/ms733025.aspx)

[一个很好的教程，帮助你理解 MSDN](http://mkdot.net/blogs/dejan/archive/2008/10/23/wcf-tracing-and-message-logging.aspx)

# c# - 如何将列表绑定到组合框？

> ID：600869
> 
> 赞同：114
> 
> 时间：2009-03-01T23:59:23.533
> 
> 标签：c#, winforms, data-binding, combobox

我想将 a 连接`BindingSource`到类对象列表，然后将对象值连接到 ComboBox。
谁能建议怎么做？

```
public class Country
{
    public string Name { get; set; }
    public IList<City> Cities { get; set; }

    public Country()
    {
        Cities = new List<City>();
    }
} 
```

是我的班级，我想将其`name`字段绑定到 BindingSource，然后可以将其与 ComboBox 关联

* * *

## 回答 #1

> 赞同：171
> 
> 时间：2009-03-02T00:21:57.067

当您指的是组合框时，我假设您不想使用 2 路数据绑定（如果是这样，请查看使用 a `BindingList`）

```
public class Country
{
    public string Name { get; set; }
    public IList<City> Cities { get; set; }
    public Country(string _name)
    {
        Cities = new List<City>();
        Name = _name;
    }
} 
```

```
List<Country> countries = new List<Country> { new Country("UK"), 
                                     new Country("Australia"), 
                                     new Country("France") };

var bindingSource1 = new BindingSource();
bindingSource1.DataSource = countries;

comboBox1.DataSource = bindingSource1.DataSource;

comboBox1.DisplayMember = "Name";
comboBox1.ValueMember = "Name"; 
```

要查找在绑定组合框中选择的国家/地区，您可以执行以下操作：`Country country = (Country)comboBox1.SelectedItem;`.

如果您希望 ComboBox 动态更新，您需要确保您设置为`DataSource`implements的数据结构`IBindingList`；一种这样的结构是`BindingList<T>`.

* * *

提示：确保将 绑定`DisplayMember`到类上的属性而不是公共字段。如果你的类使用`public string Name { get; set; }`它会工作，但如果它使用`public string Name;`它将无法访问该值，而是会在组合框中显示每一行的对象类型。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-03-02T00:22:05.757

对于后台程序，有两种方法可以使用 ComboBox/ListBox

1) 将 Country 对象添加到 Items 属性并检索 Country 作为 Selecteditem。要使用它，您应该覆盖 Country 的 ToString。

2) 使用 DataBinding，将 DataSource 设置为 IList (List<>) 并使用 DisplayMember、ValueMember 和 SelectedValue

对于 2)，您首先需要一个国家/地区列表

```
// not tested, schematic:
List<Country> countries = ...;
...; // fill 

comboBox1.DataSource = countries;
comboBox1.DisplayMember="Name";
comboBox1.ValueMember="Cities"; 
```

然后在 SelectionChanged 中，

```
if (comboBox1.Selecteditem != null)
{
   comboBox2.DataSource=comboBox1.SelectedValue;

} 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2011-10-20T21:37:31.810

```
public MainWindow(){
    List<person> personList = new List<person>();

    personList.Add(new person { name = "rob", age = 32 } );
    personList.Add(new person { name = "annie", age = 24 } );
    personList.Add(new person { name = "paul", age = 19 } );

    comboBox1.DataSource = personList;
    comboBox1.DisplayMember = "name";

    comboBox1.SelectionChanged += new SelectionChangedEventHandler(comboBox1_SelectionChanged);
}

void comboBox1_SelectionChanged(object sender, SelectionChangedEventArgs e)
{
    person selectedPerson = comboBox1.SelectedItem as person;
    messageBox.Show(selectedPerson.name, "caption goes here");
} 
```

繁荣。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T00:03:18.967

尝试这样的事情：

```
yourControl.DataSource = countryInstance.Cities; 
```

如果您使用的是 WebForms，则需要添加以下行：

```
yourControl.DataBind(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T00:38:09.477

```
public class Country
{
    public string Name { get; set; }
    public IList<City> Cities { get; set; }

    public Country()
    {
        Cities = new List<City>();
    }
}

public class City 
{
    public string Name { get; set; } 
}

List<Country> Countries = new List<Country>
{
    new Country
    {
        Name = "Germany",
        Cities =
        {
            new City {Name = "Berlin"},
            new City {Name = "Hamburg"}
        }
    },
    new Country
    {
        Name = "England",
        Cities =
        {
            new City {Name = "London"},
            new City {Name = "Birmingham"}
        }
    }
};
bindingSource1.DataSource = Countries;
member_CountryComboBox.DataSource = bindingSource1.DataSource;
member_CountryComboBox.DisplayMember = "Name";
member_CountryComboBox.ValueMember = "Name"; 
```

这是我现在使用的代码。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2012-09-24T19:30:02.827

如果您使用的是 ToolStripComboBox，则没有暴露数据源（.NET 4.0）：

```
List<string> someList = new List<string>();
someList.Add("value");
someList.Add("value");
someList.Add("value");

toolStripComboBox1.Items.AddRange(someList.ToArray()); 
```

# .net - .NET DataSet 实现底层

> ID：600871
> 
> 赞同：3
> 
> 时间：2009-03-02T00:00:54.230
> 
> 标签：.net, dataset

谁能给我任何资源的指针，详细说明[.NET DataSet](http://msdn.microsoft.com/en-us/library/system.data.dataset.aspx)类的“底层”使用的结构和算法？

我目前使用的语言没有像 DataSet 类这样的通用内存数据结构的实现。我可能最终不得不自己构建一个（但没有那么广泛！），但我想在开始破解之前更好地了解现有系统是如何组合在一起的。（谢谢[道格拉斯霍夫施塔特](http://steve-yegge.blogspot.com/2008/10/universal-design-pattern.html)）

我正在阅读[Mono implementation](http://www.google.com/codesearch/p?hl=en#Z4m7EHUY1qU/mono-1.2.4/mcs/class/System.Data/System.Data/DataSet.cs&q=dataset%20lang:c%23)，但任何其他链接、文章或想法将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-02T00:10:59.027

启动 Reflector 并直奔源头...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-02T00:18:41.503

您可以从 Microsoft 合法[下载 DataSet 的原始源代码](http://referencesource.microsoft.com/netframework.aspx)，这将使您可以访问所有内容，包括原始评论。但是，如果您正在实施类似的系统/产品，您应该仔细研究[许可证](http://referencesource.microsoft.com/referencesourcelicensing.aspx)，以确保您不太可能通过查看源代码来违反它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-02T00:23:05.660

Reflector 可在[http://www.red-gate.com/products/reflector/index.htm](http://www.red-gate.com/products/reflector/index.htm)获得，它可以让您准确了解 DataSet 是如何实现的。

您还需要查看 DataAdapter，尤其是 DbDataAdapter.Fill、DataTable，尤其是 DataTable.Load，以及 DataRow 和 DbDataReader。然后，您可能想查看一些特定的实现，例如 SqlDataAdapter、SqlCommand 等。

请注意，DataSet 证明了一切看起来都像钉子的古老格言。它在 .NET 中被过度使用。特别是，不要使用它在 Web 服务和它的客户端之间传输数据——它不能很好地互操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-02T00:44:19.213

ADO.Net 数据集的关键数据结构是[红黑树](http://en.wikipedia.org/wiki/Red-black_tree)

> 它很复杂，但它的操作具有良好的最坏情况运行时间，并且在实践中很有效：它可以在 O(log n) 时间内搜索、插入和删除，其中 n 是树中元素的总数。简单来说，红黑树是一种二叉搜索树，它智能地插入和删除，保证树的合理平衡。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T00:28:29.920

这本书名为 Programming ADO.Net 2.0 core reference 对数据集进行了出色的描述，包括讨论的许多问题和内部数据结构。

数据集的主要实现依赖于红/黑自平衡树。

本书提到的另一个重要警告是，通过字符串查找数据代码的效率不高，因为它使用字符串比较来搜索查找表以查找适当的列。通过对行数进行硬编码，您可以在表和列上获得相当不错的查找性能提升。当然，这是维护的噩梦，除非你编写一个工具来为你做这件事。

# linux - 从 Linux 内核中的路径获取 inode

> ID：600877
> 
> 赞同：5
> 
> 时间：2009-03-02T00:06:18.570
> 
> 标签：linux, kernel

我目前正在尝试在内核函数中获取给定路径名的 inode。我只有完整的路径名。我试过这样的尝试：

```
user_path_at(AT_FDCWD, buffer, LOOKUP_FOLLOW, &path); 
```

但是那个给定路径中的 dentry 是无效的，结果似乎是这样。然后我想也许可以尝试 stat() 并从中获取 inode 号。但是，这只给了我一个数字，而不是结构 inode。我不知道在不获取现有 inode 并遍历整个 inode 列表的情况下将 inode 编号转换为 inode 的方法。我什至不知道这是否可行。但我当然不想那样做。

有什么简单的方法可以从内核中的 char *pathname 获取 struct inode 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-02T00:12:37.790

`stat()`将在“ `st_ino`”字段中为您提供文件的 inode。

对不起，最初对问题的误解。

如果您想要内核中的实际 inode 结构，我很确定内核本身不会遍历数组或列表来查找 inode 编号（除非列表非常小）。由于内核的代码是公开的，你应该能够找出它是如何工作的，然后做同样的事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T00:19:44.967

没有简单的方法，因为 struct inode 是内核的一部分并且您在用户空间中。这完全取决于特定的文件系统实现。您确定 stat 结构中的信息不足以满足您的需求吗？

无论如何，[这个链接](http://kerneltrap.org/node/14585)可能会有所帮助。

# sql-server - 估计数据库大小

> ID：600886
> 
> 赞同：21
> 
> 时间：2009-03-02T00:16:29.950
> 
> 标签：sql-server, database, sizing

我想知道在估计数据库大小方面开发新应用程序时您会做什么。

例如，我正计划启动一个网站，但我很难估计我的数据库可以增长的大小。我不希望你告诉我我的数据库会有多大，但我想知道在估计这个时是否有一般原则。

例如，当 Jeff 开发 StackOverflow 时，他（大概）估计了他的数据库大小和增长。

我的困境是我正在为我的 Web 应用程序寻找一个托管解决方案（在这个阶段它大约是成本），并且最好不想因为没有购买足够的 SQL Server 空间而自责（他们为此收取溢价） ）。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-02T00:25:56.433

如果您有数据库模式，那么调整大小非常简单……它只是估计的行数 * 每个表的平均行大小 * 索引的一些因素 * 开销的一些其他因素。鉴于现在存储的价格低得离谱，除非您打算拥有一个非常高流量的网站（或正在为大型企业构建应用程序），否则调整大小通常不是问题。

对于我自己的尺寸练习，我总是创建一个 Excel 电子表格列表：

*   col 1：每个将增长的表
*   col 2：估计的列大小（以字节为单位）
*   col 3：估计的行数（每年或最多，取决于应用程序）
*   col 4：索引因子（我总是将其设置为 2）
*   col 5：开销系数（我总是将其设置为 1.2）
*   col 6：总列（col 2 X 3 X 4 X 5）

col 6（总列）的总和，加上没有增长表的数据库的初始大小，就是您的大小估计。你可以变得更科学，但这是我快速而肮脏的方式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T00:28:01.857

决定：

*   每天有多少访客，V
*   每次访问将创建多少条记录，N1、N2、N3...
*   每种记录类型的大小，S1、S2、S3...

编辑：忘记了一个好的经验法则是 2 倍的指数因子

每天的总增长 = 2* V * (N1*S1 + N2*S2 + N3*S3 + ...)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T00:30:05.067

我要遵循的经验法则是

*   我期望有多少用户？
*   他们可以发布什么内容？
*   用户记录有多大？
*   用户可以添加的每个内容项有多大？
*   ***我***要加多少？
*   这些内容项目会存在多久？永远？仅仅几周？

将用户记录大小乘以用户数；添加用户数量乘以内容项大小；乘以二（为了方便的软糖因素）。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-02T00:26:53.433

估计的成本很可能大于存储的成本

大多数托管服务提供商按每月月底使用的数量出售容量，所以让它运行

# html - div在标题周围折叠

> ID：600890
> 
> 赞同：6
> 
> 时间：2009-03-02T00:19:45.840
> 
> 标签：html, css

我有几个嵌套的 div：

```
<div id="wrapper">
  <div id="header">
    <!-- a bunch of float divs here -->
  </div>

  <div id="body">
    <div id="content">
      <!-- a bunch of html controls here -->
    </div>
  </div>
</div> 
```

*   包装风格：`width: 780px; margin: 20px auto; border: solid black 5px;`
*   标题样式：`position: relative; min-height: 125px;`
*   身材：`position: relative;`
*   内容风格：`position: absolute; left: 50px; top: 0px;`

我在内容 div 中有一堆 html 元素，由于某种原因，主体 div 和包装器 div 在标题周围折叠，如果我没有为主体 div 设置固定高度，则内容 div 会自行挂起。我唯一的浮动元素在标题中。

**编辑**：

如果我删除内容 div（并将 html 元素直接放在正文中），正文 div 将停止折叠！试图理解为什么 - 猜测这是由于位置：内容 div 的绝对值。

任何线索为什么会发生这种情况以及如何解决？

我看了一下[这个问题](https://stackoverflow.com/questions/370432/div-collapse-after-float-css)，但它似乎对我不起作用（或者我可能在错误的地方清理......）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-02T00:42:58.653

试试这个。注意：header div 上隐藏的溢出解决了清除 div 的需要。请注意为什么要对内容使用相对+绝对定位。恕我直言，这可以更好地处理边距。

```
<html>
<head>
  <title>Layout</title>
  <style type="text/css">
    #wrapper { width: 780px; margin: 20px auto; border: solid black 5px; }
    #header { overflow: hidden; background-color: yellow; }
    #header div { float: right; border: 2px solid red; }
    #body { position: relative; }
    #content { position: absolute; left: 50px; top: 0px;  }
  </style>
</head>
<body>
    <div id="wrapper">
      <div id="header">
        <div>One</div>
      <div>Two</div>
      <div>Three</div>
      </div>
      <div id="body">
        <div id="content">
          <p>This is some text</p>
        </div>
      </div>
    </div>
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-02T10:15:14.130

在这种情况下，您实际上不需要使用绝对或相对定位。

以下内容通过最少的 css 争论实现了您所需要的。
颜色是因为我喜欢颜色，你也应该如此！

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
        <title>Page Title</title>
        <style type="text/css" media="screen">
    #wrapper { 
        width: 780px; 
        margin: 20px auto; 
        border: solid black 5px;

    }
    #header { 
        min-height: 125px; 
        overflow:hidden;

    }
    #body { 
        background-color:red; 

    }
    #content { 
        margin-left: 50px;
        margin-top: 0px;
        background-color:pink; 

     }
.floatie { float:left; width:40px; height :40px; 
    margin:5px; background-color:#fe0;}

        </style>

    </head>
    <body>

        <div id="wrapper">
          <div id="header">
                <div class="floatie"></div>
                <div class="floatie"></div>
                <div class="floatie"></div>
                <div class="floatie"></div>
                <div class="floatie"></div>
                <div class="floatie"></div>
                <div class="floatie"></div>
          </div>

          <div id="body">
            <div id="content">

                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, 
                    sed do eiusmod tempor incididunt ut labore et dolore 
                    magna aliqua. Ut enim ad minim veniam, quis nostrud 
                    exercitation ullamco laboris nisi ut aliquip ex ea 
                    commodo consequat. Duis aute irure dolor in 
                    reprehenderit in voluptate velit esse cillum dolore eu 
                    fugiat nulla pariatur. Excepteur sint occaecat 
                    cupidatat non proident, sunt in culpa qui officia 
                    deserunt mollit anim id est laborum.</p>
            </div>
          </div>
        </div>

    </body>
</html> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-02T00:34:04.493

我使用这种风格来清除元素：

```
.Clear { clear: both; height: 0; overflow: hidden; } 
```

在标题中放置一个清除 div，以提供标题元素大小：

```
<div id="wrapper">
  <div id="header">
    <!-- a bunch of float divs here -->
    <div class="Clear"></div>
  </div>

  <div id="body">
    <div id="content">
      <!-- a bunch of html controls here -->
    </div>
  </div>
</div> 
```

将清除元素的高度设置为零会导致它本身不占用空间。溢出样式是即使高度设置为零，IE 也不会给它一个高度。IE有个奇怪的想法，每个元素至少要高一个字符，设置overflow:hidden; 即使元素的内容在 IE 中高一个字符，也将高度保持为零。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-02T01:16:18.793

`position:relative`如果您希望#content 显示在#wrapper 的边界边界内，请在从#body 中删除（或完全删除该DIV）之后尝试此交换大小：

```
#header{position: relative; overflow:hidden; clear:both;}
#content{position:relative; left:50px; top:0px;} 
```

这样，您将能够看到#content 显示在包装器内但位于#header 下方。

可能正在发生，因为确实没有任何东西可以让#content 从下面突出。#header，当它被设置为相对时，下面会消失，即使#body 然后设置为绝对，它的后代设置为相对。

将#content 从 更改`position:absolute`为`position:relative`将使其位于先前的DIV 之下，在本例中为#header。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T00:24:31.617

*尝试在*标题中的浮动元素之后清除。

```
<div id="wrapper">
  <div id="header">
    <!-- a bunch of float divs here -->
    <div style="clear:both;"></div> <!-- Or use a clearfix... -->
  </div>

  <div id="body">
    <div id="content">
      <!-- a bunch of html controls here -->
    </div>
  </div>
</div> 
```

只要清除元素在包含的 div 内，它就应该完成你想要的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-02T00:24:52.020

使用“body” id 将样式“clear: both”添加到您的 div。您还可以在“bunch of float divs”之后和标题 div 的结束标记之前添加一个具有这种样式的 div。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-02T00:33:03.590

当您想要清除某些内容时，您还需要浮动该元素以使其正常工作。所以你会需要。

```
#header { clear: both; float: left; }
#body { clear: both; float: left; } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-02T00:35:24.100

如果不是完全需要，我不喜欢使用“clear:both”。更好的解决方案是将折叠 DIV 的“溢出”属性设置为“自动”。

尝试类似：

> ```
> #header { float: left; overflow: auto; } 
> ```

# java - 当我运行 .jnlp 文件时，Java Image 搞砸了

> ID：600907
> 
> 赞同：0
> 
> 时间：2009-03-02T00:29:46.127
> 
> 标签：java, image, jar, jnlp

我有一个在我的程序开始时被调用的方法，当我运行 jar 时它工作正常，但是当我运行 jnlp 文件时它崩溃了。

```
public void newImg(String i)
{
    try
    {
        File file = new File(i);
        img = ImageIO.read(file);
    }
} 
```

顺便说一下，img 是一个缓冲图像。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-02T00:55:44.443

赔率是您提供给文件的路径或权限不匹配。将 File ctor 放入 try 块中，捕获异常，并找出它是什么。

它应该看起来像这样：

```
try {
    File file =  new File(i);
    img = ImageIO.read(file);
} catch (Exception ex) {
    // You probably want to open the java console, or use a logger
    // as a JNLP may send stderr someplace weird.
    Systemm.err.println("Exception was: ", ex.toString());
} 
```

您拥有的代码对异常没有任何作用。

您可能想查看 Java 教程中的[异常线程](http://java.sun.com/docs/books/tutorial/essential/exceptions/)。

### 更新

看我的评论。我只是尝试了一些东西并确认了我的想法——带有 a`try {}`和 no的代码`catch`甚至`finally`不会编译。如果这确实是您认为正在使用的代码，那么您可能一直在加载旧的类文件；这个还没有编译。

```
$ cat Foo.java 
public class Foo {
     public void tryit() {
         try {
             File f = new File(null);
         }
     }
}
$ javac Foo.java
Foo.java:3: 'try' without 'catch' or 'finally'
         try {
         ^
1 error
$ 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-02T02:38:08.190

也许您没有正确加载图像。不要使用文件的相对位置。这对于每个操作系统都是不同的。您应该像这样正确加载 JAR 中的图像：

```
URL url = this.getClass().getResource("image.jpg");
Image img = Toolkit.getDefaultToolkit().getImage(url); 
```

这将加载一个名为 image.jpg 的文件，该文件与类位于同一位置。如果 File.pathSeparator 在其他位置，您也可以使用它。

使用以下两种方法之一将其作为资源加载：

[http://java.sun.com/javase/6/docs/api/java/lang/Class.html#getResource(java.lang.String)](http://java.sun.com/javase/6/docs/api/java/lang/Class.html#getResource(java.lang.String)) [http://java.sun.com/javase/6/docs/ api/java/lang/Class.html#getResourceAsStream(java.lang.String)](http://java.sun.com/javase/6/docs/api/java/lang/Class.html#getResourceAsStream(java.lang.String))

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-20T17:59:01.507

确保您具有正确的文件名/路径。

确保您对文件系统具有文件访问权限。

# c++ - 指针神秘地重置为 NULL

> ID：600912
> 
> 赞同：1
> 
> 时间：2009-03-02T00:31:20.913
> 
> 标签：c++, pointers

我正在开发一款游戏，目前正在开发处理输入的部分。这里涉及三个类，`ProjectInstance`一个是启动关卡和东西的类，一个`GameController`是处理输入的类，一个`PlayerEntity`是受`GameController`. 在启动关卡时，ProjectInstance 会创建`GameController`，它会`EvaluateControls`在 Step 方法中调用它的方法，该方法在游戏循环中被调用。该`EvaluateControls`方法看起来有点像这样：

```
void CGameController::EvaluateControls(CInputBindings *pib) {
    // if no player yet
    if (gc_ppePlayer == NULL) {
        // create it
        Handle<CPlayerEntityProperties> hep = memNew(CPlayerEntityProperties);
        gc_ppePlayer = (CPlayerEntity *)hep->SpawnEntity();
        memDelete((CPlayerEntityProperties *)hep);
        ASSERT(gc_ppePlayer != NULL);
        return;
    }

    // handles controls here
} 
```

该函数被正确调用，并且断言永远不会触发。但是，每次调用此函数时，`gc_ppePlayer`都会设置为 NULL。如您所见，它不是超出范围的局部变量。唯一`gc_ppePlayer`可以设置为 NULL 的地方是在构造函数中或可能在析构函数中，在调用`EvaluateControls`. 调试时，`gc_ppePlayer`在返回之前接收到正确的预期值。当我再次按 F10 并且光标位于右括号时，该值变为 0xffffffff。我在这里不知所措，怎么会发生这种情况？任何人？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-02T00:37:25.750

在该表达式的值更改（变为 NULL 或从 NULL）时设置一个观察点，`gc_ppePlayer == NULL`调试器将指向您确切发生的位置。

试试看，看看会发生什么。寻找未终止的字符串或将内存复制到太小的内存等...通常这是导致全局/堆栈变量被随机覆盖的问题的原因。

在 VS2005 中添加观察点（brone 的说明）

> 1.  转到断点窗口
> 2.  点击新建，
> 3.  单击数据断点。进入
> 4.  `&gc_ppePlayer`在地址框中，保留其他值。
> 5.  然后运行。
> 
> 当`gc_ppePlayer`更改时，断点将被命中。– 布朗

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-02T00:38:50.677

您是在调试 Release 还是 Debug 配置？在发布构建配置中，您在调试器中看到的并不总是正确的。进行了优化，这可以使监视窗口显示您所看到的古怪值。

你真的看到 ASSERT 触发了吗？ASSERT 通常是从发布版本编译出来的，所以我猜你正在调试发布版本，这就是为什么 ASSERT 不会导致应用程序终止的原因。

我建议构建一个 Debug 版本的软件，然后查看 gc_ppePlayer 是否真的为 NULL。如果确实如此，那么您可能会看到某种类型的内存堆损坏，其中该指针被覆盖。但是，如果它是内存损坏，它通常比您描述的确定性要低得多。

顺便说一句，使用这样的全局指针值通常被认为是不好的做法。如果它确实是单个对象并且需要全局可访问，请查看是否可以将其替换为单例类。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-02T00:48:01.887

我的第一个想法是说 SpawnEntity() 正在返回一个指向内部成员的指针，该内部成员在调用 memDelete() 时被“清除”。我不清楚指针何时设置为 0xffffffff，但如果它发生在调用 memDelete() 期间，那么这就解释了为什么您的 ASSERT 没有触发 - 0xffffffff 与 NULL 不同。

您已经有多久没有重建整个代码库了？我经常看到这样的内存问题，只需重建整个解决方案即可解决。

您是否尝试过在函数结束时跨步 (F11) 而不是跨步 (F10)？尽管您的示例没有显示任何局部变量，但为了简单起见，您可能遗漏了一些。如果是这样，F11 将（希望）进入任何这些变量的析构函数，让您查看其中一个是否导致问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T01:07:52.477

你有一个“核心范丹戈”。

动态初始化正在覆盖内存的各种位（原文如此）。

直接或间接地，全局正在被覆盖。内存中的全局相对于堆在哪里？

二进制切碎动态初始化的部分，直到问题消失。（一次注释掉一半，递归）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T01:29:07.933

根据您使用的平台，有一些工具（免费或付费）可以快速找出此类内存问题。

在我的头顶上：

*   [瓦尔格林德](http://valgrind.org/)
*   [理性净化](http://www-01.ibm.com/software/awdtools/purify/)

# asp.net - 在没有打开视图状态的情况下运行 ASP.NET

> ID：600919
> 
> 赞同：5
> 
> 时间：2009-03-02T00:36:10.260
> 
> 标签：asp.net, performance, viewstate

我们即将开始重建我们的一个 ASP.NET 项目，我想尝试在不打开 viestate 的情况下开发它（在 web.config 中禁用）。

我知道 viewstate 的优点和缺点，一般来说，它与控制状态相比跟踪了什么，但是我想知道：

1.  原理开发过程有什么区别？即，您对 Page_Load 等的结构有何不同？

2.  标准 ASP.NET 控件中是否有任何功能在没有打开视图状态的情况下真的无法工作？

另外，有没有关于使用和不使用 VS 的工作流程差异的详细文章？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-02T00:59:42.107

如果您反对视图状态 - 为什么不尝试使用 MVC 框架？这可能是一个更容易的调整。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-02T00:38:18.430

我禁用了我的项目的视图状态。我使用 scatter/gather 方法从 aspx 页面向/从我的数据访问对象填充和获取值。它比使用视图状态更干净、更简单。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-02T01:28:53.707

大多数控件（如 TextBoxes 和 DropDownLists）在没有视图状态的情况下都能正常运行。

我不知道任何开发过程问题，除了通过代码创建或修改的任何控件或属性在没有视图状态的情况下不会持续存在，因此您必须在回发时重新创建/修改它们。

我有一些带有大视图状态的非常大的页面。我做了一个实验来禁用整个项目的视图状态，并且发现（起初）没有明显的功能损失。然后在测试中出现了一些小问题，所以我们恢复了它。但是我们的 300 页 Web 应用程序在没有视图状态的情况下可能有 99% 的功能。我们遇到的问题集中在数据网格上——主要是分页，动态创建控件和其他由代码修改的东西，因此没有视图状态就不会持续存在。

这是一篇关于 Viewstate 的非常好的文章：

[http://msdn.microsoft.com/en-us/library/ms972976.aspx](http://msdn.microsoft.com/en-us/library/ms972976.aspx)

# xpath - XPath 2.0：如何测试我们所拥有的变量是一个元素？

> ID：600934
> 
> 赞同：0
> 
> 时间：2009-03-02T00:45:05.200
> 
> 标签：xpath

说我有一个变量`$foo`。我想使用`$foo castable as element()`，但我不能在 castable 之后使用节点类型。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-02T00:56:52.880

`$foo instance of element()`成功了。

# asp.net - 在 ASP.NET 中阻止用户访问网站

> ID：600939
> 
> 赞同：2
> 
> 时间：2009-03-02T00:48:45.927
> 
> 标签：asp.net

除了IP阻塞，可能使用cookie（如果用户更改IP但不删除cookie，则将新IP添加到禁止列表中，因此必须更改IP并必须一起删除cookie才能访问网站），是否有任何技巧可以用来阻止烦人的用户访问网站，我知道对于精明的用户来说没有任何东西可以工作，但我正试图让不太精明的用户更难，有什么建议吗？

编辑：我已经在我的网站上注册了，关键是这对于阻止确定的用户是没有用的（他们可以简单地创建其他帐户）。

@rifferte，实际上我已经建立了一个审核部分，版主可以删除帖子并暂停会员，会员也可以报告滥用和垃圾邮件，我并不是想让这成为不可能，只是没有办法做到这一点，我只是想摆脱不太精明的人（大多数），而不是永远，我打算在一段时间内阻止他们（可能是几天或类似的时间）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-02T01:43:15.000

对现有用户的任何公开谴责都可能导致论坛相当于军备竞赛。SO 播客上的一种思想流派是标记违规用户并将他们的帖子从正常视图中删除，但在他们（坏用户）正在查看该站点时将其包括在内。这样一来，他们认为社区正在忽视他们，这使得燃烧变得不那么有趣。如果该网站没有试图阻止他们，但他们在燃烧的努力是徒劳的，他们很可能会走开。

[另请参阅 Jeff 的此博客](http://www.codinghorror.com/blog/2011/06/suspension-ban-or-hellban.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-02T02:20:21.010

我遇到过的最好的方法之一是 vBulletin 中的“Tachy 去考文垂”功能。将用户添加到此列表会将他们置于适用于所有人（*除了*他们自己）的全局忽略列表中。

因此，他们继续发帖，从他们的角度来看一切正常，但他们的帖子不会干扰其他用户。令人惊讶的是，这些用户似乎很少弄清楚发生了什么，他们对所造成的破坏非常满意，他们认为他们正在肆无忌惮地肆虐。

当每个人都忽略他们时，破坏性用户往往会**很快消失。**一旦他们放弃，您可以一次性批量删除他们的所有内容，这需要相对较少的管理工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-02T01:39:32.933

有时似乎有帮助的是：

*   确保帐户在发布之前需要“成熟”。
*   与堆栈溢出类似的信誉系统（帐户消失 = 信誉消失）:)
*   使用 OpenID 等身份验证提供程序。以这种方式创建多个帐户需要更多的工作

事情的简单事实是：如果有人在创建帐户后可以做任何事情，则该帐户没有任何额外价值。一旦一个帐户有一些额外的价值（即有人需要在一个帐户中做一些好的工作以获得更多的权限），你会发现滥用者可能会去其他网站。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T00:57:05.577

我相信如果用户有那么多时间去刻录，你就会一直处于猫捉老鼠的游戏中。

您最好的选择是在网站的注册过程中加入一些人为因素，以适当地研究任何特定用户。不优雅，但在不了解您的网站的情况下，没有太多可以说的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T00:58:13.093

现在这个问题已经通过额外的信息进一步完善，我想改变我的答案。

论坛站点中的问题用户之所以存在，是因为其他用户为他们提供了内容。如何尝试一种方法，如果您识别出问题用户，然后您会默默地从您的网站向其他用户隐藏他们的帖子，而不是问题用户。理论是，问题用户“认为”他们的帖子通过了，但由于它实际上对所有其他用户隐藏，没有人会回复问题用户，如果幸运的话，他们会去其他地方他们所在的地方得到反馈。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-02T02:54:50.537

你能相信你的“好”用户群来标记坏/烦人的用户吗？

像 craigslist 之类的东西：如果某个用户被一些用户标记为烦人，他们的帐户会在一段时间内暂时无法发帖。如果这种情况发生几次，他们的帐户会被暂停吗？

只是一个想法。

# sql - 如何将 SQL 子查询转换为联接

> ID：600943
> 
> 赞同：9
> 
> 时间：2009-03-02T00:55:28.187
> 
> 标签：sql, sql-server, join, subquery

我有两个具有 1:n 关系的表：“内容”和“版本化内容数据”（例如，文章实体和该文章创建的所有版本）。我想创建一个显示每个“内容”的顶级版本的视图。

目前我使用这个查询（带有一个简单的子查询）：

```
选择
   t1.id,
   t1.title,
   t1.contenttext,
   t1.fk_idothertable
   t1.版本
FROM mytable 作为 t1
WHERE (version = (SELECT MAX(version) AS topversion
                  来自我的表
                  WHERE (fk_idothertable = t1.fk_idothertable)))
```

子查询实际上是对提取特定项目的最高版本的同一个表的查询。请注意，版本化项目将具有相同的 fk_idothertable。

在 SQL Server 中，我尝试创建此查询的**索引视图，但似乎我做不到，因为****索引视图**中不允许子查询。所以...这是我的问题...您能想出一种方法将此查询转换为某种带有 JOIN 的查询吗？

似乎索引视图不能包含：

*   子查询
*   公用表表达式
*   派生表
*   HAVING 子句

我很绝望。欢迎任何其他想法:-)

非常感谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-02T03:11:35.130

如果表已经在生产中，这可能无济于事，但建模的正确方法是使 version = 0 成为永久版本并始终增加 OLDER 材料的版本。因此，当您插入新版本时，您会说：

```
UPDATE thetable SET version = version + 1 WHERE id = :id
INSERT INTO thetable (id, version, title, ...) VALUES (:id, 0, :title, ...) 
```

那么这个查询就是

```
SELECT id, title, ... FROM thetable WHERE version = 0 
```

没有子查询，没有 MAX 聚合。您总是知道当前版本是什么。您永远不必选择 max(version) 来插入新记录。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-02T01:12:53.963

也许是这样的？

```
SELECT
  t2.id,
  t2.title,
  t2.contenttext,
  t2.fk_idothertable,
  t2.version
FROM mytable t1, mytable t2
WHERE t1.fk_idothertable == t2.fk_idothertable
GROUP BY t2.fk_idothertable, t2.version
HAVING t2.version=MAX(t1.version) 
```

只是一个疯狂的猜测......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T01:05:24.683

我不知道这会有多有效，但是：

```
选择 t1.*, t2.version
FROM mytable AS t1
    加入 （
        选择 mytable.fk_idothertable, MAX(mytable.version) AS 版本
        来自我的表
    ) t2 ON t1.fk_idothertable = t2.fk_idothertable

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T01:05:33.013

您也许可以使 MAX 成为分组依据的表别名。

它可能看起来像这样：

```
SELECT 
   t1.id, 
   t1.title, 
   t1.contenttext,
   t1.fk_idothertable
   t1.version
FROM mytable as t1 JOIN
   (SELECT fk_idothertable, MAX(version) AS topversion
   FROM mytable
   GROUP BY fk_idothertable) as t2
ON t1.version = t2.topversion 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T02:38:27.660

我认为 FerranB 很接近，但没有完全正确的分组：

```
with
latest_versions as (
   select 
      max(version) as latest_version,
      fk_idothertable
   from 
      mytable
   group by 
      fk_idothertable
)
select
  t1.id, 
  t1.title, 
  t1.contenttext,
  t1.fk_idothertable,
  t1.version
from 
   mytable as t1
   join latest_versions on (t1.version = latest_versions.latest_version 
      and t1.fk_idothertable = latest_versions.fk_idothertable); 
```

米

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-23T14:38:53.467

```
If SQL Server accepts LIMIT clause, I think the following should work:
SELECT 
   t1.id, 
   t1.title, 
   t1.contenttext,
   t1.fk_idothertable
   t1.version
FROM mytable as t1 ordery by t1.version DESC LIMIT 1;
(DESC - For descending sort; LIMIT 1 chooses only the first row and
DBMS usually does good optimization on seeing LIMIT). 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-03-02T01:04:28.383

像这样......我假设子查询中的“mytable”是一个不同的实际表......所以我称之为 mytable2。如果它是同一张表，那么这仍然可以工作，但我想 fk_idothertable 将只是“id”。

```
 SELECT 
   t1.id, 
   t1.title, 
   t1.contenttext,
   t1.fk_idothertable
   t1.version
FROM mytable as t1
    INNER JOIN (SELECT MAX(Version) AS topversion,fk_idothertable FROM mytable2 GROUP BY fk_idothertable) t2
        ON t1.id = t2.fk_idothertable AND t1.version = t2.topversion 
```

希望这可以帮助

# java - 如何在可能为空的对象上输出字符串属性

> ID：600945
> 
> 赞同：3
> 
> 时间：2009-03-02T00:56:24.860
> 
> 标签：java, jsf, seam

作为接缝 JSF 页面中数据表的一部分，一列需要名称的输出：

```
<h:outputText value="#{listing.staffMember.name}"/> 
```

问题是“staffMember”在某些列表中可能为空，所以我收到错误：

```
javax.el.ELException: /xxxxx.xhtml @42,67 value="#{listing.staffMember.name}": Error reading 'name' on type xxxx.model.AgentStaff_$$_javassist_152 
```

如果值为 null，我不希望呈现任何文本。我试过这个：

```
<h:outputText value="#{listing.staffMember.name}" rendered="#{listing.staffMember != null}"/> 
```

但同样的错误出现了。

如何在可能为空的对象上输出属性？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-02T02:53:35.687

您可能可以[使用三元运算符](http://www.javabeat.net/tips/173-ternary-operator-in-jsp-20-expression-langua.html)，它看起来像：

```
value="#{listing.staffMember != null ? listing.staffMember.name : 'None'}" 
```

或者您可以使用[c:if 标签](http://www.coderanch.com/t/212933/JSF/java/if-like-JSF-conditions)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-08T08:30:28.760

你能试试这个（一直对我有用）：

```
<h:outputText value="#{listing.staffMember.name}" 
              rendered="#{not empty listing.staffMember}"/> 
```

不确定与 null 相比有什么区别。

# sharepoint - SharePoint 发布网站上的分层导航

> ID：600959
> 
> 赞同：1
> 
> 时间：2009-03-02T01:09:15.423
> 
> 标签：sharepoint, moss

我有一个看起来像这样的网站结构：

*   家
    *   2级
        *   3级
            *   4级

而且我在 MOSS 发布网站上正确显示左侧导航时遇到问题。当我在**2 级**以下的页面上时，导航应该如下所示：

*   2级
    *   3级

当我到达**3 级**以下的页面时，它应该如下所示：

*   2级
    *   3级
        *   4级

但我似乎找不到菜单和数据提供者执行此操作的方法。

如何将导航设置为始终从固定级别开始，但到达比当前深度大一倍的深度？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-02T03:38:13.380

你可以自己动手。获取一份[moss 菜单](http://blogs.msdn.com/sharepoint/archive/2006/12/02/customizing-the-wss-3-0-moss-2007-menu-control.aspx)代码的副本，在您自己的控件中覆盖 render 方法并创建一个解决方案包以将您的新菜单作为一项功能发布。

# .net - 在 VB.NET 中创建类库

> ID：600962
> 
> 赞同：1
> 
> 时间：2009-03-02T01:13:17.007
> 
> 标签：.net, class

我需要在 VB.NET 中创建一个将连接到 Oracle 数据库的类库。

然后我将执行一些函数来从数据库中检索信息。

然后我需要在 ASP.Net 2.0 项目中使用这个类。

有人愿意指出我实现这一目标的正确方向吗？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-02T03:53:03.720

当我第一次不得不创建一个库来处理数据库时；我不知道如何开始，因为我不知道要搜索的确切术语。

如果您搜索如何创建“DAL”（数据访问层），您应该能够找到许多方法来实现您正在寻找的东西。

通常 DAL 独立于它的使用位置，因此您可以在 ASP.NET、WinForms 或 WPF 等中使用它。而且您可以以不必担心是否连接的方式编写 DAL到 Oracle 或其他 RDBMS。

无论如何，这里的关键字是**DAL**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T01:19:16.710

你有两个选择；来自 Microsoft 和 ODP.NET 的 System.Data.OracleClient。就个人而言，我更喜欢 ODP.NET，但 System.Data.OracleClient 会完成这项工作。

如果您熟悉使用 ADO.NET 连接到其他数据库，您会发现连接到 Oracle 没有什么不同——Connection、Command、Reader 等。

基本 ODP.NET 示例 [http://www.oracle.com/technology/sample_code/tech/windows/odpnet/odpbasic.html](http://www.oracle.com/technology/sample_code/tech/windows/odpnet/odpbasic.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T01:22:59.227

[该](http://www.connectionstrings.com/oracle)站点详细介绍了如何为可用于连接到 oracle 数据库的不同提供程序构建连接字符串。

# c# - 将地址对象转换为字符串的最佳方法是什么？

> ID：600967
> 
> 赞同：2
> 
> 时间：2009-03-02T01:17:16.060
> 
> 标签：c#, string, c#-3.0, object

我有一个 Address 对象，它具有 AddressLine1、AddressLine2、Suburb、State、ZipCode 属性。（还有更多，但这对于示例来说已经足够了）。此外，这些属性中的每一个都是字符串。我正在使用 C# 3.0。

我想将它表示为一个字符串，但是当我这样做时，我发现我正在创建一个由于所有 if 语句而具有高圈复杂度的方法......

假设分配给每个属性的字符串与属性的名称相同（即AddressLine1 = "AddressLine1"）...我希望地址表示如下：

“AddressLine1 AddressLine2 Suburb State ZipCode”。

现在，我最初的做法是通过一个简单的 String.Format()

```
String.Format("{0} {1} {2} {3} {4}", address.AddressLine1, 
address.AddressLine2, address.Suburb, address.State, address.ZipCode); 
```

这一切都很好，直到我发现其中一些字段可以为空......特别是 AddressLine2。结果是额外的不需要的空间......当你连续获得几个时，这特别烦人。

为了解决这个问题以及我能想到的唯一解决方案，我必须手动构建字符串，并且只有在地址属性不为空或不为空时才将地址属性添加到字符串中。

IE

```
string addressAsString = String.Empty;

if (!String.IsNullOrEmpty(address.AddressLine1))
{
    addressAsString += String.Format("{0}", address.AddressLine1);
}

if(!String.IsNullOrEmpty(address.AddressLine2))
{
    addressAsString += String.Format(" {0}", address.AddressLine2);
}

etc.... 
```

有没有更优雅和/或更简洁的方法来实现我没有考虑的这一点？我的解决方案只是*感觉*凌乱和臃肿......但我想不出更好的方法来做到这一点......

据我所知，鉴于我想做的事情，这是我唯一的选择......但我只是想我会把它扔在那里，看看是否有比我更有经验的人知道更好的方法。如果没有更好的选择，那么好吧......但如果有，那么我将学习一些我以前不知道的东西。

提前致谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-02T01:23:53.017

这可能不是最有效的方法，但它很简洁。您可以将您想要的项目放入一个数组中并过滤掉那些没有重要价值的项目，然后加入它们。

```
var items = new[] { line1, line2, suburb, state, ... };
var values = items.Where(s => !string.IsNullOrEmpty(s));
var addr = string.Join(" ", values.ToArray()); 
```

可能更有效但更难阅读的是将值聚合到 a`StringBuilder`中，例如

```
var items = new[] { line1, line2, suburb, state, ... };
var values = items.Where(s => !string.IsNullOrEmpty(s));
var builder = new StringBuilder(128);
values.Aggregate(builder, (b, s) => b.Append(s).Append(" "));
var addr = builder.ToString(0, builder.Length - 1); 
```

我可能倾向于第一个实现之类的东西，因为它更简单且更易于维护的代码，然后如果性能是一个问题，请考虑更像第二个实现（如果它确实更快......）。

（注意这需要 C# 3.0，但你没有提到你的语言版本，所以我假设这没问题）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-02T01:30:54.950

将字符串放在一起时，我建议您使用 StringBuilder 类。这样做的原因是 System.String 是不可变的，因此您对字符串所做的每一次更改都只会返回一个新字符串。

如果您想在文本中表示一个对象，最好覆盖 ToString() 方法并将您的实现放在那里。

最后但同样重要的是，使用 C# 3.5 中的 Linq，您可以像 Greg Beech 在这里所做的那样将它们连接在一起，但不要使用 string.Join() 使用：

```
StringBuilder sb = new StringBuilder();
foreach (var item in values) {
  sb.Append(item);
  sb.Append(" ");
} 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-02T02:54:45.623

我建议重写 ToString 方法，并采用定义自定义类型的 IFormatProvider 实现。

有关实现 IFormatProvider 的信息，请参阅位于[http://msdn.microsoft.com/en-us/library/system.iformatprovider.aspx](http://msdn.microsoft.com/en-us/library/system.iformatprovider.aspx)的MSDN 。

然后您可以编写如下代码：
address.ToString("s"); // 短地址
address.ToString("whatever"); // 您定义的任何自定义格式。

绝对不是最简单的方法，但最干净的恕我直言。此类实现的一个示例是 DateTime 类。

干杯
灰

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T01:21:28.063

首先，地址需要某些信息，因此您不应该允许没有邮政编码的地址。您还可以通过将每个属性初始化为空字符串或要求每个属性作为构造函数的参数来确保它们永远不会为空。这样你就知道你已经在处理有效的数据了，所以你可以输出一个格式化的字符串，而不需要 IsNullOrEmpty 检查。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T01:23:56.980

我在构建多行联系人摘要时遇到了类似的问题，该摘要可能有几个空字段。我几乎做了你做的同样的事情，除了我使用了一个字符串生成器，而不是一遍又一遍地连接到一个字符串。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-02T01:29:13.347

如果您的数据不完全可靠，则需要在某处拥有该逻辑 - 我建议您创建另一个为您执行该逻辑的只读属性（将其称为 FormattedAddress）。这样，您不必更改任何代码，在某些时候，您可以清理或以其他方式更改规则。

+1 建议使用字符串生成器，而不是连接字符串。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-03-11T21:26:04.610

我知道这真的很老了，但是我感觉到了一个通用的解决方案并以这种方式实现了我的解决方案：

```
private static string GetFormattedAddress(
    string address1,
    string address2,
    string city,
    string state,
    string zip)
{
    var addressItems =
        new []
        {
            new[] { address1, "\n" },
            new[] { address2, "\n" },
            new[] { city, ", " },
            new[] { state, " " },
            new[] { zip, null }
        };

    string suffix = null;
    var sb = new StringBuilder(128);

    foreach (var item in addressItems)
    {
        if (!string.IsNullOrWhiteSpace(item[0]))
        {
            // Append the last item's suffix
            sb.Append(suffix);

            // Append the address component
            sb.Append(item[0]);

            // Cache the suffix
            suffix = item[1];
        }
    }

    return sb.ToString();
} 
```

# c# - 在 ASP.NET 中将行插入数据库

> ID：600971
> 
> 赞同：1
> 
> 时间：2009-03-02T01:20:03.667
> 
> 标签：c#, .net, insert, datasource

我是 .NET 的新手，我似乎无法弄清楚应该简单的东西。我想在表中插入一行，并使用未绑定到数据控件的值对其进行初始化。具体来说，我在页面上有一个 CreateUserWizard 控件。在 CreatedUser 方法中，我想在我创建的名为“users”的数据库中插入一行，其中包含来自 CreateUserWizard 控件的用户名和电子邮件地址，以及来自 DateTime.Now 函数的新用户的创建日期。似乎没有一种方法可以在 sqlDataSource 控件中设置参数，以便它们可以访问未绑定到数据控件的数据。谁能解释我这样做的方法？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-02T01:29:02.117

您走错了路 - 您根本不会使用 sqlDataSource 控件。您将通过代码与数据库进行更直接的交互。例如：

```
SqlConnection conn = new SqlConnection(connString);
SqlCommand cmnd = new SqlCommand("Insert Into Table (P1, P2) Values (@P1, @P2)", conn);
cmnd.Parameters.AddWithValue("@P1", P1Value);
cmnd.Parameters.AddWithValue("@P2", P2Value);
cmnd.ExecuteNonQuery();
conn.Close(); 
```

现在，说了这么多，您将希望详细了解 SqlCommand 和 SqlDataReader（它们非常简单），然后将注意力转向构建对您有意义的数据访问层。你会很高兴你做到了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-02T01:37:01.300

另一种选择是在数据库本身上设置默认值，这样您就不必担心传递 Datetime.now。

# php - 从查询中获取近似数量的搜索结果的最佳方法是什么？

> ID：600972
> 
> 赞同：2
> 
> 时间：2009-03-02T01:20:14.273
> 
> 标签：php, mysql, search, approximation

为了更详细地描述它，如果我有一个区域的图像地图，当单击时，将执行查询以获取有关该区域的更多信息。

我的客户希望我在将鼠标悬停在该区域图像地图上时显示大致数量的搜索结果。

我的问题是如何缓存？或者在不严重耗尽服务器内存资源的情况下获得该数字？

顺便说一句，如果这是必要的信息，我正在使用 php 和 mysql。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-02T01:22:50.103

您可以定期执行查询，然后存储结果（例如，在不同的表中）。

结果不会是绝对最新的，但会是一个很好的近似值，并且会减少服务器上的负载。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-02T01:31:27.633

MySQL 可以为您提供查询将返回的大致行数，而无需实际运行查询。这就是 EXPLAIN 语法的用途。

您在“SELECT”之前使用“EXPLAIN”运行查询，然后将行列中的所有结果相乘。

准确性是高度可变的。它可能适用于某些类型的查询，但对其他类型的查询毫无用处。它利用 MySQL 优化器保留的有关您的数据的统计信息。

注意：定期（即每月一次）在表格上使用 ANALYZE TABLE 可能有助于提高这些估计的准确性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T01:24:26.463

您可以使用区域的 id 创建另一个表，然后创建一个脚本，该脚本以较慢的时间（例如晚上）在所有区域上运行，并用数据填充这个额外的表。

然后，当您将鼠标悬停时，您会从这个新表中获取 ID，并且最多可以使用一天。

这样做的问题可能是你没有很慢的时间，或者在晚上完成的运行需要很长时间并且过程非常繁重。

编辑您的评论。

如果可以，请选择一个较大的地区或国家，在您选择的 SQL 浏览器中查询该地区并查看所需时间。

如果它太多，您可以分发它，以便某些国家/地区将在特定时间执行，小国一起执行，而大国在某个时期单独执行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T01:56:08.807

您是否担心当滚动事件发生时您根本不想去数据库获取此信息，或者您是否认为查询太慢并且您想要来自数据库的信息，但更快?

如果您的查询速度较慢，您可以对其进行调整，或使用已经给出的其他一些建议。

或者，为了完全避免数据库命中，您似乎在此地图上有有限数量的区域，您可以定期对所有区域运行查询并将这些数字保存在内存中。

# c# - 如何在 C# 中进行模板特化

> ID：600978
> 
> 赞同：91
> 
> 时间：2009-03-02T01:23:05.077
> 
> 标签：c#, partial-specialization

您将如何专攻 C#？

我会提出一个问题。你有一个模板类型，你不知道它是什么。但是您确实知道它是否源自`XYZ`您要调用的`.alternativeFunc()`. 一个很好的方法是调用一个专门的函数或类，并在调用的任何派生类型上有其他专门化时`normalCall`返回。这将如何在 C# 中完成？`.normalFunc()``XYZ``.alternativeFunc()`

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2009-03-02T04:51:51.847

在 C# 中，最接近特化的是使用更具体的重载；但是，这很脆弱，并没有涵盖所有可能的用法。例如：

```
void Foo<T>(T value) {Console.WriteLine("General method");}
void Foo(Bar value) {Console.WriteLine("Specialized method");} 
```

在这里，如果编译器知道编译时的类型，它将选择最具体的：

```
Bar bar = new Bar();
Foo(bar); // uses the specialized method 
```

然而....

```
void Test<TSomething>(TSomething value) {
    Foo(value);
} 
```

甚至会使用`Foo<T>`for `TSomething=Bar`，因为这是在编译时烧录的。

*另一种方法是在*泛型方法中使用类型测试——但是，这通常是一个糟糕的主意，不推荐使用。

基本上，C# 只是不希望您使用专业化，除了多态性：

```
class SomeBase { public virtual void Foo() {...}}
class Bar : SomeBase { public override void Foo() {...}} 
```

这里`Bar.Foo`将始终解决正确的覆盖。

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2009-03-02T01:45:28.503

假设您正在谈论模板专业化，因为它可以使用 C++ 模板完成——这样的功能在 C# 中并不真正可用。这是因为 C# 泛型在编译期间不会被处理，并且更多是运行时的一个特性。

但是，您可以使用 C# 3.0 扩展方法实现类似的效果。这是一个示例，展示了如何仅为`MyClass<int>`类型添加扩展方法，就像模板特化一样。但是请注意，您不能使用它来隐藏方法的默认实现，因为 C# 编译器总是更喜欢标准方法而不是扩展方法：

```
class MyClass<T> {
  public int Foo { get { return 10; } }
}
static class MyClassSpecialization {
  public static int Bar(this MyClass<int> cls) {
    return cls.Foo + 20;
  }
} 
```

现在你可以这样写：

```
var cls = new MyClass<int>();
cls.Bar(); 
```

如果您希望在未提供专业化时使用的方法有一个默认情况，那么我相信编写一个通用`Bar`扩展方法应该可以解决问题：

```
 public static int Bar<T>(this MyClass<T> cls) {
    return cls.Foo + 42;
  } 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2010-07-26T18:46:07.217

通过添加中间类和字典，**可以进行专业化**。

为了专注于 T，我们创建了一个通用接口，其中包含一个名为（例如）Apply 的方法。对于实现接口的具体类，定义该类特有的Apply方法。这个中间类称为特征类。

该特征类可以在泛型方法的调用中指定为参数，然后（当然）总是采用正确的实现。

除了手动指定之外，特征类也可以存储在全局`IDictionary<System.Type, object>`. 然后可以查找它，瞧，你在那里有真正的专业化。

如果方便，您可以在扩展方法中公开它。

```
class MyClass<T>
{
    public string Foo() { return "MyClass"; }
}

interface BaseTraits<T>
{
    string Apply(T cls);
}

class IntTraits : BaseTraits<MyClass<int>>
{
    public string Apply(MyClass<int> cls)
    {
        return cls.Foo() + " i";
    }
}

class DoubleTraits : BaseTraits<MyClass<double>>
{
    public string Apply(MyClass<double> cls)
    {
        return cls.Foo() + " d";
    }
}

// Somewhere in a (static) class:
public static IDictionary<Type, object> register;
register = new Dictionary<Type, object>();
register[typeof(MyClass<int>)] = new IntTraits();
register[typeof(MyClass<double>)] = new DoubleTraits();

public static string Bar<T>(this T obj)
{
    BaseTraits<T> traits = register[typeof(T)] as BaseTraits<T>;
    return traits.Apply(obj);
}

var cls1 = new MyClass<int>();
var cls2 = new MyClass<double>();

string id = cls1.Bar();
string dd = cls2.Bar(); 
```

请参阅此[链接](http://barendgehrels.blogspot.com/2010/07/c-specializations-by-traits-i.html)到我最近的博客和后续的详细描述和示例。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2015-03-31T21:53:49.100

我也在寻找一种模式来模拟模板专业化。有一些方法可能在某些情况下有效。然而案子呢

```
static void Add<T>(T value1, T value2)
{
    //add the 2 numeric values
} 
```

可以使用语句选择操作，例如`if (typeof(T) == typeof(int))`. 但是有一种更好的方法可以通过单个虚函数调用的开销来模拟真正的模板特化：

```
public interface IMath<T>
{
    T Add(T value1, T value2);
}

public class Math<T> : IMath<T>
{
    public static readonly IMath<T> P = Math.P as IMath<T> ?? new Math<T>();

    //default implementation
    T IMath<T>.Add(T value1, T value2)
    {
        throw new NotSupportedException();    
    }
}

class Math : IMath<int>, IMath<double>
{
    public static Math P = new Math();

    //specialized for int
    int IMath<int>.Add(int value1, int value2)
    {
        return value1 + value2;
    }

    //specialized for double
    double IMath<double>.Add(double value1, double value2)
    {
        return value1 + value2;
    }
} 
```

现在我们可以编写，而不必事先知道类型：

```
static T Add<T>(T value1, T value2)
{
    return Math<T>.P.Add(value1, value2);
}

private static void Main(string[] args)
{
    var result1 = Add(1, 2);
    var result2 = Add(1.5, 2.5);

    return;
} 
```

如果不仅要为实现的类型调用特化，还要为派生类型调用特化，则可`In`以为接口使用参数。但是，在这种情况下，方法的返回类型不能再是泛型类型`T`。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2018-03-02T15:56:46.653

我认为有一种方法可以使用.NET 4+ 使用动态分辨率来实现它：

```
static class Converter<T>
{
    public static string Convert(T data)
    {
        return Convert((dynamic)data);
    }

    private static string Convert(Int16 data) => $"Int16 {data}";
    private static string Convert(UInt16 data) => $"UInt16 {data}";
    private static string Convert(Int32 data) => $"Int32 {data}";
    private static string Convert(UInt32 data) => $"UInt32 {data}";
}

class Program
{
    static void Main(string[] args)
    {
        Console.WriteLine(Converter<Int16>.Convert(-1));
        Console.WriteLine(Converter<UInt16>.Convert(1));
        Console.WriteLine(Converter<Int32>.Convert(-1));
        Console.WriteLine(Converter<UInt32>.Convert(1));
    }
} 
```

输出：

```
Int16 -1
UInt16 1
Int32 -1
UInt32 1 
```

这表明不同的类型调用了不同的实现。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-03-28T18:58:55.270

一些建议的答案是使用运行时类型信息：本质上比编译时绑定的方法调用慢。

编译器不像 C++ 那样强制专门化。

我建议在完成通常的编译器以实现类似于 C++ 的效果后，查看 PostSharp 以获取注入代码的方法。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-02T01:52:38.330

如果您只想测试一个类型是否来自 XYZ，那么您可以使用：

```
theunknownobject.GetType().IsAssignableFrom(typeof(XYZ)); 
```

如果是这样，您可以将“theunknownobject”转换为 XYZ 并像这样调用 AlternativeFunc()：

```
XYZ xyzObject = (XYZ)theunknownobject; 
xyzObject.alternativeFunc(); 
```

希望这可以帮助。

# php - 如何从 PHP 中隐藏 .SVN 目录

> ID：600997
> 
> 赞同：1
> 
> 时间：2009-03-02T01:31:41.843
> 
> 标签：php, svn, configuration

我正在使用 SVN 来管理我的网站的副本。该站点运行一个typo3 安装，它使用PHP 创建后端。

问题是，所有愚蠢的 .SVN 文件夹都出现在 PHP 的目录列表中。我不是说 apache 列表中的构建。我的意思是由 PHP 后端创建的目录列表。

那么，有没有办法从 PHP 中隐藏特殊目录？

[注意] 更改 PHP 源代码不是一种选择。Typo3 太大，每个扩展都使用自己的代码。比 SVN 导出脚本要费力得多。

克里斯

PS：我不想设置 svn export --> web_root 只是为了摆脱文件。而且我知道我可以阻止 apache 为 .SVN 目录提供服务，我做到了。但是在浏览目录树（由 PHP 创建）时，它们仍然出现在后端。而且他们很烦人...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-02T02:19:19.780

这很困难，因为您必须更改文件系统和 Typo3 之间某处的行为。你有：

> 文件系统 → 操作系统 → PHP → Typo3

文件必须保留在文件系统中并且必须保持对操作系统可见，因此您可以使用 SVN。更改 Typo3 对您来说不是一种选择，并且更改 PHP 会产生许多其他您应该避免的主要不良后果。所以，你剩下的就是在 OS→PHP 或 PHP→Typo3 之间插入一些东西。

第一种情况实际上是可能的，这取决于您使用的操作系统以及您是否具有管理员（root）访问权限。**[FUSE](http://fuse.sourceforge.net/)**是 Linux 内核的一部分，也[可用于许多其他操作系统](http://apps.sourceforge.net/mediawiki/fuse/index.php?title=OperatingSystems)。然后，使用 fuse，您可以安装像[rofs-filtered](http://ebixio.com/rofs-filtered)这样的过滤器，它允许您过滤哪些文件和目录在已安装的卷中可见。你用它来创建一个镜像你的 SVN 检出目录的文件系统，过滤这些`.svn`目录。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-02T01:59:49.170

> 那么，有没有办法从 PHP 中隐藏特殊目录？

不。

只要运行 PHP 的用户对目录具有读取权限，它就会始终生成该目录中的所有文件/目录。没有办法从某些进程中隐藏文件，如果这可能编写一个根工具包来隐藏 ls 和其他文件系统工具会容易得多。

您想要/需要的选项是一种定义 Typo3 忽略的文件的方法，并使其在系统范围内，因此也被扩展使用。但是，您已指定不想更改源代码，也不想进行 svn 导出。

因此，您被 .svn 目录困住了。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-01-21T14:06:43.133

简短的回答是“不容易，简单或理智”。

[从 SVN 的导出](http://svnbook.red-bean.com/en/1.0/re10.html)而不是结帐运行网站。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T01:33:42.633

试试这个。

```
<locationmatch "/.svn/">
    order allow,deny
    deny from all
</locationmatch> 
```

顺便说一句，在 PHP 的循环中，您可以进行逻辑检查以查看文件名是否不是“.svn”，通常 PHP 目录工具会这样做以排除“。” 和“..”目录。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T01:36:42.190

> 问题是，所有愚蠢的 .SVN 文件夹都出现在 PHP 的目录列表中。我不是说 apache 列表中的构建。我的意思是由 PHP 后端创建的目录列表。

什么应用程序在做目录列表？您是否考虑过查看 PHP 后端的代码并添加一些内容来阻止 .svn 目录的显示？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-02T08:34:15.260

只需找到或编写一个非常简单的应用程序，它将您的当前目录与将公开给 Web 的新目录同步。您可以拥有一个监视更改的服务，或者使用带有排除项的 rsync 之类的服务或您拥有的服务。这会简单得多，因为根据另一个问题，您在 Windows 上。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-21T14:03:10.090

还有一个名为 np_subversion 的扩展，它将通过 subversion 处理文件管理更改。作为一个不错的选择，它会为您隐藏文件夹

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-01-21T14:27:13.553

> 我不想设置 svn export --> web_root 只是为了摆脱文件

你确定吗？这就是 SVN 的设计方式：您从 SVN 中检查代码以对其进行处理，然后从 SVN 导出代码以进行部署。如果您不喜欢这样，那么 SVN 可能不是正确的选择。正如gahooa所说，也许切换到Git？

这有点像说“我想保存我的 Word 文档，但我不希望这个愚蠢的 .doc 文件出现在我的计算机上。” 这就是软件的工作原理。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-01-21T14:34:44.647

Sara Golemon 的[Runkit](http://il2.php.net/runkit)可以做到这一点。您可以重新映射 glob() 等函数。但是，我不确定在生产服务器中运行它是否是个好主意。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-03-02T01:51:18.147

如果您不需要 .svn 文件夹，您可以删除它们。

```
find ./ -name ".svn" | xargs rm -f *.svn 
```