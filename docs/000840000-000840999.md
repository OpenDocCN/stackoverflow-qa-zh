# StackOverflow 问答 000840000-000840999

# schema - 如何创建一个模式，其中每个客户可以有多个用户定义的属性？

> ID：840002
> 
> 赞同：0
> 
> 时间：2009-05-08T14:19:13.990
> 
> 标签：schema, database, entity-attribute-value, application-design

我将开发一个应用程序，该应用程序允许我们的客户定义将在某种反馈/调查环境中显示给用户的字段。例如，比萨店可能有一个区域要求您最喜欢的浇头，酒吧可能有您最喜欢的啤酒品牌。

系统需要能够让我们的客户创建和修改这些字段，因为它们依赖于特定的客户并且可能不会被复制。如果有一些方法可以根据类似客户的领域向客户提出建议，那将是理想的；例如，如果我们有第二家比萨店注册，在他们的管理页面上定义字段可能会说类似的企业选择询问以下问题，并显示“样本”值列表。

这会是`Entity-Attribute-Value (EAV)`该表模型的良好候选者吗？传统的关系模型行不通，因为它会涉及许多称为“user1”之类的字段，这当然对于任何事情都非常笨拙。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-19T02:41:24.693

不，您描述的系统不需要 EAV，尽管您在下面看到的内容可能与 EAV 模型有一些共同的元素：

客户（clientId，clientName）

调查（surveyId，clientId）

RESPONDENT（respondentId、surveyId、respondentName、respondentEmail）

QUESTION（questionId、surveyId、questionText）例如“最喜欢的浇头”

选项（questionId，responseText）例如“anchovies”，“pepperoni”

响应（questionId、respondentId、responseText）

客户可以创建许多调查，每个调查可以有许多问题，有些带有建议的选项。RESPONDENT 对 SURVEY 做出回应，他们的回答均被记录为 RESPONSE。RESPONSE.responseText 可能匹配也可能不匹配给定的 OPTION.responseText，这取决于他们是否选择了选项或键入了自己的响应。

这只是一个示例，您可能需要在此模型上进行许多变体以满足您的特定要求。

# iphone - UITableView单元格刷新问题重新排列

> ID：840011
> 
> 赞同：5
> 
> 时间：2009-05-08T14:20:35.327
> 
> 标签：iphone, objective-c, uitableview, refresh

一些帮助将不胜感激！

我有一个自定义 UITableView 单元格，由一个图像（绿色、橙色或红色）和两个不同字体大小的标签组成。UITableView 由对象的 NSMutableArray 驱动。

UITableView 分为三个部分，第一部分包含所有带有红色图像的单元格，第二部分包含橙色，第三部分包含绿色。

我已经实现了在 UITableView 中重新排列单元格的功能，允许用户将带有红色图像的项目从红色部分拖到橙色部分。这种拖动效果很好，并且基础数据已正确更新。我知道是这种情况，因为如果我选择单元格，我会转到其详细视图并更新数据。

但是，直到我进入详细信息（或退出应用程序）并返回后，UITableView 才会更新！如果我将有问题的单元格滚动出视图并再次返回视图，它也会更新，因此数组显然包含正确的数据。我只是无法触发视图刷新！

在更改 moveRowAtIndexPath 中的基础数据的代码之后，我尝试了以下操作：

```
[self.tableView reloadData]; 
```

但是，这会导致异常。苹果语言参考实际上说在插入、删除或动画时不能调用 reloadData，这当然是我正在做的。此外，尝试只刷新单元格

```
[self setNeedsDisplay]; 
```

不起作用（尽管它也没有崩溃）。

关于如何刷新 UITableView 的任何想法？我找不到 afterMoveHasBeenCompleted: 方法或任何东西，所以如果我在 moveRowAtIndexPath: 方法期间无法调用 reloadData，那么我在哪里调用它？！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-11T11:57:17.133

知道了！！

我发现解决方案是延迟刷新代码，从而阻止它崩溃。

我将 reloadData 调用放入一个单独的方法中：

```
- (void)refreshDisplay:(UITableView *)tableView {
[tableView reloadData]; } 
```

然后以 0.5 秒的延迟调用它：

```
[self performSelector:(@selector(refreshDisplay:)) withObject:(tableView) afterDelay:0.5]; 
```

它没有崩溃，而是刷新了！0.5 秒的延迟几乎不明显，完全可以接受。

希望这对其他人有帮助！

谢谢

菲尔

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T00:08:19.163

查看 UITableViewDelegate 的参考资料。如果你为你的 UITableView 分配了一个委托，你可以使用它的方法来处理你的表格视图已经完成某些事情的通知。您可能会使用其中一种

```
tableView:didEndEditingRowAtIndexPath:
```

或者

```
tableView:targetIndexPathForMoveFromRowAtIndexPath:toProposedIndexPath:
```

来实现这一点。

# cocoa - 锁定一个nswindow的位置

> ID：840015
> 
> 赞同：4
> 
> 时间：2009-05-08T14:20:55.640
> 
> 标签：cocoa, nswindow

是否可以锁定nswindow的位置？我不是要 setIgnoresMouseEvents。我需要阻止用户移动窗口，但他应该仍然可以使用 nstoolbar。

提前谢谢--molter

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-06-23T01:33:33.313

我同意杰森的“正常”情况。但我认为在某些特殊情况下可以适当地做这样的事情。显然苹果也这么认为；从 10.6 开始 - 你需要做的就是调用 NSWindows'

```
- (void)setMovable:(BOOL)flag 
```

或覆盖

```
- (BOOL)isMovable; 
```

在您的 NSWindow 子类中更改窗口的可移动性。

如果这不可用，Quartz 事件服务 API（[文档](http://developer.apple.com/library/mac/#documentation/Carbon/Reference/QuartzEventServicesRef/Reference/reference.html)）提供了防止窗口移动的方法。一种方法是在用户开始拖动窗口时安装事件点击并操纵传入事件以仅包含初始鼠标按下位置而不是更新的（实际）位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-08T08:14:18.300

您应该听从 Jason 的建议并使用 kiosk 模式。请参阅此[技术说明](http://developer.apple.com/mac/library/technotes/KioskMode/Introduction/Introduction.html)。

# c++ - 高效的编码帮助

> ID：840023
> 
> 赞同：2
> 
> 时间：2009-05-08T14:22:37.443
> 
> 标签：c++, pointers

我目前正在用 C++ 编写代码来查找 6 个整数的所有可能排列并存储最佳排列（即总和最接近给定值的排列）。

我正在尝试尽可能高效地编写此代码，并会感谢任何建议或示例。

我正在考虑将整数存储在数组中，并在循环中使用指针执行排列。这是一个好方法吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-08T14:30:52.323

他们已经为你想到了这个：

```
#include <algorithm>

int ra[6] = { 1, 2, 3, 4, 5, 6 };

do {
    // whatever
} while (std::next_permutation(ra, ra+6)); 
```

请注意，元素必须以升序开始（通过 operator< 进行比较），否则循环将在您看到每个排列之前终止。有关详细信息，请参阅[http://en.cppreference.com/w/cpp/algorithm/next_permutation](http://en.cppreference.com/w/cpp/algorithm/next_permutation)。

它可能无法提供最快的运行时间，因为在每一步都必须检查数组以找出要更改的内容。但它肯定是程序员工作中最有效的，而且在不了解编译器和平台的情况下，无论如何都不可能对嵌套循环方法进行微优化。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T14:25:43.023

看看这篇出色的帖子[@Coding the Wheel](http://www.codingthewheel.com/) : [Exhaustively Enumerated Combinations and Permutations in Code](http://www.codingthewheel.com/archives/exhaustively-enumerating-combinations-and-permutations-in-code)。它有完整的代码，是由一个[SO'r](https://stackoverflow.com/users/90/coding-the-wheel)编写的，它应该足以让你走上正轨。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T14:41:07.900

假设重复的数字不是问题，有 n! n 个整数的排列（一次取 n 个）。因此，无论您做什么，您的算法都将具有阶乘时间行为（ O (n^n) ）。

换句话说，当 n 变大时，它会**变慢**。对不起。

在[排列维基百科](http://en.wikipedia.org/wiki/Permutation)页面上实际上有算法可以做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T14:53:11.193

> 我正在考虑将整数存储在数组中，并在循环中使用指针执行排列。这是一个好方法吗？

不，这不是一个好方法。与其交换指向数组中项的指针，不如交换数组中的项。指针只是一个额外的间接步骤，没有任何实际目的。

# asp.net - 加载 IEnumerable 收藏

> ID：840029
> 
> 赞同：1
> 
> 时间：2009-05-08T14:23:19.517
> 
> 标签：asp.net, xelement

```
XElement root = XElement.Load(xmlReader);

IEnumerable<XElment> items = root.Elements("?????????"); 
```

哪来的？？？是，我可以添加路径还是必须是单个 xml 元素名称？

IE。我可以做 /blah/blah2/asdf 吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T14:38:08.203

*？？？*应该是单个 xml 元素名称。

严格地说，`Elements()`方法接受一个`XName`参数。幸运的是，存在从`string`to的隐式转换`XName`。

```
XName name = "Book";
XName name2 = "{http://schemas.company.com/books}Book"; // XName with a namespace 
```

要选择*路径*，请使用`System.Xml.XPath`命名空间（`System.Xml.Linq`程序集）中的扩展方法：

```
IEnumerable<XElment> items = root.XPathSelectElements("Books/Author"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T14:29:42.560

不，Elements 扩展方法的参数需要是单个元素名称（实际上是 XName，但如果您不需要命名空间，只需将元素名称作为字符串传递），而不是 XPath。

如果要使用 XPath 选择 XElements，还有[一个扩展方法](http://msdn.microsoft.com/en-us/library/bb342176.aspx)。包括 System.Xml.XPath 并执行：

```
IEnumerable<XElement> items = root.XPathSelectElements("your/xpath"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T14:28:52.080

如果您尝试传递 XPath，您将生成此异常：

> System.Xml.dll 中出现“System.Xml.XmlException”类型的未处理异常
> 
> 附加信息：“/”字符，十六进制值 0x2F，不能包含在名称中。

您必须将元素名称作为字符串传递。该字符串被隐式转换为对字符串中[`XName`](http://msdn.microsoft.com/en-us/library/system.xml.linq.xname.aspx)可以和不能包含哪些字符有限制的类型（`/`、`<`、`>`等）。

# oracle - PL/SQL 过程参数中的类泛型行为

> ID：840040
> 
> 赞同：4
> 
> 时间：2009-05-08T14:25:40.247
> 
> 标签：oracle, generics, plsql, procedure

假设我在 PL/SQL 中定义了一些数据类型：

```
TYPE foo_t IS RECORD (...);
TYPE foo_table_t IS TABLE OF foo_t INDEX BY BINARY_INTEGER;

TYPE bar_t IS RECORD (...);
TYPE bar_table_t IS TABLE OF bar_t INDEX BY BINARY_INTEGER; 
```

我是否可以编写一个能够接受从 TABLE 派生的任何数据类型（例如 a`foo_table_t`或 a `bar_table_t`）作为参数的过程？该过程不需要知道表的行类型。一个简单的例子：

```
PROCEDURE remove_last(some_table ...) IS
BEGIN
    some_table.DELETE(some_table.LAST);
END; 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-08T16:11:07.807

不是直接的。来自 PL/SQL 程序员指南：

“实参及其对应的形参必须具有兼容的数据类型。”

PL/SQL 将实际参数数据类型隐式转换为形式参数数据类型。因此，您可以将数字值传递给需要字符串的过程，它会起作用，因为您可以进行隐式转换。

你能做的最好的就是编写重载过程：

程序通用（foo IN OUT foo_t）；

程序通用（bar IN OUT bar_t）；

然后您可以使用任一记录类型调用泛型。这与要处理的记录类型的数量成比例地失去吸引力:-D

# sql - 通过多个表进行高级 SQL 数据比较

> ID：840043
> 
> 赞同：2
> 
> 时间：2009-05-08T14:25:48.123
> 
> 标签：sql, synchronization, comparison

考虑下面的情况。
两个环境（DEV 和 TEST）中的两个表（A 和 B），这些表中有记录。
如果您查看表格的内容，您就会明白功能数据是相同的。
我的意思是，除了 PK 和 FK 值之外，Roger 这个名字还与水果和蔬菜有关。

## 在 DEV 环境中：

**表 A**
1 罗杰
2 凯文

**表 B**（斜体字段是表 A 的 FK）
1 *1*水果
2 *1*蔬菜
3 *2*肉

## 在测试环境中：

**表 A**
4 罗杰
5 凯文

**表 B**（斜体字段是表 A 的 FK）
7 *4*水果
8 *4*蔬菜
9 *5*肉类

我正在寻找一个 SQL 数据比较工具，它会告诉我在上述情况下没有区别。
或者，如果有，它将以正确的顺序生成插入和更新脚本（先插入 A 然后 B）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T08:45:20.757

我在红门上找到了这个：[http ://www.red-gate.com/messageboard/viewtopic.php?t=8401#top](http://www.red-gate.com/messageboard/viewtopic.php?t=8401#top)

我联系了他们，他们告诉我这个功能将在下一个版本的数据比较中实现。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-13T06:45:50.513

你也可以试试Devart 的[dbForge 数据比较](http://www.devart.com/dbforge/)。它允许您比较数据并设置您需要的操作的结果。看看它的性能和简单性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T14:31:59.170

我使用[SQL Compare](http://www.red-gate.com/products/SQL_Compare/index.htm)作为[Red Gate Software的](http://www.red-gate.com/)[SQL Toolbelt](http://www.red-gate.com/products/SQL_Professional_Toolbelt/index.htm)的一部分

我对它的性能和功能*非常*满意。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T14:33:33.347

大多数数据比较工具允许您忽略列；但是，您希望他们不要忽略 FK 列，而是确定 Test.TableA 的 4 等于 Dev.TableA 的 1，以便表 B 中的第一行相同。它是否正确？

我不知道有什么工具可以做到这一点。现在对于您的第二个问题，大多数数据比较工具都会以正确的顺序为您生成脚本。您可以查看 Redgate 的[数据比较](http://www.red-gate.com/products/SQL_Data_Compare/index.htm)。

如果您有 Visual Studio 开发人员版，它会附带一个数据比较工具（可作为单独安装提供，称为 Visual Studio 数据库版）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T14:48:41.017

我有一个存储过程，可以比较任何两个表。事实证明，这也适用于视图。所以我可以比较两个视图，每个视图都返回一个“扁平化”版本的模式。我可以省略诸如标识/代理键之类的列，也可以指示我的 proc 忽略它们。

至于插入，我不确定。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-04-29T21:51:17.327

[使用SqlDiffFramework](https://github.com/msorens/SqlDiffFramework)可以直接找到任何差异，这是一个用于数据源的可视差异程序（而不是像典型差异程序那样的*文件）。*顾名思义，它是一个框架：您必须向它提供两个查询以进行比较，一个用于您的 DEV 环境，一个用于您的 TEST 环境。在您的特定情况下，查询将是相同的，例如：

```
SELECT A.person, B.foodgroup
FROM A JOIN B on A.IdPerson = B.IdPerson
ORDER BY A.person, B.foodgroup 
```

SqlDiffFramework 在一个窗口中提供了两个并排的查询工具。您只需将一侧指向您的 DEV 数据库，另一侧指向您的 TEST 数据库，然后运行这两个查询来获取和比较数据。（您甚至可以保存快照，然后在您选择的快照上运行差异，以查看差异（如果有）如何随着时间的推移而出现。）

但是请注意，SqlDiffFramework*没有*解决您请求的第二部分，即生成脚本以使它们匹配。

[SqlDiffFramework，版本 1.0，于 2010.04.29 推出，开源且免费提供。]

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-05-13T19:26:01.960

试试[SQL 数据检查器](http://www.sqlaccessories.com/SQL_Data_Examiner/)。我喜欢这个工具。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-02-07T04:52:45.180

如果您使用的是 sql server 2008，您可以使用合并语句，它会根据您想要执行的操作插入更新或删除。

# iphone - 设置新视图的 UIImage 并显示

> ID：840045
> 
> 赞同：0
> 
> 时间：2009-05-08T14:26:29.807
> 
> 标签：iphone, cocoa-touch, image, view, uiimageview

我正在尝试设置新视图的图像。我设置控制器的图像，然后显示视图。但是在控制器的 viewDidLoad 中，没有可用的图像。

```
- (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingImage:(UIImage *)image editingInfo:(NSDictionary *)editingInfo {

EditPictureSaveViewController *editPictureController = [EditPictureSaveViewController alloc];

[editPictureController initWithNibName:@"EditPictureSaveView" bundle:[NSBundle mainBundle]];

UIImageView *imageView = [ [ UIImageView alloc ] initWithImage: image ];
[imageView setImage:image];
[editPictureController setPreview:imageView];

[self.navigationController pushViewController:editPictureController animated:YES]; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T14:37:07.690

那是因为 viewDidLoad 被调用

```
[editPictureController initWithNibName:@"EditPictureSaveView" bundle:[NSBundle mainBundle]]; 
```

加载NIB后。

editPictureController 的图像属性（我假设它是 UIImageView - 令人困惑！）在此之后才设置。

改为在 viewWillAppear: 方法中的 viewDidLoad 中执行您正在执行的任何操作 - 当 pushViewController:animated: 调用 viewWillAppear: 时将设置您的图像属性。

# sharepoint-2007 - 自定义表单上的 SharePoint 2007 附件

> ID：840048
> 
> 赞同：1
> 
> 时间：2009-05-08T14:27:22.003
> 
> 标签：sharepoint-2007, sharepoint-designer

基本上，我需要为 SharePoint 列表自定义 NewForm.aspx 页面。我还需要让附件功能继续工作。目标环境没有应用必要的更新来使其正常工作（而且这似乎不太可能改变。言语无法表达这是多么令人沮丧：-（）

有谁知道如何解决这个问题，以便附件可以在自定义表单上工作？可能吗？欢迎任何建议。到目前为止，我发现的所有内容都承认了这个问题，但没有提供除应用更新之外的其他解决方案。

**更新：**使用 jQuery 将适当的元素从隐藏表单移动到自定义表单中，我已经克服了与表单元素被隐藏或不接受焦点的类型有关的初始 javascript 错误。该表单现在看起来可以正常工作，但如果您单击“确定”保存到列表，则不会保存附件。有没有办法解决这个问题？

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-07-23T14:51:58.857

简而言之，如果不安装一些更新，就无法修复错误，尽管其中一个可以“静默”安装。另一种方法是放弃 Sharepoint Designer 并使用自定义模板。

首先，艾莉森指出的帖子不起作用，尽管作者从未费心删除它。不仅仅是自定义表单缺少正确的标签，它使用的 SPDataSource 对象也被破坏并且从不存储附件数据，即使您添加了缺少的标签也是如此。

2008 年 4 月，MS Support 提出了一个可用的解决方法，Marc Davis 在这篇[文章](http://cid-6d5649bcab6a7f93.spaces.live.com/blog/cns!6D5649BCAB6A7F93!130.entry)中进行了描述。该帖子包含指向替换 SPDataSource dll 的链接。没有它，您将无法修复错误。

这个错误最终在 2008 年 12 月通过独立的修补程序得到了[修复](http://support.microsoft.com/kb/960311/en-us)。这最终在[2008 年 12 月的累积更新](http://support.microsoft.com/kb/960709/en-us)中汇总。

显然，即使是解决方法也需要 Temple 安装一些额外的二进制文件。唯一的选择是放弃使用 Sharepoint Designer 自定义表单并创建[自定义模板](http://weblogs.asp.net/sharadkumar/archive/2008/07/07/how-to-customize-rendering-of-sharepoint-list-form-fields-part-1.aspx)。自定义模板本质上是一个 ASCX 控件，它允许您使用所有传统的 ASP.NET 技术来实现您想要的结果。它确实需要一些工作才能让它工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-20T14:05:57.857

此页面有一个潜在的解决方法，不涉及应用任何更新。您应该能够通过 SharePoint Designer 处理所有事情：http: [//msmvps.com/blogs/obts/archive/2007/04/14/802759.aspx](http://msmvps.com/blogs/obts/archive/2007/04/14/802759.aspx)

# javascript - 什么是良好的独立于浏览器的 JavaScript 编程环境？

> ID：840050
> 
> 赞同：4
> 
> 时间：2009-05-08T14:27:41.723
> 
> 标签：javascript, debugging, tdd, development-environment

我的团队当前的项目涉及用 JavaScript 重写检索库。我们基本上是在寻找一种设置，使我们能够应用测试驱动的开发方法。

到目前为止，我们计划使用 Vim 编写代码，没有花哨的 IDE。为了生成输出，我们将使用 Spidermonkey 的 shell 环境。JSLint 可以作为一个适度的语法检查工具。

基本问题仍然存在：您如何开发 JavaScript（独立于浏览器）程序？如果我们已经走在正确的轨道上，那么也许您可以为我们提供一些提示和技巧。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T14:53:40.880

您可以在 Spidermonkey 或[Rhino](http://www.mozilla.org/rhino/)（Java 中较旧的 JS 解释器）中测试您的代码，但在您测试脚本之前，您不会真正知道它适用于哪些浏览器！

我同意较早的海报，使用像 jQuery 这样的独立于浏览器的库可能是一个好主意。

我没有使用过 Spidermonkey，但我知道 Rhino 有一个很好的调试 GUI，允许进行通常的操作：设置断点、监视和单步执行代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T14:31:43.257

如果你有机会重写它，你可能会考虑使用 jQuery。

它本质上与浏览器无关。或者至少它比普通的 javascript 需要更少的对象嗅探。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T14:35:52.640

只有测试你才会使你的 JavaScript 代码独立于浏览器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T16:19:09.770

是的，我正在使用相同的环境来开发独立的 JS 应用程序（vim + SpiderMonkey）。我只想加起来，我已经制作了小型浏览器内 IDE，用于在服务器端读取/写入/启动 JS 脚本。有时它非常有帮助。另外，我正在寻找使用[WXJavascript](http://www.wxjavascript.net/)的项目，这似乎很有希望。

# multithreading - Server.Transfer 和 System.Threading.ThreadAbortException

> ID：840052
> 
> 赞同：1
> 
> 时间：2009-05-08T14:28:09.333
> 
> 标签：multithreading, exception, server.transfer

请参阅[http://support.microsoft.com/kb/312629/EN-US/](http://support.microsoft.com/kb/312629/EN-US/)

我也在我的应用程序中使用 reponse.direct 并且我没有遇到异常。知识库文章建议的解决方法（Server.Execute）对我不起作用。如果我使用 Server.Execute，我会从目标页面上的 Ajax Toolkit 获得很多 javascript 异常，但我没有深入研究原因。

我的问题-您认为反对将例外视为“已知限制”并继续前进的论据是什么？

我在这个非常特殊的情况下使用 Server.Transfer 的原因是我想屏蔽实际正在执行的页面的（真实）目标 url。它工作得很好，除了这个异常（用户永远不会看到）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T15:28:34.230

确保您没有在异常处理程序（try..catch/finally）中调用 Server.Transfer()。

**编辑：**

Server.Transfer 总是在完成时引发 ThreadAbortException。如果将其包装在异常处理程序中，则应捕获显式异常类型，而不仅仅是“异常”。

请参阅[MSDN](http://msdn.microsoft.com/en-us/library/y4k58xk7.aspx)上的 Server.Transfer 帮助。这是有关[ThreadAbortException的信息](http://msdn.microsoft.com/en-us/library/system.threading.threadabortexception.aspx)

# java - 将 Apache 重定向到 Tomcat - 在应用程序中导航时出现 IllegalStateException

> ID：840054
> 
> 赞同：2
> 
> 时间：2009-05-08T14:28:11.550
> 
> 标签：java, apache, jsp, tomcat, redirect

我在 Windows XP 上使用 Apache 2.2 和 Tomcat 6.0.18。我已启用 mod_proxy 模块以将流量从我的 Apache Web 服务器重定向到 Tomcat。我只更新了 httpd.conf 文件以进行如下重定向：

```
ProxyPass         /myapp  http://MYMACHINENAME:8080/MyApp/Start
ProxyPassReverse  /myapp  http://MYMACHINENAME:8080/MyApp/Start 
```

我遇到的问题是初始重定向工作正常，JSP 页面正确呈现。当我尝试通过单击页面上的菜单导航到不同的 JSP 页面时，出现异常：

```
SEVERE: Servlet.service() for servlet StartIntro threw exception
java.lang.IllegalStateException
    at org.apache.catalina.connector.ResponseFacade.sendRedirect(ResponseFacade.java:435)
    at StartIntro.doPost(StartIntro.java:103)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:637)
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)
    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:286)
    at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:845)
    at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)
    at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:447)
    at java.lang.Thread.run(Thread.java:595) 
```

如果我不从 Apache 进行任何重定向，则导航工作正常。

有什么我应该研究的想法吗？

TIA，马格努斯·拉西

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-11-19T01:32:43.890

虽然这是一个被[社区](https://stackoverflow.com/users/-1/community)戳的老话题，但我会发表我的想法：

```
java.lang.IllegalStateException
    at org.apache.catalina.connector.ResponseFacade.sendRedirect(ResponseFacade.java:435)
    at StartIntro.doPost(StartIntro.java:103) 
```

如果其中的某些`StartIntro#doPost()`内容已经提交了响应，则可能会发生这种情况。当满足以下情况之一时，将提交响应：

1.  之前已经设置了响应标头。
2.  A `forward()`or`include()`之前已经在相同的响应上调用过。
3.  超过 2KB 的数据被写入响应。
4.  少于 2KB 被写入并被`flush()`调用。

我会仔细检查`StartIntro#doPost()`所有这些都在做什么。提到的 2KB 是依赖于应用服务器的，但对于 Tomcat，它可以配置为 HTTP 连接器的缓冲区大小。

我要补充一点，初学者的一个常见错误是他们认为 a`forward()`或 a的调用`sendRedirect()`会神奇地退出并“跳”出方法块，从而忽略代码的残余。例如：

```
protected void doPost() {
    if (someCondition) {
        forward();
    }
    redirect(); // This is STILL invoked when someCondition is true!
} 
```

因此这实际上是不正确的。要解决此问题，您需要`return;`在块的末尾添加一条语句，或者为调用`if`引入一个`else`块。`redirect()`

希望这些信息有助于确定根本原因。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-07-12T17:23:27.960

使用 Apache 2.2 和 Tomcat 6.0.18 支持的 AJP 代理。

如果尚未安装，则需要为 apache 安装 mod_proxy_ajp，并确保将 tomcat 配置为侦听 ajp 连接（检查 server.xml）。

默认情况下，Tomcat 6.0.18 在端口 8009 中侦听 AJP 连接。

然后你需要在你的 httpd.conf 中添加这样的东西

```
 <Proxy *>
     AddDefaultCharset Off
     Order deny,allow
     Allow from all
   </Proxy>

   ProxyPass /yoururl ajp://ip.for.tomcat.server:8009/yoururl
   ProxyPassReverse /yoururl ajp://ip.for.tomcat.server:8009/yoururl 
```

然后你可以去[http://apachehost/yoururl](http://apachehost/yoururl)并且所有的重定向都应该是透明的。此外，html 代理更有效，因为 ajp 是更底层的协议。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-05-08T08:18:57.590

您已经提交了响应，然后您可能正在通过 List 或 JSON 向 JSP 写入数据。如果您正在重定向到同一个 JSP 并且您将 STRING 作为“成功”返回，那么就会发生此异常。因为通过 STRUTS@ 返回 SUCCESS 会提交您的响应，并且它不允许将任何进一步的数据发布到您的 JSP。

解决方案：您需要做的就是返回 NULL 并重定向到同一个 JSP 页面。希望对您有所帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-25T10:52:01.403

您可以使用 ProxySet 指令：

```
ProxySet ajp://mymachine:7001 <parameters> 
```

在[Apache 文档中查看更多信息](http://httpd.apache.org/docs/2.2/mod/mod_proxy.html#proxyset)

# asp.net - 使用 JavaScript 显示页面加载进度

> ID：840056
> 
> 赞同：2
> 
> 时间：2009-05-08T14:28:24.607
> 
> 标签：asp.net, javascript, jquery, download

我正在从 Web 服务中检索文件列表并将它们显示为链接。当有人点击链接时，文件应该开始下载。问题是不存在对该文件的直接访问。以下是下载文件的过程：

1.  用户点击链接
2.  服务器调用 Web 服务来检索文件
3.  浏览器加载的时间与从 Web 服务恢复文件所需的时间一样长
4.  浏览器最终提供文件给用户下载

为了解决在下载开始之前必须等待 Web 服务的不利用户体验，我想在单击链接时显示“正在加载...”反馈对话框，并在文件准备好时让对话框消失.

我正在使用 jQuery，并且一直在尝试向页面添加 iframe 以加载文件，但我遇到的问题是我不知道如何确定文件是否已准备好。

我正在寻找提示，不仅在客户端提供充足的反馈，而且可能也在服务器端（使用 ASP.Net），以防万一我可以做一些事情来简化流程。谢谢你。

**更新**：澄清一下，这是为了将文件下载到用户的机器上。我特别寻找的是一种确定文件何时可以下载的方法。因此，当上述第 4 步发生时，我想删除“正在加载...”消息。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T16:49:23.690

听起来您需要在您的服务器上公开一个新的请求 URL，其唯一的工作是回复 web-service-retrieval 是否已完成（或者如果没有，它已经完成了多远）。

让 AJAX 每隔几秒钟轮询一次该服务，并在它回复文件已准备好时删除“正在加载...”消息。

客户端应该发送会话 ID（也可能是文件 ID），以便服务器知道正在询问哪个文件。服务器端需要能够联系正在运行的 web-service-retrieval 进程/线程来询问它已经走了多远。（如果它找不到线程那么大概它已经完成了。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T14:31:26.830

您可以在 jquery 中使用 $.ajax 函数的完整选项，该选项应在请求完成时调用

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T14:38:10.433

您可以让**jQuery**等待点击链接，并在点击链接时显示显示加载消息。

显示如何[“加载 - 请稍候”消息显示脚本的](http://rainbow.arch.scriptmania.com/scripts/preload_wait.html)示例，您可以遵循该脚本。

**编辑-**

基本上你想要一个进度条监视器，我从未见过它只用 javascript 完成，但用 flash 或 ajax 完成。

这是一个应该有所帮助的[文件上传演示。](http://www.bennadel.com/blog/1244-ColdFusion-jQuery-And-AJAX-File-Upload-Demo.htm)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T14:52:04.830

如果您要链接到抓取文件并将其写回流的 ASHX，您可以修改链接单击事件以显示消息。

```
$(function () {
  $("a.someClass").click(function () {
    $("div.message").fadeIn();  // show a loading message
    return true; // make sure the link still gets followed
  });
}); 
```

在等待 ASHX 写回响应时，加载消息可以只是一个微调器或其他东西。

**编辑：**由于您没有直接链接到 ASHX：

```
$(function () {
  var ashxCallback = function (data, textStatus) {
    // data could be: xmlDoc, jsonObj, html, text, etc...
    this; // the options for this ajax request
    // textStatus can be one of: "timeout", "error", "notmodified", "success", "parsererror" 
    alert(textStatus);
  };

  $("a.someClass").click(function () {
    $("div.message").fadeIn();  // show a loading message
    $.get("some.ashx?id=1234", "", ashxCallback);
    return false;
  });
}); 
```

使用[jQuery.get()](http://docs.jquery.com/Ajax/jQuery.get#urldatacallbacktype)和[jQuery.post()](http://docs.jquery.com/Ajax/jQuery.post#urldatacallbacktype)。

**编辑＃2：**我只是有另一个想法。如果 Loading... 消息在重定向到文件的 iframe 中怎么办？因此，您将使用 jQuery 显示 iframe，它会显示默认消息 Loading... 和一个小微调器动画，然后将 iframe 的 src/location 设置为永远加载的 ASHX。然后，您可以从 iframe 的父页面为其提供一个 onload 处理程序，该处理程序将隐藏/删除它。如果您需要示例代码，请告诉我。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T16:07:21.203

如果准备文件的时间少于 AJAX 请求的默认超时，您可以启动 AJAX 请求，向用户显示“正在加载...”消息。AJAX 调用然后检查文件的可用性，当它变得可用时 - 返回消息（成功与否）并提供文件的链接。AJAX 请求甚至可以进行文件下载，但这是您的选择。

# visual-studio - 如何更改 csharp 项目（visual studio / msbuild 机器）中的源文件编码？

> ID：840065
> 
> 赞同：61
> 
> 时间：2009-05-08T14:30:00.360
> 
> 标签：visual-studio, encoding, utf-8, localization

有没有办法强制 VS 总是使用 Unicode，而不是奇怪的 ISO 东西？

我正在使用 Visual Studio 2008 on Vista（波兰语语言环境）开发一个 winapp csproject。当我在 Win Server 2003（英语语言环境）上构建项目时出现问题 - 然后波兰变音符号消失了。

我调查该问题是由不正确的源文件编码引起的。看起来源文件没有使用 UTF-8 编码。

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2009-05-08T14:32:58.857

问题：从命令行启动的编译器无法处理源文件，因为我刚刚添加了国际字符。

解决方案：以 UTF-8 编码显式保存源文件以保留国际字符。

如何：

*   在 Visual Studio 中打开有问题的文件。
*   在文件菜单上点击“高级保存选项”</li>
*   从“编码”组合中选择“Unicode (UTF-8 ...”</li>
*   单击确定。

你准备好了。承诺取悦构建服务器和等待绿色的团队其他成员。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2018-11-12T09:28:32.073

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-10-27T19:03:27.160

我在 VS2015 vb.net 项目中遇到了同样的问题，并通过`<CodePage>1250</CodePage>`在 vbproj/csproj 文件中添加标记来解决它。我在`<SchemaVersion>`标记后做了它，重建了项目，它对我有用。我在使用 ż,ą 等波兰语字母时遇到了问题。您也可以尝试使用 UTF-8 - 65001，但我没有检查它是否有效。

# silverlight-3.0 - Silverlight (3.0) - 数据网格 - 用户通过数据网格添加数据

> ID：840068
> 
> 赞同：4
> 
> 时间：2009-05-08T14:30:50.983
> 
> 标签：silverlight-3.0, datagrid

我只使用 Silverlight 超过 24 小时。所以我仍然在寻找我的脚。

我目前正在使用 Silverlight 3（测试版）（我需要其出色的离线模式功能）

使用绑定到数据源的数据网格时，用户是否可以通过网格添加数据？还是数据网格仅限于显示和编辑来自绑定数据源的数据？

非常感谢卢克

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T17:25:44.087

除非最近发生了变化，否则您需要自己将新行添加到数据源。看看这篇描述这个过程的帖子：

[http://weblogs.asp.net/manishdalal/archive/2008/08/25/silverlight-business-application-part-1-add-new-item.aspx](http://weblogs.asp.net/manishdalal/archive/2008/08/25/silverlight-business-application-part-1-add-new-item.aspx)

# javascript - 当您有多个表单时，IE8 不会在输入时提交

> ID：840070
> 
> 赞同：2
> 
> 时间：2009-05-08T14:31:07.690
> 
> 标签：javascript, html, css, internet-explorer-8

如果您有 3 个表单（如下所示）并且您将其中两个表单设置为不显示（display:none;）并且您使用 javascript 来切换每个表单，当您将它们设置为隐藏时，这些表单设置为可见和您尝试按 Enter 提交表单，它不会提交。

如果默认情况下第一个表单可见，则将提交的唯一表单。

这适用于 ie7 和 ie6，但不适用于 ie8（如图）

我正在使用 jquery 来隐藏和显示我的表单，但这应该不是问题。我也尝试过使用不同的 css 规则（如可见性：隐藏），但仍然是同样的问题；

```
<a href="" onclick="$('#form1').show();$('#form2').hide();$('#form3').hide();">form1</a>
  <a href="" onclick="$('#form1').hide();$('#form2').show();$('#form3').hide();">form2</a>
  <a href="" onclick="$('#form1').hide();$('#form2').show();$('#form3').hide();">form3</a> 

<div id="form1">
      <form method="get"  action="test1/" >
        <input type="text" name="text1" id="text1" />
        <input type="text" name="text2" id="text2" />
        <input type="text" name="text3" id="text3" />
        <input type="submit" name="submit1"  value="submit1"/>
      </form>
  </div>

<div id="form2" >
<form method="get" action="test2/" style="display:none" >
<input type="text" name="text4" id="text4" />
<input type="text" name="text5" id="text5" />
<input type="text" name="text6" id="text6" />
<input type="submit" name="submit2"  value="submit2"/>
</form>
</div>

<div id="form3" >
  <form method="get" action="test3/" style="display:none" >
      <input type="text" name="text7" id="text7" />
      <input type="text" name="text8" id="text8" />
      <input type="text" name="text9" id="text9" />
      <input type="submit" name="submit3"  value="submit3"/>
  </form>
</div> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T21:59:43.883

恐怕我这里没有 IE 8 可供测试，但您可以尝试不同的 CSS 属性作为解决方法：

```
<style type="text/css">
.hide {
    position: absolute;
    top: -9999px;
    left: -9999px;
}
</style>

<a href="" onclick="$('#form1').removeClass('hide');$('#form2').addClass('hide');$('#form3').removeClass('hide');">form1</a>
<a href="" onclick="$('#form1').addClass('hide');$('#form2').removeClass('hide');$('#form3').addClass('hide');">form2</a>
<a href="" onclick="$('#form1').addClass('hide');$('#form2').removeClass('hide');$('#form3').addClass('hide');">form3</a> 
```

这将具有与 相同的视觉效果`display: none;`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T17:28:02.757

我看到你正在使用 jQuery - 你可能会做一些类似的事情

```
$(function() {  // execute when document ready
  $("input").keyup(function(e) {
    if (e.keyCode==13) { // enter 
      var form = $(this).parents("form").get(0); // first <form> tag that is a parent.
      if (form) form.submit();
      return e.preventDefault(); // stop it from activating in other browsers.
    }
  });
}); 
```

这应该确保当您点击输入时表单提交。

# asp.net - 从另一台机器上的 asp.net 应用程序连接到分析服务时出错

> ID：840075
> 
> 赞同：0
> 
> 时间：2009-05-08T14:31:45.393
> 
> 标签：asp.net, vb.net, ssas

我的任务是让 asp.net (vb.net) 与我们生产服务器上的分析服务引擎对话。Web 服务器是独立于 Web 服务器的机器。Web 服务器以 IUSR_ 用户身份运行。该应用程序（当然）在同时具有 IIS 和分析服务的开发机器上工作。我看到的问题似乎是权限错误（由 asp.net 应用程序在浏览器中返回）：

```
An existing connection was forcibly closed by the remote host .... 
```

它在这里的类似帖子中进行了描述：[http ://www.mydatabasesupport.com/forums/sqlserver-olap/201903-existing-connection-forcibly-closed-remote-host.html](http://www.mydatabasesupport.com/forums/sqlserver-olap/201903-existing-connection-forcibly-closed-remote-host.html)

我不是系统管理员，也不是分析服务专家（你问我为什么要负责这个任务？因为其他人无法让它工作并且它已经落在了我身上）。无论如何，我可以使用一些帮助......我已经尝试创建用户（IUSR_）并将其添加到sql server并将该用户添加到角色中。虽然这在我的本地机器上工作，但它在我们的生产环境中不起作用，其中 sql 和 web 服务器是分开的。

蒂亚，唐

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T18:19:11.760

经过一番摆弄后，我想出了一些可行的方法。它可能不是一个巨大的安全问题，因为该服务器对公共互联网不可见；它只对几个 iis 服务器可见（它不在我们的局域网上） - 然而，这是一个“蛮力”、不安全的解决方案（无论如何在某些环境中）......

1.  在 IIS 服务器上：将此添加到 web 配置中的连接字符串中：SSPI=anonymous; 这会打开未经身份验证的访问请求。
2.  在 SQL SERVER 上：在分析服务中，右键单击服务器。在“一般”下靠近底部到“Security\RequireClientAuthentication”并将其更改为 False
3.  在同一页面，选择左侧的“安全”（而不是一般）。将“匿名登录”添加到用户列表
4.  离开服务器属性。右键单击多维数据集中的 CubeViewer 角色并选择属性。将匿名登录添加到用户列表中。

所以，我可以从我们的 iis 服务器未经身份验证访问 sql 服务器。

我仍然有兴趣看到更安全的解决方案 - 哦，我忘了提到，没有域......这是同一子网上的两台服务器，只有常规登录。

# drawing - 在网站上绘制面板？

> ID：840078
> 
> 赞同：2
> 
> 时间：2009-05-08T14:32:01.573
> 
> 标签：drawing

在网页中制作绘图面板的最佳方法是什么。我想知道如何开发一些非常简单的东西，例如用户可以在其中绘制签名的小面板。

这是一个很好的例子[drawhere.com](http://drawhere.com)，但我需要一些更简单的方法。谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T14:42:21.047

最简单的方法可能是使用`<canvas>`标签和一些 JavaScript。[这](http://www.damonkohler.com/2008/12/javascript-painting-with-canvas.html)是一个非常简单的示例，可以帮助您入门。您可以为圆圈、框等添加更多功能。

我敢肯定有人已经制作了类似的东西，你可以使用，但我找不到任何东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T14:52:13.160

虽然 Zifre 的回答在某种意义上是有效的，但我会非常厌倦 <canvas> 标签，至少目前，因为它没有很好的支持（因为许多浏览器还没有完全支持 HTML5）。

一些浏览器支持它（最显着的是 Firefox 和任何在 Webkit 上运行的东西），但其他一些浏览器不支持（尤其是旧浏览器）。最好选择一个*更*通用的解决方案（尽管绝不是完全通用的），并使用Flash之*类的东西。*

# java - Java Web 应用程序的基于日期的许可逻辑？

> ID：840080
> 
> 赞同：1
> 
> 时间：2009-05-08T14:32:32.397
> 
> 标签：java, web-applications, licensing

我正在尝试为 Java Web 应用程序提出基于日期的许可机制的逻辑。该应用程序需要部署在可能无法访问 Internet 的客户端站点中（部署在 Intranet 上）。在这种情况下，我如何建立基于开始/结束日期的许可机制。如果我为此使用服务器系统日期/时间，我冒着系统管理员更改服务器日期/时间的风险，以保持 locense 处于活动状态。有什么建议么？Windows dektop 应用程序似乎可以做到这一点，不知道怎么做？

桑杰。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T17:18:09.473

嗯，我认为如果规则是： (a) 许可必须基于开始和结束日期；(b) 不能假设计算机与外界相连，那么我认为这个问题甚至在理论上都无法解决。您唯一的日期来源将是计算机本身的某个日期，系统日期或用户输入的其他日期。也许我遗漏了一些东西，但我不明白它如何不受用户谎报日期的影响。我的意思是，如果计算机没有连接到外部世界，那么根据定义，就没有外部资源来验证日期。你可以像 Joeytwiddle 的建议那样对日期进行合理性检查，记录你以前见过的日期并寻找任何可疑的东西，比如日期倒退，或者最后 6000 次运行的日期是同一天或其他。除此之外，这听起来像是一个圈子或找到一个诚实的政治家的问题：这是不可能的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T15:18:00.230

通过让您的应用记录上次运行的时间来检测系统日期的任何变化。如果它启动并发现它是在未来最后一次运行，你可以怀疑犯规！

当然，如果用户可以找到 lastRunDate 数字的存储位置，他们就可以绕过它。编辑：如果用户真的注意到他的机器的日期是错误的并更改它，它也可能被错误触发。如果您不使用世界时，请不要忘记夏令时更改（为有效日期更改留出一两个小时的灵活性）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T14:51:02.337

一个可能的解决方案：

您将定期向您的客户发出一对匹配的密钥和一个密钥验证类。服务器应用程序应检查验证类，至少在启动时，或定期使用 JVM 时间。

您还需要为您的客户提供一种简单的方式来获得更新的密钥/验证程序。

归根结底，鉴于可以检查和操作 java 类文件，这仍然不是一个完整的证明机制，但它确实提供了一个不依赖于主机机制的临时许可方案。

# c++ - 浮点错误 -1.#J 是什么意思？

> ID：840081
> 
> 赞同：14
> 
> 时间：2009-05-08T14:32:48.170
> 
> 标签：c++, c, floating-point, printf

最近，有时（很少）当我们从应用程序导出数据时，导出日志包含看起来像“-1.#J”的浮点值。我无法重现它，所以我不知道浮点数在二进制中的样子，或者 Visual Studio 如何显示它。

我尝试查看 printf 的源代码，但没有找到任何东西（虽然不是 100% 确定我查看了正确的版本......）。

我试过谷歌搜索，但谷歌似乎丢弃了任何#。而且我找不到任何浮动错误列表。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-05-08T15:27:09.100

它可以是负无穷大或 NaN（不是数字）。由于字段 printf 的格式不区分它们。

我在 Visual Studio 2008 中尝试了以下代码：

```
double a = 0.0;
printf("%.3g\n", 1.0 / a);  // +inf
printf("%.3g\n", -1.0 / a); // -inf
printf("%.3g\n", a / a);    //  NaN 
```

这导致以下输出：

```
1.#J
-1.#J
-1.#J 
```

删除 .3 格式说明符给出：

```
1.#INF
-1.#INF
-1.#IND 
```

所以很明显 0/0 给出 NaN 而 -1/0 给出负无穷大（如果我没记错的话，NaN、-inf 和 +inf 是唯一的“错误”浮点数）

# c# - 为 Crystal Reports 中的参数分配多个值

> ID：840085
> 
> 赞同：6
> 
> 时间：2009-05-08T14:33:43.377
> 
> 标签：c#, .net, crystal-reports

我在报告中添加了一个参数，并选中了“允许多个值”选项。

这是一个状态列（IE、Proposed、In Progress、Completed、Canceled），我希望用户能够选择报告哪些（以及多少个）不同的 OrderStatus。

我通常如何设置参数是：

```
report.SetParameterValue("@dtBegin", dtBegin.DateTime); 
```

我试图为多个值做的是这样的：

```
//pseudo loop
foreach(int intOrderStatus in intSelectedOrderStatuses)
{
    report.Parameter_OrderStatus.CurrentValues.AddValue(intOrderStatus);
} 
```

我检查过它确实将值添加到 OrderStatus 参数，但是当报表运行时，CrystalReports 对话框弹出并要求我输入 OrderStatus 参数的值。所以似乎这些值没有“提交”到参数。我已经进行了多次搜索，但无法弄清楚为什么它不起作用。

谢谢，

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-08T20:48:34.320

只需使用整数数组设置参数值。

```
report.SetParameterValue("@OrderStatus", new int[]{1,2,3}); 
```

在选择专家中，您将使用*in*运算符。

```
{table.order_status_id} in {?@OrderStatus} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-27T06:39:31.373

您可以做的是，制作一个普通的参数字段，即没有多个值，只有离散值 true，您需要传递的只是 1、2、3、4。“，”是分隔符，使用您认为适合您的分隔符，然后在记录选择公式中简单地输入

```
{table.order_status_id} in split({@OrderStatus}, ",") 
```

您需要从页面传递的只是字符串 1,2,3,4，它应该可以工作

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T14:42:23.420

您是否在 Crystal Reports 参数选项中将参数设置为隐藏？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-22T16:53:35.030

我没有尝试过，但我认为您应该能够将 intOrderStatus 添加到 ParameterDiscreteValue 或 ParameterRangeValue 并将其传递给 Parameter_OrderStatus.CurrentValues 而不是 intOrderStatus。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-12-09T11:48:48.913

那么我有同样的问题。解决方法非常简单。不要在参数后添加数据源。例如

```
report.SetParameterValue("@dtBegin", dtBegin.DateTime);
report.SetParameterValue("@dtBegin2", dtBegin.DateTime1);
//Note datasource is assigned after parameters
report.SetDatasource(dataset); 
```

水晶报表会在将数据源应用到报表之前刷新参数。下面是不弹出离散对话框

```
//Note Datasource is applied before parameters
report.SetDatasource(dataset);
report.SetParameterValue("@dtBegin", dtBegin.DateTime);
report.SetParameterValue("@dtBegin2", dtBegin.DateTime1); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-10-24T16:25:26.260

以下在*Crystal Reports*版本*13.0.20*中进行了测试：

**1）**在`Parameter Fields`部分添加新参数如下：

```
Name: ParamMultipleOrderStatus
Type: Number
Value Options: 
    Allow multiple values: true 
```

**2）**在Crystal Reports中选择`Select Expert Record ...`，代码可能是这样的（使用`=`运算符）：

```
{Orders.OrderStatus} = {?ParamMultipleOrderStatus} 
```

**3）**使用以下代码：

```
foreach (int intOrderStatus in intSelectedOrderStatuses)
{
    report.ParameterFields["ParamMultipleOrderStatus"].CurrentValues.AddValue(intOrderStatus);
} 
```

# javascript - 如何使用 Javascript 加载 XML 文件内容？

> ID：840088
> 
> 赞同：8
> 
> 时间：2009-05-08T14:34:12.207
> 
> 标签：javascript, html, xml, xmlhttprequest

我正在寻找一种将 XML 文件的内容直接加载到 Javascript 变量中的方法。假设我有以下目录结构：

```
/index.html
/loader.js
/file.xml 
```

在`index.html`中，有一个`<body>`标签，其内容应替换为 XML 文件的内容。因此，如果 XML 文件包含：

```
<element>
    <item>Item One</item>
    <item>Item Two</item>
</element> 
```

然后在动态加载之后，HTML 将是：

```
...
<body>
<element>
...
</element>
</body>
... 
```

我的问题是，我可以使用什么函数`loader.js`将内容直接加载到变量中？我使用过 XmlHttpRequests 和 ActiveX XMLDOM 解析器，但它们都只是给了我一个结构化数据模型，然后我必须对其进行排序以找到我的元素。我不需要解析任何东西，我只想获取所有文件内容。

**注意：**仅 HTML/Javascript，没有服务器端代码。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T14:44:57.983

我想我可能已经想通了。以下似乎工作得很好：

```
function loadFileToElement(filename, elementId)
{
    var xmlHTTP = new XMLHttpRequest();
    try
    {
    xmlHTTP.open("GET", filename, false);
    xmlHTTP.send(null);
    }
    catch (e) {
        window.alert("Unable to load the requested file.");
        return;
    }

    document.getElementById(elementId).innerHTML=xmlHTTP.responseText;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T14:47:52.487

也许您可以阅读 XmlHttpRequests 的 responseText 属性以在解析之前获得纯文本？

# .net - UdpClient.CancelReceive 在哪里？

> ID：840090
> 
> 赞同：4
> 
> 时间：2009-05-08T14:35:21.157
> 
> 标签：.net, sockets

我正在实现一个简单的本地网络发现协议，因此我调用了 UdpClient.Send，然后调用了 UdpClient.BeginReceive。如果有多个响应未决，我会在回调结束时调用 UdpClient.BeginReceive。像这样的东西：

```
UdpClient client = new UdpClient(AddressFamily.InterNetwork);
client.EnableBroadcast = true;
client.Send(request, request.Length, broadcastEndPoint);
client.BeginReceive(Callback, client); 
```

...然后在`Callback`：

```
void Callback(IAsyncResult ar)
{
    UdpClient client = (UdpClient)ar.AsyncState;
    IPEndPoint remoteEndPoint = null;
    byte[] response = client.EndReceive(ar, ref remoteEndPoint);

    // Do something with response

    client.BeginReceive(Callback, client);
} 
```

我的问题是我的主循环调用`client.Close`，而仍然有一个接收未决。接收完成，然后我对 BeginReceive 的下一次调用引发异常：`System.Net.Sockets.SocketException: An existing connection was forcibly closed by the remote host`

为什么 UdpClient 没有 CancelReceive 方法？我能做些什么呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-09-08T07:16:37.750

取而代之或克服此异常创建 bool 并在发出关闭命令之前设置它，使用该 bool 来检查回调

像这样

```
bool isClosing=false;
void Callback(IAsyncResult ar)
{
    if(isClosing) return;
} 
```

`bool` `isClosing`在发出关闭命令之前设置

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-10-15T16:00:20.483

使用“isClosing”标志通知回调函数 UdpClient 不再可用不是正确的解决方案。回调在不同的线程中执行，总是有可能在“isClosing”标志检查之后和“BeginReceive”（或“EndReceive”）调用之前关闭连接。

即使这不是一个干净的设计，微软似乎建议只捕获相应的异常来检测套接字不再可用。“BeginReceive”没有记录，但[类似的功能“BeginConnect”记录了](http://msdn.microsoft.com/en-us/library/vstudio/6aeby4wt%28v=vs.100%29.aspx)：

> 要取消对 BeginConnect() 方法的挂起调用，请关闭 Socket。当异步操作正在进行时调用 Close() 方法时，将调用提供给 BeginConnect() 方法的回调。对 EndConnect(IAsyncResult) 方法的后续调用将引发 ObjectDisposedException 以指示操作已被取消。

因此，示例代码如下所示：

```
void Callback(IAsyncResult ar)
{
    try
    {
        UdpClient client = (UdpClient)ar.AsyncState;
        IPEndPoint remoteEndPoint = null;
        byte[] response = client.EndReceive(ar, ref remoteEndPoint);

        // Do something with response

        client.BeginReceive(Callback, client);
    }
    catch (SocketException e)
    {
        // Oups, connection was closed
    }
    catch (ObjectDisposedException e)
    {
        // Oups, client was disposed
    }
} 
```

# class - 类文件的最佳大小是多少？

> ID：840092
> 
> 赞同：3
> 
> 时间：2009-05-08T14:35:28.583
> 
> 标签：class, size

我知道类文件没有单一的“理想”大小，但仍然......

关于类文件的最佳大小是否有任何数据（如研究，而不是意见）？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-08T14:37:19.377

我会说最佳大小足以让班级完成其工作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T14:38:27.283

意见：完成工作的最小可能尺寸，同时保持可读性但促进简洁。

在[学术界](http://portal.acm.org/citation.cfm?id=567176.567181)，有一些关于这个主题的工作可以尝试更正式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T14:39:15.190

我不关心类文件的大小，而是关心源文件的大小。

通常类文件大小大致是源文件大小的函数，但这不是观察类文件大小的理由。

# .net - 在 .NET 中实现 IPC 总线的最佳机制？

> ID：840095
> 
> 赞同：0
> 
> 时间：2009-05-08T14:36:16.430
> 
> 标签：.net, wcf, .net-3.5, ipc

我有几个应用程序想通过数据总线进行本地通信。

理想情况下：

*   他们上网时会说话和倾听
*   这种通信方式不会有“所有者”。
*   无需安装额外的组件（即消息队列）
*   如果没有需要打开的端口就好了

您认为做到这一点的最佳技术是什么？

有没有办法将 WCF 用于数据总线？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-09T01:07:32.247

是的，你可以，我认为应该使用 WCF 来做到这一点。命名管道绑定在机器进程间通信方面非常出色。它使用简单（假设您对服务有一定的了解）并且非常高效。我认为这完全符合您想要做的事情（根据您的描述）。

网上有很多关于这种方式使用这种绑定的文章。 [这](http://www.omegacoder.com/?p=101)是一个针对您所描述的内容的内容...我通读了一些，但是您对这个特定内容的了解可能会有所不同。

如果您搜索 WCF 和 Named Pipe，您会发现很多资源。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-10T00:39:27.763

你也可以看看这个：

[http://www.codeproject.com/KB/WCF/NullTransportForWCF.aspx](http://www.codeproject.com/KB/WCF/NullTransportForWCF.aspx)

# c# - C# 对此设计的思考

> ID：840096
> 
> 赞同：0
> 
> 时间：2009-05-08T14:36:21.780
> 
> 标签：c#, wcf

我有这个问题域，我需要能够运行一个后台进程：

*   运行过滤器获取 obj 集合（耗时操作）
*   通过一组规则传递 obj coll...也许通过一个规则接口
*   能够向任何感兴趣的听众公开规则引起的任何变化。

每个过滤器可能有许多规则，并且可以有多个过滤器。

这将是解决这个问题的实用方法吗？我在想：

*   在 Windows 服务中托管一个 WCF 应用程序，该应用程序将公开规则更改的回调
*   让服务完成运行 filter->rules 的繁重工作。这需要单独的线程工作吗？

欢迎对现有框架、设计模式等提出任何想法或参考。

谢谢苏尼特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T19:45:10.337

如果您的后台进程需要立即（24/7/365）从远程机器访问，Windows 服务对我来说很有意义。假设您熟悉 C#，创建一个 Windows 服务是微不足道的。[您可以按照此处](https://stackoverflow.com/questions/593454/easiest-language-to-create-a-windows-service/593803#593803)的步骤进行操作。一旦您启动了 Windows 服务，就可以通过在 Windows 服务的 OnStart 回调中创建 System.ServiceModle.ServiceHost 实例来轻松托管 WCF 服务。至于 WCF 模式和良好实践，我建议您参考 Juval Lowy 的网站[IDesign.net](http://www.idesign.net)。只需提供您的电子邮件地址，该站点就有大量与 WCF 相关的免费下载。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T14:44:08.750

您有几个选项，最明显的两个是客户端调用启动作业并轮询服务器以获取状态的方法，或者设置回调。

无论哪种方式，作业都应该在单独的线程上运行，这样它就不会阻塞服务。

如果您使用投票状态路由，请将实际结果放在返回状态中。如果您使用回调，请使用 WSDualHttpBinding 并设置回调。这看起来有点吓人，但它真的没那么糟糕。

我会让其他人加入实际的模式或框架，我只是不确定。此外，检查 MSMQ，这可能是另一个可行的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T14:51:37.530

您可以使用 WWF 来处理规则。您应该能够将 WWF 作为服务托管。

# ruby-on-rails - 在单个请求中获取不同的活动资源模型

> ID：840099
> 
> 赞同：1
> 
> 时间：2009-05-08T14:37:06.990
> 
> 标签：ruby-on-rails, model, resources, request

是否可以在单个请求中接收不同 Active Resource 模型的对象？例如，请求“GET /user/joe/articles/1.xml HTTP/1.1”从服务器返回来自用户（“joe”）的对象和来自文章（id“1”）的另一个对象。

我知道可以将数组中的这些对象发送给客户端，但 ARes 无法处理它们。有没有办法将响应一分为二并将结果发送到不同的活动资源模型进行处理？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-03T00:57:21.107

我认为您想要做的是将用户 xml 包含在返回的文章 xml 中。

如果您使用 ActiveRecord 制作 xml，您可以使用[to xml](http://api.rubyonrails.org/classes/ActiveRecord/Serialization.html#M001828)调用的 :include 参数来获取包含在文章响应中的用户。输出类似于

```
<article>
  ...
  <user>
    ...
  </user>
</article> 
```

然后，您应该能够在返回的文章对象上调用“.user”以获取用户属性。

# actionscript-3 - AS3 奇偶（错误）功能

> ID：840115
> 
> 赞同：0
> 
> 时间：2009-05-08T14:40:44.233
> 
> 标签：actionscript-3, flash

请问如何修复这个 AS3 功能？

谢谢你

```
function dispari(numero:int):Boolean;
{
  //check if the number is odd or even
  if (numero % 2 == 0)
  {
    returns false;
  }
  else
  {
    returns true;
  }
} 
```

错误：1071：语法错误：属性返回后需要定义关键字（例如函数），而不是 false。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T14:59:29.307

`(;)`为什么你的函数语句末尾有一个分号？我没有进行*任何*AS3 编码，但它看起来不正确，并且粗略地浏览了网络上的一些示例并没有它。

我怀疑这可能是导致您的问题的原因。试试这个：

```
function dispari(numero:int):Boolean
{
    //check if the number is odd or even
    if (numero % 2 == 0)
    {
        return false;
    }
    else
    {
        return true;
    }
} 
```

我还更改了`return`语句以匹配 AS3 的所有其他部分返回值（谢谢，@Herms，忘了提及 :-)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-11T09:29:23.577

Pax 的答案是正确的，但您可以通过返回结果来简化它：

```
function dispari(numero:int):Boolean
{
  return (numero % 2 != 0);
} 
```

# jquery - JQuery UI datepicker 没有坐在 IE 6 中的下拉菜单上

> ID：840117
> 
> 赞同：0
> 
> 时间：2009-05-08T14:40:59.070
> 
> 标签：jquery, internet-explorer-6, datepicker, drop-down-menu

出于某种原因，我们的日期选择器在 IE6 中落后于它下方的下拉菜单

[www.senegal.co.uk](http://www.senegal.co.uk/)

我所做的每一次搜索似乎都建议日期选择器应该处理这个问题。

我们确实有以下css：

```
.ui-datepicker-cover {
    display: none; /*sorry for IE5*/
    display/**/: block; /*sorry for IE5*/
    position: absolute; /*must have*/
    z-index: -1; /*must have*/
    filter: mask(); /*must have*/
    top: -4px; /*must have*/
    left: -4px; /*must have*/
    width: 200px; /*must have*/
    height: 200px; /*must have*/
} 
```

我尝试添加 bgiframe 并调用：

> $("#ui-datepicker-div").bgIframe();

但这并不能解决问题。

有任何想法吗？

我想我们需要有使用 jquery ui datepicker 经验的人来帮助我们解决这个问题！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T15:10:23.820

你肯定需要 BGIFrame - [http://docs.jquery.com/Plugins/bgiframe](http://docs.jquery.com/Plugins/bgiframe)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T15:12:02.723

解决这个问题的最快和最简单的方法是使用[BGIFrame](http://docs.jquery.com/Plugins/bgiframe)插件，它应该可以解决您的 IE6 问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T15:13:46.183

问题是 IE6 的 z-index 错误。我以前见过这个问题，但从来没有在 jQuery 中使用过。这里有几个链接可以帮助您朝着正确的方向前进。

[链接](http://www.brenelz.com/blog/2009/02/03/squish-the-internet-explorer-z-index-bug/) [1 链接2](http://jquerybox.com/index.php?topic=14.0)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-20T05:13:10.957

试试 $("#datepickerid").bgiframe();

bgiframe 插件位于[http://docs.jquery.com/Plugins/bgiframe](http://docs.jquery.com/Plugins/bgiframe)

jQuery UI 团队在他们遇到此类问题的大多数地方都使用它。

希望它也适合你。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T14:58:54.737

不会 z-index: -1 将图层发送到堆栈的**后面**，从而将其放在表单元素下吗？

我认为您可能需要一个正值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T08:54:11.077

无法及时找到解决方案，所以最后只需输入一些代码来隐藏下拉菜单

```
beforeShow: function() {
    $('.searchPanelGroup6').css('visibility', 'hidden');
},
onClose: function() {
    $('.searchPanelGroup6').css('visibility', 'visible');
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-17T09:40:30.680

我们并没有过多地使用显式定位，所以对我来说，它最近将以下样式直接应用于不会隐藏在日期选择器下方的选择/下拉元素：

`zoom: -1; position: relative;`

（哦，它被应用在一个单独的样式表中，该样式表仅用于 ms 即 6...）

# oracle - Oracle 我可以在 WHERE 子句中使用标量函数吗？或 NULL 问题

> ID：840118
> 
> 赞同：0
> 
> 时间：2009-05-08T14:41:02.050
> 
> 标签：oracle, trim

不知何故，当我打电话时，我永远不会得到任何结果： select * from table_1 t1 where t1.c1 IS NOT NULL and trim(t1.c1) != '' ;

trim(t1.c1) != '' 部分导致问题实际上我什么也没返回。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T14:43:05.133

Oracle 的奇特之处在于空字符串 ( `''`) 和`NULL`是一回事。就好像你在说：

```
trim(t1.c1) != NULL 
```

这样的说法**永远不会**是真的。尝试：

```
trim(t1.c1) IS NOT NULL 
```

# c# - 时间跨度格式

> ID：840120
> 
> 赞同：26
> 
> 时间：2009-05-08T14:41:08.523
> 
> 标签：c#, .net, timespan

当您将时间跨度声明为：

```
TimeSpan t = new TimeSpan(0, 70, 0); 
```

?

我当然知道您可以为此做一些简单的数学运算，但我有点希望 .NET 中有一些东西可以为我处理这个问题 - 对于更复杂的场景

**如何在 .NET 中使用自定义格式对 TimeSpan 对象进行 String.Format的**重复**[？](https://stackoverflow.com/questions/574881/how-can-i-string-format-a-timespan-object-with-a-custom-format-in-net)**

 *** * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-08T14:51:53.647

没有内置功能，您需要使用自定义方法，例如：

```
TimeSpan ts = new TimeSpan(0, 70, 0);
String.Format("{0} hour{1} {2} minute{3}", 
              ts.Hours, 
              ts.Hours == 1 ? "" : "s",
              ts.Minutes, 
              ts.Minutes == 1 ? "" : "s") 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-08T16:13:10.550

```
public static string Pluralize(int n, string unit)
{
    if (string.IsNullOrEmpty(unit)) return string.Empty;

    n = Math.Abs(n); // -1 should be singular, too

    return unit + (n == 1 ? string.Empty : "s");
}

public static string TimeSpanInWords(TimeSpan aTimeSpan)
{
    List<string> timeStrings = new List<string>();

    int[] timeParts = new[] { aTimeSpan.Days, aTimeSpan.Hours, aTimeSpan.Minutes, aTimeSpan.Seconds };
    string[] timeUnits = new[] { "day", "hour", "minute", "second" };

    for (int i = 0; i < timeParts.Length; i++)
    {
        if (timeParts[i] > 0)
        {
            timeStrings.Add(string.Format("{0} {1}", timeParts[i], Pluralize(timeParts[i], timeUnits[i])));
        }
    }

    return timeStrings.Count != 0 ? string.Join(", ", timeStrings.ToArray()) : "0 seconds";
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-05-09T08:41:42.417

从这里复制了我自己的答案：[如何将 TimeSpan 转换为格式化字符串？](https://stackoverflow.com/questions/842057/how-do-i-convert-a-timespan-to-a-formatted-string/4423615#4423615)

```
public static string ToReadableAgeString(this TimeSpan span)
{
    return string.Format("{0:0}", span.Days / 365.25);
}

public static string ToReadableString(this TimeSpan span)
{
    string formatted = string.Format("{0}{1}{2}{3}",
        span.Duration().Days > 0 ? string.Format("{0:0} days, ", span.Days) : string.Empty,
        span.Duration().Hours > 0 ? string.Format("{0:0} hours, ", span.Hours) : string.Empty,
        span.Duration().Minutes > 0 ? string.Format("{0:0} minutes, ", span.Minutes) : string.Empty,
        span.Duration().Seconds > 0 ? string.Format("{0:0} seconds", span.Seconds) : string.Empty);

    if (formatted.EndsWith(", ")) formatted = formatted.Substring(0, formatted.Length - 2);

    if (string.IsNullOrEmpty(formatted)) formatted = "0 seconds";

    return formatted;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T15:31:48.590

```
公共静态字符串 GetDurationInWords( TimeSpan aTimeSpan )
{
    字符串 timeTaken = string.Empty;

    如果（aTimeSpan.Days > 0）
        timeTaken += aTimeSpan.Days + "day" + (aTimeSpan.Days > 1 ? "s" : "" );

    如果（aTimeSpan.Hours > 0）
    {
        if(!string.IsNullOrEmpty(timeTaken))
           时间 += " ";
        timeTaken += aTimeSpan.Hours + "hour" + (aTimeSpan.Hours > 1 ? "s" : "" );
    }

    如果（aTimeSpan.Minutes > 0）
    {
       if(!string.IsNullOrEmpty(timeTaken))
           时间 += " ";
       timeTaken += aTimeSpan.Minutes + "minute" + (aTimeSpan.Minutes > 1 ? "s" : "" );
    }

    如果（aTimeSpan.Seconds > 0）
    {
       if(!string.IsNullOrEmpty(timeTaken))
           时间 += " ";
       timeTaken += aTimeSpan.Seconds + "秒" + (aTimeSpan.Seconds > 1 ? "s" : "" );
    }

    if(string.IsNullOrEmpty(timeTaken))
        timeTaken = "0 秒。";

     返回时间；
}

```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T15:57:48.933

我喜欢约翰正在研究的答案。这就是我想出的。

```
Convert.ToDateTime(t.ToString()).ToString("h \"Hour(s)\" m \"Minute(s)\" s \"Second(s)\""); 
```

不考虑天数，因此如果需要，您需要添加它。

# asp.net - .Net：通用对象列表 List(Of T) 是否有大小限制？

> ID：840121
> 
> 赞同：0
> 
> 时间：2009-05-08T14:41:27.243
> 
> 标签：asp.net

列表可以容纳多少个对象有限制吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T15:00:28.087

如果您查看通用列表（T 的）的 count/item/etc 属性；它是一个整数。

所以我猜 Integer.MaxValue (2147483647) 是一个很好的猜测。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T14:47:50.940

有一个简单的方法可以找出:-)

```
int count = 0;
while (true)
{
    myList.Add(new object());
    Console.WriteLine("added " + count++ + " objects");
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T14:58:52.083

列表的 .Count 属性是一个整数，因此在这方面有些限制。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T14:42:56.727

只有那些由您的物理架构、可用内存等强加的...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T14:51:21.290

请记住，大型集合可能最终会出现在大型对象堆上。这部分托管内存没有像 Gen0、1、2 那样被清理，因此请谨慎操作。让运行时根据您实际需要添加的数据选择集合大小。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T14:52:29.993

我相信它仅限于您拥有的内存量。添加到列表中的越多，越多的项目被添加到堆栈中，直到引用被释放并且垃圾收集器将其抓取回来。

# vb.net - 为什么访问 AppData（在 Vista 上）中的文件需要管理员权限？

> ID：840123
> 
> 赞同：4
> 
> 时间：2009-05-08T14:41:45.730
> 
> 标签：vb.net, windows-vista

在尝试删除 AppData 文件夹中的文件时，我的应用程序 (vb.net)**有时会**引发“拒绝访问”异常，我不知道为什么。

我在尝试删除它之前确认该文件存在并且没有做任何事情使其成为只读等。

有趣的是，当我以管理员权限登录时似乎一切正常。但是，我认为 AppData 文件夹不需要管理员权限。

任何帮助将不胜感激！

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2014-05-10T06:10:30.630

我没有看到你的代码的直觉是，也许你在你的程序或另一个程序中打开了这个文件？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T15:17:57.467

也许这些文件是在您以管理员身份启动应用程序时创建的？因此，当您稍后以普通用户身份尝试删除它们时，您会收到此错误。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-11T01:40:28.990

它不一定是文件夹，而是您尝试与之交互的文件的所有者。如果文件归管理员所有，您可能会遇到问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-05-11T12:03:22.410

AppData 是一个受保护的隐藏文件夹，因为它旨在让您的应用程序存储本地、LocalLow 和漫游应用程序相关数据。这就是为什么当您尝试进入该文件夹时会收到 UAC 提示并且它也隐藏在视图之外的原因。

尝试在代码中使用 Privilege demand 属性来请求进程提升以访问文件夹。

# c# - 如何使用 XPath 获取元素？

> ID：840126
> 
> 赞同：1
> 
> 时间：2009-05-08T14:42:23.123
> 
> 标签：c#, asp.net, xpath

我的 XML 就像：

```
<root>
  <section name="blah">
    <item name="asdf">2222</item>
  </section>
</root> 
```

我将在 XML 中有多个“部分”，我想获取一个特定的部分。

在这种情况下，我需要获取名为“blah”的部分中的项目。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T14:47:07.807

那么xpath是：

```
/root/section[@name='blah']/item 
```

例如，在`XmlDocument`：

```
foreach(XmlElement item in doc.SelectNodes("/root/section[@name='blah']/item"))
{
     Console.WriteLine(item.GetAttribute("name"));
     Console.WriteLine(item.InnerText);
} 
```

* * *

编辑重新评论：如果您只想要这些部分，请使用：

```
/root/section[@name='blah'] 
```

但是你需要手动迭代数据（因为理论上你可以有多个名为“blah”的部分，每个部分都可以有多个项目）。

# c# - 文件被修改了？现在要在 WPF 中处理？

> ID：840131
> 
> 赞同：1
> 
> 时间：2009-05-08T14:43:28.580
> 
> 标签：c#, wpf

告诉我的应用程序文件已被修改并且它应该向用户询问文件名的最佳方式是什么？有没有这样的课程，还是我手动编写所有这些逻辑？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T14:47:04.717

您需要手动处理该逻辑。如果你有一个体面的应用程序架构为你工作，这并不太难。只要在你的“文件”对象上翻转一个`Modified`标志，只要对象发生突变，它就会被序列化到磁盘上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T22:52:00.527

另一个解决方案是我最近看到的。如果在“文件”对象上设置修改标志很困难，您总是可以尝试保存到内存流并计算其哈希值，如果哈希值与原始版本的哈希值不同，则它已更改。

它不像设置修改标志那样优雅，但更容易改造。

# ruby - 如何编写 Ruby 方法来处理零个、一个或多个输入？

> ID：840136
> 
> 赞同：4
> 
> 时间：2009-05-08T14:44:31.947
> 
> 标签：ruby, idioms

我有一个 Ruby 方法，如下所示：

```
# Retrieve all fruits from basket that are of the specified kind.
def fruits_of_kind(kind)
  basket.select { |f| f.fruit_type == kind.to_s }
end 
```

现在，您可以这样称呼它：

```
fruits_of_kind(:apple)    # => all apples in basket
fruits_of_kind('banana')  # => all bananas in basket 
```

等等。

如何更改方法以使其正确处理可迭代输入以及无输入和零输入？例如，我希望能够支持：

```
fruits_of_kind(nil) # => nil
fruits_of_kind(:apple, :banana)    # => all apples and bananas in basket
fruits_of_kind([:apple, 'banana']) # => likewise 
```

这可以惯用地做吗？如果是这样，编写方法以使它们可以接受零个、一个或多个输入的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T15:18:19.557

您需要使用 Ruby splat 运算符，它将所有剩余的参数包装到一个数组中并将它们传递给：

```
def foo (a, b, *c)
  #do stuff
end

foo(1, 2) # a = 1, b = 2, c = []
foo(1, 2, 3, 4, 5) #a = 1, b = 2, c = [3, 4, 5] 
```

在你的情况下，这样的事情应该有效：

```
def fruits_of_kind(*kinds)
  kinds.flatten!
  basket.select do |fruit|
    kinds.each do |kind|
      break true if fruit.fruit_type == kind.to_s
    end == true #if no match is found, each returns the whole array, so == true returns false
  end
end 
```

* * *

## 编辑

我将代码更改为扁平化类型，以便您可以发送列表。这段代码根本不处理任何类型的输入，但如果你想明确输入，请在开头`nil`添加该行。`kinds = [] if kinds.nil?`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T15:08:51.873

使用 Ruby 的 VARARGS 功能。

```
# Retrieve all fruits from basket that are of the specified kind.
# notice the * prefix used for method parameter
def fruits_of_kind(*kind)
  kind.each do |x|
    puts x
  end
end

fruits_of_kind(:apple, :orange)
fruits_of_kind()
fruits_of_kind(nil) 
```

-佐助

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T15:17:50.650

```
def fruits_of_kind(kind)
    return nil if kind.nil?

    result = []

    ([] << kind).flatten.each{|k| result << basket.select{|f| f.fruit_type == k.to_s }}

    result
end 
```

'splat' 运算符可能是最好的方法，但有两件事需要注意：传入 nil 或列表。要针对您想要的输入/输出修改 Pesto 的解决方案，您应该执行以下操作：

```
def fruits_of_kind(*kinds)
  return nil if kinds.compact.empty? 

  basket.select do |fruit|
    kinds.flatten.each do |kind|
      break true if fruit.fruit_type == kind.to_s
    end == true #if no match is found, each returns the whole array, so == true returns false
  end
end 
```

如果传入 nil，* 会将其转换为 [nil]。如果要返回 nil 而不是空列表，则必须将其压缩（删除空值）为 []，然后如果为空则返回 nil。

如果您传入一个列表，例如 [:apple, 'banana']，* 会将其转换为 [[:apple, 'banana']]。这是一个细微的区别，但它是一个包含另一个列表的单元素列表，因此您需要在执行“每个”循环之前展平种类。展平会将其转换为 [:apple, 'banana']，就像您期望的那样，并为您提供您正在寻找的结果。

**编辑**：更好，感谢格雷格坎贝尔：

```
 def fruits_of_kind(basket, kind)
       return nil if kind.nil?

       kind_list = ([] << kind).flatten.map{|kind| kind.to_s}

       basket.select{|fruit| kind_list.include?(fruit) } 
   end 
```

或（使用 splat）

```
 def fruits_of_kind(*kinds)
       return nil if kinds.compact.empty?

       kind_list = kinds.flatten.map{|kind| kind.to_s}

       basket.select{|fruit| kind_list.include?(fruit.fruit_type) } 
   end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-01-07T23:15:33.250

有一个很好的表达使用 splat 作为数组创建的参数来处理你的最后一个例子：

```
def foo(may_or_may_not_be_enumerable_arg)
  arrayified = [*may_or_may_not_be_enumerable_arg]
  arrayified.each do |item|
    puts item
  end
end

obj = "one thing"
objs = ["multiple", "things", 1, 2, 3]

foo(obj)
# one thing
# => ["one thing"]

foo(objs)
# multiple
# things
# 1
# 2
# 3
# => ["multiple", "things", 1, 2, 3] 
```

# installation - 如何在 NSIS 中创建模拟安装程序？

> ID：840137
> 
> 赞同：0
> 
> 时间：2009-05-08T14:44:35.240
> 
> 标签：installation, nsis

我想使用 NSIS 制作一个模拟安装程序，以便我们演示最终安装过程完成后的样子。

我已经使用 Eclipse 插件完成了向导来创建经典安装程序。我想添加没有后端功能但会显示用户需要输入的数据的描述（例如 JRE 的路径）的附加屏幕、用于输入它的文本框 + 浏览按钮和下一步按钮. 我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T15:23:35.800

确切的答案取决于您使用的用户界面。

如果您使用的是[Modern User Interface](http://nsis.sourceforge.net/Docs/Modern%20UI/Readme.html)，这可能会有所帮助：

```
!define MUI_DIRECTORYPAGE_VARIABLE $InstallDirectory
!insertmacro MUI_PAGE_DIRECTORY

!define MUI_DIRECTORYPAGE_VARIABLE $JRE_InstallDirectory
!define MUI_PAGE_HEADER_TEXT "Choose JRE Location"
!define MUI_PAGE_HEADER_SUBTEXT "Choose an installation path for the JRE."
!define MUI_DIRECTORYPAGE_TEXT_TOP "This program will install the JRE to the following directory.  To use a different path, click Browse and select another directory. Click Next to continue."
!define MUI_DIRECTORYPAGE_TEXT_DESTINATION "JRE Path"
!insertmacro MUI_PAGE_DIRECTORY 
```

这将显示带有所有默认文本的标准目录页面（询问程序的安装路径）并将其存储在 $InstallDirectory 变量中。

以下页面将具有相同的布局，但带有自定义文本以询问 JRE 安装目录，该目录将存储在 $JRE_InstallDirectory 变量中。有关详细信息，[请参阅文档](http://nsis.sourceforge.net/Docs/Modern%20UI/Readme.html)。

# sql - 用于从列中提取文本并将其存储到同一记录中的不同列的 SQL 查询

> ID：840138
> 
> 赞同：3
> 
> 时间：2009-05-08T14:44:38.220
> 
> 标签：sql, sql-server, database

我需要一些有关 SQL 查询的帮助...

我有一个 SQL 表，其中包含已提交表单的列详细信息。我需要获取存储在该列中的部分文本并将其放入同一行的不同列中。我需要复制的文本位始终位于列中的相同位置。

任何帮助将不胜感激，伙计们......我的大脑一片空白：>

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-08T14:46:55.997

```
UPDATE  mytable
SET     other_column = SUBSTRING(column, begin_position, length) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-08T14:49:53.697

您可能只想使用计算列。这样，如果源字符串发生更改，您的计算列仍然正确。如果您需要查找此子字符串，那么如果您的数据库支持，您可能需要一个持久的计算列。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T14:46:56.543

```
UPDATE table
SET Column2 = SUBSTRING(Column1, startPos, length) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T15:42:52.137

如果您要复制的值在每条记录中的不同位置，但始终遵循相同的文本怎么办？

# clipboard - 如何在 TEdit 中禁用复制/粘贴

> ID：840144
> 
> 赞同：3
> 
> 时间：2009-05-08T14:46:54.437
> 
> 标签：clipboard, c++builder, vcl

我想防止在我的`TEdit`. 我怎样才能做到这一点？

我尝试在按下控件时设置`Key=NULL`on`KeyDown`事件`CTRL+V`，但它不起作用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T15:10:45.830

您需要阻止`WM_CUT`、`WM_COPY`和`WM_PASTE`消息发送到您的 TEdit。 [此答案](https://stackoverflow.com/questions/96271/how-do-i-intercept-a-paste-event-in-an-editbox)描述了如何仅使用 Windows API 来做到这一点。`TEdit`对于 VCL，子类化并更改其`DefWndProc`属性或覆盖其`WndProc`方法可能就足够了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-08-11T17:14:09.327

将此分配给`TEdit.OnKeyPress`：

```
procedure TForm1.Edit1KeyPress(Sender: TObject; var Key: Char);
begin
 if (Key=#22) or (Key=#3) then Key:=#0;   // 22 = [Ctrl+V] / 3 = [Ctrl+C]
end; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-01-29T18:10:33.907

我知道这是一个老问题，但我会添加我发现的内容。原始海报几乎有解决方案。如果您在按键事件而不是按键事件中忽略剪切/复制/粘贴，则它可以正常工作。即（C++ 生成器）

```
void __fastcall Form::OnKeyPress(TObject *Sender, System::WideChar &Key)
{
   if( Key==0x03/*ctrl-c*/ || Key==0x16/*ctrl-v*/ || Key==0x018/*ctrl-x*/ )
      Key = 0;  //ignore key press
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T15:10:31.933

当 TEdit 窗口处于活动状态时，您可以使用一些全局程序来获取快捷方式并阻止 CV CC CX

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-01-18T11:44:17.603

```
Uses Clipbrd;

procedure TForm1.Edit1Enter(Sender: TObject);
begin
  Clipboard.AsText := '';
end; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-06-12T14:21:03.920

一个老问题，但同样糟糕的答案仍在四处流传。

```
unit LockEdit;

// Version of TEdit with a property CBLocked that prevents copying, pasting,
// and cutting when the property is set.

{$mode objfpc}{$H+}

interface

uses
  Classes, SysUtils, StdCtrls, Windows;

type

  TLockEdit = class(TEdit)
  protected
      procedure WndProc(var msg: TMessage); override;
  private
      FLocked: boolean;
  public
      property CBLocked: boolean read FLocked write FLocked default false;
  end;

implementation

  procedure TLockEdit.WndProc(Var msg: TMessage);
  begin
  if ((msg.msg = WM_PASTE) or (msg.msg = WM_COPY) or (msg.msg = WM_CUT))
      and CBLocked
          then msg.msg:=WM_NULL;
  inherited;
  end;

end. 
```

# c# - Linq 和相等运算符：“System.Int32”类型的表达式不能用于“System.Object”类型的参数

> ID：840150
> 
> 赞同：10
> 
> 时间：2009-05-08T14:47:15.217
> 
> 标签：c#, .net, linq, operator-overloading

我试图覆盖 C# 中的相等 (==) 运算符来处理任何类型与自定义类型的比较（自定义类型实际上是围绕 null 的包装器/框）。

所以我有这个：

```
internal sealed class Nothing
{
    public override bool Equals(object obj)
    {
        if (obj == null || obj is Nothing)
            return true;
        else
            return false;
    }

    public static bool operator ==(object x, Nothing y)
    {
        if ((x == null || x is Nothing) && (y == null || y is Nothing))
            return true;
        return false;
    }
   ...
} 
```

现在，如果我拨打如下电话：

```
Nothing n = new Nothing();
bool equal = (10 == n); 
```

它工作得很好。但是，如果我尝试通过 Linq 表达式树做同样的事情：

```
exp = Expression.Equal(
    Expression.Constant(10), 
    Expression.Constant(new Nothing(), typeof(Nothing))
); 
```

它抛出异常：

```
System.ArgumentException : Expression of type 'System.Int32' cannot be used for parameter of type 'System.Object' of method 'Boolean op_Equality(System.Object, PARTSFinder.Rules.Runtime.RulesNothing)'
    at System.Linq.Expressions.Expression.ValidateArgumentTypes(MethodInfo method, ReadOnlyCollection`1& arguments)
    at System.Linq.Expressions.Expression.ValidateCallArgs(Expression instance, MethodInfo method, ReadOnlyCollection`1& arguments)
    at System.Linq.Expressions.Expression.Call(Expression instance, MethodInfo method, IEnumerable`1 arguments)
    at System.Linq.Expressions.Expression.Call(Expression instance, MethodInfo method, Expression[] arguments)
    at System.Linq.Expressions.ExpressionCompiler.GenerateBinaryMethod(ILGenerator gen, BinaryExpression b, StackType ask) 
```

关于为什么基本系统可以将 Int32 转换为 Object，但 Linq 不能，或者我该如何解决这个问题的任何想法？

整件事都盯着看，因为 Linq 一开始也无法将 Int32 与 Object 进行比较：

```
exp = Expression.Equal(
    Expression.Constant(10), 
    Expression.Constant(null)
); 
```

引发异常，指出“System.Int32”和“System.Object”没有比较运算符。

* * *

快速跟进：

以下确实可以正常工作：

```
exp = Expression.Equal(
    Expression.Constant(10, typeof(object)), 
    Expression.Constant(new Nothing(), typeof(Nothing))
);

exp = Expression.Equal(
    Expression.Constant(10, typeof(object)), 
    Expression.Constant(null)
); 
```

因此，专门将所有内容都转换为对象。那么，Linq 是否只是在内部不处理继承？真烦人……

* * *

跟进#2：

我还尝试使用自定义比较方法：

```
exp = Expression.Equal(
    Expression.Constant(10),
    Expression.Constant(null),
    false,
    this.GetType().GetMethod("ValueEquals", BindingFlags.Public | BindingFlags.Static)
);

    public static bool ValueEquals(object x, object y)
    {
        if (x == null && y == null)
            return true;
        if (x.GetType() != y.GetType())
            return false;
        return x == y;
    } 
```

这也会引发异常：

```
System.InvalidOperationException : The operands for operator 'Equal' do not match the parameters of method 'ValueEquals'.
    at System.Linq.Expressions.Expression.GetMethodBasedBinaryOperator(ExpressionType binaryType, Expression left, Expression right, MethodInfo method, Boolean liftToNull) 
```

但是再次将所有内容直接转换为对象有效：

```
exp = Expression.Equal(
    Expression.Constant(10, typeof(object)),
    Expression.Constant(null, typeof(object)),
    false,
    this.GetType().GetMethod("ValueEquals", BindingFlags.Public | BindingFlags.Static)
); 
```

所以我想我有我的解决方法......将所有内容都转换为对象并使用自定义比较方法。我仍然对 Linq 没有像普通 C# 那样自动进行转换感到惊讶。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-08T14:51:50.293

空有什么问题？重新丢失`int`vs `null`，尝试`int?`：

```
exp = Expression.Equal(
    Expression.Constant(10, typeof(int?)), 
    Expression.Constant(null, typeof(int?))
); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-05-30T23:22:06.807

您应该查看这篇文章以检查可空类型。

[http://msdn.microsoft.com/en-us/library/ms366789.aspx](http://msdn.microsoft.com/en-us/library/ms366789.aspx)

# c# - ObservableCollection 和 ListBoxItem DataTemplate 生成问题

> ID：840161
> 
> 赞同：2
> 
> 时间：2009-05-08T14:48:58.833
> 
> 标签：c#, wpf, observablecollection, listboxitem

ObservableCollection 发生了一些奇怪的事情。

我有以下代码：

```
private readonly ObservableCollection<DisplayVerse> _display;
private readonly ListBox _box;

    private void TransferToDisplay()
    {
        double elementsHeight = 0;

        _display.Clear();

        for (int i = 0; i < _source.Count; i++) {
            DisplayVerse verse = _source[i];
            _display.Add(verse);
            elementsHeight += CalculateItemsHeight(i);
            if (elementsHeight + Offset > _box.ActualHeight) {
                _display.RemoveAt(_display.Count - 1);
                break;
            }
        }
        MessageBox.Show(elementsHeight.ToString());
    }

    private double CalculateItemsHeight(int index)
    {
        ListBoxItem lbi = _box.ItemContainerGenerator.ContainerFromIndex(index) as ListBoxItem;
        return lbi != null ? lbi.ActualHeight : 0;
    } 
```

我在这里要做的是控制有多少项目进入 ObservableCollection _display。现在，在这个 for 循环中，您可以看到元素被添加，直到总元素高度（+偏移）大于列表框本身。

现在，这很奇怪，在这个 for 循环之后 elementsHeight 等于 0。（即使 lbi 不为空，CalculateItemsHeight 在所有循环迭代中都返回 0）似乎未创建数据模板中定义的 UI 元素......

然而。

现在，如果我在 _display.Add(verse) 之后放置一些 MessageBoxes，您可以看到 CalculateItemsHeight 实际上返回项目的高度。

```
for (int i = 0; i < _source.Count; i++) {
    DisplayVerse verse = _source[i];
    _display.Add(verse);
    MessageBox.Show("pause"); // <----- PROBLEM?
    elementsHeight += CalculateItemsHeight(i);
    if (elementsHeight + Offset > _box.ActualHeight) {
        _display.RemoveAt(_display.Count - 1);
        break;
    }
}
MessageBox.Show(elementsHeight.ToString()); 
```

如图所示修改 for 循环后，最后一个 MessageBox**实际上显示**了所有已处理元素的实际高度。

我的问题是 - **UI 元素是什么时候真正创建的**？似乎它是在 MessageBox 显示期间的某个地方完成的。这种行为对我来说很奇怪，也许它与线程有关，不确定。

添加到 _display ObservableCollection 显然会立即创建一个项目，而不是它的视觉元素（但是它们是在之后添加的，我只是不知道确切的时间）。如何在不必弹出消息框的情况下执行相同的行为？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-05T21:02:36.303

实际上，我试图让它工作，我发现“.UpdateLayout()”函数对我来说非常有用。我意识到你在做垂直，我在做水平，但这是我的代码，它非常简单：

 `````
for (int i = 0; i < listOfItems.ItemsIn.Count; ++i)
    {
        //CalculateItemsHeight(i);

        ListBoxItem abc = (lb.ItemContainerGenerator.ContainerFromItem(lb.Items[i]) as ListBoxItem);
        abc.UpdateLayout();
        totalWidth += abc.ActualWidth;
    } 
````  `希望这会有所帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T15:10:48.670

wpf 布局引擎不会通过布局和排列通道，因此您的列表框项还没有被指定大小。粘贴在消息框中将允许执行此操作的后台线程运行。在查看它们的大小之前，尝试在你的项目上强制调用 Measure()。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T20:22:10.513

**解决了**

这会在几分之一秒内产生一些闪烁效果（就像一个接一个地加载项目一样），但实际上符合我的需要。

关键是在检索项目高度之前刷新项目的 UI。

我创建了一个扩展方法：

```
 public static void RefreshUI(this DependencyObject obj)
    {
        obj.Dispatcher.Invoke(System.Windows.Threading.DispatcherPriority.Loaded, (Action)delegate { });
    } 
```

然后在检索高度之前，我刷新了 UI。

```
private double CalculateItemsHeight(int index)
    {
        ListBoxItem lbi = _box.ItemContainerGenerator.ContainerFromIndex(index) as ListBoxItem;
        if (lbi != null) {
            lbi.RefreshUI();
            return lbi.ActualHeight;
        }
        return 0;
    } 
```

# database - 每个表都应该有一个主键吗？

> ID：840162
> 
> 赞同：385
> 
> 时间：2009-05-08T14:49:14.963
> 
> 标签：database, database-design

我正在创建一个数据库表，但没有为其分配逻辑主键。每个表都应该有一个主键吗？

* * *

## 回答 #1

> 赞同：347
> 
> 时间：2009-05-08T14:52:37.387

简短的回答：**是**的。

长答案：

*   你需要你的桌子可以加入一些东西
*   如果您希望您的表被聚集，您需要某种主键。
*   如果您的表设计不需要主键，请重新考虑您的设计：很可能，您遗漏了一些东西。为什么要保留相同的记录？

在 MySQL 中，如果您没有明确指定主键，InnoDB 存储引擎总是会创建一个主键，从而产生一个您无权访问的额外列。

请注意，主键可以是复合的。

如果您有一个多对多链接表，则在链接中涉及的所有字段上创建主键。因此，您可以确保没有两条或更多条记录描述一个链接。

除了逻辑一致性问题之外，大多数 RDBMS 引擎将受益于将这些字段包含在唯一索引中。

而且由于任何主键都涉及创建唯一索引，因此您应该声明它并获得逻辑一致性和性能。

请参阅我的博客中的这篇文章，了解为什么您应该始终为唯一数据创建唯一索引：

*   [**使索引唯一**](http://explainextended.com/2009/04/23/making-an-index-unique/)

**PS**有一些*非常非常*特殊的情况，您不需要主键。

大多数情况下，它们包括出于性能原因没有*任何索引的日志表。*

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-05-08T15:34:50.080

总是最好有一个主键。这样它就满足了[第一个范式](http://en.wikipedia.org/wiki/First_normal_form)，并允许您继续沿着[数据库规范化](http://en.wikipedia.org/wiki/Database_normalization)路径。

正如其他人所说，没有主键有一些原因，但如果有主键，大多数都不会受到伤害

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2019-04-29T09:52:49.580

不同意建议的答案。简短的回答是：**不**。

主键的目的是唯一标识表上的一行，以便与另一个表形成关系。传统上，自动递增的整数值用于此目的，但对此有一些变化。

但是在某些情况下，例如记录时间序列数据，根本不需要这样的密钥，只会占用内存。使一行独一无二只是......不是必需的！

一个小例子：表 A：LogData

```
Columns:  DateAndTime, UserId, AttribA, AttribB, AttribC etc... 
```

不需要主键。

表 B：用户

```
Columns: Id, FirstName, LastName etc. 
```

需要主键 (Id) 才能用作 LogData 表的“外键”。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-05-08T15:11:43.863

除了极少数情况（可能是多对多关系表，或者临时用于批量加载大量数据的表），我会说：

> > *如果它没有主键，它就不是表！*

马克

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-05-08T14:54:09.960

几乎任何时候我创建了一个没有主键的表，以为我不需要一个，我最终返回并添加了一个。我现在甚至使用自动生成的身份字段创建连接表，我将其用作主键。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-05-08T14:55:10.283

加就行了

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-05-08T15:05:35.780

您是否需要将此表连接到其他表？您需要一种唯一标识记录的方法吗？如果答案是肯定的，您需要一个主键。假设您的数据类似于客户表，其中包含作为客户的人员的姓名。可能没有自然键，因为您需要地址、电子邮件、电话号码等来确定这个 Sally Smith 是否与那个 Sally Smith 不同，并且您将把该信息存储在相关表中，因为这个人可以有多个电话，addesses 、电子邮件等。假设 Sally Smith 与 John Jones 结婚并成为 Sally Jones。如果您的桌子上没有人工钥匙，那么当您更新名称时，您只需将 7 个 Sally Smiths 更改为 Sally Jones，即使其中只有一个结婚并更改了她的名字。

您说您没有自然密钥，因此您也没有任何字段组合可以使其唯一，这使得人工密钥至关重要。

我发现任何时候我没有自然密钥，人工密钥是维护数据完整性的绝对必要条件。如果您确实有一个自然键，则可以将其用作键字段。但就个人而言，除非自然键是一个字段，否则我还是更喜欢人工键和自然键上的唯一索引。如果你不放一个，你以后会后悔的。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2012-02-09T11:24:56.443

在每张桌子上都有一个 PK 是一个很好的做法，但这不是必须的。很可能您将需要一个唯一索引和/或聚集索引（是否为 PK），具体取决于您的需要。

查看联机丛书中的主键和聚集索引部分（适用于 SQL Server）

" *PRIMARY KEY 约束标识具有唯一标识表中行的值的列或列集。表中的任何两行都不能具有相同的主键值。您不能为主键中的任何列输入 NULL。我们建议使用小的整数列作为主键。每个表都应该有一个主键。符合主键值的列或列组合称为候选键。* "

但也请检查一下：[http ://www.aisintl.com/case/primary_and_foreign_key.html](http://www.aisintl.com/case/primary_and_foreign_key.html)

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-05-08T14:58:34.113

为了让它成为未来的证明，你真的应该这样做。如果你想复制它，你需要一个。如果你想把它加入另一张桌子，你的生活（以及明年必须维护它的可怜傻瓜的生活）会容易得多。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2020-08-11T15:00:00.197

聚会迟到了，但我想加两分钱：

> 每个表都应该有一个主键吗？

*   如果您在谈论“关系 Albegra”，答案是**Yes**。以这种方式对数据建模需要实体和表具有主键。关系代数的问题（除了它有 20 种不同的、不匹配的风格之外），它只存在于纸面上。您无法使用关系代数构建现实世界的应用程序。

*   现在，如果您正在谈论来自现实世界应用程序的数据库，它们部分/大部分都遵循关系代数，充分利用它并忽略它的其他部分。此外，现在数据库引擎提供了大量的非关系功能（现在是 2020 年）。所以在这种情况下，答案是**否定**的。无论如何，我 99.9% 的真实世界表都有主键，但也有合理的例外。恰当的例子：事件/日志表（多个索引，但看不到一个键）。

底线是，在遵循实体/关系模型的事务应用程序中，几乎（如果不是）所有表都有主键是很有意义的。如果您决定跳过表的主键，请确保您有充分的理由，并且准备好为您的决定辩护。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-05-08T14:54:41.097

我知道为了在 .NET 中使用 gridview 的某些功能，您需要一个主键才能让 gridview 知道哪一行需要更新/删除。一般的做法应该是有一个主键或主键簇。我个人更喜欢前者。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-05-09T16:32:03.157

我的职责是维护离岸开发团队创建的应用程序。现在我在应用程序中遇到了各种问题，因为原始数据库模式在某些表上不包含主键。所以请不要因为你糟糕的设计而让其他人受苦。在表上拥有主键总是一个好主意。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-05-08T14:54:40.270

我总是有一个主键，即使一开始我还没有考虑到它的目的。有几次我最终需要在一个没有 PK 的表中进行 PK，并且以后再放入它总是比较麻烦。我认为总是包含一个有更多的好处。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-05-08T15:00:45.090

如果您使用的是 Hibernate，则无法创建没有主键的实体。如果您使用的是使用普通 sql/ddl 脚本创建的现有数据库，并且没有添加主键，则此问题可能会产生问题

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-05-08T14:52:47.293

简而言之，没有。但是，您需要记住，某些客户端访问 CRUD 操作需要它。为了将来打样，我倾向于总是使用主键。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2021-01-19T07:17:15.040

我想找到像这样的官方信息 - [15.6.2.1 Clustered and Secondary Indexes - MySQL](https://dev.mysql.com/doc/refman/8.0/en/innodb-index-types.html)。

> 如果 table 没有 PRIMARY KEY 或合适的 UNIQUE 索引，InnoDB 在内部生成一个名为 GEN_CLUST_INDEX 的隐藏聚集索引，该索引包含行 ID 值的合成列。这些行按 InnoDB 分配给此类表中的行的 ID 排序。行 ID 是一个 6 字节的字段，随着新行的插入而单调增加。因此，按行 ID 排序的行在物理上是按插入顺序排列的。

那么，为什么不自己创建主键或类似的东西呢？此外，ORM 无法识别这个隐藏的 ID，这意味着您不能在代码中使用 ID。

# java - 如何调试 ConcurrentModificationException？

> ID：840165
> 
> 赞同：14
> 
> 时间：2009-05-08T14:49:30.453
> 
> 标签：java, multithreading, exception, concurrency

我遇到了 ConcurrentModificationException 并且通过查看它我看不出它发生的原因；抛出异常的区域和所有修改集合的地方都被包围

```
synchronized (this.locks.get(id)) {
  ...
} // locks is a HashMap<String, Object>; 
```

我试图捕捉讨厌的线程，但我所能确定的（通过在异常中设置断点）是抛出线程拥有监视器，而另一个线程（程序中有两个线程）休眠。

我应该如何进行？当您遇到类似的线程问题时，您通常会怎么做？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-05-08T14:52:31.833

它可能与同步块无关。`ConcurrentModificationException`当您在迭代集合的元素时修改集合时，通常会发生 s。

```
List<String> messages = ...;
for (String message : messages) {
    // Prone to ConcurrentModificationException
    messages.add("A COMPLETELY NEW MESSAGE");
} 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-08T20:00:02.453

与之前的帖子类似，如果您删除条目，您可能会遇到相同的问题。例如

```
for(String message : messages) {
  if (condition(message))
     messages.remove(message);
} 
```

另一个常见的例子是清理地图。

这个特殊的问题可以使用一个迭代器显式地解决。

```
for(Iterator<String> iter = messages.iterator(); iter.hasNext();) {
   String message = iter.next();
   if (condition(message))
       iter.remove(); // doesn't cause a ConcurrentModificationException 
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-06-12T23:09:00.883

有时您的应用程序可能过于复杂，某些功能可能会产生过多的副作用。此外，也许另一个线程确实对该列表做错了，而您无法轻易找到。

对于我自己的问题，我编写了自己的列表系统，它委托另一个列表，一旦锁定，所有其他修改都会抛出 ConcurrentModificationException，因此错误的修改指令将在输出时出现异常。它还可以检测上述错误。

```
导入 java.util.*；

/**
 * 由 IntelliJ IDEA 创建。
 * 用户：francoiscassistat
 * 日期：2010 年 6 月 12 日
 * 时间：18:20:18
 *
 *
 * 可锁定列表，用于调试列表上的 ConcurrentModificationException。
 * 可以使用 setLocked(boolean) 打开/关闭锁。
 * 锁定时，对列表或迭代器的所有写访问都会获得 ConcurrentModificationException。
 * 简单用例：
 *
 * list.setLocked(true);
 *
 * for (Object o : list.iterator()) // 现在 this 不会得到 ConcurrentModificationException，导致这个的其他指令将抛出异常
 * { ... }
 *
 * list.setLocked(false);
 */
公共类 LockableList<E> 实现 List<E> {
    受保护的类 LockableListIterator 实现 Iterator<E> {
        受保护的 Iterator<E> 迭代器；

        公共 LockableListIterator(Iterator<E> 迭代器) {
            this.iterator = 迭代器；
        }

        公共布尔 hasNext() {
            返回迭代器.hasNext();
        }

        公共E下一个（）{
            返回迭代器.next();
        }

        公共无效删除（）{
            检查锁（）；
            迭代器.remove();
        }
    }

    受保护的类 LockableListListIterator 实现 ListIterator<E> {
        受保护的 ListIterator<E> listIterator;

        公共 LockableListListIterator(ListIterator<E> listIterator) {
            this.listIterator = listIterator;
        }

        公共布尔 hasNext() {
            返回 listIterator.hasNext();
        }

        公共E下一个（）{
            返回 listIterator.next();
        }

        公共布尔 hasPrevious() {
            返回 listIterator.hasPrevious();
        }

        公共 E 以前的（） {
            返回 listIterator.previous();
        }

        公共 int nextIndex() {
            返回 listIterator.nextIndex();
        }

        公共 int previousIndex() {
            返回 listIterator.previousIndex();
        }

        公共无效删除（）{
            检查锁（）；
            listIterator.remove();
        }

        公共无效集（E e）{
            检查锁（）；
            listIterator.set(e);
        }

        公共无效添加（E e）{
            检查锁（）；
            listIterator.add(e);
        }
    }

    受保护的类 LockableListSubList 实现 List<E>
    {
        受保护的列表<E> 列表；

        公共 LockableListSubList(List<E> 列表) {
            this.list = 列表；
        }

        公共整数大小（）{
            返回列表大小（）；
        }

        公共布尔 isEmpty() {
            返回列表.isEmpty();
        }

        公共布尔包含（对象o）{
            返回 list.contains(o);
        }

        公共迭代器<E>迭代器（）{
            返回新的 LockableListIterator(list.iterator());
        }

        公共对象[] toArray() {
            返回列表.toArray();
        }

        公共 <T> T[] toArray(T[] a) {
            返回 list.toArray(a);
        }

        公共布尔添加（E e）{
            检查锁（）；
            返回列表.add(e);
        }

        公共布尔删除（对象o）{
            检查锁（）；
            返回列表.remove(o);
        }

        public boolean containsAll(Collection<?> c) {
            返回 list.containsAll(c);
        }

        public boolean addAll(Collection<? extends E> c) {
            检查锁（）；
            返回列表.addAll(c);
        }

        public boolean addAll(int index, Collection<? extends E> c) {
            检查锁（）；
            返回 list.addAll(index, c);
        }

        public boolean removeAll(Collection<?> c) {
            检查锁（）；
            返回列表.removeAll(c);
        }

        公共布尔保留所有（集合<？> c）{
            检查锁（）；
            返回列表.retainAll(c);
        }

        公共无效清除（）{
            检查锁（）；
            list.clear();
        }

        @覆盖
        公共布尔等于（对象o）{
            返回 list.equals(o);
        }

        @覆盖
        公共 int hashCode() {
            返回 list.hashCode();
        }

        公共 E 获取（整数索引）{
            返回列表.get（索引）；
        }

        public E set(int index, E element) {
            检查锁（）；
            返回 list.set(index, element);
        }

        公共无效添加（int索引，E元素）{
            检查锁（）；
            list.add（索引，元素）；
        }

        公共 E 删除（整数索引）{
            检查锁（）；
            返回列表。删除（索引）；
        }

        公共 int indexOf（对象 o）{
            返回 list.indexOf(o);
        }

        公共int lastIndexOf（对象o）{
            返回 list.lastIndexOf(o);
        }

        公共 ListIterator<E> listIterator() {
            返回新的 LockableListListIterator(list.listIterator());
        }

        公共 ListIterator<E> listIterator(int index) {
            返回新的 LockableListListIterator(list.listIterator(index));
        }

        公共列表<E> subList(int fromIndex, int toIndex) {
            return new LockableListSubList(list.subList(fromIndex, toIndex));
        }
    }

    受保护的列表<E> 列表；
    受保护的布尔锁定；

    公共 LockableList(List<E> 列表) {
        this.list = 列表；
        锁定=假；
    }

    公共布尔 isLocked() {
        返回锁定；
    }

    公共无效 setLocked（布尔锁定）{
        this.locked = 锁定；
    }

    受保护的无效检查锁（）{
        如果（锁定）
            throw new ConcurrentModificationException("Locked");
    }

    公共整数大小（）{
        返回列表大小（）；
    }

    公共布尔 isEmpty() {
        返回列表.isEmpty();
    }

    公共布尔包含（对象o）{
        返回 list.contains(o);
    }

    公共迭代器<E>迭代器（）{
        返回新的 LockableListIterator(list.iterator());
    }

    公共对象[] toArray() {
        返回列表.toArray();
    }

    公共 <T> T[] toArray(T[] a) {
        返回 list.toArray(a);
    }

    公共布尔添加（E e）{
        检查锁（）；
        返回列表.add(e);
    }

    公共布尔删除（对象o）{
        检查锁（）；
        返回列表.remove(o);
    }

    public boolean containsAll(Collection<?> c) {
        返回 list.containsAll(c);
    }

    public boolean addAll(Collection<? extends E> c) {
        检查锁（）；
        返回列表.addAll(c);
    }

    public boolean addAll(int index, Collection<? extends E> c) {
        检查锁（）；
        返回 list.addAll(index, c);
    }

    public boolean removeAll(Collection<?> c) {
        检查锁（）；
        返回列表.removeAll(c);
    }

    公共布尔保留所有（集合<？> c）{
        检查锁（）；
        返回列表.retainAll(c);
    }

    公共无效清除（）{
        检查锁（）；
        list.clear();
    }

    @覆盖
    公共布尔等于（对象o）{
        返回 list.equals(o);
    }

    @覆盖
    公共 int hashCode() {
        返回 list.hashCode();
    }

    公共 E 获取（整数索引）{
        返回列表.get（索引）；
    }

    public E set(int index, E element) {
        检查锁（）；
        返回 list.set(index, element);
    }

    公共无效添加（int索引，E元素）{
        检查锁（）；
        list.add（索引，元素）；
    }

    公共 E 删除（整数索引）{
        检查锁（）；
        返回列表。删除（索引）；
    }

    公共 int indexOf（对象 o）{
        返回 list.indexOf(o);
    }

    公共int lastIndexOf（对象o）{
        返回 list.lastIndexOf(o);
    }

    公共 ListIterator<E> listIterator() {
        返回新的 LockableListListIterator(list.listIterator());
    }

    公共 ListIterator<E> listIterator(int index) {
        返回新的 LockableListListIterator(list.listIterator(index));
    }

    公共列表<E> subList(int fromIndex, int toIndex) {
        return new LockableListSubList(list.subList(fromIndex, toIndex));
    }
}

```

只需像这样使用它：

```
List list = new LockableList(new ArrayList(...));
list.setLocked(true);

for (E e : list.iterator())
{ ... }

list.setLocked(false);

```

希望它可以帮助别人。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-06-12T17:23:22.663

如果您需要从列表中删除一些元素。您可以维护另一个列表，例如要删除的元素。最后调用 removeAll(collection)。当然，这对于大数据是不利的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-01-06T17:00:52.457

不得不处理类似的问题后，我编写了一个小助手来调试某些对象上的并发访问情况（有时使用调试器会修改运行时行为，以至于问题不会发生）。该方法类似于弗朗索瓦展示的方法，但更通用一些。也许它可以帮助某人：[http ://code.google.com/p/kongcurrent/](http://code.google.com/p/kongcurrent/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-08T14:53:32.910

在迭代动态列表时（例如在 foreach 循环中）修改动态列表时，通常会收到 ConcurrentModificationException。你可能想确保你没有在任何地方这样做。

# eclipse - OSGi SAT，我们应该如何处理激活失败？

> ID：840169
> 
> 赞同：1
> 
> 时间：2009-05-08T14:49:57.677
> 
> 标签：eclipse, osgi

eclipse OSGi Service Activator Toolkit 提供了一个框架，可以简化处理 budles 之间的依赖关系。

可以从 org.eclipse.soda.sat.core.framework.BaseBundleActivator 派生并覆盖（例如）activate() 方法来执行一些特定的初始化工作。

签名受保护 void activate(){}

这导致了一个问题：“如果 activate() 失败，我们打算做什么？”，假设由于某种原因我们无法正确初始化。我不能抛出异常，方法签名不允许这样做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-06-07T08:34:06.887

如果您使用的是 Equinox（使用 org.eclipse.osgi_3.5.1.R35x_v20090827 测试），则在 activate() 方法中抛出 RuntimeException 或错误对您没有帮助。独立于您抛出捆绑包的内容最终将处于状态 ACTIVE。

我认为这种行为是 Equinox 特有的（错误？），因为据我了解，这违反了 OSGi 规范。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T20:36:19.263

It's still possible to throw [RuntimeException](http://java.sun.com/javase/6/docs/api/) and [Error](http://java.sun.com/javase/6/docs/api/) (And Exceptions that inherit these). (Remember that Error indicates serious problems that a reasonable application should not try to catch.)

It would also seems like a good idea to output something to your logging facility.

The alternative you choose is dependent on the situation; what the root cause of the failed activation is. If the cause is something abnormal, that should not happen during normal circumstances, an Error or RuntimeException (and ofcourse loggin) feels right.

# vb.net - 如何以编程方式将excel嵌入word？

> ID：840170
> 
> 赞同：1
> 
> 时间：2009-05-08T14:50:28.860
> 
> 标签：vb.net, excel, vba, ms-word

有什么办法吗？我更喜欢使用 VB.NET 或 Java，并尽量避免使用 VBA。谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T15:14:13.063

[此信息](http://www.c-sharpcorner.com/UploadFile/amrish_deep/WordAutomation05102007223934PM/WordAutomation.aspx)可能会有所帮助。它介绍了使用 C# 自动化 Word，但这些示例应该让您使用 VB。

# java - 更改 Java 中的当前工作目录？

> ID：840190
> 
> 赞同：180
> 
> 时间：2009-05-08T14:54:04.700
> 
> 标签：java, working-directory

如何从 Java 程序中更改当前工作目录？我能找到的关于这个问题的所有内容都声称你根本做不到，但我不敢相信情况确实如此。

我有一段代码使用硬编码的相对文件路径从通常启动的目录中打开文件，我只想能够在不同的 Java 程序中使用该代码，而不必从内部启动它一个特定的目录。似乎您应该可以调用`System.setProperty( "user.dir", "/path/to/dir" )`，但据我所知，调用该行只是默默地失败并且什么都不做。

如果Java不允许您这样做，我会理解，如果不是因为它允许您*获取*当前工作目录，甚至允许您使用相对文件路径打开文件......

* * *

## 回答 #1

> 赞同：154
> 
> 时间：2009-05-08T14:59:28.917

在纯 Java 中没有可靠的方法来做到这一点。通过或设置`user.dir`属性似乎确实会影响 的后续创建，但不会影响。`System.setProperty()``java -Duser.dir=...``Files``FileOutputStreams`

[`File(String parent, String child)`](https://docs.oracle.com/javase/8/docs/api/java/io/File.html#File-java.lang.String-java.lang.String-)如果您将目录路径与文件路径分开构建，则构造函数可以提供帮助，从而更轻松地进行交换。

另一种方法是设置一个脚本以从不同的目录运行 Java，或者使用 JNI 本机代码[，如下所示](/questions/840190#8204584)。

[相关的 Sun 错误](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4045688)已于 2008 年关闭，因为“不会修复”。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2009-05-08T15:04:03.977

如果您使用[ProcessBuilder](http://java.sun.com/javase/6/docs/api/java/lang/ProcessBuilder.html "流程构建器")运行您的遗留程序，您将能够指定它的工作[目录](http://java.sun.com/javase/6/docs/api/java/lang/ProcessBuilder.html#directory)。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2012-12-20T23:00:52.430

有**一种**方法可以使用系统属性“user.dir”来做到这一点。要理解的关键部分是必须调用 getAbsoluteFile()（如下所示），否则将根据*默认*的“user.dir”值解析相对路径。

```
import java.io.*;

public class FileUtils
{
    public static boolean setCurrentDirectory(String directory_name)
    {
        boolean result = false;  // Boolean indicating whether directory was set
        File    directory;       // Desired current working directory

        directory = new File(directory_name).getAbsoluteFile();
        if (directory.exists() || directory.mkdirs())
        {
            result = (System.setProperty("user.dir", directory.getAbsolutePath()) != null);
        }

        return result;
    }

    public static PrintWriter openOutputFile(String file_name)
    {
        PrintWriter output = null;  // File to open for writing

        try
        {
            output = new PrintWriter(new File(file_name).getAbsoluteFile());
        }
        catch (Exception exception) {}

        return output;
    }

    public static void main(String[] args) throws Exception
    {
        FileUtils.openOutputFile("DefaultDirectoryFile.txt");
        FileUtils.setCurrentDirectory("NewCurrentDirectory");
        FileUtils.openOutputFile("CurrentDirectoryFile.txt");
    }
} 
```

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2011-11-20T20:45:07.487

可以使用 JNA/JNI 调用 libc 来更改 PWD。JRuby 家伙有一个方便的 java 库，用于进行 POSIX 调用，称为[**jnr-posix**](https://github.com/jnr/jnr-posix)。这是[maven信息](https://search.maven.org/artifact/com.github.jnr/jnr-posix)

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2013-02-06T15:20:56.213

如前所述，您无法更改 JVM 的 CWD，但如果您要使用 Runtime.exec() 启动另一个进程，则可以使用允许您指定工作目录的重载方法。这实际上并不是为了在另一个目录中运行您的 Java 程序，而是在许多情况下，当需要启动另一个程序（例如 Perl 脚本）时，您可以指定该脚本的工作目录，同时保持 JVM 的工作目录不变。

请参阅[Runtime.exec](http://docs.oracle.com/javase/6/docs/api/java/lang/Runtime.html#exec%28java.lang.String%5B%5D,%20java.lang.String%5B%5D,%20java.io.File%29) javadocs

具体来说，

```
public Process exec(String[] cmdarray,String[] envp, File dir) throws IOException 
```

`dir`运行子进程的工作目录在哪里

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-05-08T14:58:35.470

如果我理解正确，Java 程序从当前环境变量的*副本开始。*任何更改`System.setProperty(String, String)`都是修改副本，而不是原始环境变量。并不是说这为 Sun 为什么选择这种行为提供了一个彻底的理由，但也许它揭示了一点点......

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-05-08T14:59:11.850

工作目录是一个操作系统特性（在进程启动时设置）。你为什么不只是传递你自己的系统属性（`-Dsomeprop=/my/path`）并在你的代码中使用它作为你的文件的父级：

```
File f = new File ( System.getProperty("someprop"), myFilename) 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-05-08T15:03:03.290

在这里做的更聪明/更容易的事情是只更改你的代码，而不是打开文件假设它存在于当前工作目录中（我假设你正在做类似的事情`new File("blah.txt")`，只需自己构建文件的路径。

`user.dir`让用户传入基本目录，从配置文件中读取它，如果找不到其他属性，则回退等等。但是改进程序中的逻辑比改变方式要容易得多环境变量起作用。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-05-28T20:09:38.513

我试图调用

`String oldDir = System.setProperty("user.dir", currdir.getAbsolutePath());`

它似乎工作。但

`File myFile = new File("localpath.ext"); InputStream openit = new FileInputStream(myFile);`

抛出一个`FileNotFoundException`虽然

`myFile.getAbsolutePath()`

显示正确的路径。我[读过这个](http://docs.oracle.com/javase/tutorial/essential/environment/sysprop.html)。我认为问题是：

*   Java 知道具有新设置的当前目录。
*   但是文件处理是由操作系统完成的。不幸的是，它不知道新设置的当前目录。

解决方案可能是：

`File myFile = new File(System.getPropety("user.dir"), "localpath.ext");`

它使用JVM已知的当前目录创建一个文件对象作为绝对对象。但是该代码应该存在于使用过的类中，它需要更改重用代码。

~~~~JcHartmut

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-06-10T07:37:46.117

您可以使用

> 新文件（“相对/路径”）.getAbsoluteFile（）

后

> System.setProperty("user.dir", "/some/directory")

```
System.setProperty("user.dir", "C:/OtherProject");
File file = new File("data/data.csv").getAbsoluteFile();
System.out.println(file.getPath()); 
```

将打印

```
C:\OtherProject\data\data.csv 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-12-18T17:51:23.807

您可以使用 JNI 或 JNA 更改进程的实际工作目录。

**使用 JNI，**您可以使用本机函数来设置目录。POSIX 方法是`chdir()`. 在 Windows 上，您可以使用`SetCurrentDirectory()`.

**使用 JNA，**您可以将本机函数包装在 Java 绑定器中。

对于 Windows：

```
private static interface MyKernel32 extends Library {
    public MyKernel32 INSTANCE = (MyKernel32) Native.loadLibrary("Kernel32", MyKernel32.class);

    /** BOOL SetCurrentDirectory( LPCTSTR lpPathName ); */
    int SetCurrentDirectoryW(char[] pathName);
} 
```

对于 POSIX 系统：

```
private interface MyCLibrary extends Library {
    MyCLibrary INSTANCE = (MyCLibrary) Native.loadLibrary("c", MyCLibrary.class);

    /** int chdir(const char *path); */
    int chdir( String path );
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-08T15:04:26.923

此问题的其他可能答案可能取决于您打开文件的原因。这是一个属性文件还是具有与您的应用程序相关的一些配置的文件？

如果是这种情况，您可以考虑尝试通过类路径加载器加载文件，这样您就可以加载 Java 可以访问的任何文件。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-07-31T15:48:17.243

如果您在 shell 中运行命令，您可以编写类似“java -cp”之类的内容并添加任何您想要用“：”分隔的目录，如果 java 在一个目录中找不到东西，它会尝试在其他目录中找到它们，即我就是这样做的。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2013-09-11T14:23:20.787

使用文件系统视图

```
private FileSystemView fileSystemView;
fileSystemView = FileSystemView.getFileSystemView();
currentDirectory = new File(".");
//listing currentDirectory
File[] filesAndDirs = fileSystemView.getFiles(currentDirectory, false);
fileList = new ArrayList<File>();
dirList = new ArrayList<File>();
for (File file : filesAndDirs) {
if (file.isDirectory())
    dirList.add(file);
else
    fileList.add(file);
}
Collections.sort(dirList);
if (!fileSystemView.isFileSystemRoot(currentDirectory))
    dirList.add(0, new File(".."));
Collections.sort(fileList);
//change
currentDirectory = fileSystemView.getParentDirectory(currentDirectory); 
```

# html - 如何将文本中的 URL 转换为 HTML 链接？

> ID：840192
> 
> 赞同：3
> 
> 时间：2009-05-08T14:54:27.930
> 
> 标签：html, perl, url

我正在用 Perl 编写一个论坛类型的讨论板，并希望自动将[http://www.google.com](http://www.google.com)更改为 HTML 链接。这也应该是安全的，并且在安全方面犯了错误。有没有一种快速、简单、安全的方式来自动添加链接？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-08T15:05:02.163

尝试这样的事情：

```
use Regexp::Common qw /URI/;

$text =~ s|($RE{URI}{HTTP})(?!</a>)|<a href="$1">$1</a>|g 
```

这里的关键是使用 Regexp::Common::URI ，它可能比我想出的任何东西都更彻底的 url 匹配器。我还在最后做了一个[否定的前瞻断言](http://www.perl.com/doc/manual/html/pod/perlre.html)，以确保 url 不在链接中。最后一部分并不完全，因为有人可能会做这样的事情：

```
<a href="http://www.mysite.com">http://www.mysite.com is my website</a> 
```

要正确执行此操作，您需要解析整个提交文本，并且只替换尚未成为链接一部分的 url。

# sql-server-2008 - 大容量 SQL Server 2008 的关键数据类型？

> ID：840193
> 
> 赞同：2
> 
> 时间：2009-05-08T14:54:39.567
> 
> 标签：sql-server-2008, star-schema, primary-key-design

我在为大量数据设计数据库的过程中，我想知道主键使用什么数据类型？

将进行表分区，数据库最终将被集群化，并将热故障转移到替代数据中心。

**编辑**

* * *

表格 - 考虑多个时间段和多个事物的聊天系统，与多个用户聊天的时间段和事物。

指数问题是我正在考虑的 - 即某些东西可能会在短时间内生成数十亿行。即在我们可以更改数据库或 DBA 做 DBA 事情之前

马克 - 我和你一样关心 GUID - 我不喜欢 GUID 飞来飞去的编码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-20T12:58:56.643

仅凭您提供的一点点信息，我建议您使用**BigInt**，这将使您达到 9,223,372,036,854,775,807，这是您不可能超过的数字。（不要从 INT 开始，并认为当您超过 20 亿行时您可以轻松地将其更改为 BigInt。这是可能的（我已经做到了），但可能需要很长时间，并且涉及重大的系统中断。）

Kimberly Tripp 有一系列关于创建聚簇索引和选择主键（相关问题，但并不总是完全相同的问题）的优秀系列博客文章（*[GUIDs as PRIMARY KEYs and/or the clustering key](http://sqlskills.com/BLOGS/KIMBERLY/post/GUIDs-as-PRIMARY-KEYs-andor-the-clustering-key.aspx)* and *[The Clustered Index Debate Continues](http://www.sqlskills.com/BLOGS/KIMBERLY/post/The-Clustered-Index-Debate-Continues.aspx)* ） ）。她的建议是聚集索引/主键应该是：

1.  **唯一**（否则无用作为键）
2.  **窄**（键用于所有非聚集索引和外键关系）
3.  **静态**（您不想更改所有相关记录）
4.  **总是增加**（所以新记录总是被添加到表的末尾，而不必插入到中间）

如果您使用 BigInt 作为键和聚集索引的递增标识，则应该满足所有这四个要求。

编辑：我上面提到的 Kimberly 的文章（*[GUIDs as PRIMARY KEYs 和/或集群键](http://sqlskills.com/BLOGS/KIMBERLY/post/GUIDs-as-PRIMARY-KEYs-andor-the-clustering-key.aspx)*）讨论了为什么（客户端生成的）GUID 是集群键的错误选择：

> 但是，一个非连续的 GUID——比如它的值在客户端（使用 .NET）或由 newid() 函数（在 SQL Server 中）生成的 GUID 可能是一个非常糟糕的选择——主要是因为碎片化它在基表中创建，但也因为它的大小。它不必要地宽（它比基于 int 的标识宽 4 倍——它可以为您提供 20 亿（实际上是 40 亿）个唯一行）。而且，如果您需要超过 20 亿行，您总是可以使用 bigint（8 字节 int）并获得 263-1 行。

SQL 有一个名为 NEWSEQUENTIALID() 的函数，它允许您生成避免碎片问题的顺序 GUID，但它们仍然存在不必要的宽问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-20T10:11:38.650

您总是可以选择**int**但考虑到您的分区/集群，我建议您查看将生成全局唯一键的**uniqueidentifier 。**

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-20T10:26:13.470

int 往往是规范，除非您需要大量数据，并且具有使用`IDENTITY`等的优势；`Guid`如果您希望数字不可猜测或可导出，则具有一些优势，但是如果您使用 a `Guid`（除非您自己将其生成为“梳理”），则应确保它是非集群的（即索引；不是农场)，因为它不会是增量的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-20T10:23:29.920

我认为 int 会非常适合它。

> INTEGER 的范围是 - 2147483648 到 2147483647。

您也可以使用 UniqueIdentifier (GUID)，但在这种情况下

*   MSSQL 中的表行大小限制
*   存储+内存。想象一下，你有 10000000 行并且还在增长的表
*   灵活性：有可用于 INT 的 T-SQL 运算符，例如 >、<、= 等...
*   GUID 未针对 ORDER BY/GROUP BY 查询和一般范围查询进行优化

# ruby-on-rails - Rails update_attributes 方法是更新数据库中模型的最佳选择吗？

> ID：840199
> 
> 赞同：17
> 
> 时间：2009-05-08T14:55:01.750
> 
> 标签：ruby-on-rails, model, controller, updatemodel, update-attributes

```
def update
  @album = Album.find(params[:id])
  if @album.update_attributes(params[:album])
    redirect_to(:action=>'list')
  else
    render(:action=>'edit')
  end    
end 
```

我正在介绍的 Rails 1.1.6 教程建议使用`update_attributes`更新模型的方法，如上面列出的控制器中的示例代码所示。查看 Rails 文档，我想知道为什么`update`不首选该方法，尤其是因为它的命名如此合乎逻辑。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-08T15:15:30.767

Update 接受一个对象`id`参数和一组属性，否则它们的工作方式类似于`update_attributes`.

所以这个（来自[AWDWR 第 3 版](http://www.pragprog.com/titles/rails3/agile-web-development-with-rails-third-edition)）

```
Order.update(12, :name => "Barney", :email => "barney@bedrock.com") 
```

相当于

```
Order.find(12).update_attributes(:name => "Barney", :email => "barney@bedrock.com") 
```

因此，如果您只想用一组属性更新一行已知 id，那么我会说没有理由不使用`update`- 看起来这就是他们编写它的原因！

（有什么方法可以让你的教程从 1.1.6 升级？它已经很老了，而且在当时并不是一个特别惊天动地的版本。1.2.6 更好 - 1.xs 中的最后一个，如果我没记错）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-09-20T14:09:44.347

使用 update_attributes 方法只是假设您已经有一个对象，并且您只需传递一组属性。工作完成了！

# asp.net - 动态控件、更新面板和事件 - 实现我的结果的最佳方式

> ID：840202
> 
> 赞同：0
> 
> 时间：2009-05-08T14:55:12.873
> 
> 标签：asp.net, controls, dynamic-controls

一直在拉我的头发并在网上做一些查看，试图找出一个优雅的解决方案来解决我的问题。

我有一个 ProductImages.aspx 页面。它在动态创建的列表中显示与该产品关联的所有图像。事件与每张图片相关联，以便您对其进行更新。

这工作正常。

但是，最后我有一个选项可以让我添加新图像。这是一个触发对 AddImage 方法的调用的按钮。

现在发生的事情是原始控件正在创建并添加到带有事件的页面中。然后如果触发按钮事件，它将重新创建所有现有的图像控件和一个新的。添加这一点，在 OnInit 之后创建的新图像控件没有附加事件，因为事件是在 OnInit 之后添加的。

我可以执行 Response.Redirect 来重新加载页面并触发 OnInit 以再次连接事件，但这似乎非常不雅，并且破坏了使用更新面板的意义。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T20:16:58.483

I'm thinking you could always load the picture upload control in a div and have a Javascript link to toggle the display attribute of the div.

Or perhaps use CollapsiblePanels from the AjaxToolKit to hide and show the upload form.

I think either of those ways would be more elegant than doing a post back (even if it's in an UpdatePanel) just to retrieve the picture upload form.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-01T20:08:17.417

Your questions makes it sound like you're saying that you can't put the controls in OnInit because it is only fired on the first load of the page. This is not the case - OnInit is fired each time the page is loaded (including postbacks), so you can re-create your controls there even when using an update panel.

One property that *is* different between the initial load and the postbacks is the Page.IsPostback property, which you can use to just perform actions on the first load of the page.

# c# - 如何判断 FTP 文件夹中的文件最近何时被覆盖？

> ID：840205
> 
> 赞同：0
> 
> 时间：2009-05-08T14:55:43.357
> 
> 标签：c#, windows-services, directory

我正在编写一个 Windows 服务，它需要从本地计算机上的 FTP 文件夹中获取一个文件并解析该文件中的数据，并将其推送到外部源。该文件将在某个时候从其他方上传到 FTP 文件夹，我无法预测文件何时上传。我需要该服务能够扫描 FTP 文件夹并识别文件最近何时上传到服务器，并启动解析过程。

我需要知道.NET 中是否有某种方法可以检测文件何时放入目录。

[在 SO 中有一个类似的](https://stackoverflow.com/questions/426809/how-to-get-date-time-when-file-was-placed-in-a-directory-on-windows)问题，但不是关于编写 Windows 服务。此外，解决方案似乎是监视目录本身，但我使用 DirectoryInfo 类测试了这个想法，并且在查看 LastWriteTime 属性时它不起作用。当我复制和替换目录中的文件时，目录的时间不会改变。

注意：我不能依赖文件上的创建/修改时间戳，因为我不知道对方是如何生成这些文件的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T14:59:24.190

使用 FileSystemWatcher。这将引发您可以处理的“已更改”（甚至我相信是“已创建”）事件。在开始使用它之前，您需要小心确保文件已完全写入，但这应该会让您指向正确的方向。

编辑：对于约瑟夫关于如何的问题，这是我在我的实用程序类中保留的一个静态方法：

```
公共静态布尔文件完成（字符串文件路径）
        {
            尝试
            {
                File.Open(filePath, FileMode.Open, FileAccess.ReadWrite, FileShare.None);
                返回真；
            }
            抓住{返回假；}
        }

```

然后我在实际文件处理之前只是一个 While(!FileComplete(foo)) {}。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T15:00:52.173

看看[FileSystemWatcher](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)。

# c# - 相同条件的保护子句和异常处理

> ID：840210
> 
> 赞同：2
> 
> 时间：2009-05-08T14:57:06.253
> 
> 标签：c#, exception, error-handling, guard-clause

我遇到了以下代码片段。名称已更改以保护无辜者：

```
 public void RunProgram()
    {
        System.IO.FileInfo fInfo = new System.IO.FileInfo(Application.StartupPath + "Program.exe");

        if (!fInfo.Exists)
        {
            System.Windows.Forms.MessageBox.Show("Program could not be found, please verify your installation.\n\nDetails:\n" + fInfo.FullName);
            return;
        }

        try
        {
            System.Diagnostics.Process  process = new System.Diagnostics.Process();
            System.Diagnostics.ProcessStartInfo pStart  = new System.Diagnostics.ProcessStartInfo(); 
            pStart.FileName = fInfo.FullName;
            pStart.UseShellExecute = true;
            process.StartInfo = pStart;
            process.Start();
        }
        catch
        {
            System.Windows.Forms.MessageBox.Show(string.Format("An error occurred trying to run the program:{0}", fInfo.FullName));
        }
    } 
```

我知道这里有一些问题：

*   异常类型没有单独处理
*   错误消息信息不足

请放心，我也会解决这些问题，但我的主要问题是在 try/catch 块之前检查文件是否存在。这让我觉得有点多余。

异常处理的重点是捕捉意外情况。我完全希望文件在那里，因此删除存在检查并让异常处理捕获它，如果它对我来说不是一个合理的解决方案。

你怎么看？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T15:00:46.917

文件不存在是我们可以合理预期的——因为我们处于 UI 级别（我假设，因为`MessageBox`），所以合理地检查请求是合理的，直接告诉用户并取消。

如果我们深入代码的内部（从 UI 中删除了几个级别），那么例外将是正确的 - 但我仍然可能首先检查文件是否存在并给出一个合理的错误。当然，任何文件存在性检查都会立即成为线程竞争条件；-p

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T15:01:46.493

我投票[取消`.Exists()`支票。](https://stackoverflow.com/questions/673654/when-is-it-okay-to-check-if-a-file-exists)

至于处理异常类型，我的正常模式是从通用异常处理程序开始以捕获所有内容，但还要确保记录这些异常。然后将其分开以根据日志处理不同的异常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T15:55:42.463

它是多余的，可能会给人一种虚假的安全感。请注意，由于并发性，您仍然可能会收到 FileNotFound 异常。

另请参阅：[是否存在参数验证可能被视为多余的情况？](https://stackoverflow.com/questions/522238/is-there-a-case-where-parameter-validation-may-be-considered-redundant/522665#522665)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T22:49:43.887

我总是尽量避免例外。这通常是因为我倾向于在启用异常中断的情况下运行 Visual Studio，因此请尽量避免异常。

我还花费了大量时间研究抛出异常代价高昂的嵌入式系统。这可能不是 C# 的情况。

# mysql - Cacti 将千行报告为 Mysql 排序

> ID：840212
> 
> 赞同：0
> 
> 时间：2009-05-08T14:57:50.450
> 
> 标签：mysql, cacti

在我的 cacti 安装中，报告 mysql 排序的图表的值是kiloRows。这个值是什么意思？我似乎在任何地方都找不到任何东西。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T17:31:23.123

查看源代码后，原来 cacti 正在获取 mysql SORT_ROWS 变量，然后除以 1024。

# flash - 如何将 MOV 文件加载到 Flash 9

> ID：840213
> 
> 赞同：0
> 
> 时间：2009-05-08T14:57:52.477
> 
> 标签：flash, actionscript-3, quicktime, movie

我在将 MOV 文件加载到 Flash 9 中时遇到问题。当我用谷歌搜索这个问题时，我得到很多人说确定你可以做到，但没有人提供工作示例代码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T20:56:07.687

以下来自[http://en.wikipedia.org/wiki/Adobe_Flash#Flash_Video](http://en.wikipedia.org/wiki/Adobe_Flash#Flash_Video)

> 闪光视频
> 
> Flash 视频（.flv 文件）是一种容器格式，这意味着它本身不是视频格式，但可以包含其他格式。Flash 中的视频采用 H.263 编码，从 Flash player 8 开始，它也可以采用 VP6 编码。音频为 MP3。由于 Flash Player 8 和 Flash Player 9 的大量采用率，VP6 的使用在许多公司中很常见。 [16]
> 
> 2007 年 8 月 20 日，Adobe 在其博客上宣布，随着 Flash Player 9 的更新 3，Flash Video 也将支持 MPEG-4 国际标准。 [31] 具体来说，Flash Player 将支持以 H.264 (MPEG-4 Part 10) 压缩的视频、使用 AAC (MPEG-4 Part 3) 压缩的音频、MP4、M4V、M4A、3GP 和 MOV 多媒体容器格式 (MPEG- 4 第 14 部分），3GPP 定时文本规范（MPEG-4 第 17 部分），它是一种标准化的字幕格式和对“ilst”原子的部分解析支持，它是 iTunes 用于存储元数据的 ID3 等效原子。Adobe 还宣布，由于流式传输 H.264 时 FLV 结构的功能限制，他们将逐渐从专有的 FLV 格式转向标准 MP4 格式。

```
package com.yourdomain.packageName
{
    import flash.display.Sprite;
    import flash.media.Video;
    import flash.net.NetConnection;
    import flash.net.NetStream;

    public class DocumentClass extends Sprite
    {
        private var _video:Video;
        private var _nc:NetConnection;
        private var _ns:NetStream;

        public function DocumentClass():void
        {
            _video = new Video(800, 600);
            addChild(_video);

            _nc = new NetConnection();
            _nc.connect(null);

            _ns = new NetStream(nc);
            _video.attachNetStream(_ns);
           _ns.play("path/to/file.extension");
        }
    }
} 
```

- 这是一个非常基本的实现，不包括元数据的处理。

首先，我们实例化一个 800 宽和 600 高的 Video 对象，并将其添加到显示列表中。

其次，我们实例化一个 NetConnection 对象并调用它的 connect 方法，传递 null 作为参数。（这是必需的）

第三，我们创建一个 NetStream 对象，将之前创建的 NetConnection 对象传递给它的构造函数。

第四，我们将 Video 对象的 attachNetStream 设置为 _ns，即我们实例化的 NetStream。

最后，我们调用 NetStream 对象的播放方法 _ns，并将其传递给我们的媒体所在的位置。（FLV/F4V/MOV/等）

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-14T14:51:27.433

与任何 FLV 相同，使用 NetStream（我不推荐它，它很难处理）或您可以找到的任何 AS3 视频播放组件，如 FLVPlayback 等......只要您的目标是 FP 9.0.115.0，并且该文件以 h264 和 MPEG-4 容器（如 mov、mp4、f4v 等）编码...

# c# - 如何将信息从一个 WPF UserControl 传递到另一个 WPF UserControl？

> ID：840214
> 
> 赞同：5
> 
> 时间：2009-05-08T14:57:53.477
> 
> 标签：c#, wpf, user-controls, application-design

我有一个 WPF 应用程序。

在左侧有一个堆栈面板，里面装满了按钮。

右侧有一个空的停靠面板。

当用户**单击按钮**时，它**会将相应的 UserControl** (View) 加载到停靠面板中：

```
private void btnGeneralClick(object sender, System.Windows.RoutedEventArgs e)
{
    PanelMainContent.Children.Clear();
    Button button = (Button)e.OriginalSource;
    Type type = this.GetType();
    Assembly assembly = type.Assembly;

    IBaseView userControl = UserControls[button.Tag.ToString()] as IBaseView;
    userControl.SetDataContext();

    PanelMainContent.Children.Add(userControl as UserControl);
} 
```

**这种模式效果很好**，因为每个 UserControl 都是一个 View，它有一个 ViewModel 类，该类向它提供从 Model 获得的信息，因此用户可以从一个页面点击到另一个页面，每个页面都可以执行独立的功能，例如编辑所有客户，保存到数据库等

## 问题：

但是，现在，在其中一个页面上，我想要一个包含客户列表的 ListBox，每个客户都有一个“编辑”按钮，当单击该编辑按钮时，我想用 EditSingleCustomer 填充 DockPanel UserControl 并将需要编辑的 Customer 传递给它。

我可以加载 EditCustomer 用户控件，但是如何*将它传递给客户进行编辑并设置其 DataContext 来编辑该客户*？

*   我无法在构造函数中传递它，因为所有 UserControls 都已创建并存在于 MainWindow.xaml.cs 的 Dictionary 中。
*   所以我在每个 UserControl 上创建了一个 PrepareUserControl 方法，并将 Customer 传递给它，并且可以使用 x:Name="..." 后面的代码中的文本框显示它，但这不是重点，我需要将 ItemsControl 数据绑定到一个ObservableCollection 当然可以利用 WPF 的数据绑定功能。
*   所以我尝试将 View 中的 ListBox ItemSource 绑定到其后面的代码，如下所示：

* * *

```
<UserControl.Resources>
    <local:ManageSingleCustomer x:Key="CustomersDataProvider"/>
</UserControl.Resources>

<DockPanel>
    <ListBox ItemsSource="{Binding Path=CurrentCustomersBeingEdited, Source={StaticResource CustomersDataProvider}}"
             ItemTemplate="{DynamicResource allCustomersDataTemplate}"
             Style="{DynamicResource allCustomersListBox}">
    </ListBox>
</DockPanel> 
```

这会导致该视图中 IntializeComponent() 中的无限循环导致堆栈溢出错误。**所以我想我以错误的方式解决这个问题，必须有一些更简单的范例来简单地将命令从一个 UserControl 传递到 WPF 中的另一个 UserControl**（在有人说“使用 WPF 命令”之前，我已经在使用命令在我的 UserControl 上允许用户编辑所有客户，这工作正常，但我必须在我的视图后面的代码中处理它（而不是在我的视图模型中），因为我需要父窗口上下文才能加载另一个用户控制何时完成保存：

```
<Button Style="{StaticResource formButton}" 
        Content="Save" 
        Command="local:Commands.SaveCustomer"
        CommandParameter="{Binding}"/>

private void OnSave(object sender, System.Windows.Input.ExecutedRoutedEventArgs e)
{
    Customer customer = e.Parameter as Customer;
    Customer.Save(customer);

    MainWindow parentShell = Window.GetWindow(this) as MainWindow;
    Button btnCustomers = parentShell.FindName("btnCustomers") as Button;
    btnCustomers.RaiseEvent(new RoutedEventArgs(Button.ClickEvent));
} 
```

**那么如何在 WPF 中简单地将一个 UserControl 加载到 DockPanel 中，在该 UserControl 内部有一个带有命令的按钮，该按钮加载另一个 UserControl*并向该 UserControl 发送一个可以绑定其控件的特定对象？***

我可以想象此时我对 WPF 命令的了解还不够，如果有人能从这里指出我正确的方向，那就太好了，或者如果您认为这种“在 DockPanel 模式中加载 UserControls 对 WPF 来说是陌生的，并且应该避免并用另一种构建应用程序的方式代替”，这也是有用的消息。您可以[在此处下载我的应用程序的当前状态，](http://tanguay.info/web/index.php?pg=codeExamples&id=169)以了解它的结构。谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-12T18:07:20.847

我刚刚使用 WPF 完成了一个 LOB 应用程序，其中这种问题/模式不断出现，所以我将如何解决您的问题：

1) 在您创建 ListBox 中的每个项目的 DataTemplate 中，连同它的编辑按钮，将 Button 的 tag 属性绑定到该列表框项目下的 Customer 对象。

2) 为按钮创建一个 Click 事件处理程序，并设置 Button 的 Click 事件以触发该处理程序。

3) 在事件处理程序中，设置 UserControl 的 Content 属性。

4) 在用户控件范围内（可能在其直接容器的资源中）设置一个 DataTemplate，它描述了该单个客户的编辑器。

另一种可行的方法是在 EditCustomer 类上声明 Customer 依赖属性，然后在单击按钮时设置该属性（可能通过 XAML 触发器）。

我希望这不是太模糊。如果不出意外，请知道您面临的问题在 WPF 中是可以解决的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T15:59:47.773

这是您使用中介者模式的地方。有几篇关于这个主题的博客文章（[例如](http://joshsmithonwpf.wordpress.com/2009/04/06/a-mediator-prototype-for-wpf-apps/)），并且在一些 WPF 框架（例如[Prism中的](http://www.codeplex.com/CompositeWPF)[EventAggregator](http://msdn.microsoft.com/en-us/library/dd458915.aspx) ）中有该模式的实现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T15:09:15.070

我没有时间真正深入研究这个（这是一个有趣的问题，我希望你能得到一个好的答案——我可以看到自己将来会遇到类似的情况）。

您是否考虑过减少 WPF-y 并回退到使用包含客户的 EventArgs 在源 UserControl 上触发事件，然后在事件处理程序中触发目标控件上的适当命令？

# java - NetBeans Web 服务客户端项目 - 重复 WSDL 解析

> ID：840217
> 
> 赞同：2
> 
> 时间：2009-05-08T14:58:25.067
> 
> 标签：java, netbeans, wsdl

我因此创建了一个新项目...

```
 File, New Project...
    Java, Java Application.

  Right-click project icon in "Projects" tree-view panel.
    Choose New, Web Service Client...

  Specify WSDL file e.g. 
     ( ) Project
     (*) Local file D:\temp\Foo\Bar.wsdl
     ( ) WSDL URL                            [Set Proxy...]

     client-style JAX-WS

     [ ] Generate Dispatch code 
```

它解析了 WSDL 并生成了大量的 java 文件。我创建了一个主类并使用 Netbeans 插入一个 WS 客户端调用

现在，每当我运行我的代码（桌面应用程序）时，它都会再次解析 WSDL（它永远不会改变）并重新生成大约 78 个 java 文件并编译它们。

如何阻止 Netbeans 执行这种不必要且耗时的操作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-10-27T06:16:13.833

这是默认的 netbeans 行为，以保证代理代码的正确性。虽然你必须能够改变它。我想应该在 build.xml 文件（ant 构建脚本）中进行更改，以防止这种耗时的习惯。

# .net - 使用 GetGlobalResourceObject 选择资源文件，读取当前文化

> ID：840222
> 
> 赞同：1
> 
> 时间：2009-05-08T14:58:52.897
> 
> 标签：.net, asp.net

在根据每个用户设置设置 CurrentUICulture 后，我正在使用 GetGlobalResourceObject 对网站上的语言进行本地化。

我还使用通过 GetGlobalResourceObject 检索到的文本创建电子邮件，该文本发送给另一个用户。是否可以选择 GetGlobalResourceObject 使用的语言文件，以便以收件人而不是发件人的语言发送电子邮件（默认情况下发生）。

谢谢，帕特里克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T10:49:17.567

找到正确的链接后很简单：

[http://msdn.microsoft.com/en-us/library/ms149949.aspx](http://msdn.microsoft.com/en-us/library/ms149949.aspx)

# javascript - 使用 Google AJAX 库 API 时将 jQuery 注入页面失败

> ID：840240
> 
> 赞同：4
> 
> 时间：2009-05-08T15:01:06.010
> 
> 标签：javascript, jquery, google-ajax-libraries

我想使用 Google AJAX Libraries API 将 jQuery 注入页面，我想出了以下解决方案：

**[http://my-domain.com/inject-jquery.js](http://my-domain.com/inject-jquery.js)：**

```
;((function(){

  // Call this function once jQuery is available
  var func = function() {
    jQuery("body").prepend('<div>jQuery Rocks!</div>');
  };

  // Detect if page is already using jQuery
  if (!window.jQuery) {
    var done = false;
    var head = document.getElementsByTagName('head')[0];
    var script = document.createElement("script");
    script.src = "http://www.google.com/jsapi";
    script.onload = script.onreadystatechange = function(){

      // Once Google AJAX Libraries API is loaded ...
      if (!done && (!this.readyState || this.readyState == "loaded" || this.readyState == "complete")) {

        done = true;

        // ... load jQuery ...
        window.google.load("jquery", "1", {callback:function(){

          jQuery.noConflict();

          // ... jQuery available, fire function.
          func();
        }});

        // Prevent IE memory leaking
        script.onload = script.onreadystatechange = null;
        head.removeChild(script);
      }
    }

    // Load Google AJAX Libraries API
    head.appendChild(script);

  // Page already using jQuery, fire function
  } else {
    func();
  }
})()); 
```

然后该脚本将包含在单独域的页面中：

**[http://some-other-domain.com/page.html](http://some-other-domain.com/page.html)：**

```
<html>
  <head>
    <title>This is my page</title>
  </head>
  <body>
    <h1>This is my page.</h1>
    <script src="http://my-domain.com/inject-jquery.js"></script>
  </body>
</html> 
```

在 Firefox 3 中，我收到以下错误：

```
Module: 'jquery' must be loaded before DOM onLoad! jsapi (line 16) 
```

该错误似乎特定于 Google AJAX Libraries API，因为我看到其他人使用 jQuery 小书签将 jQuery 注入当前页面。我的问题：

*   有没有一种方法可以将 Google AJAX 库 API / jQuery 注入页面而不管 onload/onready 状态如何？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-08T16:06:55.307

如果您正在注入，那么在不使用 google 加载程序的情况下请求脚本可能会更容易：

```
(function() {
    var script = document.createElement("script");
    script.src = "http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js";
    script.onload = script.onreadystatechange = function(){ /* your callback here */ };
    document.body.appendChild( script );
})() 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-22T21:52:24.917

在我们找到不同的解决方案后，我发现了这篇文章。所以出于某种原因，如果你不能使用公认的解决方案，这个似乎工作正常：

```
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript">
    if (typeof jQuery == 'undefined') {
        // jQuery hasn't been loaded... so let's write it into the head immediately.
        document.write('<script type="text/javascript" src="/jquery-1.3.2.min.js"><\/script>')
        }
</script> 
```

已接受的解决方案的一个问题是，您被迫将要在页面上运行的所有代码放入回调函数中。因此，任何需要 jQuery（如插件）的东西都需要从该函数中调用。并且，所有其他需要 jQuery 的包含的 JS 文件都依赖于在所有其他脚本触发之前加载 jQuery。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-18T04:03:47.443

我得到它的工作！！！！我通过查看应用程序游乐场想通了......

这是开始使用 jquery 的包装器.... 在函数中添加警报以查看它的工作情况

```
google.load("jquery", "1.4.2");

function OnLoad(){
    $(function(){

    });
}

google.setOnLoadCallback(OnLoad); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-10-25T17:51:16.347

您可以使用不那么痛苦的解决方案将 jquery（可用的最新稳定版本）注入任何页面。

[jQuerify](https://chrome.google.com/webstore/detail/jquerify/gbmifchmngifmadobkcpijhhldeeelkc) - 用于将 jQuery（可用的最新稳定版本）注入任何网页（甚至是 HTTPS）的 Chrome 扩展程序”

# visual-studio - Windows 资源管理器 - 相同文件扩展名的动态图标

> ID：840241
> 
> 赞同：3
> 
> 时间：2009-05-08T15:01:12.080
> 
> 标签：visual-studio, icons, windows-explorer

对于 Visual Studio .sln 文件，Window Explorer 正在做一些“聪明”的事情来确定是显示 v8 还是 v9 图标。

现在双击/启动图标时，我知道它通过“Visual Studio Launcher”应用程序查看 sln 文件中的版本信息并有选择地运行 VS2005 或 VS2008

但是任何想法它是如何完成图标部分的。据推测，只需浏览一个文件夹，就会在后台打开文件并决定使用哪个图标，但它是如此无缝/快速。

知道它是如何完成的。我们这里有配置生成器，它由 ClickOnce 更新部署，但人们可以一目了然地看到生成器应用程序的哪个版本创建了配置文件。

干杯，

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T15:13:07.027

我想这就是你要找的吗？

[如何创建图标处理程序](http://msdn.microsoft.com/en-us/library/cc144122(VS.85).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T15:06:55.403

[查看自定义图标](http://www.codeproject.com/KB/shell/shellextguide9.aspx)[外壳扩展教程](http://www.codeproject.com/KB/shell/shellextguideindex.aspx)的这一部分。

# jquery - Javascript 日历 - Jquery 已在网站上使用

> ID：840242
> 
> 赞同：0
> 
> 时间：2009-05-08T15:01:43.873
> 
> 标签：jquery, calendar

一位客户在其业务中使用雅虎日历。他要求我创建一个日历来显示他在雅虎上所做的事件更新。

我已经在网站上使用 Jquery，如果可能的话，我更愿意使用它。

我看到有 datepicker 等，但这只需要在他的网站上显示雅虎或谷歌（他说他愿意切换他的日历服务）日历。

谢谢。

-布赖恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T20:25:32.113

Your client will have to switch to Google Calendar since Yahoo Calendar doesn't provide a way to embed a calendar.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T15:07:58.490

你的意思是你只想在网页上嵌入他的雅虎/谷歌日历？如果是这样，为什么不直接使用 iframe 呢？

[本文](http://www.google.com/support/calendar/bin/answer.py?hl=en&answer=41207)将指导您嵌入 Google 日历。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T15:36:50.900

您可以使用[谷歌日历小工具](http://code.google.com/apis/calendar/calendar_gadgets.html)。

也请查看此链接：

*   [Google 可嵌入日历助手](http://www.google.com/calendar/embedhelper)
*   [关于谷歌日历](http://www.google.com/googlecalendar/event_publisher_guide.html)

# language-agnostic - 程序部署和克隆环境

> ID：840244
> 
> 赞同：1
> 
> 时间：2009-05-08T15:02:15.743
> 
> 标签：language-agnostic, deployment, clone

我正在我的机器上开发一个 java 程序。当我想测试时，我首先在我的机器上尝试小测试用例，然后我想用真实数据运行这个程序。一个小测试是查看 linux 内核中的一个文件，而“真正的”测试是查看整个内核......

但我想同时运行多个“真实”测试（在不同版本的内核上），所以我有 5 台相同的测试机器（运行 linux fedora）。如何在数据和程序方面同步这 5 台机器（我有时使用 yum 安装程序）？

我怎样才能确定我在任何时候都拥有完全相同的环境？

现在我主要使用scp，我的代码在svn上......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T15:08:04.387

我建议使用像 VMware 这样的虚拟化技术将一个实例克隆为多个。这样做的好处是始终能够在测试后回到相同的起点，并且能够运行比物理盒子更多的场景。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T20:40:28.677

您可以让您的基准测试工具通过**http**或其他一些流行的协议获取新版本的程序和测试数据。如果您不想使用 http，您可以考虑使用网络文件系统（例如**NFS**和**GlusterFS**）。

在我看来，您将在单个“主”服务器上启动您的脚本，然后它会产生 5 个 bash 进程。他们每个人都将登录到远程“从”服务器并执行基准测试工具。基准测试工具将从某个（可能是“主”）服务器获取新程序和数据，然后执行它，测量时间/内存/等并在标准输出上返回这些值，因此 ssh 会将其传递回主服务器服务器，它是 bash 进程。然后，您将 bash 会话输出重定向到文件。

```
testmaster.sh -> 5*(testnode.sh -> ssh
-> fetch_and_benchmark -> output -> (ssh) -> testnode.sh -> file) 
```

testmaster.sh 必须每秒检查所有文件是否已经存在，然后读取并比较结果。这听起来可能很糟糕，但相信我，如果你不手动完成所有这些事情会更好，而且脚本相对容易编写。

关于确保您在所有盒子上拥有相同的环境......不要让任何人靠近您的测试节点并且不要对它们做任何事情。

我不建议虚拟化，因为它会以您无法预测的方式改变您的测试结果。虚拟机不能像纯机一样快，也不仅仅是“它慢了 20%”。有些事情要慢得多，有些则慢得多。如果您不介意，请使用虚拟化和快照，但您说您在多个节点上测试事物，每个节点都有不同的内核，所以我想您会非常认真地对待它。

啊，还有一件事。Linux 有一种有趣的释放内存的方式（就像“在有人需要它之前不要释放它”）。有些东西会被缓存。可以肯定的是，您必须在每次测试会话后重新启动测试机器。

# asp.net - IPostBackEventHandler RaisePostBackEvent 未在异步回发时触发

> ID：840249
> 
> 赞同：1
> 
> 时间：2009-05-08T15:03:17.083
> 
> 标签：asp.net, asynchronous, postback

我设计了一个自定义的用户控件，基本上是一个按钮，实现了`IPostBackEventHandler`界面，并且很明显的定义了`RaisePostBackEvent(string eventArgument)`方法，在这里我做一些处理，基本上我触发其他事件。

默认情况下，当单击时，我的控件将执行`__doPostBack`其客户端 ID 以刷新整个页面，当然会触发 RaisePostBackEvent。

但是，我希望能够使用控件来刷新更新面板，因此从客户端我使用`__doPostBack`带有更新面板 ID 和附加参数的方法。

问题是`RaisePostBackEvent`没有触发。我知道我可以查看`Page.Request.Params["__EVENTARGUMENT"]`并做任何我需要的事情，但我真的想要简单而优雅的东西，`IPostBackEventHandler`以便让所有逻辑都在我的控制之中。

长话短说，`RaisePostBackEvent`如果我有异步回发，我该如何触发？或者是否有其他具有类似功能的界面？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-10T19:27:49.520

问题是（如果我正确理解您的问题）调用 __doPostBack 的控件必须实现 IPostBackEventHandler 接口。因此，例如，如果我在用户控件（实现 IPostBackEventHander）中有此标记：

```
<asp:Button runat="server"
     UseSubmitBehavior="false" ID="Button"
     Text="Update"
     OnClientClick="myfunction();"/> 
```

myfunction javascript 必须如下所示：

```
<script type="text/javascript">
    function myfunction(param)   
    {
        __doPostBack("<%= this.UniqueID %>", "myargs");    
    }
</script> 
```

请注意，我发送的是 this.UniqueID 而不是 Button.UniqueID，因为按钮没有实现 IPostBackEventHander 但用户控件实现了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-14T08:33:05.877

我遇到了同样的问题，在寻找解决方案时发现了这个主题。我找到了它，因此我将其发布以帮助可能遇到相同问题的开发人员。

在 UserControl 中实现 IPostBackEventHandler 接口：

```
Public Class UserControl_Rattachement
Inherits System.Web.UI.UserControl
Implements ICallbackEventHandler, IPostBackEventHandler 
```

在 RaisePostBackEvent 函数中，调用 UpdatePanel 的 Update() 方法：

```
Public Sub RaisePostBackEvent(eventArgument As String) Implements System.Web.UI.IPostBackEventHandler.RaisePostBackEvent
    // Code executed during the PostBack
    UpdatePanel1.Update()
End Sub 
```

在 UserControl 的 Page_Load 方法中，将 PostBack 定义为异步：

```
Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    ScriptManager.GetCurrent(Page).RegisterAsyncPostBackControl(Me)
End Sub 
```

现在在 Render 方法中添加客户端脚本：

```
Protected Overrides Sub Render(writer As System.Web.UI.HtmlTextWriter)
    MyBase.Render(writer)

    Dim postbackReference As String = Page.ClientScript.GetPostBackEventReference(Me, Nothing, True)
    Dim postbackScript As String = String.Format("function updateRattachement() {{ {0}; }}", postbackReference)

    writer.WriteLine("<script type=""text/javascript"">")
    writer.WriteLine(postbackScript)
    writer.WriteLine("</script>")
End Sub 
```

然后，在需要时调用客户端函数：

```
updateRattachement(); 
```

PostBack 将是异步的，这将刷新您指定的 UpdatePanel。

我希望这会有所帮助，对我的英语感到抱歉。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-11-14T05:45:25.980

```
此行是关键或自定义点击事件忽略更新面板
// ScriptManager.GetCurrent(Page).RegisterAsyncPostBackControl(this);并注意页面定义中的 IPostBackEventHandler 部分

```
在此示例中，普通按钮和自定义单击事件 div 在更新面板中一起工作

```

公共部分类 tmp2：System.Web.UI.Page，IPostBackEventHandler
{

protected void Page_Load(object sender, EventArgs e)
{
    ScriptManager.GetCurrent(Page).RegisterAsyncPostBackControl(this);
    if (!Page.IsPostBack)
    {
        div1.Attributes["onclick"] = ClientScript.GetPostBackEventReference(this, "ClickDiv");
    }
}
protected void Button1_Click(object sender, EventArgs e)
{
    Label1.Text += "1";
    UpdatePanel1.Update();
}
protected void Div1_Click()
{

    div1.InnerHtml += "b";
    UpdatePanel1.Update();

}

public void RaisePostBackEvent(string eventArgument)
{

    if (!string.IsNullOrEmpty(eventArgument))
    {

        if (eventArgument == "ClickDiv")
        {

            Div1_Click();

        }

    }

} 
```

}

# flash - COMException (8004014) 在 Vista x64 上的 VS2008 中使用 ShockwaveFlashObjects

> ID：840252
> 
> 赞同：0
> 
> 时间：2009-05-08T15:03:52.213
> 
> 标签：flash, com

我正在尝试在我的应用程序中嵌入一个 Flash 对象。我添加了对 ShockwaveFlash COM 对象的引用，但应用程序在实例化时失败：

```
ShockwaveFlashObjects.ShockwaveFlashClass shockwave = new ShockwaveFlashObjects.ShockwaveFlashClass(); 
```

出现以下错误：

> System.Runtime.InteropServices.COMException：检索具有 CLSID {D27CDB6E-AE6D-11CF-96B8-444553540000} 的组件的 COM 类工厂失败，原因是以下错误：80040154。

我正在运行 Vista x64，这可能是问题吗？

以前有人经历过吗？任何想法如何解决这个错误？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T16:51:19.553

80040154 是 REGDB_E_CLASSNOTREG。最有可能的是，您的代码在 64 位进程中运行，但 Shockwave 仅安装用于 32 位。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-02T13:45:16.207

但是当我将 Target CPU 从“Any”更改为“x86”时，它起作用了。

# sql - SQL - 如何在没有源表的情况下创建多行结果

> ID：840254
> 
> 赞同：1
> 
> 时间：2009-05-08T15:04:07.297
> 
> 标签：sql

在标准 SQL 中，有没有办法说：

```
select mubmle as x from mumblemmble 
```

并得到不止一行的结果，像这样

```
 x
 _ 
 1
 2
 3 
```

不创建临时表？如果我知道某个表有足够的行，我可以使用 row_count() 在 SQL Server 中执行此操作，例如：

```
 select row_number() over (order by x.SomeColumn) from 
(select top 24 SomeColumn from TableThatHasAtLeast24Rows) x 
```

但是想知道是否有一种标准（不那么愚蠢）的方法来做到这一点。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T15:11:58.043

没有标准的方法，在`MySQL`.

在`Oracle`：

```
SELECT  *
FROM    dual
CONNECT BY
        level < n 
```

在`MS SQL`：

```
WITH hier(row) AS
        (
        SELECT  1
        UNION ALL
        SELECT  row + 1
        FROM    hier
        WHERE   row < n
        )
SELECT  *
FROM    hier
OPTION (MAXRECURSION 0) 
```

在`PostgreSQL`：

```
SELECT  *
FROM    generate_series (1, n) 
```

请注意`MS SQL`，与 不同的是`Oracle`，它不能将递归堆栈交换到临时表空间中，因此在生成大型数据集时可能会遇到麻烦。

有关更多详细信息，请参阅[**此答案**](https://stackoverflow.com/questions/701444/how-do-i-make-a-row-generator-in-mysql/707845)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T16:00:54.213

SQL 2003 标准定义了一种实现方式——但并非所有 DBMS 都实现它：

```
<table value constructor> ::= VALUES <row value expression list>

<row value expression list> ::= <table row value expression>
                            [ { <comma> <table row value expression> }... ]

<row value expression> ::= 
         <row value special case>
     |   <explicit row value constructor>

<table row value expression> ::= 
         <row value special case>
     |   <row value constructor> 
```

而且，在经历了许多其他 BNF 之后，您会发现：

```
<explicit row value constructor> ::= 
         <left paren> <row value constructor element> <comma>
                      <row value constructor element list> <right paren>
     |   ROW <left paren> <row value constructor element list> <right paren>
     |   <row subquery>

<row value constructor element list> ::= 
     <row value constructor element>
     [ { <comma> <row value constructor element> }... ]

<row value constructor element> ::= <value expression> 
```

翻译时，这意味着在某些情况下，您可以使用：

```
 VALUES (v1a, v1b, v1c), (v2a, v2b, v2c) 
```

创建一个表值，每行包含两行和三列。INSERT 语句是您可以使用该构造的一个地方。另一个是在 SELECT 语句的 FROM 子句中，尽管显示足够的 BNF 来连接点将占用比 SO 鼓励的答案更多的空间。

# web-services - javaFX作为Web服务客户端？

> ID：840257
> 
> 赞同：0
> 
> 时间：2009-05-08T15:04:13.320
> 
> 标签：web-services, javafx

我需要从 JavaFX 客户端调用 Web 服务。

是否有某种 wsimport 类型的工具可用于从已部署的 WSDL 生成 JavaFX 客户端存根？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-09T08:48:55.133

JavaFX 仅支持开箱即用的 RESTfull Web 服务。但是，您可以使用现有的 Java 工具来生成 WSDL 存根，并使用从 JavaFX 脚本类生成的类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T15:18:02.477

您可以制作 Java 类存根并从 javaFX 调用它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T21:58:32.933

是的，

假设您有一个“MyJavaClass.java”

```
import somePackadge.MyJavaClass
...

var myObject:MyJavaClass = new MyJavaClass();

myObject.setSomething("this is something");

println("{myObject.getSomething()}");

... 
```

有关详细信息，请参阅“ [http://java.sun.com/developer/technicalArticles/scripting/javafx/javafx_and_java/](http://java.sun.com/developer/technicalArticles/scripting/javafx/javafx_and_java/) ”

# vb.net - 从vb.net的gridview中的图像按钮获取行的ID

> ID：840260
> 
> 赞同：0
> 
> 时间：2009-05-08T15:04:28.560
> 
> 标签：vb.net, gridview, imagebutton

我有一个gridview，在那个gridview中，我使用addhandler以编程方式创建了一个imagebuttons列表，如下所示：

```
Dim deletecshr As New ImageButton
deletecshr.ImageUrl = "\images\bttnDeletemini.gif"
deletecshr.ToolTip = "This Will Delete All Cashiers"
AddHandler deletecshr.Click, AddressOf deletecshr_Click
deletecshr.Attributes.Add("onclick", "javascript: if(confirm('Are you sure you want to delete all of these cashiers?')==false) return false;")

    If e.Row.Cells.Count > 2 And e.Row.RowType <> DataControlRowType.Header And e.Row.RowType <> DataControlRowType.Footer Then
        e.Row.Cells(3).Controls.Add(deletecshr)
    End If 
```

我的问题是在单击处理程序中获取单击的图像按钮行的值。我怎么得到那个？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T15:16:52.883

我建议分配

```
imageButton.CommandName = "Delete"
imageButton.CommandArgument = Your_Row_ID_You_Want_To_Get 
```

然后使用 imageButton.OnCommand 完成您的工作。

**编辑：** 以下是要遵循的步骤：

1.  在 RowCreated 中创建图像按钮
2.  在 RowDataBound 中分配图像按钮的 CommandName 和 CommandArgument
3.  在 RowCommand 中，检查该行的图像按钮 CommandArgument，您应该会看到之前存储在那里的 ID。

# c# - 将参数传递给模板类型的 C# 泛型 new()

> ID：840261
> 
> 赞同：451
> 
> 时间：2009-05-08T15:04:29.653
> 
> 标签：c#, .net, generics, new-operator

添加到列表时，我试图通过其构造函数创建一个类型为 T 的新对象。

我收到编译错误：错误消息是：

> “T”：创建变量实例时无法提供参数

但是我的类确实有一个构造函数参数！我怎样才能使这项工作？

```
public static string GetAllItems<T>(...) where T : new()
{
   ...
   List<T> tabListItems = new List<T>();
   foreach (ListItem listItem in listCollection) 
   {
       tabListItems.Add(new T(listItem)); // error here.
   } 
   ...
} 
```

* * *

## 回答 #1

> 赞同：434
> 
> 时间：2009-05-08T15:11:04.287

为了在函数中创建泛型类型的实例，您必须使用“new”标志对其进行约束。

```
public static string GetAllItems<T>(...) where T : new() 
```

但是，这仅在您要调用没有参数的构造函数时才有效。不是这里的情况。相反，您必须提供另一个参数，该参数允许基于参数创建对象。最简单的是函数。

```
public static string GetAllItems<T>(..., Func<ListItem,T> del) {
  ...
  List<T> tabListItems = new List<T>();
  foreach (ListItem listItem in listCollection) 
  {
    tabListItems.Add(del(listItem));
  }
  ...
} 
```

然后你可以这样称呼它

```
GetAllItems<Foo>(..., l => new Foo(l)); 
```

* * *

## 回答 #2

> 赞同：360
> 
> 时间：2011-04-08T18:02:03.380

在 .Net 3.5 和之后您可以使用激活器类：

```
(T)Activator.CreateInstance(typeof(T), args) 
```

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2010-06-16T15:39:06.843

由于没有人费心发布“反思”答案（我个人认为这是最好的答案），所以这里是：

```
public static string GetAllItems<T>(...) where T : new()
{
   ...
   List<T> tabListItems = new List<T>();
   foreach (ListItem listItem in listCollection) 
   {
       Type classType = typeof(T);
       ConstructorInfo classConstructor = classType.GetConstructor(new Type[] { listItem.GetType() });
       T classInstance = (T)classConstructor.Invoke(new object[] { listItem });

       tabListItems.Add(classInstance);
   } 
   ...
} 
```

编辑：由于 .NET 3.5 的 Activator.CreateInstance，此答案已被弃用，但它在较旧的 .NET 版本中仍然有用。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2012-02-22T20:39:40.100

**对象初始化器**

如果带有参数的构造函数除了设置属性之外没有做任何事情，则可以在 C# 3 中执行此操作，或者使用[对象初始化器](http://msdn.microsoft.com/en-us/library/bb384062(v=vs.100).aspx)而不是调用构造函数更好地执行此操作（如前所述，这是不可能的）：

```
public static string GetAllItems<T>(...) where T : new()
{
   ...
   List<T> tabListItems = new List<T>();
   foreach (ListItem listItem in listCollection) 
   {
       tabListItems.Add(new T() { YourPropertyName = listItem } ); // Now using object initializer
   } 
   ...
} 
```

使用它，您也可以始终将任何构造函数逻辑放入默认（空）构造函数中。

**激活器.CreateInstance()**

或者，您可以像这样调用[Activator.CreateInstance()](http://msdn.microsoft.com/en-us/library/system.activator.createinstance.aspx)：

```
public static string GetAllItems<T>(...) where T : new()
{
   ...
   List<T> tabListItems = new List<T>();
   foreach (ListItem listItem in listCollection) 
   {
        object[] args = new object[] { listItem };
        tabListItems.Add((T)Activator.CreateInstance(typeof(T), args)); // Now using Activator.CreateInstance
   } 
   ...
} 
```

请注意，如果执行速度是重中之重并且您可以维护另一个选项，则Activator.CreateInstance 可能会产生一些[性能开销，您可能希望避免这些开销。](https://stackoverflow.com/questions/6069661/does-system-activator-createinstancet-have-performance-issues-big-enough-to-di)

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2016-10-10T15:07:58.390

非常老的问题，但新的答案;-)

**ExpressionTree 版本**：（*我认为最快和最干净的解决方案）*

正如*Welly Tambunan*所说，*“我们也可以使用表达式树来构建对象”*

这将为给定的类型/参数生成一个“构造函数”（函数）。它返回一个委托并接受参数类型作为对象数组。

这里是：

```
// this delegate is just, so you don't have to pass an object array. _(params)_
public delegate object ConstructorDelegate(params object[] args);

public static ConstructorDelegate CreateConstructor(Type type, params Type[] parameters)
{
    // Get the constructor info for these parameters
    var constructorInfo = type.GetConstructor(parameters);

    // define a object[] parameter
    var paramExpr = Expression.Parameter(typeof(Object[]));

    // To feed the constructor with the right parameters, we need to generate an array 
    // of parameters that will be read from the initialize object array argument.
    var constructorParameters = parameters.Select((paramType, index) =>
        // convert the object[index] to the right constructor parameter type.
        Expression.Convert(
            // read a value from the object[index]
            Expression.ArrayAccess(
                paramExpr,
                Expression.Constant(index)),
            paramType)).ToArray();

    // just call the constructor.
    var body = Expression.New(constructorInfo, constructorParameters);

    var constructor = Expression.Lambda<ConstructorDelegate>(body, paramExpr);
    return constructor.Compile();
} 
```

* * *

**示例 MyClass：**

```
public class MyClass
{
    public int TestInt { get; private set; }
    public string TestString { get; private set; }

    public MyClass(int testInt, string testString)
    {
        TestInt = testInt;
        TestString = testString;
    }
} 
```

* * *

**用法：**

```
// you should cache this 'constructor'
var myConstructor = CreateConstructor(typeof(MyClass), typeof(int), typeof(string));

// Call the `myConstructor` function to create a new instance.
var myObject = myConstructor(10, "test message"); 
```

[![在此处输入图像描述](https://i.stack.imgur.com/AzmK4.png)](https://i.stack.imgur.com/AzmK4.png)

* * *

*另一个例子：将类型作为数组传递*

```
var type = typeof(MyClass);
var args = new Type[] { typeof(int), typeof(string) };

// you should cache this 'constructor'
var myConstructor = CreateConstructor(type, args);

// Call the `myConstructor` fucntion to create a new instance.
var myObject = myConstructor(10, "test message"); 
```

* * *

**表达式的DebugView**

```
.Lambda #Lambda1<TestExpressionConstructor.MainWindow+ConstructorDelegate>(System.Object[] $var1) {
    .New TestExpressionConstructor.MainWindow+MyClass(
        (System.Int32)$var1[0],
        (System.String)$var1[1])
} 
```

* * *

**这等效于生成的代码：**

```
public object myConstructor(object[] var1)
{
    return new MyClass(
        (System.Int32)var1[0],
        (System.String)var1[1]);
} 
```

* * *

**小缺点**

所有值类型参数在像对象数组一样传递时都会被装箱。

* * *

**简单的性能测试：**

```
private void TestActivator()
{
    Stopwatch sw = Stopwatch.StartNew();
    for (int i = 0; i < 1024 * 1024 * 10; i++)
    {
        var myObject = Activator.CreateInstance(typeof(MyClass), 10, "test message");
    }
    sw.Stop();
    Trace.WriteLine("Activator: " + sw.Elapsed);
}

private void TestReflection()
{
    var constructorInfo = typeof(MyClass).GetConstructor(new[] { typeof(int), typeof(string) });

    Stopwatch sw = Stopwatch.StartNew();
    for (int i = 0; i < 1024 * 1024 * 10; i++)
    {
        var myObject = constructorInfo.Invoke(new object[] { 10, "test message" });
    }

    sw.Stop();
    Trace.WriteLine("Reflection: " + sw.Elapsed);
}

private void TestExpression()
{
    var myConstructor = CreateConstructor(typeof(MyClass), typeof(int), typeof(string));

    Stopwatch sw = Stopwatch.StartNew();

    for (int i = 0; i < 1024 * 1024 * 10; i++)
    {
        var myObject = myConstructor(10, "test message");
    }

    sw.Stop();
    Trace.WriteLine("Expression: " + sw.Elapsed);
}

TestActivator();
TestReflection();
TestExpression(); 
```

结果：

```
Activator: 00:00:13.8210732
Reflection: 00:00:05.2986945
Expression: 00:00:00.6681696 
```

使用比调用快`Expressions`+/- **8 倍，**比使用快`ConstructorInfo`+/- **20 倍**`Activator`

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2009-05-08T15:13:01.207

这在您的情况下不起作用。您只能指定它具有空构造函数的约束：

```
public static string GetAllItems<T>(...) where T: new() 
```

你可以做的是通过定义这个接口来使用属性注入：

```
public interface ITakesAListItem
{
   ListItem Item { set; }
} 
```

然后你可以改变你的方法是这样的：

```
public static string GetAllItems<T>(...) where T : ITakesAListItem, new()
{
   ...
   List<T> tabListItems = new List<T>();
   foreach (ListItem listItem in listCollection) 
   {
       tabListItems.Add(new T() { Item = listItem });
   } 
   ...
} 
```

另一种选择是`Func`JaredPar 描述的方法。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2010-04-30T17:45:53.223

如果您只是想使用构造函数参数初始化成员字段或属性，在 C# >= 3 中，您可以更轻松地做到这一点：

```
public static string GetAllItems<T>(...) where T : InterfaceOrBaseClass, new() 
{ 
   ... 
   List<T> tabListItems = new List<T>(); 
   foreach (ListItem listItem in listCollection)  
   { 
       tabListItems.Add(new T{ BaseMemberItem = listItem }); // No error, BaseMemberItem owns to InterfaceOrBaseClass. 
   }  
   ... 
} 
```

这与加里·舒特勒所说的相同，但我想补充一点。

当然，您可以使用属性技巧来做更多的事情，而不仅仅是设置字段值。属性“set()”可以触发设置其相关字段所需的任何处理以及对象本身的任何其他需求，包括检查是否在使用对象之前进行完全初始化，模拟完全构造（是的，这是一个丑陋的解决方法，但它克服了 M$ 的 new() 限制）。

我无法确定这是计划中的漏洞还是意外的副作用，但它确实有效。

很有趣的是，MS 人如何为语言添加新功能并且似乎没有进行完整的副作用分析。整个通用的东西就是一个很好的证据......

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-05-08T15:06:56.073

您需要添加 where T: new() 以让编译器知道 T 保证提供默认构造函数。

```
public static string GetAllItems<T>(...) where T: new() 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2017-07-13T15:04:51.480

如果您可以访问要使用的类，则可以使用我使用的这种方法。

创建一个具有替代创建者的界面：

```
public interface ICreatable1Param
{
    void PopulateInstance(object Param);
} 
```

用一个空的创建者创建你的类并实现这个方法：

```
public class MyClass : ICreatable1Param
{
    public MyClass() { //do something or nothing }
    public void PopulateInstance (object Param)
    {
        //populate the class here
    }
} 
```

现在使用您的通用方法：

```
public void MyMethod<T>(...) where T : ICreatable1Param, new()
{
    //do stuff
    T newT = new T();
    T.PopulateInstance(Param);
} 
```

* * *

如果您无权访问，请包装目标类：

```
public class MyClass : ICreatable1Param
{
    public WrappedClass WrappedInstance {get; private set; }
    public MyClass() { //do something or nothing }
    public void PopulateInstance (object Param)
    {
        WrappedInstance = new WrappedClass(Param);
    }
} 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2015-11-06T11:13:17.563

我发现我收到一个错误“在创建类型参数 T 的实例时无法提供参数”，所以我需要这样做：

```
var x = Activator.CreateInstance(typeof(T), args) as T; 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-11-12T11:38:39.893

这有点糊涂，当我说有点糊涂时，我的意思可能是令人反感，但是假设您可以为参数化类型提供一个空的构造函数，那么：

```
public static T GetTInstance<T>() where T: new()
{
    var constructorTypeSignature = new Type[] {typeof (object)};
    var constructorParameters = new object[] {"Create a T"};
    return (T) new T().GetType().GetConstructor(constructorTypeSignature).Invoke(constructorParameters);
} 
```

将有效地允许您从带有参数的参数化类型构造对象。在这种情况下，我假设我想要的构造函数有一个 type 参数`object`。我们使用约束允许的空构造函数创建一个 T 的虚拟实例，然后使用反射来获取它的其他构造函数之一。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-01-30T13:53:07.557

我有时会使用类似于使用属性注入的答案的方法，但可以保持代码更清洁。它没有具有一组属性的基类/接口，而是仅包含一个（虚拟）Initialize() 方法，该方法充当“穷人的构造函数”。然后你可以让每个类像构造函数一样处理它自己的初始化，这也增加了一种处理继承链的方便方式。

如果经常发现自己处于希望链中的每个类初始化其唯一属性的情况，然后调用其父级的 Initialize() 方法，该方法又会初始化父级的唯一属性等等。这在具有不同类但具有相似层次结构的情况下特别有用，例如映射到/来自 DTO:s 的业务对象。

使用通用字典进行初始化的示例：

```
void Main()
{
    var values = new Dictionary<string, int> { { "BaseValue", 1 }, { "DerivedValue", 2 } };

    Console.WriteLine(CreateObject<Base>(values).ToString());

    Console.WriteLine(CreateObject<Derived>(values).ToString());
}

public T CreateObject<T>(IDictionary<string, int> values)
    where T : Base, new()
{
    var obj = new T();
    obj.Initialize(values);
    return obj;
}

public class Base
{
    public int BaseValue { get; set; }

    public virtual void Initialize(IDictionary<string, int> values)
    {
        BaseValue = values["BaseValue"];
    }

    public override string ToString()
    {
        return "BaseValue = " + BaseValue;
    }
}

public class Derived : Base
{
    public int DerivedValue { get; set; }

    public override void Initialize(IDictionary<string, int> values)
    {
        base.Initialize(values);
        DerivedValue = values["DerivedValue"];
    }

    public override string ToString()
    {       
        return base.ToString() + ", DerivedValue = " + DerivedValue;
    }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-10-01T10:20:39.157

如果您只需要从 ListItem 转换为您的类型 T，您可以在 T 类中实现此转换作为转换运算符。

```
public class T
{
    public static implicit operator T(ListItem listItem) => /* ... */;
}

public static string GetAllItems(...)
{
    ...
    List<T> tabListItems = new List<T>();
    foreach (ListItem listItem in listCollection) 
    {
        tabListItems.Add(listItem);
    } 
    ...
} 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2021-08-01T18:49:25.690

*补充性能信息*

使用Jeroen van Langen的表达方法（见上）和直接实例化数据模型类进行数据库访问和填充数据模型类的性能测试。

结论：表达方式较快。

结果：

1.  测试：数据模型类的直接实例：记录：3558，秒：1.2746019
2.  测试：带有类型参数的方法读取列表的实例：记录：3558，秒：0.4878858

表达式方法的代码示例：

```
var list = ReadList<DataModel>(SQLStatement, Connection); 
```

方法 ReadList：注意：所有数据模型类都有一个参数类型为 SQLDataReader 的构造函数

```
public static List<pDataModel> ReadList<pDataModel>(string pSQLStatement, SqlConnection pConnection) where pDataModel : new()
    {
            // constructor of data model
            var lType = typeof(pDataModel);
            var lParameters = new Type[] { typeof(SqlDataReader) };
            var lDataModelConstructor = CreateConstructor(lType, lParameters);

            // read data
            List<pDataModel> lDataList = new List<pDataModel>();
            using (pConnection)
            {
                SqlCommand lCommand;
                lCommand = new SqlCommand(pSQLStatement, pConnection);
                pConnection.Open();
                SqlDataReader lReader = lCommand.ExecuteReader();

                if (lReader.HasRows)
                {
                    while (lReader.Read())
                    {
                        pDataModel lDataItem = (pDataModel)lDataModelConstructor(lReader);
                        lDataList.Add(lDataItem);
                    }
                }
                lReader.Close();
                pConnection.Close();
            }

            return lDataList;
    } 
```

直接实例化的代码示例：

```
 List<DataModel> list= new List<DataModel>();
            using (connection)
            {
                SqlCommand command;
                command = new SqlCommand(SQLStatement, connection);
                connection.Open();
                SqlDataReader reader = command.ExecuteReader();
                if (reader.HasRows)
                {
                    while (reader.Read())
                    {
                        list.Add(new DataModel(reader));
                    }
                }
                reader.Close();
                connection.Close();
            } 
```

* * *

## 回答 #15

> 赞同：-4
> 
> 时间：2009-05-08T15:08:05.120

我相信您必须使用 where 语句来约束 T 以仅允许具有新构造函数的对象。

现在它接受任何东西，包括没有它的对象。

# .net - 如何限制 ZedGraph Y Scale 中显示的小数位数？

> ID：840270
> 
> 赞同：1
> 
> 时间：2009-05-08T15:06:18.527
> 
> 标签：.net, graphing, zedgraph

我正在使用 ZedGraph 的主窗格来显示两个具有同步 X 轴的图形。当我放大其中一张图时遇到了问题。当我放大时，Y 轴将显示越来越多的小数位数，最终导致放大后的图比另一个图更窄，从而阻止它们的 X 轴精确排列。

我尝试过的解决方法：

*   将两个子窗格上的 YAxis.MinSpace 和 Y2Axis.MinSpace 设置得更大
*   使 YAxis.Scale.FontSpect.Size 更小

这两种方法都会有所帮助，但不能解决问题。最终，我将放大到足够多的程度，以使一张图在比例尺上显示足够多的小数位，从而使两张图不再具有相同的宽度。

我想我可以通过限制显示的小数位数来解决这个问题，但我找不到办法做到这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T09:34:31.757

对于固定的小数位数，您可以

```
GraphPane.YAxis.Scale.Format = "F0"; // 0 decimal places 
```

或者，如果您想有机会在决定小数位数之前检查当前的可见范围，您可以添加一个事件处理程序

```
GraphPane.YAxis.ScaleFormatEvent 
```

# asp.net - 仅在第二次单击时调用的事件处理程序

> ID：840275
> 
> 赞同：3
> 
> 时间：2009-05-08T15:07:27.010
> 
> 标签：asp.net, event-handling

我正在构建一个动态按钮视图，它根据数据库中的项目数量以编程方式添加按钮。就像一个简单的工作流引擎。在调用的第一页上，事件处理程序按预期工作。包含新项目的新页面被构建并返回给客户端。在第二次回发时，不会调用事件处理程序，并且视图保留相同的项目。通过重新单击同一个按钮（第三次回发），事件处理程序中的断点被击中。

我的问题是为什么即使我在每次回发时重建页面（覆盖 OnInit()）也没有调用事件处理程序？

有关信息：方法`LoadViewWithAlphabeticalDatasource()`和`LoadViewWithWorkflowItem()`做的完全一样，所以我在下面的部分中删除了一个。事件以相同的方式添加。

代码：

```
<pre>
   namespace EPS.Web.View.Article
   {
       public class DynamicGridView : BasePage, IDynamicGridView
       {

           protected override void OnInit(EventArgs e)
           {
               Presenter = new DynamicGridPresenter(this);
               if (IsPostBack)
               {
                   if (Presenter.Step smallerthan 2)
                   {
                       LoadViewWithAlphabeticalDatasource();
                   }
                   else
                   {
                       LoadViewWithWorkflowItem();
                   }
               }
           }

           [PageMethod]
           protected void Page_Load(object sender, EventArgs e)
           {
               if(!IsPostBack)
               {
                   SetSubmenuVisible = false;
                   Presenter.InitView();
                   PrepareView();
               }
               AddEvents();
               AddLabels();
               PageMethodsEngine.InvokeMethod(this);
           }

           private void Back_Clicked(object sender, EventArgs e)
           {
               Presenter.StepEngine(DynamicGridPresenter.BACK, string.Empty, string.Empty);
               PrepareView();
           }

           private void Cancel_Clicked(object sender, EventArgs e)
           {
               Presenter.StepEngine(DynamicGridPresenter.CANCEL, string.Empty, string.Empty);
               PrepareView();
           }

           private void ForwardString(object sender, EventArgs e)
           {
               Presenter.StepEngine(DynamicGridPresenter.FORWARD, ((LinkButton)sender).CommandArgument, string.Empty);
               PrepareView();
           }

          private void ForwardWorkflowItem(object sender, EventArgs e)
          {
              Presenter.StepEngine(DynamicGridPresenter.FORWARD, string.Empty, ((LinkButton)sender).CommandArgument);
              PrepareView();
          }

          protected void PrepareView()
          {
              phDynamicGridView.Controls.Clear();
              if (Presenter.Step smallerthan 2)
              {
                  LoadViewWithAlphabeticalDatasource();
              }
              else
              {
                  LoadViewWithWorkflowItem();
              }
          }

          private void LoadViewWithWorkflowItem()
          {
              var table = new HtmlTable();
              table.Attributes.Add("class", "tableDynamicGrid");
              int max = GetRowLength(WODatasource.Count);
              int temp = 1;
              int actualPosition = 0;
              int itr = 1;
              var tr = new HtmlTableRow();

              if (WODatasource.Count == 0)
              {
                  phDynamicGridView.Controls.Add(new HtmlTable());
                  return;
              }

              foreach (WorkflowItem s in WODatasource)
              {
                  if (actualPosition biggerOrEqual MaxLength && temp smallerOrEqual max)
                  {
                      table.Rows.Add(tr);
                      actualPosition = 0;
                      temp++;
                      tr = new HtmlTableRow();
                  }

                  actualPosition++;

                  var cell = new HtmlTableCell();
                  // cell.Attributes.Add("class", "cellDynamicGrid");
                  var btn = new LinkButton
                                {
                                    CommandArgument = s.Oid.ToString(),
                                    Text = s.SelectionItem.Name /*, CssClass = "linkButtonDynamicGrid"*/
                                };
                  btn.Click += ForwardWorkflowItem;

                  cell.Controls.Add(btn);
                  tr.Cells.Add(cell);

                  if (itr == WODatasource.Count && temp smallerOrEqual max)
                  {
                      while (itr biggerOrEqual WODatasource.Count && itr smallerThan max*MaxLength)
                      {
                          tr.Cells.Add(new HtmlTableCell());
                          itr++;
                      }
                      table.Rows.Add(tr);
                      phDynamicGridView.Controls.Add(table);
                      return;
                  }
                  itr++;
              }
          }

       }
 </pre> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T15:32:07.963

OnInit在调用 LoadPostData*之前*发生，这就是它似乎在第二次单击时起作用的原因。实际发生的是您正在处理来自先前回发的事件。

1.  Page_Init
2.  加载视图状态
3.  **加载邮政数据**
4.  Page_Load
5.  引发PostDataChangedEvent
6.  提高后退事件
7.  Page_PreRender
8.  保存视图状态
9.  Page_Render
10.  Page_UnLoad

这是来自 Asp.net 1.1 的事件的简化版本；2.0 之间插入了一些额外的事件，例如 OnPreInit。订单仍然存在。

您必须使用来自 Load 或更高版本的事件。有些人选择 PreRender，但 DataBinding 的约定是在 Load。

**更新**

我看到您正在向控件树动态添加控件。这充满了陷阱（但完全可行。）

a) 确保每次页面加载时都添加动态控件，而不仅仅是在回发时。回发/视图状态保持状态（即数据），而不是对象。您应该在 OnInit 中添加它们（OnLoad 也可以，但维护起来比较麻烦）。您目前只添加回发，这就是第二次回发有效的原因（而不是第一次）

b) 只初始化动态控件一次，就像您对任何其他控件一样 - 在 [!IsPostBack] 上，在 Load 中。

-Oisin

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T11:47:58.753

感谢大家帮助我。我找到了解决方案：

我不知道动态创建的按钮需要一个 ID 值。我建议 Asp 知道创建了哪个按钮。不幸的是我错了。.NET 似乎比较按钮上的 ID 而不是 ControlTree 中的位置。

我添加了

```
新按钮{ID = itr.ToString()}

```

现在，当服务器重建站点时，会触发事件处理程序。

关于 x。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T15:09:45.990

此类问题几乎总是将事件处理程序连接到页面生命周期中的错误位置的结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-25T17:27:37.570

我只是有一个类似的问题。我尝试了很多解决方案，但最后我注意到我的网络表单上的一个文本框正在发回服务器，这把事情搞砸了。这是一个很难捕捉的错误，因为我并不是想让我的文本框这样做。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-02-13T05:42:42.367

如果您在没有声明的情况下使用 ID 变量，这可能是问题的原因。更改您的 ID 变量名称的名称。

# emacs - Emacs 流浪模式编辑中的密码

> ID：840279
> 
> 赞同：16
> 
> 时间：2009-05-08T15:08:00.567
> 
> 标签：emacs, ssh, passwords, tramp

我正在使用 emacs [tramp 模式](http://www.emacswiki.org/emacs/TrampMode)通过 ssh 远程编辑文件。问题是每次我保存我正在编辑的文件时，我都必须输入我的用户密码。我觉得这很烦人。我怎样才能只写一次密码/编辑会话？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-08T15:33:33.967

啊，从关于密码缓存的[流浪汉文档](http://www.gnu.org/software/emacs/manual/html_node/tramp/Password-caching.html)中，您可以设置：

```
(setq password-cache-expiry nil) 
```

这需要包[password-cache.el](http://braeburn.aquamacs.org/code/master/lisp/password-cache.el)。

此外，在流浪汉源中，它提到阅读[ssh-agent(1)](http://www.openbsd.org/cgi-bin/man.cgi?query=ssh-agent)手册页，其中显示了如何设置它，以便您不必重新输入密码（在 Emacs 内部或外部）：

> 有两种主要的方式来设置代理：第一种是代理启动一个新的子命令，其中一些环境变量被导出，例如 ssh-agent xterm &。第二个是代理打印所需的 shell 命令（可以生成 sh(1) 或 csh(1) 语法），这些命令可以在调用 shell 中进行评估，例如 eval`ssh-agent -s`用于 Bourne 类型的 shell，例如 sh(1) 或ksh(1) 和 eval`ssh-agent -c`用于 csh(1) 和衍生物。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-08T15:36:20.607

```
(setq password-cache-expiry nil) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-08T15:55:56.347

除了[Trey Jackson 的解决方案](https://stackoverflow.com/questions/840279/passwords-in-emacs-tramp-mode-editing/840431#840431)之外，您还可以选择以下几种方式：

*   如果您在 *nix 系统上，您可以使用[FUSE/SSHFS](http://fuse.sourceforge.net/sshfs.html)挂载远程目录，因此您可以像在本地文件系统上一样编辑文件。

*   使用[SSH 公钥认证](http://sial.org/howto/openssh/publickey-auth/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-09T16:12:46.207

Using public key (RSA) authentication is more secure and much more convenient. On a GNU/Linux system (and maybe others, I don't know) you typically would unlock your private key once per login session with a password and then use it.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-09T05:44:26.543

use SSH public key authentication.

# ruby-on-rails - 什么是 Rails 方式（约定俗成）

> ID：840284
> 
> 赞同：0
> 
> 时间：2009-05-08T15:08:52.497
> 
> 标签：ruby-on-rails

在 Rails 中开发有时被描述为遵循“rails 方式”。并且约定优于配置也是 Rails 中一个非常重要的方面。

但是这些特定的约定是什么？例如使用活动记录？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T15:10:44.177

我建议您访问[therailsway.com](http://www.therailsway.com/)：

> Rails Way 是关于在 Rails 应用程序设计中教授“最佳实践”的全部内容。它由独立顾问兼 Rails 核心团队成员 Michael Koziarski 运营，在设计和构建 Web 应用程序方面拥有丰富的经验。

您还可以阅读[Rails 方式](https://rads.stackoverflow.com/amzn/click/com/0321445619)：

> 通过详细的代码示例，Obie 系统地介绍了 Rails 的关键功能和子系统。他介绍了先进的编程技术，介绍了有助于轻松采用 Rails 的开源库，并提供了对测试和生产部署的重要见解。一起深入了解 Rails 代码库，了解 Rails 为何如此行事，以及如何使其符合您的期望。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T15:11:25.830

首先是[命名约定](http://itsignals.cascadia.com.au/?p=7)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T21:43:19.273

你不必遵循惯例，但如果你这样做了，你会*更*快乐。

按照 Rails 期望的方式布置目录结构，它会自动知道在哪里查找内容。

将您的表命名为模型的复数形式，并包含一个 id 列，它会自动知道如何处理您的数据。

按照它的预期命名你的控制器、视图等，它会处理这么多的苦差事，如果你有选择的话，你会发疯的。

简而言之，而不是一个大的配置文件，只需按照 Rails 的预期做事，并且“配置”是免费的。它会让你成为一个更快乐的开发者。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-09T04:00:58.367

我认为“rails 方式”或“ruby 方式”是程序员在用 Ruby 编写时使用的普遍接受的语法和实践。所有语言都有类似的“最佳实践”习惯（例如，无论是否是“Pythonic”）。

将其与语言或框架使用的实际功能或预期约定区分开来很重要。这有点像书面语言的语法规则和定义特定写作类型的文体指南之间的区别。

我认为所有语言都有一定的偏见和优势，这使得某种“风格”的编程流行起来。迁移语言的人一开始可能会遇到困难，因为他们还没有学会如何用那种特定的语言写作。例如，许多来自严格 OO 环境的程序员可能无法理解如何使用 Ruby或在 Ruby 中工作`map()`。`inject()``lambda`

Ruby/Rails 中使用的许多约定对于其他平台来说可能看起来很陌生。熟悉“ruby 方式”的最好方法就是阅读大量源代码并记录人们似乎构建类、例程、文件结构等的方式。

还阅读其他人提到的两本“方法”书籍不会受到伤害。我拥有它们，它们是极好的资源。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T15:18:33.550

值得记住的是，因为我上周绊倒了它并且花了相当长的时间令人不快地感到困惑，所以名称以“_id”结尾的任何列都被视为外键，因此不包含在`content_columns`. 很合理，但我花了一些时间来追查为什么我的代码没有导出一个名为“sg_deal_id”的值。现在是“sg_deal_num”...

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-08T15:19:30.600

Rails 由 DHH 在 37signals 开发。他们[写了一本](http://gettingreal.37signals.com/)关于他们的最佳实践的书，不仅在编码方面，而且在设计和商业等方面。您可以在线免费阅读。这是从我认为是通用 Rails 开发人员的角度开始看待事物的好方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-11T10:35:38.257

我认为有几张海报过于关注问题中的“rails way”字面意思。

恕我直言，此时学习 Rails 的最佳方式是使用[官方 Rails 指南。](http://guides.rubyonrails.org/)

# java - 在不同的网络上时出现 JBoss UnknownHostException

> ID：840292
> 
> 赞同：3
> 
> 时间：2009-05-08T15:10:43.210
> 
> 标签：java, jboss, dns, rmi

我在让 JBoss 跨网络工作时遇到了一些问题。作为快速概述，我们有一个开发网络（我将其称为 DEV）和一个客户端网络（例如.. CLIENT！）。这些通过防火墙连接。在 Dev 网络中，服务器称为 192.168.100.50，在客户端网络中称为 10.0.100.50。两个网络中的 DNS 通过 DNS (sqlserver.dev.net) 解析相关 IP。

sqlserver 提供 2 种服务，一种通过 .NET Web 服务，另一种通过 JBoss。在 DEV 网络上运行客户端时，两种服务都可以正常工作。在 CLIENT 网络上时，只有 .NET 服务有效。

JBoss 客户端在尝试执行以下代码中的 ContextLookup 时会抛出 UnknownHostException：

```
Properties p = new Properties();
p.put("java.naming.factory.initial", "org.jnp.interfaces.NamingContextFactory");
p.put("java.naming.factory.url.pkgs", "=org.jboss.naming:org.jboss.jnp.interfaces");
p.put("java.naming.provider.url", "sqlserver.dev.net:1199");

try {
  Context c = new InitialContext(p);
  cm = (ServiceRemote)c.lookup(Service.RemoteJNDIName);
} catch (NamingException e) {
  e.printStackTrace();
  throw new RuntimeException(e);
} 
```

例外是：

> 根异常是 java.rmi.UnknownHostException：未知主机：SQLserver

我可以确认问题在于客户端正在尝试连接到没有域名的“sqlserver”。这已经通过将“sqlserver”添加到客户端的主机文件中进行了测试，并且工作正常。此外，“SQLserver”的拼写很有趣，因为这是 Windows 主机报告它的主机名的方式，而不是它在 DNS 中的存储方式。我最好的猜测是，一旦客户端建立初始连接，JBoss 会告诉客户端将来连接到“SQLserver”，客户端无法解决。

我已经尝试将以下系统属性设置为 sqlserver 的 FQDN：

> jgroups.bind_addr
> bind.address
> java.rmi.server.hostname

有没有人有任何想法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T15:21:12.017

好的，事实证明，在启动时绑定到 0.0.0.0 实际上会弄乱它的自我识别。绑定到 sqlserver.dev.net (run.bat -b sqlserver.dev.net) 修复了它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-11T05:06:56.117

可能是您的网络有代理服务器，您需要在属性检查中提供代理服务器 ip 和代理端口。

# jquery - ASP.NET MVC 和 jQuery - 路由和脚本位置

> ID：840302
> 
> 赞同：1
> 
> 时间：2009-05-08T15:11:54.003
> 
> 标签：jquery, asp.net-mvc, path

我正在使用 ASP.NET MVC 中的概念验证应用程序，并且在使用 jQuery 时有一个关于路由的查询。我的一个功能需要我调用 ~/jqdata/myFunction/ 这一切都很好

```
$.get("/jqdata/myFunction/" + $(this).attr("name"), function(data) { alert (data); } 
```

但是，我将无法控制要部署应用程序的虚拟目录。在 Site.Master 页面中，我可以将样式和 js 文件的这种行为包含在头部带有 runat="server" 以及指向“~/Styles/site.css”的链接中，例如，但我不知道如何以确保 jQuery 调用正确的路径来获取其数据。

任何人都可以提供帮助，即使这意味着我会因为这样做而称我为白痴或遗漏了一些非常明显的东西？我是一个winforms的人，真的，你看。:)

谢谢马克

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T15:41:46.100

您可以使用服务器端代码将网站的根设置为 JavaScript 中的变量，可能在您的 MasterPage 中，也可能只是在您需要它的视图中：

```
var rootUrl = '<%= Html.ResolveUrl("~/")%>'; 
```

那么您的功能将类似于以下内容：

```
$.get(rootUrl + "jqdata/myFunction/" ...); 
```

# c# - 如何将 Excel 工作表导出到新工作簿中

> ID：840310
> 
> 赞同：2
> 
> 时间：2009-05-08T15:13:15.763
> 
> 标签：c#, .net, vb.net, excel

我有一堆包含多个工作表的 Excel 工作簿。我想遍历每个工作簿并将每个工作表导出到它自己的新工作簿中。我希望每个新工作簿中都有一个工作表。

这是我到目前为止所得到的：

```
 Sub ExportWorksheet(ByVal worksheet As Excel.Worksheet, ByVal filePath As String)
      Dim xlApp As Excel.Application = New Excel.ApplicationClass
      Dim xlWorkBook As Excel.Workbook = xlApp.Workbooks.Add
      worksheet.Select()
      worksheet.Copy()
      xlWorkBook.Worksheets.Add()
      worksheet.Paste(Destination:=xlWorkBook)

      xlWorkBook.SaveAs(Filename:=filePath)

      xlWorkBook.Close(False)
      xlApp.Quit()
   End Sub 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T15:47:24.230

在 Excel 中，这将通过将工作表复制到新工作簿来完成，而不是通过创建新工作簿然后将工作表添加到其中来完成。这是通过使用`Worksheet.Copy`而不指定要在工作簿中放置复制的工作表的位置来实现的。

更多阅读： http: [//msdn.microsoft.com/en-us/library/microsoft.office.tools.excel.worksheet.copy (VS.80).aspx](http://msdn.microsoft.com/en-us/library/microsoft.office.tools.excel.worksheet.copy(VS.80).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T18:47:22.457

嗬！

`worksheet.SaveAs(Filename:=filePath)`

# jquery - jquery tablesorter 过滤器插件

> ID：840318
> 
> 赞同：2
> 
> 时间：2009-05-08T15:14:54.760
> 
> 标签：jquery, tablesorter

我正在使用与这个出色的[tablesorter 过滤器](http://github.com/jbritten/jquery-tablesorter-filter/tree/master)插件配对的[tablesorter](http://tablesorter.com/docs/) jquery插件。

我的页面上有一个选择框，其中包含我表中所有列的列表。当用户选择选择它时，我希望能够将过滤器限制为仅选择的列。

到目前为止，我已将一个事件附加到选择框，如下所示：

```
$('#SelectedColumn').bind("change", columnSelected); 
```

使用这样的处理程序：

```
function columnSelected() {
  var selected = $(this).val();
  $.tablesorterFilter.defaults.filterColumns = [selected];
} 
```

这确实正确设置了过滤器列的默认值，但是当过滤器发生时，它实际上并没有使用该值。看来该插件允许您仅在构造时设置过滤列。或者我的 jquery 新手无法弄清楚如何获取我需要翻转的数据位。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T17:15:08.763

这以蛮力的方式让我得到了我想要的东西。仍在寻找更好的解决方案。

```
function columnSelected() {
  var selected = $(this).val();
  $('#GoToTextBox').val('').focus();
  if (selected == 'Any') {
    $table.get(0).config.filter[0].filterColumns = null;
  } else {
    $table.get(0).config.filter[0].filterColumns = [selected];
  }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-23T22:41:11.970

我为 Tablesorter 工作宽度 jFilterSelect 过滤器：

[http://www.jordigirones.com/131-filtros-desplegables-con-tablesorter.html](http://www.jordigirones.com/131-filtros-desplegables-con-tablesorter.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-21T17:51:50.500

我有同样的问题。在选择框的更改事件中，只需重新加载页面即可解决您的问题。

```
<select name="search" id="search" onchange="refreshPage()" >

function refreshPage(){
        location.reload();
} 
```

# c++ - 如何查看 C++ 程序的汇编代码？

> ID：840321
> 
> 赞同：147
> 
> 时间：2009-05-08T15:15:20.360
> 
> 标签：c++, assembly, disassembly

如何查看 C++ 程序的汇编代码？

有哪些流行的工具可以做到这一点？

* * *

## 回答 #1

> 赞同：181
> 
> 时间：2009-05-08T15:22:52.277

## 询问编译器

如果您自己构建程序，您可以要求您的编译器发出汇编源代码。对于大多数 UNIX 编译器，都使用该`-S`开关。

*   如果您使用的是 GNU 汇编器，编译时`-g -Wa,-alh`将在标准输出上提供混合的源代码和汇编（`-Wa`要求编译器驱动程序将选项传递给汇编器，`-al`打开汇编列表，并`-ah`添加“高级源”列表）：

    `g++ -g -c -Wa,-alh foo.cc`

*   对于 Visual Studio，使用[`/FAsc`](http://msdn.microsoft.com/en-us/library/367y26c6.aspx).

## 窥视二进制文件

如果您有已编译的二进制文件，

*   在 UNIX 上使用`objdump -d a.out`（也适用于 cygwin），
*   [`dumpbin /DISASM foo.exe`](http://msdn.microsoft.com/en-us/library/756as972.aspx)在 Windows 上。

## 使用你的调试器

调试器也可以显示反汇编。

*   `disas`在 GDB 中使用命令。如果您更喜欢 Intel 语法，
    请使用。`set disassembly-flavor intel`
*   或者Windows上Visual Studio的[反汇编窗口](http://msdn.microsoft.com/en-us/library/a3cwf295.aspx)。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-05-08T15:25:44.487

在 GCC/G++ 中，使用`-S`. 这将输出一个`something.s`带有汇编代码的文件。

编辑：如果您希望输出采用 Intel 语法（这是 IMO，更具可读性，并且大多数汇编教程都使用它），请使用`-masm=intel`.

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2009-05-08T15:23:17.237

**在 Visual Studio 中**；

1.  设置断点
2.  运行程序直到它在断点处停止
3.  右键单击源代码并选择“显示分解”

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2010-02-08T17:08:12.280

对于 gcc/g++

```
gcc -save-temps -fverbose-asm prog.c 
```

这将生成 prog.s，其中包含对每个 asm 行中使用的变量的一些注释：

```
 movl    $42, -24(%ebp)  #, readme
    movl    -16(%ebp), %eax # pid, pid
    movl    %eax, 4(%esp)   # pid,
    movl    $.LC0, (%esp)   #,
    call    printf  # 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2017-04-25T14:39:17.707

该网站目前正在为我工​​作（2017）：[https ://godbolt.org/](https://godbolt.org/)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-05-08T15:19:41.473

无论您使用什么调试器，都应该有一个汇编视图（Visual Studio、Borland IDE、gdb 等）。如果您没有使用调试器，而只想查看程序中的程序集，则可以使用反汇编程序，或者运行程序并使用调试器附加到它，然后从那里进行转储。有关选项的信息，请参阅对[反汇编程序的参考。](http://en.wikipedia.org/wiki/Disassembler)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-05-08T17:38:56.117

很多人已经告诉过如何使用给定的编译器生成汇编代码。另一种解决方案是编译一个目标文件并使用[objdump](http://sourceware.org/binutils/docs-2.19/binutils/objdump.html#objdump)、[readelf](http://sourceware.org/binutils/docs-2.19/binutils/readelf.html#readelf)（在 Unix 上）或 DUMPBIN( [link](http://msdn.microsoft.com/en-us/library/756as972(VS.80).aspx) )（在 Windows 上）等工具转储它。您也可以转储可执行文件，但读取输出会更加困难。

这具有与任何编译器以相同方式工作的优点。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-05-08T15:22:26.257

正如其他人所提到的，您平台的调试器是一个很好的起点。对于所有调试器和反汇编器的手提钻，看看[IDA Pro。](http://www.hex-rays.com/idapro/)

在 Unix/Linux 平台（包括 Cygwin）上，您可以使用`objdump --disassemble <executable>`.

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-05-08T15:25:46.247

大多数编译器都有输出汇编列表的选项。例如，使用 VisualStudio，您可以使用以下内容：

```
cl.exe /FAfile.asm file.c 
```

不过，为了获得最佳可读性，大多数调试器都会提供一个将反汇编与原始源代码交错的视图，因此您可以逐行将代码与编译器的输出进行比较。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-07-17T23:51:00.757

用于 32 位 PE 文件的[PE Explorer 反汇编程序。](http://www.heaventools.com/PE_Explorer_disassembler.htm)其他人的 IDA。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2015-08-01T05:50:44.550

你也可以试试这个网站：[http ://assembly.ynh.io/](http://assembly.ynh.io/)

在那里，您可以粘贴您的 C 或 C++ 代码，然后按蓝色按钮查看程序集等效版本。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-05-08T16:46:19.033

在 Visual Studio 中，您可以为 C++ 项目生成汇编程序列表。

转到项目属性，然后转到 C++/Output Files 并将 Assembler 输出设置和 ASM 列表位置设置为文件名。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-08-20T13:40:07.577

在 Intel Mac OS X 10.8 (Mountain Lion) 上，该`-masm=intel`指令不起作用。但是，如果你安装了[Xcode](http://en.wikipedia.org/wiki/Xcode)，它应该已经安装了名为 'otool' 的工具：

```
otool code.o -tV 
```

您必须提供已编译的目标代码作为参数。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-02-28T08:08:30.633

如果您是 Eclipse 用户，您可以使用[Disassembly 视图](http://help.eclipse.org/kepler/index.jsp?topic=%2Forg.eclipse.cdt.doc.user%2Freference%2Fcdt_u_dissassembly_view.htm)。

> 反汇编视图将加载的程序显示为与源代码混合的汇编指令以进行比较。当前执行的行由箭头标记指示并在视图中突出显示。您可以在反汇编视图中执行以下任务：
> 
> *   在任何汇编指令的开头设置断点
> *   启用和禁用断点及其设置属性
> *   逐步执行程序的反汇编指令
> *   跳转到程序中的特定指令

# java - Java 强制转换运算符是如何工作的？

> ID：840322
> 
> 赞同：12
> 
> 时间：2009-05-08T15:15:29.597
> 
> 标签：java, casting, jvm

我正在尝试调试涉及 Java 中的 ClassCastException 的问题。为了解决这个问题，我需要知道当我从 Object 转换为特定类型时发生了什么。**谁能向我解释一下 Java cast 运算符如何在 Java 级别和 JVM 级别工作？**

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-08T15:18:39.307

[JLS](http://docs.oracle.com/javase/specs/jls/se5.0/html/conversions.html#5.5)够用吗？

> 转换转换应用于转换运算符的操作数（第 15.16 节）：操作数表达式的类型必须转换为由转换运算符显式命名的类型。铸造上下文允许使用：
> 
> *   身份转换（§5.1.1）
> *   扩大的原始转换（§5.1.2）
> *   缩小原始转换（§5.1.3）
> *   扩大的参考转换（§5.1.5）可选地后跟未经检查的转换（§5.1.9）
> *   缩小参考转换（第 5.1.6 节）可选地后跟未经检查的转换
> *   拳击转换（§5.1.7）
> *   拆箱转换（§5.1.8）。

实际上，也许[这部分](http://docs.oracle.com/javase/specs/jls/se5.0/html/conversions.html#192526)更相关：

> *将编译时引用类型S*的值强制转换为编译时引用类型*T*的编译时合法性的详细规则如下：
> 
> *   如果 *S*是类类型：
>     *   如果*T*是类类型，那么 | *小号*| <: | *T* |，或| *T* | <: | *小号*|; 否则会发生编译时错误。此外，如果存在*T的超类型**X*和 *S*的超类型*Y*， 使得*X*和 *Y*都可证明是不同的参数化类型（第 4.5 节），并且*X*和 *Y*的擦除相同，则编译时发生错误。
>     *   ***如果*T*是接口类型：
>         
>         *   如果 *S*不是一个`final` 类（第 8.1.1 节），那么，如果存在 *T的超类型**X*和*S*的超类型 *Y*，那么 *X*和*Y*都是可证明不同的参数化类型，并且*X*和*Y* 都一样，会发生编译时错误。否则，转换在编译时总是合法的（因为即使 *S*没有实现*T*，*S*的子类也可能）。
>         *   ***如果*S*是一个 `final`类（第 8.1.1 节），则*S*必须实现*T*，否则会发生编译时错误。****** 
>     *   **如果*T是类型变量，则递归应用此算法，使用**T* 的上限代替*T*。**
>     *   **如果*T*是数组类型，则*S*必须是 class `Object`，否则会发生编译时错误。**
> *   **如果*S*是接口类型：
>     
>     *   如果*T*是数组类型，则*T*必须实现*S*，否则会发生编译时错误。
>     *   如果*T*不是类型 `final`（第 8.1.1 节），那么如果存在 *T的超类型**X*和*S*的超类型 *Y*，这样 *X*和*Y*都是可证明不同的参数化类型，并且*X*的擦除和*Y* 相同，就会发生编译时错误。否则，转换在编译时总是合法的（因为即使 *T*没有实现*S*，*T*的子类也可能）。
>     *   ***如果*T*是 的类型`final`，则：
>         
>         *   如果*S*不是参数化类型或原始类型，则*T*必须实现*S*，并且强制转换静态已知是正确的，否则会发生编译时错误。
>         *   否则， *S*要么是调用某个泛型类型声明*G的参数化类型，要么是对应于泛型类型声明**G*的原始类型。然后必须存在*T的超类型**X*， 这样*X*是对*G*的调用，否则会发生编译时错误。此外，如果*S*和*X* 可证明是不同的参数化类型，则会发生编译时错误。***** 
> *   ***如果*S是类型变量，则递归应用此算法，使用**S*的上限代替 *S*。***
> *   **如果 *S*是数组类型*SC* []，即 SC 类型的组件*数组*：
>     
>     *   如果*T*是类类型，则如果*T*不是 `Object`，则会发生编译时错误（因为 `Object`它是唯一可以分配数组的类类型）。
>     *   如果*T是接口类型，则除非**T*是 type `java.io.Serializable`或 type ， 否则会发生编译时错误 `Cloneable`，这是数组实现的唯一接口。
>     *   如果*T* 是类型变量，则：
>         *   *如果T*的上限是 `Object`or type `java.io.Serializable`或 type ，或者*S*可以通过递归应用这些规则合法地强制转换为 `Cloneable`的类型变量，则强制转换是合法的（尽管未经检查）。
>         *   **如果T*的上限是数组类型 *TC[] ，则除非类型**SC[]*可以通过递归应用这些编译时规则转换为*TC[]*，否则会发生编译时错误。*
>         *   *否则，会发生编译时错误。*
>     *   *如果*T*是*TC* [] 类型的数组，即*TC*类型的组件数组，则除非满足以下条件之一，否则会发生编译时错误：*
>     *   **TC*和*SC*是相同的原始类型。*
>     *   **TC*和 *SC*是引用类型，并且类型 *SC*可以通过递归应用这些编译时规则转换为*TC 。****

 **现在完全清楚了，不是吗？:D

换句话说，这是我在不了解您的问题的更多细节的情况下能做的最好的事情。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-08T15:49:46.020

类转换神秘的一个可能原因是不仅类型必须匹配，而且它们必须由同一个类加载器加载。

您不仅应该能够转储类型层次结构，还应该能够转储每个类的类加载器的标识。

在应用程序代码和基础设施代码被故意隔离的 appserver 风格的环境中，这类问题并不少见 - 例如，如果系统类意外包含在应用程序 JAR 中，您可以在 JVM 中拥有两个“相同”类的副本，生活变得混乱

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-08T15:27:20.097

其他有用且权威的参考资料可在 Java 虚拟机规范中找到，特别是[§2.6.5，“Narrowing Reference Conversions”，](http://docs.oracle.com/javase/specs/jvms/se5.0/html/Concepts.doc.html#32879)尤其是[`checkcast`](http://docs.oracle.com/javase/specs/jvms/se5.0/html/Instructions2.doc2.html#checkcast)指令的定义。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-08T15:33:22.033

强制转换断言对象的运行时类型与给定的静态类型兼容，因此允许您在对象上调用该类型的方法。

这里 obj 是一个 Integer 对象，但只能通过 Object 引用访问：

```
Object obj = new Integer(1); 
```

Casting 让您再次将其视为 Integer（或 Integer 的某个超类）：

```
System.out.println(((Integer) obj).intValue()); 
```

当给定的静态类型与对象的运行时类型不匹配时，会发生 ClassCastException：

```
System.out.println(((Float) obj).intValue()); // runtime error 
```

您可以使用 getClass() 和各种 Class 方法找到任何对象的运行时类型：

```
System.out.println(obj.getClass()); // prints "class java.lang.Integer" 
```

# c# - 是什么导致 LINQ to SQL 中的 Timeout expired SqlExceptions？

> ID：840334
> 
> 赞同：15
> 
> 时间：2009-05-08T15:17:46.673
> 
> 标签：c#, sql-server, sql-server-2005, linq-to-sql, sqlexception

我的应用程序一直运行到 Timeout Expired SqlExceptions。问题是这个查询只需要运行相当长的时间。我很难弄清楚这个异常发生在哪里。这是在数据库服务器上创建的超时还是在我的程序中发生的？或者如果两者都可以，我如何确定它是哪一个？

最后，如何延长超时时间？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-08T16:14:55.210

增加超时 = **BAD**
修复查询 = **GOOD**

我不确定所涉及的所有细节，但通常以下适用：

当查询运行缓慢时，在管理工作室中执行以下操作：

*   运行 SET ShowPlan_All ON
*   运行您的查询
*   查看单词“scan”的输出。你的问题就在那里。

“扫描” = 触摸每一行（表格或索引）。您想“扫描”电话簿以查找一个号码还是使用索引？

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-08T15:20:14.030

您可能正在运行DataContext 上设置的[CommandTimeout 。](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.commandtimeout.aspx)这默认为 30 秒。

您需要做的就是在执行查询之前在 DataContext 上设置属性。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-08T15:21:45.477

这很可能发生，因为默认超时为 30 秒。您可以通过在连接字符串上设置 Timeout 属性来更改此设置。Alternatley 您可以在[DataContext](http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.commandtimeout.aspx)上设置它。

这是[一篇](http://www.codeproject.com/KB/linq/LINQ2SQLCommandTimeout.aspx)关于代码项目的文章。

# sql - SQL 测试最佳实践

> ID：840350
> 
> 赞同：2
> 
> 时间：2009-05-08T15:19:49.600
> 
> 标签：sql, sql-server, sql-server-2005

除了自动化测试之外，SQL 测试（存储过程、视图、查询、触发器...）的最佳实践是什么？大多数情况下，查询有效或返回数千行，因此检查它们有点困难。我想知道您通常如何测试 SQL 查询。你能指点我一个好的（在线）参考吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T15:26:25.873

尝试消除额外的变量。

方法：

*   每个测试应该只测试一个特性（视图、存储过程等）
*   使用已知的测试数据（它应该来自真实环境（但实际上不是真实环境）
*   使用最少量的测试数据来充分测试该功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T15:39:21.567

对于插入、更新、删除，我会在运行 proc 之前和之后检查表的状态，以查找满足插入更新或删除条件的记录。因此，如果我要添加 7 条记录，它们不应该事先在表中，而应该在之后。

选择数千条记录可能更难。没有什么可以替代实际了解您的数据以及您期望得到什么。例如，我知道某个客户有大约 2000 名销售代表。如果我运行一个应该包含所有代表的查询，而其中只有大约 1000 个代表，我就知道出了点问题。有时我会将查询结果放入临时表中，以便对其进行统计。如果我正在做一份与会者报告，那么我可以根据我的查询看到报告中有 200 个不同的会议在该时间段内。如果我只查看该表并看到在同一时间段内有 350 场会议，我会查看排除会议的内容，通常会查看一个或多个被排除会议的详细信息以及相关表以了解原因没有出现。

我还寻找重复的记录。如果我希望每次会议有一条记录，并且同一会议有两次，我知道其中一个连接表的记录比我对查询条件的预期要多。

我经常要求我们的一些运营人员也查看报告的查询结果。因为他们比我更接近数据的使用，所以他们经常会发现我没有发现的东西。

另一种技术是故意将用于测试的 where 子句限制为较小的数据子集，您实际上可以手动检查以查看您所期望的是否就是您所得到的。如果您有大量计算或复杂计算，这将特别有用。每当我进行复杂的计算时，我都会查看一个典型案例的原始数据并根据原始数据手动计算公式，然后我可以检查它在我的查询中是否正确。

Triggers I test by writing them as regular queries first (after first creating and populating the temp tables for #inserted and #deleted). I make sure to add multiple records to my temp tables because every trigger must be able to correctly handle multiple record inserts/updates or deletes. Then I write code to show the before state and the after state and put it all in a transaction so I can roll it back while testing.

# mysql - Delphi - 即使在被释放后，TSQLQuery 也会在 MySQL 上留下一个进程

> ID：840353
> 
> 赞同：2
> 
> 时间：2009-05-08T15:20:48.227
> 
> 标签：mysql, delphi

我在 Delphi 2007 中使用 DBExpress 连接到网上的 MySQL5 数据库服务器。

一切正常，直到我尝试上传大量数据。我正在尝试将 8000 多条记录插入数据库，一次一个循环，在循环中，我将 TSQLConection 对象与要插入的数据一起传递给一个函数。

该函数创建一个 TSQLQuery 对象并运行插入查询，然后释放 TSQLQuery。当我在大量数据上运行它时，我收到一条消息说 MySQL 服务器有很多连接。查看 MySQL 服务器的进程列表，我看到了这一点。

```
+---------+------+-------------------------------+--------+---------+------+--------+-----------------------+
| Id      | User | Host                          | db     | Command | Time | State  | Info                  |
+---------+------+-------------------------------+--------+---------+------+--------+-----------------------+
| 2962500 | name | myispdomain.co.uk:27812       | data   | Sleep   |    3 |        | [NULL]                |
+---------+------+-------------------------------+--------+---------+------+--------+-----------------------+ 
```

我创建的每个 TSQLQuery 对象都有一个条目，如果我单步执行代码，我可以在运行 ExecSQL() 时看到一个新条目。我在 TSQLQuery 上调用 FreeAndNil 并尝试在释放它之前调用 Close。

我的MySQL连接设置如下

```
 ConnectionName := 'MySQLConnection';
   DriverName     := 'MySQL';
   GetDriverFunc  := 'getSQLDriverMYSQL';
   KeepConnection := TRUE;
   LibraryName    := 'dbxmys30.dll';
   LoadParamsOnConnect := False ;
   LoginPrompt := FALSE;
   Name := 'mySQLConnection';
   VendorLib := 'LIBMYSQL.DLL';
   TableScope := [tsTable,tsView];

    Params.Add('DriverName=MySQL');
    Params.Add('HostName=www.sample.com');
    Params.Add('Database=data'); 
    Params.Add('User_Name=myuser'); 
    Params.Add('Password=mypassword'); 
    Params.Add('BlobSize=-1');
    Params.Add('ErrorResourceFile=');
    Params.Add('LocaleCode=0000');
    Params.Add('Compressed=False');
    Params.Add('Encrypted=True'); 
```

如果我将 KeepConnection 设置为 False，问题就会消失，但运行查询的时间会增加。

有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T16:02:13.697

不要一遍又一遍地重新创建您的连接，也不要重新创建您的查询。使用参数进行查询；打开连接一次，填充查询的参数，执行它，关闭查询（但不是连接），再次填充查询参数，然后再次执行。

像这样的东西（使用 Advantage Database Server，但概念是一样的）：

```
// Both Create() calls should be followed by try..finally to ensure they're 
// cleaned up after. Omitted for brevity.
Conn := TAdsConnection.Create(nil);
// Configure connection parameters here
Conn.Open;

Qry := TAdsQuery.Create(nil);
Qry.AdsConnection := Conn;
Qry.SQL.Add('INSERT INTO SOMETABLE (COL1, COL2, COL3)');
Qry.SQL.Add('VALUES (:COL1, :COL2, :COL3)');
while not OtherTable.Eof do
begin
  Qry.ParamByName('COL1').AsInteger := OtherTable.FieldByName('COL1').AsInteger;
  Qry.ParamByName('COL2').AsString := OtherTable.FieldByName('COL2').AsString;
  Qry.ParamByName('COL3').AsDateTime := OtherTable.FieldByName('COL3').AsDateTime;
  Qry.ExecSQL;
  Qry.Close;
  OtherTable.Next;
end;
// Free query
Conn.Close;
// Free connection. 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T15:56:52.023

显而易见的事情是重构使用单个 TSQLQuery 并将其传入。如果您使用参数创建它，则可以使这一切比为每个数据项创建一个全新的查询更有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-03T00:01:26.400

您可以构建更大的插入，例如：

```
Qry := TAdsQuery.Create(nil);
Qry.AdsConnection := Conn;
String qry = "INSERT INTO SOMETABLE (COL1, COL2, COL3)";
String values = "";

while not OtherTable.Eof do
begin
  values += "('"  + OtherTable.FieldByName('COL1').AsString + 
            "','" + OtherTable.FieldByName('COL1').AsString + 
            "','" + OtherTable.FieldByName('COL1').AsString + 
            "'),";
  OtherTable.Next;
end;

//to remove last ',' and add query terminator ";"
values = values.SubString(0, values.Length()-1) + ";"; 

qry = qry + values; //build the bulk insert

Qry.Add(qry);
Qry.ExecSQL;
//Qry.Close() no need of this, exec executes the command and leave, theres nothing to close
// Free query
Conn.Close; 
```

插入语句应如下所示： INSERT INTO (col1, col2, col3) values ('val1','val2','val3'), ('val1','val2','val3'), ('val1' ,'val2','val3'), ..., ('val1','val2','val3');

有了这个，正如 Ken 建议的那样，您只使用一个连接，但您的应用程序运行得更快，因为您在一个查询中插入了更多数据。

缺点： - 数据应该没有错误，因为您一次插入数百个数据集，因此更难确定哪组数据导致问题。-该组件不适用于大型查询，因此最好将数据拆分为块并一次处理插入，例如 500 行。

我目前使用这种方法插入 1000 行（包含 4 到 8 列数据）没有问题，我用 5000 行测试它，但抛出“查询期间丢失连接”的异常，所以我把它留在 1000 中。我认为调整服务器可以增加数据传输，假设组件不是问题，在我的情况下 1000 就足够了。

最后，我使用的是builder c++而不是delphi，所以我发布的代码可能有错误

-何塞

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-05T14:10:18.893

```
ConnectionName := 'MySQLConnection';
DriverName     := 'MySQL';
GetDriverFunc  := 'getSQLDriverMYSQL';
**KeepConnection := TRUE;**    //   <---------- this setting is persisting the database connection, change to false if you want to disconnect 
LibraryName    := 'dbxmys30.dll';
LoadParamsOnConnect := False ;
LoginPrompt := FALSE;
Name := 'mySQLConnection';
VendorLib := 'LIBMYSQL.DLL';
TableScope := [tsTable,tsView]; 
```

如果您的应用程序要多次查询事物，那么重复断开重新连接不是一个好习惯。首选方法是在第一次需要时创建连接，并保持打开状态直到不再需要。

*命令*---> *sleep*表示您已连接到数据库，但当前没有查询（TSQLQuery**等**）正在运行。事实上，如果你没有创建一个高负载操作，你很可能只会看到“*睡眠*”之外的任何东西。

# html - 如何在 html 中嵌入 .AVI？

> ID：840355
> 
> 赞同：4
> 
> 时间：2009-05-08T15:21:26.710
> 
> 标签：html, avi

我在网上找到了一些 .AVI in html 的例子。
但是我的页面 [http://pianocheater.com/VIDEO.html](http://pianocheater.com/VIDEO.html)是有问题的。

我的电脑上的chrome很好。
在 IE 中，您会在顶部看到那个 dang bar，然后视频是空白的。
它适用于我的电脑，但不适用于其他电脑，所以我认为它会是编解码器或其他东西？

这是现有的 html...（抱歉，请注意如何在此处获取漂亮的 html）

```
<object width=288 height=512
  id      ="MediaPlayer"
  type    ="application/x-oleobject"
  standby ="Loading Windows Media Player components..."
  classid ="CLSID:22D6f312-B0F6-11D0-94AB-0080C74C7E95"
  codebase="http://activex.microsoft.com/activex/controls/mplayer/
            en/nsmp2inf.cab#Version=6,4,7,1112">
  <param name="showControls" value="true">
  <param name="autoStart"    value="false">
  <param name="filename"     value="img/adg.avi">
  <embed width=288 height=512  src="img/adg.avi"
         type="application/x-mplayer2" showControls=1 autoStart=0></embed>
 </object> 
```

我知道 .AVI 会阻止 Mac 用户看到它们。
没关系。我的 midi 应用程序没有 mac 版本。
我也知道 .AVI 不能很好地流式传输。
当我转换为 .MOV 或 .WMV 时，音频会严重滞后。
（这是一个 MIDI 应用程序 - 声音很重要。）

任何提示或想法将不胜感激:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T15:27:20.050

您是否尝试过单独使用？

```
<embed src="img/adg.avi"/> 
```

…但你最好只使用 YouTube 或类似的东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T15:29:38.843

这在 Flash 中更容易完成。

将视频转成FLV，使用开源[JW](http://www.longtailvideo.com/players/jw-flv-player/)播放器播放。您可以使用开源[ffmpeg](http://www.videohelp.com/tools/ffmpeg)转换视频。（ffmpeg 有很多免费的 GUI 前端）

# flash - 将动画序列从 Flash 导出为 JPEG

> ID：840358
> 
> 赞同：0
> 
> 时间：2009-05-08T15:22:10.157
> 
> 标签：flash, actionscript-3, video, encoding, jpeg

我想知道是否有可能在一段时间内记录/捕获 swf 电影的状态并将其全部保存为 jpgs 到服务器？

AS3 有新的 com.adobe.images.JPGEncoder 类，似乎可以完成这项工作，但我可以捕获序列吗？希望我能把它重新组合成视频或动画。

还有其他方法可以以编程方式将 swf 编码为视频吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T16:13:10.597

在使用 JPGEncoder 之前，我已经完成了“屏幕捕获”，所以我认为您应该能够在 ENTER_FRAME 事件中捕获屏幕。这可能不起作用，因为 JPG 编码不是超级快。

这就是我要做的事情。供您参考，这是一些执行此操作的代码（对于单个屏幕截图）：

```
var fileReference:FileReference = new FileReference();

// Capture the BitmapData of the stage for example
var captureMovieClip:DisplayObjectContainer = stage;

var stage_snapshot:BitmapData = new BitmapData(captureMovieClip.width, captureMovieClip.height);
stage_snapshot.draw(captureMovieClip);

// Setup the JPGEncoder, run the algorithm on the BitmapData, and retrieve the ByteArray
var encoded_jpg:JPGEncoder = new JPGEncoder(100); 
var jpg_binary:ByteArray = encoded_jpg.encode(stage_snapshot);

// save
fileReference.save(jpg_binary, "screenshot.jpg"); 
```

您可以扩展它以在您的 ENTER_FRAME 事件处理程序中调用，然后将文件保存为不同的文件名。此外，您可以使用不同的显示对象来代替舞台。

我不知道这会运行多快，您可能需要降低帧速率，这样 ENTER_FRAME 就不会被调用太多，但是您的 JPG 渲染会损失一些质量。

同时降低质量：`new JPGEncoder(100)` 从 100 到较低的值可能有助于 jpeg 的文件大小（但可能会或可能不会因压缩而产生更多开销）。

# .net - .NET 矩阵库

> ID：840360
> 
> 赞同：29
> 
> 时间：2009-05-08T15:22:20.420
> 
> 标签：.net, math, matrix, sparse-matrix

我正在为 .NET/C# 寻找一个好的（经过充分测试、功能齐全且最好具有良好界面的）矩阵库。我在这里的主要要求只是它应该是免费的（在这种情况下我并不特别关心它是否是开源的）并且最好支持[稀疏矩阵](http://en.wikipedia.org/wiki/Sparse_matrix)运算。强制性要求是所有基本操作（例如乘法、转置、求逆）以及寻找特征值和特征向量。用于发现特征值的数值而非分析方法的实现，特别是[Lanczos 算法](http://en.wikipedia.org/wiki/Lanczos_algorithm)对于稀疏矩阵，将是非常可取的，因为我将要处理的矩阵非常大（长度为 10,000 以上）并且是正方形的，而且还相当稀疏。话虽如此，我可能会要求很多，所以任何关于一个相当完整的矩阵库的建议都会很棒。

现在我知道 Python 有一个或两个用于此类任务的有用库（即[NumPy](http://numpy.scipy.org/) / [SciPy](http://www.scipy.org/)），但不幸的是，该领域似乎缺乏 .NET。

经过一番搜索，我找到了以下 .NET 库，我可能会使用它们：

*   Lutz Roeder 的[地图包](https://github.com/lutzroeder/Mapack)
*   [点网矩阵](http://www.codeproject.com/KB/recipes/psdotnetmatrix.aspx)（代码项目）
*   [C# 矩阵库](http://www.codeproject.com/KB/cs/CSML.aspx)(CodeProject)

但是，由于我没有使用任何这些库或其他库的任何经验（并且在任何情况下都没有足够的时间来正确检查它们），如果有人可以在这里讨论他们对各种库的建议，我将不胜感激，他们的优点/缺点，特别是关于我的用途的适用性，以及他们对它们的一般经验。

求助于 MatLab 始终是一种选择，但不是首选，因为如果我可以将矩阵数学直接与我的程序集成会更方便。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-08T15:41:45.523

编辑：

上次我评估它时它并不完全在那里，但有相当多的活动，所以您还应该考虑（免费和开源）[Math.NET Numerics](http://numerics.mathdotnet.com/)。

现在看来，他们似乎已经完成了他们的新版本，并添加了稀疏矩阵支持，以及其他好东西。

* * *

如果您想要更强大的支持，不幸的是，您确实需要使用 .NET atm 的商业包。

有两个功能非常丰富的包，它们都很好地支持矩阵。 [Extreme Numerics](http://www.extremeoptimization.com/)效果很好，并且有一些非常好的功能。我还听说过有关[IMSL Visual Numerics](http://www.roguewave.com/products/imsl-numerical-libraries.aspx)数学库的好消息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-02-28T22:45:07.760

试试[ILNumerics](http://ilnumerics.net)：我们有一个 rel。作为开源项目的悠久历史，最近改为商业许可证以获得更好和可靠的支持。我有偏见，但这里有一个简短的功能列表：

*   更好的内存管理，因此...
*   更快的算法
*   使用 MKL 进行线性代数
*   n-dim 数组类，语法类似于 Matlab
*   3D 绘图控件
*   支持 32/64 位
*   支持单声道
*   [完整的功能列表](http://ilnumerics.net/%24FeatureList.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T15:37:48.637

我过去有我们的 Mapack，发现它非常好。

虽然，我认为它没有稀疏矩阵，但它确实支持所有基本的线性代数函数。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T15:42:37.423

另一种选择：[用于 .NET 的 IMSL](http://www.vni.com/products/imsl/cSharp/overview.php)。CenterSpace 有[NMath](http://www.centerspace.net/products.php)库——没有用过这些。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T15:38:40.787

我在大学的一个神经网络项目中使用了 Mapack（.Net 端口而不是 COM 版本）。我无法完全记住图书馆的细节，但它完成了我需要的一切，而且使用起来也不是特别繁琐。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-09T22:55:13.177

[Meta.Numerics](http://www.meta-numerics.net)（托管在[codeplex](http://metanumerics.codeplex.com)上）是一个免费包，它将计算非对称矩阵的特征值和特征向量，但它目前不专门处理稀疏矩阵。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-11-05T15:13:08.973

你考虑过 math.net 铱星吗？

[http://iridium.mathdotnet.com/](http://iridium.mathdotnet.com/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-08T15:34:06.510

现已失效的托管 DirectX 库具有一些矩阵支持。

此后它已被封装到 Microsoft XNA 中，它可能不适合您，但[MDX 维基百科文章](http://en.wikipedia.org/wiki/Managed_DirectX)推荐了一种名为[SlimDX](http://slimdx.mdxinfo.com/)的东西，它[可能没](http://slimdx.org/latestdocs/help/html/T_SlimDX_Matrix.htm)问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-07-25T15:25:55.867

关于 .NET 和 Python，您可以使用 IronPython。但是，您还需要[Ironclad](http://www.johndcook.com/blog/2009/03/19/ironclad-ironpytho/)以使 SciPy 和 NumPy 与 IronPython 一起工作。

# php - 防止IIS7重写将“index.php”添加到重定向路径？

> ID：840362
> 
> 赞同：0
> 
> 时间：2009-05-08T15:22:37.567
> 
> 标签：php, iis, iis-7, rewrite

我正在尝试使用 PHP5 (fastcgi) 在 IIS7 上为 Wordpress MU 2.7 配置[重写](http://learn.iis.net/page.aspx/460/using-url-rewrite-module/)规则。

目前我在 Web.config 中只有以下重写规则：

```
 <rule name="Canonical Host Name" stopProcessing="true">
             <match url="(.*)" />
             <conditions logicalGrouping="MatchAll">
                 <add input="{HTTP_HOST}" negate="true"
                      pattern="^subdomain\.example\.com$" />
             </conditions>
             <action type="Redirect"
                     url="http://subdomain.example.com/{R:1}"
                     redirectType="Permanent" />
         </rule> 
```

在我输入 URL 的那一刻（见下文），它确实**重定向**到正确的主机名，但由于某种原因在路径前加上`index.php/`：

```
url: `http://subdomain/my/path/123`
redirects to: `http://subdomain.example.com/index.php/my/path/123`
should redirect to: `http://subdomain.example.com/my/path/123` 
```

有谁知道为什么会这样以及如何防止这种情况发生？

我是否缺少某个服务器设置或其他东西......？php.ini？web.config 规则？还是只是我的重写规则错了？

编辑：这个问题似乎与 Wordpress 的永久链接结构无关！如果我删除 redirect ，行为是相同的`index.php`。我认为没有任何 PHP 代码正在运行……这必须处于更高的级别。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T16:25:12.533

默认情况下（我认为），Wordpress 将友好的永久链接格式化为 index.php/path/to/post，因为这模拟了重写，而不需要服务器支持重写。这可以解释为什么你的重写是这样的——他们在重写之前有 index.php。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T19:15:19.300

[您可以通过更改](http://learn.iis.net/page.aspx/466/enabling-pretty-permalinks-in-wordpress/)WordPress 配置中的永久链接结构选项来防止它发生。

# c# - 如何在 IronPython 中检查类型相等性（是运算符或 x.GetType() == typeof(xType)）？

> ID：840364
> 
> 赞同：1
> 
> 时间：2009-05-08T15:22:59.360
> 
> 标签：c#, ironpython

> **重复：** [在python中检查类型的规范方法是什么？](https://stackoverflow.com/questions/152580/whats-the-canonical-way-to-check-for-type-in-python)

如何在 IronPython 中检查类型相等性？

我需要 IronPython 中与以下 C# 代码等效的代码：

```
if (x.GetType() == typeof(xType)) 
```

或者

```
if (x is xType) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T15:29:49.000

```
from System import *
if x.GetType() == Type.GetType(xType): 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-08T20:36:19.353

说 C 是一个静态类，不是完全限定的，而是导入到 Iron python 脚本中的 x 是 C 的一个实例，而 ABC 是完全限定的名称

为什么这些不起作用？

```
x.GetType() == Type.GetType("A.B.C") 
```

或者

```
x is Type.GetType("A.B.C") 
```

或者

```
x is C 
```

或者

```
x.GetType() == Type.GetType(C) 
```

# git - Git是否仅用于源代码控制？

> ID：840367
> 
> 赞同：4
> 
> 时间：2009-05-08T15:23:26.113
> 
> 标签：git, version-control

将Git集成到与源代码控制无关的项目中是不是很疯狂。

我正在考虑定期在客户端运行多个命令并将输出提交到本地 git 存储库的数据收集器。如果远程服务器可用，它会将原始数据推送到服务器端以进行进一步处理。在这种情况下，我将免费获得压缩、历史记录和各种交付方式。有什么缺点？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-08T15:27:10.270

这并不疯狂，不。Git 最初被设计为只是一个版本控制的文件系统，后来被用作源代码控制系统的基础；然而，事情并没有那么顺利，git 成为了源代码控制系统。话虽如此，它仍然是一个文件系统设计，你没有理由不能将它用于其他目的（事实上我自己也打算做一些非常相似的事情，但这个项目从未成功过）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T15:37:44.503

已经有几个基于 Git 的备份系统可用，例如[Gibak](http://eigenclass.org/hiki/gibak-backup-system-introduction)。所以它绝对能够有效/安全地处理大型数据集。

一个缺点是，您将无法合并二进制数据。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T15:28:17.053

这取决于您要处理的数据类型。如果您谈论的是少量数据，那么请改用数据库，但如果您想跟踪对文档的修改，那么我认为在 Git 之类的基础上构建系统没有问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T17:41:57.263

我使用 Subversion 进行数据库备份。每条记录一行有许多静态记录，使 svn 成为一种快速简便的备份解决方案。我看不到任何有意义的缺点。从一个随机的互联网人到另一个：你有我的支持！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T15:24:54.940

“Git 是一个免费和开源的分布式版本控制系统，旨在快速高效地处理从小型项目到大型项目的所有项目。

每个 Git 克隆都是一个成熟的存储库，具有完整的历史记录和完整的修订跟踪功能，不依赖于网络访问或中央服务器。分支和合并既快速又容易。

Git 用于文件的版本控制，很像 Mercurial、Bazaar、Subversion、CVS、Perforce 和 Visual SourceSafe 等工具。"

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-08T15:28:47.753

不，它不仅用于源代码控制。

人们将它用作各种文档（如手稿、演讲等）的版本控制系统……

git 不必与软件源代码控制一起使用，您可以随意使用它

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-08T15:29:03.883

对我来说，在数据库中收集数据似乎更容易。在数据库中，信息是有组织的、易于访问且易于操作的。此外，如果您需要远程访问，请允许其他域访问数据库。

而在 Git 中，您被困在将所有内容存储到平面文件中。然后解析所有这些信息是你的工作，如果你有很多信息，这可能需要很长时间。但是，数据库通常可以很快返回您想要的确切信息。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-08T15:39:38.070

听起来您正在寻找的是某种消息队列或服务总线。其中有很多。当然，如果 Git 适合你，为什么不呢？但请确保您不只是在使用它，因为它是您所知道的唯一类似的工具。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-08T15:48:46.303

我看不出这是个坏主意。Git 非常适合管理大量和少量的信息。二进制或文本都允许并保留其修订历史。

这可能就像[iFolder](http://www.novell.com/products/ifolder/)一样工作，但具有更好的合并、保存历史和共享信息的能力。

问题之一是这种设置的复杂性。除非您的用户精通 git 分支、通过合并解决冲突以及手动应用补丁，否则您将不得不做出一些艰难的决定来降低系统的性能。

GUID 的想法也会让最终用户感到困惑，因此您可能必须在此基础上构建一些简单的东西（版本编号）。不允许空文件夹的困境也是您必须解决的问题。

git（相对于 svn 或 iFolder）的好处是移动文件很容易，合并很聪明。

总的来说，git 在一个存储库中很好地管理我们的二进制图像、媒体和代码文件。我想不出为什么它不能用作任何其他类型项目的助手，以跟踪文档、图像和其他媒体。

# iphone - 用于 Iphone 的 Gravatar？如何生成十六进制 MD5 哈希？

> ID：840386
> 
> 赞同：1
> 
> 时间：2009-05-08T15:26:44.047
> 
> 标签：iphone, objective-c, hash, md5

我想在我的 iPhone 应用程序中使用[gravatar 。](http://en.gravatar.com/site/implement/url)无论如何在 iPhone 的 Objective-C 中生成十六进制 MD5 哈希？在 iPhone 上使用 openssl 是不行的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T15:35:28.317

这是我在从我的应用程序中删除它之前的做法：

```
#import <CommonCrypto/CommonDigest.h>

NSString* md5( NSString *str ) {
  const char *cStr = [str UTF8String];
  unsigned char result[CC_MD5_DIGEST_LENGTH];

  CC_MD5( cStr, strlen(cStr), result );

  return [[NSString
      stringWithFormat:@"%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X%02X",
      result[0], result[1],
      result[2], result[3],
      result[4], result[5],
      result[6], result[7],
      result[8], result[9],
      result[10], result[11],
      result[12], result[13],
      result[14], result[15]
      ] lowercaseString];
} 
```

公平地说，我不是自己写的。我在互联网的某个地方找到了它，但我没有记录在哪里。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T23:59:25.187

我用于生成必要 MD5 哈希的代码位于[我的 github 存储库](http://github.com/AlanQuatermain/aqtoolkit/tree/master)的 CommonCrypto 子文件夹中。那里有一堆类似的例程，它们将向您展示如何使用 CommonCrypto 或如何格式化十六进制字节值、base-64 等字符串。

生成字符串的一种可能更好的方法是：

```
NSMutableString * str = [[NSMutableString alloc] initWithCapacity: 33];
int i;
for ( i = 0; i < 16; i++ )
{
  [str appendFormat: @"%02x", result[i]];
}
NSString * output = [str copy];
[str release];
return ( [output autorelease] ); 
```

但是，如果您要使用上述答案中的代码，我个人建议将 %02X 更改为 %02x 并完全放弃 -lowercaseString 调用 - 还不如生成小写的十六进制值开始。

# sql - 具有代理键的表是否需要对自然键的唯一约束才能处于 1NF 中？

> ID：840392
> 
> 赞同：5
> 
> 时间：2009-05-08T15:27:17.010
> 
> 标签：sql, database, database-design

实用主义者赢得了代理与自然主键的争论，支持代理键*。在我自己的工作中，我总是不假思索地使用 SQL Server 标识列。但是我突然想到，对于一个处于第一范式的表，我应该能够识别一个自然键并使用唯一约束来强制它。我不能对我的数据库中的所有表都这样做，所以我的数据库甚至不符合规范化的最低标准。

您是否同意具有代理主键的表也必须对自然键具有唯一约束才能处于 1NF 中？

*我认为 Joe Celko 仍然在打好仗，见[最后一段](http://www.intelligententerprise.com/channels/business_intelligence/showArticle.jhtml;jsessionid=3O5G0FAW0VNDGQSNDLOSKHSCJUNN2JVN?articleID=201806814&pgno=2)。

编辑添加：感谢您的回复。我的印象是添加唯一约束并不是一种常见的做法，所以我对迄今为止的反应一致感到有些惊讶。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T15:38:16.857

# 是的！

如果表应该最多记录自然键的实例，则需要对相关列进行约束以强制执行该约束。否则，您最终会得到一个包含 50,000,000 行的表，每行都有不同的 ID 值，但其他方面相同——这取决于您的观点，这是可悲的、可笑的或可笑的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T15:40:35.713

我可以把 IDENTITY 列给我的客户带来的所有问题写成一本书。从好的方面来说，它让我继续工作。如果每个人第一次都以正确的方式设计了他们的数据库，我就不必进来修复它们了 :)

如果您要将 IDENTITY 用作代理键，则需要这样做。代理键应该**完全**在幕后。用户永远不应该在报告中看到它们，他们永远不能用它们查找行，等等。此外，您应该有一个自然键，根据定义，它必须是唯一的。应该在您的数据模型中强制执行这种唯一性。

我当前的客户已决定将合并其数据库中的多个实体。他们当然在任何地方都使用了 IDENTITY 列**，并将**它们显示在前端的所有记录上。现在必须合并行，因此存在冲突，这意味着重新编号。当然，由于用户在实体被重新编号时知道这些数字，所以它将完全让用户陷入循环。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T15:44:42.863

如果您有一个自然键并且您没有对其施加唯一约束，那么您将在数据完整性方面产生问题。不幸的是，在现实世界中，并不是每张桌子都有一个真正的自然键。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-09T08:51:45.577

让我重新提出这个问题。有趣的点不是表格是否在 1NF 中。有趣的一点是自然数据是否在 1NF 中。

如果您删除 ID 列，然后清除重复项，您就执行了关系语言中所谓的“投影”。根据定义，结果在 1NF 中。

如果您删除 ID 列，但不清除重复项，您最终会得到一袋行，而不是一组。如果应用程序不能以某种方式阻止重复项进入该包，则该包不在 1NF 中。

我的答案归结为与乔纳森和汤姆的相同。最终结果是您已经将数据完整性的防御移出 DBMS 并移回应用程序。应用程序程序员倾向于这样做，在这种情况下以及在许多其他情况下。如果他们正确地编写应用程序，那么这是一个偏好问题。如果他们不这样做，那么他们在引入数据库之前已经退回到最先进的技术。

# c# - C#中的静态变量

> ID：840397
> 
> 赞同：15
> 
> 时间：2009-05-08T15:27:49.427
> 
> 标签：c#, variables, static-variables

在 C# 中，有没有办法将静态变量放入像 VB.Net 这样的方法中？

```
Static myCollection As Collection 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-08T15:32:47.230

> 为什么 C# 不支持静态方法变量？
> 
> 问：在 C++ 中，可以编写一个静态方法变量，并拥有一个只能从方法内部访问的变量。C# 不提供此功能。为什么？
> 
> A: C# 没有这个特性有两个原因。
> 
> 首先，通过使用类级别的静态变量可以获得几乎相同的效果，而添加方法静态变量将需要增加复杂性。
> 
> 其次，当代码被重复调用或从多个线程调用时，方法级别的静态变量有些臭名昭著，而且由于定义在方法中，因此很难找到定义。
> 
> -- [msdn c# 常见问题解答](http://blogs.msdn.com/csharpfaq/archive/2004/05/11/130248.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-08T15:33:31.173

不，没有，但这与在类级别拥有静态变量有何不同？

[实际上，如果您查看](http://weblogs.asp.net/psteele/pages/7717.aspx)shared 是如何实现的，它是一个在类上创建静态字段的编译器技巧。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-08T15:31:10.417

最接近 VB.NET 的[`Static`](http://msdn.microsoft.com/en-us/library/z2cty7t8(VS.80).aspx)是在当前类型中创建一个字段。除此之外，C# 没有等价物。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T15:31:42.020

不，CLR 不支持这一点，VB.NET 使用编译器技巧来允许它。啊。

* * *

## 回答 #5

> 赞同：-6
> 
> 时间：2009-05-08T15:35:42.980

我很确定 C# 等价物是`const`：因此：

```
public const Collection myCollection = new Collection();

```

我对 VB.NET 不太熟悉，所以我可能会偏离基础，但这将允许您设置一个无法更改的变量。

# .net - 用于编辑 XML/XSL 的 .NET Windows 控件？

> ID：840400
> 
> 赞同：3
> 
> 时间：2009-05-08T15:28:31.623
> 
> 标签：.net, xml, editor, xslt

抱歉，如果以前有人问过这个问题。进行了快速搜索，没有什么可以 100% 回答我的问题。

我在数据库中存储了一些 XSL，我希望用户能够在我的 .NET Windows 应用程序中进行编辑。我可以将它粘贴到一个多行文本框中，但我没有得到自动缩进、颜色编码等任何东西。有谁知道我可以用来实现这一目标的 .NET 控件吗？理想情况下，我希望模拟在 Visual Studio IDE 中编辑 XML 文件时获得的体验，但我意识到这可能不切实际。至少，我希望它能够很好地缩进文本。我不太担心 XSL/XML 本身的验证——我可以自己排序。有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-16T01:45:18.507

这并不能直接回答您的问题，但[CodePlex](http://gregsxmleditor.codeplex.com/Wiki/View.aspx)上提供了用于名为 Greg's XML Editor 的 XML 编辑器的代码。它不是控件，但您当然可以查看代码，看看是否有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-11T05:09:41.753

它有点旧，但不久前我做了一个简单的 XSL 编辑器控件。[http://www.codeproject.com/KB/edit/XSLEditor.aspx](http://www.codeproject.com/KB/edit/XSLEditor.aspx)

# audio - 编写一个识别声音并执行动作的程序

> ID：840405
> 
> 赞同：10
> 
> 时间：2009-05-08T15:29:23.277
> 
> 标签：audio

我想编写一个能够存储声音模式的程序，例如火车汽笛，喇叭（哔哔）......通过麦克风收听声音..​​....然后在听到声音时采取一些行动. 我知道一点 python，很久以前就用 VB 编程过。主要是我是一个Oracle，PLSQL的人。该程序将需要一个适度的用户界面。

解决此问题的最佳解决方案组合（语言、第三方插件等）是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T15:35:04.883

我的猜测是，在这种情况下阻力最小的路径是结合使用第三方音频识别库和高级语言（如 Java 或 .NET 系列语言之一，如 C# 或 VB.NET）。

[您可以先在数字声音处理](http://www.faqs.org/docs/sp/)和音频识别领域进行一些研究。

当您找到具有您感兴趣的功能的库或框架以及您选择的语言的绑定时，请开始使用它来实现。

请参阅[MARF](http://marf.sourceforge.net/)（一个 Java 库），也许微软在[System.Speech.Recognition](http://msdn.microsoft.com/en-us/library/system.speech.recognition.aspx)命名空间（如果我没记错的话，它已与较新的 Windows 操作系统集成）在这方面的工作

**编辑 - 桌面与从 Web 运行**

在您询问有关使用 Flash 或 Silverlight 以使您的解决方案能够在桌面或 Web 上运行的评论中。

首先，我想指出 Flash 和 Silverlight 都在客户端计算机上实际运行。不同之处在于它们在 Web 浏览器的上下文中运行，并且用户不必安装应用程序。否则它们与桌面应用程序没有太大区别，用户显然必须为他们的浏览器安装 Flash of Silverlight 插件。

如果这就是您所追求的（即用户不必安装您的应用程序），那么您可以查看 Flash、Silverlight 或[Java Web Start](http://en.wikipedia.org/wiki/Java_Web_Start)。实际上 JAVA Web Start 可能是一个不错的选择，因为您可以利用[MARF 框架](http://marf.sourceforge.net/)。

但是，如果您决定使用 Flash、Silverlight 或 Java Web Start，则可能需要处理一些安全问题，因为访问客户端系统资源必然需要一些大多数“基于 Web 的应用程序”不需要的权限通常需要。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T15:35:00.140

[Sphinx](http://cmusphinx.sourceforge.net/sphinx4/)是一个语音识别系统。它可能能够被修改甚至训练以按照您期望的方式工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T15:58:48.540

如果您正在聆听程序事先知道的喇叭或火车汽笛的特定录音，那么如果声音足够独特，您将能够可靠地检测和区分它们。

对程序以前没有听到过的新声音进行分类（听起来像喇叭，或者像火车汽笛等）是一个更难的问题。

在任何一种情况下，声音识别算法通常都会查看录制声音的频谱（参见 Miky D 的关于数字声音处理的链接），并对这些数据执行一些[模式识别](http://cgm.cs.mcgill.ca/~godfried/teaching/pr-web.html)，而不是对录制的波形本身进行一些模式识别。

至于语言和第三方库，请选择可以让您轻松获取录制的音频数据的东西。Java 在这方面似乎不错（另请参阅 Java 机器学习算法[WEKA](http://www.cs.waikato.ac.nz/~ml/)）。虽然周围有用于语音和音乐分析的程序/库，但我不知道有哪一种专为任意声音而设计，因此您最终可能不得不自己编写分析算法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-09T18:19:17.940

我知道的大多数算法都使用[频谱图](http://en.wikipedia.org/wiki/Spectrogram)（即频谱与时间）来区分声音。这个问题的难度可以通过你的频谱图看起来有多么不同来估计。

您的声音可能使它们更容易与语音区分开来的一个方面是它们可能具有清晰的谐波结构（即看起来更像小提琴而不是维基百科链接中的声音）。这种谐波结构在区分声音方面非常有用，并且可能对您的问题有所帮助。这让我想到了另一个地方：在区分鸟歌方面有很多工作，它们具有清晰的和声结构，以及许多已发布的算法，尽管我不知道可以扩展以满足您的需求的免费软件。不过，使用鸟鸣分析软件来查看您的声音文件可能会很有用。例如，请参阅[Raven](http://www.birds.cornell.edu/brp/raven/RavenOverview.html)项目，尽管还有许多其他免费的频谱图包。

# wpf - WPF：绑定到 ComboBox SelectedItem

> ID：840407
> 
> 赞同：6
> 
> 时间：2009-05-08T15:29:41.073
> 
> 标签：wpf, binding, combobox

我有一个基于 XML 数据的带有 ComboBox 的 UserControl：

```
<Root>
<Node Background="Yellow" Foreground="Cyan" Image="1.ico" Property="aaaa" Value="28" />
<Node Background="SlateBlue" Foreground="Black" Image="2.ico" Property="bbbb" Value="2.5" />
<Node Background="Teal" Foreground="Green" Image="3.ico" Property="cccc" Value="4.0" />
<Node Background="Yellow" Foreground="Red" Image="4.ico" Property="dddd" Value="0" /></Root> 
```

这是用户控件 XAML：

```
<UserControl x:Class="xxxxxxxx.MyComboBox"
         xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
         x:Name="myComboBoxControl">
<UserControl.Resources>
    <DataTemplate x:Key="dataTemplateNode">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" MinWidth="20"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto" MinWidth="20"/>
            </Grid.ColumnDefinitions>
            <Border Background="{Binding XPath=@Background}" Grid.Column="0">
                <Image Source="{Binding XPath=@Image}" 
                       Width="16" 
                       Height="16" 
                       Margin="3" />
            </Border>
            <Border Background="{Binding XPath=@Background}" Grid.Column="1">
                <TextBlock Foreground="{Binding XPath=@Foreground}" 
                           Margin="3"
                           Text="{Binding XPath=@Property}" />
            </Border>
            <Border Background="{Binding XPath=@Background}" Grid.Column="2">
                <TextBlock Foreground="{Binding XPath=@Foreground}" 
                           Margin="3" 
                           FontWeight="Bold"
                           Text="{Binding XPath=@Value}" />
            </Border>
        </Grid>
    </DataTemplate>

    <XmlDataProvider x:Key="xmlNodeList" 
                     Source="/data/Combo.xml" 
                     XPath="/Root/Node"/>
</UserControl.Resources>

<ComboBox Name="myComboBox" 
          ItemsSource="{Binding Source={StaticResource xmlNodeList}}" 
          ItemTemplate="{StaticResource dataTemplateNode}"
          HorizontalContentAlignment="Stretch" /></UserControl> 
```

在 MainForm.xaml 中，我有一个要绑定到我的 UserControl SelectedItem 的 TextBox。

```
<StackPanel Orientation="Horizontal">
<local:MyComboBox1 x:Name="comboBoxST" />
<TextBox x:Name="textBoxST"/></StackPanel> 
```

如果你能指导我如何做到这一点，我会很高兴。

提前致谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-08T17:14:53.693

这里的技巧是，当您必须绑定到绑定到 XML 的 ItemControl 上的 SelectedItem 时，所选项目本身就是一个 XmlElement，并且您必须使用 XPath 来获取所需的元素/属性。

实现这一点的最简单方法是使用 DataContext：

```
<TextBox x:Name=textBoxST 
    DataContext="{Binding ElementName=comboBoxST, Path=SelectedItem}" 
    Text="{Binding XPath=@Value}"/> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-07-09T18:45:03.793

对于它的价值，我更喜欢 Sergey 早期的方法。但是，在我的场景中，我有一个标签而不是文本框，但这对我有用：

```
 <Label x:Name="labelST" Content="{Binding ElementName=comboBoxST, Path=SelectedValue}"/> 
```

斯帕西巴，谢尔盖。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T22:59:59.930

上面发布的答案是针对直接放在表单上的列表框的情况。在 UserControl 和模板化 ComboBox 的情况下，我会避免纯 xml 绑定 - 太多因素会破坏它。相反，使用此代码创建一个依赖属性：

```
 public MyComboBox()
    {
        InitializeComponent();
        myComboBox.SelectionChanged += MyComboBoxSelectionChanged;
    }

    void MyComboBoxSelectionChanged(object sender, SelectionChangedEventArgs e)
    {
        SetValue(SelValueProperty, ((XmlElement)e.AddedItems[0]).Attributes["Value"].Value);
    }

    public static readonly DependencyProperty SelValueProperty =
        DependencyProperty.Register("SelValue", typeof(string), typeof(MyComboBox),
            new FrameworkPropertyMetadata("")); 
```

然后绑定很简单：

```
<TextBox x:Name=textBoxST Text="{Binding ElementName=comboBoxST, Path=SelValue}"/> 
```

# visual-studio - 使用 Visual Studio 2005 构建 LynxOS 应用程序

> ID：840408
> 
> 赞同：0
> 
> 时间：2009-05-08T15:29:47.377
> 
> 标签：visual-studio, lynxos

我正在尝试为 LynxOS（硬实时操作系统）构建应用程序。到目前为止，最好的方法是使用一个名为 VisualLynx 的插件，它将自己附加到 VS 6.0 并用其交叉编译器链接器等替换它的 make 系统。VS 6.0 使用起来真的很痛苦，所以我想使用 VS 2005 但它似乎 VS 2005 没有附加功能。有没有办法在 VS 2005 上使用我已经拥有的东西（Visual Lynx for VS 6.0）......会有很大帮助。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-16T12:01:23.540

我通常从 linux 交叉编译以用于 LynxOS 构建。在这方面，我在 Redhat 上的 IDE 中使用了 xemacs 或 eclipse。像冠军一样工作。

# c - 使用 C 检查用户输入是否为有效字符串

> ID：840410
> 
> 赞同：2
> 
> 时间：2009-05-08T15:29:49.967
> 
> 标签：c, validation

我正在从用户那里获取字符串输入。但是我如何检查用户是否输入了字符串或数字？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-08T15:34:13.777

调用 strtol，检查存储到 endptr 的值是否不等于输入（转换成功），并且是指向 NUL 字节的指针（使用了整个字符串）。

[http://www.opengroup.org/onlinepubs/000095399/functions/strtol.html](http://www.opengroup.org/onlinepubs/000095399/functions/strtol.html)

解释说，如果你还想检测溢出，诀窍是将errno设置为0，然后调用strtol，然后检查errno是否仍然为0。

如果您想学究气，还必须使用 isspace() 检查输入字符串的第一个字符是否为非空格。原因是 strtol 和朋友跳过了初始空格，但也许你不认为“1”是一个有效数字。

如果您想允许更大的数字或非整数数字，替代方案分别包括 strtoll 和 strtod。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T15:31:55.500

您可以检查它是否为数字：

```
char c;
scanf( "%c", &c );
if( isdigit(c) )
  printf( "You entered the digit %c\n", c ); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T15:34:06.307

```
int isNum;
 if ((isNum = strtol(string, NULL, 10)))
  printf(" '%d' numbers was found!\n", isNum);
else
 {
     printf("No number found");
 } 
```

转换读取的所有有效字符，如果字符串以无效字符开头，则函数返回零 (0)。

[strtol() 示例](http://www.kernel.org/doc/man-pages/online/pages/man3/strtol.3.html) ，显示如何在数字或字符串中不是数字的部分之后打印出以下字符。

**或者**

```
 int isNum
 isNum = atoi(string); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T16:05:17.587

这里已经有很多很好的启发式方法了。

如果您想仔细定义输入，您可能需要编写自己的词法分析器/解析器来准确接受您的意思，而不是尝试从标准库函数中构建临时工具。

这本身就是一个实质性的话题。请参阅可能的“如何构建编译器？”之一。StackOverflow 上的问题以供参考……（例如[学习编写编译器](https://stackoverflow.com/questions/1669/learning-to-write-a-compiler)）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T15:33:40.723

您可以使用 atoi 或 atof，然后检查此函数返回的值是否不为 0。这并非万无一失，因为用户可能输入了“0”。

另一种方法是检查字符串中的每个字符是否为 [0-9]、+/- 或小数点，并拒绝每个不符合要求的字符串。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-08T15:41:14.977

您尚未指定您期望的“数字”。根据有效的输入集，您可以调用其他人指定的许多标准库函数。例如：如果您期望浮点数，则简单检查它是否是数字不起作用。另请注意，仅调用库函数是不够的，您还需要检查返回值（即，如果在转换过程中发生任何错误）。

或者，您可以使用该`sscanf`功能检索数字。

最后，整数可以存储为一个`int`或其变体（`long`等）或浮点数。电话是你的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-08T17:39:41.480

而不是使用 strtol、atoi、atof 等函数。您可以定义自己的函数，该函数逐个字符地解析字符串并构建输出整数。如果在此解析过程中，如果字符是非数字，那么您可以放心地说 NaN 中的字符串。或者您也可以使用 isdigit() 并检查每个字符，如果所有字符都是数字，则使用 atoi 将字符串转换为数字。

# flash - 为什么在单击和移动鼠标时 Flash 不更新显示？

> ID：840440
> 
> 赞同：1
> 
> 时间：2009-05-08T15:34:25.993
> 
> 标签：flash, actionscript, actionscript-2, transparent

我有一个 Flash 剪辑，当鼠标单击影片剪辑时，它会移动影片剪辑。一些非常基本的东西。

我没有使用拖动（因为 MC 不会一直用鼠标移动），而是使用 onMouseMove 根据 _xmouse、_ymouse 和其他一些计算来更新 MC 位置。

问题是在 Internet Explorer 下移动变得非常缓慢，如果我一直缓慢移动鼠标，它不会更新，直到我停下来。

我检查了痕迹，事件被正确触发。我尝试使用 updateAfterEvent(); 没有帮助。

这在Firefox中没有发生。

（经过漫长而令人沮丧的调试，我最终找到了导致此问题的原因。由于我在网上寻找答案但没有找到答案，所以我决定在这里添加它以供其他人使用。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T15:37:24.253

当影片在 HTML 容器中被指定为“透明”时，就会发生这种行为。将其设置为“窗口”可以解决此问题。

我还是不知道为什么firefox没有出现“慢速效果”，也许firefox flash插件处理透明度更好。

# php - PHP中的字符串到字节/二进制数组

> ID：840457
> 
> 赞同：6
> 
> 时间：2009-05-08T15:37:15.893
> 
> 标签：php, arrays

如何在 PHP 中将字符串转换为二进制数组？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T17:06:08.613

我认为您要求与 Perl 打包/解包功能等效。如果是这种情况，我建议您查看 PHP 打包/解包函数：

*   [打开包装](http://us.php.net/manual/en/function.unpack.php "从二进制字符串中解压数据")
*   [盒](http://us.php.net/pack "将数据打包成二进制字符串")

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T15:53:01.517

PHP中没有二进制数组这样的东西。所有需要字节流的函数都对字符串进行操作。你到底想做什么？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T17:02:49.650

如果您尝试访问字符串的特定部分，则可以将其视为数组。

```
$foo = 'bar';
echo $foo[0]; 
```

输出：b

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-09T17:19:12.657

假设您要将 $stringA="Hello" 转换为二进制。

首先用 ord() 函数取第一个字符。这将为您提供十进制字符的 ASCII 值。在这种情况下，它是 72。

现在使用 dec2bin() 函数将其转换为二进制。然后接下一个函数。[您可以在http://www.php.net](http://www.php.net)找到这些函数的工作原理。

或者使用这段代码：

```
<?php
    // Call the function like this: asc2bin("text to convert");
    function asc2bin($string)
    {
        $result = '';
        $len = strlen($string);
        for ($i = 0; $i < $len; $i++)
        {
            $result .= sprintf("%08b", ord($string{$i}));
        }
        return $result;
    }

    // If you want to test it remove the comments
    //$test=asc2bin("Hello world");
    //echo "Hello world ascii2bin conversion =".$test."<br/>";
    //call the function like this: bin2ascii($variableWhoHoldsTheBinary)
    function bin2ascii($bin)
    {
        $result = '';
        $len = strlen($bin);
        for ($i = 0; $i < $len; $i += 8)
        {
            $result .= chr(bindec(substr($bin, $i, 8)));
        }
        return $result;
    }
    // If you want to test it remove the comments
    //$backAgain=bin2ascii($test);
    //echo "Back again with bin2ascii() =".$backAgain;
?> 
```

# java - 您是否见过一个附加程序，它会根据 Log4j 中的 NDC 记录到单独的文件？

> ID：840465
> 
> 赞同：3
> 
> 时间：2009-05-08T15:38:21.273
> 
> 标签：java, logging, log4j

我们只有极少数的客户（少于 50 个），我们希望每个客户都有自己独立的日志文件，所有服务器端日志信息都存放在其中。我知道您可以使用 NDC 和过滤器使用 Log4j 中的标准附加程序将日志语句定向到不同的文件，但这需要更多的设置（为所有现有客户创建记录器）并且它不会自动适应添加新客户进入系统。

您是否见过一个附加程序，它会根据 Log4j NDC 值将日志语句拆分为单独的文件？我想我可以构建一个新的 appender 来做到这一点，但我不能说如果我能得到一些已经构建好的东西，我想这样做。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-29T13:31:51.947

与 logback（log4j 的继任者）一起提供的 SiftingAppender 正是为处理这种情况而设计的。

顾名思义，a`SiftingAppender`可用于根据给定的运行时属性分离（或筛选）日志记录。例如，`SiftingAppender`可以根据用户会话分离日志事件，使每个用户生成的日志进入不同的日志文件，每个用户一个日志文件。例如，`SiftingAppender`可以将日志记录事件分成不同的日志文件，每个用户一个文件。

[SiftingAppender](http://logback.qos.ch/manual/appenders.html#SiftingAppender)的文档包含一个基于用户 ID 分离日志的示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T16:38:21.517

我不知道有任何标准甚至 3rd 方附加程序可以做到这一点，虽然你是正确的，你可以编写自己的，但我倾向于只使用标准文件附加程序之一（滚动或其他方式）并使用一个工具可以过滤文本行（即从视图中排除与模式不匹配的任何行）以读取日志。大多数可以过滤的编辑器也可以设置过滤器集，以便您可以重用现有模式。我不会讨论使用*哪个*编辑器，因为我什至不知道您使用的是什么操作系统，而且每个人都有自己的偏好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T17:27:38.157

听起来你想要一个多文件附加程序之类的东西，你提供文件名的一部分，其余部分用 NDC 填充。我不知道这样的事情。可能你必须自己动手。

如果您自己滚动，您可能希望创建一个`Appender`内部使用动态创建的 a `Map`of `RollingFileAppender`s。但是，我不知道 Appender 是否可以访问 NDC。这可能是一项不平凡的工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T21:23:14.750

我也从未遇到过这样的附加程序，但我认为编写自己的附加程序没什么大不了的。如果你想自己做 - 看看[AppenderSkeleton](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/AppenderSkeleton.html)，你至少要做的是重写 append(..) 方法。当您的 appender 被调用时，您将获得完整的事件，其中将包含所需的一切，包括 NDC。然后随心所欲地使用它。我认为在您的情况下，MDC（映射诊断上下文）是可行的替代方案，恕我直言，它更灵活。

如果您正在寻找商业解决方案 - 查看[logFaces](http://www.moonlit-software.com)，它是为处理类似情况而设计的。**披露**：我是该产品的作者。

# actionscript-3 - AS3：为 int、uint 或 Number 声明“未定义”参数

> ID：840469
> 
> 赞同：11
> 
> 时间：2009-05-08T15:39:04.110
> 
> 标签：actionscript-3, actionscript, function, parameters, int

我想实现以下逻辑：

```
function setMyValue (myVar:int = undefined):void
{
    if (myVar == undefined)
    {
        /* Generate a value for myVar */
    }
    else
    {
        /* Use the supplied value for myVar */
    }
} 
```

因此，如果提供了该值，请使用它。如果没有，则生成它。看起来很简单。

问题是 AS3 不喜欢这个。“未定义”被强制转换为“0”，因此 myVar 永远不会未定义。我尝试了 NaN、null 等的变体，但没有任何效果。我能想到的唯一办法是提供一些“幻数”作为默认值，但这很难看。有人知道更好的解决方案吗？

谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-08T17:40:40.057

**UPD**（来自我的评论）：选择一些幻数来表示值缺失当然​​不是一个好习惯，除非您可以完全确定这个幻数不会作为某些算术的结果出现（这通常是正确的）。因此，这里最好的方法是使用比`int`(eg `Number`) 更宽的类型，或者将一些标志 ( `Boolean`value) 传递给函数，以及`int`，以指示实际值不存在。选择应该取决于您是否要强调传递值是不可分割的事实的重要性。

* * *

如果您对扩展参数类型感到满意，那么您应该使用`NaN`并执行以下操作：

```
function setMyValue (myVar : Number = NaN) : void
{
    if ( isNaN(myVar) )
    {
        /* Generate a value for myVar */
    }
    else
    {
        /* Use the supplied value for myVar */
    }
} 
```

这在技术上更准确，也更稳定。它还允许您在编译时进行强类型输入，并且不会像使用`Object`.

`int`请注意，正如其中一个答案所暗示的那样，这将不起作用。`int`只有数值，并且会被强制为 0。您需要使用*type* .`NaN``Number`

如果您担心性能 - 不要担心。使用`Number`代替`int`或`uint`通常是可以的。

* * *

**UPD：**如果您想明确标记该参数应该是完整的，只需使用附加标志和确切类型 - 它会更清晰。

```
function setMyValue (isIntValueSupplied : Boolean = false, intValue : int = 0) : void
{
    if ( isIntValueSupplied )
    {
        /* Generate or use a default value of intValue */
    }
    else
    {
        /* Use the supplied value for intValue */
    }
} 
```

* * *

另一种选择是使用附加值定义您自己的类型，例如`MaybeInt`，它包含整数值和一个标志（无论它是否实际初始化）。这样你就会清楚地表明 value 应该是 integer 或*no-value*。但是，这种方法可能有点笨重。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T15:45:55.093

生成的值是 const 吗？如果是，为什么不简单地将其作为默认值？

> 问题是 AS3 不喜欢这个。“未定义”被强制转换为“0”，因此 myVar 永远不会未定义。

是的，因为这是`int`(for `string`and `Object`this'd be `null`) 的默认初始化值。

另一种选择是将参数松散地键入为 an`Object`或保持未指定（通过使用 a ）， 如果它不是，则`*`稍后将其类型转换为。`int``null`

```
function setMyValue (myVar:Object = null):void
{
    if (myVar == null)
    {
        /* Generate a value for myVar */
    }
    else
    {
        int value = myVar as int;
        /* Use the supplied value for myVar */
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-20T11:00:19.500

我的解决方案是简单地使用它

```
if(myUint == new uint){ is undefined, act appropriately; } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-17T10:06:03.067

```
function setMyValue (myVar:int = -1):void
{
    if (myVar == -1)
    {
        /* Generate a value for myVar */
    }
    else
    {
        /* Use the supplied value for myVar */
    }
} 
```

# visual-studio-2008 - VS2008 设计器中的“无法加载基类”错误

> ID：840471
> 
> 赞同：0
> 
> 时间：2009-05-08T15:39:08.370
> 
> 标签：visual-studio-2008, designer

Visual Studio 在尝试打开一个简单类时出错，并出现错误“设计人员检查了文件中的以下类：InstallerSupport --- 无法加载基类 'Microsoft.ManagementConsole.SnapInInstaller'”

我已经引用了程序集，并且项目构建得很好。尝试在我的编译代码上运行 installutil 时，我也会遇到错误，这可能是相关的。我怀疑我错过了一些明显的东西......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T16:40:21.670

我认为您的答案在 msdn 论坛上： [http ://social.msdn.microsoft.com/Forums/en-US/clr/thread/72e5c51a-9ea7-40b4-a24d-f2f8f713a01e/](http://social.msdn.microsoft.com/Forums/en-US/clr/thread/72e5c51a-9ea7-40b4-a24d-f2f8f713a01e/)

截图如下：“好的，我测试了使用 C:\WINDOWS\System32 中的 microsoft.managementconsole.dll（文件版本：5.2.3790.2612Z）编译。使用 VS2005 编译后，VS2005 自动在调试目录。

而且我能够使用 !!!! 成功安装管理单元

所以我回到 C:\Program Files\Reference Assemblies\Microsoft\mmc\v3.0 并找到一个 mmcfxcommon.dll（文件版本 6.0.6001.16651）

将 mmcfxcommon.dll 复制到调试文件夹后，现在可以安装了。

所以最后，我错过了 mmcfxcommon.dll。”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T20:31:03.970

已修复 - 我安装了更新的 SDK，并尝试从 microsoft.managementconsole.dd 版本 6.0.6001.17011 而不是 5.2.3790.3959 加载类型。现在我已经从 DLL Hell 中逃脱了，一切都很好。

# visual-studio - Visual Studio 的 .sln 和 .vcproj 文件中的宏/环境变量

> ID：840472
> 
> 赞同：33
> 
> 时间：2009-05-08T15:39:11.380
> 
> 标签：visual-studio, project, path, solution

我有两个类似的问题：

a）我有一个包含多个项目的解决方案，我希望能够通过设置一些环境变量/宏来轻松切换项目位置。例如，这个项目可以位于 \SolutionDir\Dir1\ 或 \SolutionDir\Dir2\ 所以，我想指定它应该位于 \SolutionDir\$(Var) 并设置变量。

在 Visual Studio 中是否有任何构建方式来做到这一点？

我目前只知道两种解决方案 - 手动/以编程方式编辑 .sln 文件以找到该项目并设置正确的路径。

我无法在 .sln 文件中使用环境变量。

b) 我有一个包含资源（.rc 和 .h）文件的项目。我希望能够通过其他环境变量或宏来设置它们的位置。

像 \ProjectDir\$(Var2)\resource.rc 这样的东西

我在属性表上找到了一些有希望的信息，但是当我在 .vcproj 的文件标记中使用宏时，Visual Studio 不会扩展宏。

感谢您提出如何解决此问题的任何想法。

问候，维克多

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-07-14T17:46:59.473

只需在相关字段中使用环境变量：

```
OutputDirectory="$(MyEnvVariableName)\Bin" 
```

一个技巧是每次更改变量时都需要重新启动 Visual Studio IDE。

有一篇关于此的 MSDN 文章：[How to: Use Environment Variables in a Build](http://msdn.microsoft.com/en-us/library/ms171459.aspx)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-05-26T08:37:57.197

我想我的目标和你一样：我想使用环境变量来定位解决方案文件（.sln）中的一些项目，并使用一些环境变量来定位我的项目中的一些文件。

我找到了一种方法，它对我来说很好（使用 Visual Studio 2005）： - 使用文本编辑器编辑 .sln 文件并使用以下语法 %MyEnvironmentVariable% 的环境变量 - 编辑 .vcproj 文件并替换带有一些变量的所需文件的路径，使用以下语法 $(MyEnvironmentVariable)。

希望它有所帮助......西里尔

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-26T08:56:37.050

实现您在 b) 中描述的最佳方法是使用属性表。也看看这个非常[相似的问题](https://stackoverflow.com/questions/634466/how-to-add-environmental-variable-to-vs-solution-sln)。

> 我在属性表上找到了一些有希望的信息，但是当我在 .vcproj 的文件标记中使用宏时，Visual Studio 不会扩展宏。

我不确定您使用的是哪个版本的 VS。VS2008 允许您定义例如这样的包含目录：“$(OpenCVInclude)\cxcore\include”。我用它所有的时间。OpenCVInclude 是在属性表中定义的宏。

至于问题a），我认为没有“干净”的方式来做你想做的事。作为替代方案，您可以使用配置管理器：

*   包括解决方案中的所有项目。
*   以不同的方式命名项目，例如基于 OEM。
*   为每个项目定义解决方案中的发布和调试配置
*   在“Build->Configuration Manager”中，您可以选中或取消选中每个配置的“Build”列。检查相关项目的“构建”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-01-28T04:55:05.803

我不确定您是仅构建 C++ 项目还是构建 C#\VB 项目，但 Visual Studio 的一大优点是所有项目实际上都只是 MSBuild 项目。如果您在文本编辑器中编辑项目，您将看到在项目结束时它会导入一个 .targets 文件。如果您跟踪并找到后续导入，您会发现几乎所有 VS 项目都导入 Microsoft.Common.Targets。Microsoft.Common.Targets 导入 Custom.Before.Microsoft.Common.Targets。使用此导入，您可以使用自己的自定义操作导入自己的目标文件。

例如，我有一个目标文件，该文件具有在解决方案中的所有项目中定义的公共属性，以及在每个项目构建结束时处理的自定义构建后事件。

使用此扩展方法并通过在解决方案中创建除了标准版本\调试之外的自定义配置，您应该能够根据需要创建尽可能复杂的构建配置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-06T21:51:22.753

(a) Cyrille 为您的要求提供了一个不错的解决方案。另一种方法是将可更改的设置保存在一个公共位置。请注意，这不适用于 *.sln 和 *.vcproj 等非 msbuild 文件（直到 VS 2010）。

项目文件：... $(ChangeableDir)\foo.cs

Common.targets: ChangeThis ...

但是，我不认为这是做事的好方法。如果您正在构建的功能之间的差异很大，您应该考虑在源代码控制系统中创建一个分支。OTOH，如果差异很小 - 例如硬编码字符串 - 那么这会导致您的第二个问题......

(b) 您描述的资源管理类型本质上与人们将项目本地化为不同语言所面临的问题相同。幸运的是，自 2005 年以来，Visual Studio 中内置了直接支持。查看以前的问题，例如：[Visual Studio 2008 中的本地化](https://stackoverflow.com/questions/355685/localization-in-visual-studio-2008)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-07-14T13:12:38.593

一种解决方案是在启动 VS 之前设置一些环境变量。在我们的项目中，我们使用如下所示的批处理文件：

```
SET ROOT=D:/root
SET COMPILER_ROOT=C:/Program Files (x86)/Microsoft Visual Studio 12.0/Common7/IDE
start "Microsoft Visual Studio 12.0" /D"%COMPILER_ROOT%\" "%COMPILER_ROOT%/devenv.exe" "%ROOT%\trunk\OurSolution.sln" 
```

# c# - 是否可以更改 WPF 中禁用按钮的背景颜色？

> ID：840477
> 
> 赞同：5
> 
> 时间：2009-05-08T15:41:09.050
> 
> 标签：c#, wpf, xaml

我试图获得“使整个窗口及其上的所有控件变暗”的效果。

该窗口及其上的所有内容也需要禁用。

问题是当按钮被禁用时，它似乎不允许您更改背景颜色。

**WPF 中有没有办法更改按钮的背景颜色，即使它被禁用？**

**XAML：**

```
<Window x:Class="TestDimWindows.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">

    <Grid x:Name="dimElement">
        <StackPanel HorizontalAlignment="Left">
            <TextBlock 
                Text="This is an example of dimming a window." 
                Margin="5"/>
            <StackPanel 
                HorizontalAlignment="Left" 
                Margin="5">
                <Button x:Name="theButton" 
                        Content="Dim the window" 
                        Click="Button_Click"/>
            </StackPanel>
        </StackPanel>
    </Grid>

</Window> 
```

**代码背后：**

```
using System.Windows;
using System.Windows.Media;

namespace TestDimWindows
{
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
        }

        private void Button_Click(object sender, RoutedEventArgs e)
        {
            dimElement.Background = new SolidColorBrush(Colors.Gray);
            dimElement.Opacity = 0.5;
            dimElement.IsEnabled = false;

            //I want this button to look "dimmed out" as well
            //but since it is disabled, it is a ghostly white.
            //how can I change the color even though it is disabled?
            theButton.Background = new SolidColorBrush(Colors.Gray);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T15:44:32.163

您可以删除 onclick，并更改颜色，然后将其设为“禁用”状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T15:44:20.057

您可以为其创建自己的控件模板。

我建议使用 Blend（如果您没有许可证，您可以获得试用版）来创建您当前使用的模板的副本。

如果您检查当前模板，它必须在某处将背景颜色设置为禁用。查找基于 IsEnabled 属性的触发器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-09T16:53:13.097

我会尝试使用填充整个网格的矩形来实现暗淡效果，它是灰色的，不透明度小于 1，z-index 高于正常控件。默认情况下，矩形将具有可见性 = 折叠，然后我将使用触发器将其可见性设置为当某些适当的“IsEnabled”属性变为“true”时可见。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T16:11:54.360

查看 VisualBrush。您可以将 VisualBrush 的视觉效果设置为控件，VisualBrush 将重新创建控件的视觉表示，而没有任何实际功能。

我从 Sells/Griffiths 的“Programming WPF”（关于图形的第 13 章）中获取了这个示例，并自己对其进行了一些修改，然后再进行了一些修改以向您展示解决方案。

这样做是创建一个简单的绘图界面（输入 2 个点的 x 和 y 坐标在它们之间画一条线），但也反映了下图。它根本不意味着强大，但它应该展示我认为您正在寻找的功能。
最后 2 个带有 VisualBrush 和 SolidColorBrush 的矩形元素是我创建复制控件然后将其遮蔽的方式。

您可以做的是将这两个元素覆盖在您想要遮蔽的页面/窗口/等上，然后在您希望效果发生时使它们可见。

希望这可以帮助。

```
<Window x:Class="GraphicsTest.Window1"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
Title="Window1" Height="300" Width="300">
<Window.Resources>
</Window.Resources>
<Grid>
    <Grid.RowDefinitions>
        <RowDefinition Height="2*"/>
        <RowDefinition Height="1*"></RowDefinition>
    </Grid.RowDefinitions>
    <Grid x:Name="mainUI">
        <DockPanel>
            <GroupBox Header="Point 1" Name="gbPoint1" DockPanel.Dock="Top">
                <StackPanel Orientation="Horizontal">
                    <Label Width="40" HorizontalContentAlignment="Right">X:</Label>
                    <TextBox Name="tbX1" Width="40" TextChanged="Content_TextChanged"/>
                    <Label Width="40" HorizontalContentAlignment="Right">Y:</Label>
                    <TextBox Name="tbY1" Width="40" TextChanged="Content_TextChanged"/>
                </StackPanel>
            </GroupBox>
            <GroupBox Header="Point 2" Name="gbPoint2"  DockPanel.Dock="Top">
                <StackPanel Orientation="Horizontal">
                    <Label Width="40" HorizontalContentAlignment="Right">X:</Label>
                    <TextBox Name="tbX2" Width="40" TextChanged="Content_TextChanged"/>
                    <Label Width="40" HorizontalContentAlignment="Right">Y:</Label>
                    <TextBox Name="tbY2" Width="40" TextChanged="Content_TextChanged"/>
                </StackPanel>
            </GroupBox>
            <Canvas>
                <Line Name="lnDraw" Stroke="Black" StrokeThickness="2"/>
            </Canvas>
        </DockPanel>
    </Grid>
    <Rectangle Grid.Row="1">
        <Rectangle.LayoutTransform>
            <ScaleTransform ScaleY="-1"/>
        </Rectangle.LayoutTransform>
        <Rectangle.Fill>
            <VisualBrush Visual="{Binding ElementName=mainUI}" />
        </Rectangle.Fill>
    </Rectangle>
    <Rectangle Grid.Row="1">
        <Rectangle.Fill>
            <SolidColorBrush Color="Black" Opacity=".5"/>
        </Rectangle.Fill>
    </Rectangle>
</Grid> 
```

还有.cs

```
public partial class Window1 : Window
{
    public Window1()
    {
        InitializeComponent();
    }

    private void Content_TextChanged(object sender, TextChangedEventArgs e)
    {
        int x1;
        int x2;
        int y1;
        int y2;

        if (int.TryParse(tbX1.Text, out x1) && int.TryParse(tbX2.Text, out x2) && int.TryParse(tbY1.Text, out y1) && int.TryParse(tbY2.Text, out y2))
        {
            lnDraw.X1 = x1;
            lnDraw.X2 = x2;
            lnDraw.Y1 = y1;
            lnDraw.Y2 = y2;
        }
    }
} 
```

# emacs - 在 Windows 上的 Emacs 中将 Caps Lock 映射到 Control

> ID：840478
> 
> 赞同：12
> 
> 时间：2009-05-08T15:41:14.510
> 
> 标签：emacs, elisp, autohotkey

在阅读[这些](https://stackoverflow.com/questions/127973/is-it-worth-swapping-ctrl-and-caps-lock-for-windows-users-that-dont-use-emacs) [问题](https://stackoverflow.com/questions/508874/how-to-remap-keys-when-in-emacs)或[EmacsWiki 文章中](http://www.emacswiki.org/emacs/MovingTheCtrlKey#toc12)关于将 Caps Lock 映射到 Windows 中的 emacs 中的控制时，最好的答案似乎涉及注册表。我的问题是当用户因为没有管理员权限而无法修改机器的注册表时可以做什么。有没有办法从emacs中进行映射？[这篇文章](http://emacs-fu.blogspot.com/2008/12/remapping-caps-lock.html)非常接近，甚至说：“正如人们所提到的，您当然可以将 Caps-Lock 映射到其他键，例如 Control 键。” 但我不知道如何表示控制键（使用[各种](http://sunsite.univie.ac.at/textbooks/emacs/emacs_35.html#SEC451)看起来非常全面但可能不是以 Windows 为中心的参考），尝试类似

```
(setq w32-enable-caps-lock nil)
(global-set-key [capslock] '[control]) 
```

和

```
(setq w32-enable-caps-lock nil)
(global-set-key [capslock] 'ctl-x-map) 
```

这似乎不起作用。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-08T16:36:20.993

我知道这并不能真正回答你的问题，但 Trey Jackson 基本上解释了这个问题。单独检测控制键需要 Windows 上的低级键盘挂钩，我认为 Emacs 没有实现。

一种方法（涉及外部程序，但不需要管理员权限）是使用[AutoHotkey](http://www.autohotkey.com/ "自动热键")。您只需要以下 2 行脚本：

```
CapsLock::Ctrl
LCtrl::Capslock 
```

每当打开 emacs 时，您都需要运行此脚本，但幸运的是 Autohotkey 是一个非常低调的应用程序（通常只占用大约数百 Kb 的内存）。例如，您可以在 .emacs 中执行此脚本，以便在打开 emacs 时交换控制键和大写锁定键。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-08T16:20:43.120

我相信它不起作用，因为 Windows（或 X）没有为`[capslock]`or传递实际事件`[control]`——它是一个修饰键，比如`[shift]`. 按下修饰键不会导致应用程序获得击键，但如果按下修饰键和第二个（非修饰键）键，则会获得击键。

例如`[a]`and`[A]`是两个不同的键，一个是常规的“a”，另一个本质上是“shift-a”。我相信您可以将 Windows 设置为让“shift-a”实际上发送“z”或其他东西。

因为`[capslock]`, `[control]`, `[shift]`,`[meta]`都是修饰键，所以它们本身不会为应用程序生成键事件。

简而言之，Emacs 没有得到`[control]`可以重新映射的关键事件，而是得到了一个`C-a`事件。这通常通过`[control]`和`[a]`键的明显组合来完成。但是，事件可能由不同的击键产生，比如说`[F10]`甚至`[y]`（令人困惑，是的）。

我是这样理解的。当然欢迎澄清。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-09T16:36:48.637

在 Windows 上重新映射 CapsLock 的最简单方法是下载此[CapsLockChanger](http://www.filebird.com/caps-lock-changer/download/)实用程序，选择要映射到的键（控制）并将其放在开始->启动菜单中。

它保留在您的托盘中，完成密钥重新映射的工作，并且不需要弄乱注册表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-09T19:26:28.857

您不一定需要管理员权限才能修改注册表。
事实上，Windows 注册表是一个分段资源，很像文件系统，您可以对注册表中的各个分支和节点拥有细粒度的权限。您确定您无法更改注册表的假设是否正确？我认为默认情况下在 Vista 上是这样，但在以前的 Windows 上不是。

# c - C 中的函数指针是如何工作的？

> ID：840501
> 
> 赞同：1400
> 
> 时间：2009-05-08T15:49:17.003
> 
> 标签：c, function-pointers

我最近对 ​​C 中的函数指针有了一些经验。

因此，继续回答您自己的问题的传统，我决定为那些需要快速深入了解该主题的人做一个非常基础的小总结。

* * *

## 回答 #1

> 赞同：1628
> 
> 时间：2009-05-08T15:49:59.090

# C中的函数指针

让我们从一个我们将*指向*的基本函数开始：

```
int addInt(int n, int m) {
    return n+m;
} 
```

首先，让我们定义一个指向函数的指针，该函数接收 2`int`并返回一个`int`：

```
int (*functionPtr)(int,int); 
```

现在我们可以安全地指向我们的函数：

```
functionPtr = &addInt; 
```

现在我们有了一个指向函数的指针，让我们使用它：

```
int sum = (*functionPtr)(2, 3); // sum == 5 
```

将指针传递给另一个函数基本上是一样的：

```
int add2to3(int (*functionPtr)(int, int)) {
    return (*functionPtr)(2, 3);
} 
```

我们也可以在返回值中使用函数指针（尽量跟上，它会变得混乱）：

```
// this is a function called functionFactory which receives parameter n
// and returns a pointer to another function which receives two ints
// and it returns another int
int (*functionFactory(int n))(int, int) {
    printf("Got parameter %d", n);
    int (*functionPtr)(int,int) = &addInt;
    return functionPtr;
} 
```

但是使用 a 更好`typedef`：

```
typedef int (*myFuncDef)(int, int);
// note that the typedef name is indeed myFuncDef

myFuncDef functionFactory(int n) {
    printf("Got parameter %d", n);
    myFuncDef functionPtr = &addInt;
    return functionPtr;
} 
```

* * *

## 回答 #2

> 赞同：324
> 
> 时间：2009-05-08T16:32:47.773

**C 中的函数指针可用于在 C 中执行面向对象的编程。**

例如，以下行是用 C 编写的：

```
String s1 = newString();
s1->set(s1, "hello"); 
```

是的，`->`and 缺少`new`操作符是一个死命，但这似乎意味着我们正在将某个`String`类的文本设置为`"hello"`.

通过使用函数指针，**可以模拟 C 中的方法**。

这是如何实现的？

该类`String`实际上是一个`struct`带有一堆函数指针的类，它们充当模拟方法的一种方式。以下是`String`该类的部分声明：

```
typedef struct String_Struct* String;

struct String_Struct
{
    char* (*get)(const void* self);
    void (*set)(const void* self, char* value);
    int (*length)(const void* self);
};

char* getString(const void* self);
void setString(const void* self, char* value);
int lengthString(const void* self);

String newString(); 
```

可以看出，`String`类的方法实际上是指向声明函数的函数指针。在准备 的实例时`String`，`newString`调用该函数以设置指向它们各自函数的函数指针：

```
String newString()
{
    String self = (String)malloc(sizeof(struct String_Struct));

    self->get = &getString;
    self->set = &setString;
    self->length = &lengthString;

    self->set(self, "");

    return self;
} 
```

例如，`getString`调用`get`方法调用的函数定义如下：

```
char* getString(const void* self_obj)
{
    return ((String)self_obj)->internal->value;
} 
```

可以注意到的一件事是，没有对象实例的概念并且具有实际上是对象一部分的方法，因此必须在每次调用时传入“自身对象”。（而且`internal`只是一个隐藏`struct`的，它在前面的代码清单中被省略了——它是一种执行信息隐藏的方法，但这与函数指针无关。）

因此，与其能够做`s1->set("hello");`，不如传入对象以执行对 的操作`s1->set(s1, "hello")`。

由于这个小解释必须传递对您自己的引用，我们将进入下一部分，即**C 中的继承**。

假设我们想要创建一个 的子类`String`，比如说一个`ImmutableString`。为了使字符串不可变，该`set`方法将不可访问，同时保持对`get`and的访问`length`，并强制“构造函数”接受 a `char*`：

```
typedef struct ImmutableString_Struct* ImmutableString;

struct ImmutableString_Struct
{
    String base;

    char* (*get)(const void* self);
    int (*length)(const void* self);
};

ImmutableString newImmutableString(const char* value); 
```

基本上，对于所有子类，可用的方法又是函数指针。这一次，该`set`方法的声明不存在，因此不能在`ImmutableString`.

至于 的实现`ImmutableString`，唯一相关的代码是“构造函数”函数，即`newImmutableString`：

```
ImmutableString newImmutableString(const char* value)
{
    ImmutableString self = (ImmutableString)malloc(sizeof(struct ImmutableString_Struct));

    self->base = newString();

    self->get = self->base->get;
    self->length = self->base->length;

    self->base->set(self->base, (char*)value);

    return self;
} 
```

在实例化 时，指向and方法`ImmutableString`的函数指针实际上是通过遍历作为内部存储对象的变量来引用and方法。`get``length``String.get``String.length``base``String`

使用函数指针可以实现从超类继承方法。

我们可以进一步继续**C 中的多态性**。

例如，如果出于某种原因我们想要更改`length`方法的行为以`0`在`ImmutableString`类中始终返回，那么我们要做的就是：

1.  添加一个将用作覆盖`length`方法的函数。
2.  转到“构造函数”并将函数指针设置为覆盖`length`方法。

添加覆盖`length`方法`ImmutableString`可以通过添加`lengthOverrideMethod`：

```
int lengthOverrideMethod(const void* self)
{
    return 0;
} 
```

然后，构造函数中方法的函数指针`length`连接到`lengthOverrideMethod`：

```
ImmutableString newImmutableString(const char* value)
{
    ImmutableString self = (ImmutableString)malloc(sizeof(struct ImmutableString_Struct));

    self->base = newString();

    self->get = self->base->get;
    self->length = &lengthOverrideMethod;

    self->base->set(self->base, (char*)value);

    return self;
} 
```

现在，类中的`length`方法不再具有与`ImmutableString`类相同的行为，而是方法将引用函数中定义的行为。`String``length``lengthOverrideMethod`

我必须添加一个免责声明，我仍在学习如何用 C 语言编写面向对象的编程风格，所以可能有些地方我没有很好地解释，或者可能只是在如何最好地实现 OOP 方面偏离了标准但我的目的是试图说明函数指针的众多用途之一。

有关如何在 C 中执行面向对象编程的更多信息，请参阅以下问题：

*   [C语言中的面向对象？](https://stackoverflow.com/questions/415452/object-orientation-in-c)
*   [你能用C写面向对象的代码吗？](https://stackoverflow.com/questions/351733/can-you-write-object-oriented-code-in-c)

* * *

## 回答 #3

> 赞同：250
> 
> 时间：2011-04-09T00:51:16.587

被解雇的指南：如何在 x86 机器上通过手动编译代码来滥用 GCC 中的函数指针：

这些字符串文字是 32 位 x86 机器代码的字节。 `0xC3`是[x86`ret`指令](http://felixcloutier.com/x86/RET.html)。

您通常不会手动编写这些，而是​​用汇编语言编写，然后使用汇编程序`nasm`将其组装成平面二进制文件，然后将其十六进制转储为 C 字符串文字。

1.  返回 EAX 寄存器的当前值

    ```
    int eax = ((int(*)())("\xc3 <- This returns the value of the EAX register"))(); 
    ```

2.  写一个交换函数

    ```
    int a = 10, b = 20;
    ((void(*)(int*,int*))"\x8b\x44\x24\x04\x8b\x5c\x24\x08\x8b\x00\x8b\x1b\x31\xc3\x31\xd8\x31\xc3\x8b\x4c\x24\x04\x89\x01\x8b\x4c\x24\x08\x89\x19\xc3 <- This swaps the values of a and b")(&a,&b); 
    ```

3.  写一个for循环计数器到1000，每次调用某个函数

    ```
    ((int(*)())"\x66\x31\xc0\x8b\x5c\x24\x04\x66\x40\x50\xff\xd3\x58\x66\x3d\xe8\x03\x75\xf4\xc3")(&function); // calls function with 1->1000 
    ```

4.  你甚至可以编写一个计数到 100 的递归函数

    ```
    const char* lol = "\x8b\x5c\x24\x4\x3d\xe8\x3\x0\x0\x7e\x2\x31\xc0\x83\xf8\x64\x7d\x6\x40\x53\xff\xd3\x5b\xc3\xc3 <- Recursively calls the function at address lol.";
    i = ((int(*)())(lol))(lol); 
    ```

请注意，编译器将字符串文字放置在`.rodata`节中（或`.rdata`在 Windows 上），该节作为文本段的一部分（与函数代码一起）链接。

文本段具有 Read+Exec 权限，因此将字符串文字转换为函数指针无需系统调用`mprotect()`，`VirtualProtect()`就像您需要动态分配的内存一样。（或`gcc -z execstack`将程序与堆栈+数据段+堆可执行文件链接，作为快速破解。）

* * *

要反汇编这些，您可以编译它以在字节上放置标签，并使用反汇编程序。

```
// at global scope
const char swap[] = "\x8b\x44\x24\x04\x8b\x5c\x24\x08\x8b\x00\x8b\x1b\x31\xc3\x31\xd8\x31\xc3\x8b\x4c\x24\x04\x89\x01\x8b\x4c\x24\x08\x89\x19\xc3 <- This swaps the values of a and b"; 
```

用 编译`gcc -c -m32 foo.c`和反汇编`objdump -D -rwC -Mintel`，我们可以得到程序集，并发现这段代码通过破坏 EBX（保留调用的寄存器）违反了 ABI，并且通常效率低下。

```
00000000 <swap>:
   0:   8b 44 24 04             mov    eax,DWORD PTR [esp+0x4]   # load int *a arg from the stack
   4:   8b 5c 24 08             mov    ebx,DWORD PTR [esp+0x8]   # ebx = b
   8:   8b 00                   mov    eax,DWORD PTR [eax]       # dereference: eax = *a
   a:   8b 1b                   mov    ebx,DWORD PTR [ebx]
   c:   31 c3                   xor    ebx,eax                # pointless xor-swap
   e:   31 d8                   xor    eax,ebx                # instead of just storing with opposite registers
  10:   31 c3                   xor    ebx,eax
  12:   8b 4c 24 04             mov    ecx,DWORD PTR [esp+0x4]  # reload a from the stack
  16:   89 01                   mov    DWORD PTR [ecx],eax     # store to *a
  18:   8b 4c 24 08             mov    ecx,DWORD PTR [esp+0x8]
  1c:   89 19                   mov    DWORD PTR [ecx],ebx
  1e:   c3                      ret    

  not shown: the later bytes are ASCII text documentation
  they're not executed by the CPU because the ret instruction sends execution back to the caller 
```

该机器代码将（可能）在 Windows、Linux、OS X 等系统上以 32 位代码运行：所有这些操作系统上的默认调用约定在堆栈上传递参数，而不是在寄存器中更有效地传递参数。但是 EBX 在所有正常的调用约定中都保留了调用，因此将其用作临时寄存器而不保存/恢复它很容易使调用者崩溃。

* * *

## 回答 #4

> 赞同：120
> 
> 时间：2009-05-08T16:26:09.800

我最喜欢的函数指针用途之一是便宜且简单的迭代器 -

```
#include <stdio.h>
#define MAX_COLORS  256

typedef struct {
    char* name;
    int red;
    int green;
    int blue;
} Color;

Color Colors[MAX_COLORS];

void eachColor (void (*fp)(Color *c)) {
    int i;
    for (i=0; i<MAX_COLORS; i++)
        (*fp)(&Colors[i]);
}

void printColor(Color* c) {
    if (c->name)
        printf("%s = %i,%i,%i\n", c->name, c->red, c->green, c->blue);
}

int main() {
    Colors[0].name="red";
    Colors[0].red=255;
    Colors[1].name="blue";
    Colors[1].blue=255;
    Colors[2].name="black";

    eachColor(printColor);
} 
```

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2009-05-09T02:05:44.447

一旦有了基本的声明符，函数指针就很容易声明了：

*   id: `ID`: *ID 是一个*
*   指针: `*D`: *D 指向的指针*
*   Function: `D(<parameters>)`: *D 函数取`<`参数`>`返回*

而 D 是使用相同规则构建的另一个声明符。最后，在某个地方，它以`ID`（参见下面的示例）结尾，这是声明的实体的名称。让我们尝试构建一个函数，该函数接受一个指针，该指针指向一个不接受任何内容并返回 int 的函数，并返回一个指向一个接受 char 并返回 int 的函数的指针。使用类型定义是这样的

```
typedef int ReturnFunction(char);
typedef int ParameterFunction(void);
ReturnFunction *f(ParameterFunction *p); 
```

如您所见，使用 typedef 构建它非常容易。如果没有 typedef，使用上述声明符规则也不难，一致地应用。如您所见，我错过了指针指向的部分以及函数返回的内容。这就是出现在声明的最左边的内容，并且不感兴趣：如果已经建立了声明符，它会在最后添加。让我们这样做。始终如一地构建它，首先是冗长的 - 使用`[`and显示结构`]`：

```
function taking 
    [pointer to [function taking [void] returning [int]]] 
returning
    [pointer to [function taking [char] returning [int]]] 
```

如您所见，可以通过一个接一个地附加声明符来完全描述一种类型。可以通过两种方式进行构建。一种是自下而上，从最正确的东西（叶子）开始，一直到标识符。另一种方式是自上而下，从标识符开始，一直到叶子。我将展示两种方式。

## 自下而上

构造从右边的东西开始：返回的东西，也就是接受 char 的函数。为了使声明符不同，我将对它们进行编号：

```
D1(char); 
```

直接插入 char 参数，因为它很简单。`D1`通过替换来添加指向声明符的指针`*D2`。请注意，我们必须将括号括起来`*D2`。这可以通过查找`*-operator`和 函数调用运算符的优先级来知道`()`。如果没有我们的括号，编译器会将其读取为`*(D2(char p))`. 但这当然不再是对 D1 的简单替换`*D2`。声明符周围总是允许使用括号。因此，实际上，如果添加太多它们，您不会做错任何事。

```
(*D2)(char); 
```

返回类型完成！现在，让我们用`D2`函数声明*器函数替换`<parameters>`返回*，这就是`D3(<parameters>)`我们现在的样子。

```
(*D3(<parameters>))(char) 
```

请注意，不需要括号，因为这次我们*想* `D3`成为函数声明符而不是指针声明符。太好了，唯一剩下的就是它的参数。该参数的完成与我们完成返回类型完全相同，只是`char`替换为`void`. 所以我会复制它：

```
(*D3(   (*ID1)(void)))(char) 
```

我已经替换`D2`为`ID1`，因为我们已经完成了该参数（它已经是一个指向函数的指针 - 不需要另一个声明符）。`ID1`将是参数的名称。现在，我在最后告诉上面添加了所有这些声明符修改的类型 - 出现在每个声明的最左侧的那个。对于函数，这成为返回类型。对于指向类型等的指针......当写下类型时，它会以相反的顺序出现在最右边:) 无论如何，替换它会产生完整的声明。当然两次`int`。

```
int (*ID0(int (*ID1)(void)))(char) 
```

我`ID0`在那个例子中调用了函数的标识符。

## 自顶向下

这从类型描述中最左边的标识符开始，当我们穿过右边时包装该声明符。*从带参数**返回的**函数*开始*`<``>`*

```
ID0(<parameters>) 
```

描述中的下一件事（在“返回”之后）是*指向*. 让我们合并它：

```
*ID0(<parameters>) 
```

然后接下来的事情是*functon 接受`<`参数`>`返回*。参数是一个简单的字符，所以我们马上又把它放进去，因为它真的很简单。

```
(*ID0(<parameters>))(char) 
```

注意我们添加的括号，因为我们再次希望`*`首先绑定，*然后*是`(char)`. 否则它会读取*带`<`参数的`>`函数返回函数 ...*。不，甚至不允许函数返回函数。

现在我们只需要放`<`参数`>`。我将展示推导的一个简短版本，因为我认为您现在已经知道如何去做。

```
pointer to: *ID1
... function taking void returning: (*ID1)(void) 
```

`int`就像我们在自下而上所做的那样放在声明符之前，我们就完成了

```
int (*ID0(int (*ID1)(void)))(char) 
```

## 好东西

自下而上还是自上而下更好？我习惯于自下而上，但有些人可能更喜欢自上而下。我认为这是一个品味问题。顺便说一句，如果您在该声明中应用所有运算符，您最终会得到一个 int：

```
int v = (*ID0(some_function_pointer))(some_char); 
```

这是 C 中声明的一个很好的属性：声明断言，如果在使用标识符的表达式中使用这些运算符，那么它会产生最左边的类型。数组也是如此。

希望你喜欢这个小教程！现在，当人们想知道函数的奇怪声明语法时，我们可以链接到这个。我试图尽可能少地放置 C 内部组件。随意编辑/修复其中的内容。

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2013-06-10T19:56:41.133

## 函数指针的另一个好用处：
在版本之间轻松切换

当您在不同时间或不同开发阶段需要不同功能时，它们非常方便使用。例如，我正在一台有控制台的主机上开发一个应用程序，但该软件的最终版本将放在 Avnet ZedBoard 上（它有用于显示器和控制台的端口，但它们对于最终版本）。所以在开发过程中，我会用它`printf`来查看状态和错误信息，但是当我完成后，我不想打印任何东西。这是我所做的：

# 版本.h

```
// First, undefine all macros associated with version.h
#undef DEBUG_VERSION
#undef RELEASE_VERSION
#undef INVALID_VERSION

// Define which version we want to use
#define DEBUG_VERSION       // The current version
// #define RELEASE_VERSION  // To be uncommented when finished debugging

#ifndef __VERSION_H_      /* prevent circular inclusions */
    #define __VERSION_H_  /* by using protection macros */
    void board_init();
    void noprintf(const char *c, ...); // mimic the printf prototype
#endif

// Mimics the printf function prototype. This is what I'll actually 
// use to print stuff to the screen
void (* zprintf)(const char*, ...); 

// If debug version, use printf
#ifdef DEBUG_VERSION
    #include <stdio.h>
#endif

// If both debug and release version, error
#ifdef DEBUG_VERSION
#ifdef RELEASE_VERSION
    #define INVALID_VERSION
#endif
#endif

// If neither debug or release version, error
#ifndef DEBUG_VERSION
#ifndef RELEASE_VERSION
    #define INVALID_VERSION
#endif
#endif

#ifdef INVALID_VERSION
    // Won't allow compilation without a valid version define
    #error "Invalid version definition"
#endif 
```

在`version.c`我将定义 2 个函数原型`version.h`

# 版本.c

```
#include "version.h"

/*****************************************************************************/
/**
* @name board_init
*
* Sets up the application based on the version type defined in version.h.
* Includes allowing or prohibiting printing to STDOUT.
*
* MUST BE CALLED FIRST THING IN MAIN
*
* @return    None
*
*****************************************************************************/
void board_init()
{
    // Assign the print function to the correct function pointer
    #ifdef DEBUG_VERSION
        zprintf = &printf;
    #else
        // Defined below this function
        zprintf = &noprintf;
    #endif
}

/*****************************************************************************/
/**
* @name noprintf
*
* simply returns with no actions performed
*
* @return   None
*
*****************************************************************************/
void noprintf(const char* c, ...)
{
    return;
} 
```

注意函数指针是如何原型化`version.h`的

`void (* zprintf)(const char *, ...);`

当它在应用程序中被引用时，它将在它指向的任何地方开始执行，这还没有被定义。

在`version.c`中，请注意在`board_init()`函数中`zprintf`分配了唯一函数（其函数签名匹配），具体取决于定义的版本`version.h`

`zprintf = &printf;`zprintf 调用 printf 进行调试

或者

`zprintf = &noprint;`zprintf 只是返回并且不会运行不必要的代码

运行代码将如下所示：

# 主程序.c

```
#include "version.h"
#include <stdlib.h>
int main()
{
    // Must run board_init(), which assigns the function
    // pointer to an actual function
    board_init();

    void *ptr = malloc(100); // Allocate 100 bytes of memory
    // malloc returns NULL if unable to allocate the memory.

    if (ptr == NULL)
    {
        zprintf("Unable to allocate memory\n");
        return 1;
    }

    // Other things to do...
    return 0;
} 
```

上面的代码将`printf`在调试模式下使用，或者在发布模式下什么也不做。这比浏览整个项目并注释或删除代码要容易得多。我需要做的就是更改版本，`version.h`剩下的代码将完成！

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2014-11-10T08:50:57.897

函数指针通常由 定义`typedef`，并用作参数和返回值。

上面的答案已经解释了很多，我只是举一个完整的例子：

```
#include <stdio.h>

#define NUM_A 1
#define NUM_B 2

// define a function pointer type
typedef int (*two_num_operation)(int, int);

// an actual standalone function
static int sum(int a, int b) {
    return a + b;
}

// use function pointer as param,
static int sum_via_pointer(int a, int b, two_num_operation funp) {
    return (*funp)(a, b);
}

// use function pointer as return value,
static two_num_operation get_sum_fun() {
    return &sum;
}

// test - use function pointer as variable,
void test_pointer_as_variable() {
    // create a pointer to function,
    two_num_operation sum_p = &sum;
    // call function via pointer
    printf("pointer as variable:\t %d + %d = %d\n", NUM_A, NUM_B, (*sum_p)(NUM_A, NUM_B));
}

// test - use function pointer as param,
void test_pointer_as_param() {
    printf("pointer as param:\t %d + %d = %d\n", NUM_A, NUM_B, sum_via_pointer(NUM_A, NUM_B, &sum));
}

// test - use function pointer as return value,
void test_pointer_as_return_value() {
    printf("pointer as return value:\t %d + %d = %d\n", NUM_A, NUM_B, (*get_sum_fun())(NUM_A, NUM_B));
}

int main() {
    test_pointer_as_variable();
    test_pointer_as_param();
    test_pointer_as_return_value();

    return 0;
} 
```

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2014-11-17T18:24:09.717

C 中函数指针的一大用途是调用在运行时选择的函数。例如，C 运行时库有两个例程[`qsort`](https://en.cppreference.com/w/c/algorithm/qsort)和[`bsearch`](https://en.cppreference.com/w/c/algorithm/bsearch)，它们接受一个指向函数的指针，该函数被调用来比较正在排序的两个项目；这允许您根据您希望使用的任何标准分别对任何内容进行排序或搜索。

一个非常基本的示例，如果调用了一个函数，而`print(int x, int y)`该函数又可能需要调用一个函数（`add()`或者`sub()`，它们属于同一类型），那么我们将做什么，我们将向函数添加一个函数指针参数，`print()`如下所示：

```
#include <stdio.h>

int add()
{
   return (100+10);
}

int sub()
{
   return (100-10);
}

void print(int x, int y, int (*func)())
{
    printf("value is: %d\n", (x+y+(*func)()));
}

int main()
{
    int x=100, y=200;
    print(x,y,add);
    print(x,y,sub);

    return 0;
} 
```

输出是：

> 值为：410
> 值为：390

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2014-09-26T08:09:51.910

从头开始函数有一些内存地址，从它们开始执行的地方开始。在汇编语言中它们被称为（调用“函数的内存地址”）。现在回到 C 如果函数有内存地址，那么它们可以被 C 中的指针操作。所以按照 C 的规则

1.首先你需要声明一个指向函数的指针 2.传递所需函数的地址

****注意->功能应该是相同的类型****

这个简单的程序将说明一切。

```
#include<stdio.h>
void (*print)() ;//Declare a  Function Pointers
void sayhello();//Declare The Function Whose Address is to be passed
                //The Functions should Be of Same Type
int main()
{
 print=sayhello;//Addressof sayhello is assigned to print
 print();//print Does A call To The Function 
 return 0;
}

void sayhello()
{
 printf("\n Hello World");
} 
```

![在此处输入图像描述](https://i.stack.imgur.com/L4qpJ.png)之后让我们看看机器是如何理解它们的。一瞥上述程序在 32 位架构中的机器指令。

红色标记区域显示地址是如何交换和存储在 eax 中的。然后他们是eax上的调用指令。eax 包含函数的所需地址。

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2018-08-20T05:47:15.477

函数指针是一个包含函数地址的变量。由于它是一个指针变量，但具有一些受限制的属性，因此您可以像使用数据结构中的任何其他指针变量一样使用它。

我能想到的唯一例外是将函数指针视为指向单个值以外的东西。通过递增或递减函数指针或添加/减去函数指针的偏移量来进行指针运算实际上并没有任何实用性，因为函数指针仅指向单个事物，即函数的入口点。

函数指针变量的大小，变量占用的字节数，可能因底层架构而异，例如 x32 或 x64 或其他。

函数指针变量的声明需要指定与函数声明相同类型的信息，以便 C 编译器进行通常所做的检查。如果在函数指针的声明/定义中没有指定参数列表，C 编译器将无法检查参数的使用。在某些情况下，这种缺乏检查可能很有用，但请记住，安全网已被移除。

一些例子：

```
int func (int a, char *pStr);    // declares a function

int (*pFunc)(int a, char *pStr);  // declares or defines a function pointer

int (*pFunc2) ();                 // declares or defines a function pointer, no parameter list specified.

int (*pFunc3) (void);             // declares or defines a function pointer, no arguments. 
```

前两个声明有些相似之处在于：

*   `func`是一个接受 an`int`和 a`char *`并返回 an的函数`int`
*   `pFunc`是一个函数指针，它被分配了一个函数的地址，该函数接受一个`int`和一个`char *`并返回一个`int`

所以从上面我们可以有一个源代码行，其中函数的地址`func()`被分配给函数指针变量`pFunc`，如`pFunc = func;`.

请注意与函数指针声明/定义一起使用的语法，其中括号用于克服自然运算符优先规则。

```
int *pfunc(int a, char *pStr);    // declares a function that returns int pointer
int (*pFunc)(int a, char *pStr);  // declares a function pointer that returns an int 
```

**几个不同的用法示例**

函数指针的一些使用示例：

```
int (*pFunc) (int a, char *pStr);    // declare a simple function pointer variable
int (*pFunc[55])(int a, char *pStr); // declare an array of 55 function pointers
int (**pFunc)(int a, char *pStr);    // declare a pointer to a function pointer variable
struct {                             // declare a struct that contains a function pointer
    int x22;
    int (*pFunc)(int a, char *pStr);
} thing = {0, func};                 // assign values to the struct variable
char * xF (int x, int (*p)(int a, char *pStr));  // declare a function that has a function pointer as an argument
char * (*pxF) (int x, int (*p)(int a, char *pStr));  // declare a function pointer that points to a function that has a function pointer as an argument 
```

您可以在函数指针的定义中使用可变长度参数列表。

```
int sum (int a, int b, ...);
int (*psum)(int a, int b, ...); 
```

或者您根本无法指定参数列表。这可能很有用，但它消除了 C 编译器对提供的参数列表执行检查的机会。

```
int  sum ();      // nothing specified in the argument list so could be anything or nothing
int (*psum)();
int  sum2(void);  // void specified in the argument list so no parameters when calling this function
int (*psum2)(void); 
```

**C 风格的演员表**

您可以将 C 样式转换与函数指针一起使用。但是请注意，C 编译器可能会在检查方面松懈或提供警告而不是错误。

```
int sum (int a, char *b);
int (*psplsum) (int a, int b);
psplsum = sum;               // generates a compiler warning
psplsum = (int (*)(int a, int b)) sum;   // no compiler warning, cast to function pointer
psplsum = (int *(int a, int b)) sum;     // compiler error of bad cast generated, parenthesis are required. 
```

**比较函数指针是否相等**

您可以使用语句检查函数指针是否等于特定函数地址，`if`但我不确定这会有多大用处。其他比较运算符的效用似乎更小。

```
static int func1(int a, int b) {
    return a + b;
}

static int func2(int a, int b, char *c) {
    return c[0] + a + b;
}

static int func3(int a, int b, char *x) {
    return a + b;
}

static char *func4(int a, int b, char *c, int (*p)())
{
    if (p == func1) {
        p(a, b);
    }
    else if (p == func2) {
        p(a, b, c);      // warning C4047: '==': 'int (__cdecl *)()' differs in levels of indirection from 'char *(__cdecl *)(int,int,char *)'
    } else if (p == func3) {
        p(a, b, c);
    }
    return c;
} 
```

**函数指针数组**

如果你想要一个函数指针数组，其中参数列表中的每个元素都有差异，那么你可以定义一个函数指针，其中未指定参数列表（不是`void`这意味着没有参数，而是未指定），尽管你如下所示可能会看到来自 C 编译器的警告。这也适用于函数的函数指针参数：

```
int(*p[])() = {       // an array of function pointers
    func1, func2, func3
};
int(**pp)();          // a pointer to a function pointer

p[0](a, b);
p[1](a, b, 0);
p[2](a, b);      // oops, left off the last argument but it compiles anyway.

func4(a, b, 0, func1);
func4(a, b, 0, func2);  // warning C4047: 'function': 'int (__cdecl *)()' differs in levels of indirection from 'char *(__cdecl *)(int,int,char *)'
func4(a, b, 0, func3);

    // iterate over the array elements using an array index
for (i = 0; i < sizeof(p) / sizeof(p[0]); i++) {
    func4(a, b, 0, p[i]);
}
    // iterate over the array elements using a pointer
for (pp = p; pp < p + sizeof(p)/sizeof(p[0]); pp++) {
    (*pp)(a, b, 0);          // pointer to a function pointer so must dereference it.
    func4(a, b, 0, *pp);     // pointer to a function pointer so must dereference it.
} 
```

**C 风格`namespace`将全局`struct`与函数指针结合使用**

您可以使用`static`关键字指定名称为文件范围的函数，然后将其分配给全局变量，以提供类似于`namespace`C++ 功能的方式。

在头文件中定义一个结构，该结构将作为我们的命名空间以及使用它的全局变量。

```
typedef struct {
   int (*func1) (int a, int b);             // pointer to function that returns an int
   char *(*func2) (int a, int b, char *c);  // pointer to function that returns a pointer
} FuncThings;

extern const FuncThings FuncThingsGlobal; 
```

然后在C源文件中：

```
#include "header.h"

// the function names used with these static functions do not need to be the
// same as the struct member names. It's just helpful if they are when trying
// to search for them.
// the static keyword ensures these names are file scope only and not visible
// outside of the file.
static int func1 (int a, int b)
{
    return a + b;
}

static char *func2 (int a, int b, char *c)
{
    c[0] = a % 100; c[1] = b % 50;
    return c;
}

const FuncThings FuncThingsGlobal = {func1, func2}; 
```

然后通过指定全局结构变量的完整名称和成员名称来访问函数。修饰符用于全局，因此`const`不会被意外更改。

```
int abcd = FuncThingsGlobal.func1 (a, b); 
```

**函数指针的应用领域**

DLL 库组件可以执行类似于 C 样式方法的操作，其中从支持创建包含函数指针`namespace`的库接口中的工厂方法请求特定库接口。此库接口加载请求的 DLL 版本，创建`struct`一个带有必要函数指针的结构，然后将该结构返回给请求调用者以供使用。

```
typedef struct {
    HMODULE  hModule;
    int (*Func1)();
    int (*Func2)();
    int(*Func3)(int a, int b);
} LibraryFuncStruct;

int  LoadLibraryFunc LPCTSTR  dllFileName, LibraryFuncStruct *pStruct)
{
    int  retStatus = 0;   // default is an error detected

    pStruct->hModule = LoadLibrary (dllFileName);
    if (pStruct->hModule) {
        pStruct->Func1 = (int (*)()) GetProcAddress (pStruct->hModule, "Func1");
        pStruct->Func2 = (int (*)()) GetProcAddress (pStruct->hModule, "Func2");
        pStruct->Func3 = (int (*)(int a, int b)) GetProcAddress(pStruct->hModule, "Func3");
        retStatus = 1;
    }

    return retStatus;
}

void FreeLibraryFunc (LibraryFuncStruct *pStruct)
{
    if (pStruct->hModule) FreeLibrary (pStruct->hModule);
    pStruct->hModule = 0;
} 
```

这可以用于：

```
LibraryFuncStruct myLib = {0};
LoadLibraryFunc (L"library.dll", &myLib);
//  ....
myLib.Func1();
//  ....
FreeLibraryFunc (&myLib); 
```

相同的方法可用于为使用底层硬件的特定模型的代码定义抽象硬件层。函数指针由工厂填充硬件特定功能，以提供实现抽象硬件模型中指定的功能的硬件特定功能。这可用于提供软件使用的抽象硬件层，该软件调用工厂函数以获得特定的硬件函数接口，然后使用提供的函数指针来执行底层硬件的操作，而无需了解有关特定目标的实现细节.

**用于创建委托、处理程序和回调的函数指针**

您可以使用函数指针作为委托某些任务或功能的一种方式。C 中的经典示例是与标准 C 库函数一起使用的比较委托函数指针，`qsort()`并`bsearch()`提供排序顺序以对项目列表进行排序或对已排序的项目列表执行二进制搜索。比较函数委托指定排序或二分搜索中使用的排序算法。

另一个用途类似于将算法应用于 C++ 标准模板库容器。

```
void * ApplyAlgorithm (void *pArray, size_t sizeItem, size_t nItems, int (*p)(void *)) {
    unsigned char *pList = pArray;
    unsigned char *pListEnd = pList + nItems * sizeItem;
    for ( ; pList < pListEnd; pList += sizeItem) {
        p (pList);
    }

    return pArray;
}

int pIncrement(int *pI) {
    (*pI)++;

    return 1;
}

void * ApplyFold(void *pArray, size_t sizeItem, size_t nItems, void * pResult, int(*p)(void *, void *)) {
    unsigned char *pList = pArray;
    unsigned char *pListEnd = pList + nItems * sizeItem;
    for (; pList < pListEnd; pList += sizeItem) {
        p(pList, pResult);
    }

    return pArray;
}

int pSummation(int *pI, int *pSum) {
    (*pSum) += *pI;

    return 1;
}

// source code and then lets use our function.
int intList[30] = { 0 }, iSum = 0;

ApplyAlgorithm(intList, sizeof(int), sizeof(intList) / sizeof(intList[0]), pIncrement);
ApplyFold(intList, sizeof(int), sizeof(intList) / sizeof(intList[0]), &iSum, pSummation); 
```

另一个例子是 GUI 源代码，其中通过提供事件发生时实际调用的函数指针来注册特定事件的处理程序。Microsoft MFC 框架及其消息映射使用类似的东西来处理传递到窗口或线程的 Windows 消息。

需要回调的异步函数类似于事件处理程序。异步函数的用户调用异步函数来启动一些动作，并提供一个函数指针，一旦动作完成，异步函数将调用该函数指针。在这种情况下，事件是完成其任务的异步函数。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-09T13:56:12.877

由于函数指针通常是类型化的回调，你可能想看看[类型安全的回调](http://ccan.ozlabs.org/info/typesafe_cb.html)。这同样适用于非回调函数的入口点等。

C 是非常善变和宽容的 :)

# javascript - 您可以将 JavaScript 用作 Asp.Net MVC 的嵌入式资源吗？

> ID：840506
> 
> 赞同：1
> 
> 时间：2009-05-08T15:50:41.103
> 
> 标签：javascript, model-view-controller, resources

在带有 Ajax 的 Asp.Net 中，我可以将我的 Javascript 文件作为嵌入资源包含在我的程序集中，并使用 ScriptManager 创建对嵌入脚本的引用。

有没有办法用 Asp.Net MVC 做同样的事情？

# svn - svn update 没有更新！

> ID：840509
> 
> 赞同：31
> 
> 时间：2009-05-08T15:51:16.857
> 
> 标签：svn

我希望 svn update 用来自服务器的文件覆盖我的本地文件，即使我的本地文件有修改，我想把它们扔掉并使用远程存储库上的版本。

我怎么做？我试过`svn update --force`了，但它不起作用。

### 更新：

感谢您的回答，所以我正在使用这样的还原：

```
svn revert . -R 
```

这是我应该如何使用它吗？安全吗？我有一个相同速度的 git 存储库，我不希望 svn`.git`为我破坏我的存储库！

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-05-08T15:54:03.137

您应该使用 SVN 还原。这会将工作副本中的文件恢复到其原始状态。有关更多信息和示例，请查看此处的 svn 书：http: [//svnbook.red-bean.com/en/1.1/re25.html](http://svnbook.red-bean.com/en/1.1/re25.html)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2013-03-25T16:58:32.347

我只是想在 diyism 发布的内容中添加一些内容。

我没看到`.`旁边的`;`in the line

```
svn revert -R .; svn up 
```

这让我很困惑。我不知道为什么在使用**revert**并且不使用**update**`.`时需要显式使用所有文件，但这似乎就是这样。

 ****所以，如果它对任何人有帮助，我认为将答案看成两行会更清楚

```
svn revert -R .
svn update 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-09-24T02:54:20.810

我在 OSX（10.6，目前使用 svn 1.6.16）上偶尔会遇到这个问题。一种解决方法是这样做：

```
 svn update `svn ls -R` 
```

虽然它可能很慢。

参考：[http ://code.google.com/p/support/issues/detail?id=3192](http://code.google.com/p/support/issues/detail?id=3192)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-08T15:55:32.493

顺便说一句，这实际上是 SVN 的一个特性。更新时它永远不会覆盖您的任何修改（除非您使用`revert`.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-08T15:53:35.603

请改用“还原”。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-08T15:54:31.343

您必须还原您的修改，并在必要时在此之后进行更新。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-03-30T10:13:18.683

使用这一行：

```
svn revert -R .;svn up 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-08T15:54:37.303

使用 svn 还原

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-11T02:38:18.037

最坏的情况是，删除工作副本的内容（不包括 .svn 文件夹）并进行更新。

# math - 概率和相对频率

> ID：840520
> 
> 赞同：1
> 
> 时间：2009-05-08T15:54:37.020
> 
> 标签：math, statistics, probability

如果我使用相对频率来估计事件的概率，那么基于实验次数的估计有多好？标准差是一个很好的衡量标准吗？纸质/链接/在线书籍将是完美的。

[http://en.wikipedia.org/wiki/Frequentist](http://en.wikipedia.org/wiki/Frequentist)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T16:22:43.240

我相信您正在寻找样本比例的置信区间。以下是一些可能有用的资源：

[比例教程](http://davidmlane.com/hyperstat/B9168.html)
[的置信区间 比例讲义的置信区间](http://www.pitt.edu/%7Enancyp/stat-0800-f00/handouts/formulas.pdf)

基本上，您的估计与样本数量的平方根成反比。因此，如果您想将错误减少一半，您将需要四倍的样本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T16:11:42.440

卡方检验可能是您想要的。例如，参见[Pearson's chi-square test](http://en.wikipedia.org/wiki/Pearson%27s_chi-square_test)的维基百科页面。标准偏差不是您想要的，因为这与分布的形状有关，而不是您对实际分布的估计有多准确。另外，请注意，大多数这些都是关于“正态”分布的，并不是所有的分布都是正态的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T17:18:46.087

你在是/否实验的序列 n 中计算成功次数 s，对吗？只要单个实验是独立的，您就处于二项分布（[维基百科](http://en.wikipedia.org/wiki/Binomial_distribution)）的领域。成功频率 f = s / n 是成功概率 p 和的估计量。对于 n 次抽签，您的频率估计 f 的方差为 p * (1-p) / n。

只要 p 不太接近 0 或 1，并且只要您没有“太小”的观察次数 n，标准差将是您估计 f 质量的合理衡量标准。

如果 n 足够大（经验法则 n * p > 10），您可以通过正态分布 N(f, f * (1-f) / n) 进行近似，标准差估计是一个很好的衡量标准。有关更广泛的讨论，请参见[此处。](http://www.stat.yale.edu/Courses/1997-98/101/binom.htm)

这就是说，如果这需要具有一定的学术严谨性（例如是家庭作业），使用标准偏差的近似值不会减少任何问题。

# c++ - 给定一个指向 C++ 对象的指针，调用静态成员函数的首选方法是什么？

> ID：840522
> 
> 赞同：4
> 
> 时间：2009-05-08T15:55:24.507
> 
> 标签：c++, static, coding-style

说我有：

```
class A {
public:
    static void DoStuff();

    // ... more methods here ...
}; 
```

后来我有一个想要调用 DoStuff 的函数：

```
B::SomeFunction(A* a_ptr) { 
```

是不是更好说：

```
 a_ptr->DoStuff();
} 
```

或者即使我有一个实例指针以下更好：

```
 A::DoStuff()
} 
```

这纯粹是风格问题，但我想在做出决定之前获得一些明智的意见。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-08T15:57:36.390

我想我更喜欢“A::DoStuff()”，因为更清楚的是正在调用静态方法。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-05-08T16:00:53.403

最好通过其名称调用静态方法，而不是通过对象，因为它实际上根本不使用该对象。在 Java 中，也存在同样的问题。Java 中一个不太常见的问题如下：

```
Thread t = getSomeOtherThread();
t.sleep(1000); 
```

这编译得很好，但几乎总是一个错误 -`Thread.sleep()`是一种导致*当前*线程休眠的静态方法，而不是代码似乎暗示的正在执行的线程。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-08T15:57:44.750

我个人更喜欢 A::DoStuff() 约定，因为任何阅读代码的人都可以立即清楚这是对静态成员函数的调用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-08T16:05:05.983

尽管我同意 A::DoStuff() 更清晰，而且这是我自己编写的，但我可以看到一个通过指针进行的参数，即“假设类名更改”。如果 A 类变为 B 类，那么我们只需要在一处（指针声明）而不是两处更新类名。

只是一个想法...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T16:45:47.443

[Jon Skeet 让我](https://stackoverflow.com/questions/163026/what-is-your-least-favorite-syntax-gotcha/163181#163181)明白了为什么不应该通过实例指针调用静态方法。他的例子是在 Java 中，但这个概念也适用于 C++：

```
Thread t = new Thread(...);
t.start();
t.sleep(1000); // Which thread does it look like this will affect? 
```

正如我第一次阅读他的回答时所评论的那样：“在我阅读 [Jon 的帖子] 之前，我认为能够通过实例引用一个特性来调用静态方法。现在我知道得更多了。”

简而言之，使用类名而不是实例调用静态方法。在我看来，这不仅仅是一个风格问题——它可能会导致误导、错误的代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T16:25:45.697

通常我会做 A::DoStuff(); 方式而不是 a->DoStuff(); 因为也许有一天我所在的函数由于重构而不再具有该实例指针。但这是一个整体风格的东西，你不应该失去任何睡眠。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-08T18:32:21.043

我在Java中看到过很多问题，如果人们使用通过对象调用实例方法的语法调用静态方法，而对象实际上是变量类型的子类，人们想知道为什么它不调用静态方法子类中的同名。他们通过对象调用它的事实使他们认为它是一个可以被覆盖的实例方法，并且它以某种方式使用对象的类型进行运行时动态查找。

但当然，该对象根本不会在调用中使用——只有变量的类型在编译时用于决定它是什么类的静态方法。所以如果你把一个物体放在那里，那是完全误导的，因为它让人们认为它被使用了，而实际上并没有。这就是为什么我倾向于只通过类名调用静态方法——它完全等同于通过类类型的变量调用它；但它会告诉你到底发生了什么，没有无用的误导性额外信息。

# erlang - 在 Erlang 中模拟一组飞机

> ID：840525
> 
> 赞同：1
> 
> 时间：2009-05-08T15:55:36.067
> 
> 标签：erlang

我在大学的一项实际工作中遇到了问题。

这项工作是关于 Erlang 的，我必须构建一个飞机交通和防撞系统。

我的问题是：考虑到速度，如何模拟飞机轨迹？我想到了使用一个过程...

有人有什么想法吗？

最好的后卫。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-20T10:41:32.113

您并没有真正提供有关您项目的全部范围的详细信息，但在我看来，您可能想研究与航空相关的开源项目，例如飞行模拟器，以了解他们的表现如何这种事情，甚至可能是为了看看如何利用这些来简化你的工作。

[例如， FlightGear](http://www.flightgear.org)提供对 AI 交通节点的支持，以及以类似多人游戏的方式连接的多个客户端。参考早期的概念，即使用父进程作为“世界”进程并有任意数量的客户端进程模拟飞机，多人服务器将是世界进程。

因此，在您的具体情况下，FlightGear 中的 AI 交通组件看起来特别相关，因为它向您展示了如何计算 4D 轨迹并将其提供给其他客户端。基本上，在 FlightGear 中，这是使用一个名为[fgms](http://fgms.sourceforge.net)（FlightGear Multiplayer Server）的中央服务器，它基本上将纬度/经度、高度（包括速度和方向）发送给其他客户端。

假设您的工作范围与使用地面雷达数据计算 TCAS 之类的轨迹有关，您可以简单地将代码连接到他们的开源多人服务器，然后轮询/查询服务器以获取位置更新，从而模拟雷达询问。

事实上，只看他们的服务器代码，似乎还有另一种方法：fgms 代码支持中继服务器的概念，其中所有客户端数据自动镜像到另一台服务器上，因此您的雷达系统也可以实现作为该服务器的侦听器并伪装成镜像/中继服务器，以便它可以处理所有流量而无需显式轮询服务器。这似乎是比我之前建议的更好的方法，因为这样您将自动获得位置更新，而无需自己进行任何处理（查看网络协议，数据包似乎只是 XDR 编码的 POD） .

因此，假设您需要专注于雷达系统，您可以简单地 1）下载他们的多人服务器，2）构建它，3）将您的 erlang 系统设置为中继服务器，4）运行服务器和 5）处理所有更新并构建相应空域的 3D 雷达图像。

如果您想在开始时保持简单，您可以类似地运行几个飞行模拟器实例，同时将其连接到本地多人游戏服务器，这样您在飞行模拟器中所做的任何事情都会传播到您的雷达系统.

利用现有项目的组件似乎是一种很有前途的方法：根据您的项目范围，您甚至可以简单地将您的 erlang 代码连接到 FlightGear（或者更确切地说是它的多人服务器），这样您就可以直接专注于最相关的努力工作（假设这是 TCAS 计算）

此外，如果您需要将任意流量注入您的空域，他们的多人游戏服务器非常简单，可以创建几乎任意流量。

前面提到的 FlightGear 中的 AI 交通系统支持创建[虚拟飞行计划来路由 AI 交通](http://sourceforge.net/tracker/?func=detail&aid=1447777&group_id=19399&atid=369399)，还可以通过编辑[XML 文件](http://cvs.flightgear.org/viewvc/data/AI/Aircraft/performancedb.xml?revision=1.1&view=markup)来自定义飞机的性能特征。

请注意，他们当前的多人服务器实现非常简单，基本上可以归结为一个数据包多路复用器，它只是将数据从每个客户端转发到所有其他客户端（有关更多详细信息，请参阅[此](http://wiki.flightgear.org/index.php/Howto:_Set_up_a_multiplayer_server)内容）。

服务器的[源代码](http://fgms.cvs.sourceforge.net/viewvc/fgms/stable/src/)几乎是自包含的，没有任何重要的依赖项，目前它只能在 nix 平台上编译，不过（如果你运行的是 Windows，你可能需要查看 cygwin 或 colinux 来获得运行他们的服务器）。

但是请注意，服务器组件目前通常被认为是未维护的，换句话说，它在 3 年内没有真正更新过。另一方面，代码本身已经正常使用多年了。因此，目前未维护的状态并没有真正说明代码本身或其可用性，它实际上只会影响。

因此，虽然 fgms 有许多[计划中的更改](http://wiki.flightgear.org/index.php/Distributed_Interactive_Simulation)（例如添加 DIS 支持），但没有人在服务器上积极工作，它只是按原样使用，在这些计划的功能中，似乎与您的工作相关：

> 从一个客户端发布多架飞机/车辆的协议[SF.net](http://sourceforge.net/tracker/index.php?func=detail&aid=1849308&group_id=161928&atid=821811)

有趣的是，[之前已经讨论](http://sourceforge.net/tracker/?func=detail&aid=1849311&group_id=161928&atid=821811)过可能将他们的 fgms 组件移植到 erlang 而不是 C++ 中实现，因此如果您发现需要使用 erlang 增强或重新实现服务器代码，您的贡献实际上可能非常大感谢，特别是因为他们自己的服务器目前基本上没有维护。

如果您决定在您的某些项目中使用 FlightGear，您可能需要订阅[FlightGear 开发人员的](https://lists.sourceforge.net/lists/listinfo/flightgear-devel) [邮件列表](http://www.flightgear.org/mail.html)。

为了得出飞机性能数据，您可能需要查看此[飞机性能数据库](http://elearning.ians.lu/aircraftperformance/)。

此外，您可能希望查看此[FlightGear 相关讨论](http://sourceforge.net/tracker/?func=detail&aid=1447777&group_id=19399&atid=369399)，该讨论提供了有关飞机性能计算的各种其他链接，特别是 4D 轨迹预测。

特别是 [EuroControl BADA 项目](http://www.eurocontrol.int/eec/public/standard_page/proj_BADA.html)似乎很有趣。

即使您最终会发现您的项目范围与传统的飞行模拟器相差太大，使用诸如 FlightGear 之类的开源飞行模拟器仍然可以帮助您以非常好的方式可视化您的项目，即通过实际检查实时交通冲突时尚，在虚拟 3D 世界中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T17:22:51.537

也许是一组进程，每个进程都代表一个平面。有一个他们响应的“Radar Ping”事件返回当前航向、航向、速度和位置。从那里编写您的逻辑。

我可能过于简化了他们需要做的事情，但你明白了。一个过程肯定是做到这一点的一种方法。

另一种选择只是维护所有飞机的 AST。如果不了解您的项目必须做什么的更多细节，就很难提供更多信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-14T04:14:37.213

您可能会对这篇关于在 Erlang 中构建模拟的[论文（参见第 21 页）感兴趣。](http://freebsd.ntu.edu.tw/FreeBSD/ports/local-distfiles/olgeni/master_thesis_patterns.pdf)它提出了一种解决方案，其中包含一个*世界*进程加上每个活动实体的一个进程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T11:49:32.953

There exists a [Traffic and Queuing Simulator](http://members.iinet.net.au/~clark/traffic_a_simulator.htm) written in Erlang.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-09T17:12:16.350

> 我的问题是：考虑到速度，如何模拟飞机轨迹？我想到了使用一个过程...

[对我来说，这听起来像是3d 坐标](http://en.wikipedia.org/wiki/3d_coordinates)中的基本物理学。如果您知道飞机的方向，那么您可以通过计算与速度的距离来计算飞机的新位置（假设在 1 秒后）。得到距离后，您需要计算平面的新坐标，知道方向和距离。

通常这类模拟运行一个虚拟“时钟”并通过逐个滴答增加（虚拟）时间滴答（例如，每滴答一秒或一分钟）来重新计算所有飞机的位置。通过连接位置计算的“点”，您可以获得轨迹。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-09T05:16:47.157

有什么东西必须是实时的吗？如果不是，真的，这只是您可以在 gen_server 或 gen_event 进程中进行的一些简单的速度计算。只需生成一个主管为每架飞机生成 gen_server 子级，然后当时间过去时，为每架飞机执行一个 handle_call 并让他们更新他们的信息。

# python - 弹出日志管理问题

> ID：840531
> 
> 赞同：0
> 
> 时间：2009-05-08T15:57:32.070
> 
> 标签：python, logging, popen

**问题：**

我在 Python 中有一个监视器程序，它使用子进程的 Popen 来启动新进程。这些过程有可能运行很长时间（数周至数月）。我正在将文件句柄传递给 Popen 中的 stdout 变量，我担心这个文件会很容易变大。有没有办法可以安全地移动或删除该日志文件中的数据？

***重要提示：***这是在 Windows 系统上，因此任何解决方案都必须与 Windows 兼容。

**代码片段：**

这就是我创建流程的方式。

```
try:
    logFile = file(self.logFileName, 'w')
    self.process = Popen(self.command, shell=False, stdout=logFile, stderr=STDOUT)
finally:
    logFile.close() 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T16:46:19.580

修复监控程序，让它负责轮换自己的日志，或者自己调解来自日志程序的数据并将其打包到单独的文件中。

这是你有的两个选择。一旦它运行，你就不能弄乱另一个进程的文件描述符，所以不，你不能在那个文件中“移动或删除数据”。

= 迈克

# bash - 如何在 Bash 中的带引号的字符串中使用环境变量

> ID：840536
> 
> 赞同：127
> 
> 时间：2009-05-08T15:57:57.153
> 
> 标签：bash, quotes, environment

我在 bash 脚本中尝试了以下各种形式：

```
#!/bin/bash
svn diff $@ --diff-cmd /usr/bin/diff -x "-y -w -p -W $COLUMNS" 
```

但我无法获得正确扩展`COLUMNS`环境变量的语法。

我尝试了以下各种形式：

```
svn diff $@ --diff-cmd /usr/bin/diff -x '-y -w -p -W $COLUMNS' 
```

和

```
svn diff $@ --diff-cmd /usr/bin/diff -x '-y -w -p -W ${COLUMNS}' 
```

和

```
eval svn diff $@ --diff-cmd /usr/bin/diff -x "-y -w -p -W $COLUMNS" 
```

建议？

* * *

## 回答 #1

> 赞同：465
> 
> 时间：2012-02-23T20:36:32.623

对于任何通过谷歌来到这里寻找标题中提出的一般问题的答案的人（就像我一样），只是一个简短的说明/摘要。以下任何一项都应该适用于访问引号内的 shell 变量：

```
echo "$VARIABLE"
echo "${VARIABLE}" 
```

使用单引号是主要问题。根据[Bash 参考手册](http://www.gnu.org/software/bash/manual/bashref.html#Single-Quotes)：

> 将字符括在单引号 ( `'`) 中会保留引号内每个字符的文字值。单引号之间不能出现单引号，即使前面有反斜杠。[...] 将字符括在双引号 ( `"`) 中会保留引号内所有字符的文字值，但`$`, ```, `\`, 和启用历史扩展时除外`!`。字符`$`和 ` 在双引号中保留其特殊含义（请参阅 Shell 扩展）。反斜杠仅在后跟以下字符之一时才保留其特殊含义：`$`, ```, `"`,`\`，或换行符。在双引号内，删除后面跟有这些字符之一的反斜杠。没有特殊含义的字符前面的反斜杠保持不变。双引号可以用反斜杠在双引号中引用。如果启用，将执行历史扩展，除非`!`出现在双引号中的使用反斜杠进行转义。前面的反斜杠`!`不会被删除。特殊参数在双引号中`*`时`@`具有特殊含义（请参阅 Shell 参数扩展）。

在问题中提出的特定情况下， $COLUMNS 是一个具有非标准属性的特殊变量（参见上面 lhunath 的回答）。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-05-09T19:45:21.417

如果不确定，您可以在终端上使用 'cols' 请求，而忘记 COLUMNS：

```
COLS=$(tput cols) 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-05-11T07:30:50.073

请注意`COLUMNS`：

1.  **不是**环境变量。它是一个普通的 bash 参数，由 bash 自己设置。
2.  收到`SIGWINCH`信号后自动设置。

第二点通常意味着您的`COLUMNS`变量只会在*交互式*shell 中设置，**而不是**在 bash 脚本中。

如果您的脚本`stdin`连接到您的终端，您可以通过询问终端来手动查找终端的宽度：

```
tput cols 
```

并在您的 SVN 命令中使用它：

```
svn diff "$@" --diff-cmd /usr/bin/diff -x "-y -w -p -W $(tput cols)" 
```

（注意：你应该*引用* `"$@"`并远离`eval`;-)）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T16:29:08.403

以下脚本适用于我的多个`$COLUMNS`. 我想知道你是不是`COLUMNS`在这个电话之前没有设置？

```
#!/bin/bash
COLUMNS=30
svn diff $@ --diff-cmd /usr/bin/diff -x "-y -w -p -W $COLUMNS" 
```

您可以`$COLUMNS`在脚本中回显以查看其设置是否正确吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-09T08:04:56.627

你做得对，所以我猜还有其他问题（不是导出 COLUMNS ？）。

调试这些情况的一个技巧是制作一个专门的命令（编程语言人员的闭包）。创建一个名为 diff-columns 的 shell 脚本，执行以下操作：

```
exec /usr/bin/diff -x -y -w -p -W "$COLUMNS" "$@" 
```

并使用

```
svn diff "$@" --diff-cmd  diff-columns 
```

这样，您的代码更易于阅读且更模块化（自上而下的方法），并且您可以单独彻底地测试 diff-columns 代码（自下而上的方法）。

# c# - 生成加密安全的身份验证令牌

> ID：840537
> 
> 赞同：60
> 
> 时间：2009-05-08T15:57:58.107
> 
> 标签：c#, iphone, wcf, web-services, security

**背景：**

这确实是一个一般的最佳实践问题，但有关特定情况的一些背景可能会有所帮助：

我们正在为 iPhone 开发一个“连接的”应用程序。它将通过 REST 服务与后端应用程序通信。为了不必每次启动应用程序时都提示用户输入用户名和密码，我们将公开一个“登录”服务，该服务在初始启动时验证用户名和密码并返回可用于未来 Web 的身份验证令牌对真实数据的服务请求。令牌可能有一个过期时间，之后我们会要求他们使用他们的用户名/密码重新进行身份验证。

**问题：**

生成此类用于身份验证的令牌的最佳实践是什么？

例如，我们可以...

*   散列（SHA-256 等）随机字符串并将其存储在给定用户的数据库中以及到期日期。在后续请求中对令牌进行简单查找以确保它匹配。
*   使用密钥加密用户 ID 和一些附加信息（时间戳等）。在后续请求中解密令牌以确保它是由我们发布的。

这感觉它必须是一个已解决的问题。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-05-13T15:44:24.973

根据对这个问题的其他答案的反馈、额外的研究和线下讨论，这就是我们最终要做的……

很快就有人指出，此处的交互模型与选中“记住我”复选框时 ASP.NET 中的表单身份验证使用的模型基本完全相同。它不是发出 HTTP 请求的 Web 浏览器。我们的“票证”等同于 Forms Authentication 设置的 cookie。默认情况下，表单身份验证本质上使用“使用密钥加密某些数据”的方法。

在我们的登录 Web 服务中，我们使用以下代码创建票证：

```
string[] userData = new string[4];

// fill the userData array with the information we need for subsequent requests
userData[0] = ...; // data we need
userData[1] = ...; // other data, etc

// create a Forms Auth ticket with the username and the user data. 
FormsAuthenticationTicket formsTicket = new FormsAuthenticationTicket(
    1,
    username,
    DateTime.Now,
    DateTime.Now.AddMinutes(DefaultTimeout),
    true,
    string.Join(UserDataDelimiter, userData)
    );

// encrypt the ticket
string encryptedTicket = FormsAuthentication.Encrypt(formsTicket); 
```

然后，我们为 WCF 服务添加了一个操作行为属性，该属性添加了一个 IParameterInspector，用于检查请求的 HTTP 标头中的有效票证。开发者将这个操作行为属性放在需要认证的操作上。以下是该代码解析票证的方式：

```
// get the Forms Auth ticket object back from the encrypted Ticket
FormsAuthenticationTicket formsTicket = FormsAuthentication.Decrypt(encryptedTicket);

// split the user data back apart
string[] userData = formsTicket.UserData.Split(new string[] { UserDataDelimiter }, StringSplitOptions.None);

// verify that the username in the ticket matches the username that was sent with the request
if (formsTicket.Name == expectedUsername)
{
    // ticket is valid
    ...
} 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-08T17:46:40.293

构建自己的身份验证系统始终是“最糟糕的做法”。这种事情最好留给专门研究身份验证系统的专业人士。

如果您一心想要构建自己的“来自登录服务的过期票据”架构而不是重新使用现有架构，那么至少熟悉驱动类似系统（如 Kerberos）设计的问题可能是个好主意. 这里有一个温和的介绍：

[http://web.mit.edu/kerberos/dialogue.html](http://web.mit.edu/kerberos/dialogue.html)

看看过去 20 年来在 Kerberos（和类似系统）中发现了哪些安全漏洞并确保不会复制它们也是一个好主意。Kerberos 由安全专家构建，并经过数十年的仔细审查，仍然发现其中存在严重的算法缺陷，例如：

[http://web.mit.edu/kerberos/www/advisories/MITKRB5-SA-2003-004-krb4.txt](http://web.mit.edu/kerberos/www/advisories/MITKRB5-SA-2003-004-krb4.txt)

从他们的错误中吸取教训比从自己的错误中学习要好得多。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-05-08T20:04:15.673

Amazon.com 使用[HMAC SHA-1 消息令牌](http://docs.amazonwebservices.com/AmazonS3/latest/index.html?RESTAuthentication.html)对请求进行身份验证和授权。他们将其用于相当大的商业服务，因此我有责任相信他们的工程决策。谷歌发布的[OpenSocial API](http://code.google.com/apis/opensocial/)有点类似。基于 Google 和 Amazon.com 使用类似且公开发布的方法来保护 Web 请求，我怀疑这些可能是不错的方法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-13T02:24:50.990

您提供的两个答案中的任何一个都足够了。您可能会找到可以为您执行此操作的框架，但事实是构建起来并不难。（我工作过的每家公司都推出了自己的产品。）数据库存储令牌与加密数据“cookies”的选择是一个架构决策——你想在每个页面视图上进行数据库查找，还是你更愿意用cookie解密来咀嚼CPU？在大多数应用程序中，使用加密的 cookie 可以大规模提高性能（如果这是一个问题）。否则只是口味问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-10T02:19:00.707

由于您使用的是 WCF，因此如果使用 CFNetwork，您有多种选择——例如 NTLM 或 Digest Authentication：

[http://developer.apple.com/documentation/Networking/Conceptual/CFNetwork/Concepts/Concepts.html#//apple_ref/doc/uid/TP30001132-CH4-SW7](http://developer.apple.com/documentation/Networking/Conceptual/CFNetwork/Concepts/Concepts.html#//apple_ref/doc/uid/TP30001132-CH4-SW7)

我知道这不能回答您的具体问题，但我也遇到过这个问题（iPhone - Tomcat），并决定尽可能使用 Web 服务器上的身份验证服务。在大多数情况下，将身份验证信息包含在每个请求中不会造成重大损失。快速的 Google 会找到很多关于 WCF 和 RESTful 服务的博客文章（以及 StackOverflow 上的一些相关问题）。

希望这可以帮助！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-07-27T20:03:53.923

你应该实现：

1.  OAuth2 隐式授权 - 用于第三方应用程序[https://www.rfc-editor.org/rfc/rfc6749#section-1.3.2](https://www.rfc-editor.org/rfc/rfc6749#section-1.3.2)
2.  OAuth2 资源所有者密码凭证 — 用于您自己的移动应用程序[https://www.rfc-editor.org/rfc/rfc6749#section-1.3.3](https://www.rfc-editor.org/rfc/rfc6749#section-1.3.3)

这正是您正在寻找的来自 OAuth2 的工作流程。不要重新发明轮子。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-08T16:09:44.270

这听起来就像一个过期时间很长的会话标识符。在 Web 应用程序中用于此的相同原则也适用于此。

会话标识符不是对信息进行编码，而是从一个非常大的空间（128 位）中随机选择的。服务器保留将会话标识符与用户和其他所需信息（例如到期时间）相关联的记录。客户端通过安全通道为每个请求提供会话标识符。

安全性依赖于会话标识符的不可预测性。使用加密 RNG 从非常大的空间生成它们。

# nhibernate - 在命名查询中使用视图

> ID：840538
> 
> 赞同：0
> 
> 时间：2009-05-08T15:58:03.627
> 
> 标签：nhibernate, nhibernate-mapping

我有一个使用视图的命名查询。我无法创建类映射，因为此视图没有 Id 列。我创建了一个命名查询并将其设置为将其作为一个类返回，定义所有返回值。但是，我仍然收到 KeyNotFound 异常。如果我将所有列设置为它返回列表。你怎么能告诉 NHibernate 把它映射到一个类。

```
<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2">
  <sql-query name="GetAvailablePermissions" read-only="true">
    <return alias="perm" class="Domain.AcsAvailablePermission, Domain">
      <return-property name="Id" column="PermissionId"/>
      <return-property name="Code" column="Code"/>
      <return-property name="Category" column="Category"/>
      <return-property name="Description" column="Description"/>      
    </return>
    <![CDATA[
    SELECT
      [PermissionId]
      , [Code]
      , [Category]
      , [Description]
    FROM [dbo].[vw_Permission]
    WHERE
      [SiteId] = :SiteId
    ]]>
  </sql-query>
</hibernate-mapping> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T21:38:05.020

我没有找到 NHibernate 方式，所以我将所有内容都更改为返回标量。然后获取 IList 并使用 LINQ 将其转换为 IList。

# css - 在主要居中的 div 旁边浮动另一个 div

> ID：840542
> 
> 赞同：2
> 
> 时间：2009-05-08T15:58:55.840
> 
> 标签：css, html, css-float, center

好的，所以我有一个网站，整个东西都包装在一个容器中。此容器以 margin:auto 为中心。我想将一段内容浮动到这个居中容器的右侧，无论用户是否调整浏览器窗口的大小等，它都会粘在它的一边。我想知道是否有一种真正简单的方法来这样做而不是添加另一个巨大的 div，给它宽度并将居中的部分浮动到左侧，将内容块浮动到右侧。谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T16:07:58.050

捎带@NickAllen，您想使用绝对定位，以便侧边栏的宽度不包括在主容器的居中。

```
#container {
  position: relative;
  width: 500px;
  border: 1px solid #f00;
  margin: 0px auto;
}
#sidebar {
  position: absolute;
  width: 200px;
  right: -200px;
  border: 1px solid #0f0;
}
```

```
<div id="container">
  <div id="sidebar">
    [ sidebar content ]<br>
    [ sidebar content ]<br>
  </div>
  [content]<br>
  [content]<br>
  [content]<br>
</div>
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T21:54:48.793

也许我误解了你的问题，但这不是你想要的：

```
 #container {
        width: 960px;
        margin: 0px auto;
    }

    #sidebar {
        float: right;
    }
```

```
<div id="container">
        <div id="sidebar">
        some content
        </div>
    </div>
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T16:02:13.353

给容器 div 属性 position: relative; 将您的浮动 div 作为容器 div 的第一个孩子并给它

```
#floatingDiv
{
    position: absolute;
    top: 0;
    right: -{widthOfFloatedDiv};
} 
```

我认为这会起作用，但未经测试

好的，所以测试它并且它有效

```
<div style="position: relative; width: 980px; margin: 0 auto; border: 1px solid #000; height: 400px;">
    <div style="position: absolute; top: 0; right: -200px; width: 200px;">
        <p>Floated DIV</p>
    </div>
    <p>container div</p>
</div> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-03-12T15:47:10.507

老问题，但由于其他答案有点缺乏那个“东西”，它仍然在谷歌之上。实现这一点的最简单、最干净的方法是使用*两个 wrappers*。

```
<div class="bigWrapper">
  <div class="sidebar">Hello, I'm your sidebar</div>      

  <div class="smallWrapper">
    Put the thing you want to center here.
  </div>
</div> 
```

使用以下CSS：

```
.bigWrapper { 
    width: 1000px;
    height: auto;
    margin: auto;
}

.smallWrapper {
    width: 500px;
    height: auto;
    margin: auto;
}

.sidebar {
    width: 250px;
    float: left;
    height: auto;
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-08T16:00:56.523

浮动是解决这个问题的方法。它们将始终粘在一起，除非容器小于它们的宽度之和。

提示：确保您的容器足够宽以容纳两个内部 div；如果没有，并且用户的窗口较窄，他们将在另一个下方显示一个。

# css - 为什么样式为“height: 100%”的元素看起来 > 100%？

> ID：840546
> 
> 赞同：0
> 
> 时间：2009-05-08T16:00:05.230
> 
> 标签：css, browser

我有一个页面，在页面加载时，我在所有内容上放置了一个**绝对 DIV**`height:100%` ，并带有“ ”，表示“页面正在加载......”。

但是，从滚动条可以看出，页面的高度是 100% + 内容的高度。

一旦页面加载并且覆盖绝对定位的 DIV 设置为 ，这将立即消失`display:none`。

这发生在 Firefox 3、Chrome、IE6 中。

**关于如何制作高度的任何想法：100%，只有 100%，而不是更多？**

```
<html>
  <head>
     <style type="text/css">
         * html, * body {height: 100%; margin: 0; padding: 0}
            #message {background: black; height: 100%; left: 0; opacity: 0.15; position: absolute; top: 0%; width: 100%}
            #loading {height: 100%; left: 0; position: absolute; top: 45%; width: 100%; z-index: 2}
            #loading p {background: white; border: 2px solid #666; width: 180px}
     </style>
  </head>
  <body>
     <div id="grayout"></div>
     <div id="loading"><p>Page is loading...</p></div>
     <div id="content">
     // content is dynamically loaded into this div via AJAX
     </div>
  </body>
</html> 
```

**更新**：看来问题是我有“top:45%​​”。如何将该 DIV 移动到页面的中心（因为它是“页面正在加载消息”）而不会再次导致同样的问题？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-08T16:08:03.917

如果该元素具有垂直填充或边距，则会根据 CSS 规范将其添加到块的高度（请参阅[视觉格式化模型以了解绝对定位、不可替换的元素](http://www.w3.org/TR/CSS21/visudet.html#abs-non-replaced-height)）。

* * *

**编辑**   将`top:45%`您的元素向下移动 45%。删除它 ( `top:0`) 或将元素的高度设置为`auto`（默认值）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T16:09:24.177

你有没有尝试过：

```
* html, * body {height: 100%; margin: 0; padding: 0;} 
```

这也应该从页面中删除所有填充和边距。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T16:08:24.367

尝试添加

```
overflow: hidden; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T16:09:18.873

绝对定位的元素被从页面流中取出，因此 div 可能不适合内容后面。为什么容器 div 首先绝对定位？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T16:13:53.370

几乎总是，我从以下行开始我的 CSS：

```
* {padding:0; margin:0} 
```

这应该可以解决您的问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T16:36:44.190

Re: // 很多内容是通过 AJAX 动态加载的

是否有任何动态数据具有牢不可破的线条，或者可能超出空间的图像或文本？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-08T16:41:33.087

您的“加载” div 是窗口的整个高度，它位于距离顶部 45% 的位置，因此它会溢出窗口 45%，从而为您提供滚动条。

尝试将其移动到页面顶部并将文本垂直居中。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-05-08T16:10:48.917

哈张贴的 HTML 导致了一个没有介绍文本的问题..

```
<html>
  <head>
  </head>
  <body>
     <div style="height: 100%; background-color: blue;"></div>
  </body>
</html> 
```

# winapi - VB6：运行时错误“13”：设置和 int 时类型不匹配 int

> ID：840548
> 
> 赞同：2
> 
> 时间：2009-05-08T16:00:50.750
> 
> 标签：winapi, vb6

我对 VB6 编程并不陌生，但我也不是它的大师。希望有人可以帮助我解决一个关于类型不匹配错误的问题，该错误是由于尝试使用从函数返回的 int 设置 int 变量而收到的。

我试图设置的整数定义为：

```
Global AICROSSDOCKStatus As Integer 
```

现在，当我尝试拨打此电话时，我收到了运行时错误 13

```
AICROSSDOCKStatus = ProcessQuery(iocode, pb, AICROSSDOCBOLFN, "") 
```

我已经逐行调试了程序行。ProcessQuery 函数获取并返回预期的整数，但是当对 AICROSSDOCKStatus 进行分配时，它会失败。

附带说明一下，我还尝试对 ProcessQuery 执行 CInt() 并获得相同的结果。

有人对我可以尝试的方法有什么建议吗？

编辑：这是 ProcessQuery 的定义

```
Function ProcessQuery(icode As Integer, pb As ADODB.Recordset, TableName As String, sql$) As Integer 
```

编辑2：我无法告诉你为什么以这种方式完成。我继承了代码库。哎呀...

```
 Function ProcessQuery(icode As Integer, pb As ADODB.Recordset, TableName As String, sql$) As Integer
    ProcessQuery = ProcessQuery1(icode, pb, TableName, sql$)
End Function 
```

```
 Function ProcessQuery1(icode As Integer, pb As ADODB.Recordset, TableName As String, sql$) As Integer
''THIS IS THE ORIGINAL SQL CALL ROUTINE!
Dim STATUS As Integer
On Error GoTo ProcessSQLError

STATUS = 0
Select Case icode
   Case BCLOSE
        If pb.State  0 Then
            pb.Close
        End If
        Set pb = Nothing
        STATUS = 3
    Case BOPEN
        STATUS = 9
        Set pb = New ADODB.Recordset
    Case BOPENRO
        STATUS = 9
        Set pb = New ADODB.Recordset
    Case BGETEQUAL, BGETEQUAL + S_NOWAIT_LOCK, BGETGREATEROREQUAL, BGETGREATEROREQUAL + S_NOWAIT_LOCK
        If pb.State  0 Then
            pb.Close
            ''Set pb = Nothing
            ''Set pb = New ADODB.Recordset
        End If
        pb.Open sql$, MISCO_SQL_DB, adOpenDynamic, adLockOptimistic
        If Not pb.EOF Then
            pb.MoveFirst
        Else
            STATUS = 9
        End If
    Case BGET_LE, BGET_LE + S_NOWAIT_LOCK
        If pb.State  0 Then
            pb.Close
        End If
        pb.Open sql$, MISCO_SQL_DB, adOpenDynamic, adLockOptimistic
        If Not pb.BOF Then
            pb.MoveLast

        Else
            STATUS = 9
        End If
    Case BGETFIRST, BGETFIRST + S_NOWAIT_LOCK
        If pb.State  0 Then pb.Close
        sql = "select * from " + TableName
        If InStr(1, gblOrderBy, "ORDER BY") > 0 Then
            sql = sql + gblOrderBy
        Else
            sql = sql + " ORDER BY " + gblOrderBy
        End If

        gblOrderBy = ""
        pb.Open sql$, MISCO_SQL_DB, adOpenDynamic, adLockOptimistic
        If Not pb.EOF Then
                                                        pb.MoveFirst
        End If
    Case BGETLAST, BGETLAST + S_NOWAIT_LOCK
        If pb.State  0 Then
            pb.Close
        End If
        sql = "select * from " + TableName
        If InStr(1, gblOrderBy, "ORDER BY") > 0 Then
            sql = sql + gblOrderBy
        Else
            sql = sql + " ORDER BY " + gblOrderBy
        End If
        gblOrderBy = ""
        pb.Open sql$, MISCO_SQL_DB, adOpenDynamic, adLockOptimistic
        If Not pb.EOF Then
            pb.MoveFirst
            pb.MoveLast
        End If
    Case BGETNEXT, BGETNEXT + S_NOWAIT_LOCK:            pb.MoveNext
    Case BGETPREVIOUS, BGETPREVIOUS + S_NOWAIT_LOCK:    pb.MovePrevious
    Case B_UNLOCK
        ''need to add code here
    Case BINSERT
        If pb.State = 0 Then
            pb.Open TableName, MISCO_SQL_DB, adOpenDynamic, adLockOptimistic
        End If
    Case BDELETE
        STATUS = 8
        pb.Delete
    Case Else
        STATUS = 1
        MsgBox "STOP: UNDEFINDED PROCEDURE" + Str$(icode)
End Select
If STATUS = 0 Then
    If pb.EOF Or pb.BOF Then STATUS = 9
End If

ProcessQuery1 = STATUS
Exit Function

ProcessSQLError:
    MsgBox TableName + ": " + Error(Err), vbCritical, "Error "
    ProcessQuery1 = 9

End Function 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T16:10:03.800

好吧，我不能说我知道出了什么问题，但这里有一个可能的调试步骤：首先分配一个本地定义的整数，然后将 AICROSSDOCKStatus 分配给本地 int。如果运行时 err 13 发生在第一次分配时，那么真的很奇怪 - 如果它发生在第二次，那么您可能想查看是否有任何全局变量是您可能超出界限的数组。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T16:16:26.780

试试下面的，看看这个值是否是一个 int，

```
msgbox ProcessQuery(iocode, pb, AICROSSDOCBOLFN, "") 
```

我确信它不会是一个 int 并且这就是它失败的结果。我的猜测是，它会出现字符，使其成为非数字值。

您可以尝试`IsNumeric()`对结果进行检查，如果它是一个数值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T16:21:20.203

尝试使用一个中间变体，它应该从你的函数中获取任何类型的类型。它至少应该允许您调查返回值的真实类型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T16:21:59.343

这将告诉您函数实际返回的类型的名称：

```
MsgBox TypeName(ProcessQuery(...)) 
```

在任何情况下，将 ProcessQuery() 函数限制为 int 都可能有助于从一开始就防止此类错误：

```
Function ProcessQuery(whatever arguments) As Integer
  ''// ...
End Function 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T16:42:18.437

API 返回一个 16 位的 VB6 整数有点不寻常。很多时候，翻译 C 函数原型的人会将 ac“int”与 VB6 整数混淆，而在 VB6 中等价物实际上是 Long。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-08T20:17:10.307

问题不在于函数的返回有问题，而是通过引用传递的参数有问题。我需要一个 Recordset(pb) 以通过引用传递，但我已将 (pb) 声明为 Record。

# sql-server - CLR UDF 返回 Varbinary(MAX)

> ID：840552
> 
> 赞同：1
> 
> 时间：2009-05-08T16:01:00.593
> 
> 标签：sql-server, sqlclr, user-defined-functions

SQL CLR 用户定义函数是否可以返回数据类型 varbinary(MAX)？

在它提到的文档中：

“输入参数和从标量值函数返回的类型可以是 SQL Server 支持的任何标量数据类型，除了 rowversion、text、ntext、image、timestamp、table 或 cursor。” - 他们没有提到varbinary，但我不确定......

我有一些来自 .NET 端的字节数组数据，我需要从 CLR 返回到 SQL Server，并且我试图避免使用存储过程的输出参数来完成它（这就是我拥有它的方式现在正在测试中）。

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-01-21T22:41:34.803

从技术上讲，从 SQL Server 到 CLR 代码的接口中没有 8000 字节的最大值。主要是 T-SQL 包装器 Stored Proc 或 Function 的定义方式不同。意思是，如果调用 CLR 代码的 T-SQL Proc 或 Function 定义`RETURNS`为，那么无论您是否指定或作为 CLR 代码的返回类型，`VARBINARY(MAX)`它都应为。`VARBINARY(MAX)``SqlBytes``SqlBinary`

两者都`SqlBytes`可以`SqlBinary`处理 2 GB 的限制，但区别在于 CLR 代码如何接受数据。`SqlBinary`（就像`SqlString`）一次获取所有参数值，而`SqlBytes`（就像`SqlChars`）提供一个流接口，因此对于非常大的值可能更有效。

回到您在使用预定义 SQL 函数包装器时看到的问题，即~~是~~是关于 Visual Studio（技术上是 SSDT）如何自动生成的问题~~s~~d T-SQL。默认为`SqlBinary` ~~是~~是`VARBINARY(8000)`而默认为`SqlBytes` ~~是~~是`VARBINARY(MAX)`。以同样的方式，默认为`SqlString` ~~是~~是`NVARCHAR(4000)`而默认为`SqlChars` ~~是~~是`NVARCHAR(MAX)`。当被问到这个问题时，这些*是默认值。*也许从 Visual Studio 2012 开始，默认值已更改为`MAX`用于所有 4 种数据类型。这不一定是一件好事，因为使用`MAX`类型与非`MAX`类型对性能有一定的影响。因此，如果您不需要超过 8000 字节`VARBINARY`或 4000 字节的`NVARCHAR`，那么您将需要使用以下方法之一覆盖默认值：

1.  您可以`ALTER`在 Visual Studio 生成 Function 或 Proc 后定义，在这种情况下，您甚至可以将数据类型（输入参数或返回值）更改为任何大小，例如`VARBINARY(100)`或`NVARCHAR(50)`.

2.  You can use the `SqlFacet` decorator to tell Visual Studio / SSDT to auto-generate the Function or Proc definitions with the size option that you prefer as opposed to the default. The following example shows specifying the size for both input parameters and the return value (note that `-1` = `MAX`):

    ```
    [return: SqlFacet(MaxSize = -1)]  
    [Microsoft.SqlServer.Server.SqlFunction(Name = "FunctionName")]  
    public static SqlBinary FuncName([SqlFacet(MaxSize = 50)] SqlString InputParam) 
    ```

Using either of these two methods you can make either `SqlBinary` or `SqlBytes` map to either `VARBINARY(1 - 8000)` or `VARBINARY(MAX)`. Likewise, you can make either `SqlString` or `SqlChars` map to eithert `NVARCHAR(1 - 4000)` or `NVARCHAR(MAX)`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T17:02:22.663

如果将其定义为返回[SqlBytes](http://msdn.microsoft.com/en-us/library/system.data.sqltypes.sqlbytes.aspx)数据类型，则它应该正确映射到`varbinary(MAX)`SQL Server 中。

```
[SqlFunction]
public static SqlBytes Function1()
{
    return new SqlBytes(Encoding.UTF8.GetBytes("Hello world."));
} 
```

虽然您也可以使用[SqlBinary](http://msdn.microsoft.com/en-us/library/system.data.sqltypes.sqlbytes.aspx)数据类型，但如果您通过 Visual Studio 部署，它将被映射到`varbinary(8000)`而不是`varbinary(MAX)`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T18:51:01.513

答案似乎是肯定的 - 您可以通过返回“SqlBinary”来同时使用 varbinary(MAX)，也可以按照上面的建议使用 SqlBytes。

# vb.net - 使用 VB.NET 等效于 DataTable.Rows.Find 的通用列表？

> ID：840557
> 
> 赞同：1
> 
> 时间：2009-05-08T16:01:20.687
> 
> 标签：vb.net, .net-2.0

我正在将 DataTables 转换为通用列表，并且需要一种快速简便的方法来实现 Find 功能。看来我将不得不使用谓词。经过进一步调查，我似乎仍然无法重新创建该功能。我有这个谓词...

```
Private Function ByKey(ByVal Instance As MyClass) As Boolean
    Return Instance.Key = "I NEED THIS COMPARISON TO BE DYNAMIC!"
End Function 
```

然后这样称呼它......

```
Dim Blah As MyClass = MyList.Find(AddressOf ByKey) 
```

但是我没有办法将一个关键变量传递给这个谓词来进行比较，就像我过去对 DataTable 所做的那样......

```
Dim MyRow as DataRow = MyTable.Rows.Find(KeyVariable) 
```

如何在 VB.NET 中设置谓词委托函数来完成此任务？

不推荐 LINQ 或 lambdas，因为这是关于 .NET 2.0 版的问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T16:11:05.297

只需将您的谓词放在一个类实例中：

```
Public Class KeyMatcher
    Public Sub New(ByVal KeyToMatch As String)
       Me.KeyToMatch = KeyToMatch
    End Sub

    Private KeyToMatch As String

    Public Function Predicate(ByVal Instance As MyClass) As Boolean
       Return Instance.Key = KeyToMatch
    End Function
End Class 
```

进而：

```
Dim Blah As MyClass = MyList.Find(AddressOf New KeyMatcher("testKey").Predicate) 
```

我们甚至可以花点心思让这个通用：

```
Public Interface IKeyed(Of KeyType)
    Public Key As KeyType
End Interface

Public Class KeyMatcher(Of KeyType)
    Public Sub New(ByVal KeyToMatch As KeyType)
       Me.KeyToMatch = KeyToMatch
    End Sub

    Private KeyToMatch As KeyType

    Public Function Predicate(ByVal Instance As IKeyed(Of KeyType)) As Boolean
       Return Instance.Key = KeyToMatch
    End Function
End Class 
```

然后让你的 MyClass 类型实现新的 IKeyed 接口

# sql-server - sql server 报表服务可以用作报表编写器吗？

> ID：840565
> 
> 赞同：1
> 
> 时间：2009-05-08T16:03:04.397
> 
> 标签：sql-server, reporting-services

我们正在尝试使用 microsoft 报告服务以编程方式在 asp.net 中创建报告。我们不确定这是否可能。我们的报告有几个查询。我们不是为每个查询创建单独的 .rdlc 报告，而是寻找一种方法，以便我们可以将查询/存储过程提供给报告服务引擎，并且报告服务引擎将创建一个报告并将其显示在 Web 上. 那可能吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T16:20:02.653

不是你描述的方式。

报告服务需要一个报告定义来生成报告（.rdlc）。它不能只是猜测。您可以以编程方式创建定义。毕竟，.rdlc 只是报表定义语言模式形式的 XML。

您可以遍历结果集，为结果集中的每一列创建新的报告表列或类似的东西。我从来没有尝试过，但我认为如果不提前知道列、大小等，那么获得可靠的格式几乎是不可能的。我不知道您在谈论多少不同的查询，但是做这样的事情可能不值得。

这些查询是否完全不同？它们是否返回相同的基本数据类型？

# sql-server - T/SQL 谜题 - 如何加入为两个不相关的表创建一对一的关系？

> ID：840569
> 
> 赞同：1
> 
> 时间：2009-05-08T16:03:54.377
> 
> 标签：sql-server, tsql, join

假设我有两张桌子...... Foo 和 Bar。它们包含以下数据。

```
Table Foo:
Foo_Id
------
100
101

Table Bar:
Bar_Id
------
200
201 
```

如您所见，每个表都有两条记录。我想以返回两条记录的方式将这些表连接在一起；最终目标是为这些记录创建一对一的关系，即使在这种状态下它们没有这种关系。此数据的结果将进入表 Foo_Bar 以存储此新关系。

理想情况下，输出将类似于以下内容。

```
Foo_Id  Bar_Id
------  ------
100     200
101     201 
```

此代码将用于 T/SQL 存储过程。我可以使用 while 循环轻松编写此代码，但我不希望使用 while 循环，因为现实世界的应用程序将拥有比四条记录更多的数据，并且每天会被多个用户多次调用。

提前致谢！

编辑：

这或多或少是一个库存问题……我有 100 片披萨，还有 100 个人说他们想要一片披萨。Foo_Bar 表基本上是一种为每人分配一片披萨的方法。该表存在，此解决方案将加载该表的数据。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T16:49:57.590

试试这个：

```
declare @Foo table (Foo_Id int)
INSERT INTO @Foo VALUES (100)
INSERT INTO @Foo VALUES (101)
declare @Bar table (Bar_Id int)
INSERT INTO @Bar VALUES (200)
INSERT INTO @Bar VALUES (201)

SELECT
    dt_f.Foo_Id
        ,dt_f.RowNumber
        ,dt_b.Bar_Id
    FROM (SELECT
              Foo_Id, ROW_NUMBER() OVER(ORDER BY Foo_Id) AS RowNumber
              FROM @Foo
          ) dt_f
        INNER JOIN (SELECT
                        Bar_Id, ROW_NUMBER() OVER(ORDER BY Bar_Id) AS RowNumber
                        FROM @Bar
                   ) dt_b ON dt_f.RowNumber=dt_b.RowNumber 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T16:08:14.743

select foo_id, bar_id from foo inner join bar on foo_id = (bar_id -100)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T16:11:44.530

从您给出的示例中，您也许可以利用 bar_id = 100 + foo_id

```
选择 foo.foo_id, bar.bar_id
from foo inner join bar on foo.foo_id +100 = bar.bar_id

```

..但也许这只是您示例中的简化？

如果 ID 之间没有关系，那么它就不再是真正的*关系数据*，并且没有简单的方法来连接关系数据库中的行。

在这种情况下，您必须向其中一个表添加一个新列并添加一个外键，以便数据*确实*成为关系数据。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T16:41:15.990

分配给库存通常是一次一行的操作。为此使用集合很棒，但它是一种“批处理”范例。我会想象各种各样的人排成一列并从库存表中获取比萨饼。Mssql 对此 get-next-available-item 模式有一些有用的提示 - 查看 READPAST 提示。要获得披萨，您可能会做类似的事情

```
UPDATE mytable WITH (READPAST) SET AcquiringUserID = @userId where AcquiringUserId is null 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T16:08:43.837

从每个表中选择作为具有排名函数的嵌套选择语句，然后加入排名。

```
select foo_id, bar_id
from (select foo_id, rank() over (partition by foo_id order by foo_id) as [Rank] from foo) f
left join (select bar_id, rank() over (partition by bar_id order by bar_id) as [Rank] from bar) b
on f.Rank = b.Rank 
```

# oracle - Oracle - 如何从已经存在的日期创建日期？

> ID：840577
> 
> 赞同：0
> 
> 时间：2009-05-08T16:07:11.610
> 
> 标签：oracle, datetime

说我发出：

```
select date_field from table1; 
```

date_field 就像'25.11.2009' 我会尝试用月份改变日期字段的位置，反之亦然。（当然几天> 12一些操作）

```
 TO_DATE( MOD(SUBSTR(TO_CHAR(a.A_DATE, 'DD.MM.YYYY'), 4, 2), 12) || '.' ||
              SUBSTR(TO_CHAR(a.A_DATE, 'DD.MM.YYYY'), 1, 2) || 
              SUBSTR(TO_CHAR(a.A_DATE, 'DD.MM.YYYY'), 6, 4),
          'DD.MM.YYYY') 
```

问题是从 MOD() 函数返回的值是一个数字，即 01.07.2009 --> 我得到的日期为 1，而不是预期的“01”。后来我无法得到日期。有没有捷径可以解决我的问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T19:18:31.460

我怀疑您需要认真重新考虑您要做什么。

我认为您开始的目的是想简单地更改日期的格式，例如将“25.11.2009”更改为“11.25.2009”。

如果 date_field 实际上是 DATE 类型，则字段中没有存储固有格式。它是一个表示特定日期和时间的数值。当您在 SQLPlus 或其他工具中选择它时，它会被格式化为文本，但该格式不会存储在表中。

如果您想以特定格式查看日期，请使用 TO_CHAR 函数来强制它。您还可以使用 NLS_DATE_FORMAT 为单个会话、单个客户端或整个数据库设置默认格式模型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T16:28:06.800

我用过： CASE MOD(SUBSTR(TO_CHAR(a.birthday, 'DD.MM.YYYY'), 1, 2), 12) WHEN 1 THEN '01' WHEN 2 THEN '02' WHEN 3 THEN '03' WHEN 4然后 '04' 当 5 然后 '05' 当 6 然后 '06' 当 7 然后 '07' 当 8 然后 '08' 当 9 然后 '09' 当 10 然后 '10' 当 11 然后 '11' 当 12 然后 ' 12' END 不是很优雅但很有效 :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T16:13:46.383

这行得通吗？

```
TO_DATE(TO_CHAR(a.A_DATE, 'DD/MM/YYYY'), 'MM/DD/YYYY') 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T16:40:35.757

你试过`TO_CHAR(<date>, '<format>')`吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-25T02:52:53.847

yli> “我以某种方式匿名化了日期，实际上是员工的雇佣日期，以用于测试环境。”

所以这是你的实际要求。如果要更改某些日期，则根本不需要使用日期/字符串转换函数 ( `TO_CHAR/TO_DATE`)。Oracle 直接支持对日期值的算术运算。

如果你想随机化你的日期，为什么不使用类似的东西：

```
select date_field + dbms_random.value * 100 from table1; 
```

# c# - ASP.NET - 内部消息系统

> ID：840582
> 
> 赞同：0
> 
> 时间：2009-05-08T16:07:57.877
> 
> 标签：c#, asp.net

我想在我的 Web 应用程序中实现一个消息系统，类似于 Chase 和 Facebook 在其网站上的系统。我应该自己开发，还是应该找到第 3 方控制或其他解决方案？谷歌会提供某种 API 来简化这个过程吗？我倾向于自己开发这个，因为它可能不会涉及太多，但想知道我的选择。

感谢所有建议/评论！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T17:22:44.033

在这种情况下，构建自己的消息传递系统会更好。

# asp.net - 如何在两个不同的 Web 应用程序中共享会话变量？

> ID：840594
> 
> 赞同：0
> 
> 时间：2009-05-08T16:10:36.547
> 
> 标签：asp.net, session-state

我有两个不同的 Web 应用程序：第一阶段和第二阶段。

对于某些会话值，阶段 II 依赖于阶段 I。

我想通过共享会话变量来运行这两个应用程序。

我不想使用状态服务器来存储会话。

我使用过 inproc 会话，我想一起分享这个会话。

我如何实现这一目标？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T16:14:50.310

您不能通过进程内会话在 2 个应用程序之间共享会话，因为进程内会话在应用程序的上下文中运行。您只能通过将会话从应用程序的上下文中取出来共享会话，这只有在 out-proc 会话模式下才有可能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T21:49:34.983

看看这个[LINK](http://blog.maartenballiauw.be/post/2007/11/ASPNET-load-balancing-and-ASPNET-state-server-(aspnet_state).aspx)我想它可能会帮助您进行设置。

# asp.net-mvc - 如何返回带有查询字符串的 asp.net mvc 视图？

> ID：840606
> 
> 赞同：0
> 
> 时间：2009-05-08T16:12:26.730
> 
> 标签：asp.net-mvc, view, query-string

在 Asp.NET MVC 中，如何让控制器返回带有查询字符串的视图？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T00:54:31.987

如果您发布您想要完成的内容可能会更好。简单的答案是你不能，查询字符串是请求的一部分，所以如果你想这样做，你需要使用查询字符串作为 URL 的一部分重定向到你的视图......但听起来你可能是试图使用查询字符串将数据传递给视图？如果是这样，您最好使用 ViewData。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-06-13T14:42:34.257

用这个

```
return RedirectToAction("AmendAbsence", new RouteValueDictionary (new  {  Controller ="Absence", Action="AmendAbsence", Id=id })); 
```

适当配置 Global.asmx

谢谢

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T05:07:59.817

[这](http://www.asp.net/learn/mvc/tutorial-11-cs.aspx)应该让您开始返回视图。[本教程](http://www.asp.net/learn/mvc/tutorial-26-cs.aspx)应该向您展示如何将参数传递到操作中以生成特定结果。

# c# - 部署 WCF 服务、C#、WCF、VS2008

> ID：840608
> 
> 赞同：0
> 
> 时间：2009-05-08T16:12:54.887
> 
> 标签：c#, visual-studio-2008, wcf

我有一个测试项目，WCF 服务库，并且我发布了该项目。拥有一台安装正确的 2003 服务器。我浏览到我的应用程序并单击 .svc 时出现此错误。

找不到作为 ServiceHost 指令中的服务属性值提供的类型“SearchService”。

这是我的 web.config 中的片段

```
<endpoint address="" binding="wsHttpBinding" contract="TestService.ISearchService">
      <identity>
        <dns value="localhost" />
      </identity>
    </endpoint> 
```

我的界面：

```
 [ServiceContract]
public interface ISearchService
{
    [OperationContract]
    string GetName();
} 
```

我的实现：

```
 [ServiceBehavior(InstanceContextMode=InstanceContextMode.PerSession)]
public class SearchService :ISearchService
{
    #region ISearchService Members

    public string GetName()
    {
      returnn "HAL-2001" 
    }

 } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T18:10:50.700

ANo，错误表明主机在您的 web.config 中找不到服务实现“SearchService”的定义。在您的 web.config 中，您需要将 <endpoint> 标记包装在 <service> 标记中。<service> 的 name 属性应设置为 SearchService 类的全名（包括所有命名空间）。您还需要定义一种行为以使服务能够在浏览器中显示 WSDL。当您将服务部署到服务器时，您可能还希望删除 <dns value="localhost" />。

这是一个示例片段，请确保将 SearchService 的完整类名放在 <service> 标记中，并确保完整的类名在您的 .svc 文件中：

```
<system.serviceModel>
 <services>
  <service name="SearchService" behaviorConfiguration="ServiceBehavior">
    <endpoint address="" binding="wsHttpBinding" contract="TestService.ISearchService">
    </endpoint>
    <endpoint address="mex" binding="mexHttpBinding" contract="IMetadataExchange"/>
  </service>
</services>
<behaviors>
  <serviceBehaviors>
    <behavior name="ServiceBehavior">
      <!-- To avoid disclosing metadata information, set the value below to false and remove the metadata endpoint above before deployment -->
      <serviceMetadata httpGetEnabled="true"/>
      <!-- To receive exception details in faults for debugging purposes, set the value below to true.  Set to false before deployment to avoid disclosing exception information -->
      <serviceDebug includeExceptionDetailInFaults="false"/>
    </behavior>
  </serviceBehaviors>
</behaviors>  </system.serviceModel> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T17:06:12.997

好吧，wsHttpBinding 要求您使用 SOAP 连接到您的服务 - 单独的 Web 浏览器无法解决它，这就是为什么当您浏览到 .svc 文件时它不起作用的原因。那里没有错，真的。

您需要创建一个真正成熟的 SOAP 客户端来连接到您的服务并对其进行测试。或者，您也可以使用文件夹`WcfTestClient.exe`中的测试客户端。`VS2008\Common7\IDE`

马克

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T21:27:06.393

答：不，您应该切换到 basicHttpBinding 并进行测试以确保一切正常。您正在使用 WSHttpBinding 并且默认情况下它已打开身份验证。您的客户端需要传递凭据才能真正获得响应，这就是浏览器调用不起作用的原因。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T16:39:41.763

您的客户代码调用的是什么？为此，它应该调用如下所示的代理类。

```
class SearchServiceProxy : ClientBase<ISearchService>, ISearchService
{
    public string GetName()
    {
        return Channel.GetName();
    }
} 
```

# apache-flex - Flex：未处理 CSS 类型选择器，因为该类型未在应用程序中使用

> ID：840611
> 
> 赞同：9
> 
> 时间：2009-05-08T16:13:00.580
> 
> 标签：apache-flex

当我为我的应用程序使用自定义皮肤时，我到处都会收到这些警告。是的，我知道为什么。但我不需要被告知这一点，我不喜欢所有的黄色图标都把我的工作区弄得乱七八糟。我知道如果我删除未使用的类，它们会消失，但是 1）如果稍后我决定添加一个组件，我希望该类就地设置样式，并且 2）我的皮肤位于共享位置，所以即使这个应用程序不使用特定类，另一个使用相同皮肤的应用程序可能会使用。那么有没有人知道告诉 flex builder 忽略这种特殊类型的警告的方法？

谢谢。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-10T12:13:54.120

在项目属性的 Flex 编译器部分的“附加编译器参数”框中，附加以下内容以禁用有关未使用的 CSS 类型选择器的警告：

```
-show-unused-type-selector-warnings=false 
```

它工作得很好。

不要只是禁用所有警告，知道绑定可能会失败等非常重要。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T17:54:49.527

这个我没试过，但是看看...

[http://www.adobe.com/cfusion/communityengine/index.cfm?event=showdetails&productId=2&postId=12748](http://www.adobe.com/cfusion/communityengine/index.cfm?event=showdetails&productId=2&postId=12748)

或这个：

[http://www.derekentringer.com/blog/flex-builder-remove-css-type-selector-warnings/](http://www.derekentringer.com/blog/flex-builder-remove-css-type-selector-warnings/)

# reporting-services - Reporting Services 报告超时

> ID：840629
> 
> 赞同：13
> 
> 时间：2009-05-08T16:15:47.500
> 
> 标签：reporting-services, reportingservices-2005

我们有一份 2005 年的报告，它可以是 2 到 250 页左右，平均大约是 10 页。当开发报告时，我们的开发人员被告知 10 页左右是正确的数字，并且非常不了解业务领域好吧，他认为报告服务是正确的方法。

现在报告已部署到 PROD，我们收到了一些关于报告超时的投诉。鉴于所请求的报告的绝对大小（250 页），开发人员和我对此都不会感到非常惊讶。

我的问题是，我们必须使用哪些选项来使用当前 95% 的时间有效的报告并使其适用于剩余的 5%？是否有任何配置选项可以提高渲染性能或类似的东西？

> 该报告用于退货授权，因此退货的大小可以非常大。每个授权页面都有 4 个带有徽标和条形码的不同退货标签。

**澄清：**

报告从报告服务到报告查看器的呈现速度相当快，但是当我们导出为 PDF 时，需要一段时间才能加载。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2010-08-17T18:38:27.080

您可以摆弄以下任何一项：

**1) 修改 SessionTimeout 和 SessionAccessTimeout 系统属性。**

这是 rs.exe 的示例脚本，它将为您设置这些值：

```
Public Sub Main()
    Dim props() as [Property]
    props = new [Property] () { new [Property](), new [Property]() }

    props(0).Name = "SessionTimeout"
    props(0).Value = timeout

    props(1).Name = "SessionAccessTimeout"
    props(1).Value = timeout

    rs.SetSystemProperties(props)
End Sub 
```

您可以使用以下命令运行此脚本：

```
rs -i sessionTimeout.rss -s http://yourserver.com/reportserver -v timeout="6000" 
```

超时以秒表示，因此本示例将 SessionTimeout 和 SessionAccessTimeouts 设置为大约一个半小时。

（通过[http://blogs.msdn.com/b/jgalla/archive/2006/10/11/session-timeout-during-execution.aspx](http://blogs.msdn.com/b/jgalla/archive/2006/10/11/session-timeout-during-execution.aspx)）

**2) 通过报表管理器更改报表执行超时** 打开报表管理器 在页面顶部，单击站点设置。这将打开站点的常规属性页面。

报告执行超时 指定报告处理是否在一定秒数后超时。（通过[http://msdn.microsoft.com/en-us/library/ms181194.aspx](http://msdn.microsoft.com/en-us/library/ms181194.aspx)）

**3) 设置 HttpRuntime ExecutionTimeout**

1.  转到开始 -> 管理工具 -> Internet 信息服务，打开 ReportServer 的 Web.config 文件。
2.  从那里展开网站 -> 默认网站，然后单击 ReportServer。在右侧窗格中，右键单击“Web.Config”并选择“打开”。
3.  找到 HttpRuntime 参数。如果它不存在，则必须在该部分中创建它。
4.  将 executionTimeout 值设置为“10800”（3 小时），如下所示：

```
<system.web>
    <httpRuntime executionTimeout = "10800" />
</system.web> 
```

**4) 增加报表服务器上的脚本超时时间**

1.  进入您的报告服务器并打开 Internet 信息服务；右键单击 ReportServer 并选择属性。
2.  转到选项选项卡，并将 ASP 脚本超时设置为 300 秒（这对我来说真的不起作用）。

**5) 将报告设置为在服务器上永不超时**

1.  在服务器上打开 Web 浏览器并转到[http://yourserver.com/Reports](http://yourserver.com/Reports)
2.  导航到报告位置并单击问题报告。
3.  在左侧窗格中，单击属性。
4.  在“报告执行超时”中单击“不要使报告执行超时”。（通过[http://geekswithblogs.net/ssrs/archive/2009/10/30/steps-to-resolve-ssrs-timeout-issues.aspx](http://geekswithblogs.net/ssrs/archive/2009/10/30/steps-to-resolve-ssrs-timeout-issues.aspx)）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T16:27:51.590

SSRS 中的每个报表都有一个报表执行超时设置。默认情况下，它们设置为使用默认系统设置，但可以通过报表管理器或 SSMS 自定义它们。

你确定这不是数据库命令超时吗？这可以在连接字符串中进行调整。是报告效率低下还是查询？250 页的 SSRS 报告确实还不错。我们经常运行这么大的报告。SSRS 实际上优于我们使用的大多数其他报告引擎。

# iphone - 面向 SQL 经验丰富的开发人员的 Core Data 与 SQLite

> ID：840634
> 
> 赞同：34
> 
> 时间：2009-05-08T16:17:21.803
> 
> 标签：iphone, sqlite, core-data

我们开始在 iPhone Enterprise 开发人员计划中开发内部应用程序。由于它接近于 OS 3.0，我们正在重新考虑使用 SQLite 和使用 Core Data 的原始设计。这里有更多信息：

*   有一个旧版桌面应用程序正在取代它。我们将重用现有的后端。
*   我们目前有一个生成的 SQLite 数据库作为概念证明。这基本上是现有后端数据库的缩减版本。
*   我们将从远程站点加载数据并将其存储在本地，它将持续存在并且需要。我们只会在它发生变化时更新它，这将是每两个月更新一次。我们很可能会使用 XML 或 JSON 来传输数据。
*   这个项目有两个开发人员，我们都有很强的 SQL 技能，但没有一个人使用过 Core Data。

我的问题是：Core Data 比 SQLite 有什么好处，在这个特定实例中会有什么好处，这些好处是否证明学习新框架而不是使用现有的强大 SQL 技能是合理的？

编辑：我刚刚注意到这个问题：[Core Data vs SQLite 3](https://stackoverflow.com/questions/523482/core-data-vs-sqlite3)。因此，我想我的问题是：

*   如果我必须检查特定项目是否存在或是否有更新，这很容易使用 SQL，Core Data 仍然有意义吗？我可以加载图表中的第一个对象并检查版本号而不加载整个图表吗？
*   如果我们已经了解 SQL，Core Data 在这个项目中的优势是否证明我们学习它是合理的？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-08T17:08:55.377

当您阅读过[Core Data 与 SQLite 3](https://stackoverflow.com/questions/523482/core-data-vs-sqlite3)时，您知道 Core Data 和持久性机制（在本例中为 SQLite）在很大程度上是正交的。Core Data 实际上是关于管理对象图的，它的主要用例是用于 MVC 架构的模型组件。*如果*您的应用程序非常适合这种架构，可能值得使用 Core Data，因为它会在模型​​组件中为您节省大量代码。如果您已经有一个工作模型组件（例如来自现有的桌面应用程序），那么 Core Data 不会为您买太多。混合方法是可能的——您可以进行自己的持久性/查询，并在内存存储中构建一个核心数据，您使用查询结果填充该核心数据，并通过核心数据将此内存存储用作您的应用程序的模型组件。这并不常见，但我已经做到了，并且没有重大障碍。

要回答您的具体问题：

1.  您可以为整个持久存储分配版本号并通过 检索该信息`+[NSPersistentStore metadataForPersistentStoreWithURL:error:]`，甚至无需打开存储。`+setMetadata:forPersistentStoreWithURL:error`当然，也存在等价物。如果要将版本信息存储在实体实例中而不是持久存储元数据中，则只能加载单个对象。使用 SQLite 持久存储，Core Data 可以很好地只获取您需要的内容。

2.  该`NSPredicate`API 非常容易学习，并且似乎在 SQL 编译方面做得不错。至少对于您可以在 iPhone 上安装的大小的数据库，根据我的经验，它肯定是足够的（性能方面）。然而，我认为 SQL 与 Core Data 的问题有点误导。一旦你得到查询的结果，你打算用它做什么？如果您自己动手，则必须实例化对象、处理错误/唯一性（如果您不想立即将查询的整个结果加载到内存中）以及 Core 已经提供的所有其他对象图管理工具数据。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-08T16:40:09.563

听起来您已经使用 SQLite 设计了项目，并且您在该领域有经验。

所以底线是，移植这个项目是否有意义，Core Data 会为我提供我原始设计中没有的任何东西吗？

假设原始设计已正确完成，基于此项目的要求，它可能不值得。

但这不是讨论的结束。还有其他需要考虑的事情：我的下一个项目会有这么轻的数据库需求吗？由于时间或预算限制，我是否需要尽快发货？假设我迟早要学习 Core Data，现在这样做难道没有意义吗？我可能有兴趣将我的代码移植到 Mac 上吗？

这些问题的答案可能会让您做出这样的决定：是的，可以说回到绘图板并了解 Core Data 的全部内容确实是值得的。

回答你的最后一个问题：优势是什么？好吧，Core Data 是您的数据库的更高层次的抽象，它也是数据存储不可知的（因此，如果未来版本的 iPhone 放弃 SQLite 以使用 MySQL 的嵌入式版本......不太可能，但它是一个示例）然后 Core数据需要对代码进行很少的更改才能使其与新的数据存储一起使用。Core Data 将为 Mac 平台提供大量的快速可移植性。Core Data 将处理您的数据模型的版本控制，而除非您有框架或工作流来管理它，否则直接访问 SQLite 不会。

我确信其他回答者可以提出其他优势，也许还有一些很好的理由为什么不搞乱 Core Data。顺便说一句，在类似的情况下，我的决定是移植到更高级别、更新的框架。但就我而言，这是一个附带项目，发货日期和预算都不是因素。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T16:42:16.143

不要贬低这个论坛，但您可能会在 Apple iPhone DevForum 找到更多具有上下文相关经验的受访者。

从纯粹的项目管理角度来说，听起来您知道如何使用 SQLite 构建您想要构建的东西，因此对我来说，沿着这条路线开始对我来说更有意义。

话虽如此，CoreData 构建在 SQLite 之上，如果您尝试将系统的其他部分与您的数据结合使用，例如使用 KVC/KVO 或绑定，那么您可能很快就会发现这个功能值得学习曲线。

= 迈克

# python - 按字典顺序排序？

> ID：840637
> 
> 赞同：7
> 
> 时间：2009-05-08T16:18:50.567
> 
> 标签：python, api, sorting, photobucket

我正在与 Photobucket API 集成，我在他们的[api 文档](http://pic.photobucket.com/dev_help/WebHelpPublic/Content/Getting%20Started/Consumer%20Authentication.htm)中遇到了这个问题：

> *“按名称对参数进行排序[原文如此]（字节排序，标准排序，不自然或不区分大小写）。如果参数具有相同的名称，则按值排序。”*

这意味着什么？如何按字典顺序对某些内容进行排序？字节顺序？

到目前为止，他们的其他文档都还不错，但是（对我来说）这条线似乎需要进一步解释。不幸的是，没有。

无论如何，我正在用**Python**编写应用程序（它最终将成为 Django 应用程序），以防你想推荐可以为我处理此类排序的特定模块^_^

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-08T16:38:46.213

我认为这里的词典是 ascii 排序的“别名”？

```
词典自然  
z1.doc z1.doc    
z10.doc z2.doc    
z100.doc z3.doc    
z101.doc z4.doc    
z102.doc z5.doc    
z11.doc z6.doc    
z12.doc z7.doc    
z13.doc z8.doc    
z14.doc z9.doc     
z15.doc z10.doc    
z16.doc z11.doc    
z17.doc z12.doc    
z18.doc z13.doc     
z19.doc z14.doc     
z2.doc z15.doc    
z20.doc z16.doc    
z3.doc z17.doc    
z4.doc z18.doc    
z5.doc z19.doc    
z6.doc z20.doc    
z7.doc z100.doc    
z8.doc z101.doc    
z9.doc z102.doc    

```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-08T16:24:16.170

这个词应该是“词典”

[http://www.thefreedictionary.com/Lexicographic](http://www.thefreedictionary.com/Lexicographic)

字典顺序。使用字符串中出现的字母。

正如他们建议的那样，不要将大写和小写折叠在一起。只需使用 Python 内置的 list.sort() 方法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-08T16:31:46.917

这类似于 Facebook API——查询字符串需要在生成签名哈希之前进行规范化。

您可能有一个参数字典，例如：

```
params = {
  'consumer_key': "....",
  'consumer_secret': "....",
  'timestamp': ...,
  ...
} 
```

像这样创建查询字符串：

```
urllib.urlencode(sorted(params.items())) 
```

`params.items()`将字典的键和值作为列表元组返回，`sorted()`对列表进行排序，并`urllib.urlencode()`在转义时将它们连接成单个字符串。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T17:16:22.253

从该部分引用更多内容：

> 2 生成基本字符串：
> 
> 规范化参数：
> 
> *   将此请求的 OAuth 特定参数添加到输入参数中，包括：
>     
>     
>     
>     ```
>     oauth_consumer_key = <consumer_key>
>     oauth_timestamp = <timestamp>
>     oauth_nonce = <nonce>
>     oauth_version = <version>
>     oauth_signature_method = <signature_method> 
>     ```
>     
>     
> *   按名称对参数进行排序 [原文如此]（字节排序，标准排序，不自然或不区分大小写）。如果参数名称相同，则按值排序。
>     
>     
> *   按照 RFC3986 第 2 节（即 urlencode）对参数值进行编码。创建参数字符串()。这与 HTTP 'postdata' 或 'querystring' 的格式相同，即每个参数表示为 name=value 并用 & 分隔。例如，`a=1&b=2&c=hello%20there&c=something%20else`

我认为他们是说参数必须按排序顺序出现 - `oauth_consumer_key`before `oauth_nonce`before ...

# php - 如何为新闻门户创建 CMS？

> ID：840638
> 
> 赞同：1
> 
> 时间：2009-05-08T16:19:04.387
> 
> 标签：php, mysql, content-management-system

好的，我再试一次，如果对你来说太简单了，对不起；我们都必须从某个地方开始。

我需要使用网页来指定报纸的布局，即页眉、页脚和新闻区域。这是由我创建的 HTML 页面生成的 [带有复选框和创建按钮的页面]。

第二个网页是为各种组件添加内容；同样，我的 HTML 页面包含 3 个部分，用于输入页眉、正文和页脚，每个部分都有一个保存按钮。然后需要输出内容。

信息将存储在 MySQL 数据库中，但我只需要使用我已经在 HTML 中创建的 Web 表单来设计布局和添加内容。数据库用于存储布局和内容信息。

对数据库表的更改应动态反映演示页面中的更改。

到目前为止，我已经创建的数据库有 6 个链接表 [布局、页眉、页脚、本地、国家和国际]。我也知道与数据库链接的 MySQL 代码，但不知道如何编写代码以通过 php 处理将信息从网页发布到数据库或从数据库获取信息。

任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-08T16:32:41.343

到目前为止我学到了什么：

1.  如果您创建一个 CMS，您将获得大量的编程经验。
2.  如果您想为真实客户构建新闻门户，请避免 [1] 并使用现有的 CMS。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T16:33:39.003

尽管您可以使用许多框架和 cms 系统。您正在寻找与您将在此处找到的数据库交互的 php 命令。

[http://ca2.php.net/manual/en/function.mysql-query.php](http://ca2.php.net/manual/en/function.mysql-query.php)

我希望这有帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T17:44:59.067

我实际上正在做一个类似的项目。不要使用现有的 CMS...对于这种基本的东西，大多数 cms 都太过分了...它还可以让您更好地控制一切，它是初学者学习 PHP 和如何使用数据库的好方法...一个工具我发现 FCKeditor 很有用...它允许客户端创建详细的布局，就像他们使用 Word 一样，但会将 HTML 返回给您...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T16:27:58.470

听起来你正在重新发明时间，以及随之而来的所有问题。我可以建议您使用现有的 CMS 吗？有无数的选择，但我想到的一些比较有名的包括......

*   克隆
*   Joomla
*   德鲁巴
*   TYPO3
*   WordPress

甚至还有一个关于该主题的维基百科页面：[Web 内容管理系统](http://en.wikipedia.org/wiki/Web_content_management_system)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-23T18:09:41.027

我正在为客户做类似的事情。由于截止日期和预算，我放弃了，不得不使用现有的 CMS。这是我对这个项目的建议。但我相信您将继续开发此 CMS 或为项目开发，因此您需要做的是除了连接到数据库之外，您只需创建一个函数来调用正确的数据桌子。您在 PHP 函数中使用 SQL 语法，您会说从表名 WHERE 表列=页面的正确行中提取内容。链接到 PHP 手册的那个人把你送到了正确的页面。

我必须说开发自己的 CMS 并不是一个坏主意，就像很多人出于多种原因一直说的那样。1\. 你在这个过程中学到了很多东西 2\. 许多 cms 有大量的矫枉过正。3.虽然他们都过分了，但他们错过了一个重要的功能，那就是内容块。页面可能需要多个可编辑的内容区域。Wordpress 等只允许您编辑页面的一个主要部分。当然，他们有动态的侧边栏和菜单，但这不是我们想要的。我们需要一个允许您编辑页面的几个不同内容区域的 CMS。我正在为此目的创建自己的 CMS。我在分离代码时遇到问题，我只能在不同的页面模板中调用函数，但这是另一回事。无论如何，请使用该 PHP 手册链接中的信息。我觉得' s 正是您正在寻找的。与此同时，不要放弃那个 CMS，也不要听每个人说这个世界不需要另一个 CMS。确实如此。一种准系统，可将多个主要内容区域从数据库中提取到页面中。就这样。没有插件，没有矫枉过正。只是大块的内容。也许在你完成后分享你的源代码以便一些人可以学习？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T16:26:05.293

调查：

1.  [德鲁巴](http://drupal.org/)
2.  [WordPress](http://wordpress.org/)

作为起点。祝你好运。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-08T16:43:44.687

我以这种方式成功使用了 WordPress，并会推荐它。

这篇文章对我做类似的事情很有帮助：http: [//blueprintds.com/2008/03/13/top-10-wordpress-cms-plugins/](http://blueprintds.com/2008/03/13/top-10-wordpress-cms-plugins/)

至于用不同的内容部分组成一个页面，有几种方法可以采用。这里有2个常见的。

方法 1：让您的主题页面或索引模板从单独的“页面”或“帖子”中提取内容。根据您在“页面”或“帖子”上设置的要在该部分中显示的类别或指示它们将在一个部分中显示的自定义字段值来选择要包含的部分。我喜欢这种方法，因为您可以获得漂亮的 html 所见即所得编辑器和内容的版本控制。

模板示例：

```
html
<? php /*call main pagecontent*/ ?>
html
<?php /*call 2nd section of pagecontent (posts where category = '2nd section' limit 1)*/ ?>
more html
<?php /*call 3rd section of pagecontent (posts where category = '3rd section' limit 1)*/ ?>
etc 
```

方法 2：为单个帖子的单独内容部分使用自定义字段（这里有很多缺点，但快速获得一些东西可能更直接。）

如果上述内容需要更多详细信息，请告诉我。

# asp.net-mvc - 如何在 UpdateModel() 中捕获映射到整数属性的非整数值

> ID：840640
> 
> 赞同：0
> 
> 时间：2009-05-08T16:19:22.343
> 
> 标签：asp.net-mvc, validation

假设您有一个名为 Person 的对象，如下所示：

```
class Person
{
  public int ID { get; set; }
  public string Name { get; set; }
  public int NumberOfCatsNamedEnder { get; set; }
} 
```

我有一个简单的 HTML 表单，它公开了发布到我的 PersonController 类中的 ASP.NET MVC 操作的属性。我遇到的问题是，如果有人输入字母“A” `NumberOfCatsNamedEnder`，我会得到一个*“人”类型的模型没有成功更新。*错误。由于在尝试更新模型时会发生这种情况，因此我找不到任何方法来检查是否有人在不诉诸于的情况下传入了非整数值

```
if(!IsInteger(formCollection["NumberOfCatsNamedEnder"]))
{
  ModelState.AddModelError(
    "NumberOfCatsNamedEnder",
    "Ender count should be a number");
} 
```

有一个更好的方法吗？我能够找到一些关于自定义 ModelBinders 的信息；这是需要的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T18:19:11.493

我真的很喜欢使用[演示模型](http://martinfowler.com/eaaDev/PresentationModel.html)的方法。我会创建一个这样的类：

```
class PersonPresentation
{
    public int ID { get; set; }
    public string Name { get; set; }
    public string NumberOfCatsNamedEnder { get; set; }

    public void FromPerson(Person person){ /*Load data from person*/ }
} 
```

然后您的控制器操作可以将视图绑定到 PersonPresentation：

```
public ActionResult Index()
{
    Person person = GetPerson();
    PersonPresentation presentation = new PersonPresentation();
    ViewData.Model = presentation.FromPerson(person);
    return View();
} 
```

...然后在您的 Update 方法中接受一个并执行验证：

```
public ActionResult Update(PersonPresentation presentation)
{
    if(!IsInteger(presentation.NumberOfCatsNamedEnder))
    {
        ModelState.AddModelError(
          "NumberOfCatsNamedEnder",
          "Ender count should be a number");
    }
    ...
} 
```

# linked-list - 为什么在链表中间插入 O(1)？

> ID：840648
> 
> 赞同：145
> 
> 时间：2009-05-08T16:21:24.303
> 
> 标签：linked-list, big-o

根据关于链表的[维基百科文章，在链表](http://en.wikipedia.org/wiki/Linked_list#Linked_lists_vs._arrays)中间插入被认为是 O(1)。我认为这将是O（n）。您不需要找到可能在列表末尾附近的节点吗？

这种分析是否没有考虑到节点操作的发现（尽管它是必需的）而只是插入本身？

**编辑**：

> 与数组相比，链表有几个优点。在列表的特定点插入元素是一个常数时间操作，而在数组中插入可能需要移动一半或更多的元素。

上面的说法对我来说有点误导。如果我错了，请纠正我，但我认为结论应该是：

**数组：**

*   找到插入/删除点 O(1)
*   执行插入/删除 O(n)

**链接列表：**

*   找到插入/删除点 O(n)
*   执行插入/删除 O(1)

我认为唯一不必找到该位置的情况是，如果您保留某种指向它的指针（例如在某些情况下使用头部和尾部）。所以我们不能直截了当地说链表在插入/删除选项中总是优于数组。

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2009-05-08T16:24:19.680

你是对的，文章认为“索引”是一个单独的操作。所以插入本身是 O(1)，但到达中间节点是 O(n)。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-05-08T16:25:11.270

插入本身是 O(1)。节点查找是 O(n)。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2009-05-08T16:24:56.947

不，当您决定要插入时，假定您已经在遍历列表的中间。

链接列表上的操作通常以这样一种方式完成，即它们并不真正被视为通用“列表”，而是作为节点的集合——将节点本身视为主循环的迭代器。因此，当您浏览列表时，您会注意到作为业务逻辑的一部分需要添加一个新节点（或删除一个旧节点）并且您这样做了。您可以在一次迭代中添加 50 个节点，每个节点只需 O(1) 时间即可断开两个相邻节点的链接并插入新节点。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-08T16:26:21.483

为了与该图表显示的数组进行比较，它是 O(1)，因为您不必将所有项目移动到新节点之后。

所以是的，他们假设您已经拥有指向该节点的指针，或者获取指针是微不足道的。换句话说，问题是：“*给定节点 X*，在该节点之后插入的代码是什么？” 您可以从插入点开始。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-05-08T16:28:58.843

插入链表与遍历链表不同。您不是在定位项目，而是在重置指针以将项目放在那里。无论是在前端附近还是接近尾端插入都没有关系，插入仍然涉及重新分配指针。当然，这取决于它是如何实现的，但这就是列表的优势——您可以轻松插入。通过索引访问是数组的亮点。然而，对于一个列表，通常需要 O(n) 才能找到第 n 个项目。至少那是我在学校里记得的。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-05-08T16:24:10.367

因为它不涉及任何循环。

插入就像：

*   插入元素
*   链接到上一个
*   链接到下一个
*   完毕

无论如何，这是恒定的时间。

因此，一个接一个地插入 n 个元素是 O(n)。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-05-08T16:24:31.927

一旦你知道你要把它放在哪里，插入就是 O(1)。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-05-08T16:25:10.240

> 这种分析是否没有考虑到节点操作的发现（尽管它是必需的）而只是插入本身？

你说对了。在给定点插入假定您已经持有指向要在之后插入的项目的指针：

```
InsertItem(item * newItem, item * afterItem) 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-05-08T16:25:31.800

不，它不考虑搜索。但是，如果您已经拥有指向列表中间项目的指针，则在该点插入是 O(1)。

如果你必须搜索它，你必须添加搜索时间，应该是 O(n)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-08T16:25:14.217

这篇文章是关于比较数组和列表的。查找数组和列表的插入位置都是 O(N)，因此本文忽略它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-08T16:25:23.483

O(1) 取决于您有一个项目，您将在其中插入新项目。（之前或之后）。如果你不这样做，那就是 O(n)，因为你必须找到那个项目。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-08T16:25:59.613

我认为这只是您选择计入 O() 表示法的一个例子。在插入正常操作的情况下进行计数是复制操作。对于数组，在中间插入涉及将位置上方的所有内容复制到内存中。使用链表，这变成了设置两个指针。无论插入什么，您都需要找到该位置。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-08T16:27:13.590

如果您有要在操作后插入的节点的引用，则对于链表来说是 O(1)。
对于一个数组，它仍然是 O(n)，因为您必须移动所有后续节点。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-05-08T16:28:32.150

最常见的情况可能是在列表的开头或结尾插入（并且列表的结尾可能很快就可以找到）。

相比之下，在数组的开头或结尾插入项目（如果数组位于末尾则需要调整数组的大小，或者如果数组位于开头则需要调整大小并移动所有元素）。

# web-services - WSDL 与 REST 的优缺点

> ID：840653
> 
> 赞同：113
> 
> 时间：2009-05-08T16:24:14.407
> 
> 标签：web-services, rest, wsdl

**有关的：**

> [为什么要使用 REST 而不是 Web 服务？](https://stackoverflow.com/questions/90451/why-would-one-use-rest-instead-of-web-services)

在决定是使用 SOAP 还是 REST（我指的是 RESTful 方式的 HTTP/XML）实现 Web 服务时，我应该注意什么以及应该考虑什么？我认为这不是一种适合所有东西的尺寸，所以我该如何选择使用哪一种。

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2009-05-08T16:35:47.547

这两种协议在现实世界中有非常不同的用途。

SOAP（使用 WSDL）是一个以文档传递为中心的重量级 XML 标准。这样做的好处是您的请求和响应可以非常结构化，甚至可以使用 DTD。缺点是它是 XML，而且非常冗长。但是，如果两方需要有严格的合同（比如银行间通信），这很好。SOAP 还允许您在文档上分层，例如 WS-Security。SOAP 通常与传输无关，这意味着您不一定需要使用 HTTP。

REST 非常轻量级，并且依赖于 HTTP 标准来完成它的工作。快速启动并运行有用的 Web 服务非常棒。如果您不需要严格的 API 定义，这就是要走的路。大多数网络服务都属于这一类。您可以对 API 进行版本化，以便 API 的更新不会对使用旧版本的人造成破坏（只要他们指定版本）。REST 本质上需要 HTTP，并且与格式无关（意味着您可以使用 XML、JSON、HTML 等）。

通常我使用 REST，因为我不需要花哨的 WS-* 功能。如果您希望计算机使用 WSDL 来理解您的 Web 服务，那么 SOAP 还是不错的。REST 规范通常只有人类可读。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-05-13T15:34:07.797

以下链接提供了有关 WSDL 与 REST 的有用信息，包括优点和缺点

有几个关键点是

1) SOAP 是为分布式计算环境设计的，而 REST 是为点对点环境设计的。

2) WADL 可用于定义 REST 服务的接口。

[http://www.ajaxonomy.com/2008/xml/web-services-part-1-soap-vs-rest](http://www.ajaxonomy.com/2008/xml/web-services-part-1-soap-vs-rest)
[http://ajaxonomy.com/2008/xml/web-services-part-2-wsdl-and -wadl](http://ajaxonomy.com/2008/xml/web-services-part-2-wsdl-and-wadl)

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-05-08T17:28:25.767

将 WSDL（意为“SOAP”）视为“重量级”。重物怎么办？如果工具集正在为您完成所有“繁重的工作”，那么它为什么重要？

我从来不需要使用复杂的 REST API。当我这样做时，我希望我会希望有一个 WSDL，我的工具会很乐意将其转换为一组代理类，因此我可以只调用看似方法的东西。相反，我怀疑为了使用非平凡的基于 REST 的 API，有必要手动编写大量的“轻量级”代码。

即使这一切都完成了，您仍然会将人类可读的文档翻译成代码，随之而来的风险就是人类读错了。由于 WSDL 是服务的机器可读描述，因此很难“读错”。

* * *

请注意：自从这篇文章以来，我*有*机会使用一个中等复杂的 REST 服务。事实上，我确实希望有一个 WSDL 或类似的东西，而且我确实不得不手动编写大量代码。事实上，大部分开发时间都花在了“手动”删除所有调用不同服务操作的代码的重复代码上。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-05-13T04:27:00.007

这可能真的属于上述几篇文章中的评论，但我还没有代表这样做，所以就这样吧。

我认为有趣的是，对于 SOAP 和 REST 经常引用的许多优点和缺点（IMO）与这两种技术的实际价值或限制几乎没有关系。REST 被引用最多的专业人士可能是它是“轻量级的”或者更倾向于“人类可读”。在某种程度上，这当然是正确的，REST 的进入门槛确实较低 - 所需的结构比 SOAP 少（尽管我同意那些说好的工具主要是这里的答案的人的观点 - 太多的 SOAP 工具太糟糕了相当可怕）。

然而，除了最初的入门成本之外，我认为 REST 印象来自请求 URL 的形式和大多数 REST 服务交换的数据的复杂性的组合。REST 倾向于鼓励更简单、更易读的请求 URL，并且数据也更易于消化。然而，这些在多大程度上是 REST 固有的，在多大程度上它们仅仅是偶然的。更简单的 URL 结构是该架构的直接结果——但它同样可以很好地应用于基于 SOAP 的服务。更易消化的数据更有可能是由于缺乏任何定义的结构造成的。这意味着您最好保持数据格式简单，否则您将需要做很多工作。所以这里 SOAP 的附加结构，

因此，对于用于计算机系统之间的结构化数据交换，我不确定 REST 本质上是否优于 SOAP（或反之亦然），它们只是不同而已。我认为上面的 REST 与 SOAP 与动态与静态类型的比较是一个很好的比较。动态语言往往会遇到麻烦的地方是系统的长期维护和保养（从长远来看，我说的不是一年或两年，而是五年或十年）。看看 REST 是否会随着时间的推移遇到同样的挑战将会很有趣。我倾向于认为，如果我正在构建一个分布式的信息处理系统，我会倾向于使用 SOAP 作为通信机制（也因为它提供的传输和应用程序协议分层以及上面提到的灵活性）。

在其他地方，虽然 REST 似乎更合适。客户端与其服务器之间的 AJAX（无论有效负载如何）就是一个主要示例。我不太关心这种连接的寿命，易用性和灵活性是最重要的。同样，如果我需要快速访问某些外部服务，并且我不认为我会关心交互的可维护性随着时间的推移（我再次假设这是 REST 最终会让我付出更多代价的地方，一种方式或其他），那么我可能会选择 REST，这样我就可以快速进出。

无论如何，它们都是可行的技术，并且取决于您想要为给定应用程序做出的权衡，它们可以为您提供良好（或较差）的服务。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-05-08T19:22:21.017

REST 不是协议；这是一种建筑风格。或者，如果您愿意，可以作为范例。这意味着 SOAP 的定义要宽松得多。对于基本的 CRUD，您可以依赖标准协议，例如 Atompub，但对于大多数服务，您将拥有更多的命令。

作为消费者，SOAP 可能是福也可能是祸，这取决于语言支持。由于 SOAP 在很大程度上是在严格类型系统上建模的，因此它最适用于静态类型语言。对于动态语言来说，它很容易变得粗俗和多余。此外，在 Java 和 .NET 的世界之外，客户端库支持并不是那么好

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-09-26T17:54:50.753

对我来说，当我们使用网络服务这个词时，我们应该小心。我们应该一直指定我们是在谈论 SOAP Web 服务、REST Web 服务还是其他类型的 Web 服务，因为我们在这里谈论的是不同的东西，如果我们将它们都命名为 Web 服务，人们就不再理解了。

基本上 SOAP Web 服务已经建立了多年，它们遵循严格的规范，描述如何基于 SOAP 规范与它们进行通信。现在 REST Web 服务有点新，基本上看起来更简单，因为它们不使用任何通信协议。基本上，您在使用 REST Web 服务时发送和接收的内容是纯 XML。人们喜欢它，因为他们可以按照自己想要的方式解析 xml，而不必处理更复杂的通信协议（如 SOAP）。

对我来说，REST 服务几乎就像您要创建一个 servlet 而不是 SOAP Web 服务。servlet 获取数据并返回数据。数据的格式是基于xml的。如果我们愿意，我们也可以想象使用 xml 以外的东西。例如，可以使用标签代替 xml，这将不再是 REST，而是其他东西（在重量方面可能更轻，因为 xml 本质上并不轻）。我们是否仍将其称为 Web 服务？是的，我们可以，但这不会遵循任何当前标准，如果我们开始调用所有 Web 服务，但我们可以按照我们想要的方式进行操作，那么这就是这里的主要问题，那么我们就会失去互操作性方面的东西。这意味着与 Web 服务交换的数据格式不再标准化。

人们不喜欢 SOAP 的地方在于他们很难理解它，而且他们无法手动生成查询。计算机可以很好地做到这一点，因此我们需要明确一点：Web 服务查询和响应是否应该由最终用户直接使用，或者我们是否同意 Web 服务位于由计算机系统基于某些规范化调用的 API 之下标准？

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-05-20T02:26:09.723

**SOAP**：它也可以通过 SMTP 传输，这意味着我们也可以使用电子邮件简单文本格式调用服务

它需要额外的框架/引擎应该在 Web 服务消费者机器中以将 SOAP 消息转换为各种语言的相应对象结构。

**REST** : 现在 WSDL2.0 也支持描述 REST Web 服务

当您想让您的服务变得轻量级时，我们可以使用，例如从手机、pda 等移动设备调用...

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-04-22T07:45:43.733

对于您的系统被限制在您的公司内的企业系统，使用肥皂更容易和适当，因为您几乎可以控制客户。它更容易，因为有多种工具可以创建类（代理），并且看起来您正在执行与您的 java 或 .net 环境（大多数公司使用的环境）相匹配的常规 OOP。

我会为面向互联网的应用程序使用 REST 来公开接口（如 twitter api），因为客户端可以使用 javascripts 或 html 或其他类型不严格的应用程序。REST 更自由更有意义。

同样对于面向互联网的客户端（万维网），它更容易解析来自 rest 接口的 json 或 xml，而不是来自 soap 接口的纯 xml。很难在 javascript 上使用代理，而且 javascript 自然不支持对象。如果您将 REST 与 javascript 一起使用，您通常只需解析 json 字符串就可以了。面向互联网的接口通常非常简单（所以大多数时候它的解析很简单）并且通常不需要一致性，这就是为什么 REST 就足够了。

对于企业应用程序，我认为 REST 是不够的，因为事务、安全性、严格类型、模式在企业应用程序开发中起着非常重要的作用，这就是 SOAP 更适合它们的原因。

我的结论是 SOAP 适用于企业系统，REST 适用于 Internet 或 WWW。您可以互换使用它，但您可能会发现自己最终无法使用正确的工具来完成工作。

对不起，我的英语不好。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-08T16:31:52.423

在为 REST 辩护时，它严格遵循 HTTP 和可寻址性原则，例如读取操作使用 GET，更新操作使用 POST 等。我发现这是一种更简洁的方法。Oreilly 的书 RESTful Web Services 比我更好地解释了这一点，如果您阅读它，我认为您更喜欢 REST 方法

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-08T16:28:57.827

客户端的工具集将是一个。另一个是对 SOAP 服务的熟悉。如今，越来越多的服务采用 RESTful 路线，并且可以通过简单的 cURL 示例来测试此类服务。虽然，实现这两种方法并允许客户最广泛地利用并不是那么困难。

如果您需要选择一个，我建议使用 REST，它更容易。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-11-15T19:43:51.933

以前的答案包含很多信息，但我认为有一个尚未指出的哲学差异。SOAP 是“我们如何创建一个现代的、面向对象的、独立于平台和协议的 RPC 继任者？”的答案。REST 从以下问题发展而来：“我们如何获取使 HTTP 在 Web 上如此成功的见解，并将它们用于分布式计算？”

SOAP 是关于为您提供使分布式编程看起来像……编程的工具。REST 试图强加一种风格来简化分布式接口，使分布式资源可以相互引用，就像分布式 html 页面可以相互引用一样。它的一种方法是尝试（主要）将操作限制为对资源的“CRUD”（创建、读取、更新、删除）。

REST 还很年轻——尽管它面向“人类可读”服务，但不排除自省服务等或自动创建代理。但是，这些还没有标准化（正如我所写的那样）。SOAP 为您提供了这些东西，但是（恕我直言）“只”给您这些东西，而 REST 强加的样式由于其简单性已经在鼓励 Web 服务的传播。我自己会鼓励新手服务提供商选择 REST，除非他们需要使用特定的 SOAP 提供的功能。

那么，在我看来，如果您正在实现一个“未开发的”API，并且对可能的客户端不太了解，我会选择 REST，因为它鼓励的风格往往有助于使接口易于理解，并且易于开发。如果您对客户端和服务器有很多了解，并且有特定的 SOAP 工具可以让两者的生活变得轻松，那么我不会对 REST 抱有信心。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-08T19:19:33.987

只需更改配置设置，您就可以轻松地将喷出 WSDL 的 WCF Web 组件转换为其他用途。您可以浏览 HTTP，然后还可以命名管道、tcp、自定义协议等，而无需更改代码。我相信 WCF 组件也可能更容易为安全、双向调用、事务、并发等设置。

REST 几乎将您限制为 HTTP（在许多情况下这很好）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-10-30T19:00:19.270

我知道这个讨论很老了，但是在阅读了所有的答案和评论之后，我相信每个人都错过了关于 2 个系统之间区别的最重要的一点：SOAP 使用复杂类型不仅给你数据，而且验证并将其保持在为其定义的严格类型指定中。WSDL 告诉您数据格式是什么，数据类型是什么，允许您添加 reg-ex 模式样式规则，并定义一条数据在请求/响应中必须和可能允许的次数. 另一方面，休息没有这些机制。

SOAP 既复杂又繁重，因为它允许您发送复杂繁重的分层数据。REST 是纯文本，由源和端点整理规则。

SOAP 是独立于业务的，因为它在文档中嵌入了所有数据规则。

SOAP 和 REST 之间的区别在于 SOAP 是一个自包含的面向业务的模式。REST 是一个文本文档。

# security - 限制IP地址应该在哪里处理？

> ID：840668
> 
> 赞同：1
> 
> 时间：2009-05-08T16:26:08.740
> 
> 标签：security, reverse-proxy

我们在应用层前面运行了一个反向代理，我想知道处理 IP 限制的“最佳实践”位置在哪里。

目前，我们使用应用程序安全性来限制通过 IP 地址对特定资源的访问，但是当我们转向在反向代理后面运行时，这会导致一些问题。在代理而不是应用程序上配置允许/拒绝规则非常容易，但是由于我们在代理后面运行多个应用程序，因此对配置进行修改有可能影响其他应用程序（不是很大的危险，但仍然存在） .

将过滤器放在更上层还是更靠近应用程序更好？

是否有任何陷阱，例如我们通过应用程序限制和添加反向代理遇到的所有请求“来自”代理，迫使我们使用标头来查找“真实”IP 地址。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T17:13:30.607

我们尽可能早地过滤并使其远离应用程序；这类事情可以通过网络运营更好地管理。原因是应用程序开发人员或维护人员在更改 IP 地址时并不总是参与其中，而网络操作人员通常是第一个知道的。此外，网络类型工具通常更擅长提供/限制对软件级工具的访问。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T17:21:32.257

我永远不会受到IP地址的限制。像这样的限制是安全层的工作，而不是 IP 地址所在的网络层的工作。我很少发现让应用程序限制网络实施的价值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T14:16:37.547

这取决于需要被 IP 限制的资源类型。如果应用程序的某些部分需要通过 IP 进行限制，那么应用程序应该处理它。如果需要阻止整个应用程序，那么您应该更进一步。

一般规则是在不损害您现有的任何审计系统的情况下尽早进行限制（了解人们何时试图破坏您的安全系统几乎总是一个好主意）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T17:24:38.100

我尽可能早地通过 IP 地址进行限制——这消除了后续层或子网中不必要的流量。所以我的建议与 u07ch 的建议类似，尽可能早地去做。

# linq - 静态方法与使用 Linq2Sql 的存储库模式

> ID：840671
> 
> 赞同：1
> 
> 时间：2009-05-08T16:26:14.667
> 
> 标签：linq, linq-to-sql, static-methods

我想到了在部分 Linq 查询上创建静态方法的想法，例如

```
public partial class User
{
    public static User FindByGuid(string guid, ApplicationDataContext context)
    {
        return context.Users.Where(x => x.GUID == guid).Single();
    }
} 
```

因此，例如，我可以通过以下方式轻松找到用户：

```
using (var context = new ApplicationDataContext())
{
    var user = DataAccess.User.FindByGuid(UsersDropDown.SelectedValue, context);
} 
```

这是公认的设计模式吗？与存储库模型相比，这样做的优点/缺点是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T20:42:39.837

虽然我在您在这里所做的事情中没有看到公认的模式，但我确实看到您通过将 applicationdatacontext 作为依赖项传递给方法来使用依赖注入。这里的问题是，无论从何处启动依赖项，您仍然与数据上下文紧密耦合，这使得单元测试变得更加困难。

# vb.net - Linq to object：ToList 无法转换为通用列表

> ID：840674
> 
> 赞同：1
> 
> 时间：2009-05-08T16:26:45.073
> 
> 标签：vb.net, linq

```
Dim tenItem = From t In _InvalidFeeList _
                      From i In ItemCount _
                      Where t.FeeCode <> i.FeeCode _
                      Order By t.Description _
                      Ascending Take (10)

        Dim feeList As List(Of AccessorialFee) = tenItem.ToList() 
```

我收到“无法转换为 System.generic.list”错误。我到处寻找这个错误，我的代码似乎应该[在这里工作](http://www.hookedonlinq.com/ToListOperator.ashx)

我不明白。有人能告诉我我哪里弄错了吗？

编辑：我想我应该解释一下我想在这里做什么。如果 FeeCode 不等于 ItemCount FeeCode 中的对象，我想比较两个对象列表并从 InvalidFeeList 中选择对象，并从 InvalidFeeList 中获取前 10 个对象。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T17:18:07.290

问题是你有两个“From”子句，所以结果不仅仅是原始集合的类型。不过很容易修复 - 只需在最后添加一个投影：

```
Dim tenItem = From t In _InvalidFeeList _
              From i In ItemCount _
              Where t.FeeCode <> i.FeeCode _
              Order By t.Description _
              Ascending Take (10) _
              Select t  ' This is the new line '

Dim feeList As List(Of AccessorialFee) = tenItem.ToList() 
```

编辑：您是否试图查找其中*任何*项目中`_InvalidFeeList`不`FeeCode`存在的项目？如果是这样，我建议进行此更改：*`ItemCount`*

 *```
Dim feeCodes = From i In ItemCount Select i.FeeCode
Dim feeCodeSet = new HashSet(Of FeeCodeType)(feeCodes)

Dim tenItem = From t in _InvalidFeeList
              Where Not feeCodeSet.Contains(t.FeeCode)
              Order By t.Description _
              Ascending Take (10) 
Dim feeList As List(Of AccessorialFee) = tenItem.ToList() 
```

如您所见，我不知道 的类型`FeeCode`，而 VB 并不是我的强项，但我希望您能大致了解。此建议假设您使用的是 LINQ to Objects - 如果您使用的是 LINQ to SQL，我不确定最好的方法。请注意，我们不再需要`Select`for 子句，`tenItem`因为我们现在只处理一个集合。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T16:31:49.910

_InvalidFeeList 不是 List(Of AccessorialFee) 类型

[编辑]试试这个并添加一个断点和一个手表：

```
Dim tenItem = (From t In _InvalidFeeList _
                      From i In ItemCount _
                      Where t.FeeCode <> i.FeeCode _
                      Order By t.Description _
                      Ascending Take (10)).ToList().GetType() 
```

# algorithm - 寻找生成真实行星的算法

> ID：840675
> 
> 赞同：8
> 
> 时间：2009-05-08T16:26:46.553
> 
> 标签：algorithm

我想收集算法列表和其他资源，以生成逼真且有趣的行星视觉效果。视觉效果应该看起来像您希望在 NASA 主页上找到的东西。关键属性是：

*   气态巨星的多彩氛围
*   戒指（可选）
*   没有大气层的固体岩石的撞击坑
*   宜居行星可能具有海洋、山脉、河流、森林等特征
*   可居住者甚至可以对地表文明有一个现实的分布

最终目标应该是为科幻（SciFi）作家提供一个工具来生成一个世界，帮助他们激发想法，为场景创建位置，或者作为为他们的书籍渲染漂亮图像的基础。

注意：这是一个 wiki，所以没有单一的“正确”答案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T16:31:24.110

[分形地形生](http://en.wikipedia.org/wiki/Fractal_landscape)成为创建逼真的景观创造了奇迹。我想你可以扩大这些过程的规模，以便在植物规模上产生陆地。[该站点](http://gameprogrammer.com/fractal.html)详细描述了用于景观的过程。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T05:57:34.843

查看 conworlding 链接。实际上有商业软件（想到 ProFantasy），但如果你想从头开始做某事，我有一个你可能感兴趣的链接：

[魔法世界建造者](http://www.web-writer.net/fantasy/)

最后，Guy Lecky-Thompson 写了一些关于在游戏设计中使用程序内容的有趣书籍。我有他的两本书，它们非常鼓舞人心。列出了许多算法，包括一些 RNG 实现、名称生成器（提示：选择名称部分的列表，然后每个名称应该有多少部分，然后随机化），关于地形和景观生成的两个完整章节，一个地牢章节.. .

哦！说到地下城，不知道你是否听说过 Roguelikes，但我最近一直在研究这些。我想他们在地牢中使用的许多相同的一般原则都可以应用——此外，他们还共享一些荒野算法。尝试：

[Temple of The Roguelike](http://www.templeoftheroguelike.com) - 可能是最大的 Roguelike 开发者论坛

[Wilderness Generation using Vornoi Diagrams](http://roguelikedeveloper.blogspot.com/2007/07/wilderness-generation-using-voronoi.html) - 这个博客由 Unangband 的开发人员运行，Unangband 是一种非常流行的 Rogue 变体。Roguelike 开发社区中的许多人共享资源。

[马尔可夫链](http://pcg.wikidot.com/pcg-algorithm:markov-chain)- 这篇文章是关于如何使用马尔可夫链将随机名称放在一起。托管它的 wiki 有很多算法，任何生成任何类型的程序内容的人都会感兴趣。

[Roguebasin](http://roguebasin.roguelikedevelopment.org/index.php?title=Main_Page) - many useful aglorithms and code examples here.

Have fun !

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-22T14:17:53.800

If you want high-level descriptions of a very mature procedural planet renderer, [Infinity](http://www.infinity-universe.com/Infinity/) is perhaps the most venerable. The development blog covers many of the concepts used to create some very nice procedural planets and some other very nice space phenomena.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T16:47:22.137

我不是天文学家，但您可能会考虑使用某种决策树来对行星进行初步分类：

1.  主要成分（甲烷/岩石/等）
2.  大量的
3.  额外的气氛（多少，什么等）
4.  温度（或者，指定与恒星的距离，对恒星建模并基于上述编写算法）
5.  年龄
6.  小行星/流星活动

像陨石坑这样的东西将由 1、3 和 6 间接确定。半径可以从 1 和 2 计算。列表中较高的元素可能会在较低的元素上设置边界。

您仍然有许多算法需要研究，但也许有一个信息顺序可能会构建您的计算或您使用的变量。

# batch-file - 如何从批处理文件中获取驱动器列表？

> ID：840677
> 
> 赞同：2
> 
> 时间：2009-05-08T16:27:07.740
> 
> 标签：batch-file, windows-server-2003, drive-mapping

我正在尝试获取所有映射驱动器的列表以进行系统升级，并希望通过批处理文件获取此信息。我怎样才能做到这一点？

对于奖励积分：如何在新服务器上编写这些驱动器的映射脚本？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T17:11:55.917

当前映射列表将由

```
net use 
```

传输将像这样进行（为了其中的乐趣¹，让我们在批处理脚本而不是 VBScript 中执行此操作）：

```
@echo off

setlocal EnableDelayedExpansion

set letter=.
set uncpath=.
set colon=.

for /f "delims=" %%l in ('net use') do @(
  for /f "tokens=2" %%t in ("%%l") do @set letter=%%t
  for /f "tokens=3" %%t in ("%%l") do @set uncpath=%%t

  set colon=!letter:~1,1!

  if "!colon!" EQU ":" (
    echo if exist !letter! net use !letter! /delete
    echo net use !letter! !uncpath! /persistent:yes
  )
)

endlocal 
```

输出是这样的：

```
if exist M: net use M: /delete
net use M: \\someserver\someshare /persistent:yes
if exist N: net use N: /delete
net use N: \\otherserver\othershare /persistent:yes 
```

只需将其存储在批处理文件中即可。

* * *

¹实际上，“有趣”在这里并不合适。;-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T17:10:54.857

列出映射的驱动器

```
Net Use 
```

映射新驱动器

```
Net Use G: \\Server\Path 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T17:04:34.140

您可以使用 vbscript 执行此操作

```
Set objFSO = CreateObject("Scripting.FileSystemObject")
Set colDrives = objFSO.Drives

For Each objDrive in colDrives
    Wscript.Echo "Drive letter: " & objDrive.DriveLetter
Next 
```

你可以映射网络驱动器

```
Set objNetwork = CreateObject("WScript.Network") 
objNetwork.MapNetworkDrive "G:", "\\Server\Path" 
```

# oracle - 如何使用 Oracle 瘦 JDBC 驱动程序在会话中设置应用程序信息？

> ID：840679
> 
> 赞同：1
> 
> 时间：2009-05-08T16:27:50.577
> 
> 标签：oracle, session, jdbc, inspection

我想更改使用 Oracle Enterprise Manager 应用程序检查 Oracle 10g 会话时显示的应用程序信息：

```
Application Information  
  Program       'my program'  
  Module        'something'  
  Command       UNKNOWN 
```

我正在使用 JDBC 瘦驱动程序进行连接，我不得不承认，如果可能的话，我宁愿不使用 OCI 驱动程序。我可以用瘦驱动程序做到这一点，如果可以，怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T20:55:45.127

DBMS_APPLICATION_INFO 应该注意这一点：

[http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14258/d_appinf.htm](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14258/d_appinf.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T18:29:34.980

使用 DBMS_APPLICATION_INFO 包中的适当方法（.SET_ACTION、.SET_CLIENT_INFO、.SET_MODULE

# javascript - jQuery快速搜索使用onAfter函数调用突出显示结果？

> ID：840688
> 
> 赞同：1
> 
> 时间：2009-05-08T16:29:19.997
> 
> 标签：javascript, jquery, search, autocomplete

我昨天很快就得到了一个关于[我需要的最佳自动完成选项的惊人答案。](https://stackoverflow.com/questions/837958/autocomplete-search-multiple-parts-of-string-then-returns-the-most-likely-ones)

我想我可以使用[QuickSearch 中的 onAfter 函数调用](http://rikrikrik.com/jquery/quicksearch/#options)来调用[SearchHighlight 插件来突出显示我正在输入的文本。](http://www.jquery.info/The-plugin-SearchHighlight)

这可行吗？我很难让它工作。

```
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
        <title>rikrikrik - quickSearch jQuery plug-in - List items</title>
        <script src="jquery.js" type="text/javascript" charset="utf-8"></script>
        <script src="jquery.quicksearch.js" type="text/javascript" charset="utf-8"></script>
        <script src='jquery.SearchHighlight.js'></script>
        <script type="text/javascript" charset="utf-8">
            $(document).ready(function () {             
                $('ul#a li').quicksearch({
                    attached: 'ul:first',
                    position: 'before',
                    labelText: 'Search all countries beginning with A',
                    inputText: 'Search',
                    loaderImg: 'loader.gif',
                    loaderText: 'Searching...'
                    onAfter: ('ul#a li').SearchHighlight(partial) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T17:05:52.857

看起来该插件旨在处理从引荐来源网址解析关键字的正则表达式。我没有看到您更改 SearchHighlight 插件的选项，因此您正在使用其默认配置。这意味着它不知道您的搜索文本框，也不知道如何从中提取关键字。不过，看起来您可以使用 keys 选项将其重新配置为使用特定关键字。

因此，您需要将对 SearchHighlight 的调用更改为如下所示：

```
 $(document).ready(function() {
        $('ul#a li').quicksearch({
        attached: 'ul:first',
        position: 'before',                                
        labelText: 'Search all countries beginning with A',                                
        inputText: 'Search',                                
        loaderImg: 'loader.gif',                                
        loaderText: 'Searching...',
        onAfter: function() { $('ul#a li').SearchHighlight({ exact: "partial", keys: $('.qs_input').val() });
    }); 
```

其中 SEARCH_BOX 是您的文本框的 ID。

**编辑**：哈！我的语法很差。对于那个很抱歉。上面的代码应该适合你。此外，这可能不是那么好，因为当您更改搜索字符串时，无法重置突出显示。

# c# - 你将如何重构这个臭代码？（记录、复制和粘贴，.Net 3.5）

> ID：840689
> 
> 赞同：11
> 
> 时间：2009-05-08T16:29:27.593
> 
> 标签：c#, .net, .net-3.5, refactoring

我有这样的代码：

```
Logger logger = new Logger();
System.Diagnostics.Stopwatch stopWatch = new System.Diagnostics.Stopwatch();
logger.LogInformation("Calling SomeObject.SomeMethod at " + DateTime.Now.ToString());
stopWatch.Start();
// This is the method I'm interested in.
SomeResponse response = someObject.SomeMethod(someParam);
stopWatch.Stop();
logger.LogInformation("SomeObject.SomeMethod returned at " + DateTime.Now.ToString());
logger.LogInformation("SomeObject.SomeMethod took " + stopWatch.ElapsedMilliseconds + " milliseconds."); 
```

我需要围绕更多对象及其方法包装类似的代码来进行一些性能分析。我不允许使用 3rd 方插件或软件等。

我真的不想围绕所有这些方法编写相同的代码来调用所有这些日志记录代码。您将如何重构它以消除我的一些编码工作？

如果我不是很清楚，请在评论中提出问题，我会尽力澄清。

谢谢你的帮助！！

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-08T16:38:34.810

您可以重构代码以接受方法指针实例（又名[System.Action](http://msdn.microsoft.com/en-us/library/system.action.aspx)）。

```
public void CallWithLogTiming (Action theAction)
{
  Logger logger = new Logger();
  System.Diagnostics.Stopwatch stopWatch = new System.Diagnostics.Stopwatch();
  logger.LogInformation("Calling SomeObject.SomeMethod at " + DateTime.Now.ToString());
  stopWatch.Start();

// This is the method I'm interested in.
  theAction();

  stopWatch.Stop();
  logger.LogInformation("SomeObject.SomeMethod returned at " + DateTime.Now.ToString());
  logger.LogInformation("SomeObject.SomeMethod took " + stopWatch.ElapsedMilliseconds + " milliseconds.");
} 
```

然后你可以通过创建一个 lambda 表达式来调用它。由于 myResponse 是一个捕获的变量，因此将在运行此 Action 时填充它，并且 myResponse 稍后将在此范围内可用。

```
SomeResponse myResponse = null;
CallWithLogTiming( () => myResponse = someObject.SomeMethod(someParam) ); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-08T16:37:50.397

为简单起见，您可以使用泛型，就像这样（在我的脑海中）：

```
public T MyLogMethod<T,S>(Func<S, T> someFunction, S someParameter) {} 
```

Func(S,T) 其中 S 是方法的参数类型，T 是返回类型。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-08T16:39:49.393

我想我实现了一个可以像这样使用的计时器类：

```
void test()
{
  foo();
  //timer for the following statements
  using (new MyTimer("Some method"))
  {
    bar();
  }
  baz();
} 
```

MyTimer 类实现如下：

*   包含一个秒表实例和一个标识计时器的消息字符串
*   构造函数启动秒表并记住消息字符串
*   Dispose 方法停止秒表，并记录消息字符串和经过的时间

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T16:36:24.270

绝对是 AOP 的候选人。我们使用 PostSharp 来处理这类事情。[http://www.postsharp.org/](http://www.postsharp.org/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-08T16:42:40.463

总有[PostSharp](http://www.postsharp.org/)库可以让您编写面向方面的代码。它允许您将日志记录和秒表作为属性进行，这很酷。它将作为后编译步骤在您的方法中注入前代码和后代码。

此外，您可能会考虑使用一些像这样的计时器/记录器静态方法来包装您想要计时/记录的代码：

```
Timer.LogExecutionTime("SomeObject.SomeMethod", () =>
{
    Logger.LogBeforeAndAfter("SomeObject.SomeMethod", () =>
    {
        SomeResponse response = someObject.SomeMethod(someParam);
    }
}); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-08T16:51:12.673

您可以使用 Logger 上的一些简单扩展方法使语法更简洁，这不需要额外的程序集，然后您已经拥有并且您可以立即将其插入。如果您要在整个代码中多次执行此操作，它是可重用的。

```
public static class LoggerExtentions
{
    public static void StartTimerLogInformation(this Logger logger, Stopwatch stopWatch, string method)
    {
        stopWatch.Reset();
        stopWatch.Start();
        logger.LogInformation(string.Format("Calling {0} at {1}", method, DateTime.Now.ToString()));
    }        

    public static void StopTimerLogInformation(this Logger logger, Stopwatch stopWatch, string method)
    {
        stopWatch.Stop();
        logger.LogInformation(string.Format("{0} returned at {1}", method, DateTime.Now.ToString()));
        logger.LogInformation(string.Format("{0} took {1} milliseconds", method, stopWatch.ElapsedMilliseconds));
        stopWatch.Reset();
    }
} 
```

那么您可以使用此代码替换原始帖子中的代码

```
Logger logger = new Logger();
Stopwatch stopWatch = new Stopwatch();
logger.StartTimerLogInformation(stopWatch, "SomeObject.SomeMethod");
SomeResponse response = someObject.SomeMethod(someParam);
logger.StopTimerLogInformation(stopWatch, "SomeObject.SomeMethod"); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-08T16:39:58.707

如果您编写这样的类（我正在使用 Java；可能有些东西不能准确翻译）：

```
public class myProfiler {
    final String method;
    final Logger logger = new Logger();
    final System.Diagnostics.Stopwatch stopWatch = new Stopwatch();
    public myProfiler(method) {this.method = method};
    public void Start() {
        logger.LogInformation("Calling " + method + " at " + DateTime.Now.ToString());
        stopWatch.Start();      
    }
    public void Stop() {
        stopWatch.Stop();
        logger.LogInformation(method + " returned at " + DateTime.Now.ToString());
        logger.LogInformation(method + " took " + stopWatch.ElapsedMilliseconds + " milliseconds.");
    }
} 
```

然后，您将每种方法中所需的代码减少为

```
myProfiler profiler = new myProfiler("SomeObject.SomeMethod");
profiler.Start();
...
profiler.Stop(); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-08T16:58:54.993

您如何继承所有对象的计时器类？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-02-18T11:01:51.613

在这些情况下，我喜欢做的是使用 Disposable 模式来实现我的计时器；如果出现错误，您将得到保证正确的清理和日志记录：

```
 public class Timer : IDisposable
    {
        Logger logger = new Logger();
        Stopwatch stopWatch = new Stopwatch();

        public Timer()
        {
            calledFunc = CalledFunc;
            logger.LogInformation("Calling SomeObject.SomeMethod at " +
                DateTime.Now.ToString());
            stopWatch.Start();
        }

        // Dispose() calls Dispose(true)
        public void Dispose()
        {
            Dispose(true);
            GC.SuppressFinalize(this);
        }
        // NOTE: Leave out the finalizer altogether if this class doesn't 
        // own unmanaged resources itself, but leave the other methods
        // exactly as they are. 
        ~Timer()
        {
            // Finalizer calls Dispose(false)
            Dispose(false);
        }
        // The bulk of the clean-up code is implemented in Dispose(bool)
        protected virtual void Dispose(bool disposing)
        {
            if (disposing)
            {
                // free managed resources
                stopWatch.Stop();
                logger.LogInformation("SomeObject.SomeMethod returned at " +
                    DateTime.Now.ToString());
                logger.LogInformation("SomeObject.SomeMethod took " +
                    stopWatch.ElapsedMilliseconds + " milliseconds.");
            }
            // free native resources if there are any.
        }
    } 
```

然后你像这样使用计时器：

```
using (var t = new Timer())
{
   // your code
} 
```

* * *

当然，您可以将参数传递给计时器（方法名称、记录器等），以便自定义设置和处置中发生的事情

# ruby-on-rails - Ruby on Rails 正则表达式

> ID：840690
> 
> 赞同：2
> 
> 时间：2009-05-08T16:29:36.517
> 
> 标签：ruby-on-rails, ruby

我在模型中有这些陈述：

```
before_save :add_http

protected
def add_http
  if (/^http\:\/\/.+$/.match(url)) == nil
    str = "http://" + url
    url = str
  end
end 
```

我已经检查了控制台中的正则表达式，它似乎是正确的，但是当“url”被保存到数据库时，“http://”还没有被添加。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T16:51:00.943

没关系，明白了...

```
protected
def add_http
  if (/^http\:\/\/.+$/.match(url)) == nil
    str = "http://" + url
    self.url = str
  end
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-09T06:40:52.833

不确定这对您是否重要，但您的正则表达式不适用于 https URL。这应该可以工作：

```
def add_http
  self.url += "http://" if self.url.match(/^https?\:\/\/.+$/).nil?
end 
```

# c# - VB.NET WithEvents 关键字行为 - VB.NET 编译器限制？

> ID：840691
> 
> 赞同：15
> 
> 时间：2009-05-08T16:30:32.973
> 
> 标签：c#, .net, vb.net, clr, vb.net-to-c#

我正在努力熟悉 C#，就像我熟悉 VB.NET（我工作场所使用的语言）一样。关于学习过程的最好的事情之一是，通过学习另一种语言，你往往会更多地了解你的主要语言——像这样的小问题会弹出：

根据我发现的来源和过去的经验，VB.NET 中声明为*WithEvents*的字段能够引发事件。我知道 C# 没有直接的等价物——但我的问题是：在 VB.NET 中*没有*这个关键字的字段不能引发事件，有没有办法在 C# 中创建同样的行为？VB 编译器是否只是阻止这些对象处理它们的事件（同时实际上允许它们像往常一样引发事件）？

我只是好奇; 我对这个问题没有任何特别的应用......

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-08T16:34:45.880

省略 WithEvents 不会阻止成员引发事件。它只是阻止您在他们的事件中使用“句柄”关键字。

这是 WithEvents 的典型用法：

```
Class C1
    Public WithEvents ev As New EventThrower()
    Public Sub catcher() Handles ev.event
        Debug.print("Event")
    End Sub
End Class 
```

这是一个不使用 WithEvents 并且大致等效的类。它说明了为什么 WithEvents 非常有用：

```
Class C2
    Private _ev As EventThrower
    Public Property ev() As EventThrower

        Get
            Return _ev
        End Get

        Set(ByVal value As EventThrower)
            If _ev IsNot Nothing Then
                    removehandler _ev.event, addressof catcher
            End If
            _ev = value
            If _ev IsNot Nothing Then
                    addhandler _ev.event, addressof catcher
            End If
        End Set
    End Property

    Public Sub New()
        ev = New EventThrower()
    End Sub

    Public Sub catcher()
        Debug.print("Event")
    End Sub
End Class 
```

# jndi - 我需要做什么才能将 JTA 集成到 Java SE 应用程序中？

> ID：840694
> 
> 赞同：4
> 
> 时间：2009-05-08T16:31:39.333
> 
> 标签：jndi, jta, java

假设我想实现一个应用程序容器。不是一个完整的 Java EE 堆栈，但我需要提供对 JDBC 资源和事务的访问，以访问将部署在我正在编写的应用程序中的第三方代码。

进一步假设，我正在查看 JBossTS 的事务。我还没有确定它，但据我所知，它似乎最适合我需要做的事情。

如何将*提供*连接资源和 JTA 事务的支持集成到我的 Java SE 应用程序中？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-09T09:10:12.990

> 如何将提供连接资源和 JTA 事务的支持集成到我的 J2SE 应用程序中？

嗨克里斯

这个问题有两个要素：

1) 使 JTA API，主要是 UserTransaction，可用于应用程序代码，因此它可以启动和结束事务。在 Java EE 环境中，它被发布到 JNDI 中一个众所周知的位置。如果你有一个 JNDI 实现，那就是要走的路（使用 JBossTS 的 JNDIManager 类来帮助你进行设置）。否则，您需要某种工厂对象或注入机制。当然，您也可以将实现类直接公开给最终用户，但这有点讨厌，因为它限制了将来更换 JTA 的任何机会。

```
public javax.transaction.UserTransaction getUserTransaction() {
  return new com.arjuna.ats.internal.jta.transaction.UserTransactionImple();
} 
```

就是这样——您现在可以开始、提交和回滚事务了。一些容器也以类似的方式将 TransactionManager 类发布到应用程序，但它实际上是为容器本身使用而设计的，应用程序代码很少需要它。

2) 自动管理 XAResources 的登记。资源管理器，即数据库和消息队列，具有实现 XAResource 的驱动程序。每次应用程序连接到资源管理器时，都需要将相应的 XAResource 移交给 JTA 实现，以便它可以驱动资源管理器作为 2PC 的一部分。大多数应用程序服务器都带有自动处理此问题的 JCA。在没有它的环境中，您需要一些替代方法来使应用程序代码免于手动执行这项繁琐的任务。与 JBossTS 捆绑的 TransactionalDriver 为 JDBC 连接处理这个问题。XAPool 也可能值得考虑。

多年来，JBossTS 已嵌入到许多环境中。一些经验教训记录在集成指南[http://anonsvn.jboss.org/repos/labs/labs/jbosstm/trunk/atsintegration/docs/](http://anonsvn.jboss.org/repos/labs/labs/jbosstm/trunk/atsintegration/docs/) ] 如果你想要一个可行的例子，你可以看看 tomcat 集成工作[http://anonsvn.jboss.org/repos/labs/labs/jbosstm/workspace/jhalliday/tomcat-integration/](http://anonsvn.jboss.org/repos/labs/labs/jbosstm/workspace/jhalliday/tomcat-integration/) ]

> JBoss 的 TM 太可怕了。至少，如果您希望进行 ACID 事务。

嗨埃里克森

我不认为我会走到“可怕”的地步。它非常强大且高度可配置，这可能会让新手感到有些畏惧。正确的恢复配置特别棘手，因此我完全赞同您关于严格测试的评论。除此之外，我不知道有任何记录在案的测试用例在与符合规范的资源管理器一起使用时当前无法提供 ACID 结果。如果您有这样的案例，或者只是更有建设性的改进建议，请让 JBoss 知道，以便解决问题。

> 不要重新发明轮子。使用 Spring 框架。它已经提供了这个功能等等。

-1 Spring 不提供 JTA 实现，只是各种 3rd 方的包装器。这是一个常见的误解。

> JTA 支持本地事务和全局事务。

恐怕又是一个误解。JTA 规范只处理 XA 即全局事务。存在各种众所周知的技术来使 JTA 事务管理器驱动本地事务。这些通常涉及将连接包装在 XAResource 中。虽然大多数实现都支持这一点，但它实际上超出了规范的范围，因此如果您需要这种行为，您必须在选择 JTA 实现之前与供应商核实。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-30T15:12:47.680

试试[Atomikos TransactionsEssentials](http://www.atomikos.com/Main/TransactionsEssentials)。

与竞争的开源 JTA/XA 实现不同，这个实现是从一开始就为 JSE 编写的。因此，它提供了高级 JDBC 和 JMS 池以及 JTA/XA 功能，您会发现它很容易集成到您的应用程序中。

最好的家伙

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T16:38:20.457

不要重新发明轮子。使用[Spring 框架](http://www.springsource.org/about)。它已经提供了这个功能等等。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T17:02:44.173

您可以使用 Spring，就像我不那么热衷一样。

你可能想要的一个例子是[here](http://www.time4tea.net/wiki/display/MAIN/Proper+XA+Transactions+With+Oracle+and+Spring)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-08T18:39:52.663

JTA 支持**本地事务**和**全局事务**。

本地事务可以通过 Spring、JPA 甚至手动提交连接轻松处理。

全局事务**需要**事务协调器。这是一个单独的产品/库，在开源中不容易获得（或者至少我不知道）。

因此，如果我查看您帖子的标题（“JTA”），答案是**NO SIMPLE WAY**。

如果我阅读您的帖子本身（“提供对 JDBC 资源和事务的访问”），我会说**Spring、JPA 和 Hibernate 都可以满足您的需求**（据我了解）。

PS**更正**：​​JTA*并不*真正支持本地事务（正如人们指出的那样），但是当您只需要单个连接时，即使由 JTA 控制，也基本上是本地事务，尤其是当事务管理器位于相同的 JVM（因为它经常发生）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-05-18T21:52:30.927

“JBoss 的 TM 太可怕了。至少，如果您希望进行 ACID 事务。人们可以说的最好的一点是，只要它不必应对任何故障，它就可能不会搞砸。而且它不是单独......大多数事务管理器（甚至一些商业管理器）真的不起作用。”

不确定您为做出上述声明做了哪些功课，但 JBossTS（自 2006 年以来 JBoss 中的 TM，当它被收购时）确实提供了完整的 ACID 语义。它最初也是 HP NetAction 套件的一部分，与其他任何开源 TM 相比，它被部署在更多的关键任务应用程序中。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-30T18:27:26.237

我选择使用 Bitronix 事务管理器来解决这个问题，尽管显然至少还有一个当时对我来说并不明显的其他选项（Atomikos）。

解决这个问题最终还需要我使用 Tomcat 进程内 JNDI 提供程序，以便将事务与 JNDI 名称相关联。由于该提供程序的限制，我无法使用 JTA UserTransaction 的默认名称，这在文档中并没有立即显现出来。

无论如何，感谢所有人的有用答案！

# configuration - Castle Windsor AllTypes 中类型的有序解析

> ID：840698
> 
> 赞同：1
> 
> 时间：2009-05-08T16:32:00.613
> 
> 标签：configuration, dependency-injection, castle-windsor

我有一组为我的应用程序启动活动实现接口的类。这是注册码：

```
private static void ConfigureContainer()
{
    var container = new WindsorContainer();

    container.Register(AllTypes.Of<IStartupTask>()
             .FromAssembly(Assembly.GetExecutingAssembly()))
    ...

    var serviceLocator = container.Resolve<IServiceLocator>();
    ServiceLocator.SetLocatorProvider(() => serviceLocator);
} 
```

为了获得任务，我使用它并且它按预期工作：

```
public static void Run()
{
    var tasks = ServiceLocator.Current.GetAllInstances<IStartupTask>();

    foreach (var task in tasks)
    {
       task.Execute();
    }
} 
```

这是我的问题：我有一个任务取决于另一个任务首先运行。有一个`InitializeDatabase`任务需要在`PopulateDatabse`任务之前运行。还有一堆其他任务正在运行`InitializeDatabase`，如果有一些 Castle 配置允许我订购类型的分辨率，我宁愿不将任务拆分出来。我不想指定正在解析的类型的完整顺序，因为这违背了自动注册的目的，只是`InitializeDatabase`第一个或`PopulateDatabase`最后一个。

有没有办法注册哪些类型应该首先解析而不指定所有类型的顺序？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-09T01:53:46.923

这是一种方法，它可能不是很漂亮，但它有效：

```
[AttributeUsage(AttributeTargets.Class)]
public class FirstAttribute: Attribute {}
public interface IService {}
public class ThirdService : IService { }
[First]
public class FirstService : IService { }
public class SecondService: IService {}

[Test]
public void WindsorOrder() {
    var container = new WindsorContainer();

    container.Register(AllTypes.Of<IService>()
        .FromAssembly(Assembly.GetExecutingAssembly()));

    var intf = container.ResolveAll<IService>()
        .OrderByDescending(i => i.GetType().GetCustomAttributes(typeof(FirstAttribute), true).Length)
        .ToArray();
    Assert.IsInstanceOfType(typeof(FirstService), intf[0]);
} 
```

如果您从 中删除`[First]`，`FirstService`则第一个将是`ThirdService`并且测试将失败。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T11:37:29.360

为此使用 HandlerSelector

# biztalk - BizTalk BRE InvalidCastException

> ID：840699
> 
> 赞同：1
> 
> 时间：2009-05-08T16:32:04.217
> 
> 标签：biztalk, biztalk-rule-engine

我已将新 VM（运行 Windows Server 2003 的 MS 虚拟服务器）配置为托管 BizTalk Server 2006 的现有 VM 的副本。我遇到了 BRE 处理问题。策略的部署和词汇表的发布与工作虚拟机上的完全一样。

一个编排调用一个辅助组件，该组件又使用 BRE 组件。辅助组件中似乎执行的最后一行是：

```
Policy workflowPolicy = new Policy(policyName) 
```

我从下面的事件日志中粘贴了堆栈跟踪：

```
Exception type: InvalidCastException
Source: Microsoft.RuleEngine
Target Site: Int32 GetInt32(System.String, Int32)
The following is a stack trace that identifies the location where the exception occured
   at Microsoft.RuleEngine.Configuration.GetInt32(String key, Int32 defaultValue)
   at Microsoft.RuleEngine.ReteTranslator.RuleSetToReteTranslatorImpl.Translate(RuleSet ruleset, Int32 duration)
   at Microsoft.RuleEngine.ReteTranslator.RuleSetToReteTranslator.Translate(RuleSet ruleset, Int32 duration)
   at Microsoft.RuleEngine.RuleEngine..ctor(RuleSet ruleSet, Boolean doOptimizations)
   at Microsoft.RuleEngine.RuleEngineCache.Allocate(String rulesetName, Int32 majorRevision, Int32 minorRevision, TrackingConfiguration& trackingConfig)
   at Microsoft.RuleEngine.RuleEngineCache.Allocate(String rulesetName, TrackingConfiguration& trackingConfig)
   at Microsoft.RuleEngine.Policy..ctor(String policyName)
   at Tesco.BRE.Services.PolicyServices.Direct.OrderWorkflowServices.Commands.GetNextTaskList.Execute()
   at Tesco.DataSources.Integration.Common.CommandBase.CommandDecorators.CommandLoggingDecorator`1.Execute()
   at Tesco.DataSources.Integration.Common.CommandBase.CommandUtilities.GetCommandResponse[T](CommandBase`1 command)
   at Tesco.BRE.Services.PolicyServices.Direct.OrderWorkflowServices.OrderWorkflowOperations.GetNextTaskList(String currentTaskName, String currentTaskStatus, XmlDocument order)
   at Tesco.Direct.OrderManagement.Orchestrations.FollowTaskResult.segment2(StopConditions stopOn)
   at Microsoft.XLANGs.Core.SegmentScheduler.RunASegment(Segment s, StopConditions stopCond, Exception& 
```

看起来 Microsoft.RuleEngine.Configuration.GetInt32 正在传递一个无法转换为 Int32 的值？

我试过取消配置/重新配置 BRE。据我所知，新服务器上的所有内容都完全按照工作服务器进行配置。

任何帮助，感激地接受 - 我整天都被这个困扰！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T21:48:20.960

如果遵循堆栈跟踪，则可以读取“缓存”和“跟踪”。我会尝试重新启动主机并取消选中 HAT 中的任何规则跟踪。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-09T19:27:56.513

感谢您的回复马丁。我现在已经解决了这个问题。问题是进行注册表更改时的用户错误（我的）。我必须按如下方式创建一个 reg 设置

```
HKLM\SOFTWARE\Microsoft\BusinessRules\3.0\StaticSupport (DWORD), value 2 
```

为了使 BRE 能够使用静态方法。这在以下位置进行了描述：[http ://technet.microsoft.com/en-us/library/dd298814.aspx](http://technet.microsoft.com/en-us/library/dd298814.aspx)

尽管我在配置服务器时进行了添加，但我无意中使用了字符串而不是 dword。因为这花了我一天多的时间才弄清楚——我不会很快犯同样的错误！

# c# - 工厂模式：枚举还是类型？

> ID：840700
> 
> 赞同：7
> 
> 时间：2009-05-08T16:32:31.487
> 
> 标签：c#, design-patterns

在实现工厂或简单工厂时，使用 Type 而不是 Enum 来指定要实例化的类会反对什么？

例如

```
public class SimpleFactory
{
 public static ITest Create(Type type)
 {
  if (type == typeof(ConcreteTest1))
   return new ConcreteTest1();
  if (type == typeof(ConcreteTest2))
   return new ConcreteTest2();

  throw new Exception("Invalid type");
 }
} 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-08T16:40:35.210

使用枚举更具限制性，这意味着用户不太可能尝试将您的工厂与不受支持的类型一起使用。

我发现在定义 API 以阻止会导致抛出异常的使用模式时尽一切可能是件好事。在这种情况下允许“类型”打开了数百万种调用函数的方法，这将导致：

```
throw new Exception("Invalid type"); 
```

使用枚举可以消除这种情况。枚举抛出的唯一方法是如果用户做了明显错误的事情。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-08T17:16:38.133

工厂仅在它们对您的对象执行配置或初始化以使它们处于有效状态时才有用。如果工厂所做的只是新建并返回对象，我不会打扰它。

我会为每个类层次结构创建一个工厂。例如：

```
public abstract class Vehicle {}
public class Car : Vehicle {}
public class Truck : Vehicle {}

public class VehicleFactory
{
    public Vehicle CreateVehicle<T>() where T : Vehicle
    {
        // Get type of T and delegate creation to private methods
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T16:46:46.380

如果您想要一个万无一失的工厂，您必须为每种具体类型创建一个具体工厂。这个类不遵循开闭原则：每次你得到一个新的具体类型，你都必须重新编辑这个类。

恕我直言，更好的方法是使用继承，每个具体类型都有一个具体的工厂类。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T16:49:20.650

我更喜欢使用通用约束，因为有一个枚举只是为了指定你想要的对象类型对我来说似乎是多余的，并且使用你描述的类型你违反了开放/封闭原则。我会做的与您所做的不同的是限制您的类型，以便只能传入允许的类型。

我将在 C# 中使用泛型给出一个示例。

```
public class SimpleFactory
{
 public static ITest Create<T>()
    where T: ITest, new()
 {
    return new T();
 }
} 
```

然后，您将使用 ConcreteTest1 和 ConcreteTest2 实现 IConcreteTest，您可以像这样使用您的工厂：

```
ConcreteTest1 test1 = SimpleFactory.Create<ConcreteTest1>(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T16:49:12.333

如果你想按类型创建，你可以使用`Activator.CreateInstance(Type t)`. 将其包装在模板方法中以将其限制在您的界面中，例如`Create<T> where T:ITest`.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-08T16:54:28.530

我认为我最大的担忧是工厂的目的是允许客户端代码创建对象的派生实例而不知道正在创建的类型的细节（更具体地说，如何创建实例的细节，但如果做得正确，调用者不需要知道基类提供的任何细节）。

使用从派生类型中提取的类型信息仍然需要调用者对他想要实例化的类型有一些深入的了解，这使得更新和维护变得困难。通过替换 Enum 类型（或字符串、int 等），您可以更新工厂，而无需更新调用代码以了解新的派生类型。

我想有人可能会争辩说，类型名称可以作为字符串从配置文件、数据库等中读取，并且类型信息使用反射（在 .NET 中）或 RTTI（在 C++ 中）确定，但我认为这是一个更好的情况是简单地使用类型字符串作为您的标识符，因为它可以有效地服务于相同的目的。

# objective-c - 您为 Mac OSX 开发软件的动机是什么？

> ID：840704
> 
> 赞同：4
> 
> 时间：2009-05-08T16:33:01.827
> 
> 标签：objective-c, cocoa, macos, appkit

我真的很喜欢我的 Mac，并且我正在考虑在未来的某个时间为它开发软件。您制作 Mac 软件的原因是什么？因为你觉得 Mac 很酷？还是市场如此有趣？我想我们很多人都想知道，对吧？

正如我所说，对我来说，这是 Mac 的酷炫之处。我对市场一无所知。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-08T16:38:51.547

我喜欢 Objective C 作为一种语言。我在日常生活中使用mac。我喜欢在下面拥有一个 unixish 操作系统的灵活性。简而言之，它满足了我的需求并帮助我学习。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-08T18:10:31.780

我参加了威尔·希普利关于[Delicious Monster](http://delicious-monster.com/company.php)成名的演讲。他在 Mac 上开发的理由很简单：

1.  Mac 用户平均购买更多软件
2.  平均价格更高

在我看来，这些似乎是非常令人信服的理由，再加上不那么拥挤的市场。

这是在 iPhone 出现之前的日子，如今你拥有更广泛的客户群。

此外，用于开发 Mac 和 iPhone 应用程序的“强制”MVC 使得平台之间的移植非常容易，请参见[Tweetie for iPhone and now Mac](http://blog.atebits.com/)的示例。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-08T17:45:14.713

**简而言之：**

Objective-C 语言、Cocoa 和 Mac OS X 为开发人员提供的应用程序（不仅仅是 Xcode 和 Interface Builder）。

**稍微长一点：**

我喜欢 Cocoa 提供的 Objective-C 语法和无数的函数。在为 Mac OS X 编写应用程序时，您可以做很多事情，甚至不需要编写一行代码。当您编写非常简单的“粘合代码”时，您可以做更多的事情。当你需要编写“真正的”代码来实现某个框架中尚不可用的东西时，它不会让人觉得很累，因为在我看来，编写 Objective-C 代码很有趣。

市场也很有趣，例如，在许多领域，Mac 缺少软件，因此您可以成为第一个为某项任务制作应用程序的人，这对于新公司来说可能是一件好事。市场也令人沮丧，因为我认为现在人们对 Mac 软件的期望太高了，至少我是这样。Mac 软件不仅必须在技术实现和可用性/直观性方面绝对出色，而且还必须看起来漂亮或酷或其他。例如，这对于一个人的软件商店来说真的很难。你需要成为一名编码员和一名设计师，据说这是不可能的，当然也有例外。例如，与 Linux 相比，每个人都对所选 GUI 系统提供的标准 GUI 工具感到满意。

大约三年来我没有做过太多的 Mac 编程，但是每次我用 Java、C#、Ruby、C 或我正在使用的任何其他语言开发应用程序时，我都会梦想着用 Xcode 用 Objective-C 编写应用程序反而。但后来我也开始考虑开发跨平台软件而不是只能在 Mac OS X 上运行的软件的好处。我使用 Windows、Mac OS X、Linux 和一些鲜为人知的操作系统，并且能够使用我自己开发的应用程序在这些平台中的每一个平台上而不是只在 Mac 上编写是太好了，不能放弃。这就是为什么我现在主要开发跨平台软件，尽管我更喜欢为 Mac OS X 开发。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T16:47:11.373

用户。
在某些圈子中，出于某种原因，Mac 是唯一的选择。您拥有整个公司，但没有一台 Windows 机器。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T17:59:09.920

很简单——因为它是我使用的操作系统。如果我主要使用 Windows，我可能会学习 C#/.NET 而不是 ObjC/Cocoa。

另外，我会说 Mac 软件比 Windows 软件有更好的声誉（“免费 Windows 软件”可以描述为“间谍软件”的化名）。围绕 OS X 软件（如[TUAW](http://www.tuaw.com/)、[iusethis.com](http://osx.iusethis.com/)等网站）有一个非常好的社区，我猜这是因为 OS X 最近才出现，同时所有博客/社交媒体的东西都被占用了（ “好时机”或多或少）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-08T02:00:01.017

Mac 市场正以惊人的速度增长。在我们没有任何工作的情况下让您的市场增长真是太棒了；）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-11T11:10:25.580

自 1984 年以来，我一直是 mac 用户，并且是 Apple 用户的时间更长......尽管如此，我仍然*总是*对开箱即用的开发人员可用的惊人资源感到鼓舞......（有时需要几年时间让这些资源得到正确记录，但它们就在那里，而且非常棒。）示例：coreAudio、coreGraphics、coreVideo、FireWireSDK 等等等等……

我不是布道者，也不是苹果支付的，只是我的 0.02 美元

|K<

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-09T10:14:30.183

我为 Mac OS X 编程，因为它是我使用的环境，我决定确保我使用的环境质量的一个好方法是参与构建该环境。拥有良好的 Mac 用户、管理员和开发人员社区会很有帮助，因此了解环境、热门与否等既简单又快捷。这种社区感觉让我有机会向他人学习并炫耀一下，我喜欢这两件事。

我实际上是从 NeXTSTEP 迁移到 OS X 的，而我在 NeXT 上的原因是完全一样的——这就是我使用的。Uni 的计算实验室是基于 NeXT 的，它是一个很好的 UNIX 平台，易于使用和理解，我意识到如果我为此进行开发，那么我将为我自己的用户体验质量做出贡献，并且我毕业后可能会有一份工作（有）;-)。

像其他一些海报一样，我也喜欢 Objective-C 语言，但这对我来说不是一个交易的关键。我用 C 和 Python 编写过（并且仍在编写）工具，并且以前维护过 WebObjects Java 代码。这些事情都没有错。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-10-25T06:58:30.400

为 Mac 开发有几个很好的理由：

1.Apple 提供了很好的工具，例如 Xcode，并且该语言有很好的文档记录以及拥有庞大的支持社区

2.将应用程序从 OS X 移植到 iPhone/iPad 非常容易。

3\. OS X 和 iOS（iPhone 和 iPad）都有应用商店，人们可以在其中购买大量软件，从而提供大量潜在受众，从而为开发人员提供从应用程序中赚钱的简便方法。

# search - 谷歌自定义搜索不索引动态页面

> ID：840706
> 
> 赞同：1
> 
> 时间：2009-05-08T16:33:14.183
> 
> 标签：search

我正在尝试使用 Google 自定义搜索为信息站点提供搜索功能。

**关于网站：**

*   内容是动态生成的
*   URL 对内容的访问是搜索引擎友好的（即 site.com/Info/3/4/45）
*   网站管理员工具提交并接受的站点地图（基于 RSS 提要）。它指出没有页面被编入索引。
*   根据 RSS 提要成功提交注释

**问题：**

提交的页面上显示的任何关键字都没有结果。

**问题：**

*   为什么谷歌不索引提交的页面？
*   我可能做错了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T16:40:00.500

具有基本设置的自定义搜索与使用`site:your.website`. 标准搜索是否会给您预期的结果？

请注意，Google 不会立即索引页面。这需要一些时间。[检查您的网站是否已编入索引。](https://support.google.com/webmasters/answer/35256)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T17:15:22.083

是的，在我提交站点地图后，Google 花了大约 2 周的时间来获取我的所有页面。但是您应该会在几天后看到一些被索引的页面。

# internet-explorer - 安装搜索提供程序 [Internet Explorer]

> ID：840712
> 
> 赞同：1
> 
> 时间：2009-05-08T16:35:39.217
> 
> 标签：internet-explorer, search-engine, nsis, opensearch

这似乎是一项基本任务，但由于某种原因我无法找到解决方案。

如何以编程方式在 Internet Explorer 中安装搜索提供程序？我正在为我的安装程序使用 NSIS。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T17:55:33.407

似乎没有任何官方记录的手动安装 Internet Explorer 搜索服务的方法。[官方](http://blogs.msdn.com/ie/archive/2005/09/14/466186.aspx)的方法好像是实现

```
window.external.AddSearchProvider("URL") 
```

使用 IE 7+ 查看时，会提示用户安装搜索服务。

但是，经过一番探索，IE 8 似乎至少在以下位置安装了搜索服务（使用 NSIS 变量）：

```
%LOCALAPPDATA%\Microsoft\Internet Explorer\Services\ 
```

查看该文件夹（在安装至少一项搜索服务之后）以查看结构。看起来您只需要一个 .ico 和（可能）一个[OpenSearch](http://www.opensearch.org) .xml 文件。您还需要一些注册表设置（如下所述）。

但是，对于简单的搜索（没有自动建议），看起来您只需在注册表中设置搜索服务即可。注册表中搜索设置的位置是：

```
HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\SearchScopes\{guid} 
```

其中 {guid} 是标识搜索服务的 GUID。同样，只需检查其他搜索服务所做的事情，因为似乎没有任何官方文档用于此类事情。例如，谷歌只是为他们的服务指定一个 URL，使用 URL 中的 OpenSearch 替换来实现魔术。

注意：由于显然没有关于此的公开文档，因此所有这些都可能在未来发生变化。如果您不使用官方方法（在浏览器中），您最终可能会支持多种不同的安装方法。

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-08-24T07:00:05.337

[http://msdn.microsoft.com/en-us/library/cc849066(v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/cc849066(v=vs.85).aspx)现在似乎是 IE8+ 支持的方法

[从http://www.microsoft.com/download/en/details.aspx?id=22015](http://www.microsoft.com/download/en/details.aspx?id=22015)下载 IE8 SDK并使用 openservice.h 和 openservice.idl 文件调用相关函数。

# .net - 在 .NET 框架中引发事件的正确方法

> ID：840715
> 
> 赞同：28
> 
> 时间：2009-05-08T16:36:00.963
> 
> 标签：.net, events, delegates

目前，“[避免检查空事件处理程序”位于标题](https://stackoverflow.com/questions/9033/hidden-features-of-c/9282#9282)[为 C# 的隐藏功能](https://stackoverflow.com/questions/9033/hidden-features-of-c)的帖子的答案顶部，其中包含严重误导性信息。

虽然我知道 Stack Overflow 是一种“民主”，并且通过公众投票将答案推到了首位，但我觉得很多投票赞成答案的人要么对 C#/.NET 没有完全了解，要么没有花时间完全理解帖子中描述的做法的后果。

简而言之，该帖子提倡使用以下构造，以避免在调用事件时必须检查 null。

```
public event EventHandler SomeEvent = delegate {};
// Later..
void DoSomething()
{
   // Invoke SomeEvent without having to check for null reference
    SomeEvent(this, EventArgs.Empty);  
} 
```

乍一看，这似乎是一个聪明的捷径，但它可能会导致大型应用程序中的一些严重问题，尤其是在涉及并发的情况下。

在调用事件的委托之前，您**必须检查空引用**。仅仅因为您使用空委托初始化事件并不意味着您的类的用户不会在某些时候将其设置为 null 并破坏您的代码。

这样的事情很典型：

```
void DoSomething()
{
    if(SomeEvent != null) 
        SomeEvent(this, EventArgs.Empty);
} 
```

但即使在上面的示例中，也存在这样的可能性，即当 DoSomething() 可能由一个线程运行时，另一个可能会删除事件处理程序，并且可能会出现竞争条件。

假设这种情况：

```
      线程 A. 线程 B.
    -------------------------------------------------- ----------------------
 0：如果（某个事件！= null）
 1: { // 删除 SomeEvent 的所有处理程序
 2：一些事件（这个，EventArgs.Empty）；
 3：}

```

在引发事件的代码检查了委托的空引用之后，线程 B 删除了 SomeEvent 事件的事件处理程序，但在它调用委托之前。当 SomeEvent(this, EventArgs.Empty); 调用时， SomeEvent 为 null 并引发异常。

为了避免这种情况，引发事件的更好模式是：

```
void DoSomething()
{
    EventHandler handler = SomeEvent;
    if(handler != null)
    {
        handler(this, EventArgs.Empty);
    }
} 
```

对于 .NET 中的 EventHandlers 主题的广泛讨论，我建议阅读Krzysztof Cwalina 和 Brad Abrams 的“[框架设计指南”，第 5 章第 4 节 - 事件设计。](https://rads.stackoverflow.com/amzn/click/com/0321545613)尤其是 Eric Gunnerson 和 Joe Duffy 对这个话题的讨论。

正如 Eric 所建议的，在下面的一个答案中，我应该指出，可以设计一个更好的同步解决方案来解决这个问题。我写这篇文章的目的是**提高人们的意识**，而**不是为这个问题提供一个唯一真正**的解决方案。正如 Eric Lippert 和 Eric Gunnerson 在上述书中所建议的那样，问题的具体解决方案取决于程序员，但重要的是不能忽视这个问题。

**希望版主会注释有问题[的答案](https://stackoverflow.com/questions/9033/hidden-features-of-c/9282#9282)，以便毫无戒心的读者不会被错误的模式误导。**

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-05-08T21:18:49.580

大约一周前我提出了同样的问题，得出了相反的结论：

[C# 事件和线程安全](https://stackoverflow.com/questions/786383/c-events-and-thread-safety)

否则，您的总结并不能说服我！

首先，该类的客户端不能将 null 分配给事件。`event`这就是关键字的全部意义所在。如果没有那个关键字，它将是一个持有委托的字段。有了它，它的所有操作都是私有的，除了入伍和退市。

因此，`delegate {}`在构造时分配给事件完全符合正确实现事件源的要求。

当然，在类中可能存在将事件设置为的错误`null`。但是，在任何包含任何类型字段的类中，都可能存在将字段设置为`null`. 你会主张每次访问一个类的任何成员字段时，我们都编写这样的代码吗？

```
// field declaration:
private string customerName;

private void Foo()
{
    string copyOfCustomerName = customerName;
    if (copyOfCustomerName != null)
    {
        // Now we can use copyOfCustomerName safely...
    }
} 
```

你当然不会。所有程序都将变得两倍长，可读性减半，这没有什么好理由。当人们将这种“解决方案”应用于事件时，也会发生同样的疯狂。事件对于赋值不是公开的，与私有字段一样，因此直接使用它们是安全的，只要您在构造时将它们初始化为空委托。

你不能这样做的一种情况是当你在 a 中有一个事件时`struct`，但这并不完全是一种不便，因为事件往往出现在可变对象上（表明状态的变化），并且`struct`如果允许 s 变异，s 是出了名的诡计， so 最好是不可变的，因此事件对`struct`s 几乎没有用处。

正如我在问题中所描述的那样，可能存在另一个完全独立的竞争条件：如果客户端（事件接收器）想要确保其处理程序在被除名后不会被调用怎么办？但正如 Eric Lippert 指出的那样，这是客户解决问题的责任。简而言之：不可能保证某个事件处理程序在被除名后不会被调用。这是代表不可变的必然结果。无论是否涉及线程，这都是正确的。

在 Eric Lippert 的博客文章中，他链接到我的 SO 问题，但随后陈述*了一个不同但相似的问题*。我认为，他这样做是出于正当的修辞目的——只是为了为讨论次要比赛条件创造条件，即影响事件处理者的条件。但不幸的是，如果您点击我的问题的链接，然后稍微粗心地阅读他的博客文章，您可能会觉得他正在摒弃“空委托”技术。

事实上，他说“还有其他方法可以解决这个问题；例如，初始化处理程序以拥有一个永远不会被删除的空操作”，这就是“空委托”技术。

他涵盖了“进行空检查”，因为它是“标准模式”；我的问题是，为什么这是标准模式？Jon Skeet 建议，鉴于该建议早于匿名函数被添加到语言中，它可能只是 C# 版本 1 的遗留问题，我认为这几乎可以肯定是正确的，所以我接受了他的回答。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-05-08T20:56:01.930

“仅仅因为您使用空委托初始化事件并不意味着您的类的用户不会在某些时候将其设置为 null 并破坏您的代码。”

不可能发生。事件“只能出现在 += 或 -= 的左侧（在类型内使用时除外）”以引用执行此操作时会遇到的错误。诚然，“除非在类型中使用”使这成为理论上的可能性，但不是任何理智的开发人员都会关心的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-06-21T09:40:50.597

只是为了澄清。即使与序列化一起使用，使用空委托作为事件初始值的方法也有效：

```
// to run in linqpad:
// - add reference to System.Runtime.Serialization.dll
// - add using directives for System.IO and System.Runtime.Serialization.Formatters.Binary
void Main()
{
    var instance = new Foo();
    Foo instance2;
    instance.Bar += (s, e) => Console.WriteLine("Test");
    var formatter = new BinaryFormatter();
    using(var stream = new MemoryStream()) {
        formatter.Serialize(stream, instance);
        stream.Seek(0, SeekOrigin.Begin);
        instance2 = (Foo)formatter.Deserialize(stream);
    }
    instance2.RaiseBar();
}

[Serializable]
class Foo {
    public event EventHandler Bar = delegate { };
    public void RaiseBar() {
        Bar(this, EventArgs.Empty);
    }
}

// Define other methods and classes here 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T16:48:06.067

对于它的价值，您应该真正研究 Juval Lowy 的[EventsHelper 类](http://www.idesign.net/idesign/uploads/EventsHelper.zip)，而不是自己做事。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-08T21:25:56.397

Brumme 是 Eric 和 Abrams 的爸爸。你应该阅读他的博客，而不是从这两位公关人员那里讲道。这家伙技术含量很高（与高级发型师的标志相反）。他将在没有“Redmond Flowers in 1TB Land”的情况下给您一个正确的解释，说明为什么种族和记忆模型对于上面另一张海报提出的托管（re：shield-the-children）环境来说是一个挑战。

顺便说一句，这一切都从他们开始，C++ CLR 实现人员：

blogs.msdn.com/cbrumme

# sql - 添加 SQL Server 索引但如何仅重新编译受影响的存储过程？

> ID：840719
> 
> 赞同：4
> 
> 时间：2009-05-08T16:36:39.400
> 
> 标签：sql, sql-server, sql-server-2005, tsql, indexing

我需要向表中添加索引，并且我只想重新编译/所有引用该表的存储过程。有什么快速简便的方法吗？

编辑：

来自 SQL Server 2005 联机丛书，重新编译存储过程：

当数据库被添加索引或更改索引列中的数据等操作更改时，用于访问其表的原始查询计划应通过重新编译再次优化。此优化会在 Microsoft SQL Server 2005 重新启动后第一次运行存储过程时自动发生。如果存储过程使用的基础表发生更改，也会发生这种情况。**但是，如果添加了存储过程可能受益的新索引，则在 Microsoft SQL Server 重新启动后下一次运行存储过程之前，不会发生优化。**在这种情况下，强制存储过程在下次执行时重新编译会很有用

强制重新编译存储过程的另一个原因是在必要时抵消存储过程编译的“参数嗅探”行为。当 SQL Server 执行存储过程时，该过程在编译时使用的任何参数值都包含在生成查询计划中。如果这些值代表随后调用过程的典型值，则存储过程在每次编译和执行时都会从查询计划中受益。否则，性能可能会受到影响

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T16:48:09.187

它们通常会自动重新编译。我想我不知道这是否得到保证，但这是我观察到的——如果你更改（例如添加索引）存储过程引用的对象，那么它会重新编译。

```
create table mytable (i int identity)
insert mytable default values
go 100
create proc sp1 as select * from mytable where i = 17
go
exec sp1 
```

如果您查看此执行的计划，它会按预期显示表扫描。

```
create index mytablei on mytable(i)
exec sp1 
```

该计划已更改为索引查找。

编辑：好的，我想出了一个似乎有效的查询 - 这为您提供了所有引用计划缓存中给定表的 sproc 名称。您可以将 sproc 名称与 sp_recompile 语法连接起来，以生成一堆可以执行的 sp_recompile 语句。

```
;WITH XMLNAMESPACES (default 'http://schemas.microsoft.com/sqlserver/2004/07/showplan')
,TableRefs (SProcName, ReferencedTableName) as
(
    select
        object_name(qp.objectid) as SProcName,
        objNodes.objNode.value('@Database', 'sysname') + '.' + objNodes.objNode.value('@Schema', 'sysname') + '.' + objNodes.objNode.value('@Table', 'sysname') as ReferencedTableName 
    from sys.dm_exec_cached_plans cp
    outer apply sys.dm_exec_sql_text(cp.plan_handle) st
    outer apply sys.dm_exec_query_plan(cp.plan_handle) as qp
    outer apply qp.query_plan.nodes('//Object[@Table]') as objNodes(objNode)
    where cp.cacheobjtype = 'Compiled Plan'
    and cp.objtype = 'Proc'
)
select 
    * 
from TableRefs
where SProcName is not null
    and isnull(ReferencedTableName,'') = '[db].[schema].[table]' 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T17:15:13.240

您可以执行 sp_recompile 并提供刚刚建立索引的表名。所有依赖于该表的 proc 都将从存储的 proc 缓存中刷新，并在下次执行时“编译”

从 msdn 文档中查看： [sp_recompile (Transact-SQL)](http://msdn.microsoft.com/en-us/library/ms181647.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T16:50:31.583

我相信，如果启用了自动生成统计信息选项，可能会从相关索引的存在中受益的存储过程将自动生成一个新的查询计划。

有关导致自动重新编译的可能性的详细信息，请参阅标题为重新编译执行计划的部分。

[http://technet.microsoft.com/en-us/library/ms181055(SQL.90).aspx](http://technet.microsoft.com/en-us/library/ms181055(SQL.90).aspx)

# objective-c - 有委托的对象的名称是什么？

> ID：840729
> 
> 赞同：0
> 
> 时间：2009-05-08T16:39:07.367
> 
> 标签：objective-c, cocoa, cocoa-touch, uikit

代表类似于“主人”的狗。我正在考虑一个重要实例变量的名称，该变量必须持有对委托的这个“主”的弱引用。这个有官方名称吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-01-02T18:08:58.833

Apple在[Cocoa Fundamentals Guide，Cocoa Design Patterns 部分中将其称为](http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CocoaFundamentals/CocoaDesignPatterns/CocoaDesignPatterns.html)*宿主对象/类*。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-18T17:24:31.957

也许你在想“下属”？

[http://developer.apple.com/mac/library/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/mmObjectOwnership.html#//apple_ref/doc/uid/20000043-1044135](http://developer.apple.com/mac/library/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/mmObjectOwnership.html#//apple_ref/doc/uid/20000043-1044135)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-02T18:24:49.913

您的委托不应引用其委托的对象。相反，主对象应该将自己作为参数传递给委托方法。这样，一个对象就可以委托给多个独立对象。

# c# - DataGridViewCellEventArgs 如何帮助修改 DataGridViewCell 的当前值？

> ID：840739
> 
> 赞同：0
> 
> 时间：2009-05-08T16:40:57.270
> 
> 标签：c#, events, datagridview

当 CheckBoxColumn 已被检查时，我正在使用此事件来备注该行，所以另外我想使用“Value”属性“以编程方式”替换同一行中的当前单元 [6] 值，但默认情况下它失败了“只读”属性为 = “真”。

DataGridView1.DataSource 从 LINQ2SQL 查询中检索。

```
void updateStyle_DataGridViewCellEventArgs(object sender, DataGridViewCellEventArgs e)
{
     if (e.RowIndex == -1)
         return;
     else
     {
        DataGridView dgv = sender as DataGridView;
        int vCHK = e.ColumnIndex;
        if (vCHK != 0)
            return;
        else
        {
            DataGridViewCheckBoxCell temp = (DataGridViewCheckBoxCell)dgv.Rows[e.RowIndex].Cells[0];
            if ((bool)temp.EditedFormattedValue == true)
            {
                DataGridViewTextBoxCell xrow = (DataGridViewTextBoxCell)dgv.Rows[e.RowIndex].Cells[6];
                xrow.ReadOnly = false;
                xrow.Value = "P";
                xrow.OwningRow.DefaultCellStyle.BackColor = Color.Wheat;
            }
            else
            {
                temp.OwningRow.DefaultCellStyle.BackColor = Color.White;
            }
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T16:49:30.900

我会在 DataSource 中找到实际的对象/行，在那里翻转布尔值，然后重新绑定网格。然后您可以在 CellFormatting 事件中设置 BackColor。

# c# - Delphi TDecompressionStream 的 C# 等效项是什么？

> ID：840741
> 
> 赞同：0
> 
> 时间：2009-05-08T16:41:02.307
> 
> 标签：c#, .net, delphi, compression

我有一些需要在 C# 中重新编码的 Delphi 代码：

```
procedure TDocSearchX.Decompress;
var
BlobStream:TBlobStream;
DecompressionStream:TDecompressionStream;
FileStream:TFileStream;
Buffer:array[0..2047] of byte;
count:integer;
begin
    BlobStream:=TBlobStream.Create(DocQueryDATA,bmRead);
    DecompressionStream:=TDecompressionStream.Create(BlobStream);
    FileStream:=TFileStream.Create(FDocFile,fmCreate);
    while True do
    begin
        Count := DecompressionStream.Read(Buffer, 2048);
        if Count <> 0 then FileStream.Write(Buffer, Count) else Break;
    end;
    Blobstream.Free;
    DecompressionStream.Free;
    FileStream.Free;
end; 
```

写这篇文章的承包商要离开了，我需要解压缩图像（当前存储在数据库中）。我已经能够将图像提取到文件中，但不知道如何使用 C# 解压缩它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T16:56:06.623

看起来`TDecompressionStream`可能使用 ZLib。这是 ZLIB 的 .NET 库：

[http://www.componentace.com/zlib_.NET.htm](http://www.componentace.com/zlib_.NET.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T16:52:40.860

据我所知，没有与 TDecompressionStream 类等效的 .Net 框架。你能在 Delphi 中编写一个用于解压缩图像的小型转换器应用程序吗？然后，您可以在您的 C# 代码中自由使用任何支持 .Net 的压缩库（例如 SharpZipLib）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T17:30:09.897

如果您必须保持已使用的相同压缩，请将 Delphi 解压缩例程滚动到 DLL 中，并使用 PInvoke 从 C# 中使用它。

如果你想替换压缩，编写一个批处理来提取 Delphi 压缩图像，将它们解压缩为原始格式，然后用你喜欢的 C# 库重新压缩它们。

# asp.net - 单击时禁用按钮

> ID：840742
> 
> 赞同：14
> 
> 时间：2009-05-08T16:41:09.030
> 
> 标签：asp.net, javascript, jquery

我有一个按钮控件。一旦用户点击它，点击事件应该触发，然后按钮应该被禁用。我怎样才能做到这一点？我可以选择使用 JQuery 或 JavaScript 或两者。

这是我的按钮声明：

```
<asp:Button 
  ID="Button1" 
  runat="server" 
  Text="Click Me" 
  onclick="Button1_Click"
/> 
```

在后面的按钮单击代码上，我添加了一个 Response.Write()。那应该被执行，然后按钮应该被禁用

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-05-08T21:50:46.993

无论出于何种原因，[HTML 规范规定禁用的元素不应包含在 POST 请求](http://www.w3.org/TR/html401/interact/forms.html#successful-controls)中。因此，如果您在客户端 onclick 事件中使用 JavaScript 禁用 HTML 元素，则当浏览器组装 POST 请求时，输入元素将被禁用，服务器将无法正确通知哪个元素引发了回发，它会'不触发服务器端点击事件处理程序。

当您将**UseSubmitBehavior属性设置为 false 时，ASP.NET 将呈现****按钮**类型的输入元素，而不是ASP.NET 按钮控件通常生成的**提交**类型的常规输入。这很重要，因为单击按钮元素不会触发浏览器的表单提交事件。

ASP.NET 不依赖浏览器表单提交，而是在该按钮元素的 onclick 处理程序中呈现对 __doPostBack() 的客户端调用。__doPostBack 将明确提出回发，无论请求中通过什么 POST 数据。

通过独立于浏览器提交事件引发回发，您可以摆脱前面提到的 HTML 怪癖。然后，您可以设置“this.disabled = true;”的 OnClientClick，它将呈现为“this.disabled = true; __doPostBack('Button1', '');”，一切都会按预期工作。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-08T16:44:52.937

添加一个 OnClientClick="this.disabled = true;" 到您的按钮。

如果您使用的是 Asp.net Ajax，您可能想看看使用[PostBack Ritalin](http://encosia.com/downloads/postback-ritalin/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-03-23T15:44:32.290

你试过这个吗？

添加一个 OnClientClick="MyFunction();" 到您的 .NET 按钮。

然后在 .aspx 页面脚本标签中添加以下 JS 函数：

```
<script type="text/javascript">
  function MyFunction()
  {
    window.setTimeout(function ()
    {
      // get the button/control to disable using your favourite clientside ...
      // ... control grabbing code snippet ...
      // ... eg. JQUERY $('Button1'), getElementById, etc.)

      document.getElementsByName('Button1').Button1.disabled = true;

      // I've used "getElementsByName" because .NET will render a button with
      // ... a "name" attribute, and not an "id" attribute, by default

    }, 1);
  }
</script> 
```

这使浏览器有机会回发，然后快速按钮禁用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T16:45:20.660

在通过客户端脚本禁用按钮之前，您需要小心回发。这是 ajax 和输入框的常见问题。禁用输入框会阻止从浏览器发送数据，即使在禁用时您可以看到其中的文本。答案是您需要为此使用 jquery 以确保服务器端代码在被禁用之前首先运行。

-Oisin

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T17:27:27.297

```
// to disable
this.setAttribute('disabled', true); 
// to enable
this.removeAttribute('disabled'); 
```

这是一个跨浏览器解决方案

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-09T05:35:15.613

身体标签“<”body onBeforeunload="buttonId.disabled = true;" 的事件真的很酷 ">"

此事件在表单提交之前触发，换句话说，您的数据将被正确提交。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-03-16T18:59:46.387

使用“this.disabled = true”方法时，如果页面上有验证器，请确保在禁用控件之前检查页面是否有效。如果验证失败，您将无法在不重新加载页面的情况下重新启用控件。

```
if (Page_IsValid) this.disabled = true; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-12-01T18:23:50.173

```
 <script type="text/javascript">
     Sys.WebForms.PageRequestManager.getInstance().add_beginRequest(BeginRequestHandler);
      function BeginRequestHandler(sender, args) {
        document.getElementById('<%= lblMessage.ClientID %>').innerText = "Processing...";
          document.getElementById('<%= btnSubmit.ClientID %>').innerText = "Processing";
         args.get_postBackElement().disabled = true;
           }
           </script> 
```

在源页面中添加脚本标签。更改代码中按钮的 ID。您可以禁用该按钮，直到进程完成执行。

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2009-05-08T16:55:50.837

你可以禁用它服务器端

```
Button1.Enabled = false; 
```

# c# - DataRelation 插入和外键

> ID：840757
> 
> 赞同：3
> 
> 时间：2009-05-08T16:43:43.457
> 
> 标签：c#, .net, ado.net, datagridview, datarelation

我有一个带有两个 DataGridViews 的 winforms 应用程序，显示我的 Person 和 Address 表中的主从关系。Person 表有一个 PersonID 字段，它是自动递增的主键。Address 有一个 PersonID 字段，即 FK。

我用 DataAdapter 填充我的 DataTables 并设置 Person.PersonID 列的 AutoIncrement=true 和 AutoIncrementStep=-1。我可以从 DataGridView 在 Person DataTable 中插入记录。PersonID 列显示 PersonID 的唯一负值。我通过调用 DataAdapter.Update(PersonTable) 更新数据库，SQL Server 自动将负的 PersonID 转换为正的唯一值。

这就是问题所在。Address DataGridView 通过 PersonID 显示与 Person 有 DataRelation 的地址表。插入的人员记录具有临时负的 PersonID。我现在可以通过 DataGridView 将记录插入到 Address 中，并且 Address.PersonID 设置为 DataRelation 映射中的负值。我调用 Adapter.Update(AddressTable) 并且否定的 PersonID 进入地址表，打破了这种关系。

你们如何使用 DataTables 和主从 DataGridViews 处理主键/外键？

谢谢！史蒂夫

编辑：

经过更多的谷歌搜索，我发现 SqlDataAdapter.RowUpdated 事件给了我我需要的东西。我创建了一个新命令来查询使用@@IDENTITY 插入的最后一个id。它工作得很好。DataRelation 为我更新了 Address.PersonID 字段，因此需要先更新 Person 表，然后更新 Address 表。所有新记录都正确插入，并带有正确的 ID！

```
 Adapter = new SqlDataAdapter(cmd);
            Adapter.RowUpdated += (s, e) => 
            {
                if (e.StatementType != StatementType.Insert) return;
                //set the id for the inserted record
                SqlCommand c = e.Command.Connection.CreateCommand();
                c.CommandText = "select @@IDENTITY id";
                e.Row[0] = Convert.ToInt32( c.ExecuteScalar() );
            };
            Adapter.Fill(this);
            SqlCommandBuilder sb = new SqlCommandBuilder(Adapter);
            sb.GetDeleteCommand();
            sb.GetUpdateCommand();
            sb.GetInsertCommand();
            this.Columns[0].AutoIncrement = true;
            this.Columns[0].AutoIncrementSeed = -1;
            this.Columns[0].AutoIncrementStep = -1; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-16T22:33:48.617

我有一个类似的问题，但我的解决方案有点不同。

@Noel Kennedy：您的解决方案不适用于 SQL Server 2005 CE，因为它不支持多条语句，并且 TableAdapter 不会生成更新父表中的自动增量列所需的刷新代码。

注意：您仍然需要关系中的级联更新，以便更新子表。

我还在我的 TableAdapter 中添加了一个方法，该方法足够通用，可以复制/粘贴到所有父 TableAdapter 中。我唯一改变的是标识行类型和索引（如果需要）。我还向 TableAdapter 添加了一个名为 GetIdentity() 的查询。您可以通过使用 sql="SELECT @@IDENTITY;" 添加标量查询，将其添加到数据集设计器中的 TableAdapter

现在自定义函数是：

```
public int InsertAndRefresh(System.Data.DataTable dataTable)
{
    int updated = 0;

    System.Data.DataRow[] updatedRows = dataTable.Select("", "", System.Data.DataViewRowState.Added);

    bool closed = (this.Connection.State == System.Data.ConnectionState.Closed);
    if (closed) 
        this.Connection.Open();

    foreach (System.Data.DataRow row in updatedRows)
    {
        updated+=this.Adapter.Update(new global::System.Data.DataRow[] { row });
        decimal identity = (decimal)this.GetIdentity();
        row[0] = System.Decimal.ToInt64(identity);
        row.AcceptChanges();
    }
    if (closed)
        this.Connection.Close();

    return updated;
} 
```

您想先在父级上调用它。然后像往常一样做所有事情（更新父母然后孩子）。

干杯!

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T23:28:15.200

您需要在数据集设计器中双击关系，然后选择级联更新。当你的真实 SQL server 生成的 Person 表的 PK 值生成时，它也会自动在地址表中设置外键值。

您不需要执行任何 RowUpdated 事件。它内置在数据集功能中。

# ms-access - ASP 奇怪的未指定错误 - 80004005

> ID：840762
> 
> 赞同：4
> 
> 时间：2009-05-08T16:45:03.827
> 
> 标签：ms-access, asp-classic, ado

我必须在一个已经制作好的网站上工作，只需添加一些小模块

当我更新时，在不同的子文件夹中有许多名为 myDB.mdb 的文件我想确保我的应用程序正在连接正确的数据库，所以我开始重命名子文件夹......在其中一个子文件夹中，我刷新了主站点我的停止工作了

我重命名回正确的名称..刷新...刷新...刷新..我仍在刷新，我启动了另一个浏览器..它给出了连接问题：S

提供程序错误“80004005”

未指定的错误

/new/conn.asp，第 13 行

关于他的任何想法：S 将不胜感激任何帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2013-10-04T11:47:34.453

我曾经也有过一样的问题。我第一次加载页面时效果很好，但是如果我再次快速加载页面，则会出现此错误。如果我等了一段时间，那么我没有收到错误。这一定是因为当您调用 objConnection.Close 时，实际关闭 mdb 文件需要一些时间，所以如果您再次尝试打开它，您会得到“文件已在使用类型错误”。奇怪地向连接添加模式为我解决了这个问题。它不必是只读的，读/写也可以。

```
objConnection.Mode = 1 ' read only 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T16:47:13.087

> 用于 ODBC 驱动程序的 Microsoft OLE DB 提供程序错误“80004005”[Microsoft][ODBC Microsoft Access Driver] Microsoft Jet 数据库引擎无法打开文件“（未知）”。它已被其他用户独占打开，或者您需要权限才能查看其数据。
> 
> 或者
> 
> 用于 ODBC 驱动程序的 Microsoft OLE DB 提供程序 (0x80004005) [Microsoft][ODBC Microsoft Access Driver]“（未知）”不是有效路径。确保路径名拼写正确并且您已连接到文件所在的服务器。
> 
> 或者
> 
> 用于 ODBC 驱动程序的 Microsoft OLE DB 提供程序错误“80004005”[Microsoft][ODBC Microsoft Access 97 Driver] 无法使用“（未知）”；文件已在使用中。

来自：[http ://tutorials.aspfaq.com/8000xxxxxx-errors/80004005-errors.html](http://tutorials.aspfaq.com/8000xxxxx-errors/80004005-errors.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-08T18:22:13.797

不管发生什么，都会导致 80004005 错误，所以问题肯定是权限问题。

根据 Web 服务器的配置，可能不是 IUSR 帐户需要访问。我发现最好启动[FileMon](http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx)，将其过滤为我的数据库名称（使用通配符），然后检查出现的错误的属性。查看属性将向您显示实际尝试访问该文件的用户。

对于 Access 数据库，您需要确保修改的是文件夹而不是文件的权限。您需要对该文件夹具有修改权限，以便可以创建 .ldb 文件。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-08T16:50:35.733

检查 IUSR 帐户是否对 Access 数据库和包含它的文件夹/子文件夹具有权限。我发现有时如果您重命名或压缩访问数据库，它会失去 IUSR 特权，因此出现在使用/锁定中

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-01-06T03:53:12.240

我在 Access DB 上遇到了同样的错误：Provider error '80004005' Unspecified error

原因是其中一个页面包含的文件格式不正确（UTF-8）但是 ANCI 当我将该文件更改为 UTF-8 时，一切都正常了！

问候奥托

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-02-06T23:41:36.087

谷歌搜索，但问题是我的情况下文件名中的空格。删除它们，没有问题。我希望这会帮助别人。

# java - 在 Jython 中使用 java.util.prefs.Preferences

> ID：840763
> 
> 赞同：2
> 
> 时间：2009-05-08T16:45:11.237
> 
> 标签：java, linux, jython, preferences

我似乎无法使用 Jython 脚本存储 Java 首选项。如果在 Jython 2.5 beta 中我使用：

```
clazz = Class.forName('mypackage.myclass')
prefs = Preferences.userNodeForPackage(clazz);
# or Preferences.userRoot()
prefs.put('propertyname', 'yes') 
```

不存储首选项。如果我再添加：

```
prefs.flush() 
```

我明白了

> java.util.prefs.BackingStoreException：无法获得文件锁定。

我目前正在使用 Java 1.6 在 Linux 和 Unix 上运行它。我希望我遗漏了一些明显的东西，因为我的 Java 应用程序可以在同一系统上成功使用 java.util.prefs.Preferences。

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-11-04T14:15:11.210

在对您的问题和答案的评论中，您声明它尝试编写/etc/.java/.systemPrefs。我不认为这实际上是正确的。

> ```
> clazz = Class.forName('mypackage.myclass')
> prefs = Preferences.userNodeForPackage(clazz);
> # or Preferences.userRoot()
> prefs.put('propertyname', 'yes') 
> ```

您正在使用 Preferences.userNodeForPackage，因此您将获得 .userPrefs。它们位于 /home/[user]/.java 并且应该是可写的。

使用 systemPrefs 您可以在 linux 上解决权限问题。默认情况下，首选项存储在 /etc/.java/.systemPrefs 中。如果此目录不可用（例如，如果您只是将 jre 复制到系统上），则用于编写首选项的 FileSystemPreferences 类将退回到 [java.home]/.systemPrefs。

不需要调用 prefs.flush() ，因为首选项保存在预定义的时间间隔中，并且在程序终止时保存。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-09T04:39:32.237

这似乎是[相关](http://developer.java.sun.com/developer/bugParade/bugs/4666397.html)的。

可能仅仅是文件没有创建或者文件的所有者没有足够的权限？或类似的东西？

# video - Vimeo 网站的缩略图比 YouTube 更难

> ID：840765
> 
> 赞同：3
> 
> 时间：2009-05-08T16:45:32.703
> 
> 标签：video, youtube, thumbnails, vimeo

我们的网站允许人们通过提交 URL 来添加视频 - 通常来自 YouTube 或 Vimeo。在向人们提供视频列表时，我想显示缩略图。

YouTube 让我轻松搞定 - 只需在 URL 的末尾加上“1.jpg”，你就得到了你的图像。

Vimeo 似乎希望我发出 HTTP 请求，并从它们返回的 XML 中提取缩略图 URL - 什么？谁有时间？！！！另外，我还必须存储这些 URL，对于列出 20 个视频的页面，我无法即时获取它们。

有没有更简单的方法来获取 Vimeo 缩略图？我一个都找不到...

# sharepoint - .NET Sharepoint 创建目录

> ID：840767
> 
> 赞同：3
> 
> 时间：2009-05-08T16:45:59.427
> 
> 标签：sharepoint, webclient, put

我可以使用 webclient 将文件上传到共享点，如下所示

```
using (System.Net.WebClient webclient = new System.Net.WebClient())
{
    System.Net.NetworkCredential credentials = new System.Net.NetworkCredential(
                    Encryptor.Decrypt(ConfigurationManager.AppSettings["username"]),
                    Encryptor.Decrypt(ConfigurationManager.AppSettings["password"]),
                    ConfigurationManager.AppSettings["domain"]);
    webclient.Credentials = credentials;

    string path = Path.Combine("http://sharepoint.domain.com/dir", filename);
    webclient.UploadData(path, "PUT", fileBytes);
} 
```

但是如果目录不存在，我不知道如何创建目录。

任何想法我该怎么做？

谢谢，-c

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T17:06:13.010

SharePoint 网站中的“目录”一词具有欺骗性。SharePoint Web 服务的“目录”结构是位于 SharePoint 数据库中的虚拟结构。您需要确定 SharePoint 对象模型中的“目录”是什么对象，例如：[http](http://sharepoint.domain.com/dir) : //sharepoint.domain.com/dir 可能是一个 SPSite，在站点中，您可以拥有一个 SPFolders 的“目录”， SPLists、SPDocumentLibraries 等

因此，如果“创建不存在的目录”是指在 SharePoint 站点目录结构中，您将无法使用 WebClient。您有两个选择：Windows SharePoint Services 对象模型和 SharePoint Webservices。

在我看来，对象模型当然更容易使用，但它需要您在与 SharePoint 服务器相同的服务器上运行应用程序。Web 服务需要做更多的工作，但它使您能够远程使用它们。

您将需要确定您尝试添加的对象类型（例如 SPFolder、SPSite、SPList、SPDocumentLibrary 等）。

[此处](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.aspx)有大量使用对象模型的文档，但如果您想使用 Web 服务，您需要在以下位置访问它们：

```
Administration Service       http://<server-url:port-number>/_vti_adm/admin.asmx
Alerts Service               http://<server-url>/_vti_bin/alerts.asmx
Document Workspace Service   http://<server-url>/_vti_bin/dws.asmx
Forms Service                 http://<server-url>/_vti_bin/forms.asmx
Imaging Service             http://<server-url>/_vti_bin/imaging.asmx
List Data Retrieval Service http://<server-url>/_vti_bin/dspsts.asmx
Lists Service                 http://<server-url>/_vti_bin/lists.asmx
Meetings Service               http://<server-url>/_vti_bin/meetings.asmx
Permissions Service         http://<server-url>/_vti_bin/permissions.asmx
Site Data Service             http://<server-url>/_vti_bin/sitedata.asmx
Site Service                   http://<server-url>/_vti_bin/sites.asmx
Users and Groups Service       http://<server-url>/_vti_bin/usergroup.asmx
Versions Service               http://<server-url>/_vti_bin/versions.asmx
Views Service                 http://<server-url>/_vti_bin/views.asmx
Web Part Pages Service       http://<server-url>/_vti_bin/webpartpages.asmx
Webs Service                   http://<server-url>/_vti_bin/webs.asmx 
```

我建议查看 Lists 或 Document Workspace Service 服务。

希望有帮助。

# perl - 为什么我的 BigInt 数字中有小数点？

> ID：840770
> 
> 赞同：1
> 
> 时间：2009-05-08T16:46:30.673
> 
> 标签：perl, string, bigint

在 Perl 中添加 15 位数字`999999999999990`会产生带有句点的结果，例如`1.9999999999999e+.`When using `substr`it still generate `1.99999999999`，而当使用`BigInt`结果时仍然有句点。Perl 5.8.7 获得没有句点的结果的正确 Perl 语法是什么？

```
use BigInt;
$acct_hash = substr(($acct_hash + $data[1]),0,15);

BigInt.pm -> /opt/perl5.8.7/lib/5.8.7/Math/BigInt.pm
BigInt -> /opt/perl5.8.7/lib/5.8.7/Math/BigInt.pm 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-08T16:57:50.787

使用[bigint pragma](http://perldoc.perl.org/bigint.html)来透明地使用[Math::BigInt](http://perldoc.perl.org/Math/BigInt.html)：

```
#!/usr/bin/perl

use strict;
use warnings;

print 999999999999990 + 999999999999990, "\n";

use bigint;

print 999999999999990 + 999999999999990, "\n"; 
```

# javascript - 获取数组中的所有非唯一值（即：重复/多次出现）

> ID：840781
> 
> 赞同：496
> 
> 时间：2009-05-08T16:48:31.213
> 
> 标签：javascript, arrays

我需要检查一个 JavaScript 数组以查看是否有任何重复值。最简单的方法是什么？我只需要找出重复的值是什么——我实际上并不需要它们的索引或它们被重复的次数。

我知道我可以遍历数组并检查所有其他值是否匹配，但似乎应该有一种更简单的方法。

### 类似的问题：

*   [获取 JavaScript 数组中的所有唯一值（删除重复项）](https://stackoverflow.com/questions/1960473)

* * *

## 回答 #1

> 赞同：352
> 
> 时间：2009-05-08T16:54:00.403

您可以对数组进行排序，然后遍历它，然后查看下一个（或上一个）索引是否与当前索引相同。假设您的排序算法很好，这应该小于 O(n ² )：

```
const findDuplicates = (arr) => {
  let sorted_arr = arr.slice().sort(); // You can define the comparing function here. 
  // JS by default uses a crappy string compare.
  // (we use slice to clone the array so the
  // original array won't be modified)
  let results = [];
  for (let i = 0; i < sorted_arr.length - 1; i++) {
    if (sorted_arr[i + 1] == sorted_arr[i]) {
      results.push(sorted_arr[i]);
    }
  }
  return results;
}

let duplicatedArray = [9, 9, 111, 2, 3, 4, 4, 5, 7];
console.log(`The duplicates in ${duplicatedArray} are ${findDuplicates(duplicatedArray)}`);
```

以防万一，如果您要作为重复项的函数返回。这适用于类似类型的案例。

参考：[https ://stackoverflow.com/a/57532964/8119511](https://stackoverflow.com/a/57532964/8119511)

* * *

## 回答 #2

> 赞同：214
> 
> 时间：2009-05-08T17:05:48.910

如果你想消除重复，试试这个很好的解决方案：

```
function eliminateDuplicates(arr) {
  var i,
      len = arr.length,
      out = [],
      obj = {};

  for (i = 0; i < len; i++) {
    obj[arr[i]] = 0;
  }
  for (i in obj) {
    out.push(i);
  }
  return out;
}

console.log(eliminateDuplicates([1,6,7,3,6,8,1,3,4,5,1,7,2,6]))
```

来源： [http ://dreaminginjavascript.wordpress.com/2008/08/22/eliminating-duplicates/](http://dreaminginjavascript.wordpress.com/2008/08/22/eliminating-duplicates/)

* * *

## 回答 #3

> 赞同：197
> 
> 时间：2014-07-26T06:56:55.790

这是我从重复线程（！）的回答：

2014 年编写此条目时 - 所有示例都是 for 循环或 jQuery。Javascript 有完美的工具：排序、映射和归约。

## 查找重复项

```
var names = ['Mike', 'Matt', 'Nancy', 'Adam', 'Jenny', 'Nancy', 'Carl']

var uniq = names
  .map((name) => {
    return {
      count: 1,
      name: name
    }
  })
  .reduce((a, b) => {
    a[b.name] = (a[b.name] || 0) + b.count
    return a
  }, {})

var duplicates = Object.keys(uniq).filter((a) => uniq[a] > 1)

console.log(duplicates) // [ 'Nancy' ]
```

## 更多功能语法：

@Dmytro-Laptin 指出了一些可以删除的代码。这是相同代码的更紧凑的版本。使用一些 ES6 技巧和高阶函数：

```
const names = ['Mike', 'Matt', 'Nancy', 'Adam', 'Jenny', 'Nancy', 'Carl']

const count = names =>
  names.reduce((a, b) => ({ ...a,
    [b]: (a[b] || 0) + 1
  }), {}) // don't forget to initialize the accumulator

const duplicates = dict =>
  Object.keys(dict).filter((a) => dict[a] > 1)

console.log(count(names)) // { Mike: 1, Matt: 1, Nancy: 2, Adam: 1, Jenny: 1, Carl: 1 }
console.log(duplicates(count(names))) // [ 'Nancy' ]
```

* * *

## 回答 #4

> 赞同：93
> 
> 时间：2015-08-20T15:48:25.027

更新：*简短*的单行以获得重复项：

```
[1, 2, 2, 4, 3, 4].filter((e, i, a) => a.indexOf(e) !== i) // [2, 4] 
```

要获得没有重复的数组，只需反转条件：

```
[1, 2, 2, 4, 3, 4].filter((e, i, a) => a.indexOf(e) === i) // [1, 2, 3, 4] 
```

我根本没有`filter()`在下面的旧答案中考虑过；）

* * *

当您只需要检查[此问题](https://stackoverflow.com/questions/7376598/)中所要求的是否没有重复项时，您可以使用以下`[every()](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/every)`方法：

```
[1, 2, 3].every((e, i, a) => a.indexOf(e) === i) // true

[1, 2, 1].every((e, i, a) => a.indexOf(e) === i) // false 
```

请注意，这`every()`不适用于 IE 8 及更低版本。

* * *

## 回答 #5

> 赞同：75
> 
> 时间：2016-03-10T16:57:15.940

## 查找数组中的重复值

这应该是在数组中实际查找重复值的最短方法之一。正如 OP 特别要求的那样，**这不会删除重复项，但会找到它们**。

```
var input = [1, 2, 3, 1, 3, 1];

var duplicates = input.reduce(function(acc, el, i, arr) {
  if (arr.indexOf(el) !== i && acc.indexOf(el) < 0) acc.push(el); return acc;
}, []);

document.write(duplicates); // = 1,3 (actual array == [1, 3])
```

这不需要排序或任何第三方框架。它也不需要手动循环。它适用于[indexOf()](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf)（或更清楚地说：[严格比较运算符](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Comparison_Operators#Using_the_Equality_Operators)）支持的每个值。

由于[reduce()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce)和[indexOf()](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf)它至少需要 IE 9。

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2009-05-08T16:54:30.293

您可以添加此函数，或对其进行调整并将其添加到 Javascript 的 Array 原型中：

```
Array.prototype.unique = function () {
    var r = new Array();
    o:for(var i = 0, n = this.length; i < n; i++)
    {
        for(var x = 0, y = r.length; x < y; x++)
        {
            if(r[x]==this[i])
            {
                alert('this is a DUPE!');
                continue o;
            }
        }
        r[r.length] = this[i];
    }
    return r;
}

var arr = [1,2,2,3,3,4,5,6,2,3,7,8,5,9];
var unique = arr.unique();
alert(unique); 
```

* * *

## 回答 #7

> 赞同：28
> 
> 时间：2011-10-28T10:35:15.670

更新：以下使用优化的组合策略。它优化了原始查找以受益于哈希 O(1) 查找时间（`unique`在原始数组上运行是 O(n)）。对象查找通过在迭代时使用唯一 id 标记对象来优化，因此识别重复对象也是每个项目 O(1) 和整个列表的 O(n)。唯一的例外是被冻结的项目，但这些项目很少见，并且使用数组和 indexOf 提供了回退。

```
var unique = function(){
  var hasOwn = {}.hasOwnProperty,
      toString = {}.toString,
      uids = {};

  function uid(){
    var key = Math.random().toString(36).slice(2);
    return key in uids ? uid() : uids[key] = key;
  }

  function unique(array){
    var strings = {}, numbers = {}, others = {},
        tagged = [], failed = [],
        count = 0, i = array.length,
        item, type;

    var id = uid();

    while (i--) {
      item = array[i];
      type = typeof item;
      if (item == null || type !== 'object' && type !== 'function') {
        // primitive
        switch (type) {
          case 'string': strings[item] = true; break;
          case 'number': numbers[item] = true; break;
          default: others[item] = item; break;
        }
      } else {
        // object
        if (!hasOwn.call(item, id)) {
          try {
            item[id] = true;
            tagged[count++] = item;
          } catch (e){
            if (failed.indexOf(item) === -1)
              failed[failed.length] = item;
          }
        }
      }
    }

    // remove the tags
    while (count--)
      delete tagged[count][id];

    tagged = tagged.concat(failed);
    count = tagged.length;

    // append primitives to results
    for (i in strings)
      if (hasOwn.call(strings, i))
        tagged[count++] = i;

    for (i in numbers)
      if (hasOwn.call(numbers, i))
        tagged[count++] = +i;

    for (i in others)
      if (hasOwn.call(others, i))
        tagged[count++] = others[i];

    return tagged;
  }

  return unique;
}(); 
```

如果你有 ES6 Collections 可用，那么会有一个更简单且速度更快的版本。（此处适用于 IE9+ 和其他浏览器的垫片：[https](https://github.com/Benvie/ES6-Harmony-Collections-Shim) ://github.com/Benvie/ES6-Harmony-Collections-Shim ）

```
function unique(array){
  var seen = new Set;
  return array.filter(function(item){
    if (!seen.has(item)) {
      seen.add(item);
      return true;
    }
  });
} 
```

* * *

## 回答 #8

> 赞同：23
> 
> 时间：2015-06-24T04:11:00.487

```
var a = ["a","a","b","c","c"];

a.filter(function(value,index,self){ return (self.indexOf(value) !== index )}) 
```

* * *

## 回答 #9

> 赞同：22
> 
> 时间：2009-05-09T00:00:52.203

这应该让你得到你想要的，只是重复的。

```
function find_duplicates(arr) {
  var len=arr.length,
      out=[],
      counts={};

  for (var i=0;i<len;i++) {
    var item = arr[i];
    counts[item] = counts[item] >= 1 ? counts[item] + 1 : 1;
    if (counts[item] === 2) {
      out.push(item);
    }
  }

  return out;
}

find_duplicates(['one',2,3,4,4,4,5,6,7,7,7,'pig','one']); // -> ['one',4,7] in no particular order. 
```

* * *

## 回答 #10

> 赞同：22
> 
> 时间：2009-12-03T09:29:57.557

# 从 3 个（或更多）数组中查找*非唯一*值：

## ES2015

```
//                             
var arr =  [1,2,2,3,3,4,5,6,2,3,7,8,5,22],
    arr2 = [1,2,511,12,50],
    arr3 = [22,0],
    merged,
    nonUnique;

// Combine all the arrays to a single one
merged = arr.concat(arr2, arr3)

// create a new (dirty) Array with only the non-unique items
nonUnique = merged.filter((item,i) => merged.includes(item, i+1))

// Cleanup - remove duplicate & empty items items 
nonUnique = [...new Set(nonUnique)]

console.log(nonUnique)
```

* * *

## ES2015 之前：

在下面的示例中，我选择在*原型*`unique`之上叠加一个方法，允许从任何地方访问，并且具有更多的*“声明性”*语法。我不建议在大型项目中使用这种方法，因为它很可能会与具有相同自定义名称的另一种方法发生冲突。`Array`

 **```
Array.prototype.unique = function () {
    var arr = this.sort(), i=arr.length; // input must be sorted for this to work
    while(i--)
      arr[i] === arr[i-1] && arr.splice(i,1) // remove duplicate item
    return arr
}

Array.prototype.nonunique = function () {
    var arr = this.sort(), i=arr.length, res = []; // input must be sorted for this to work
    while(i--)
      arr[i] === arr[i-1] && (res.indexOf(arr[i]) == -1) && res.push(arr[i]) 
    return res
}

//                             
var arr =  [1,2,2,3,3,4,5,6,2,3,7,8,5,22],
    arr2 = [1,2,511,12,50],
    arr3 = [22,0],
    // merge all arrays & call custom Array Prototype - "unique"
    unique = arr.concat(arr2, arr3).unique(),
    nonunique = arr.concat(arr2, arr3).nonunique()

console.log(unique)     // [1,12,2,22,3,4,5,50,511,6,7,8]
console.log(nonunique)  // [1,12,2,22,3,4,5,50,511,6,7,8]
```

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2012-09-04T16:12:28.943

使用下划线.js

```
function hasDuplicate(arr){
    return (arr.length != _.uniq(arr).length);
} 
```

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2019-09-13T18:50:34.357

这是我能想到的最简单的解决方案：

```
const arr = [-1, 2, 2, 2, 0, 0, 0, 500, -1, 'a', 'a', 'a']

const filtered = arr.filter((el, index) => arr.indexOf(el) !== index)
// => filtered = [ 2, 2, 0, 0, -1, 'a', 'a' ]

const duplicates = [...new Set(filtered)]

console.log(duplicates)
// => [ 2, 0, -1, 'a' ]
```

就是这样。

**笔记：**

1.  它适用于任何数字`0`，包括字符串和负数，例如`-1`- **相关问题：** [获取 JavaScript 数组中的所有唯一值（删除重复项）](https://stackoverflow.com/questions/1960473)

2.  `arr`保留原始数组（`filter`返回新数组而不是修改原始数组）

3.  该`filtered`数组包含**所有**重复项；它还**可以**包含超过 1 个相同的值（例如，我们的过滤数组是`[ 2, 2, 0, 0, -1, 'a', 'a' ]`）

4.  如果您只想获取重复**的**值（您不希望有多个具有相同值的重复项），您可以使用`[...new Set(filtered)]`（ES6 有一个对象**Set**只能存储唯一值）

希望这可以帮助。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2018-08-13T13:53:00.453

这是我的简单和一条线的解决方案。

它首先搜索非唯一元素，然后使用 Set 使找到的数组唯一。

所以我们最后有重复的数组。

```
var array = [1, 2, 2, 3, 3, 4, 5, 6, 2, 3, 7, 8, 5, 22, 1, 2, 511, 12, 50, 22];

console.log([...new Set(
  array.filter((value, index, self) => self.indexOf(value) !== index))]
);
```

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2018-10-17T14:45:17.013

这是我的建议（ES6）：

```
let a = [1, 2, 3, 4, 2, 2, 4, 1, 5, 6]
let b = [...new Set(a.sort().filter((o, i) => o !== undefined && a[i + 1] !== undefined && o === a[i + 1]))]

// b is now [1, 2, 4] 
```

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2021-07-03T04:20:26.903

最简单快捷的方法是使用`Set`对象：

```
const numbers = [1, 2, 3, 2, 4, 5, 5, 6];

const set = new Set(numbers);

const duplicates = numbers.filter(item => {
    if (set.has(item)) {
        set.delete(item);
    } else {
        return item;
    }
});

console.log(duplicates);
// [ 2, 5 ] 
```

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2018-04-04T23:39:55.500

一个班轮简单的方法

```
var arr = [9,1,2,4,3,4,9]
console.log(arr.filter((ele,indx)=>indx!==arr.indexOf(ele))) //get the duplicates
console.log(arr.filter((ele,indx)=>indx===arr.indexOf(ele))) //remove the duplicates
```

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2011-10-21T22:08:52.560

```
var a = [324,3,32,5,52,2100,1,20,2,3,3,2,2,2,1,1,1].sort();
a.filter(function(v,i,o){return i&&v!==o[i-1]?v:0;}); 
```

或者当添加到 Array 的 prototyp.chain

```
//copy and paste: without error handling
Array.prototype.unique = 
   function(){return this.sort().filter(function(v,i,o){return i&&v!==o[i-1]?v:0;});} 
```

见这里：[https ://gist.github.com/1305056](https://gist.github.com/1305056)

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2018-05-23T07:05:18.927

**使用 es6 对象解构和减少的快速而优雅的方式**

它在 O(n) 中运行（对数组进行 1 次迭代）并且不会重复出现超过 2 次的值

```
const arr = ['hi', 'hi', 'hi', 'bye', 'bye', 'asd']
const {
  dup
} = arr.reduce(
  (acc, curr) => {
    acc.items[curr] = acc.items[curr] ? acc.items[curr] += 1 : 1
    if (acc.items[curr] === 2) acc.dup.push(curr)
    return acc
  }, {
    items: {},
    dup: []
  },
)

console.log(dup)
// ['hi', 'bye']
```

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2019-10-16T14:15:09.650

**最短的香草 JS**：

```
[1,1,2,2,2,3].filter((v,i,a) => a.indexOf(v) !== i) // [1, 2, 2] 
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2021-01-25T18:30:42.287

您可以使用过滤器方法和 indexOf() 来获取所有重复值

```
function duplicate(arr) {
    return duplicateArray = arr.filter((item, index) => arr.indexOf(item) !== index) 
} 
```

**arr.indexOf(item)**将始终返回可以找到给定元素的第一个索引

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2013-05-02T19:15:27.063

这是一个非常轻便的方法：

```
var codes = dc_1.split(',');
var i = codes.length;
while (i--) {
  if (codes.indexOf(codes[i]) != i) {
    codes.splice(i,1);
  }
} 
```

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2017-07-17T17:15:15.343

使用 ES6（或使用 Babel 或 Typescipt），您可以简单地执行以下操作：

```
var duplicates = myArray.filter(i => myArray.filter(ii => ii === i).length > 1); 
```

[https://es6console.com/j58euhbt/](https://es6console.com/j58euhbt/)

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2017-07-30T09:08:17.867

我刚刚想出了一个简单的方法来使用数组过滤器来实现这一点

```
 var list = [9, 9, 111, 2, 3, 4, 4, 5, 7];

    // Filter 1: to find all duplicates elements
    var duplicates = list.filter(function(value,index,self) {
       return self.indexOf(value) !== self.lastIndexOf(value) && self.indexOf(value) === index;
    });

    console.log(duplicates);
```

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2017-09-19T09:13:22.807

具有 ES6 语法的简单代码（返回已排序的重复数组）：

```
let duplicates = a => {d=[]; a.sort((a,b) => a-b).reduce((a,b)=>{a==b&&!d.includes(a)&&d.push(a); return b}); return d}; 
```

如何使用：

```
duplicates([1,2,3,10,10,2,3,3,10]); 
```

* * *

## 回答 #25

> 赞同：4
> 
> 时间：2019-10-11T08:38:26.460

这个答案也可能会有所帮助，它利用 js`reduce` **运算符/方法**从数组中删除**重复项。**

```
const result = [1, 2, 2, 3, 3, 3, 3].reduce((x, y) => x.includes(y) ? x : [...x, y], []);

console.log(result);
```

* * *

## 回答 #26

> 赞同：4
> 
> 时间：2020-03-22T02:36:13.183

排名较高的答案存在一些固有问题，包括使用旧版 javascript、不正确的排序或仅支持 2 个重复项。

这是解决这些问题的现代解决方案：

```
const arrayNonUniq = array => {
    if (!Array.isArray(array)) {
        throw new TypeError("An array must be provided!")
    }

    return array.filter((value, index) => array.indexOf(value) === index && array.lastIndexOf(value) !== index)
}

arrayNonUniq([1, 1, 2, 3, 3])
//=> [1, 3]

arrayNonUniq(["foo", "foo", "bar", "foo"])
//=> ['foo'] 
```

您也可以使用 npm 包[`array-non-uniq`](https://www.npmjs.com/package/array-non-uniq)。

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2009-05-09T01:02:41.027

以下函数（已经提到的消除重复函数的变体）似乎可以解决问题，为输入 ["test", "test2", "test2", 1, 1, 1, 2 返回 test2,1,7,5 , 3, 4, 5, 6, 7, 7, 10, 22, 43, 1, 5, 8]

请注意，JavaScript 中的问题比大多数其他语言中的问题更奇怪，因为 JavaScript 数组几乎可以容纳任何东西。请注意，使用排序的解决方案可能需要提供适当的排序功能——我还没有尝试过这条路线。

此特定实现适用于（至少）字符串和数字。

```
function findDuplicates(arr) {
    var i,
        len=arr.length,
        out=[],
        obj={};

    for (i=0;i<len;i++) {
        if (obj[arr[i]] != null) {
            if (!obj[arr[i]]) {
                out.push(arr[i]);
                obj[arr[i]] = 1;
            }
        } else {
            obj[arr[i]] = 0;            
        }
    }
    return out;
} 
```

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2012-07-31T09:45:04.963

仅限 ES5（即，它需要 IE8 及以下版本的 filter() polyfill）：

```
var arrayToFilter = [ 4, 5, 5, 5, 2, 1, 3, 1, 1, 2, 1, 3 ];

arrayToFilter.
    sort().
    filter( function(me,i,arr){
       return (i===0) || ( me !== arr[i-1] );
    }); 
```

* * *

## 回答 #29

> 赞同：3
> 
> 时间：2014-08-02T12:22:27.393

**这可能是从数组中永久删除重复项的最快方法之一，** 比这里的大多数函数快 10 倍。在 safari 中快 78 倍

```
function toUnique(a,b,c){//array,placeholder,placeholder
 b=a.length;
 while(c=--b)while(c--)a[b]!==a[c]||a.splice(c,1)
}
var array=[1,2,3,4,5,6,7,8,9,0,1,2,1];
toUnique(array);
console.log(array); 
```

1.  测试：http: [//jsperf.com/wgu](http://jsperf.com/wgu)
2.  演示：http: [//jsfiddle.net/46S7g/](http://jsfiddle.net/46S7g/)
3.  更多：[https ://stackoverflow.com/a/25082874/2450730](https://stackoverflow.com/a/25082874/2450730)

如果您无法阅读上面的代码，请阅读 javascript 书籍或这里有一些关于较短代码的解释。[https://stackoverflow.com/a/21353032/2450730](https://stackoverflow.com/a/21353032/2450730)

**编辑** 如评论中所述，此函数确实返回具有唯一性的数组，但问题要求查找重复项。在这种情况下，对该函数的简单修改允许将重复项推送到数组中，然后使用前一个函数`toUnique`删除重复项的重复项。

```
function theDuplicates(a,b,c,d){//array,placeholder,placeholder
 b=a.length,d=[];
 while(c=--b)while(c--)a[b]!==a[c]||d.push(a.splice(c,1))
}
var array=[1,2,3,4,5,6,7,8,9,0,1,2,1];

toUnique(theDuplicates(array)); 
```

* * *

## 回答 #30

> 赞同：3
> 
> 时间：2015-11-03T00:49:51.773

```
var arr = [2, 1, 2, 2, 4, 4, 2, 5];

function returnDuplicates(arr) {
  return arr.reduce(function(dupes, val, i) {
    if (arr.indexOf(val) !== i && dupes.indexOf(val) === -1) {
      dupes.push(val);
    }
    return dupes;
  }, []);
}

alert(returnDuplicates(arr));
```

此函数**避免了排序步骤**，并使用 reduce() 方法将重复项推送到新数组中（如果它尚不存在）。

* * *

## 回答 #31

> 赞同：3
> 
> 时间：2016-08-12T08:31:55.373

使用“包含”来测试元素是否已经存在。

```
var arr = [1, 1, 4, 5, 5], darr = [], duplicates = [];

for(var i = 0; i < arr.length; i++){
  if(darr.includes(arr[i]) && !duplicates.includes(arr[i]))
    duplicates.push(arr[i])
  else
    darr.push(arr[i]);
}

console.log(duplicates);
```

```
<h3>Array with duplicates</h3>
<p>[1, 1, 4, 5, 5]</p>
<h3>Array with distinct elements</h3>
<p>[1, 4, 5]</p>
<h3>duplicate values are</h3>
<p>[1, 5]</p>
```

* * *

## 回答 #32

> 赞同：3
> 
> 时间：2016-09-04T06:23:58.083

ES6 提供了 Set 数据结构，它基本上是一个不接受重复的数组。使用 Set 数据结构，有一种非常简单的方法可以在数组中查找重复项（仅使用一个循环）。

这是我的代码

```
function findDuplicate(arr) {
var set = new Set();
var duplicates = new Set();
  for (let i = 0; i< arr.length; i++) {
     var size = set.size;
     set.add(arr[i]);
     if (set.size === size) {
         duplicates.add(arr[i]);
     }
  }
 return duplicates;
} 
```

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2018-04-27T08:32:12.703

**遵循逻辑将更容易和更快**

```
// @Param:data:Array that is the source 
// @Return : Array that have the duplicate entries
findDuplicates(data: Array<any>): Array<any> {
        return Array.from(new Set(data)).filter((value) => data.indexOf(value) !== data.lastIndexOf(value));
      } 
```

**好处 ：**

1.  单行：-P
2.  所有内置数据结构有助于提高效率
3.  快点

**逻辑说明：**

1.  转换为设置以删除所有重复项
2.  遍历设定值
3.  使用源数组中的每个设置值检查条件“值第一个索引不等于最后一个索引”==> 然后推断为重复，否则它是“唯一的”

**注意：** map() 和 filter() 方法高效且快速。

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2009-05-09T00:12:16.980

只是在上面添加一些理论。

在比较模型中，查找重复项的下限为 O(n*log(n)。所以理论上，您不能做得比第一次排序然后依次通过列表删除找到的任何重复项更好。

如果您想在线性 (O(n)) *预期*时间内找到重复项，您可以散列列表的每个元素；如果发生冲突，请将其删除/标记为重复项，然后继续。

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2011-05-06T10:23:17.940

我更喜欢这样做的功能方式。

```
function removeDuplicates(links) {
    return _.reduce(links, function(list, elem) { 
        if (list.indexOf(elem) == -1) {
            list.push(elem);
        }   
        return list;
    }, []);
} 
```

这使用下划线，但 Array 也有一个[`reduce`](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/Reduce)功能

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2013-01-15T22:49:56.937

```
var input = ['a', 'b', 'a', 'c', 'c'],
    duplicates = [],
    i, j;
for (i = 0, j = input.length; i < j; i++) {
  if (duplicates.indexOf(input[i]) === -1 && input.indexOf(input[i], i+1) !== -1) {
    duplicates.push(input[i]);
  }
}

console.log(duplicates); 
```

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2013-05-23T14:17:23.693

我认为以下是完成您所要求的最简单和最快的 O(n) 方法：

```
function getDuplicates( arr ) {
  var i, value;
  var all = {};
  var duplicates = [];

  for( i=0; i<arr.length; i++ ) {
    value = arr[i];
    if( all[value] ) {
      duplicates.push( value );
      all[value] = false;
    } else if( typeof all[value] == "undefined" ) {
      all[value] = true;
    }
  }

  return duplicates;
} 
```

或者对于 ES5 或更高版本：

```
function getDuplicates( arr ) {
  var all = {};
  return arr.reduce(function( duplicates, value ) {
    if( all[value] ) {
      duplicates.push(value);
      all[value] = false;
    } else if( typeof all[value] == "undefined" ) {
      all[value] = true;
    }
    return duplicates;
  }, []);
} 
```

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2014-04-02T07:31:34.940

修改@RaphaelMontanaro 的解决方案，借鉴@Nosredna 的博客，如果您只想识别数组中的重复元素，可以这样做。

```
function identifyDuplicatesFromArray(arr) {
        var i;
        var len = arr.length;
        var obj = {};
        var duplicates = [];

        for (i = 0; i < len; i++) {

            if (!obj[arr[i]]) {

                obj[arr[i]] = {};

            }

            else
            {
                duplicates.push(arr[i]);
            }

        }
        return duplicates;
    } 
```

感谢@Nosredna 提供优雅的解决方案！

* * *

## 回答 #39

> 赞同：2
> 
> 时间：2014-05-26T19:58:30.730

我不喜欢大多数答案。

为什么？太复杂，代码太多，代码效率低下，很多都没有回答这个问题，即找到重复项（而不是给出一个没有重复项的数组）。

Next 函数返回所有重复项：

```
function GetDuplicates(arr) {
  var i, out=[], obj={};
  for (i=0; i < arr.length; i++) 
    obj[arr[i]] == undefined ? obj[arr[i]] ++ : out.push(arr[i]);
  return out;
} 
```

因为大多数时候返回所有重复值是没有用的，而只是告诉存在哪些重复值。在这种情况下，您返回一个具有唯一重复项的数组；-)

```
function GetDuplicates(arr) {
  var i, out=[], obj={};
  for (i=0; i < arr.length; i++)
    obj[arr[i]] == undefined ? obj[arr[i]] ++ : out.push(arr[i]);
  return GetUnique(out);
}

function GetUnique(arr) {
  return $.grep(arr, function(elem, index) {
    return index == $.inArray(elem, arr);
  });
} 
```

也许其他人也有同样的想法。

* * *

## 回答 #40

> 赞同：2
> 
> 时间：2016-02-06T08:01:54.257

以 O(n) 时间复杂度解决上述问题（无需排序）。

```
var arr = [9, 9, 111, 2, 3, 4, 4, 5, 7];

var obj={};

for(var i=0;i<arr.length;i++){
    if(!obj[arr[i]]){
        obj[arr[i]]=1;
    } else {
        obj[arr[i]]=obj[arr[i]]+1;
    }
}
var result=[]
for(var key in obj){
    if(obj[key]>1){
        result.push(Number(key)) // change this to result.push(key) to find duplicate strings in an array
    }
}

console.log(result) 
```

* * *

## 回答 #41

> 赞同：2
> 
> 时间：2016-08-19T21:20:10.127

```
function GetDuplicates(arr) {
    var i = 0, m = [];
    return arr.filter(function (n) {
        return !m[n] * ~arr.indexOf(n, m[n] = ++i);
    });
} 
```

* * *

## 回答 #42

> 赞同：2
> 
> 时间：2017-04-21T13:45:45.930

我觉得最简单的解决方案就是使用 indexOf

仅将唯一元素推送到数组的完整示例。

```
var arr = ['a','b','c','d','a','b','c','d'];
var newA = [];
for(var i = 0; i < arr.length; i++){
    if(newA.indexOf(arr[i]) === -1){
        newA.push(arr[i]);
    }
 } 
```

* * *

## 回答 #43

> 赞同：2
> 
> 时间：2018-11-28T19:35:35.680

## 魔法

```
a.filter(( t={}, e=>!(1-(t[e]=++t[e]|0)) )) 
```

**O(n) 性能**；我们假设您的数组在其中，`a`并且它包含可以`.toString()`以独特方式转换的元素（由 JS in 隐式完成`t[e]`）例如 numbers=[4,5,4], strings=["aa","bb","aa "], arraysNum=[[1,2,3], [43,2,3],[1,2,3]]。解释[在这里](https://stackoverflow.com/a/53453045/860099)，唯一值[在这里](https://stackoverflow.com/a/53526999/860099)

```
var a1 = [[2, 17], [2, 17], [2, 17], [1, 12], [5, 9], [1, 12], [6, 2], [1, 12]];
var a2 = ['Mike', 'Adam','Matt', 'Nancy', 'Adam', 'Jenny', 'Nancy', 'Carl'];
var a3 = [5,6,4,9,2,3,5,3,4,1,5,4,9];

let nd = (a) => a.filter((t={},e=>!(1-(t[e]=++t[e]|0)))) 

// Print
let c= x => console.log(JSON.stringify(x));             
c( nd(a1) );
c( nd(a2) );
c( nd(a3) );
```

* * *

## 回答 #44

> 赞同：2
> 
> 时间：2019-09-30T11:24:22.003

有一个非常简单的方法可以解决这个问题。如果您使用新的“设置”javascript 命令。Set 可以将一个数组作为输入并输出一个仅包含唯一值的新“Set”。然后通过比较数组的长度和集合的“大小”属性，您可以查看它们是否不同。如果它们不同，则一定是由于重复条目。

```
var array1 = ['value1','value2','value3','value1']; // contains duplicates
var array2 = ['value1','value2','value3','value4']; // unique values

console.log('array1 contains duplicates = ' + containsDuplicates(array1));
console.log('array2 contains duplicates = ' + containsDuplicates(array2));

function containsDuplicates(passedArray) {
  let mySet = new Set(passedArray);
  if (mySet.size !== passedArray.length) {
    return true;
  }
  return false;
}
```

如果你运行上面的代码片段，你会得到这个输出。

array1 包含重复项 = true

array2 包含重复项 = false

* * *

## 回答 #45

> 赞同：1
> 
> 时间：2013-04-07T21:29:06.063

使用下划线的另一种方式。Numbers 是源数组，dupes 可能有重复值。

```
var itemcounts = _.countBy(numbers, function (n) { return n; });
var dupes = _.reduce(itemcounts, function (memo, item, idx) {
    if (item > 1)
        memo.push(idx);
    return memo;
}, []); 
```

* * *

## 回答 #46

> 赞同：1
> 
> 时间：2015-08-02T07:30:36.860

与其他一些答案类似，但我曾经[`forEach()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach)让它更漂亮一点：

```
function find_duplicates(data) {

    var track = {};
    var duplicates = [];

    data.forEach(function (item) {
        !track[item] ? track[item] = true : duplicates.push(item);
    });

    return duplicates;
} 
```

如果一个值多次重复，则返回其所有重复项，如下所示：

```
find_duplicates(['foo', 'foo', 'bar', 'bar', 'bar']);
// returns ['foo', 'bar', 'bar'] 
```

这可能是您想要的，否则您只需要遵循“唯一”过滤即可。

* * *

## 回答 #47

> 赞同：1
> 
> 时间：2017-07-19T04:40:38.593

最快的解决方法实际上是用一个标志

```
var values = [4,2,3,1,4]

// solution
const checkDuplicate = list => {
  var hasDuplicate = false;
  list.sort().sort((a, b) => {
    if (a === b) hasDuplicate = true
  })
  return hasDuplicate
}

console.log(checkDuplicate(values))
```

* * *

## 回答 #48

> 赞同：1
> 
> 时间：2017-08-03T23:24:35.990

这也可以使用`Set()`.

**Set 中的一个值只能出现一次；**它在 Set 的系列中是独一无二的。

```
 Array.prototype.hasDuplicates = function () {
        if (arr.length !== (new Set(arr).size)) {
            return true;
        }
        return false;
    } 
```

更多关于 Set 的信息： [https ://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set)

***注意：*** *IE 不完全支持集合。*

* * *

## 回答 #49

> 赞同：1
> 
> 时间：2017-11-20T09:16:17.557

这是我能想到的简单 ES5 解决方案之一——

```
function duplicates(arr) {
  var duplicatesArr = [],
      uniqueObj = {};

  for (var i = 0; i < arr.length; i++) {
    if( uniqueObj.hasOwnProperty(arr[i]) && duplicatesArr.indexOf( arr[i] ) === -1) {
      duplicatesArr.push( arr[i] );
    }
    else {
      uniqueObj[ arr[i] ] = true;
    }
  }

  return duplicatesArr;
}
/* Input Arr: [1,1,2,2,2,1,3,4,5,3] */
/* OutPut Arr: [1,2,3] */ 
```

* * *

## 回答 #50

> 赞同：1
> 
> 时间：2018-06-08T06:37:54.687

```
//find duplicates:
//sort, then reduce - concat values equal previous element, skip others

//input
var a = [1, 2, 3, 1, 2, 1, 2]

//short version:
var duplicates = a.sort().reduce((d, v, i, a) => i && v === a[i - 1] ? d.concat(v) : d, [])
console.log(duplicates); //[1, 1, 2, 2]

//readable version:
var duplicates = a.sort().reduce((output, element, index, input) => {
  if ((index > 0) && (element === input[index - 1]))
    return output.concat(element)
  return output
}, [])
console.log(duplicates); //[1, 1, 2, 2]
```

* * *

## 回答 #51

> 赞同：1
> 
> 时间：2018-07-14T22:14:10.470

1.  打印重复值

```
 var arr = [1,2,3,4,13,2,3,4,3,4];

    // non_unique Printing 
    function nonUnique(arr){
    var result = [];
    for(var i =0;i<arr.length;i++){
        if(arr.indexOf(arr[i],i+1) > -1){
            result.push(arr[i]);
        }
    }
    console.log(result);
    }nonUnique(arr);

    // unique Printing
    function uniqueDuplicateVal(arr){
       var result = [];
       for(var i =0;i<arr.length;i++){
        if(arr.indexOf(arr[i],i+1) > -1){
          if(result.indexOf(arr[i]) === -1]){
             result.push(arr[i]);
          }
        }
       }    
    }
    uniqueDuplicateVal(arr)
```

* * *

## 回答 #52

> 赞同：1
> 
> 时间：2018-10-25T11:51:34.443

这应该是在数组中实际查找重复值的最短和最简单的方法之一。

```
var arr = [1,2,3,4,5,6,7,8,1,2,3,4,5,3,3,4];
var data = arr.filter(function(item,index,arr){
  return arr.indexOf(item) != arr.lastIndexOf(item) && arr.indexOf(item) == index;
})

console.log(data );
```

* * *

## 回答 #53

> 赞同：1
> 
> 时间：2018-11-23T20:59:48.740

这是我能想到的最有效的方法，因为它不包括`Array.indexOf()`或`Array.lastIndexOf()`具有 O(n) 的复杂性，并且在任何复杂性 O(n) 的循环中使用都会使完全复杂性 O(n^2)。

我的第一个循环的复杂度为 O(n/2) 或 O((n/2) + 1)，因为哈希中搜索的复杂度为 O(1)。当数组中没有重复时，第二个循环的最差复杂度是 O(n)，每个元素都有重复时的最佳复杂度是 O(n/2)。

```
function duplicates(arr) {
  let duplicates = [],
      d = {},
      i = 0,
      j = arr.length - 1;

  // Complexity O(n/2)
  while (i <= j) {
    if (i === j)
      d[arr[i]] ? d[arr[i]] += 1 : d[arr[i]] = 1;  // Complexity O(1)
    else {
      d[arr[i]] ? d[arr[i]] += 1 : d[arr[i]] = 1;  // Complexity O(1)
      d[arr[j]] ? d[arr[j]] += 1 : d[arr[j]] = 1;  // Complexity O(1)
    }

    ++i;
    --j;
  }

  // Worst complexity O(n), best complexity O(n/2)
  for (let k in d) {
    if (d[k] > 1)
      duplicates.push(k);
  }

  return duplicates;

}

console.log(duplicates([5,6,4,9,2,3,5,3,4,1,5,4,9]));
console.log(duplicates([2,3,4,5,4,3,4]));
console.log(duplicates([4,5,2,9]));
console.log(duplicates([4,5,2,9,2,5,9,4])); 
```

* * *

## 回答 #54

> 赞同：1
> 
> 时间：2018-11-30T17:59:00.430

这是一个带有哈希表的单循环方法，用于计算元素并在计数为 时过滤数组`2`，因为它返回第一个找到的重复项。

优势：

*   单回路
*   在闭包中使用对象进行计数

```
var array = [5, 0, 2, 1, 2, 3, 3, 4, 4, 8, 6, 7, 9, 4],
    duplicates = array.filter((h => v => (h[v] = (h[v] || 0) + 1) === 2)({}));

console.log(duplicates);
```

* * *

## 回答 #55

> 赞同：1
> 
> 时间：2019-10-24T08:21:31.197

您可以使用`sort`,`filter`来`sets`做到这一点。

```
var numbers = [1,2,3,4,5,6,7,8,1,2,3,4,5,3,3,4];
var numbersSorted = numbers.sort();
let result = numbers.filter((e, i) => numbers[i] == numbers[i+1]);
result = [...new Set(result)];
console.log(result);
```

* * *

## 回答 #56

> 赞同：1
> 
> 时间：2020-08-01T18:37:48.770

基于@bluemoon 但更短，只返回一次所有重复项！

```
function checkDuplicateKeys(arr) {
    const counts = {}
    return arr.filter((item) => {
        counts[item] = counts[item] || 1
        if (counts[item]++ === 2) return true
    })
}

// [1,2,2,2,2,2,2] => [1,2]
// ['dog', 'dog', 'cat'] => ['dog'] 
```

* * *

## 回答 #57

> 赞同：1
> 
> 时间：2021-10-04T11:20:57.470

```
const names = [
  "Alex",
  "Matt",
  12,
  "You",
  "Me",
  12,
  "Carol",
  "Bike",
  "Carol",
];

const count = (names) =>
  names.reduce((a, b) => ({ ...a, [b]: (a[b] || 0) + 1 }), {});

let obj = count(names);
let objectKeys = Object.keys(obj);

let repetitiveElements = [];
let answer = objectKeys.map((value) => {
  if (obj[value] > 1) {
    return repetitiveElements.push(value);
  }
});
console.log(repetitiveElements); 
```

* * *

## 回答 #58

> 赞同：1
> 
> 时间：2021-10-16T09:37:24.197

已经有很多答案了，但不幸的是有些太长了，有些很短但对我来说太神秘了，而另一些则超出了我的知识范围......不过，我真的很喜欢我提出的这个解决方案。希望它对某些人仍然有帮助！

尽管原始帖子说他/她实际上并不需要重复的索引或重复的次数，但我认为将它们计数仍然是最清楚的。

带注释的代码。

```
function findDuplicates(array, count = {}) {
  // with count declared in the parameter, initialized as an empty object, 
  // it can store the counts of all elements in array  

  // using the forEach loop to iterate through the input array, 
  // also using the conditional ternary operators 
  // (works just like a normal if-else statement, but just a bit cleaner)
  // we can store all occurrences of each element from array in count
  array.forEach(el => count[el] ? count[el]++ : count[el] = 1)

  // using Object.keys, we get an array of all keys from count (all numbers) 
  // (sorted as well, though of no specific importance here)
  // using filter to find all elements with a count (value) > 1 (duplicates!)
  return Object.keys(count).filter(key => count[key] > 1);
} 
```

只是代码（带有测试用例）。

```
function findDuplicates(array, count = {}) {
  array.forEach(el => count[el] ? count[el]++ : count[el] = 1);
  return Object.keys(count).filter(key => count[key] > 1);
}

let arr1 = [9, 9, 111, 2, 3, 4, 4, 5, 7];
let arr2 = [1,6,7,3,6,8,1,3,4,5,1,7,2,6];
console.log(findDuplicates(arr1)); // => ['4', '9']
console.log(findDuplicates(arr2)); // => ['1', '3', '6', '7']
```

* * *

## 回答 #59

> 赞同：1
> 
> 时间：2021-11-16T10:48:52.590

这个问题有这么多错误的答案或答案，这实际上是一种耻辱，需要像 Set 这样的大量额外记忆。干净简单的解决方案：

```
function findDuplicates<T>(arr: Array<T>): T[] {
  //If the array has less than 2 elements there are no duplicates
  const n = arr.length;
  if (n < 2)
    return [];

  const sorted = arr.sort();
  const result = [];

  //Head
  if (sorted[0] === sorted[1])
    result.push(sorted[0]);

  //Inner (Head :: Inner :: Tail)
  for (let i = 1; i < n-1; i++) {
    const elem = sorted[i];
    if (elem === sorted[i - 1] || elem === sorted[i+1])
      result.push(elem)
  }

  //Tail
  if (sorted[n - 1] == sorted[n - 2])
    result.push(sorted[n - 1]);

  return result;
}

console.dir(findDuplicates(['a', 'a', 'b', 'b']));
console.dir(findDuplicates(['a', 'b']));
console.dir(findDuplicates(['a', 'a', 'a']));
console.dir(findDuplicates(['a']));
console.dir(findDuplicates([])); 
```

* * *

## 回答 #60

> 赞同：0
> 
> 时间：2009-05-08T16:54:19.077

Prototype 库有一个[uniq](http://www.prototypejs.org/api/array/uniq)函数，它返回没有欺骗的数组。但这只是工作的一半。

* * *

## 回答 #61

> 赞同：0
> 
> 时间：2009-05-09T15:15:21.110

/* Array 对象的 indexOf 方法对于比较数组项很有用。IE是唯一不原生支持的主流浏览器，但是实现起来很简单：*/

```
Array.prototype.indexOf= Array.prototype.indexOf || function(what, i){
    i= i || 0;
    var L= this.length;
    while(i<L){
        if(this[i]=== what) return i;
        ++i;
    }
    return -1;
}

function getarrayduplicates(arg){
    var itm, A= arg.slice(0, arg.length), dups= [];
    while(A.length){
        itm= A.shift();
        if(A.indexOf(itm)!= -1 && dups.indexOf(itm)== -1){
            dups[dups.length]= itm;
        }
    }
    return dups;
} 
```

var a1= [1, 22, 3, 2, 2, 3, 3, 4, 1, 22, 7, 8, 9];

警报（getarrayduplicates（a1））；

对于非常大的数组，在找到重复项时从数组中删除它们会更快，这样就不会再次查看它们：

```
function getarrayduplicates(arg){
    var itm, A= arg.slice(0, arg.length), dups= [];
    while(A.length){
        itm= A.shift();
        if(A.indexOf(itm)!= -1){
            dups[dups.length]= itm;
            while(A.indexOf(itm)!= -1){
                A.splice(A.indexOf(itm), 1);
            }
        }
    }
    return dups;
} 
```

* * *

## 回答 #62

> 赞同：0
> 
> 时间：2011-03-27T19:15:35.823

从 Raphael Montanaro 的回答中，可以改进与数组/对象项的使用，如下所示。

```
function eliminateDuplicates(arr) {
  var len = arr.length,
      out = [],
      obj = {};

  for (var key, i=0; i < len; i++) {
    key = JSON.stringify(arr[i]);
    obj[key] = (obj[key]) ? obj[key] + 1 : 1;
  }
  for (var key in obj) {
    out.push(JSON.parse(key));
  }
  return [out, obj];
} 
```

注意：对于不支持 JSON 的浏览器，您需要使用 JSON 库。

* * *

## 回答 #63

> 赞同：0
> 
> 时间：2011-09-11T06:53:41.823

[http://jsfiddle.net/vol7ron/gfJ28/](http://jsfiddle.net/vol7ron/gfJ28/)

```
var arr  = ['hello','goodbye','foo','hello','foo','bar',1,2,3,4,5,6,7,8,9,0,1,2,3];
var hash = [];

// build hash
for (var n=arr.length; n--; ){
   if (typeof hash[arr[n]] === 'undefined') hash[arr[n]] = [];
   hash[arr[n]].push(n);
}

// work with compiled hash (not necessary)
var duplicates = [];
for (var key in hash){
    if (hash.hasOwnProperty(key) && hash[key].length > 1){
        duplicates.push(key);
    }
}    
alert(duplicates); 
```

1.  结果将是`hash`数组，它将包含一组唯一的值和这些值的位置。所以如果有2个或更多位置，我们可以确定该值有重复。因此，每一个地方`hash[<value>].length > 1`，都表示一个副本。

2.  `hash['hello']`将返回`[0,3]`，因为在节点 0 和 3 中找到了 'hello' `arr[]`。

    ***注意：**长度`[0,3]`是用来确定它是否是重复的。*

3.  使用`for(var key in hash){ if (hash.hasOwnProperty(key)){ alert(key); } }`将提醒每个唯一值。

* * *

## 回答 #64

> 赞同：0
> 
> 时间：2013-02-04T09:00:40.423

这是避免重复到 javascript 数组中的一种方法……它支持字符串和数字……

```
 var unique = function(origArr) {
    var newArray = [],
        origLen = origArr.length,
        found,
        x = 0; y = 0;

    for ( x = 0; x < origLen; x++ ) {
        found = undefined;
        for ( y = 0; y < newArray.length; y++ ) {
            if ( origArr[x] === newArray[y] ) found = true;
        }
        if ( !found) newArray.push( origArr[x] );    
    }
   return newArray;
} 
```

检查这个[小提琴](http://jsfiddle.net/V9RBE/4/)..

* * *

## 回答 #65

> 赞同：0
> 
> 时间：2013-02-14T22:57:19.647

我正在尝试改进@swilliams 的答案，这将返回一个没有重复的数组。

```
// arrays for testing
var arr = [9, 9, 111, 2, 3, 4, 4, 5, 7];

// ascending order
var sorted_arr = arr.sort(function(a,b){return a-b;}); 

var arr_length = arr.length;
var results = [];
if(arr_length){
    if(arr_length == 1){
        results = arr;
    }else{
        for (var i = 0; i < arr.length - 1; i++) {
            if (sorted_arr[i + 1] != sorted_arr[i]) {
                results.push(sorted_arr[i]);
            }
            // for last element
            if (i == arr.length - 2){
                results.push(sorted_arr[i+1]);
            }
        }
    }
}

alert(results); 
```

* * *

## 回答 #66

> 赞同：0
> 
> 时间：2013-11-22T11:49:28.667

这是一个使用 sort() 和 JSON.stringify() 实现的

[https://gist.github.com/korczis/7598657](https://gist.github.com/korczis/7598657)

```
function removeDuplicates(vals) {
    var res = [];
    var tmp = vals.sort();

    for (var i = 0; i < tmp.length; i++) {
        res.push(tmp[i]);
                    while (JSON.stringify(tmp[i]) == JSON.stringify(tmp[i + 1])) {
            i++;
        }
    }

    return res;
}
console.log(removeDuplicates([1,2,3,4,5,4,3,3,2,1,])); 
```

* * *

## 回答 #67

> 赞同：0
> 
> 时间：2016-06-21T06:41:43.567

这是一个简单的小片段，可以在没有排序和两个循环的情况下查找唯一值和重复值。

```
var _unique = function (arr) {
    var h = [], t = [];
    arr.forEach(function (n) {
        if (h.indexOf(n) == -1)
            h.push(n);
        else t.push(n);
    });
    return [h, t];
}
var result = _unique(["test",1,4,2,34,6,21,3,4,"test","prince","th",34]);
console.log("Has duplicate values : " + (result[1].length > 0))  //and you can check count of duplicate values
console.log(result[0]) //unique values
console.log(result[1]) //duplicate values
```

* * *

## 回答 #68

> 赞同：0
> 
> 时间：2017-03-21T15:14:33.630

您可以使用以下构造：

```
var arr = [1,2,3,4,5,6,7,8,9,0,5];
var duplicate = arr.filter(function(item, i, arr) {
  return -1 !== arr.indexOf(item, i + 1);
}) 
```

* * *

## 回答 #69

> 赞同：0
> 
> 时间：2017-05-11T12:59:42.903

使用纯 Js

```
function arr(){
  var a= [1,2,3,4,5,34,2,5,7,8,6,4,3,25,8,34,56,7,8,76,4,23,34,46,575,8564,53,5345657566];
  var b= [];
  b.push(a[0]);
  var z=0;

  for(var i=0; i< a.length; i++){
      for(var j=0; j< b.length; j++){
        if(b[j] == a[i]){
          z = 0;
          break;
        }
        else
          z = 1;
      }
      if(z)
        b.push(a[i]);
    }
  console.log(b);
} 
```

* * *

## 回答 #70

> 赞同：0
> 
> 时间：2017-07-10T07:36:52.277

```
var isUnique = true;      
for (var i= 0; i< targetItems.length; i++) {
        var itemValue = $(targetItems[i]).val();
        if (targetListValues.indexOf(itemValue) >= 0) {
          isUnique = false;
           break;
        }
      targetListValues.push(itemValue);
        if (!isUnique) {
          //raise any error msg
          return false;
        }
      } 
```

* * *

## 回答 #71

> 赞同：0
> 
> 时间：2017-08-31T23:24:58.817

在这里，我们每个重复只输出一次重复。

```
var arr = [9, 9, 9, 9, 111, 2, 3, 4, 4, 5, 7];
arr.sort(); 

var results = [];
for (var i = 0; i < arr.length - 1; i++) {
    if (arr[i + 1] == arr[i]) {
        results.push(arr[i]);
    }
}

results = Array.from(new Set(results))

console.log(results);
```

* * *

## 回答 #72

> 赞同：0
> 
> 时间：2018-04-19T10:46:08.673

这是基于出现次数的更高级的功能。

```
function getMostDuplicated(arr, count) {
      const result = [];
      arr.forEach((item) => {
        let i = 0;
        arr.forEach((checkTo) => {
          if (item === checkTo) {
            i++;
            if (i === count && result.indexOf(item) === -1) {
              result.push(item);
            }
          }
        });
      });
      return result;
}

arr = [1,1,1,2,5,67,3,2,3,2,3,1,2,3,4,1,4];
result = getMostDuplicated(arr, 5); // result is 1
result = getMostDuplicated(arr, 2); // result 1, 2, 3, 4
console.log(result); 
```

* * *

## 回答 #73

> 赞同：0
> 
> 时间：2018-09-22T21:33:34.957

这就是我用地图实现它的方式。它应该在 O(n) 时间内运行并且应该很容易喘气。

```
 var first_array=[1,1,2,3,4,4,5,6];
    var find_dup=new Map;

    for (const iterator of first_array) {
            // if present value++
            if(find_dup.has(iterator)){ 
                find_dup.set(iterator,find_dup.get(iterator)+1); 
            }else{
            // else add it
                find_dup.set(iterator,1);
            }
        }
    console.log(find_dup.get(2));
```

然后你可以`find_dup.get(key)`找到它是否有重复（它应该给出> 1）。

* * *

## 回答 #74

> 赞同：0
> 
> 时间：2018-11-01T00:34:57.580

返回重复项并保留数据类型。

### 具有 O(4n) 性能

```
const dupes = arr => {
  const map = arr.reduce((map, curr) => {
    return (map.set(curr, (map.get(curr) || 0) + 1), map)
  }, new Map());

  return Array.from(map).filter(([key, val])=> val > 1).map(([key, val]) => key)
} 
```

### 具有 O(2n) 性能

```
const dupes = arr => {
  const map = arr.reduce((map, curr) => {
    return (map.set(curr, (map.get(curr) || 0) + 1), map)
  }, new Map());

  const dupes_ = [];
  for (let [key, val] of map.entries()) {
    if (val > 1) dupes_.push(key);
  }
  return dupes_;
} 
```

* * *

## 回答 #75

> 赞同：0
> 
> 时间：2019-02-27T05:20:00.947

**从数组/字符串中获取重复值/重复值的最简单方法：**

```
function getDuplicates(param) {
  var duplicates = {}

  for (var i = 0; i < param.length; i++) {
    var char = param[i]
    if (duplicates[char]) {
      duplicates[char]++
    } else {
      duplicates[char] = 1
    }
  }
  return duplicates
}

console.log(getDuplicates("aeiouaeiou"));
console.log(getDuplicates(["a", "e", "i", "o", "u", "a", "e"]));
console.log(getDuplicates([1, 2, 3, 4, 5, 1, 1, 2, 3]));
```

* * *

## 回答 #76

> 赞同：0
> 
> 时间：2019-05-23T18:12:14.373

这将从数组中返回重复项作为重复项数组。

```
 const duplicates = function(arr) {
      // let try moving in pairs.. maybe that will work
      let dups = new Set(),
          r = []
      arr.sort()
      arr.reduce((pv, cv) => {
        if (pv === cv) {
          dups.add(pv)
        }
        return cv
      })
      for (let m of dups.values()) {
        r.push(m)
      }
      return r
    }

    console.log(duplicates([1,3,5,6,7,4,4,5,1,4,6,3,8,9,5,0]))
```

* * *

## 回答 #77

> 赞同：0
> 
> 时间：2020-04-17T15:35:16.647

很简单的方法：

```
function getDuplicateValues(someArray) {
	const duplicateValues = new Set([])
	const check = new Set([])
	someArray.forEach(v => {
		if (check.has(v)) {
			duplicateValues.add(v)
		} else {
			check.add(v)
		}
	})
	return Array.from(duplicateValues);
}

const result = getDuplicateValues(['coffee', 'soda', 'water', 'juice', 'water', 'water', 'coffee'])

repeated_values.textContent = JSON.stringify(result, null, '  ')
```

```
<pre id="repeated_values"></pre>
```

* * *

## 回答 #78

> 赞同：0
> 
> 时间：2020-08-31T09:39:21.410

公认的答案是最完美的答案，但正如一些用户指出的那样，对于一个元素重复超过 2 次的情况，它将为我们提供包含重复元素的数组：

该解决方案也涵盖了这些场景::

```
const peoples = [
  {id: 1, name:"Arjun"},
  {id: 2, name:"quinze"},
  {id: 3, name:"catorze"},
  {id: 1, name:"Arjun"},
  {id: 4, name:"dezesseis"},
  {id: 1, name:"Arjun"},
  {id: 2, name:"quinze"},
  {id: 3, name:"catorzee"}
]

function repeated(ppl){

  const newppl = ppl.slice().sort((a,b) => a.id -b.id);

  let rept = [];
  for(let i = 0; i < newppl.length-1 ; i++){
    if (newppl[i+1].id == newppl[i].id){
      rept.push(newppl[i+1]);
    }
  }

  return [...new Set(rept.map(el => el.id))].map(rid => 
    rept.find(el => el.id === rid)
  );

}

repeated(peoples); 
```

* * *

## 回答 #79

> 赞同：0
> 
> 时间：2022-01-28T10:48:16.193

面试时有人问我，我的回答是，

```
List<int> getDublicates(List<int> x)
{
   List<int> result = new List<int>();
   while (x.Count>0)
   {
      int d = x[0];
      x.Remove(x[0]);
      if (x.Contains(d)) 
      result.Add(d);
   }
   return result;
} 
```

它有很好的性能

* * *

## 回答 #80

> 赞同：0
> 
> 时间：2022-02-12T20:01:14.133

删除重复项的最短方法是使用[Set](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set)和[Spread 语法](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax)

```
const remove = (array) => [...new Set(array)];
console.log(remove([1,1,2,2,3]); //1,2,3 
```

* * *

## 回答 #81

> 赞同：-1
> 
> 时间：2011-03-31T15:47:03.580

这是一个不使用临时数组来存储非重复的数组：

```
// simple duplicate removal for non-object types
Array.prototype.removeSimpleDupes = function() {
    var i, cntr = 0, arr = this, len = arr.length;

    var uniqueVal = function(val,n,len) { // remove duplicates
        var dupe = false;
            for (i = n; i < len; i++) { 
                if (typeof arr[i]!=="undefined" && val===arr[i]) { arr.splice(i,1); dupe = true; }
            }
        return (dupe) ? arr.length : len;
    };

    while (cntr < len) {
        len = uniqueVal(arr[cntr],cntr+1,len);
        cntr++;
    }

    return arr;
}; 
```

* * *

## 回答 #82

> 赞同：-1
> 
> 时间：2011-11-12T07:04:07.497

```
function remove_dups(arrayName){
  var newArray = new Array();

  label:for(var i=0; i<arrayName.length; i++ ){  

     for(var j=0; j<newArray.length;j++ ){
       if(newArray[j]==arrayName[i]){
         continue label;
       }
     }

     newArray[newArray.length] = arrayName[i];

  }

  return newArray;
} 
```

* * *

## 回答 #83

> 赞同：-1
> 
> 时间：2014-01-20T20:42:25.117

惊讶没有人发帖`this solution`。

```
<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>
</title>
</head>
<body>
  <script>
       var list = [100,33,45,54,9,12,80,100];
       var newObj = {};
       var newArr = [];
        for(var i=0; i<list.length; i++){
          newObj[list[i]] = i;               
        }
        for(var j in newObj){
            newArr.push(j);  
        }
       console.log(newArr);
  </script>
</body>
</html> 
```

* * *

## 回答 #84

> 赞同：-1
> 
> 时间：2014-12-06T10:45:02.403

```
var arr = [4,5,1,1,2,3,4,4,7,5,2,6,10,9];
var sorted_arr = arr.sort();
var len = arr.length;
var results = [];
for (var i = 0; i < len; i++) {
  if (sorted_arr[i + 1] !== sorted_arr[i]) {
    results.push(sorted_arr[i]);
  }
}
document.write(results);
```

* * *

## 回答 #85

> 赞同：-1
> 
> 时间：2017-01-20T09:46:16.237

```
var a= [1, 2,2,3,3,4,4,4];
var m=[];
var n = [];
a.forEach(function(e) {
  if(m.indexOf(e)=== -1) {
    m.push(e);
}else if(n.indexOf(e)=== -1){
    n.push(e);
}

}); 
```

* * *

## 回答 #86

> 赞同：-1
> 
> 时间：2018-10-31T11:55:41.117

您可以通过比较索引继续：

```
function getDuplicate(array) {
    return array.filter((value, index) => array.value !== index)
} 
```

* * *

## 回答 #87

> 赞同：-1
> 
> 时间：2019-02-07T05:51:22.647

**我们将使用 Javascript ES6 功能来做魔术！**

```
var arr = [9, 9, 111, 2, 3, 4, 4, 5, 7];
const filtered = arr.filter((value, index) => {
 return arr.indexOf(value) >= index;
});

console.log(filtered); 
```

[https://jsfiddle.net/97Lxupnz/](https://jsfiddle.net/97Lxupnz/)

* * *

## 回答 #88

> 赞同：-1
> 
> 时间：2019-09-04T06:48:33.560

```
var arr = ['a','b','c','a'];

arr.filter( (item , index ) => {  
console.log(item , index , arr.indexOf(item) , arr.indexOf( item ) == index);
return index == arr.indexOf(item)
 } ); 
```

[![在此处输入图像描述](https://i.stack.imgur.com/GSJlz.png)](https://i.stack.imgur.com/GSJlz.png)

* * *

## 回答 #89

> 赞同：-1
> 
> 时间：2019-11-14T08:42:10.443

```
var array = ['a', 'b', 'c', 'a'];

function unique(array) {
    var unique_arr = [];
    array.forEach(function(i, e) {
        if (unique_arr.indexOf(i)===-1) unique_arr.push(i);
    });
    return unique_arr;
}
console.log(unique(array)); 
```

* * *

## 回答 #90

> 赞同：-3
> 
> 时间：2012-07-27T16:39:38.120

如果你使用的是 Jquery，这篇文章对于重复检查很有用。

[如何使用jquery查找数组中的重复项](https://stackoverflow.com/questions/4346547/how-to-find-the-duplicates-in-an-array-using-jquery)

```
var unique_values = {}; var list_of_values = []; $('input[name$="recordset"]').     each(function(item) {          if ( ! unique_values[item.value] ) {             unique_values[item.value] = true;             list_of_values.push(item.value);         } else {             // We have duplicate values!         }     }); 
```

* * *

## 回答 #91

> 赞同：-3
> 
> 时间：2015-09-09T16:44:04.143

```
//program to find the duplicate elements in arraylist

import java.util.ArrayList;
import java.util.Scanner;

public class DistinctEle 
{ 
    public static void main(String args[])
    {
        System.out.println("Enter elements");
        ArrayList<Integer> abc=new ArrayList<Integer>();
        ArrayList<Integer> ab=new ArrayList<Integer>();
        Scanner a=new Scanner(System.in);
        int b;
        for(int i=0;i<=10;i++)
        {
            b=a.nextInt();
            if(!abc.contains(b))
            {
                abc.add(b);
            }
            else
            {
                System.out.println("duplicate elements"+b);
            }
        }
    }
} 
```

# c# - 线程和 lambda 表达式

> ID：840782
> 
> 赞同：10
> 
> 时间：2009-05-08T16:48:53.333
> 
> 标签：c#, .net, multithreading, lambda, threadpool

下面两段代码有什么区别？使用第二个会有什么问题吗？

场景一：

```
private void Log(Exception e)
{
    ThreadPool.QueueUserWorkItem(new WaitCallback(Log), e);
}

private void Log(object obj)
{
    Exception e = (Exception)obj;
    Logger.Log(e);
} 
```

方案 2

```
private void Log(Exception e)
{
    ThreadPool.QueueUserWorkItem(
        (obj) => 
            {
                Logger.Log(e);
            });
} 
```

在场景 2 中，我没有将异常作为参数传递给 ThreadPool。异常对象的线程编组是如何发生的？会不会有什么问题？如果有的话，这样做有什么限制？最大的优势是您可以非常轻松地传入任意数量的参数。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-08T16:51:49.613

唯一的区别是，在场景二中，您正在关闭`e`变量，该变量有效地将堆栈变量`e`移动到移动到堆中的自定义类型，这样您就不会丢失它。

我认为这应该可以正常工作。

**编辑：**至于性能，这两种情况之间不应该有显着差异。在场景 1 中，您已经将异常传递`state`给在`QueueUserWorkItem`内部将该异常引用移动到堆上的方法。唯一的开销是，当您使用闭包时，编译器会为您创建一个类型并将任何捕获的变量存储为该类型的字段。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T18:03:49.690

请注意，您可以使用匿名方法来代替 Lambda，它也可以在 C# 2.0 中工作：

```
ThreadPool.QueueUserWorkItem(delegate(Object e) 
    { 
        Logger.Log(e as Exception); 
    }); 
```

# mysql - ActiveRecord MySQL 和 JOINS

> ID：840794
> 
> 赞同：0
> 
> 时间：2009-05-08T16:50:37.527
> 
> 标签：mysql, activerecord, join

我有一个与[RubyOnRails Guide](http://guides.rubyonrails.org/active_record_querying.html#specifying-conditions-on-the-joined-tables)中公开的问题非常相似的问题。

这个查询：

```
Client.all :joins => :orders, 
           :conditions => { :orders => {:created_at => time_range}} 
```

如果他们在时间范围内下了一些订单，则应将所有客户连同他们的订单一起退回。我对吗？

我想要的略有不同：我想要所有客户，无论他们是否在时间范围内下订单。如果他们做了一些命令，我​​想要他们。我想出了：

```
Client.all :joins => 'LEFT OUTER JOIN orders ON orders.client_id = clients.id',
           :conditions => {:orders => {:created_at => time_range}}) 
```

但这并没有给我没有下订单的客户......有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T16:57:34.577

我认为这会做到：

```
Client.all :joins => 'LEFT OUTER JOIN orders ON orders.client_id = clients.id',
       :conditions => ['orders.created_at IN (?) OR orders.id IS NULL', time_range] 
```

# javascript - 简单的 jQuery 隐藏/显示在 IE 中不起作用

> ID：840800
> 
> 赞同：0
> 
> 时间：2009-05-08T16:51:34.200
> 
> 标签：javascript, jquery, internet-explorer, cross-browser, show-hide

```
$(document).ready(function () {
    $('#createGallery').hide();

    $("#newGallery").click(function () {
        $("#createGallery").show('slow');
    });
    $("#gallerySelect > option").not("#newGallery").click(function () {
        $("#createGallery").hide('slow');
    });
}); 
```

我不知道为什么。似乎很容易。我的 HTML 在 HAML 中。但是如果您不知道 HAML 是什么，它很容易理解。我的 HAML 内容如下：

```
 #createGallery
          %span{ :style => "color:#1B75BC; font-size: 15px;" }
            new gallery
          %br
          %form{ :action => ""}
            %input{ :name => "tabname", :type => "text", :rows => "1", :cols => "30", :style => "height: 15px; width: 260px; margin-right: 40px;"}

        %span{ :style => "color:#1B75BC; font-size: 15px;" }
          gallery

        %form{ :action => ""}
          %select#gallerySelect{ :name => "Choose Gallery", :style => "width:260px" }
            %option{ :selected => "selected", :value => "QuickFact" }
              Choose Gallery
            %option{ :value => "QuickFact"}
              My Interior Design
            %option#newGallery{ :value => "QuickFact" }
              New Gallery
        %br 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T17:23:05.670

我不相信 OPTION 元素有点击事件。您需要将点击处理程序附加到 SELECT 元素，然后检查选择的选项。\

（免责声明：空气编码）

```
$(document).ready(function(){
    $('#createGallery').hide();
    $("#gallerySelect").click(function () {
        if (this.options[this.selectedIndex].id == 'newGallery') {
            $("#createGallery").show('slow');
        } else {
            $("#createGallery").hide('slow');
        }
    });
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T17:32:01.063

这将有助于获取当前页面的 HTML，以及更多地了解问题。

*   哪个版本的IE有问题？
*   只是隐藏/显示#createGAllery 不起作用，还是点击事件根本没有触发？
*   做什么`alert($("#gallerySelect > option").not("#newGallery").length);`或`alert($("#gallerySelect > option").length);`返回？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T18:06:55.050

您所有的选项元素都具有相同的值......这通常不是这个元素的使用方式。此外，如果您要立即隐藏元素，则可以在 HAML 中将其设置为这样（当然，除非您希望非 JS 用户默认看到它）。如果您按照以下方式做一些事情会更有意义：

```
$(function(){ 
    $("#gallerySelect").bind('change',function () {
        if($(this).val() == 'newGallery') {
            $("#createGallery").show('slow');   
        } else {
            $("#createGallery").hide('slow');
        }    
    });

}); 
```

使用 HAML 是这样的：

```
 #createGallery{:style => "display:none;" }
      %span{ :style => "color:#1B75BC; font-size: 15px;" }
        new gallery
      %br
      %form{ :action => ""}
        %input{ :name => "tabname", :type => "text", :rows => "1", :cols => "30", :style => "height: 15px; width: 260px; margin-right: 40px;"}

    %span{ :style => "color:#1B75BC; font-size: 15px;" }
      gallery

    %form{ :action => ""}
      %select#gallerySelect{ :name => "Choose Gallery", :style => "width:260px" }
        %option{ :selected => "selected", :value => "chooseGal" }
          Choose Gallery
        %option{ :value => "designInterior"}
          My Interior Design
        %option{ :value => "newGallery" }
          New Gallery
    %br 
```

# networking - netsnmp 的困难：使用 snmpget 并将错误记录到 STDOUT

> ID：840802
> 
> 赞同：1
> 
> 时间：2009-05-08T16:52:28.223
> 
> 标签：networking, snmp

在手册页中，我看到以下内容：

```
-L LOGOPTS        Toggle various defaults controlling logging:
              e:           log to standard error
              o:           log to standard output 
```

这让我非常兴奋，因为我处于从 STDOUT 而不是从 STDERR 捕获错误对我有利的情况。

如果我运行命令：

```
snmpget -v1 -ccommString  -Lo 172.16.x.x  .1.2.3.4.5.6.7.8.9 
```

我回到我的终端

```
Error in packet
Reason: (noSuchName) There is no such variable name in this MIB.
Failed object: iso.2.3.4.5.6.7.8.9 
```

但是，如果我运行命令：

```
snmpget -v1 -ccommString  -Lo 172.16.x.x .1.2.3.4.5.6.7.8.9 2> foo 
```

我在终端上没有得到任何响应，但文件 foo 包含我上面得到的相同错误消息。因此，我在 STDERR 上收到错误消息，而不是在 STDOUT 上，如我所料。

我在这里读错了手册页吗？此外，我在 linux 和 windows 系统上都试过这个，由于我所处的情况，我更愿意在 STDOUT 而不是 STDERR 上发出错误，因为我不想使用 shell 来完成通常的工作 2 >&1

非常感谢任何帮助或建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T17:16:06.437

我相信 -L 选项控制代理（snmpd）如何记录日志，并且不适用于来自 snmpget 的错误消息（-L 是“常见”标志之一，它可能不适用于所有 net-snmp 命令）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T07:54:20.757

以下 c 代码是 snmpget 实用程序源代码的一部分（net-snmp-5.4.2.1\apps 中的 snmpget.c）。

```
fprintf(stderr, "Error in packet\nReason: %s\n",
        snmp_errstring(response->errstat));

if (response->errindex != 0) {
    fprintf(stderr, "Failed object: ");
    for (count = 1, vars = response->variables;
            vars && count != response->errindex;
            vars = vars->next_variable, count++)
        /*EMPTY*/;
    if (vars) {
        fprint_objid(stderr, vars->name, vars->name_length); 
```

如您所见，消息只是简单地写入**stderr**。

您可以使用自定义 snmpget 实用程序：[下载](http://www.net-snmp.org/download.html)源代码，将**stderr**替换为**stdout** ，然后重新编译。

# php - 爆炸超过所有其他单词

> ID：840807
> 
> 赞同：3
> 
> 时间：2009-05-08T16:53:50.763
> 
> 标签：php, explode

假设我有一个字符串：

```
$string = "This is my test case for an example." 
```

如果我确实基于''爆炸，我会得到一个

```
Array('This','is','my','test','case','for','an','example.'); 
```

我想要的是对所有其他空间进行爆炸：

```
Array('This is','my test','case for','an example.'). 
```

字符串可能有奇数个单词，因此数组中的最后一项可能不包含两个单词。

有人知道怎么做吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-08T16:56:40.227

我会查看结果，并在事后连接字符串。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-08T17:09:12.210

```
$matches = array();
preg_match_all('/([A-Za-z0-9\.]+(?: [A-Za-z0-9\.]+)?)/',
       'This is my test case for an example.',$matches);

print_r($matches); 
```

产量：

```
Array
(
  [0] => Array
    (
        [0] => This is
        [1] => my test
        [2] => case for
        [3] => an example.
    )

  [1] => Array
    (
        [0] => This is
        [1] => my test
        [2] => case for
        [3] => an example.
    )

) 
```

**更新**修复它以匹配句子末尾的单个单词

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T21:50:08.747

可用于不同分隔符和数字的函数。

```
function explodeEveryNth($delimiter, $string, $n) {
    $arr = explode($delimiter, $string);
    $arr2 = array_chunk($arr, $n);
    $out = array();
    for ($i = 0, $t = count($arr2); $i < $t; $i++) {
        $out[] = implode($delimiter, $arr2[$i]);
    }
    return $out;
} 
```

测试代码

```
var_dump(explodeEveryNth(' ', 'This is a test string', 2)); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T17:10:36.777

 `````
$string = "This is my test case for an example.";

preg_match_all("/[a-zA-Z0-9]+\ [a-zA-Z0-9]+/", $string, $matches);
print_r($matches); 
````  `* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T17:48:32.253

**您可以在其他场景中重复使用的东西：（**总是更好的 IMO）。

虽然可能不是最优雅的解决方案，但这确实遵循其他 PHP 核心函数的一般概念语法......

无论如何...这使用递归。它很灵活，因为它允许您指定块的大小（以防您想在以后或其他项目中这样做）。我这样做更像是一个个人挑战，看看我能想出什么。

```
<?php
function chunk_explode($glue=' ',$pieces='',$size=2,$final=array()) {
    if(!is_string($pieces) && !is_array($pieces)) 
        return false;

    if(is_string($pieces))
        $pieces = explode($glue,$pieces);

    $num_pieces = sizeof($pieces);
    if($num_pieces <= 0) 
       return $final;

    if($num_pieces >= $size) {
        $arr_chunk = array_chunk($pieces, $size);
        array_push($final,implode($glue,$chunk[0]));
        for($i=0;$i<=$size;$i++) { array_shift($pieces); }
        return chunk_explode($glue,$pieces,$size,$final);
    }
    array_push($final,implode($glue,$pieces));
    return $final;
}
$string = "This is my test case for an example.";
chunk_explode(' ',$string,3); 
```

如果此`chunk_explode`功能很糟糕，请告诉我，以便我从错误中吸取教训。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-08T17:03:16.123

```
$matches = array();
preg_match_all('/\S+(?:\s[A-Za-z0-9.]+|$)/',
    'This is my test case for an example.',
    $matches
);
print_r($matches);
preg_match_all('/\S+(?:\s[A-Za-z0-9.]+|$)/',
    'This is my test case for example.',
    $matches
);
print_r($matches); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-11T22:19:24.360

PHP中有75个数组函数，让我们尝试使用它们而不是for循环！

我喜欢 Kyle 的函数名。（我假设您没有运行 5.3 并遭受 create_function 的影响。）

```
 function chunk_explode($string, $chunks = 2, $delim = ' ') {
     $A = explode($delim, $string);
     $A = array_chunk($A, $chunks);
     return array_map(
         create_function('$x',
            'return implode(\'' . $delim . '\',$x);'), $A);
 } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-09T16:37:36.967

显然这不是最好的解决方案，但以我自己的方式解决它很有趣。还有很多东西要学...

```
function solveThisPuzzle($string) {

$modified_string = preg_replace('(\s)', '+', $string, -1, $count);  
$words = explode('+', $modified_string);

$phrases_arr = array();

for($i = 1; $i < $count+1; $i++) {
    if(($i % 2)) {
        $phrase = $words[$i-1].' '.$words[$i];
        $phrases_arr[] = $phrase;
        unset($phrases_arr[$i]);
    } elseif($i == $count) {
            $phrase = $words[$i];
            $phrases_arr[] = $phrase;
        } else {            
            $phrase = NULL;
        }
}

foreach($phrases_arr as $final_phrase) {
    $solution .= $final_phrase.'<br />';
}

    return $solution; 
```

}

```
$string = "This is my test case for an example, huzzah!";
echo solveThisPuzzle($string);

This is
my test
case for
an example,
huzzah! 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-08T17:12:21.873

```
 $str = "This is my test case for an example.";
    $arr = split(' ', $str);
    $newArr = array();
    $count = count($arr);
    for($i=0;$i<$count;$i = $i + 2) {
        $newArr[] = $arr[$i] . ' ' . $arr[$i+1];
    }

array(4) {
  [0]=>
  string(7) "This is"
  [1]=>
  string(7) "my test"
  [2]=>
  string(8) "case for"
  [3]=>
  string(11) "an example."
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-09-05T11:56:21.200

我不会在我自己的项目中使用任何以前发布的答案。

最干净、最直接的工具是`preg_split()`. 匹配第一个非空格字符序列，然后是空格，然后是下一个非空格字符序列，然后“忘记”匹配的字符并匹配在爆炸过程中必须消耗的空间。

`\K`意思是“从这里重新开始全字符串匹配”。使用`\K`消除了实现捕获组和`PREG_`标志的需要。

代码：（[演示](https://3v4l.org/beZUF)）

```
$string = "This is my test case for an example.";

var_export(
    preg_split('~[^ ]+ [^ ]+\K ~', $string)
); 
```

输出：

```
array (
  0 => 'This is',
  1 => 'my test',
  2 => 'case for',
  3 => 'an example.',
) 
```

# c# - 如何在 C# 中使用 WebBrowser 控件 DocumentCompleted 事件？

> ID：840813
> 
> 赞同：14
> 
> 时间：2009-05-08T16:54:34.177
> 
> 标签：c#, automation, c#-2.0, webbrowser-control

在开始写这个问题之前，我试图解决以下问题

```
// 1\. navigate to page
// 2\. wait until page is downloaded
// 3\. read and write some data from/to iframe 
// 4\. submit (post) form 
```

问题是，如果网页上存在 iframe，DocumentCompleted 事件将被触发不止一次（在每个文档完成后）。程序很可能会尝试从 DOM 中读取未完成的数据并且自然会失败。

但突然在写这个问题***“如果”怪物***启发了我，我解决了我试图解决的问题。由于我在谷歌上失败了，我想把它贴在这里会很好。

```
 private int iframe_counter = 1; // needs to be 1, to pass DCF test
    public bool isLazyMan = default(bool);

    /// <summary>
    /// LOCK to stop inspecting DOM before DCF
    /// </summary>
    public void waitPolice() {
        while (isLazyMan) Application.DoEvents();
    }

    private void webBrowser1_Navigating(object sender, WebBrowserNavigatingEventArgs e) {
        if(!e.TargetFrameName.Equals(""))
            iframe_counter --;
        isLazyMan = true;
    }

    private void webBrowser1_DocumentCompleted(object sender, WebBrowserDocumentCompletedEventArgs e) {
        if (!((WebBrowser)sender).Document.Url.Equals(e.Url))
            iframe_counter++;
        if (((WebBrowser)sender).Document.Window.Frames.Count <= iframe_counter) {//DCF test
            DocumentCompletedFully((WebBrowser)sender,e);
            isLazyMan = false; 
        }
    }

    private void DocumentCompletedFully(WebBrowser sender, WebBrowserDocumentCompletedEventArgs e){
        //code here
    } 
```

至少现在，我的 5m hack 似乎运行良好。

也许我在查询 google 或 MSDN 时真的失败了，但我找不到：“如何在 C# 中使用 webbrowser 控制 DocumentCompleted 事件？”

**备注：**在学习了很多关于webcontrol的知识后，我发现它做了Funky的东西。

即使您检测到文档已完成，在大多数情况下，它也不会永远保持这种状态。页面更新可以通过多种方式完成 - 帧刷新、类似请求的 ajax 或服务器端推送（您需要有一些支持异步通信并具有 html 或 JavaScript 互操作的控件）。还有一些 iframe 永远不会加载，所以永远等待它们不是最好的主意。

我最终使用：

```
if (e.Url != wb.Url) 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-06-16T05:39:10.297

您可能还想知道 AJAX 调用。

考虑使用这个：

```
private void webBrowser_DocumentCompleted(object sender, WebBrowserDocumentCompletedEventArgs e)
{
    string url = e.Url.ToString();
    if (!(url.StartsWith("http://") || url.StartsWith("https://")))
    {
            // in AJAX
    }

    if (e.Url.AbsolutePath != this.webBrowser.Url.AbsolutePath)
    {
            // IFRAME 
    }
    else
    {
            // REAL DOCUMENT COMPLETE
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-10-13T15:51:24.737

我还没有在网上找到解决这个问题的有效方法。希望这将使它达到顶峰，并为每个人节省我为解决它而花费的几个月的调整时间，以及与之相关的边缘情况。多年来，随着 Microsoft 改变了 isBusy 和 document.readystate 的实现/可靠性，我一直在为这个问题争论不休。使用 IE8，我不得不求助于以下解决方案。它类似于 Margus 的问题/答案，但有一些例外。我的代码将处理嵌套框架、javascript/ajax 请求和元重定向。为了清楚起见，我简化了代码，但如果 5 分钟 domAccess 仍然等于 false，我还使用超时功能（不包括在内）重置网页。

```
private void m_WebBrowser_BeforeNavigate(object pDisp, ref object URL, ref object Flags, ref object TargetFrameName, ref object PostData, ref object Headers, ref bool Cancel)
{
    //Javascript Events Trigger a Before Navigate Twice, but the first event 
    //will contain javascript: in the URL so we can ignore it.
    if (!URL.ToString().ToUpper().StartsWith("JAVASCRIPT:"))
    {
        //indicate the dom is not available
        this.domAccess = false;
        this.activeRequests.Add(URL);
    }
}

private void m_WebBrowser_DocumentComplete(object pDisp, ref object URL) 
{

    this.activeRequests.RemoveAt(0);

    //if pDisp Matches the main activex instance then we are done.
    if (pDisp.Equals((SHDocVw.WebBrowser)m_WebBrowser.ActiveXInstance)) 
    {
        //Top Window has finished rendering 
        //Since it will always render last, clear the active requests.
        //This solves Meta Redirects causing out of sync request counts
        this.activeRequests.Clear();
    }
    else if (m_WebBrowser.Document != null)
    {
        //Some iframe completed dom render
    }

    //Record the final complete URL for reference
    if (this.activeRequests.Count == 0)
    {
        //Finished downloading page - dom access ready
        this.domAccess = true;
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-02-01T21:21:24.427

与 Thorsten 不同的是，我不必使用 ShDocVw，但对我来说真正不同的是添加循环检查 ReadyState 并在未准备好时使用 Application.DoEvents()。这是我的代码：

```
 this.webBrowser.DocumentCompleted += new WebBrowserDocumentCompletedEventHandler(WebBrowser_DocumentCompleted);
        foreach (var item in this.urlList) // This is a Dictionary<string, string>
        {
            this.webBrowser.Navigate(item.Value);
            while (this.webBrowser1.ReadyState != WebBrowserReadyState.Complete)
            {
                Application.DoEvents();
            }
        } 
```

我使用 Yuki 的解决方案来检查 WebBrowser_DocumentCompleted 的结果，尽管最后一个 if/else 根据用户的评论交换：

```
 private void WebBrowser_DocumentCompleted(object sender, WebBrowserDocumentCompletedEventArgs e)
    {
        string url = e.Url.ToString();
        var browser = (WebBrowser)sender;

        if (!(url.StartsWith("http://") || url.StartsWith("https://")))     
        {             
            // in AJAX     
        }
        if (e.Url.AbsolutePath != this.webBrowser.Url.AbsolutePath)     
        {
            // IFRAME           
        }     
        else     
        {             
            // REAL DOCUMENT COMPLETE
            // Put my code here
        }
    } 
```

像魅力一样工作:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-05T07:19:37.600

我不得不做类似的事情。我所做的是直接使用 ShDocVw（向我的项目添加对所有必要互操作程序集的引用）。然后，我没有将 WebBrowser 控件添加到我的表单，而是将*AXShDocVw.AxWebBrowser*控件。

要导航和等待，我使用以下方法：

```
private void GotoUrlAndWait(AxWebBrowser wb, string url)
{
    object dummy = null;
    wb.Navigate(url, ref dummy, ref dummy, ref dummy, ref dummy);

    // Wait for the control the be initialized and ready.
    while (wb.ReadyState != SHDocVw.tagREADYSTATE.READYSTATE_COMPLETE)
        Application.DoEvents();
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2011-09-12T18:04:47.633

只是想在这里写一两行关于与飞宝代码一起工作的小改进。这个想法是在网页中注入一个地标（javascript）变量，并使用它来检测后续的 DocumentComplete 事件中哪些是真正的交易。我怀疑它是防弹的，但总的来说它比缺乏它的方法更可靠。欢迎任何意见。这是样板代码：

```
 void WebBrowser_DocumentCompleted(object sender, WebBrowserDocumentCompletedEventArgs e)
    {
        string url = e.Url.ToString();
        var browser = (WebBrowser)sender;

        if (!(url.StartsWith("http://") || url.StartsWith("https://")))
        {
            // in AJAX     
        }
        if (e.Url.AbsolutePath != this.webBrowser.Url.AbsolutePath)
        {
            // IFRAME           
        }
        else if (browser.Document != null && (bool)browser.Document.InvokeScript("eval", new object[] { @"typeof window.YourLandMarkJavascriptVariableHere === 'undefined'" }))
        {
            ((IHTMLWindow2)browser.Document.Window.DomWindow).execScript("var window.YourLandMarkJavascriptVariableHere = true;");

            // REAL DOCUMENT COMPLETE
            // Put my code here
        }
    } 
```

# image - 在IE中的文本框中左右浮动图像奇怪的间距

> ID：840814
> 
> 赞同：0
> 
> 时间：2009-05-08T16:54:40.480
> 
> 标签：image, internet-explorer, alignment, css-float, word-wrap

我的例子在[这里](http://workforall.biz/workforall/success.html)

当被告知在 FF 中向右或向左对齐时，徽标看起来很好，并且它们似乎与文本正确换行，但在 IE 中，在第一行文本之后出现了巨大的间隙。

我还创建了浮动左右样式，并尝试应用于徽标，但效果相同。我知道这是 IE 中的一个问题，但我还没有找到解决方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T17:11:15.060

不要在 HTML 中使用 align="left" 和 align="right"，只需在 floatleft 和 floatright CSS 声明中包含 float 属性：

```
.floatleft {
    float:left;
    padding: 0px 8px 8px 0px;
}
.floatright {
    float: right;
    padding: 0px 0px 8px 8px;
} 
```

# ruby-on-rails - Rails 在帮助器中使用命名路由（但使用类方法）

> ID：840825
> 
> 赞同：0
> 
> 时间：2009-05-08T16:58:05.637
> 
> 标签：ruby-on-rails, routes

尝试使用[此方法](http://giantrobots.thoughtbot.com/2007/7/24/disambiguate-your-helpers)（其中的要点在 中使用`self.method_name`，`FunnyHelper`然后在视图中调用它`FunnyHelper.method_name`）。

然而，这至少会导致几个问题——视图方法`h()`和命名路由被破坏*（它们可以使用模块方法`def method_name`，但不能用于任何类方法`def self.method_name`）*。

`def self.method_name`显然，我可以通过回退到`def method_name`;来避免这种情况。有人对我如何吃蛋糕有任何建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T18:58:54.863

如果你*真的*想这样做，你可以使用

```
include ActionController::UrlWriter 
```

访问您的命名路线和

```
# h is a private method 
ActionController::Base.helpers.send :h, "<" 
```

对于其他视图助手。但我不会推荐它。在我看来，thinkobt 在这里建议的设计模式很糟糕，我只会使用 helper :blogs，尽管他们抱怨它并不明确。这是真的，有点……但总的来说，Rails 尤其是 Rails 的这一部分是以完全“非显式”的方式构建的，所以试图与之抗争将比它的价值更麻烦，因为你是发现。

# jsf - 自定义 JSF 组件属性列表

> ID：840830
> 
> 赞同：3
> 
> 时间：2009-05-08T16:59:59.343
> 
> 标签：jsf, attributes, custom-controls

我正在编写一个自定义 JSF 组件，它将为一组指定的图像呈现图像转换。组件要使用的图像列表将由组件的用户指定。

主要组件将进行渲染，生成的标记不是 html。

我只是在学习 JSF，我想知道是否有一个既定的模式可以将参数属性列表传递给自定义组件：

用户是否期望传递如下属性：
`<i:imageComponent width="480" height="320" imageUrls="img1Url1, imgUrl2" imageCaptions="imageCaption1, imageCaptions2"/>`

然后我可以使用转换器将这些属性转换为服务器列表，或者这会更自然吗？

`<i:imageComponent width="480" height="320">`
`<i:image id="im1" href="url1" caption="caption1"/>`
`<i:image id="im2" href="url2" caption="caption2"/>`
`<i:imageComponent/>`

在我的例子中，主要的 imageComponent 将进行所有渲染，所以我只想弄清楚将属性列表传递给组件的自然方式是什么。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T19:44:05.550

```
<i:imageComponent width="480" height="320" imageUrls="img1Url1, imgUrl2"
    imageCaptions="imageCaption1, imageCaptions2"/> 
```

这种设计容易出错，因为它要求两个单独的列表保持同步。

```
<i:imageComponent width="480" height="320">
    <i:image id="im1" href="url1" caption="caption1"/>
    <i:image id="im2" href="url2" caption="caption2"/>
<i:imageComponent/> 
```

这种设计是有限制的，因为它要求组件消费者定义固定数量的包含图像。至少在第一个设计中，*imageUrls*和*imageCaptions*属性可以使用 EL 表达式绑定到动态值。

* * *

考虑为您的组件定义一个[模型](http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller)- 一个可用于迭代值的接口。例如，[UIData （](http://java.sun.com/javaee/5/docs/api/javax/faces/component/UIData.html) [h:dataTable](http://java.sun.com/javaee/javaserverfaces/1.2_MR1/docs/tlddocs/h/dataTable.html)底层的组件类型）使用[DataModel](http://java.sun.com/javaee/5/docs/api/javax/faces/model/DataModel.html)来处理其内容 - 请参阅[规范](http://java.sun.com/javaee/javaserverfaces/reference/api/index.html)了解详细信息。

这可能会导致这样的标签设计：

```
<i:imageComponent width="480" height="320"
        value="#{backingBean.imageModel}" /> 
```

这种方法需要更少的视图混乱。

* * *

代替模型，考虑中继器设计（这将依赖于用户/开发人员提供适当的绑定类型）：

```
<i:imageComponent width="480" height="320"
        value="#{backingBean.someIterable}" var="img" >
    <i:image href="#{img.href}" caption="#{img.caption}"/>
<i:imageComponent/> 
```

这种方法的优点是后端不需要任何特殊类型。

# sql-server - 如何从 SSMS 中执行一组 .SQL 文件？

> ID：840831
> 
> 赞同：68
> 
> 时间：2009-05-08T17:00:27.753
> 
> 标签：sql-server, batch-file, ssms

如何从 SQL Server Management Studio 中执行一组 .SQL 文件（每个文件都进行一些数据转换）？

还有什么其他方法可以批量执行 .SQL 文件？

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2009-05-08T17:04:47.337

虽然 SQLCMD.exe 是最好的方法，但 SSMS 也有一个 SQLCMD 模式，您可以在其中执行 SQLCMD 脚本。要启用此模式，请单击菜单栏中的**Query ，然后选择****SQLCMD Mode**。

":r filename.sql" 命令是用于导入和执行 sql 脚本文件的 SQLCMD 脚本命令。您知道您处于 SQLCMD 模式，因为任何作为 SQLCMD 脚本命令的行都将以彩色（我认为是灰色）背景显示。

```
:setvar path "c:\Path_to_scripts\"
:r $(path)\file1.sql
:r $(path)\file2.sql 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-05-08T17:02:34.517

使用[SqlCmd.exe](http://msdn.microsoft.com/en-us/library/ms170207.aspx)。

例如：[_](http://msdn.microsoft.com/en-us/library/ms170572%28SQL.90%29.aspx)

```
sqlcmd -S myServer\instanceName -i C:\myScript.sql 
```

或将输出保存到文件：

```
sqlcmd -S myServer\instanceName -i C:\myScript.sql -o C:\EmpAdds.txt 
```

# sql - 跟踪表中值的更新时间

> ID：840833
> 
> 赞同：1
> 
> 时间：2009-05-08T17:02:13.270
> 
> 标签：sql, database

任何人都可以请让我知道是否有办法找出更新表格的确切时间。我的意思是更新列的时间。请帮忙。

谢谢，

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T17:06:48.890

添加触发器，当插入的（更改的）数据与您的条件匹配时，您的通知（插入日志表等）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T17:09:45.483

我喜欢在需要这种跟踪的表中保留 LastUpdatedTimeStamp 列。

如果您询问是否跟踪已经进行的更改，您可能能够分析事务日志。我不知道一个人会怎么做。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T22:12:49.030

最佳实践是在该表上更新触发器，它将调用一个通用过程，您可以在其中传递描述字段名称和更新记录的主键以及时间戳等参数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T22:26:19.450

您可以在更新相关列时添加触发器。仅当相关列实际更改时才会触发。以下示例适用于 Oracle。

```
CREATE OR REPLACE TRIGGER my_trigger
BEFORE UPDATE
OF my_column
ON my_table
BEGIN
   :new.my_column_updated_at := SYSDATE;
END; 
```

`my_column_updated_at`然后将跟踪何时`my_column`更改。您可能还想在插入时添加一个触发器以设置`my_column_updated_at`.

如果您需要了解表中任何行的列何时更新，您可以发出以下 SQL：

```
SELECT MAX(my_column_updated_at) FROM my_table 
```

# visual-studio-2008 - 流利的 NHibernate 类作为域类的代码

> ID：840838
> 
> 赞同：4
> 
> 时间：2009-05-08T17:02:48.260
> 
> 标签：visual-studio-2008, nhibernate, fluent-nhibernate, domain-driven-design

好的，所以我想为非 aspx 类创建一个代码。我有映射文件（类），我想在项目中显示为实体的代码。有没有办法在 VS2008 中做到这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T17:06:34.820

您可以通过将其命名为 Class.Designer.（vb 或 cs）来创建设计器文件，它会显示为您正在创建的任何类的代码。但是，其中一个类必须是部分类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T17:18:40.923

听起来您正在谈论在解决方案资源管理器中显示为嵌套的文件。ASP.NET Codebehind 文件只是其中一个例子。

你想要的项目文件是这样的：

```
<ItemGroup>
    <EmbeddedResource Include="Resources.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>Resources.Designer.cs</LastGenOutput>
      <SubType>Designer</SubType>
    </EmbeddedResource>
</ItemGroup>
<ItemGroup>
    <Compile Include="Resources.Designer.cs">
      <DependentUpon>Resources.resx</DependentUpon>
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
    </Compile>
</ItemGroup> 
```

我相信这`<DependentUpon>`是指示嵌套的元素。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-28T14:16:23.740

我实际上得到了这个工作。现在所有“映射”都显示为我的实体的类后面的代码，在查找实体的映射时为我节省了大量时间。这是它在项目文件中的外观。

```
<Compile Include="Entities\OrderMap.cs">
  <DependentUpon>Order.cs</DependentUpon>
</Compile> 
```

我们还创建了一个模板，这样您就可以右键单击，选择添加 NH 实体并将其保存到项目中，如上所示。现在唯一的问题是实体的重命名，必须进入项目并手动更改名称。但这不会经常发生，而且是为了提高生产力而做出的小小权衡。

# visual-studio-2008 - TFS中不同类型的比较有什么区别

> ID：840845
> 
> 赞同：31
> 
> 时间：2009-05-08T17:04:31.440
> 
> 标签：visual-studio-2008, tfs

当您右键单击文件并选择“比较...”时，您会得到几个不同的选项：

1.  变更集
2.  日期
3.  标签
4.  最新版本
5.  工作区版本

前 3 个非常不言自明。但是最新版本和工作区版本有什么区别呢？4 似乎您正在将机器上的代码与 TFS 5 中的最新版本进行比较 - 这不应该就像 (4) 一样吗？（我认为它可能允许您与多个工作空间进行比较，但对话框似乎没有选择不同工作空间的选项。）

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-05-28T19:29:51.347

我发现最新版本工作区版本之间的区别

最新版本 - 将您当前的代码文件与 TFS 服务器上的最新代码文件进行比较。（这包括您的代码猴子所做的所有更改，并在您签出文件后重新签入）。仅当您启用了多个结帐时，这种比较形式才会显示差异。

工作区版本 - 将您当前的代码文件与您签出文件时的代码进行比较。如果您启用了多个签出并且您的一些代码猴子已签入更改 - 那么，您可以使用此选项查看您最初更改的内容。然后，您必须与最新版本进行比较，以查看在签入代码文件时是否存在任何冲突。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-08T18:47:53.970

最新版本是指提交给 TFS 源代码管理的最后一个版本，而工作区版本是指本地工作区中最后一个签入的版本。

所以基本上工作区版本比较会将您正在比较的文件与您签入的文件进行比较。最新版本比较会将其与团队中其他人可能已签入的文件进行比较。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T20:13:34.107

最新版本和工作区版本之间的混淆主要来自（对我而言）您认为您正在点击的内容。当您在源代码控制视图或待定更改中单击文件时，TFS 会将其视为您单击源代码控制中上次同步到的文件，*而不是*本地文件。

大多数情况下，Latest-Version 可能不会被用作（我假设）您大部分时间都会被同步到最新版本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-06-10T08:19:00.587

正如我在stackoverflow上阅读的另一个问题（[“与工作区版本比较”和“与最新版本比较”有什么区别？](https://stackoverflow.com/questions/20213756/what-is-the-difference-between-compare-with-workspace-version-and-compare-wit)）我的解释如下（如果我错了，请纠正）

**与最新版本**比较：将您的文件（已编辑或未编辑）与 TFS 服务器中的最新版本进行比较

**与工作区版本**比较：将您的文件（已编辑或未编辑）与您在开始工作之前签出到工作区的版本进行比较。

# wpf - WPF - 将图像属性绑定到图像控件

> ID：840872
> 
> 赞同：5
> 
> 时间：2009-05-08T17:11:12.920
> 
> 标签：wpf, data-binding, image

假设我有**字符串名称**和**图像照片**作为我的 DataContext 中的一个类的属性。我需要将它们绑定到控件是一个 DataTemplate。

我认为这会起作用，但它不会：

```
<Image Source="{Binding Photo}"/> 
```

为什么不？我的照片应该有另一种类型吗？（也许是位图图像？）

如何将 Image 控件绑定到 Image 属性？

谢谢！

编辑：像往常一样，点击提交后，我看到错误很明显：没有从 Image 到 ImageSource 的转换器。我的转换器如何将 Image 转换为 ImageSource？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T17:37:43.670

是的，如果我让我的属性 BitmapImage 一切正常。对不起这个愚蠢的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T18:53:27.717

拥有 Image 类型的数据属性实际上没有任何意义，因为 Image 是一个控件（如果您真的想这样做，您可以绑定到 Photo.Source）。您应该改用 ImageSource（或 BitmapImage，就像您所做的那样，因为 BitmapImage 继承自 ImageSource）。

# c# - 如何通过代码确定硬件虚拟化是否可用？（C#、C++）

> ID：840873
> 
> 赞同：4
> 
> 时间：2009-05-08T17:11:13.140
> 
> 标签：c#, windows, windows-7, virtualization

如何通过代码检测系统是否支持硬件虚拟化？（最好在 C# 或 C++ 中）。

我尝试使用 WMI 和 ManagementObjectSearcher，但找不到似乎表示机器中是否存在虚拟化支持的属性。

额外问题：是否可以判断 CPU 是否支持硬件虚拟化，但在 BIOS 中禁用？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2014-08-06T13:12:38.747

我没有 C 风格的答案，但这里有一个 PowerShell 方法——它只是一个简单的 WMI 查询——可以提供帮助。

查询 Win32_Processor；有标志“SecondLevelAddressTranslationExtensions”和“VirtualizationFirmwareEnabled”。他们似乎为我回答了这些问题。

在 PoSH 中，它是

(GWMI Win32_Processor).VirtualizationFirmwareEnabled

和

(GWMI Win32_Processor).SecondLevelAddressTranslationExtensions

我希望这有帮助。

马克·米纳西

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-03T10:33:16.157

我认为原始发帖人是在询问如何检测计算机硬件是否支持虚拟化，而不是在虚拟机中运行。请参阅[此问题](https://stackoverflow.com/questions/20658/determine-if-my-pc-supports-hw-virtualization)以获取可能的答案。

此外，您是否可以检查 CPU 标志可能值得一看，因为如果处理器支持虚拟化扩展，则会有 Intel`vmx`标志或 AMD标志。`svm`我不能说我知道这应该如何在 Windows 下完成，但这些信息`/proc/cpuinfo`在 Linux 上是可用的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T17:29:47.197

不确定代码，但[Securable](http://www.grc.com/securable.htm)似乎能够做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-19T16:58:29.387

检查此[链接](https://stackoverflow.com/questions/24841536/is-it-possible-using-c-sharp-to-check-if-hardware-virtualization-enabled/24842577#24842577)，如您所见，也许您应该使用 WMI 类来获取信息。.NET 框架有 System.Management 命名空间来做到这一点。Win32_processor 类可以为您提供有关处理器所需的所有信息，因为您无法使用 win32_processor 类直接访问 cpu 标志，也许您需要检查 VirtualizationFirmwareEnabled 的值

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-06-19T20:47:30.087

检查[StackOverFlow：如何识别您在 VM 下运行](https://stackoverflow.com/questions/39533/how-to-identify-that-youre-running-under-a-vm)

# java - 查看实际的 Maven 调用

> ID：840875
> 
> 赞同：4
> 
> 时间：2009-05-08T17:11:34.340
> 
> 标签：java, maven-2

有没有办法让 Maven 在其日志中包含为执行特定操作而调用的实际命令？我遇到了一个 javac 调用失败的问题，我想看看 maven 实际上在做什么。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T21:51:19.707

-X 是您将获得的最接近的值。由插件（在这种情况下为编译器）来记录有用的信息。Maven 将始终记录传递给插件的值，但这里编译器调用 JavaC 并且显然它没有记录您想要的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T16:08:43.373

我不确定它是否*可以*记录您想要的内容。我认为它在同一个 JVM 中直接调用编译器。所以没有命令行可以显示。

# c# - 如何使用反射来确定数组的嵌套类型（元素类型）？

> ID：840878
> 
> 赞同：65
> 
> 时间：2009-05-08T17:12:07.100
> 
> 标签：c#, .net, reflection

我有一个 System.Type 实例，“IsArray”为此返回 true。

如何确定数组类型的“嵌套类型”？

IE

```
Type GetArrayType(Type t)
{
    if(t.IsArray)
    {
        //  What to put here?
    }
    throw new Exception("Type is not an array");
}
Assert.That(GetArrayType(typeof(string[])), Iz.EqualTo(typeof(string));
Assert.That(GetArrayType(typeof(Foo[])), Iz.EqualTo(typeof(Foo)); 
```

* * *

## 回答 #1

> 赞同：110
> 
> 时间：2009-05-08T17:15:14.753

```
t.GetElementType() 
```

[参考](http://msdn.microsoft.com/en-us/library/system.type.getelementtype(VS.71).aspx)。

# sql - 如何创建按值范围分组的 SQL 查询

> ID：840884
> 
> 赞同：0
> 
> 时间：2009-05-08T17:14:47.140
> 
> 标签：sql, sql-server

我想创建一个报告特定范围内结果百分比的 sql 查询。例如

10 到 20 之间的值的 20%

40% 的值在 20 到 32.5 之间

服务器 - MSSQL

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T17:23:16.090

```
GROUP BY CASE 
         WHEN VALUE >= 10 AND VALUE <= 20 THEN '20%'
         WHEN VALUE > 20 AND VALUE <= 32.5 THEN '40%' ELSE '0' END 
```

您需要涵盖*所有*可能的值，因此 ELSE 0。您可能想要在此处做一些不同的事情，但它应该给您一个开始。

* * *

基于 Joel Gauvreau 的评论：

```
SUM(CASE WHEN VALUE >=10 AND VALUE <= 20 THEN 1.0 ELSE 0.0 END) / COUNT(*),
SUM(CASE WHEN VALUE > 20 AND VALUE <= 32.5 THEN 1.0 ELSE 0.0 END) / COUNT(*) 
```

或者在查询结束时使用[`COMPUTE`](http://msdn.microsoft.com/en-us/library/ms181708.aspx)语句。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T17:26:25.943

这将为您提供每个范围的计数，您可以从那里轻松确定百分比：

```
declare @ranges table (beginInclusive float, endExclusive float)
insert @ranges (beginInclusive, endExclusive)
    select 10, 20
    union all select 20, 32.5

select
    r.beginInclusive,
    r.endExclusive,
    count(*)
from t join @ranges on t.RangedValue >= r.beginInclusive and t.RangedValue < r.endExclusive
group by 
    r.beginInclusive,
    r.endExclusive 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T17:30:48.630

```
SELECT B.Description, Total = COUNT(*) / CONVERT(money, (SELECT COUNT(*) FROM Target T2))
FROM Target T
JOIN (
    SELECT  Description = '0 to 10', LBound = 0, UBound = 10 
    UNION ALL 
    SELECT Description = '10 to 20', LBound = 10, UBound = 20
) B ON T.Value >= LBound AND T.Value < B.UBound
GROUP BY B.Description 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T17:50:56.850

```
Declare @1 as int
Declare @2 as int
Declare @TotalRows as int

set @1 = (Select COUNT(id) FROM dbo.Table_1 WHERE id >= 10 and id <= 20)
set @2 = (Select COUNT(id) FROM dbo.Table_1 WHERE id > 20 AND id <= 32.5);
set @TotalRows = (Select Count(id) from dbo.Table_1);

SELECT CAST(((@1 * 100)/@TotalRows) as nvarchar(32)) + '%', CAST(((@2 * 100)/@TotalRows) as nvarchar(32)) + '%'; 
```

有点复杂，但这确实有效......我想......

dbo.Table_1 只有 1 列，“id”，它是 int 类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T18:17:50.953

如果这是您将定期做的事情，那么您可以创建一个包含范围的表格以及这些范围的组成部分。如果没有，您可以将它们设置在表变量或临时表中并加入其中。它基本上是 JohnOpincar 的解决方案，但使用的是表而不是子查询。

此外，在您的示例中，您列出了“10 到 20”和“20 到 32.5”。如果正好是 20 行在哪里计算？在交付最终解决方案之前，您可能应该确保您的需求在这一点上是明确的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T17:30:41.440

我通常会使用子查询并获取范围计数并加入总数以获取百分比。就像是：

```
SELECT 
  RangeCount/CNT as Percentage,
  Range
FROM 
(
SELECT
  Count(*) AS CNT
FROM
  SomeTable
) AS Total
LEFT JOIN 
(
SELECT
  CASE Val <= 10 then
       '0 up to 10'
  ELSE 
       CASE when Val <= 20
         '11 to 20'
       ELSE 
        '> 20'
       END
    END
  END AS Range,
  COUNT(*) AS RangeCount
FROM 
   SomeTable
GROUP BY
   Range
) AS RangeTotals 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-08T20:36:03.037

Joel's answer seems the best way to me. Posting to explain the query, and because the answer has an integer division sum/count which will return 1 or 0 instead of a percentage.

For the 20 -> 32.5 range:

```
select CAST(SUM(
    CASE WHEN 20 < field AND field <= 32.5 THEN 1 ELSE 0 END
    ) as float) / COUNT(*) * 100.0
from table 
```

The case returns 1 when the value is in range. Because there's no group by clause, the sum adds the result of the case for every row in the table. Convert to float, divide by the number of rows =count(*), and you get the percentage.

You can also write it like:

```
select SUM(
    CASE WHEN 20 < field AND field <= 32.5 THEN 1.0 ELSE 0.0 END
    ) / COUNT(*) * 100
from table 
```

Here the CASE will result in a float 1.0 instead of the integer 1.

# c++ - 用一种语言编写的代码如何从另一种语言调用

> ID：840888
> 
> 赞同：7
> 
> 时间：2009-05-08T17:15:09.230
> 
> 标签：c++, programming-languages, scheme, compilation, interpreter

这是一个我一直想知道答案但从未真正问过的问题。

由一种语言（尤其是解释型语言）编写的代码如何被编译型语言编写的代码调用。

例如，假设我正在用 C++ 编写一个游戏，并且我将一些 AI 行为外包给了用 Scheme 编写的。用 Scheme 编写的代码如何达到编译后的 C++ 代码可以使用的程度？C++ 源代码如何使用它，C++ 编译代码如何使用它？使用方式有区别吗？

### 有关的

> [多语言如何在一个项目中交互？](https://stackoverflow.com/questions/636841/how-do-multiple-languages-interact-in-one-project/636851)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-08T17:50:28.287

这个问题没有一个在任何地方都有效的单一答案。一般来说，答案是两种语言必须就“某事”达成一致——一组或规则或“调用协议”。

在高层次上，任何协议都需要指定三件事：

*   “发现”：如何发现彼此。
*   “链接”：如何建立联系（在他们相互了解之后）。
*   “调用”：如何实际向对方提出请求。

细节很大程度上取决于协议本身。

有时这两种语言会协同工作。有时这两种语言同意支持一些外部定义的协议。如今，操作系统或“运行时环境”（.NET 和 Java）也经常参与其中。有时，该能力只有一种方式（“A”可以调用“B”，但“B”不能调用“A”）。

请注意，这与任何语言在与操作系统通信时面临的问题相同。Linux 内核不是用 Scheme 编写的，你知道的！

让我们看看来自 Windows 世界的一些典型答案：

*   **C 与 C++**：C++ 使用“C 协议”的扭曲（“损坏”）变体。C++ 可以调用 C，C 也可以调用 C++（尽管名称有时会很混乱，翻译名称可能需要外部帮助）。这不仅仅是 Windows；在支持两者的所有平台上通常都是如此。大多数流行的操作系统也使用“C 协议”。

*   **VB6 与大多数语言**：VB6 的首选方法是“COM 协议”。其他语言必须能够编写 COM 对象才能在 VB6 中使用。VB6 也可以生成 COM 对象（尽管不是所有可能的 COM 对象变体）。

    VB6 还可以谈论“C 协议”的一个非常有限的变体，然后只能在外部进行调用：它不能创建可以直接通过“C 协议”与之交谈的对象。

*   **.NET 语言**：所有 .NET 语言都编译为相同的低级语言 (IL)。运行时管理通信，从这个角度来看，它们看起来都像同一种语言。

*   **VBScript 与其他语言**：VBScript 只能谈论 COM 协议的一个子集。

还有一点需要注意：SOAP“Web 服务”实际上也是一种“调用协议”，就像许多其他正在流行的基于 Web 的协议一样。毕竟，这都是关于与用不同语言编写的代码交谈（并且在不同的盒子中运行！）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T17:20:56.237

通常，C++ 代码将调用脚本语言的解释器。编译代码和脚本代码之间的交互程度取决于解释器，但总有一种方法可以在两者之间传递数据。根据解释器的不同，可能可以从另一侧操作一侧的对象，例如调用 Ruby 对象上的方法的 C++ 函数。甚至可能有一种方法可以控制另一个的执行。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-08T17:29:59.163

有一个关于模块如何通信的协议。以下是对其工作原理的高级、广泛的概述：

1.  为您想要“共享”的代码创建了一个库。根据您的平台，这些通常称为 DLL 或 SO。
2.  您要公开的每个功能（入口点）都将可供外部世界绑定。有一些关于如何绑定的协议，例如调用约定，它指定传递参数的顺序、谁清理堆栈、有多少参数存储在寄存器中以及哪些参数等。有关调用示例，请参见 cdecl、stdcall 等[这里](http://en.wikipedia.org/wiki/Calling_convention)的约定。
3.  然后调用模块将静态或动态绑定到共享库。
4.  一旦您的调用库绑定到共享库，它就可以指定要绑定到特定入口点。这通常是按名称完成的，但是大多数平台还提供按索引绑定的选项（如果您的模块更改和入口点重新排序，则更快，但更脆弱）。
5.  您通常还会在模块中的某个地方声明要调用的函数，以便您的语言可以进行静态类型检查，知道调用约定是什么等。

对于从 C++ 调用 Scheme 的场景，Scheme 解释器很可能会导出一个动态绑定到 Scheme 函数/对象并调用它的函数。如果 Scheme 模块已编译，它可能具有导出入口点的选项，以便您的 C++ 模块可以绑定到该入口点。我对 Scheme 不是很熟悉，所以其他人可能比我更好地回答该特定绑定的细节。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T17:37:28.053

您还可以集成这两个环境，而无需在可执行文件中编译解释器的库。您将 exe 和 Scheme exe 作为单独的程序保存在系统上。从您的主 exe 中，您可以将您的方案代码写入文件，然后使用 system() 或 exec() 来运行方案解释器。然后解析方案解释器的输出。

上面建议的方法将 exe 分开，您不必担心 3rd 方依赖关系，它们可能很重要。问题也包含在一个或另一个 exe 中。

如果运行单独的 exe 不能满足您的性能要求，您可以设计一个协议，其中 Scheme 解释器成为服务器。您需要编写一些在套接字或文件上等待输入的 Scheme 函数，评估该输入，然后将结果输出到同一个套接字或不同的文件。另一个迭代是查看可能已经在运行解释器的现有服务器，例如 apache 具有允许以多种语言编写代码的模块。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-08T17:34:04.957

如果您实际上是在寻找工具来做这样的事情，就像亚当的回应，请参阅[swig](http://www.swig.org/)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-08T20:08:42.823

From a theoretical point of view, when program A need to use resources(class/functions/etc) from program B, it's about passing in some information from A to B, and get some information back or some actions performed. So there needs to be a way provided by B that allows A to pass in information and get result.

In practice, it usually lies on the shoulder of languages to handle this process: the language B(program B is written in) will generate a protocol and make resources in B available in a predefined way, then language A(program A is written in) will provide some utility/framework to help invocate the exposed resources and get results following B's protocol.

To be more specific to your question, for interpreted languages, the process is fairly universal, the protocol is normally among the lines of command line parameter, HTTP request and other ways of transmitting plain text. Take the first example, program B will receive a call from HTTP request as input, and then process the request from there on. The actual format of input is totally decided by program B.

Things like SOAP and etc, are just a way to regulate programs to take input in a commonly agreed standard.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-08T20:26:18.227

It's been a decade or so, but I did exactly this for my senior capstone (Well, I built a back-propogating neural network in C, and used a scheme program to teach it). The version of Scheme I was using had a compiler as well as an intepreter, and I was able to build it as a .o file. I don't know the version of scheme I was running, but it appears the RScheme will turn your scheme code into C.

# java - 如何根据按钮操作在框架内切换面板？

> ID：840893
> 
> 赞同：5
> 
> 时间：2009-05-08T17:15:43.580
> 
> 标签：java, swing, event-handling, jpanel, jbutton

我创建了一个具有工具栏、菜单栏和内容区域的应用程序。我已将菜单和工具栏添加到应用程序窗口，但我坚持根据通过工具栏单击的按钮操作（如添加、显示）在内容区域中显示面板。这是正确的方法吗？有没有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-08T17:22:52.830

如果我理解正确，您想要多个`JPanels`，一次只显示一个？如果是这种情况，听起来 a[`CardLayout`](http://java.sun.com/javase/6/docs/api/java/awt/CardLayout.html)就是您所需要的。你基本上用唯一的名字[添加](http://java.sun.com/javase/6/docs/api/java/awt/CardLayout.html#addLayoutComponent%28java.awt.Component,%20java.lang.Object%29)你的所有`JPanels`东西，然后你可以告诉`CardLayout`它们中的哪一个来[显示](http://java.sun.com/javase/6/docs/api/java/awt/CardLayout.html#show(java.awt.Container,%20java.lang.String))。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T20:38:24.000

我认为 CardLayout 可能是您想要的，但是如果像内存使用这样的问题是一个问题并且您真的想删除并添加一个新的 JPanel/组件，您需要删除旧的 JPanel 并添加新的 JPanel（具有适当的约束和/或索引取决于布局）。进行切换后，您必须 validate() 内容窗格。

# c++ - 如何计算从立体图像到密集视差图？

> ID：840894
> 
> 赞同：2
> 
> 时间：2009-05-08T17:15:50.383
> 
> 标签：c++, image-processing, stereoscopy, disparity-mapping

如何计算从立体图像到立体图像的密集视差图？

到目前为止，我的想法是检查第一张图像中的所有像素，然后扫描第二张图像以查找匹配项。为了比较两个像素的相似性，我计算了它们周围一个小窗口中像素的平方差。该算法在合成图像上效果相对较好，但在包含反射或光强度差异较大的图片上失败。我应该使用什么方法来获得更好的结果？

图像处理大师，请分享你的知识。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T22:28:04.610

Otto-Chau 立体匹配算法非常有效，它结合了具有亚像素精度的自适应最小二乘补丁匹配以及匹配图像上的区域增长：

Otto, GP, Chau, TKW, 1989。用于匹配地形图像的“区域增长”算法。图像视觉计算，7(2)，第 83-94 页。

这是一种基于区域的方法，因此在一定程度上依赖于图像中合理数量的纹理。如果您的图像数据非常稀疏，则基于特征的方法可能会更好，可能会通过自适应 LS 匹配来增强准确性。相关方法易于实现并且速度很快，但由于它们不考虑图像之间的仿射翘曲，因此它们通常不如使用 Newton-Raphson 方案以最小化翘曲次数和辐射测量参数以获得图像之间的非常好的拟合。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T17:32:03.510

我发现这篇文章是关于计算密集视差图的方法，如果你点击链接，你可以获得详细描述他们方法的 PDF。不幸的是，我的图像处理经验不包括立体视觉，因此我无法评论所呈现算法的质量。

[http://serdis.dis.ulpgc.es/~lalvarez/research/demos/StereoFlow/](http://serdis.dis.ulpgc.es/~lalvarez/research/demos/StereoFlow/)

我将检查我的文本以获取有关此主题的任何进一步材料。

编辑：我浏览了我拥有的书籍和 Linda G. Shapiro 和 George C. Stockman 的“计算机视觉”，在已知相机和图像方向时，对立体镜背后的数学进行了约 10 页的解释，并指出了有关相关性的部分找到立体图像之间的共同特征，但在视差映射上一无所获。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T18:19:16.470

计算差异的一种流行且有效的方法涉及图形切割。本质上，一个图形是由​​两个图像创建的，然后以这样一种方式进行切割，以最小化图像中深度不连续性导致的能量。康奈尔大学的 Ramin Zabih 有很多关于这个主题的论文：

[http://www.cs.cornell.edu/~rdz/graphcuts.html](http://www.cs.cornell.edu/~rdz/graphcuts.html)

我建议“通过图形切割快速近似能量最小化”作为概述。

# c# - 如何以编程方式单击 TreeView TreeNode，使其在列表中突出显示并触发 AfterSelect 事件？

> ID：840899
> 
> 赞同：9
> 
> 时间：2009-05-08T17:16:47.417
> 
> 标签：c#, winforms, treeview

我在 Winforms 应用程序中有一个 TreeView 控件，基本上目标是显示一个包含 TreeView 控件的表单，我想显示一个打开并选中节点的表单（简单 - EnsureVisible）。

我遇到的问题是，当我设置 TreeView 控件的 SelectedNode 属性时，节点没有突出显示，并且 AfterSelect 事件没有像我期望的那样触发。AfterSelect 很容易编写代码，但缺少突出显示很烦人。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-08T17:31:18.380

是因为 TreeView 没有焦点吗？将 TreeView 的 HideSelection 属性设置为 False 会改变您看到的行为吗？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-08T17:29:52.393

设置 SelectedNode 之后。尝试选择树视图。反正为我工作。

```
private void button1_Click(object sender, EventArgs e)
{
this.treeView1.SelectedNode = this.treeView1.Nodes[1];
this.treeView1.Select();
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-03-10T11:47:40.370

试试这个使选定的节点加粗：

```
selectedNode.NodeFont = new System.Drawing.Font(
    selectedNode.TreeView.Font,
    selectedNode.TreeView.Font.Style | FontStyle.Bold);

// You need to append an emptry string to work around this bug: 
// http://support.microsoft.com/kb/937215
selectedNode.Text += string.Empty; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-09T13:14:44.033

好吧，我猜我很快就问了这个问题。找到了解决方案：

```
//clear background
RadTreeNodeCollection nodes = rtrvNetworkAll.Nodes;
foreach (RadTreeNode n in nodes)
{
        this.ClearRecursive(n);
}
//search a node with the build in find function
foreach (RadTreeNode n in nodes)
{
        this.FindRecursive(n);
}

// recursively move through the treeview nodes
private void FindRecursive(RadTreeNode treeNode)
{
        foreach (RadTreeNode tn in treeNode.Nodes)
        {
                // if the text properties match, color the item
                if (tn.Text == this.txtSearch.Text)
                {
                    tn.BackColor = Color.Yellow;
                }
                FindRecursive(tn);
        }
}

private void ClearRecursive(RadTreeNode treeNode)
{
       foreach (RadTreeNode tn in treeNode.Nodes)
       {
                tn.BackColor = Color.White;
                ClearRecursive(tn);
       }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-09-29T15:29:24.093

以编程方式执行此操作（我发现）的最简单方法是伪造点击事件。我需要这样做，因为当我使用 TreeView.Nodes.Find() 搜索节点时，我需要它在向下的过程中单击层次结构的每个级别。所以我基本上做了以下事情：

```
tvMyTreeView_NodeMouseClick(tvMyTreeView, new TreeNodeMouseClickEventArgs(myNode, MouseButtons.Left, 1, 0, 0)); 
```

这触发了我的事件并假装在 myNode 节点上单击左键。在该事件中，您可以格式化 e.Node 但是您想对其进行着色。希望这可以帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-08T17:32:50.263

通过突出显示，我假设您的意思是使文本变粗。它不像其他一些客户端技术那样优雅，但是您可以处理正在更改的节点并将所选节点设为粗体，例如

```
treeNode.Font = new Font(treeNode.Font, treeNode.Font.Style | treeNode.Bold); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-05-26T16:47:09.863

对我来说，问题是`TreeView`控件不一定具有焦点，因此所选节点未突出显示。以下代码对我有用：

```
treeView.Focus();
treeView.SelectedNode = myTreeNode; 
```

`TreeView`我在为控件实现一些拖放功能时遇到了这个确切的问题。

# vim - Vim：基于字符串的采购

> ID：840900
> 
> 赞同：21
> 
> 时间：2009-05-08T17:17:36.760
> 
> 标签：vim

在网上众多的 Vim 脚本教程中，我似乎都找不到答案。我想要做的是从环境变量构造一个脚本的文件名，然后获取它。我想在 Vim 中完成。

如果我要在 shell 中执行此操作，我会执行以下操作：

```
source ${HOME}/.vim/myscript_${FOO}.vim 
```

我如何在 Vim 中做到这一点？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-05-08T17:49:49.210

您可以建立一个字符串，然后使用执行命令：

```
exec "source " . $HOME . "/.vim/myscript_" . l:foo . ".vim" 
```

（`l:foo`这里是在函数中使用局部变量的示例。）

* * *

### 编辑：

但实际上`exec`在这种特定情况下是矫枉过正的。正如 rampion[这里所示](https://stackoverflow.com/questions/840900/vim-sourcing-based-on-a-string/841025#841163)，OPs 任务可以直接通过以下方式完成：

```
source $HOME/.vim/myscript_$FOO.vim 
```

尽管 vim 不允许我们`${...}`像在 shell 中那样整齐地包装变量名，但在这种情况下，我们很幸运，`HOME`它由the`/`和`FOO``.`

通常，如果您`exec` *想*通过非终止字符跟随变量之一，则需要。例如：

```
exec "source " . $BAR . "_script.vim" 
```

将插入`BAR`变量，而以下将尝试找到一个名为 的变量`BAR_script`：

```
source $BAR_script.vim       " Possibly not what you wanted! 
```

### 使用 shellescape() 以确保安全

在将变量添加到要执行的字符串时，我们应该真正使用`shellescape()`来转义奇怪的字符（例如文件名中的空格）。

例如，这些是上述更安全的版本：

```
exec "source " . shellescape($HOME . "/.vim/myscript_" . l:foo) . ".vim"

exec "source " . shellescape($BAR) . "_script.vim" 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T18:25:56.550

只`:source`为我工作：

```
% export MYPATH='a/b/c'
% mkdir -p $MYPATH
% export MYFILE='temp.vim'
% cat > $MYPATH/$MYFILE
echo 'hello world'
^D
% vim
:source $MYPATH/$MYFILE
hello world 
```

但是，如果您想自动获取一些 vim 脚本，只需将它们放在您的`~/.vim/plugin/`目录中，它们就会为您加载，而无需手动执行。

从`:help expand-environment-var`（我通过做`:help environment`和制表符完成到第一个可能的结果）

```
             *:set_env* *expand-env* *expand-environment-var*
    特定字符串选项中的环境变量将被扩展。如果
    环境变量存在'$'和以下环境变量
    name 被替换为它的值。如果不存在 '$' 和名称
    不修改。任何非 id 字符（不是字母、数字或“_”）都可以
    遵循环境变量名称。那个角色和接下来是
    附加到环境变量的值。示例：>
       :set term=$TERM.new
       :set path=/usr/$INCLUDE,$HOME/include,.
    当使用 ":set opt-=val" 或 ":set 从选项中添加或删除字符串时
    opt+=val" 扩展是在添加或删除之前完成的。

```

我倾向于发现 vim 的内置帮助比其他任何东西都更有用，但确实需要一段时间才能掌握知道要查找什么的诀窍。

# vb.net - 进程间读写器锁定（或文件句柄和访问被拒绝）

> ID：840901
> 
> 赞同：0
> 
> 时间：2009-05-08T17:17:49.910
> 
> 标签：vb.net, file, locking, file-security

好吧，先来点背景。我们需要一个进程间读/写锁。我们决定使用一个文件并使用 LockEx 和 UnlockEx 锁定第一个字节。该类在创建时会在系统临时文件夹中创建一个文件。该文件创建时具有读写访问权限并共享读|写|删除。我们还指定了 DeleteOnClose，这样我们就不会留下大量的临时文件。显然，AcquireReader 和 AcquireWriter 使用适当的标志调用 LockEx，而 ReleaseLock 调用 UnlockEx。
我们已经使用一个可以运行多个实例的小型应用程序测试了这个类，并且它运行良好。使用它的应用程序有问题，我们已设法在另一个小型测试应用程序中重新生成。在伪代码中是

```
创建 InterProcessReaderWriter
在不获取任何锁的情况下处理 InterProcessReaderWriter
启动一个需要读卡器锁的子进程

```

第一次运行时，它运行良好。如果您尝试再次运行它，而第一次的子进程仍然持有锁，我们会在尝试打开文件时收到 UnauthorisedAccessException。
这似乎是一个权限问题，而不是共享冲突，但此测试用例中的所有进程都以同一用户身份运行。这里有人有什么想法吗？

我注意到另一个问题，它建议使用互斥锁和信号量来实现我们想要的。我可能会改变我们的实现，但我仍然想知道是什么导致了这个问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-09T21:24:28.357

在我看来，子进程正在尝试访问同一个文件两次。

临时文件名是唯一的吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-05T11:36:48.050

为什么不锁定整个文件？而不是第一个字节。下面的示例类的好处是它可以跨不同机器上的进程工作，而不是将其限制在一台机器上。

这是一个使用下面的 lockfilehelper 类的简单示例。

```
Module Module1
    Sub Main()
        Using lockFile As New LockFileHelper("\\sharedfolder\simplefile.lock")
            If lockFile.LockAcquire(1000) Then
                ' Do your work here.
            Else
                ' Manage timeouts here.
            End If
        End Using
    End Sub
End Module 
```

这是 Helper 类的代码。

```
Public Class LockFileHelper
    Implements IDisposable
    '-------------------------------------------------------------------------------------------------
    ' We use lock files in various places in the system to provide a simple co-ordination mechanism
    ' between different threads within a process and for sharing access to resources with the same
    ' process running across different machines.
    '-------------------------------------------------------------------------------------------------
    Private _lockFileName As String
    Private _ioStream As IO.FileStream
    Private _acquiredLock As Boolean = False
    Private _wasLocked As Boolean = False
    Public Sub New(ByVal LockFileName As String)
        _lockFileName = LockFileName
    End Sub
    Public ReadOnly Property LockFileName() As String
        Get
            Return _lockFileName
        End Get
    End Property
    Public ReadOnly Property WasLocked() As Boolean
        Get
            Return _wasLocked
        End Get
    End Property
    Public Function Exists() As Boolean
        Return IO.File.Exists(_lockFileName)
    End Function
    Public Function IsLocked() As Boolean
        '-------------------------------------------------------------------------------------------------
        ' If this file already locked?
        '-------------------------------------------------------------------------------------------------
        Dim Result As Boolean = False
        Try
            _ioStream = IO.File.Open(_lockFileName, IO.FileMode.Create, IO.FileAccess.ReadWrite, IO.FileShare.None)
            _ioStream.Close()
        Catch ex As System.IO.IOException
            ' File is in used by another process.
            Result = True
        Catch ex As Exception
            Throw ex
        End Try

        Return Result
    End Function
    Public Sub LockAcquireWithException(ByVal TimeOutMilliseconds As Int32)
        If Not LockAcquire(TimeOutMilliseconds) Then
            Throw New Exception("Timed out trying to acquire a lock on the file " & _lockFileName)
        End If
    End Sub
    Public Function LockAcquire(ByVal TimeOutMilliseconds As Int32) As Boolean
        '-------------------------------------------------------------------------------------------------
        ' See have we already acquired the lock. THis can be useful in situations where we are passing
        ' locks around to various processes and each process may want to be sure it has acquired the lock.
        '-------------------------------------------------------------------------------------------------
        If _acquiredLock Then
            Return _acquiredLock
        End If

        _wasLocked = False
        Dim StartTicks As Int32 = System.Environment.TickCount
        Dim TimedOut As Boolean = False
        If Not IO.Directory.Exists(IO.Path.GetDirectoryName(_lockFileName)) Then
            IO.Directory.CreateDirectory(IO.Path.GetDirectoryName(_lockFileName))
        End If
        Do
            Try
                _ioStream = IO.File.Open(_lockFileName, IO.FileMode.Create, IO.FileAccess.ReadWrite, IO.FileShare.None)
                _acquiredLock = True
            Catch ex As System.IO.IOException
                ' File is in used by another process.
                _wasLocked = True
                Threading.Thread.Sleep(100)
            Catch ex As Exception
                Throw ex
            End Try
            TimedOut = ((System.Environment.TickCount - StartTicks) >= TimeOutMilliseconds)
        Loop Until _acquiredLock OrElse TimedOut
        '-------------------------------------------------------------------------------------------------
        ' Return back the status of the lock acquisition.
        '-------------------------------------------------------------------------------------------------
        Return _acquiredLock
    End Function
    Public Sub LockRelease()
        '-------------------------------------------------------------------------------------------------
        ' Release the lock (if we got it in the first place)
        '-------------------------------------------------------------------------------------------------
        If _acquiredLock Then
            _acquiredLock = False
            If Not IsNothing(_ioStream) Then
                _ioStream.Close()
                _ioStream = Nothing
            End If
        End If
    End Sub
    Private disposedValue As Boolean = False        ' To detect redundant calls
    ' IDisposable
    Protected Overridable Sub Dispose(ByVal disposing As Boolean)
        If Not Me.disposedValue Then
            If disposing Then
                Call LockRelease()
            End If

            ' TODO: free shared unmanaged resources
        End If
        Me.disposedValue = True
    End Sub
#Region " IDisposable Support "
    ' This code added by Visual Basic to correctly implement the disposable pattern.
    Public Sub Dispose() Implements IDisposable.Dispose
        ' Do not change this code.  Put cleanup code in Dispose(ByVal disposing As Boolean) above.
        Dispose(True)
        GC.SuppressFinalize(Me)
    End Sub
#End Region
End Class 
```

# .net - PowerShell、扩展方法和猴子补丁

> ID：840907
> 
> 赞同：8
> 
> 时间：2009-05-08T17:20:46.737
> 
> 标签：.net, powershell, extension-methods, monkeypatching

是否可以在 PowerShell 中编写扩展方法？或者在运行时在现有类型（如 [string] ）之上添加一个新方法？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-10T18:28:18.073

如果您有要添加到特定类型的方法或属性，则可以通过 PowerShell 的自适应类型系统创建自定义类型扩展。

自定义类型扩展是一个 XML 文件，用于描述类型的属性或脚本方法，然后通过 Update-TypeData cmdlet 将其加载到 PowerShell 会话中。

可以在[PowerShell 团队博客 - 讨厌添加成员？（PowerShell 的自适应类型系统救援）](http://blogs.msdn.com/powershell/archive/2008/09/06/hate-add-member-powershell-s-adaptive-type-system.aspx)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-08T17:38:34.167

我不知道用扩展方法修补类型的方法。但是当然可以通过 add-member cmdlet 修补对象

```
PS> $a = "foo"
PS> $a = add-member -in $a -memberType ScriptMethod -name Bar -value { $this + "bar" } -passthru
PS> $a.Foo()
foobar 
```

**编辑**解释完全和完全可读的 PowerShell 语法:)

我喜欢 PowerShell，但它确实时不时会提出神秘的语法。

*   “-in”：这是 inputObject 的缩写，本质上表示向此添加成员
*   “-memberType”：您可以将许多不同类型的值添加到运行时对象，包括方法、注释属性、代码方法等……完整列表请参见“get-help add-member -full”
*   “-passthru”：获取刚刚添加成员的对象并将其推送到管道中。如果没有这个标志，分配将被分配和空管道到`$a`.
*   赋值调用基本上是确保`$a`现在有你添加的方法

# javascript - 如何创建 W3C 或 Gmail 风格的#anchor“链接”？

> ID：840922
> 
> 赞同：2
> 
> 时间：2009-05-08T17:25:00.703
> 
> 标签：javascript, gmail, anchor, w3c, hyperlink

如果您使用 Gmail，您会在地址栏中看到如下网址：
*[https://mail.google.com/mail/#inbox](https://mail.google.com/mail/#inbox)*
*[https://mail.google.com/mail/#starred](https://mail.google.com/mail/#starred)*
如果您转到其中一个这些 URL，它会直接跳转到相应的视图。

[http://validator.w3.org](http://validator.w3.org)上有一个类似的例子，`#validate_by_uri`其中的 anchors`#validate_by_upload`和`#validate_by_input`每个自动聚焦不同的选项卡。

这些事情是怎么做的？该页面是否使用 Javascript 来检测锚点然后为您切换视图？如何防止页面滚动到锚点位置？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T17:28:36.280

该页面使用 JavaScript 来评估对象的 " `hash`" 属性`window.location`。

通过禁用 JavaScript 来尝试一下。至少对于验证器页面，这会产生一个不足为奇的结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T21:19:29.407

YUI 包括一个为您实现的[历史管理器](http://developer.yahoo.com/yui/history/)。检查[源代码](http://github.com/yui/yui2/blob/102bb76d2082e0cd6ba991e2ec1db32b510c1710/build/history/history.js)应该可以帮助您理解它是如何工作的。

# linq-to-sql - 如何判断给定的 Linq-to-Sql 对象是否附加到数据上下文？

> ID：840924
> 
> 赞同：5
> 
> 时间：2009-05-08T17:25:27.443
> 
> 标签：linq-to-sql, datacontext

我将 linq 2 sql 用于我的 ORM。

出于性能原因，我将其中的一些序列化，然后将它们放入 memcached 中。

当它们被反序列化时，它们当然不会附加到数据上下文，这 100% 没问题，因为它们仅用于在这些场景中读取。

然而，出于理智的原因，我希望能够判断给定对象是否附加到数据上下文（从数据库中获取），或者没有（从 memcached 中获取）。

有任何想法吗？

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-15T20:03:13.040

使用 GetOriginalEntityState。这是一个测试。

```
客户 cust = new Customer();
ctx.Customers.Attach(cust);

客户来源 = ctx.Customers.GetOriginalEntityState(cust);

//测试orig是否为null

```

# asp.net - 会话安全和 ASP.NET Ajax

> ID：840929
> 
> 赞同：2
> 
> 时间：2009-05-08T17:26:12.980
> 
> 标签：asp.net, ajax, security

我开始使用 ASP.NET Ajax。按照[Eric Pascarello 的](http://weblogs.asp.net/rhurlbut/archive/2006/02/16/438365.aspx)建议，我总是假设任何事情都可能来自客户端（包括虚假请求）。

我很难解释的一件事是用户身份验证。由于我们使用 .NET 的内置会话状态管理机制，我有点不知道 Web 服务存在哪些安全风险。

我需要做什么来确定用户就是他所说的那个人（以足够合理的概率）？正在使用

```
[WebMethod(EnableSession = true)] 
```

足够？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T17:43:13.470

这就是您确保 Session 对象在您的方法中可用的方式。如果您想确保它们已通过身份验证，请在您的 web.config 中进行配置

```
<location path="MyService.asmx">
    <system.web>
      <authorization>
        <deny users="?" />
      </authorization>
    </system.web>
  </location> 
```

# ruby-on-rails - Rails i18n 配置文件管理最佳实践

> ID：840930
> 
> 赞同：5
> 
> 时间：2009-05-08T17:26:16.053
> 
> 标签：ruby-on-rails, ruby, internationalization

我正在对 RoR 网站进行 i18n 转换。我正在使用 Sven Fuchs textmate bundle 和 NewDesk 的翻译插件。我从 Sven Fuchs 提供的 yaml 文件开始（[http://github.com/svenfuchs/rails-i18n/tree/3e1994d137e1785689e39f6e957087d3baed0011/rails/locale](http://github.com/svenfuchs/rails-i18n/tree/3e1994d137e1785689e39f6e957087d3baed0011/rails/locale)）

我很快看到文件之间的密钥不同步，在开发实例之间进行管理变得很痛苦，使用“FROM=en TO=ru rake translate:google”任务或“rake translate:merge_keys”更新产品

*   yaml翻译文件扩散的最佳实践是什么？
*   跨环境同步 yaml 文件的最佳实践是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-20T17:42:02.410

您是否考虑过从数据库生成文件？我不确定其他人对此的看法，但我需要为客户项目提供一个接口来编辑国际化信息。

所以我把每一个都放入整个网站的语言配置文件中，让他们编辑它。他们有一个按钮可以根据 build.. 生成最新文件。也许你可以找出对你有用的东西？我最终做的是用翻译存储每个数据库行以获得版本号。因此，根据我正在直播的内容，它会发现所有旧内容......从技术上讲，在语言文件中包含新内容也不会伤害你，因为它根本不会被使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-10-19T06:25:29.147

认为您可能对我正在从事的一个名为[Locale](http://www.localeapp.com)的项目感兴趣。它提供了一个很好的 UI 来管理您的翻译以及一些同步工具，这样您就不必再编写 YAML 了：)

# .net - .NET 中的 XML HTTP POST 集成

> ID：840933
> 
> 赞同：3
> 
> 时间：2009-05-08T17:27:00.480
> 
> 标签：.net, http, post, xml-serialization

我正在开发一个与外部公司集成的 .NET 项目。该公司将通过 HTTP POST（原始 XML，而不是 SOAP）向我们发送 XML 消息。他们将向我们发送基本上三种不同类型的 XML 消息，它们都有自己的 XSD。这些 XSD 之间没有继承层次结构，它们基本上都是独立的 XML“实体”。

现在，我们只是使用 IHttpHandler .ashx 类来处理 XML。我们从每个 XSD 创建了一个类，并使用 XmlSerializer 将不同的 XML 消息转换为对象。这并不理想，因为在创建适当的 XmlSerializer 来处理它之前，我们需要知道消息的类型。我们目前只是查看消息中的根元素名称来选择传递给 XmlSerializer 的类型。

必须有更好的方法来做到这一点...... WCF 中有什么东西可以用纯 XML 自动完成吗？或者是否有可以动态序列化多种类型的 XML 序列化器？还有其他建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T18:01:40.553

WCF 作为 RESTful+POX

[Windows Communication Foundation (WCF) 中的](http://msdn.microsoft.com/en-us/netframework/cc950529.aspx)[REST 和 POX REST](http://msdn.microsoft.com/en-us/library/aa395208.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-08T18:03:00.427

我对 XMLSerializer 的唯一问题是它非常脆弱。更改 XML 以获得更多功能，您可能会破坏客户端。我认为最好自己解析 XML。也许使用 Linq XDocument/XElement？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T19:36:51.043

Linq to XML 类非常灵活且易于使用。您可以新建一个 XElement 并输入您的 XML 字符串。

```
XElement xml = XElement.Parse(receivedXmlString); 
```

任务完成。

Anders Heijlsberg 在 MIX07 上就这方面做了一场精彩的会议，“[使用 LINQ 显着改进 Web 应用程序中的数据驱动开发](http://videos.visitmix.com/MIX07/DEV04)”。您可能会发现该视频很有用。Linq to XML 的内容大约是 26 分钟。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-09T19:59:47.483

我将使用 XML Serializer，只是以比您目前使用的更通用的方式。

如果消息可以是三种类型之一，您仍然可以使用 XML Serializer 自动读取和反序列化 - 您无需检查第一个元素来区分它们。但它要求您将 XSD 合并到一个统一的 XSD 中，然后在 .NET 端生成一个统一的“联合”类型。您也可以通过合并生成的类型，然后使用 xsd.exe 工具从中派生生成的 XSD 来实现此目的。

在我看来，XML Serializer 所谓的“脆弱性”不是问题。如果您使用依赖于 XSD 的 XML 数据绑定技术，XML 通常会很脆弱，XML 序列化也是如此。脆弱的不是 XML 序列化本身。IT 是脆弱的架构。如果架构本身的设计没有考虑到进化，那么基于架构的方法（包括 .NET 中的 XML 序列化）可能会很脆弱。例如，适当使用 xsd:any 和 xsd:xmlAny、消息版本标记等。好消息是对于设计可以优雅发展的灵活模式有很好的指导。

但是，这一切都可能不是问题，因为架构已经存在。在任何情况下，您都不会使用 XML Serializer 给系统添加“脆弱性”。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-08T18:00:25.190

为什么不使用 XmlReadMode.Auto 将其读入数据集？然后，您就有了一个可以适当读取的对象——您可以查看 Table[0] 以查看您拥有的是哪一个。

# sql-server - SQL Server 2005 中 LOCK_ESCALATION = TABLE 的等价物是什么？

> ID：840942
> 
> 赞同：32
> 
> 时间：2009-05-08T17:29:27.433
> 
> 标签：sql-server, sql-server-2005, sql-server-2008, syntax, locking

我有一个在 SQL Server 2008 中生成的脚本，但我需要针对 SQL Server 2005 数据库执行它。

SQL Server 2005 中的以下等效语句是什么？

```
ALTER TABLE dbo.Event SET (LOCK_ESCALATION = TABLE) 
```

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-05-09T10:45:38.237

`LOCK_ESCALATION = TABLE`是 SQL Server 2008 中的默认行为，并且是 SQL Server 2005 中的唯一行为。

您可以安全地删除该语句，而无需更改任何功能。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-09T10:04:56.167

没有等效选项：它是[SQL Server 2008 中的新](http://www.sqlskills.com/blogs/paul/post/SQL-Server-2008-Partition-level-lock-escalation-details-and-examples.aspx)选项。

您需要将“Script For version”更改为 SQL Server 2005，

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-07-19T00:53:53.933

> ^([@gbn](https://stackoverflow.com/users/27535/gbn) [写道](https://stackoverflow.com/a/843059/692942))
> “*您需要将“脚本版本”更改为 SQL Server 2005”*

在 SQL Server Management Studio 2008 中选择菜单工具-选项（[SQL Server 对象资源管理器/脚本页面](http://msdn.microsoft.com/en-us/library/bb326600.aspx)）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T18:28:46.463

在脚本生成向导中，将选项 Script For version 设置为 SQL 2005，它应该会为您提供正确的脚本。

# php - 从 PHP 中的字符串中删除除字母数字字符之外的所有内容

> ID：840948
> 
> 赞同：40
> 
> 时间：2009-05-08T17:30:17.540
> 
> 标签：php, regex, string

我想要一个正则表达式或其他字符串，它可以替换字符串中除了字母数字字符（`a-z`和`0-9`）之外的所有内容。所有东西`,@#$(@*810`都应该被剥离。有任何想法吗？

编辑：我现在需要这个来剥离所有东西，但允许点，所以除了`a-z, 1-9, .`. 想法？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-05-08T17:34:50.260

```
$string = preg_replace("/[^a-z0-9.]+/i", "", $string); 
```

匹配一个或多个非 az 0-9 [不区分大小写] 或 "." 的字符 并替换为“”

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-05-08T17:43:47.727

我喜欢为此使用 [^[:alnum:]]，这样可以减少出错的空间。

```
preg_replace('/[^[:alnum:]]/', '', "(ABC)-[123]"); // returns 'ABC123' 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-08T17:32:13.370

```
/[^a-z0-9.]/ 
```

应该做的伎俩

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-08T17:34:21.960

尝试：

```
$string = preg_replace ('/[^a-z0-9]/i', '', $string); 
```

/i 代表不区分大小写（当然，如果您需要它）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-07-08T08:05:22.100

这也适用于用下划线替换任何不是数字、单词字符或句点的内容。对文件名有用。

```
$clean = preg_replace('/[^\d\w.]+/', '_', $string); 
```

# grails - Grails 验证器不起作用

> ID：840951
> 
> 赞同：2
> 
> 时间：2009-05-08T17:30:54.183
> 
> 标签：grails

我希望这只需要一双新的眼睛来注视它。

我有一个学校班

```
class School {
    String name

    static constraints = {
        name(maxLength:50,blank:false)
    }

    static hasMany = [pupils:Reviewer]

    String toString() {
        return name
    }
} 
```

我有一个学校控制器

```
class SchoolController {
    def scaffold = School
} 
```

当我运行该应用程序并在我的添加学校表单中输入一个很长的（比 50 比 50 字符长得多）甚至是一个空白名称时，似乎没有遵守约束。

我错过了什么？

戴夫

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-08T18:44:21.527

根据[Grails 验证参考](http://www.grails.org/Validation+Reference#maxLength)maxLength 已弃用..

您是否尝试过使用 maxSize 代替？

# c++ - 当“virtual”在“class Foo : public virtual Bar”而不是“virtual void frob()”中是什么意思？

> ID：840960
> 
> 赞同：8
> 
> 时间：2009-05-08T17:32:14.760
> 
> 标签：c++, virtual

当“virtual”在“class Foo : public virtual Bar”而不是“virtual void frob()”中是什么意思？

对于给定的方法，有 8 个案例源于以下三个位置是否存在虚拟。

1.  超类的功能。
2.  这个类的继承链。
3.  此类功能。

我想我了解数字 1 和 3 的交互方式，但数字 2 似乎是多余的。是吗？我不明白什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-08T17:36:07.713

那是[虚拟继承](http://www.parashift.com/c++-faq-lite/multiple-inheritance.html#faq-25.9)，当你知道你将进行多重继承时，你就会这样做。该页面更详细。

# xml - 使用 DataContractSerializer 指定序列化 XML 的结构

> ID：840962
> 
> 赞同：0
> 
> 时间：2009-05-08T17:33:07.970
> 
> 标签：xml, database, linq-to-sql

我正在使用 DataContractSerializer 类为 LINQ to SQL 项目创建序列化 XML。在序列化和检查返回的对象后，我得到如下所示的 XML。

```
- <ContentObject xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.datacontract.org/2004/07/MyProject.Data.Model">
  <_x003C_ID_x003E_k__BackingField>1</_x003C_ID_x003E_k__BackingField> 
  <_x003C_ObjectItemState_x003E_k__BackingField>Active</_x003C_ObjectItemState_x003E_k__BackingField> 
  <_x003C_ObjectName_x003E_k__BackingField>6ec555b0ba244ab4a8b2d2f2e7f4185a</_x003C_ObjectName_x003E_k__BackingField>   ETC. 
```

我正在尝试找出如何将 XML 结构简化为

```
- <ContentObject xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.datacontract.org/2004/07/MyProject.Data.Model">
  <ID>1</ID> 
  <ObjectItemState>Active</ObjectItemStat> 
  <ObjectName>6ec555b0ba244ab4a8b2d2f2e7f4185a</ObjectName>    ETC 
```

我试过装饰包装对象

```
 namespace MyProject.Data.Model
{
    [Serializable]
    public class ContentObject
    {
        [XmlAttribute("ID")]
        public int ID { get; set; }
        [XmlAttribute("ObjectName")]
        public string ObjectName { get; set; }      
        [XmlAttribute("ObjectItemState")]
        public string ObjectItemState { get; set; }  ETC
    }
} 
```

但这无济于事。谁能帮我找到在类中或 DBML Designer 文件中指定 XML 结构所需的确切操作？任何链接或文章也会非常有帮助。谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T19:05:20.790

如果您使用的是您提到的，那么您必须使用和属性`DataContractSerializer`来装饰您的结构- 而不是等等（这些用于常规和 XML 序列化程序）。`[DataContract]``[DataMember]``[Serializable]``[XmlAttribute]`

DataContractSerializer 是一个严格的“选择加入”序列化程序——只有那些你特别标记的字段和/或属性`[DataMember]`才会被序列化；与选择退出的 XmlSerializer 不同 - 它序列化所有内容，除非它被标记为`[XmlIgnore]`.

马克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T19:04:11.073

我找到了自己的答案：我在混合技术：我需要更改班级装饰，如下所示：

```
[Serializable]
/// <summary>
/// regular Object type, like Client or Poll
/// </summary>
[DataContract(Name = "ContentObject", Namespace = "http://www.myproject.dev")]
public class ContentObject
{
    [DataMember(Name = "ID")]
    public int ID { get; set; }
    [DataMember(Name = "ObjectName")]
    public string ObjectName { get; set; }
    [DataMember(Name = "ObjectItemState")]
    public ItemState ObjectItemState { get; set; } ETC. 
```

# sql - 使用 SQL 返回存储在 oracle blob 列中的文件的可读“文件大小”的优雅方法是什么？

> ID：840966
> 
> 赞同：5
> 
> 时间：2009-05-08T17:34:39.603
> 
> 标签：sql, oracle, plsql

您将如何编写 SQL 查询以更易于阅读的形式获取 blob 的大小？该示例类似于将大型 word 文档存储在表上的 blob 中。我想执行类似的东西：

```
select fnc_getReadableSize(documents.doc) from documents where id = ? 
```

输出：23.4 MB

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-15T16:32:34.497

“可读”部分是我应该更多强调的。这是我现在整理的内容。

```
WITH file_sizes AS
     (SELECT 1048576 MEGABYTE, 1024 KILOBYTE,
             DBMS_LOB.GETLENGTH (BLOB_COLUMN) byte_size
        FROM BLOB_COLUMN)
SELECT (CASE TRUNC (byte_size / MEGABYTE)
           WHEN 0
              THEN TO_CHAR ((byte_size / KILOBYTE), '999,999') || ' KB'
           ELSE TO_CHAR ((byte_size / MEGABYTE), '999,999.00') || ' MB'
        END
       ) display_size
  FROM file_sizes

Output:

DISPLAY_SIZE  
--------------
       1.88 MB
     433 KB   
     540 KB   
     333 KB   
       1.57 MB
       1.17 MB 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-08T18:08:51.457

```
SELECT DBMS_LOB.GETLENGTH(COLUMN_NAME) FROM DOCUMENTS 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-08-21T16:15:27.270

这是格式化问题的纯 SQL 解决方案。它使用以 1024 为底的对数来获取数字的长度。

```
WITH my_values AS (
   SELECT                              4 AS my_value FROM DUAL UNION ALL
   SELECT                             42 AS my_value FROM DUAL UNION ALL
   SELECT                            424 AS my_value FROM DUAL UNION ALL
   SELECT                           4242 AS my_value FROM DUAL UNION ALL
   SELECT                          42424 AS my_value FROM DUAL UNION ALL
   SELECT                         424242 AS my_value FROM DUAL UNION ALL
   SELECT                        4242424 AS my_value FROM DUAL UNION ALL
   SELECT                       42424242 AS my_value FROM DUAL UNION ALL
   SELECT                      424242424 AS my_value FROM DUAL UNION ALL
   SELECT                     4242424242 AS my_value FROM DUAL UNION ALL
   SELECT                    42424242424 AS my_value FROM DUAL UNION ALL
   SELECT                   424242424242 AS my_value FROM DUAL UNION ALL
   SELECT                  4242424242424 AS my_value FROM DUAL UNION ALL
   SELECT                 42424242424242 AS my_value FROM DUAL UNION ALL
   SELECT                424242424242424 AS my_value FROM DUAL UNION ALL
   SELECT               4242424242424242 AS my_value FROM DUAL UNION ALL
   SELECT              42424242424242424 AS my_value FROM DUAL UNION ALL
   SELECT             424242424242424242 AS my_value FROM DUAL UNION ALL
   SELECT            4242424242424242424 AS my_value FROM DUAL UNION ALL
   SELECT           42424242424242424242 AS my_value FROM DUAL UNION ALL
   SELECT          424242424242424242424 AS my_value FROM DUAL UNION ALL
   SELECT         4242424242424242424242 AS my_value FROM DUAL UNION ALL
   SELECT        42424242424242424242424 AS my_value FROM DUAL UNION ALL
   SELECT       424242424242424242424242 AS my_value FROM DUAL UNION ALL
   SELECT      4242424242424242424242424 AS my_value FROM DUAL UNION ALL
   SELECT     42424242424242424242424242 AS my_value FROM DUAL UNION ALL
   SELECT    424242424242424242424242424 AS my_value FROM DUAL UNION ALL
   SELECT   4242424242424242424242424242 AS my_value FROM DUAL
),
exponents AS (
   SELECT my_value,
          TRUNC((LN(my_value) / LN(1024))) AS exponent
     FROM my_values
),
base_values AS (
  SELECT my_value,
         exponent,
         ROUND(my_value / POWER(1024, exponent), 3) AS base_value
    FROM exponents
),
prefixes AS (
   SELECT 0 AS exponent,    'B' AS unit FROM DUAL UNION ALL
   SELECT 1 AS exponent,  'KiB' AS unit FROM DUAL UNION ALL
   SELECT 2 AS exponent,  'MiB' AS unit FROM DUAL UNION ALL
   SELECT 3 AS exponent,  'GiB' AS unit FROM DUAL UNION ALL
   SELECT 4 AS exponent,  'TiB' AS unit FROM DUAL UNION ALL
   SELECT 5 AS exponent,  'PiB' AS unit FROM DUAL UNION ALL
   SELECT 6 AS exponent,  'EiB' AS unit FROM DUAL UNION ALL
   SELECT 7 AS exponent,  'ZiB' AS unit FROM DUAL UNION ALL
   SELECT 8 AS exponent,  'YiB' AS unit FROM DUAL),
formatted AS (
   SELECT b.my_value,
          b.exponent,
          b.base_value,
          TO_CHAR(b.base_value, '999.000') || ' ' || p.unit AS engineering_notation
     FROM base_values b
     JOIN prefixes p
       ON p.exponent = b.exponent)
SELECT * FROM formatted;

  MY_VALUE   EXPONENT BASE_VALUE ENGINEERING_NOTATION
---------- ---------- ---------- ------------------------------------------------
         4          0          4    4.000 B
        42          0         42   42.000 B
       424          0        424  424.000 B
      4242          1      4.143    4.143 KiB
     42424          1      41.43   41.430 KiB
    424242          1    414.299  414.299 KiB
   4242424          2      4.046    4.046 MiB
  42424242          2     40.459   40.459 MiB
 424242424          2    404.589  404.589 MiB
4242424242          3      3.951    3.951 GiB
4.2424E+10          3     39.511   39.511 GiB
4.2424E+11          3    395.107  395.107 GiB
4.2424E+12          4      3.858    3.858 TiB
4.2424E+13          4     38.585   38.585 TiB
4.2424E+14          4    385.846  385.846 TiB
4.2424E+15          5      3.768    3.768 PiB
4.2424E+16          5      37.68   37.680 PiB
4.2424E+17          5    376.803  376.803 PiB
4.2424E+18          6       3.68    3.680 EiB
4.2424E+19          6     36.797   36.797 EiB
4.2424E+20          6    367.972  367.972 EiB
4.2424E+21          7      3.593    3.593 ZiB
4.2424E+22          7     35.935   35.935 ZiB
4.2424E+23          7    359.347  359.347 ZiB
4.2424E+24          8      3.509    3.509 YiB
4.2424E+25          8     35.093   35.093 YiB
4.2424E+26          8    350.925  350.925 YiB 
```

这是 PL/SQL 中的类似解决方案

```
SET SERVEROUTPUT ON
DECLARE
   FUNCTION get_human_readable_byte_size(
      byte_size_ IN NUMBER) RETURN VARCHAR2;

   FUNCTION get_human_readable_byte_size(
      byte_size_ IN NUMBER) RETURN VARCHAR2
   IS
      exponent_   NUMBER;
      base_value_ NUMBER;
      unit_       VARCHAR2(255);
      formatted_  VARCHAR2(255);
   BEGIN
      exponent_ := TRUNC((LN(byte_size_) / LN(1024)));
      base_value_ := ROUND(byte_size_ / POWER(1024, exponent_), 3);
      SELECT DECODE(exponent_,
                    0, 'B',
                    1, 'KiB',
                    2, 'MiB',
                    3, 'GiB',
                    4, 'TiB',
                    5, 'PiB',
                    6, 'EiB',
                    7, 'ZiB',
                    8, 'YiB',
                    '* 1024 ^ ' || exponent_) INTO unit_ 
        FROM DUAL;
      formatted_ := TO_CHAR(base_value_, '999.000') || ' ' || unit_;
      RETURN formatted_;
   END get_human_readable_byte_size;
BEGIN
   dbms_output.put_line(get_human_readable_byte_size(4));
   dbms_output.put_line(get_human_readable_byte_size(42));
   dbms_output.put_line(get_human_readable_byte_size(424));
   dbms_output.put_line(get_human_readable_byte_size(4242));
   dbms_output.put_line(get_human_readable_byte_size(42424));
   dbms_output.put_line(get_human_readable_byte_size(424242));
   dbms_output.put_line(get_human_readable_byte_size(4242424));
   dbms_output.put_line(get_human_readable_byte_size(42424242));
   dbms_output.put_line(get_human_readable_byte_size(424242424));
   dbms_output.put_line(get_human_readable_byte_size(4242424242));
   dbms_output.put_line(get_human_readable_byte_size(42424242424));
   dbms_output.put_line(get_human_readable_byte_size(424242424242));
   dbms_output.put_line(get_human_readable_byte_size(4242424242424));
   dbms_output.put_line(get_human_readable_byte_size(42424242424242));
   dbms_output.put_line(get_human_readable_byte_size(424242424242424));
   dbms_output.put_line(get_human_readable_byte_size(4242424242424242));
   dbms_output.put_line(get_human_readable_byte_size(42424242424242424));
   dbms_output.put_line(get_human_readable_byte_size(424242424242424242));
   dbms_output.put_line(get_human_readable_byte_size(4242424242424242424));
   dbms_output.put_line(get_human_readable_byte_size(42424242424242424242));
   dbms_output.put_line(get_human_readable_byte_size(424242424242424242424));
   dbms_output.put_line(get_human_readable_byte_size(4242424242424242424242));
   dbms_output.put_line(get_human_readable_byte_size(42424242424242424242424));
   dbms_output.put_line(get_human_readable_byte_size(424242424242424242424242));
   dbms_output.put_line(get_human_readable_byte_size(4242424242424242424242424));
   dbms_output.put_line(get_human_readable_byte_size(42424242424242424242424242));
   dbms_output.put_line(get_human_readable_byte_size(424242424242424242424242424));
   dbms_output.put_line(get_human_readable_byte_size(4242424242424242424242424242));
   dbms_output.put_line(get_human_readable_byte_size(42424242424242424242424242424));
   dbms_output.put_line(get_human_readable_byte_size(424242424242424242424242424242));
   dbms_output.put_line(get_human_readable_byte_size(4242424242424242424242424242424));
END;
/

4.000 B
42.000 B
424.000 B
4.143 KiB
41.430 KiB
414.299 KiB
4.046 MiB
40.459 MiB
404.589 MiB
3.951 GiB
39.511 GiB
395.107 GiB
3.858 TiB
38.585 TiB
385.846 TiB
3.768 PiB
37.680 PiB
376.803 PiB
3.680 EiB
36.797 EiB
367.972 EiB
3.593 ZiB
35.935 ZiB
359.347 ZiB
3.509 YiB
35.093 YiB
350.925 YiB
3.427 * 1024 ^ 9
34.270 * 1024 ^ 9
342.700 * 1024 ^ 9
3.347 * 1024 ^ 10 
```

# sql-server - 动态创建临时表，插入临时表，然后选择

> ID：840968
> 
> 赞同：4
> 
> 时间：2009-05-08T17:34:51.493
> 
> 标签：sql-server, tsql, insert, temp-tables

基本上我希望能够根据现有表动态创建一个临时表，然后将值插入到临时表中，然后选择插入的值。

我已经有了可以创建临时表的部分，它工作得很好，只是插入和选择表格不太好。

这是我当前的代码。

```
declare @table table 
(
    OrdinalPosition int, 
    ColumnName nvarchar(255), 
    DataType nvarchar(50), 
    MaxChar int, 
    Nullable nvarchar(5)
)
declare @i int
declare @count int
declare @colname nvarchar(255), @datatype nvarchar(50), @maxchar int
declare @string nvarchar(max)
declare @tblname nvarchar(100)

set @tblname='Projects'

set @string='create table #' + @tblname + ' ('

insert into @table 
(
    OrdinalPosition, 
    ColumnName, 
    DataType, 
    MaxChar, 
    Nullable
)

SELECT    
    ORDINAL_POSITION ,
    COLUMN_NAME ,
    DATA_TYPE ,
    CHARACTER_MAXIMUM_LENGTH ,
    IS_NULLABLE
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_NAME = @tblname

set @i=1
select @count=count(*) from @table

while (@i<=@count)
begin

    select @colname=ColumnName from @table where OrdinalPosition=@i
    select @datatype=DataType from @table where OrdinalPosition=@i
    select @maxchar=MaxChar from @table where OrdinalPosition=@i

    if (@maxchar is null)
    begin

        set @string = @string + @colname + ' ' + @datatype

    end
    else
    begin

        set @string = @string + @colname + ' ' + @datatype + '(' + cast(@maxchar as nvarchar(20)) + ')'

    end

    if (@i=@count)
    begin

        set @string = @string + ')'

    end
    else
    begin

        set @string = @string + ', '

    end

    set @i=@i+1
end

select @string

exec(@string)

set @string='
insert into #Projects (pk_prID, prWASSN_ID, prProjectStatus, prBusinessUnit, prServiceLine, prStudyTypeCode, prStudyNumber, prTimePoint, prStudyDirector, 
                      prGroupLeader, prBookedDate, prBookedAmount, prConsumed, prBudgetedHours, prFinalReport, prFinalYear, prFinalMonth, prStartQA, 
                      prLabWorkStarted, prLabWorkCompleted, prProjImpDate, prCompanyName, prCompanyNumber, prIsFTE, prRevisedDeadlineDate, prProjectFinalized, 
                      prBookedYear, prBookedMonth, prCRMQuoteID, prLineItemNumber, prDraftReport, prInternalTargetDeadlineDate, prProtocolSignedDate, 
                      prDataToRWS, prRWSWorkStarted, prFirstDraftToPL, prFirstDraftToQA, prArchivedDate, prToPLForQACommentReview, 
                      prAnticipatedProjectArchiveDate, prToQAWithPLCommentResponse, prProjectReactivatedDate, prQAFinishDate, prSecondDraftReportToClient)
select *
from cube.Projects'

select @string

exec (@string)

set @string='select * from #Projects'

exec (@string) 
```

这是我得到的错误：

（44 行受影响）

（1 行受影响）

（1 行受影响）消息 208，级别 16，状态 0，第 2 行无效的对象名称“#Projects”。消息 208，级别 16，状态 0，第 1 行无效的对象名称“#Projects”。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-08T17:46:41.353

尝试用两个## 命名表，这将创建一个全局临时表。这可能是范围界定的问题，您可能正在使用 exec 创建表，但它返回时不可见。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-08T17:50:17.367

当您调用 exec 我相信它会在声明临时表的上下文之外执行我相信如果您将字符串附加在一起并作为对 exec 的一次调用执行它会成功。另一种选择是使用带有## 作为前缀而不是# 的全局临时表。

# python - 如何在不使用继承的情况下为 python 类命名以获得另一个名称？

> ID：840969
> 
> 赞同：43
> 
> 时间：2009-05-08T17:35:18.417
> 
> 标签：python

如果我有一个 python 类，我如何将该类名别名为另一个类名并保留它的所有方法、类成员和实例成员？如果不使用继承，这可能吗？

例如，我有一个像这样的课程：

```
class MyReallyBigClassNameWhichIHateToType:
    def __init__(self):
         <blah>
    [...] 
```

我正在创建一个交互式控制台会话，我不希望用户的手指在交互式会话中实例化类时脱落，所以我想将这个非常长的类名别名为像“C”这样的小东西。有没有一种简单的方法可以在没有继承的情况下做到这一点？

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2009-05-08T17:37:11.643

```
C = MyReallyBigClassNameWhichIHateToType 
```

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2009-05-08T17:45:39.627

此外，如果您要从另一个模块导入名称...

```
from modulename import ReallyLongNameWhichIHateToType as FriendlyName 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-05-08T17:37:33.390

你可以简单地做：

```
ShortName = MyReallyBigClassNameWhichIHateToType 
```

Python 中的类与任何其他类一样只是一个对象，并且可以有多个名称。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-05-08T17:36:56.307

重构名称，没有理由它应该有这么长的名称。

否则`whateverName = VeryLongClassName`应该做的伎俩。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2018-11-29T16:43:18.597

简单的名称分配方法有效，但有一个缺点，在某些情况下可能很重要：由于属性的原因，别名将与“基”类的名称相同`__name__`。

```
class C(object):
    pass

D = C

print(C.__name__)  # 'C'
print(D.__name__)  # 'C' again 
```

例如，如果您创建自定义异常，然后创建另一个分配第一个异常的异常，则无论您提出哪一个异常，每次都会获得此“父”异常的名称，这可能会使用户感到困惑：

```
class CustomBaseException(Exception):

    def __init__(self, operation):
        super(CustomBaseException, self).__init__()
        self.operation = operation

    def __str__(self):
        return f"Invalid operation '{self.operation}'"

OperationException = CustomBaseException

raise OperationException('readd') 
```

输出：

```
Traceback (most recent call last):
  File "<input>", line 12, in <module>
CustomBaseException: Invalid operation 'readd' 
```

所以一个解决方案是实际子类化该类：

```
class CustomBaseException(Exception):

    def __init__(self, operation):
        super(CustomBaseException, self).__init__()
        self.operation = operation

    def __str__(self):
        return f"Invalid operation '{self.operation}'"

class OperationException(CustomBaseException):
    pass

raise OperationException('delite') 
```

输出：

```
Traceback (most recent call last):
  File "<input>", line 14, in <module>
OperationException: Invalid operation 'delite' 
```

# python - 计算 Boyer-Moore 字符串搜索算法中的第二个（不匹配）表

> ID：840974
> 
> 赞同：4
> 
> 时间：2009-05-08T17:36:32.160
> 
> 标签：python, algorithm, discrete-mathematics, string-search

为了使 Boyer-Moore 算法成为最坏情况线性，失配表的计算必须是 O(m)。然而，一个简单的实现将遍历所有后缀 O(m) 以及该后缀中的所有位置可以检查是否相等......这是 O(m ³ )！

下面是[建表算法](http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm#The_second_table)的简单实现。所以这个问题变成了：我怎样才能把这个算法的运行时间提高到 O(m)？

```
def find(s, sub, no):
    n = len(s)
    m = len(sub)

    for i in range(n, 0, -1):
        if s[max(i-m, 0): i] == sub[max(0, m-i):] and \
            (i-m < 1 or s[i-m-1] != no):
            return n-i

    return n

def table(s):
    m = len(s)
    b = [0]*m

    for i in range(m):
        b[i] = find(s, s[m-i:], s[m-i-1])

    return b

print(table('anpanman')) 
```

为了让思想休息，这不是家庭作业。当有人发布改进想法时，我会添加修订。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-09T14:50:32.487

[本页](http://www.iti.fh-flensburg.de/lang/algorithmen/pattern/bmen.htm)“好后缀启发式的预处理”下的代码在 O(n) 时间内构建好后缀表。它还解释了代码的工作原理。

# python - 如何在 python 2.x 中将原始字节存储为文本而不丢失信息？

> ID：840981
> 
> 赞同：1
> 
> 时间：2009-05-08T17:37:43.887
> 
> 标签：python, python-2.7, storage, bit, data-compression

假设我有任何以字节为单位的数据。例如：

> 0110001100010101100101110101101

如何将其存储为*可打印*文本？显而易见的方法是将每个 0 转换为字符“0”，将每个 1 转换为字符“1”。事实上，这就是我目前正在做的事情。我想知道如何才能更紧密地包装它们，而不会丢失信息。

我想将八位一组的位转换为 ASCII，但该格式不接受某些位组合。还有其他想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-08T17:43:02.207

只使用像base64这样的“安全”字符的编码呢？
[http://en.wikipedia.org/wiki/Base64](http://en.wikipedia.org/wiki/Base64)

编辑：这是假设您想安全地将数据存储在文本文件等中？

在 Python 2.x 中，字符串应该没问题（Python 不使用以空字符结尾的字符串，所以不用担心）。

3.x 中的其他内容检查 bytes 和 bytearray 对象。 [http://docs.python.org/3.0/library/stdtypes.html#bytes-methods](http://docs.python.org/3.0/library/stdtypes.html#bytes-methods)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-08T17:47:18.637

不确定你在说什么。

```
>>> sample = "".join( chr(c) for c in range(256) )
>>> len(sample)
256
>>> sample
'\x00\x01\x02\x03\x04\x05\x06\x07\x08\t\n\x0b\x0c\r\x0e\x0f\x10\x11\x12\x13\x14\
x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f !"#$%&\'()*+,-./0123456789:;<=>?@ABC
DEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\x7f\x80\x81\x82\x83
\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97
\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab
\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf
\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3
\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7
\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb
\xfc\xfd\xfe\xff' 
```

该字符串`sample`包含所有 256 个不同的字节。没有“位组合......不被接受”这样的东西。

要使其*可打印*，只需使用`repr(sample)`-- 转义非 ASCII 字符。正如你在上面看到的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-08T17:40:38.827

尝试标准*数组*模块或*结构*模块。这些支持以节省空间的方式存储字节——但它们不直接支持位。

你也可以试试[http://cobweb.ecn.purdue.edu/~kak/dist/BitVector-1.2.html](http://cobweb.ecn.purdue.edu/~kak/dist/BitVector-1.2.html)或[http://ilan.schnell-web.net/prog/bitarray/](http://ilan.schnell-web.net/prog/bitarray/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T02:01:39.860

对于 Python 2.x，最好的办法是将它们存储在一个字符串中。获得该字符串后，您可以使用 python 附带的 base64 模块将其编码为安全的 ASCII 值。

```
import base64
encoded = base64.b64encode(bytestring) 
```

这将比存储“1”和“0”更简洁。

有关 base64 模块的更多信息，请参阅 python[文档](http://docs.python.org/library/base64.html)。

# lucene - 在 WhitespaceAnalyzer 中使用停用词

> ID：840984
> 
> 赞同：3
> 
> 时间：2009-05-08T17:39:04.820
> 
> 标签：lucene, lucene.net

Lucene 的 StandardAnalyzer 在索引时从字符串/首字母缩略词中删除点。我希望 Lucene 保留点，因此我使用的是 WhitespaceAnalyzer 类。

我可以将我的停用词列表提供给 StandardAnalyzer...但是我如何将它提供给 WhitespaceAnalyzer？

谢谢阅读。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T19:20:33.780

Create your own analyzer by extending WhiteSpaceAnalyzer and override [tokenStream](http://lucene.apache.org/java/2_4_1/api/org/apache/lucene/analysis/WhitespaceAnalyzer.html#tokenStream(java.lang.String,%20java.io.Reader)) method as follows.

```
public TokenStream tokenStream(String fieldName, Reader reader) {
    TokenStream result = super.tokenStream(fieldName, reader);
    result = new StopFilter(result, stopSet);
    return result;
} 
```

Here the stopSet is the Set of stop words, which you could get by adding a constructor to your analyzer which accepts a list of stop words.

You may also wish to override reusableTokenStream() method in similar fashion if you plan to reuse the TokenStream.``*********``**