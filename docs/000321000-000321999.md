# StackOverflow 问答 000321000-000321999

# scope - 动态范围的优点是什么？

> ID：321000
> 
> 赞同：31
> 
> 时间：2008-11-26T15:04:01.147
> 
> 标签：scope, lexical-scope, dynamic-scope

我了解到[静态作用域](http://en.wikipedia.org/wiki/Static_scoping#Static_scoping_.28also_known_as_lexical_scoping.29)是唯一明智的做事方式，而[动态作用域](http://en.wikipedia.org/wiki/Static_scoping#Dynamic_scoping)是魔鬼的工具，仅由解释器/编译器的不良实现造成。

[然后我从Common Lisp vs. Scheme](http://community.schemewiki.org/?scheme-vs-common-lisp)文章中看到了这个片段：

```
根据标准，仅限词法和动态词法范围。
范围特殊变量。提供了常见的动态范围变量
Lisp 只是在这一点上获胜。通过一些实现作为扩展
                                  但是使用它们的代码是不可移植的。

     （我听说过关于是否动态范围的争论
      首先是或不是一个坏主意。我不在乎。
      我只是注意到你可以用它做你想做的事情
      没有它就不能轻易做到。）

```

为什么 Common Lisp “在这一点上获胜”？使用动态作用域更容易做哪些事情？我真的无法证明需要它/将其视为一件好事。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-11-26T15:20:55.450

像其他一切一样，动态范围只是一个工具。使用得当它可以使某些任务更容易。使用不当会引入错误和令人头疼的问题。

我当然可以看到它的一些用途。可以消除将变量传递给某些函数的需要。

例如，我可能会在程序开始时设置显示，并且每个图形操作都只是假设这个显示。

如果我想在该显示器内设置一个窗口，那么我可以将该窗口“添加”到以其他方式指定显示器的变量堆栈中，并且在此状态下执行的任何图形操作都将转到窗口而不是显示器作为所有的。

这是一个人为的例子，可以通过将参数传递给函数来同样好地完成，但是当您查看此类任务生成的一些代码时，您会意识到全局变量确实是一种更容易的方法，而**动态范围为您提​​供了一个很多全局变量的健全性与函数参数的灵活性**。

-亚当

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-11-26T15:15:53.230

动态范围的主要风险是意外后果。动态作用域使作用域遵循运行时堆栈，这意味着作用域中的符号集要大得多，并且在任何符号使用时都不是很明显。动态范围的变量很像全局变量，只是每个变量可能有多个版本，只有最新的定义可见，而隐藏所有其他变量。

动态范围，只要它有用，它对于需要对运行时堆栈敏感的行为很有用。例如（一般来说，不是特定于 Lisp 或变体）：

*   异常处理 - 最顶层的 catch 块是发生异常时“在范围内”的那个
*   安全性 - .NET 基于代码的安全性根据调用它的代码来决定某些特权 API 的可访问性。

将其用于其他用途的问题在于，它会在词汇上相距遥远的代码片段之间创建隐式依赖和耦合。这样，它也类似于全局变量，只是它可能更糟（由于动态覆盖的定义）。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-26T15:15:33.043

动态范围在某些特定领域的语言中很有用。特别是，它可以方便地使用样式表语言。我的经验来自[GNU TeXmacs](http://texmacs.org/)样式表语言。

在这种语言中，显示参数存储在动态范围的变量中。这些变量会影响其作用域内每个原子的渲染，包括由作用域中调用的函数产生的原子。

TeXmacs 中的动态范围也用于标记交叉引用。用于交叉引用的锚点从其环境中获取标签。例如，公式块中包含的锚点将使用公式编号作为标签，而不是位于公式之后的锚点的节编号。

想想看，unix 环境变量也是动态作用域的变量。尽管内部作用域不能改变外部作用域中变量的值。

正如 Barry Kelly 所[指出](https://stackoverflow.com/posts/edit/321057)的，动态范围也可以用于实现关心调用范围的语言功能，例如异常处理或上下文相关的权限处理。在存在延续的情况下，可以进入和退出范围，而无需遍历调用堆栈。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-03T01:04:03.983

动态范围允许定义上下文功能。从这个意义上说，它与现代框架中的依赖注入非常相似。（例如，考虑当您使用依赖注入定义注释 Java 类以允许对各种引用进行透明初始化时。（参见 spring 或 JPA 等））

显然，动态作用域对给定函数的调用站点的运行时特性做出了某些假设，这些假设在编译（或设计）时无法保证。再次，按照现代（Java）框架组件的示例，如果您在容器的受控（运行时）环境之外实例化这样的类，则很可能由于其所需的依赖关系，该类将无法运行不会被初始化（又名注入）。

但同样明显的是，组件系统（仅作为一个例子）显然受益于动态绑定机制。依赖注入是实现这一点的框架级手段。动态范围是相同的语言级别的手段。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-04-02T15:50:24.483

另请注意，结合

*   *词法作用域*的概念（我们觉得这对编程语言来说是一件好事，而不是*动态作用域*）
*   函数定义（*lambda 表达式）深深嵌入*代码中（也可以简称为“嵌套函数”）

从语言实现的角度和程序员的角度来看，这可能是一项复杂的工作。这个复杂的东西甚至还有一个特殊的名字：**闭包**。

正如[维基百科所写](http://en.wikipedia.org/wiki/Scope_%28programming%29#Lexical_scoping)：

> *在具有一流嵌套函数* 的语言中正确实现*静态作用域*并非易事，因为它要求每个函数值都带有它所依赖的变量值的记录（函数和这个环境的对被称为一个*闭包*）。

 **这不仅在具有全局和/或可变变量（如 C 或 Java）的语言中实现并非微不足道；考虑在评估对在该位置范围内的可变状态的闭包时确保正确访问嵌套函数定义！只有一件事：当你在未来某个时间评估闭包时，使用的对象不应该被破坏和垃圾收集），但从**概念上来说，程序员思考如何关闭将在复杂的情况下工作**以及它将确切具有哪些（副作用）效果（出于相同的原因：您需要考虑闭包与定义闭包时范围内的所有可变状态的交互，例如：当您在闭包内部引用时定义到范围内的外部可变变量，**您是否真的想访问变量在定义闭包时所具有的值，即您想要拥有该变量的只读副本，或者您想要在未来评估闭包时全面访问变量的可变状态？**）。

在纯函数式语言中，考虑嵌套函数定义及其用途要简单得多，因此只有词法范围对它们来说根本不是问题。但是，如果您的语言不能正常工作，那么它就不是那么微不足道了。（我相信这是长期以来一直争论如何向 Java 添加闭包的原因之一：尽管它们只是建立在词法作用域的好概念之上，但它们似乎并不容易让程序员理解.)

使用动态范围考虑非纯函数式语言中的嵌套函数更简单（尽管动态范围并不好：您获得的编译时检查更少，并保证程序在动态范围内的正确行为）。

所以我认为，考虑到动态范围的所有危险，**如果一个人想要并且敢于这样做，那么**在一种语言中使用动态范围的优势也可以是用一种简单的方式编程一些东西的可能性。

### 笔记

关于 Java 中（无）闭包的悠久历史（并且程序员不喜欢这个概念） ——http: [//people.csail.mit.edu/gregs/ll1-discuss-archive-html/msg04030.html](http://people.csail.mit.edu/gregs/ll1-discuss-archive-html/msg04030.html)：

> 日期：2003 年 8 月 14 日星期四 08:05:44 -0700
> 
> 来自：迈克尔·瓦尼尔
> 
> 主题：回复：绑定和分配（原：回复：延续）
> 
> > 日期：2003 年 8 月 14 日星期四 10:45:34 -0400
> > 
> > 来自：“大卫·B·塔克”
> > 
> > > 我想，虽然我没有统计证据，但为了在匿名内部类（闭包）中引用它们而将局部变量声明为 final 的要求几乎完全未知并且在实践中未使用。
> > 
> > 出于好奇，有谁知道为什么 Java 只允许在匿名类中引用最终变量？
> > 
> > 戴夫
> 
> ```
>  <cynic>Otherwise you'd have the equivalent of true closures,
> and if you had that    java would be a
> *really* powerful and useful language, so they obviously    couldn't do that.
> </cynic> 
> ```
> 
> 实际上，原型实现 *确实*允许从内部类中引用非最终变量。*用户*强烈抗议，抱怨他们不想要这个！原因很有趣：为了支持这些变量，有必要对它们进行堆分配，而且（至少在那个时候）普通的 Java 程序员仍然对堆分配和垃圾收集以及所有这些东西很敏感。当看不到“new”关键字时，他们不赞成“在桌子下”执行堆分配的语言。

因此，在早期——显然——在 Java 中采用了“第三种”方法（与我在上面提到的两种方法相反）：既不是“只读副本”，也不是在评估封闭（在定义闭包时）可变状态的时间，而是状态的可变副本（至少，我这样理解引用的段落；或者不，他在谈论堆分配只是参考？..然后是第二个选项。很好。第三个选项对我来说真的不明智。）。不知道他们现在如何在 Java 中实现闭包，我没有关注最近关于 Java 的新内容。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-11-10T10:24:19.597

动态范围打破了[参照透明性](http://en.wikipedia.org/wiki/Referential_transparency_(computer_science))，这意味着您无法再对程序进行推理。DS 基本上是类固醇上的全局变量。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-08-23T17:18:08.083

Richard Stallman 的这篇经典文章（来自 GNU/Linux、Emacs、FSF）解释了为什么动态作用域对 Emacs 编辑器和 Emacs Lisp 语言很重要。总之，它对定制很有用。

[http://www.gnu.org/software/emacs/emacs-paper.html#SEC17](http://www.gnu.org/software/emacs/emacs-paper.html#SEC17)

另请参阅Emacs wiki 上的[此页面](http://www.emacswiki.org/emacs/DynamicBindingVsLexicalBinding)，了解有关在 Emacs Lisp 中使用动态范围的更多信息：

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-10-10T06:09:02.670

我认为 Common LISP 中的动态范围类似于 C 中的全局变量。在功能函数中使用它们是有问题的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-03T01:54:26.670

动态范围的变量是一个强大的，但有时也是不直观和危险的工具。

想象一下，您想要拥有特定于线程的全局变量，即每个线程都有自己的一组全局变量。这可以通过动态范围轻松完成。只需在线程初始化时更改对这个变量的引用。

或者考虑一下异常：它们在大多数语言中都是动态范围的。如果您必须从头开始构建异常系统，您可以使用动态范围的变量轻松地做到这一点。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-08-24T06:17:04.530

Emacs 绑定方式对我来说很方便的一个例子 - 顺便说一句，不确定词法或动态是否是正确的术语。

let 内绑定的变量向下看，不需要显式切换作为参数，这节省了很多击键。

```
(defun foo1 ()
  (message "%s" a))

(defun foo2 ()
  (let ((a 2))
  (message "%s" a)))

(defun foo3 ()
  (let ((a 1))
    (foo1)
    (foo2)))

==>
1
2 
```

foo2 内部的绑定很有趣，因为这里可能会安装默认值的用法

(let ((a (if (eq something a) 否则分配...

# url - Skype 接管网址

> ID：321015
> 
> 赞同：4
> 
> 时间：2008-11-26T15:06:59.003
> 
> 标签：url, skype, phone-number

我们的应用程序中存在一些问题，Skype 接管了我们的一些 url，将它们替换为使您能够开始通话的 Skype 插件。看起来 Skype 认为它们是电话号码。我想知道是否有某种方法可以标记我们的网址，这样 Skype 就不会认为它们是电话号码？

它在此处描述[http://www.skype.com/help/guides/ie_addon/](http://www.skype.com/help/guides/ie_addon/)，但没有在 html 中禁用此功能的选项...有什么建议吗？想在我们的锚标签中添加一个属性来告诉 skyp 远离。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T15:55:16.940

尝试：

`<meta name="SKYPE_TOOLBAR" content="SKYPE_TOOLBAR_PARSER_COMPATIBLE" />`

在你的头部元素中。

[链接文本](http://forum.skype.com/lofiversion/index.php/t78380.html)

# python - 使函数不可覆盖

> ID：321024
> 
> 赞同：28
> 
> 时间：2008-11-26T15:08:29.813
> 
> 标签：python

我知道python函数默认是虚拟的。假设我有这个：

```
class Foo:
    def __init__(self, args):
        do some stuff
    def goo():
        print "You can overload me"
    def roo():
        print "You cannot overload me" 
```

我不希望他们能够这样做：

```
class Aoo(Foo):
    def roo():
        print "I don't want you to be able to do this" 
```

有没有办法防止用户重载 roo()？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2019-11-19T17:29:15.240

Python 3.8（2019 年 10 月发布）`final`为类型添加了限定符。

在类型模块中添加了一个`final`限定符——以`final`装饰器和最终类型注释的形式——用于三个相关目的：

*   声明一个方法不应该被覆盖
*   声明一个类不应该被子类化
*   声明不应重新分配变量或属性

```
from typing import final

class Base:
    @final
    def foo(self) -> None:
        ...

class Derived(Base):
    def foo(self) -> None:  # Error: Cannot override final attribute "foo"
                            # (previously declared in base class "Base")
        ... 
```

它符合您的要求，并且现在受到核心 Python 的支持。

查看[PEP-591](https://www.python.org/dev/peps/pep-0591/)了解更多详情。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-11-26T16:07:04.373

您可以使用元类：

```
class NonOverridable(type):
    def __new__(self, name, bases, dct):
        if bases and "roo" in dct:
            raise SyntaxError, "Overriding roo is not allowed"
        return type.__new__(self, name, bases, dct)

class foo:
    __metaclass__=NonOverridable
    ... 
```

每当创建子类时，都会调用元类型的**new ；**这将在您提出的情况下导致错误。仅当没有基类时，它才会接受 roo 的定义。

您可以通过使用注释来声明哪些方法是最终的，从而使该方法更加花哨；然后，您需要检查所有基础并计算所有最终方法，以查看它们中的任何一个是否被覆盖。

这仍然不能阻止有人在定义方法后将方法修补到类中。您可以尝试通过使用自定义字典作为类的字典来捕获这些（这可能不适用于所有 Python 版本，因为类可能要求类字典具有确切的 dict 类型）。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-26T15:34:24.160

由于 Python 有猴子补丁，因此您不仅不能将任何东西设为“私有”。即使可以，仍然有人可以在新版本的方法函数中进行猴子补丁。

您可以使用这种名称作为“不要靠近”的警告。

```
class Foo( object ):
    def _roo( self ):
       """Change this at your own risk.""" 
```

这是通常的做法。每个人都可以阅读您的来源。他们被警告了。如果他们勇敢地去他们被警告不要去的地方，他们就会得到他们应得的。它不起作用，你无法帮助他们。

您可以尝试使用内部类和由“私有”方法调用的“隐藏”实现模块故意使这一点变得模糊。但是……每个人都有你的来源。你无法*阻止*任何事情。您只能告知人们他们行为的后果。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-26T16:32:08.083

```
def non_overridable(f):
    f.non_overridable = True
    return f

class ToughMeta(type):
    def __new__(cls, name, bases, dct):
        non_overridables = get_non_overridables(bases)
        for name in dct:
            if name in non_overridables:
                raise Exception ("You can not override %s, it is non-overridable" % name)
        return type.__new__(cls, name, bases, dct)

def get_non_overridables(bases):
    ret = []
    for source in bases:
        for name, attr in source.__dict__.items():
            if getattr(attr, "non_overridable", False):
                ret.append(name)
        ret.extend(get_non_overridables(source.__bases__))
    return ret

class ToughObject(object):
    __metaclass__ = ToughMeta
    @non_overridable
    def test1():
        pass

# Tests ---------------
class Derived(ToughObject):
    @non_overridable
    def test2(self):
        print "hello"

class Derived2(Derived):
    def test1(self):
        print "derived2"

# -------------------- 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-02-06T23:27:33.743

派对迟到了，但并非所有 python 方法默认都是“虚拟的”——考虑：

```
class B(object):
    def __priv(self): print '__priv:', repr(self)

    def call_private(self):
        print self.__class__.__name__
        self.__priv()

class E(B):
    def __priv(self): super(E, self).__priv()

    def call_my_private(self):
        print self.__class__.__name__
        self.__priv()

B().call_private()
E().call_private()
E().call_my_private() 
```

由于名称修改而受到打击：

```
B
__priv: <__main__.B object at 0x02050670>
E
__priv: <__main__.E object at 0x02050670>
E
Traceback (most recent call last):
  File "C:/Users/MrD/.PyCharm2016.3/config/scratches/test_double__underscore", line 35, in <module>
    E().call_my_private()
  File "C:/Users/MrD/.PyCharm2016.3/config/scratches/test_double__underscore", line 31, in call_my_private
    self.__priv()
  File "C:/Users/MrD/.PyCharm2016.3/config/scratches/test_double__underscore", line 27, in __priv
    def __priv(self): super(E, self).__priv()
AttributeError: 'super' object has no attribute '_E__priv' 
```

因此，如果您想从该语言中获得一些帮助，以禁止人们覆盖您在课堂上需要的一些功能，这就是您要走的路。如果您想要最终确定的方法是您的类 API 的一部分，但是您会被注释方法（或元类黑客）所困扰。我个人的观点是，final 关键字对于继承非常有用——因为你可以避免类在被覆盖时以阴险的方式破坏（例如，考虑在超级实现中使用“final”方法，然后有人覆盖——繁荣，超级破坏）——并且出于文档目的（没有文档比编译时语法错误更好）-但是 Python 的动态特性不允许这样做，并且黑客很脆弱-所以添加一个文档字符串：

```
"""DON'T OVERRIDE THIS METHOD""" 
```

# java - XML 中描述的 Java GUI

> ID：321034
> 
> 赞同：7
> 
> 时间：2008-11-26T15:10:05.520
> 
> 标签：java, xml, user-interface

我公司目前正在评估 Java FAT 客户端的开发。它应该支持动态 GUI，并在服务器端具有尽可能多的逻辑。因此，想到了将屏幕作为 XML 发送到 FAT 客户端，将其显示给用户并将类似于“html 表单”的输入数据以如下结构发送回：

```
<fields>
  <field type="checkbox" name="active" checked="false" x="10" y="10" />
  <field type="textbox" name="username" value="dummy" x="10" y="30" />
  <field type="selection" name="group" selectedIndex="1" x="10" y="50">
     <data index="0">user</data>
     <data index="1">admin</data>
  </field>
  <field type="button" name="ok" x="10" y="70" />
  <field type="button" name="cancel" x="10" y="90" />
</field> 
```

*背景*
发起人正在寻找一种数据输入和审查应用程序，他们可以通过简单地更改配置来适应他们的需求。因此，我们必须为他们的管理员提供一种设计所谓的“屏幕”（又名表单）的可能性，并提供一个客户端/服务器系统，使他们能够将这些内容分发给他们的最终用户。传入的数据（即用户输入的数据）将被转发到处理业务逻辑的现有工作流引擎。

**问题**
有没有人开发过类似的东西？你会推荐哪些图书馆？有什么优缺点吗？非常感谢！

*更新*
非常感谢您的输入，[Thinlet和](http://www.thinlet.com)[JavaFX](http://en.wikipedia.org/wiki/JavaFX)看起来都非常有前途——我会研究这两者。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T15:14:18.333

“它应该支持动态 GUI，并在服务器端拥有尽可能多的逻辑。”

您所描述的是一个网络应用程序。客户端（浏览器）已经编写好了，XML（ish）格式是（X）HTML。

可以使用您自己的 XML 格式和您自己的客户端重新创建此过程，但我不明白为什么这是必要的或可取的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T17:53:45.313

当我上次寻找这样的东西时，两个选项是[Thinlet](http://www.thinlet.com/index.html)和[Apache Jelly](http://commons.apache.org/jelly/libs/swing/index.html)。

优点是您可以将应用程序的布线和构造与行为分开。我不确定他们中的任何一个是否可行，但我想*可能*有一些功能可以转换为另一个工具包，就像[Lazlo](http://www.openlaszlo.org/showcase)可以转换为 AJAX 和 Flash 一样。

在我找到这些之前，我已经基于 JHTMLEditor 编写了一个类似的工具包（当时[Echo](http://echo.nextapp.com/)是最前沿的，Java 1.3 是最前沿的）。它起作用了，但是侦听器与渲染器在同一个 VM 中运行。

这提出了@Draemon 提出的观点，在客户端/服务器上下文中，我不得不问这是否是解决更大问题的有效方法。我猜您想将大量 CPU 周期卸载到客户端上？也许如果您再添加一点，我们可以提出更多建议？这确实指向了一种方法，您的应用程序作为`localhost`Web 服务器部署在桌面上，并且您将页面提供给本地浏览器。

如果您可以等待，我会等待[JavaFX](http://en.wikipedia.org/wiki/JavaFX)，因为这将使构建小程序更具声明性，并且还将减少渲染库的初始下载。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T15:29:20.160

试试[JavaFX](http://www.javafx.com) （[关于 JavaFX 的维基百科](http://en.wikipedia.org/wiki/JavaFX)）。它不是 XML，但它也很容易和声明性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T15:37:59.160

已经用 SWT 做过类似的事情，尽管那是将逻辑数据结构（在本例中为应用程序表单模型）转换为 GUI，而不是直接指定 GUI。这使我们能够根据客户端属性（PocketPC 或桌面）重构 GUI，因为数据模型是语义而不是关于布局的独裁。

编写 XML 解析器和生成器很简单。编写一些东西来从模型生成接口并不那么简单，因为您确实需要存储 GUI 元素和它们相关的模型字段之间的关系，以便您可以在进行更改时更新它们，而不是每个上通常的硬编码侦听器图形用户界面元素。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T18:12:37.757

有很多基于 XUL 的工具包可用于各种语言，包括 Java。我认为 Thinlet 为 Java 做了一个非常简单的 XUL，但应该还有其他的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-26T18:14:42.840

基本上，您正在向客户端发送序列化表单，并对结果数据进行序列化。这可以通过Java 序列化（即RMI）来完成，但是防火墙等可能会使RMI 在Internet 上的使用变得复杂。

如果您想在线上使用基于 HTTP 的 XML，您可以查看[java.beans.XMLEncoder](http://java.sun.com/j2se/1.5.0/docs/api/java/beans/XMLEncoder.html)。XMLEncoder 面向 UI 组件的序列化，但它同样适用于序列化 POJO。这些本质上是在 FAT 客户端中填充了用户输入的模型对象。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-09-29T00:59:39.753

看一下 ofbiz 框架。它使用小部件（xml）并通过处理程序将它们转换为输出 [http://ofbiz.apache.org/](http://ofbiz.apache.org/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-26T15:29:19.990

试试[QT 占碑](http://trolltech.com/products/appdev/programming-language-support/programming-language-support#additional-language-bindings)。这允许您在 QT Designer 中构建表单布局并将它们导出为您描述的那种描述符文件。

# sql-server - 在 MS SQL 上的更新查询中减少 PAGE 级别的死锁

> ID：321036
> 
> 赞同：4
> 
> 时间：2008-11-26T15:10:48.060
> 
> 标签：sql-server, database, sql-server-2005, tsql, deadlock

在默认的“READ COMMITED”事务下，在一个简单的普通表上，一个愚蠢的简单 SQL UPDATE 查询导致了一些有趣的死锁。

```
UPDATE table SET column=@P1 WHERE PK=@P2 
```

列`PK`是`varchar(11)`，上面有一个聚集索引。表上没有触发器或表关系..等。

我做了一些检查，发现死锁发生在“PAGE”级别，而不是 ROW/记录级别。然后，我发现对于每个更新查询，确实需要 100 个（甚至更多）页锁。（这对我来说没有意义，因为我一次更新一行）

有什么办法可以防止死锁的发生吗？或者，如何在不使用游标的情况下减少单行更新所需的锁数？

--

谢谢你的建议。

我曾尝试用高填充因子和低填充因子重建索引几次。我曾试图让进程更新不同的位置/切片。但没有任何改善或最坏的情况。

--

我尝试了 SQL Server Profiler。我捕获了一些“Lock:Deadlock Chain”和“Lock:Deadlock”，但没有捕获“Deadlock Graph”。双方都在读取提交、自动提交模式下进行简单的更新查询。

```
Lock:Deadlock Chain 17887475    1       0X01    4   myserver        2008-11-28 10:16:46.210 Parallel query worker thread was involved in a deadlock                                                                 0           971497  102 - Resource type Exchange                    Lock:Deadlock Chain 17887476    1       0X01    4   myserver        2008-11-28 10:16:46.210 Deadlock Chain SPID = 209 1:438102                                                                                                                                                                                                                                                          265006271       0   0X56AF060001000000000000001B0006        27              0 - LOCK    4 - U           0   72057594040352768   1 - TRANSACTION 0   6 - PAGE    mydatabase  971497  101 - Resource type Lock                
Lock:Deadlock Chain 17887477    1       0X01    4   myserver        2008-11-28 10:16:46.210 Parallel query worker thread was involved in a deadlock                                                                 0           971497  102 - Resource type Exchange                    Lock:Deadlock Chain 17887478    1       0X01    4   myserver        2008-11-28 10:16:46.210 Deadlock Chain SPID = 54 1:426206                                                                                                                                                                                                                                                           265006240       0   0XDE80060001000000000000001B0006        27              0 - LOCK    4 - U           0   72057594040352768   1 - TRANSACTION 0   6 - PAGE    mydatabase  971497  101 - Resource type Lock                
Lock:Deadlock Chain 17887479    1       0X01    4   myserver        2008-11-28 10:16:46.210 Deadlock Chain SPID = 209 1:426206                                                                                                                                                                                                                                                          265006271       0   0XDE80060001000000000000001B0006        27              0 - LOCK    4 - U           0   72057594040352768   1 - TRANSACTION 0   6 - PAGE    mydatabase  971497  101 - Resource type Lock                
Lock:Deadlock Chain 17887480    1       0X01    4   myserver        2008-11-28 10:16:46.210 Parallel query worker thread was involved in a deadlock                                                                 0           971497  102 - Resource type Exchange                    Lock:Deadlock Chain 17887481    1       0X01    4   myserver        2008-11-28 10:16:46.210 Deadlock Chain SPID = 54 1:426066                                                                                                                                                                                                                                                           265006240       0   0X5280060001000000000000001B0006        27              0 - LOCK    4 - U           0   72057594040352768   1 - TRANSACTION 0   6 - PAGE    mydatabase  971497  101 - Resource type Lock                
Lock:Deadlock Chain 17887482    1       0X01    4   myserver        2008-11-28 10:16:46.210 Deadlock Chain SPID = 209 1:426066                                                                                                                                                                                                                                                          265006271       0   0X5280060001000000000000001B0006        27              0 - LOCK    4 - U           0   72057594040352768   1 - TRANSACTION 0   6 - PAGE    mydatabase  971497  101 - Resource type Lock                
Lock:Deadlock Chain 17887483    1       0X01    4   myserver        2008-11-28 10:16:46.210 Parallel query worker thread was involved in a deadlock                                                                 0           971497  102 - Resource type Exchange                    Lock:Deadlock Chain 17887484    1       0X01    4   myserver        2008-11-28 10:16:46.210 Deadlock Chain SPID = 209 1:425614                                                                                                                                                                                                                                                          265006271       0   0X8E7E060001000000000000001B0006        27              0 - LOCK    4 - U           0   72057594040352768   1 - TRANSACTION 0   6 - PAGE    mydatabase  971497  101 - Resource type Lock                
Lock:Deadlock Chain 17887485    1       0X01    4   myserver        2008-11-28 10:16:46.210 Parallel query worker thread was involved in a deadlock                                                                 0           971497  102 - Resource type Exchange                    Lock:Deadlock Chain 17887486    1       0X01    4   myserver        2008-11-28 10:16:46.210 Deadlock Chain SPID = 209 1:426687                                                                                                                                                                                                                                                          265006271       0   0XBF82060001000000000000001B0006        27              0 - LOCK    4 - U           0   72057594040352768   1 - TRANSACTION 0   6 - PAGE    mydatabase  971497  101 - Resource type Lock                
Lock:Deadlock Chain 17887487    1       0X01    4   myserver        2008-11-28 10:16:46.210 Parallel query worker thread was involved in a deadlock                                                                 0           971497  102 - Resource type Exchange                
Lock:Deadlock Chain 17887488    1       0X01    4   myserver        2008-11-28 10:16:46.210 Deadlock Chain SPID = 209 1:425392                                                                                                                                                                                                                                                          265006271       0   0XB07D060001000000000000001B0006        27              0 - LOCK    4 - U           0   72057594040352768   1 - TRANSACTION 0   6 - PAGE    mydatabase  971497  101 - Resource type Lock                
Lock:Deadlock Chain 17887489    1       0X01    4   myserver        2008-11-28 10:16:46.210 Parallel query worker thread was involved in a deadlock                                                                 0           971497  102 - Resource type Exchange                
Lock:Deadlock Chain 17887491    1       0X01    4   myserver        2008-11-28 10:16:46.210 Parallel query worker thread was involved in a deadlock                                                                 0           971497  102 - Resource type Exchange                
Lock:Deadlock Chain 17887493    1       0X01    4   myserver        2008-11-28 10:16:46.210 Parallel query worker thread was involved in a deadlock                                                                 0           971497  102 - Resource type Exchange                
Lock:Deadlock Chain 17887494    1       0X01    4   myserver        2008-11-28 10:16:46.210 Deadlock Chain SPID = 209 1:435792                                                                                                                                                                                                                                                          265006271       0   0X50A6060001000000000000001B0006        27              0 - LOCK    4 - U           0   72057594040352768   1 - TRANSACTION 0   6 - PAGE    mydatabase  971497  101 - Resource type Lock                
Lock:Deadlock Chain 17887495    1       0X01    4   myserver        2008-11-28 10:16:46.210 Parallel query worker thread was involved in a deadlock                                                                 0           971497  102 - Resource type Exchange                
Lock:Deadlock Chain 17887496    1       0X01    4   myserver        2008-11-28 10:16:46.210 Deadlock Chain SPID = 209 1:438206                                                                                                                                                                                                                                                          265006271       0   0XBEAF060001000000000000001B0006        27              0 - LOCK    4 - U           0   72057594040352768   1 - TRANSACTION 0   6 - PAGE    mydatabase  971497  101 - Resource type Lock                
Lock:Deadlock   17887497        myuser  0XCD85FBB269700B4AA2F4E8579D118999  209 myserver    myuser  2008-11-28 10:16:45.930 1:426206    265006271   myapps  0   0XDE80060001000000000000001B0006    123 27  281 2008-11-28 10:16:46.210 myclient    0 - LOCK    4 - U           0   72057594040352768   1 - TRANSACTION 0   6 - PAGE    mydatabase  971498 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-26T15:17:57.360

您有 2 个选项来减少锁升级：

1）添加 WITH (ROWLOCK) 提示以要求 sql server 采用更细粒度的锁（您的里程可能会有所不同：

> UPDATE table WITH (ROWLOCK) SET column=@P1 WHERE PK=@P2; 而 PK varchar(11) 上有一个聚集索引。桌子上没有跳跳虎或桌子关系..等。

2) 以随机顺序更新行，这降低了行锁升级为页锁的可能性。

Also, ensuring that the indexes on that table are up to date can often reduce locking. As can leaving a Fill factor (90 is good) if you are going to be doing lots of inserts.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T03:43:21.147

Have you run a profile trace?

Fire up SQL Profiler and create a standard trace with these events added:

*   Locks:Deadlock Graph
*   Locks:Lock:Deadlock Chain
*   Locks:Lock:Escalation

Should should provide details of the precise nature of the deadlock.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T16:30:48.383

In the normal, simple case this type of begavior is not often seen. My question to you is this : what's on the 'other side' of this transaction? What's the other update statement that is running and causing this deadlock? That, I think, will be the key to diagnosing this problem. Honestly, my money is on this other, heretofore unidentified query being the culprit. And I'm in vegas now...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T15:15:22.950

What select statements from same table AND same records do occur inside the same transaction before update statement? Use (updlock) locking hints in these selects.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T17:00:27.337

do you have any UPDATE TRIGGERS on the table? If so, the action of the trigger, might be causing your deadlock.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-22T15:41:32.993

I finally have to do a workaround by using cusror in a stored procedure.

But it is still interesting that how the PAGE lock happen and how to resolve.

* * *

After some more search on Google, there are some other people have the same problem and they(from MSDN forum) suggest to turn off the parallelism in SQL Server 2005 but I never get a chance to try.

# c# - c#文本框中的链接

> ID：321037
> 
> 赞同：6
> 
> 时间：2008-11-26T15:11:30.197
> 
> 标签：c#, textbox, hyperlink

我有一个自定义 Jabber IM 客户端，但我遇到了链接问题。当输入[http://something.com](http://something.com)之类的内容时，我希望它在消息窗口中显示为链接。消息窗口是一个标准的 c# 文本框。有没有办法将其标记为链接，以便可以单击并打开网页？

谢谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-26T15:16:52.387

RichTextBox 可以检测 URL，我认为常规 TextBox 无法检测到它们。但是，您始终可以使用单行 RichTextBox 进行输入。

[http://msdn.microsoft.com/en-us/library/f591a55w.aspx](http://msdn.microsoft.com/en-us/library/f591a55w.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2016-02-07T22:24:34.940

Jamie Garcia 先生提供的解决方案非常棒，提供的 MSDN 文章链接引用了该解决方案。但是，鉴于这个解决方案是很久以前提出的，我想提出一个更新的解决方案。

[MSDN 解决方案](https://msdn.microsoft.com/en-us/library/f591a55w.aspx)启动 Internet Explorer 并将 URL 直接传递给程序。我觉得更好（并且更以用户为中心）的方法是在用户的**默认网络浏览器**中启动链接。

`LinkClicked`我们仍然为我们控件的事件设置了一个事件处理程序`RichTextBox`，但有一些更改。这是完整的代码：

```
// Event raised from RichTextBox when user clicks on a link:
private void richTextBox_LinkClicked(object sender, LinkClickedEventArgs e)
{
    LaunchWeblink(e.LinkText);
}

// Performs the actual browser launch to follow link:
private void LaunchWeblink(string url)
{
    if (IsHttpURL(url)) Process.Start(url);
}

// Simple check to make sure link is valid,
// can be modified to check for other protocols:
private bool IsHttpURL(string url)
{
    return
        ((!string.IsNullOrWhiteSpace(url)) &&
        (url.ToLower().StartsWith("http")));
} 
```

正如[MSDN 文章](https://msdn.microsoft.com/en-us/library/f591a55w.aspx)所述，控件的`DetectUrls`属性`RichTextBox`默认启用，因此任何有效的 http/https url 将自动显示为带下划线的超链接。

# c# - 在 WPF 中共享 ObjectDataProvider

> ID：321048
> 
> 赞同：4
> 
> 时间：2008-11-26T15:14:13.297
> 
> 标签：c#, wpf, objectdataprovider

我试图在我的主应用程序和用户控件之间共享一个 ObjectDataProvider 资源。我在应用程序和用户控件中包含的单独资源字典文件中定义 odp。

```
<ObjectDataProvider x:Key="AsymmetricFrameHolder" 
    ObjectType="{x:Type data:DataFrameAsymmetric}"/> 
```

然后我尝试在主应用程序中访问它，如下所示：

```
ObjectDataProvider odp = (ObjectDataProvider)Resources["AsymmetricFrameHolder"];
return (DataFrameAsymmetric)odp.ObjectInstance; 
```

并将其绑定在用户控件中：

```
<Grid Name="grid"  Height="Auto" Width="Auto" 
   DataContext="{StaticResource AsymmetricFrameHolder}"> 
```

然后：

```
<TextBox  Name="TextBox_Length"  Grid.Row="0" Grid.Column="1" 
    Text="{Binding Path=Length }"/> 
```

这将创建 2 个 DataFrameAsymmetric 实例。一个在主应用程序中，一个在用户控件中。

如何设置程序以创建单个共享实例？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-26T16:45:13.003

如果你可以采取不同的路线，这个问题可以很容易地解决。将您的 Class DataFrameAsymmetric 转换为**[Singleton 类](http://msdn.microsoft.com/en-us/library/ms998558.aspx)**，并在您想要使用它的实例的任何地方使用如下所示

```
<Grid Name="grid"  Height="Auto" Width="Auto" DataContext="{Binding Source={x:Static data:DataFrameAsymmetric.Instance}}"> 
```

在代码的任何部分，您都可以通过以下方式访问实例

```
DataFrameAsymmetric.Instance 
```

# visual-studio - 如何在 Visual Studio Team 版中按个人请求查看负载测试报告

> ID：321051
> 
> 赞同：2
> 
> 时间：2008-11-26T15:14:31.737
> 
> 标签：visual-studio, testing, load-testing

当使用 Visual Studio 的 Load Web Test 对网站进行性能测试时，可以获得结果摘要。显示了有用的度量，例如平均响应时间、最大响应时间等。

让我感兴趣的一件事是能够在需要时深入了解特定请求，回答诸如单个请求花费最多时间之类的问题。可以将 Run Settings 的 Timing Details Storage 属性设置为“All Individual Details”，但这似乎只为每个 URI 提供聚合，而忽略了对查询参数的更改。在我的场景中，[http://somewebsite/dosomething.ashx?cmd=find与](http://somewebsite/dosomething.ashx?cmd=find)[http://somewebsite/dosomething.ashx?cmd=nothing](http://somewebsite/dosomething.ashx?cmd=nothing)非常不同。如何生成区分这些的报告？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-10T18:19:03.427

AFAIK，VSTS 2008 中的负载测试不允许您在粒度级别捕获请求详细信息。我读过 VSTS 2010（仍处于测试阶段）有一个功能可以让你做类似的事情。 [http://blogs.msdn.com/billbar/archive/2009/06/09/vsts-2010-load-test-feature-saving-test-logs.aspx](http://blogs.msdn.com/billbar/archive/2009/06/09/vsts-2010-load-test-feature-saving-test-logs.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-20T20:25:04.130

或者您可以尝试在[http://www.qualiwebsolutions.com/上查看 Visual Studio 报告工具](http://www.qualiwebsolutions.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-17T03:54:39.087

（此功能是 VS 2008 或 2010 中的新功能，不确定是哪个）：在您的请求中选择查询字符串参数，在“属性”窗格中有一个属性“显示单独的请求结果”。将此设置为 True，然后 Visual Studio 将为该查询字符串参数的所有变体记录单独的页面结果。

# email - 如何使用电子邮件模板 txt 文件并保留格式？

> ID：321055
> 
> 赞同：0
> 
> 时间：2008-11-26T15:15:00.737
> 
> 标签：email, asp-classic, formatting

我正在使用预先格式化的文本文件作为电子邮件模板。该文件在我想要的地方有换行符。我想使用此模板发送纯文本电子邮件，但是当我这样做时，我会丢失所有格式。换行符被剥离。

如何解析此文件并保留换行符？我不想使用`<pre>`标签，因为我想发送纯文本电子邮件。

我正在使用经典的 ASP ReadAll 方法将模板拉入字符串：

```
 Dim TextStream
        Set TextStream = FSO.OpenTextFile(Filepath, ForReading, False, TristateUseDefault)

        ' Read file in one hit
        Dim Contents
        GetTemplate = TextStream.ReadAll ' return file contents 
```

我错过了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T15:38:21.483

这就是我所做的......

我获取一个文本或 HTML 文件（我将显示文本，因为它更小，但适用的代码完全相同），并且我将众所周知的值放入我以后可以替换的文本文件中。

-- 开始文本文件

```
We've generated a new password for you at your request, you can use this new password with your username to log in to various sections of our site.

Username: ##UserName##
Temporary Password: ##Password##

To use this temporary password, please copy and paste it into the password box.

Please keep this email for your records. 
```

-- 结束文本文件

然后创建一个键/值对列表的简单问题，其中包含要替换的文本以及替换它的值。将文件作为字符串加载到内存中，并循环通过键/值对替换文本值。

```
ListDictionary dictionary = new ListDictionary
                                            {
                                                {"##UserName##", user.BaseUser.UserName},
                                                {"##Password##", newPassword}
                                            };

            string fromResources = GetFromResources("forgotpasswordEmail.html");
            string textfromResources = GetFromResources("forgotpasswordEmail.txt");
            foreach (DictionaryEntry entry in dictionary)
            {
                fromResources = fromResources.Replace(entry.Key.ToString(), entry.Value.ToString());
                textfromResources = textfromResources.Replace(entry.Key.ToString(), entry.Value.ToString());
            } 
```

然后您可以通过电子邮件发送文本（在本例中为 textfromResources 变量），它将包含所有必要的换行符和格式。

就像我说的，您可以对 HTML 文件或您想要的任何类型的文件执行相同的操作。

尽管我的示例是用 C# 编写的（我手头没有任何经典的 ASP 代码，抱歉），但查找和替换值的概念将适用于经典 ASP。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T15:40:09.093

您显示的代码不应删除任何换行符。问题可能出在电子邮件生成部分。你能展示那部分吗？

邮件的 Content-Type 是 text/plain 吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T02:49:48.900

我建议使用 [http://www.webdevbros.net/2007/06/28/template-component-for-classic-asp/](http://www.webdevbros.net/2007/06/28/template-component-for-classic-asp/)

# php - 在 Cocoa 中加密数据，在 PHP 中解码

> ID：321061
> 
> 赞同：2
> 
> 时间：2008-11-26T15:17:25.817
> 
> 标签：php, cocoa, encryption, openssl, mcrypt

我试图解决的情况：在我的 Cocoa 应用程序中，我需要使用对称密码加密一个字符串，将其发布到 PHP，并让该脚本解码数据。该过程需要反向工作以返回答案（PHP 编码，Cocoa 解码）。

我遗漏了一些东西，因为即使我可以在 PHP 和 Cocoa 中使密钥和初始化向量 (iv) 相同，但当一个应用程序将其编码数据发送到另一个应用程序时，解码永远不会起作用。两者都可以很好地编码/解码自己的数据（经过验证以确保手头没有一些 PEBKAC 问题）。我怀疑某处存在填充问题，我只是没有看到。

我的 cocoa 应用程序使用 SSCrypto 进行编码（它只是 OpenSSL 函数的一个方便的包装器）。密码是 Blowfish，模式是 CBC。（请原谅内存泄漏，代码已被剥离为基本要素）

```
NSData *secretText = [@"secretTextToEncode" dataUsingEncoding:NSUTF8StringEncoding];
NSData *symmetricKey = [@"ThisIsMyKey" dataUsingEncoding:NSUTF8StringEncoding];

unsigned char *input = (unsigned char *)[secretText bytes];
unsigned char *outbuf;
int outlen, templen, inlen;
inlen = [secretText length];

unsigned char evp_key[EVP_MAX_KEY_LENGTH] = {"\0"};
int cipherMaxIVLength = EVP_MAX_IV_LENGTH;
EVP_CIPHER_CTX cCtx;
const EVP_CIPHER *cipher = EVP_bf_cbc();

cipherMaxIVLength = EVP_CIPHER_iv_length( cipher );
unsigned char iv[cipherMaxIVLength];

EVP_BytesToKey(cipher, EVP_md5(), NULL, [symmetricKey bytes], [symmetricKey length], 1, evp_key, iv);

NSData *initVector = [NSData dataWithBytes:iv length:cipherMaxIVLength];

EVP_CIPHER_CTX_init(&cCtx);

if (!EVP_EncryptInit_ex(&cCtx, cipher, NULL, evp_key, iv)) {
    EVP_CIPHER_CTX_cleanup(&cCtx);
    return nil;
}
int ctx_CipherKeyLength = EVP_CIPHER_CTX_key_length( &cCtx );
EVP_CIPHER_CTX_set_key_length(&cCtx, ctx_CipherKeyLength);

outbuf = (unsigned char *)calloc(inlen + EVP_CIPHER_CTX_block_size(&cCtx), sizeof(unsigned char));

if (!EVP_EncryptUpdate(&cCtx, outbuf, &outlen, input, inlen)){
    EVP_CIPHER_CTX_cleanup(&cCtx);
    return nil;
}
if (!EVP_EncryptFinal(&cCtx, outbuf + outlen, &templen)){
    EVP_CIPHER_CTX_cleanup(&cCtx);
    return nil;
}
outlen += templen;
EVP_CIPHER_CTX_cleanup(&cCtx);

NSData *cipherText = [NSData dataWithBytes:outbuf length:outlen];

NSString *base64String = [cipherText encodeBase64WithNewlines:NO];
NSString *iv = [initVector encodeBase64WithNewlines:NO]; 
```

然后将 base64String 和 iv 发布到 PHP 以尝试对其进行解码：

```
<?php

import_request_variables( "p", "p_" );

if( $p_data != "" && $p_iv != "" )
{
    $encodedData = base64_decode( $p_data, true );
    $iv = base64_decode( $p_iv, true );

    $td = mcrypt_module_open( MCRYPT_BLOWFISH, '', MCRYPT_MODE_CBC, '' );
    $keySize = mcrypt_enc_get_key_size( $td );
    $key = substr( md5( "ThisIsMyKey" ), 0, $keySize );

    $decodedData = mcrypt_decrypt(MCRYPT_BLOWFISH, $key, $encodedData, MCRYPT_MODE_CBC, $iv );
    mcrypt_module_close( $td );

    echo "decoded: " . $decodedData;
}
?> 
```

decodedData 总是乱码。

我已经尝试反转该过程，将编码输出从 PHP 发送到 Cocoa，但 EVP_DecryptFinal() 失败，这让我相信某处存在 NULL 填充问题。我已经阅读并重新阅读了 PHP 和 OpenSSL 文档，但现在它们都模糊不清了，我没有想法可以尝试。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T17:58:31.357

我认为您的问题是从密钥字符串派生原始加密密钥的方法在两侧不同。php md5() 函数返回一个十六进制字符串，即“a476c3...”，您将其缩减为密钥大小，而 EVP_BytesToKey() 是一个相当复杂的哈希例程，它返回一个原始字节字符串。它可能会通过提供的参数简化为原始 MD5 哈希，但我无法确定。无论哪种方式，它都将不同于 php 哈希。

如果您将 php 更改为 md5("ThisIsMyKey", TRUE)，这将为您提供原始 md5 哈希。在可可方面，SSCrypto 的 +getMD5ForData: 方法应该为相同的字符串生成相同的字符串（文本编码问题除外）。

编辑 1：如果 php 字符串和 Cocoa 数据打印出来相同，它们在字节级别仍然不同。php 字符串是十六进制编码的（即仅包含字符 0-9 和 af），而可可数据是原始字节（尽管 NSData 在 NSLogged 时会打印出其内容的十六进制编码字符串）。您仍然需要将第二个 TRUE 参数添加到 php 的 md5() 函数以获取原始字节字符串。

编辑 2：[OpenSSL 1.1.0c 更改了](https://stackoverflow.com/q/39637388/608639)一些内部组件中使用的摘要算法。以前使用MD5，1.1.0改用SHA256。请注意，更改不会影响您`EVP_BytesToKey`和`openssl enc`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T18:27:00.897

我发现了我的问题。简短的回答：在 Cocoa 和 PHP 下使用的密钥长度不同。长答案...

我最初的查询是使用 Blowfish/CBC，它是一个从 16 字节到 56 字节的可变密钥长度密码。出于 Boaz 认为密钥在某种程度上应该受到责备的想法，我切换到 TripleDES 作为密码，因为它使用 24 的固定密钥长度字节。这时我注意到一个问题：Cocoa/EVP_BytesToKey() 返回的密钥长度为 24 字节，但 md5() 对我的密钥进行散列后返回的值只有 16。

该问题的解决方案是让 PHP 以相同的方式创建一个密钥，`EVP_BytesToKey`直到输出长度至少为 (cipherKeyLength + cipherIVLength)。以下 PHP 就是这样做的（忽略任何盐或计数迭代）

```
$cipher = MCRYPT_TRIPLEDES;
$cipherMode = MCRYPT_MODE_CBC;

$keySize   = mcrypt_get_key_size( $cipher, $cipherMode );
$ivSize    = mcrypt_get_iv_size( $cipher, $cipherMode );

$rawKey = "ThisIsMyKey";
$genKeyData = '';
do
{
    $genKeyData = $genKeyData.md5( $genKeyData.$rawKey, true );
} while( strlen( $genKeyData ) < ($keySize + $ivSize) );

$generatedKey = substr( $genKeyData, 0, $keySize );
$generatedIV  = substr( $genKeyData, $keySize, $ivSize );

$output = mcrypt_decrypt( $cipher, $generatedKey, $encodedData, $cipherMode, $generatedIV );

echo "output (hex)" . bin2hex($output); 
```

请注意，该输出的末尾很可能有 PKCS#5 填充。在这里查看评论[http://us3.php.net/manual/en/ref.mcrypt.php](http://us3.php.net/manual/en/ref.mcrypt.php)用于添加`pkcs5_pad`和`pkcs5_unpad`删除所述填充。

基本上，获取密钥的原始 md5 值，如果不够长，则将密钥附加到 md5 结果并再次 md5 该字符串。洗涤，冲洗，重复。EVP_BytesToKey() 的手册页解释了它实际在做什么，并在需要时显示了将盐值放在哪里。这种重新生成密钥的方法也正确地重新生成了初始化向量 (iv)，因此没有必要传递它。

但是河豚呢？

`EVP_BytesToKey()`返回密码可能的最小密钥，因为它不接受作为密钥大小基础的上下文。所以默认大小就是你得到的全部，对于 Blowfish 来说是 16 字节。 `mcrypt_get_key_size()`，另一方面，返回最大可能的密钥大小。所以我的原始代码中的以下几行：

```
$keySize = mcrypt_enc_get_key_size( $td );
$key = substr( md5( "ThisIsMyKey" ), 0, $keySize ); 
```

将始终返回 32 个字符的密钥，因为 $keySize 设置为 56。将上面的代码更改为：

```
$cipher = MCRYPT_BLOWFISH;
$cipherMode = MCRYPT_MODE_CBC;

$keySize   = 16; 
```

允许河豚正确解码，但几乎破坏了可变长度密钥的好处。总而言之，`EVP_BytesToKey()`当涉及到可变密钥长度密码时，它被打破了。使用可变密钥密码时，您需要以不同的方式创建密钥/iv。我没有深入研究它，因为 3DES 可以满足我的需要。

# language-agnostic - 高阶函数的导数

> ID：321067
> 
> 赞同：5
> 
> 时间：2008-11-26T15:18:58.637
> 
> 标签：language-agnostic, programming-languages, automatic-differentiation

这是在[自动微分](http://en.wikipedia.org/wiki/Automatic_differentiation)的背景下——这样的系统将如何处理类似的功能`map`，或者`filter`——甚至是[SKI 组合](http://en.wikipedia.org/wiki/SKI_combinator_calculus)器之一？

示例：我有以下功能：

```
def func(x):
    return sum(map(lambda a: a**x, range(20))) 
```

它的衍生物是什么？AD 系统会产生什么结果？（此函数在实数输入上定义明确）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-06-26T02:35:42.350

我不同意公认的答案，即您无法有效地区分更高等级的函数，或者您需要通过在实践中演示它来将自己限制在其中的一个特别小的子集。

使用我的 Haskell 'ad' 包，我们得到：

```
ghci> :m + Numeric.AD
ghci> diff (\x -> sum (map (**x) [1..20])) 10
7.073726805128313e13 
```

我们可以提取通过滥用跟踪数字类型所做的事情来回答您关于导数的问题：

```
ghci> :m + Debug.Traced
ghci> putStrLn $ showAsExp $ diff (\x -> sum (map (**x) [1..20])) (unknown "x" :: Traced Double) 
1.0 * (1.0 ** x * log 1.0) + 
1.0 * (2.0 ** x * log 2.0) +
1.0 * (3.0 ** x * log 3.0) +
1.0 * (4.0 ** x * log 4.0) +
1.0 * (5.0 ** x * log 5.0) +
1.0 * (6.0 ** x * log 6.0) +
1.0 * (7.0 ** x * log 7.0) +
1.0 * (8.0 ** x * log 8.0) +
1.0 * (9.0 ** x * log 9.0) +
1.0 * (10.0 ** x * log 10.0) +
1.0 * (11.0 ** x * log 11.0) +
1.0 * (12.0 ** x * log 12.0) +
1.0 * (13.0 ** x * log 13.0) +
1.0 * (14.0 ** x * log 14.0) +
1.0 * (15.0 ** x * log 15.0) +
1.0 * (16.0 ** x * log 16.0) +
1.0 * (17.0 ** x * log 17.0) +
1.0 * (18.0 ** x * log 18.0) +
1.0 * (19.0 ** x * log 19.0) +
1.0 * (20.0 ** x * log 20.0) 
```

通过完全共享，您会得到看起来更可怕的结果，有时会逐渐提高效率。

```
ghci> putStrLn $ showAsExp $ reShare $ diff (\x -> sum (map (**x) [1..20])) 
      (unknown "x" :: Traced Double)
let _21 = 1.0 ** x;
    _23 = log 1.0;
    _20 = _21 * _23;
    _19 = 1.0 * _20;
    _26 = 2.0 ** x;
    _27 = log 2.0;
    _25 = _26 * _27;
    _24 = 1.0 * _25;
    _18 = _19 + _24;
    _30 = 3.0 ** x;
    _31 = log 3.0;
    _29 = _30 * _31;
    _28 = 1.0 * _29;
    _17 = _18 + _28;
    _34 = 4.0 ** x;
    _35 = log 4.0;
    _33 = _34 * _35;
    _32 = 1.0 * _33;
    _16 = _17 + _32;
    _38 = 5.0 ** x;
    _39 = log 5.0;
    _37 = _38 * _39;
    _36 = 1.0 * _37;
    _15 = _16 + _36;
    _42 = 6.0 ** x;
    _43 = log 6.0;
    _41 = _42 * _43;
    _40 = 1.0 * _41;
    _14 = _15 + _40;
    _46 = 7.0 ** x;
    _47 = log 7.0;
    _45 = _46 * _47;
    _44 = 1.0 * _45;
    _13 = _14 + _44;
    _50 = 8.0 ** x;
    _51 = log 8.0;
    _49 = _50 * _51;
    _48 = 1.0 * _49;
    _12 = _13 + _48;
    _54 = 9.0 ** x;
    _55 = log 9.0;
    _53 = _54 * _55;
    _52 = 1.0 * _53;
    _11 = _12 + _52;
    _58 = 10.0 ** x;
    _59 = log 10.0;
    _57 = _58 * _59;
    _56 = 1.0 * _57;
    _10 = _11 + _56;
    _62 = 11.0 ** x;
    _63 = log 11.0;
    _61 = _62 * _63;
    _60 = 1.0 * _61;
    _9 = _10 + _60;
    _66 = 12.0 ** x;
    _67 = log 12.0;
    _65 = _66 * _67;
    _64 = 1.0 * _65;
    _8 = _9 + _64;
    _70 = 13.0 ** x;
    _71 = log 13.0;
    _69 = _70 * _71;
    _68 = 1.0 * _69;
    _7 = _8 + _68;
    _74 = 14.0 ** x;
    _75 = log 14.0;
    _73 = _74 * _75;
    _72 = 1.0 * _73;
    _6 = _7 + _72;
    _78 = 15.0 ** x;
    _79 = log 15.0;
    _77 = _78 * _79;
    _76 = 1.0 * _77;
    _5 = _6 + _76;
    _82 = 16.0 ** x;
    _83 = log 16.0;
    _81 = _82 * _83;
    _80 = 1.0 * _81;
    _4 = _5 + _80;
    _86 = 17.0 ** x;
    _87 = log 17.0;
    _85 = _86 * _87;
    _84 = 1.0 * _85;
    _3 = _4 + _84;
    _90 = 18.0 ** x;
    _91 = log 18.0;
    _89 = _90 * _91;
    _88 = 1.0 * _89;
    _2 = _3 + _88;
    _94 = 19.0 ** x;
    _95 = log 19.0;
    _93 = _94 * _95;
    _92 = 1.0 * _93;
    _1 = _2 + _92;
    _98 = 20.0 ** x;
    _99 = log 20.0;
    _97 = _98 * _99;
    _96 = 1.0 * _97;
    _0 = _1 + _96;
in  _0 
```

一般来说，自动微分对高阶函数没有问题。但是，根据特定工具的限制，源到源的翻译可能会遇到一些问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-04-30T19:14:16.997

一个好的广告系统将毫无困难地轻松完成。如果 AD 代码执行源到源的翻译，那么`sum`. 但是，如果它是一个通过重载算术运算符来工作的 AD 系统，那么 AD 代码实际上不会“看到”`sum`函数，而只是函数调用的`+`操作。`sum`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T15:28:29.883

高阶函数是离散的。它们不具有笛卡尔的质量，即具有对某些 n 维空间中的点具有明确定义的映射的参数。

但是，随着您对答案的澄清，可以说几件事。符号区分一些高阶函数是可能的，但仅适用于解析为众所周知的函数的某些调用模式。

可能[数值微分](http://en.wikipedia.org/wiki/Numerical_differentiation)会更有成效，因为它可以通过重复评估给定函数来估计导数。

此外，完全通用的函数——你的例子正朝着这个方向发展，使用相对任意的函数——最终你会达到图灵完备性，这意味着符号微分器的任何聪明之处都无法自动区分功能。

# c++ - 从 C++ 函数返回多个值

> ID：321068
> 
> 赞同：313
> 
> 时间：2008-11-26T15:19:01.493
> 
> 标签：c++

是否有从 C++ 函数返回多个值的首选方法？例如，假设一个函数将两个整数相除并返回商和余数。我经常看到的一种方法是使用参考参数：

```
void divide(int dividend, int divisor, int& quotient, int& remainder); 
```

一种变体是返回一个值并通过引用参数传递另一个值：

```
int divide(int dividend, int divisor, int& remainder); 
```

另一种方法是声明一个结构以包含所有结果并返回：

```
struct divide_result {
    int quotient;
    int remainder;
};

divide_result divide(int dividend, int divisor); 
```

通常首选这些方法之一，还是有其他建议？

编辑：在现实世界的代码中，可能有两个以上的结果。它们也可能是不同的类型。

* * *

## 回答 #1

> 赞同：260
> 
> 时间：2008-11-26T15:22:03.763

为了返回两个值，我使用 a `std::pair`（通常是 typedef'd）。您应该查看`boost::tuple`（在 C++11 和更新版本中，有`std::tuple`）以获得两个以上的返回结果。

随着在 C++ 17 中引入结构化绑定，返回`std::tuple`可能应该成为公认的标准。

* * *

## 回答 #2

> 赞同：245
> 
> 时间：2013-05-13T06:51:59.500

在 C++11 中，您可以：

```
#include <tuple>

std::tuple<int, int> divide(int dividend, int divisor) {
    return  std::make_tuple(dividend / divisor, dividend % divisor);
}

#include <iostream>

int main() {
    using namespace std;

    int quotient, remainder;

    tie(quotient, remainder) = divide(14, 3);

    cout << quotient << ',' << remainder << endl;
} 
```

在 C++17 中：

```
#include <tuple>

std::tuple<int, int> divide(int dividend, int divisor) {
    return  {dividend / divisor, dividend % divisor};
}

#include <iostream>

int main() {
    using namespace std;

    auto [quotient, remainder] = divide(14, 3);

    cout << quotient << ',' << remainder << endl;
} 
```

或使用结构：

```
auto divide(int dividend, int divisor) {
    struct result {int quotient; int remainder;};
    return result {dividend / divisor, dividend % divisor};
}

#include <iostream>

int main() {
    using namespace std;

    auto result = divide(14, 3);

    cout << result.quotient << ',' << result.remainder << endl;

    // or

    auto [quotient, remainder] = divide(14, 3);

    cout << quotient << ',' << remainder << endl;
} 
```

* * *

## 回答 #3

> 赞同：144
> 
> 时间：2008-11-26T17:05:10.983

就个人而言，我通常不喜欢返回参数，原因有很多：

*   在调用中，哪些参数是输入，哪些是输出并不总是很明显
*   您通常必须创建一个局部变量来捕获结果，而返回值可以内联使用（这可能是也可能不是一个好主意，但至少您可以选择）
*   对我来说，一个函数有一个“门内”和一个“门外”似乎更干净——所有的输入都在这里，所有的输出都在那里
*   我喜欢让我的论点列表尽可能短

我对 pair/tuple 技术也有一些保留。主要是，返回值通常没有自然顺序。代码的读者如何知道`result.first`是商还是余数？实施者可以更改顺序，这会破坏现有代码。如果值是相同的类型，那么这尤其隐蔽，因此不会生成编译器错误或警告。实际上，这些参数也适用于返回参数。

这是另一个代码示例，这个示例不那么简单：

```
pair<double,double> calculateResultingVelocity(double windSpeed, double windAzimuth,
                                               double planeAirspeed, double planeCourse);

pair<double,double> result = calculateResultingVelocity(25, 320, 280, 90);
cout << result.first << endl;
cout << result.second << endl; 
```

这是打印地速和航向，还是航向和地速？这并不明显。

与此相比：

```
struct Velocity {
    double speed;
    double azimuth;
};
Velocity calculateResultingVelocity(double windSpeed, double windAzimuth,
                                    double planeAirspeed, double planeCourse);

Velocity result = calculateResultingVelocity(25, 320, 280, 90);
cout << result.speed << endl;
cout << result.azimuth << endl; 
```

我认为这更清楚。

所以我认为我的第一选择，一般来说，是结构技术。在某些情况下，pair/tuple 的想法可能是一个很好的解决方案。我想尽可能避免返回参数。

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2008-11-26T15:22:17.040

```
std::pair<int, int> divide(int dividend, int divisor)
{
   // :
   return std::make_pair(quotient, remainder);
}

std::pair<int, int> answer = divide(5,2);
 // answer.first == quotient
 // answer.second == remainder 
```

std::pair 本质上是您的结构解决方案，但已经为您定义，并准备适应任何两种数据类型。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2008-11-26T15:21:40.707

它完全取决于实际功能和多个值的含义，以及它们的大小：

*   如果它们与您的分数示例中相关，那么我将使用结构或类实例。
*   如果它们不是真正相关并且不能分组到一个类/结构中，那么也许你应该将你的方法重构为两个。
*   根据您返回的值的内存大小，您可能希望返回指向类实例或结构的指针，或使用引用参数。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-11-26T17:45:34.847

面向对象的解决方案是创建一个比率类。它不需要任何额外的代码（会节省一些），会更干净/更清晰，并且会给你一些额外的重构，让你也可以清理这个类之外的代码。

实际上，我认为有人建议返回一个结构，该结构足够接近，但隐藏了这样的意图，即这需要是一个经过深思熟虑的类，具有构造函数和一些方法，实际上，就是您最初提到的“方法”（作为返回pair) 应该很可能是此类返回自身实例的成员。

我知道您的示例只是一个“示例”，但事实是，除非您的函数比任何函数都应该做的更多，否则如果您希望它返回多个值，您几乎肯定会丢失一个对象。

不要害怕创建这些小类来做一些小工作——这就是 OO 的魔力——你最终会分解它，直到每个方法都非常小而简单，每个类都小而易于理解。

另一件事应该是一个错误的指标：在 OO 中你基本上没有数据——OO 不是关于传递数据，一个类需要在内部管理和操作它自己的数据，任何数据传递（包括访问器）是一个迹象，表明你可能需要重新考虑一些事情。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2016-07-22T16:55:02.723

**使用 C++17，您还可以返回一个或多个不可移动/不可复制的值**（在某些情况下）。返回不可移动类型的可能性来自于新的保证返回值优化，并且它与 *聚合*以及可以称为*模板构造函数*的东西很好地组合在一起。

```
template<typename T1,typename T2,typename T3>
struct many {
  T1 a;
  T2 b;
  T3 c;
};

// guide:
template<class T1, class T2, class T3>
many(T1, T2, T3) -> many<T1, T2, T3>;

auto f(){ return many{string(),5.7, unmovable()}; }; 

int main(){
   // in place construct x,y,z with a string, 5.7 and unmovable.
   auto [x,y,z] = f();
} 
```

这样做的好处是保证不会导致*任何*复制或移动。您也可以使示例`many`struct 可变参数。更多细节：

[返回 C++17 可变参数模板“构造推导指南”的可变参数聚合（结构）和语法](https://stackoverflow.com/questions/38393302/returning-variadic-aggregates-struct-and-syntax-for-c17-variadic-template-c)

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2018-10-16T18:49:00.420

有很多方法可以返回多个参数。我要说得够多了。

使用参考参数：

```
void foo( int& result, int& other_result ); 
```

使用指针参数：

```
void foo( int* result, int* other_result ); 
```

这样做的好处是你必须`&`在呼叫站点做一个，可能会提醒人们这是一个外参数。

编写一个模板并使用它：

```
template<class T>
struct out {
  std::function<void(T)> target;
  out(T* t):target([t](T&& in){ if (t) *t = std::move(in); }) {}
  out(std::optional<T>* t):target([t](T&& in){ if (t) t->emplace(std::move(in)); }) {}
  out(std::aligned_storage_t<sizeof(T), alignof(T)>* t):
    target([t](T&& in){ ::new( (void*)t ) T(std::move(in)); } ) {}
  template<class...Args> // TODO: SFINAE enable_if test
  void emplace(Args&&...args) {
    target( T(std::forward<Args>(args)...) );
  }
  template<class X> // TODO: SFINAE enable_if test
  void operator=(X&&x){ emplace(std::forward<X>(x)); }
  template<class...Args> // TODO: SFINAE enable_if test
  void operator()(Args...&&args){ emplace(std::forward<Args>(args)...); }
}; 
```

那么我们可以这样做：

```
void foo( out<int> result, out<int> other_result ) 
```

一切都很好。 `foo`不再能够读取作为奖励传入的任何值。

定义可以放置数据的点的其他方法可用于构造`out`. 例如，在某处放置东西的回调。

我们可以返回一个结构：

```
struct foo_r { int result; int other_result; };
foo_r foo(); 
```

whick 在每个版本的 C++ 中都可以正常工作，在[c++17](/questions/tagged/c%2b%2b17 "显示标记为“c++17”的问题")中，这也允许：

```
auto&&[result, other_result]=foo(); 
```

零成本。由于有保证的省略，参数甚至不能移动。

我们可以返回一个`std::tuple`：

```
std::tuple<int, int> foo(); 
```

缺点是参数未命名。这允许[c++17](/questions/tagged/c%2b%2b17 "显示标记为“c++17”的问题")：

```
auto&&[result, other_result]=foo(); 
```

也是。在[c++17](/questions/tagged/c%2b%2b17 "显示标记为“c++17”的问题")之前，我们可以改为：

```
int result, other_result;
std::tie(result, other_result) = foo(); 
```

这有点尴尬。然而，保证省略在这里不起作用。

进入陌生领域（这是之后`out<>`！），我们可以使用延续传递风格：

```
void foo( std::function<void(int result, int other_result)> ); 
```

现在来电者这样做：

```
foo( [&](int result, int other_result) {
  /* code */
} ); 
```

这种风格的一个好处是您可以返回任意数量的值（具有统一类型）而无需管理内存：

```
void get_all_values( std::function<void(int)> value ) 
```

回调可能会被`value`调用 500 次`get_all_values( [&](int value){} )`。

对于纯粹的精神错乱，您甚至可以在延续上使用延续。

```
void foo( std::function<void(int, std::function<void(int)>)> result ); 
```

其用途如下：

```
foo( [&](int result, auto&& other){ other([&](int other){
  /* code */
}) }); 
```

`result`这将允许和之间的多一关系`other`。

再次使用统一值，我们可以这样做：

```
void foo( std::function< void(span<int>) > results ) 
```

在这里，我们用一系列结果调用回调。我们甚至可以反复这样做。

使用它，您可以拥有一个函数，该函数可以有效地传递数兆字节的数据，而无需在堆栈外进行任何分配。

```
void foo( std::function< void(span<int>) > results ) {
  int local_buffer[1024];
  std::size_t used = 0;
  auto send_data=[&]{
    if (!used) return;
    results({ local_buffer, used });
    used = 0;
  };
  auto add_datum=[&](int x){
    local_buffer[used] = x;
    ++used;
    if (used == 1024) send_data();
  };
  auto add_data=[&](gsl::span<int const> xs) {
    for (auto x:xs) add_datum(x);
  };
  for (int i = 0; i < 7+(1<<20); ++i) {
    add_datum(i);
  }
  send_data(); // any leftover
} 
```

现在，`std::function`这有点重，因为我们将在零开销无分配环境中执行此操作。所以我们想要一个[`function_view`](https://foonathan.net/blog/2017/01/20/function-ref-implementation.html)永远不会分配的。

另一种解决方案是：

```
std::function<void(std::function<void(int result, int other_result)>)> foo(int input); 
```

where 而不是接受回调并调用它，`foo`而是返回一个接受回调的函数。

```
foo(7)([&](int result, int other_result){ /* code */ }); 
```

这通过使用单独的括号将输出参数与输入参数分开。

使用`variant`和[c++20](/questions/tagged/c%2b%2b20 "显示标记为“c++20”的问题")协程，您可以`foo`生成返回类型（或只是返回类型）的变体的生成器。语法还没有固定，所以我不会举例。

在信号和槽的世界中，公开一组信号的函数：

```
template<class...Args>
struct broadcaster;

broadcaster<int, int> foo(); 
```

允许您创建一个`foo`异步工作并在完成时广播结果。

沿着这条线，我们有各种管道技术，其中一个函数不做某事，而是安排数据以某种方式连接，并且这些操作相对独立。

```
foo( int_source )( int_dest1, int_dest2 ); 
```

那么这个代码在有整数提供它之前不会*做*任何事情。`int_source`当它发生时，`int_dest1`并`int_dest2`开始接收结果。

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2008-11-26T17:39:31.023

在 C（以及 C++）标准中，使用(or ) 中的`div`,`ldiv`​​ （和，在 C99 中，`lldiv`) 函数返回结构是有先例的。`<stdlib.h>``<cstdlib>`

“返回值和返回参数的混合”通常是最不干净的。

让函数返回状态并通过返回参数返回数据在 C 中是明智的；在 C++ 中，您可以使用异常来传递故障信息，这显然不太明智。

如果有两个以上的返回值，那么类似结构的机制可能是最好的。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-11-26T17:43:48.110

使用结构或类作为返回值。使用`std::pair`现在可能有效，但是

1.  如果您稍后决定要返回更多信息，这是不灵活的；
2.  从函数在头文件中的声明中并不清楚返回的内容和顺序。

对于使用您的函数的任何人来说，返回具有自记录成员变量名称的结构可能不太容易出错。戴上我同事的帽子片刻，你的`divide_result`结构很容易让我，你的功能的潜在用户，在 2 秒后立即理解。弄乱输出参数或神秘的对和元组将需要更多时间来阅读，并且可能会被错误地使用。而且很可能即使在使用该函数几次之后，我仍然不记得参数的正确顺序。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-11-26T16:00:42.657

如果您的函数通过引用返回值，编译器在调用其他函数时无法将其存储在寄存器中，因为理论上，第一个函数可以将传递给它的变量的地址保存在全局可访问的变量中，并且任何后续调用的函数可能更改它，因此编译器将（1）在调用其他函数之前将寄存器中的值保存回内存，以及（2）在任何此类调用之后再次从内存中需要它时重新读取它。

如果您通过引用返回，您的程序优化将受到影响

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2015-02-04T10:41:40.840

在这里，我正在编写一个在 C++ 中返回多个值（超过两个值）的程序。该程序可在 c++14 (G++4.9.2) 中执行。程序就像一个计算器。

```
#  include <tuple>
# include <iostream>

using namespace std; 

tuple < int,int,int,int,int >   cal(int n1, int n2)
{
    return  make_tuple(n1/n2,n1%n2,n1+n2,n1-n2,n1*n2);
}

int main()
{
    int qut,rer,add,sub,mul,a,b;
    cin>>a>>b;
    tie(qut,rer,add,sub,mul)=cal(a,b);
    cout << "quotient= "<<qut<<endl;
    cout << "remainder= "<<rer<<endl;
    cout << "addition= "<<add<<endl;
    cout << "subtraction= "<<sub<<endl;
    cout << "multiplication= "<<mul<<endl;
    return 0;
} 
```

因此，您可以清楚地理解，通过这种方式，您可以从函数中返回多个值。使用 std::pair 只能返回 2 个值，而 std::tuple 可以返回两个以上的值。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-11-26T15:22:32.623

我倾向于在这样的函数中使用 out-vals，因为我坚持返回成功/错误代码的函数范式，并且我喜欢保持统一。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-11-26T15:20:59.443

替代方案包括数组、[生成器](http://en.wikipedia.org/wiki/Generator_(computer_science))和[控制反转](http://en.wikipedia.org/wiki/Inversion_of_Control)，但这里没有一个是合适的。

有些人（例如微软在历史上的 Win32 中）为了简单起见倾向于使用引用参数，因为很清楚谁分配以及它在堆栈上的外观，减少结构的扩散，并允许单独的成功返回值。

“纯”程序员更喜欢结构，假设它*是*函数值（就像这里的情况一样），而不是函数偶然触及的东西。如果你有一个更复杂的过程，或者有状态的东西，你可能会使用引用（假设你有理由不使用一个类）。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-11-26T15:40:18.780

我想说没有首选的方法，这完全取决于您要如何处理响应。如果结果将在进一步处理中一起使用，那么结构是有意义的，如果不是，我倾向于将其作为单独的引用传递，除非该函数将在复合语句中使用：

`x = divide( x, y, z ) + divide( a, b, c );`

我经常选择在参数列表中通过引用传递“输出结构”，而不是通过返回新结构的复制开销来传递（但这会让小东西出汗）。

`void divide(int dividend, int divisor, Answer &ans)`

out 参数是否令人困惑？作为引用发送的参数表明该值将发生变化（与 const 引用相反）。合理的命名也消除了混乱。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2014-11-21T10:20:21.140

为什么要坚持一个有多个返回值的函数？使用 OOP，您可以使用一个类，该类提供具有单个返回值和任意数量的附加“返回值”的常规函数​​，如下所示。优点是调用者可以选择查看额外的数据成员，但不需要这样做。这是复杂数据库或网络调用的首选方法，其中可能需要大量额外的返回信息以防发生错误。

为了回答您的原始问题，此示例具有返回商的方法，这是大多数调用者可能需要的，此外，在方法调用之后，您可以将余数作为数据成员。

```
class div{
   public:
      int remainder;

      int quotient(int dividend, int divisor){
         remainder = ...;
         return ...;
      }
}; 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2017-11-16T18:52:06.643

而不是返回多个值，只需返回其中一个值并在所需函数中引用其他值，例如：

```
int divide(int a,int b,int quo,int &rem) 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-11-26T15:43:39.057

对于从函数返回多个值的通用系统，Boost 元组将是我的首选。

可能的例子：

```
include "boost/tuple/tuple.hpp"

tuple <int,int> divide( int dividend,int divisor ) 

{
  return make_tuple(dividend / divisor,dividend % divisor )
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2015-10-20T11:02:58.837

我们可以这样声明函数，它返回一个结构类型的用户定义变量或指向它的指针。并且通过结构的性质，我们知道C中的结构可以保存多个非对称类型的值（即一个int变量，四个char变量，两个float变量等等……）

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2022-01-19T10:38:38.663

C ++ 17，使用`std::make_tuple`结构[化绑定](https://en.cppreference.com/w/cpp/language/structured_binding)并`auto`尽可能：

```
#include <tuple>

#include <string>
#include <cstring>

auto func() {
    // ...
    return std::make_tuple(1, 2.2, std::string("str"), "cstr");
}

int main() {
    auto [i, f, s, cs] = func();
    return i + f + s.length() + strlen(cs);
} 
```

有了`-O1`这个完全优化：[https](https://godbolt.org/z/133rT9Pcq)
`-O3` ://godbolt.org/z/133rT9Pcq只需要优化 std::string：[https ://godbolt.org/z/Mqbez73Kf](https://godbolt.org/z/Mqbez73Kf)

在这里：[https](https://godbolt.org/z/WWKvE3osv) ://godbolt.org/z/WWKvE3osv你可以看到 GCC 将所有返回的值一起存储在一块内存 ( `rdi+N`) 中，[POD](https://en.wikipedia.org/w/index.php?title=Plain_Old_Data_Structures)样式，证明没有性能损失。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-05-21T18:11:25.940

如果它只有几个返回值，我会通过引用来做，但对于更复杂的类型，你也可以这样做：

```
static struct SomeReturnType {int a,b,c; string str;} SomeFunction()
{
  return {1,2,3,string("hello world")}; // make sure you return values in the right order!
} 
```

如果它只是一个临时返回类型，则使用“静态”将返回类型的范围限制为此编译单元。

```
 SomeReturnType st = SomeFunction();
 cout << "a "   << st.a << endl;
 cout << "b "   << st.b << endl;
 cout << "c "   << st.c << endl;
 cout << "str " << st.str << endl; 
```

这绝对不是最漂亮的方法，但它会起作用。

* * *

## 回答 #22

> 赞同：-4
> 
> 时间：2020-10-03T18:17:02.530

快速回答：

```
#include <iostream>
using namespace std;

// different values of [operate] can return different number.
int yourFunction(int a, int b, int operate)
{
    a = 1;
    b = 2;

    if (operate== 1)
    {
        return a;
    }
    else
    {
        return b;
    }
}

int main()
{
    int a, b;

    a = yourFunction(a, b, 1); // get return 1
    b = yourFunction(a, b, 2); // get return 2

    return 0;
} 
```

# c# - 无法访问文件，因为它正被另一个进程使用

> ID：321077
> 
> 赞同：3
> 
> 时间：2008-11-26T15:21:22.923
> 
> 标签：c#, .net, exception-handling

我有一个 ASP.NET 程序，我正在使用 webClient 类的 DownloadFile 方法从 Web 下载文件，并对其进行一些修改。然后我将其保存到另一个具有唯一名称的文件夹中。当我收到此错误时

> 该进程无法访问文件“D:\RD\dotnet\abc\abcimageupload\images\TempStorage\tempImage.jpg”，因为它正被另一个进程使用

谁能告诉我如何解决这个问题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T15:44:31.347

一般来说，我认为你的代码应该是这样的。

```
WebClient wc = new WebClient();
wc.DownloadFile("http://stackoverflow.com/Content/Img/stackoverflow-logo-250.png", "Foo.png");
FileStream fooStream;
using (fooStream = new FileStream("foo.png", FileMode.Open))
{
    // do stuff
}
File.Move("foo.png", "foo2.png"); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-27T05:57:40.640

使用 SysInternals 的工具来跟踪哪些应用程序正在访问文件并导致此类问题，我取得了非常好的成功。

[Process Monitor](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)是您想要的工具 - 将其设置为将输出过滤为您感兴趣的文件夹中的文件，您将能够看到对该文件的每次访问。

无需猜测问题所在。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-25T02:17:32.600

尝试以下操作，将您的文件流设置为异步模式（第三个参数）

```
FileStream myStream = File.Create(fileName, results.Length,FileOptions.Asynchronous);
//make sure you close the file
myStream.Write(results, 0, results.Length);
myStream.Flush();
myStream.Close();
myStream.Dispose(); 
```

如果这失败重置你访问它的文件 b4 的属性

```
File.SetAttributes(Server.MapPath(sendFilepath), FileAttributes.Normal); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T15:23:34.680

您是否在进行更改后明确关闭文件流？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-17T20:00:28.737

我不知道这是否会解决你的问题..

写入文本文件然后尝试打开它时，我得到了完全相同的错误。

它是通过刷新写入器然后在写入文件后关闭它来解决的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-08T15:25:33.913

这可能会有所帮助....抱歉，它的 VB 不是 C，但嘿...

这有效

```
 Dim fs As FileStream = Nothing
    fs = File.Create("H:\test.txt")
    fs.Close()
    File.Delete("H:\test.txt") 
```

这不会，给出“文件正在被另一个进程使用”错误

```
 File.Create("H:\test.txt")
    File.Delete("H:\test.txt") 
```

# java - 如何在将使用 getResourceAsStream() 加载的 XML 文件中包含 DTD？

> ID：321081
> 
> 赞同：1
> 
> 时间：2008-11-26T15:22:03.810
> 
> 标签：java, xml, xerces

我有一个使用以下 DOCTYPE 定义 DTD 的 xml 文件（'videofaq.xml'）

```
<!DOCTYPE video-faq SYSTEM "videofaq.dtd"> 
```

我在 Servlet 初始化时从类路径（实际上是从 JAR）加载文件，使用：

```
getClass().getResourceAsStream("videofaq.xml") 
```

正确找到了 XML，但对于同一包中的 DTD，Xerces 给了我一个 FileNotFoundException，并显示 Tomcat 启动脚本的路径，并在末尾附加了“videofaq.dtd”。如果有的话，我可以将哪些提示传递给 Xerces 以使其正确加载 DTD？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T16:02:51.823

当你这样做

```
getClass().getResourceAsStream("videofaq.xml") 
```

您调用的不是 xerces，因此，当您将流提供给 xerces 时，它不知道文件是从哪里加载的。它从应用程序根路径（您已描述）加载它。

一个简单的解决方案是在 xml 文件中指定 dtd 的整个路径。

此外，xerces 似乎尝试了多个地方。因此，您应该查看语法缓存机制或实体解析器（我认为按此顺序使用）。

Xerces 语法文档：http: [//xerces.apache.org/xerces2-j/faq-grammars.html](http://xerces.apache.org/xerces2-j/faq-grammars.html)

Xerces 功能使用实体解析器2：http: [//xerces.apache.org/xerces2-j/features.html](http://xerces.apache.org/xerces2-j/features.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T14:11:13.363

自定义 EntityResolver 将起作用，但您可以通过设置 SystemID 以允许处理器“查找”相对路径来避免创建自定义类。

[http://www.onjava.com/pub/a/onjava/excerpt/java_xslt_ch5/index.html?page=5](http://www.onjava.com/pub/a/onjava/excerpt/java_xslt_ch5/index.html?page=5)

> 通过将系统标识符作为参数提供给 StreamSource，您可以告诉 XSLT 处理器在哪里查找 commonFooter.xslt。如果没有此参数，您可能会在处理器无法解析此 URI 时遇到错误。简单的解决方法是调用 setSystemId() 方法，如下所示：

```
// construct a Source that reads from an InputStream
Source mySrc = new StreamSource(anInputStream);
// specify a system ID (a String) so the 
// Source can resolve relative URLs
// that are encountered in XSLT stylesheets
mySrc.setSystemId(aSystemId); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T16:04:07.767

使用 SAX 时，您可以提供自己的`EntityResolver`，然后以您想要的任何方式加载资源。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T16:19:03.633

通常，在为 XML 解析器指定输入时，尝试使用采用 URL 的方法重载（通常作为带有参数名称的字符串，如“systemId”）。这允许解析器为您解析相对引用，并提供更好的错误消息。

因此，在您的情况下，将 DTD 与 videofaq.xml 放在同一包中，并将`String`结果传递`getClass().getResource("videofaq.xml")`给 XML 解析器。

# vb.net - 如何编写表单编辑器？

> ID：321095
> 
> 赞同：0
> 
> 时间：2008-11-26T15:27:23.800
> 
> 标签：vb.net, forms, layout, vb6, editor

我正在尝试在 VB6 或 VB.Net 中编写打印布局编辑器，并且正在寻找一些参考文章来帮助我入门。

这个想法是，编辑器将用于定义发票或报表布局的打印“区域”，允许用户绘制客户地址、发票编号、行、总计等的框。然后程序将弄清楚如何翻译各种盒子的尺寸和位置到打印位置以存储在布局定义文件中，稍后由帐户系统用于打印各种报告。请注意，由于各种原因（主要是帐户系统不是 Windows），将文本放入 Word 或类似产品并让它们打印文档不是一种选择。我当然可以手动编辑文档布局文件，但它不是很人性化。

正如您可能想象的那样，搜索“表单编辑器”、“布局编辑器”等会带来数百个不相关的结果。令人沮丧的是，我看过一篇非常相关的文章，却丢失了书签。

我希望有人有一些指示。

* * *

谢谢，这听起来比我想象的要复杂。我*真的*希望我能找到我丢失的原始文章，因为它很清楚如何在 vb.net 中进行此操作。

因为它是打印表单的布局，我认为这大大降低了复杂性 - 我只需要存储每个打印区域的大小和位置，以及字体、对齐和颜色信息，可能还有图形的文件名如果需要徽标。布局定义文件格式完全在我的控制之下。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T17:47:56.870

首先，您应该非常了解您正在使用的语言/API，事实上，您*确实*应该指定您是否正在使用 Windows.Forms、WPF、GTK# 等。确保您**非常**擅长那。

然后，您应该为表单编辑器考虑一种存储表单的格式。通常，表单编辑器使用 XML。如果您也想追随这种趋势，那么您**真的**应该学习一个好的 VB 的 XML API。

最后，仔细计划您的步骤：

1.  您想使用 API 提供的自定义文本字段控件，还是想手动绘制它们（如果是，那么您需要学习绘图 API）？
2.  确保您非常了解布局定义文件格式。

现在，是时候开始概念验证了：创建一个简单的编辑器，可以加载/保存表单并向它们添加按钮。这可能是最难弄清楚的一步。您可能需要处理事件和其他一些事情，但最终它会起作用（如果没有，那么您可能会再次询问）。最后，只需添加您需要的功能，例如布局定义文件输出、新控件、控件移动/调整大小等。

如果您需要其他任何东西（包括更具体的说明），请询问。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-07-11T15:39:26.353

我记得大约 10 年前 iirc 在 vb6 中开发了这种打印输出表单编辑器。不确定我是否仍然可以找到来源：确实我发现了这个问题，因为我需要编写另一个并且希望找到一些代码来开始，而不是再次从头开始。无论如何，我实现它的方式或多或少是这样的：

*   一个用于页面背景的自定义控件，显示一个光栅，并对鼠标事件做出反应（例如，在右键单击时显示一个菜单）；
*   每个字段都是一个无窗口的自定义控件，也显示一个光栅，每个（固定宽度）字符一个单元格。它还对鼠标事件做出反应，以便可以移动和调整大小；当我说无窗口时，我的意思是“没有 hwnd”，这是一种允许放置大量控制实例而不用担心对资源的影响的优化；如果您要使用 .net，您可以不在乎，但如果您使用 vb6，它确实会有所作为；
*   一个属性网格，如 vb6 中的一个，显示所选字段的属性。就我而言，我可以设置文本的样式（压缩、扩展、粗体）和运行时使用的表达式来检索要打印的值；
*   加载布局文件将调整页面大小并为文件中的每个字段实例化一个字段控件；
*   保存写出页面属性（大小，名称等）然后枚举字段集合并写出它们的属性；
*   我没有使用 xml，因为文件格式已经固定，因为它是由执行实际打印的引擎使用的；xml 只会让我的生活更轻松，无需为数据文件格式编写自定义解析器。
*   要求仅处理点阵打印机，但幸运的是我没有偷工减料，我可以轻松地对其进行调整，以处理更精确的区域放置和尺寸。我的意思很简单，我抵制了使用行和列坐标的诱惑，而是使用了缇；数学需要更多的思考，但绝对不是火箭科学。

总而言之，做起来并不难，而且效果很好，有点像“水晶报表”的表单编辑器。
我记得花了一些时间来获得正确的细节，例如网格捕捉不同的字符宽度，在更改文本样式（如压缩或扩展）时调整字段大小，而不会因为舍入错误而跳来跳去，诸如此类。不要让这吓到你，记住你不必从一开始就照顾好一切，只是要小心一点，不要阻止以后做的可能性。

现在我不会对 vb6 提供太多建议，除非这是你最了解的并且需要生成一个 .exe 而不依赖于目标机器上安装的 .net 框架。
相反，如果您选择使用 .net，我认为如果您还不了解 wpf，这将是一个学习 wpf 的好机会，它可以制作一些令人印象深刻的图形，甚至比 windows.forms 还要多。

# c# - C#.NET 中是否保证数组列表的顺序？

> ID：321096
> 
> 赞同：19
> 
> 时间：2008-11-26T15:27:48.573
> 
> 标签：c#, .net, arraylist

如果我在 C#.NET 中使用 ArrayList，是否保证顺序与我添加项目的顺序相同？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-11-26T15:29:47.647

是的，元素总是被添加到末尾（除非您另外指定，例如调用[Insert](http://msdn.microsoft.com/en-us/library/system.collections.arraylist.insert.aspx)）。换句话说，如果你这样做：

```
int size = list.Count;
int index = list.Add(element);
Assert.AreEqual(size, index); // Element is always added at the end
Assert.AreEqual(element, list[index]); // Returned index is position in list 
```

当然，如果您删除任何较早的元素或在其前面插入新元素，该位置将会改变。

您是否有充分的理由使用`ArrayList`而不是`List<T>`顺便说一句？非通用集合是*如此*2003...

（顺便说一下，订单也很稳定`List<T>`。）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-26T15:29:40.550

是的，除非您的某些代码通过交换等方式更改了顺序。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-26T15:32:16.363

是的。因为它存储为数组。

其他属性是

*   保证订单
*   随机访问。您可以通过 O(1) 中的索引访问任何元素
*   在开头和中间缓慢插入和删除。
*   未分类。（使用快速排序或类似的排序应该花费 O(n log n)）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-26T15:29:54.387

是的。[傻回答长度限制]

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T15:30:47.507

当您将项目添加到 ArrayList 时，该项目将始终保留在该索引处。当然，除非你改变它。

（框架可能会重新排列内存，但您的索引将始终保持不变）

# installation - 使用 Installshield 和用户对话框卸载 MSI 时的特权提升

> ID：321098
> 
> 赞同：4
> 
> 时间：2008-11-26T15:27:59.697
> 
> 标签：installation, windows-installer, installshield, uninstallation

我需要实现以下目标： MSI 的卸载应该显示一个用户对话框，基于该对话框 Windows Installer 知道如何准确删除软件（在这种情况下：用户必须选择是否也删除数据库）。

运行时，卸载过程也会触发自定义操作。所有这些操作都需要管理权限。

所以我需要让“程序和功能”在“删除”上显示完整的 UI，或者在点击“更改”然后删除时显示管理权限的身份验证对话框。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-03T10:21:51.747

**以供参考：**

添加和删​​除程序 (ARP)，分别。程序和功能（在 Vista+ 上），仅在删除时显示基本 UI。显示对话框需要完整的 UI。结果：此处无法进行用户交互。

**解决方案：**

如果除了显示删除对话框之外别无他法，则需要禁用删除，并且必须通过显示完整 UI 的更改选项触发删除过程。

**附加信息：**

如果涉及需要提升权限的自定义操作，则需要在系统上下文中将它们配置为延迟。这将使安装程序在进入执行序列时提升权限，从而显示需要管理权限的 UAC 对话框。

# drupal - 如何在部署期间保持数据同步？

> ID：321106
> 
> 赞同：6
> 
> 时间：2008-11-26T15:30:14.073
> 
> 标签：drupal, deployment, drupal-database

我有机会使用开发、登台和生产环境来制作 Drupal 网站。使用 subversion 使代码在站点之间保持同步是一项简单的任务。不那么简单的是在安装之间传播对数据库数据（不仅仅是模式）的更改。

任何 Drupal 开发人员都会熟悉这样做的原因。Drupal 将某些配置设置存储在数据库中，特别是与 CCK 字段、视图和其他允许使用管理界面进行动态设置的模块相关。简单地同步模式是不够的 - 数据中还包含基本信息。

我正在寻找一种同步这些数据库更改的方法，这样如果开发人员在登台服务器上进行 CCK 字段更改，它们可以传播到本地开发环境以进行更多工作，并最终传播到生产环境。

有没有工具可以做到这一点？您在这样的项目中处理单个或多个开发人员的流程是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-26T15:38:02.733

对于基本数据同步：我每晚使用 mysqldump 将所有数据转储到 .sql 文件中。然后该脚本将其签入版本控制系统。这是在一个简单的 bash 脚本中完成的，但您几乎可以在任何平台上执行类似的操作......

我只是进一步阅读，我不确定我的方法是否会有所帮助。我从来不需要合并 SQL 转储，所以我无法评论它的管理效率。

虽然您应该能够将更改（架构、新数据）推送到登台/生产服务器，但将更改拉回开发服务器可能会更麻烦。正如我所说 - 合并可能会也可能不会。我只是不知道。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T17:46:03.053

在这里，我们几乎将 CCK 降级为用于原型和简单节点类型。尝试将数据库中的“配置”与“内容”分开是不值得的。您可以通过各种方式尝试保持同步，但简而言之，除非它在一个文件中或让您可以选择导出到一个文件，否则您会受到伤害。（作为额外的奖励，将视图导出到文件会比每次使用时将其从数据库中拉出要快一点。）

您提到了 Dev、Staging 和 Live 服务器——如果您有开发人员在 Staging 中进行未记录的更改，那么您就完蛋了。如果您定期将 Staging 与 Live 同步并强制执行（常识）策略，即对 Staging 所做的唯一更改是在 Dev 中解决的事情并且在转移到 Live 之前正在测试，那么您可能会取得更大的成功。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T09:21:08.047

我试图在另一个问题中回答我是如何做到这一点的。我也会在这里发布

我认为这里的一个好策略是使用安装配置文件 API。使用安装配置文件 API，您可以完成使用 Drupal 管理工具所做的大多数事情。大多数核心表单只是在变量表中设置变量。为了能够明智地对非内容数据库内容（即配置）进行版本控制，明智的做法是使用更新功能。

在我的网站上，我们有一个模块“ec”，除了它的 ec.install 文件包含更新功能，例如 ec_update_6001()

您的主要安装功能可以负责在您进行的任何新安装上实际运行更新，以使您的模块保持最新。

```
function ec_install() {
  $ret = array();
  $num = 0;
  while (1) {
   $version = 6000 + $num;
   $funcname = 'ec_update_' . $version;
   if (function_exists($funcname)) {
     $ret[] = $funcname();
     $num++;
   } else {
     break;
   }
  }
return $ret;
} 
```

现在跟随我们实际文件中的一个或两个示例更新函数

```
// Create editor role and set permissions for comment module
function ec_update_6000() {
  install_include(array('user'));
  $editor_rid = install_add_role('editor');
  install_add_permissions(DRUPAL_ANONYMOUS_RID, array('access comments'));
  install_add_permissions(DRUPAL_AUTHENTICATED_RID, array('access comments', 'post comments', 'post comments without approval'));
  install_add_permissions($editor_rid, array('administer comments', 'administer nodes'));
  return array();
}
// Enable the pirc theme.
function ec_update_6001() {
  install_include(array('system'));
  // TODO: line below is not working due to a bug in Install Profile API. See http://drupal.org/node/316789.
  install_enable_theme('pirc');
  return array();
}

// Add the content types for article and mtblog
function ec_update_6002() {
  install_include(array('node'));
  $props = array(
    'description' => 'Historical Movable Type blog entries',
  );
  install_create_content_type('mtblog', 'MT Blog entry', $props);
  $props = array(
    'description' => 'Article',
  );
install_create_content_type('article', 'Article', $props);
return array();
} 
```

实际上，这主要解决了数据库和 Drupal 代码的版本控制问题。我们广泛使用它。它允许我们推广更改数据库配置的新代码，而无需重新导入数据库或进行实时更改。这也意味着我们可以正确地测试版本，而不必担心隐藏的数据库更改。

最后 cck 和 views 支持这种方法。请参阅此代码段

```
// Enable CCK modules, add CCK types for Articles in prep for first stage of migration,
// enable body for article, enable migration modules.
function ec_update_6023() {
  $ret = array();
  drupal_install_modules(array('content', 'content_copy', 'text', 'number', 'optionwidgets'));
  install_include(array('content', 'content_copy'));
  install_content_copy_import_from_file(drupal_get_path('module', 'ec') . '/' . 'article.type', 'article');
  $sql = "UPDATE {node_type} SET body_label='Body', has_body=1
  WHERE type = 'article'";
  $ret[] = update_sql($sql);
  return $ret;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T15:53:29.363

使用数据库版本控制系统。为此，您需要数据库中的 VersionInfo 表以及 xml 格式的所有 sql ddl 和 dml 查询以及版本信息。现在您只需一个简单的 .net 工具，它将检查 VersionInfo 表并运行来自 xml 的所有查询，这些查询是在该版本之后添加的，并将版本更新为 versionInfo 中的当前版本。

# asp.net-mvc - ASP-MVC 表单身份验证 - cookie 不持久

> ID：321109
> 
> 赞同：1
> 
> 时间：2008-11-26T15:31:03.933
> 
> 标签：asp.net-mvc, authentication, cookies

我有我自己的 linq to sql 数据库，它有一个很好的登录方法，它给了我一个用户。

我已经按照网络上的 101 个示例了解如何将 cookie 添加到客户端。

```
 FormsAuthenticationTicket ticket = new FormsAuthenticationTicket(
                1,
                _u.id.ToString(), 
                DateTime.Now, 
                DateTime.Now.AddDays(14), 
                true, 
                "hi", 
                FormsAuthentication.FormsCookiePath);

        string hash = FormsAuthentication.Encrypt(ticket);

        HttpCookie cookie = new HttpCookie(FormsAuthentication.FormsCookieName, hash);   

        if (ticket.IsPersistent) cookie.Expires = ticket.Expiration;

        //Response.Cookies.Add(cookie);

        //FormsAuthentication.RedirectFromLoginPage(_u.name, _remember);
        FormsAuthentication.SetAuthCookie(_u.name, _remember); 
```

果然，它确实被添加了。但是当我检查它时，它的到期时间是会话结束，而不是指定的两周。因此，当用户在关闭浏览器后试图返回该站点时，他们必须登录。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T17:08:52.847

这个特殊错误是因为我将浏览器设置为在关闭时删除 cookie。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2012-08-01T01:08:46.923

我有同样的问题，我在登录时解决 Page_Load
首先验证 User.Identity 是否正确
，如果我们有一个有效的用户！！！。
如果 false 删除旧 cookie（请参阅此链接[http://forums.asp.net/t/1227365.aspx/1](http://forums.asp.net/t/1227365.aspx/1)）
**，最后一部分是为了防止新 cookie 无法正确保存。**

# selenium - 从 Java 进程运行 Selenium

> ID：321112
> 
> 赞同：2
> 
> 时间：2008-11-26T15:32:39.157
> 
> 标签：selenium, java

您将如何从 Java 进程运行 Selenium 进程（线程），这样我就不必手动启动 Selenium？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-26T16:08:52.577

服务器：

```
import org.openqa.selenium.server.SeleniumServer;
public class SeleniumServerControl {
  private static final SeleniumServerControl instance = new SeleniumServerControl();
  public static SeleniumServerControl getInstance() {
    return instance;
  }
  private SeleniumServer server = null;
  protected SeleniumServerControl() {
  }
  public void startSeleniumServer() {
    if (server == null) {
      try {
        server = new SeleniumServer(SeleniumServer.DEFAULT_PORT);
        System.out.println(" selenium server " + server.toString());
      } catch (Exception e) {
        System.err.println("Could not create Selenium Server because of: "
            + e.getMessage());
        e.printStackTrace();
      }
    }
    try {
      server.start();
    } catch (Exception e) {
      System.err.println("Could not start Selenium Server because of: "
          + e.getMessage());
      e.printStackTrace();
    }
  }
  public void stopSeleniumServer() {
    if (server != null) {
      try {
        server.stop();
        server = null;
      } catch (Exception e) {
        System.err.println("Could not stop Selenium Server because of: "
            + e.getMessage());
        e.printStackTrace();
      }
    }
  }
} 
```

客户端：

```
browser = new DefaultSelenium("localhost", 4444, "*firefox", "http://www.google.com");
browser.start(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-09-15T12:42:11.870

您还可以使用一些其他设置：

```
 RemoteControlConfiguration settings = new RemoteControlConfiguration();
    File f = new File("/home/user/.mozilla/firefox/default");
    settings.setFirefoxProfileTemplate(f);
    settings.setReuseBrowserSessions(true);
    settings.setSingleWindow(true);
    if (this.ServerWorks == false)
    {
        try
        {
            server = new SeleniumServer(settings);
            server.start();
            this.ServerWorks = true;
        } catch (Exception e)
        {
            e.printStackTrace();
        }
    } 
```

# javascript - 如何在 JavaScript 函数调用中预设参数？（部分功能应用）

> ID：321113
> 
> 赞同：53
> 
> 时间：2008-11-26T15:33:10.590
> 
> 标签：javascript, functional-programming

我正在尝试编写一个 JavaScript 函数，该函数将返回其第一个参数（函数）及其所有其余参数作为该函数的预设参数。

所以：

```
函数输出（a，b）{
    document.write(a + " " + b);
}

函数设置器（...）{...}

二传手（出，“你好”）（“世界”）；
设置器（出，“你好”，“世界”）（）；

```

将输出“hello world”两次。对于 setter 的一些实现

我在第一次尝试时遇到了操纵参数数组的问题，但似乎有更好的方法来做到这一点。

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2008-11-26T17:39:12.253

首先，你需要一个部分 -[**部分和咖喱之间有区别**](https://stackoverflow.com/questions/218025/what-is-the-difference-between-currying-and-partial-application)- 这就是你所需要*的，没有框架*：

```
function partial(func /*, 0..n args */) {
  var args = Array.prototype.slice.call(arguments, 1);
  return function() {
    var allArguments = args.concat(Array.prototype.slice.call(arguments));
    return func.apply(this, allArguments);
  };
} 
```

现在，使用您的示例，您可以完全按照您的要求做：

```
partial(out, "hello")("world");
partial(out, "hello", "world")();

// and here is my own extended example
var sayHelloTo = partial(out, "Hello");
sayHelloTo("World");
sayHelloTo("Alex"); 
```

该`partial()`函数可用于实现，但*不是*柯里化。[**这是一篇关于差异的博客文章**](http://www.uncarved.com/blog/not_currying.mrk)的引述：

> 在部分应用程序接受一个函数并从中构建一个接受较少参数的函数的情况下，currying 通过组合每个接受一个参数的函数来构建接受多个参数的函数。

希望有帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T15:38:31.810

[咖喱 javascript](http://www.crockford.com/javascript/www_svendtofte_com/code/curried_javascript/index.html)是你要找的吗？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-12-15T06:29:53.120

使用 Javascript 的`apply()`，您可以修改`function prototype`

```
Function.prototype.pass = function() {
    var args = arguments,
        func = this;
    return function() {
        func.apply(this, args);
    }
}; 
```

然后您可以将其称为`out.pass('hello','world')`

`apply`为第二个参数/参数获取一个数组。

`arguments`是函数内部可用的属性，该函数包含数组结构中的所有参数。

另一种常见的方法是使用`bind`

`loadedFunc = func.bind(this, v1, v2, v3);`

然后

`loadedFunc() === this.func(v1,v2,v3);`

这样就够了，虽然有点丑。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-26T16:21:02.663

如果您使用 Dojo，您只需调用 dojo.hitch() 即可，它几乎完全符合您的要求。几乎——因为它也可以用来打包上下文。但你的例子是第一个：

```
dojo.hitch(out, "hello")("world");
dojo.hitch(out, "hello", "world")(); 
```

也：

```
var A = {
  sep: ", ",
  out: function(a, b){ console.log(a + this.sep + b); }
};

// using functions in context    
dojo.hitch(A, A.out, "hello")("world");
dojo.hitch(A, A.out, "hello", "world")();

// using names in context
dojo.hitch(A, "out", "hello")("world");
dojo.hitch(A, "out", "hello", "world")(); 
```

dojo.hitch() 是 Dojo Base 的一部分，所以只要你包含 dojo.js，它就在那里。

dojox.lang.functional.curry 模块中提供了另一个通用工具（[在 JavaScript with Dojo 中的 Functional fun 中](http://lazutkin.com/blog/2008/jan/12/functional-fun-javascript-dojo/)记录了— 只需在此页面上查找“curry”）。具体来说，您可能想查看 curry() 和 partial()。

curry() 累积参数（如您的示例中），但有一个区别：一旦满足 arity ，它就会调用返回值的函数。实施您的示例：

```
df.curry(out)("hello")("world");
df.curry(out)("hello", "world"); 
```

请注意，最后一行末尾没有“()”——它是自动调用的。

partial() 允许随机替换参数：

```
df.partial(out, df.arg, "world")("hello"); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-06-18T21:32:35.123

你可以用[`Function.prototype.bind()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind)这个。这是 ES5 的补充。

除了设置函数的上下文（`this`值）的常见用例之外，它还可以设置部分参数。

```
function out(a, b) {
  document.write(a + " " + b);
}

function setter(func) {
  return func.bind.apply(func, [window].concat([].slice.call(arguments).slice(1)));
}

setter(out, "hello")("world");
setter(out, "hello", "world")();
```

我的`setter`功能其实很简单。最长的部分只是获取参数列表。我将像这样分解代码：

```
func.bind.apply(func, [window].concat([].slice.call(arguments).slice(1)))
func.bind.apply(                                                        )  // need to use apply to pass multiple arguments as an array to bind()
                func,                                                      // apply needs a context to be run in
                      [window].concat(                                 )   // pass an array of arguments to bind(), starting with window, to be the global context
                                      [].slice.call(arguments).slice(1)    // convert the arguments list to an array, and chop off the initial value 
```

[这些浏览器](http://kangax.github.io/compat-table/es5/#Function.prototype.bind)支持它：Chrome 7+、Firefox 4+、IE9+。MDN（在开头链接）虽然有一个 polyfill。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-02-03T10:19:49.507

无需立即调用函数（例如等待用户确认时）即可实现参数预设的简单方法是将函数“装扮”在另一个匿名函数中。

代替：`exportFile(docType)`

做：`function(){ return exportFile(docType) }`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-26T17:00:03.863

** 编辑：见 Jason Bunting 的回复。这个答案实际上显示了一种链接多个输出调用的低于标准的方式，而不是一个带有某些参数预设的输出调用。如果这个答案确实有助于解决类似的问题，那么您应该确保按照 Jason 的建议使用 apply 和 call，而不是我想出的使用 eval 的晦涩方式。**

嗯......你的输出实际上会在其中写很多“未定义”......但这应该接近你想要的：

```
function out(a, b) {
    document.write(a + " " + b);
}

function getArgString( args, start ) {
    var argStr = "";
    for( var i = start; i < args.length; i++ ) {
        if( argStr != "" ) {
            argStr = argStr + ", ";
        }
        argStr = argStr + "arguments[" + i + "]"
    }
    return argStr;
}

function setter(func) {
    var argStr = getArgString( arguments, 1 );
    eval( "func( " + argStr + ");" );
    var newSettter = function() {
        var argStr = getArgString( arguments, 0 );
        if( argStr == "" ) {
            argStr = "func";
        } else {
            argStr = "func, " + argStr;
        }
        return eval( "setter( " + argStr + ");" );
    }
    return newSettter;
}

setter(out, "hello")("world");
setter(out, "hello", "world")(); 
```

不过，我可能会将 getArgString 中的代码移动到 setter 函数本身中……因为我使用了“eval”，所以更安全一些。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-07-04T17:18:19.967

使用闭包是另一种选择。使用返回其他函数的函数！

# eclipse - eclipse中终止调试/运行的捷径是什么？

> ID：321118
> 
> 赞同：48
> 
> 时间：2008-11-26T15:34:05.847
> 
> 标签：eclipse, keyboard-shortcuts

eclipse中终止调试/运行的快捷方式是什么？在 Preferences -> Keys 下查看`Ctrl`+`F2`但它不起作用。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2011-06-22T16:42:41.680

转到首选项 -> 常规 -> 键

找到“终止”将您的绑定设置为您想要的任何内容（在我的情况下`F12`）。

然后将“When”从“Debugging”更改为“Editing Java Source”。

现在为我工作。

Going to Customize Perspective 只向我展示了我已经拥有的绑定，而不是让我设置它们。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-26T15:41:51.680

[如此处](http://dev.eclipse.org/newslists/news.eclipse.newcomer/msg21758.html)所述，您可以使用
`Window / Customize Perspective > Commands`.
（选择“调试”组）

然后在 Java 透视图中打开 Debug 视图（可能是 Fast 视图），您应该会得到 Terminate 键绑定。

我想它不起作用，因为您在非调试会话中尝试了它。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-11-12T17:37:32.980

好吧，这是一个公认的蹩脚的答案，但这里有。`CTRL`+`F2`对我不起作用（从任何角度来看）。我不知道为什么。我正在运行 3.5.2

所以我打了`Alt`, `R`, `T`, `Enter`.

`Alt`, 以进入顶部菜单栏。`R`, 选择运行菜单。`T`, 选择终止。最后，`enter`实际调用它。这真的没那么糟糕。瘸？是的。比鼠标点击还快？当然。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-07-06T04:37:30.133

在您的透视图中打开一个调试视图（`Alt`+ `Shift`+ `Q`，`Q`-> 查找调试）。应用程序运行后，使用`CTRL`+ `F7`（在 Mac 上为`Command`+ `F7`）切换到调试视图，按下以突出显示已启动的应用程序，并触发终止快捷方式

参考[这个](https://stackoverflow.com/a/321150/179630)答案，我认为它并非一直有效，因为根据运行的内容，eclipse 可能不会将“终止”命令注册为可用。

例如，当我使用 maven（m2e 插件）运行我的项目时，控制台视图上的终止按钮可用，但菜单上不可用。请参阅下面的屏幕截图（我使用了基于 eclipse indigo 的 Springsource Tools Suite 2.9.2 和 m2e 1.0.200）

![运行 maven 时，控制台视图终止按钮可用但不在运行菜单上](https://i.stack.imgur.com/2fFIe.png)

这是因为在调试视图中默认情况下未选择启动的应用程序。

这个问题在 Eclipse 论坛主题[这里讨论。](http://www.eclipse.org/forums/index.php/mv/msg/92972/286069/#msg_286069)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-12-27T13:58:24.887

阅读所有这些，但没有找到简单的方法。所以，我拼凑了一个[非常简单的插件](https://bitbucket.org/mantis78/relaunch-plugin/wiki/Home)。

希望它对其他人也有帮助。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-10-04T13:47:12.363

在窗口选项卡中，您可以看到快捷方式：

[![在此处输入图像描述](https://i.stack.imgur.com/mZ4hM.png)](https://i.stack.imgur.com/mZ4hM.png)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-05-31T15:53:04.027

F2 可能已经被您的操作系统使用，它可以在 Eclipse 获得机会之前拦截击键。

在 Mac 上，F2 键通常用于增加屏幕亮度。这将优先于 Eclipse 为其分配的任何内容。翻译：当您在某些 Mac 上按 F2 时（取决于您的设置），您的屏幕会（尝试）变亮，而 Eclipse 什么也不做。

希望有帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-01-09T10:06:59.390

我也遇到了这个问题，但仍然没有找到合适的解决方案。

显然，因为多个用户程序实例可以一起运行，所以它们（eclipse 开发人员）只是没有放置通用终止键。

正如我刚刚在他们的错误部分看到的那样，他们（可能）正在显示一个对话框，用于在单击终止按钮时选择要终止的正在运行的程序（默认情况下可能是 Ctrl+F2）。

您可以查看此问题的[错误页面](https://bugs.eclipse.org/bugs/show_bug.cgi?id=515316)以获取更多详细信息和更新。希望它可以帮助任何人。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-04-26T17:44:33.617

上面的很多答案对某些人有用，但可能不是每个人。正如 Scott Biggs 提到的，command-F2 可能在 mac 上不起作用（请注意，要在 mac 上获取 F2，您还需要按住 fn 键），因此您可以将绑定重置为 shift-F2。只要您在调试，就为我工作。

# svn - 分叉颠覆项目

> ID：321125
> 
> 赞同：8
> 
> 时间：2008-11-26T15:37:36.447
> 
> 标签：svn, version-control, project-management

我以前从未分叉过一个项目，所以我对如何进行有点困惑。我有一个我自己使用的项目，我作为 BSD 许可项目（项目 A）发布。在工作中，我想使用该代码，但对我们公司（项目 B）进行了特定的修改，但我希望仍然能够使用来自我发布的基本代码的功能进行更新。

在不覆盖我对项目 B 所做的修改的情况下，处理项目的两个分支并将项目 A 的更改合并到项目 B 中的最佳方法是什么？

* * *

它被分成两个实体，我在谷歌代码上的主要仓库，然后是我们自己内部仓库中的公司版本。我的问题是在从一个版本升级到另一个版本时保持一切正常，但要保持自定义修改。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T19:03:38.403

请参阅前面提到[的 The Subversion Book 中讨论“供应商分支”](http://svnbook.red-bean.com/en/1.1/ch07s05.html)的部分。这将讨论如何处理外部子项目，以便您可以在更新外部项目时合并更改并合并您自己的本地修改。

如果您将项目的公共版本（托管在 Google 代码上）视为公司代码中的外部依赖项，这种方法应该会很好用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T15:50:34.610

在 Subversion 中，“forking”是“branching”，“I​​ncorporating changes”是“merging”。

如果不仔细阅读[The Subversion 书](http://svnbook.red-bean.com/)的相关部分，我认为您将无法逃脱。一旦你投入时间，它就会写得很清楚并且很容易理解。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T15:57:52.163

除非 Work 愿意将这些修改发布回原始项目，否则我将在那里启动一个全新的 SVN 项目（项目 B）。然后，随着您进入 BSD 许可项目（项目 A）的下一个版本，您可以从上一个版本中创建更改集，然后将它们应用回项目 B。

它可能看起来像多重人格障碍，但您必须根据您所在的位置（单词或家庭）充当两个不同的实体。

另一方面，IFF 愿意将这些修改发布回原始项目，那么您更好的选择是创建一个分支并将您对项目 A 的更改合并到 Projet B（定期）。

# sql - 如何为我的数据创建交叉引用表/查询？

> ID：321127
> 
> 赞同：2
> 
> 时间：2008-11-26T15:37:38.427
> 
> 标签：sql, database-design, cross-reference

我的数据库中有两个简单的表。一个“卡片”表包含卡片的 ID、名称和文本，以及一个包含卡片 ID 和详细说明卡片规则的文本的“规则”表。

在裁决文本中，经常有对数据库中另一张卡片的引用。在文本中很容易找到这一点，因为每张卡片都包含在文本的引号中。在裁决文本中引用多张卡片的情况并不少见。

我想做的是能够创建一个交叉引用表（或程序，如果它足够有效的话），这样当我提交卡片查询时，我可以找到所有直接引用卡片的裁决记录通过识别并获取文本中引用卡片名称的所有裁决记录。

解决这个问题的最佳方法是什么？我的环境是 SQL 2005，但任何类型的“与数据库无关”的解决方案在这里都被广泛接受。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T15:57:59.073

这似乎是一个相当简单和常见的关系问题，可以通过交叉引用表来解决。例如：

```
CREATE TABLE dbo.Cards (
    id        INT            NOT NULL,
    name      VARCHAR(50)    NOT NULL,
    card_text VARCHAR(4000)  NOT NULL,
    CONSTRAINT PK_Cards PRIMARY KEY CLUSTERED (id)
)
GO
CREATE TABLE dbo.Card_Rulings (
    card_id        INT            NOT NULL,
    ruling_number  INT            NOT NULL,
    ruling_text    VARCHAR(4000)  NOT NULL,
    CONSTRAINT PK_Card_Rulings PRIMARY KEY CLUSTERED (card_id, ruling_number)
)
GO
CREATE TABLE dbo.Card_Ruling_Referenced_Cards (
    parent_card_id    INT    NOT NULL,
    ruling_number     INT    NOT NULL,
    child_card_id     INT    NOT NULL,
    CONSTRAINT PK_Card_Ruling_Referenced_Cards PRIMARY KEY CLUSTERED (parent_card_id, ruling_number, child_card_id)
)
GO
ALTER TABLE dbo.Card_Rulings
ADD CONSTRAINT FK_CardRulings_Cards FOREIGN KEY (card_id) REFERENCES dbo.Cards(id)
GO
ALTER TABLE dbo.Card_Ruling_Referenced_Cards
ADD CONSTRAINT FK_CardRulingReferencedCards_CardRulings FOREIGN KEY (parent_card_id, ruling_number) REFERENCES dbo.Card_Rulings (card_id, ruling_number)
GO
ALTER TABLE dbo.Card_Ruling_Referenced_Cards
ADD CONSTRAINT FK_CardRulingReferencedCards_Cards FOREIGN KEY (child_card_id) REFERENCES dbo.Cards(id)
GO 
```

要获得一张卡片的所有卡片规则：

```
SELECT *
FROM dbo.Cards C
INNER JOIN dbo.Card_Rulings CR ON CR.card_id = C.id
WHERE C.id = @card_id 
```

要获取给定卡在裁决中引用的所有卡：

```
SELECT C.*
FROM dbo.Card_Rulings CR
INNER JOIN dbo.Card_Ruling_Referenced_Cards CRRC ON CRRC.parent_card_id = CR.card_id
INNER JOIN dbo.Cards C ON C.id = CRRC.child_card_id
WHERE CR.card_id = @card_id 
```

这完全是我的想法，没有经过测试，因此可能存在语法错误等。

您的前端将负责维护引用。这可能是可取的，因为它避免了有人忘记在规则文本中的卡名周围加上引号等问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T15:55:57.407

我建议您创建另一个表来存储您的引用。然后，创建一个维护该表的插入和更新触发器。这样，您将有一个更快的查询来返回您正在寻找的数据。

我认识到最初填充此表可能有点困难，这就是为什么我在下面显示一些示例数据（和查询），您可以使用它们来帮助您入门。

```
Declare @Card Table(Id Int, Name VarChar(20), CardText VarChar(8000))

Declare @Ruling Table(CardId Int, CardRuling VarChar(8000))

Insert Into @Card Values(1, 'Card 1', 'This is the card ID = 1')
Insert Into @Card Values(2, 'Card 2', 'This is the card id = 2.')
Insert Into @Card Values(3, 'Card 3', 'This is the card id = 3.')

Insert Into @Ruling Values(1, 'This is the ruling for 1 which references "2"')
Insert Into @Ruling Values(2, 'This is the ruling for 2 which references nothing')
Insert Into @Ruling Values(3, 'This is the ruling for 3 which references "1" and "2"')

Declare @CardId Int
Set @CardId = 1

Select  * 
From    @Card As Card
        Inner Join @Ruling As Ruling
            On Card.Id = Ruling.CardId
        Left Join @Card As CardReferences
            On Ruling.CardRuling Like '%"' + Convert(VarChar(10), CardReferences.Id) + '"%' 
```

编辑：

我建议另一个表的原因是因为您可能会对这个查询的性能感到失望，尤其是对于大型表。

# .net - 如何使用 VB.NET 打开受密码保护的共享网络文件夹？

> ID：321128
> 
> 赞同：8
> 
> 时间：2008-11-26T15:37:40.910
> 
> 标签：.net, vb.net, networking

我需要在网络上打开一个受密码保护的共享文件夹才能访问 Access 97 数据库。如何打开文件夹并输入密码？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-27T12:46:20.177

在这里找到[http://www.mredkj.com/vbnet/vbnetmapdrive.html](http://www.mredkj.com/vbnet/vbnetmapdrive.html)

```
Public Declare Function WNetAddConnection2 Lib "mpr.dll" Alias "WNetAddConnection2A" _
( ByRef lpNetResource As NETRESOURCE, ByVal lpPassword As String, _
  ByVal lpUserName As String, ByVal dwFlags As Integer) As Integer

 Public Declare Function WNetCancelConnection2 Lib "mpr" Alias   "WNetCancelConnection2A" _
    (ByVal lpName As String, ByVal dwFlags As Integer, ByVal fForce As Integer) As Integer

    <StructLayout(LayoutKind.Sequential)> _
Public Structure NETRESOURCE
        Public dwScope As Integer
        Public dwType As Integer
        Public dwDisplayType As Integer
        Public dwUsage As Integer
        Public lpLocalName As String
        Public lpRemoteName As String
        Public lpComment As String
        Public lpProvider As String
    End Structure

Public Const ForceDisconnect As Integer = 1
Public Const RESOURCETYPE_DISK As Long = &H1

Public Function MapDrive(ByVal DriveLetter As String, ByVal UNCPath As String) As Boolean

        Dim nr As NETRESOURCE
        Dim strUsername As String
        Dim strPassword As String

        nr = New NETRESOURCE
        nr.lpRemoteName = UNCPath
        nr.lpLocalName = DriveLetter & ":"
        strUsername = Nothing '(add parameters to pass this if necessary)
        strPassword = Nothing '(add parameters to pass this if necessary)
        nr.dwType = RESOURCETYPE_DISK

        Dim result As Integer
        result = WNetAddConnection2(nr, strPassword, strUsername, 0)

        If result = 0 Then
            Return True
        Else
            Return False
        End If
    End Function

Public Function UnMapDrive(ByVal DriveLetter As String) As Boolean
    Dim rc As Integer
        rc = WNetCancelConnection2(DriveLetter & ":", 0, ForceDisconnect)

        If rc = 0 Then
            Return True
        Else
            Return False
        End If

    End Function 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T20:48:01.780

一种解决方案是将网络文件夹映射到可用的驱动器号。您可以使用 Windows 操作系统命令完成此操作：

```
System.Diagnostics.Process.Start("net.exe", "use K: \\Server\URI\path\here /USER:<username> <password>" ) 
```

只需将用户名和密码替换为您需要的凭据，并确保驱动器号可用。

要断开连接，您可以致电

```
System.Diagnostics.Process.Start("net.exe", "use /delete K:" ) 
```

# c# - 如何在 C# 中使计算机发出哔哔声？

> ID：321135
> 
> 赞同：114
> 
> 时间：2008-11-26T15:38:53.603
> 
> 标签：c#, .net, audio, beep

如何在没有外部扬声器的情况下使计算机的内部扬声器在 C# 中发出哔哔声？

* * *

## 回答 #1

> 赞同：199
> 
> 时间：2008-11-26T15:41:02.337

在 .Net 2.0 中，您可以使用 Console.Beep()。

```
// Default beep
Console.Beep(); 
```

您还可以指定哔声的频率和长度（以毫秒为单位）。

```
// Beep at 5000 Hz for 1 second
Console.Beep(5000, 1000); 
```

有关详细信息，请参阅[http://msdn.microsoft.com/en-us/library/8hftfeyw%28v=vs.110%29.aspx](http://msdn.microsoft.com/en-us/library/8hftfeyw%28v=vs.110%29.aspx)

* * *

## 回答 #2

> 赞同：155
> 
> 时间：2008-11-26T15:47:01.607

你也可以使用相对未使用的：

```
 System.Media.SystemSounds.Beep.Play();
    System.Media.SystemSounds.Asterisk.Play();
    System.Media.SystemSounds.Exclamation.Play();
    System.Media.SystemSounds.Question.Play();
    System.Media.SystemSounds.Hand.Play(); 
```

此声音的文档可在[http://msdn.microsoft.com/en-us/library/system.media.systemsounds(v=vs.110).aspx中找到](http://msdn.microsoft.com/en-us/library/system.media.systemsounds(v=vs.110).aspx)

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-11-26T15:40:21.653

解决方案是，

```
Console.Beep 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-11-26T15:40:27.563

试试这个

`Console.WriteLine("\a")`

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2016-07-04T04:30:22.703

已确认**Windows 7 和更新版本**（至少 64 位或两者）**不使用系统扬声器**，而是将呼叫路由到默认声音设备。

因此，`system.beep()`在 win7/8/10 中使用不会使用内部系统扬声器产生声音。相反，如果外部扬声器可用，您会听到哔哔声。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2017-10-31T11:11:24.707

我只是在为自己寻找解决方案时遇到了这个问题。您可能会考虑通过运行一些 kernel32 的东西来调用系统哔声功能。

```
using System.Runtime.InteropServices;
        [DllImport("kernel32.dll")]
        public static extern bool Beep(int freq, int duration);

        public static void TestBeeps()
        {
            Beep(1000, 1600); //low frequency, longer sound
            Beep(2000, 400); //high frequency, short sound
        } 
```

这与运行 powershell 相同：

```
[console]::beep(1000, 1600)
[console]::beep(2000, 400) 
```

# macos - Word 2008 宏到 SVN 添加当前文档

> ID：321136
> 
> 赞同：0
> 
> 时间：2008-11-26T15:39:02.123
> 
> 标签：macos, vba, svn, ms-word, applescript

我想在当前 Word 2008 文档上调用“svn add”。我有一个 shell 脚本，稍后会 svn 提交它。我不希望该 shell 脚本不加选择地 svn 添加文件，因此我希望能够通过 Word 2008 中与宏或 appleScript 相关联的按钮来执行此操作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-29T03:18:37.400

由于 Word 2008 没有 VBA，因此您需要使用 AppleScript。

有什么阻止你使用“做 shell 脚本”来做你需要的事情吗？

您需要 svn add 的文档路径 - 请参阅[文档类中的全名属性](http://www.microsoft.com/mac/developers/default.mspx?clr=99-25-0&ep=9&target=9635a2e8-234a-48f2-9586-f848ac8e3da21033&CTT=InContent)

# maven-2 - 如何使用 Netbeans 嵌入式 Maven 将模块安装到 maven 存储库中？

> ID：321137
> 
> 赞同：12
> 
> 时间：2008-11-26T15:39:54.553
> 
> 标签：maven-2, netbeans

我有 NetBeans 的 Maven 插件，它成功地为我设置了一个本地存储库。现在我需要向我的存储库添加一个 3rd 方库（特别是 Oracle JDBC 驱动程序）。构建失败并显示有关如何安装第三方模块的说明，但看​​起来我无法使用 NetBeans Maven 插件运行该命令。这可能吗，还是我只需要获取 Maven 的外部版本？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-04T08:19:09.467

您可以做的（至少在 NetBeans 6.5 中）如下：

*   在你的 pom 中添加对库的依赖
*   转到项目->您的项目->库（您应该看到带有感叹号的库）
*   右键单击库，选择“手动安装工件”
*   从本地驱动器中选择 jar，“本地安装”，您就完成了！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-26T17:21:38.233

我最终在这里下载了 Maven： [http](http://maven.apache.org/download.html) ://maven.apache.org/download.html 并使用独立的 Maven 二进制文件将 jar 安装到我的 Maven 存储库中。如果有人对这个问题有任何想法，我仍然有兴趣知道答案。

# asp.net - 来自 ASP .NET 的电子邮件

> ID：321138
> 
> 赞同：3
> 
> 时间：2008-11-26T15:39:55.320
> 
> 标签：asp.net, email, gmail, exchange-server

我使用 smtp 类通过代码发送电子邮件。

我可以使用 .net 框架中的类来显示在页面上收到的电子邮件，而不必使用诸如 exchange sdk 之类的东西吗？

我将如何在 .net Web 应用程序（带有 .net 类）中使用 gmail pop 和 smtp 服务器信息来发送和接收电子邮件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T15:55:08.720

是的，这是可能的。您可能会发现使用许多可用的第三方组件之一会更容易，这些组件封装了您原本需要开发的大部分逻辑。

我喜欢 Chilkat 的[电子邮件组件](http://www.chilkatsoft.com/email-features.asp)。他们提供[了一个在线示例，展示了如何使用他们的组件通过 POP3 访问 Gmail 收件箱](http://www.example-code.com/csharp/pop3_gmail.asp)。它们还有一个[IMAP 组件](http://www.chilkatsoft.com/imap-features.asp)，您可能会发现它很有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T15:56:59.153

读这个

[如何在 C# 中进行 POP3](http://www.developerfusion.com/article/4071/how-to-pop3-in-c/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T18:27:52.780

如果没有任何第三方库，您将无法从 .net 中的远程服务器检索电子邮件。

.Net 仅包含 SMTP 支持，对于 POP 和 IMAP，您必须使用另一个库。（或自己动手。）

顺便说一句，这个问题适用于任何邮件服务器/服务，而不仅仅是 gmail。

# c# - 检查 C# 中的任何 int 类型？

> ID：321139
> 
> 赞同：4
> 
> 时间：2008-11-26T15:39:57.783
> 
> 标签：c#, reflection, casting, types

我有一个函数，除其他外，它接受一个对象和一个类型，并将对象转换为该类型。然而，输入对象通常是一个双精度类型，并且类型有一些 int 变体（uint、long 等）。如果将整数作为双精度（如 4.0）传入，我希望它能够工作，但如果传入小数（4.3）则抛出异常。有没有更优雅的方法来检查 Type 是否是某种 int？

```
if (inObject is double && (targetType == typeof (int)
                         || targetType == typeof (uint)
                         || targetType == typeof (long)
                         || targetType == typeof (ulong)
                         || targetType == typeof (short)
                         || targetType == typeof (ushort)))
{
    double input = (double) inObject;
    if (Math.Truncate(input) != input)
        throw new ArgumentException("Input was not an integer.");
} 
```

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T17:07:15.813

这似乎可以满足您的要求。我只测试了双精度、浮点数和整数。

```
 public int GetInt(IConvertible x)
    {
        int y = Convert.ToInt32(x);
        if (Convert.ToDouble(x) != Convert.ToDouble(y))
            throw new ArgumentException("Input was not an integer");
        return y;
    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T19:46:28.987

```
int intvalue;
if(!Int32.TryParse(inObject.ToString(), out intvalue))
   throw InvalidArgumentException("Not rounded number or invalid int...etc");

return intvalue; //this now contains your value as an integer! 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T17:29:21.870

您应该能够使用 Convert.ToDecimal 和 x % y 的组合，我想，其中 y = 1 并检查结果 ==0;

# java - 将 JVM 参数放入文件中以在运行时获取

> ID：321140
> 
> 赞同：4
> 
> 时间：2008-11-26T15:39:59.563
> 
> 标签：java, jvm, jvm-arguments

我正在构建我当前应用程序的一个 jar，它需要设置几个 JVM 参数。

有没有办法在文件中而不是在命令行中设置这些 JVM 参数？

我已经进行了一些搜索，看起来我可以使用 java.properties 文件做一些事情，可能是通过设置 java-args，但我找不到任何对格式的引用。

我在吠叫错误的树吗？

这可能吗？如果可以，怎么办？

如果没有，还有其他方法可以指定 JVM 参数吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T15:48:03.057

您当然可以编写一个批处理脚本来执行 JVM。批处理脚本可以查看文件并使用适当的参数进行调用。不过，这将取决于操作系统。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-18T01:19:34.533

在启动 JVM 之前包装 jar 文件 shell/bash 脚本来设置参数和环境变量是很常见的

例如在 *nix 系统上你可以做这样的事情

```
#!/bin/sh
CLASSPATH=foo.jar:bar.jar
JVMARGS=-some_arg
MYAPP_ARGS=-some_args -for -my -app

java $JVMARGS -classpath $CLASSPATH com.my.domain.myapp $MYAPP_ARGS 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T23:48:03.340

如果您使用的是 jar 文件，您可以设置清单文件并在该文件中提供一些信息（主类等）。

您还可以引用主 jar 文件要使用的其他 jar 文件。*例如，您*不想包含在公司 jar 文件中的第三方 jar。

除此之外，其他人是对的 - 设置批处理文件/脚本。

# c - C 中宏定义 (#define) 的良好编程实践

> ID：321143
> 
> 赞同：24
> 
> 时间：2008-11-26T15:40:21.557
> 
> 标签：c, c-preprocessor

例如，永远不要定义这样的宏：

```
#define DANGER 60 + 2 
```

当我们执行这样的操作时，这可能会很危险：

```
int wrong_value = DANGER * 2; // Expecting 124 
```

相反，这样定义是因为您不知道宏的用户如何使用它：

```
#define HARMLESS (60 + 2) 
```

这个例子很简单，但这几乎解释了我的问题。在编写宏时，您会推荐任何一套指南或最佳实践吗？

谢谢你的时间！

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-26T15:43:26.357

当做一个宏来运行它的参数并且表现得像一个表达式时，这是惯用的：

```
 #define DOIT(x) do { x } while(0) 
```

这种形式有以下优点：

1.  它需要一个终止分号
2.  它适用于嵌套和大括号，例如 if/else

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-11-26T15:49:40.713

不仅应该在参数周围加上括号，还应该在返回的表达式周围加上括号。

```
#define MIN(a,b)  a < b ? a : b     // WRONG  

int i = MIN(1,2); // works
int i = MIN(1,1+1); // breaks

#define MIN(a,b)  (a) < (b) ? (a) : (b)   // STILL WRONG

int i = MIN(1,2); // works
int i = MIN(1,1+1); // now works
int i = MIN(1,2) + 1; // breaks

#define MIN(a,b)  ((a) < (b) ? (a) : (b))   // GOOD

int i = MIN(1,2); // works
int i = MIN(1,1+1); // now works
int i = MIN(1,2) + 1; // works 
```

不过，`MIN(3,i++)`还是坏了……

最好的规则是**仅在没有其他方法有效时才使用#defines！** 我知道你问的是 C 而不是 C++，但仍然牢记他。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-26T16:01:35.010

在整个宏**和**扩展列表中引用的每个参数周围使用括号：

```
#define MAX(x, y) ((x) > (y) ? (x) : (y)) 
```

* * *

避免编写多次评估其参数的宏。当参数有副作用时，此类宏将不会按预期运行：

```
MAX(a++, b); 
```

如果大于 ，将评估`a++`两次。`a``b`

* * *

为宏使用大写名称以明确它是宏而不是函数，以便可以相应地考虑差异（另一个一般的良好做法是也不将具有副作用的参数传递给函数）。

* * *

不要使用宏来重命名这样的类型：

```
#define pint int * 
```

因为当有人键入时它的行为不会像预期的那样

```
pint a, b; 
```

请改用 typedef。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-26T15:43:44.813

使用静态常量值而不是宏来表示常量值、整数或其他值。编译器通常可以将它们优化掉，并且它们仍然是语言类型系统中的一等公民。

```
static const int DANGER = 60 + 2; 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-26T15:42:43.160

在展开式中，在参数周围加上括号，这样如果它们传入表达式，您将获得预期的行为。

```
#define LESS_THAN(X,Y) (((X) < (Y) ? (X) : (Y)) 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-26T17:00:36.903

对 MAX/MIN 宏的响应，取自[Linux 内核中的 GCC hacks](http://www.ibm.com/developerworks/linux/library/l-gcc-hacks/index.html)：

```
#define min(x, y) ({                       \
        typeof(x) _min1 = (x);             \
        typeof(y) _min2 = (y);             \
        (void) (&_min1 == &_min2);         \
        _min1 < _min2 ? _min1 : _min2; }) 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-26T15:52:41.907

为您的宏使用相当独特的名称，因为它们具有全局范围并且可以与任何内容发生冲突，因此：

```
#define MAX 10 
```

很容易与其他代码发生冲突，因此：

```
#define MYPROJECT_MAX 10 
```

或者更独特的东西，会更好。

我见过这种冲突没有产生编译错误，但产生了稍微错误的代码的情况，所以它可能非常阴险。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-16T17:41:21.170

取消定义你的宏。

您`#defines`应该与`#undef`. 这可以防止预处理器堵塞并影响意外的代码片段。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-05-04T04:14:49.957

对于多行宏，请使用`do { } while (0)`：

```
#define foo(x) do {  \
    (x)++;           \
    printf("%d", x); \
} while(0) 
```

你做过吗

```
#define foo(x) {     \
    (x)++;           \
    printf("%d", x); \
} 
```

反而，

```
if (xyz)
    foo(y);
else
    foo(z); 
```

会失败的。

另外，在宏中引入临时变量时要小心：

```
#define foo(t) do {    \
    int x = (t);       \
    printf("%d\n", x); \
} while(0)

int x = 42;
foo(x); 
```

将打印`0`而不是`42`。

如果你有一个复杂的表达式需要返回一个值，你可以使用逗号运算符：

```
#define allocate(foo, len) (foo->tmp = foo->head, foo->head += len, foo->tmp) 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-26T16:20:28.980

如果您细心且专业，则可以通过将宏用作简单的代码生成器来完成 DRY（不要重复自己）代码。你必须向其他程序员解释你在做什么，但它可以节省很多代码。例如，列表宏技术：

```
// define a list of variables, error messages, opcodes
// or anything that you have to write multiple things about
#define VARLIST \
    DEFVAR(int, A, 1) \
    DEFVAR(double, B, 2) \
    DEFVAR(int, C, 3) \

// declare the variables
#define DEFVAR(typ, name, val) typ name = (val);
    VARLIST
#undef  DEFVAR

// write a routine to set a variable by name
void SetVar(string varname, double value){
    if (0);
    #define DEFVAR(typ, name, val) else if (varname == #name) name = value;
        VARLIST
    #undef  DEFVAR
    else printf("unrecognized variable %s\n", varname);
}

// write a routine to get a variable's value, given its name
// .. you do it .. 
```

现在，如果您想添加一个新变量、删除一个变量或重命名一个变量，只需进行 1 行编辑。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-26T17:37:57.327

看看我有多讨厌这个：

```
void bar(void) {
    if(some_cond) {
        #define BAZ ...
        /* some code */
        #undef BAZ
    }
} 
```

总是这样放置它们：

```
void bar(void) {
    if(some_cond) {
#define BAZ ...
        /* some code */
#undef BAZ
    }
} 
```

# vb.net - .Net FormStartPosition.CenterScreen 不居中

> ID：321155
> 
> 赞同：2
> 
> 时间：2008-11-26T15:43:24.673
> 
> 标签：vb.net, winforms

我正在尝试在 VB.net 中居中放置一个表单。它没有使表格居中，而是在中心和 0,0（左上角）之间的一半左右结束。

我正在使用代码

Me.StartPosition = FormStartPosition.CenterScreen

它是从 IntializeDisplay 方法调用的，而 IntializeDisplay 方法又是从 Form Load 方法调用的。

我假设我正在设置一些破坏中心计算的属性，但我不确定它可能是什么。

如果有人有任何想法，他们将不胜感激。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-06T20:07:08.300

在事件中添加它，它将起作用：

```
Public Sub New()

    ' This call is required by the Windows Form Designer.
    InitializeComponent()
    ' Add any initialization after the InitializeComponent() call.
    Me.StartPosition = FormStartPosition.CenterScreen

End Sub 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-27T05:54:21.147

我认为您在流程中设置 StartPosition 的值为时已晚 - 在调用 Form.Load 时，加载已经完成并且表单具有分配的位置。

在问题中引用的代码行上设置断点，然后查看表单位置 - 它已经在它出现的位置。

为了达到您想要的效果，需要在表单开始其内置位置处理之前设置 StartPosition 的值。我建议在调用 InitializeComponent() 之后将代码放入表单构造函数中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-03-01T21:32:24.993

如果您正在调整表单大小，或者正在使用自动调整大小，您需要使用

```
 Me.CenterToScreen() 
```

Load 事件结束时的命令。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T16:09:36.850

您是否实施了任何形式的调整大小/定位逻辑？如果是这样，请将其注释掉，然后重试。

尝试`Form.StartPosition`在设计器中设置 （这将在 中设置`InitializeComponent()`）而不是在 Load 事件中。

尝试重置`Form.Location`and`Form.Size`值。如果您的表单已本地化，请删除资源文件中的`Form.Location`AND`Form.Size`条目。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-03-01T21:27:42.800

不要依赖表单初始化来处理它的起始位置，而是尝试调用该方法来使表单居中。即使在显示后更改大小后，这也允许您将表单居中。

例子：

```
Me.CenterToScreen() 
```

或者

```
Me.CenterToParent() 
```

取决于您试图使表格居中的位置。

# php - 使用正则表达式检查 PHP 中的文件扩展名

> ID：321158
> 
> 赞同：18
> 
> 时间：2008-11-26T15:43:39.117
> 
> 标签：php, regex

我正在读取单个目录中的所有文件，并且我想过滤 JPG、JPEG、GIF 和 PNG。

大写和小写字母。这些是唯一被接受的文件。

我目前正在使用这个：

```
$testPics = takeFiles($picsDir, "([^\s]+(?=\.(jpg|JPG|jpeg|JPEG|png|PNG|gif|GIF))\.\2)"); 
```

并且函数 takeFiles 看起来像这样：

```
function takerFiles($dir, $rex="") {
    $dir .= "/";
    $files = array();
    $dp = opendir($dir);
    while ($file = readdir($dp)) {
      if ($file == '.')  continue;
      if ($file == '..') continue;
      if (is_dir($file)) continue;
      if ($rex!="" && !preg_match($rex, $file)) continue;
      $files[] = $file;
    }
    closedir($dp);
    return $files;
  } 
```

它总是什么都不返回。所以我的正则表达式代码一定有问题。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-11-26T15:48:42.150

我认为您的正则表达式有问题。首先在这里尝试测试正则表达式：[https ://www.regexpal.com/](https://www.regexpal.com/)

我认为这个可能对你有用：

`/^.*\.(jpg|jpeg|png|gif)$/i`

请注意末尾的 /i - 这是“不区分大小写”标志，您不必输入所有排列:)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-26T15:55:19.623

如何使用[glob()](http://www.php.net/glob)代替？

```
$files = glob($dir . '*.{jpg,gif,png,jpeg}',GLOB_BRACE); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-26T16:06:33.753

有什么理由你不想使用`scandir`and`pathinfo`吗？

```
public function scanForFiles($path, array $exts)
{
    $files = scanDir($path);

    $return = array();

    foreach($files as $file)
    {
        if($file != '.' && $file != '..')
        {
            if(in_array(pathinfo($file, PATHINFO_EXTENSION), $exts))) {
                $return[] = $file;   
            }
        }
    }

    return $return;
} 
```

因此，您还可以检查文件是否为目录并执行递归调用以扫描该目录。我匆忙编写代码，所以可能不是 100% 正确。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-02-19T15:03:33.170

这对我有用

```
$string = "your-file-name.jpg";
preg_match("/\b(\.jpg|\.JPG|\.png|\.PNG|\.gif|\.GIF)\b/", $string, $output_array); 
```

最好的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T15:49:03.913

你应该在你的正则表达式周围加上斜杠。->“/（...）/”

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T16:02:51.857

有几种方法可以做到这一点。

你试过[glob()](http://us3.php.net/glob)吗？

```
$files = glob("{$picsDir}/*.{gif,jpeg,jpg,png}", GLOB_BRACE); 
```

您是否考虑过[pathinfo()](http://us.php.net/pathinfo)？

```
$info = pathinfo($file);
switch(strtolower($info['extension'])) {
    case 'jpeg':
    case 'jpg':
    case 'gif':
    case 'png':
        $files[] = $file;
        break;
} 
```

如果您坚持使用正则表达式，则无需匹配整个文件名，只需匹配扩展名即可。使用`$`标记来匹配字符串的结尾，并使用`i`标志来表示不区分大小写。另外，不要忘记在表达式中使用分隔符，在我的例子中是“%”：

```
$rex = '%\.(gif|jpe?g|png)$%i'; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-09-29T17:23:08.263

以下是从目标目录按类型编译文件数组的两种不同方法（演示为 conf）。我不确定哪个性能更好。

```
 $path    = '/etc/apache2/';
    $conf_files = []; 

    // Remove . and .. from the returned array from scandir
    $files = array_diff(scandir($path), array('.', '..'));
    foreach($files as $file) {
        if(in_array(pathinfo($file, PATHINFO_EXTENSION), ['conf'])) {
            $conf_files[] = $file;   
        }   
    }
    return $conf_files; 
```

这将返回完整的文件路径，而不仅仅是文件名

```
return $files = glob($path . '*.{conf}',GLOB_BRACE); 
```

# wcf - 如何在 WCF 服务中创建 XPS 文档进行存储和返回？

> ID：321168
> 
> 赞同：0
> 
> 时间：2008-11-26T15:47:26.600
> 
> 标签：wcf, xps, middle-tier

我有一个 WCF 服务作为中间层，在某些情况下，我需要创建一个可打印的文档，将其存储在数据库中以供将来参考，然后将其返回给客户端。

作为文件格式，我的第一选择是 XPS，所以我想在 WCF 服务中创建一个 XPS 文档，存储它，然后返回它。

有没有一种简单的方法来实现这一点，或者其他一些明显的方法来解决我错过的问题（在 WCF 中存储和返回可打印文档）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-30T21:30:17.627

简单的？XPS 没有什么是容易的。

我目前正在使用 XpsSerializerFactory 将 XPS 序列化为字节数组

```
 using (MemoryStream ms = new MemoryStream())
    {
        var writer = new XpsSerializerFactory().CreateSerializerWriter(ms);
        writer.Write(fds);
        return ms.ToArray();
    } 
```

我一直在玩弄只是发送支持文档包的内存流以及文档的 URI，但我从未测试过。

# javascript - JavaScript父变量值不规则？

> ID：321175
> 
> 赞同：2
> 
> 时间：2008-11-26T15:50:03.957
> 
> 标签：javascript, variables, function

我有以下代码：

```
var address;
getAddress(0,0);
function getAddress(latlng) 
{
  if (latlng != null) 
  {
    geocoder.getLocations(latlng, 
    function(addresses) 
    {
      if(addresses.Status.code == 200) 
      { 
        address = addresses.Placemark[0].address.toString();
        alert(address);  // Outputs something :)
      }
    });
   }
   return address;   //returns nothing :(
} 
```

`address`总是返回`undefined`，但警报确实输出了一些东西。为什么是这样？

（Geocoder 是[Google Maps API](http://code.google.com/apis/maps/documentation/reference.html#GClientGeocoder)的一个实例）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T16:15:30.880

我认为您的问题都与范围有关。一般来说，您不想依赖在函数范围内使用的变量的全局声明。

这应该更正您的函数的任何范围问题：

```
var address = getAddress(0,0);

function getAddress(latlng) {
    if (latlng != null) {
        var address = geocoder.getLocations(latlng, function(addresses) {
            if(addresses.Status.code == 200) { 
                return addresses.Placemark[0].address.toString();
            }
        });
    }
return address;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T17:09:30.287

我通过将 geocoder.getLocations() 实现为异步成功地重现了该错误。如果 geocoder.getLocations() 只是简单地执行了参数函数，那么变量的更改将在 getAddress() 返回之前变得可见，因此这不是范围问题。

```
var address;
alert("B: address returned: " + getAddress());
function getAddress() {
  executeFunction(function() {
    address = "myAddress";
    alert("C: address set to: " + address);
  });
  return address;
}

function executeFunction(aFunction) {
  alert("A: executing: " + aFunction);
  window.setTimeout(aFunction, 1);
} 
```

执行上面的代码会产生警报顺序 ABC，这意味着该地址在分配之前返回。替换为 ACB 顺序中`window.setTimeout(aFunction, 1);`的`aFunction()`结果，最后一个警报是“B：返回的地址：myAddress”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T16:26:29.080

如果我没记错的话，它看起来像

```
geocoder.getLocations 
```

不会返回一个值，但期望一个回调函数，在你的情况下：

```
function(addresses) {
    if(addresses.Status.code == 200) { 
        return addresses.Placemark[0].address.toString();
    }
} 
```

这个“内部”返回不会有太大作用，因为它将返回到 geocoder.getLocations 的内部。

因此，执行分配的函数可能在外部返回之后被调用（回调和 200 状态表明涉及到缓慢的 http 调用）。

也就是说，除非您可以修改 geocoder.getLocations ，否则解决方案将是使您的函数也可以正常工作，例如：

```
function getAddress(latlng, callback) {
    if (latlng != null) {
        geocoder.getLocations(latlng, function(addresses){
            if(addresses.Status.code == 200) { 
                address = addresses.Placemark[0].address.toString();
                alert(address);
                //Outputs something :)
                callback(address);
            }
        });
    } 
```

}

你会用类似这样的方式调用它：

```
getAddress(ll, function(address){
   alert(address);
}); 
```

作为奖励，您可以摆脱全局变量:-)

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2008-11-26T16:16:48.847

我看不出这不起作用的任何原因。

为了确保没有返回任何东西使函数调用像这样

```
window.alert(getAddress(0,0)); 
```

然后看看输出了什么

# sql - 在 sql server 2005 中进行通配符搜索的最佳方法是什么？

> ID：321179
> 
> 赞同：2
> 
> 时间：2008-11-26T15:50:59.273
> 
> 标签：sql, sql-server-2005, search, wildcard

所以我有一个`stored procedure`接受产品代码的产品，例如`1234567890`. 我想为这些产品提供通配符搜索选项。（即`123456*`）并让它返回所有匹配的产品。做这个的最好方式是什么？

我过去使用过类似下面的东西：

```
SELECT @product_code = REPLACE(@product_code, '*', '%') 
```

然后`LIKE`在现场进行搜索`product_code`，但我觉得它可以改进。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T16:10:40.203

你已经在做的事情就是你能做的最好的事情。

您可能会尝试的一种优化是确保您允许的列上有一个索引。SQL Server 仍然需要对通配符搜索进行全面扫描，但它只会针对特定索引而不是完整表。

与往常一样，在任何更改之前和之后检查查询计划是一个好主意。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T17:04:02.090

## 一些随机的想法

这取决于，但您可能需要考虑：

*   默认情况下始终查找子字符串。例如，如果用户输入“1234”，您搜索：

    WHERE 产品如“%1234%”

*   允许用户完全控制。即简单地接受他们的输入并将其传递给`LIKE`子句。这意味着他们可以提出自己的自定义搜索。这仅在您的用户有兴趣学习时才有用。

    WHERE 产品如@input

# c# - 如何使用 NUnit 测试与数据库相关的代码？

> ID：321180
> 
> 赞同：65
> 
> 时间：2008-11-26T15:51:01.787
> 
> 标签：c#, database, unit-testing, tdd, nunit

我想用命中数据库的 NUnit 编写单元测试。我希望每个测试的数据库都处于一致状态。我认为交易可以让我“撤消”每个测试，所以我四处搜索并找到了 2004-05 年关于该主题的几篇文章：

*   [http://weblogs.asp.net/rosherove/archive/2004/07/12/180189.aspx](http://weblogs.asp.net/rosherove/archive/2004/07/12/180189.aspx)
*   [http://weblogs.asp.net/rosherove/archive/2004/10/05/238201.aspx](http://weblogs.asp.net/rosherove/archive/2004/10/05/238201.aspx)
*   [http://davidhayden.com/blog/dave/archive/2004/07/12/365.aspx](http://davidhayden.com/blog/dave/archive/2004/07/12/365.aspx)
*   [http://haacked.com/archive/2005/12/28/11377.aspx](http://davidhayden.com/blog/dave/archive/2004/07/12/365.aspx)

这些似乎解决了为 NUnit 实现自定义属性的问题，该属性构建了在每次测试执行后回滚数据库操作的能力。

这很棒但是...

1.  这个功能是否存在于 NUnit 的某个地方？
2.  在过去的 4 年中，这项技术是否得到了改进？
3.  这仍然是测试数据库相关代码的最佳方法吗？

* * *

编辑：这不是我想专门测试我的 DAL，我更想测试与数据库交互的代码片段。对于这些测试是“无接触”和可重复的，如果我可以在每次测试后重置数据库，那就太棒了。

此外，我想将其简化为目前没有测试场所的现有项目。出于这个原因，我实际上无法为每个测试从头开始编写数据库和数据的脚本。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-12-15T01:55:25.523

NUnit 现在有一个 [Rollback] 属性，但我更喜欢用不同的方式来做。我使用[TransactionScope](http://msdn.microsoft.com/en-us/library/system.transactions.transactionscope.aspx)类。有几种使用它的方法。

```
[Test]
public void YourTest() 
{
    using (TransactionScope scope = new TransactionScope())
    {
        // your test code here
    }
} 
```

由于您没有告诉 TransactionScope 提交它会自动回滚。即使断言失败或引发其他异常，它也可以工作。

另一种方法是使用 [SetUp] 创建 TransactionScope 并使用 [TearDown] 对其调用 Dispose。它减少了一些代码重复，但完成了同样的事情。

```
[TestFixture]
public class YourFixture
{
    private TransactionScope scope;

    [SetUp]
    public void SetUp()
    {
        scope = new TransactionScope();
    }

    [TearDown]
    public void TearDown()
    {
        scope.Dispose();
    }

    [Test]
    public void YourTest() 
    {
        // your test code here
    }
} 
```

这与单个测试中的 using 语句一样安全，因为 NUnit 将保证调用 TearDown。

说了这么多，我确实认为命中数据库的测试并不是真正的单元测试。我仍然编写它们，但我认为它们是集成测试。我仍然认为它们提供价值。我经常使用它们的一个地方是测试 LINQ to SQL 代码。我不使用设计师。我手写了 DTO 和属性。众所周知，我弄错了。集成测试有助于发现我的错误。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T16:07:32.940

我刚去了一个 .NET 用户组，演示者说他在测试设置和拆卸中使用了 SQLlite，并使用了内存选项。他不得不稍微捏造连接并明确破坏连接，但每次都会提供一个干净的数据库。

[http://houseofbilz.com/archive/2008/11/14/update-for-the-activerecord-quotmockquot-framework.aspx](http://houseofbilz.com/archive/2008/11/14/update-for-the-activerecord-quotmockquot-framework.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T16:06:51.020

我会称这些集成测试，但没关系。我为此类测试所做的是让测试类中的设置方法在每次测试之前清除所有感兴趣的表。我通常手动编写 SQL 来执行此操作，这样我就不会使用被测类。

通常，我的数据层依赖于 ORM，因此我不会在那里编写太多单元测试。我觉得不需要对我不写的代码进行单元测试。对于我在层中添加的代码，我通常使用依赖注入来抽象出与数据库的实际连接，这样当我测试我的代码时，它就不会触及实际的数据库。结合模拟框架执行此操作以获得最佳结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T16:09:42.420

对于这种测试，我尝试了 NDbUnit（与 NUnit 协同工作）。如果没记错的话，它是来自 Java 平台的 DbUnit 的一个端口。它有很多巧妙的命令来完成你想要做的事情。该项目似乎已移至此处：

[http://code.google.com/p/ndbunit/](http://code.google.com/p/ndbunit/)

（它曾经在[http://ndbunit.org](http://ndbunit.org)）。

来源似乎可通过此链接获得：http: [//ndbunit.googlecode.com/svn/trunk/](http://ndbunit.googlecode.com/svn/trunk/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-07T18:04:02.260

考虑创建一个数据库脚本，以便您可以从 NUnit 自动运行它，也可以手动运行它以进行其他类型的测试。例如，如果使用 Oracle，则从 NUnit 中启动 SqlPlus 并运行脚本。这些脚本通常写起来更快，更容易阅读。此外，非常重要的是，从 Toad 或等效程序运行 SQL 比从代码运行 SQL 或从代码通过 ORM 更具启发性。通常我会创建一个 setup 和 teardown 脚本并将它们放入 setup 和 teardown 方法中。

您是否应该从单元测试中通过数据库是另一个讨论。我相信这样做通常是有意义的。对于许多应用程序来说，数据库是绝对的行动中心，逻辑是高度基于集合的，所有其他技术、语言和技术都是过客。随着函数式语言的兴起，我们开始意识到 SQL 和 JavaScript 一样，实际上是一种伟大的语言，这些年来就在我们的眼皮底下。

顺便说一句，Linq to SQL（我在概念上喜欢它，但从未使用过）在我看来几乎是一种从代码中执行原始 SQL 而不承认我们在做什么的方式。有些人喜欢 SQL 并且知道他们喜欢它，有些人喜欢它但不知道他们喜欢它。:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-11-13T21:58:08.690

对于像我这样最近来到这个线程的任何人，我想建议尝试我目前正在为这个特定案例开发的[Reseed库。](https://github.com/v-zubritsky/Reseed)

内存数据库替换（缺少功能）和事务回滚（事务不能嵌套）对我来说都不是一个合适的选择，所以我最终选择了一个简单的删除/插入循环来恢复数据。最后用一个库来生成这些，同时尝试优化我的测试速度和设置的简单性。如果它帮助其他人会很高兴。

我推荐的另一种选择是使用数据库快照来恢复数据，它具有相当的性能和可用性。工作流程如下：

*   删除现有快照；
*   创建数据库；
*   插入数据；
*   创建快照；
*   执行测试；
*   从快照恢复；
*   去“执行测试”，直到没有人离开；
*   删除快照。

如果您可以拥有所有测试的唯一数据脚本并允许您在唯一的时间执行插入（这应该是最慢的），那么它是合适的，而且您根本不需要数据清理脚本。

为了进一步提高性能，因为此类测试可能需要大量时间，请考虑使用数据库池和测试并行化。

# javascript - 为什么切换到 DojoX 网格会导致 JavaScript“无法将焦点移至控制”错误？

> ID：321193
> 
> 赞同：0
> 
> 时间：2008-11-26T15:55:56.440
> 
> 标签：javascript, grid, dojo

**问题**
我在一个页面上有许多 Dojo 组件。当用户尝试从类似输入的组件切换到类似网格的组件时，我收到 JavaScript“无法将焦点移动到控件”错误。用户群使用 IE6。

**解决方案**
DojoX Grid 布局中的第一个元素不能隐藏。如果它被隐藏，您会收到一个 JavaScript“无法将焦点移动到控制”错误。为了解决这个问题，我添加了一行 # 来显示。见下文。

> ```
>  var gridLayout = [
>     new dojox.grid.cells.RowIndex({ name: "row #", 
>                                     width: 2, 
>                                     styles: "text-align: right;"
>                                  }),
>     {
>       field: "ele_id",
>       name: "Element ID",
>       styles: "text-align:right;",
>       width:5,
>       hidden:"true"           
>     },
>     {
>       field: "ele_nm",
>       name: "Element Name",
>       styles: "text-align:left;",
>       width:8          
>     }
>   ]; 
> ```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T16:01:19.910

防止标签可能会干扰使用屏幕阅读器浏览您网站的视力不佳的用户。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-26T16:02:26.240

如果输入 Y 不接受用户输入，则不要将其设为输入字段！

如果您只是将其用于值显示，请使用样式`<span>`或`<div>`代替。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-26T16:00:02.643

我个人认为这种行为有点烦人。为什么要禁止用户专注于该领域？

更好的解决方案是隐藏/禁用该字段，直到准备好将数据输入其中。您还应该有一些文字来解释为什么该字段被禁用。

编辑：您发布的错误消息在谷歌上有一些结果，但似乎它可能是任何数量的问题，这个[http://www.francoisfaubert.com/2008/03/06/cant-move-focus-to -control/](http://www.francoisfaubert.com/2008/03/06/cant-move-focus-to-control/)听起来有可能。检查您的 HTML 以查看页面上是否有其他具有相同 ID 的控件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-26T16:00:17.947

您可以将 Input-Z 设置为禁用控件。然后，当用户进入 Input-Y 并填写它时，将 Input-Z 更改为启用。你怎么能这样做：

```
<input id="Input-x" type="text" />
<input id="Input-y" type="text" onChange="document.getElementById('Input_Z').removeAttribute('disabled');" />
<input id="Input-z" type="text" disabled /> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T15:56:55.003

您必须处理 keydown 事件并侦听字符 9（这是制表符）。要使事件无效，您只需在用户按下字符 9 时返回 false。

`function handleKeyDown(e)`

`{`

`var keynum;`

`var keychar;`

`var numcheck;`

`if(window.event) // IE`

`{`

`keynum = e.keyCode;`

`}`

`else if(e.which) // Netscape/Firefox/Opera`

`{`

`keynum = e.which;`

`}`

`return keynum != 9;` `` `}`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-26T16:30:41.877

在您的评论澄清问题后，我了解您需要用户不能使用 Tab 键聚焦元素。尝试添加到元素：

tabindex="-1"

例如：

```
<div id="mygrid" tabindex="-1"> <!-- Some stuff here --> </div> 
```

有关负标签索引的更多信息：[introduction-to-wai-aria](http://dev.opera.com/articles/view/introduction-to-wai-aria/)

编辑：关于 ARIA 的更多信息：http: [//www.w3.org/WAI/intro/aria](http://www.w3.org/WAI/intro/aria)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-26T16:57:36.067

关于错误信息：来自[Fake's tank](http://www.francoisfaubert.com/2008/03/06/cant-move-focus-to-control/)：

> “很可能你的文档中有冲突的 id。另外，请记住 IE 7 和以前的版本认为 name 属性应该像 id 一样对待。”

因此，首先，这是一个特定于 IE 的错误。其次，去改变你的身份证。它似乎是之前困扰一些惠普基于 html 的软件的问题，并且在用户从 IE6 升级到 IE7 时出现。

关于禁用焦点的问题 - 只需隐藏标签中 type=hidden 不需要的任何输入，它们将不再是问题。永远不要乱用人们的标签 - 这是在 Windows 应用程序上使用 html 改进的一件事。

故事的寓意：

*   正确地做
*   微软在网络东西上是废话
*   不要乱用标准的 GUI 行为

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-26T15:58:16.110

```
<input name="z" onfocus="this.blur()"/> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-26T16:25:43.153

给组件元素一个 tabindex 属性，其值为 -1

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-25T02:51:54.320

**解决方案**
DojoX Grid 布局中的第一个元素不能隐藏。如果它被隐藏，您会收到一个 JavaScript“无法将焦点移动到控制”错误。为了解决这个问题，我添加了一行 # 来显示。见下文。

> ```
>  var gridLayout = [
>     new dojox.grid.cells.RowIndex({ name: "row #", 
>                                     width: 2, 
>                                     styles: "text-align: right;"
>                                  }),
>     {
>       field: "ele_id",
>       name: "Element ID",
>       styles: "text-align:right;",
>       width:5,
>       hidden:"true"           
>     },
>     {
>       field: "ele_nm",
>       name: "Element Name",
>       styles: "text-align:left;",
>       width:8          
>     }
>   ]; 
> ```

# git - 带有 cvs 的 git 比单独的 cvs 快吗？

> ID：321196
> 
> 赞同：8
> 
> 时间：2008-11-26T15:56:13.460
> 
> 标签：git, cvs

我的团队在一个包含大约 20,000 个 Java 文件的 cvs 项目中工作。由于文件的数量，做一个 cvs 更新需要一些时间。我通常会检出整个树的大约 5 个副本，以便轻松检入不同的请求，而不必担心每个文件修改了哪些文件。让所有 5 棵树保持最新并彼此同步是一件非常痛苦的事情。

我读过在本地使用 git 和远程 cvs 服务器相当容易，而且 git 速度很快。git 会显着加快本地树的更新速度吗？

我意识到下限是进行一次 cvs 更新的时间。但我认为，一旦第一棵树是最新的，就有可能快速将其他 4 棵树与第一棵树同步，而不是再执行 4 条 cvs update 命令。我正确理解 git 吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-26T17:04:12.810

我们在工作中做类似的事情。我们基本上将`master`git 中的分支用作单个更新的 CVS 代码版本；我们在那里不做任何开发，只是 CVS 更新。然后，我们所有的开发项目都发生在我们 rebase 的特性分支上。当我们在`master`分支上进行 CVS 更新时，我们将这些更改提交到`master`，然后将我们的其他开发分支重新定位到`master`.

这并不理想——它使与其他人共享分支变得困难。但是，我们可以一次管理多个开发项目，并轻松地对它们进行分支、合并和差异化。`master`而且，我们只根据需要在一个分支上与 CVS 交互。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-27T18:11:27.087

我在一个大型项目（大约 10k 个文件）中使用 Git 作为 Subversion 客户端。Git 非常快，非常快。它是如此之快，以至于我只保留*一个*工作克隆，并在同一个克隆中的功能分支之间切换。和你一样，当我使用 Subversion 时，我会有两到三个类似的结帐，并且会定期在它们之间切换，因为我同时有多个事情在进行中。有时会很混乱。借助 Git 的轻量级分支、存储和“git add -p”等功能，我发现我不再需要多次签出。我可以在一个目录中完成所有操作，而不必担心丢失我忘记或意外覆盖的更改。

我没有将 Git 与 CVS 一起使用，但如果它的集成类似于 git-svn，那么它不会有问题。

# ibm-midrange - 来自 iSeries 的带有附件的邮件

> ID：321199
> 
> 赞同：4
> 
> 时间：2008-11-26T15:56:54.583
> 
> 标签：ibm-midrange

有没有办法从 iSeries 终端发送电子邮件，从 IFS 添加附件？我知道如何使用 SNDDST 实用程序发送普通电子邮件。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T16:56:25.553

有两种主要方法可以做到这一点。

1.  Do-It-Yourselfer 将使用 QtmmSendMail API
2.  否则，您可以使用其他几种免费和购买的产品。我推荐的是：
    *   [MAILTOOL](http://www.bvstools.com/mailtool.html) - 目前 399 美元。根据您要执行的操作，如果您想通过电子邮件发送假脱机文件，我建议您使用[SplTool Suite 。](http://www.bvstools.com/spltoolsuite.html)
    *   [RPGMail](http://mowyourlawn.com/RPGMail.html) - 使用 JavaMail 的免费 API

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T06:46:29.317

最新版本的操作系统已包含[**SNDSMTPEMM**](http://www-01.ibm.com/support/docview.wss?uid=nas8N1011153)命令。它非常易于使用，并且允许您通过填充适当的参数来包含消息正文和附件。

这就是我向任何在他们的系统上安装它并且需要简单和免费的东西的人推荐的。为了更加稳健，可以使用 Brad Stone 的[**MAILTOOL Plus**](https://www.bvstools.com/mailtool.html)，它可以作为付费订阅使用。

以下信息是我的原始答案，略有更新，主要用于历史目的：

* * *

在我工作的地方，我们使用[**MMAIL**](http://www.easy400.net/mmail/start)。它成本低廉，并提供易于使用的命令。例如，我碰巧总是按如下方式通过电子邮件发送流文件（在 CLP 中）：

```
  MMAIL/EMLSTMF SUBJECT('每月销售报告') +
    FROMNAME('AS/400') FROMADDR('as400@mycompany.com') +
    TO('jsmith@mycompany.com'/Jim Smith/*TO +
       'bjones@mycompany.com'/Bob Jones/*CC) +
    STMF(&文件1 &文件2 &文件3)

```

还有其他可用的参数（如果您使用交互式提示，则非常不言自明），以及处理最常见用例的其他几个命令。如果您想要更好的控制，或者需要发送更复杂的消息，该包还提供了一个 API，但我从来不需要比提供的命令更多的东西。

该实用程序过去是免费的，但作者现在需要 50 美元的“捐款”才能完全访问他网站上的下载。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-27T05:37:08.827

[您可以使用 Java 和JavaMail API](http://java.sun.com/products/javamail/)编写自己的程序。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-07T02:40:10.093

我有一段时间没看过了，但在 i5/OS 上应该有一些 QSH 可以使用的 unixy 邮件实用程序。如果没有，那么移植一个应该是一件简单的事情。在这里寻找想法：[http ://www.shelldorado.com/articles/mailattachments.html](http://www.shelldorado.com/articles/mailattachments.html)

但我更喜欢 JavaMail 的想法。只是一个快速的谷歌产生一个有 JavaMail 使用示例的网站：[http ://www.javaworld.com/javaworld/jw-10-2001/jw-1026-javamail.html](http://www.javaworld.com/javaworld/jw-10-2001/jw-1026-javamail.html)

使用 JavaMail，您还可以*阅读*邮件，如果这也有用的话。

**更新**：您说您已经可以从 IFS 添加附件。命令[CATSPLF](http://publib.boulder.ibm.com/infocenter/iseries/v5r3/index.jsp?topic=/rzahz/catsplf.htm)（QSH 实用程序的一部分）可以检索假脱机文件并将它们写入标准输出。这意味着您可以将假脱机文件传输到 IFS。但是你必须对创造他们的工作有很多了解。

喜欢：

```
    catsplf ... > /我的/文件/路径

```

我在[http://www.mcpressonline.com/tips-techniques/cl/techtip-read-printer-output-with-qshell.html](http://www.mcpressonline.com/tips-techniques/cl/techtip-read-printer-output-with-qshell.html)找到了这个。CATSPLF 是在 V5R3 中引入的。

# c# - 如何使用 Reflection.Emit 调试运行时生成的 IL 代码

> ID：321203
> 
> 赞同：11
> 
> 时间：2008-11-26T15:57:14.427
> 
> 标签：c#, .net, vb.net

我试图在运行时使用 Reflection.Emit 命名空间中的 DynamicMethod 类生成一些代码，但由于某种原因它抛出了“VerificationException”。这是我正在尝试使用的 IL 代码...

```
ldarg.1
ldarg.0
ldfld, System.String FirstName
callvirt, Void Write(System.String)
ldarg.1
ldarg.0
ldfld, System.String LastName
callvirt, Void Write(System.String)
ldarg.1
ldarg.0
ldfld, Int32 Age
callvirt, Void Write(Int32)
ret 
```

我需要一种方法来调试生成的 IL 代码。我有什么选择？我正在使用VS2008专业版。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-26T19:46:28.177

我在这里找到了更多帮助...

[DebuggerVisualizer for DynamicMethod (Show me the IL)](http://blogs.msdn.com/haibo_luo/archive/2005/10/25/484861.aspx)这是一个调试器可视化工具，您可以使用它在运行时查看生成的 IL！

更好的是[调试 LCG](http://blogs.msdn.com/yirutang/archive/2005/05/26/422373.aspx)，它允许您在运行时使用 Windbg 调试生成的代码！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T15:59:25.780

尝试使用[peverify](http://msdn.microsoft.com/en-us/library/62bwd2yd(VS.80).aspx)工具检查 IL。来自 MSDN：

> peverify.exe 基于数据流分析以及数百条关于有效元数据的规则列表执行全面的 MSIL 验证检查。有关 Peverify.exe 执行的检查的详细信息，请参阅 .NET Framework SDK 中工具开发人员指南文件夹中的“元数据验证规范”和“MSIL 指令集规范”。

您需要将生成的代码作为程序集保存到磁盘，以便它有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T16:03:52.430

在使用调试器（至少不是内置的）的意义上，没有办法直接调试 IL。你真的只有两个选择

1.  问 Rob 建议。手动将 IL 和 ilasm 键入 DLL/EXE。然后在生成的 DLL 上运行 peverify 以查看您的错误。
2.  如果您实际上想要调试 IL，那么您可能会坚持使用原始汇编。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T16:19:06.503

您需要发出符号信息才能调试 IL。

[使用反射发射发射符号信息](http://msdn.microsoft.com/en-us/library/a263ywy6.aspx)

并将发出的操作码与文件中发出它的对应位置相匹配。（ILGenerator.Emit() 调用所在的位置）。

但这当然不是一项微不足道的任务。

编辑：

您无法调试无法验证的代码，它根本不会被 Jit-ed。你需要检查你对 IL ops 的正确使用。堆栈中是否每个都具有它期望的所需类型的正确操作数？

编辑2：

简单的方法是使用 C# 创建代码，然后使用[Reflector](http://www.red-gate.com/products/reflector/)或其他一些 IL 反汇编程序查看 IL 并将其与您的进行比较。

编辑 3：不幸的是，无法使用 DynamicMethod 发出调试信息，但 WinDBG 可用于转储 IL，Jose Fco Bonnin 在他的博客中解释了这一点。[使用 DynamicMethod 执行动态 IL：](http://www.josefcobonnin.com/post/2008/08/23/Executing-dynamic-IL-with-DynamicMethod.aspx)

> DynamicMethod 遇到的主要问题是我们无法为 LCG 生成调试信息，因为调试 API 是基于 LCG 没有的元数据。在任何情况下，都不会丢失，因为我们可以继续使用 WinDBG 进行调试。...

该过程将在帖子中进一步解释。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T17:25:52.453

这在调试结束时可能对您没有帮助，但 RunSharp 是生成 IL 的好工具，可以帮助您避免常见的陷阱。它让编写 IL 感觉更像是编写 C#。

以下是示例概述：http: [//www.codeproject.com/KB/dotnet/runsharp.aspx](http://www.codeproject.com/KB/dotnet/runsharp.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T17:43:33.510

> ```
> ldarg.1
> ldarg.0
> ldfld, System.String FirstName
> callvirt, Void Write(System.String) 
> ```

在这个阶段，您仍然有 arg1 在堆栈上。

# haxe - 斧头在该领域

> ID：321204
> 
> 赞同：33
> 
> 时间：2008-11-26T15:57:20.260
> 
> 标签：haxe

最近我重新审视了 Haxe，并意识到我之前忽略了它的一些优雅。但我想它在开发人员中仍然缺乏一些知名度。

所以我的问题是，这里有人用它来生产吗？如果是这样，你如何使用它？你遇到了什么陷阱或困难？你会推荐它用于未来的项目吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-07-07T16:40:18.270

我使用 Haxe 开发我所有的 Flash 应用程序，我喜欢它。我在 Linux 和 Emacs 上进行开发，我非常喜欢如何让 Haxe 适合我喜欢的开发环境。我只是使用看起来像这样的简单 Makefile：

```
项目.swf：项目.hx
    haxe 项目.hxml

```

在 Haxe 上手真的很容易，而且非常优雅。与使用 Adob​​e Flash 构建器相比，使用 Haxe 完全没有问题，并且开发了许多大型项目，包括平移教育学，兰花，Cantillion 和[Audioscapes](http://audioscapes.sness.net)。

我已经在 SourceForge 上以 GPL 的形式发布了所有这些的源代码，请在以下位置查看它们：

*   [https://sourceforge.net/projects/panning/](https://sourceforge.net/projects/panning/)
*   [https://sourceforge.net/projects/orcaannotator/](https://sourceforge.net/projects/orcaannotator/)
*   [https://sourceforge.net/projects/cantillion/](https://sourceforge.net/projects/cantillion/)
*   [https://sourceforge.net/projects/margridflash/](https://sourceforge.net/projects/margridflash/)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-26T16:31:15.357

[您可能会在使用 Haxe 的项目和使用 Haxe](http://old.haxe.org/com/projects)的[人员](http://old.haxe.org/com/people)列表中找到一些有用的信息。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-12-12T18:39:24.347

我的公司使用 Haxe 进行生产。对于编程 swf 内容在技术方面绝对没有问题。在服务器端使用它有点困难。如果您使用 Haxe for PHP，您有时会遇到一些打字问题（这或多或少是 PHP 问题）。neko vm 非常稳定且非常快，但它需要一些时间才能与所有其他服务器软件（mysql、apache - mod_rewrite）一起运行，但一旦你得到它，它就非常稳定。

我们将它用于生成 swf 应用程序，尝试了 Haxe JS 的可能性。我们还为多人游戏创建了套接字服务器，并开始使用 Haxe PHP 或 neko 生成我们所有的网页。

社区非常有帮助，文档有时有点短。

这只是我的看法和我的经验。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-26T16:45:00.103

对于我们这些不知道 Haxe 是什么的人来说，它是一种用于开发 Web 应用程序的编程语言。它有多个编译器目标（Flash、php、JavaScript 和[Neko](http://en.wikipedia.org/wiki/Neko_(programming_language))语言的 VM）

*   [欢迎来到 haxe](http://haxe.org/) [haxe.org]
*   [维基百科上的Haxe](http://en.wikipedia.org/wiki/HaXe)条目

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-09-25T04:25:29.877

由于 NME/OpenFL，Haxe 目前作为跨平台开发（主要用于游戏开发）工具越来越受欢迎：[http ://www.openfl.org/](http://www.openfl.org/)

在 Haxe 中编写一次，然后将其部署到 Flash、Android、iOS 等。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-05-15T18:41:09.097

HaxeJS 非常适合 Web 生产，它允许使用所有底层 js 模块，同时提供额外的功能，如预处理器、类型化字段、条件编译、类、haxe 库、重构和 IDE 的自动完成等。加上它的非常快速地编译和输出即用型 js 文件。

我没有尝试过 microsoft typescript，但到目前为止，我一直在一些生产项目中将 HaxeJS 用于客户端和服务器（nodejs），感觉是个不错的选择。唯一的问题是如果我想与其他人共享 js 库或 npm 模块，那么我可能需要手动重写 js。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-06-11T23:41:22.537

您编译，haxelib 运行流程在您键入的目标中运行“目标”，例如 web，仅此而已，在您的 bin 文件夹中，您获取文件，记住根据您的目标和项目配置 project.flow 文件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-01-15T17:48:04.377

我们在之前的实习中将它用于内部网络系统。我们只编译为 js，而我只编译了一些次要代码为 js 和 C#。我可以说它工作得很好，当时制作了许多自定义小部件。调试生成的 js 也没有那么糟糕，但有时它不会生成您想要的代码（我记得 js 中的一个字符串比较问题，比较的是引用而不是值）。该代码已部署在生产环境中，并且多年来一直运行良好。我很确定他们今天仍在使用它。

那是在 2013 年，从那以后我就再也没有使用过它。我确实遇到的一个问题是尝试使用 2.10 版编译在 2.08 版中制作的代码。它需要一些细微但不明显的调整。我不能对最近的版本发表评论，但我会小心一点，不要通过升级到新版本的编译器来破坏大段代码。

# .net - WPF PasswordBox：如何警告用户 Caps Lock 已启用？

> ID：321211
> 
> 赞同：8
> 
> 时间：2008-11-26T15:59:51.893
> 
> 标签：.net, wpf, passwordbox

有谁知道如何实现标准气泡消息，当 Caps Lock 启用并且密码控制具有焦点时警告用户？这是内置在 .NET 框架中的，还是我需要编写自己的类来执行此操作？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-05-18T19:08:49.900

这是一个老问题，已经回答了，但我遇到了同样的问题，我一开始是这样，但如果在应用程序运行之前设置了 Caps Lock `Keyboard.IsKeyToggled(Key.CapsLock)`，就会返回。`false`所以我找到了另一个完美的解决方案。

```
Console.CapsLock //is boolean and returns true if CapsLock is on 
```

绝对出色和简单（它位于 mscorlib dll 中，因此您也不必担心不必要的依赖项）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T16:11:54.177

您可以向[PasswordChanged](http://msdn.microsoft.com/en-us/library/system.windows.controls.passwordbox.passwordchanged.aspx)事件处理程序添加一个处理程序函数并测试该函数中 CapsLock 键的值。如果发现打开，您可以从那里弹出一条消息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T16:09:50.780

如果您使用 MaskedTextBox 并指定 passwordChar，.NET 框架将自动为您执行此操作

# visual-studio - VS2008 导航到类定义插件

> ID：321220
> 
> 赞同：1
> 
> 时间：2008-11-26T16:01:30.907
> 
> 标签：visual-studio, add-in, visual-studio-addins

我正在寻找一个 Visual Studio 加载项，它可以分析光标位置周围的文本并导航到相应的类定义。

例如，我有这个当前打开的 XML 文件：

```
<object id="abc" type="MyProject.Foo.Bar, MyProject"/> 
```

如果我将光标放在*类型*属性上的双引号之间的某个位置，则加载项应获取字符串*“MyProject.Foo.Bar, MyProject”*并在当前解决方案中搜索给定类型的所有项目和项目引用，如果它找到一个，它应该导航到类定义（如果源代码在当前解决方案中不可用，则导航到元数据）。

如果这样的加载项不存在，我将不胜感激一些可以帮助我编写的指针。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T16:41:40.763

好吧，您可以使用VS2008 IDE 附带的“**[代码定义窗口”。](http://msdn.microsoft.com/en-us/library/f5yx24a6(VS.80).aspx)**当您放置光标时，Code Def 窗口会使用该类型的源代码动态更新。*适用于常规源文件.. 手头没有 IDE 来验证 XAML/XML*

您也可以“跳转到符号”键组合，但您需要为此添加 CodeRush Express。Shift+Ctrl+Q。更多细节[在这里](http://madcoderspeak.blogspot.com/2008/11/ide-ninja-shortcuts-with-vs2008-and.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-05T18:52:38.203

[在Visual Assist](http://www.wholetomato.com/)中使用 Alt+G 命令。

# linq - 如何在 Linq 中合并集合的集合

> ID：321229
> 
> 赞同：51
> 
> 时间：2008-11-26T16:03:39.763
> 
> 标签：linq, collections, linq-to-objects

我希望能够融合`IEnumerable<IEnumerable<T>>`到`IEnumerable<T>`（即将所有单独的集合合并为一个）。`Union`运算符仅适用于两个集合。任何的想法？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2008-11-26T16:05:45.733

尝试

```
var it = GetTheNestedCase();
return it.SelectMany(x => x); 
```

SelectMany 是一个 LINQ 转换，它本质上说“对于集合中的每个项目，返回集合的元素”。它将一个元素变成多个元素（因此是 SelectMany）。它非常适合将集合的集合分解为一个平面列表。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-21T21:33:00.070

```
var lists = GetTheNestedCase();
return
    from list in lists
    from element in list
    select element; 
```

是使用 C# 3.0 查询表达式语法执行此操作的另一种方法。

# javascript - 在特定 div 之外的页面上的任何地方单击事件

> ID：321239
> 
> 赞同：10
> 
> 时间：2008-11-26T16:06:52.130
> 
> 标签：javascript, jquery

当用户单击该 div 之外的页面上的任何位置时，我想隐藏该 div。如何使用原始 javascript 或 jQuery 做到这一点？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-11-26T16:16:02.937

给文档附加一个点击事件来隐藏 div：

```
$(document).click(function(e) {
   $('#somediv').hide();
}); 
```

将点击事件附加到 div 以阻止对其传播到文档的点击：

```
$('#somediv').click(function(e) {
   e.stopPropagation();
}); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T16:10:55.910

第一个想法，在原始 javascript 中（来自[这篇文章](http://www.webdeveloper.com/forum/showpost.php?p=465274&postcount=4)）：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>Untitled Document</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <meta http-equiv="Content-Style-Type" content="text/css">
    <meta http-equiv="Content-Script-Type" content="text/javascript">
    <style type="text/css">
      <!--
      #mydiv{
        background-color: #999999;
        height: 100px;
        width: 100px;
      }
      -->
    </style>
    <script type="text/javascript">
      document.onclick=check;
      function check(e)
      {
        var target = (e && e.target) || (event && event.srcElement);
        var obj = document.getElementById('mydiv');
        if(target!=obj){obj.style.display='none'}
      }
    </script>
  </head>
  <body>
    <div id="mydiv">my div</div>
  </body>
</html> 
```

用 IE6 和 FireFox3.1 测试，它确实像宣传的那样工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T16:49:34.710

听起来您确实想要一个模态对话框。这个 jQuery 插件[http://code.google.com/p/simplemodal/](http://code.google.com/p/simplemodal/)看起来很有潜力。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T18:03:07.450

如果 div 具有焦点，则可以附加到 onblur 事件。

# c++ - 死代码识别 (C++)

> ID：321241
> 
> 赞同：54
> 
> 时间：2008-11-26T16:07:29.147
> 
> 标签：c++, static-analysis, dead-code

我有一个在 Visual Studio 2008 下编译的大型遗留 C++ 项目。我知道有相当数量的“死”代码无法在任何地方访问——未调用的方法，未使用的整个类。

我正在寻找一种可以通过**静态分析**识别这一点的工具。

这个问题：[遗留 C/C++ 项目中的死代码检测](https://stackoverflow.com/questions/229069/dead-code-detection-in-legacy-cc-project)建议使用代码覆盖工具。这不是一个选项，因为测试覆盖率不够高。

它还提到了一个-Wunreachable-code。gcc 的选项。我想要 Visual Studio 类似的东西。我们已经使用链接器的 /OPT:REF 选项来删除冗余代码，但这并没有在有用的级别报告死代码（当与 /VERBOSE 一起使用时，有超过 100,000 行，包括来自库的很多行）。

是否有更好的选项可以很好地与 Visual Studio 项目配合使用？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-30T20:15:43.327

我知道 Gimpel 的 Lint 产品（[PC-Lint](http://www.gimpel.com/html/pcl.htm)和[Flexelint](http://www.gimpel.com/html/flex.htm)）将识别无法访问的代码和未使用/未引用的模块。

它们都属于静态分析工具的范畴。

我与 Gimpel 没有隶属关系，只是一个满意的长期客户。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-26T16:37:53.690

你会想要一些类似于 QA-C++ ( [http://www.programmingresearch.com/QACPP_MAIN.html](http://www.programmingresearch.com/QACPP_MAIN.html) ) 的东西，另请参阅[http://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis](http://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis)了解类似产品。

您正在寻找一种检测无法访问代码的静态代码分析工具；许多编码指南（例如 MISRA-C++，如果我没记错的话）要求不存在无法访问的代码。专门用于执行此类指南的分析工具将是您的最佳选择。

您还希望能够找到该工具的其他用途。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-26T16:43:12.460

我不知道 Visual C，并且还推荐了 -Wunreachable-code 特定的覆盖工具。作为您的情况的解决方案，我会尝试以下方法：

1.  使用 ctags（或类似程序）制作源代码中所有符号的列表
2.  在您的编译器中启用死代码消除（我假设它默认为打开）
3.  启用整个程序/链接时间优化（这样他就知道其他外部不需要模块中未使用的函数并被丢弃）
4.  从二进制文件中取出符号并将它们与 1 中的符号进行比较。

另一种方法可能是一些调用图生成工具（例如 doxygen）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-08-28T12:22:53.830

我建议您使用几种方法： 1\. GCC 有一些有用的编译标志：

```
-Wunused-function
-Wunused-label
-Wunused-value
-Wunused-variable
-Wunused-parameter
-Wunused-but-set-parameter 
```

2\. Cppcheck 有一些有用的功能，例如：

```
 --enable=unusedFunction 
```

3\. 使用之前建议的静态分析器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T18:05:06.167

一种对我有用的方法——使用 Delphi——是启用调试，并在调试器下运行你的程序。

当 Delphi 程序在调试器下运行时，IDE 会在空白处显示哪些代码行可以设置为断点。真正死掉的代码——即已被链接器/编译器剥离的代码是显而易见的，因为断点不能在那里设置。

一些附加说明，因为评论者似乎误解了这一点：

a：您不需要尝试在每一行设置断点。只需在 IDE 中打开源文件，然后快速滚动浏览它。死代码很容易被发现。

b：这不是“代码覆盖率”检查。您无需运行该应用程序即可查看它是否到达线路。

c：我对VS2008不够熟悉，所以不能说这个建议是否可行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-04-22T12:38:58.797

要么
1) MSVC 在内置[静态分析工具](https://msdn.microsoft.com/en-us/library/hh419384.aspx)中使用不足。
2) MSVC[市场](https://marketplace.visualstudio.com/)有很多工具，包括对大多数免费工具的支持，包括[CppCheck](https://marketplace.visualstudio.com/items?itemName=Alexium.Cppcheckadd-in)

对于市场应用程序，您将需要最新版本的 Visual Studio，但免费的“[社区版](https://www.visualstudio.com/free-developer-offers/)”具有非常宽松的许可。

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2009-02-18T21:12:01.010

编写一个脚本，随机删除一个函数（从源代码中）并从头开始重新编译所有内容。如果它仍然编译 - 该函数是死代码。

# regex - 在 TinyPG 中使用 BNF 中的现有语言？

> ID：321245
> 
> 赞同：2
> 
> 时间：2008-11-26T16:09:14.340
> 
> 标签：regex, bnf, ebnf, compiler-compiler, tinypg

如何在 TinyPG中使用[GOLD 元语法](http://www.devincook.com/GOLDParser/doc/meta-language/index.htm)（RegExp + BNF）中的[这些 BNF 语法？](http://www.devincook.com/GOLDParser/grammars/index.htm)我是 BNF 的新手，所以大约需要进行什么样的转换才能将 BNF 转换为 EBNF？

我相信这应该很简单，因为 TinyPG 需要 RegExp + **EBNF**，而 GOLD 语法是 RegExp + **BNF**。

另外，是否有任何可用语言的 TinyPG 源代码，只是为了看看我需要做什么样的转换？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-06T02:12:01.750

EBNF 并不*完全*向后兼容 BNF，但实际上差异很小，您应该熟悉文档

[http://www.cs.cmu.edu/~pattis/misc/ebnf.pdf](http://www.cs.cmu.edu/~pattis/misc/ebnf.pdf)

首先，您必须处理特殊字符 <>|:= （用双引号括起来）。

你可以只使用 GOLD 元语法引擎来输出你的解析器，如果它可以是一种受支持的语言 - 而不是使用 TinyPG...

这就引出了一个问题——当你实现它时，你的解析器会使用什么语言？

# asp.net - 如何在 asp.net 中从客户端网络摄像头捕获图像

> ID：321246
> 
> 赞同：6
> 
> 时间：2008-11-26T16:09:24.980
> 
> 标签：asp.net, webcam

我正在开发一个 ASP.Net 应用程序，我希望用户能够使用本地网络摄像头拍照，然后将其上传到服务器。当然，我可以依靠用户通过他们本地安装的软件手动执行此操作，将图像保存为文件并进行正常的文件上传。但是，我真正想做的是将它们全部合并到浏览器的 UI 中。我知道这意味着访问本地资源，所以我是否需要 ActiveX 控件或 Silverlight，或者我可以在 Javascript 中做些什么？

这最初是为 Intranet 应用程序设计的，因此我可以控制客户端的环境，包括规定浏览器等，这意味着我*可以*在必要时使用 ActiveX 控件。但是，如果我能以通用的方式编写它，这样它就可以在互联网应用程序中普遍使用（很高兴规定它只适用于 Windows 客户端，但让它在 FireFox 中运行会很好）。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T01:22:20.433

目前唯一可接受且通用的方法是 Flash/Flex 应用程序。Flash 播放器在世界上的每个浏览器中都预设了字面意思，并且所有浏览器都具有这种功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T17:03:45.073

[VideoCap Pro](http://www.viscomsoft.com/products/videocappro/index.html)很受欢迎，它提供了一个ActiveX版本，你检查过吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T02:29:03.777

这对我来说听起来很可疑。您意识到这可以应用于邪恶的应用程序，对吗？一个网页，当用户浏览它时，他们不知道，他们的网络摄像头会拍下他们的照片。……我不喜欢。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-04T12:20:13.790

您可以使用[Nimbb API](http://nimbb.com/Help/Api.aspx)在浏览器中进行网络摄像头视频录制。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-06T09:48:39.643

可以从 asp.net 中的客户端网络摄像头获取图像，您必须使用 Visual Studio 2010 安装 Silverlight 4：

转到以下链接：

[http://wildermuth.com/2009/11/23/Taking_a_WebCam_Photo_with_Silverlight](http://wildermuth.com/2009/11/23/Taking_a_WebCam_Photo_with_Silverlight)

# c# - 如何自定义 ObjectQuery 的 Execute 方法？

> ID：321257
> 
> 赞同：2
> 
> 时间：2008-11-26T16:10:59.250
> 
> 标签：c#, .net, linq-to-entities

我的数据库中有一个类似分区的数据库模式。

有一个名为“分区”的表`SITE`，并且每个其他表都有该表的外键 ( `SITE\_FK`)。

我为 ObjectContext 编写了一个部分类，添加了一个`SITE\_ID`属性和一个设置该属性的构造函数。

现在，在我用一些实例化 ObjectContext 之后，`SITE\_ID`我需要用这个 ObjectContext 构建的每个查询都测试它`SITE\_FK = SITE\_ID`（存储在 ObjectContext 中）。最好不必在代码中的每个查询中显式测试它，而是在 ObjectQuery 中以某种方式“*内部”测试它。*

第一个想法是向 ObjectQuery.Execute 方法添加一些功能，该方法向查询添加了一个 Where 但我找不到如何执行此操作。

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-01-12T00:02:22.670

您是否尝试过覆盖[`SaveChanges`](http://msdn.microsoft.com/en-us/library/dd395500.aspx "ObjectContext.SaveChanges 方法")？

您可能还需要考虑其他一些[方法](http://msdn.microsoft.com/en-us/library/system.data.objects.objectcontext_methods.aspx "对象上下文方法")。`ObjectContext`

# apache - 如何设置子域，如 blogspot

> ID：321259
> 
> 赞同：4
> 
> 时间：2008-11-26T16:12:07.157
> 
> 标签：apache, dns, subdomain

当用户注册到我的网站时，应该如何为用户设置子域。

需要哪些基础设施？我正在使用 Linux 服务器。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T16:21:04.550

您可以为每个已知子域使用特定的 DNS（`CNAME`或`A`/ `AAAA`）条目，也可以使用接受 *.example.com 的通配符 DNS 条目：

```
$ORIGIN example.com
foo     IN A 12.34.6.78
bar     IN A 12.34.6.78 
```

或者

```
$ORIGIN example.com
*       IN A 12.34.6.78 
```

后者的优点是，一旦服务运行，不需要更改 DNS 或 Apache 配置。缺点是所有此类通配符查找必须（根据定义）最终返回相同的 IP 地址。

Apache 配置将取决于您对最终用户控制和安全性的要求。请注意，如果用户有权在服务器上运行 CGI 脚本，则需要进行额外设置以确保安全完成。

根据内容是静态的还是动态的，这也会影响您的配置：

1.  用于[`mod_vhost_alias`](http://httpd.apache.org/docs/2.2/mod/mod_vhost_alias.html)将各个虚拟主机映射到服务器上的各个目录。

2.  如果你**真的**想要，为每个已知站点创建一个单独的`<VirtualHost>`部分，但是每次新用户注册时你都必须重新启动 Apache

3.  使用单个，然后在呈现输出的脚本中`<VirtualHost>`查看请求 URL 的主机名部分（来自环境变量），以确定要显示哪个用户的内容。`$SERVER_NAME`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T16:17:26.820

您可以在 DNS 设置中为每个子域创建一个 CNAME 条目/A 记录

> CNAME 记录是您的域管理设置中的一条记录，可让您控制域的子域。

**要将其与注册一起**自动化，您可以编写一个脚本，该脚本在每个用户注册时执行。****

 **您也可以参考此链接，了解 Apache 的分步过程：

**[如何在apache中设置子域](http://www.varslashlog.com/2008/10/31/how-to-setup-subdomains-in-apache/)**

*（既然你提到了Linux，我假设它一定是APache。如果不是，请说明）*

**替代解决方案**

您还可以在同一线程中参考[Alnitak 给出的通配符解决方案。](https://stackoverflow.com/questions/321259/how-to-setup-sub-domains-like-blogspot#321292)我发现他的方法更简单。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T16:21:34.330

基础架构包括访问 dns 服务器以添加通配符条目，并在 Apache 中重写规则。

试试这些答案：

*   [如何让 PHP 为每个用户自动创建子域？](https://stackoverflow.com/questions/183928/how-to-let-php-to-create-subdomain-automatically-for-each-user)
*   [如何在 webapp 中创建子域用户帐户](https://stackoverflow.com/questions/1180/how-to-make-subdomain-user-accounts-in-a-webapp)

或此链接：

*   [http://jam.jrox.com/docs/index.php?article=76](http://jam.jrox.com/docs/index.php?article=76)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T16:22:56.263

如果您使用 Linux 服务器，我假设您使用 Apache 作为您的网络服务器。

您必须为子域和虚拟主机设置正确的 DNS 路由。

虚拟主机相当容易设置，但我不确定以编程方式即时执行它们有多容易。

大多数情况下，它就像编辑 apache 配置文件并添加以下内容一样简单：

```
Port 80
ServerName www.mydomain.com

NameVirtualHost *:80

<VirtualHost *:80>
DocumentRoot /www/user-bob
ServerName bob.mydomain.com
...
</VirtualHost>

<VirtualHost *:80>
DocumentRoot /www/user-sally
ServerName sally.mydomain.com
...
</VirtualHost> 
```

[VirtualHost 文档](http://httpd.apache.org/docs/1.3/vhosts/examples.html)可能对您有所帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T16:24:54.637

Apache 允许您基于单个服务器上的子域指定任意数量的“站点”。创建一个新的“站点定义”文件，其中包含适当的子域信息，以及适当的 DNS 通配符，将满足您的需求。

换句话说，过程是这样的：

1.  设置通配符，以便 *.mysite.com 指向正确的服务器。
2.  当新用户注册时，创建适当的 Apache 站点定义文件 - 您可能会有一个基本模板，您可以将正确的子域信息放入并保存。
3.  让 Apache 重新读取其配置。
4.  利润。

**重要**这是基于 Debian 风格的 Apache 配置，其中配置文件包含在一个目录中，主配置读取该目录中的所有配置文件。这将大大简化事情，因为添加/删除子域将意味着添加/删除文件，而不是编辑单个文件，因此该过程将更容易自动化。

# cognos - Cognos 中日期提示中带有动态月份和年份的下拉列表框

> ID：321260
> 
> 赞同：1
> 
> 时间：2008-11-26T16:12:10.853
> 
> 标签：cognos

我想将当前月份和前两个月添加到提示中，供用户选择。

例如，如果本月是`2008 Nov`，`ddlbox`则应显示以下内容：

```
112008
102008
092008 
```

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T16:24:10.207

```
<asp:DropDownList ID="DropDownList1" runat="server">
</asp:DropDownList>

for (int i = 0; i < 3; i++)
{
    ListItem item = new ListItem(string.Format("{0: MM/yyyy}", DateTime.Now.AddMonths(-i)));
    DropDownList1.Items.Add(item);
} 
```

尝试这个 ：）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T12:01:03.503

您还可以使用 SQL 创建一个查询主题，例如这个 Oracle 示例：

```
SELECT to_char(add_months(SYSDATE, -1 * LEVEL + 1), 'MMYYYY') AS mon
FROM   dual
CONNECT BY rownum < 4 
```

# vb.net - 在 vb.net 中声明为 new 和 as something = new something 有什么区别？

> ID：321265
> 
> 赞同：4
> 
> 时间：2008-11-26T16:15:50.987
> 
> 标签：vb.net

我见过这样的代码

```
Dim s as something = new something
Dim s as new something 
```

有什么不同？有没有？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-26T16:20:50.243

略有不同。

第一个允许您执行以下操作：

```
Dim s as ParentType = new InheritedType 
```

第二个没有。

这样做的“优势”是`s`可以有许多与 ParentType 相关的不同类型，而不会在运行时爆炸。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T16:20:47.077

没有区别。就 VB 而言，这些签名是相同的。一个人的打字少了:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T17:06:55.377

没有区别。

您可能会看到一些喜欢

```
Dim s as something = new something 
```

超过

```
Dim s as new something 
```

这可能是对 Vb6 的保留（`as new`在 VB6 中，您会想到更多，并且有令人讨厌的副作用）。这是用 Vb.Net “修复”的事情之一

重申一下，在 Vb.Net 中，语句是等效的，即两个语句将构建完全相同的 IL。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-11-26T16:20:39.013

我相信你所做的只是将某物作为某物。

# java - Java中的文本文件拆分库

> ID：321267
> 
> 赞同：1
> 
> 时间：2008-11-26T16:16:30.597
> 
> 标签：java, file

我的程序接收大型 CSV 文件并将它们转换为 XML 文件。为了获得更好的性能，我想将此文件拆分为（例如）500 行的较小段。有哪些可用的用于拆分文本文件的 Java 库？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T16:54:53.030

我不明白通过将 CSV 文件拆分成更小的文件会得到什么？使用 Java，您可以随时读取和处理文件，而不必一次全部读取...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T16:22:19.650

您打算如何处理这些数据？

如果只是按记录处理记录，那么面向事件（SAX 或 StaX）解析将是可行的方法。对于逐个记录的处理，现有的“管道”工具包可能适用。

[您可以使用像这个](http://www.developer.com/tech/article.php/630491)或[这个 Splitter.java](http://www.programmersheaven.com/download/30541/1/%5AipView.aspx)这样的拆分器函数来预处理您的文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T11:55:17.800

一旦文件被分割，你打算如何分配工作？

我在一个名为 GridGain 的框架上做了类似的事情——它是一个网格计算框架，允许您在计算机网格上执行任务。

有了这个，您就可以使用缓存提供程序（例如 JBoss Cache）将文件分发到多个节点，指定开始和结束行号和进程。这在以下 GridGain 示例中进行了概述：http: [//www.gridgainsystems.com/wiki/display/GG15UG/Affinity+MapReduce+with+JBoss+Cache](http://www.gridgainsystems.com/wiki/display/GG15UG/Affinity+MapReduce+with+JBoss+Cache)

或者，您可以查看诸如 Hadoop 和 Hadoop 文件系统之类的东西，用于在不同节点之间移动文件。

通过将文件加载到缓存中，然后分配文件的某些“块”以由单独的线程处理，可以在本地计算机上完成相同的概念。网格计算的东西真的只适用于非常大的问题，或者为您的解决方案透明地提供某种程度的可伸缩性。您可能需要注意 IO 瓶颈和锁定，但是您可以在文件拆分后将“作业”分派到一个简单的线程池中。

# xml - 意外发现 里面<<< >>>。这不是有效的子元素

> ID：321272
> 
> 赞同：-1
> 
> 时间：2008-11-26T16:17:56.147
> 
> 标签：xml, perl, validation, xsd, schema

我正在尝试使用[XML::Validator::Schema](http://search.cpan.org/~samtregar/XML-Validator-Schema/Schema.pm)针对架构验证 xml 文件。
但它给了我这个错误：

```
Found unexpected <Submission> inside <<<<ROOT>>>>.  This is not a valid child element. [Ln: 2, Col:119] 
```

注意：`<Submission>`是我之后的第一个元素`<xml version="1.0" encoding="UTF-8"?>`

我不明白这意味着什么。
感谢任何帮助。

XML 是：

```
<?xml version="1.0" encoding="utf-8"?>
<Submission xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="layout-topologie.xsd">
 <Return>
  <NR4>
   <NR4Slip>
    <RCPNT_NM>
     <snm>SYMPSOM</snm>
     <gvn_nm>HOMER</gvn_nm>
     <init>A</init>
    </RCPNT_NM>
    <SEC_RCPNT_NM></SEC_RCPNT_NM>
    <RCPNT_ADDR>
     <addr_l1_txt>C/O ABC A/C 555 6666</addr_l1_txt>
     <addr_l2_txt>9999 - 88 STREET</addr_l2_txt>
     <cntry_cd>CAN</cntry_cd>
     <fgn_pstl_cd>T4S1M5</fgn_pstl_cd>
    </RCPNT_ADDR>
    <fssn_nbr>607-448-900</fssn_nbr>
    <nr_acct_nbr>NRY454080</nr_acct_nbr>
    <rcpnt_tcd>01</rcpnt_tcd>
    <payr_nbr>100000</payr_nbr>
    <inc_1_tcd>11</inc_1_tcd>
    <crcy_1_cd>CAD</crcy_1_cd>
    <tx_xmpt_1_cd>AB</tx_xmpt_1_cd>
    <inc_2_tcd>02</inc_2_tcd>
    <crcy_2_cd>CAD</crcy_2_cd>
    <tx_xmpt_2_cd>PQ</tx_xmpt_2_cd>
    <NR4_AMT>
     <gro_1_incamt>1.1</gro_1_incamt>
     <nr_tx_1_amt>0.00</nr_tx_1_amt>
     <gro_2_incamt>90000000</gro_2_incamt>
     <nr_tx_2_amt>0.00</nr_tx_2_amt>
    </NR4_AMT>
    <rpt_tcd>O</rpt_tcd>
   </NR4Slip>
   <NR4Slip>
    <RCPNT_NM>
     <snm>CARTMAN</snm>
     <gvn_nm>ERIC</gvn_nm>
    </RCPNT_NM>
    <SEC_RCPNT_NM>
     <sec_snm>SYMPSON</sec_snm>
     <sec_gvn_nm>BART</sec_gvn_nm>
    </SEC_RCPNT_NM>
    <RCPNT_ADDR>
     <addr_l1_txt>C/O DEFG A/C 555 2222</addr_l1_txt>
     <addr_l2_txt>9999 - 88 STREET</addr_l2_txt>
     <cntry_cd>CAN</cntry_cd>
     <fgn_pstl_cd>T4S1M5</fgn_pstl_cd>
    </RCPNT_ADDR>
    <fssn_nbr>607-448-901</fssn_nbr>
    <nr_acct_nbr>NRY454080</nr_acct_nbr>
    <rcpnt_tcd>01</rcpnt_tcd>
    <payr_nbr>200000</payr_nbr>
    <inc_1_tcd>11</inc_1_tcd>
    <crcy_1_cd>USD</crcy_1_cd>
    <tx_xmpt_1_cd>BC</tx_xmpt_1_cd>
    <inc_2_tcd>02</inc_2_tcd>
    <crcy_2_cd>USD</crcy_2_cd>
    <tx_xmpt_2_cd>QR</tx_xmpt_2_cd>
    <NR4_AMT>
     <gro_1_incamt>20.01</gro_1_incamt>
     <nr_tx_1_amt>10</nr_tx_1_amt>
     <gro_2_incamt>8000000</gro_2_incamt>
     <nr_tx_2_amt>0.1</nr_tx_2_amt>
    </NR4_AMT>
    <rpt_tcd>O</rpt_tcd>
   </NR4Slip>
   <NR4Summary>
    <PAYR_NM>
     <l1_nm>THE BANK OF NOVA SCOTIA</l1_nm>
    </PAYR_NM>
    <PAYR_ADDR>
     <addr_l1_txt>HR SHARED SERVICES PENSION DEPT.</addr_l1_txt>
     <addr_l2_txt>7TH FLOOR, 888 BIRCHMOUNT ROAD</addr_l2_txt>
    </PAYR_ADDR>
    <tx_yr>2007</tx_yr>
    <slp_cnt>10</slp_cnt>
   </NR4Summary>
  </NR4>
 </Return>
</Submission> 
```

XSD 是：

```
<?xml version="1.0"?>
<xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <!-- @@@@ Definition of NR4  ComplexTypes @@@@  2008/sept/03  Version# 2.8  -->
    <xsd:complexType name="NR4SlipType">
        <xsd:all>
            <xsd:element name="RCPNT_NM" type="NameType" minOccurs="0"/>
            <xsd:element name="SEC_RCPNT_NM" type="NameType_2" minOccurs="0"/>
            <xsd:element name="ENTPRS_NM" type="NR4_Line2Type" minOccurs="0"/>
            <xsd:element name="RCPNT_ADDR" type="NR4ForeignAddressType" minOccurs="0"/>
            <xsd:element name="tx_cntry_cd" type="char3Type"/>
            <xsd:element name="fssn_nbr" type="char20Type"/>
            <xsd:element name="nr_acct_nbr" type="nrType"/>
            <xsd:element name="rcpnt_tcd" type="indicator1-5Type"/>
            <xsd:element name="payr_nbr" type="char20Type" minOccurs="0"/>
            <xsd:element name="inc_1_tcd" type="numeric2Type" minOccurs="0"/>
            <xsd:element name="crcy_1_cd" type="char3Type" minOccurs="0"/>
            <xsd:element name="NR4_AMT" type="NR4AmountType" minOccurs="0"/>
            <xsd:element name="tx_xmpt_1_cd" type="char1Type" minOccurs="0"/>
            <xsd:element name="inc_2_tcd" type="numeric2Type" minOccurs="0"/>
            <xsd:element name="crcy_2_cd" type="char3Type" minOccurs="0"/>
            <xsd:element name="tx_xmpt_2_cd" type="char1Type" minOccurs="0"/>
            <xsd:element name="rpt_tcd" type="slipDataType"/>
        </xsd:all>
    </xsd:complexType>
    <xsd:complexType name="NR4AmountType">
        <xsd:all>
            <xsd:element name="gro_1_incamt" type="decimal11Type" minOccurs="0"/>
            <xsd:element name="nr_tx_1_amt" type="decimal11Type" minOccurs="0"/>
            <xsd:element name="gro_2_incamt" type="decimal11Type" minOccurs="0"/>
            <xsd:element name="nr_tx_2_amt" type="decimal11Type" minOccurs="0"/>
        </xsd:all>
    </xsd:complexType>
    <xsd:complexType name="NR4SummaryType">
        <xsd:all>
            <xsd:element name="nr_acct_nbr" type="nrType"/>
            <xsd:element name="PAYR_NM" type="Line3Type"/>
            <xsd:element name="PAYR_ADDR" type="NR4CanadaAddressType" minOccurs="0"/>
            <xsd:element name="CNTC" type="ContactType2"/>
            <xsd:element name="tx_yr" type="yearType"/>
            <xsd:element name="slp_cnt" type="int7Type"/>
            <xsd:element name="rmt_tcd" type="indicator1-2Type" minOccurs="0"/>
            <xsd:element name="rpt_tcd" type="otherDataType"/>
            <xsd:element name="NR4_TAMT" type="NR4TotalsType" minOccurs="0"/>
        </xsd:all>
    </xsd:complexType>
    <xsd:complexType name="NR4TotalsType">
        <xsd:all>
            <xsd:element name="tot_gro_1_incamt" type="decimal13Type" minOccurs="0"/>
            <xsd:element name="tot_nr_tx_1_amt" type="decimal13Type" minOccurs="0"/>
            <xsd:element name="tot_gro_2_incamt" type="decimal13Type" minOccurs="0"/>
            <xsd:element name="tot_nr_tx_2_amt" type="decimal13Type" minOccurs="0"/>
            <xsd:element name="tot_nrpt_incamt" type="decimal13Type" minOccurs="0"/>
            <xsd:element name="tot_nr_nrpt_tx_amt" type="decimal13Type" minOccurs="0"/>
        </xsd:all>
        <xsd:attribute name="tot_incamt" type="xsd:string"/>
        <xsd:attribute name="tot_tx_wthld" type="xsd:string"/>
    </xsd:complexType>
</xsd:schema> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T18:36:09.910

*您已经定义了几种类型，但是您还没有定义任何元素（除了那些*定义为您定义的类型的子组件的元素）。不仅`<Submission>`没有定义，也没有定义`<Return>`（这是它的直接子元素），也没有定义`<NR4>`，`<NR4Slip>`等等。

您需要一系列`<xsd:element>`块来将您定义的类型映射到实际的元素/标签。（以及 and 的声明`<Return>`，`<NS4>`但由于它们似乎只出现在 内`<Submission>`，您可能只想将它们内联声明为 的声明的一部分`<Submission>`。）

这是一个声明，`<Submission>`它使用您现有的类型，但内联声明其他元素。这是完全未经测试的，在我头上的，在我手头没有 ORA 的“XML Schema”副本的情况下在公共 wi-fi 上输入的：

```
<xsd:element name="Submission" nillable="false">
  <xsd:complexType>
    <xsd:sequence maxOccurs="1" minOccurs="1">
      <xsd:element name="Return">
        <xsd:complexType>
          <xsd:sequence maxOccurs="1" minOccurs="1">
            <xsd:element name="NS4">
              <xsd:complexType>
                <xsd:sequence>
                  <xsd:element name="NR4Slip" type="NR4SlipType" />
                  <xsd:element name="NR4Summary" type="NR4SummaryType" />
                </xsd:sequence>
              </xsd:complexType>
            </xsd:element>
          </xsd:sequence>
        </xsd:complexType>
      </xsd:element>
    </xsd:sequence>
  </xsd:complexType>
</xsd:element> 
```

这不会限制您可以拥有的数量`<NR4Slip>`或块数；`<NR4Summary>`您可能希望在最里面的标签上使用`minOccurs`和/或属性来设置它。内联声明也绕过实际映射或到元素。`maxOccurs``<xsd:element>``NR4SlipType``NR4SummaryType`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T16:46:27.290

看起来您的 xsd 中没有提交元素。我也没有看到返回元素。你想定义它。

另一方面，保罗，感谢您让我在第一份工作中被录用并带我飞翔。

# database - 面向列的数据库的建议

> ID：321280
> 
> 赞同：17
> 
> 时间：2008-11-26T16:20:09.887
> 
> 标签：database, column-oriented

我发现数据库通常有两种形式，传统的面向行的 RDBMS 或面向对象的数据库 (OODBMS)。然而，我记得在 90 年代中期，出现了一种面向列的新型数据库。其中一些被赋予了 4GL 一词，但我不认为它是一个固定的术语。

我想知道的是：

*   哪些面向列的数据库仍然存在？
*   这些数据库的性能特点是什么？
*   有没有开源的面向列的数据库？
*   它们与哪些平台进行互操作（.NET、Java 等）
*   你对他们的一般经验是什么？

我记得使用的两个面向列的数据库是 FAME 和 KDB。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-26T16:24:35.027

[HBase是一个以](http://en.wikipedia.org/wiki/HBase)[Google 的 BigTable](http://en.wikipedia.org/wiki/BigTable)为模型的开源的面向列的数据库系统。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-03T07:07:47.597

[Infobright](http://www.infobright.com/)
这是一个面向列的 MySQL 引擎
您可以使用（几乎）所有 MySQL api/接口/工具，但它是面向列的。

它是开源的，并且有免费版本。
非常适合仓储。我在 SQL Server 中有一个 10Gig 的事实表。Infobright 将其压缩为 15MB。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-11T13:04:29.750

还可以查看 Michael Stonebraker 的 C-store： [C-store（包括指向源代码和研究论文的链接）](http://db.lcs.mit.edu/projects/cstore/)

该论文包含有关面向列的数据库的出色观点，应该可以回答您的大部分问题。

引用论文，

```
"Most major DBMS vendors implement record-oriented 
storage systems, where the attributes of a record (or tuple) 
are placed contiguously in storage.  With this row store 
architecture, a single disk write suffices to push all of the 
fields of a single record out to disk.  Hence, high 
performance writes are achieved, and we call a DBMS 
with a row store architecture a write-optimized system.  

In contrast, systems oriented toward ad-hoc querying 
of large amounts of data should be read-optimized.  Data 
warehouses represent one class of read-optimized system,
in which periodically a bulk load of new data is 
performed, followed by a relatively long period of ad-hoc 
queries. Other read-mostly applications include customer 
relationship management (CRM) systems, electronic 
library card catalogs, and other ad-hoc inquiry systems.  In 
such environments, a column store architecture, in which 
the values for each single column (or attribute) are stored 
contiguously, should be more efficient.  This efficiency 
has been demonstrated in the warehouse marketplace by 
products like Sybase IQ [FREN95, SYBA04], Addamark  
[ADDA04], and KDB [KDB04]. In this paper, we discuss 
the design of a column store called C-Store that includes a 
number of novel features relative to existing systems." 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-26T16:29:16.343

[Sybase IQ](http://www.sybase.com/products/datawarehousing/sybaseiq)是我听说过的一种。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-10-28T11:35:16.913

[InfiniDB](http://www.infinidb.org/)最近由 Calpont 发布了开源 (GPLv2)。它支持大多数 MySQL API 并以面向列的方式存储数据，并针对大规模分析处理进行了优化。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-26T16:26:19.093

这是不同的面向列的 DBMS wiki 具有 [面向列的 DBMS 实现](https://en.wikipedia.org/wiki/List_of_column-oriented_DBMSes)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-11T13:00:33.020

Sybase IQ 是面向列的。创建表时，所有列都会自动编制索引，并且列中的数据会被很好地压缩。

这是一个不错的 OLAP 数据库（...数据仓库），但我不建议将它用于任何类型的事务处理，因为它是为数据仓库操作而设计的。

至于性能特征，SELECTS 对于大量数据非常快，但与标准 OLTP DB（例如 Sybase ASE）相比，INSERT / UPDATE / DELETE 非常慢。表锁定也与 OLTP 数据库有很大不同，因此在 MAIN 数据存储中工作时，需要为写操作（INSERTS 等）使用排他表锁定。

否则它支持 T-SQL（Sybase 版本）和 Watcom SQL。

干杯，

凯文

# ruby - 如何检查 ICMP Ping / Echo 中的返回数据包内容？

> ID：321293
> 
> 赞同：2
> 
> 时间：2008-11-26T16:21:17.840
> 
> 标签：ruby, ping, icmp

在验证 ping 回显时，实用程序/库似乎通常只检查数据包的校验和，而实际上并没有确认发出的有效负载与返回的有效负载相匹配。例如，Wireshark 的 ICMP 解析器只检查错误的校验和，而这也是 Ruby 的[net-ruby](http://raa.ruby-lang.org/project/net-ping/)检查的全部内容。

我正在调试一个低级网络驱动程序问题，我需要确认收到的数据没有被破坏，所以我想使用[ICMP Echo](https://www.rfc-editor.org/rfc/rfc792)之类的低级请求来测试我的驱动程序。但是，我现有的 Ping 工具是不够的，因为我担心校验和可能与回显响应中包含的数据匹配，而回显响应中的数据与回显请求中的数据不匹配。因此，即使它们都有有效的校验和（校验和代码中没有错误），数据接收部分也存在错误，因此我的驱动程序没有收到主机认为它正在发送的内容。

我如何检查回显有效负载以确认它与我发送的内容相同？如果我可以使用独立的“偏执 ping”实用程序，那也很好——我只需要能够改变 ping 的长度和频率，因为我只在网络泛滥时才看到问题。

我更喜欢 Ruby 库/片段的形式，但任何语言或独立应用程序都是可以接受的，只要我可以将它硬塞到在 Windows 上运行。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T20:37:08.073

我认为您错过了校验和的重点。校验和的目的是验证数据是否完整。发送方根据数据计算校验和，并与数据一起发送。接收器从数据中重新计算校验和，并将其与发送的校验和进行比较。如果它们不匹配，则数据不完整，或者两者之一计算错误。大多数情况下，错误的校验和不会导致数据包丢失，因为那里有很多损坏的协议栈，当然还有数据包管理器，它们不会修复校验和，但如果双方都碰巧正确地做到了，那么校验和检查告诉你数据是完整的。

你在看 TCP 校验和还是 ICMP 校验和？ICMP 校验和不包括 TCP 标头，仅包括 ICMP 类型、代码、校验和和数据字段。TCP 校验和失败并不一定意味着 ICMP 内容不完整，它可能只是意味着 TCP 标头被弄乱了（可能是由于 NAT 损坏）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T21:48:51.470

@Tom：感谢您的回答。你说：

> 接收器从数据中重新计算校验和，并将其与发送的校验和进行比较。

但是你也说：

> ICMP 校验和不包括 TCP 标头，仅包括 ICMP 类型、代码、校验和和数据字段。

回显请求/响应之间的 ICMP 类型不同（一个是 0，另一个是我认为的 8）。因此，根据定义（实际上，如果您使用 Wireshark 看一下），发送请求和回显响应之间的 ICMP 校验和不匹配。

我的问题是，如果 ping 实用程序/库检查了任何内容（通常他们没有），他们只检查以确保校验和与数据匹配。似乎很少有人真正使用回显响应检查发送的数据，以确保两个有效负载相同。请求和响应都可能具有有效的校验和，但有效载荷不同，而且我见过的大多数 Ping 例程都没有检查过这种情况（但它恰好是我遇到的那种错误）设备）。

感谢您查看我的问题并做出回应——非常感谢。

@全部：

在回答我自己的问题时，我能够使用强大的[.Net Ping](http://msdn.microsoft.com/en-us/library/system.net.networkinformation.ping(VS.80).aspx)类，因为它让我可以随时访问接收到的响应缓冲区（与我发现的大多数其他 Ping 库不同）。

# php - 突出PHP中两个字符串的区别

> ID：321294
> 
> 赞同：142
> 
> 时间：2008-11-26T16:21:32.457
> 
> 标签：php, string, diff, word-diff

突出PHP中两个字符串之间差异的最简单方法是什么？

我正在按照 Stack Overflow 编辑历史页面的思路进行思考，其中新文本为绿色，删除的文本为红色。如果有任何预先编写的函数或类可用，那将是理想的。

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2011-02-22T19:23:45.283

刚刚写了一个类来计算最小（不是字面意思）的编辑次数，以将一个字符串转换为另一个字符串：

[http://www.raymondhill.net/finediff/](http://www.raymondhill.net/finediff/)

它有一个静态函数来呈现一个 HTML 版本的差异。

这是第一个版本，可能会得到改进，但它现在工作得很好，所以我把它扔在那里，以防有人需要像我需要的那样有效地生成一个紧凑的差异。

编辑：现在在 Github 上： [https ://github.com/gorhill/PHP-FineDiff](https://github.com/gorhill/PHP-FineDiff)

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-11-26T16:32:53.230

您可以使用 PHP Horde_Text_Diff 包。

但是，此软件包不再可用。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2010-09-24T08:15:41.927

这是一个不错的，也是 [http://paulbutler.org/archives/a-simple-diff-algorithm-in-php/](http://paulbutler.org/archives/a-simple-diff-algorithm-in-php/)

> 解决问题并不像看起来那么简单，在我弄清楚之前，这个问题困扰了我大约一年。我设法用 PHP 用 18 行代码编写了我的算法。这不是进行差异的最有效方法，但它可能是最容易理解的。
> 
> 它的工作原理是查找两个字符串共有的最长单词序列，并递归查找字符串其余部分的最长序列，直到子字符串没有共同的单词。此时它将剩余的新词添加为插入，剩余的旧词作为删除。
> 
> 你可以在这里下载源代码：[PHP SimpleDiff](http://web.archive.org/web/20100830033558/http://github.com/paulgb/simplediff/blob/5bfe1d2a8f967c7901ace50f04ac2d9308ed3169/simplediff.php) ...

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-11-26T16:32:34.043

如果你想要一个健壮的库，[Text_Diff](http://pear.php.net/package/Text_Diff)（一个 PEAR 包）看起来很不错。它有一些非常酷的功能。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2014-02-25T17:07:42.000

这是一个简短的函数，可用于区分两个数组。它实现了[LCS](http://en.wikipedia.org/wiki/Longest_common_subsequence_problem)算法：

```
function computeDiff($from, $to)
{
    $diffValues = array();
    $diffMask = array();

    $dm = array();
    $n1 = count($from);
    $n2 = count($to);

    for ($j = -1; $j < $n2; $j++) $dm[-1][$j] = 0;
    for ($i = -1; $i < $n1; $i++) $dm[$i][-1] = 0;
    for ($i = 0; $i < $n1; $i++)
    {
        for ($j = 0; $j < $n2; $j++)
        {
            if ($from[$i] == $to[$j])
            {
                $ad = $dm[$i - 1][$j - 1];
                $dm[$i][$j] = $ad + 1;
            }
            else
            {
                $a1 = $dm[$i - 1][$j];
                $a2 = $dm[$i][$j - 1];
                $dm[$i][$j] = max($a1, $a2);
            }
        }
    }

    $i = $n1 - 1;
    $j = $n2 - 1;
    while (($i > -1) || ($j > -1))
    {
        if ($j > -1)
        {
            if ($dm[$i][$j - 1] == $dm[$i][$j])
            {
                $diffValues[] = $to[$j];
                $diffMask[] = 1;
                $j--;  
                continue;              
            }
        }
        if ($i > -1)
        {
            if ($dm[$i - 1][$j] == $dm[$i][$j])
            {
                $diffValues[] = $from[$i];
                $diffMask[] = -1;
                $i--;
                continue;              
            }
        }
        {
            $diffValues[] = $from[$i];
            $diffMask[] = 0;
            $i--;
            $j--;
        }
    }    

    $diffValues = array_reverse($diffValues);
    $diffMask = array_reverse($diffMask);

    return array('values' => $diffValues, 'mask' => $diffMask);
} 
```

它生成两个数组：

*   values 数组：出现在差异中的元素列表。
*   掩码数组：包含数字。0：不变，-1：删除，1：添加。

如果您用字符填充数组，它可用于计算内联差异。现在只需一步即可突出差异：

```
function diffline($line1, $line2)
{
    $diff = computeDiff(str_split($line1), str_split($line2));
    $diffval = $diff['values'];
    $diffmask = $diff['mask'];

    $n = count($diffval);
    $pmc = 0;
    $result = '';
    for ($i = 0; $i < $n; $i++)
    {
        $mc = $diffmask[$i];
        if ($mc != $pmc)
        {
            switch ($pmc)
            {
                case -1: $result .= '</del>'; break;
                case 1: $result .= '</ins>'; break;
            }
            switch ($mc)
            {
                case -1: $result .= '<del>'; break;
                case 1: $result .= '<ins>'; break;
            }
        }
        $result .= $diffval[$i];

        $pmc = $mc;
    }
    switch ($pmc)
    {
        case -1: $result .= '</del>'; break;
        case 1: $result .= '</ins>'; break;
    }

    return $result;
} 
```

例如。：

```
echo diffline('StackOverflow', 'ServerFault') 
```

将输出：

```
S<del>tackO</del><ins>er</ins>ver<del>f</del><ins>Fau</ins>l<del>ow</del><ins>t</ins> 
```

小号~~粘性~~服务器~~F~~错误~~哦~~吨

补充笔记：

*   diff 矩阵需要 (m+1)*(n+1) 个元素。因此，如果您尝试区分长序列，您可能会遇到内存不足错误。在这种情况下，首先区分较大的块（例如行），然后在第二遍中区分它们的内容。
*   如果从开头和结尾修剪匹配元素，然后仅在不同的中间运行算法，则可以改进算法。后一个[（更臃肿的）版本](https://gist.github.com/Calmarius/24bdf9b753eb0553c148)也包含这些修改。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-05-01T11:42:35.327

xdiff 还有一个 PECL 扩展：

*   [http://php.net/manual/en/book.xdiff.php](http://php.net/manual/en/book.xdiff.php)
*   [http://pecl.php.net/package/xdiff](http://pecl.php.net/package/xdiff)

尤其：

*   [xdiff_string_diff](http://php.net/manual/en/function.xdiff-string-diff.php) — 制作两个字符串的统一差异

PHP手册中的示例：

```
<?php
$old_article = file_get_contents('./old_article.txt');
$new_article = $_POST['article'];

$diff = xdiff_string_diff($old_article, $new_article, 1);
if (is_string($diff)) {
    echo "Differences between two articles:\n";
    echo $diff;
} 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-11-30T16:22:43.420

我在显示的基于 PEAR 的替代方案和更简单的替代方案上都遇到了可怕的麻烦。因此，这是一个利用 Unix diff 命令的解决方案（显然，您必须在 Unix 系统上或有一个有效的 Windows diff 命令才能工作）。选择您最喜欢的临时目录，并根据需要更改异常以返回代码。

```
/**
 * @brief Find the difference between two strings, lines assumed to be separated by "\n|
 * @param $new string The new string
 * @param $old string The old string
 * @return string Human-readable output as produced by the Unix diff command,
 * or "No changes" if the strings are the same.
 * @throws Exception
 */
public static function diff($new, $old) {
  $tempdir = '/var/somewhere/tmp'; // Your favourite temporary directory
  $oldfile = tempnam($tempdir,'OLD');
  $newfile = tempnam($tempdir,'NEW');
  if (!@file_put_contents($oldfile,$old)) {
    throw new Exception('diff failed to write temporary file: ' . 
         print_r(error_get_last(),true));
  }
  if (!@file_put_contents($newfile,$new)) {
    throw new Exception('diff failed to write temporary file: ' . 
         print_r(error_get_last(),true));
  }
  $answer = array();
  $cmd = "diff $newfile $oldfile";
  exec($cmd, $answer, $retcode);
  unlink($newfile);
  unlink($oldfile);
  if ($retcode != 1) {
    throw new Exception('diff failed with return code ' . $retcode);
  }
  if (empty($answer)) {
    return 'No changes';
  } else {
    return implode("\n", $answer);
  }
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2015-04-08T14:29:43.903

这是我找到的最好的一个。

[http://code.stephenmorley.org/php/diff-implementation/](http://code.stephenmorley.org/php/diff-implementation/)

![在此处输入图像描述](https://i.stack.imgur.com/H0EGN.png)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-26T16:28:25.097

您正在寻找的是“差异算法”。一个快速的谷歌搜索让我找到了[这个解决方案](http://compsci.ca/v3/viewtopic.php?p=142539)。我没有测试它，但也许它会做你需要的。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-04-25T22:28:05.727

[Neil Frasers diff_match_patch 的 php 端口](https://github.com/nuxodin/diff_match_patch-php)（Apache 2.0 许可）

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-04-24T05:18:01.367

我建议从 PHP 核心查看这些很棒的函数：

similar_text — 计算两个字符串之间的相似度

[http://www.php.net/manual/en/function.similar-text.php](http://www.php.net/manual/en/function.similar-text.php)

levenshtein — 计算两个字符串之间的 Levenshtein 距离

[http://www.php.net/manual/en/function.levenshtein.php](http://www.php.net/manual/en/function.levenshtein.php)

soundex — 计算字符串的 soundex 键

[http://www.php.net/manual/en/function.soundex.php](http://www.php.net/manual/en/function.soundex.php)

metaphone — 计算字符串的变音键

[http://www.php.net/manual/en/function.metaphone.php](http://www.php.net/manual/en/function.metaphone.php)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-08-27T11:42:45.013

我尝试了一种简单的方法，其中包含两个文本框和一些颜色样式。注意：我的差异检查器只会突出单词而不是字符的差异。

```
 <?php
    $valueOne = $_POST['value'] ?? "";
    $valueTwo = $_POST['valueb'] ?? "" ;

    $trimValueOne = trim($valueOne);
    $trimValueTwo = trim($valueTwo);

    $arrayValueOne = explode(" ",$trimValueOne);
    $arrayValueTwo = explode(" ",$trimValueTwo);

    $allDiff = array_merge(array_diff($arrayValueOne, $arrayValueTwo), array_diff($arrayValueTwo, $arrayValueOne));
    if(array_intersect($arrayValueOne,$allDiff) && array_intersect($arrayValueTwo,$allDiff)){

        if(array_intersect($arrayValueOne,$allDiff)){
            $highlightArr = array_intersect($arrayValueOne,$allDiff);
            $highlightArrValue = array_values($highlightArr);
            for ($i=0; $i <count($arrayValueOne) ;$i++) { 
                for ($j=0; $j <count($highlightArrValue) ; $j++) { 
                    if($arrayValueOne[$i] == $highlightArrValue[$j]){
                        $arrayValueOne[$i] = "<span>".$arrayValueOne[$i]."</span>";
                    }
                }
            }
            $strOne = implode(" ",$arrayValueOne);
            echo "<p class = \"one\">{$strOne}</p>";
        }if(array_intersect($arrayValueTwo,$allDiff)){
        $highlightArr = array_intersect($arrayValueTwo,$allDiff);
        $highlightArrValue = array_values($highlightArr);
        for ($i=0; $i <count($arrayValueTwo) ;$i++) { 
            for ($j=0; $j <count($highlightArrValue) ; $j++) { 
                    if($arrayValueTwo[$i] == $highlightArrValue[$j]){
                        $arrayValueTwo[$i] = "<span>".$arrayValueTwo[$i]."</span>";
                    }
                }
        }
        $strTwo = implode(" ",$arrayValueTwo);
        echo "<p class = \"two\">{$strTwo}</p>";
        }
    }elseif(!(array_intersect($arrayValueOne,$allDiff) && array_intersect($arrayValueTwo,$allDiff))){
        if($trimValueOne == $trimValueTwo){
            echo"<p class = \"one green\">$trimValueOne</p></p>";
            echo"<p class = \"two green\">$trimValueTwo</p></p>";
        }
        else{
            echo"<p class = \"one \">$trimValueOne</p></p>";
            echo"<p class = \"two \">$trimValueTwo</p></p>";
        }

    }
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <form method="post" action="">
    <textarea type="text" name="value" placeholder="enter first text"></textarea>
    <textarea type="text" name="valueb" placeholder="enter second text"></textarea>
    <input type="submit">
    </form>
</body>
</html> 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-03-11T20:51:40.117

我遇到了 Chris Boulton 基于 Python difflib 编写的 PHP diff 类，这可能是一个很好的解决方案：

[PHP 差异库](https://github.com/chrisboulton/php-diff)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-01-15T15:30:53.267

另一种解决方案（用于并排比较而不是统一视图）：[https](https://github.com/danmysak/side-by-side) ://github.com/danmysak/side-by-side 。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2022-01-17T11:13:22.670

对于那些只是寻找一个非常简单的函数来在字符串 A 中而不是在字符串 B 中查找字符的人，我编写了这个快速且非常简单的函数。

```
function strdiff($a,$b){

    $a = str_split($a);
    $b = str_split($b);

    return array_diff($a,$b);

} 
```

# c++ - FFMPEG 帧到 DirectX 表面

> ID：321298
> 
> 赞同：2
> 
> 时间：2008-11-26T16:22:39.320
> 
> 标签：c++, directx, ffmpeg

给定来自 FFMPEG () 函数的指向 AVFrame 的指针，`avcodec_decode_video`我如何将图像复制到 DirectX 表面？（假设我有一个指向适当大小的 DX X8R8G8B8 表面的指针。）

谢谢。

约翰。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-02T23:47:55.363

您可以使用 FFMPEG 的 img_convert() 函数同时将图像复制到您的表面并将其转换为 RGB 格式。这是从我最近的一个项目中粘贴的几行代码，它做了类似的事情（尽管我使用的是 SDL 而不是 DirectX）：

```
 AVFrame *frame;
    avcodec_decode_video(_ffcontext, frame, etc...);

    lockYourSurface();
    uint8_t *buf = getPointerToYourSurfacePixels();

// Create an AVPicture structure which contains a pointer to the RGB surface.
    AVPicture pict;

    memset(&pict, 0, sizeof(pict));

    avpicture_fill(&pict, buf, PIX_FMT_RGB32,
                   _ffcontext->width, _ffcontext->height);

// Convert the image into RGB and copy to the surface.
    img_convert(&pict, PIX_FMT_RGB32, (AVPicture *)frame,
                _context->pix_fmt, _context->width, _context->height);

    unlockYourSurface(); 
```

# sql - 不使用select *的原因是什么？

> ID：321299
> 
> 赞同：140
> 
> 时间：2008-11-26T16:22:49.290
> 
> 标签：sql

我看到很多人声称您应该在选择查询中专门命名您想要的每一列。

假设我无论如何都要使用所有的列，我为什么不使用`SELECT *`？

即使考虑到问题 * [SQL 查询 - Select * from view 或 Select col1, col2, ... colN from view](https://stackoverflow.com/questions/128412/sql-query-question-select-from-view-or-select-col1col2from-view) *，我不认为这是一个完全重复的问题，因为我从稍微不同的角度来处理这个问题。

我们的原则之一是在时机未到之前不要进行优化。考虑到这一点，似乎 using`SELECT *`应该是**首选**方法，直到它被证明是资源问题或模式几乎是一成不变的。正如我们所知，在开发完全完成之前不会发生这种情况。

也就是说，是否存在不使用的首要问题`SELECT *`？

* * *

## 回答 #1

> 赞同：175
> 
> 时间：2008-11-26T21:25:13.343

不过早优化这句话的精髓是使用简单直接的代码，**然后**使用分析器指出热点，然后您可以对其进行优化以提高效率。

当您使用 select * 时，您将无法进行分析，因此您没有编写清晰直接的代码，并且违背了报价的精神。`select *`是一种反模式。

* * *

所以选择列并不是过早的优化。有几件事在我的头顶上......

1.  如果您在 SQL 语句中指定列，如果从表中删除该列并执行查询，则 SQL 执行引擎将出错。
2.  您可以更轻松地扫描正在使用该列的代码。
3.  您应该始终编写查询以带回最少的信息。
4.  正如其他人提到的，如果您使用序数列访问，则永远不应使用 select *
5.  如果您的 SQL 语句连接表，则 select * 为您提供连接中所有表的所有列

推论是使用`select *`...

1.  应用程序使用的列是不透明的
2.  DBA 和他们的查询分析器无法帮助您的应用程序性能不佳
3.  发生更改时代码更脆弱
4.  您的数据库和网络正在遭受损失，因为它们带回了太多数据 (I/O)
5.  数据库引擎优化是最小的，因为您要带回所有数据，无论（逻辑）。

* * *

编写正确的 SQL 就像编写`Select *`. 因此，真正的懒人编写适当的 SQL 是因为他们不想重新访问代码并试图记住他们在执行此操作时所做的事情。他们不想向 DBA 解释每一段代码。他们不想向客户解释为什么应用程序像狗一样运行。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-11-26T16:24:22.220

如果您的代码依赖于特定顺序的列，那么当表发生更改时，您的代码将中断。此外，当您选择 * 时，您可能会从表中获取太多信息，尤其是当表中有二进制字段时。

仅仅因为您现在正在使用所有列，并不意味着其他人不会向表中添加额外的列。

它还增加了计划执行缓存的开销，因为它必须获取有关表的元数据才能知道 *.

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-11-26T16:24:06.853

一个主要原因是，如果您曾经从表中添加/删除列，任何进行 SELECT * 调用的查询/过程现在将获得比预期更多或更少的数据列。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-12-05T19:01:11.680

1.  以一种迂回的方式，你打破了尽可能使用严​​格类型的模块化规则。显式几乎普遍更好。

2.  即使您现在需要表中的每一列，以后也可以添加更多内容，每次运行查询时这些内容都会被拉下，并且可能会损害性能。它会损害性能，因为

    *   您正在通过网络获取更多数据；和
    *   因为您可能会破坏优化器直接从索引中提取数据的能力（对于所有属于索引的列的查询。）而不是在表本身中进行查找

# 何时使用选择 *

当您明确需要表中的每一列时，而不是需要在您编写查询时存在的表中的每一列。例如，如果正在编写一个需要显示表的全部内容（无论它们是什么）的数据库管理应用程序，您可能会使用这种方法。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-11-26T16:32:03.343

有几个原因：

1.  如果数据库中的列数发生变化并且您的应用程序希望有一定的数量......
2.  如果数据库中列的顺序发生变化，并且您的应用程序希望它们按特定顺序排列...
3.  内存开销。8 个不必要的 INTEGER 列会增加 32 字节的浪费内存。这听起来并不多，但这是针对每个查询的，而 INTEGER 是小列类型之一……额外的列更有可能是 VARCHAR 或 TEXT 列，它们加起来更快。
4.  网络开销。与内存开销相关：如果我发出 30,000 个查询并有 8 个不必要的 INTEGER 列，我就浪费了 960kB 的带宽。VARCHAR 和 TEXT 列可能要大得多。

注意：我在上面的示例中选择了 INTEGER，因为它们的大小固定为 4 个字节。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-11-26T16:32:05.963

如果您的应用程序使用 SELECT * 获取数据并且更改了数据库中的表结构（例如删除了一个列），那么您的应用程序将在您引用缺失字段的每个地方都失败。如果您改为在查询中包含所有列，您的应用程序将中断（希望）您最初获取数据的一个位置，从而使修复更容易。

话虽如此，在许多情况下 SELECT * 是可取的。一种情况是我经常遇到的情况，我需要将整个表复制到另一个数据库中（例如 SQL Server 到 DB2）。另一个是为一般地显示表格而编写的应用程序（即不知道任何特定表格）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-26T16:55:40.313

`select *`当我在 SQL Server 2005 的视图中使用时，我实际上注意到了一个奇怪的行为。

运行以下查询，您将明白我的意思。

```
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[starTest]') AND type in (N'U'))
DROP TABLE [dbo].[starTest]
CREATE TABLE [dbo].[starTest](
    [id] [int] IDENTITY(1,1) NOT NULL,
    [A] [varchar](50) NULL,
    [B] [varchar](50) NULL,
    [C] [varchar](50) NULL
) ON [PRIMARY]

GO

insert into dbo.starTest
select 'a1','b1','c1'
union all select 'a2','b2','c2'
union all select 'a3','b3','c3'

go
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vStartest]'))
DROP VIEW [dbo].[vStartest]
go
create view dbo.vStartest as
select * from dbo.starTest
go

go
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vExplicittest]'))
DROP VIEW [dbo].[vExplicittest]
go
create view dbo.[vExplicittest] as
select a,b,c from dbo.starTest
go

select a,b,c from dbo.vStartest
select a,b,c from dbo.vExplicitTest

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[starTest]') AND type in (N'U'))
DROP TABLE [dbo].[starTest]
CREATE TABLE [dbo].[starTest](
    [id] [int] IDENTITY(1,1) NOT NULL,
    [A] [varchar](50) NULL,
    [B] [varchar](50) NULL,
    [D] [varchar](50) NULL,
    [C] [varchar](50) NULL
) ON [PRIMARY]

GO

insert into dbo.starTest
select 'a1','b1','d1','c1'
union all select 'a2','b2','d2','c2'
union all select 'a3','b3','d3','c3'

select a,b,c from dbo.vStartest
select a,b,c from dbo.vExplicittest 
```

比较最后 2 个 select 语句的结果。我相信您将看到的是**Select ***按索引而不是名称引用列的结果。

如果您重建视图，它将再次正常工作。

**编辑**

我添加了一个单独的问题，* [“从表中选择*”与“从表中选择 colA、colB 等”在 SQL Server 2005 中的有趣行为](https://stackoverflow.com/questions/321468)* 以更详细地研究该行为。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-26T16:40:40.687

您可以连接两个表并使用第二个表中的 A 列。如果您稍后将 A 列添加到第一个表（名称相同但含义可能不同），您很可能会从第一个表中获取值，而不是之前的第二个表中的值。如果您明确指定要选择的列，则不会发生这种情况。

当然，如果您忘记将新列添加到每个 select 子句，指定列有时也会导致错误。如果每次执行查询时都不需要新列，则可能需要一些时间才能注意到该错误。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-26T20:36:13.130

我了解您在过早优化方面的目标，但这实际上只是到了一定程度。目的是在一开始就避免**不必要**的优化。你的表没有索引吗？您会使用 nvarchar(4000) 来存储邮政编码吗？

正如其他人指出的那样，指定您打算在查询中使用的每一列还有其他好处（例如可维护性）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-06-29T15:24:52.937

当您指定列时，您也将自己束缚在一组特定的列中，并使自己的灵活性降低，从而使 Feuerstein 无论身在何处都可以翻身。只是一个想法。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-12-21T14:48:14.447

**SELECT ***并不总是邪恶的。在我看来，至少。我经常将它用于返回整个表以及一些计算字段的动态查询。

例如，我想从“普通”表中计算地理几何，该表没有任何几何字段，但字段包含坐标。我使用 postgresql 及其空间扩展 postgis。但该原则适用于许多其他情况。

一个例子：

*   地点表，坐标存储在标记为 x、y、z 的字段中：

    CREATE TABLE places (place_id integer, x numeric(10, 3), y numeric(10, 3), z numeric(10, 3), description varchar);

*   让我们用一些示例值来提供它：

    INSERT INTO places (place_id, x, y, z, description) VALUES
    (1, 2.295, 48.863, 64, 'Paris, Place de l\'Étoile'),
    (2, 2.945, 48.858, 40, 'Paris, Tour Eiffel '),
    (3, 0.373, 43.958, 90, 'Condom, Cathédrale St-Pierre');

*   我希望能够使用一些 GIS 客户端映射此表的内容。正常的方法是向表中添加几何字段，并根据坐标构建几何。但我更喜欢动态查询：这样，当我更改坐标（更正、更准确等）时，映射的对象实际上会动态移动。所以这里是带有**SELECT ***的查询：

    创建或替换视图 places_points AS
    SELECT *,
    GeomFromewkt('SRID=4326; POINT ('|| x || ' ' || y || ' ' || z || ')')
    FROM places;

    有关 GeomFromewkt() 函数的使用，请参阅 postgis。

*   结果如下：

    选择 * FROM places_points；

```
place_id | x | 是 | z | 描述 | geomfromewkt                            
----------+--------+--------+--------+------------- -----------------+-------------------------------- ----------------------------------  
        1 | 2.295 | 48.863 | 64.000 | 巴黎，星辰广场 | 01010000A0E61000005C8FC2F5285C02405839B4C8766E48400000000000005040  
        2 | 2.945 | 48.858 | 40.000 | 巴黎，埃菲尔铁塔 | 01010000A0E61000008FC2F5285C8F0740E7FBA9F1D26D48400000000000004440
        3 | 0.373 | 43.958 | 90.000 | 避孕套，Cathédrale St-Pierre | 01010000A0E6100000AC1C5A643BDFD73FB4C876BE9FFA45400000000000805640
(3 线)

```

现在，任何 GIS 程序都可以使用最右边的列来正确映射点。

*   如果将来某些字段被添加到表中：不用担心，我只需要再次运行相同的 VIEW 定义。

我希望 VIEW 的定义可以保持“原样”，使用 *，但事实并非如此：这是 postgresql 内部存储的方式：

选择places.place_id，places.x，places.y，places.z，places.description，geomfromewkt（（（（（（'SRID = 4326; POINT（'::text || places.x）||''： :text) || places.y) || ' '::text) || places.z) || ')'::text) AS geomfromewkt FROM places;

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-26T16:29:47.637

即使您使用每一列但通过数字索引寻址行数组，如果稍后添加另一行，您也会遇到问题。

所以基本上这是一个可维护性的问题！如果您不使用 * 选择器，您将不必担心您的查询。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-26T16:29:59.383

仅选择您需要的列可以使内存中的数据集更小，从而使您的应用程序更快。

此外，许多工具（例如存储过程）也缓存查询执行计划。如果您稍后添加或删除列（如果您选择关闭视图，则特别容易），当工具无法返回预期的结果时，它通常会出错。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-11-26T16:48:08.113

做的时候没关系，`exists(select * ...)`因为它永远不会扩展。否则，它仅在使用临时选择语句探索表时或如果您在上面定义了 CTE 并且您想要每一列而不用再次输入它们时才真正有用。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-11-26T19:58:05.033

它使你的代码更模糊，更难维护；因为您正在向域中添加额外的未使用数据，并且不清楚您想要哪些，哪些不是。（这也表明您可能不知道或不关心。）

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-11-26T20:22:14.937

直接回答您的问题：当它使您的代码对基础表的更改更加脆弱时，不要使用“SELECT *”。仅当对直接影响程序需求的表进行更改时，您的代码才应该中断。

您的应用程序应该利用关系访问提供的抽象层。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-12-18T18:44:44.987

我不使用 SELECT * 只是因为很高兴看到并知道我正在检索哪些字段。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-02-18T20:42:53.827

在视图中使用“select *”通常不好，因为如果表列发生更改，您将被迫重新编译视图。更改视图的基础表列，您将收到不存在的列的错误，直到您返回并重新编译。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-07-13T21:18:16.467

只是添加一件其他人没有提到的事情。`Select *`返回所有列，稍后有人可能会添加一个列，您不一定希望用户能够看到，例如谁最后更新了数据或时间戳或注释，只有管理员才能看到并非所有用户等。

此外，在添加列时，应审查并考虑对现有代码的影响，以确定是否需要根据列中存储的信息进行更改。通过使用`select *`，通常会跳过该审查，因为开发人员会假设没有任何问题。事实上，没有什么可能会显式地出现中断，但查询现在可能会开始返回错误的东西。仅仅因为没有明确的中断，并不意味着查询不应该发生变化。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2012-08-25T06:15:31.050

因为“select *”在不需要所有字段时会浪费内存。但是对于sql server，它们的性能是相同的。

# c# - MarshalByRefObject 和序列化

> ID：321301
> 
> 赞同：1
> 
> 时间：2008-11-26T16:23:21.113
> 
> 标签：c#, remoting

**当我创建一个从MarshalByRefObject**继承的类，比如 ClassA，然后使用**RemotingServices.Marshal**方法创建一个**ObjRef**对象时，它会序列化 ClassA 的所有私有字段吗？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T16:30:15.403

不，MarshalByRefObject 的想法是，它并不是每个都为了远程处理而序列化。相反，CLR 在这种情况下生成所谓的透明代理。之所以称为透明，是因为它的外观和行为与 ClassA 相似，但实际上并非 ClassA。对 ClassA 实例的所有调用都跨远程处理边界编组到创建 ClassA 的原始 AppDomain 中。

编辑：回应进一步的澄清。

在这种情况下将数据传递给 MarshalByRefObject 时，您需要考虑数据的类型。本质上是从 MarshalByRefObject 派生的，或者不是。如果它确实从 MarshalByRefObject 派生，则该参数将作为代理传递。如果它不是从 MarshalByRefObject 派生的，那么它将被序列化，作为一系列字节穿过 AppDomain 边界，然后在目标 AppDomain 中反序列化。

您的场景列出了不是 MarshalByRef 的字符串（通常我将它们称为 MarshalByValue ，但这纯粹是约定）。因此，当它们穿过您的远程边界时，它们将被序列化。

# python - python登录论坛

> ID：321304
> 
> 赞同：3
> 
> 时间：2008-11-26T16:24:13.420
> 
> 标签：python, login, phpbb3, typeerror

我写这个是为了尝试登录一个论坛（phpBB3）。

```
import urllib2, re
import urllib, re
logindata = urllib.urlencode({'username': 'x', 'password': 'y'})
page = urllib.urlopen("http://www.woarl.com/board/ucp.php?mode=login"[logindata])
output = page.read() 
```

但是，当我运行它时，它会出现；

```
Traceback (most recent call last):
  File "C:/Users/Mike/Documents/python/test urllib2", line 4, in <module>
    page = urllib.urlopen("http://www.woarl.com/board/ucp.php?mode=login"[logindata])
TypeError: string indices must be integers 
```

关于如何解决这个问题的任何想法？

*编辑*

在字符串和数据之间添加逗号会产生此错误

```
Traceback (most recent call last):
  File "C:/Users/Mike/Documents/python/test urllib2", line 4, in <module>
    page = urllib.urlopen("http://www.woarl.com/board/ucp.php?mode=login",[logindata])
  File "C:\Python25\lib\urllib.py", line 84, in urlopen
    return opener.open(url, data)
  File "C:\Python25\lib\urllib.py", line 192, in open
    return getattr(self, name)(url, data)
  File "C:\Python25\lib\urllib.py", line 327, in open_http
    h.send(data)
  File "C:\Python25\lib\httplib.py", line 711, in send
    self.sock.sendall(str)
  File "<string>", line 1, in sendall
TypeError: sendall() argument 1 must be string or read-only buffer, not list 
```

*编辑2*

我已将代码从原来的样子更改为；

```
import urllib2, re
import urllib, re
logindata = urllib.urlencode({'username': 'x', 'password': 'y'})
page = urllib2.urlopen("http://www.woarl.com/board/ucp.php?mode=login", logindata)
output = page.read() 
```

这不会引发任何错误消息，它只会给出 3 个空白行。这是因为我试图从登录后消失的登录页面中读取数据。如果是这样，我如何让它显示在点击登录后应该出现的索引。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-26T16:29:19.573

你的线

```
page = urllib.urlopen("http://www.woarl.com/board/ucp.php?mode=login"[logindata]) 
```

是语义上无效的 Python。大概你的意思是

```
page = urllib.urlopen("http://www.woarl.com/board/ucp.php?mode=login", [logindata]) 
```

其中有一个逗号分隔参数。然而，你真正想要的只是

```
page = urllib2.urlopen("http://www.woarl.com/board/ucp.php?mode=login", logindata) 
```

不尝试将 logindata 包含在列表中并使用 urlopen 的更新版本是 urllib2 库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T16:27:31.323

您的 URL 字符串不应该是

```
"http://www.woarl.com/board/ucp.php?mode=login"[logindata] 
```

但

```
 "http://www.woarl.com/board/ucp.php?mode=login", logindata 
```

我认为，因为 [] 用于数组并且它需要一个整数。我可能是错的，因为我没有做过很多 Python。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T16:27:39.090

`"http:..."`在字符串和 urlencoded 数据之间使用逗号怎么样`[logindata]`？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T16:33:59.530

如果你在 logindata 上做一个类型，你可以看到它是一个字符串：

```
>>> import urllib
>>> logindata = urllib.urlencode({'username': 'x', 'password': 'y'})
>>> type(logindata)
<type 'str'> 
```

将它放在方括号 ([]) 中会将其置于列表上下文中，这不是您想要的。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-27T01:41:36.087

使用高级“机械化”模块会更容易。

# c# - 当我的 wpf 绑定验证失败并且包含面板不再可见时，如何摆脱红色矩形？

> ID：321327
> 
> 赞同：21
> 
> 时间：2008-11-26T16:30:45.247
> 
> 标签：c#, .net, wpf, validation, data-binding

我有一种情况，我正在使用 wpf 数据绑定和使用 ExceptionValidationRule 进行验证。

解决方案的另一部分涉及折叠一些面板并显示其他面板。

如果设置了验证异常 - 即 UI 在存在验证问题的 UI 元素周围显示红色边框，并且包含面板已折叠，仍会显示红色边框。这显然不是故意的？有解决方法吗？有谁知道这是否是设计使然？

提供的最小代码示例（不是我的实际代码，但复制了问题）。创建一个新的 WpfApplication（我叫我的 WpfDataBindingProblem）。

window1 的 xml 如下：

```
<Window x:Class="WpfDataBindingProblem.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <StackPanel Margin="5">

        <StackPanel Name="panel1" Visibility="Visible" Margin="5">
            <TextBox Name="DataBoundTextBox">
                <Binding Path="TextValue">
                    <Binding.ValidationRules>
                        <ExceptionValidationRule/>
                    </Binding.ValidationRules>
                </Binding>
            </TextBox>
        </StackPanel>

        <StackPanel Name="panel2" Visibility="Collapsed" Margin="5">
            <TextBlock>
                The quick brown fox jumps over the lazy dog.
            </TextBlock>
        </StackPanel>

        <Button Click="Button_Click" Margin="5">
            Toggle panels
        </Button>

    </StackPanel>
</Window> 
```

window1的代码如下：

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;

namespace WpfDataBindingProblem {

    public partial class Window1 : Window {
        public Window1() {
            InitializeComponent();

            this.DataContext = new MyClass("default");
        }

        private void Button_Click(object sender, RoutedEventArgs e) {
            panel1.Visibility = panel1.Visibility == Visibility.Collapsed ?
                Visibility.Visible : Visibility.Collapsed;
            panel2.Visibility = panel2.Visibility == Visibility.Collapsed ?
                Visibility.Visible : Visibility.Collapsed;
        }
    }

    public class MyClass : INotifyPropertyChanged {

        private string mTextValue;

        public MyClass(string defaultText) {
            TextValue = defaultText;
        }

        public string TextValue {
            get {
                return mTextValue;
            }
            set {
                mTextValue = value;
                if (string.IsNullOrEmpty(mTextValue)) {
                    throw new ApplicationException("Text value cannot be empty");
                }
                OnPropertyChanged(new PropertyChangedEventArgs("TextValue"));
            }
        }

        public event PropertyChangedEventHandler PropertyChanged;

        protected virtual void OnPropertyChanged(PropertyChangedEventArgs e) {
            if (this.PropertyChanged != null) {
                this.PropertyChanged(this, e);
            }
        }
    }

} 
```

要重现该问题，请运行该应用程序。从文本框中删除**默认**文本并关闭标签 - 显示红色矩形表示验证问题。单击按钮。包含红色矩形控件的面板被隐藏并显示另一个面板，但红色矩形仍然存在。啊！

非常感谢所有帮助。

PS 为长的问题标题道歉！

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-26T20:12:43.630

如果我没记错的话，这是一个已知问题。我们重新模板化文本框以包括以下内容：

```
<Setter Property="Validation.ErrorTemplate">
    <Setter.Value>
        <ControlTemplate>
            <ControlTemplate.Resources>
                <BooleanToVisibilityConverter x:Key="converter" />
        </ControlTemplate.Resources>
            <DockPanel LastChildFill="True">
                <Border 
                    BorderThickness="1"
                    BorderBrush="Red"
                    Visibility="{Binding ElementName=placeholder, Mode=OneWay, Path=AdornedElement.IsVisible, Converter={StaticResource converter}}">
                    <AdornedElementPlaceholder x:Name="placeholder" />
                </Border>
             </DockPanel>
         </ControlTemplate>
    </Setter.Value>
</Setter> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T16:44:51.287

我自己对这个问题有一个答案，那就是更改我的按钮单击事件，这会改变面板的可见性。这会变成这样：

```
private void Button_Click(object sender, RoutedEventArgs e) {
    if (panel1.Visibility == Visibility.Collapsed) {
        panel1.Visibility = Visibility.Visible;
        DataBoundTextBox.GetBindingExpression(TextBox.TextProperty).UpdateSource();
        panel2.Visibility = Visibility.Collapsed;
    }
    else {
        panel1.Visibility = Visibility.Collapsed;
        DataBoundTextBox.GetBindingExpression(TextBox.TextProperty).UpdateTarget();
        panel2.Visibility = Visibility.Visible;
    }
} 
```

**UpdateSource()**和**UpdateTarget()**具有重新应用和删除红色矩形的效果，但这似乎是一个丑陋的 hack。当然，当包含面板折叠时，wpf 框架应该为我隐藏红色矩形。任何不需要我摆弄绑定表达式的更清洁的修复都会得到我的投票。

谢谢，

山姆

# database-design - 数据模型中的“多重继承”（泛化关系）

> ID：321329
> 
> 赞同：0
> 
> 时间：2008-11-26T16:30:52.440
> 
> 标签：database-design

对于一些学校的小组作业，我正在制作一个通用的披萨配送一切管理系统，并且在数据建模过程中遇到了一个问题，如果不使用至少几层丑陋的东西我无法弄清楚。

餐厅备有食材和饮料/小吃/等。（我将这些称为“饮料”）。饮料有售价。该应用程序存储菜肴的食谱——每道菜都有一组配料和用量，以及它的售价。一个订单有一系列食谱和饮料，但没有配料——直接出售面粉是没有意义的。

因此，我需要成分和饮料之间的“可储存”概括，以及饮料和食谱之间的“可销售”（或“菜单项”）概括；而且我真的不记得允许多重概括的 ERD 建模。

（目前我只是选择菜单项之一，并决定让可储存的东西具有单独的实体层次结构，并在应用程序代码中处理它。并且正在考虑删除单独的层次结构，并且根本不在数据模型中表达成分/饮料的差异，而不是使用“是成分”标志属性。）

有什么我遗漏的东西可以让我在无需处理应用程序代码中的任何东西（或尽可能少）的情况下对此进行建模吗？

如果有人喜欢将这种事情作为心理锻炼/拼图来做，那么为了获得更多乐趣，删除的功能包括：

*   具有不同税率类别的饮料——认为软饮料和酒类的征税方式不同；菜肴也有税率，但不属于一个类别
*   出售/一些/成分是有意义的——浇头（对于想要额外培根但没有橄榄的人）；我们还必须在一次“额外”服务中存储多少单位的浇头。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T17:11:50.983

没有一个简单的解决方案，你有一张配料表或可储存物品，其中包括饮料和其他可能单独列出的配料。这些都不能直接订购。

然后，您有一个菜单项目表，这些项目都是成分/可储存项目的集合。一个菜单项集合可能只有一个项目——在饮料的情况下，这可能总是如此，但也可能包括例如一片柠檬。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T19:12:53.673

SQL 不直接支持继承或泛化的概念。表之间的关系只是参考关系。所以没有“IS-A”机制。

您可以使用外键表示“属于”（如“此饮料属于税率为 8% 的商品类别”），也可以使用外键表示“有一个”（如“此成分”有一个父母”）。

[您可以使用邻接关系](https://stackoverflow.com/questions/192220/what-is-the-most-efficientelegant-way-to-parse-a-flat-table-into-a-tree#192462)设计支持单独的层次结构，允许一个项目属于多个树。

由于这是一个家庭作业问题，我会停在那里，剩下的留给你。:-)

# bash - bash if -a vs -e option

> ID：321348
> 
> 赞同：71
> 
> 时间：2008-11-26T16:38:04.233
> 
> 标签：bash

Both about `-a` and `-e` options in [Bash documentation](http://www.gnu.org/software/bash/manual/bashref.html#Bash-Conditional-Expressions) is said:

```
-a file
    True if file exists.
-e file
    True if file exists. 
```

Trying to get what the difference is I ran the following script:

```
resin_dir=/Test/Resin_wheleph/Results

if [ -e ${resin_dir} ] ; then
    echo "-e ";
fi

if [ ! -e ${resin_dir} ] ; then
    echo "! -e";
fi

if [ -a ${resin_dir} ] ; then
    echo "-a";
fi

if [ ! -a ${resin_dir} ] ; then
    echo "! -a";
fi 
```

`/Test/Resin_wheleph/Results` exists and is a directory. And this is what I get:

```
-e
-a
! -a 
```

which seems to be a little strange (notice `-a` and `! -a`). But when I use double brackets (e. g. `if [[ -e ${resin_dir} ]]`) in the similar script it gives reasonable output:

```
-e
-a 
```

So:

1.  What is a difference between `-a` and `-e` options?
2.  Why `-a` produces a strange result when used inside single brackets?

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2008-11-26T16:39:23.030

I researched, and this is quite hairy:

`-a` is deprecated, thus isn't listed in the manpage for `/usr/bin/test` anymore, but still in the one for bash. Use `-e` . For single '[', the bash builtin behaves the same as the `test` bash builtin, which behaves the same as `/usr/bin/[` and `/usr/bin/test` (the one is a symlink to the other). Note the effect of `-a` depends on its position: If it's at the start, it means `file exists`. If it's in the middle of two expressions, it means logical `and`.

`[ ! -a /path ] && echo exists` doesn't work, as the bash manual points out that `-a` is considered a binary operator there, and so the above isn't parsed as a `negate -a ..` but as a `if '!' and '/path' is true` (non-empty). Thus, your script always outputs `"-a"` (which actually tests for files), and `"! -a"` which actually is a binary `and` here.

For `[[`, `-a` isn't used as a binary `and` anymore (`&&` is used there), so its unique purpose is to check for a file there (although being deprecated). So, negation actually does what you expect.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-26T17:26:22.703

The '`-a`' option to the test operator has one meaning as a unary operator and another as a binary operator. As a binary operator, it is the 'and' connective (and '`-o`' is the 'or' connective). As a unary operator, it apparently tests for a file's existence.

The `autoconf` system advises you to avoid using '`-a`' because it causes confusion; now I see why. Indeed, in portable shell programming, it is best to combine the conditions with '`&&`' or '`||`'.

I think @litb is on the right track. When you have '`! -a ${resin_dir}`', Bash may be interpreting it as "is the string '!' non-empty and is the string in '${resin_dir}' non-empty, to which the answer is yes. The Korn shell has a different view on this, and the Bourne shell yet another view - so stay away from '`-a`'.

On Solaris 10:

```
$ bash -c 'x=""; if [ ! -a "$x" ] ; then echo OK ; else echo Bad; fi'
Bad
$ ksh -c 'x=""; if [ ! -a "$x" ] ; then echo OK ; else echo Bad; fi'
OK
$ sh -c 'x=""; if [ ! -a "$x" ] ; then echo OK ; else echo Bad; fi'
sh: test: argument expected
$ 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T17:02:21.720

The double bracket [[ exp ]] is a bash builtin. In bash -a and -e are the same, probably for some backwards compatibility.

The single bracket [ exp ] is an alias for the external command "test". In "test", -a is a logical AND. Although [ nothing AND $STRING ] looks like it should be false, test has some syntax quirks, which is why I recommend using the bash builtin [[ exp ]], which tends to be more sane.

Note: bash really does call /bin/[ when you use "[".

```
$ [ $UNASIGNED_VAR == "bar" ]
bash: [: ==: unary operator expected 
```

the error shows bash called [. An strace also shows "execve("/usr/bin/[", ..."

# c++ - 使用非平凡的构造函数初始化联合

> ID：321351
> 
> 赞同：60
> 
> 时间：2008-11-26T16:38:46.870
> 
> 标签：c++, constructor, multiplatform

我有一个结构，我创建了一个自定义构造函数来将成员初始化为 0。我在较旧的编译器中看到，在发布模式下，如果不将 memset 设置为 0，则不会初始化这些值。

我现在想在联合中使用这个结构，但是因为它有一个非平凡的构造函数而出错。

那么，问题 1。默认编译器实现的构造函数是否保证结构的所有成员都将被初始化为空？非平凡的构造函数只是将所有成员的 memset 设置为 '0' 以确保结构清晰。

问题 2：如果必须在基础结构上指定构造函数，如何实现联合以包含该元素并确保初始化为 0 的基础元素？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-11-26T19:33:20.370

问题 1：默认构造函数确实根据 C++ 标准将 POD 成员初始化为 0。请参阅下面的引用文本。

问题 2：如果必须在基类中指定构造函数，则该类不能是联合的一部分。

最后，您可以为您的联合提供一个构造函数：

```
union U 
{
   A a;
   B b;

   U() { memset( this, 0, sizeof( U ) ); }
}; 
```

对于第一季度：

来自 C++03，12.1 构造函数，第 190 页

隐式定义的默认构造函数执行类的一组初始化，这些初始化将由用户编写的具有空 mem-initializer-list (12.6.2) 和空函数体的类的默认构造函数执行。

来自 C++03, 8.5 Initializers, pg 145

默认初始化 T 类型的对象意味着：

*   如果 T 是非 POD 类类型（第 9 条），则调用 T 的默认构造函数（如果 T 没有可访问的默认构造函数，则初始化是非良构的）；
*   如果 T 是数组类型，则每个元素都是默认初始化的；
*   *否则，对象是零初始化的*。

对 T 类型的对象进行零初始化意味着：

*   如果 T 是标量类型（3.9），则将对象设置为值 0（零）转换为 T；
*   *如果 T 是非联合类类型，则每个非静态数据成员和每个基类子对象都是零初始化的*；
*   ***如果 T 是联合类型，则对象的第一个命名数据成员为零初始化；***
*   如果 T 是数组类型，则每个元素都初始化为零；
*   如果 T 是引用类型，则不执行初始化。

对于第二季度：

来自 C++03，12.1 构造函数，第 190 页

如果构造函数是隐式声明的默认构造函数并且满足以下条件，则构造函数是微不足道的：

*   它的类没有虚函数 (10.3) 和虚基类 (10.1)，并且
*   其类的所有直接基类都有普通的构造函数，并且
*   对于其类的所有属于类类型（或其数组）的非静态数据成员，每个这样的类都有一个简单的构造函数

来自 C++03，9.5 联合，第 162 页

联合可以具有成员函数（包括构造函数和析构函数），但不能具有虚拟 (10.3) 函数。联合不应有基类。联合不应用作基类。具有非平凡构造函数 (12.1)、非平凡复制构造函数 (12.8)、非平凡析构函数 (12.4) 或非平凡的类的对象复制赋值运算符（13.5.3、12.8）不能是联合的成员，也不能是此类对象的数组

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2015-10-22T20:20:28.070

**在 C++11 中情况变得更好了。**

[正如Stroustrup](http://www.stroustrup.com/C++11FAQ.html#unions)本人所描述的那样，您现在可以合法地执行此操作（我从[C++11 的 Wikipedia 文章中](https://en.wikipedia.org/wiki/C%2B%2B11#Unrestricted_unions)获得了该链接）。

维基百科上的例子如下：

```
#include <new> // Required for placement 'new'.

struct Point {
    Point() {}
    Point(int x, int y): x_(x), y_(y) {}
    int x_, y_;
};

union U {
    int z;
    double w;
    Point p; // Illegal in C++03; legal in C++11.
    U() {new(&p) Point();} // Due to the Point member, a constructor
                           // definition is now *required*.
}; 
```

Stroustrup 更详细地介绍了一些细节。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T17:13:50.370

AFAIK 联合成员可能没有构造函数或析构函数。

问题1：不，没有这样的保证。任何不在构造函数初始化列表中的 POD 成员都会被默认初始化，但这是使用您定义的构造函数，并且有一个初始化列表。如果你没有定义构造函数，或者你定义了一个没有初始化列表和空体的构造函数，POD 成员将不会被初始化。

非 POD 成员将始终通过其默认构造函数构造，如果合成，则不会再次初始化 POD 成员。鉴于联合成员可能没有构造函数，您几乎可以保证联合中结构的 POD 成员不会被初始化。

问题 2：您始终可以像这样初始化结构/联合：

```
struct foo
{
    int a;
    int b;
};

union bar
{
    int a;
    foo f;
};

bar b = { 0 }; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-26T19:41:16.843

正如 Greg Rogers 对[unwesen](https://stackoverflow.com/questions/321351/initializing-a-union-with-a-non-trivial-constructor#321466)帖子的评论中提到的，您可以为您的联合提供一个构造函数（如果您愿意，还可以提供析构函数）：

```
struct foo
{
    int a;
    int b;
};

union bar
{
    bar() { memset(this, 0, sizeof(*this)); }

    int a;
    foo f;
}; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T16:44:37.747

你能做这样的事情吗？

```
class Outer
{
public:
    Outer()
    {
        memset(&inner_, 0, sizeof(inner_));
    }
private:
    union Inner
    {
        int qty_;
        double price_;
    } inner_;
}; 
```

...或者可能是这样的？

```
union MyUnion
{
    int qty_;
    double price_;
};

void someFunction()
{
    MyUnion u = {0};
} 
```

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-11-26T17:51:40.497

您必须等待编译器支持 C++0x 才能获得此功能。到那时，对不起。

# powershell - 通过 GPO 设置事件日志设置

> ID：321355
> 
> 赞同：1
> 
> 时间：2008-11-26T16:40:36.443
> 
> 标签：powershell, logging, group-policy

如何在应用程序/安全性/系统以外的事件日志上设置“根据需要覆盖”设置？具体来说，除了可能添加的任何其他未来日志之外，我还想将此应用于 Powershell 和 Windows Powershell 日志。这需要同时应用于服务器 2003 和 2008。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-07-21T04:36:49.010

哇。我环顾四周，除了系统、应用程序、安全性之外，找不到为事件日志设置 GPO 设置的任何参考。这似乎是错误的。您必须使用 wevtutil.exe (cmd) 或 limit-eventlog (powershell) 为您的域、工作组或工作站编写脚本。这两个实用程序都内置了远程连接。

```
wevtutil sl <Log Name> /rt:false

limit-eventlog -Log Name  -OverFlowAction OverwriteAsNeeded 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T17:53:48.980

我不相信他们是为此的GPO。但大多数组策略只是修改注册表。

您可以创建一个修改设置的 adm 模板，或者您可以简单地编写一个脚本来调整设置。

```
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Eventlog\PowerShell 
```

如果您不确定如何手动配置设置，只需调整事件日志 GUI 中的设置，并将所有其他系统设置为相同。您可能需要重新启动系统才能使更改生效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T17:01:43.093

现在您需要使用 SDM Software 的 GPO cmdlet。这是在 PowerShell 中修改 GPO 中设置的唯一方法。但是我不知道如何更改“任何可能添加的日志”——我认为你不能修改系统默认值（尽管我可能是错的——这不是我做过的事情）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-21T05:15:45.900

计算机配置-->Windows 设置-->安全设置-->事件日志

# debugging - USB调试

> ID：321359
> 
> 赞同：2
> 
> 时间：2008-11-26T16:42:28.953
> 
> 标签：debugging, hardware, usb

我正在寻找一种非常特定的 USB 设备，用于调试可能使用 USB 但不使用普通计算机（专有硬件）的系统。我想要一个具有 USB 主机控制器和两个 USB 设备连接的设备。要调试的设备连接到 USB 主控制器，并且其中一个设备连接连接到另一个设备，该设备上有自己的主控制器。另一个设备连接连接到电脑。关键是所有通过设备传输的 USB 数据（从连接到主机控制器的设备到连接到第一个设备连接的设备）都会报告给 pc。

我很乐意编写软件来进行日志记录（实际上我想这样做），但我似乎在任何地方都找不到这样的板。任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T14:33:58.820

I have an Ellisys USB analyser, which isn't exactly what you describe internally, but does sit between a peripheral and a host and use a separate PC to collect the data.

(i.e. it has two 'B' and one 'A' connectors on it.)

Excellent product, and very helpful company.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T17:11:43.137

如果你有合适的硬件，嗅探 USB 应该不会太难。这是一个棘手的问题。我还没有看到任何描述你想要的 USB 接线盒的东西。但是我可以说这是在以下两本杂志的范围内：

1.  [坚果和伏特](http://www.nutsvolts.com)
2.  [电路酒窖](http://www.circuitcellar.com)

如果他们的档案中没有 USB 分线盒项目，那么至少他们会有小型廉价单板计算机的广告，这些计算机具有多个 USB 端口，您可以使用这些端口缓冲信号并将其报告回您的 PC。

或者，是否可以将您的 PC 连接到两个设备的中间，并编写一个自定义驱动器，在为您嗅探流的同时来回回显数据？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T14:27:39.300

Sorry for the long delay in my reply -- I checked out one of our USB developer's toolchain, and he uses a [Beagle USB Sniffer](http://www.avrfreaks.net/index.php?module=Freaks%20Tools&func=viewItem&item_id=913). He seems happy with it.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T14:41:10.787

You're looking for a USB device with two upstream outputs. I think according to the USB spec, this is not possible. You will have two USB hosts trying to send messages and control the USB devices at the same time.

What if you were to look for a device which allowed you to view the data going through a hub via something other than a usb output?

If you're building something custom, take a look at this [USB chip site](http://ftdichip.com/). The chips are programmable via a windows application. Once you define how you want it to operate, it's saved on an EPROM on the dev board ($30-$50).

Sorry if this isn't helpful!

# c# - 如何将十六进制字符串转换为字节数组？

> ID：321370
> 
> 赞同：314
> 
> 时间：2008-11-26T16:45:53.547
> 
> 标签：c#, encoding, hex

我们可以使用 C# 中的内置函数将十六进制字符串转换为字节数组，还是我必须为此创建一个自定义方法？

* * *

## 回答 #1

> 赞同：554
> 
> 时间：2008-11-26T16:56:24.743

这是一个有趣的 LINQ 示例。

```
public static byte[] StringToByteArray(string hex) {
    return Enumerable.Range(0, hex.Length)
                     .Where(x => x % 2 == 0)
                     .Select(x => Convert.ToByte(hex.Substring(x, 2), 16))
                     .ToArray();
} 
```

* * *

## 回答 #2

> 赞同：98
> 
> 时间：2012-04-03T14:25:40.817

我做了一些研究，发现 byte.Parse 甚至比 Convert.ToByte 还要慢。我能想到的最快的转换使用每字节大约 15 个滴答声。

```
 public static byte[] StringToByteArrayFastest(string hex) {
        if (hex.Length % 2 == 1)
            throw new Exception("The binary key cannot have an odd number of digits");

        byte[] arr = new byte[hex.Length >> 1];

        for (int i = 0; i < hex.Length >> 1; ++i)
        {
            arr[i] = (byte)((GetHexVal(hex[i << 1]) << 4) + (GetHexVal(hex[(i << 1) + 1])));
        }

        return arr;
    }

    public static int GetHexVal(char hex) {
        int val = (int)hex;
        //For uppercase A-F letters:
        //return val - (val < 58 ? 48 : 55);
        //For lowercase a-f letters:
        //return val - (val < 58 ? 48 : 87);
        //Or the two combined, but a bit slower:
        return val - (val < 58 ? 48 : (val < 97 ? 55 : 87));
    } 
```

// 也适用于 .NET Micro Framework，其中（在 SDK4.3 中）byte.Parse(string) 只允许整数格式。

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2011-11-22T23:47:58.613

以下代码通过逐字节解析字符串将十六进制字符串更改为字节数组。

```
public static byte[] ConvertHexStringToByteArray(string hexString)
{
    if (hexString.Length % 2 != 0)
    {
        throw new ArgumentException(String.Format(CultureInfo.InvariantCulture, "The binary key cannot have an odd number of digits: {0}", hexString));
    }

    byte[] data = new byte[hexString.Length / 2];
    for (int index = 0; index < data.Length; index++)
    {
        string byteValue = hexString.Substring(index * 2, 2);
        data[index] = byte.Parse(byteValue, NumberStyles.HexNumber, CultureInfo.InvariantCulture);
    }

    return data; 
} 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2012-05-25T15:46:56.337

我认为这可能有效。

```
public static byte[] StrToByteArray(string str)
    {
        Dictionary<string, byte> hexindex = new Dictionary<string, byte>();
        for (int i = 0; i <= 255; i++)
            hexindex.Add(i.ToString("X2"), (byte)i);

        List<byte> hexres = new List<byte>();
        for (int i = 0; i < str.Length; i += 2)            
            hexres.Add(hexindex[str.Substring(i, 2)]);

        return hexres.ToArray();
    } 
```

# search - 谷歌如何从其他网站返回“搜索”？

> ID：321372
> 
> 赞同：2
> 
> 时间：2008-11-26T16:46:37.040
> 
> 标签：search

假设我正在执行 google 搜索`search term`。

有时，其中一个建议将是这样的 URL：`www.someothersearch.com/search+term/`

“someothersearch.com”是如何做到这一点的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T16:50:55.487

一般来说，只有在其他页面链接到该页面时，该页面才会出现在 Google 中。Google 不会去 someothersearch.com 并在表单中提交“搜索词”，它可能是 someothesearch.com 上的隐藏或非隐藏链接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T16:49:27.690

为什么不？someothersearch.com 可能有自己的索引页面，用于查找以前搜索过的术语；谷歌蜘蛛也只是索引这些索引页面。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T16:49:56.863

只是一个猜测。也许这些网站支持[OpenSearch](http://www.opensearch.org/Specifications/OpenSearch/1.1)？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T17:58:23.980

一开始我误解了你的问题；这些网站正在做的是重写他们的请求。他们如何知道人们会搜索哪些字词对我来说有点神秘，但它可能依赖于诸如观看[google.com/trends](http://google.com/trends)、抓取他们自己的和其他日志文件以从 google 推荐包含搜索字词、购买人们可能会使用 AdSense 的排名良好的术语列表，而不是尝试为他们生成自然流量……等等。可能当他们添加带有这些术语的新页面时，他们也会将它们添加到Google 将抓取的[xml 站点地图中。](https://www.google.com/webmasters/tools/docs/en/protocol.html)

已编辑：我已在您的问题中添加了[Open-Search](https://stackoverflow.com/questions/tagged/open-search)标签；请遵循它。您会在[https://stackoverflow.com/questions/20830/firefox-and-ie7-users-here-is-your-stackoverflow-search-plugin](https://stackoverflow.com/questions/20830/firefox-and-ie7-users-here-is-your-stackoverflow-search-plugin)[链接文本](https://stackoverflow.com/questions/20830/firefox-and-ie7-users-here-is-your-stackoverflow-search-plugin)中找到信息最丰富的帖子；但是我建议您使用 image/png 作为您的图标格式。

# asp.net - RhinoMocks 活动订阅

> ID：321373
> 
> 赞同：2
> 
> 时间：2008-11-26T16:46:55.417
> 
> 标签：asp.net, unit-testing, rhino-mocks

作为 RhinoMocks 和单元测试的新手，我遇到了一个似乎无法解决的问题（无论我阅读了多少文档）。

问题是这样的：我创建了一个公开 5 个事件的接口（用于 ASP.NET 中的视图和 MVP 监督控制器模式......我知道，我应该使用 MVC，但那是另一回事问题）。无论如何，我想测试当某个事件在视图上触发时，我们将其称为“IsLoaded”，我的 Presenter 内部的一个方法被调用，并且使用依赖注入，一个值从依赖返回并设置为风景。这是问题开始的地方：当我使用 Expect.Call(Dependency.GetInfo()).Return(SomeList) 时，Call 永远不会执行（没有调用 mock.ReplayAll() 方法）。好吧，当我调用 ReplayAll 方法时，我得到了 ExpectationExceptions，因为 Presenter 对象订阅了 View Interface 公开的其他事件。

因此，为了测试 IView.IsLoaded 是否已触发，我想验证 IView.ListOfSomething 是否已更新以匹配我通过 Expect.Call() 传入的列表。但是，当我设置期望值时，其他事件订阅（直接从 Presenter 的构造函数中发生）未通过测试的 #0 期望值。我得到的是，view.Save += this.SaveNewList 抛出了一个 RhinoMocks ExpectationViolationException。

我的百万美元问题是：我是否有必要为我的所有事件设定期望（通过 [Setup]），还是我缺少/不了解单元测试或 RhinoMocks 的工作原理？

请记住，我对单元测试*非常*陌生，因此对 RhinoMocks 也很陌生。如果看起来我不知道我在说什么，请随时指出。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-03T14:33:49.307

我正在做一个项目，我们也使用了 MVP 和 rhino 模拟。我们所做的只是期望每个测试中的所有事件订阅。

```
 private void SetupDefaultExpectations()
    {
        _mockView.Initializing += null; LastCall.IgnoreArguments();
        _mockView.SavingChanges += null; LastCall.IgnoreArguments();
    } 
```

然后我们在 IMockedObject（来自 RhinoMocks）上构建了一个扩展方法来触发单元测试中的事件并解包异常，以便它们可以在标准 NUnit 方式中被预期。

```
static class IMockedObjectExtension
{
    public static void RaiseEvent(this IMockedObject mockView, string eventName, EventArgs args)
    {
        EventRaiser eventraiser = new EventRaiser(mockView, eventName);

        try
        {
            eventraiser.Raise(mockView, args);
        }
        catch (TargetInvocationException ex)
        {
            throw ex.InnerException;
        }
    }

    public static void RaiseEvent(this IMockedObject mockView, string eventName)
    {
        RaiseEvent(mockView, eventName, EventArgs.Empty);
    }
} 
```

然后可以像这样从单元测试中使用它

```
using(_mocks.Record())
{
    Expect.Call(dependency.GetInfo()).Return(someList);
}
using(_mocks.Playback())
{
    Presenter presenter = new Presenter(_mockView, dependency);
    (_mockView as IMockedObject).RaiseEvent("SavingChanges");
} 
```

为了消除演示者测试之间的重复，我们将其重构为 BasePresenterTest 基类，该基类为所有演示者测试设置此基本结构，并将辅助方法公开给子类。

```
public abstract class BasePresenterTest<VIEW> where VIEW : IBaseView
{
    protected MockRepository _mocks;
    protected VIEW View { get; private set; }

    protected abstract void SetUp();
    protected abstract void TearDown();
    protected abstract void SetupDefaultExpectations();

    [SetUp]
    public virtual void BaseSetUp()
    {
        _mocks = new MockRepository();
        View = _mocks.CreateMock<VIEW>();

        SetUp();
    }

    [TearDown]
    public virtual void BaseTearDown()
    {
        TearDown();

        View = null;
        _mocks = null;
    }

    protected virtual void BaseSetupDefaultExpectations()
    {
        //Setup default expectations that are general for all views
        SetupDefaultExpectations();
    }

    protected virtual IDisposable Record()
    {
        IDisposable mocksRecordState = _mocks.Record();

        BaseSetupDefaultExpectations();

        return mocksRecordState;
    }

    protected virtual IDisposable Playback()
    {
        return _mocks.Playback();
    }

    protected void RaiseEventOnView(string eventName)
    {
        (View as IMockedObject).RaiseEvent(eventName);
    }       
} 
```

这从我们项目的测试中消除了很多代码。

我们仍然使用旧版本的 RhinoMocks，但一旦我们升级到更高版本，我会尝试更新它。

# mysql - 具有各种类型的 MySQL 列

> ID：321375
> 
> 赞同：4
> 
> 时间：2008-11-26T16:47:41.203
> 
> 标签：mysql, database-design

我似乎经常发现自己想要在 MySQL 数据库的同一列中存储不止一种类型的数据（通常是整数和文本）。我知道这很可怕，但它发生的原因是当我存储人们对问卷中问题的回答时。有些问题需要整数响应，有些需要文本响应，有些可能是从列表中选择的项目。

我过去采取的方法是：

1.  将所有内容存储为文本并在以后需要时转换为 int （或其他）。

2.  有两列 - 一列用于文本，一列用于 int。然后，您只需在每个响应的每行中填写一个，而将另一个保留为空。

3.  有两张表格 - 一张用于文本回复，一张用于整数回复。

不过，我真的不喜欢其中任何一个，而且我觉得必须有更好的方法来处理这种情况。

为了使其更具体，这是我可能拥有的表格示例：

```
CREATE TABLE question (
  id int(11) NOT NULL auto_increment,
  text VARCHAR(200) NOT NULL default '',
  PRIMARY KEY ('id')
)

CREATE TABLE response (
  id int(11) NOT NULL auto_increment,
  question int (11) NOT NULL,
  user int (11) NOT NULL,
  response VARCHAR(200) NOT NULL default ''
) 
```

或者，如果我使用上面的选项 2：

```
CREATE TABLE response (
  id int(11) NOT NULL auto_increment,
  question int (11) NOT NULL,
  user int (11) NOT NULL,
  text_response VARCHAR(200),
  numeric_response int(11)
) 
```

如果我使用选项 3，则会有一个 responseInteger 表和一个 responseText 表。

这些是正确的方法，还是我错过了一个明显的选择？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T17:09:16.747

[选项 2] 不是最标准化的选项 [正如@Ray 声称的那样]。最规范化的将没有可为空的字段，显然选项 2 将要求每一行都为空。

在您设计的这一点上，您必须考虑使用情况、您将执行的查询以及您将编写的报告。您想同时对所有数字响应进行数学运算吗？即在哪里 numeric_response 不为空？恐怕不太可能。

更有可能的是，WHERE Question = 11 的平均响应是多少。在这些情况下，您可以选择 INT 表或 INT 列，两者都不会比另一个更容易。

如果你确实做了两张表，你很可能会不断地将它们结合在一起，以解决诸如有多少百分比的问题得到回应等问题。

您能看到您要求数据库回答的问题是如何开始推动设计的吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T17:11:57.520

我会选择选项 1。答案总是文本字符串，但有时文本字符串恰好是整数的表示形式。不太容易确定应该对给定问题的答案施加哪些限制（如果有的话）。如果某个答案应该只是一个或多个数字的序列，你如何验证呢？最有可能的是，问题表应该包含有关可能答案的信息，并且应该指导验证。

我注意到 QuestionID 和 UserID 的组合是（或应该是）唯一的（对于给定的问卷）。所以，你真的不需要答案中的自动增量列。无论如何，您还应该对 QuestionID 和 UserID 具有唯一约束（或主键约束）（无论您是否保留自动增量列）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T16:52:15.250

选项 2 是正确的、最标准化的选项。

# c++ - 在 C++ 中，我希望我的接口 .h 说 int GetSomeInt() const;.... 但实际上方法 *DOES* 更新“this”。

> ID：321377
> 
> 赞同：4
> 
> 时间：2008-11-26T16:48:14.493
> 
> 标签：c++, constants

我正在向 const 方法添加一些惰性初始化逻辑，这使得该方法实际上不是 const。有没有办法让我不必从公共界面中删除“const”？

```
int MyClass::GetSomeInt() const
{
    // lazy logic
    if (m_bFirstTime)
    {
        m_bFirstTime = false;
        Do something once
    }

    return some int...

} 
```

编辑：“可变”关键字在这里起作用吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-26T16:51:15.517

使 m_bFirstTime 可变：

```
class MyClass
{
  : :
  mutable bool m_bFirstTime;
}; 
```

...但这也常常表明存在设计缺陷。所以要小心。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-26T16:53:33.220

实际上，您说您不想更改头文件。所以你唯一的选择是抛弃 this 指针的常量......

```
int MyClass::GetSomeInt() const
{
    MyClass* that = const_cast<MyClass*>(this);

    // lazy logic
    if (that->m_bFirstTime)
    {
        that->m_bFirstTime = false;
        Do something once
    }

    return some int...

} 
```

如果使用 mutable 引发红旗，这会在轨道上启动红旗存储。做这样的事情通常是一个非常糟糕的主意。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-26T17:09:59.943

我认为这个问题涉及两个概念：（1）“逻辑上的 const”和（2）“按位的 const”。我的意思是从类中获取一些 int 并不会在*逻辑上*更改类，并且在*大多数*情况下它不会更改类成员的*位*。但是，在某些情况下，例如您的情况，确实如此。

在这些情况下，方法在逻辑上是 const 但不是按位 const，编译器无法知道这一点。这就是 mutable 关键字存在的原因。像 John Dibling 展示的那样使用它，但这***不是***设计缺陷。相反，在很多情况下这是必要的。在您的示例中，我假设 int 的计算很昂贵，因此如果不需要，我们不想计算它。在其他情况下，您可能希望缓存方法的结果以供以后使用等。

顺便说一句，即使您已经接受“可变”答案是正确的，您也必须更新 .h！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T16:50:52.570

将 m_bFirstTime 成员设置为可变

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T18:29:06.290

正如[John Dibling 所说](https://stackoverflow.com/questions/321377/in-c-i-want-my-interface-h-to-say-int-getsomeint-const-but-actually-the-method#321387)，将更改的字段标记为可变。重要的部分在 ypnos 的评论中：“不要真正改变对象的状态”（正如外界所感知的那样）。也就是说，在 const 方法调用之前和之后的任何方法调用都必须产生相同的结果。否则你的设计有缺陷。

一些有意义的事情是可变的：

*   互斥锁或其他锁类型
*   缓存结果（不会改变）

互斥锁不是对象状态的一部分，它们只是保证数据完整性的阻塞机制。从您的类中检索值的方法确实需要更改互斥锁，但是在执行 const 方法之后，您的类数据和状态将与之前完全相同。

对于缓存，您必须考虑仅对检索成本高且假定不会更改的数据有意义的数据（例如 DNS 结果）。否则，您可能会将过时的数据返回给您的用户。

在 const 方法中不应该更改的一些内容：

*   任何修改对象状态的东西
*   影响此或其他方法结果的任何内容

执行 const 方法的类的任何用户都将假定您的类（从外部世界看）在执行期间不会改变。如果它不一样，那将是相当误导和容易出错的。举个例子，假设一个 dump() 方法改变了一些内部变量 -state, value- 并且在调试过程中你的类的用户决定在给定的点 dump() 你的对象：你的类在跟踪和没有跟踪时的行为会有所不同: 完美的调试噩梦。

请注意，如果您执行惰性优化，则必须执行它们才能访问不可变数据。也就是说，如果您的界面规定在构建期间您将从数据库中检索一个元素，该元素以后可以通过常量方法访问，那么如果您对数据进行延迟获取，您最终可能会遇到用户构造您的对象的情况保留旧数据的副本，修改数据库，然后决定将以前的数据恢复到数据库中。如果您执行了延迟提取，您最终会丢失原始值。如果在程序执行期间不允许修改配置文件，则相反的示例是配置文件解析。您可以避免将文件解析到需要的位置，因为您知道在开始或稍后执行读取将产生相同的结果。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T17:08:20.540

无论如何 - 请注意这将不再是线程安全的。如果对象只有 const 方法（或者您在初始化后只使用 const 方法），您通常可以依赖对象是线程安全的。但是，如果这些 const 方法只是逻辑上的 const，那么您将失去这种好处（当然，除非您开始一直锁定它）。

唯一可能导致 havok 的编译器优化是让编译器确定您使用相同的参数调用该方法两次，并且只重用第一个返回值 - 只要该函数在逻辑上确实是 const 就可以了，并为给定的一组参数（和对象状态）返回相同的值。如果任何人（包括另一个线程）都可以访问该对象以在其上调用非常量方法，那么即使该优化也是无效的。

mutable 被添加到专门针对这种情况的语言中。C++ 是一种实用的语言，并且很乐意在需要时允许这样的极端情况存在。

# javascript - IE 的 JQuery 问题（主要） - 所有版本

> ID：321378
> 
> 赞同：0
> 
> 时间：2008-11-26T16:48:16.930
> 
> 标签：javascript, jquery, internet-explorer

这只发生在 IE（所有版本）上，在 jquery-1.2.6.js 的第 1120 行，我收到以下错误：

```
Line 1120:
Invalid Property Value 
```

js文件中的行如下：

```
elem[name] = value; 
```

它在 attr 内部：`function( elem, name, value )`

有没有人有类似的问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T17:01:47.917

如果[这](http://groups.google.com/group/jquery-en/browse_thread/thread/3ef3a830916b2fbb)也是你，听起来你正在尝试更改元素的 CSS，而不是给它一个属性。

如果是这种情况，那么试试这个；

```
jQuery.css('color', 'inherit'); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-18T01:58:09.497

如果使用无效的属性值调用 jQuery.css，也会出现此错误，例如：

```
$('div.foo').css('padding-left', 'NaNpx'); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T17:12:51.680

问题仅在于 IE，因为您可能正在尝试设置诸如“最小高度”之类的内容，该内容存在于 Firefox 等（适当的 CSS 实施）浏览器中，但不存在于 Internet Explorer 等（恶魔衍生的恶魔）浏览器中。我使用 jQuery 自己的对话框 UI 功能遇到了同样的问题。

在此之前，我是 jQuery 的忠实拥护者，但这确实让我有些吃惊。

# iphone - iPhone 和 Cocos2d 精灵/图层

> ID：321382
> 
> 赞同：2
> 
> 时间：2008-11-26T16:49:54.227
> 
> 标签：iphone, objective-c, cocos2d-iphone

我正在使用 cocos2d-iphone 将 Sprites 放置到图层上以设置游戏场地。在游戏中的某些点，需要根据游戏条件移除某些 Sprite。我想做的是设置一个 Sprite 指针数组，但我有两个问题：

将 Sprite 指针放在数组中的最佳方法是什么？

如何仅使用指向 Sprite 的指针删除 cocos2d 中的 Sprite？我知道如何从其父层做到这一点，但这对于主游戏循环来说过于运行时密集。

提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T17:46:28.403

该类`Sprite`继承自`CocosNode`，因此您应该可以调用`spritePointer.parent.remove(spritePointer)`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T18:00:24.210

我想到了。如果其他人有兴趣，方法是声明一个 Sprite 指针数组，例如：

```
Sprite * mySprites[10][10]; // assuming a 10x10 playfield where obstacles get placed 
```

然后，在设置 Sprite 时：

```
mySprites[0][0] = [Sprite spriteWithFile: @"obstacle.png"];   
[myLayer add:mySprites[0][0]]; 
```

要删除精灵：

```
[myLayer remove:mySprites[0][0]]; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-05-26T21:24:44.303

还有`[mySprite removeFromParentAndCleanup:YES]`。

# c# - Resharper 在代码清理时围绕 NUnit [SetUp] 区 域

> ID：321384
> 
> 赞同：3
> 
> 时间：2008-11-26T16:50:38.220
> 
> 标签：c#, resharper

在 Ctrl+E 上，C（代码清理）ReSharper 用一个区域包围了 [SetUp] 方法。

有谁知道我怎样才能让它停下来？我不喜欢区域，也不希望它们出现在我的任何代码中。它一直在减慢我删除它们的速度。我不会停止使用代码清理，因为它太棒了，但这方面很烦人。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-26T16:55:54.510

如果您进入 resharper 选项 -> 类型成员布局。取消勾选使用默认布局，您将在那里看到默认布局。您可以查找要删除的 Nunit 文本并对其进行编辑。应用它并完成。

# asp.net - 如何让 ASP.NET 2.0 Web App 像 1.1 App 一样编译？

> ID：321396
> 
> 赞同：0
> 
> 时间：2008-11-26T16:54:18.337
> 
> 标签：asp.net, iis, deployment, asp.net-2.0

在为部署编译 ASP.NET 2.0 应用程序名称 MySite 时，我得到了一系列类似于“bin/APP_xyz123.dll”、“bin/APP_xyz456.dll”等的程序集。

一切正常，但如果我做了一个小的代码更改，我必须更新整个站点，因为每个新版本的组装名称的“_xyz123”和“_xyz456”部分都会发生变化。

我想要的是拥有一个名为 MySite.dll 的程序集，我可以根据需要对其进行更新，但目前还没有明确的方法来实现这一点。有谁知道我可以创造我想要的预期结果的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T16:55:46.430

在 2005 年和 2008 年，创建网站有两种选择——WebSite 项目和 Web 应用程序项目。

WAP 是您想要的。它在 2008 年默认可用，但您必须在 2005 年下载更新才能获得它。

[您可以在Gu-ster 的博客](http://webproject.scottgu.com/)上阅读有关它的更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T17:22:26.063

是的，你想要的WAP项目。并且您需要添加一个 Web 部署项目 (.wdproj)。然后在属性页面中，您转到“输出程序集”页面并选择所需的选项（听起来您想要“将所有页面和控制输出合并到单个程序集”）并给它您想要的名称（mysite.dll ）。

所有 cs 文件（在 App_code 和文件后面的页面中）都将合并到这个单个 dll 中（如果这是您选择的选项）。

然后每次编译时只需复制 wdproj 调试或发布文件夹中的输出（如果没有更改 aspx 页面，您只需复制 dll.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T17:41:18.147

另一种选择是使用[aspnet_merge.exe](http://msdn.microsoft.com/en-us/library/bb397866.aspx)工具，它可以为您的应用程序生成单个程序集。

# redmine - Redmine - 在问题显示中添加“花费时间”字段

> ID：321403
> 
> 赞同：14
> 
> 时间：2008-11-26T16:56:05.073
> 
> 标签：redmine

我将如何将“花费时间”添加为要在问题列表中显示的列？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-11-02T01:19:02.090

合并 Eric 和 Joel 的答案，这是我需要做的才能将“花费时间”列添加到 Redmine 1.0.3。不确定是否有更好的方法来添加翻译文本。

要为新字段提供本地化名称，请在字段定义末尾的第 299 行附近添加到 config/locales/en.yml：

```
 field_spent_hours: Spent time 
```

要添加新列，请创建 lib/spent_time_query_patch.rb 内容：

```
# Based on http://github.com/edavis10/question_plugin/blob/master/lib/question_query_patch.rb
require_dependency 'query'

module QueryPatch
  def self.included(base) # :nodoc:
    base.extend(ClassMethods)

    # Same as typing in the class
    base.class_eval do
      unloadable # Send unloadable so it will not be unloaded in development
      base.add_available_column(QueryColumn.new(:spent_hours))
    end

  end

  module ClassMethods
    unless Query.respond_to?(:available_columns=)
      # Setter for +available_columns+ that isn't provided by the core.
      def available_columns=(v)
        self.available_columns = (v)
      end
    end

    unless Query.respond_to?(:add_available_column)
      # Method to add a column to the +available_columns+ that isn't provided by the core.
      def add_available_column(column)
        self.available_columns << (column)
      end
    end
  end
end 
```

为了让上面的花费时间查询补丁实际加载，创建了 config/initializers/spent_time_query_patch.rb 内容：

```
require 'spent_time_query_patch'

Query.class_eval do
  include QueryPatch
end 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-08T06:04:32.887

您也可以通过在运行时添加列来做到这一点。这将在不修改 Redmine 核心的情况下添加花费的小时数列。只需将以下代码放入 lib/ 中的文件中即可

改编自：

*   [Redmine 预算插件](http://github.com/edavis10/redmine-budget-plugin/tree/master/lib/query_patch.rb)
*   [Redmine 问题插件](http://github.com/edavis10/redmine-question-plugin/tree/master/lib/question_query_patch.rb)

```
require_dependency '查询'

模块查询补丁
  def self.included(base) # :nodoc:
    base.extend（类方法）

    # 与在类中输入相同
    base.class_eval 做
      unloadable # 发送 unloadable 使其在开发中不会被卸载
      base.add_available_column(QueryColumn.new(:spent_hours))
    结尾

  结尾

  模块类方法

    除非 Query.respond_to?(:available_columns=)
      # 核心未提供的 +available_columns+ 的设置器。
      def available_columns=(v)
        self.available_columns = (v)
      结尾
    结尾

    除非 Query.respond_to?(:add_available_column)
      # 向 +available_columns+ 中添加核心未提供的列的方法。
      def add_available_column（列）
        self.available_columns
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-09T21:45:29.337

> 此外，如果“花费时间”列是可排序的，那将是很酷的。

在查找生成的 SQL 之后，我只是以这种方式实现了可排序功能：

```
base.add_available_column(QueryColumn.new(:spent_hours, 
 :sortable => "(select sum(hours) from time_entries where time_entries.issue_id = t0_r0)")
) 
```

替换相应的行。我只是希望 issue_id 列的名称始终是“t0_r0”...

PS：您可以在 app/models/query.rb 第 122++ 行中找到很多示例

**2 位数问题：** 不幸的是，我不得不破解其中一个核心文件：app/helpers/queries_helper.rb

在第 44 行左右，更改：

```
when 'Fixnum', 'Float'                              
  if column.name == :done_ratio
    progress_bar(value, :width => '80px')
  else
    value.to_s
  end 
```

进入：

```
when 'Fixnum', 'Float'
  if column.name == :done_ratio
    progress_bar(value, :width => '80px')
  elsif column.name == :spent_hours
    sprintf "%.2f", value
  else
    value.to_s
  end 
```

**编辑：使用补丁而不是操纵源** 最近，我们对 redmine 系统进行了更新，因此上述修复也被删除了。这一次，我们决定将其作为一个补丁来实现。

打开任何插件（我们为核心上的猴子补丁更改创建了一个插件）。打开 vendor/plugins/redmine_YOURPLUGIN/app/helpers/queries_helper.rb

```
module QueriesHelper
  def new_column_content(column, issue)
    value = column.value(issue)
    if value.class.name == "Float" and column.name == :spent_hours
      sprintf "%.2f", value
    else
      __column_content(column, issue)
    end 
  end
  alias_method :__column_content, :column_content
  alias_method :column_content, :new_column_content
end 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-10-04T11:09:15.787

此功能[内置于](http://www.redmine.org/issues/971)1.4.0 版本

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-30T20:38:27.027

由于没有人回答，我只是戳了来源，直到它产生结果。然后我开始写博客来解释我是如何做到的。

[将花费时间列添加到 Redmine 中的默认问题列表](http://joelmeador.tumblr.com/post/45927797301/add-spent-time-spent-hours-column-to-redmines)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-09-02T08:08:22.797

通过使用[AgileDwarf](http://www.agiledwarf.com/)插件。你可以花时间&你可以说出你这段时间花了什么（开发-设计-...）

# c# - 从邮件文件中读取电子邮件

> ID：321411
> 
> 赞同：0
> 
> 时间：2008-11-26T17:00:43.970
> 
> 标签：c#, .net, email

我有大量的邮件档案，我想去重复和整理。档案要么采用 mbox 格式，要么包含单个邮件消息。为了增加一点复杂性，有些文件有 windows EOL 序列，有些文件有 unix EOL。
使用 C#。如何读取存档并将其拆分为单独的消息，或读取单个消息文件？在 python 中，我会使用*mailbox.mbox*类，但在 C# 文档中看不到匹配的功能。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T20:16:31.627

您不太可能找到一个库来为 C# 读取该文件 - 没有那么多 Unix 用户也使用 C#。

我会做的是：

1.  阅读 Python 代码，然后将其移植到 C#
2.  在线查找 mbox 格式的说明。由于它是 Unix 系统，因此格式很可能只是一个纯文本文件，应该很容易解析。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-29T02:05:10.893

大多数标准 Unix 邮件文件以“From”开头的行分隔条目

因此，如果您将邮件文件作为文本文件读取，并且每次在行首看到字符串“From”时切换到新的邮件条目，它应该可以工作 - 其他任何地方的字符串都应该已经被电子邮件程序分隔

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-05T00:18:35.290

如果是一次性活动，我认为对消息进行排序的最简单步骤：

1.  将所有 mbox 文件合并为一个
2.  将编译加载到 Thunderbird 作为本地文件夹
3.  在文件夹上运行重复消息查找器插件之一
4.  删除找到的重复项
5.  压缩文件夹
6.  获取无重复消息列表:)

[重复消除器（Thunderbird 的附加组件）](https://addons.mozilla.org/en-US/thunderbird/search?q=duplicate&cat=all&advancedsearch=1&as=1&appid=18&lver=any&atype=0&pp=20&pid=5&sort=&lup=)

我用过这个：删除重复消息（备用）

# c# - IE 的 getBoundingClientRect 在浏览器中给出的答案与在 windows.forms.webbrowser 中不同 - 为什么？

> ID：321412
> 
> 赞同：1
> 
> 时间：2008-11-26T17:00:56.623
> 
> 标签：c#, browser, mshtml

取以下html

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>Basic Layout</title>
    <style type="text/css">
        html,body,div{font-family:Verdana}
        #Head{border-bottom:solid 10px #369}
        #Body{margin-left:200px;background-color:#def}
        #Body h2{float:left;margin-left:-200px;padding:10px;font-size:1em;}
        #Foot{border-top:dashed 1px #369}
        p{page-break-inside:avoid}
    </style>
    <script>
        document.onclick = function() {
            alert(document.getElementById("Body").getBoundingClientRect().left);
        }
    </script>
</head>
<body>
    <div id="Head">
        <h1>Basic Layout Header</h1>
    </div>
    <div id="Body">
        <h2>Body Header</h2>
        <p>
            Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Mauris pretium. Morbi
            nisi velit, lacinia vitae, porttitor nec, laoreet nec, neque. Fusce id dolor. Vivamus
            scelerisque libero. Fusce aliquet gravida dui. Integer vulputate bibendum pede.
            Donec fringilla porta sem. Donec justo pede, fermentum eu, mattis a, malesuada id,
            erat. Maecenas hendrerit justo vitae felis. Praesent ut purus. Pellentesque turpis
            tortor, lobortis sed, fringilla venenatis, mattis nec, ipsum. Nunc non diam. Maecenas
            gravida mollis quam. Aenean nec urna. Quisque gravida, nulla a vulputate mattis,
            mauris justo mollis leo, et pellentesque eros augue sit amet urna. Aliquam rhoncus
            erat in mauris. Nullam ut urna. Nam pharetra, purus ac ultricies consectetuer, est
            leo aliquam augue, vitae pulvinar dui mi scelerisque mi. Integer urna. Praesent
            risus libero, porttitor vel, auctor gravida, posuere vel, felis.
        </p>
    </div>
    <div id="Foot">
        <p>Footer</p>
    </div>
</body>
</html> 
```

将其加载到浏览器中并单击任意位置 - 你会得到 210 这是#Body div 的左值

但是，在带有 webbrowser 控件的 win 表单上，导航到相同的 html

```
 webBrowser1.Navigate(_Url); 
```

再次单击，您将获得 10。

为什么……为什么……为什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-26T17:34:22.890

更新：

将此添加到头部元素，（我安装了 ie8 beta 2）

```
<META http-equiv="X-UA-Compatible" content="IE=8"> 
```

它可以工作（显示了 208），但是

```
<META http-equiv="X-UA-Compatible" content="IE=7"> 
```

仍然显示 10，这需要为 ie 7 工作

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T18:48:45.017

搬到这里， [http ://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=4176755&SiteID=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=4176755&SiteID=1)

# c++ - LPCSTR、LPCTSTR 和 LPTSTR

> ID：321413
> 
> 赞同：125
> 
> 时间：2008-11-26T17:01:15.543
> 
> 标签：c++, windows, visual-c++, mfc

`LPCSTR`和`LPCTSTR`和有什么区别`LPTSTR`？

为什么我们需要这样做来将字符串转换为`LV`/`_ITEM`结构变量`pszText`：

```
LV_DISPINFO dispinfo;  
dispinfo.item.pszText = LPTSTR((LPCTSTR)string); 
```

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2008-11-26T17:09:48.023

要回答您问题的第一部分：

`LPCSTR`是指向 const 字符串的指针（LP 表示[Long Pointer](https://stackoverflow.com/questions/2315311/what-is-a-long-pointer)）

`LPCTSTR`是一个指向`const TCHAR`字符串的指针，（`TCHAR`可以是宽字符还是字符，具体取决于项目中是否定义了 UNICODE）

`LPTSTR`是指向（非常量）`TCHAR`字符串的指针

实际上，在过去谈论这些时，为了简单起见，我们省略了“指向一个”短语，但正如在轨道上的轻量级所提到的，它们都是指针。

这是一篇很棒的[代码项目文章](http://www.codeproject.com/KB/string/cppstringguide1.aspx)，描述了 C++ 字符串（请参阅下面的 2/3 以获取比较不同类型的图表）

* * *

## 回答 #2

> 赞同：94
> 
> 时间：2008-11-26T17:09:35.857

又快又脏：

`LP`==**长**指针。**_** 想想指针或字符*

`C`= **C** onst，在这种情况下，我认为它们的意思是字符串是 const，而不是指针是 const。

`STR`是**字符串**

`T`取决于编译器选项，它用于宽字符或字符（TCHAR）。

## 奖金阅读

LPTSTR[中的字母“T”代表什么？](https://devblogs.microsoft.com/oldnewthing/20061017-03/?p=29363):^([存档](https://archive.ph/3lqLY))

> # LPTSTR 中的字母“T”代表什么？
> 
> 2006 年 10 月 17 日
> 
> LPTSTR 中的“T”来自 TCHAR 中的“T”。我不确定，但它似乎很可能代表“文本”。相比之下，WCHAR 中的“W”可能来自 C 语言标准，它代表“宽”。

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2017-09-27T21:00:17.397

## 8 位 AnsiStrings

*   `char`: 8 位字符*（底层 C/C++ 数据类型）*
*   `CHAR`*: （Windows 数据类型）*的别名`char`
**   `LPSTR`: 以空字符结尾的***字符串***`CHAR` *（**长**指针）****   `LPCSTR`: 以空字符结尾的常量***字符串***`CHAR` *（**Long** Pointer **C**常量）****

 *******## 16 位 Unicode 字符串

*   `wchar_t`: 16 位字符*（底层 C/C++ 数据类型）*
*   `WCHAR`*: （Windows 数据类型）*的别名`wchar_t`
**   `LPWSTR`: 以空字符结尾的***字符串***`WCHAR` *（**长**指针）****   `LPCWSTR`: 以空字符结尾的常量***字符串***`WCHAR` *（**Long** Pointer **C**常量）****

 *******## 取决于`UNICODE`定义

*   `TCHAR``WCHAR`:如果定义了 UNICODE 的别名；除此以外`CHAR`
*   `LPTSTR`: 以空字符结尾的***字符串***`TCHAR` *（**长**指针）*
***   `LPCTSTR`: 以空字符结尾的常量***字符串***`TCHAR` *（**Long** Pointer **C**常量）***

 ******所以：

| 物品 | 8 位*(Ansi)* | 16 位*（宽）* | 变化 |
| --- | --- | --- | --- |
| 特点 | `CHAR` | `WCHAR` | `TCHAR` |
| 细绳 | `LPSTR` | `LPWSTR` | `LPTSTR` |
| 字符串（常量） | `LPCSTR` | `LPCWSTR` | `LPCTSTR` |

## 奖金阅读

`TCHAR`→[*文本字符*](https://blogs.msdn.microsoft.com/oldnewthing/20061017-03/?p=29363) *( [archive.is](https://archive.fo/bWuoe) )*

* * *

[**为什么默认的 8 位代码页称为“ANSI”？**](https://archive.today/oV0B)

来自[Unicode 和 Windows XP](https://web.archive.org/web/20060223061715/http://download.microsoft.com/download/5/6/8/56803da0-e4a0-4796-a62c-ca920b73bb17/21-Unicode_WinXP.pdf)
，作者 Cathy Wissink
项目经理，Windows 全球化
微软公司
2002 年 5 月

> 尽管 Windows NT 3.1 支持底层的 Unicode，但系统中包含的许多高级应用程序和组件仍然需要代码页支持，这解释了 Win32 API 的“A”[ANSI] 版本的普遍使用，而不是比“W”[“宽”或 Unicode] 版本。（用于表示 Windows 代码页的术语“ANSI”是一个历史参考，但如今在 Windows 社区中继续存在的一个误称。这源于 Windows 代码页 1252 最初基于ANSI 草案，后来成为 ISO 标准 8859-1。但是，在向 ISO 标准中为控制代码保留的范围添加代码点时，Windows 代码页 1252 和最初基于 ISO 8859-x 系列的后续 Windows 代码页偏离了来自 ISO。直到今天，

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-26T17:12:55.897

添加到约翰和蒂姆的答案。

除非您正在为 Win98 编码，否则您应该在应用程序中使用 6 种以上的字符串类型中的两种

*   `LPWSTR`
*   `LPCWSTR`

其余的旨在支持 ANSI 平台或双重编译。这些在今天已经不像过去那么重要了。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-09-05T23:42:12.497

要回答问题的第二部分，您需要执行以下操作

```
LV_DISPINFO dispinfo;  
dispinfo.item.pszText = LPTSTR((LPCTSTR)string); 
```

因为 MS 的`LVITEM`结构有一个`LPTSTR`，即一个*可变*的T 字符串指针，而不是一个`LPCTSTR`. 你正在做的是

1）将`string`（`CString`猜测为a）转换为`LPCTSTR`（实际上意味着将其字符缓冲区的地址作为只读指针获取）

`const`2）通过抛弃它的-ness ，将该只读指针转换为可写指针。

这取决于`dispinfo`你的电话是否有可能`ListView`最终试图通过它来**写**`pszText`。如果是这样，这可能是一件非常糟糕的事情：毕竟你得到了一个只读指针，然后决定把它当作可写的：也许它是只读的是有原因的！

如果`CString`您正在使用它，您可以选择使用`string.GetBuffer()`- 故意为您提供可写的`LPTSTR`. 然后，您必须记住`ReleaseBuffer()`在字符串确实发生更改时调用。或者您可以分配一个本地临时缓冲区并将字符串复制到那里。

在 99% 的情况下，这将是不必要的，并且将其`LPCTSTR`视为一种`LPTSTR`工作......但是有一天，当你最不期待的时候......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-12-15T03:39:59.953

对问题第二部分的简短回答是，`CString`该类没有通过设计提供直接的类型转换，而您正在做的是一种作弊。

更长的答案如下：

您可以打字的原因`CString`是`LPCTSTR`因为 CString 通过覆盖提供了此功能`operator=`。按照设计，它只提供对`LPCTSTR`指针的转换，因此不能用这个指针修改字符串值。

换句话说，出于与上述相同的原因，它根本不提供`operator=`将转换`CString`为的重载。`LPSTR`他们不想允许以这种方式更改字符串值。

所以本质上，诀窍是使用运营商 CString 提供并得到这个：

```
LPTSTR lptstr = (LPCTSTR) string; // CString provide this operator overload 
```

现在 LPTSTR 可以进一步类型转换为 LPSTR :)

```
dispinfo.item.pszText = LPTSTR( lpfzfd); // accomplish the cheat :P 
```

从“CString”获取的正确方法`LPTSTR`是这样的（完整示例）：

```
CString str = _T("Hello");
LPTSTR lpstr = str.GetBuffer(str.GetAllocLength());
str.ReleaseBuffer(); // you must call this function if you change the string above with the pointer 
```

再次因为[GetBuffer()](https://docs.microsoft.com/en-us/cpp/atl-mfc-shared/reference/csimplestringt-class?view=msvc-160#getbuffer)`LPTSTR`出于这个原因返回，现在您可以修改:)

# silverlight - Silverlight DataGrid 异常重新排序列标题

> ID：321417
> 
> 赞同：1
> 
> 时间：2008-11-26T17:01:53.670
> 
> 标签：silverlight, datagrid

我正在尝试通过更改列标题 DisplayIndex 值来设置 silverlight 数据网格中列标题的初始显示顺序。如果我尝试在页面加载时设置列顺序，则会出现超出范围的异常。如果我稍后设置列顺序（相同的例程），例如在按钮单击处理程序中，它可以工作。这只是 silverlight datagrid 控件中的错误吗？对可能的解决方法的建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T12:26:55.893

我猜您在从 Page Loaded 事件修改 DataGrid 中的列的 DisplayIndex 时遇到问题，因为此时尚未创建它们。您没有说，但我假设您正在让 DataGrid 自动生成列，否则您可以在定义 DataGrid 列时在 XAML 中设置 DisplayIndex。

当 DataGrid 生成 Columns 时，它会为每个 Column 触发一个 AutoGeneratingColumn 事件，允许您修改其属性。这有点粗略，但一种解决方案可能是使用为其创建列的 PropertyName 在此事件的处理程序中设置 DisplayIndex。

```
private void grid_AutoGeneratingColumn(object sender, DataGridAutoGeneratingColumnEventArgs e)
{
    switch (e.PropertyName)
    {
        case "Name":
            e.Column.DisplayIndex = 1;
            break;

        case "Age":
            e.Column.DisplayIndex = 0;
            break;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-11-10T13:36:52.927

```
/// <summary>
/// Automation DataGrid Control - Columns Localization and Ordering
/// Option1: Localization of Columns Automatically
/// Option2: Ordering columns in DataGrid Automatically
/// </summary>
/// <param name="dataGrid"> DataGrid control</param>
/// <param name="ContractType"> Contract of Row DataItem 
/// Example: typeof(ClientType) 
/// </param>
/// <param name="columns"> Ordered Properties of Contract
/// Example:  columns = "Id_Client,Client,GeographyItem,Flag_Approved,ClientType,ClientRelation,ClientPrestigeLevel"
/// </param>
public void AutomateDataGridColumns(DataGrid dataGrid, Type Contract, String columns)
{
    try
    {   
        List<String> OrderedColumns = columns.Split(new string[] { ",", "|", ";" }, StringSplitOptions.RemoveEmptyEntries).ToList();

        //Buid Order of created COLUMNS
        dataGrid.Loaded += (sndr, arg) =>
        {
            if (dataGrid.Columns.Count == OrderedColumns.Count && dataGrid.AutoGenerateColumns == true)                       
            {
                foreach (var item in dataGrid.Columns)
                {
                    Int32 displayIndex = OrderedColumns.IndexOf(item.Header.ToString());
                    if (displayIndex != -1)
                    {  item.DisplayIndex = displayIndex;  }                          
                }
            };
        };

        //DataGridColumn Localization  
        dataGrid.AutoGeneratingColumn += (sndr, arg) =>
        {
                LocalizeDataGridColumn(sndr as DataGrid, arg, Contract, OrderedColumns);

                //We need To Update DataGrid  after last Column Localized -->so  Loaded event will be Raised/
                // or ArgumentOutOfRange Exception will be thrown
                if (dataGrid.Columns.Count == OrderedColumns.Count && dataGrid.AutoGenerateColumns == true)
                {
                    dataGrid.UpdateLayout();
                }
        };

    }           
    catch (Exception exc)
    {  throw exc;
    }
}

/// <summary>
/// DataGridColumn Control Localization
/// </summary>
/// <param name="dataGrid">Host DataGrid control </param>
/// <param name="arg">Auto Generated Column arg </param>
/// <param name="Contract">Type Contract</param>
/// <param name="localizationColumns">Ordered Properties to Contract </param>
protected void LocalizeDataGridColumn(DataGrid dataGrid, DataGridAutoGeneratingColumnEventArgs arg, Type Contract, List<String> localizationColumns)
{
    try
    {
        DataGridColumn Column = arg.Column;

        if (localizationColumns.Contains(Column.Header.ToString()))
        {
            // LOCALIZING Column.Header                      

            // Check column local resource key exist 
            // CultureKeys -  local Culture enum type 
            // SystemDispatcher - is My SL4  MEF Bootstrappper 
            // LocalizationService  - is My Localization service in SL4   
            // if somebody is interested i can share more of my LocalizationService - use mail      
            CultureKeys currntCulture = SystemDispatcher.LocalizationService.CurrentCulture;
            string ResourceKey = LocalResKeys.BoPropElmNameLoc.ToString() + "\\" + Contract.Name + @"|" + Column.Header.ToString();

            if (SystemDispatcher.LocalizationService.CultureResources[currntCulture].Item2.ContainsKey(ResourceKey))
                Column.Header = SystemDispatcher.LocalizationService.CultureResources[currntCulture].Item2[ResourceKey];                                       
        }
        else
        {    arg.Cancel = true;
        }
    }
    catch (Exception exc)
    {
        throw exc;
    }

} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-19T09:54:04.123

实际上，您需要订阅 grid.Loaded 事件并在那里重新排序列：

```
public UserManagementControl()
    {
        InitializeComponent();
        dataGridUsers.Loaded += new RoutedEventHandler(dataGridUsers_Loaded);
    }

    void dataGridUsers_Loaded(object sender, RoutedEventArgs e)
    {
        dataGridUsers.Columns[0].DisplayIndex = 1;
    } 
```

你有 ArgumentOutOfRangeException 因为到目前为止还没有加载控件

# java - 在哪里关闭 java PreparedStatements 和 ResultSets？

> ID：321418
> 
> 赞同：43
> 
> 时间：2008-11-26T17:02:08.990
> 
> 标签：java, jdbc, resource-management

考虑代码：

```
PreparedStatement ps = null;
ResultSet rs = null;
try {
  ps = conn.createStatement(myQueryString);
  rs = ps.executeQuery();
  // process the results...
} catch (java.sql.SQLException e) {
  log.error("an error!", e);
  throw new MyAppException("I'm sorry. Your query did not work.");
} finally {
  ps.close();
  rs.close();
} 
```

上面没有编译，因为两者都`PreparedStatement.close()`抛出`ResultSet.close()`了`java.sql.SQLException`. 那么我应该在 finally 子句中添加一个 try/catch 块吗？或者将 close 语句移到 try 子句中？或者只是不打扰打电话关闭？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-11-26T19:29:47.680

在 Java 7 中，您不应该显式关闭它们，而是使用[自动资源管理](http://www.oracle.com/technetwork/articles/java/trywithresources-401775.html)来确保关闭[资源](http://docs.oracle.com/javase/7/docs/api/java/lang/AutoCloseable.html)并正确处理异常。异常处理的工作方式如下：

```
尝试中的异常 | 关闭异常 | 结果
-----------------+--------------------+------------ -----------------------------------------
      没有 | 没有 | 继续正常
      没有 | 是 | 抛出 close() 异常
      是 | 没有 | 从 try 块中抛出异常
      是 | 是 | 将 close() 异常添加到主异常
                 | | 作为“抑制”，抛出主要异常

```

希望这是有道理的。在允许漂亮的代码，像这样：

```
private void doEverythingInOneSillyMethod(String key)
  throws MyAppException
{
  try (Connection db = ds.getConnection()) {
    db.setReadOnly(true);
    ...
    try (PreparedStatement ps = db.prepareStatement(...)) {
      ps.setString(1, key);
      ...
      try (ResultSet rs = ps.executeQuery()) {
        ...
      }
    }
  } catch (SQLException ex) {
    throw new MyAppException("Query failed.", ex);
  }
} 
```

* * *

在 Java 7 之前，最好使用嵌套的 finally 块，而不是测试 null 的引用。

我将展示的示例使用深度嵌套可能看起来很难看，但在实践中，设计良好的代码可能不会以相同的方法创建连接、语句和结果；通常，每个级别的嵌套都涉及将资源传递给另一个方法，该方法将其用作另一个资源的工厂。使用这种方法，来自 a的异常将掩盖块`close()`内部的异常。`try`这是可以克服的，但它会导致代码更加混乱，并且需要一个自定义异常类来提供 Java 7 中存在的“被抑制的”异常链接。

```
Connection db = ds.getConnection();
try {
  PreparedStatement ps = ...;
  try {
    ResultSet rs = ...
    try {
      ...
    }
    finally {
      rs.close();
    }
  } 
  finally {
    ps.close();
  }
} 
finally {
  db.close();
} 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-11-26T17:10:40.300

如果您真的在手动滚动自己的 jdbc，它肯定会变得一团糟。finally 中的 close() 需要用自己的 try catch 包裹起来，这至少是丑陋的。您不能跳过关闭，尽管在连接关闭时资源将被清除（如果您使用的是池，则可能不会立即清除）。实际上，使用框架（例如休眠）来管理您的数据库访问的主要卖点之一是管理连接和结果集处理，这样您就不会忘记关闭。

你可以做一些像这样简单的事情，这至少隐藏了混乱，并保证你不会忘记一些东西。

```
public static void close(ResultSet rs, Statement ps, Connection conn)
{
    if (rs!=null)
    {
        try
        {
            rs.close();

        }
        catch(SQLException e)
        {
            logger.error("The result set cannot be closed.", e);
        }
    }
    if (ps != null)
    {
        try
        {
            ps.close();
        } catch (SQLException e)
        {
            logger.error("The statement cannot be closed.", e);
        }
    }
    if (conn != null)
    {
        try
        {
            conn.close();
        } catch (SQLException e)
        {
            logger.error("The data source connection cannot be closed.", e);
        }
    }

} 
```

进而，

```
finally {
    close(rs, ps, null); 
} 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-26T17:09:30.350

对于文件 I/O，我通常在 finally 块中添加一个 try/catch。但是，您必须小心不要从 finally 块中抛出任何异常，因为它们会导致原始异常（如果有）丢失。

有关关闭数据库连接的更具体示例，请参阅[本文](http://accu.org/index.php/journals/236)。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-26T17:20:03.137

不要浪费时间编写低级异常管理，使用像 Spring-JDBC 这样的高级 API 或围绕连接/语句/rs 对象的自定义包装器来隐藏杂乱的 try-catch 代码。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-03-25T15:13:20.490

另请注意：

“当一个 Statement 对象关闭时，它当前的 ResultSet 对象（如果存在）也将关闭。”

[http://java.sun.com/j2se/1.5.0/docs/api/java/sql/Statement.html#close()](http://java.sun.com/j2se/1.5.0/docs/api/java/sql/Statement.html#close())

仅在 finally 中关闭 PreparedStatement 就足够了，并且仅当它尚未关闭时。但是，如果您想真正特别，请先关闭 ResultSet，而不是在关闭 PreparedStatement 之后（之后关闭它，就像这里的一些示例一样，实际上应该保证异常，因为它已经关闭了）。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-26T17:11:23.543

我通常有一个实用方法可以关闭这样的事情，包括注意不要尝试使用空引用做任何事情。

通常如果`close()`抛出我并不关心的异常，所以我只是记录异常并吞下它 - 但另一种选择是将它转换为`RuntimeException`. 无论哪种方式，我都建议使用易于调用的实用方法来执行此操作，因为您可能需要在许多地方执行此操作。

请注意，如果关闭 PreparedStatement 失败，您当前的解决方案不会关闭 ResultSet - 最好使用嵌套的 finally 块。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2017-04-06T17:05:41.500

以@erickson 的回答为基础，为什么不像这样在一个`try`街区内完成呢？

```
private void doEverythingInOneSillyMethod(String key) throws MyAppException
{
  try (Connection db = ds.getConnection();
       PreparedStatement ps = db.prepareStatement(...)) {

    db.setReadOnly(true);
    ps.setString(1, key);
    ResultSet rs = ps.executeQuery()
    ...
  } catch (SQLException ex) {
    throw new MyAppException("Query failed.", ex);
  }
} 
```

请注意，您不需要在块`ResultSet`内创建对象，因为当对象关闭时 's 会自动关闭。`try``ResultSet``PreparedStatement`

> 当生成它的 Statement 对象关闭、重新执行或用于从多个结果序列中检索下一个结果时，ResultSet 对象将自动关闭。

参考：[https ://docs.oracle.com/javase/7/docs/api/java/sql/ResultSet.html](https://docs.oracle.com/javase/7/docs/api/java/sql/ResultSet.html)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-08-06T08:17:14.747

如果您使用的是 Java 7，则可以在那些实现[AutoCloseable](http://docs.oracle.com/javase/7/docs/api/java/lang/AutoCloseable.html)的类中使用异常处理机制的改进（即`PreparedStatement`，`Resultset`）

您可能还会发现这个问题很有趣：[Closing ResultSet in Java 7](https://stackoverflow.com/questions/11454999/closing-resultset-in-java-7)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-06-12T05:02:03.127

我知道这是一个老问题，但如果有人正在寻找答案，java 现在有 try-with-resouce 解决方案。

```
static String readFirstLineFromFile(String path) throws IOException {
      try (BufferedReader br =
                   new BufferedReader(new FileReader(path))) {
        return br.readLine();
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-26T17:10:13.653

不要省略调用关闭。它可能会导致问题。

我更喜欢在 finally 中添加 try/catch 块。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-12-08T05:43:50.140

可能是一种旧的（虽然简单）的做事方式，但它仍然有效：

```
public class DatabaseTest {

    private Connection conn;    
    private Statement st;   
    private ResultSet rs;
    private PreparedStatement ps;

    public DatabaseTest() {
        // if needed
    }

    public String getSomethingFromDatabase(...) {
        String something = null;

        // code here

        try {
            // code here

        } catch(SQLException se) {
            se.printStackTrace();

        } finally { // will always execute even after a return statement
            closeDatabaseResources();
        }

        return something;
    }

    private void closeDatabaseResources() {
        try {
            if(conn != null) {
                System.out.println("conn closed");
                conn.close();
            }

            if(st != null) {
                System.out.println("st closed");
                st.close();
            }

            if(rs != null) {
                System.out.println("rs closed");
                rs.close();
            }

            if(ps != null) {
                System.out.println("ps closed");
                ps.close();
            }

        } catch(SQLException se) {
            se.printStackTrace();
        }               
    }
} 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2012-08-06T08:06:38.103

关注 finally 子句，

```
finally {
   try {
      rs.close();
      ps.close();
   } catch (Exception e) {
      // Do something
   }
} 
```

我认为你必须修改2点。

首先，在fainlly 子句中再次使用try & catch。

其次，在执行 ps.close() 之前执行 rs.close()。

fly1997@naver.com

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2008-11-26T17:11:00.720

我用这个。。

```
finally
{
    if (ps != null) ps.close();
    if (rs != null) rs.close();
} 
```

# c - 在 C 中解析二进制数据？

> ID：321423
> 
> 赞同：20
> 
> 时间：2008-11-26T17:03:00.753
> 
> 标签：c, parsing, network-programming

是否有任何关于如何在 C 中读取和解析二进制数据的库或指南？

我正在研究一些功能，这些功能将在网络套接字上接收 TCP 数据包，然后根据规范解析二进制数据，通过代码将信息转换为更可用的形式。

是否有任何图书馆可以做到这一点，或者甚至是执行这类事情的入门书？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-27T16:02:07.287

我不得不不同意这里的许多回应。我强烈建议您避免将结构强制转换为传入数据的诱惑。它看起来很有说服力，甚至可能适用于您当前的目标，但是如果将代码移植到另一个目标/环境/编译器，您就会遇到麻烦。几个原因：

**Endianness**：您现在使用的架构可能是大端，但您的下一个目标可能是小端。或相反亦然。您可以使用宏（例如，ntoh 和 hton）来克服这个问题，但这是额外的工作，并且您必须确保*每次*引用该字段时都调用这些宏。

**对齐**：您使用的体系结构可能能够在奇地址偏移处加载多字节字，但许多体系结构不能。如果 4 字节字跨越 4 字节对齐边界，则加载可能会拉垃圾。即使协议本身没有错位字，有时字节流本身也会错位。（例如，虽然 IP 报头定义将所有 4 字节字放在 4 字节边界上，但以太网报头通常会将 IP 报头本身推到 2 字节边界上。）

**Padding**：您的编译器可能会选择在没有填充的情况下紧密打包您的结构，或者它可能会插入填充以处理目标的对齐约束。我已经看到同一编译器的两个版本之间的这种变化。您可以使用#pragmas 来强制解决问题，但#pragmas 当然是特定于编译器的。

**位排序**：C 位域内的位排序是特定于编译器的。另外，对于您的运行时代码，这些位很难“获取”。每次引用结构内的位域时，编译器都必须使用一组掩码/移位操作。当然，您将不得不在某些时候进行掩蔽/移动，但如果速度是一个问题，最好不要在每个参考点都这样做。（如果空间是最重要的问题，那么使用位域，但要小心。）

这并不是说“不要使用结构”。我最喜欢的方法是声明所有相关协议数据的友好本机字节序结构，没有任何位域并且不关心问题，然后编写一组使用该结构作为中间人的对称打包/解析例程。

```
typedef struct _MyProtocolData
{
    Bool myBitA;  // Using a "Bool" type wastes a lot of space, but it's fast.
    Bool myBitB;
    Word32 myWord;  // You have a list of base types like Word32, right?
} MyProtocolData;

Void myProtocolParse(const Byte *pProtocol, MyProtocolData *pData)
{
    // Somewhere, your code has to pick out the bits.  Best to just do it one place.
    pData->myBitA = *(pProtocol + MY_BITS_OFFSET) & MY_BIT_A_MASK >> MY_BIT_A_SHIFT;
    pData->myBitB = *(pProtocol + MY_BITS_OFFSET) & MY_BIT_B_MASK >> MY_BIT_B_SHIFT;

    // Endianness and Alignment issues go away when you fetch byte-at-a-time.
    // Here, I'm assuming the protocol is big-endian.
    // You could also write a library of "word fetchers" for different sizes and endiannesses.
    pData->myWord  = *(pProtocol + MY_WORD_OFFSET + 0) << 24;
    pData->myWord += *(pProtocol + MY_WORD_OFFSET + 1) << 16;
    pData->myWord += *(pProtocol + MY_WORD_OFFSET + 2) << 8;
    pData->myWord += *(pProtocol + MY_WORD_OFFSET + 3);

    // You could return something useful, like the end of the protocol or an error code.
}

Void myProtocolPack(const MyProtocolData *pData, Byte *pProtocol)
{
    // Exercise for the reader!  :)
} 
```

现在，您的其余代码仅在友好、快速的结构对象中操作数据，并且仅在您必须与字节流交互时才调用 pack/parse。不需要 ntoh 或 hton，也不需要位域来减慢您的代码速度。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-26T17:31:59.260

在 C/C++ 中执行此操作的标准方法实际上是按照“gwaredd”的建议转换为结构

它并不像人们想象的那样不安全。您首先转换为您期望的结构，如他/她的示例中所示，**然后**测试该结构的有效性。您必须测试最大值/最小值、终止序列等。

无论您使用什么平台，都必须阅读[Unix Network Programming, Volume 1: The Sockets Networking API](https://rads.stackoverflow.com/amzn/click/com/0131411551)。买，借，偷（受害者会明白，这就像偷食物什么的……），但一定要读。

在阅读史蒂文斯之后，大部分内容会更有意义。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-27T07:22:54.057

让我重申你的问题，看看我是否理解正确。您正在寻找可以对数据包进行正式描述然后生成“解码器”来解析此类数据包的软件？

如果是这样，该字段中的引用是[PADS](http://padsproj.org/)。介绍它的一篇好文章是[PADS: A Domain-Specific Language for Processing Ad Hoc Data](http://www.padsproj.org/papers/pldi.pdf)。PADS 非常完整，但不幸的是在非免费许可证下。

有可能的替代方案（我没有提到非 C 解决方案）。显然，没有一个可以被视为完全生产就绪：

*   [宾派克](http://www.imconf.net/imc-2006/papers/p29-pang.pdf)
*   [数据包类型](http://www.sigcomm.org/sigcomm2000/conf/paper/sigcomm2000-9-2.ps.gz)
*   [数据脚本](http://datascript.sourceforge.net/)

如果您阅读法语，我在[Génération de décodeurs de format binaires](http://www.bortzmeyer.org/binaire-vers-structures.html)中总结了这些问题。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-11-27T07:44:31.143

以我的经验，最好的方法是首先编写一组原语，从二进制缓冲区读取/写入某种类型的单个值。这为您提供了高可见性，以及处理任何字节顺序问题的非常简单的方法：只需让函数正确执行即可。

然后，您可以为`struct`每个协议消息定义 s，并为每个消息编写打包/解包（有些人称它们为序列化/反序列化）函数。

作为基本情况，提取单个 8 位整数的原语可能如下所示（假设`char`主机上有 8 位，如果需要，您也可以添加一层自定义类型来确保这一点）：

```
const void * read_uint8(const void *buffer, unsigned char *value)
{
  const unsigned char *vptr = buffer;
  *value = *buffer++;
  return buffer;
} 
```

在这里，我选择通过引用返回值，并返回一个更新后的指针。这是一个口味问题，您当然可以返回值并通过引用更新指针。读取函数更新指针以使这些指针可链接是设计的关键部分。

现在，我们可以编写一个类似的函数来读取 16 位无符号数：

```
const void * read_uint16(const void *buffer, unsigned short *value)
{
  unsigned char lo, hi;

  buffer = read_uint8(buffer, &hi);
  buffer = read_uint8(buffer, &lo);
  *value = (hi << 8) | lo;
  return buffer;
} 
```

这里我假设传入的数据是大端的，这在网络协议中很常见（主要是出于历史原因）。你当然可以变得聪明，做一些指针运算并消除对临时的需要，但我发现这种方式使它更清晰，更容易理解。在调试时，在这种原语中具有最大的透明度可能是一件好事。

下一步将开始定义您的协议特定消息，并编写读/写原语以进行匹配。在那个层面上，考虑代码生成；如果您的协议以某种通用的、机器可读的格式描述，您可以从中生成读/写函数，这样可以省去很多麻烦。如果协议格式[足够聪明](http://www.uni-verse.org/)，这会更难，但通常可行且强烈推荐。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-26T17:21:06.677

您可能对[Google Protocol Buffers](http://code.google.com/p/protobuf/)感兴趣，它基本上是一个序列化框架。它主要用于 C++/Java/Python（这些是 Google 支持的语言），但正在努力将其移植到其他语言，包括[C](http://code.google.com/p/protobuf-c/)。（我根本没有使用过 C 端口，但我负责其中一个 C# 端口。）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-26T17:12:36.553

您实际上并不需要在 C 中解析二进制数据，只需将一些指针指向您认为应该是的任何内容。

```
struct SomeDataFormat
{
    ....
}

SomeDataFormat* pParsedData = (SomeDataFormat*) pBuffer; 
```

请注意字节序问题、类型大小、读取缓冲区末尾等

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-26T18:04:46.760

解析/格式化二进制结构是在 C 中比在高级/托管语言中更容易完成的**极少数事情之一。**您只需定义一个与您要处理的格式相对应的结构，该结构**就是**解析器/格式化程序。这是可行的，因为 C 中的结构表示精确的内存布局（当然，它已经是二进制的）。另请参阅 kervin 和 gwaredd 的回复。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-26T17:22:23.957

我不太明白你在找什么样的图书馆？将接受任何二进制输入并将其解析为未知格式的通用库？我不确定是否有这样的库可以以任何语言存在。我认为您需要稍微详细说明您的问题。

**编辑**：
好的，所以在阅读[Jon 的](https://stackoverflow.com/questions/321423/parsing-binary-data-in-c#321482)回答之后似乎有一个库，它更像是代码生成工具。但正如许多人所说，只是将数据转换为适当的数据结构，适当小心，即使用打包结构并处理字节序问题，你很好。将这样的工具与 C 一起使用只是一种矫枉过正。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-27T07:21:58.880

基本上是关于铸造`struct`工作的建议，但请注意，数字在不同的架构上可能以不同的方式表示。

为了处理字节序问题，引入了网络字节顺序 - 通常的做法是在发送数据之前将数字从主机字节顺序转换为网络字节顺序，并在接收时转换回主机顺序。请参阅函数`htonl`、`htons`和。`ntohl``ntohs`

并真正考虑 kervin 的建议 - 阅读[UNP](https://rads.stackoverflow.com/amzn/click/com/0131411551)。你不会后悔的！

# wpf - 我可以在 WCF 中使用 INotifyPropertyChanged 吗？

> ID：321429
> 
> 赞同：3
> 
> 时间：2008-11-26T17:04:34.913
> 
> 标签：wpf, wcf

在我的 WPF 应用程序中，我调用 WCF 服务来检索我的业务对象。我获取该业务对象并将其绑定到网格。我现在想应用 INotifyPropertyChanged 属性，但不确定它是否适用于 WCF。我的最终目标是能够编辑网格中的项目，单击更新并通过 WCF 服务将其推回。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T17:08:29.320

我认为生成的类可以选择自动实现。

> **`svcutil /enableDataBinding`**
> - 在所有数据协定类型上实现 System.ComponentModel.INotifyPropertyChanged 接口以启用数据绑定。（简称：/edb）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-27T10:05:56.553

如果您谈论的是部分受信任的 WPF 应用程序，您可以在 .NET 3.5 中...您不能在 .NET 3.0 中...

如果您所说的是完全信任，我认为没有问题:)

# asp.net-mvc - ASP.NET MVC Beta 1 - URI 路由语法

> ID：321439
> 
> 赞同：0
> 
> 时间：2008-11-26T17:08:32.660
> 
> 标签：asp.net-mvc, asp.net-mvc-routing

我已经在网上搜索了关于 ASP.NET MVC Beta 1 中路由语法的一个不错的解释，但我仍然无法让它工作。

请有人解释一下我需要在我的 Global.asax.cs 文件中放入什么来为我的网站提供两个受支持的 URI：

`www.mysite.com/map.aspx`（即没有任何显式参数/操作来执行默认操作的站点），并且，

`www.mysite.com/map.aspx/search/searchParam1/searchParam2/searchParam3/`（用于执行搜索）

PS：与此同时，我会继续努力，如果我找到答案，我会自己发布。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T17:46:35.937

```
routes.MapRoute("Default", "map.aspx", new { controller = "DefaultController", action = "DefaultAction" });

routes.MapRoute("Search", "map.aspx/search/{*params}", new { controller = "SearchController", action = "Search" } ); 
```

示例网址：[http ://www.mysite.com/map.aspx/search/dogs/cats/](http://www.mysite.com/map.aspx/search/dogs/cats/)

传递给 SearchController.Search() 的参数：params="/dogs/cats"

然后，您可以解析参数以处理您的搜索结果。

但是，在我看来，如果您正在构建 MVC 应用程序，将 map.aspx 放在 URL 中看起来是错误的。您的网址应类似于[http://www.mysite.com/search/](http://www.mysite.com/search/)

# oracle - 需要有关使用 PL/SQL 以动态方式将表数据输出到 CSV 的想法

> ID：321455
> 
> 赞同：2
> 
> 时间：2008-11-26T17:11:43.107
> 
> 标签：oracle, plsql

任务是获取可更改的表列表。

编写一段 PL/SQL，在执行时将每个表行输出到单独的 csv 文件中。

所以如果有5张桌子。您将获得 5 个包含相关表格数据的 CSV 文件。

CSV 应该是 | 分隔并在每个值周围都有“（以便于导入到 excel）

我所知道的只是表格列表。

因此，将列表加载到过程顶部的数组中，循环遍历此列表并使用 UTL_FILE 逐行输出每一行。

我很想知道每个表是否需要一个游标，或者是否可以动态使用游标来存储每个表的结果。

ps 每个文件还必须包含列标题作为第一行。

甚至可能吗？有一个超过 30 个表的列表，其中一些表有超过 200 列。

所以请出主意:)。

我慢慢地认为这是不可能的。因为我需要一些可以收集所有列名等的动态 SQL。我陷入了困境！

它不能是一个 SQL 脚本并且只是假脱机输出。我们想要做的就是在数组声明中添加或删除表。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T17:18:34.463

是的，有可能。看看这个[Ask Tom](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:88212348059)问题，它展示了如何一次处理 1 张桌子。您需要做的就是遍历您的表名数组并为每个表名调用 Tom 的过程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T17:15:51.163

首先，Oracle 将所有这些数据存储在您有权访问的视图中。

```
SELECT * FROM ALL_TAB_COLUMNS 
```

将为您提供表格的列列表。这将使为文件创建列标题变得简单。

剩下的只是将数据卸载到一个平面文件中。你可以在[这里](http://asktom.oracle.com/tkyte/flat/index.html)找到食谱。

这是直接指向[代码](http://asktom.oracle.com/tkyte/flat/unloader15a.sql)的链接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T17:32:05.343

有几种选择。

1.  您可以使用 UTL_FILE 将预先格式化的文本字符串转储到文件中。只需制作一个游标，输出所有与分隔符连接的数据列。

像这样的东西：

```
DECLARE
  TYPE IDCurTyp IS REF CURSOR;
  fo            UTL_FILE.FILE_TYPE;
  varRow        VARCHAR2(4000);
  cur_output    IDCurTyp;
BEGIN
  fo := UTL_FILE.FOPEN('BILLING_DIR','BillingFile1.csv', 'W', 2000)
  OPEN cur_output FOR
    'SELECT ''"'' || t1.col1 || ''",'' || t1.col2 || ''","'' || t1.col2 || ''"'' FROM t1'
  LOOP
    FETCH cur_output INTO varRow;
    EXIT WHEN cur_output%NOTFOUND;
    UTL_FILE.putf( fo, '%s\n', varRow );
  END LOOP;

  CLOSE cur_output;

  UTL_FILE.FCLOSE( fo );
END: 
```

2.  代替预先格式化的文本，创建一个接受 SQL 查询的包，然后使用 DBMS_SQL 包来解析它并提取列名等，并创建文本字符串以再次使用 UTL_FILE 转储。

# mysql - 什么时候应该重建数据库索引？

> ID：321461
> 
> 赞同：26
> 
> 时间：2008-11-26T17:12:39.640
> 
> 标签：mysql, indexing, maintenance

[我在这里](https://stackoverflow.com/questions/320919/refactoring-extreme-sql-queries)阅读了关于重构一个大型慢速 SQL 查询的信息，当前最高响应来自 Mitch Wheat，他希望确保查询使用主要选择的索引，并提到：

> 我要做的第一件事是检查以确保定期运行活动的索引维护作业。如果没有，请重建所有现有索引，或者如果不可能，至少更新统计信息。

我只是一名业余 DBA，并且我已经制作了一些程序自由职业者，它们基本上是 Java 桌面客户端，偶尔也是 MySQL 后端。当我设置系统时，我知道要在将要查询的列上创建一个索引，有一个 varchar CaseID 和一个 varchar CustName。

然而，我在几个月前设置了这个系统并让客户端运行它，我相信索引应该随着数据的输入而增长，我相信一切仍然运行良好。我担心索引应该定期重建，因为今天我读到应该有一个“积极的维护工作”。我设置的唯一维护工作是每晚备份。

我想向社区询问数据库可能需要的定期维护。是否需要重建索引？只要没有人弄乱它并且数据保持在几千兆字节以下，我是否可以相信 MySQL 后端会继续运行？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-26T18:11:24.857

无需“重建”索引。它们始终保持最新状态。也许他指的是重建桌子。根据您的使用模式和架构，您可以在 InnoDB 中获得碎片页面，我认为在 MyISAM 中也是如此。重建表可以通过消除磁盘上的数据碎片来提高性能。我不经常使用 MyISAM 表，但我认为建议使用某些使用模式运行“OPTIMIZE TABLE”。有关MyISAM 和 InnoDB 的一些有用信息，请参阅[OPTIMIZE TABLE上的 MySQL 文档。](http://dev.mysql.com/doc/refman/5.1/en/optimize-table.html)

我对 MyISAM 的复杂性不太熟悉，但对于 InnoDB，统计数据确实会过时。数据库保留有关给定索引的数据分布方式的估计统计信息，并且这些统计信息可能会过时，但是 MySQL/InnoDB 具有一些内置功能来尝试使统计信息保持最新。您通常不必担心它。

因此，如果您使用 InnoDB，答案是否定的，您通常不需要主动做任何事情来保持索引的良好性能。我对 MyISAM 不太确定，我认为需要定期优化这些表更为常见。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-26T18:03:18.167

设置一个 cronjob 来优化索引和检查错误通常是一个好主意。

见[mysqlcheck](http://dev.mysql.com/doc/refman/5.0/en/mysqlcheck.html)。一个典型的 cron 作业看起来像`mysqlcheck -Aaos`，它检查所有数据库中的所有表是否有错误，优化索引，并且只输出错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T05:04:31.447

您链接到的关于“定期维护”的答案是在临时表的特定上下文中，该表会定期被截断和重新填充。您不需要对绝大多数 MySQL 数据库安装执行此操作。

# javascript - javascript 中的动画 insertBefore

> ID：321465
> 
> 赞同：0
> 
> 时间：2008-11-26T17:13:28.937
> 
> 标签：javascript, user-interface, animation

所以我有这个应用程序来检查服务器上的更新，得到一个 JSON 响应，每个新的更新都放在我列表的顶部，放在一个新的 div 上，该 div 是通过 insertBefore 使用 javascript 添加的。

一切正常，但我想在添加 div 时添加动画效果，即“慢慢地”向下移动现有 div，并在顶部添加新的，关于如何做到这一点的任何指针？

该应用程序实际上在 facebook 中运行而不使用 iframe，我尝试使用 jquery，但它似乎不适用于 facebook，并且查看 FB 所做的代码修改，我认为其他框架也会有类似的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T17:54:30.413

在 jQuery 中，您可以执行以下操作：

```
$(myListItem).hide().slideDown(2000); 
```

否则，使用 setTimeout 和一些 CSS 修改推出自定义动画。这是我在几分钟内搞定的一个乱七八糟的东西：

```
function anim8Step(height)
{
    var item = document.getElementById('anim8');

    item.style.height = height + 'px';
}

function anim8()
{
    var item = document.getElementById('anim8');
    var steps = 20;
    var duration = 2000;
    var targetHeight = item.clientHeight;
    var origOverflow = item.style.overflow;

    item.style.overflow = 'hidden';

    anim8Step(0);

    for(var i = 1; i < steps; ++i)
        setTimeout('anim8Step(' + (targetHeight * i / steps) + ');', i / steps * duration);

    setTimeout('var item = document.getElementById(\'anim8\'); item.style.height = \'auto\'; item.style.overflow = \'' + origOverflow + '\';', duration);
} 
```

（我不太擅长 Javascript，所以很抱歉这是一团糟。）

基本上，您将 li (#anim8) 的溢出设置为隐藏，因此内容不会与其他元素的内容重叠。然后，将高度设置为 0，并随着时间的推移将其增加到 clientHeight。然后，将溢出设置回原来的状态（这一步可能并不是真正需要的）并删除高度属性（以防万一）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T21:15:13.020

由于您希望自己做，您需要使用 setTimeout 反复更改 div 的高度。基本的、快速的和肮脏的代码看起来像这样：

```
var newDiv; 

function insertNewDiv() {
// This is called when you realize something was updated    
// ...      
    newDiv = document.createElement('div');
    newDiv.style.height = "0px";
    document.body.appendChild(newDiv); 
    setTimeout(slideInDiv, 0);
}

function slideInDiv(){  
    newDiv.style.height = newDiv.clientHeight + 10 + "px";  // Slowly make it bigger

    if (newDiv.clientHeight < 100){
        setTimeout(slideInDiv, 40);  // 40ms is approx 25 fps
    } else {
        addContent();
    }
}

function addContent(){  
  newDiv.innerHTML = "Done!";
} 
```

请注意，您可能希望使您的动画代码更通用（传入 ID、回调函数等），但对于基本动画，这应该可以帮助您入门。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T17:36:35.147

这取决于您使用的 JavaScript 框架；但是看看[MooTools](http://demos.mootools.net/Fx.Slide)、[Scriptaculous](http://github.com/madrobby/scriptaculous/wikis/combination-effects-demo)、[jQuery](http://docs.jquery.com/Effects)和[YUI Animation](http://developer.yahoo.com/yui/animation/)。如果您只是自己敲定 JavaScript，您会发现使用间隔计时器会随着时间的推移修改某些元素的样式，然后触发动画完成事件以停止计时器并最终更新页面是相当复杂的容易出错的过程。

您可能正在寻找通常称为[向下](http://docs.jquery.com/Effects/slideDown#speedcallback)[滑动](http://github.com/madrobby/scriptaculous/wikis/effect-slidedown) 的东西（尝试演示）。

# .net - 3 层开发的最佳实践

> ID：321467
> 
> 赞同：2
> 
> 时间：2008-11-26T17:14:18.983
> 
> 标签：.net, asp.net, architecture

有谁知道 MS 或其他人的任何文档，其中列出了在 ASP.NET 中开发 3 层架构的最佳实践。我正在努力让我的老板相信当前的架构需要重新思考和重新设计，以提供一个灵活且可重用的系统。我发现了很多通用文档，它们从高层次上告诉你如何做到这一点的最佳实践，但很少展示你如何实际实现它们。我需要向他展示使用业务对象相对于数据集和事物的优势的文档到那个详细程度。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T17:21:16.923

Microsoft 的[Patterns & Practices 小组](http://msdn.microsoft.com/en-us/practices/default.aspx)以“架构指南”的形式发布了各种白皮书和文档，这些都是很有帮助的。他们最近还出版了一些[“袖珍指南”](http://www.codeplex.com/AppArch/Wiki/View.aspx?title=Pocket%20Guides&referringTitle=Home)。即使您没有完全按照他们的要求行事，他们也可能是讨论您的特定需求的一个很好的起点。

他们来自微软也可能有助于增加与老板讨论的可信度。特别是在[Web Application Architecture](http://www.codeplex.com/AppArch/Release/ProjectReleases.aspx?ReleaseId=19802)上有一个，这听起来可能是相关的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T17:33:42.437

我强烈建议研究[ASP.NET MVC](http://www.asp.net/mvc/)。对于 n 层应用程序来说，这是一个更好的选择，因为它允许更大程度的关注点分离。这导致可以使用 ASP.NET 实现的更具可测试性和可维护性的应用程序

# sql - SQL Server 2005 中的“从表中选择 *”与“从表中选择 colA、colB 等”的有趣行为

> ID：321468
> 
> 赞同：14
> 
> 时间：2008-11-26T17:14:51.540
> 
> 标签：sql, sql-server, sql-server-2005, tsql, views

为冗长的帖子道歉，但我需要发布一些代码来说明问题。

受问题启发 *[不使用 select 的原因是什么*？*](https://stackoverflow.com/questions/321299)，我决定指出我前一段时间注意到的 select * 行为的一些观察结果。

所以让代码自己说话：

```
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[starTest]') AND type in (N'U'))
DROP TABLE [dbo].[starTest]
CREATE TABLE [dbo].[starTest](
    [id] [int] IDENTITY(1,1) NOT NULL,
    [A] [varchar](50) NULL,
    [B] [varchar](50) NULL,
    [C] [varchar](50) NULL
) ON [PRIMARY]

GO

insert into dbo.starTest(a,b,c)
select 'a1','b1','c1'
union all select 'a2','b2','c2'
union all select 'a3','b3','c3'

go
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vStartest]'))
DROP VIEW [dbo].[vStartest]
go
create view dbo.vStartest as
select * from dbo.starTest
go

go
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[vExplicittest]'))
DROP VIEW [dbo].[vExplicittest]
go
create view dbo.[vExplicittest] as
select a,b,c from dbo.starTest
go

select a,b,c from dbo.vStartest
select a,b,c from dbo.vExplicitTest

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[starTest]') AND type in (N'U'))
DROP TABLE [dbo].[starTest]
CREATE TABLE [dbo].[starTest](
    [id] [int] IDENTITY(1,1) NOT NULL,
    [A] [varchar](50) NULL,
    [B] [varchar](50) NULL,
    [D] [varchar](50) NULL,
    [C] [varchar](50) NULL
) ON [PRIMARY]

GO

insert into dbo.starTest(a,b,d,c)
select 'a1','b1','d1','c1'
union all select 'a2','b2','d2','c2'
union all select 'a3','b3','d3','c3'

select a,b,c from dbo.vExplicittest
select a,b,c from dbo.vStartest 
```

如果您执行以下查询并查看最后 2 个 select 语句的结果，您将看到的结果如下：

```
select a,b,c from dbo.vExplicittest
a1  b1  c1
a2  b2  c2
a3  b3  c3

select a,b,c from dbo.vStartest
a1  b1  d1
a2  b2  d2
a3  b3  d3 
```

正如您在**select a,b,c from dbo.vStartest**的结果中看到的那样，c 列的数据已被 d 列的数据替换。

我相信这与视图的编译方式有关，我的理解是列是由列索引 (1,2,3,4) 映射的，而不是名称。

我想我会把它作为警告发布给在他们的 SQL 中使用 select * 并遇到意外行为的人。

注意：如果您在每次修改表后重建使用 select * 的视图，它将按预期工作。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-27T07:10:02.460

[sp_refreshview](http://msdn.microsoft.com/en-us/library/ms187821(SQL.90).aspx)修复视图，或者在视图定义中使用 WITH SCHEMABINDING

> 如果视图不是使用 SCHEMABINDING 子句创建的，则当对影响视图定义的视图下的对象进行更改时，应运行 sp_refreshview。否则，视图在被查询时可能会产生意想不到的结果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T18:21:02.573

**这对于任何**RDBMS下的视图来说都是非常标准的行为，而不仅仅是 MSSQL，并且必须谨慎对待包含“select * from”的视图的使用的原因。

SQL 引擎将编译每个视图 - 这基本上是字典/解析步骤并存储结果。如果您因此更改基础表，则始终需要显式重新编译，除非数据库具有某种方法来标记视图以在这种情况下进行检查。

该问题也可能（将）也适用于存储过程和类似的数据库对象。

# .net - 拖放对象引用 VB.Net

> ID：321471
> 
> 赞同：1
> 
> 时间：2008-11-26T17:15:46.623
> 
> 标签：.net, vb.net, reference, drag-and-drop, object

我正在尝试“交换”两个单元格的内容及其映射。为此，我需要拖放对单元格的引用，而不是字符串值本身。然后，我可以使用此引用来更新 Dictionary 并获取值。它允许我进行交换，因为我将引用旧单元格以在其中添加所需的值。

我遇到的问题是我不确定如何传递单元格引用：

```
Private Sub DataGridView1_MouseDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles DataGridView1.MouseDown
    If e.Button = MouseButtons.Left Then
        DataGridView1.DoDragDrop(DataGridView1.CurrentCell, DragDropEffects.Copy)
    End If

End Sub 
```

在 drop 事件中：

```
Private Sub DataGridView1_DragDrop(ByVal sender As System.Object, ByVal e As System.Windows.Forms.DragEventArgs) Handles DataGridView1.DragDrop

   'Problem is here -->'Dim copyedFromCell As DataGridViewCell = DirectCast(e.Data(), DataGridViewCell)** 
    Dim copyedFromKey As String = GetMappingForCell(copyedFromCell) 
    Dim thisKey As String = GetMappingForCell(DataGridView1.CurrentCell)
    Dim copyedFromValue As String = copyedFromCell.Value
    Dim thisValue As String = DataGridView1.CurrentCell.Value

    mappings(copyedFromKey) = DataGridView1.CurrentCell
    mappings(thisKey) = copyedFromCell

    DataGridView1.CurrentCell.Value = copyedFromValue
    copyedFromCell.Value = thisValue

End Sub 
```

我正在尝试做的事情可能吗？我完全破坏了吗？谢谢 ：）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-03T19:09:27.533

你[`e.Data`](http://msdn.microsoft.com/en-us/library/system.windows.forms.drageventargs.data.aspx)是一个[`IDataObject`](http://msdn.microsoft.com/en-us/library/system.windows.idataobject.aspx)，**而不是**你发送的价值`DoDragDrop`。

要获取您发送的值，您必须调用[`e.Data.GetData(...)`](http://msdn.microsoft.com/en-us/library/94ckfkxz.aspx).

要修复您的代码，请将问题行替换为：

```
Dim copiedFromCell As DataGridViewCell = _
   e.Data.GetData(GetType(DataGridViewTextBoxCell)) 
```

（或任何类型`DataGridView1.CurrentCell`。）

您可以通过调用获取可删除的类型列表[`e.Data.GetFormats()`](http://msdn.microsoft.com/en-us/library/1745023c.aspx)。

# html - 需要帮助显示子列表而不间隔父列表

> ID：321477
> 
> 赞同：1
> 
> 时间：2008-11-26T17:19:11.967
> 
> 标签：html, css, html-lists

我正在打印我们提供的大学专业列表，然后在每个专业中，我们都有每个专业的浓度。

我们的科学专业有以下浓度：环境科学与林业、脊椎按摩疗法、化学、生物学

这是它正在做什么的屏幕截图： [![替代文字](https://i.stack.imgur.com/sNslE.jpg)](https://i.stack.imgur.com/sNslE.jpg)

我不希望它显示的间距（我不希望您在人力资源管理 AAS 和心理学之后看到的间距。）在屏幕截图中，任何帮助表示赞赏。

源代码如下所示：

```
.col-middle .majors-list li {
  list-style-type: none;
  width: 50%;
  float: left;
  margin-bottom: 2px;
}

.col-middle ul.majors-list {
  margin-left: 0;
}

.col-middle ul.concentrations-list {
  overflow: auto;
}

.col-middle .concentrations-list li {
  float: none;
}
```

```
<ul class="majors-list">
  <li>Major
    <ul class="concentrations-list">
      <li>Concentration Item</li>
      <li>Concentration Item</li>
      <li>Concentration Item</li>
      <li>Concentration Item</li>
    </ul>
  </li>
  <li>Major
    <ul class="concentrations-list">
      <li>Concentration Item</li>
      <li>Concentration Item</li>
      <li>Concentration Item</li>
      <li>Concentration Item</li>
    </ul>
  </li>
  <li>Major
    <ul class="concentrations-list">
      <li>Concentration Item</li>
      <li>Concentration Item</li>
      <li>Concentration Item</li>
      <li>Concentration Item</li>
    </ul>
  </li>
  <li>Major
    <ul class="concentrations-list">
      <li>Concentration Item</li>
      <li>Concentration Item</li>
      <li>Concentration Item</li>
      <li>Concentration Item</li>
    </ul>
  </li>
</ul>
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T20:22:13.267

如果没有一些 javascript，您将无法做到这一点。对于 mozilla 或 webkit，您可以使用 -[moz|webkit]-column-count: 2; 但即使这样也不会给您提供给定 css 几乎为您提供的相同解决方案，换句话说，排序将是垂直的而不是水平的。当我使用 column-count 属性时，内部列表也在列上被拆分，我认为这也不够。

一个javascript解决方案，我相信可以很容易地用一个像jquery这样的框架来完成，它可能会使用每个li元素，并结合position:relative和position:absolute属性和一些数学来动态定位它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T17:49:03.453

尝试浮动：右而不是浮动：左。

这适用于 Firefox 2。不适用于（许多）其他浏览器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T19:00:36.303

您想`display: none;`在 CSS 中为浓度列表类提供一个属性。然后，您可以通过为其提供 onclick 事件来显示其中一个子列表，该事件将类更改为浓度列表显示，并将浓度列表显示类添加到 CSS 并为其赋予`display: block;`属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T19:07:01.483

你可以用 CSS3 Columns 来做到这一点，但我猜你需要它才能在*那个*浏览器中工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T22:49:36.620

您可以尝试的一件事是让您的 ul.majors-list display: inline; （或内联块）和浮动：左；它*可能会*起作用。

* * *

上面应该是“尝试让你的**ul.majors-list li** display: inline;”。但是我不能让它快速工作。不知道如何在不摆脱最顶层的 ul 并让每个人成为自己的列表的情况下做到这一点。

# html - 这两种将html页面链接到css文件的方法有什么区别？

> ID：321478
> 
> 赞同：15
> 
> 时间：2008-11-26T17:19:27.410
> 
> 标签：html, css

我一直在阅读一些关于 css 的教程，我看到了两种不同的方式来说明应该使用哪个 css 文件来设置页面样式：

```
<style type="text/css">@import url("style.css");</style> 
```

和

```
<link rel="stylesheet" type="text/css" href="style.css" /> 
```

他们之间有什么区别？我应该使用哪一个？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-26T17:33:34.467

根据[Yahoo 的“加速网站的最佳实践”，](http://developer.yahoo.com/performance/rules.html#csslink)使用**@include**的行为类似于将 <link> 放在*Internet Explorer*中页面的底部。

在页面末尾加载 CSS 会导致页面重新呈现。这意味着，页面首先在没有 CSS 的情况下显示，然后用 CSS 重新绘制。这会减慢页面的加载速度。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-26T19:19:28.840

## CSS Cascade 以及为什么你应该关心

它归结为[CSS 特异性](http://www.smashingmagazine.com/2007/07/27/css-specificity-things-you-should-know/)和 CSS 级联。小心行事并知道您在做什么，CSS 特异性可以成为您的朋友。

```
// bring CSS into the Page
<style type="text/css">@import url("importedStyles.css");</style>

/// Link to CSS Style Sheet
<link rel="stylesheet" type="text/css" href="linkedStyles.css" /> 
```

由于 @import 将样式带入该页面，因此这些规则将**覆盖**外部或“链接”样式表。内联 CSS 胜过其中之一是因为[CSS 的特殊性](http://www.smashingmagazine.com/2007/07/27/css-specificity-things-you-should-know/)更高：

```
<span style="color: red;">I am DEFINITELY RED</span> 
```

但是，这仅在规则具有相同特异性时才有效

采取以下措施：

```
<div class="error">I am an error message</div> 
```

如果我在 importStyles.css 中有这样的规则：

```
.error { color: blue; } /* specificity = 10 */ 
```

“externalStyles.css”中的规则如下：

```
div.error { color: red; } /* specificity = 11 */ 
```

它将采用 externalStyles 版本

注意：内联样式的[CSS 特异性](http://www.smashingmagazine.com/2007/07/27/css-specificity-things-you-should-know/)是 1000，所以它胜过所有的东西，除了 !important 标签是 10000。[另一个 CSS 特异性文章](http://htmldog.com/guides/cssadvanced/specificity/)

## CSS 特殊性参考

*   !重要 = 10,000
*   内联样式 = 1000
*   规则中的每个#id = 100 - 例如，这是 200：

    #content #footer { 颜色：红色；} /* 200 */

*   每班 = 10

*   每个 html 元素 = 1

所以，一些例子：

```
body .selected { color: red; } /* 11 */
ul li { color: red; } /* 2 */
ul li.selected { color: blue; } /* 12 */

#content ul li.selected a { color: red; } /* 113 */

/* Careful, can't override this, ever */ 
a { color: blue; !important } /* 10,000 - Override everything */ 
```

所以......级联仅适用于具有**相同特异性**的元素。在应用特异性规则之后应用级联。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-26T17:33:24.607

**除非您使用非常**旧的浏览器（netscape 4.x 和 ie 3.x），否则没有太大区别。[您可以在此处](http://webdesign.about.com/od/beginningcss/f/css_import_link.htm)阅读有关每种含义的完整介绍。

> 从标准的角度来看，链接到外部样式表或导入它没有区别。任何一种方式都是正确的，并且任何一种方式都会同样有效（在大多数情况下）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T17:27:02.827

@import 规则主要是一个 hack。所有现代浏览器都理解@import 规则，而早期浏览器则不理解。因此，如果您的网站由于 css 规则而在早期浏览器上崩溃（这不是一件常见的事情，但...将它放在@import 规则之上

编辑：由于 @import 规则会产生一些缓存问题（正如其他人已经提到的那样），您可以 @import(styles.php) 并在 styles.php 中执行类似的操作

```
ob_start ("ob_gzhandler");
header("Content-type: text/css");
header("Cache-Control: must-revalidate");
$offset = 60 * 60 ;
$ExpStr = "Expires: " . gmdate("D, d M Y H:i:s",time() + $offset) . " GMT";
header($ExpStr);    
echo ("@import url(style1.css);\r");
echo ("@import url(style2.css);\r");
echo ("@import url(style3.css);\r"); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T17:27:14.993

如前所述，第一个是嵌入式样式表（也可以在外部样式表中完成）这可以在外部使用时导致更好的组织样式表，但请记住，当样式表被嵌入时，浏览器不会缓存它

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-26T17:28:01.623

从历史上看，我相信第一个经常被用来阻止 Netscape 4 采用你的风格（不过我可能是错的；当 Netscape 4 仍然是一个问题时，我不太了解跨浏览器编码，所以这是一个非常模糊的记忆）。

如今，人们有时会使用`<link>`从网页中包含一个样式表，然后 @import 从该单个表中获取一堆其他样式表。如果您喜欢滚动，这允许您将样式分离为 layout.css、typography.css 等。

正如 Tungle 提到的，缓存成为 @import 的问题，但仅限于 IE。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-26T17:41:45.883

这是关于优先级的。如果您`@import`使用 foo.css，则 CSS 规则的行为就像您将 foo.css 的内容直接放入该`<style>`块中一样。这意味着它们比`<link>`编入的 css 文件具有更高的优先级。

因此，如果您要 @import 一个设置`font-size: 12pt`并链接一个设置的文件，`font-size: 14pt`您最终会得到 12pt 文本。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-26T17:23:21.070

第一个实际上是引用另一个文件的嵌入式 CSS；而第二个是从 HTML 到 CSS 的直接引用。

我想不出使用第一个的理由。

# c# - Web 服务和 nunit 测试

> ID：321485
> 
> 赞同：4
> 
> 时间：2008-11-26T17:22:00.993
> 
> 标签：c#, asp.net, web-services, unit-testing, nunit

我创建了一个控制台应用程序，它调用 Web 服务上的方法。我已经访问了 web 服务并从我期望的控制台应用程序中获得了响应。当我创建一个单独的测试程序集并创建一些以相同方式调用相同方法的 nunit 测试时，我得到以下异常：-

System.InvalidOperationException：在 ServiceModel 客户端配置部分中找不到引用合同“xxxxx.xxx”的默认端点元素。这可能是因为没有为您的应用程序找到配置文件，或者因为在客户端元素中找不到与此协定匹配的端点元素。

以前有人经历过吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-26T17:25:26.183

是的，请确保将 app.config 文件添加到单元测试项目中，并将控制台应用程序配置文件中的相同设置添加到其中。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-01-22T16:52:39.393

我遇到了同样的问题，但是当直接在 NUnit 中打开测试项目 .NET dll 时，测试会成功，但是如果我随后将测试保存为 NUnit 中的项目，则会返回上述错误！

我的解决方法是将测试保存为 NUnit 项目，然后从菜单中选择“Project=>Edit...”，然后在底部选择“General”选项卡并在“Configuration File Name:”字段中输入'\Debug' 文件夹中 GENERATED 'app.Config' 文件的全名，因此 [dllname].config。

# asp.net - 您如何“指定”Web 服务器来支持给定的应用程序？

> ID：321486
> 
> 赞同：4
> 
> 时间：2008-11-26T17:22:08.077
> 
> 标签：asp.net, deployment, hardware

我在尝试从 VPS 和专门的托管服务提供商的销售人员那里获得对我的问题的体面回答时遇到了真正的麻烦。我有一组相当简单的要求 - 我如何选择服务器规格/包并确信我已经得到了正确的？是否有要使用的指标——例如每分钟的 Http 请求数？还有其他基准吗？你如何处理它？

初始要求是：

*   必须支持支持超过 200 个用户（可能多达 1000 个）的私有 ASP.NET 应用程序。用户活动将在整个工作日基本持续
*   该应用程序比您的平均“网站”更密集（但并非过度）
*   用户将上传和下载大文件
*   需要 MS SQL Server 数据库 - （工作组版本就足够了吗？）
*   必须支持另外 5 个低流量级别且几乎没有数据库活动的公共域

**跟进：** 感谢大家的回复。我可以访问可以配置用于分析的系统，那么任何人都可以推荐任何分析/负载测试工具吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T17:30:57.933

您的要求太模糊，无法做出决定。例如，什么是*大文件*？什么是低流量水平？

最简单的方法之一就是设置一个测试服务器+网络，然后尝试模拟正常负载。

如果您无法设置测试环境，您可能只是在猜测正确的大小，然后在真实系统上进行测试，并根据需要调整您的服务级别。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T17:37:26.300

你可以在这里添加你想要的关于用户数量等的所有数据，你甚至可以让它比你这里的数据更量化——用这种方式回答这是一个不可能的问题。

真正的答案是：简介、简介、简介。您必须衡量应用程序及其数据库的行为方式，以确定在特定活动级别支持 N 个用户所需的资源。如果你真的知道或有理由相信你的软件一开始就会有不平凡的负载，那么我给你的最好建议是研究负载测试工具和服务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T17:44:07.720

您需要分析您期望的负载。然后，您应该选择能够满足您预期需求并提供增长路径的提供商。如果您的托管服务提供商能够优雅地处理增长，那么增长会容易得多。

也就是说，如果您的项目是您的供应商做过的最大的项目，或者需要比以往更复杂的硬件，那么您需要寻找更大的人。

当您知道自己想要什么时，要非常具体，但不要对您的要求过于激进。例如，如果您需要 8gb 的内存，请说 8gb。不要说需要 4gb，但 16gb 会很好。

我还要求提供两个系统的报价：您今天需要什么以及一年后您*可能需要什么。*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T17:49:32.920

您在每秒 http 请求的正确轨道上。还要查看 IIS 的磁盘 io 和内存使用情况。他们需要知道他们的硬件可以处理多少流量。

SQL Workgroup 版本应该适合您 - 它可以使用高达 3GB 的内存。

[http://www.microsoft.com/sqlserver/2005/en/us/compare-features.aspx](http://www.microsoft.com/sqlserver/2005/en/us/compare-features.aspx)

# algorithm - 计算下一次执行 cron 作业的时间

> ID：321494
> 
> 赞同：49
> 
> 时间：2008-11-26T17:26:31.127
> 
> 标签：algorithm, language-agnostic, cron

我有一个 cron “时间定义”

```
1 * * * * (every hour at xx:01)
2 5 * * * (every day at 05:02)
0 4 3 * * (every third day of the month at 04:00)
* 2 * * 5 (every minute between 02:00 and 02:59 on fridays) 
```

我有一个unix时间戳。

是否有一种明显的方法来查找（计算）下一次（在给定的时间戳之后）作业将被执行？

我正在使用 PHP，但问题应该与语言无关。

[更新]

“ [PHP Cron Parser](http://www.phpclasses.org/browse/package/2568.html) ”类（由 Ray 建议）计算 CRON 作业应该执行的最后时间，而不是下一次。

为了使它更容易：在我的情况下，cron时间参数只是绝对的，单个数字或“*”。没有时间范围，也没有“*/5”间隔。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2010-08-10T22:10:26.033

这是一个基于 dlamblin 伪代码的 PHP 项目。

它可以计算 CRON 表达式的下一次运行日期、CRON 表达式的上一次运行日期，并确定 CRON 表达式是否与给定时间匹配。你可以跳过这个 CRON 表达式解析器完全实现了 CRON：

1.  范围的增量（例如 */12、3-59/15）
2.  间隔（例如 1-4、MON-FRI、JAN-MAR ）
3.  列表（例如 1、2、3 | JAN、MAR、DEC）
4.  一个月的最后一天（例如 L）
5.  一个月的最后一个工作日（例如 5L）
6.  一个月的第 N 个给定工作日（例如 3#2、1#1、MON#4）
7.  离该月某一天最近的工作日（例如 15W、1W、30W）

[https://github.com/mtdowling/cron-expression](https://github.com/mtdowling/cron-expression)

用法（PHP 5.3+）：

```
<?php

// Works with predefined scheduling definitions
$cron = Cron\CronExpression::factory('@daily');
$cron->isDue();
$cron->getNextRunDate();
$cron->getPreviousRunDate();

// Works with complex expressions
$cron = Cron\CronExpression::factory('15 2,6-12 */15 1 2-5');
$cron->getNextRunDate(); 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-11-26T20:37:11.537

这基本上与检查当前时间是否符合条件相反。所以像：

```
//Totaly made up language
next = getTimeNow();
next.addMinutes(1) //so that next is never now
done = false;
while (!done) {
  if (cron.minute != '*' && next.minute != cron.minute) {
    if (next.minute > cron.minute) {
      next.addHours(1);
    }
    next.minute = cron.minute;
  }
  if (cron.hour != '*' && next.hour != cron.hour) {
    if (next.hour > cron.hour) {
      next.hour = cron.hour;
      next.addDays(1);
      next.minute = 0;
      continue;
    }
    next.hour = cron.hour;
    next.minute = 0;
    continue;
  }
  if (cron.weekday != '*' && next.weekday != cron.weekday) {
    deltaDays = cron.weekday - next.weekday //assume weekday is 0=sun, 1 ... 6=sat
    if (deltaDays < 0) { deltaDays+=7; }
    next.addDays(deltaDays);
    next.hour = 0;
    next.minute = 0;
    continue;
  }
  if (cron.day != '*' && next.day != cron.day) {
    if (next.day > cron.day || !next.month.hasDay(cron.day)) {
      next.addMonths(1);
      next.day = 1; //assume days 1..31
      next.hour = 0;
      next.minute = 0;
      continue;
    }
    next.day = cron.day
    next.hour = 0;
    next.minute = 0;
    continue;
  }
  if (cron.month != '*' && next.month != cron.month) {
    if (next.month > cron.month) {
      next.addMonths(12-next.month+cron.month)
      next.day = 1; //assume days 1..31
      next.hour = 0;
      next.minute = 0;
      continue;
    }
    next.month = cron.month;
    next.day = 1;
    next.hour = 0;
    next.minute = 0;
    continue;
  }
  done = true;
} 
```

我可能写得有点倒退。此外，如果在每个主要 if 中，如果不进行大于检查，您只需将当前时间等级增加 1 并将较小的时间等级设置为 0，然后继续，则它可能会短得多；但是，您将循环更多。像这样：

```
//Shorter more loopy version
next = getTimeNow().addMinutes(1);
while (true) {
  if (cron.month != '*' && next.month != cron.month) {
    next.addMonths(1);
    next.day = 1;
    next.hour = 0;
    next.minute = 0;
    continue;
  }
  if (cron.day != '*' && next.day != cron.day) {
    next.addDays(1);
    next.hour = 0;
    next.minute = 0;
    continue;
  }
  if (cron.weekday != '*' && next.weekday != cron.weekday) {
    next.addDays(1);
    next.hour = 0;
    next.minute = 0;
    continue;
  }
  if (cron.hour != '*' && next.hour != cron.hour) {
    next.addHours(1);
    next.minute = 0;
    continue;
  }
  if (cron.minute != '*' && next.minute != cron.minute) {
    next.addMinutes(1);
    continue;
  }
  break;
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-27T13:32:03.330

对于任何感兴趣的人，这是我的最终 PHP 实现，它几乎等于 dlamblin 伪代码：

```
class myMiniDate {
    var $myTimestamp;
    static private $dateComponent = array(
                                    'second' => 's',
                                    'minute' => 'i',
                                    'hour' => 'G',
                                    'day' => 'j',
                                    'month' => 'n',
                                    'year' => 'Y',
                                    'dow' => 'w',
                                    'timestamp' => 'U'
                                  );
    static private $weekday = array(
                                1 => 'monday',
                                2 => 'tuesday',
                                3 => 'wednesday',
                                4 => 'thursday',
                                5 => 'friday',
                                6 => 'saturday',
                                0 => 'sunday'
                              );

    function __construct($ts = NULL) { $this->myTimestamp = is_null($ts)?time():$ts; }

    function __set($var, $value) {
        list($c['second'], $c['minute'], $c['hour'], $c['day'], $c['month'], $c['year'], $c['dow']) = explode(' ', date('s i G j n Y w', $this->myTimestamp));
        switch ($var) {
            case 'dow':
                $this->myTimestamp = strtotime(self::$weekday[$value], $this->myTimestamp);
                break;

            case 'timestamp':
                $this->myTimestamp = $value;
                break;

            default:
                $c[$var] = $value;
                $this->myTimestamp = mktime($c['hour'], $c['minute'], $c['second'], $c['month'], $c['day'], $c['year']);
        }
    }

    function __get($var) {
        return date(self::$dateComponent[$var], $this->myTimestamp);
    }

    function modify($how) { return $this->myTimestamp = strtotime($how, $this->myTimestamp); }
}

$cron = new myMiniDate(time() + 60);
$cron->second = 0;
$done = 0;

echo date('Y-m-d H:i:s') . '<hr>' . date('Y-m-d H:i:s', $cron->timestamp) . '<hr>';

$Job = array(
            'Minute' => 5,
            'Hour' => 3,
            'Day' => 13,
            'Month' => null,
            'DOW' => 5,
       );

while ($done < 100) {
    if (!is_null($Job['Minute']) && ($cron->minute != $Job['Minute'])) {
        if ($cron->minute > $Job['Minute']) {
            $cron->modify('+1 hour');
        }
        $cron->minute = $Job['Minute'];
    }
    if (!is_null($Job['Hour']) && ($cron->hour != $Job['Hour'])) {
        if ($cron->hour > $Job['Hour']) {
            $cron->modify('+1 day');
        }
        $cron->hour = $Job['Hour'];
        $cron->minute = 0;
    }
    if (!is_null($Job['DOW']) && ($cron->dow != $Job['DOW'])) {
        $cron->dow = $Job['DOW'];
        $cron->hour = 0;
        $cron->minute = 0;
    }
    if (!is_null($Job['Day']) && ($cron->day != $Job['Day'])) {
        if ($cron->day > $Job['Day']) {
            $cron->modify('+1 month');
        }
        $cron->day = $Job['Day'];
        $cron->hour = 0;
        $cron->minute = 0;
    }
    if (!is_null($Job['Month']) && ($cron->month != $Job['Month'])) {
        if ($cron->month > $Job['Month']) {
            $cron->modify('+1 year');
        }
        $cron->month = $Job['Month'];
        $cron->day = 1;
        $cron->hour = 0;
        $cron->minute = 0;
    }

    $done = (is_null($Job['Minute']) || $Job['Minute'] == $cron->minute) &&
            (is_null($Job['Hour']) || $Job['Hour'] == $cron->hour) &&
            (is_null($Job['Day']) || $Job['Day'] == $cron->day) &&
            (is_null($Job['Month']) || $Job['Month'] == $cron->month) &&
            (is_null($Job['DOW']) || $Job['DOW'] == $cron->dow)?100:($done+1);
}

echo date('Y-m-d H:i:s', $cron->timestamp) . '<hr>'; 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-04-20T08:15:57.953

使用这个功能：

```
function parse_crontab($time, $crontab)
         {$time=explode(' ', date('i G j n w', strtotime($time)));
          $crontab=explode(' ', $crontab);
          foreach ($crontab as $k=>&$v)
                  {$v=explode(',', $v);
                   foreach ($v as &$v1)
                           {$v1=preg_replace(array('/^\*$/', '/^\d+$/', '/^(\d+)\-(\d+)$/', '/^\*\/(\d+)$/'),
                                             array('true', '"'.$time[$k].'"==="\0"', '(\1<='.$time[$k].' and '.$time[$k].'<=\2)', $time[$k].'%\1===0'),
                                             $v1
                                            );
                           }
                   $v='('.implode(' or ', $v).')';
                  }
          $crontab=implode(' and ', $crontab);
          return eval('return '.$crontab.';');
         }
var_export(parse_crontab('2011-05-04 02:08:03', '*/2,3-5,9 2 3-5 */2 *'));
var_export(parse_crontab('2011-05-04 02:08:03', '*/8 */2 */4 */5 *')); 
```

**编辑**也许这更具可读性：

```
<?php

    function parse_crontab($frequency='* * * * *', $time=false) {
        $time = is_string($time) ? strtotime($time) : time();
        $time = explode(' ', date('i G j n w', $time));
        $crontab = explode(' ', $frequency);
        foreach ($crontab as $k => &$v) {
            $v = explode(',', $v);
            $regexps = array(
                '/^\*$/', # every 
                '/^\d+$/', # digit 
                '/^(\d+)\-(\d+)$/', # range
                '/^\*\/(\d+)$/' # every digit
            );
            $content = array(
                "true", # every
                "{$time[$k]} === 0", # digit
                "($1 <= {$time[$k]} && {$time[$k]} <= $2)", # range
                "{$time[$k]} % $1 === 0" # every digit
            );
            foreach ($v as &$v1)
                $v1 = preg_replace($regexps, $content, $v1);
            $v = '('.implode(' || ', $v).')';
        }
        $crontab = implode(' && ', $crontab);
        return eval("return {$crontab};");
    } 
```

用法：

```
<?php
if (parse_crontab('*/5 2 * * *')) {
    // should run cron
} else {
    // should not run cron
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-06-26T09:25:38.500

基于 @dlamblin 的想法创建了用于计算下一次运行时间的 javascript API。支持秒和年。还没有设法完全测试它，所以期待错误，但如果发现任何问题，请告诉我。

存储库链接：[https ://bitbucket.org/nevity/cronner](https://bitbucket.org/nevity/cronner)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-26T17:28:50.933

看看[这个](http://www.phpclasses.org/browse/package/2568.html)：

> 它可以根据给定的 cron 定义计算下一次计划作业应该运行的时间。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-01-30T18:37:39.027

感谢您发布此代码。它确实帮助了我，即使是在 6 年后。

试图实现我发现了一个小错误。

`date('i G j n w', $time)`返回分钟的 0 填充整数。

稍后在代码中，它对该 0 填充整数进行取模。PHP 似乎没有按预期处理这个问题。

```
$ php
<?php
print 8 % 5 . "\n";
print 08 % 5 . "\n";
?>
3
0 
```

如您所见，`08 % 5`返回 0，而`8 % 5`返回预期的 3。我找不到 date 命令的非填充选项。我尝试摆弄这`{$time[$k]} % $1 === 0`条线（比如更改`{$time[$k]}`为`({$time[$k]}+0)`，但无法让它在模数期间删除 0 填充。

因此，我最终只是更改了 date 函数返回的原始值，并通过运行删除了 0 `$time[0] = $time[0] + 0;`。

这是我的测试。

```
<?php

function parse_crontab($frequency='* * * * *', $time=false) {
    $time = is_string($time) ? strtotime($time) : time();
    $time = explode(' ', date('i G j n w', $time));
    $time[0] = $time[0] + 0;
    $crontab = explode(' ', $frequency);
    foreach ($crontab as $k => &$v) {
        $v = explode(',', $v);
        $regexps = array(
            '/^\*$/', # every 
            '/^\d+$/', # digit 
            '/^(\d+)\-(\d+)$/', # range
            '/^\*\/(\d+)$/' # every digit
        );
        $content = array(
            "true", # every
            "{$time[$k]} === $0", # digit
            "($1 <= {$time[$k]} && {$time[$k]} <= $2)", # range
            "{$time[$k]} % $1 === 0" # every digit
        );
        foreach ($v as &$v1)
            $v1 = preg_replace($regexps, $content, $v1);
            $v = '('.implode(' || ', $v).')';
    }
    $crontab = implode(' && ', $crontab);
    return eval("return {$crontab};");
}

for($i=0; $i<24; $i++) {
    for($j=0; $j<60; $j++) {
        $date=sprintf("%d:%02d",$i,$j);
        if (parse_crontab('*/5 * * * *',$date)) {
             print "$date yes\n";
        } else {
             print "$date no\n";
        }
    }
}

?> 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-05-14T14:37:48.587

我的回答不是唯一的。只是用 Java 编写的 @BlaM 答案的副本，因为 PHP 的日期和时间与 Java 有点不同。

该程序假定 CRON 表达式很简单。它只能包含数字或 *。

```
Minute = 0-60
Hour = 0-23
Day = 1-31
MONTH = 1-12 where 1 = January.
WEEKDAY = 1-7 where 1 = Sunday. 
```

代码：

```
package main;

import java.util.Calendar;
import java.util.Date;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class CronPredict
{
    public static void main(String[] args)
    {
        String cronExpression = "5 3 27 3 3 ls -la > a.txt";
        CronPredict cronPredict = new CronPredict();
        String[] parsed = cronPredict.parseCronExpression(cronExpression);
        System.out.println(cronPredict.getNextExecution(parsed).getTime().toString());
    }

    //This method takes a cron string and separates entities like minutes, hours, etc.
    public String[] parseCronExpression(String cronExpression)
    {
        String[] parsedExpression = null;
        String cronPattern = "^([0-9]|[1-5][0-9]|\\*)\\s([0-9]|1[0-9]|2[0-3]|\\*)\\s"
                        + "([1-9]|[1-2][0-9]|3[0-1]|\\*)\\s([1-9]|1[0-2]|\\*)\\s"
                        + "([1-7]|\\*)\\s(.*)$";
        Pattern cronRegex = Pattern.compile(cronPattern);

        Matcher matcher = cronRegex.matcher(cronExpression);
        if(matcher.matches())
        {
            String minute = matcher.group(1);
            String hour = matcher.group(2);
            String day = matcher.group(3);
            String month = matcher.group(4);
            String weekday = matcher.group(5);
            String command = matcher.group(6);

            parsedExpression = new String[6];
            parsedExpression[0] = minute;
            parsedExpression[1] = hour;
            parsedExpression[2] = day;
            //since java's month start's from 0 as opposed to PHP which starts from 1.
            parsedExpression[3] = month.equals("*") ? month : (Integer.parseInt(month) - 1) + "";
            parsedExpression[4] = weekday;
            parsedExpression[5] = command;
        }

        return parsedExpression;
    }

    public Calendar getNextExecution(String[] job)
    {
        Calendar cron = Calendar.getInstance();
        cron.add(Calendar.MINUTE, 1);
        cron.set(Calendar.MILLISECOND, 0);
        cron.set(Calendar.SECOND, 0);

        int done = 0;
        //Loop because some dates are not valid.
        //e.g. March 29 which is a Friday may never come for atleast next 1000 years.
        //We do not want to keep looping. Also it protects against invalid dates such as feb 30.
        while(done < 100)
        {
            if(!job[0].equals("*") && cron.get(Calendar.MINUTE) != Integer.parseInt(job[0]))
            {
                if(cron.get(Calendar.MINUTE) > Integer.parseInt(job[0]))
                {
                    cron.add(Calendar.HOUR_OF_DAY, 1);
                }
                cron.set(Calendar.MINUTE, Integer.parseInt(job[0]));
            }

            if(!job[1].equals("*") && cron.get(Calendar.HOUR_OF_DAY) != Integer.parseInt(job[1]))
            {
                if(cron.get(Calendar.HOUR_OF_DAY) > Integer.parseInt(job[1]))
                {
                    cron.add(Calendar.DAY_OF_MONTH, 1);
                }
                cron.set(Calendar.HOUR_OF_DAY, Integer.parseInt(job[1]));
                cron.set(Calendar.MINUTE, 0);
            }

            if(!job[4].equals("*") && cron.get(Calendar.DAY_OF_WEEK) != Integer.parseInt(job[4]))
            {
                Date previousDate = cron.getTime();
                cron.set(Calendar.DAY_OF_WEEK, Integer.parseInt(job[4]));
                Date newDate = cron.getTime();

                if(newDate.before(previousDate))
                {
                    cron.add(Calendar.WEEK_OF_MONTH, 1);
                }

                cron.set(Calendar.HOUR_OF_DAY, 0);
                cron.set(Calendar.MINUTE, 0);
            }

            if(!job[2].equals("*") && cron.get(Calendar.DAY_OF_MONTH) != Integer.parseInt(job[2]))
            {
                if(cron.get(Calendar.DAY_OF_MONTH) > Integer.parseInt(job[2]))
                {
                    cron.add(Calendar.MONTH, 1);
                }
                cron.set(Calendar.DAY_OF_MONTH, Integer.parseInt(job[2]));
                cron.set(Calendar.HOUR_OF_DAY, 0);
                cron.set(Calendar.MINUTE, 0);
            }

            if(!job[3].equals("*") && cron.get(Calendar.MONTH) != Integer.parseInt(job[3]))
            {
                if(cron.get(Calendar.MONTH) > Integer.parseInt(job[3]))
                {
                    cron.add(Calendar.YEAR, 1);
                }
                cron.set(Calendar.MONTH, Integer.parseInt(job[3]));
                cron.set(Calendar.DAY_OF_MONTH, 1);
                cron.set(Calendar.HOUR_OF_DAY, 0);
                cron.set(Calendar.MINUTE, 0);
            }

            done =  (job[0].equals("*") || cron.get(Calendar.MINUTE) == Integer.parseInt(job[0])) &&
                    (job[1].equals("*") || cron.get(Calendar.HOUR_OF_DAY) == Integer.parseInt(job[1])) &&
                    (job[2].equals("*") || cron.get(Calendar.DAY_OF_MONTH) == Integer.parseInt(job[2])) &&
                    (job[3].equals("*") || cron.get(Calendar.MONTH) == Integer.parseInt(job[3])) &&
                    (job[4].equals("*") || cron.get(Calendar.DAY_OF_WEEK) == Integer.parseInt(job[4])) ? 100 : (done + 1);
        }

        return cron;
    }
} 
```

# memory - 将 SQL Server 2000 配置为在 64 位服务器上使用超过 2Gb 的内存

> ID：321496
> 
> 赞同：2
> 
> 时间：2008-11-26T17:27:06.663
> 
> 标签：memory, sql-server-2000, 64-bit

有什么方法可以配置 SQL Server 2000 标准版（32 位）以在运行 Windows 2003（64 位）的服务器上使用超过 2Gb 的内存？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T13:27:17.427

禁用高级窗口扩展 (AWE) 的 32 位版本的 SQL Server 只能访问 2 GB 的内存（如果在 boot.ini 中使用 /3gb 开关，则只能访问 3 GB - 虽然我不确定我的头顶如果这适用于 64 位 Windows）。这与它们是在 Windows 2003 32 位还是 64 位上运行无关。

此外，SQL Server 2000 标准版无法开启 AWE（它是企业独有的功能），因此您受限于 2 GB 的限制。

最好的办法是了解升级到 SQL Server 2005 Standard（32 位或 64 位 - 32 位 Standard 可以使用 AWE）或价格更高的 SQL Server 2000 Enterprise Edition。由于 SQL Server 2000 已经结束生命，我的建议是采用 2005 标准路线。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T17:47:57.883

看来这篇微软文章是相关的：

[如何将 SQL Server 配置为使用超过 2 GB 的物理内存](http://support.microsoft.com/kb/274750)

# php - 您使用什么工具/语言进行 PHP Web 应用程序部署？

> ID：321502
> 
> 赞同：10
> 
> 时间：2008-11-26T17:30:35.750
> 
> 标签：php, deployment, web-applications, build-process

对于在 LAMP 上运行的 Web 应用程序，我需要能够在多台服务器上部署数据库迁移和代码更改，并能够在之后测试部署，所有这些都由脚本自动完成。

目前，我在直接使用我的构建工具 ( [Phing](http://phing.info/trac/) ) 和一些特殊的部署/测试任务、shell 脚本或 Ruby 或 Python 等脚本语言之间纠结。

问题是我觉得应该使用构建工具来构建，而不是部署。我也觉得 shell 脚本很难维护，可读性也不强。

你对这个问题有什么好的建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T17:43:30.577

对于 PHP 项目，Phing 是要走的路。部署绝对是它的预期用途之一，考虑到在 PHP 中没有任何“真正的”构建过程——因为脚本没有被编译。

来自官方网站：

> 如果您发现自己编写自定义脚本来处理应用程序的打包、部署或测试，那么我们建议您查看 Phing 框架。

Phing 可以做 shell/python/ruby 脚本可以做的所有事情，并且可以在 PHP 中进行扩展，这是它对 PHP 开发人员的主要吸引力。如果您是 PHP 开发人员，为什么要使用 ruby​​/python？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T17:37:50.480

[stackoverflow 上](https://stackoverflow.com/questions/tagged/capistrano)的很多人似乎真的很喜欢[Capistrano](http://capistranorb.com/)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-01-27T17:20:26.883

Rasmus Lerdorf（PHP 的创建者）发布了一个名为[WePloy](http://blog.wepay.com/post/69915650225/weploy-wepays-deployment-tool)的部署工具。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-28T17:18:06.023

要部署 Web 应用程序，PHP 或其他，只需单击一下，您就可以使用[fredistrano](http://code.google.com/p/fredistrano/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T17:36:23.697

我用了什么？

*   svn 提交后挂钩
*   rsync 的 shell 脚本
*   perl cgi 脚本到 svn 跨系统切换

不过，鉴于您的陈述“我也觉得 shell 脚本难以维护且可读性不强”，您似乎无法接受这些中的任何一个。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-01-27T17:24:29.460

使用 Svn export + rsync 的个人脚本

# xml - 限制 XSD 中的独占键值对

> ID：321518
> 
> 赞同：3
> 
> 时间：2008-11-26T17:35:51.793
> 
> 标签：xml, xsd

在 XSD 中，有两个元素 A 和 B。它们是同级元素。

A 的值可以是“1”或“2”。B 的值可以是“一”或“二”。

但是，我想限制这一点，以便只有“1-one”和“2-two”是有效的组合，而不是“1-two”或“2-one”。有没有办法在 XSD 中做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T23:31:55.193

Schematron 可用于定义此类共现约束。您可以在此处找到一些介绍性文章：

*   [使用 Schematron 改进 XML 文档验证](http://msdn.microsoft.com/en-us/library/aa468554.aspx)
*   [Schematron：在树中使用模式的 XML 结构验证语言](http://xml.coverpages.org/schematron.html)

# iphone - 带有奇怪删除线的破碎细胞？

> ID：321522
> 
> 赞同：1
> 
> 时间：2008-11-26T17:37:10.527
> 
> 标签：iphone, objective-c, cocoa-touch, uitableview

我在这里的 iPhone 开发体验中遇到了一个特定 UITableView 的奇怪问题。如果您查看以下屏幕截图：

[替代文字 http://dl-client.getdropbox.com/u/57676/brokencell.png](http://dl-client.getdropbox.com/u/57676/brokencell.png)

您会注意到穿过“Jane Aba”牢房中间的罢工。

知道是什么导致了这种奇怪的图形显示吗？对于模拟器和运行 2.2 SDK 的实际设备都是如此。

根据要求，这是我的`-tableView:cellForRowIndexPath:`方法：

*** 编辑 ***

我找到了问题所在。我不完全确定为什么这是问题，但确实如此。在我的 RootViewController 中，我的`-initWithCoder:`方法中有以下代码行：

```
self.navigationController.navigationBar.barStyle = UIBarStyleBlackTranslucent; 
```

当我将其注释掉时，单元格（不在 RootViewController 中，而是辅助控制器中）已解决。知道为什么会这样吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T23:31:45.960

我有一个类似的问题。对我来说，单行是由创建但从未正确调整大小或放置的多余视图引起的，因此 1 像素高，漂浮在其他所有内容之上。您还可以通过混淆 UINavigationController 的子视图集（通过将视图直接添加到其布局容器）来导致这种情况。

查看您的 UI（xib 文件和以编程方式创建的视图）以查找不应该存在或不被使用的视图。编写一些代码来转储 UI 层次结构可能会有所帮助，这样您就可以看到哪些视图在哪里。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T21:11:59.283

当您在 IB 中将表格视图的单元格高度设置为 1 像素时，问题就消失了。似乎在填充表格之前，使用 IB 中设置的单元格高度的轮廓绘制了一个空表格。不要将单元格高度设置为 0。IB 不喜欢这样。:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T19:53:48.520

你在你的 -tableView:heightForRowAtIndexPath: 方法中做了什么特别的事情吗？

在我看来，行的高度设置不正确，因此单元格的内容正在扩展超出其范围。

# iphone - UITableView在导航栏下滚动

> ID：321526
> 
> 赞同：1
> 
> 时间：2008-11-26T17:39:00.587
> 
> 标签：iphone, objective-c, cocoa-touch, uitableview

我有一个表格视图设置，当前，当它闪烁时，它的部分与状态栏正下方齐平，而不是与导航栏齐平。我不确定这是否是正确的行为，但是当它滑入视图时，大多数应用程序都会在导航栏下方正确刷新部分标题。

纠正这个问题而不是任意缩小 tableView 的正确方法是什么？

*** 编辑 ***

与我在[Broken cell 中创建的带有奇怪删除线的线程有关？](https://stackoverflow.com/questions/321522/iphone-devel-broken-cell-with-an-odd-strikethrough). 当我将导航栏设置为半透明黑色时，会出现此问题以及“单元格删除线”问题。当它是黑色不透明或正常时，不存在这样的问题。我不确定这是因为我的代码中的其他内容还是 SDK 的问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T18:01:00.417

听起来您要么没有在 IB 中正确设置边界，要么您的弹簧和支柱不正确。这是 UIViewController 的顶层，还是子视图？你在使用 UINavigationController 吗？如果在 IB 中测试接口，看起来还可以吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-13T04:45:48.283

我遇到了类似的问题，通过设置它会自动修复

```
self.navigationController.navigationBar.barStyle = UIBarStyleBlackTranslucent; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T23:40:58.717

正如我在另一篇文章中指出的那样，我怀疑 UINavigationController 下的视图层次结构已被破坏。

UINavigationController 的内容视图（包含导航栏和您的 UITableView）中的 layoutSubviews 应该调整 UITableView 的大小，使其不与导航栏重叠。在您的情况下，我猜测 UITableView 之后会自行调整大小，或者 layoutSubviews 出于某种原因不知道 UITableView 并且 UITableView 在导航栏下方传递，从而导致您看到的对齐问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-26T09:21:05.060

我在 iOS 5.1 上使用以下代码遇到了同样的问题：

**创建导航控制器并添加表格视图**

```
UINavigationController *navigationController = [[UINavigationController alloc] init];
[navigationController setModalPresentationStyle:UIModalPresentationFormSheet];
[navigationController setModalTransitionStyle:UIModalTransitionStyleFlipHorizontal];
[navigationController.navigationBar setBarStyle:UIBarStyleBlack];
[navigationController.navigationBar setTranslucent:TRUE];
[navigationController setNavigationBarHidden:NO animated:NO];
[self presentModalViewController:navigationController animated:YES];

MyTableViewController *aTableViewController = [[[MyTableViewController alloc] initWithStyle:UITableViewStylePlain] autorelease];
aTableViewController.navigationItem.rightBarButtonItem = buttonItem;
[navigationController pushViewController:aboutTableViewController animated:YES]; 
```

**将表头视图添加到表中**

```
ATableHeaderView aTableHeaderView = [[[ATableHeaderView alloc] initWithFrame:aboutTableView.frame] autorelease]; 
[aTableHeaderView setAutoresizingMask:UIViewAutoresizingFlexibleHeight|UIViewAutoresizingFlexibleWidth|UIViewAutoresizingFlexibleTopMargin];
[aTableHeaderView sizeToFit];
[aTableView setTableHeaderView:aTableHeaderView]; 
```

**在表头视图中，我添加了一些标签**

```
UILabel *aLabel = [[[UILabel alloc] initWithFrame:CGRectMake(x,y, width, height)] autorelease];
[aLabel setText:aString];
[aLabel setAutoresizesSubviews:YES];
[aLabel setAutoresizingMask:UIViewAutoresizingFlexibleHeight | UIViewAutoresizingFlexibleWidth]; 
```

我最终得到了导航栏下的表格标题内容。将导航栏更改为纯黑色修复了它。但这不是我想要的。经过反复试验，我删除了该行：

```
[aLabel setAutoresizingMask:UIViewAutoresizingFlexibleHeight | UIViewAutoresizingFlexibleWidth]; 
```

从标题中 UILabel 的设置，问题得到解决。我有一个半透明的标题，表格的内容定位正确。

# c# - 如何使用 c# 从 windows mobile 打开网络连接？

> ID：321531
> 
> 赞同：3
> 
> 时间：2008-11-26T17:40:44.717
> 
> 标签：c#, networking, windows-mobile, compact-framework

我正在尝试将 Windows 窗体应用程序转换为 Windows Mobile 应用程序（Windows Mobile 6 Professional）。它需要从 Web 服务器获取 XML 文档。如果设备已经有一个开放的网络连接，它就可以正常工作，比如在运行应用程序之前打开 IE。但如果没有打开的连接，它会挂起。

如果连接不存在，我已经想出了几种不同的方法来打开连接，但是如果连接已经打开，每种方法都会挂起应用程序。

测试开放连接的正确方法是什么，如果不存在，打开一个？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-26T18:03:51.487

您应该使用[ConnectionManager API](http://msdn.microsoft.com/en-us/library/aa458120.aspx)来请求设备建立连接。适用于 WinMo 5.0 及更高版本。Jim Wilson[在此处有一篇关于 API 的管理使用的文章](http://msdn.microsoft.com/en-us/library/bb840031.aspx)。您也可以使用[CSP](http://msdn.microsoft.com/en-us/library/aa456107.aspx)。当然，[OpenNETCF 的 SDF](http://www.smartdeviceframework.com)也有一组 ConnectionManager 类。

# constraint-programming - 约束编程入门

> ID：321535
> 
> 赞同：39
> 
> 时间：2008-11-26T17:42:09.800
> 
> 标签：constraint-programming

寻找开始使用约束编程的技巧、教程、书籍和其他资源。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-05T02:43:31.843

一旦你进入了最佳状态，网上就有很多优秀的材料，但下面的链接是（IMO）很好的起点（我使用的那些）。

[Programming with Constraints: An Introduction - (Course website)](https://people.eng.unimelb.edu.au/pstuckey/book/course.html)
[Programming with Constraints: An Introduction - (Google book)](http://books.google.ca/books?id=jBYAleHTldsC&dq=Programming+with+Constraints&pg=PP1&ots=QfhyTiUzBP&source=bn&sig=BuqKI2n2fkcPzek-8C-T9m82e0Q&hl=en&sa=X&oi=book_result&resnum=4&ct=result#PPT437,M1)
[Online Guide to Constraint Programming](http://ktiml.mff.cuni.cz/~bartak/constraints/)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-07-25T18:28:33.140

约束处理规则 (CHR) 是一种开发自己的（特定于问题的）约束求解器的语言。检查这个：

*   [CHR主页](https://dtai.cs.kuleuven.be/CHR/)

在那里你可以找到链接

*   ***WebCHR 在线演示***（最初在 LMU 慕尼黑开发，现在在 Uni Ulm 进行美化）
*   **Prolog**（自然）和**Haskell**的几个实现，以及 Java（JCK）的（不幸的是未维护的）原型。

还有一个 CHR 的 JavaScript 实现：http: [//chrjs.net](http://chrjs.net) ( [https://github.com/fnogatz/CHR.js](https://github.com/fnogatz/CHR.js) )

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-27T07:16:58.797

也许你可以看看萨尔大学关于约束规划的介绍性[课程。](http://www.ps.uni-sb.de/courses/cp-ss07/services.html)他们不像[dr_pepper](https://stackoverflow.com/questions/321535/getting-started-with-constraint-programming#321579)所说的那样使用 mozart ，而是使用[Gecode](http://www.gecode.org/)。Gecode 是 mozart 的后续语言，部分由同一个人实现。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-26T17:54:40.680

我建议开始使用[mozart](http://www.mozart-oz.org/)。它是一种开源约束编程语言，该站点有大量文档可以帮助您入门。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-07-18T13:56:50.563

这是[约束编程](http://www.ict.kth.se/courses/ID2204/)课程网站的另一个链接。

早些时候，该课程使用 Mozart/Oz 进行评估，但现在已被[Gecode](http://gecode.org)取代。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-02-09T03:19:30.527

我建议您进一步查看以下网站，了解由 Håkan Kjellerstrand（又名 Hakank）在[Hakank 主页上维护的约束规划](http://www.hakank.org/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-09-01T16:41:50.877

[Microsoft 的 Solver Foundation](http://code.msdn.microsoft.com/solverfoundation)有一些易于理解的示例。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-05T02:51:08.130

[约束规划](http://books.google.com.au/books?id=Kjap9ZWcKOoC)的手册是经过深思熟虑的。

在琐事中，那里引用了[我四年级](http://portal.acm.org/author_page.cfm?id=81100589552) 大学的导师（不久前）。:)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-20T17:12:46.680

如果你是 Java 程序员，我推荐使用[Cream: Class Library for Constraint Programming](http://bach.istc.kobe-u.ac.jp/cream/)

# share - 项目的 Intranet 门户

> ID：321536
> 
> 赞同：1
> 
> 时间：2008-11-26T17:42:10.017
> 
> 标签：share

我想为我的开发团队设置一个门户来分享想法、报告、文档、图像等。类似于 MS SharePoint 但免费/开源的东西。

你能分享一下你们都用什么来做同样的事情吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T17:44:34.413

查看[DotNetNuke](http://www.dotnetnuke.com)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T17:45:41.320

[Trac](http://trac.edgewall.org/ "追踪")和[MediaWiki](http://www.mediawiki.org/wiki/MediaWiki "媒体维基")将是我的前两个选择，这取决于您是否想要集成票务。别忘了，MediaWiki 有一个强大的插件生态系统，所以你想在 wiki 和讨论功能之外添加的任何东西都可能是可用的。

[Redmine](http://www.redmine.org/ "红米")是另一个不错的选择——我不像 Trac 那样喜欢它，但在我保存项目管理工具的共享主机上设置要容易得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T17:47:05.267

尝试[露天](http://www.alfresco.com/)

# linq - 在 Linq/Lambda 中编写存储过程（可单元测试但高性能的存储过程）。可能的？

> ID：321543
> 
> 赞同：2
> 
> 时间：2008-11-26T17:43:50.437
> 
> 标签：linq, unit-testing, stored-procedures, report, expression-trees

我正在为报告模型（SQL Server Reporting Services）创建数据源。这些报告需要大量的连接和计算（比如说，计算财务参数，比如花在这个、那个、金额 A 和金额 B 上的钱）......所有这些都涉及子对象。

为这段代码编写单元测试对我来说很有意义（即遍历订单集合，根据业务规则和子对象聚合信息等）。为了正确地做到这一点，我希望我的代码看起来大约。像这样

```
foreach (IOrder in Orders)
   foreach (IOrderLine in IOrder.Orderlines) 
     ...

   return ... 
```

然后测试返回值。

但是这段代码不是将在报告视图中使用的 SQL……当然……所以我在想，我可以在数据库中插入一个 .NET 程序集。这里的问题当然是性能……我不想在 C# 中循环所有这些对象……太慢了。

所以，很自然，Linq/Lambda/Expression 树似乎是我的答案。众所周知，当你在做 Linq to SQL 时，会先构建表达式树，然后基于它们生成适当的 SQL。

因此，我可以使用 lambda 表达式在 Linq to Objects 中编写我的代码，在示例集合上对这段代码进行单元测试（将表达式编译为 .net），并在 DB 存储过程中重用与 Linq to SQL 相同的代码，以便在内部SQL Server 它会为我生成正确的 SQL（就像 Linq to SQL 已经做的那样）......

然后我可以从单元测试和用 C# 编写域逻辑代码以及用于报告的高性能存储过程中获益。

可能的？**我可以在 SQL Server CLR 存储过程中使用 Linq/Lambda 吗？**有人做过或知道如何使它工作吗？我疯了吗？你知道更好的方法吗？

谢谢

**PS我想现在我想出了应该如何正确地做到这一点**。根据 Udi Dahan 的说法，如果我理解他的话。数据库应该是非规范化的，所有计算的字段都应该在表中的对象上。当子对象（添加了 OrderLine）发生某些事情时，我的 Customer 对象应该接收一个事件并重新计算智能值（缓存它并保持）。

然后报告直截了当，没有逻辑并且工作快速......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-02T21:14:02.320

不，您不能在 SQL CRL Procs 中使用 LINQ/Lambda - 它基于不同版本的 .NET，并且不支持这些命名空间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-02T22:50:30.020

> 因此，我可以使用 lambda 表达式在 Linq to Objects 中编写我的代码，在示例集合上对这段代码进行单元测试（将表达式编译为 .net），并在 DB 存储过程中重用与 Linq to SQL 相同的代码，以便在内部SQL Server 它会为我生成正确的 SQL（就像 Linq to SQL 已经做的那样）......

在您建议从存储的过程中调用 CLR 代码之前，这个计划很好。从数据库进程本身运行 CLR 代码会在版本控制、配置和数据库稳定性方面产生很多问题……如果这样做，问题就会太多。

您的动机是受益于使用存储过程，这通常更快。如果这些存储过程依次运行 CLR 代码，它们不会比在本地进程中运行的 CLR 代码快。

从技术上讲，使用 LINQ 生成的表达式比存储的过程消耗更多的 CPU 周期。这是因为数据库引擎必须在每次运行查询时重新生成执行计划。通常，您的数据库服务器位于单独的计算机上，尽管它不受 CPU 限制（它将受到磁盘或网络容量的限制），因此这不是真正的性能问题。如果您在与其他所有设备相同的机器上运行数据库服务器，则可能是这样，但不要尝试用如此复杂的东西来解决这个问题，直到它成为真正的问题。

如果您想减少生成报告的开销，Udi 的建议可能是合适的。尽管首先要考虑两个重要的副作用。首先，是否能够增加预生成报告字段的操作的性能开销？一个更大的问题是它将您的报告逻辑与运行目标系统的代码耦合在一起。这可以防止您在不更新业务代码的情况下更新报告代码，并假定报告代码在报告代码投入生产后立即运行。

# database - db4o 开发工具和资源？

> ID：321545
> 
> 赞同：1
> 
> 时间：2008-11-26T17:44:10.093
> 
> 标签：database, db4o

由于 db4o ObjectManager 的 7.x 版本仅作为商业产品提供（非常昂贵！）是否有任何替代工具可用于检查/探索 db4o 7.x 数据库？

此外，您还会向 db4o 开发新手推荐哪些其他工具？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-04T00:51:27.790

对象管理器似乎现在是免费的：

[Object Manager Enterprise 现在对所有开发人员免费](http://developer.db4o.com/blogs/product_news/archive/2009/01/25/object-manager-enterprise-now-free-to-all-developers.aspx)

我想试一试！

# java - 如何在不强制转换的情况下将 double 转换为 long？

> ID：321549
> 
> 赞同：202
> 
> 时间：2008-11-26T17:44:52.040
> 
> 标签：java, type-conversion

在不强制转换的情况下将 double 转换为 long 的最佳方法是什么？

例如：

```
double d = 394.000;
long l = (new Double(d)).longValue();
System.out.println("double=" + d + ", long=" + l); 
```

* * *

## 回答 #1

> 赞同：265
> 
> 时间：2008-11-26T17:47:18.400

假设您对截断为零感到满意，只需投射：

```
double d = 1234.56;
long x = (long) d; // x = 1234 
```

这将比通过包装类更快 - 更重要的是，它更具可读性。现在，如果您需要“始终接近零”以外的舍入，则需要稍微复杂一点的代码。

* * *

## 回答 #2

> 赞同：139
> 
> 时间：2008-11-26T17:49:07.150

...这是不截断的舍入方式。赶紧在Java API Manual中查找：

```
double d = 1234.56;
long x = Math.round(d); //1235 
```

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2014-06-09T22:27:58.610

首选方法应该是：

```
Double.valueOf(d).longValue() 
```

来自[Double (Java Platform SE 7) 文档](http://docs.oracle.com/javase/7/docs/api/java/lang/Double.html#valueOf(double)：

```
Double.valueOf(d) 
```

> 返回表示指定值的`Double`实例。如果不需要`double`新实例，则通常应优先使用此方法，而不是构造函数，因为此方法可能会通过缓存频繁请求的值来显着提高空间和时间性能。`Double``Double(double)`

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2008-11-26T17:49:07.303

`(new Double(d)).longValue()`内部只是进行强制转换，因此没有理由创建 Double 对象。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2012-08-14T10:28:53.840

番石榴数学库有一个专门设计用于将双精度数转换为长整数的方法：

```
long DoubleMath.roundToLong(double x, RoundingMode mode) 
```

您可以使用`java.math.RoundingMode`来指定舍入行为。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2015-05-04T07:22:36.730

如果您强烈怀疑 DOUBLE 实际上是 LONG，并且您想

1) 将其 EXACT 值作为 LONG 的句柄

2) 当它不是 LONG 时抛出一个错误

你可以尝试这样的事情：

```
public class NumberUtils {

    /**
    * Convert a {@link Double} to a {@link Long}.
    * Method is for {@link Double}s that are actually {@link Long}s and we just
    * want to get a handle on it as one.
    */
    public static long getDoubleAsLong(double specifiedNumber) {
        Assert.isTrue(NumberUtils.isWhole(specifiedNumber));
        Assert.isTrue(specifiedNumber <= Long.MAX_VALUE && specifiedNumber >= Long.MIN_VALUE);
        // we already know its whole and in the Long range
        return Double.valueOf(specifiedNumber).longValue();
    }

    public static boolean isWhole(double specifiedNumber) {
        // http://stackoverflow.com/questions/15963895/how-to-check-if-a-double-value-has-no-decimal-part
        return (specifiedNumber % 1 == 0);
    }
} 
```

Long 是 Double 的子集，因此如果您在不知情的情况下尝试转换 Long 范围之外的 Double，您可能会得到一些奇怪的结果：

```
@Test
public void test() throws Exception {
    // Confirm that LONG is a subset of DOUBLE, so numbers outside of the range can be problematic
    Assert.isTrue(Long.MAX_VALUE < Double.MAX_VALUE);
    Assert.isTrue(Long.MIN_VALUE > -Double.MAX_VALUE); // Not Double.MIN_VALUE => read the Javadocs, Double.MIN_VALUE is the smallest POSITIVE double, not the bottom of the range of values that Double can possible be

    // Double.longValue() failure due to being out of range => results are the same even though I minus ten
    System.out.println("Double.valueOf(Double.MAX_VALUE).longValue(): " + Double.valueOf(Double.MAX_VALUE).longValue());
    System.out.println("Double.valueOf(Double.MAX_VALUE - 10).longValue(): " + Double.valueOf(Double.MAX_VALUE - 10).longValue());

    // casting failure due to being out of range => results are the same even though I minus ten
    System.out.println("(long) Double.valueOf(Double.MAX_VALUE): " + (long) Double.valueOf(Double.MAX_VALUE).doubleValue());
    System.out.println("(long) Double.valueOf(Double.MAX_VALUE - 10).longValue(): " + (long) Double.valueOf(Double.MAX_VALUE - 10).doubleValue());
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-09-10T09:58:11.390

只需通过以下方式：

```
double d = 394.000;
long l = d * 1L; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-26T17:51:05.397

简单地说，强制转换比创建 Double 对象更有效。

# asp.net-mvc - 单元测试：创建一个“模拟”请求来模拟 MVC 页面请求

> ID：321550
> 
> 赞同：2
> 
> 时间：2008-11-26T17:45:26.703
> 
> 标签：asp.net-mvc, unit-testing, tdd

如何为我的 asp.net-mvc 应用程序创建模拟请求以进行单元测试？

我有什么选择？

我在我的操作中使用 FormsCollection，所以我也可以模拟表单输入数据。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T19:06:45.527

您只需创建一个新的 FormCollection 实例并在其中添加数据。

所以你可以在不嘲笑任何东西的情况下调用这样的东西。

```
var result = controller.Create(new FormCollection { { "InvoiceId", "-1" } }) as RedirectToRouteResult; 
```

否则，如果您的代码调用诸如 Request 或 HttpContext 之类的东西，您可以使用以下扩展方法（灵感来自 Scott Hanselman 的[示例](http://www.hanselman.com/blog/ASPNETMVCSessionAtMix08TDDAndMvcMockHelpers.aspx)）

我正在使用 RhinoMocks。

```
public static HttpContextBase SetHttpContext(this MockRepository mocks, Controller controller, HttpCookieCollection cookies) {
cookies = cookies ?? new HttpCookieCollection();

var request = mocks.StrictMock<HttpRequestBase>();
var context = mocks.StrictMock<HttpContextBase>();
var response = mocks.StrictMock<HttpResponseBase>();

SetupResult.For(context.Request).Return(request);
SetupResult.For(context.Response).Return(response);
SetupResult.For(request.Cookies).Return(cookies);
SetupResult.For(request.IsSecureConnection).Return(false);
SetupResult.For(response.Cookies).Return(cookies);

if (controller != null)
{
    controller.ControllerContext = new ControllerContext(context, new RouteData(), controller);
}

if (!string.IsNullOrEmpty(requestUrl))
{
    request.SetupRequestUrl(requestUrl);
    SetupResult.For(response.ApplyAppPathModifier(null)).IgnoreArguments().Return(null);
}

return context;
} 
```

# git - 防止使用 Git 覆盖文件

> ID：321561
> 
> 赞同：2
> 
> 时间：2008-11-26T17:48:46.307
> 
> 标签：git, version-control

我的公司最近开始使用 Git 进行源代码版本控制，并且由于编码人员的无能 - 那是我和我的老板 :-P - 我们有一个非常好的意大利面条被到处覆盖。
有没有办法将某些文件标记为“不可触及”，所以如果从另一个分支更新分支时要么不覆盖文件，要么根本不进行更新？
提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T20:33:50.623

您可以添加一个名为 .gitignore 的文件。git 将忽略与该文件中的正则表达式匹配的任何文件名。

因此，我通常从以下内容开始：

```
*.log
*~
conf/* 
```

修改口味。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T21:11:16.867

你可以用钩子完全按照你的要求做，但我不知道这是否能解决你真正的问题。

如果它就像您正在处理的文件被修改一样简单，那很容易：永远不要对未提交的更改进行拉/合并/变基。在引入任何其他代码之前始终提交。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T17:59:09.110

一般来说，Git 在使用 checkout 从一个分支移动到另一个分支时会尽量避免覆盖更改的文件。也就是说，如果一个文件没有被改变，而 Git 需要改变它，那么文件就会改变（之前的文件内容仍然存在于之前的分支中）。如果文件已更改且 Git*不需要*更改，则文件内容将被保留。如果文件已被更改，Git 想要更改它，则会通知您本地更改与分支更改冲突，Git 将拒绝切换分支。

为了了解您的文件被意外覆盖的原因，我们可能需要有关您所做操作的更多信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-26T19:21:48.210

让 Git 丢弃信息需要非常具体的操作，即使这样它也不会覆盖信息。所以情况可能不是你想象的那样。

将 Git 存储库视为源代码的事务数据库。根据您的操作系统和设置，它可能是一个隐藏的数据库，因此您看到的只是工作目录。

问题是：*Git 使用本地文件系统中的工作目录作为数据库上的浏览器*。该“视图”可以更改，并且您所有交易（提交）的记录*仍在回购中，未更改*。

因此，您看到的工作目录将根据您调用的“视图”（结帐，通常是一个分支）而改变。甚至在你的文本编辑器中打开的文件副本也可以更改，这让我第一次注意到它时感到很奇怪。

您*可以*丢弃之前的工作，例如：
1.`git reset HEAD~2` 丢弃最后两次提交或
2.`checkout -f` 丢弃工作目录中未提交的更改（如果尚未`git add`编辑，则无法恢复），然后更改为不同的分支（'view ')
但您不能在不收到警告消息的情况下无意中覆盖信息。在大多数情况下，信息仍然在 repo 中，直到它被垃圾收集，通常是在 30 多天之后。

正如格雷格所说，我们需要更多信息才能确定。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T18:08:30.353

听起来你想要的是阻止 git 跟踪“不可触碰”的文件。这是通过使用[git rm 命令](http://www.kernel.org/pub/software/scm/git/docs/git-rm.html "git rm 命令")完成的。

```
git rm <file> 
```

如果这是您想要的，请使用 --dry-run 开关来预览会发生什么。如果您确定要删除文件，则可能需要使用 --cached 开关，以免删除本地文件。

当然，您必须手动将文件添加到未来的分支中，这可能不是一个好主意。

# linq - 数据表上的 Linq 查询（“不在”）

> ID：321566
> 
> 赞同：1
> 
> 时间：2008-11-26T17:49:55.807
> 
> 标签：linq

我想返回`TableA`另一个表中不存在的表中的所有行。

例如

```
select bench_id from TableA where bench_id not in (select bench_id from TableB ) 
```

你能帮我写一个等效的 LINQ 查询吗？这`TableA`是来自 Excel，`TableB`来自数据库

我正在将 Excel 工作表数据加载到`DataTable`. 我正在从数据库加载。简而言之，并且是类型`TableA``TableB``TableA``TableB``DataTable`

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T17:53:32.133

那么如果表 A 来自 Excel，您是先将数据加载到内存中吗？如果是这样（即您正在使用 LINQ to Objects），那么我建议您将表 B 中的 ID 加载到一个集合中，然后使用：

```
var query = tableA.Where(entry => !tableBIdSet.Contains(entry.Id)); 
```

如果这不合适，请提供更多详细信息。

转换成一个集合可能最好使用[HashSet 构造函数来完成，该构造函数接受一个`IEnumerable<T>`](http://msdn.microsoft.com/en-us/library/bb301504.aspx). 例如：

```
var tableBIdSet = new HashSet<string>(db.TableB.Select(entry => entry.Id)); 
```

（如果 ID 实际上不是不同的，您可以在最后添加对 Distinct() 的调用。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-25T09:21:42.000

```
var lPenaltyEmployee = from row1 in tBal.getPenaltyEmployeeList().AsEnumerable()
                                   select row1;

var PenaltyEmp = new HashSet<string>(lPenaltyEmployee.Select(Entry => Entry.Emsrno);

DataTable lAbsentEmp = (from row in tBal.getAbsentEmployee(txtFromDate.Text).AsEnumerable()
                                    where !(PenaltyEmp).Contains(row["Emsrno"].ToString())
                                    select row).CopyToDataTable(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T17:54:35.687

```
From a in TableA
Group Join b in TableB on a.bench_id Equalsb.bench_id into g = Group
Where g.Count = 0
Select a 
```

# visual-studio - 使用firefox作为默认浏览器进行VS2008调试-如何使调试器在退出时停止/关闭？

> ID：321568
> 
> 赞同：14
> 
> 时间：2008-11-26T17:51:17.237
> 
> 标签：visual-studio, debugging, firefox

我将 Firefox 作为我的开发机器上的默认浏览器，当我从 Visual Studio 开始调试时，Firefox 会按照我的预期启动，并且体验的所有属性都与 IE 相同，除了一件事 - 当我关闭浏览器时。使用 IE 时，当我关闭浏览器时，Visual Studio 会自动关闭调试器。当我关闭 FF 时，我没有得到这种行为 - 有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-23T01:18:59.630

这种行为的原因很简单：Visual Studio 将自己附加到要调试的进程，如果看到该进程终止，它将退出运行模式。FireFox 不会在每次启动窗口时创建新进程：它会重用现有进程。IE 能够为每个窗口创建一个新窗口（取决于选项设置）。如果您已经在运行 FF 并启动要调试的应用程序，则会在现有进程中创建应用程序窗口，并且 VS 会附加到该进程。当您关闭应用程序窗口时，该过程不会终止，因为它对于预先存在的窗口仍然处于活动状态。下次它发生关闭所有其他 FF 窗口时，您将看到 Visual Studio 退出调试运行模式。如果有办法告诉 FireFox 为新窗口创建一个新进程，那么这个问题就会消失。我没有

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-28T00:58:39.800

要添加到[Mark 的](https://stackoverflow.com/questions/321568/vs2008-debugging-with-firefox-as-default-browser-how-to-make-the-debugger-stop#471509)答案，您可以为 firefox 设置特定的“调试”配置文件，然后更改项目的属性/Web，选择“启动外部程序”并浏览到 firefox.exe，并将命令行参数设置为'-no-远程-P“MyDebugProfile”'。

要管理您的配置文件，请（从命令行）像这样启动 firefox：

```
c:\> <installation path of ff>\firefox.exe -profilemanager 
```

在那里，您创建一个新的配置文件（让我们说“调试”）

要使用此配置文件（即您为 VS 设置的内容）启动新的 FF 进程：

```
c:\> <install path to ff>\firefox.exe -no-remote -P "debug" "http://mysite" 
```

请注意，“-P”参数区分大小写。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-04T06:10:51.143

右键单击任何 .aspx 页面并选择“浏览方式...”选项，您可以在此处设置默认浏览器

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T00:53:00.100

尝试将调试器附加到 FireFox 进程！

在 VS (2008) 中，选择菜单选项 Debug -> Attach to Process，然后选择 firefox.exe - 如果您没有看到此进程，您可能必须确保选中“Show processes in all sessions”。

我运行了它并验证它确实有效。我还验证了通过应用程序调试关闭 FireFox 不起作用，如果您将 Firefox 设置为 VS 2008 中的默认浏览器。

# javascript - 我们还需要在 JavaScript 中检查不同的浏览器类型吗？

> ID：321571
> 
> 赞同：0
> 
> 时间：2008-11-26T17:53:00.900
> 
> 标签：javascript, jquery

这可能是一个简单的问题，问这个问题我有点尴尬，但我已经使用这段 JavaScript 广告代码有一段时间了，这让我很困扰，它对我来说从来没有真正的意义，而且可能已经过时了现在使用现代浏览器。我的问题是，我们还需要检查浏览器类型吗，第二段脚本在做什么？

```
<script type="text/javascript">
  document.write('<scr' + 'ipt src="" type="text/javascript"></scr' + 'ipt>');
</script>
<script type="text/javascript">
  if ((!document.images && navigator.userAgent.indexOf('Mozilla/2.') >= 0)  || navigator.userAgent.indexOf("WebTV")>= 0) {
    document.write('<a href="">');
    document.write('<img src="" border="0" alt="" /></a>');
  }
</script> 
```

我想澄清一下，我实际上是在给某人打电话，所以虽然我可以检查浏览器类型，但这确实是代码管理员的责任。如果我能把它放到 jQuery 中，我会很高兴——但我在调用时遇到了问题（请参阅下面的另一篇文章）。

我想知道的是，我还需要检查这些浏览器类型吗？

干杯，
史蒂夫

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-26T17:54:47.497

[大多数情况下，我们使用像jQuery](http://jquery.com/)这样的javascript 库来为我们处理这类事情。

奇怪的是，这些天我发现自己更频繁地破解每个浏览器的 CSS。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T18:00:29.997

最好检查浏览器 DOM 是否支持特定功能，而不是直接处理用户代理字符串。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T18:11:12.097

在第二段代码中：它正在检查两件事：

*   打开文档的浏览器支持 DOM 的 document.images 部分，文档包含任何图像，并且浏览器的 UserAgent 字符串（标识符）包含“Mozilla/2.”，
*   或者 UserAgent 字符串包含“WebTV”

在这些情况下，它会输出一个空链接和图像标签。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T18:12:32.593

这就是使用 API（例如 jQuery）的原因。他们将检查浏览器兼容性（和未来兼容性）的工作从开发人员身上转移了出去。当出现新浏览器或新版本的浏览器时，如有必要，API 会更新，以便您的代码继续工作。

所以看看你能不能用jQuery想出一个解决方案，你就不用担心这个了。为了将来的兼容性，您可能必须获得最新版本的 jQuery，但理论上您的代码不必更新。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T18:20:07.040

很高兴听到这么多人支持 jQuery，但我添加的代码针对的是我无法控制的外部脚本，我的问题是每当我使用 jQuery 调用此脚本时，广告会自行打开页：

```
$(this).append().html('<script src="http://ad.doubleclick.net/adj/' + site + '.iclick.com/adtarget;subss=' + subss + ';subs=' + subs + ';area=' + area + ';site=' + site + ';kw=' + kw + ';sz=' + $adSize + ';pos=' + count + ';tile=' + tilecount + ';ord=' + zzzzadslotzzzz + '"></script>'); 
```

我很想把这些东西移到 jQuery 中（这是我的目标，因为我想在文档准备好之前停止加载广告）

谢谢，
史蒂夫

# linq-to-sql - 使用反射信息生成 lambda

> ID：321572
> 
> 赞同：3
> 
> 时间：2008-11-26T17:53:00.917
> 
> 标签：linq-to-sql, lambda

我有实体类型、主键名称和主 ID 的 Guid。我想在 LinqToSql 中获取此类 Id 的元素。

```
model.GetTable<T>().Where(t => here equality  ); 
```

我想我需要自己生成那个表达式，但我不知道如何:(

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-28T17:54:30.197

[http://blog.dynback.com/index.php/2008/11/architecture/database/repository-in-linq-to-sql-getbyid-part/](http://blog.dynback.com/index.php/2008/11/architecture/database/repository-in-linq-to-sql-getbyid-part/)

调查结果！看一看！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-27T13:00:34.733

我期待着，在搜索编译器代码生成之后，在 Reflector 中我发现了这个 lambda 的创建。

```
 public static T GetById(Guid id)
    {
        Type entType = typeof(T);

        if (!CheckTable(entType)) {
            throw new TypeLoadException(string.Format(
                "{0} is not Table Entity, has no attribute Table", entType.FullName));
        }

        string property = GetPrimaryKeyName(entType).Name;

        ParameterExpression cs;
        var lambda = Expression.Lambda<Func<Personal, bool>>(
                Expression.Equal(
                        Expression.Property(
                                cs = Expression.Parameter(typeof(T), "p"), 
                                entType.GetProperty(property).GetGetMethod()
                        ), 
                        Expression.Constant(id), 
                        false, 
                        typeof(Guid).GetMethod("Equals")
                ), new ParameterExpression[] { cs }
        );

        return Connection.Model.GetTable<T>().Single(lambda);
    } 
```

我需要的东西，但我有编译器异常：

> 错误 5 无法从用法中推断方法“System.Linq.Enumerable.Single(System.Collections.Generic.IEnumerable, System.Func)”的类型参数。尝试明确指定类型参数。D:\Projects\Own\Yabeda\Source\trunk\med\Yabeda.Med.Mvc\Data\Oper.cs 48 20 Yabeda.Med.Mvc

找不到此错误的含义！

# python - urllib2 数据发送

> ID：321582
> 
> 赞同：2
> 
> 时间：2008-11-26T17:56:09.507
> 
> 标签：python, urllib2

我最近在 SO 的帮助下写了这个。现在有人可以告诉我如何让它真正登录到板上。它以非登录格式显示所有内容。

```
import urllib2, re
import urllib, re
logindata = urllib.urlencode({'username': 'x', 'password': 'y'})
page = urllib2.urlopen("http://www.woarl.com/board/index.php", logindata)
pagesource = page.read()
print pagesource 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T18:06:45.320

最近有人问[了你问的同样的问题](https://stackoverflow.com/questions/301924/python-urlliburllib2httplib-confusion)。如果您通读该问题的答案，您将看到代码示例向您展示如何在仅使用标准库中的内容在 Python 脚本中浏览网站时保持登录状态。

接受的答案可能对您没有[其他答案](https://stackoverflow.com/questions/301924/python-urlliburllib2httplib-confusion#302184)有用，因为接受的答案处理涉及重定向的特定问题。但是，无论如何，我建议通读所有答案。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T18:02:14.843

您可能想研究从服务器保留 cookie。

[Pycurl](http://pycurl.sourceforge.net/)或[Mechanize](http://wwwsearch.sourceforge.net/mechanize/)会让你更轻松

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T18:08:05.830

如果实际查看页面，您会看到登录链接将您带到[http://www.woarl.com/board/ucp.php?mode=login](http://www.woarl.com/board/ucp.php?mode=login)

该页面具有登录表单并再次使用 POST提交到[http://www.woarl.com/board/ucp.php?mode=login 。](http://www.woarl.com/board/ucp.php?mode=login)

然后，您必须提取可能设置的 cookie，并将它们放入 CookieJar 或类似文件中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T03:46:52.667

您可能希望使用这些处理程序创建一个开启程序并将其应用于 urllib2。应用这些后，您的 cookie 将得到处理，如果服务器决定将您带到其他地方，您将被重定向。

```
# Create handlers
cookieHandler = urllib2.HTTPCookieProcessor() # Needed for cookie handling
redirectionHandler = urllib2.HTTPRedirectHandler() # needed for redirection (not needed for javascript redirect?)

# Create opener
opener = urllib2.build_opener(cookieHandler,redirectionHandler)

# Install the opener
urllib2.install_opener(opener) 
```

# asp.net - ASP.NET 动态页面控件：是否可以在 Page.Load 之后绑定事件？

> ID：321585
> 
> 赞同：0
> 
> 时间：2008-11-26T17:58:08.347
> 
> 标签：asp.net, jquery, asp.net-ajax, asp.net-2.0

我有一个网站，我目前正在使用通常的 WebForm 东西和 ASP.NET AJAX 1.0 在 ASP.NET 2.0 中工作。是否可以在 Page.Load 事件之后将事件绑定到动态创建的控件？

我有一个类似于此代码的动态创建的 table <td> 元素：

```
' Create Link Button
lnk.ID = String.Format("lnkDetails_{0}", dr("Id"))
lnk.Text = dr("Name").ToString()
lnk.CommandArgument = dr("Id").ToString()
AddHandler lnk.Click, AddressOf DetailsLink_Click
cName.Controls.Add(lnk) 
```

此代码针对数据库中的每一行进行循环（当然还有更多单元格添加到表中，包括带有事件的 ImageButton。当我在导致并包括 Page.Load 的事件期间执行此代码时，这些事件完美地工作.我需要能够用当前数据填充此表，该数据在页面上其他地方的 btnClick 事件期间更新，该事件发生在此 Page_Load 事件之后，所以我用旧数据填充。如果我将此代码更改为 Page.LoadComplete ，事件停止工作。

此数据是应用程序各种组件的摘要显示，例如某人的姓名，当在“详细”表单上更新时，通过部分回发（要求）更新数据库，然后需要在此“摘要”中显示更新' 更新后的部分。目前，实际上需要 2 次回发才能真正看到“摘要”部分中的更改，因此摘要实际上比更改落后了 1 步（像泥巴一样清晰？）

什么是我用当前数据填充此表的最佳方式（在 Page.LoadComplete 期间/之后可用），但在单击链接时仍然会触发事件（该事件导致 UpdatePanel 显示“详细信息”形式）。

我还可以使用 jQuery 和常用的 ASP.NET AJAX 方法，而且 javascript 也是网站的要求，所以我不需要为不受支持的浏览器降级。

这是我的第一个 ASP.NET Web 应用程序，需要一些帮助来找出实现这一目标的最佳方法（我精通 PHP、Django 和制作 Web 表单的*常用*方法 - 比如在一个页面上拥有多个表单 o_O ）。

### 更新：

在 Page_Load 之后确实没有将控件事件绑定到控件的好方法。页面的整体架构是一个包含整个页面的 ASP.NET 表单，只有 1 个 aspx 页面。我正在使用母版页（但是它对我的问题没有任何明显的影响）。

页面分为左右“窗格”，左侧是所有数据的摘要（在更新面板中），右侧“窗格”有 6 个“选项卡”，每个选项卡都实现为自己的用户控件，每个选项卡都有几个表单字段和更新按钮都在它自己的更新面板中。

任何这些选项卡上的更新只会刷新摘要面板 ( `UpdatePanel.update()`) 及其自己的面板。来自 db 的摘要的动态控件的“刷新”和事件绑定发生在 Page_Load 期间，并且 Update Button 事件更新 db 数据。（控制事件发生在 Page_Load 之后）。我想避免重复发布以更新摘要，任何想法都是有帮助的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T18:53:14.413

在“页面其他位置的 btnClick 事件”中的数据更改后，您需要回发整个页面。听起来您有一个 UpdatePanel，听起来这正在捕获您的 btnClick 事件处理程序的回发。将 btnClick 放在 UpdatePanel 之外或更改其触发器，以便您的 btnClick 强制回发/刷新您的数据。或者，重新设计您的表格，使其在您单击 btnClick 时进行 AJAXly 刷新，如果不了解更多有关页面结构和控件的信息，很难获得更多详细信息。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T20:06:38.387

您可以随时绑定到事件。毕竟这只是一个简单的事件。但并非所有地方都适合，因为您必须考虑事件何时触发。在大多数情况下，这发生在 Page_Load 和 Page_PreRender 之间。这包括 LinkBut​​ton 上的单击事件。一般来说，我建议在 Page_Init 阶段添加您动态创建的控件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T18:04:08.383

您必须在 Page.Load 之前添加控件，以便在回发之间维护 ViewState，因此请使用 OnInit 事件处理程序。

但是一旦添加它们，您应该能够在 Page.Load 期间或之后的任何时间绑定事件处理程序（例如 OnClick）......例如在网格的 ItemDataBound （或类似的东西）或 Page.PreRender .

# asp.net - 使用 QueryString 值调试 ASP.NET 页面

> ID：321588
> 
> 赞同：2
> 
> 时间：2008-11-26T17:58:43.167
> 
> 标签：asp.net, visual-studio-2008, debugging

我正在尝试调试需要查询字符串中的值的 asp.net Web 表单。我只想调试该页面，而不必经历整个过程来创建查询字符串值并发送请求。

当我开始调试过程时，关于如何在 VS2008 中附加查询字符串值的任何建议。

注意：我不想在后面的页面代码中硬编码值。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-26T18:02:06.017

Visual Studio 可以选择在调试时启动哪个页面。

它在属性 -> 网站 -> 开始网址下

在那里您可以输入您想要的确切网址。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-25T18:58:12.183

Woot，这对我帮助很大！

只需从解决方案资源管理器中右键单击您的 Web 项目，单击属性（或 alt-enter），单击 Web 左侧选项卡，然后设置特定的起始页面（包括您的 qs 参数）！

# dos - DOS：如何在无需登录共享的情况下运行批处理？

> ID：321614
> 
> 赞同：1
> 
> 时间：2008-11-26T18:07:08.347
> 
> 标签：dos, xcopy

我在批处理脚本中运行 xcopy 命令，它将文件复制到另一个工作站上的共享驱动器；但是，工作站在连接到共享之前需要登录。有没有办法将登录/连接脚本写入批处理文件？

提前致谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T18:12:45.043

您可以使用“net use x:\servername\sharename /u:username password”命令登录到批处理文件中的共享。但是，将密码放入纯文本批处理文件通常是个坏主意。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T18:11:52.297

您可以使用 net use 映射临时驱动器并使用凭据登录。这是我们必须做的。也许有更好的方法。然后在脚本结束时我们取消映射驱动器。

这是 net use 命令的链接：[http ://www.cezeo.com/tips-and-tricks/net-use-command/](http://www.cezeo.com/tips-and-tricks/net-use-command/)

# linux - xls 到文本转换器

> ID：321617
> 
> 赞同：5
> 
> 时间：2008-11-26T18:08:18.093
> 
> 标签：linux, excel, unix, converter, xls

有人知道可以从 unix 命令行运行的免费 xls 到文本转换器吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-26T18:17:45.453

还有包含 xls2csv 实用程序的包[catdoc （Ubuntu 链接）。](http://packages.ubuntu.com/intrepid/catdoc)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T18:13:19.753

快速搜索出现`apt-cache`Ubuntu[软件包 python-excelerator](http://packages.ubuntu.com/intrepid/python-excelerator)的[excelerator](http://pypi.python.org/pypi/pyExcelerator/0.6.0a)`py_xls2html`，其中包括`py_xls2csv`和`py_xls2txt`实用程序。这对你有用吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T18:13:21.610

你的问题让我想起了[反字](http://www.winfield.demon.nl/)。我抬头一看，发现[anti-excel](http://sourceforge.net/projects/antiexcel/)。我从来没有使用过它，所以我不能保证它的效果如何，或者它是否可以完成你手头的任务。另外，我记得在 linux 上使用了一个名为“sc”的实用程序在控制台上创建电子表格——不过，我不知道它是否能够解释 XLS 文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-05-29T06:46:56.493

我认为 gnumeric 更好地将文档转换为 csv [http://xmodulo.com/2012/06/how-to-convert-xlsx-files-to-xls-or-csv.html](http://xmodulo.com/2012/06/how-to-convert-xlsx-files-to-xls-or-csv.html)

# c++ - C++ 序列化性能

> ID：321619
> 
> 赞同：22
> 
> 时间：2008-11-26T18:08:22.353
> 
> 标签：c++, performance, serialization, boost, protocol-buffers

我正在构建一个分布式 C++ 应用程序，该应用程序需要对在不同进程和计算机之间传递的简单数据结构进行大量序列化和反序列化。

我对序列化复杂的类层次结构不感兴趣，但更多的是发送带有一些简单成员（如数字、字符串和数据向量）的结构。数据向量通常可以是许多兆字节。我担心基于 text/xml 的方法太慢了，我真的不想自己写这个，因为字符串编码和数字字节序等问题会使它比表面上看起来更复杂。

我一直在研究协议缓冲区和 boost.serialize。根据文档，协议缓冲区似乎非常关心性能。从某种意义上说，Boost 似乎更轻量级，因为您没有用于指定数据格式的外部语言，我觉得这对于这个特定项目非常方便。

所以我的问题归结为：有人知道对于我上面描述的典型用例，boost 序列化是否很快？

此外，如果还有其他可能适合此的库，我很乐意听到它们。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-27T06:06:28.003

我强烈建议使用协议缓冲区。它们使用起来非常简单，提供出色的性能，并解决了字节顺序和向后兼容性等问题。为了使其更具吸引力，由于多种语言实现，序列化数据与语言无关。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-26T18:13:13.667

我会想到 ACE 和 ACE TAO，但您可能不喜欢它的大小和范围。 [http://www.cs.wustl.edu/~schmidt/ACE.html](http://www.cs.wustl.edu/~schmidt/ACE.html)

关于您对“快速”和提升的查询。这是一个主观术语，在不了解您的要求（吞吐量等）的情况下，很难为您回答这个问题。并不是说我自己对提升的东西有任何基准......

您可以使用一些消息传递层，但它们可能比 boost 慢。我想说您在 boost 中找到了一个很好的解决方案，但我只使用了 ACE 和其他专有的通信/消息传递产品。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-26T18:46:56.143

我的**猜测**是 boost 已经足够快了。我在以前的项目中使用它来将数据序列化到磁盘和从磁盘序列化，它的性能甚至从未成为问题。

我在这里的[回答](https://stackoverflow.com/questions/284885/multi-client-async-sockets-in-c-best-practices#285986)一般都是关于序列化的，除了你选择使用的序列化库之外，这可能对你有所帮助。

话虽如此，看起来您知道序列化（字节序字符串编码）的大部分主要问题点。您确实忽略了版本控制和向前/向后兼容性。如果时间不重要，我建议您编写自己的序列化代码。这是一次启发性的经历，你学到的教训是无价的。虽然我会警告你，但它会让你讨厌基于 XML 的协议的臃肿。:)

无论您选择哪种方式，都祝您项目顺利。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-28T14:43:38.553

另请查看[ONC-RPC（旧 SUN-RPC）](http://en.wikipedia.org/wiki/Open_Network_Computing_Remote_Procedure_Call)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-26T18:29:28.940

boost.serialization 不关心字符串编码或字节序。如果这对您很重要，那么您同样可以不使用它。

您可能想从 ZeroC 研究 ICE：[http ://www.zeroc.com/](http://www.zeroc.com/)

它的工作方式与 CORBA 类似，只是它完全由公司指定和定义。好处是实现按预期工作，因为没有那么多。不利的一面是，如果您使用的是他们不支持的语言，那么您就不走运了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-26T19:31:50.607

如果您只发送定义明确的数据结构，那么也许您应该将[ASN.1](http://en.wikipedia.org/wiki/ASN.1)视为一种编码方法？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-15T18:40:37.923

还有[Thrift](http://wiki.apache.org/incubator/ThriftProposal)，它看起来像一个 alpha 项目，但由 Facebook 使用和开发，因此它的用户很少。

或者好的旧[DCE](http://www.opengroup.org/dce/)，这是 MS 决定用于 COM 的标准。它现在是开源的，虽然晚了 20 年，但总比没有好。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-26T18:32:13.880

不要抢先优化。首先测量，然后优化。

# iphone - 在 iPhone 项目中加载数据文件

> ID：321622
> 
> 赞同：6
> 
> 时间：2008-11-26T18:10:02.067
> 
> 标签：iphone, cocoa-touch

如何在 iPhone 项目中读取数据文件？例如，假设我有一个名为“level.dat”的静态文件，其结构如下：障碍物：10 时间：100 障碍物1：10,20 ...

我想将文件的内容读入 NSString 然后进行解析。如何将文件的内容读入字符串？此外，“level.dat”文件应位于项目的哪个位置？它应该在“资源”下还是仅在主目录中？

提前致谢！

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-26T18:16:50.430

请参阅此答案：[如何在 iPhone 上使用 fopen()？](https://stackoverflow.com/questions/318341/how-to-fopen-on-the-iphone)它显示了如何访问捆绑包中的资源。获得路径后，只需使用 [NSString stringWithContentsOfFile:encoding:error:]。

```
NSString   *path = [[NSBundle mainBundle] pathForResource: @"level" ofType: @"dat"]
NSError    *error = nil;
NSString   *data = [NSString stringWithContentsOfFile: path 
                                             encoding: NSUTF8StringEncoding 
                                                error: &error]; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-27T14:34:16.887

虽然这不是您所要求的，但请考虑将您的文件转换为 plist。您必须将它们重新格式化为 XML，然后您可以将它们直接加载到 NSDictionary 中：

```
dict = [NSDictionary dictionaryWithContentsOfFile:[[NSBundle mainBundle] pathForResource:@"levels" ofType:@"plist"]]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-06T22:46:14.863

您是否考虑将数据放入 SQLite 数据库而不是平面文件？我发现该 API 在 iPhone 上非常易于使用。

这就是我现在在手机上存储所有数据的方式。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-27T11:30:49.423

如果您在解析数据字符串时需要帮助，请参阅[Cocoa For Scientist上的有用文章](http://www.macresearch.org/cocoa_for_scientists_part_xvii_representing_data_in_tables)

# php - 从 PHP 的生产站点获取错误的最佳方法是什么？

> ID：321629
> 
> 赞同：1
> 
> 时间：2008-11-26T18:11:29.943
> 
> 标签：php, error-handling, wddx

对于大多数生产站点，您想尽快知道何时出现错误。我的问题是如何最好地获取这些信息。

通常，最好在电子邮件中获取错误，因为我不会每天坐下来查看错误日志，直到出现错误——这是不可能的，因为我在不同的服务器上有 20 个或更多的生产站点。这些错误可能是任何东西，包括未设置的变量、收到的无效数据或查询错误。

目前我已经按照[PHPs 网站上的示例进行操作，在此处找到](http://ca.php.net/manual/en/errorfunc.examples.php)。因此，它会创建一个文本字符串以及一个 XML 文件，然后通过电子邮件发送该文件。我对此稍作修改，以保留所有错误，直到脚本结束，然后发送附有 XML 文件的电子邮件。（由于循环中的错误，我已经崩溃了几个发送超过 500 000 封电子邮件的邮件服务器。）大多数情况下，这可以完美运行。（我还创建了一个对象来完成所有的错误处理。）

当流程有大量数据时，就会出现问题`wddx_serialize_value()`。然后如果有多个错误，那么，它真的会使用大量内存，大多数时候超过脚本允许使用的内存。

因此，我`gzcompress()`在 XML 文件中添加了一个附加项，然后将其存储在变量中。这会有所帮助，但如果数据量非常大，它仍然会耗尽内存。（在最近的一个案例中，它想使用大约 2GB。）

我想知道还有哪些其他解决方案，或者您如何修改它以使其工作？

所以有几个要求：

*   它必须能够向我发送的不仅仅是错误消息，并且不应该让我登录服务器来弄清楚发生了什么（这样我就可以检查何时移动并确定它是否是紧急事件）
*   需要限制发送的电子邮件数量。最好的还是1。
*   它需要像往常一样记录到文件中

**编辑：**我需要与错误相关的其他信息，而不仅仅是错误字符串。通常我发现几乎不可能重现错误，因为它是由用户输入引起的，除非我获得更多信息，否则我不知道。我已尽最大努力输入信息错误，但您永远不知道用户将如何使用系统或他们将输入什么垃圾数据。因此，我需要的不仅仅是错误文本/字符串。

**编辑 2：**无法将错误记录到数据库，因为据我所知，数据库可能不存在。需要几乎可以保证运行的东西。此外，这些网站并非都在一台服务器上，而且我经常无法访问服务器上的 cron（愚蠢的托管公司）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T18:14:52.777

我没有设置自定义错误处理程序，而是像往常一样让错误进入错误日志。我设置了一个定期运行的 cron 并监视错误日志中的更改 - 如果它发生更改，它会向我发送一封仅包含更改的电子邮件。您可以改进此过程并解析更改以更好地满足您的需求 - 例如仅向您发送高于特定级别的错误（例如 E_WARNING 及以上）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T18:21:49.190

一种方法可能是在您的应用程序中进行适当的异常管理，即控制记录哪些错误。

每个引发的异常都会在数据库中记录错误详细信息。

然后，您可以编写一个小应用程序来搜索错误数据库，可能只为您的所有网站提供一个。

这样您就可以避免大型不可读的日志文件，因为所有内容都已编入索引并且可以快速搜索。当您的数据库变得太大时，您可以通过 cron 作业截断日志表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T22:56:53.487

Anacron，一个通过电子邮件将更改发送到错误日志*和错误日志文件的 cron 作业就足够了。cron 作业可以在发送电子邮件之前完成所有需要的处理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T23:14:27.867

我过去使用的一个东西是[epylog](https://fedorahosted.org/epylog/)，它是一个非常灵活的用 python 编写的日志监控应用程序。您可以将其设置为监控您的错误日志，并将错误（或部分错误）包含在通过电子邮件发送给您的日志摘要中。

我倾向于将更详细的错误数据存储在服务器上的平面文件中，并向您发送一封电子邮件，告诉您检查日志。监视错误目录或文件的更改并设置速率限制的 cron 作业将是减少对正在运行的应用程序的影响的好方法。

# c# - 如何在 C# 表达式树中设置字段值？

> ID：321650
> 
> 赞同：41
> 
> 时间：2008-11-26T18:15:34.803
> 
> 标签：c#, lambda, expression-trees

鉴于：

```
FieldInfo field = <some valid string field on type T>;
ParameterExpression targetExp = Expression.Parameter(typeof(T), "target");
ParameterExpression valueExp = Expression.Parameter(typeof(string), "value"); 
```

如何编译 lambda 表达式以将“target”参数上的字段设置为“value”？

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2008-11-26T18:29:14.713

**.Net 4.0**：现在有了`Expression.Assign`，这很容易做到：

```
FieldInfo field = typeof(T).GetField("fieldName");
ParameterExpression targetExp = Expression.Parameter(typeof(T), "target");
ParameterExpression valueExp = Expression.Parameter(typeof(string), "value");

// Expression.Property can be used here as well
MemberExpression fieldExp = Expression.Field(targetExp, field);
BinaryExpression assignExp = Expression.Assign(fieldExp, valueExp);

var setter = Expression.Lambda<Action<T, string>>
    (assignExp, targetExp, valueExp).Compile();

setter(subject, "new value"); 
```

**.Net 3.5**：你不能，你必须使用 System.Reflection.Emit 代替：

```
class Program
{
    class MyObject
    {
        public int MyField;
    }

    static Action<T,TValue> MakeSetter<T,TValue>(FieldInfo field)
    {
        DynamicMethod m = new DynamicMethod(
            "setter", typeof(void), new Type[] { typeof(T), typeof(TValue) }, typeof(Program));
        ILGenerator cg = m.GetILGenerator();

        // arg0.<field> = arg1
        cg.Emit(OpCodes.Ldarg_0);
        cg.Emit(OpCodes.Ldarg_1);
        cg.Emit(OpCodes.Stfld, field);
        cg.Emit(OpCodes.Ret);

        return (Action<T,TValue>) m.CreateDelegate(typeof(Action<T,TValue>));
    }

    static void Main()
    {
        FieldInfo f = typeof(MyObject).GetField("MyField");

        Action<MyObject,int> setter = MakeSetter<MyObject,int>(f);

        var obj = new MyObject();
        obj.MyField = 10;

        setter(obj, 42);

        Console.WriteLine(obj.MyField);
        Console.ReadLine();
    }
} 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-11-26T22:40:47.637

如前所述，设置字段是有问题的。您可以（在 3.5 中）使用单个方法，例如属性设置器 - 但只能是间接的。[正如这里](http://marcgravell.blogspot.com/2008/11/future-expressions.html)所讨论的，这在 4.0 中变得更加容易。但是，如果您实际上有属性（而不是字段），您可以简单地使用`Delegate.CreateDelegate`：

```
using System;
using System.Reflection;
public class Foo
{
    public int Bar { get; set; }
}
static class Program
{
    static void Main()
    {
        MethodInfo method = typeof(Foo).GetProperty("Bar").GetSetMethod();
        Action<Foo, int> setter = (Action<Foo, int>)
            Delegate.CreateDelegate(typeof(Action<Foo, int>), method);

        Foo foo = new Foo();
        setter(foo, 12);
        Console.WriteLine(foo.Bar);
    }
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-10-06T01:06:16.627

```
private static Action<object, object> CreateSetAccessor(FieldInfo field)
    {
        DynamicMethod setMethod = new DynamicMethod(field.Name, typeof(void), new[] { typeof(object), typeof(object) });
        ILGenerator generator = setMethod.GetILGenerator();
        LocalBuilder local = generator.DeclareLocal(field.DeclaringType);
        generator.Emit(OpCodes.Ldarg_0);
        if (field.DeclaringType.IsValueType)
        {
            generator.Emit(OpCodes.Unbox_Any, field.DeclaringType);
            generator.Emit(OpCodes.Stloc_0, local);
            generator.Emit(OpCodes.Ldloca_S, local);
        }
        else
        {
            generator.Emit(OpCodes.Castclass, field.DeclaringType);
            generator.Emit(OpCodes.Stloc_0, local);
            generator.Emit(OpCodes.Ldloc_0, local);
        }
        generator.Emit(OpCodes.Ldarg_1);
        if (field.FieldType.IsValueType)
        {
            generator.Emit(OpCodes.Unbox_Any, field.FieldType);
        }
        else
        {
            generator.Emit(OpCodes.Castclass, field.FieldType);
        }
        generator.Emit(OpCodes.Stfld, field);
        generator.Emit(OpCodes.Ret);
        return (Action<object, object>)setMethod.CreateDelegate(typeof(Action<object, object>));
    } 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-11-03T11:09:39.820

实际上，有一种方法可以在 .NET 3.5 中使用表达式树设置属性和字段。它可能是某些不支持的 PCL 配置文件的唯一选择`Delegate.CreateDelegate`（除了*Reflection.Emit*）：

*   对于字段，诀窍是将字段作为*ref*参数传递，
    例如`SetField(ref holder.Field, "NewValue");`

*   该属性（正如 Marc 已经指出的那样）可以通过反射和调用它的 setter 方法来设置。

下面作为 NUnit 测试夹具提供了完整的概念证明。

```
[TestFixture]
public class CanSetPropAndFieldWithExpressionTreeInNet35
{
    class Holder
    {
        public int Field;
        public string Prop { get; set; }
    }

    public static class FieldAndPropSetter
    {
        public static T SetField<T, TField>(T holder, ref TField field, TField value)
        {
            field = value;
            return holder;
        }

        public static T SetProp<T>(T holder, Action<T> setProp)
        {
            setProp(holder);
            return holder;
        }
    }

    [Test]
    public void Can_set_field_with_expression_tree_in_Net35()
    {
        // Shows how expression could look like:
        Func<Holder, Holder> setHolderField = h => FieldAndPropSetter.SetField(h, ref h.Field, 111);
        var holder = new Holder();
        holder = setHolderField(holder);
        Assert.AreEqual(111, holder.Field);

        var holderType = typeof(Holder);
        var field = holderType.GetField("Field");
        var fieldSetterMethod =
            typeof(FieldAndPropSetter).GetMethod("SetField")
            .MakeGenericMethod(holderType, field.FieldType);

        var holderParamExpr = Expression.Parameter(holderType, "h");
        var fieldAccessExpr = Expression.Field(holderParamExpr, field);

        // Result expression looks like: h => FieldAndPropSetter.SetField(h, ref h.Field, 222)
        var setHolderFieldExpr = Expression.Lambda<Func<Holder, Holder>>(
            Expression.Call(fieldSetterMethod, holderParamExpr, fieldAccessExpr, Expression.Constant(222)),
            holderParamExpr);

        var setHolderFieldGenerated = setHolderFieldExpr.Compile();
        holder = setHolderFieldGenerated(holder);
        Assert.AreEqual(222, holder.Field);
    }

    [Test]
    public void Can_set_property_with_expression_tree_in_Net35()
    {
        // Shows how expression could look like:
        Func<Holder, Holder> setHolderProp = h => FieldAndPropSetter.SetProp(h, _ => _.Prop = "ABC");
        var holder = new Holder();
        holder = setHolderProp(holder);
        Assert.AreEqual("ABC", holder.Prop);

        var holderType = typeof(Holder);
        var prop = holderType.GetProperty("Prop");
        var propSet = prop.GetSetMethod();

        var holderParamExpr = Expression.Parameter(holderType, "h");
        var callSetPropExpr = Expression.Call(holderParamExpr, propSet, Expression.Constant("XXX"));
        var setPropActionExpr = Expression.Lambda(callSetPropExpr, holderParamExpr);

        var propSetterMethod = typeof(FieldAndPropSetter).GetMethod("SetProp").MakeGenericMethod(holderType);

        // Result expression looks like: h => FieldAndPropSetter.SetProp(h, _ => _.Prop = "XXX")
        var setHolderPropExpr = Expression.Lambda<Func<Holder, Holder>>(
            Expression.Call(propSetterMethod, holderParamExpr, setPropActionExpr),
            holderParamExpr);

        var setHolderPropGenerated = setHolderPropExpr.Compile();
        holder = setHolderPropGenerated(holder);
        Assert.AreEqual("XXX", holder.Prop);
    }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-12-09T10:13:03.880

我曾经做过这门课。也许它有帮助：

```
public class GetterSetter<EntityType,propType>
{
    private readonly Func<EntityType, propType> getter;
    private readonly Action<EntityType, propType> setter;
    private readonly string propertyName;
    private readonly Expression<Func<EntityType, propType>> propertyNameExpression;

    public EntityType Entity { get; set; }

    public GetterSetter(EntityType entity, Expression<Func<EntityType, propType>> property_NameExpression)
    {
        Entity = entity;
        propertyName = GetPropertyName(property_NameExpression);
        propertyNameExpression = property_NameExpression;
        //Create Getter
        getter = propertyNameExpression.Compile();
        // Create Setter()
        MethodInfo method = typeof (EntityType).GetProperty(propertyName).GetSetMethod();
        setter = (Action<EntityType, propType>)
                 Delegate.CreateDelegate(typeof(Action<EntityType, propType>), method);
    }

    public propType Value
    {
        get
        {
            return getter(Entity);
        }
        set
        {
            setter(Entity, value);
        }
    }

    protected string GetPropertyName(LambdaExpression _propertyNameExpression)
    {
        var lambda = _propertyNameExpression as LambdaExpression;
        MemberExpression memberExpression;
        if (lambda.Body is UnaryExpression)
        {
            var unaryExpression = lambda.Body as UnaryExpression;
            memberExpression = unaryExpression.Operand as MemberExpression;
        }
        else
        {
            memberExpression = lambda.Body as MemberExpression;
        }
        var propertyInfo = memberExpression.Member as PropertyInfo;
        return propertyInfo.Name;
    } 
```

测试：

```
var gs = new GetterSetter<OnOffElement,bool>(new OnOffElement(), item => item.IsOn);
        gs.Value = true;
        var result = gs.Value; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-03-06T19:31:45.220

为了完整起见，这里是吸气剂：

```
 public static IEnumerable<Func<T, object>> GetTypeGetters<T>()
    {
        var fields = typeof (T).GetFields();

        foreach (var field in fields)
        {
            ParameterExpression targetExp = Expression.Parameter(typeof(T), "target");
            UnaryExpression boxedFieldExp = Expression.Convert(Expression.Field(targetExp, field), typeof(object));
            yield return  Expression.Lambda<Func<T,object>>(boxedFieldExp, targetExp).Compile();
        }
    } 
```

# php - PHP 中每个错误级别包含的内容

> ID：321652
> 
> 赞同：2
> 
> 时间：2008-11-26T18:15:49.060
> 
> 标签：php, error-handling

我基本上想知道每个错误级别中包含什么，[就像](http://ca3.php.net/manual/en/errorfunc.constants.php)在 PHP 中找到的那样。例如，未设置的变量或键落在哪里？或者解析落在哪里？我似乎无法在 PHP 网站或一般互联网上找到与此相关的任何文档。

**编辑：**我正在寻找什么错误导致什么错误级别/类型或其他方式的列表。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T18:28:50.440

对于每种特定情况，手册都会说明会引发哪种类型的错误。例如，如果您查看[变量部分](http://www.php.net/manual/en/language.variables.php)，您会看到未设置的变量将引发 E_NOTICE 错误。其他语言结构、函数定义、扩展等也是如此。只需检查手册。

# qt - 当 Qt 小部件获得焦点时获取通知/事件/信号

> ID：321656
> 
> 赞同：33
> 
> 时间：2008-11-26T18:16:52.757
> 
> 标签：qt, focus

在 Qt 中，当一个小部件获得焦点时，如何获得有关它的通知，以便我可以执行一些自定义代码？是否有信号或事件？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2010-01-02T03:01:04.617

您可以添加 en `event filter`。**这是使用QtCreator**
编写的应用程序示例。此表单有一个名为***combobox*****的QComboBox**。

 *****```
 MainWindow::MainWindow(QWidget *parent) :
QMainWindow(parent),ui(new Ui::MainWindow)
{
    ui->setupUi(this);
    ui->comboBox->installEventFilter(this);
    .
    .
    .
}

bool MainWindow::eventFilter(QObject *object, QEvent *event)
{
    if (event->type() == QEvent::FocusOut)
    {
        if (object == ui->comboBox)
        {
            qWarning(object->objectName().toLatin1().data());
        }
    }
    return false;
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-26T18:25:05.190

当焦点改变时会发送一个“focusChanged”信号，在 Qt 4.1 中引入。
它有两个参数，一个小部件失去焦点，一个获得焦点：

```
void QApplication::focusChanged(QWidget * old, QWidget * now) 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-27T18:36:13.200

Qt Designer isn't designed for this level of WYSIWYG programming.

Do it in C++:

```
class LineEdit : public QLineEdit
{
    virtual void focusInEvent( QFocusEvent* )
    {}
}; 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-02T14:43:54.120

最简单的方法是将插槽连接到 QApplication::focusChanged 信号。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-26T18:30:06.600

我不得不玩它，但只要看看 QT 文档，就有一个“focusInEvent”。这是一个事件处理程序。

以下是您如何查找有关...的信息。打开“QT 助手”。转到索引。放入“QLineEdit”。在所有小部件页面上都有一个非常有用的链接，称为“所有成员列表，包括继承的成员”。这个列表很棒，因为它甚至有继承的东西。

我快速搜索了“Focus”，并找到了与此 Widget 的焦点相关的所有内容。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-28T21:10:51.130

您在 QT 中遇到了奇怪的拆分，如果您查看文档`focusInEvent`不是插槽，它是受保护的函数，如果您正在实现小部件的子类，则可以覆盖它。如果您只想捕获进入小部件的事件，您可以使用[`QObject::installEventFilter`](http://doc.trolltech.com/4.2/qobject.html#installEventFilter)它来捕获任何类型的事件。

出于某种奇怪的原因，奇趣科技的开发人员决定通过两种途径传播 UI 事件，信号/插槽和`QEvent`

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-02-24T11:17:20.977

以防万一有人在寻找两个 QMainWindow 焦点更改。您可以使用

```
if(e->type() == QEvent::WindowActivate)
{
    //qDebug() << "Focus IN " << obj << e ;

} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-27T01:19:10.923

QWidget::setFocus() 是插槽，而不是信号。[您可以使用focus 属性](http://doc.trolltech.com/4.4/qwidget.html#focus-prop)检查 QLineEdit 是否处于焦点。QLineEdit 在更改或编辑文本时发出信号，请参阅文档。

# python - Python 映像库的应用程序配置不正确

> ID：321668
> 
> 赞同：4
> 
> 时间：2008-11-26T18:21:07.273
> 
> 标签：python, image-processing

我正在尝试为 Python 2.6 安装 Python Imaging Library 1.1.6。下载安装可执行文件 (Win XP) 后，我收到以下错误消息：

“应用程序无法启动，因为应用程序配置不正确。重新安装应用程序可能会解决此问题”

对我做了什么/没做什么有什么想法吗？该应用程序尚未安装，我无法通过 IDLE 会话导入模块。想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-28T08:22:03.063

它看起来像一个 SxS（“并排”）问题。可能缺少 PIL 链接的运行时库。尝试安装用于构建 PIL 的编译器的可再发行包。

[MSVC 2005 重新分发](http://www.microsoft.com/downloads/details.aspx?familyid=200B2FD9-AE1A-4A14-984D-389C36F85647&displaylang=en)

[MSVC 2008 重新分发](http://www.microsoft.com/downloads/details.aspx?familyid=D5692CE4-ADAD-4000-ABFE-64628A267EF0&displaylang=en)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-27T07:06:26.353

“为所有用户”安装 Python，而不是“只为我”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T14:34:10.220

我最近收到了与 wxPython 库有关的相同消息。这是因为 wxPython 是使用比我的 PC 更高版本的 Visual C++ 构建的。正如 atzz 所建议的，一种解决方案是安装适当的可再发行包。尝试在 Google 上搜索“Microsoft Visual C++ 2008 Redistributable Package”并进行下载。如果这不起作用，请重复 2005 版本。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-26T18:34:08.307

我在黑暗中拍摄：会是[这样](http://effbot.org/zone/python-register.htm)吗？

# asp.net - 如何在 IE6 的编辑模式下使 DetailsView CheckBoxField 可见？

> ID：321674
> 
> 赞同：2
> 
> 时间：2008-11-26T18:22:46.440
> 
> 标签：asp.net, internet-explorer-6, detailsview

```
<%-- In IE6, in edit mode, the checkbox isn't visible --%>
<asp:DetailsView ID="MyDetailsView" runat="server" Height="50px" Width="100%"
        AutoGenerateRows="False" SkinID="detailsViewSkin" DataKeyNames="SerialNumber"
        DataSourceID="DetailsObjectDataSource">
   <asp:CheckBoxField DataField="Active" HeaderText="Active" SortExpression="Active" />
</asp:DetailsView> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-01T22:14:34.883

唯一真正突出的是您在网格视图中缺少**字段**标签。除此之外，没有什么不寻常的——而且我一直在使用 DetailsViews，在 IE6 中没有什么大问题。

```
<%-- In IE6, in edit mode, the checkbox isn't visible --%>
<asp:DetailsView ID="MyDetailsView" runat="server" Height="50px" Width="100%" AutoGenerateRows="False" SkinID="detailsViewSkin" DataKeyNames="SerialNumber" DataSourceID="DetailsObjectDataSource">
   <Fields>
      <asp:CheckBoxField DataField="Active" HeaderText="Active" SortExpression="Active" />
   </Fields>
</asp:DetailsView> 
```

我只是再次需要这个，所以在 IE6 中重新测试，我的 CheckBoxFields 工作正常。我想知道 CSS 或您的皮肤文件中是否存在干扰 IE6 的内容。

# asp.net - 使用 ASP.NET、JQuery 和 Suckerfish 构建数据库驱动的菜单

> ID：321680
> 
> 赞同：0
> 
> 时间：2008-11-26T18:26:37.777
> 
> 标签：asp.net, jquery, recursion, menu

我正在尝试使用 Suckerfish css 菜单和 Jquery 从表中创建菜单。我使用这个作为我的参考：[Suckerfish menu with ASP.NET and JQuery](http://www.aspcode.net/Suckerfish-menu-with-ASPNET-and-JQuery.aspx)，我让它使用手动提供的链接（很像文章中的）。

我遇到问题的地方是编写递归函数以从数据库中获取菜单项并在适当的层次结构中创建新的菜单项。我的数据库表如下所示：

表菜单

* * *

MenuID ParentID 链接文本

这个想法是，如果一个项目是父级项目，则 MenuID 和 ParentID 是相同的，如果它是一个孩子，它将在 ParentID 字段中具有它的父级的 MenuID。我需要创建一个函数，可以通过并找到父母的所有孩子（可能是几个级别），并让它替换像这样的手动输入：

```
 Dim Foo As New MenuItem("#", "Foo", Me)
        Items.Add(Foo)
        Foo.Items.Add(New MenuItem("#", "1", Me))
        Foo.Items.Add(New MenuItem("#", "2", Me))
        Foo.Items.Add(New MenuItem("#", "3", Me))
        Foo.Items.Add(New MenuItem("#", "4", Me)) 
```

如有必要，我愿意更改数据库表结构，并且基本上会做任何其他事情来实现这一点。

感谢您的任何意见，非常感谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T19:00:48.347

这种表示分层数据的方法对人类来说很容易理解，但很难从中提取数据，因为它需要递归来提取完整​​的层次结构。某些 SQL 风格的命令可以为您执行此操作，但这就是幕后发生的事情。

我建议您阅读[SQL 中的 More Trees & Hierarchies](http://www.sqlteam.com/article/more-trees-hierarchies-in-sql)，并使用它解释的物化路径方法重构您的模式。它很容易查询并且可以很好地扩展。

# java - 按时间间隔休眠组

> ID：321687
> 
> 赞同：6
> 
> 时间：2008-11-26T18:29:25.617
> 
> 标签：java, mysql, hibernate, group-by

我有一个带有日期时间类型的时间戳字段的表。我需要将定义的开始时间和结束时间之间的数据聚合到代表等长时间间隔的 x 组中，其中 x 作为函数参数提供。

使用 Hibernate 执行此操作的最佳方法是什么？

编辑：一些解释

mysql表：

```
data_ts: datetime pk
value1 : int
value2 : bigint
... 
```

实体类：

```
Calendar dataTs;
Integer value1;
BigDecimal value2;
... 
```

我正在寻找执行类似操作的 HQL 查询

```
select max(c.value1), avg(c.value2) from MyClass c 
  where c.dataTs between :start and :end group by <interval> 
```

其中整个时间段被分成 x 个大小相等的时间间隔。

例子：

```
Start : 2008-10-01 00:00:00   
End   : 2008-10-03 00:00:00 (2 days)
Groups: 32 
```

需要按 1.5 小时（48 小时/32 小时）的时间间隔进行分组：

```
2008-10-01 00:00:00 - 2008-10-01 01:29:59
2008-10-01 01:30:00 - 2008-10-01 02:59:59
2008-10-01 02:00:00 - 2008-10-01 04:29:59
... 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-26T21:49:06.463

我试图解决同样的问题。我必须在一天内按 2 小时的间隔对数据进行分组。事实上，“纯”Hibernate 不应该以这种方式使用。所以我将原生 SQL 投影添加到 Hibernate 的标准中。对于您的情况，它可能看起来像这样（我使用的是 MySQL 语法和函数）：

```
int hours = 2; // 2-hours interval

Criteria criteria = session.createCriteria( MyClass.class )
            .add( Restrictions.ge( "dataTs", start ) )
            .add( Restrictions.le( "dataTs", end ) );

ProjectionList projList = Projections.projectionList();
        projList.add( Projections.max( "value1" ) );
        projList.add( Projections.avg( "value2" ) );
        projList.add( Projections.sqlGroupProjection(
            String.format( "DATE_ADD( DATE( %s_.dataTs ), INTERVAL( HOUR( %s_.dataTs ) - HOUR( %s_.dataTs) %% %d ) HOUR) as hourly", criteria.getAlias(), criteria.getAlias(), criteria.getAlias(), hours ),
            String.format( "DATE_ADD( DATE( %s_.dataTs ), INTERVAL( HOUR( %s_.dataTs) - HOUR( %s_.dataTs ) %% %d ) HOUR)", criteria.getAlias(), criteria.getAlias(), criteria.getAlias(), hours ),
            new String[]{ "hourly" },
            new Type[]{ Hibernate.TIMESTAMP } )
        );
        criteria.setProjection( projList );

List results = criteria
            .setCacheable( false )
            .list(); 
```

代码看起来有点难看，但它解决了问题。希望总体思路对您有所帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T18:38:18.330

Hibernate 用于对象图（实体和值类型）与其在关系数据库中的表示之间的映射。

从您的问题描述中，您并没有真正提及您正在建模的任何实体，因此我建议您进入原生 SQL 查询。

[http://www.hibernate.org/hib_docs/reference/en/html/querysql.html](http://www.hibernate.org/hib_docs/reference/en/html/querysql.html)

也许如果您发布了表格结构，这可能会为您的问题提供更多背景信息？

# wpf - WPF 样式触发器

> ID：321701
> 
> 赞同：3
> 
> 时间：2008-11-26T18:33:51.350
> 
> 标签：wpf, triggers, styles

我在 Style 触发器中更改了 Text 的 FontSize，这会导致包含文本的 Control 也调整大小。如何在不影响父级大小的情况下更改字体大小？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-04T20:22:08.537

明智地将元素与其父布局隔离的一个好技巧是将元素放置在 Canvas 中

在下面的标记中，您的元素有两个副本 第一个是隐藏的并确定控件的大小 第二个是可见的，但包裹在 Canvas 中，因此其布局大小不会影响父级。

```
<Parent>
  <Grid>
    <Element Visibility="Hidden"/>
    <Canvas>
      <Element />
    </Canvas>
  <Grid>
</Parent> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-02-09T02:04:58.953

绝对不需要硬编码的宽度、疯狂的度量覆盖、棘手的绑定或任何类似的东西。

解决方案实际上非常简单。不要在样式触发器中更改字体大小，而是为您的按钮创建一个简单的控件模板，并将 RenderTransform 应用于内容呈现器元素。将 ScaleTransform 添加到 RenderTransform。在 IsPressed 触发器定义中，将 ScaleTransform 上的垂直和水平比例设置为较小的比率，例如 0.8。

使用 RenderTransform 将保持按下按钮的布局相同，因此不会影响其他元素的位置。相比之下，使用 LayoutTransform 实际上会导致按钮容器缩小，而父容器的 ArrangeOverride 方法会导致相邻按钮移动以填充额外空间。

我现在真的很忙，所以我将把实际的实施留给你！;-)

[http://msdn.microsoft.com/en-us/library/system.windows.media.scaletransform.aspx](http://msdn.microsoft.com/en-us/library/system.windows.media.scaletransform.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-10T20:51:43.233

您可以在减小 FontSize 的同时增加 Padding - 这将导致 Button 的计算高度保持不变：

```
<StackPanel>
    <Button Content="ABC">
        <Button.Style>
            <Style TargetType="{x:Type Button}">
                <Setter Property="FontSize" Value="20"/>
                <Style.Triggers>
                    <Trigger Property="IsPressed" Value="True">
                        <Setter Property="FontSize" Value="12"/>
                        <Setter Property="Padding" Value="5"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
        </Button.Style>
    </Button>
    <Button Margin="0,20" Content="123" FontSize="20"/>
    <Button Content="Do Re Mi" FontSize="20"/>
</StackPanel> 
```

如果 FontSize 也在增加，您也可以反过来设置负填充。

您还可以使用从 FontSize 到 Padding 的绑定以一般方式完成相同的事情，但如果您只处理一组固定的 FontSizes，那么像上面那样对它进行硬编码会更容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T14:18:07.963

我正在为 ButtonControl 创建一个 ControlTemplate，因此它看起来像一个带有 IsKeyboardFocused、IsPressed、IsDefaulted 等触发器的标签（平面文本，无边框）。

IsPressed 被定义为将 FontSize（从默认值 30）降低到 28。以提供按下的动画效果。

这些 Button 的一种用途是 Button 的水平 StackPanel，由垂直分隔符分隔。当 IsPressed 触发器在按钮上触发并调整大小时，整行按钮都会重新调整，这不是令人愉悦的视觉效果。

我的偏好是基于模板的解决方案，以避免引入新控件以提供覆盖。硬编码大小方法的唯一问题是国际化，其他语言会增加原始大小。

我要使用的解决方案是在计算完按钮的 DesiredSize 后在 C# 中设置 minWidth。请注意，即使在呈现 Button 之后，宽度也是 NaN，因此 DesiredSize 的使用/存在。稍后我将尝试对 C# 进行 XAML 化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T18:36:17.117

你使用什么样的控件？如果这是像 GroupBox 或 TabItem 这样的 HeaderedControl，那么您需要专门设置 HeaderTemplate，如下所示：

```
<DataTemplate x:Key="MyHeaderTemplate">
  <TextBlock Text="{Binding}" Fontsize="14" FontWeight="Bold" />
</DataTemplate> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T19:42:40.243

我可以想到一些你可以尝试的事情：

*   **您可以覆盖控件的 Measure Pass** - 在 WPF 中呈现控件时，它会经历两次传递。第一个是“测量通过”，控件提出它*想要的*尺寸。第二个是“安排通行证”，它实际上布置了控制。WPF 提供了一种称为[MeasureOverride 的方法。](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.measureoverride.aspx)如果您重写此方法，您可以提供可用于调整控件大小的自定义行为。

    *注意*- 我相信您必须在此覆盖期间调用所有控件子项的 Measure 方法，以使您的控件正确布局。

*   **硬编码控件上的高度和宽度**- 这将使用您的值覆盖控件的 DesiredSize。虽然通常不是最好的想法，但它会起作用。

# c# - 使用服务器端动态创建的 TableRow 的“onclick”

> ID：321714
> 
> 赞同：3
> 
> 时间：2008-11-26T18:39:10.607
> 
> 标签：c#, asp.net, controls

我正在动态创建一个我想要具有可点击行的表。当用户单击其中一行时，我想重定向到特定于该行项目的页面。我的问题是如何在服务器端将“onclick”事件连接到一个例程，然后允许我根据他们单击的行中包含的一些数据构建一个 url？

例如，我想在点击时执行此操作：

`Response.Redirect("SomePage.aspx?" itemType + "&" + COLUMN1VALUE)`;

其中 COLUMN1VALUE 将是单击的行中的第一列。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T19:12:45.297

听起来您的实际目标只是在另一页上显示/编辑该行。如果是这种情况，您可以在创建表格行时简单地添加一个 javascript 事件处理程序。

```
<tr onclick="window.location='DetailPage.aspx?id=<%= IdFromDb %>'">
    <!-- etc......-->
</tr> 
```

如果您使用 GridView 创建表，您可以在 RowDataBound 事件中注入它：

```
protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)

{

    string OnClickCmd = "window.location='DetailPage.aspx?id=";

    if (e.Row.RowType == DataControlRowType.DataRow)

    {

        OnClickCmd += DataBinder.Eval(e.Row.DataItem, "IdFromDb").ToString() + "'";

        e.Row.Attributes.Add("onclick", OnClickCmd);

    }
} 
```

除非您需要在回发中做某事，否则无需重定向。此外，您可以在创建行时创建一个超链接，从而消除对 javascript 的需求，您不需要完整的行点击体验。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T18:43:48.507

我会将表中的链接构建为 SomePage.aspx 的实际锚标记（在构建表时，您应该知道每个表行的查询字符串是什么），而不是重定向的服务器端控件在回发

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T18:45:51.123

在您的单击事件处理程序中，您将发送方转换为按钮，然后获取其父项，直到您到达 TableRow，然后执行 FindControl() 以查找具有特定于该行的值的控件并使用它来构建您的 URL！

祝你好运！

# c# - 将选项卡强制到扩展的 .net 控件中的下一个控件

> ID：321719
> 
> 赞同：6
> 
> 时间：2008-11-26T18:43:52.593
> 
> 标签：c#, .net, winforms, events, controls

假设我在 .net 中扩展了一个名为 CustomTextBox 的文本框。在某些情况下，我想强制一个选项卡到表单上的下一个 TabIndex。除了获取 CustomTextBox 的父级中包含的所有控件，按它们的 TabIndex 对它们进行排序，然后关注下一个序数之外，有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-26T18:54:03.260

我认为您正在寻找类似以下方法的方法：

```
form1.SelectNextControl(textBox1, true, true, true, true); 
```

（所有正确的只是不同的选择，阅读智能感知！）

您确实说过它是 WinForms 而不是 WebForms 对吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T18:54:38.873

如果要扩展普通的 Winforms 文本框，则可以根据需要将**AcceptsTab**属性设置为 True 或 False。如果为真，则制表符将插入到您的文本框中。如果为 false，则按 Tab 键会将焦点移动到 Tab 顺序中的下一个控件

# version-control - 版本控制注释的最佳实践

> ID：321720
> 
> 赞同：20
> 
> 时间：2008-11-26T18:44:00.923
> 
> 标签：version-control, comments

有很多关于评论代码的讨论，但是评论签入怎么样？

我发现这篇博文： [http ://redbitbluebit.com/subversion-check-in-comment-great-practices/](http://redbitbluebit.com/subversion-check-in-comment-great-practices/)

作为整理发行说明的人，我正在寻找使这项工作更容易的方法。

`<Begin_Doc>...<End_Doc>`目前，我们为应该发布给我们的软件客户的任何内容定义了自己的方案。但即使是内部的东西，我也想知道每次更改的“原因”。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-26T18:46:52.883

每个功能都有一个工单/问题/错误报告/任务/无论你叫什么，工单号总是在签入注释中引用。这给出了上下文。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-26T18:51:19.880

我建议不要为此使用/重载您的版本控制系统。我建议问题跟踪软件更合适。

一方面，让开发人员在已经在需求文档或问题/缺陷系统中的提交消息中添加所有上下文和重复信息似乎是不合适的。

您可以使用工具来收集提交评论中的相关修复/问题编号，然后从您的其他存储库中收集这些，但我认为基本上使您的修订工具成为面向外部的东西是错误的。

您需要定义源/版本存储库/SVN 是什么 - 是用于管理源文件，还是用于编写发行说明。我认为它不应该超载。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-26T20:36:51.600

我们尽量保持简单：*写一句话来描述您正在进行的更改。*如果开发人员需要两个或更多句子来描述提交，那么提交可能是两个不相关的工作。当这样的提交最终进入版本控制时，很难单独恢复修复。

我们喜欢在提交评论中包含的另一条信息是提交修复/实现的*缺陷/功能编号。*并非我们所做的所有工作都与我们的问题跟踪系统中的缺陷有关，因此这不是强制性的。

我们在提交注释中添加的最后一条信息是*一位代码审阅者的姓名*。这是在提交发生之前对更改进行完整性检查的人。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-26T20:35:43.177

我推荐功能性评论。评论应概述更改的内容。如果有什么改变了，为什么。每个提交都应该是可解释的，如果你不能清楚地解释它，你可能不应该检查它。

使用源代码控制日志时要记住的最重要的事情是它们可以确定何时更改以及更改了什么。功能越多，越详细越好。提交应该以一口大小的形式进行，可以用一口大小的注释来解释。

我个人的喜好是这样的风格：

更新了错误记录系统。

1.  添加了使用正则表达式的遗留错误解析例程来获取遗留错误代码。
2.  更改了数据库错误消息中的文本，以纠正拼写错误。
3.  删除了注释掉的代码部分，因为它们不再被使用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-26T18:52:17.740

关键是你要对评论做什么。如果您正在创建发行说明，那么您可以按照您的建议进行操作。但是，我建议您在其他地方跟踪发布说明，例如在项目管理或错误跟踪工具中。

至于开发者相关的评论，我们一般会要求人们解释他们在做什么，一句话解释。它不需要太正式，主要是因为如果它是人们会反对它。另外，如果你知道是谁做的，并且你有一个快速的评论，你通常可以追溯问题并找到这个人。

同样，如果您使用[FogBugz 之](http://www.fogbugz.com)类的工具，您可以将 SVN 签入链接到案例编号。这意味着您可以查看案例以获取完整的讨论、评论、屏幕截图等。这比您在签入评论中输入的信息要多得多。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-26T18:54:35.410

同意 Remembrance，但您还应该写一些关于您为什么以您的方式实施更改/错误修复的内容。如果您相信经常签到，您还应该包括待办事项，以使您的一位同事能够完成任务。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-26T20:36:13.520

使我的更改很小有帮助：我可以通过这种方式提供我的更改的详细描述。

签入注释应该是开发人员想要的信息：这包括重构、代码背后的动机等。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-03T20:57:25.613

在我们的项目中，我们总是提倡提供一些关于提交的细节，并帮助避免重复信息，例如我们使用 Trac 和集成我们的存储库的问题。优点是您可以在评论中引用问题单，并仅说明已执行的解决方案或工作步骤。然后，Trac 会自动将参考编号链接到原始问题编号，并将您的提交消息作为对问题的评论应用。然后，当您想查看已完成的操作时，您可以简单地阅读 Trac 中的问题并了解完整的上下文。

关于发布说明，我们发现在发布中获取问题列表并使用提交信息作为评论的基础效果很好。通常，您不会有包含原始提交消息的发行说明，因为您的客户并不真正关心每一个微小的变化，甚至不关心评论中可能包含的详细程度。因此，您通常需要进行大量编辑以突出显示该版本中实现的主要更改和错误修复。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-26T18:53:54.537

我会说尝试遵循变更日志样式。第一行应该是一个简短的摘要，并包括问题/票号（如果有）。根据您的 VCS 如何处理多行提交消息，这可能后跟一个空行，然后是更完整的多行描述。我会说强加任何严格的格式是不合理的，因为它会阻止频繁提交，但只要以这种方式完成重要的提交（那些关闭问题或重大更改）你应该没问题。

如果您使用 Trac 或 roundup + svn 集成之类的东西，它可以从提交消息中挑选出问题编号。我总是把这些放在第一行，因为它们非常有用。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2008-11-26T20:22:35.780

**编辑：鉴于这是迄今为止我最不赞成的答案，我认为值得强调最后一段中隐藏的内容：我是独资经营者。我对这些项目拥有 100% 的所有权，并且不与其他开发人员合作。在拥有多个开发人员的商店中，我在此答案中所说的一切可能完全不合适。**

我在这里订阅 DRY，就像在所有事情上一样。

我几乎从不为我的提交添加评论。评论几乎总是在重复我自己。“这次提交发生了什么变化”这个问题的答案？几乎总是在差异中。

当我查看一个文件并问“这里到底发生了什么？”时，我做的第一件事就是查看与前一个版本的差异。90% 的情况下，答案是立即显而易见的，要么是因为代码不言自明，要么是因为我在代码中注释了一些不言自明的东西。如果不是，我将文件的修订日期与错误跟踪系统相关联，答案就在那里。

这总是有效的。有时需要进行一些调查才能弄清楚，因为我没有充分评论我的代码。但我从来没有很快找到答案。

我在提交日志中添加评论的唯一一次是当我知道差异对我没有帮助时。例如，当我对一个类的成员进行排序时：在这种情况下，差异唯一会告诉我的是发生了非常大的事情。当我这样做时，我会在修复它后立即提交文件。没有合适的地方来评论文件中该范围的更改，因此我添加了一条注释，大意是此 rev 中的唯一更改是重新排序成员。

（“你为什么不在文件顶部的修订历史中评论这样的更改？”你可能会问。我没有在我的文件顶部保留修订历史。那是一个可怕的，打破 -一生的习惯改变，我从来没有后悔过。修订历史是颠覆。）

如果我没有 100% 的项目所有权，情况可能会有所不同。将提交与错误修复关联起来可能太难了。培训其他开发人员编写代码以使其能够有效地依赖版本控制可能太难了。我得看看。

# java - 如何在图像中设置 DPI 信息？

> ID：321736
> 
> 赞同：31
> 
> 时间：2008-11-26T18:49:00.757
> 
> 标签：java, image

我有一个应用程序，我想导出高分辨率（或者更确切地说，高像素密度？）图像进行打印 - 例如，我想要以每英寸 250 点 (DPI) 打印的图像，而不是默认值，我理解为 72 DPI。

我使用带有 Graphics2D 对象的 BufferedImage 来绘制图像，然后使用 ImageIO.write() 来保存图像。

知道如何设置 DPI 吗？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2011-01-28T22:31:58.940

库尔特的回答显示了方法，我仍然花了很长时间才让它运行，所以这里是保存 PNG 时设置 DPI 的代码。有很多事情要做才能找到合适的作家等等......

```
 private BufferedImage gridImage;
 ...

 private void saveGridImage(File output) throws IOException {
    output.delete();

    final String formatName = "png";

    for (Iterator<ImageWriter> iw = ImageIO.getImageWritersByFormatName(formatName); iw.hasNext();) {
       ImageWriter writer = iw.next();
       ImageWriteParam writeParam = writer.getDefaultWriteParam();
       ImageTypeSpecifier typeSpecifier = ImageTypeSpecifier.createFromBufferedImageType(BufferedImage.TYPE_INT_RGB);
       IIOMetadata metadata = writer.getDefaultImageMetadata(typeSpecifier, writeParam);
       if (metadata.isReadOnly() || !metadata.isStandardMetadataFormatSupported()) {
          continue;
       }

       setDPI(metadata);

       final ImageOutputStream stream = ImageIO.createImageOutputStream(output);
       try {
          writer.setOutput(stream);
          writer.write(metadata, new IIOImage(gridImage, null, metadata), writeParam);
       } finally {
          stream.close();
       }
       break;
    }
 }

 private void setDPI(IIOMetadata metadata) throws IIOInvalidTreeException {

    // for PMG, it's dots per millimeter
    double dotsPerMilli = 1.0 * DPI / 10 / INCH_2_CM;

    IIOMetadataNode horiz = new IIOMetadataNode("HorizontalPixelSize");
    horiz.setAttribute("value", Double.toString(dotsPerMilli));

    IIOMetadataNode vert = new IIOMetadataNode("VerticalPixelSize");
    vert.setAttribute("value", Double.toString(dotsPerMilli));

    IIOMetadataNode dim = new IIOMetadataNode("Dimension");
    dim.appendChild(horiz);
    dim.appendChild(vert);

    IIOMetadataNode root = new IIOMetadataNode("javax_imageio_1.0");
    root.appendChild(dim);

    metadata.mergeTree("javax_imageio_1.0", root);
 } 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2017-03-27T10:32:09.493

# 设置 TIFF DPI

如果您想为 TIFF 设置 dpi，请尝试通过以下步骤执行此操作：

```
private static IIOMetadata createMetadata(ImageWriter writer, ImageWriteParam writerParams, int resolution) throws
                                                                                                            IIOInvalidTreeException
{
    // Get default metadata from writer
    ImageTypeSpecifier type = ImageTypeSpecifier.createFromBufferedImageType(BufferedImage.TYPE_BYTE_GRAY);
    IIOMetadata meta = writer.getDefaultImageMetadata(type, writerParams);

    // Convert default metadata to TIFF metadata
    TIFFDirectory dir = TIFFDirectory.createFromMetadata(meta);

    // Get {X,Y} resolution tags
    BaselineTIFFTagSet base = BaselineTIFFTagSet.getInstance();
    TIFFTag tagXRes = base.getTag(BaselineTIFFTagSet.TAG_X_RESOLUTION);
    TIFFTag tagYRes = base.getTag(BaselineTIFFTagSet.TAG_Y_RESOLUTION);

    // Create {X,Y} resolution fields
    TIFFField fieldXRes = new TIFFField(tagXRes, TIFFTag.TIFF_RATIONAL, 1, new long[][] { { resolution, 1 } });
    TIFFField fieldYRes = new TIFFField(tagYRes, TIFFTag.TIFF_RATIONAL, 1, new long[][] { { resolution, 1 } });

    // Add {X,Y} resolution fields to TIFFDirectory
    dir.addTIFFField(fieldXRes);
    dir.addTIFFField(fieldYRes);

    // Add unit field to TIFFDirectory (change to RESOLUTION_UNIT_CENTIMETER if necessary)
    dir.addTIFFField(new TIFFField(base.getTag(BaselineTIFFTagSet.TAG_RESOLUTION_UNIT), BaselineTIFFTagSet.RESOLUTION_UNIT_INCH));

    // Return TIFF metadata so it can be picked up by the IIOImage
    return dir.getAsMetadata();
} 
```

此外，您可以通过类似的方式设置任何 TIFF 标签。

在[源代码中阅读更多信息](http://www.jochenhebbrecht.be/site/2012-11-25/java/creating-a-tif-file-a-resolution-x-ppi-a-pdfbox-pdpage)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-03-08T13:08:16.660

我在我的项目中将此代码用于 tiff 文件，它运行良好..

```
import java.awt.image.BufferedImage;
import java.awt.image.RenderedImage;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.util.ArrayList;
import java.util.List;
import javax.imageio.ImageIO;
import javax.media.jai.NullOpImage;
import javax.media.jai.OpImage;
import javax.media.jai.PlanarImage;
import com.sun.media.jai.codec.FileSeekableStream;
import com.sun.media.jai.codec.ImageCodec;
import com.sun.media.jai.codec.ImageDecoder;
import com.sun.media.jai.codec.ImageEncoder;
import com.sun.media.jai.codec.SeekableStream;
import com.sun.media.jai.codec.TIFFEncodeParam;
import com.sun.media.jai.codec.TIFFField;
class SetDDPI
 {
static void tiff_Maker(List<BufferedImage> output, String result) throws   IOException
{
    TIFFEncodeParam params = new TIFFEncodeParam();
    OutputStream out = new FileOutputStream(result);
    List<BufferedImage> imageList = new ArrayList<BufferedImage>();
    for (int i = 1; i < output.size(); i++)
    {
        imageList.add(output.get(i));
    }
    params.setWriteTiled(true);
    params.setCompression(TIFFEncodeParam.COMPRESSION_GROUP4);
    params.setExtraImages(imageList.iterator());
    TIFFField[] extras = new TIFFField[2];
    extras[0] = new TIFFField(282, TIFFField.TIFF_RATIONAL, 1, (Object) new long[][] { { (long) 300, (long) 1 },
            { (long) 0, (long) 0 } });
    extras[1] = new TIFFField(283, TIFFField.TIFF_RATIONAL, 1, (Object) new long[][] { { (long) 300, (long) 1 },
            { (long) 0, (long) 0 } });
    params.setExtraFields(extras);
    ImageEncoder encoder = ImageCodec.createImageEncoder("tiff", out, params);
    encoder.encode(output.get(0));
    out.close();
}
static List<BufferedImage> tiff_Extractor(File tiff) throws IOException
{
    List<BufferedImage> images = new ArrayList<BufferedImage>();
    SeekableStream ss = new FileSeekableStream(tiff);
    ImageDecoder decoder = ImageCodec.createImageDecoder("tiff", ss, null);
    int numPages = decoder.getNumPages();
    for (int j = 0; j < numPages; j++)
    {
        PlanarImage op = new NullOpImage(decoder.decodeAsRenderedImage(j), null, null, OpImage.OP_IO_BOUND);
        images.add(op.getAsBufferedImage());

    }
    return images;
}
} 
```

这是设置 300 DPI 的 Tiff 图像。您可以根据需要进行更改。

```
extras[0] = new TIFFField(282, TIFFField.TIFF_RATIONAL, 1, (Object) new     
long[][] { { (long) 300, (long) 1 },{ (long) 0, (long) 0 } });

extras[1] = new TIFFField(283, TIFFField.TIFF_RATIONAL, 1, (Object) new     
long[][] { { (long) 300, (long) 1 },{ (long) 0, (long) 0 } }); 
```

# java - servlet 中的线程局部变量

> ID：321757
> 
> 赞同：6
> 
> 时间：2008-11-26T18:54:59.793
> 
> 标签：java, multithreading, servlets, concurrency, thread-local

threadlocals 变量对拥有变量的 servlet 发出的所有请求都是全局的吗？

我正在为服务器使用树脂。

谢谢你的遮阳篷。

我想我可以让自己更清楚。

**具体案例：**

我想要：

*   当请求开始执行时初始化一个静态变量。
*   能够以线程安全的方式在从 servlet 调用的方法的进一步执行中查询变量的值，直到请求结束执行

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-17T13:17:58.267

简短的回答：是的。
再长一点：这就是 Spring 发挥它的魔力的方式。请参阅[RequestContextHolder](http://www.docjar.com/html/api/org/springframework/web/context/request/RequestContextHolder.java.html)（通过 DocJar）。

不过需要小心——您必须知道何时使 ThreadLocal 无效、如何推迟到其他线程以及如何（不）与非线程本地上下文纠缠在一起。

或者你可以只使用弹簧......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T18:58:31.470

我认为它们对于仅使用该特定线程发出的所有请求都是全局的。*其他线程获取线程本地*数据的其他副本。这是线程本地存储的关键点： [http](http://en.wikipedia.org/wiki/Thread-local_storage#Java) ://en.wikipedia.org/wiki/Thread-local_storage#Java 。

除非您在 servlet 配置中选中适当的选项，否则 servlet 容器将使用您的 servlet 和多个线程来并行处理请求。如此有效地，您将为为客户端提供服务的每个线程拥有单独的数据。

如果您的 WebApplication 不是分布式的（在多个 Java 虚拟机上运行），您可以使用该`ServletContext`对象在请求和线程之间存储共享数据（然后确保进行适当的锁定）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-17T03:55:34.050

正如 Adiel 所说，正确的做法可能是使用请求上下文（即 HttpServletRequest），而不是创建 ThreadLocal。虽然这里当然可以使用 ThreadLocal，但是如果你这样做，你必须小心清理你的线程，因为否则下一个获取线程的请求将看到与前一个请求关联的值。（当第一个请求用线程完成时，线程将返回到池中，因此下一个请求将看到它。）当请求上下文正是为此目的而存在时，没有理由必须管理这种事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-06-03T04:25:34.553

如果您使用 Servlet 3.0 可暂停请求（或 Jetty Continuations），使用 ThreadLocal 存储请求范围信息可能会中断使用这些 API 的多个线程处理单个请求。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T19:25:51.073

Threadlocal 变量总是被定义为可以全局访问，因为关键是要在可以在任何地方访问的系统周围透明地传递信息。变量的值绑定到设置它的线程，因此即使变量是全局的，它也可以根据访问它的线程具有不同的值。

一个简单的例子是当在 servlet 中接收到请求时，将用户身份字符串分配给线程局部变量中的线程。沿着该请求的处理链的任何地方（假设它在同一个 VM 的同一个线程上），都可以通过访问这个全局变量来检索身份。在处理请求时删除此值也很重要，因为线程将被放回线程池中。

# wcf - WCF 和自定义 Soap 身份验证

> ID：321764
> 
> 赞同：3
> 
> 时间：2008-11-26T18:58:58.130
> 
> 标签：wcf, authentication, soap

我正在开发一个使用 WCF 为客户端公开 WebService 端点的服务器应用程序。我想通过一个简单的自定义提供程序来实现身份验证，该提供程序将使用通过 SOAP 标头传递的用户名和密码。我知道如何设置要在客户端发送的用户名和密码，我只想知道如何从服务器端的 SOAP 标头中提取用户名和密码。任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T22:11:56.993

需要在服务行为中指定用户名和密码验证器

```
<behavior name="MyServiceBehavior">
  <serviceCredentials>
    <userNameAuthentication userNamePasswordValidationMode="Custom"
      customUserNamePasswordValidatorType="MyNamespace.MyUserNamePasswordValidator, MyDll" />
  </serviceCredentials>
</behavior> 
```

您可以从 MyUserNamePasswordValidator 类访问用户名和密码

```
public class MyUserNamePasswordValidator : UserNamePasswordValidator
{
    public override void Validate( string userName, string password )
    {
        // valid your password here 
    }
} 
```

# java - JBoss 监控/分析

> ID：321765
> 
> 赞同：2
> 
> 时间：2008-11-26T18:59:04.963
> 
> 标签：java, jboss, profiling, monitoring

我有一个遗留的 JBoss 4.0.4/EJB 2.1/PostgreSQL 系统，其中有无数个“事务脚本化”过程作为服务器 EJB 方法，由于糟糕的编程实践（比如每次都创建临时表， ETC）。

有什么我可以插入 JBoss（Aspect-Like）来监控远程 EJB 方法的执行，捕获开始时间和结束时间，以便以后进一步分析？这个想法是尽可能优化系统中执行最多的方法，然后研究新平台的替代方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T21:23:23.843

JBoss 发布所有已部署 EJB 的 JSR-77 统计信息。它们可以通过 JMX 访问。请参阅 JavaDoc：[javax.management.j2ee.statistics.EJBStats](http://java.sun.com/j2ee/1.4/docs/api/javax/management/j2ee/statistics/EJBStats.html "javax.management.j2ee.statistics.EJBStats")统计信息将包括调用次数和总执行时间，并且可以推导出平均执行时间。使用 JMX 监视器来获取数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T19:06:55.853

这看起来像一个有前途的解决方案：[http ://www.jboss.org/jbossprofiler/](http://www.jboss.org/jbossprofiler/)

它不完全是一个 AOP 解决方案，但它似乎设置起来相当简单，并且会为您提供您正在寻找的数据。

# browser - Windows Safari 无法通过 NetBIOS/WINS 名称访问服务器

> ID：321774
> 
> 赞同：0
> 
> 时间：2008-11-26T19:00:56.380
> 
> 标签：browser, safari, intranet, netbios

每当我尝试访问经过 NTLM 身份验证的 Intranet 站点时，Safari 将永远进行处理，然后返回“服务器不可用”，或者如果站点允许，则加载而不进行身份验证。我可以在 Firefox 和 Internet Explorer 中毫无问题地访问这些相同的站点。这些站点托管在 IIS6 上，并使用 ASP、ASP.Net 1.1 或 ASP.Net 2.0 生成。

关于为什么 Safari 在这些网站上窒息的任何见解？是否有任何解决方法可以让 NTLM 正确地通过 Safari 进行身份验证？

* * *

**更新：**

在进一步使用它时，我确定如果我为站点使用 FQDN（即[http://mysite](http://mysite)不起作用，但[http://mysite.domain ），NTLM 将起作用（页面加载速度相当快）。 prv](http://mysite.domain.prv)将工作）。不幸的是，由于项目的其他限制，这将不起作用。

有谁知道为什么 FQDN 会起作用，但较短的名称不会？这是可以解决的问题还是“对不起”？

* * *

**更新 2：**

根据 Wireshark 数据包嗅探器，safari 将 SYN 发送到正确的服务器 IP 地址。Intranet 服务器以 SYN、ACK 响应，Safari 向其发送 ACK。这是 safari 和服务器之间通信的结束。当尝试通过 FQDN 访问 Intranet 站点时，这三个数据包是相同的，但随后是 HTTP GET 请求，然后成功加载了页面。

因为 Safari 连接到正确的 IP 地址，我很难相信 Safari 不支持 NetBIOS/WINS 名称。此外，由于 NTLM 数据包从不交换，因为 safari 从不发送初始 GET 请求，我确信 NTLM 与此问题无关。

有人知道 safari 对 NetBIOS/WINS 的支持情况吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-26T19:17:45.270

在基于 Java 的 B2B 客户端的类似情况下，我成功地使用[http://ntlmaps.sourceforge.net/](http://ntlmaps.sourceforge.net/)来遍历代理。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T01:03:26.897

Firefox 一直能够遍历 NTLM 站点。我知道，因为我被这个糟糕的自定义 ASP 解决方案和 SharePoint 网站困在我们的 Intranet 中...... Firefox 是一个梦想。

Apple .. 修复 Safari kthx？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T20:02:44.057

> 关于为什么 Safari 在这些网站上窒息的任何见解？

因为 NTLM 不是网络标准。你不能指望任何给定的网络浏览器支持它。

直到最近，只有 IE 完全支持它。并且必须专门配置 Firefox 的支持。

# c# - 到 CurrentThread.Abort 或不到 CurrentThread.Abort

> ID：321779
> 
> 赞同：14
> 
> 时间：2008-11-26T19:03:14.427
> 
> 标签：c#, .net, multithreading

我见过一些例子，它们的线程过程看起来像这样。

```
 private void ThreadProc()
    {
        while (serviceStarted)
        {
            // do some work

            Thread.Sleep(new TimeSpan(0, 0, 5));
        }

        Thread.CurrentThread.Abort();
    } 
```

最后`Abort()`真的有必要吗？

反对调用的论据有很多`Abort()`

1.  一旦程序退出 - 预计它已经自行清理了。
2.  调用`Abort()`会引发异常，这通常比仅退出过程更耗费资源。

我想阅读解释为什么这是或不是一个好的做法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-26T19:14:25.683

调用`Thread.Abort()`确实会引发异常，如果您正在编写将被重用的代码（或基础库的一部分），其他开发人员很难处理`ThreadAbortExcpetion`s.

这篇关于[可靠性最佳实践](http://msdn.microsoft.com/en-us/library/ms228970(VS.80).aspx)的文章对此进行了解释。

我一直听说调用[`Thread.Join()`](http://msdn.microsoft.com/en-us/library/ty8d3wta.aspx)是一种更好的方法，如果你可以等到线程完成处理。

我不知道是否有人认为这是一个好习惯。它可能会导致死锁（因为在抛出异常时未正确清理非托管资源）

这是[关于它的另一篇文章](http://www.interact-sw.co.uk/iangblog/2004/11/12/cancellation)，以及处理该问题的其他方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T22:29:05.243

一旦循环退出，线程将自行终止。不需要中止线程。

`CurrentThread.Abort`不仅是多余的，而且确实有害，因为它会引发`ThreadAbortException`. 如果另一个线程尝试访问`Join()`您的服务循环线程，它将不得不处理不必要的异常。您最好的选择就是删除该行`CurrentThread.Abort()`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T19:16:42.293

调用`Abort()`自己的线程是安全的，但除此之外，通常应该避免它，因为您不能确定其他线程会正常终止。在许多情况下，您不需要中止线程。只要让它完成，它就会被回收。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T19:16:11.543

有趣的问题。但我建议不要这样做，因为这样的声明会阻止该方法被轻松重用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-08-05T09:33:41.413

当一个线程没有进一步的工作要做时，它自然会自行终止：当它正在执行的逻辑完成时。

`Thread.Abort()`导致`ThreadAbortException`在当前线程上抛出 a ，其明确目的是快速终止线程上的所有执行。这是“无法捕获”的特殊 .NET 异常之一：您可以编写一个 catch 块，但在 catch 块完成后将继续抛出异常。这确保了后续用户代码无法停止中止线程的指令。

调用`Thread.Abort()`通常被视为不好的做法，因为有更优雅的方法来终止您正在执行的逻辑。取消最好使用`CancellationToken`.

# html - CSS技巧在单元格不为空时在表格和单元格上显示边框，否则不显示边框

> ID：321786
> 
> 赞同：1
> 
> 时间：2008-11-26T19:05:57.430
> 
> 标签：html, css, xhtml

有没有办法确保只有当单元格不为空时，它包含的表格和单元格才有边框？如果表格的所有单元格都是空的，则不应看到任何边框。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-26T19:10:14.753

请参阅[空单元格](http://www.w3.org/TR/CSS2/tables.html#empty-cells)CSS 属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T19:23:41.763

使用纯 CSS 完成此操作的唯一方法是使用非常现代的浏览器。您需要使用 CSS 高级选择器来完成此操作。例如，您可以使用 tr:empty 查找其中没有子元素的单元格，对于纯文本，您需要做更多的事情。

不幸的是，这些只存在于 CSS3 中，所以如果你不能使用 javascript，或者不能触摸标记，那么你只能在最新的浏览器中完成。

要了解有关 CSS3 选择器的更多信息，请[单击此处](http://www.w3.org/TR/css3-selectors/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T19:08:59.750

给空单元格一个类名，给非空单元格一个类名。一个类指定边界，另一个没有。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T19:09:09.703

据我所知，这不在 CSS 的能力范围内，我能想到的最佳选择是在填充数据时通过服务器端代码动态应用类，或者在页面加载后通过 JavaScript 动态应用类浏览器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T19:14:28.210

看起来 strager 建议的 empty-cells 属性可能会奏效。如果它不能满足您的需求，我会考虑使用一些聪明的 javascript 库，例如[jQuery](http://www.jquery.com/)。您可能可以设置一个钩子来更新单元格的边框样式为 getBorderStyle(this) 当这个单元格的内容发生变化时。

在此处查看 jquery“更改”钩子：http: [//docs.jquery.com/Events/change](http://docs.jquery.com/Events/change) 如果您选择所有单元格（您可以使用 css 选择器执行此操作）并添加一个更改钩子以运行您编写的某些函数调用 updateBorder() 或类似的，你应该很好。我想它会是这样的：

```
$("table.someClass td").change(function() { updateBorder(this) }) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T19:17:22.167

单元格边框的渲染部分取决于您是否折叠边框。如果没有折叠边框，如果没有单元格内容，则默认不显示。这可以通过使用 CSS 属性[empty-cells](http://www.w3.org/TR/CSS2/tables.html#empty-cells)来切换。

如果您正在折叠边框，您将失去根据单元格内容的存在来控制边框显示的能力。

# java - 使用java加密整数

> ID：321787
> 
> 赞同：6
> 
> 时间：2008-11-26T19:06:08.553
> 
> 标签：java, encryption, cryptography, integer, bytearray

我正在尝试使用 java.security 和 javax.crypto 在 java 中加密一些整数。

问题似乎是 Cipher 类只加密字节数组。我不能直接将整数转换为字节字符串（或者我可以吗？）。做这个的最好方式是什么？

我应该将整数转换为字符串并将字符串转换为字节 [] 吗？这似乎太低效了。

有谁知道快速/简单或有效的方法？

请告诉我。

提前致谢。

吉布

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-26T19:10:17.967

您可以使用 DataOutputStream 将整数转换为 byte[]，如下所示：

```
ByteArrayOutputStream baos = new ByteArrayOutputStream ();
DataOutputStream dos = new DataOutputStream (baos);
dos.writeInt (i);
byte[] data = baos.toByteArray();
// do encryption 
```

然后稍后解密：

```
byte[] decrypted = decrypt (data);
ByteArrayInputStream bais = new ByteArrayInputStream (data);
DataInputStream dis = new DataInputStream (bais);
int j = dis.readInt(); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-26T19:14:28.443

您还可以使用 BigInteger 进行转换：

```
 BigInteger.valueOf(integer).toByteArray(); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-26T21:15:48.200

只需使用 NIO。它是为这个特定目的而设计的。ByteBuffer 和 IntBuffer 将快速、高效、优雅地完成您需要的工作。它将处理大/小端转换、高性能 IO 的“直接”缓冲区，您甚至可以将数据类型混合到字节缓冲区中。

**将整数转换为字节：**

```
ByteBuffer bbuffer = ByteBuffer.allocate(4*theIntArray.length);
IntBuffer ibuffer = bbuffer.asIntBuffer(); //wrapper--doesn't allocate more memory
ibuffer.put(theIntArray);                  //add your int's here; can use 
                                           //array if you want
byte[] rawBytes = bbuffer.array();         //returns array backed by bbuffer--
                                           //i.e. *doesn't* allocate more memory 
```

**将字节转换为整数：**

```
ByteBuffer bbuffer = ByteBuffer.wrap(rawBytes);
IntBuffer ibuffer = bbuffer.asIntBuffer();
while(ibuffer.hasRemaining())
   System.out.println(ibuffer.get());      //also has bulk operators 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-26T19:12:12.130

我发现以下代码可能对您有所帮助，因为 Java 中的 Integer 始终是 4 个字节长。

```
public static byte[] intToFourBytes(int i, boolean bigEndian) {  
    if (bigEndian) {  
        byte[] data = new byte[4];  
        data[3] = (byte) (i & 0xFF);  
        data[2] = (byte) ((i >> 8) & 0xFF);  
        data[1] = (byte) ((i >> 16) & 0xFF);  
        data[0] = (byte) ((i >> 24) & 0xFF);  
        return data;  

    } else {  
        byte[] data = new byte[4];  
        data[0] = (byte) (i & 0xFF);  
        data[1] = (byte) ((i >> 8) & 0xFF);  
        data[2] = (byte) ((i >> 16) & 0xFF);  
        data[3] = (byte) ((i >> 24) & 0xFF);  
        return data;  
    }  
} 
```

您可以在此处找到有关 bigEndian 参数的更多信息： [http ://en.wikipedia.org/wiki/Endianness](http://en.wikipedia.org/wiki/Endianness)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T22:50:38.947

创建一个 4 字节数组并分 4 步将 int 复制到数组中，如 Paulo 所说，使用按位与和位移。

但请记住，诸如 AES 和 DES 之类的块算法使用 8 或 16 字节块，因此您需要将数组填充到算法需要的值。也许将 8 字节数组的前 4 个字节保留为 0，而其他 4 个字节包含整数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-06-23T15:09:44.707

只需使用：

```
 Integer.toString(int).getBytes(); 
```

确保使用原始 int 并且 getBytes() 将返回一个字节数组。不需要做任何其他复杂的事情。

要转换回来：

```
 Integer.parseInt(encryptedString); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-07-01T15:42:28.073

我的简单解决方案是通过您提供的密钥将整数的 ASCII 值转换为字符串，将整数加密为字符串。

这是解决方案：

```
public String encodeDiscussionId(int Id) {

    String tempEn = Id + "";
    String encryptNum ="";
    for(int i=0;i<tempEn.length();i++) {
        int a = (int)tempEn.charAt(i);
        a+=148113;
        encryptNum +=(char)a;
    }
    return encryptNum;
}

public Integer decodeDiscussionId(String encryptText) {

    String decodeText = "";
    for(int i=0;i<encryptText.length();i++) {
        int a= (int)encryptText.charAt(i);
        a -= 148113;
        decodeText +=(char)a;
    }
    int decodeId = Integer.parseInt(decodeText);
    return decodeId;
} 
```

编码步骤：

1.  在这里，首先您通过以下方式将给定的整数转换为字符串：`String temp = givenInt + ""`
2.  扫描 String 的每个字符，读取该字符的 ASCII 并在本例中添加密钥为 148113。
3.  转换`Integer`为 Character 并连接到 the`String encryptNum`并最终返回它。

解码步骤：

1.  扫描字符串的每个字符，读取该字符的 ASCII 并用之前的密钥减去它。
2.  将该值转换为字符并与`decodeText`.

*由于先前的编码输出总是`String '???'`根据输入的位数而变化`Id`。*

# c# - 在发送传出请求之前将新的 SoapClient 绑定到特定的 IP 地址

> ID：321788
> 
> 赞同：4
> 
> 时间：2008-11-26T19:06:24.823
> 
> 标签：c#, web-services, binding, ip-address, soap-client

假设应用程序所在的机器具有 SoapClient（具体来说，我使用的是 Microsoft.Web.Service3.Messaging.SoapClient）。它通过发送传出请求并获得 SoapEnvelope 作为回报（完善的过程）来毫无问题地与远程位置通信。

上述场景是通过分配给应用程序所在机器的 IP。

现在，我需要修改这个过程——我们需要向机器添加另外 2 个 IP，并且我需要将传出请求“绑定”到特定 IP，而不是默认 IP。

因此，在远程位置，它似乎正在接收来自 3 个不同 IP 的请求，但实际上都是来自同一台机器/应用程序。

如何将传出请求绑定到特定 IP？这就是远程位置“锁定”到特定帐户的方式，通过 IP，而不是登录（这是我的建议，但他们拒绝了）。他们说我们应该能够做到这一点（绑定到特定的 IP），但我不确定如何使用 Microsoft 的 SoapClient 对象来做到这一点。

有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-07-16T03:46:38.817

查看 MSDN 文档，没有任何方法可以将其绑定到机器上的特定 IP 地址。

# c++ - 日期/时间转换：字符串表示为 time_t

> ID：321793
> 
> 赞同：15
> 
> 时间：2008-11-26T19:07:46.443
> 
> 标签：c++, c, datetime

如何将格式为 的日期字符串转换为C 或 C++ 中`"MM-DD-YY HH:MM:SS"`的值？`time_t`

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-26T19:12:36.747

用于`strptime()`将时间解析为 a `struct tm`，然后用于`mktime()`转换为 a `time_t`。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-26T19:20:01.803

在没有您的情况下，`strptime`您可以使用`sscanf`将数据解析为 a `struct tm`，然后调用`mktime`. 不是最优雅的解决方案，但它会起作用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-26T19:17:51.073

Boost 的日期时间库应该会有所帮助；特别是你可能想看看[http://www.boost.org/doc/libs/1_37_0/doc/html/date_time/date_time_io.html](http://www.boost.org/doc/libs/1_37_0/doc/html/date_time/date_time_io.html)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-01-30T00:04:16.073

请注意，`strptime`接受的答案中提到的不可移植。这是我用来将字符串转换为 std::time_t 的方便 C++11 代码：

```
static std::time_t to_time_t(const std::string& str, bool is_dst = false, const std::string& format = "%Y-%b-%d %H:%M:%S")
{
    std::tm t = {0};
    t.tm_isdst = is_dst ? 1 : 0;
    std::istringstream ss(str);
    ss >> std::get_time(&t, format.c_str());
    return mktime(&t);
} 
```

你可以这样称呼它：

```
std::time_t t = to_time_t("2018-February-12 23:12:34"); 
```

[您可以在此处](http://en.cppreference.com/w/cpp/io/manip/get_time)找到字符串格式参数。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-26T19:12:14.610

恐怕标准 C / C++ 中没有。有 POSIX 函数`strptime`可以转换为`struct tm`，然后可以转换为`time_t`using `mktime`。

如果你的目标是跨平台兼容，最好使用`boost::date_time`它，它具有复杂的功能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-01-30T00:27:28.663

> 将格式为“MM-DD-YY HH:MM:SS”的日期字符串转换为 time_t 的最佳方法

将代码限制为标准 C 库函数正在寻找`strftime()`. 为了扩展[@Rob 的](https://stackoverflow.com/a/321847/2410359)总体思路，使用`sscanf()`.

用于`"%n"`检测完成的扫描

```
time_t date_string_to_time(const char *date) {
  struct tm tm = { 0 }; // Important, initialize all members
  int n = 0;
  sscanf(date, "%d-%d-%d %d:%d:%d %n", &tm.tm_mon, &tm.tm_mday, &tm.tm_year,
      &tm.tm_hour, &tm.tm_min, &tm.tm_sec, &n);
  // If scan did not completely succeed or extra junk
  if (n == 0 || date[n]) {
    return (time_t) -1;
  }
  tm.tm_isdst = -1; // Assume local daylight setting per date/time
  tm.tm_mon--;      // Months since January
  // Assume 2 digit year if in the range 2000-2099, else assume year as given
  if (tm.tm_year >= 0 && tm.tm_year < 100) {
    tm.tm_year += 2000;
  }
  tm.tm_year -= 1900; // Years since 1900
  time_t t = mktime(&tm);
  return t;
} 
```

附加代码可用于确保只有 2 位时间戳部分、正值、间距等。

注意：这里假设“MM-DD-YY HH:MM:SS”是*当地时间*。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2013-04-08T10:56:29.410

```
 static time_t MKTimestamp(int year, int month, int day, int hour, int min, int sec)
{
    time_t rawtime;
    struct tm * timeinfo;

    time ( &rawtime );
    timeinfo = gmtime ( &rawtime );
    timeinfo->tm_year = year-1900 ;
    timeinfo->tm_mon = month-1;
    timeinfo->tm_mday = day;
    timeinfo->tm_hour = hour;
    timeinfo->tm_min = min;
    timeinfo->tm_sec = sec;
    timeinfo->tm_isdst = 0; // disable daylight saving time

    time_t ret = mktime ( timeinfo );

    return ret;
}

 static time_t GetDateTime(const std::string pstr)
{
    try 
    {
        // yyyy-mm-dd
        int m, d, y, h, min;
        std::istringstream istr (pstr);

        istr >> y;
        istr.ignore();
        istr >> m;
        istr.ignore();
        istr >> d;
        istr.ignore();
        istr >> h;
        istr.ignore();
        istr >> min;
        time_t t;

        t=MKTimestamp(y,m,d,h-1,min,0);
        return t;
    }
    catch(...)
    {

    }
} 
```

# python - 在 Python 的单元测试中比较 XML

> ID：321795
> 
> 赞同：41
> 
> 时间：2008-11-26T19:09:08.440
> 
> 标签：python, xml, elementtree

我有一个可以从 XML 字符串构建自身并将自身写入 XML 字符串的对象。我想编写一个单元测试来测试通过 XML 的往返，但是我在比较两个 XML 版本时遇到了麻烦。空格和属性顺序似乎是问题所在。关于如何做到这一点的任何建议？这是在 Python 中，我使用的是 ElementTree（这并不重要，因为我只是在这个级别处理字符串中的 XML）。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-26T19:35:15.063

首先规范化 2 个 XML，然后您可以比较它们。我使用 lxml 使用了以下内容

```
obj1 = objectify.fromstring(expect)
expect = etree.tostring(obj1)
obj2 = objectify.fromstring(xml)
result = etree.tostring(obj2)
self.assertEquals(expect, result) 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2011-08-14T23:05:34.563

这是一个老问题，但是由于属性顺序，接受[的 Kozyarchuk 的答案对我不起作用，并且](https://stackoverflow.com/a/321893/3357935)[minidom 解决方案](https://stackoverflow.com/a/321941/3357935)也不能按原样工作（不知道为什么，我没有调试它）。

这就是我最终想出的：

```
from doctest import Example
from lxml.doctestcompare import LXMLOutputChecker

class XmlTest(TestCase):
    def assertXmlEqual(self, got, want):
        checker = LXMLOutputChecker()
        if not checker.check_output(want, got, 0):
            message = checker.output_difference(Example("", want), got, 0)
            raise AssertionError(message) 
```

这也会产生一个差异，在处理大型 xml 文件时会有所帮助。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-26T19:56:19.030

如果问题实际上只是空格和属性顺序，并且除了文本和元素之外没有其他结构需要担心，则可以使用标准 XML 解析器解析字符串并手动比较节点。这是一个使用 minidom 的示例，但您可以非常简单地在 etree 中编写相同的内容：

```
def isEqualXML(a, b):
    da, db= minidom.parseString(a), minidom.parseString(b)
    return isEqualElement(da.documentElement, db.documentElement)

def isEqualElement(a, b):
    if a.tagName!=b.tagName:
        return False
    if sorted(a.attributes.items())!=sorted(b.attributes.items()):
        return False
    if len(a.childNodes)!=len(b.childNodes):
        return False
    for ac, bc in zip(a.childNodes, b.childNodes):
        if ac.nodeType!=bc.nodeType:
            return False
        if ac.nodeType==ac.TEXT_NODE and ac.data!=bc.data:
            return False
        if ac.nodeType==ac.ELEMENT_NODE and not isEqualElement(ac, bc):
            return False
    return True 
```

如果您需要更彻底的等价比较，涵盖其他类型节点的可能性，包括 CDATA、PI、实体引用、注释、文档类型、命名空间等，您可以使用 DOM Level 3 Core 方法 isEqualNode。minidom 和 etree 都没有，但 pxdom 是一种支持它的实现：

```
def isEqualXML(a, b):
    da, db= pxdom.parseString(a), pxdom.parseString(a)
    return da.isEqualNode(db) 
```

（如果您需要指定实体引用和 CDATA 部分是否与其替换的等效项匹配，您可能需要更改解析中的一些 DOMConfiguration 选项。）

一种稍微迂回的方法是解析，然后重新序列化为规范形式并进行字符串比较。pxdom 再次支持 DOM Level 3 LS 选项“canonical-form”，您可以使用它来执行此操作；使用 stdlib 的 minidom 实现的另一种方法是使用 c14n。但是，您必须为此安装 PyXML 扩展，所以您仍然不能在 stdlib 中完成它：

```
from xml.dom.ext import c14n

def isEqualXML(a, b):
    da, bd= minidom.parseString(a), minidom.parseString(b)
    a, b= c14n.Canonicalize(da), c14n.Canonicalize(db)
    return a==b 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-26T19:19:11.303

使用[xmldiff](http://www.logilab.org/859)，这是一个 python 工具，可以找出两个相似 XML 文件之间的差异，与 diff 的方法相同。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-26T20:46:45.700

为什么要检查 XML 数据？

测试对象序列化的方法是创建对象的实例，序列化，反序列化成新的对象，比较两个对象。当您进行破坏序列化或反序列化的更改时，此测试将失败。

检查 XML 数据的唯一事情是，如果您的序列化器发出了反序列化器所需的超集，并且反序列化器会默默地忽略它不期望的东西。

当然，如果其他东西会消耗序列化的数据，那就是另一回事了。但在这种情况下，您应该考虑为 XML 建立一个模式并对其进行验证。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-11-18T07:05:26.207

我也有这个问题，今天做了一些挖掘。该[`doctestcompare`方法](https://stackoverflow.com/questions/321795/comparing-xml-in-a-unit-test-in-python/7060342#7060342)可能就足够了，但我通过[Ian Bicking](http://blog.ianbicking.org/2007/09/24/lxmlhtml/)发现它基于`formencode.doctest_xml_compare`. 现在似乎在[这里](https://bitbucket.org/formencode/official-formencode/src/3be5078c6030/formencode/doctest_xml_compare.py#cl-70)。正如你所看到的，这是一个非常简单的函数，不像[`doctestcompare`](https://github.com/lxml/lxml/blob/master/src/lxml/doctestcompare.py)（虽然我猜`doctestcompare`是收集所有的失败，也许是更复杂的检查）。无论如何复制/导入可能是一个很好的解决方案`xml_compare`。`formencode`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-27T00:20:52.677

Java 组件`dbUnit`进行了大量的 XML 比较，因此您可能会发现查看他们的方法很有用（尤其是发现他们可能已经解决的任何问题）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-11-23T02:05:34.400

```
def xml_to_json(self, xml):
    """Receive 1 lxml etree object and return a json string"""
    def recursive_dict(element):
        return (element.tag.split('}')[1],
                dict(map(recursive_dict, element.getchildren()),
                     **element.attrib))
    return json.dumps(dict([recursive_dict(xml)]),
                      default=lambda x: str(x))

def assertEqualXML(self, xml_real, xml_expected):
    """Receive 2 objectify objects and show a diff assert if exists."""
    xml_expected_str = json.loads(self.xml_to_json(xml_expected))
    xml_real_str = json.loads(self.xml_to_json(xml_real))
    self.maxDiff = None
    self.assertEqual(xml_real_str, xml_expected_str) 
```

您可以看到如下输出：

```
 u'date': u'2016-11-22T19:55:02',
                u'item2': u'MX-INV0007',
         -      u'item3': u'Payments',
         ?                  ^^^
         +      u'item3': u'OAYments',
         ?                  ^^^ + 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-09-27T15:15:07.747

可以通过以下方式轻松完成`minidom`：

```
class XmlTest(TestCase):
    def assertXmlEqual(self, got, want):
        return self.assertEqual(parseString(got).toxml(), parseString(want).toxml()) 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-10-15T10:36:37.437

[Stevoisiak 的解决方案](https://stackoverflow.com/a/7060342/14455249)

在我的情况下不适用于 python3。固定的：

```
from lxml.doctestcompare import LXMLOutputChecker, PARSE_XML

class XmlTest(TestCase):
def assertXmlEqual(self, got, want):
    checker = LXMLOutputChecker()
    if not checker.check_output(want.encode(), got.encode(), PARSE_XML):
        message = checker.output_difference(Example(b"", want.encode()), got.encode(), PARSE_XML)
        raise AssertionError(message) 
```

# c++ - 枚举 C++ 按索引获取

> ID：321801
> 
> 赞同：23
> 
> 时间：2008-11-26T19:09:38.780
> 
> 标签：c++, enums

我想知道在 C++ 中，如果我有一个枚举，我可以访问第二个索引处的值吗？例如我有

```
enum Test{hi, bye}; 
```

如果我想要“嗨”，我可以做一些类似 Test[0] 的事情吗，谢谢。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-11-26T19:13:57.120

是和不是。如果您的 Enum 没有明确的值，那么它是可能的。如果没有明确的值，枚举值会按照声明的顺序被赋予数值 0-N。例如 ...

```
enum Test {
  hi, // 0
  bye // 1
} 
```

这意味着索引只是转换为文字值。

```
Test EnumOfIndex(int i) { return static_cast<Test>(i); } 
```

这当然会在运行时进行 0 验证，并且一旦添加了显式值，它就会崩溃。但它会在默认情况下工作。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-26T19:14:45.807

除非另有说明，否则枚举从 0 开始编号，每个条目递增 1。

```
enum Test
{
    hi, //0
    bye, //1
    count //2
} 
```

您可以将 int 转换为枚举的类型以获取您想要的值，例如：

```
(Test)0;
//or
Test(0); 
```

这使您可以执行以下操作：

```
for(int i = 0; i < count; i++)
{
    DoSomething((Test)i);
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-26T19:12:54.220

枚举将名称映射到值。在您的情况下， (int)hi 的值为 0，而 (int)bye 的值为 1。您可以使用强制转换来获取 hi 的值：

```
int myInteger = 0;
Test myValue = (Test)myInteger; 
```

但请注意，如果 myInteger 超出范围，则 myValue 可能是无效的枚举值。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-26T19:13:18.460

不，但你可以从 int 转换

```
Test test = (Test)0; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T19:42:07.093

取决于您所说的“我想要'嗨'”是什么意思。

如果你的意思是你想要这个值，那么你可以通过转换一个 int 来获得它，就像其他人所说的那样。

将数字文字转换为枚举类型通常是没有意义的 - 如果您知道您期望哪个值，您可以使用该名称。这样，枚举可以在不破坏代码的情况下进行更改。我想可能发生了一些非常奇怪的事情，有人创建了一个枚举，并记录了“3”的含义，但没有记录它是哪个枚举值。但是你会想要修复 API。

如果您有序列化数据，则将运行时已知的整数值转换为枚举可能会有所帮助。只要您知道它在枚举范围内，就可以定义结果。

如果你的意思是你想要字符串“hi”，那么你就不能拥有它。与 Java 不同，在 C++ 中，枚举类型中的值的名称只存在于编译时，而不是运行时，并且只映射到一个方向。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T19:13:50.347

您最好的选择可能是这样的：

```
enum Test{hi = 0, bye}; 
```

然后你可以简单地用数字 0 来指代“hi”，用数字 1 来指代“bye”。

尽管这确实违背了首先使用枚举的全部目的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-02-02T13:54:32.073

如果您将返回的值排除为 {Hi or bye} ，那么您将无法获得这样的值。

我不建议这样做以获得实际价值，但它可以用作黑客

```
string return_value(int index)
{
string temp = "";
switch (index)
{
case 1: temp = "hi"
break;
case 2: temp = "bye";
break;
defualt :
break;
}
return temp;
} 
```

对枚举进行类型转换将再次返回索引，但您可以分配给其他一些枚举变量

# xml - 如何在 XPath 中识别多个具有相同名称的元素？

> ID：321805
> 
> 赞同：12
> 
> 时间：2008-11-26T19:11:16.093
> 
> 标签：xml, xpath

如果我有一个包含多个同名元素的文档怎么办——例如，我将如何检索第二个元素？

```
<doc>
...
 <element name="same">foo</element>
...
 <element name="same">bar</element>
...
 <element name="same">baz</element>
...
</doc> 
```

我希望像 //elem[@name='same'][2] 这样的东西可以工作。

此外，我如何在 xpath 中找到倒数第二个元素，其中具有可变数量的同名元素

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-26T20:23:12.440

`[ ]`比 // 具有更高的优先级（并且“//”实际上只是一个缩写，而不是一个运算符）。之所以如此，是因为根据[**XPath 1.0 Spec**](https://www.w3.org/TR/1999/REC-xpath-19991116/#path-abbrev)，

"// 是 /descendant-or-self::node()/ 的缩写"

然后：

“**注意**：位置路径与位置路径`//para[1]`的含义不同`/descendant::para[1]`。后者选择第一个后代 para 元素；前者选择所有后代 para 元素，它们是其父母的第一个 para 子元素。”

因此，XPath 表达式：

     `//element[@name='same'][2]`

方法：

选择文档中名为“element”的任何元素，该元素具有属性“name”，值为“same”，并且该元素是其父元素的第二个此类子元素。

*你想要的是*：

     **`(//element[@name='same'])[2]`**

注意括号，它覆盖了 [] 的更高优先级。

*类似地，最后一个这样的节点*由以下 XPath 表达式选择：

     **`(//element[@name='same'])[last()-1]`**

**最后，一个必要的警告**：使用“//”缩写非常昂贵，因为它会导致整个（子）树被遍历。只要文档的结构已知，建议使用更具体的结构（位置路径）。

# client - 跨操作系统远程登录客户端的远程登录库和语言选择？

> ID：321808
> 
> 赞同：3
> 
> 时间：2008-11-26T19:11:34.097
> 
> 标签：client, telnet, mud

我正在寻找启动一个[MUD 客户端](http://en.wikipedia.org/wiki/MUD)应用程序，它连接到托管在 telnet 服务器上的 MUD。对我来说唯一重要的是它可以在任何操作系统上轻松高效地运行。除了这个要求，我真的不喜欢任何语言。

因此，我正在寻找一个免费可用的 telnet 客户端库，我可以在此基础上构建我的应用程序，这样我就不必过多地处理协议的细节。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T19:18:21.430

对于这种事情，我总是会考虑使用[Twisted （Python）。](http://twistedmatrix.com/trac/)

美妙之处在于，如果您以后决定将其换成 SSH 或任何比 telnet 更安全的东西，您可以轻松地做到这一点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T21:24:16.293

扭曲，扭曲，扭曲！

要使用 telnet，请参阅 package `twisted.conch.telnet`。它有一些简单的[API 文档](http://twistedmatrix.com/documents/8.1.0/api/twisted.conch.telnet.html)，但有关使用它的真正信息来自[在 Google Code Search 上的搜索](http://www.google.com/codesearch?q=twisted.conch.telnet&hl=en)，例如来自[grailmud](http://code.google.com/p/grailmud/) - 一个 MUD 服务器的[这个块。](http://grailmud.googlecode.com/svn/trunk/grailmud/telnet.py)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T19:33:02.820

如果你喜欢 Perl ， [CPAN](http://search.cpan.org/~jrogers/Net-Telnet-3.03/lib/Net/Telnet.pm)中有一个 telnet 接口。它非常小，但应该可以完成工作。

[编辑] [libcurl](http://curl.haxx.se/)也应该能够进行远程登录，尽管我找不到任何例子。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-26T19:41:32.477

对于我所有的 MUD 编程，我只是使用 RFC 从头开始​​创建了自己的例程。

如果您想避免我的一些痛苦，我将它包装成一个相当简单的 C# 类，可以正确处理 Telnet。如果您想仔细阅读，可以[在这里查看](http://scavenger.homeip.net/svn/autohack/jessie/trunk/Comm/jtbvTelnetComm.cs)。

此代码已被复制/粘贴并在 Windows 和 Linux（通过 Mono）上运行在少数单独的项目中，并且运行良好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-12T12:40:36.130

pmc ( [http://sourceforge.net/projects/perlmudclient/](http://sourceforge.net/projects/perlmudclient/) ) 试图做到这一点。上周我花了一些时间来经历它；它使用 Net::Telnet 的旧修改版本来完成连接工作。

我的问题是，当服务器发送部分行时，Net::Telnet 似乎有一个阻塞接口，即没有被换行符终止的行。它有两个支持这一点的特性（waitfor 和它的提示机制），因为几乎所有的*telnet*服务器都有不以换行符结尾的提示。

MUD 通常具有非标准的“提示”，并且在游戏过程中会有所不同；我管理的 MUD 有一个“您的选择：”提示作为其登录名 [它不仅仅是用于用户名]，并且许多游戏功能都提供了替代提示。所以我怀疑你在寻找跨平台 Telnet 库时需要牢记这一点！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-02-19T20:22:26.017

如果你喜欢 C，我衷心推荐[libtelnet](http://github.com/elanthis/libtelnet)。它将维护一个内部状态，为您完成所有序列解析，并使用[Q 方法](https://www.rfc-editor.org/rfc/rfc1143)`IAC`处理选项协商。

# asp.net - 从 ListView 获取编辑值

> ID：321819
> 
> 赞同：2
> 
> 时间：2008-11-26T19:13:49.770
> 
> 标签：asp.net, listview

我在这里遗漏了一些东西，但我已经盯着它看了太久而看不到它。我有一个简单的 ListView，带有典型的编辑/更新/取消按钮。当行进入编辑模式时，我在 EditITemTemplate 中进行了以下设置：

```
<EditItemTemplate>
    <asp:Label ID="AccountIdLabel" runat="server" Text='<%#Eval("lan_id")%>' />
    <asp:TextBox ID="EmployeeIdTextBox" runat="server" Text='<%#Eval("emp_id")%>' Columns="5" />
</EditItemTemplate> 
```

此时，用户在 EmployeeIdTextBox 中键入一个值。当他们按下更新时，它正在尝试执行以下操作：

```
Private Sub ListView_ItemUpdating(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.ListViewUpdateEventArgs) Handles EmployeeListView.ItemUpdating

    Dim accountId = CType(EmployeeListView.EditItem.FindControl("AccountIdLabel"), Label).Text
    Dim employeeId = CType(EmployeeListView.EditItem.FindControl("EmployeeIdTextBox"), TextBox).Text

    UpdateMap(accountId, employeeId)

    EmployeeListView.EditIndex = -1
    GetData()

End Sub 
```

问题是“employeeId”返回文本框中的原始值，而不是用户输入的值。我错过了什么？

更新：[找到了](https://stackoverflow.com/questions/321819/getting-edit-value-from-listview#322175)。像往常一样，由此处未包含的其他代码引起的，以提出一个简单的问题。:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T21:09:32.347

找到它 - 我在 ItemCommand 事件中有处理其他事件的代码，但不管命令如何，它都在最后执行 GetData()，因此基本上在 ItemUpdating 事件触发之前数据正在刷新。我收紧了 ItemCommand，它现在按预期工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T19:57:12.490

我认为这是因为 ItemUpdating 事件在 ListView 更新记录之前触发。您可能希望将此代码放在 ItemUpdated 事件中。

[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listview.itemupdating.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listview.itemupdating.aspx)

# haskell - 将表达式转换为字符串表示？

> ID：321822
> 
> 赞同：3
> 
> 时间：2008-11-26T19:14:06.587
> 
> 标签：haskell, functional-programming

考虑以下 Haskell 代码：

```
module Expr where

    -- Variables are named by strings, assumed to be identifiers:

    type Variable = String

    -- Representation of expressions:

    data Expr = Const Integer
          | Var Variable
          | Plus Expr Expr
          | Minus Expr Expr
          | Mult Expr Expr
          deriving (Eq, Show)

    simplify :: Expr->Expr

    simplify (Mult (Const 0)(Var"x"))
     = Const 0 
    simplify (Mult (Var "x") (Const 0))
     = Const 0
    simplify (Plus (Const 0) (Var "x")) 
    = Var "x"
    simplify (Plus (Var "x") (Const 0))
     = Var "x" 
    simplify (Mult (Const 1) (Var"x")) 
    = Var "x"
    simplify (Mult(Var"x") (Const 1))
     = Var "x" 
    simplify (Minus (Var"x") (Const 0))
     = Var "x"
    simplify (Plus (Const x) (Const y)) 
    = Const (x + y)
    simplify (Minus (Const x) (Const y))
    = Const (x - y)
    simplify (Mult (Const x) (Const y))
     = Const (x * y)
    simplify x = x

    toString :: Expr->String 
```

如何将表达式转换为字符串表示？

例如

```
toString (Var "x") = "x"  
toString (Plus (Var "x") (Const 1)) = "x + 1"  
toString (Mult (Plus (Var "x") (Const 1)) (Var "y"))  
       = "(x + 1) * y" 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T22:36:44.620

与其调用你的函数 toString，不如使用[Show type class](http://www.haskell.org/tutorial/stdclasses.html)。然后，您的数据类型可以在可以使用 Show 实例的任何地方使用。Show 是将“事物”转换为字符串的标准 Haskell 方法。

```
instance Show Expr where
    show (Var "x") = "x"
    -- etc. 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T20:24:50.830

看起来你几乎拥有它。

这是一个例子

```
toString (Plus e1 e2) = (toString e1) ++ " + " ++ (toString e2)
toString (Const i) = show i 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T19:21:07.197

这是您需要知道的一切：[http ://augustss.blogspot.com/2007/04/overloading-haskell-numbers-part-1.html](http://augustss.blogspot.com/2007/04/overloading-haskell-numbers-part-1.html)

# c# - 在 C# 中序列化匿名委托

> ID：321827
> 
> 赞同：37
> 
> 时间：2008-11-26T19:14:34.153
> 
> 标签：c#, .net-3.5, serialization

我正在尝试确定使用以下序列化代理启用匿名函数/委托/lambdas 的序列化可能会导致哪些问题。

```
// see http://msdn.microsoft.com/msdnmag/issues/02/09/net/#S3
class NonSerializableSurrogate : ISerializationSurrogate
{
    public void GetObjectData(object obj, SerializationInfo info, StreamingContext context)
    {
        foreach (FieldInfo f in obj.GetType().GetFields(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic))
            info.AddValue(f.Name, f.GetValue(obj));
    }

    public object SetObjectData(object obj, SerializationInfo info, StreamingContext context,
                                ISurrogateSelector selector)
    {
        foreach (FieldInfo f in obj.GetType().GetFields(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic))
            f.SetValue(obj, info.GetValue(f.Name, f.FieldType));
        return obj;
    }
} 
```

**清单 1** *改编自* [Counting Demo](http://www.agilekiwi.com/dotnet/CountingDemo.cs)

我能想到的可能是一个问题的主要问题是匿名类是一个内部编译器细节，它的结构不能保证在 .NET Framework 的修订之间保持不变。根据我对迭代器类似问题的研究，我相当肯定这是这种情况。

## 背景

我正在调查匿名函数的序列化。我原以为这不起作用，但发现在某些情况下确实如此。只要 lambda *not& 强制编译器生成一个匿名类，一切正常。

如果编译器需要生成的类来实现匿名函数，则会引发 SerializationException。这是因为编译器生成的类未标记为可序列化。

## 例子

```
namespace Example
{
    [Serializable]
    class Other
    {
        public int Value;
    }

    [Serializable]
    class Program
    {
        static void Main(string[] args)
        {
            MemoryStream m = new MemoryStream();
            BinaryFormatter f = new BinaryFormatter();

            // Example 1
            Func<int> succeeds = () => 5;
            f.Serialize(m, succeeds);

            // Example 2
            Other o = new Other();
            Func<int> fails = () => o.Value;
            f.Serialize(m, fails); // throws SerializationException - Type 'Example.Program+<>c__DisplayClass3' in Assembly 'Example, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null' is not marked as serializable.
        }
    } 
```

**清单 2**

这类似于尝试序列化*迭代器*的问题，我在之前的搜索中找到了以下代码（请参阅[countingdemo](http://www.agilekiwi.com/dotnet/CountingDemo.cs)）。使用**清单1**中的代码和一个ISurrogateSelector，我能够成功地序列化和反序列化第二个失败的示例。

## 客观的

我有一个通过 Web 服务公开的系统。系统有一个复杂但小的状态（很多对象，每个对象没有很多属性）。状态保存在 ASP.NET 缓存中，但也会在缓存到期时序列化为 SQL 中的 BLOB。某些对象需要在达到某些条件时执行任意“事件”。因此，它们具有接受 Action/Func 对象的属性。人为的例子：

```
 class Command
    {
        public Command(Action action, Func<bool> condition);
    } 
```

别的地方

```
 void DoSomethingWithThing(Thing thing)
    {
        state = Store.GetCurrentState();

        Command cmd = new Command(() => thing.Foo(), () => thing.IsReady())
        state.Add(cmd);

        Store.Save(state);
    } 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-02T20:35:15.160

> 一些对象需要执行任意“事件”来达到某种条件。

这些事件到底有多随意？可以对它们进行计数、分配 ID 并映射到引用吗？

```
public class Command<T> where T : ISerializable
{
  T _target;
  int _actionId;
  int _conditionId;

  public Command<T>(T Target, int ActionId, int ConditionId)
  {
    _target = Target;
    _actionId = ActionId;
    _conditionId = ConditionId;
  }

  public bool FireRule()
  {
    Func<T, bool> theCondition = conditionMap.LookupCondition<T>(_conditionId)
    Action<T> theAction = actionMap.LookupAction<T>(_actionId);

    if (theCondition(_target))
    {
      theAction(_target);
      return true;
    }
    return false;
  }  
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-23T07:59:54.313

您是否看到我在 CountingDemo 的后续文章中写的这篇文章：http: [//dotnet.agilekiwi.com/blog/2007/12/update-on-persistent-iterators.html](http://dotnet.agilekiwi.com/blog/2007/12/update-on-persistent-iterators.html)？不幸的是，微软已经确认他们可能会改变编译器的细节（有朝一日），这可能会导致问题。（例如，当您更新到新编译器时，您将无法反序列化您在旧（当前）编译器下保存的内容。）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-26T22:34:36.590

序列化委托的整个想法是非常冒险的。现在，*表达式*可能有意义，但即使这样也很难表达 - 尽管动态 LINQ 示例在某种程度上允许基于文本的表达形式。

您到底想对序列化委托*做什么？*我真的不认为这是一个好主意...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T03:35:26.980

> 由于此状态是本地状态，但在尝试设置映射时会导致问题。

本地状态不会为序列化带来完全相同的问题吗？

假设编译器和框架允许它工作：

```
Other o = FromSomeWhere();
Thing t = OtherPlace();
target.OnWhatever = () => t.DoFoo() + o.DoBar();
target.Save(); 
```

我猜 t 和 o 也必须被序列化。方法没有状态，实例有。

稍后，您反序列化目标。你没有得到 t 和 o 的新副本吗？这些副本不会与原始 t 和 o 的任何更改不同步吗？

另外：不能以这种方式调用您的手动示例吗？

```
Other o = FromSomeWhere();
Thing t = OtherPlace();
target.OnWhatever = new DoFooBar() {Other = o, Thing = t} .Run;
target.Save(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-02T21:50:04.603

功能映射会阻止我在操作/条件中使用本地状态。解决这个问题的唯一方法是为每个需要额外状态的函数创建一个类。

这就是 C# 编译器使用匿名函数自动为我做的事情。我的问题是这些编译器类的序列化。

```
 Other o = FromSomeWhere();
        Thing t = OtherPlace();
        target.OnWhatever = () => t.DoFoo() + o.DoBar();
        target.Save();c 
```

尝试序列化会失败。由于此状态是本地状态，但在尝试设置映射时会导致问题。相反，我必须声明如下内容：

```
[Serializable]
abstract class Command<T>
{
    public abstract T Run();
}

class DoFooBar : Command<int>
{
    public Other Other { get; set; }
    public Thing Thing { get; set; }

    public override int Run()
    {
        return Thing.DoFoo() + Other.DoBar(); 
    }
} 
```

然后像这样使用它：

```
 DoFooBar cmd = new DoFooBar();
        cmd.Other = FromSomewhere();
        cmd.Thing = OtherPlace();

        target.OnWhatever = cmd.Run;

        target.Save(); 
```

本质上，这意味着手动执行 C# 编译器自动为我执行的操作。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-07-09T19:17:24.100

我不是 100% 的，但我相信如果你想“保存”一个委托或一些代码到数据库中，可以相当动态，你需要做的是创建一个表达式，然后你可以编译表达式进入 Func<...>。

[表达式树基础](http://blogs.msdn.com/charlie/archive/2008/01/31/expression-tree-basics.aspx)

[带有表达式树的后期绑定调用](http://www.lostechies.com/blogs/jimmy_bogard/archive/2009/06/17/more-on-late-bound-invocations-with-expression-trees.aspx)

# php - 如何替换链接子项以创建适合播客的提要？

> ID：321834
> 
> 赞同：2
> 
> 时间：2008-11-26T19:16:32.090
> 
> 标签：php, xml, xslt, rss

我有一个 RSS 源：

```
http://feedity.com/rss.aspx/mr1-kossuth-hu/VVdXUlY 
```

```
<item>
      <title>2008\. november 23.</title>
      <link>http://www.mr1-kossuth.hu/m3u/0039c36f_3003051.m3u</link>
      <description>........</description>
      <pubDate>Wed, 26 Nov 2008 00:00:00 GMT</pubDate>
    </item> 
```

由此，我想创建一个对播客友好的提要。我想将 LINK 孩子替换为：

```
http://stream001.radio.hu:8000/content/*.mp3 
```

例子：

```
<item>
      <title>2008\. november 23.</title>
      <link>http://stream001.radio.hu:8000/content/0039c36f_3003051.mp3</link>
      <description>........</description>
      <pubDate>Wed, 26 Nov 2008 00:00:00 GMT</pubDate>
    </item> 
```

我如何在 PHP 中做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-27T00:21:04.800

**这是一个简单而纯粹的 XSLT 1.0 解决方案**，仅包含 47 行，其中一半是结束标记。**以下转换**：

```
<xsl:stylesheet 版本="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

 <xsl:输出省略-xml-declaration="yes"/>

 <xsl:param name="pNewLink"
 select="'http://stream001.radio.hu:8000/content/'"/>

 <xsl:param name="pNewExt" select="'.mp3'"/>

    <xsl:template match="node()|@*">
      <xsl:复制>
         <xsl:apply-templates select="node()|@*"/>
      </xsl:copy>
    </xsl:模板>

    <xsl:template match="链接">
      <xsl:复制>
         <xsl:copy-of select="@*"/>

         <xsl:变量名="vFName">
           <xsl:call-template name="GetFileName">
             <xsl:with-param name="pFPath" select="."/>
           </xsl:调用模板>
         </xsl:变量>

         <xsl:value-of select="concat($pNewLink,$vFName,$pNewExt)"/>
      </xsl:copy>
    </xsl:模板>

    <xsl:template name="GetFileName">
      <xsl:param name="pFPath"/>

      <xsl:选择>
        <xsl:when test="not(contains($pFPath, '/'))">
          <xsl:value-of select="substring-before($pFPath, '.')"/>
        </xsl:when>

        <xsl：否则>
          <xsl:call-template name="GetFileName">
            <xsl:with-param name="pFPath"
             select="substring-after($pFPath, '/')"/>
          </xsl:调用模板>
        </xsl:否则>
      </xsl:选择>
    </xsl:模板>
</xsl:样式表>

```

**当应用于提供的源 XML 文档时**：

```
<项目>
    <标题>2008\. 11 月 23 日。</title>
    <link>http://www.mr1-kossuth.hu/m3u/0039c36f_3003051.m3u</link>
    <description>........</description>
    <pubDate>格林威治标准时间 2008 年 11 月 26 日星期三 00:00:00</pubDate>
</项目>

```

**产生想要的结果**：

```
<项目>
    <标题>2008\. 11 月 23 日。</title>
    <link>http://stream001.radio.hu:8000/content/0039c36f_3003051.mp3</link>
    <description>........</description>
    <pubDate>格林威治标准时间 2008 年 11 月 26 日星期三 00:00:00</pubDate>
</项目>

```

**请注意此解决方案的以下**特定功能：

1.  我们使用 XSLT 设计模式来使用和覆盖[**身份转换**](http://www.w3.org/TR/xslt#copying)。

2.  **名为“GetFileName** ”的模板从完整的 URL（作为参数传递）中提取，只是去掉了文件扩展名的文件名。这**是递归调用自身的命名模板的一个很好的例子**。

3.  所需新 URL 的组成部分被指定为 global `<xsl:param>`s

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T19:22:34.557

[这是最好用XSLT](http://us.php.net/xslt)完成的事情。您可以编写一个简单的 XSL 转换来执行此操作，或者您可以使用 hacky 方式并使用 preg_match、preg_replace 和朋友。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T19:24:47.847

最简单的方法是简单的字符串替换：

```
$str = file_get_contents('http://feedity.com/rss.aspx/mr1-kossuth-hu/VVdXUlY');
$str = str_replace('<link>http://www.mr1-kossuth.hu/m3u/', '<link>http://stream001.radio.hu:8000/content/', $str);
$str = str_replace('m3u</link>', 'mp3</link>', $str); 
```

完毕！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T20:59:51.150

```
<?php
 $str = file_get_contents('http://feedity.com/rss.aspx/mr1-kossuth-hu/VVdXUlY');
 $xml = simplexml_load_string($str);
if ($xml) {

$intro = str_replace('<link>http://www.mr1-kossuth.hu/m3u/', '<enclosure url="http://stream001.radio.hu:8000/content/', $xml->asXML());
$intro = str_replace('m3u</link>', 'mp3" type="audio/mpeg" />', $intro);
echo $intro;    
} else {
    $error = "Could not load intro XML file.";
}

?> 
```

# c++ - Windows 上的 strptime() 等价物？

> ID：321849
> 
> 赞同：40
> 
> 时间：2008-11-26T19:20:48.337
> 
> 标签：c++, c, windows, datetime

是否有`strptime()`适用于 Windows 的良好等效实现？不幸的是，这个 POSIX 函数似乎不可用。

[strptime 的 Open Group 描述](http://www.opengroup.org/onlinepubs/009695399/functions/strptime.html)- 摘要：它将文本字符串转换`"MM-DD-YYYY HH:MM:SS"`为 a `tm struct`，与 . 相反`strftime()`。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2010-06-29T03:22:56.813

如果你不想移植任何代码或谴责你的项目来提升，你可以这样做：

1.  使用解析日期`sscanf`
2.  然后将整数复制到 a`struct tm`中（从月份减去 1，从年份减去 1900——月份是 0-11，年份从 1900 年开始）
3.  最后，用于`mktime`获取 UTC 纪元整数

只要记住将`isdst`成员设置`struct tm`为-1，否则您将遇到夏令时问题。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2015-11-05T10:28:24.130

假设您使用的是 Visual Studio 2015 或更高版本，您可以使用它作为 strptime 的替代品：

```
#include <time.h>
#include <iomanip>
#include <sstream>

extern "C" char* strptime(const char* s,
                          const char* f,
                          struct tm* tm) {
  // Isn't the C++ standard lib nice? std::get_time is defined such that its
  // format parameters are the exact same as strptime. Of course, we have to
  // create a string stream first, and imbue it with the current C locale, and
  // we also have to make sure we return the right things if it fails, or
  // if it succeeds, but this is still far simpler an implementation than any
  // of the versions in any of the C standard libraries.
  std::istringstream input(s);
  input.imbue(std::locale(setlocale(LC_ALL, nullptr)));
  input >> std::get_time(tm, f);
  if (input.fail()) {
    return nullptr;
  }
  return (char*)(s + input.tellg());
} 
```

请注意，对于跨平台应用程序，`std::get_time`直到 GCC 5.1 才实现，因此`std::get_time`可能无法选择直接调用。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-11-26T19:29:30.427

`strptime()`可以在此处找到开源版本（BSD 许可证） ：[http://cvsweb.netbsd.org/bsdweb.cgi/src/lib/libc/time/strptime.c?rev=HEAD](http://cvsweb.netbsd.org/bsdweb.cgi/src/lib/libc/time/strptime.c?rev=HEAD)

您需要添加以下声明才能使用它：

```
char *strptime(const char * __restrict, const char * __restrict, struct tm * __restrict); 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-11-26T19:56:05.630

这可以完成工作：

```
#include "stdafx.h"
#include "boost/date_time/posix_time/posix_time.hpp"
using namespace boost::posix_time;

int _tmain(int argc, _TCHAR* argv[])
{
    std::string ts("2002-01-20 23:59:59.000");
    ptime t(time_from_string(ts));
    tm pt_tm = to_tm( t ); 
```

但是请注意，输入字符串是 YYYY-MM-DD

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2015-03-06T09:07:09.827

一种替代方法是使用`GetSystemTime`时间信息并将其发送到一个函数，该函数根据您的格式使用`vsnprintf_s`. 在下面的示例中，有一个函数可以创建毫秒精度的时间字符串。然后它将字符串发送到一个函数，该函数根据所需的格式对其进行格式化：

```
#include <string>
#include <cstdio>
#include <cstdarg>
#include <atlstr.h> 

std::string FormatToISO8601 (const std::string FmtS, ...) {
   CStringA BufferString;
   try {
       va_list VaList;
       va_start (VaList, FmtS);
       BufferString.FormatV (FmtS.c_str(), VaList);
   } catch (...) {}
   return std::string (BufferString);
}

void CreateISO8601String () {
   SYSTEMTIME st;
   GetSystemTime(&st);
   std::string MyISO8601String = FormatToISO8601 ("%4u-%02u-%02uT%02u:%02u:%02u.%03u", st.wYear, st.wMonth, st.wDay, st.wHour, st.wMinute, st.wSecond, st.wMilliseconds);
} 
```

# bios - 在 LINGO 中获取 BIOS 时间

> ID：321858
> 
> 赞同：1
> 
> 时间：2008-11-26T19:24:14.460
> 
> 标签：bios, lingo

谁能告诉我如何在 Lingo 中获取 BIOS 时间？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T00:19:41.590

_system.time() 会给你系统时间。您还可以使用良好的旧 Lingo 语法“systemDate”，它是一个具有诸如“.seconds”之类的属性的对象。

要访问 BIOS 可能需要自定义构建的 xtra。您可以在 Delphi 或 C/C++ 中构建一个，但要使其可自动下载，如果我没记错的话，您需要签名（自从我制作了很久以来）。:-)

# xml - 如何使用带有样式表和 xsltproc 的 xslt 从 xml 中删除元素？

> ID：321860
> 
> 赞同：71
> 
> 时间：2008-11-26T19:24:56.783
> 
> 标签：xml, xslt, xslt-1.0, xslt-2.0

我有很多具有以下形式的 XML 文件：

```
<Element fruit="apple" animal="cat" /> 
```

我想从文件中删除。

使用 XSLT 样式表和 Linux 命令行实用程序 xsltproc，我该怎么做？

到目前为止，在脚本中我已经有了包含要删除的元素的文件列表，因此可以将单个文件用作参数。

* * *

**编辑：**这个问题最初缺乏意图。

我想要实现的是删除整个元素“元素” where (fruit=="apple" && animal=="cat")。在同一个文档中有许多名为“元素”的元素，我希望这些元素能够保留。所以

```
<Element fruit="orange" animal="dog" />
<Element fruit="apple"  animal="cat" />
<Element fruit="pear"   animal="wild three eyed mongoose of kentucky" /> 
```

会成为：

```
<Element fruit="orange" animal="dog" />
<Element fruit="pear"   animal="wild three eyed mongoose of kentucky" /> 
```

* * *

## 回答 #1

> 赞同：136
> 
> 时间：2008-11-26T20:44:27.340

使用最基本的 XSLT 设计模式之一：“重写[**身份转换**](https://www.w3.org/TR/1999/REC-xslt-19991116#copying)”只需编写以下内容：

```
<xsl:stylesheet 版本="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

 <xsl:输出省略-xml-declaration="yes"/>

    <xsl:template match="node()|@*">
      <xsl:复制>
         <xsl:apply-templates select="node()|@*"/>
      </xsl:copy>
    </xsl:模板>

    <xsl:template match="元素[@fruit='apple' and @animal='cat']"/>
</xsl:样式表>

```

**请注意**，第二个模板如何仅针对名为“Element”的元素覆盖标识（第一个）模板，这些元素具有属性“fruit”，值为“apple”，属性“animal”，值为“cat”。这个模板的主体是空的，这意味着匹配的元素被简单地忽略（匹配时什么都不产生）。

当此转换应用于以下源 XML 文档时：

```
<文档>...
    <Element name="same">foo</Element>...
    <元素水果=“苹果”动物=“猫”/>
    <元素水果="梨" 动物="猫" />
    <Element name="same">baz</Element>...
    <Element name="same">foobar</Element>...
</doc>

```

产生了想要的结果：

```
<文档>...
    <Element name="same">foo</Element>...
    <元素水果=“梨”动物=“猫”/>
    <Element name="same">baz</Element>...
    <Element name="same">foobar</Element>...
</doc>

```

可以在**[此处](http://www.dpawson.co.uk/xsl/sect2/identity.html)**找到更多使用和覆盖身份模板的代码片段。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2019-03-08T21:53:57.517

[@Dimitre Novatchev](https://stackoverflow.com/users/36305/dimitre-novatchev)的答案当然既正确又优雅，但有一个概括（OP 没有问）：如果您要过滤的元素也有您想要*保留*的子元素或文本怎么办？

我相信这个微小的变化涵盖了这种情况：

```
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    version="2.0">

    <xsl:template match="node()|@*">
        <xsl:copy>
            <xsl:apply-templates select="node()|@*"/>
        </xsl:copy>
    </xsl:template>

    <!-- drop DropMe elements, keeping child text and elements -->
    <xsl:template match="DropMe">
        <xsl:apply-templates/>
    </xsl:template>

</xsl:stylesheet> 
```

指定其他属性等的匹配条件可能很复杂，如果您要删除其他内容，则可以使用多个此类模板。

所以这个输入：

```
<?xml version="1.0" encoding="UTF-8"?>
<mydocument>
    <p>Here's text to keep</p>
    <p><DropMe>Keep this text but not the element</DropMe>; and keep what follows.</p>
    <p><DropMe>Also keep this text and <b>this child element</b> too</DropMe>, along with what follows.</p>
</mydocument> 
```

产生这个输出：

```
<?xml version="1.0" encoding="UTF-8"?><mydocument>
    <p>Here's text to keep</p>
    <p>Keep this text but not the element; and keep what follows.</p>
    <p>Also keep this text and <b>this child element</b> too, along with what follows.</p>
</mydocument> 
```

归功于[XSLT Cookbook](https://learning.oreilly.com/library/view/xslt-cookbook/0596003722/ch04s04.html)。

# css - 将边距应用于除 iframe 之外的所有内容

> ID：321861
> 
> 赞同：2
> 
> 时间：2008-11-26T19:25:20.030
> 
> 标签：css, iframe

我有一个使用'css a'的'page a'。此页面在 css 中设置了边距。我还有一个使用'css b'的'page b'。此页面还设置了 css 中的边距，大小与 'css a' (10px) 中的相同。

有什么办法可以让我在单独查看“页面 a”时有边距，但是当在“页面 b”上的 iframe 中查看时，边距不适用于“页面 a”。我知道这是一个很长的问题，但基本问题是我在 iframe 中的内容得到了“双倍边距”：“页面 a”的边距，然后是“页面 b”的边距！

我想这样做的一种方法是设置 iframe 不受“页面 a”边距的影响。有什么方法可以设置'css a'从边距中排除iframe，这样只有css b的边距才会应用，页面仍然对齐。那可能吗？

谢谢你的帮助

马特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T22:15:21.573

我真的很抱歉，我知道每个人都对发布答案而不是评论我很不高兴，因为我是新来的堆栈溢出和学习。怜悯！我已经弄清楚我做错了什么，现在我有了这个“开放 ID”的东西，我会尝试在正确的地方发布。恐怕这次我必须发布作为答案，因为我在没有公开身份的情况下开始了这个问题，所以仍然无法评论那些东西......

好的，现在这是一个“测试用例”：[http ://cart3.jaspers-sensations.com/test/pagea.html](http://cart3.jaspers-sensations.com/test/pagea.html)

b页是：[http](http://cart3.jaspers-sensations.com/test/pageb.html) : //cart3.jaspers-sensations.com/test/pageb.html css a是：http: [//cart3.jaspers-sensations.com/test/stylea.css](http://cart3.jaspers-sensations.com/test/stylea.css) css b是：[http:// cart3.jaspers-sensations.com/test/styleb.css](http://cart3.jaspers-sensations.com/test/styleb.css)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T19:26:41.430

如果页面位于 iframe 内，您可以使用 Javascript 更改边距。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T19:29:59.833

我不知道从 a.css 中指定它的方法，但是如果将以下内容添加到 b.css：

```
iframe { margin:-10px; } 
```

......它可能会工作。

编辑：带有 a.html 的 iframe 是 b.html 中包含的唯一项目吗？
你有测试文件吗？

编辑（2）：在 css 中，您可以将其指定为

```
iframe#head { ...; } 
```

另外，我认为您可以对自己的问题的回答发表评论。我可以用[我](https://stackoverflow.com/questions/319634/can-you-figure-out-why-this-program-is-triggering-a-illegalstateexception)的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-27T22:46:35.520

阅读[了您的说明](https://stackoverflow.com/questions/321861/apply-margins-to-all-but-iframe#322352)后，我认为您不能仅使用 CSS 来做到这一点。我很确定 CSS 不能跨越框架。

但是，如果两个文档在同一个域中，您应该可以使用 JavaScript 来执行此操作。

例如，这应该适用于您的示例页面。将以下属性添加到`<iframe>`：

```
 onload="window.frames[0].document.body.style.margin = 0" 
```

至少在 Firefox 3 和 Opera 9 中有效。但它绝对是老式的 JavaScript，并且考虑到我的浏览器在变体中的工作方式有点变化无常，我不确定将其应用于真实站点有多容易。

比我更精通 JavaScript 的人应该能够提供帮助。

这可能会有所帮助：

*   [访问 iframe 中的文档](http://xkr.us/articles/dom/iframe-document/)

# java - Java 动态绑定和方法覆盖

> ID：321864
> 
> 赞同：90
> 
> 时间：2008-11-26T19:26:21.680
> 
> 标签：java, inheritance, dynamic-binding

昨天我有一个两个小时的技术电话面试（我通过了，哇哦！），但我完全掩盖了以下关于 Java 中的动态绑定的问题。更令人费解的是，几年前当我还是一名助教时，我曾经向本科生教授这个概念，所以我给他们错误信息的前景有点令人不安……

这是我遇到的问题：

```
/* What is the output of the following program? */

public class Test {

  public boolean equals( Test other ) {
    System.out.println( "Inside of Test.equals" );
    return false;
  }

  public static void main( String [] args ) {
    Object t1 = new Test();
    Object t2 = new Test();
    Test t3 = new Test();
    Object o1 = new Object();

    int count = 0;
    System.out.println( count++ );// prints 0
    t1.equals( t2 ) ;
    System.out.println( count++ );// prints 1
    t1.equals( t3 );
    System.out.println( count++ );// prints 2
    t3.equals( o1 );
    System.out.println( count++ );// prints 3
    t3.equals(t3);
    System.out.println( count++ );// prints 4
    t3.equals(t2);
  }
} 
```

我断言输出应该是覆盖`equals()`方法中的两个单独的打印语句： at`t1.equals(t3)`和`t3.equals(t3)`. 后一种情况很明显，而前一种情况，即使`t1`有一个Object类型的引用，它也被实例化为Test类型，所以动态绑定应该调用方法的覆盖形式。

显然不是。我的面试官鼓励我自己运行程序，你瞧，被覆盖的方法只有一个输出：在 line `t3.equals(t3)`。

那么我的问题是，为什么？正如我已经提到的，即使`t1`是 Object 类型的引用（因此静态绑定会调用 Object 的`equals()`方法），动态绑定*应该*注意根据引用的实例化类型调用最具体的方法版本。我错过了什么？

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2008-11-26T21:33:10.880

Java 对重载方法使用静态绑定，对重载方法使用动态绑定。在您的示例中，equals 方法被重载（具有与 Object.equals() 不同的参数类型），因此调用的方法在编译时绑定到**引用类型。**

[这里](http://forums.techarena.in/software-development/1070300.htm)有一些讨论

它是 equals 方法这一事实并不真正相关，除了重载而不是覆盖它是一个常见的错误，根据你在面试中对问题的回答，你已经意识到了这一点。

编辑：[这里](http://skeletoncoder.blogspot.com/2006/09/java-tutorials-overloading-is-compile.html)也有很好的描述。此示例显示了与参数类型相关的类似问题，但由同一问题引起。

我相信如果绑定实际上是动态的，那么调用者和参数是 Test 实例的任何情况都会导致调用被覆盖的方法。所以 t3.equals(o1) 将是唯一不会打印的情况。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-11-26T19:35:06.110

的`equals`方法`Test`不会覆盖 的`equals`方法`java.lang.Object`。看参数类型！该类`Test`使用`equals`接受`Test`.

如果该`equals`方法旨在覆盖，则应使用 @Override 注释。这会导致编译错误指出这个常见的错误。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-26T19:47:18.597

有趣的是，在 Groovy 代码中（可以编译为类文件），除了一个调用之外，所有调用都会执行 print 语句。（将 Test 与 Object 进行比较显然不会调用 Test.equals(Test) 函数。）这是因为 groovy 确实进行了完全动态类型。这特别令人感兴趣，因为它没有任何显式动态类型的变量。我在几个地方读到这被认为是有害的，因为程序员希望 groovy 做 java 的事情。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-26T19:39:00.360

Java 不支持参数的协变，只支持返回类型。

换句话说，虽然您在覆盖方法中的返回类型可能是它在覆盖方法中的子类型，但对于参数而言并非如此。

如果您在 Object 中的 equals 参数是 Object，则在子类中将 equals 与其他任何东西放在一起将是一个重载，而不是一个被覆盖的方法。因此，调用该方法的唯一情况是当参数的静态类型为 Test 时，如 T3 的情况。

祝面试过程顺利！我很想在一家提出这类问题的公司接受面试，而不是我教给学生的常见算法/数据结构问题。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-26T19:31:11.297

我认为关键在于 equals() 方法不符合标准：它接受另一个 Test 对象，而不是 Object 对象，因此没有覆盖 equals() 方法。这意味着您实际上只是在给它 Test 对象同时给它 Object 对象调用 Object.equals(Object o) 时重载它来做一些特殊的事情。通过任何 IDE 查看该代码应该会显示两个用于测试的 equals() 方法。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-26T19:34:47.123

该方法被重载而不是被覆盖。Equals 总是将 Object 作为参数。

顺便说一句，你在 Bloch 的有效 java 中有一个项目（你应该拥有）。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-03-16T09:19:41.630

搜索一段时间后，**动态绑定**(DD) 和**静态绑定̣̣̣** (SB)中的一些注释：

**1.定时执行**：（Ref.1）

*   DB：在运行时
*   SB：编译器时间

**2.用于**：

*   DB：压倒一切
*   SB：重载（静态、私有、最终）（参考文献 2）

**参考：**

1.  执行更喜欢使用哪种方法的平均解析器
2.  因为不能用修饰符 static、private 或 final 覆盖方法
3.  [http://javarevisited.blogspot.com/2012/03/what-is-static-and-dynamic-binding-in.html](http://javarevisited.blogspot.com/2012/03/what-is-static-and-dynamic-binding-in.html)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-10-30T21:38:14.900

如果添加了另一个覆盖而不是重载的方法，它将在运行时解释动态绑定调用。

/* 下面程序的输出是什么？*/

```
public class DynamicBinding {
    public boolean equals(Test other) {
        System.out.println("Inside of Test.equals");
        return false;
    }

    @Override
    public boolean equals(Object other) {
        System.out.println("Inside @override: this is dynamic binding");
        return false;
    }

    public static void main(String[] args) {
        Object t1 = new Test();
        Object t2 = new Test();
        Test t3 = new Test();
        Object o1 = new Object();

        int count = 0;
        System.out.println(count++);// prints 0
        t1.equals(t2);
        System.out.println(count++);// prints 1
        t1.equals(t3);
        System.out.println(count++);// prints 2
        t3.equals(o1);
        System.out.println(count++);// prints 3
        t3.equals(t3);
        System.out.println(count++);// prints 4
        t3.equals(t2);
    }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-07-12T20:04:17.190

我发现了一篇关于动态与静态绑定的有趣文章。它带有一段用于模拟动态绑定的代码。它使我的代码更具可读性。

[https://sites.google.com/site/jeffhartkopf/covariance](https://sites.google.com/site/jeffhartkopf/covariance)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-26T21:59:39.997

“为什么”这个问题的答案 这就是Java语言的定义方式。

引用[关于协方差和逆变的维基百科文章](http://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)#Java)：

> 返回类型协方差在 Java 编程语言版本 J2SE 5.0 中实现。方法重写的参数类型必须完全相同（不变），否则方法会被并行定义重载。

其他语言不一样。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-11-16T09:46:51.990

很明显，这里没有覆盖的概念。它是方法重载。Object 类的`Object()`方法采用 Object 类型的引用参数，该`equal()`方法采用 Test 类型的引用参数。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2017-04-03T10:16:27.393

我将尝试通过两个示例来解释这一点，这些示例是我在网上遇到的一些示例的扩展版本。

```
public class Test {

    public boolean equals(Test other) {
        System.out.println("Inside of Test.equals");
        return false;
    }

    @Override
    public boolean equals(Object other) {
        System.out.println("Inside of Test.equals ot type Object");
        return false;
    }

    public static void main(String[] args) {
        Object t1 = new Test();
        Object t2 = new Test();
        Test t3 = new Test();
        Object o1 = new Object();

        int count = 0;
        System.out.println(count++); // prints 0
        o1.equals(t2);

        System.out.println("\n" + count++); // prints 1
        o1.equals(t3);

        System.out.println("\n" + count++);// prints 2
        t1.equals(t2);

        System.out.println("\n" + count++);// prints 3
        t1.equals(t3);

        System.out.println("\n" + count++);// prints 4
        t3.equals(o1);

        System.out.println("\n" + count++);// prints 5
        t3.equals(t3);

        System.out.println("\n" + count++);// prints 6
        t3.equals(t2);
    }
} 
```

这里，对于计数值为 0、1、2 和 3 的行；我们在方法上有*o1*和*t1*的**Object***参考*。因此，在编译时，来自*Object.class*文件的方法将是有界的。 ****`equals()``equals()`****

 *****但是，即使*t1*的*引用*是**Object**，它也有Test**类的***初始化*。 . 因此，在运行时它调用which 是 ******`Object t1 = new Test();`
`public boolean equals(Object other)`******

 ******> 被覆盖的方法

. [![在此处输入图像描述](https://i.stack.imgur.com/lXG5b.jpg)](https://i.stack.imgur.com/lXG5b.jpg)

现在，对于 4 和 6 的计数值，具有*引用*和*初始化Test 的**t3*再次调用带有参数作为对象引用的方法，并且是**`equals()`**

 **> 重载方法

好的！

> 同样，为了更好地理解编译器将调用什么方法，只需单击该方法，Eclipse 将突出显示它认为将在编译时调用的相似类型的方法。如果它在编译时没有被调用，那么这些方法就是方法覆盖的一个例子。

[![在此处输入图像描述](https://i.stack.imgur.com/6PbaF.jpg)](https://i.stack.imgur.com/6PbaF.jpg)

# javascript - 如何清除或替换缓存的图像

> ID：321865
> 
> 赞同：49
> 
> 时间：2008-11-26T19:26:24.770
> 
> 标签：javascript, image, caching, replace

我知道有很多方法可以防止图像缓存（例如通过 META 标签），以及一些很好的技巧来确保每次页面加载时都会显示图像的当前版本（例如 image.jpg?x=timestamp )，但是有什么方法可以真正清除或替换浏览器缓存中的图像，这样上述两种方法都不是必需的吗？

例如，假设页面上有 100 张图像，这些图像被命名为“01.jpg”、“02.jpg”、“03.jpg”等。如果替换图像“42.jpg”，则为有什么办法可以在缓存中替换它，以便“42.jpg”在连续页面加载时自动显示新图像？我不能使用 META 标记方法，因为我需要 ISN"T 替换的所有内容以保持缓存，并且我不能使用时间戳方法，因为我不希望每次页面都重新加载所有图像负载。

我已经绞尽脑汁并在互联网上搜索了一种方法（最好是通过javascript），但没有运气。有什么建议么？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-11-26T19:28:40.520

如果您正在动态编写页面，则可以将上次修改的时间戳添加到 URL：

`<img src="image.jpg?lastmod=12345678" ...`

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-26T19:29:20.130

`<meta>`绝对无关紧要。事实上，您根本不应该尝试使用它来控制缓存（当任何东西读取文档内容时，它已经被缓存了）。

在 HTTP 中，每个 URL 都是独立的。无论您对 HTML 文档做什么，它都不会应用于图像。

要控制缓存，您可以在每次内容更改时更改 URL。如果您不时更新图像，请允许它们永久缓存并为新图像使用新文件名（带有版本、哈希或日期）——这是长期文件的最佳解决方案。

如果您的图像经常更改（每隔几分钟，甚至在每次请求时），则发送`Cache-control: no-cache`或`Cache-control: max-age=`*`xx`*其中*xx*是图像“新鲜”的秒数。

短期文件的随机 URL 是个坏主意。它会用无用的文件污染缓存，并强制尽快清除有用的文件。

如果您有 Apache，`mod_headers`然后使用适当的规则`mod_expires`创建文件。`.htaccess`

```
<Files ~ "-nocache\.jpg">
   Header set Cache-control "no-cache"
</Files> 
```

以上将使`*-nocache.jpg`文件不可缓存。

您还可以通过 PHP 脚本提供图像（默认情况下它们具有糟糕的缓存能力；）

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2014-03-15T22:17:29.917

与其他一些答案所说的相反，客户端javascript有一种方法可以替换缓存的图像*。*诀窍是创建一个 hidden `<iframe>`，将其`src`属性设置为图像 URL，等待它加载，然后通过调用强制重新加载它`location.reload(true)`。这将更新图像的缓存副本。然后，您可以替换`<img>`页面上的元素（或重新加载页面）以查看图像的更新版本。

（小警告：如果更新单个`<img>`元素，并且如果有多个具有更新的图像，则必须全部清除或删除它们，然后替换或重置它们。如果您一个接一个地进行，一些浏览器会从其他标签复制图像的内存版本，结果是您可能看不到更新的图像，尽管它在缓存中）。

[我在这里](https://stackoverflow.com/a/22429796/999120 "我的回答：在相同的 url 上用新的图像刷新图像")发布了一些代码来进行这种更新。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2012-10-25T11:52:11.093

像这样更改图像 url，在查询字符串中添加一个随机字符串。

```
"image1.jpg?" + DateTime.Now.ToString("ddMMyyyyhhmmsstt"); 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-26T19:29:34.810

我确信大多数浏览器都尊重[Last-Modified](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.29) HTTP 标头。将它们发送出去并请求新图像。如果 Last-Modified 行没有改变，它将被浏览器缓存。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-11-24T15:34:42.150

您可以在图像上附加一个随机数，就像给它一个新版本一样。我已经实现了类似的逻辑，并且运行良好。

```
<script>
var num = Math.random();
var imgSrc= "image.png?v="+num;
$(function() {
$('#imgID').attr("src", imgSrc);
})
</script> 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-26T23:48:25.787

不，没有办法强制删除浏览器缓存中的文件，无论是通过网络服务器还是通过您可以放入它发送的文件中的任何内容。浏览器缓存归浏览器所有，由用户控制。

因此，您应该将每个文件和每个 URL 视为应谨慎管理的宝贵资源。

因此，porneL 对图像文件进行版本控制的建议似乎是最好的长期答案。ETAG在正常情况下使用，但也许你的努力已经无效了？按照建议尝试更改 ETAG。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-26T19:28:35.530

使用 ?x=timestamp 技巧的原因是因为这是基于每个图像执行此操作的唯一方法。即动态生成图像名称并指向输出图像的应用程序。

我建议您在服务器端弄清楚图像是否已更改/更新，如果是，则使用 ?x=timestamp 技巧输出您的标签以强制使用新图像。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2021-04-30T15:55:39.477

我发现[这篇](https://www.fastly.com/blog/clearing-cache-browser)关于如何缓存任何文件的文章

在这篇文章中有很多方法可以强制缓存破坏，但这是我为我的图像做的方式：

```
fetch('/thing/stuck/in/cache', {method:'POST', credentials:'include'}); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-09-16T17:51:39.757

See [http://en.wikipedia.org/wiki/URI_scheme](http://en.wikipedia.org/wiki/URI_scheme)

Notice that you can provide a unique username:password@ combo as a prefix to the domain portion of the uri. In my experimentation, I've found that inclusion of this with a fake ID (or password I assume) results in the treatment of the resource as unique - thus breaking the caching as you desire.

Simply use a timestamp as the username and as far as I can tell the server ignores this portion of the uri as long as authentication is not turned on.

Btw - I also couldn't use the tricks above with a google map marker icon caching problem I was having where the ?param=timestamp trick worked, but caused issues with disappearing overlays. Never could figure out why this was happening, but so far so good using this method. What I'm unsure of, is if passing fake credentials will have any adverse server performance affects. If anyone knows I'd be interested to know as I'm not yet in high volume production.

Please report back your results.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-26T19:29:22.627

更改图像的 ETAG。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-04-16T10:36:43.080

这是使用 PHP 函数 filemtime() 的解决方案：

```
<?php 
     $addthis = filemtime('myimf.jpg');
?> 
<img src="myimg.jpg?"<?= $addthis;?> > 
```

使用文件修改时间作为参数将导致它从缓存版本中读取，直到文件发生更改。这种方法比使用随机数更好，因为如果文件没有更改，缓存仍然可以工作。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2019-11-27T21:37:51.587

听起来您的问题的基础是如何从缓存中获取旧版本的图像。我已经成功地进行了一个新的调用并在标头中指定不要从缓存中提取。获取后您只是将其丢弃，但浏览器的缓存此时应该具有更新的图像。

```
 var headers = new Headers()
    headers.append('pragma', 'no-cache')
    headers.append('cache-control', 'no-cache')

    var init = {
      method: 'GET',
      headers: headers,
      mode: 'no-cors',
      cache: 'no-cache',
    }

    fetch(new Request('path/to.file'), init) 
```

但是，重要的是要认识到这只会影响调用它的浏览器。如果您希望在替换图像后为任何浏览器提供新版本的文件，则需要通过服务器配置来完成。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-12-17T13:06:10.993

当更改图像文件名不是一个选项时，请使用服务器端会话变量和 javascript`window.location.reload()`函数。如下：

**上传完成后：**

```
Session("reload") = "yes" 
```

**在 page_load 上：**

```
If Session("reload") = "yes" Then
    Session("reload") = Nothing
    ClientScript.RegisterStartupScript(Me.GetType), "ReloadImages", "window.location.reload();", True)
End If 
```

这允许客户端浏览器仅刷新一次，因为会话变量在一次发生后被重置。

希望这可以帮助。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-26T20:14:42.813

> 如果重新上传图像，有没有办法清除或替换以前缓存的图像客户端？在我上面的例子中，目标是让浏览器忘记“42.jpg”是什么

你在运行Firefox对吗？

*   查找`Tools`菜单
*   选择`Clear Private Data`
*   取消勾选除确保`Cache`已选中之外的所有复选框
*   按确定

:-)

说真的，我从来没有听说过这样的东西存在，我怀疑是否有它的 API。我无法想象浏览器开发人员让你在他们的缓存中四处寻找是个好主意，而且我看不出他们有任何动机来实现这样的功能。

> 我不能使用 META 标记方法或时间戳方法，因为我希望在正常情况下缓存所有图像。

为什么不能使用时间戳（或 etag，相当于同一件事）？请记住，您应该使用*图像文件本身*的时间戳，而不仅仅是`Time.Now`.
我讨厌成为坏消息的传递者，但你别无选择。

如果图像没有改变，时间戳也不会改变，所以一切都会“在正常情况下”被缓存。如果图像确实发生了变化，他们将获得一个新的时间戳（出于缓存原因，他们需要这样做），但是该时间戳将永远保持有效，直到有人再次替换图像。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-12-06T14:06:04.607

要替换 pictore 的缓存，您可以在服务器端存储一些版本值，当您加载图片时，只需发送此值而不是时间戳。当您的图像将更改时，请更改其版本。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-12-28T07:50:16.797

经过大量测试，我通过以下方式找到了解决方案。

1-我创建一个临时文件夹来复制名称添加时间（）的图像..（如果文件夹存在我删除内容）

2-从该临时本地文件夹加载图像

通过这种方式，我始终确保浏览器永远不会缓存图像并且 100% 正确工作。

```
if (!is_dir(getcwd(). 'articulostemp')){
    $oldmask = umask(0);mkdir(getcwd(). 'articulostemp', 0775);umask($oldmask);
}else{
    rrmfiles(getcwd(). 'articulostemp');
}   
foreach ($images as $image) { 
    $tmpname = time().'-'.$image;
    $srcimage = getcwd().'articulos/'.$image;
    $tmpimage = getcwd().'articulostemp/'.$tmpname;
    copy($srcimage,$tmpimage);
    $urlimage='articulostemp/'.$tmpname;
    echo '  <img loading="lazy" src="'.$urlimage.'"/>   ';                  
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-10-03T11:40:12.487

试试这个代码片段：

```
var url = imgUrl? + Math.random(); 
```

这将确保每个请求都是唯一的，因此您将始终获得最新的图像。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-11-24T19:11:07.373

由于这里的大多数（如果不是全部）答案和评论都是问题部分的副本，或者足够接近，我将投入 2 美分。

我只想指出，即使有一种方法，也很难实施。它的逻辑使我们陷入困境。从一个逻辑的角度来看，告诉浏览器替换列表中每个更改图像的缓存图像，因为某个日期是理想的但是......你什么时候会删除列表，你怎么知道每个人都有最新版本谁会访问再次？

因此，正如 OP 所要求的，我的第一个“建议”是这个列表理论。

我如何看待这样做是：

A.) 有一个可以存储我们动态和手动更改的图像 url 的列表。

B.) 设置一个截止日期，在该日期将重置捕获并且无论如何都会截断列表。

C.0）通过 i 框架检查站点入口与浏览器的列表，该列表可以在后台运行，并设置较短的缓存标头，以根据列表中最远的日期或类似性质的方式重新缓存它们。

C.1) 使用 Iframe 或 ajax/xhr 请求我认为您可以遍历列表中的每个图像，刷新页面以显示不同的图像，并根据其自己的修改日期检查缓存。因此，在此图像的 onload 上，使用服务器端来解密它是否不是最后一个图像，当它被加载时转到下一个图像。

C.1a）这意味着我们的列表可能需要每个图像的更多信息，我认为很明显可能需要一些服务器端脚本来根据每个图像的要求调整标题，以最大程度地减少重新缓存更改站点的脚步图片。

我的第二个“建议”是通知用户更改并指导他们清除缓存。（小心，尽可能仅删除图像和文件，或警告他们由于该过程而删除数据）

PS这只是一个受过教育的想法。一个快速的理论。如果/当我成功时，我会发布决赛。可能不在这里，因为它需要服务器端脚本。这至少是 OP 的问题中没有提到的一个建议，他说他已经尝试过了。

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2016-09-14T12:24:00.037

尝试以下解决方案，

myImg.src = " [http://localhost/image.jpg](http://localhost/image.jpg) ?" + 新日期（）.getTime（）；

以上解决方案对我有用:)

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2017-01-27T15:55:10.797

我通常会像@Greg 告诉我们的那样做，我有一个功能：

```
function addMagicRefresh(url)
{
    var symbol = url.indexOf('?') == -1 ? '?' : '&';
    var magic = Math.random()*999999;
    return url + symbol + 'magic=' + magic;
} 
```

这将起作用，因为您的服务器接受它并且您不以任何其他方式使用“魔术”参数。

我希望它有所帮助。

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2014-10-20T19:37:11.077

我尝试了一些非常简单的方法：

转到网站的 FTP 文件夹并将 IMG 文件夹重命名为 IMG2。刷新您的网站，您将看到图像将丢失。然后将文件夹 IMG2 重命名回 IMG 就完成了，至少它在 Safari 中对我有用。

# windows - Visual Studio 2008 安装程序项目 - 自定义操作未触发

> ID：321867
> 
> 赞同：4
> 
> 时间：2008-11-26T19:26:33.037
> 
> 标签：windows, visual-studio, visual-studio-2008, windows-installer

我似乎无法使自定义操作起作用。我可能做错了。这是我正在尝试做的事情：

我想在运行可执行文件的应用程序安装（Visual Studio 安装程序项目）中运行自定义操作。该可执行文件仅执行一些 system.io 文件复制任务，并且我已经确认该可执行文件在单独运行时可以完美运行。

1.  我创建了安装程序项目
2.  将exe添加到应用程序文件夹
3.  转到自定义操作并将exe添加到提交步骤
4.  InstallerClass 设置为 true
5.  运行安装程序，没有得到我希望的结果。所以我添加了一行写入 Windows 日志。再次运行安装程序后查看 Windows 日志，看起来它没有运行。在 exe 代码中添加了 debug.break 取消安装/重新安装了我的安装程序，但什么也没发生。我终于坐下来观看了这些过程，并确认 exe 永远不会被执行。

有什么想法吗？

目标系统：Windows XP、Vista Visual Studio 版本：2008 Sp1 语言：VB.NET 目标框架：2.0

* * *

优秀的。由于您发布的代码，我想我越来越近了。我将其转换为 VB，但出现此错误：找不到 myexename.savedstate。我想我应该向您发布的潜艇传递一些东西，但我不知道是什么。（顺便说一句，这是一个控制台应用程序）我添加了对 System.Configuration.Install.dll 的引用，这是我的代码：

```
导入 System.ComponentModel
导入 System.Configuration.Install

 _
    公共类ApplicationInstaller
        继承安装程序
        公共重载覆盖 Sub Commit(ByVal savedState As IDictionary)
            ' 在提交上做一些工作
            The_Sub_I_Want_To_Run()
        结束子
        公共重载覆盖子安装（ByVal stateSaver As IDictionary）
            ' 做一些安装工作
        结束子
        公共重载覆盖子卸载（ByVal savedState As IDictionary）
            ' 做一些卸载工作
        结束子
    结束类

```

* * *

我没有这么叫。我以前从未使用过 Installer 类。我可能在这里做一些非常菜鸟的事情。根据您的指示，我已将粘贴在下面的代码添加到我要在安装期间运行的 exe 中。我将 exe 添加到我的应用程序文件夹中，然后将其添加到提交自定义操作中。现在这是我现在尝试运行的 exe 源代码中的代码：

 ````
 _
    Public Class ApplicationInstaller
        Inherits Installer
        Public Overloads Overrides Sub Commit(ByVal savedState As IDictionary)
            ' Do some work on commit
            The_Sub_I_Have_my_codein()
            MyBase.Commit(savedState)
        End Sub
        Public Overloads Overrides Sub Install(ByVal stateSaver As IDictionary)
            ' Do some work on install

        End Sub
        Public Overloads Overrides Sub Uninstall(ByVal savedState As IDictionary)
            ' Do some work on uninstall
        End Sub
    End Class 

```

* * *

嗯...在 exe 的项目属性中，我单击了“签署程序集”，错误消失了。但是，看起来 exe 没有运行我想要的代码。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-26T19:35:13.720

The exe or library you are adding to the Commit step should contain a class deriving from [Installer](http://msdn.microsoft.com/en-us/library/system.configuration.install.installer.aspx) and marked with the [RunInstaller](http://msdn.microsoft.com/en-us/library/system.componentmodel.runinstallerattribute.aspx) attribute as follows:

```
[RunInstaller(true)]
public class ApplicationInstaller : Installer
{
    public override void Commit(IDictionary savedState) {
      // Do some work on commit
    }
    public override void Install(IDictionary stateSaver) {
      // Do some work on install
    }
    public override void Uninstall(IDictionary savedState) {
      // Do some work on uninstall
    }
} 
```

Hope this helps.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T20:26:40.357

Are you calling the base method?

```
public override void Commit(IDictionary savedState) {
    // Do some work on commit
    base.Commit(savedState);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T11:06:05.900

Set

```
InstallerClass
```

property to 'false'.

# visual-studio - 如何在 Visual Studio 中移动“解决方案资源管理器”选项卡

> ID：321873
> 
> 赞同：34
> 
> 时间：2008-11-26T19:29:18.053
> 
> 标签：visual-studio, ide, visual-studio-2005, development-environment, tabs

有谁知道如何在 Visual Studio 2005 中移动“解决方案资源管理器”选项卡？它在左边，我不能把它移到右边。

谢谢，

艾伦

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-11-26T19:30:41.407

单击标题栏，并将其拖动到屏幕的右侧。最终你会看到一个类似结构的弹出窗口。确保将鼠标悬停在正确的区域上并松开鼠标按钮。这会将其绑定到右侧。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2014-06-13T07:38:07.537

您可以转到选项卡 Windows -> 重置 Windows 布局。其他选项，如 Dockable、Floating 和 Tabbed Document 也是他们的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-07-16T09:01:51.070

您移动整个解决方案资源管理器，同时它漂浮在屏幕上。右键单击-> 选项卡式文档。再次右键单击->垂直选项卡

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-07-16T05:45:06.367

这是一个老问题，但对于希望在 Visual Studio 2019 中更改选项卡位置的任何人，右键单击打开的选项卡，选择 [设置选项卡布局]，然后选择一个位置：左、上、右。

[![在此处输入图像描述](https://i.stack.imgur.com/7QopB.gif)](https://i.stack.imgur.com/7QopB.gif)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-08-29T15:33:53.760

为了补充接受的答案给出的内容，如果您希望它看起来像这样（在左侧）：

[![最左侧边栏](https://i.stack.imgur.com/F8eIU.png)](https://i.stack.imgur.com/F8eIU.png)

执行完全相同的步骤，然后将其附加到左侧后，单击“自动隐藏”：

[![工具栏菜单](https://i.stack.imgur.com/0SplW.png)](https://i.stack.imgur.com/0SplW.png)

这样，它将在工具栏上保持可见。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T19:49:45.173

您只能在固定且未设置为自动隐藏时通过标题栏将面板拖动到中央指南针覆盖层。您可以单击标题栏中的图钉图标进行切换。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2019-03-13T09:32:22.480

转到视图-> 外观-> 向左移动侧栏

# .net - 杀死互操作应用程序进程

> ID：321881
> 
> 赞同：4
> 
> 时间：2008-11-26T19:30:21.297
> 
> 标签：.net, vb.net, excel, interop

我在程序中有以下内容（用 VB.NET 编写）：

```
Imports Microsoft.Office.Interop.Excel

Public Class Form1
    Dim eApp As New Excel.Application
    Dim w As Excel.Workbook
    w = eApp.Workbooks.Open( "path.xls", ReadOnly:=True)
    .. Processing Code ..
    //Attempts at killing the excel application
    w.Close()
    eApp.Workbooks.Close()
    eApp.Quit()
End Class 
```

当我运行它几次时，我的任务管理器中有一堆 EXCEL.EXE 实例。如何在代码中杀死这些进程？代码中的所有代码都已尝试过，但均无效。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T19:43:57.823

循环下面的代码行，直到结果为零或更小

```
System.Runtime.InteropServices.Marshal.ReleaseComObject(eApp) 
```

或查看此[链接](http://www.codeproject.com/KB/office/ReleaseExcelObject.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T19:44:35.467

我不得不在 NET 1.1 中这样做一段时间，所以请原谅生锈。

在 eApp 上，有一个 Hwind（一个 win32 窗口句柄 - [http://msdn.microsoft.com/en-us/library/bb255823.aspx](http://msdn.microsoft.com/en-us/library/bb255823.aspx)）或类似对象。我不得不使用它和一个 pInvoke ( [http://www.pinvoke.net/default.aspx/user32.GetWindowThreadProcessId](http://www.pinvoke.net/default.aspx/user32.GetWindowThreadProcessId) ) 来获取进程 ID。这样我就可以在 exe 上执行 Process.Kill() 了。

现在可能有更好的方法来做到这一点，但这应该可行。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T21:07:16.843

为了使 Excel 退出，您需要调用 Application.Quit，并使用以下技术之一。

*   在您实例化的每个 Excel 对象上调用 Marshal.ReleaseComObject。有一篇[知识库文章](http://support.microsoft.com/default.aspx/kb/317109)描述了如何做到这一点。例如，在您的示例代码中，“eApp.Workbooks.Open”实例化了一个 Workbooks 对象，而不给它分配一个变量。您需要按照知识库文章中的说明分配一个变量，以便随后发布它。问题在于，除了最简单的自动化场景之外，很难确保始终释放所有代码路径中的所有此类对象（例如，通过使用 try/finally 来确保在引发异常时释放它们）。

*   释放最后一个 Excel 对象后调用 GC.Collect 和 GC.WaitForPendingFinalizers。有些人建议您可能需要这样做两次。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-11-23T19:55:33.513

启动 Excel：

```
Microsoft.Office.Interop.Excel.Application xlApp = new Microsoft.Office.Interop.Excel.Application();
Workbook wb = xlApp.Workbooks.Open(...);
Worksheet ws = (Worksheet)wb.Worksheets[1]; 
```

杀死 Excel：

```
System.Runtime.InteropServices.Marshal.ReleaseComObject(ws);
System.Runtime.InteropServices.Marshal.ReleaseComObject(wb);
wb = null;
ws = null;

uint idProcess;
GetWindowThreadProcessId((IntPtr)xlApp.Hwnd, out idProcess);

xlApp.DisplayAlerts = false;
xlApp.Quit();
System.Runtime.InteropServices.Marshal.ReleaseComObject(xlApp);
xlApp = null;
xlApp = null;
GC.Collect();
GC.WaitForPendingFinalizers();
GC.Collect();
GC.WaitForPendingFinalizers();

Process processo = null;
try
{                   
    processo = Process.GetProcessById((int)idProcess);
}
catch { }

if (processo != null)
    processo.Kill(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T20:07:44.250

几天前我发布了一个解决方案： [Killing Excel.EXE on server](https://stackoverflow.com/questions/51462/killing-excelexe-on-server#312513)

与 StingyJack 提到的方法相同；我所知道的唯一一个真正工作的人。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T21:12:49.280

使用 Using 块

```
Using eApp As New Excel.Application
  Using w As Excel.Workbook
    w = eApp.Workbooks.Open( "path.xls", ReadOnly:=True)
    .. Processing Code ..
    //Attempts at killing the excel application
    w.Close()
    eApp.Workbooks.Close()
    eApp.Quit()
  End Using
End Using 
```

类似于 try/finally 块在 finally 中处理，这将自动处理 Excel.Application 和 Excel.Workbook。

正如其他帖子中提到的， System.Runtime.InteropServices.Marshal.ReleaseComObject(eApp) 也可能是必要的？？？？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-16T10:59:12.720

在 ExcelApplication.Quit() 之后添加以下代码。

它会从进程中杀死 excel 应用程序。

```
 Process[] Proc = Process.GetProcessesByName("Excel");
            foreach (Process p in Proc)
            {
                if (p.MainWindowTitle == "")
                    p.Kill();
            } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-05-01T17:05:12.487

Tagore Peethala 解决方案直截了当且有效。基本上确保 WorkBook.CLOSE.. 然后 ExcelApplication.QUIT... 然后只寻找一个没有打开的 excel 实例并关闭它。

```
myExcelWorksheet = null;
if (myExcelWorkbook != null)
                {
                    myExcelWorkbook.Close();
                    myExcelWorkbook = null;
                }
                if (myExcelApp != null)
                {
                    myExcelApp.Quit();
                    myExcelApp = null;
                }
                foreach (System.Diagnostics.Process myProcess in System.Diagnostics.Process.GetProcessesByName("Excel"))
                {
                    if (myProcess.MainWindowTitle == "")
                    {
                        myProcess.Kill();
                    }
                } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-07-08T11:20:26.213

```
//Quit Excel application
eApp.Quit();

//Release COM objects (every object you used in eApp,like workbooks, Workbook, Sheets, Worksheet)
System.Runtime.InteropServices.Marshal.ReleaseComObject(obj);
obj = null;

// Force garbage collector cleaning
GC.Collect(); 
```

# asp.net - 动态数据中的字段顺序？

> ID：321896
> 
> 赞同：11
> 
> 时间：2008-11-26T19:36:29.990
> 
> 标签：asp.net, asp.net-dynamic-data

有谁知道是否可以在动态数据**中选择字段的顺序**（当然，无需自定义每个表的模板）？

谢谢 ！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-05-19T22:02:13.597

在 .NET 4.0 中，使用 4.0 版本的动态数据 dll，您可以像这样设置数据注释：

```
[Display(Name = " Mission Statement", Order = 30)]
public object MissionStatement { get; set; }

[Display(Name = "Last Mod", Order = 40)]  
public object DateModified { get; private set; } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-30T23:02:17.123

根据[这个](http://forums.asp.net/p/1357520/2793762.aspx)线程 - 您可以在动态数据期货 dll 中使用 ColumnOrderAttribute。您可以从 codeplex 获取期货。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T17:46:08.343

您必须在 DynamicData 文件夹中创建一个自定义页面。

以下是步骤：

*   创建一个与您要在“DynamicData\CustomPages”文件夹下自定义列顺序的表名称同名的文件夹
*   在“DynamicData\CustomPages\[带有表名的文件夹]”文件夹下创建一个自定义页面。
    *   我只是将现有的“List.aspx”文件从“DynamicData\PageTemplates”复制到上面的文件夹中。
*   打开aspx文件，修改GridView控件为“AutoGenerateColumns='false'”
*   在 GridView 的列部分中，按您想要的顺序将具有“DataField”属性值的“DynamicControl”控件添加到列的名称中。

这是 ScottHa 的截屏视频： [http ://www.asp.net/learn/3.5-SP1/video-293.aspx](http://www.asp.net/learn/3.5-SP1/video-293.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-12T00:15:28.627

您可以通过修改 LINQ to SQL 文件中公共属性的顺序来完成此操作。

例如，我进入了 Northwind.designer.cs，这是我自动生成的 LINQ to SQL 文件，并将名为 Products 的公共属性移动到公共部分类 Category 中公共属性 CategoryName 的上方。然后我重新编译，默认模板以我的新顺序显示列。

当然，这意味着您编辑自动生成的代码，如果您重新生成它，您的更改就会丢失，因此这种技术并非没有危险。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-11T15:07:19.663

GridView 具有 ColumnsGenerator 属性，通过实现 IAutoFieldGenerator 接口的 GenerateFields 方法来使用它，您可以在其中根据您的自定义规则（属性，元信息，...）设置字段顺序

```
protected override void OnInit(EventArgs e)
{
    ...
    this.gvItemsList.ColumnsGenerator = new EntityFieldsGenerator(CurrentDataSource.CurrentTableMetadata);
    ...
}

public class EntityFieldsGenerator : IAutoFieldGenerator {
...
public ICollection GenerateFields(Control control)    
{
    // based on entity meta info
    var fields = from item in this.entityMetadata.Columns
                 where this.IncludeColumn(item.Value)
                 orderby item.Value.Order
                 select new DynamicField
                 {
                     DataField = item.Value.Column.Name,
                     HeaderText = item.Value.DisplayName,
                     DataFormatString = item.Value.DataFormatString,
                     UIHint = GetColumnUIHint(item.Value)
                 };
    return fields.ToList();
} } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-10T06:03:26.353

为避免使用动态数据期货 dll，您可以滚动您自己的 ColumnOrder 属性，如下所示：

```
[AttributeUsage(AttributeTargets.Property)]
public class ColumnOrderAttribute : Attribute
{
    public int Order { get; private set; }
    public ColumnOrderAttribute() { Order = int.MaxValue; }
    public ColumnOrderAttribute(int order) { Order = order; }
    public static ColumnOrderAttribute Default = new ColumnOrderAttribute();
} 
```

然后在实现 IAutoFieldGenerator 的类中，您有

```
public static class ExtensionMethods
{
    public static int GetOrder (this MetaColumn column)
    {
        var orderAttribute = column.Attributes.OfType<ColumnOrderAttribute>().DefaultIfEmpty(ColumnOrderAttribute.Default).Single();
        return orderAttribute.Order;
    }
}

public ICollection GenerateFields(Control control)
{
    var fields = new List<DynamicField>();
    var columns = _table.Columns.OrderBy(column => column.GetOrder());
    foreach (var column in columns)
    {
        if (!column.Scaffold) { continue; }
        fields.Add(new DynamicField {DataField = column.Name});
    }
} 
```

最后你的用法看起来像

```
[MetadataType(typeof(CustomerMetadata))]
public partial class Customer {}

public class CustomerMetadata
{
    [ColumnOrder(1)]
    public object FirstName {get;set;}
    [ColumnOrder(2)]
    public object LastName {get;set;}
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-04-10T09:22:59.283

我正在回答一个老问题，因为在我看来，可能的解决方案在新版本的框架中发生了变化。

似乎 Display(Order) 现在直接按要求工作（.NET 4.0 上的 Visual Web Developer 2010），没有任何特定的解决方法。

例子：

```
[Display(Order = 50)] 
```

重要的是检查正确的对象名称以映射外键：

在一个项目中，将实体类中的字段 OperatoreID 翻译为：

```
public object Operatore { get; set; } 
```

操作外键的源表；对于同一张表上的第二个引用，它将得到类似 1 的内容，依此类推。

# windows - 如何获取异常的名称/描述？

> ID：321898
> 
> 赞同：9
> 
> 时间：2008-11-26T19:38:14.387
> 
> 标签：windows, winapi, exception

如何在**无需**将字符串硬编码到应用程序中的情况下获取[SEH](http://msdn.microsoft.com/en-us/library/ms680657(VS.85).aspx)异常的名称和/或描述？

 **我尝试使用`FormatMessage()`，但有时它会截断消息，即使您指定忽略插入：

```
__asm { // raise access violation
    xor    eax, eax
    mov    eax, [eax]
} 
```

使用代码引发异常`0xC0000005 (EXCEPTION_ACCESS_VIOLATION)`。

```
char msg[256];
FormatMessageA(FORMAT_MESSAGE_FROM_HMODULE | FORMAT_MESSAGE_IGNORE_INSERTS,
    GetModuleHandleA("ntdll.dll"), 0xC0000005,
    MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),
    msg, sizeof(msg), NULL); 
```

`msg`用截断的字符串填充：“ `The instruction at 0x`”。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2015-10-09T18:09:39.697

结构化异常代码是通过 NTSTATUS 编号定义的。虽然来自 MS 的人[建议](https://support.microsoft.com/en-us/kb/259693)使用[FormatMessage()](https://msdn.microsoft.com/en-us/library/ms679351(v=vs.85).aspx)将 NTSTATUS 数字转换为字符串，但我不会这样做。Flag`FORMAT_MESSAGE_FROM_SYSTEM`用于将[GetLastError()](https://msdn.microsoft.com/en-us/library/ms679360(v=vs.85).aspx)的结果转换为字符串，所以这里没有意义。与标志`FORMAT_MESSAGE_FROM_HMODULE`一起使用`ntdll.dll`会导致某些代码的结果不正确。例如，因为`EXCEPTION_ACCESS_VIOLATION`你会得到`The instruction at 0x`，这不是很丰富:)。

当您查看存储在`ntdll.dll`其中的字符串时，很明显它们中的许多应该与[printf()](https://msdn.microsoft.com/en-us/library/56e442dc.aspx)函数一起使用，而不是与[FormatMessage()](https://msdn.microsoft.com/en-us/library/ms679351(v=vs.85).aspx)一起使用。例如，字符串为`EXCEPTION_ACCESS_VIOLATION`：

`The instruction at 0x%08lx referenced memory at 0x%08lx. The memory could not be %s.`

`%0`被[FormatMessage()](https://msdn.microsoft.com/en-us/library/ms679351(v=vs.85).aspx)视为转义序列，意思是消息终止符，而不是插入。插入是 %1 到 %99。这就是为什么标志`FORMAT_MESSAGE_IGNORE_INSERTS`没有任何区别。

您可能希望从中加载字符串`ntdll.dll`并将其传递给[vprintf()](https://en.cppreference.com/w/cpp/io/c/vfprintf)，但您需要完全按照字符串指定的方式准备参数（例如，对于`EXCEPTION_ACCESS_VIOLATION`它的`unsigned long`, `unsigned long`, `char*`）。这种方法有一个主要缺点：参数的数量、顺序或大小的任何变化都`ntdll.dll`可能破坏您的代码。

因此，将字符串硬编码到您自己的代码中会更安全、更容易。我发现在没有与我协调的情况下使用其他人准备的字符串是很危险的:) 以及其他功能。这只是故障的另一种可能性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T20:30:14.780

这适用吗？

[http://www.winehq.org/pipermail/wine-devel/2001-May/000801.html](http://www.winehq.org/pipermail/wine-devel/2001-May/000801.html)

# createprocessasuser - CreateProcessAsUser 在我的实验中无法正常工作

> ID：321900
> 
> 赞同：1
> 
> 时间：2008-11-26T19:38:45.913
> 
> 标签：createprocessasuser

我正在尝试执行以下操作： 1\. 我在我的 XP 中使用运行 VS.NET 2005 的 SP2 机器以管理员帐户登录 2\. 这台机器还有另一个帐户 user1，它是一个访客帐户 3\. 我正在运行一个程序管理员，我想从这个程序中启动一个 notepad.exe 进程，它将在 user1 安全上下文 4 下运行。我特别想用它`CreateProcessasUser`来执行此操作..

这是代码剪辑器，它将解释我一直在尝试的内容..

```
const string GRANTED_ALL = "10000000";

const int LOGON32_LOGON_INTERACTIVE = 2;
const int LOGON32_LOGON_NETWORK = 3;
const int LOGON32_LOGON_BATCH = 4;
const int LOGON32_LOGON_SERVICE = 5;
const int LOGON32_LOGON_UNLOCK = 7;
const int LOGON32_LOGON_NETWORK_CLEARTEXT = 8;
const int LOGON32_LOGON_NEW_CREDENTIALS = 9;

const int LOGON32_PROVIDER_DEFAULT = 0;
static IntPtr hToken = IntPtr.Zero;
static IntPtr hTokenDuplicate = IntPtr.Zero;

static void Main(string[] args)
{
    int last_error = 0;
    if(LogonUser("user1",null,"#welcome123",
        LOGON32_LOGON_INTERACTIVE, 
        LOGON32_PROVIDER_DEFAULT, out hToken))
    {
        last_error = Marshal.GetLastWin32Error();
        PROCESS_INFORMATION pi = new PROCESS_INFORMATION();
        STARTUPINFO si = new STARTUPINFO();
        SECURITY_ATTRIBUTES sa = new SECURITY_ATTRIBUTES();
        last_error = 0;
        last_error = Marshal.GetLastWin32Error();
        if(DuplicateTokenEx(hToken,UInt32.Parse(GRANTED_ALL,System.Globalization.NumberStyles.HexNumber),
            ref sa,SECURITY_IMPERSONATION_LEVEL.SecurityImpersonation,
            TOKEN_TYPE.TokenPrimary,out hTokenDuplicate))
        {
            last_error = 0;
            last_error = Marshal.GetLastWin32Error();

            CreateProcessAsUser(hTokenDuplicate, "d:\\san\\notepad.exe", null,
            ref sa, ref sa, false, 0, IntPtr.Zero, "d:\\san", ref si, out pi);

            last_error = 0;
            last_error = Marshal.GetLastWin32Error();

        }
    }

    last_error = 0;
    last_error = Marshal.GetLastWin32Error();

    if (hToken != IntPtr.Zero) CloseHandle(hToken);
    if (hTokenDuplicate != IntPtr.Zero) CloseHandle(hTokenDuplicate);

} 
```

出于某种原因，这不起作用..该`DuplicateTokenEx`函数返回为 1305 的错误代码，我似乎无法弄清楚为什么..

而不是`DuplicateTokenEx`我也使用了`DuplicateToken`，现在`CreateProcessAsUser`返回错误代码 1308。

有人可以说明一下这个问题吗..这似乎是一件显然非常简单的事情，但就是做错了.. [请注意，我特别想`LogonUser`然后再`DuplicateToken`然后`CreateProcessAsUSer`]

* * *

## 回答 #1

> 赞同：-2
> 
> 时间：2008-11-27T07:53:33.933

请参阅[CreateProcessAsUser() windowsstations 和 desktops](http://support.microsoft.com/kb/165194)。

但我建议以托管方式进行：

```
...
using System.Diagnostics;
using System.Security;
...
...
string progPath = @"c:\WINNT\notepad.exe";
ProcessStartInfo startInfo = new ProcessStartInfo(progPath);
startInfo.WindowStyle = ProcessWindowStyle.Normal;
startInfo.UseShellExecute = false;
startInfo.UserName = "SomeUser";
SecureString password = new SecureString();

#region setting password
password.AppendChar('p');
password.AppendChar('a');
...
#endregion

startInfo.Password = password;
Process.Start(startInfo);
...
... 
```

# powershell - 使用 V1 进行 Powershell 远程处理

> ID：321910
> 
> 赞同：9
> 
> 时间：2008-11-26T19:42:13.053
> 
> 标签：powershell, powershell-1.0, powershell-remoting

您知道使用 powershell V1 的任何好的远程解决方案吗（我知道 V2 的东西很棒，但我的组织不喜欢使用预发布软件）。我不需要任何壮观的东西，只是一种在另一个盒子上启动 powershell 脚本并在完成后返回结果的方法。我正在考虑使用 sysinternals PSEXEC 和 export-csv/import-csv 并制作一些可行的东西。不过，我宁愿让别人做这项工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T22:27:42.470

我认为 PrimalScript 的远程脚本执行引擎可以满足您的需求。它确实需要在远程计算机上安装一个小型服务，但是当您购买 PrimalScript（企业版）时，您将获得无限许可。

还有一个有人做过的 PSHRemoting 项目。

N Software 的 NetCmdlet 还带有一个“PowerShell 服务器”（[http://nsoftware.com/powershell/](http://nsoftware.com/powershell/)），它支持远程处理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-14T00:31:30.577

PowerShell 团队博客上有一篇[很棒的文章](http://blogs.msdn.com/powershell/archive/2008/02/29/remoting-using-powershell-v1.aspx)，描述了如何在 V1 中进行一些基本的远程处理。

基本上，PS V2 在后台使用 Windows 远程管理 (WinRM)。Winrs 是用于远程操作机器的命令行工具。

Jeffrey 谈到的这种策略使用 WinRS 和一些 PowerShell 技巧来让远程处理在 V1 中工作。它不像 V2 那样流畅，但你绝对可以得到一些基本的东西来使用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T19:51:06.653

我已经成功使用了 PSExec。您还可以使用 WMI 启动远程进程。[这](http://blog.svenlandgraf.nl/?p=24)是一个例子。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T18:58:20.003

Lee Holmes 发布了一个使用 PSExec 和 xml（而不是 csv）的解决方案[http://www.leeholmes.com/blog/CategoryView,category,guide.aspx](http://www.leeholmes.com/blog/CategoryView,category,guide.aspx)

# linq - 数据表查询

> ID：321914
> 
> 赞同：1
> 
> 时间：2008-11-26T19:43:52.377
> 
> 标签：linq, linq-to-sql, linq-to-objects

我是 LINQ 的新手。我正在尝试查找第二个数据表中不存在的行。

report_list 和 benchmark 两种类型都是：DataTable。使用 OleDbCommand、OleDbDataAdapter 填充这两个数据表。我收到一个错误“指定的演员表无效。” 在 foreach ...循环中。我会很感激你的帮助。

```
 var result = from a in report_list.AsEnumerable()
                         where !(from b in benchmark.AsEnumerable()
                                 select b.Field<int>("bench_id")
                                )
                                .Contains(a.Field<int>("BenchmarkID"))
                         select a;

            foreach (var c  in result)
            {
                Console.WriteLine(c.Field<string>("Name"));
            } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T20:17:55.943

我不知道我是否理解你的问题。您是否要获取第一个表中存在但第二个表中不存在的项目？

```
 var first = new string[] { "b", "c" };
var second = new string[] { "a", "c" };
//find the itens that exist in "first" but not in "second"
var q = from f in first
        where !second.Contains(f)
        select f;
foreach (var s in q) {
    Console.WriteLine(s);
}

//Prints:
//b 
```

我建议你先进行内部查询，一旦它不依赖于外部记录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-27T00:25:51.967

```
From a in report_list
Group Join b in benchmark On a.bench_id Equals b.bench_id Into g = Group
Where g.Count = 0
Select a 
```

请注意，这是 VB 语法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T14:38:27.737

也许使用 .Except() 扩展来获取两组的集合差异？

```
(from b in benchmark.AsEnumerable()  
    select new { id = b.Field<int>("bench_id")}).Except(
         from a in report_list.AsEnumerable() 
             select new {id = a.Field<int>("BenchmarkID")}) 
```

实际上不确定精确的语法，但这应该通过在基准测试中获取 id，然后删除 report_list 中的所有等效 id，只留下不匹配的 id 来工作。（我希望这是你之后的顺序......）

注意：这也是假设 tvanfosson 提到的上述问题也不是问题

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-27T03:55:46.143

我怀疑您要比较的字段之一不是数据库中的整数。我相信无效转换异常是由其中一个`Field<int>()`调用引发的，因为这是该方法可以引发的三种不同异常之一。[请参阅此处](http://msdn.microsoft.com/en-us/library/bb360891.aspx)的文档。

# c# - 在系统命名空间中编写自己的扩展方法可以吗？

> ID：321921
> 
> 赞同：21
> 
> 时间：2008-11-26T19:46:43.387
> 
> 标签：c#, .net, extension-methods

我最近一直在使用扩展方法，并且发现它们有很多用途。我唯一的问题是记住它们在哪里以及使用什么命名空间来获取扩展方法。

但是，我最近想在 System 命名空间、System.Collections 命名空间或其他一些有意义的系统命名空间中编写扩展方法。例如，我实现了以下内容。

```
namespace System
{
    /// <summary>Various array extensions</summary>
    public static class ArrayExtensions
    {
        /// <summary>Converts the array to a hex string</summary>
        /// <param name="value">The value.</param>
        /// <returns>The array as a hex string</returns>
        public static string ToHexString(this byte[] value)
        {
            var hex = new StringBuilder(value.Length * 2);
            foreach (byte b in value)
            {
                hex.AppendFormat("{0:X2}", b);
            }
            return hex.ToString();
        }
    }
} 
```

这是正确的做法吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-26T20:20:02.570

来自框架设计指南（第 2 版）：

不要将扩展方法放在与扩展类型相同的命名空间中，除非它是用于向接口添加方法或用于依赖管理。

虽然这没有明确涵盖您的方案，但您通常应该避免扩展框架名称空间（或您无法控制的任何名称空间），而是选择将这些扩展放在它们自己的名称空间中。如果您对“分组”扩展有强烈的感觉（例如集合扩展在一起等），那么您可以引入一个子命名空间。在您的场景中，对集合的扩展将进入`System.Collection.Extensions`命名空间或命名空间`Company.Collections`，甚至是`Company.Collections.Extension`命名空间。

为了使用扩展方法，必须导入包含赞助商类（定义扩展方法的类）的命名空间。如果将扩展方法添加到标准 .NET Framework 命名空间之一，它们将始终（并且隐式）可用。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-26T19:52:21.067

您应该避免增加您没有主要控制权的名称空间，因为将来的更改可能会破坏您的代码（例如，通过引入重复项）。

我倾向于使用不同的根名称空间来模仿标准名称空间，该名称空间将所有子名称空间标识为属于我的工作。根名称空间可以是您的姓名、您的组织名称或其他标识该名称空间内容为您的名称的名称。

例如，如果你想扩展`System.Collections`，你可以使用`NickR.Collections`or `NickR.System.Collections`。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-01T02:31:02.760

命名空间真正影响扩展方法的唯一因素是可见性和可发现性——因此这取决于您是否希望扩展方法始终出现在该类型上。框架设计指南主要针对公共 API，因此，虽然遵循它们通常是一个好主意，但对于内部 API 来说，在有意义的情况下，规则非常有待打破。

例如，我们`TimeSpan`在整个代码库中对对象进行了大量工作，但在框架中没有方法可以乘以或除以这些对象，因此我们添加`MultiplyBy`和`DivideBy`扩展方法等，并将它们放在`System`命名空间中，因为我们希望它们可访问和在使用a 的任何地方`TimeSpan`都可以发现。

另一方面，我们也做了相当多的反射工作，对`Type`对象进行操作，并且有很多扩展方法在特定领域非常有用，但并不普遍，所以它们存在于`OurCompany.Reflection`命名空间中，所以它们必须专门进口的。

因此，对于内部 API，决定归结为“我是否希望此方法在我们代码库中可用类型的任何地方都可用？”。如果答案是肯定的，则将其放在同一个命名空间中，否则将其放在其他位置。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-26T19:52:25.293

不确定它是否是错误的（或正确的，就此而言），但为什么不拥有自己的“扩展”命名空间呢？然后将所有扩展方法放在该名称空间中并保持一致。

我认为真正的问题不在于将它们放在哪里或命名它（系统或任何其他名称空间），而是要保持一致并始终使用相同的方式来避免您的问题（忘记它们在哪里）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-01T01:31:15.003

我根据我希望它们具有的可见性将我的扩展方法放在命名空间中。这样他们更容易被发现，而且我通常会得到更少的命名空间导入。

# sql - 设计一个 SQL 表并在第一时间把它做好

> ID：321924
> 
> 赞同：1
> 
> 时间：2008-11-26T19:47:20.140
> 
> 标签：sql, database-design

我目前正在为我的公司开发一个问题跟踪器，以帮助他们跟踪网络出现的问题。我正在使用 C# 和 SQL。

每个问题都有大约二十件事我们需要跟踪（状态、工作损失、谁创建它、谁在处理它等）。我需要将受问题影响的团队列表附加到我的主要问题表中的每个条目。理想情况下，受影响的团队列表包含指向唯一表实例的某种链接，仅针对该问题，显示受影响的团队列表以及每个团队实验室受到影响的百分比。

所以我的问题是在问题表的条目和该问题的唯一表之间实现这种“链接”的最佳方式是什么？或者我是不是把这个问题想错了。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-26T20:03:19.203

您所描述的称为“多对多”关系。一个团队可能会受到许多问题的影响，同样一个问题可能会影响许多团队。

在 SQL 数据库设计中，这种关系需要第三个表，其中包含对其他两个表中的每一个的引用。例如：

```
CREATE TABLE teams (
  team_id INTEGER PRIMARY KEY
  -- other attributes
);

CREATE TABLE issues (
  issue_id INTEGER PRIMARY KEY
  -- other attributes
);

CREATE TABLE team_issue (
  issue_id INTEGER NOT NULL,
  team_id INTEGER NOT NULL,
  FOREIGN KEY (issue_id) REFERENCES issues(issue_id),
  FOREIGN KEY (team_id) REFERENCES teams(team_id),
  PRIMARY KEY (issue_id, team_id)
); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T20:01:06.040

这听起来像是一个经典的多对多关系......你可能想要三个表，

1.  一个用于问题，每个创建的每个唯一问题都有一个记录（行）...

2.  一个用于团队，您公司的每个团队都有一个记录...

3.  一张名为“IssueTeams”或“TeamIssueAssociations”`或“IssueAffectedTeams”的表来保存两者之间的关联......

    最后一张表将有一个问题影响的每个团队的记录（行）......该表将有一个 2 列复合主键，在列 IssueId 和 TeamId 上......每一行都必须有一个唯一的组合这两个值中的...每个值分别是问题表和团队表的外键（FK）。

对于每个团队，该表中可能有零到多条记录，对于团队受到影响的每个问题，

对于每个问题，可能有零到多条记录，每条记录代表问题影响的团队。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T19:59:10.413

如果我正确理解了这个问题，我会创建....

*   ISSUE 表包含 20 个 so 项目
*   包含团队列表的 TEAM 表。
*   TEAM_ISSUES 表包含两者之间的链接

TEAM_ISSUES 表需要包含 ISSUE 和 TEAM 表的外键（即它应该包含一个 ISSUE_ID 和一个 TEAM_ID ......因此它充当两个“主”表之间的交集。听起来这也是这个地方把百分比。

那有意义吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-26T20:10:49.390

有很多好的免费开源问题跟踪器可用，你应该有很好的理由来实现自己的。您可以更好地利用您的时间来定制现有的跟踪器。

We are using [Bugtracker.NET](http://ifdefined.com/bugtrackernet.html) in the team I work for. It's been customized quite a bit, but there was no point in developing a system from the beginning. The reason we chose that product was that it runs on .NET and works great with SQL Server, but there are many other alternatives.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T20:00:10.537

我们可以在您的域中看到这些*实体：*

1.  “**问题**”
2.  受该问题影响的“**团队”，按一定比例**

因此，在确定了这两个项目后，您可以用两个表来表示，它们之间的*关系*是另一个表，它也可以跟踪百分比影响。

希望这可以帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-26T20:01:11.190

我不会为每个问题创建一个唯一的表。我会做这样的事情

```
表：问题
IssueId 主键
地位
工作损失
由...制作
ETC

表：团队
TeamID 主键
队名
ETC

表：问题团队
IssueID（问题表的外键）
TeamID（团队表的外键）
受影响的百分比实验室

```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-26T20:01:45.430

除非我理解错了您要执行的操作，否则您不应该为每个问题实例都有一个唯一的表。

您的数据库应该有三个表：一个问题表、一个团队表和一个问题团队连接表。IssueTeams 表将包含外键（即 TeamID 和 IssueID），它们引用 Teams 中的相应团队和 Issues 中的问题。所以问题团队可能有（Issue1，Team1），（Issue1，Team3）之类的记录。您可以将每个团队的实验室的受影响百分比保留在加入表中。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-26T20:03:36.050

好吧，为了保持现代和敏捷，“第一次做对”不如“可重构”那么时髦。但是要通过您的模型工作：

你有问题（呵呵）。你有团队。

一个问题会影响许多团队。一个团队受到许多问题的影响。因此，仅针对基本问题，您似乎具有经典的多：多关系。一个包含两列的连接表，一列用于发布 PK，另一列用于团队 PK。

然后你有什么百分比的团队的问题。当然，这有一个动态方面，所以要正确执行，您需要指定一个触发器。但显而易见的放置位置是问题中的一列（“Affected_Team_Percentage”）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-26T20:05:05.347

如果我对您的理解正确，您希望为每个问题创建一个新的受影响团队表。作为正常操作的一部分创建表给我的关系数据库设计敲响了警钟。不要这样做！

相反，使用一个affected_teams 表，其中一个[外键](http://en.wikipedia.org/wiki/Foreign_key)指向issues 表，一个外键指向teams 表。那会成功的。

# cocoa - Apple 如何让 info.plist 显示其“信息属性列表”？

> ID：321933
> 
> 赞同：3
> 
> 时间：2008-11-26T19:51:51.130
> 
> 标签：cocoa, cocoa-touch, macos, plist

我的 plist 只是以“Root”开头。他们包含一系列有用的东西，您可以选择调整配置。我正在查看的特定 info.plist 位于 iphone 项目中。我对此进行了一些研究（不是很多），但甚至没有闻到溶液的味道。

是什么机制把它放在一起？我可以按照我的意愿弯曲它吗？

澄清一下，我不是指简单地编辑 plist，而是使用属性列表编辑器来定义左侧列中的下拉列表，就像 Apple 的 info.list 行为一样。

通常我的 plist 将在编辑器中显示 3 列。键、类型和值。Info.plist 有 2，它是如何设置的，所以它在属性列表编辑器中的行为是不同的？

苹果的这个链接定义了 Info.plist 中使用的键。

[属性列表键参考](http://developer.apple.com/documentation/MacOSX/Conceptual/BPRuntimeConfig/Articles/PListKeys.html)

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-26T20:55:08.460

您在属性列表编辑器的下拉菜单中看到的名称由 Apple 所谓的“属性列表结构定义”提供。这是一个基于 XML 的文件，它为特定类型的属性列表定义了特定的键和值。属性列表编辑器使用它来将人类可读的名称与特定的属性列表键以及合理的默认值、类型信息等相关联。

属性列表编辑器在使用定义时会隐藏“类型”列，因为它会自动从结构定义中获取类型信息。如果您愿意，您仍然可以使用 Edit > Value Type 手动更改类型。您还可以通过 View > Property List Type 手动更改 Property List Editor 正在使用的定义。

Xcode 包含 Info.plist 文件的内置定义，这就是您在打开 Info.plist 文件时自动看到自定义的原因。如果您对结构定义的定义方式感兴趣，可以查看 /Developer/Platform/MacOSX.platform/Developer/Library/Xcode/Plug-ins 中的内置定义。我不相信这种格式有任何官方文档，但是看示例并不难。

# asp.net - 从 IIS 控制远程服务器上的服务

> ID：321939
> 
> 赞同：1
> 
> 时间：2008-11-26T19:53:55.790
> 
> 标签：asp.net, authentication, iis-6, invalidoperationexception, servicecontroller

*请注意：在下面我描述的每个步骤中，我都以相同的域用户帐户登录。*

我有一个 Web 应用程序可以控制远程机器上的服务（通过[ServiceController](http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicecontroller.aspx)）。当我远程连接到网站并尝试控制服务时，我收到 InvalidOperationException: Access is denied。

我知道它可以**工作**，因为当我从 Web 服务器连接到网站时（远程桌面进入，以我的域用户身份登录，然后打开网页），它按预期工作。

我已将 IIS 和 ASP.NET 配置为需要 Windows 身份验证和模拟。当此操作失败时，我会记录当前线程的主体，并且无论我是远程连接还是从服务器本身连接，我都会看到该线程以我的身份运行。

我曾尝试强制 IIS 同时使用 Kerberos 身份验证、NTLM 身份验证和两者；我的委托人将其 AuthenticationType 报告为“协商”还是“NTLM”都没有关系。当我远程连接（从我的本地机器）时，它们都不起作用

另一个奇怪的事情是，如果我从本地机器**调试**/连接到远程服务器，它每次都能正常工作！但我不是在调试，每次都失败！

这里到底发生了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-26T20:16:23.903

您的方案是委托而不是模拟。授权很难实现，它取决于许多事情是否正确。

一个开始的地方是[Kerberos 身份验证和故障排除委派问题](http://support.microsoft.com/kb/907272)

[David Wang 博客](http://blogs.msdn.com/david.wang/)是关于这些问题的非常有用的资源。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T20:01:48.723

“另一个奇怪的事情是，如果我从本地机器调试/连接到远程服务器，它每次都能正常工作！但我不是在调试，它每次都失败！”

这清楚地表明您有权限问题。当您在调试器中运行时，您以登录用户身份运行，当您不调试时，它以任何 IIS 设置使用的方式运行（默认为网络服务）。尝试设置（暂时！）使用您的域帐户作为用户启用匿名访问，看看是否有效。如果是这样，则意味着您的 IIS 没有正确设置来模拟（并且它可能作为 NETWORK SERVICE 运行）。

IIS 中的权限可能有点*难以*正确微调......祝你好运！

P/S：这看起来更像是一个网络管理问题而不是一个编程问题（参见[https://stackoverflow.com/questions/321618/stackoverflow-is-for-programming-questions-here-are-some-better-forums-为你的#321756](https://stackoverflow.com/questions/321618/stackoverflow-is-for-programming-questions-here-are-some-better-forums-for-your#321756) )

# javascript - Javascript Regexp - 匹配字符串模式，除非字符串在指定标记内

> ID：321947
> 
> 赞同：3
> 
> 时间：2008-11-26T19:57:55.063
> 
> 标签：javascript, regex

我正在尝试替换所有出现的 ???some.text.and.dots??? 在一个 html 页面上添加一个链接。我已经构建了这个正则表达式：

\?\?\?([a-z0-9.]*)\?\?\?

但是，我想排除链接内的任何结果：“<a ...> ... MY PATTERN ... </a>”，我对如何做到这一点有点困惑，所有我的尝试暂时失败了。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-26T23:01:52.557

目前还不清楚您正在处理哪种“HTML”。如果是 HTML*代码*，可能来自 Ajax 请求，那么您可以使用正则表达式；匹配链接*或*模式，然后在回调中确定要执行的操作：

```
var html = document.body.innerHTML;
html = html.replace(/(<a\s.*?>.*?<\/a>)|(\?\?\?([a-z0-9.]*)\?\?\?)/g, 
    function ( a, b, c, d ) {
       return ( a[0] == '<' ) ? a : '<a href="#">' + d + '</a>'; 
    });
context.innerHTML = html; 
```

方便的是，`replace()` [可以将回调函数](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/String/replace)作为替换生成器而不是简单的字符串。

但是，如果您正在处理实时 DOM 树，您可能希望尊重节点上的事件，而不是简单地重置`innerHTML`. 你需要一些更原始的方法：

```
// returns all childnodes of type text that do not have A as parent
function walker ( node ) {
  var nodes = [];
  for (var c, i = 0; c = node.childNodes[i]; i++) {
    if ( c.nodeType === 1 && c.tagName !== 'A' ) {
      nodes = nodes.concat( arguments.callee( c ) );
    }
    else if ( c.nodeType === 3 ) { 
      nodes.push( c );
    }
  }
  return nodes;
}

var textNodes = walker( document.body );
for (var i = 0; i < textNodes.length; i++) {
  // create an array of strings separating the pattern
  var m = textNodes[i].nodeValue.split( /(\?\?\?([a-z0-9.]*)\?\?\?)/ );
  if ( m.length > 1 ) {
    for (var j=0; j<m.length; j++) {
      var t, parent = textNodes[i].parentNode;
      // create a link for any occurence of the pattern
      if ( /^\?\?\?([a-z0-9.]*)\?\?\?$/.test( m[j] ) ) {
        var a = document.createElement( 'a' );
        a.href = "#";
        a.innerHTML = RegExp.$1;  // m[j] if you don't want to crop the ???'s
        parent.insertBefore( a, textNodes[i] );
        t = document.createTextNode( ' ' ); // whitespace padding
      }
      else {
        t = document.createTextNode( m[j] );
      }
      parent.insertBefore( t, textNodes[i] );
    }
    // remove original text node
    parent.removeChild( textNodes[i] );
  }
} 
```

此方法仅涉及文本节点，然后仅涉及与模式匹配的那些。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T20:04:33.973

JavaScript 本身并不支持后视。为了做到这一点，您需要运行 .match() 然后对于每个匹配项，您需要对您的标签进行匹配（例如 /<a\s+.*?>/ 紧接在前面您的比赛，然后在比赛之后 </a>）。

祝你好运！！

# c# - 如何重命名 XML 序列化列表中使用的子 XML 元素 ?

> ID：321971
> 
> 赞同：2
> 
> 时间：2008-11-26T20:05:42.163
> 
> 标签：c#, .net, xml, serialization

我正在将我的类序列化为 XML，其中一个属性的类型为 List<string>。

```
public class MyClass {
    ...
    public List<string> Properties { get; set; }
    ...
} 
```

通过序列化此类创建的 XML 如下所示：

```
<MyClass>
    ...
    <Properties>
        <string>somethinghere</string>
        <string>somethinghere</string>
    </Properties>
    ...
</MyClass> 
```

现在我的问题。如何更改我的类以实现这样的 XML：

```
<MyClass>
    ...
    <Properties>
        <Property>somethinghere</Property>
        <Property>somethinghere</Property>
    </Properties>
    ...
</MyClass> 
```

序列化后。谢谢你的帮助！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-26T20:16:36.023

尝试[XmlArrayItemAttribute](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlarrayitemattribute.aspx)：

```
using System;
using System.IO;
using System.Xml.Serialization;
using System.Collections.Generic;

public class Program
{
    [XmlArrayItem("Property")]
    public List<string> Properties = new List<string>();

    public static void Main(string[] args)
    {
        Program program = new Program();
        program.Properties.Add("test1");
        program.Properties.Add("test2");
        program.Properties.Add("test3");

        XmlSerializer xser = new XmlSerializer(typeof(Program));
        xser.Serialize(new FileStream("test.xml", FileMode.Create), program);
    }
} 
```

测试.xml：

```
<?xml version="1.0"?>
<Program xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <Properties>
    <Property>test1</Property>
    <Property>test2</Property>
    <Property>test3</Property>
  </Properties>
</Program> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T20:17:24.510

`[XmlElement("Property")]`在您的 Properties 成员声明之前添加。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-31T17:51:38.100

如果您想在 WCF 服务中执行此操作并且仍然使用 DataContractSerializer，您可以简单地定义一个新的 List 子类：

```
[CollectionDataContract(ItemName="Property")]
public class PropertyList: List<string>
{
    public PropertyList() { }
    public PropertyList(IEnumerable<string> source) : base(source) { }
} 
```

然后，在您要序列化的类中，只需将成员指定为：

```
[DataMember]
public PropertyList Properties; 
```

# prolog - 如何验证序言文件子句数据库中是否存在规则

> ID：321974
> 
> 赞同：5
> 
> 时间：2008-11-26T20:07:38.227
> 
> 标签：prolog

我正在做一项大学作业，我必须验证当前子句数据库中是否存在某个子句（作为事实或规则）。

这个想法是使用一个头部为 verify(+name, +arguments) 的规则。如果数据库中存在另一个头部为名称（参数）的规则，则此规则应为真

任何帮助将不胜感激...

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-03T21:07:42.037

使用`call/1`不是一个好主意，因为`call/1`实际上调用了目标，但您只想找出事实/规则是否*存在*，并且您不想在长时间计算后等待调用可能触发，并且您不想如果被调用的规则依次调用，则在屏幕上打印一些内容，例如`writeln/1`。此外，`verify/2`即使调用失败，您也希望成功（但事实/规则不存在）。

作为一种解决方案，SWI-Prolog 提供`callable/1`

```
callable(+Term)

True if Term is bound to an atom or a compound term,
so it can be handed without type-error to call/1, functor/3 and =../2. 
```

这里有两个版本`verify/2`，一个正在使用`call/1`，另一个正在使用`callable/1`。

```
verify1(Name, Arguments) :-
    Term =.. [Name | Arguments],
    call(Term).

verify2(Name, Arguments) :-
    Term =.. [Name | Arguments],
    callable(Term).

father(abraham, isaac) :-
    writeln('hello').

father(abraham, adam) :-
    fail. 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T21:03:23.263

你熟悉统一的概念吗？您要做的是：只需调用一个看起来像您要查找的谓词。

所以，在你的数据库中说是：

```
father(abraham,isaac). 
```

现在你想调用类似的东西：

```
verify(father,[abraham,isaac]). 
```

然后，您的谓词主体将必须包含一个调用机制，`father(abraham,isaac).`然后应该返回`true.`Calling`father(abraham,adam)`应该失败。

为此，您将需要两个谓词：`=../2`和`call/2`。如果您使用的是 SWI-Prolog，请从解释器的命令行调用`help(=..).`和`help(call)`访问文档。

我希望我没有破坏你的任务。您仍然需要找出如何处理部分实例化的谓词（因此，`verify(father,[abraham,X]).`您可以自己说一些类似的话，但从这里开始应该不难。

祝你好运。

# iis - 在 Xbap 上发布到 Windows Server 2003 上的 IIS

> ID：321977
> 
> 赞同：2
> 
> 时间：2008-11-26T20:08:58.007
> 
> 标签：iis, windows-server-2003, xbap

我编写了一个 Xbap 应用程序并将其发布到 Windows XP 计算机上没有任何问题。现在我想将 Xbap 应用程序发布到运行 Windows Server 2003 的计算机上。发布应用程序时我没有遇到任何失败，但是当我尝试浏览应用程序时出现故障并且无法浏览应用程序。

当我尝试运行[http://localhost/MyApp/setup.exe](http://localhost/MyApp/setup.exe)时，它​​说找不到该文件...

与 Windows XP 相比，当发布到 Windows Server 2003 计算机时，我还有其他事情要做

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T08:27:35.457

这里的问题似乎是 IIS 中的 MIME 类型。通过在 IIS 中注册以下 MIME 类型解决了我的问题：

*   .manifest 应用程序/清单
*   .xaml 应用程序/xaml+xml
*   .application 应用程序/x-ms-应用程序
*   .xbap 应用程序/x-ms-xbap
*   .deploy 应用程序/八位字节流
*   .xps 应用程序/vnd.ms-xps 文档

有关如何执行此操作的更多信息，请参阅：

[http://msdn.microsoft.com/en-us/library/ms752346.aspx#content_expiration](http://msdn.microsoft.com/en-us/library/ms752346.aspx#content_expiration)

*   项目清单

# php - 你如何确定一个变量是否包含 PHP 中的文件指针？

> ID：321979
> 
> 赞同：2
> 
> 时间：2008-11-26T20:09:20.423
> 
> 标签：php

正如问题所述：如何检查 PHP 中的变量是否包含文件指针？有些人喜欢`is_string()`或`is_object()`。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-26T20:38:04.110

您可以使用`get_resource_type()`- [http://us3.php.net/manual/en/function.get-resource-type.php](http://us3.php.net/manual/en/function.get-resource-type.php)。如果它根本不是资源，该函数将返回 FALSE。

```
$fp = fopen("foo", "w");
...
if(get_resource_type($fp) == 'file' || get_resource_type($fp) == 'stream') {
    //do what you want here
} 
```

PHP 文档说上述函数调用应该返回“文件”，但在我的设置中它返回“流”。这就是我检查上述任一结果的原因。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-26T20:12:45.377

你可以用[`stream_get_meta_data()`](http://www.php.net/manual/en/function.stream-get-meta-data.php)这个。

```
<?php
$f = fopen('index.php', 'r');
var_dump(stream_get_meta_data($f));
?>

array
  'wrapper_type' => string 'plainfile' (length=9)
  'stream_type' => string 'STDIO' (length=5)
  'mode' => string 'r' (length=1)
  'unread_bytes' => int 0
  'seekable' => boolean true
  'uri' => string 'index.php' (length=9)
  'timed_out' => boolean false
  'blocked' => boolean true
  'eof' => boolean false 
```

如果变量不是资源，您可以在它前面加上 @ 以抑制警告 - 然后只需检查它是否返回 false。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-26T20:45:41.473

如前所述，您可以使用 stream_get_meta_data 或 get_resource_type 来检查您正在处理的资源类型。

更好更可靠的方法是使用 SPL 处理文件，它可以省去一些麻烦，让您的生活更愉快。这种可能性尚未得到很好的记录，因此许多开发人员为文件对象创建了自己的包装器，但您可能会在这里找到所需的一切：

[http://www.php.net/~helly/php/ext/spl/classSplFileObject.html](http://www.php.net/~helly/php/ext/spl/classSplFileObject.html)

[http://www.php.net/~helly/php/ext/spl/classSplFileInfo.html](http://www.php.net/~helly/php/ext/spl/classSplFileInfo.html)

第一个提供了读取、写入、查找文件等的方法......

第二个提供有关您正在使用的对象的元信息，其中有一个方法：

$object->isFile();

# debugging - 在 x86 上使用 GDB 而不调试符号？

> ID：321985
> 
> 赞同：18
> 
> 时间：2008-11-26T20:11:52.320
> 
> 标签：debugging, gdb, breakpoints, symbols

如何使用 GDB 调试在 32 位 x86 处理器上没有调试符号的程序？检查函数参数、局部变量、解析指针对于知道如何做很有用。其目的并不是真正将其用于逆向工程，因为我有时只是懒得安装调试符号，并且很高兴知道如何从 gdb 中获取一些基本信息。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-07-14T01:56:50.787

首先，您可以这样做；

```
gdb "whatever"
break __libc_start_main
r 
```

这将在 libc 的 crt0 代码中设置一个断点，并允许您在 main 之前中断，即使目标二进制文件被完全剥离。

这将使您在大多数用户代码之前的断点处进入运行状态。然后，您可以随心所欲地单步执行、分解、转储内存等。

这适用于所有平台，您询问 IA-32 / x86 的事实并不重要。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-26T20:22:23.940

如果没有调试符号，则只能在 ASM 级别进行调试。好的，您可以获得*更多*信息，但除非您了解一点 ASM 和编译器生成的代码，否则您不会走得太远。*如果*您知道自己在做什么，这将让您对局部变量等进行简单的检查。

如果你有源代码，重新编译它会容易得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-27T00:43:53.210

您所能做的就是查看寄存器和堆栈的内容 - 正如 Draemon 所提到的，您必须通过推断事物的用途来完成所有事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-12-06T04:59:51.273

嗯，绝对最重要的是你能够展开堆栈。可以通过三种方式确保这一点：

*   构建调试符号`-g`

*   在通过表进行 C++ 异常展开的系统上（这些天可能是任何 ELF？），该[`-funwind-tables`](http://gcc.gnu.org/onlinedocs/gcc/Code-Gen-Options.html#index-funwind_002dtables-2153)标志将告诉它生成此类表而不管语言如何，并且 GDB 可以使用这些表（至少，对于 x86 linux 可以）。

*   或者，如果失败了，至少确保`-fomit-frame-pointer`没有启用

# algorithm - 最大线性维度 2d 点集

> ID：321989
> 
> 赞同：11
> 
> 时间：2008-11-26T20:14:32.613
> 
> 标签：algorithm, graphics, geometry

给定一组有序的 2D 像素位置（相邻或相邻对角线），它们形成一条没有重复的完整路径，如何确定周长为该组像素的多边形的最大线性尺寸？（其中 GLD 是集合中任何一对点的最大线性距离）

对于我的目的，显而易见的 O(n^2) 解决方案对于数千点的数字可能不够快。是否有良好的启发式或查找方法可以使时间复杂度更接近 O(n) 或 O(log(n))？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-26T22:40:23.770

一种简单的方法是首先找到点的凸包，这可以通过多种方式在 O(n log n) 时间内完成。[我喜欢[格雷厄姆扫描](http://en.wikipedia.org/wiki/Graham_scan)（见[动画](http://www.cs.princeton.edu/courses/archive/fall08/cos226/demo/ah/GrahamScan.html)），但[增量](http://www.cse.unsw.edu.au/~lambert/java/3d/incremental.html)算法也很流行，[其他](http://www.cse.unsw.edu.au/~lambert/java/3d/hull.html)算法也很流行，虽然有些需要[更多时间](http://www.algorithmist.com/index.php/Convex_Hull)。]

然后你可以通过从凸包上的任意两个点（比如 x 和 y）开始，顺时针移动 y 直到它离 x 最远，然后移动 x，再次移动 y 等，找到最远的对（直径）。你可以证明整个事情只需要 O(n) 时间（摊销）。所以它总共是 O(n log n)+O(n)=O(n log n)，如果你使用礼物包装作为凸包算法，可能是 O(nh)。正如你提到的，这个想法被称为[旋转卡尺。](http://en.wikipedia.org/wiki/Rotating_calipers)

这是[David Eppstein](http://code.activestate.com/recipes/117225/)（计算几何研究员；另请参阅他的[Python 算法和数据结构](http://www.ics.uci.edu/~eppstein/PADS/)以供将来参考）的代码。

所有这些都不是很难编码（最多应该是一百行；在上面的 Python 代码中少于 50 行），但在你这样做之前——你应该首先考虑你是否真的需要它。如果如您所说，您只有“数千个点”，那么在任何合理的编程语言中，简单的 O(n^2) 算法（比较所有对）将在不到一秒的时间内运行。即使有一百万点，也不应该超过一个小时。:-)

您应该选择*最简单*的有效算法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T20:16:13.373

在本页面：

*   [http://en.wikipedia.org/wiki/Rotating_calipers](http://en.wikipedia.org/wiki/Rotating_calipers)
*   [http://cgm.cs.mcgill.ca/~orm/diam.html](http://cgm.cs.mcgill.ca/~orm/diam.html)

它表明您可以在 O(n) 中确定凸多边形的最大直径。我只需要先将我的点集变成一个凸多边形（可能使用格雷厄姆扫描）。

*   [http://en.wikipedia.org/wiki/Convex_hull_algorithms](http://en.wikipedia.org/wiki/Convex_hull_algorithms)

这是我在计算凸包时遇到的一些 C# 代码：

*   [http://www.itu.dk/~sestoft/gcsharp/index.html#hull](http://www.itu.dk/~sestoft/gcsharp/index.html#hull)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T20:20:24.287

我将 Python 代码移植到 C#。它似乎工作。

```
using System;  
using System.Collections.Generic;  
using System.Drawing;  

// Based on code here:  
//   http://code.activestate.com/recipes/117225/  
// Jared Updike ported it to C# 3 December 2008  

public class Convexhull  
{  
    // given a polygon formed by pts, return the subset of those points  
    // that form the convex hull of the polygon  
    // for integer Point structs, not float/PointF  
    public static Point[] ConvexHull(Point[] pts)  
    {  
        PointF[] mpts = FromPoints(pts);  
        PointF[] result = ConvexHull(mpts);  
        int n = result.Length;  
        Point[] ret = new Point[n];  
        for (int i = 0; i < n; i++)  
            ret[i] = new Point((int)result[i].X, (int)result[i].Y);  
        return ret;  
    }  

    // given a polygon formed by pts, return the subset of those points  
    // that form the convex hull of the polygon  
    public static PointF[] ConvexHull(PointF[] pts)  
    {  
        PointF[][] l_u = ConvexHull_LU(pts);  
        PointF[] lower = l_u[0];  
        PointF[] upper = l_u[1];  
        // Join the lower and upper hull  
        int nl = lower.Length;  
        int nu = upper.Length;  
        PointF[] result = new PointF[nl + nu];  
        for (int i = 0; i < nl; i++)  
            result[i] = lower[i];  
        for (int i = 0; i < nu; i++)  
            result[i + nl] = upper[i];  
        return result;  
    }  

    // returns the two points that form the diameter of the polygon formed by points pts  
    // takes and returns integer Point structs, not PointF  
    public static Point[] Diameter(Point[] pts)  
    {  
        PointF[] fpts = FromPoints(pts);  
        PointF[] maxPair = Diameter(fpts);  
        return new Point[] { new Point((int)maxPair[0].X, (int)maxPair[0].Y), new Point((int)maxPair[1].X, (int)maxPair[1].Y) };  
    }  

    // returns the two points that form the diameter of the polygon formed by points pts  
    public static PointF[] Diameter(PointF[] pts)  
    {  
        IEnumerable<Pair> pairs = RotatingCalipers(pts);  
        double max2 = Double.NegativeInfinity;  
        Pair maxPair = null;  
        foreach (Pair pair in pairs)  
        {  
            PointF p = pair.a;  
            PointF q = pair.b;  
            double dx = p.X - q.X;  
            double dy = p.Y - q.Y;  
            double dist2 = dx * dx + dy * dy;  
            if (dist2 > max2)  
            {  
                maxPair = pair;  
                max2 = dist2;  
            }  
        }  

        // return Math.Sqrt(max2);  
        return new PointF[] { maxPair.a, maxPair.b };  
    }  

    private static PointF[] FromPoints(Point[] pts)  
    {  
        int n = pts.Length;  
        PointF[] mpts = new PointF[n];  
        for (int i = 0; i < n; i++)  
            mpts[i] = new PointF(pts[i].X, pts[i].Y);  
        return mpts;  
    }  

    private static double Orientation(PointF p, PointF q, PointF r)  
    {  
        return (q.Y - p.Y) * (r.X - p.X) - (q.X - p.X) * (r.Y - p.Y);  
    }  

    private static void Pop<T>(List<T> l)  
    {  
        int n = l.Count;  
        l.RemoveAt(n - 1);  
    }  

    private static T At<T>(List<T> l, int index)  
    {  
        int n = l.Count;  
        if (index < 0)  
            return l[n + index];  
        return l[index];  
    }  

    private static PointF[][] ConvexHull_LU(PointF[] arr_pts)  
    {  
        List<PointF> u = new List<PointF>();  
        List<PointF> l = new List<PointF>();  
        List<PointF> pts = new List<PointF>(arr_pts.Length);  
        pts.AddRange(arr_pts);  
        pts.Sort(Compare);  
        foreach (PointF p in pts)  
        {  
            while (u.Count > 1 && Orientation(At(u, -2), At(u, -1), p) <= 0) Pop(u);  
            while (l.Count > 1 && Orientation(At(l, -2), At(l, -1), p) >= 0) Pop(l);  
            u.Add(p);  
            l.Add(p);  
        }  
        return new PointF[][] { l.ToArray(), u.ToArray() };  
    }  

    private class Pair  
    {  
        public PointF a, b;  
        public Pair(PointF a, PointF b)  
        {  
            this.a = a;  
            this.b = b;  
        }  
    }  

    private static IEnumerable<Pair> RotatingCalipers(PointF[] pts)  
    {  
        PointF[][] l_u = ConvexHull_LU(pts);  
        PointF[] lower = l_u[0];  
        PointF[] upper = l_u[1];  
        int i = 0;  
        int j = lower.Length - 1;  
        while (i < upper.Length - 1 || j > 0)  
        {  
            yield return new Pair(upper[i], lower[j]);  
            if (i == upper.Length - 1) j--;  
            else if (j == 0) i += 1;  
            else if ((upper[i + 1].Y - upper[i].Y) * (lower[j].X - lower[j - 1].X) >  
                (lower[j].Y - lower[j - 1].Y) * (upper[i + 1].X - upper[i].X))  
                i++;  
            else  
                j--;  
        }  
    }  

    private static int Compare(PointF a, PointF b)  
    {  
        if (a.X < b.X)  
        {  
            return -1;  
        }  
        else if (a.X == b.X)  
        {  
            if (a.Y < b.Y)  
                return -1;  
            else if (a.Y == b.Y)  
                return 0;  
        }  
        return 1;  
    }  
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T20:21:44.173

你可以画一个比多边形大的圆并慢慢缩小它，检查你是否与任何点相交。那么你的直径就是你要找的数字。不确定这是否是一个好方法，它听起来介于 O(n) 和 O(n^2) 之间

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-26T20:25:02.357

我的现成解决方案是尝试二进制分区方法，您在中间画一条线 somwwhere 并检查所有点与该线中间的距离。这将为您提供 2 个大概非常远的点。然后检查这两者的距离并重复上述距离检查。重复这个过程一段时间。

我的直觉说这是一个 n log n 启发式，会让你非常接近。

# cross-platform - 用于跨平台桌面应用程序的嵌入式 Web 浏览器引擎？

> ID：321991
> 
> 赞同：5
> 
> 时间：2008-11-26T20:15:08.290
> 
> 标签：cross-platform, browser, desktop-application

> **可能重复：**
> [如何在跨平台应用程序中嵌入 Web 浏览器控件？](https://stackoverflow.com/questions/2721201/how-to-embed-a-web-browser-control-in-a-cross-platform-application)

我想在我的桌面应用程序中嵌入一个浏览引擎（HTML、JS、CSS、DOM）。如果我想在跨平台的桌面应用程序中使用它，哪一个最适合我？

我应该坚持一个特定的还是在本地人的基础上编写自己的抽象层？

更新：解决方案至少需要为 Windows/Mac/Linux 提供一个选项。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-26T20:37:14.393

WebKit 非常轻量级，可以在所有平台上运行。您将不得不查看 Google Chrome 以了解如何将其嵌入到 Windows 应用程序中。我相信它是 GTK 原生的。还有 wxWidgets / wxPython 的绑定。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T20:38:58.023

Qt 高度优化、跨平台且具有原生外观，可用于 C++、Java 和 Python，并且包括 WebKit。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-08T23:53:46.663

[Awesomium 可以满足](http://www.awesomium.com)您的需求——它是一个基于 Google Chromium 的跨平台（Windows 和 Mac OSX）库，旨在帮助用户在其应用程序中嵌入全功能浏览器。它可免费用于非商业用途，并具有 C++ API。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T20:32:20.003

> 我应该......在本地人的基础上编写自己的抽象层吗？

在为这个确切的问题而苦苦挣扎后，我认为这是目前唯一安全的选择。像 *nix 上的 Webkit 和 Windows 上的 Internet Explorer。

# silverlight - Silverlight 是否为每个浏览器选项卡使用单独的应用程序域？

> ID：321999
> 
> 赞同：2
> 
> 时间：2008-11-26T20:16:52.407
> 
> 标签：silverlight, appdomain, applicationdomain

如果同一个 Silverlight 应用程序在两个 Web 浏览器选项卡中运行，每个选项卡是否使用单独的应用程序域？

如果您知道 Microsoft 在何处明确提供此信息，请提供参考。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T13:37:56.813

为了澄清科尔宾的回答：

每个 Silverlight 控件实例有一个 AppDomain，因此同一页面上的两个 Silverlight 应用程序被分割为 AppDomain。根据浏览器的不同，选项卡之间可能存在分隔（例如，IE8 和 Chrome 使用单独的进程，而 Firefox 和 IE7 则没有）。让两个 Silverlight 实例相互通信的唯一方法是在同一页面上并通过 HTML 桥进行通信。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-27T06:29:52.027

不是直接来自 Microsoft，而是每个 Silverlight 实例一个 AppDomain：

*   [http://community.irritatedvowel.com/blogs/pete_browns_blog/archive/2007/11/07/How-Silverlight-is-Loaded-and-Instantiated.aspx](http://community.irritatedvowel.com/blogs/pete_browns_blog/archive/2007/11/07/How-Silverlight-is-Loaded-and-Instantiated.aspx)
*   [http://wilcob.com/Wilco/Silverlight/asp-net-silverlight-component-development.aspx](http://wilcob.com/Wilco/Silverlight/asp-net-silverlight-component-development.aspx)
*   [blogs.msdn.com/apardoe/attachment/6644139.ashx（Powerpoint](http://blogs.msdn.com/apardoe/attachment/6644139.ashx) - 幻灯片 15）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T21:25:09.630

浏览器完全控制选项卡，出于明显的安全原因，应将它们分开。**`******************************************