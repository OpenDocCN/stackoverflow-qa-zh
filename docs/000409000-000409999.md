# StackOverflow 问答 000409000-000409999

# delphi - Delphi：限制 TCP 连接

> ID：409003
> 
> 赞同：6
> 
> 时间：2009-01-03T12:46:03.967
> 
> 标签：delphi, sockets, tcp, connection, limit

我在我的 Delphi 应用程序中使用 TServerSocket 组件。我想限制客户端连接，比如说一千。不幸的是，我不知道该怎么做。该组件不提供任何属性，如“MaxConnections”或任何其他类似的属性。

我使用 OnGetThread 事件创建新的服务器线程 (TServerClientThread)。为了获得活动连接的数量，我使用了“Socket.ActiveConnections”属性。

不幸的是，我不知道该怎么办。当连接数超过限制时，我尝试不在 OnGetThread 过程中创建任何线程，但它没有改变任何东西 - 客户端，即使它无法发送或接收任何信息，它也可以连接到服务器并保持连接。怎么做才能不允许新客户端连接或只允许他们连接但立即断开连接？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-03T13:23:30.960

上次我使用 Delphi 是几年前，但我有类似的情况要处理，我的经验可能对你有用：我面临同样的问题并且不想切换到“Indy”组件，因为（ big) 应用程序不值得移植。据我所知，您应该在服务器套接字上有一个**onClientConnect**事件，这是我检查的限制：

```
.onClientConnect( Sender: TObject; aSocket: T... )
begin
    if( YourServerSocket.ActiveConnections > YourDefinedMaxConnections )
    begin
        // Drop the connection
        aSocket.Close;
    end;
end 
```

除此之外，我不记得更多了，但我认为我在这些方面做了一些事情，或者至少这是我想出的。

# asp.net - asp.net 网络统计 - 谷歌分析

> ID：409012
> 
> 赞同：2
> 
> 时间：2009-01-03T13:01:09.553
> 
> 标签：asp.net, google-analytics

我想将跟踪添加到我的网站。我看到谷歌分析似乎跟踪我需要什么。

那么我是否将谷歌分析片段粘贴在每个页面中，在母版页中，只是在我的默认页面中？获得最佳指标的最佳实践是什么。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-03T13:03:51.513

谷歌分析代码片段必须在您要跟踪的每个页面上。

最简单的方法是将代码放入母版页（如果您使用它们）。

否则将其放在每个页面上，或将其放入用户控件中，您可以将其包含在相关页面上或使用服务器端包含将其包含在内，例如：

```
<!-- #include file="file_containing_google_analytics_code.js" --> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T14:47:29.557

这取决于您网站的结构。如果您有少量母版页，那么它是有意义的，或者您可以将一些代码放在一个基类中发出它，您可以从该基类继承您的所有页面（或母版页），或者如果您有一个标准的页脚控件您可以在所有页面上使用它。

我通常将它包装在 ASP.Net 中的占位符中，并有一些代码从 web.config 设置中打开/关闭它，因此当站点在测试/UAT/dev 机器中运行时它不会出现。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T13:11:09.987

我们使用 Google Analytics，并将其合并到我们的基本页面中——尽管我们的第一个实现是使用 HttpModule 完成的。

我喜欢基页方法，因为它是一些志趣相投的任务的共同领域。它还将视图状态移动到表单的底部，删除空格等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-04T03:30:49.203

你应该看看这里：http: [//blog.sb2.fr/post/2008/12/21/Google-Analytics-WebControl-for-ASPNET.aspx](http://blog.sb2.fr/post/2008/12/21/Google-Analytics-WebControl-for-ASPNET.aspx)

# asp.net - 使用 ASP.Net 使用模板和 XPath 生成 WordML 报告

> ID：409020
> 
> 赞同：2
> 
> 时间：2009-01-03T13:10:09.833
> 
> 标签：asp.net, xml, xpath, wordml

我需要知道我们如何使用模板和使用 ASP.Net 的 XPath 生成 WordML 报告。它的优点是什么。

我需要一个简单的如何教程。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-03T13:23:40.990

> 我需要知道我们如何使用模板和使用 ASP.Net 的 XPath 生成 WordML 报告。... 一个简单的教程是我所需要的。

创建（使用 Word）您将用作模板的 WordML 格式的文档。

查看您的 WordML 模板：看看它是 XML 格式的。有微软的 WordML 参考文档，让你了解它的含义以及如何修改它。

定义 XPath 表达式，标识模板中要修改的位置（其中“修改”可能意味着“在运行时插入数据”）。

在运行时使用类似[http://www.google.com/search?hl=en&q=c%23+xpath的 API](http://www.google.com/search?hl=en&q=c%23+xpath)

> 它的优点是什么。

它比什么替代品有优势？

**好处**是输出是一个 Word 文档，其内容基于模板加上在运行时所做的修改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T14:21:44.977

我建议您使用内容控件和自定义 XML 来生成报告。这是一个示例：

[http://blogs.msdn.com/erikaehrli/archive/2006/08/11/word2007DataDocumentGenerationPart1.aspx](http://blogs.msdn.com/erikaehrli/archive/2006/08/11/word2007DataDocumentGenerationPart1.aspx)

您可能还想看看 Microsoft 的 OpenXML SDK v2.0

# javascript - 在 Opera 中使用 jquery 将容器宽度更改为 32767 以上

> ID：409025
> 
> 赞同：1
> 
> 时间：2009-01-03T13:16:00.740
> 
> 标签：javascript, jquery, width, opera

我想用 jquery 制作一个迷你时间线，并且这个时间线的宽度超过 32767 像素。当我在 Opera 中使用 jquery 更改它时`$(".timelinecontainer").width(32767);`不会更改它，但在其他浏览器中它可以工作。

你能给我建议让它在 Opera 中工作吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-03T13:22:30.570

我怀疑 Opera 将窗口宽度保持得很短，因此无法处理大于 32767 的值。无论如何，您可能应该改变方法并缩放时间线以适合当前窗口，然后可以放大部分它。我认为您的界面会以这种方式看起来和工作得更好。您似乎正在这样做，用户将不得不进行大量滚动才能查看时间线，并且永远无法完整地看到它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-03T13:36:12.633

我敢肯定我会因为这样说而被激怒，但是——你可以忽略 Opera。

如果您喜欢其他浏览器（IE、FF、Safari/Chrome）中的外观，那么我会说您已经覆盖了 99% 的基础。

当然，您可能想针对 Opera 提交错误。（虽然我猜它可能是 jquery——它可能有不同的 Opera 代码路径）。如果您可以制作一个简单的 HTML 页面来重现该问题，您就会知道。然后，将其附加到错误报告中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-06T11:38:45.467

这是一个非常古老的 Opera 错误，由于某种原因他们无法解决。Opera 仅在某些地区流行，开发人员大多忽略了这个错误。

对此没有自动化解决方案。作为一种快速解决方案，您可以在脚本中检测网络浏览器并限制 Opera 的宽度。举个例子 - 在 Opera 中滚动[这个吉他标签](http://rockby.net/en/gtp.php?tab=Limp-Bizkit/Behind-Blue-Eyes/3#multitrack)到末尾。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-04T15:27:27.013

这是一个错误，已在[http://my.opera.com/desktopteam提供的 Opera 12 pre-alphas 中修复](http://my.opera.com/desktopteam)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-07T12:25:42.363

我可以确认这确实是当前 Opera 版本中的一个错误。好消息是我们正在努力修复它（我为 Opera 工作，所以我知道那里发生了什么 :)），所以在不久的将来，您的脚本应该开始按预期工作。

我实际上建议，如果上述第一个答案建议的解决方法太难实施，您应该忽略该问题并等待修复它的 Opera 升级。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-03T23:21:53.903

这绝对是 Opera 的一个错误。

巧合的是，我昨天才第一次看到它。在我的情况下，我有一个内部容器`width:9999em`和一个外部容器，用于`overflow:hidden`创建`scrollLeft()`旋转木马。在 Opera 中，`scrollLeft()`在该宽度处停止响应。

使用 Opera 提交错误：[https ://bugs.opera.com/wizard/](https://bugs.opera.com/wizard/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-03T23:26:02.210

听起来对我来说也是一个 Opera 错误。

为什么不看看 Simile 的 Timeline 项目（[http://simile.mit.edu/timeline/](http://simile.mit.edu/timeline/)），看看他们是如何做到的？

# java - NetBeans Web 服务客户端对 eBay API 产生无效请求

> ID：409045
> 
> 赞同：1
> 
> 时间：2009-01-03T13:39:30.973
> 
> 标签：java, soap, netbeans, jax-ws, ebay-api

我正在尝试使用 NetBeans 的“新 Web 服务客户端”向导和[此处](http://developer.ebay.com/webservices/latest/ShoppingService.wsdl)找到的 WSDL 为 eBay API 制作我的第一个 Web 服务客户端。我的理解是这是使用JAX-WS生成类文件，我的请求都是SOAP。

一切似乎都正常，除了当我尝试执行请求时，eBay 会以 404 响应，如果调用对它没有意义，这似乎是它的标准响应。

Wireshark 将我的请求显示为：

```
<?xml version="1.0" ?>
<S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/">
<S:Body>
<FindItemsRequest xmlns="urn:ebay:apis:eBLBaseComponents">
<QueryKeywords>dvd players</QueryKeywords>
</FindItemsRequest></S:Body></S:Envelope> 
```

但是 eBay API 测试工具说它应该是这样的：

```
<?xml version="1.0" encoding="utf-8"?>
<FindItems xmlns="urn:ebay:apis:eBLBaseComponents">
<QueryKeywords>dvd players</QueryKeywords>
</FindItems> 
```

因此，NetBeans 用我只能假设是一些标准的 SOAP 结构来包装我的请求，并将“请求”附加到调用的名称中。

它从哪里得到这个“信封”命名空间，为什么 eBay 不使用它？我如何告诉 NetBeans 我真正想要它做什么？

我还想知道 eBay SDK 比这种方法有什么好处（如果有效的话）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-03T15:34:16.920

我设法弄清楚了，像往常一样，我因为没有彻底阅读 API 文档而自责。

eBay API 期望在提供 404 以外的任何内容之前设置某些 HTTP 标头。

之后，NetBeans 提出的 SOAP 请求被 eBay 正确解释并返回了预期的结果。

[eBay 购物 API HTTP 标头值](http://developer.ebay.com/DevZone/shopping/docs/Concepts/ShoppingAPI_FormatOverview.html#StandardURLParameters)

[JAX-WS 用户指南 - 设置 HTTP 标头](https://jax-ws.dev.java.net/guide/HTTP_headers.html)

# mysql - 在 MySQL 中进行增量备份的最佳方法是什么？

> ID：409046
> 
> 赞同：14
> 
> 时间：2009-01-03T13:42:27.380
> 
> 标签：mysql, database, backup

我们使用的是 MySQL 5.0 版，大部分表都是 InnoDB。我们运行复制到从服务器。我们正在考虑每天备份 MySQL 日志文件。

# 问题

*   有没有其他方法可以在不使用日志文件的情况下进行增量备份？
*   进行增量备份时的最佳做法是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-03T14:04:13.140

AFAIK 进行增量备份的唯一方法是使用二进制日志。如果要进行完整备份（InnoDB hotcopy），您还有其他选择，但增量意味着您需要记录所有事务。

您需要问自己为什么要备份数据。由于您有一个用于复制的从属设备，我假设备份主要用于在意外删除的情况下恢复数据？

我可能会每 1 小时轮换一次日志并对其进行备份。意思是，还原最多会使数据保留 1 小时，并且您可以还原到自上次完整快照以来的任何时间点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2017-06-21T13:45:15.543

您可以使用 mysqldump 定期转储您的模式，每个模式始终使用相同的文件名和路径（即替换最新的）

然后将其与任何支持增量/增量备份的备份工具结合使用，例如 rdiff-backup、duplicity、Duplici 或 Areca Backup。来自duplicity docs的一个例子：

> 由于 duplicity 使用 librsync，增量归档节省空间，并且仅记录自上次备份以来已更改的文件部分

这样，您的第一个备份将是第一个完整转储的压缩副本，第二个备份将包含与第一个和第二个转储的压缩差异，依此类推。您可以恢复任意时间点的 mysqldump 文件，然后将该文件恢复到 MySQL。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2020-11-10T17:54:29.517

自上次回答以来已经过去了很长时间，在此期间出现了一些用于实施增量备份的解决方案和工具。

两个主要的：

*   Percona XtraBackup - 是基于 MySQL 的服务器的开源热备份实用程序，在备份期间不会锁定您的数据库。它还允许您创建增量备份。更多细节[在这里](http://Https://www.percona.com/doc/percona-xtrabackup/2.4/backup_scenarios/incremental_backup.html)。

    这很简单，看起来像这样：

    ```
    xtrabackup --backup --target-dir=/data/backups/inc1 --incremental-basedir=/data/backups/base 
    ```

*   `mysqlbackup`是一个实用程序，包含在 mysql 企业版中。它很像 percona xtrabackup。
    可以在[这里](https://www.percona.com/doc/percona-xtrabackup/2.4/intro.html#mysql-backup-tool-feature-comparison)找到详细的比较
    它具有`--incremental`允许您进行增量备份的参数。更多细节[在这里](https://dev.mysql.com/doc/mysql-enterprise-backup/4.1/en/mysqlbackup.incremental.html)

    ```
    mysqlbackup --defaults-file=/home/dbadmin/my.cnf --incremental --incremental-base=history:last_backup --backup-dir=/home/dbadmin/temp_dir --backup-image=incremental_image1.bi backup-to-image 
    ```

这两个实用程序进行物理备份（复制数据库文件），但您仍然可以对 binlog 文件进行逻辑备份。

您可以自己编写脚本，也可以使用 github 上的现成脚本：

[macournoyer/mysql_s3_backup](https://github.com/macournoyer/mysql_s3_backup)

[Abhishek-S-Patil/mysql-backup-incremental](https://github.com/Abhishek-S-Patil/mysql-backup-incremental)

实际上，还有一些付费解决方案是这些工具的漂亮包装：

[SqlBak](https://sqlbak.com/)

[数据库思维](http://www.databasethink.com/)

**进行增量备份时的最佳做法是什么？**

这完全取决于您的架构、数据量、您可以接受的最大允许停机时间间隔。允许的最大数据丢失间隔。在设置备份之前考虑这些事情。

我只想提一个很好的做法，但非常重要，而且经常被遗忘。在另一台不相关的服务器上定期测试和运行恢复脚本。

# asp.net-mvc - .NET MVC - 从另一个控制器操作调用控制器操作

> ID：409049
> 
> 赞同：31
> 
> 时间：2009-01-03T13:49:06.133
> 
> 标签：asp.net-mvc, controller

我有一个控制器动作，我想调用另一个控制器动作。

这是一个有效的事情。是否可以？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-03T13:50:21.077

`Controller.RedirectToAction`

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-03T13:57:24.057

正如@Justice 所说，您可以使用 RedirectToAction。此外，您可以使用 TempData 在控制器操作之间传递模型（和其他）数据。

# deployment - 如何构建 Java EE 系统？如何定义术语应用程序以及 EAR 的内容？

> ID：409050
> 
> 赞同：2
> 
> 时间：2009-01-03T13:49:40.250
> 
> 标签：deployment, build-process, jakarta-ee, build-automation, packaging

我正在为使用 Java EE 5 开发的大型软件系统设计构建系统和目录结构。构建系统将使用 ant 实现。

我们有多种不同的服务，它们按主题分组。每个服务都提供 Web 服务或 EJB。每个服务都运行在一个专用的应用服务器集群上。因此，我们有多个集群，其中一些集群可以按主题进行逻辑分组。

我确实阅读了通用定义和示例，但我仍然对 Java EE 术语感到困惑：

*   什么是 Java EE 应用程序？因此，EAR 文件的内容是什么？
*   什么是 Java EE 项目？（Netbeans 以及企业应用程序的 Java 蓝图指南项目约定中都使用了该术语）

我是否必须将所有 EJB 和 WAR-module-package-files 放在一个 EAR 中，以便这个 EAR 包含我们的完整系统？

或者我是否将每组服务放入一个 EAR，尽管这些服务只是在逻辑上分组而不是在技术上分组？

或者我是否为每个服务组装了一个单独的 EAR，即通常只包含一个 EJB jar 文件，有时还包含 EJB 和一个 WAR 文件？

或者我是否摒弃了应用程序的概念，只构建 EJB 和 WAR 文件，以便每个应用程序服务器集群只有一个部署文件？

我想，我的主要问题是：打包 EAR 文件有什么好处？

正如我目前所看到的，只需要 EAR-EJB 和 WAR 文件以及 ant-build-system 中嵌套子项目的概念和我们源代码的目录结构？

编辑：非常感谢您的回答！在我看来，打包到耳朵中的应用程序是一个相当原子的子系统。所以我想，我将有一个嵌套的子项目结构（只有逻辑，只对构建系统和源目录结构可见）和相当多的 EAR，每个 EAR 大多只包含一个 ejb-jar和/或war模块并实现单个服务（部署在单个应用程序服务器集群上）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T14:11:17.463

这里有很多问题。

Java EE 项目是使用 Java EE 技术的 EAR 或 WAR 部署。如果您有一个带有 JSP 和 JDBC 访问关系数据库的 WAR，那就是一个 Java EE 项目。最初的意图是 EAR 文件是“企业”的，这意味着 EJB。EAR 文件包含 EJB、WAR、JAR、整个 enchilada。

在服务方面的想法有些不同。我认为部署值得仔细考虑，因为如果必须进行任何维护，则必须将打包在一起的组件一起关闭和启动。

因此，请仔细考虑如何打包服务。IMO，这不是一个全有或全无的答案。您应该查看您的服务正在做什么以及如何一起使用它们来决定应该如何打包和部署它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T14:23:20.090

我认为您决定放入每个 EAR 的内容受组织和技术问题的约束。

我认为 EAR 最重要的技术角色是运行时环境中的类加载器根。这通常意味着您可以在不同的 EAR 中部署不同版本的库和您自己的类。这意味着您应该保持容器根类路径相当空（或由容器供应商提供），因为它可能允许一个物理容器使用可能冲突的库来服务多个应用程序。如果您正在使用通用代码库开发许多不同的应用程序，这将是一个好消息。您可以将多个项目部署到同一个服务器场，而不会相互干扰。

您通常不会部署比 EAR 更小的软件单元。每个 EAR 都可以或多或少完全独立。我通常会让这些内容反映所属组织对应用程序或子系统的看法。您通常可以将相同的组件打包到多个 EAR 中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-05-21T08:08:54.120

逻辑和组织方面的考虑都会发挥作用。每个 EAR 将包含与特定功能相关的所有部分。我们总是可以假设每个 EAR 都是独立的，并且可以部署在一个或多个容器上。我一直遵循的典型方法是让每个 EAR 包含一个或多个 jars 和 war。每个 war 或 jar 都包含一些关键组件或一组相关组件。EAR 代表一个企业应用程序，其中包含应用程序的组件和 Web 应用程序。一个示例是我参与的支付处理系统。EAR 包含运行支付处理系统所需的一切。这包括六个罐子和 3 场战争。每个 jar 代表一些功能或功能的逻辑分组。每场战争都代表一个网络应用程序。罐子的一个例子'

*   核心功能的罐子
*   ejbs的罐子
*   一个装我们高级金融数学作品的罐子
*   一个 jar 用于我们的安全部件等。拥有多个 jar 是因为不同的人开发了不同的部件，因此他们在不同的 Eclipse 项目中工作并根据需要将它们组合起来。没有硬性规定，只要适合您的团队和情况即可。

# data-structures - 时间日历数据结构

> ID：409053
> 
> 赞同：5
> 
> 时间：2009-01-03T13:52:22.507
> 
> 标签：data-structures, time, calendar, performance, high-volume

我们正在考虑更新（重写）我们的系统，该系统存储有关人们在白天何时可以预订房间等信息。现在，我们将房间可用的开始时间和日期存储在一个表中，而在另一个表中存储个人约会时间。

从表面上看，以这种方式存储信息似乎是一个合乎逻辑的想法，但随着时间的推移和系统负载过重，我们开始意识到这种数据结构似乎效率低下。（搜索所有房间的可用时间并计算房间何时可用成为一项密集操作。如果房间在给定时间内可用，那么它可用的时间是否足够长以适应所请求的时间）。

我们一直在讨论如何让系统更高效，我们认为必须有更好的方法来解决这个问题。有没有人有关于如何去做的建议，或者有任何地方可以寻找如何构建这样的东西？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-03T13:58:35.897

我发现这本书很有启发性，对于任何涉及时间管理/约束的数据库来说都是必读的：

[使用 SQL 开发面向时间的数据库应用程序](http://sql-info.de/sql-notes/developing-time-oriented-database-applications-in-sql.html)

（*编辑补充*：这[本书](http://www.cs.arizona.edu/people/rts/publications.html)可以通过[Richard Snodgrass](http://www.cs.arizona.edu/people/rts/)的主页在线获得。这是一本好书。）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-03T16:57:00.933

@Radu094 为您指出了一个很好的信息来源 - 但处理它会很困难。

在一个非常实用的层面上，您是否考虑过将约会和可用信息记录在一个表中，而不是两个表中？对于每一天，将时间划分为“从不可用”（办公室开放之前、办公室关闭之后——如果发生这种情况）、“可用——可以分配”和“不可用”。这（两个或）三类预订将以连续的间隔记录（每个间隔的开始和结束时间都在单个记录中）。

对于每个房间和每个日期，有必要创建一组“未使用”预订（取决于您是否选择“从不可用”，该组可能是一个“可用”记录，也可能包括早班和晚班“永远不可用”记录）。

然后你必须弄清楚你在问什么问题。例如：

*   我可以在 T1 和 T2 之间的 Y 天预订房间 X 吗？
*   第 Y 天 T1 和 T2 之间有空房吗？
*   在 Y 天的什么时候房间 X 仍然可用？
*   在 Y 天的什么时候可以提供具有视听功能和可容纳 12 人的房间？
*   谁在 Y 天早上预订了房间 X？

这只是可能性的一小部分。但是通过对细节的关注和关注，查询变得易于管理。验证 DBMS 中的约束将更加困难。也就是说，确保如果时间 [T1..T2) 被预订，那么没有其他人预订 [T1+00:01..T2-00:01) 或任何其他重叠时段。请参阅Wikipedia 和其他地方[的 Allen 的区间代数](http://en.wikipedia.org/wiki/Allen%27s_Interval_Algebra)（包括[uci.edu](http://www.ics.uci.edu/~alspaugh/foundations/allen.html)上的这个）。

# asp.net-mvc - 休眠洞穴和 ASP.Net MVC

> ID：409059
> 
> 赞同：1
> 
> 时间：2009-01-03T13:59:01.917
> 
> 标签：asp.net-mvc, nhibernate, nhibernate-burrow

我使用休眠洞穴进行长时间的对话。我正准备将项目迁移到 ASP.NET MVC，但 burrow 不支持 MVC。

我试图将 Burrow 更改为通过 MVC 工作。但我不知道最好的方法是什么。我不确定 HTTP 模块是一个好方法。我想用 ActionFilters 来初始化对话。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T21:59:13.290

你可能想在这里 [http://blog.pragmasql.com/post/NHibernate-20-Sample-Project-using-NHibernateBurrow-contribution.aspx](http://blog.pragmasql.com/post/NHibernate-20-Sample-Project-using-NHibernateBurrow-contribution.aspx)看 一个使用 nhibernate burrow + asp.net mvc 的项目

# linux - 使用 AWK 删除字段前的空格

> ID：409060
> 
> 赞同：2
> 
> 时间：2009-01-03T14:00:42.430
> 
> 标签：linux, formatting, awk, whitespace

（*与同一个人提交的**[通过 AWK 保持原始格式 POST 几乎完全相同](https://stackoverflow.com/questions/408469/keeping-original-format-post-passing-through-awk)**。*）

**我有一个关于g** awk的简单问题，如下图所示：

```
 1 int blah (void)
  2 {
  3         if (foo) {
  4                 printf ("blah\n");
  5         }       
  6         return 0;
  7 } 
```

使用以下 gawk 代码 - 使用 gensub() 来维护原始格式：

```
 gawk '{ print gensub($1, "\t", 1) }' ./sample_code.out

     int blah (void)
     {
             if (foo) {
                     printf ("blah\n");
             }       
             return 0;
     } 
```

如何使用**g** awk 或 awk （可能使用正则表达式）删除字段 $1 之前的先前空格**（^）**

如下图所示：

```
 int blah (void)
 {
         if (foo) {
                 printf ("blah\n");
         }       
         return 0;
 } 
```

提前致以亲切的问候

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-03T14:22:57.267

```
awk '{sub(/^[ \t]+/, ""); print}' 
```

这是来自著名的 awk 1 衬垫列表，可以在这里找到：[http ://student.northpark.edu/pemente/awk/awk1line.txt](http://student.northpark.edu/pemente/awk/awk1line.txt)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T16:33:03.167

这让我觉得这是一个“错误的工作工具”。我会使用 sed`：

```
sed 's/^[ <tab>]*//' sample.out 
```

现在，如果问题全在于 的最内部细节`awk`，这可能无济于事；如果问题是要删除空格，它会更快并且（至少可以说）更简单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T14:24:05.440

这行得通，但要知道你总是想去掉 3 个空格。

```
vinko@parrot:~$ cat foo.c
  1 int blah（无效）
  2 {
  3 如果（富）{
  4 printf ("blah\n");
  5 }
  6返回0；
  7 }

vinko@parrot:~$ gawk '{ print gensub(/^ /,"",1,gensub($1, "", 1)) }' foo.c    
int blah（无效）
{
        如果（富）{
                printf ("废话\n");
        }
        返回0；
}

```

# c# - 使用 C# 获取 Windows Mobile 手机驱动器的大小（免费、总计）

> ID：409069
> 
> 赞同：0
> 
> 时间：2009-01-03T14:04:17.883
> 
> 标签：c#, windows-mobile, compact-framework

如何使用 C# 获取 Windows Mobile 手机上任何驱动器的大小（免费、总计）？

我需要使用在设备上运行的代码（而不是在连接的 PC 上）来执行此操作。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-03T14:52:36.473

我已经根据对问题的更好理解重写了答案，但对于那些发现这个问题的人来说，我没有丢失任何原始答案。

**从设备上运行的代码中获取大小**

答案很简单：直接 P/Invoke [GetDiskFreeSpaceEx](http://msdn.microsoft.com/en-us/library/aa912270.aspx)（[此处为示例](http://pinvoke.net/default.aspx/coredll/GetDiskFreeSpaceEx.html)）或使用[为您执行此操作](http://opennetcf.com/library/sdf/html/930b0200-63bd-94a1-b0da-6a756c748aa7.htm)的[第三方库](http://smartdeviceframework.com)。

我还将编辑帖子以使我的假设看起来是正确的 - 如果您需要，请将它们更改为以其他方式阅读。

您有一个 P/Invoke 定义。这只是一个静态方法调用。你把它放在一个班级里。像这样的东西：

```
public class MyClass
{
  [DllImport("coredll.dll", SetLastError=true, CharSet=CharSet.Auto)]
  [return: MarshalAs(UnmanagedType.Bool)]
  internal static extern bool GetDiskFreeSpaceEx(string lpDirectoryName,
    out ulong lpFreeBytesAvailable,
    out ulong lpTotalNumberOfBytes,
    out ulong lpTotalNumberOfFreeBytes);
} 
```

然后你调用它（不知道你想用你的所有编组的东西做什么）：

```
ulong GetDiskSize(string volumeName)
{
  ulong avail;
  ulong total;
  ulong totalfree;

  MyClass.GetDiskFreeSpaceEx(volumeName, out avail, out total, out totalFree);

  return total;
  // return others as desired
} 
```

然后使用它是这样的：

```
ulong diskSize = GetDiskSize("\\Storage Card"); 
```

**从 PC 上运行的代码中获取大小**

虽然设备在资源管理器中显示为“驱动器”，但它不是驱动器。外壳扩展用于使其出现在资源管理器中。您不能在框架中或通过 P/Invoke 使用任何驱动器 API 来获取有关设备的信息。

如果您需要获取有关通过 ActiveSync（XP 和更早版本）或 WMDC（Vista）连接的设备的信息，那么您*必须*使用远程 API 或 RAPI。具体的 API 是[CeGetStoreInformation](http://msdn.microsoft.com/en-us/library/aa458340.aspx)，但您必须先进行一些初始化才能调用它。

RAPI 有点过于复杂，无法在此处的答案中涵盖，但它在网上有很好的记录，并且这里有一个[现成的托管包装器（免费和开源）](http://www.opennetcf.com/FreeSoftware/DesktopCommunication/tabid/90/Default.aspx)。您在该库中的特定调用是[RAPI.GetDeviceStoreInformation](http://www.opennetcf.com/library/communication/OpenNETCF.Desktop.Communication.RAPI.GetDeviceStoreInformation.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T14:37:03.010

假设手机的驱动器在 Windows 中安装为常规卷（即，它在 Windows 资源管理器中具有驱动器号），您可以使用[System.IO.DriveInfo](http://msdn.microsoft.com/en-us/library/system.io.driveinfo.aspx)类获取此信息。

当然，下一个问题是确定要使用哪个驱动器号，因为这在手机插入的几乎每台 PC 上都会有所不同。

有几个选择：

*   扫描系统上所有可用的驱动器以查找保证存在于手机上的特殊文件。[Environment.GetLogicalDrives](http://msdn.microsoft.com/en-us/library/system.environment.getlogicaldrives.aspx)将为您提供系统上所有可用驱动器的列表；但是，其中一些可能是可移动的或以其他方式无法访问的，这可能会在您的扫描过程中导致一些不良副作用......
*   更高级的方法是枚举所有可用的 USB 设备，并使用其制造商/设备 ID 找到您的手机。虽然编写的目的略有不同，[但这篇 CodeProject 文章](http://www.codeproject.com/KB/system/usbeject.aspx)应该为您指明正确的方向......

如果您想直接在手机上而不是在它所连接的 PC 上运行代码（您的问题没有详细说明...），[这个 StackOverflow 问题](https://stackoverflow.com/questions/140117/available-space-left-on-drive-winapi-windows-ce)显示了如何在 Compact Framework 上获取可用空间信息.

*编辑*，以回应“当我使用 DriveInfo 并给它驱动器符号时，它给了我本地驱动器的大小”我的 C：驱动器“而不是移动设备上存在 C 驱动器”的详细说明：C：驱动器的手机将在其安装的 PC 上具有不同的驱动器号（例如，F :） - 因此我的回答部分谈到了寻找正确的驱动器号。当然，这确实假设您的手机驱动器在主机 PC 上完全可用：根据手机型号，情况可能会也可能不会。如果没有，在手机上运行一些代码是获取此信息的唯一可行解决方案......

# c# - 访问在 ASP.NET 的 App_Code 中未声明的类

> ID：409070
> 
> 赞同：2
> 
> 时间：2009-01-03T14:04:31.267
> 
> 标签：c#, asp.net

我有时会定义业务逻辑类来“帮助”我的 ASPX 代码隐藏类。将它们都包含在代码隐藏文件中对我来说最有意义，因为它们一起工作。但是，我偶尔想从 App_Code 中定义的更高级别的类访问业务逻辑类，但它们不能在文件之外自动访问。

因此，问题是：访问 App_Code 中定义的类很容易，但我如何访问其他地方定义的类？

更新：另一件事，ASPX 页面类和 App_Code 类在同一个命名空间中 - 这不是问题。

注意：我已经接受了那些做出回应的人的建议（谢谢大家），并且正在重构以使课堂访问更容易。但是，我认为这个问题实际上还没有得到回答（在 ASP.NET 网站项目的情况下）。我不再*需要*答案了，但是，如果有人能澄清是什么让类在 App_Code 之外可见时，它可能会帮助其他人（甚至是我，在路上）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-03T14:18:03.143

确保将类放在合理的命名空间中。

在您想要访问它们的文件后面的代码中放置“使用”关键字。

或者 <%@ import 如果您在内联代码中使用它们。

将包含您的类的 dll 放在 /bin 文件夹中。

TBH 我更喜欢将单独的库项目保留在同一个解决方案中，并在 Web probject 中有项目引用。VS 为您处理构建和放置 dll。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-12-17T04:56:46.773

有时，当您创建或添加任何文件时，它已被创建为内容文件，而它必须是编译文件。

请按照如何解决此问题的过程进行操作。

1) 右键单击​​ App_Code 文件夹中的类文件。2) 点击属性。3) 将 Build Action 从 "" 更改为 Compile 4) 重建您的应用程序。

## 这肯定会奏效

图沙尔·泰吉

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T14:40:34.860

我假设您的意思是您在代码隐藏 .cs 文件中定义了一个单独的类？你给他们什么访问修饰符？

如上所述，我通常在解决方案中有一个单独的项目来解决这类事情（通常在不同的命名空间中，如 MyApp.Web 和 MyApp。），然后从那里引用它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-06-15T14:34:28.950

你也可以在你的项目中创建一个标准文件夹来访问类，并将它们移动到那里，但是你必须做一些额外的事情来让你的项目可以访问它：

*   如果您在阅读其余这些项目符号后遇到“App_Code”文件夹的问题，请确保不要将文件夹命名为任何保留术语（即，将其称为“AppCode”，而不是“App_Code”）。
*   这些类都应该与您的代码隐藏具有相同的命名空间。
*   如果这些类是从其他类调用的，请确保使用公共方法将这些类公开。
*   包括“使用 MyClass；” 代码隐藏/类文件顶部的语句。
*   确保类的 Build Action 属性设置为 Compile。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-12-23T18:37:56.610

由于 .net dsnt 支持多重继承，因此您无法从同一代码隐藏文件中的另一个类访问一个类。但是您可以在主类中创建业务逻辑类作为内部类，并将其所有功能公开，以便可以在主类中调用它们。

# .net - .net mvc 和使用表单编辑数据

> ID：409073
> 
> 赞同：1
> 
> 时间：2009-01-03T14:08:16.907
> 
> 标签：.net, forms, model-view-controller, editing

我有一个编辑演出的表格。

初始控制器操作称为“编辑”。

表单发布到称为“更新”的第二个控制器操作

因此，一旦表单发布，我使用定制的 ModelBinder，它使用 bindingContext.ModelState.AddModelError 将验证消息添加到模型状态

更新 copntroller 操作如下所示：

```
[AcceptVerbs("POST")]
    public ActionResult Update(Guid id, FormCollection formCollection)
    {
        Gig gig = GigManager.GetByID(id);
        try
        {
            UpdateModel<Gig>(gig);
            GigManager.Save(gig);
            return RedirectToAction("List");

        }
        catch (Exception e)
        {
           return View(gig);    
        }

    } 
```

如果模型绑定器有错误，更新模型将引发异常。

这意味着调用了 RedirectToAction("Edit")，从而调用了原始的“Edit”控制器操作。

这意味着我不会看到我的验证消息，并且用户添加到表单中的任何数据都将重置为原始值！

我应该如何处理这个？

我在下面包含了“编辑”操作：

```
[AcceptVerbs("GET")]
    public ActionResult Edit(Guid id)
    {
        Gig gig = GigManager.GetByID(id);

        SelectList days = CreateDays(1, 31, 1,  gig.StartDate.Day);
        ViewData["day"] = days;

        SelectList months = CreateMonths(1, 12, 1, gig.StartDate.Month);
        ViewData["month"] = months;

        SelectList years = CreateYears(DateTime.Now.Year, DateTime.Now.Year + 10, 1, gig.StartDate.Year);
        ViewData["year"] = years;

        string bandNames ="";
        string bandIds = "";
        foreach(Act act in  gig.Acts)
        {
            bandNames += act.Name.Trim() + ", ";
            if (act.Artist != null)
            {
                bandIds += act.Artist.ID + ";";
            }
        }

        ViewData["Bands"] = bandNames;
        ViewData["BandIds"] = bandIds;

        return View(gig);

    } 
```

但是，我没有收到验证消息

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-04T03:04:19.057

也许这会有所帮助。我刚刚提交了一个执行列表/编辑管理员的控制器。它在一个可能很方便的类上使用绑定。查看文件的最后，了解处理 Get 和 Post 动词的可能方法。请注意，UpdateModelStateWithViolations 只是将错误添加到 ModelState 的助手。

```
 Controller.ModelState.AddModelError(violation.PropertyName,
            violation.ErrorMessage); 
```

显示为

```
<%= Html.ValidationSummary() %> 
```

[http://www.codeplex.com/unifico/SourceControl/changeset/view/1629#44699](http://www.codeplex.com/unifico/SourceControl/changeset/view/1629#44699)

和视图： http: [//www.codeplex.com/unifico/SourceControl/changeset/view/1629#54418](http://www.codeplex.com/unifico/SourceControl/changeset/view/1629#54418)

> ```
>  [AcceptVerbs("GET")]
>     [Authorize(Roles = "Admin")]
>     public ActionResult EditRole(Guid? RoleID)
>     {
>         Role role = null;
>         RoleForm form = new RoleForm { };
>         if (RoleID.HasValue)
>         {
>             role = accountService.GetRole(RoleID.Value);
>             if (role == null)
>                 return RedirectToAction("Roles");
> 
>             form = new RoleForm
>             {
>                 RoleID = role.ID,
>                 RoleName = role.Name,
>                 Level = role.Level
>             };
>         }
>         else
>         {
>             form = new RoleForm();
>         }
> 
>         ViewData.Model = form;
> 
>         return this.PluginView();
>     }
> 
>     [AcceptVerbs("POST")]
>     [Authorize(Roles = "Admin")]
>     public ActionResult EditRole(Guid? RoleID, [Bind(Include = "RoleID,RoleName,Level", Prefix = "")] RoleForm form)
>     {
>         Role role = null;
>         if (RoleID.HasValue)
>         {
>             role = accountService.GetRole(RoleID.Value);
>             if (role == null)
>                 return RedirectToAction("Roles");
>         }
> 
>         ServiceResponse<Role> response = accountService.AttemptEdit(form);
> 
>         if (response.Successful)
>         {
>             TempData["Message"] = "Update Successfull";
>         }
>         else
>         {
>             this.UpdateModelStateWithViolations(response.RuleViolations);
>         }
> 
>         //ViewData["AllRoles"] = accountService.GetRolePage(new PageRequest(0, 50, "Name", typeof(string), true)).Page.ToArray();
> 
>         ViewData.Model = form;
> 
>         return this.PluginView();
>     } 
> ```

# c# - C# 循环遍历数组以创建 Active Directory OU

> ID：409076
> 
> 赞同：1
> 
> 时间：2009-01-03T14:12:11.923
> 
> 标签：c#, active-directory

我正在尝试在 Active Directory 中创建嵌套的组织单位，并且我即将完成这项工作。我在下面有一个问题，我需要帮助。我正在检查 OU 是否存在，如果不存在，我需要创建它，strOUArray 包含 OU=Test OU=Test2 和 OU=Test3。我需要代码先创建 OU=Test，然后在下面的 //PROBLEM LINE 上将其用作父 OU，从而允许在 OU=Test 中创建下一个 OU OU=Test2。目前在下面的代码中，所有 OU 都将在根目录中创建，因为我不知道如何在 //PROBLEM LINE 中使用第一个创建的 OU。我试过使用：

```
parent = new DirectoryEntry("LDAP://" + strOUArray[x-1] + "," + dcSubString); //note x-1 
```

这失败了，因为要在其中创建第一个 OU 的父级不存在。任何帮助真的很感激，我有一个紧迫的截止日期，只需要离开这个，所以谢谢你的帮助。

```
String strOUs = container.Substring(0, container.IndexOf(@",DC="));
int dcIndex = container.IndexOf("DC=");
string dcSubString = container.Substring(dcIndex); //dcSubString = DC=Internal,DC=Net
string[] strOUArray = strOUs.Split(new Char[] { ',' });

for (int x = 0; x < strOUArray.Length; x++)
{
if (DirectoryEntry.Exists("LDAP://" + strOUArray[x] + "," + dcSubString))
 {

 }
else
 {
 DirectoryEntry objOU;
 DirectoryEntry parent = new DirectoryEntry("LDAP://" + dcSubString); //PROBLEM LINE

 objOU = parent.Children.Add(strOUArray[x], "OrganizationalUnit");
 objOU.CommitChanges();
 }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T16:11:30.653

似乎您`//PROBLEM LINE`的`strOUArray[x]`字符串连接不包括在内。是发帖的时候打错了吗？

还有这个片段：

```
DirectoryEntry parent = new DirectoryEntry();
parent = new DirectoryEntry("..."); 
```

您正在创建一个`DirectoryEntry`，然后立即在下一行丢弃对它的引用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T22:25:56.853

好吧，我想，我会尝试做这样的事情：

*   首先绑定到顶层（即 LDAP://
*   创建第一个 OU
*   然后递归
    *   绑定到刚刚创建的容器
    *   添加下一个级别
    *   重复直到你完成

像这样的东西（未经测试 - 我这里没有服务器可以检查它）：

```
String strOUs = container.Substring(0, container.IndexOf(@",DC="));
int dcIndex = container.IndexOf("DC=");
string dcSubString = container.Substring(dcIndex); //dcSubString = DC=Internal,DC=Net
string[] strOUArray = strOUs.Split(new Char[] { ',' });

// create a bind path which we'll build up
string ldapPath = dcSubString;

// bind to the top-level container
DirectoryEntry workEntry = new DirectoryEntry("LDAP://" + ldapPath);

// loop through all sub-OU's to create
foreach(string currentOU in strOUArray)
{
  // add the next OU below the current entry
  objOU = workEntry.Children.Add(currentOU, "OrganizationalUnit");
  objOU.CommitChanges(); 

  // bind to the newly created OU
  ldapPath = currentOU + "," + ldapPath;
  workEntry = new DirectoryEntry("LDAP://" + ldapPath);
} 
```

我看到了一个问题：如果您创建一个新的 OU，您可能无法立即绑定到它 - 有时需要一些时间才能传播到目录中。

这有帮助吗？

马克

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-04T22:43:45.910

在过去遇到类似的事情后，我创建了一个函数，该函数将返回目录对象，无论是新创建的还是现有的（对不起，它在 VBScript 中）：

```
Function GetOU(objParentOU, strOUName)
    On error resume next
    Set GetOU = Nothing

    objParentOU.Filter = Array("organizationalUnit")
    Dim OU : Set OU = Nothing
    For Each OU in objParentOU
        if lcase(OU.Name) = lcase("ou=" & strOUName) then
            wscript.echo "Connected to existing OU: " & OU.Name
            set GetOU = GetObject(OU.adsPath)
            exit function
        end if
    Next
    Set OU = Nothing

    ' If script made it to here then the OU must not already exist
    Set GetOU = objParentOU.Create("organizationalUnit", "ou=" & strOUName)
    GetOU.SetInfo

    if err then
        wscript.echo err.description
        err.clear
    else
        wscript.echo "Created new OU: " & strOUName
    end if
end function 
```

使用它，我可以建立我的链，而无需考虑 OU 是否存在。首先设置基本路径，然后在其上添加：

```
Set objDomain = GetObject(LDAP_CONNECTION_STRING)
Set parentOU = GetOU(objDomain, "parentOU")
Set childOU = GetOU(parentOU, "childOU")
Set subchildOU = GetOU(childOU, "subchildOU") 
```

随着代码在 set 命令下运行，OU 要么创建新的，要么绑定到（如果它们已经存在）。

# visual-studio-2008 - 如何在解决方案资源管理器中更改颜色？

> ID：409079
> 
> 赞同：3
> 
> 时间：2009-01-03T14:13:56.583
> 
> 标签：visual-studio-2008, solution-explorer

如何在 Visual Studio (IDE) 的解决方案资源管理器中更改背景文本和其他颜色？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T14:15:59.200

控制面板 - 显示属性 - 外观

解决方案资源管理器不能像文本编辑器那样配置。

# visual-studio - 如果我是一个单独的开发者，我应该使用 VS Team System 吗？

> ID：409101
> 
> 赞同：4
> 
> 时间：2009-01-03T14:33:31.800
> 
> 标签：visual-studio, visual-studio-2008, tfs

我有一个 MSDN 订阅，我想知道要获得哪个版本的 Visual Studio 2008。我记得读过 Team System 有很多额外的功能，比如做高级系统架构的东西，以及与做数据库工作相关的专门的东西。作为一个单独的开发人员，我身兼数职，包括数据库开发人员和架构师——我应该使用 Visual Studio Team Suite 来获得所有这些东西，还是对于一个人来说它们是主要的矫枉过正？

**编辑：** 我有一个“特殊”的 MSDN 许可证（通过 MS BizSpark 初创公司程序），它让我可以使用 3 年的完整版 Team Suite，供我自己和我的初创公司中的任何开发人员使用。之后，如果我想要升级，我必须付费，但如果我不升级（根据 BizSpark 许可），我可以无限期地使用它进行开发。

考虑到这一点，我应该看 Team Suite 还是坚持使用 Pro？我根本不打算使用 Team Foundation Server。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-03T14:44:59.580

好吧，“测试”的东西现在可以在“专业”（但不是分析）中使用，这样就删除了一个主要的比较器。在许多方面，MSDN 订阅是比 VS 产品套件更大的因素，假设您不需要完整的工具。

VS 功能列表[在这里](http://msdn.microsoft.com/en-us/vstudio/products/cc149003.aspx)；MSDN 功能列表在[这里](http://msdn.microsoft.com/en-us/subscriptions/subscriptionschart.aspx)。

我曾经使用过专业版，我从来没有觉得我错过了很多。当然，你总是可以得到 pro plus 之类的东西，比如[dotTrace](http://www.jetbrains.com/profiler/)用于分析，[ReSharper](http://www.jetbrains.com/resharper/)用于代码分析/重构，也许还有[TestDriven.NET](http://testdriven.net/)用于测试——你可能还剩下一些改变。

我现在有一个团队套件许可证（非常好），但如果我必须为此付费，我必须*非常*仔细地考虑；我*可能会*得到开发者版+ MSDN。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T15:10:40.103

我会说 VS Team System 对于单个开发人员血汗工厂来说是一种过度杀伤力，但您的情况可能证明并非如此。当您在一个所有东西都是 Microsoft 的项目上工作时，Team System 非常棒，但是当您开始使用 Oracle 和 MySQL 数据库时，所有额外的功能（数据库、架构师等）都将变得无用。不要对工具施加太大压力，如果您想省钱，VS Pro 就足够了。我宁愿花更多的钱在第三方组件和重构工具等额外的工具上，而不是闪亮的 VS Team System。

但是，既然你加入了 BizzSpark 计划，我认为这对初创公司来说真的很棒，我认为你应该去尝试 VSTS。您基本上无需为额外功能支付任何费用。当您需要为许可证支付全部费用时，我认为您将在 VSTS 上积累足够的经验来决定要么坚持使用它，要么回滚到专业版。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T14:41:09.757

在你的玩具箱里放尽可能多的玩具永远不会有坏处。当然，您可能只能在蓝月亮中与其中一些人一起玩一次，但关键是您可以随时与他们一起玩。

我在 Mac 上运行，所以我必须从 VM 上运行我所有的东西，我开始认为我所需要的只是安装 VS，然后我可以使用底层操作系统来处理我的所有其他功能（Dreamweaver、Photoshop , Office, Web Browsing) 或者换句话说我一般的日常计算生活。多亏了 VMWare，VM 和主机操作系统之间的转换很容易，但是您在电子邮件中获得了您想要在您的 VM 中使用的附件，或者您在主机操作系统上处理编程文档......这个列表还在继续在。

我的观点是……你永远不会后悔在你的开发系统中投入更多的东西，你会后悔没有你想要拥有但认为你不需要的那个工具。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-07T07:31:23.803

首先，您绝对应该使用版本控制产品。能够及时返回并回忆以前的构建将为您节省大量时间和精力。没有什么比让它工作一天更糟糕的了，然后意识到你所做的改变但不记得破坏了一切。

其次，如果只有你（甚至是其他几个人），你可能应该使用颠覆。易于设置、管理和交互是这里游戏的名称。更不用说免费、完全支持、可靠且易于学习。

我最近开始使用 VisualSVN Server 和 VisualSVN Client for Visual Studio。服务器是免费的，客户端是 45 美元的许可证，您可以在每台开发机器上使用。添加 TortuousSVN，您可以使用 Windows shell 的版本控制。

我尝试了 Microsoft 的 TFS 和 VSS 产品，发现颠覆性更容易处理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-03T14:37:33.417

我相信 Team Developer Edition 现在将包括 Database 版本。这可能就是您所需要的。从记忆中，完整的团队套件版本（开发人员、数据库、架构师和测试一起）是相当昂贵的购买。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-03T14:40:33.020

我喜欢团队系统的一项功能是能够分析应用程序的性能。如果您必须为此付费，这本身可能不值得升级，但在某些情况下它非常方便。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-03T14:47:00.883

我同意 theBadDawg 的观点。

当单元测试功能仅在最昂贵的 Visual Studio 版本中可用时，我认为这是一种讽刺。单元测试是*每个人都*应该使用的东西，因为它通过向我们灌输良好的习惯并帮助我们编写更好的软件而使我们所有人受益。特别是如果我们是游戏新手。

幸运的是，它现在是专业版。

如果您可以获得 Team Suite 并享受它的工具来提高生产力并从中生产出质量更好的软件，那就***去做吧***。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-03T15:15:10.313

我同意@Marc Gravell。您可能可以通过附加组件估算 Team System 的价值，但您还需要考虑维护附加组件的*成本*。维护几个第三方工具以获取您可以在集成包中获得的功能会带来一些痛苦。根据谁在花钱（您或雇主），您为获得所有功能而愿意承受的痛苦可能会有所不同。

尽管我在 TestDriven.Net 中添加了测试运行器，但我对 Team System 非常满意。当 TS 在单元测试、覆盖分析和源代码控制中出现时，我们切换到这个。我对这个选择非常满意，但如果我必须亲自支付，我可能会选择 nUnit、nCover、SVN 等并保留剩余的钱。我确实觉得这让我更有效率，但我不会有那么多钱可以花。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-03T20:58:38.093

如果您认真对待您的代码进行单元测试（您应该如此），那么我肯定会推荐使用开发版，因为它提供了代码覆盖率，而专业版则没有。

当然，您可以从免费/便宜的第 3 方工具中获得专业版和开发版之间的大部分功能差异，但 IMO 这些工具的价格通常高于其标签上的价格。由于您可能会使用更好的 Team Suite 3 年，因此我什至不会费心查看第 3 方工具。

# gcc - gcc -Wall 但抑制 -Wunknown-pragmas

> ID：409123
> 
> 赞同：4
> 
> 时间：2009-01-03T14:42:20.130
> 
> 标签：gcc

`-Wall`启用我不想要的警告，特别是`-Wunknown-pragmas`. 如何告诉 GCC 在启用后抑制这些警告`-Wall`？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-03T14:47:38.543

> gcc -Wall -Wno-unknown-pragmas

应该管用。

# c# - Google Sketchup API - 到 Windows 应用程序？

> ID：409129
> 
> 赞同：0
> 
> 时间：2009-01-03T14:46:06.377
> 
> 标签：c#, ruby, api, 3d, sketchup

如何通过 API 从**Windows 应用程序**与**[Google Sketchup进行交互？](http://sketchup.google.com/)**

 **我正在查看用 C#/VB.NET 编写的东西，但似乎唯一可用的[**Google Sketchup API**是用于 Ruby 的](http://sketchupapi.blogspot.com/)。

关于如何**从 .NET 使用该 Ruby API 的任何想法？**Ruby 只是服务器端还是可以在本地离线处理？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-07-05T23:59:08.670

除了 Ruby 脚本系统之外，还有一个 C++ API。在这里找到它：

[http://code.google.com/apis/sketchup/docs/downloadsdksubmit.html](http://code.google.com/apis/sketchup/docs/downloadsdksubmit.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T23:40:28.280

我认为 Ruby API 仅用于脚本插件，而不是用于独立应用程序的接口。也许您可以添加一个与您的应用程序交互的 Google Sketchup ruby​​ 插件？

# asp.net - 如何在asp.net中设置定时器

> ID：409151
> 
> 赞同：1
> 
> 时间：2009-01-03T14:58:46.523
> 
> 标签：asp.net, timer

我有一个页面，当某些操作出错时，我想启动计时器，等待 30 秒，停止计时器并重试操作。每次计时器启动时，我都需要通过更改某些标签的文本来通知用户。

我该怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-03T15:46:12.247

如果我理解正确，我认为您应该改用客户端（javascript）计时器。您不能为此使用服务器端计时器。

当您检测到错误条件时，您会相应地更新标签并将其显示给用户。同时，您调用一个客户端计时器，该计时器将在 30 秒后回发。

例如，将以下计时器代码放到您的页面上：

```
 <script>
    function StartTimer()
    {
      setTimeout('DoPostBack()', 30000); // call DoPostBack in 30 seconds
    }
    function DoPostBack()
    {
      __doPostBack(); // invoke the postback
    }
  </script> 
```

如果出现错误情况，您必须确保将启动客户端计时器：

```
if (error.Code == tooManyClientsErrorCode)
{
  // add some javascript that will call StartTimer() on the client
  ClientScript.RegisterClientScriptBlock(this.GetType(), "timer", "StartTimer();", true);
  //...
} 
```

我希望这会有所帮助（代码未经测试，因为我现在没有可用的 Visual Studio）。

**更新：**

要“模拟”按钮单击，您必须将按钮的客户端 ID 传递给 __doPostBack() 方法，例如：

```
function DoPostBack()
{
  var buttonClientId = '<%= myButton.ClientID %>';
  __doPostBack(buttonClientId, ''); // simulate a button click
} 
```

有关其他一些可能性，请参阅以下问题/答案：

*   [ClientScriptManager.GetPostBackEventReference 方法](https://stackoverflow.com/questions/267011/clientscriptmanager-getpostbackeventreference-method)
*   [从 JavaScript 调用 ASP.NET 函数？](https://stackoverflow.com/questions/3713/call-asp-net-function-from-javascript#8096)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T15:07:15.150

从客户端强制回发您可以直接调用 __doPostBack 方法

它需要两个参数，EVENTTARGET 和 EVENTARGUMENT；由于您是在正常的 asp.net 周期之外进行此调用，因此您需要在页面加载事件（或 init，您的选择）上检查 IsPostBack - 如果它是回发，那么您将需要查看这两个参数作为表单元素 (Request.Form["__EVENTTARGET"])。检查它们的值以查看回发是来自您的呼叫还是其他控件之一，如果这些值与您从客户端传入的值匹配，则对标签测试进行更改

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-12-20T15:35:26.100

有两种方法可以做到这一点，第一种方法，如果您需要在同一线程上调用其他函数会更好一些。将 ScriptManager 和 Timer 添加到 aspx 页面，您可以从工具箱中删除或直接输入代码。ScriptManager 必须在 asp:Timer 之前声明。OnTick 在每个间隔后触发。

```
 <asp:ScriptManager ID="ScriptManager1" runat="server">
    </asp:ScriptManager>
    <asp:Timer ID="Timer1" runat="server" Interval="4000" OnTick="Timer1_Tick">
    </asp:Timer> 
```

在后面的代码中（在本例中为 c#）：

```
 protected void Timer1_Tick(object sender, EventArgs e)
    {
        System.Diagnostics.Debug.WriteLine("tick tock");
    } 
```

如果您需要在同一线程上触发函数，则第二种方法效果不佳。您可以使用 C# 在 ASP.net 中创建一个计时器，以下代码每 2 秒触发一次该函数。在 (.cs) 文件后面的代码中：

```
 // timer variable
    private static System.Timers.Timer aTimer;

    protected void Page_Load(object sender, EventArgs e)
    {
        // Create a timer and set a two second interval.
        aTimer = new System.Timers.Timer();
        aTimer.Interval = 2000;

        // Hook up the Elapsed event for the timer. 
        aTimer.Elapsed += OnTimedEvent;

        // Have the timer fire repeated events (true is the default)
        aTimer.AutoReset = true;

        // Start the timer
        aTimer.Enabled = true;
    } 
```

然后以这种格式制作您要调用的函数：

```
//Doesn't need to be static if calling other non static functions

    private static void OnTimedEvent(Object source, System.Timers.ElapsedEventArgs e)
    {
        System.Diagnostics.Debug.WriteLine("The Elapsed event was raised at {0}", e.SignalTime);
    } 
```

样本输出：

[![输出](https://i.stack.imgur.com/oVaET.png)](https://i.stack.imgur.com/oVaET.png)

# c# - 在 C# 中，您可以让 Windows 窗体应用程序作为服务启动吗？

> ID：409152
> 
> 赞同：4
> 
> 时间：2009-01-03T14:59:12.733
> 
> 标签：c#

我有一个 GUI C# Windows 窗体程序，我想在计算机启动时将其作为服务启动，并且系统托盘中可能有一个图标，单击该图标会使程序最大化。这是否可能在没有重大返工的情况下实现？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-03T15:12:40.863

Windows 服务不能有 GUI，至少不能直接。您必须将应用程序分离为表示层/流程和服务层/流程：

*   表示层将保持为 WinForms 应用程序
*   服务层将作为 Windows 服务运行

他们两个必须通过一些进程间通信的方式相互通信，比如命名管道或套接字。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T15:31:10.953

您可以使用第三方应用程序，例如 FireDaemon ( [http://www.firedaemon.com/](http://www.firedaemon.com/) )，将任何程序作为服务启动。FireDaemon 中有许多可用的选项，例如表单可见性、失败时重新启动等。但是，它不会自动为您的应用程序创建托盘图标。因此，您的应用程序必须更改为拥有自己的托盘图标功能，FireDaemon 将启动程序并管理进程。

FireDaemon 的成本约为 40 美元（美元）。我想还有许多其他类似的应用程序可用。

我会首先考虑创建一个其他回答者提到的实际服务项目，但请记住这种方法。在少数情况下，它对我来说措辞很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T15:14:54.917

这取决于当前代码的编写方式。我有几个兼作服务的 WinForm 应用程序，但我将大部分工作分成了另一个程序集。我对这些应用程序的解决方案通常有 3 个项目：WinApp、Service 和 Library（我在这里过于简单化了）。

如果您认为您的 WinForm 应用程序可以提供良好的服务，那么您的代码可能处于这样一种状态，您可能很容易将其分离出来。添加服务项目非常简单，为其添加安装程序更具挑战性，但仍然有据可查。最棘手的部分是为它制作一个部署包，以正确安装服务，但同样......只要你知道你需要寻找它，它就会有据可查。

编辑：澄清一下，总的来说，我不会认为这是一个重大项目。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T15:15:27.240

你可以编写代码让它作为服务运行，但我认为更重要的问题是，它提供了什么？有一些方法可以将应用程序最小化到托盘，您可以在启动时启动所述应用程序到系统托盘。

这是我经常提到的关于做 Windows 服务的链接。它是基于 WCF 的，但我认为稍作修改就可以让它为你工作：

[http://support.microsoft.com/kb/317421](http://support.microsoft.com/kb/317421)

至于最小化到托盘，这个问题有一个很好的答案：

[最小化托盘 C# WinForms 应用程序的正确方法是什么？](https://stackoverflow.com/questions/46918/whats-the-proper-way-to-minimize-to-tray-a-c-winforms-app)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2019-09-06T06:01:00.313

您可以在 Windows 中使用任务管理器并设置一个任务，该任务将在每次 Windows 启动时执行您的应用程序的 .exe。

# php - 抓取正文内容时使用的最佳功能

> ID：409153
> 
> 赞同：0
> 
> 时间：2009-01-03T14:59:14.183
> 
> 标签：php

获取文件内容时，在 php 中使用的最佳功能是什么？目前我正在使用 fopen 但是当我尝试获取标题时，它使用大约 2-3 秒来获取标题。HTTPRequest 会是更好的选择吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-03T15:12:29.633

使用[cURL](http://www.php.net/curl)函数可以让您控制超时等，而且它们使用起来非常简单。

您可以使用[`curl_setopt($myCurlResource, CURLOPT_HEADER, true)`](http://www.php.net/curl_setopt)在返回值中包含标题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T22:22:08.220

我相信最好的开销到速度的回报是`file_get_contents()`函数，它接受一个字符串作为 URL 或本地路径：

```
<?php
$body=file_get_contents('http://google.com');
?> 
```

cURL 也很好，有更多选项可以发送诸如 POST 变量和 cookie 之类的内容，但是 PHP 默认不启用它，因此您可能无法在某些共享主机环境中使用它。

# project-planning - 编写功能规范有多重要？

> ID：409156
> 
> 赞同：7
> 
> 时间：2009-01-03T15:02:05.753
> 
> 标签：project-planning, specifications

我从来没有写过功能规范，我更喜欢跳进代码和设计东西。到目前为止，它工作得很好，但是对于最近的一个个人项目，我正在写一些描述产品所有功能的规范，以及它应该如何“工作”，而不涉及如何实现的细节，我发现它非常有价值。

你有什么想法，你是写规范还是只是开始编码和计划，哪种做法更好？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-03T15:35:39.633

如果您从家开车到最近的杂货店，您可能不需要地图。但...

如果您要开车去另一个州从未去过的地方，那么您可能会这样做。

如果您为了驾驶乐趣而随意开车，您可能不需要地图。但...

如果你想以最有效的方式到达某个地方（最小化距离、最小化时间、沿途做三个特定的停靠点等），你可能会这样做。

如果您是自己开车，可以随心所欲地走，看到有趣的东西随时停下来或重新考虑您的目的地或路线，您可能不需要地图。但...

如果您作为车队的一部分开车，并且所有人都需要一起提供食物和过夜住宿，并且需要一起到达，那么您可能会这样做。

如果您认为我不是在谈论编程，您可能不需要功能规范、故事卡、叙述、CRC 等。但是......

如果您认为我是，您可能需要至少考虑以上其中一项。

;-)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-03T15:11:55.810

对于“跳入代码”和“随手设计”的人，我会说编写任何包括功能规范在内的东西都比您当前的方法要好。如果您在开始之前花时间仔细考虑并设计它，则可以节省大量时间和精力。

*   需求有助于定义您需要做什么。
*   设计有助于定义您计划制作的内容。
*   用户文档定义了你做了什么。

你会发现大多数地方都会有这三个文件的一些变化。功能规范可以集中到设计文档中。

如果您不相信，我建议您阅读[快速开发。](https://rads.stackoverflow.com/amzn/click/com/1556159005)如果您花更多时间进行计划和设计，您确实可以更快地完成工作。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-03T15:16:21.840

为大型软件项目“直接编写代码”几乎肯定会导致失败（就像立即开始摆砖架桥那样）。

[37 Signals](http://getreal.37signals.com/)的人会说，在纸上写一个简短的文档比写一个复杂的规范要好。我想说这对于快速模拟新网站可能是正确的（设计和想法可能比僵化的模式更好），但在其他现实生活中并不总是可以接受的。

想想您的客户签署的规范文件可能具有的（法律，甚至）重要性。

士气可能是：**灵活**，并根据您的项目方案**尽可能多地**计划功能或技术规格。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-03T15:12:51.970

对于一次性黑客和小型实用程序，请不要打扰。

但是，如果您正在编写一个严肃的大型应用程序，并且有要求苛刻的客户并且必须运行很长时间，那么这是必须的。阅读 Joel 关于该主题的精彩[文章](http://www.joelonsoftware.com/articles/fog0000000036.html)- 它们是一个好的开始。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-03T15:07:41.263

我是双向的，但我从测试驱动开发中学到了一些东西......

如果您使用路线图进行编码，那么您将比如果您只是开始走在路上而不知道它将如何在中间分叉，那么您将快得多。

您不必写下每个功能将要做什么的每一个细节，而是定义您的基础知识，这样您就知道应该做什么才能使所有功能协同工作。

话虽如此，我昨天需要编写一系列异常处理程序，而我只是一头扎进去，根本没有尝试构建它。也许我应该重读我自己的建议；）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-03T15:21:25.260

许多人不想承认或意识到的是，软件开发是一门工程学科。关于他们如何处理事情，可以学到很多东西。在小型项目中，规划您将在应用程序中执行的操作并不一定至关重要，因为通常更容易快速返回并修复您的错误。与写下系统首先要做什么相比，您看不到浪费了多少时间。

实际上，在大型项目中，几乎有必要制定系统工作原理和功能的路线图。如果您愿意，可以将其称为功能规范，但通常您必须有一些东西可以向您展示为什么步骤 b 遵循步骤 a。我们都认为我们可以在飞行中想出来（我也肯定对此感到内疚），但实际上它给我们带来了问题。回想一下，问自己有多少次遇到某事并对自己说：“伙计，我希望我早点想到这一点？” 或者其他人看到你做了什么，并向你展示了你可以采取 3 个步骤来完成一项需要 10 个步骤的任务。

把它写在纸上真的会迫使你思考你要做什么。一旦它写在纸上，它就不再是一个模糊的想法，然后你可以查看它并评估你的想法是否真的有意义。更改一页文档比更改 5000 行代码更容易。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-03T15:26:43.393

如果您在 XP（或类似）环境中工作，您将使用*故事*来指导开发以及大量的单元和走廊可用性测试（我猜我喝过[Kool-Aid](https://rads.stackoverflow.com/amzn/click/com/0321303636)）。

但是，有一个领域绝对需要规范：与外部团队协调时。我与一家大型保险公司有一个项目，我们需要就某些程序行为、数据库设计的某些方面和一些文件布局达成协议。如果没有规范，我对我们所承诺的内容进行创造性的解释是开放的*。*这些人都是好人——我信任他们并且喜欢和他们一起工作。但是，如果没有那个规范，那将是一场死亡行军。有了这个规范，我总能指出他们在哪里偏离了商定的布局，或者他们在哪里要求额外的定制工作（$$！）。如果使用半对立的关系，规范可以使您免于更糟糕的情况：诉讼。

哦，是的，我同意 Kieveli 的观点：“直接跳代码”几乎从来都不是一个好主意。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-03T15:17:52.600

我会说这完全“取决于”问题的类型。我倾向于问自己我是为了它还是为了你上面的层次而写它。我也对此进行了辩论，我的个人经验表明，你应该这样做，因为它使项目保持在预期的轨道上（而不是偏离轨道）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-03T16:46:17.213

出于多种原因，我喜欢先在纸上松散地分解任何不重要的问题，而不是跳入代码；

*   我写在纸上的东西不必编译或对计算机有任何意义
*   我可以在纸上以任意抽象层次工作
*   我可以很容易地添加图片和图表
*   我可以很快地思考和调试一个概念

如果我正在处理的问题可能涉及大量时间或许多其他人，我会将其写成大纲功能规范。如果我由其他人支付开发软件的费用，并且可能存在歧义，我将添加足够的额外细节以消除这种歧义。一旦编写了软件，我还喜欢使用此文档作为开发自动化测试用例的起点。

换句话说，我编写了足够多的功能规范以正确理解我自己编写的软件，并为其他相关人员解决任何可能的歧义。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-01-03T15:42:59.087

我很少觉得需要功能规范。OTOH我总是让用户负责这个功能，一个电话就可以了，所以我可以随时向他们询问功能要求。

对我来说，功能规范更像是一种政治工具，而不是技术工具。我想一旦你有了一个规范，如果你以后发现实现的问题，你总是可以责怪规范。但是怪谁对我来说真的不感兴趣，即使找到替罪羊，问题仍然存在，不如重新审视实施并尝试将其做好。

编写一个好的规范几乎是不可能的，因为你真的对问题或工具或环境中的未来变化了解得不够多，无法正确地做到这一点。

因此，我认为采用敏捷方法进行开发并投入足够的资源和时间来随时重新审视和重构更为重要。

* * *

## 回答 #11

> 赞同：-5
> 
> 时间：2009-01-03T15:06:43.980

重要的是不要写它们：[功能规范没有任何功能](http://gettingreal.37signals.com/ch11_Theres_Nothing_Functional_about_a_Functional_Spec.php)

# .net - String.IndexOf(char) 真的比手动搜索慢吗？

> ID：409162
> 
> 赞同：4
> 
> 时间：2009-01-03T15:05:44.233
> 
> 标签：.net, performance, string

在进行简单的性能测量时，我惊讶地发现调用`String.IndexOf(char)`实际上比手动进行要慢！这是真的吗？！这是我的测试代码：

```
const string str = @"91023m lkajsdfl;jkasdf;piou-09324\\adf \asdf\45\ 65u\ 86\ 8\\\;";
static int testIndexOf() { return str.IndexOf('\\'); }
static int testManualIndexOf() {
    string s = str;
    for (int i = 0; i < s.Length; ++i)
        if (s[i] == '\\') return i;
    return -1;
} 
```

我对每种方法运行了 2500 万次，并使用`Stopwatch`. 手动版本始终比其他版本快 25%。

有什么想法吗？！

* * *

**编辑 2：**在具有 .NET 4.0 的不同机器上运行测试产生的结果与 Marc Gravell 的答案非常相似。比手动搜索*更快。***`String.IndexOf(char)`**

 ** * *

**编辑：**今天（2009 年 1 月 4 日）我想以更全面的方式检查这个问题，所以我创建了一个新项目，并编写了您将在下面找到的代码。从 cmd 运行发布模式进行 1 亿次迭代时，我得到以下结果：

```
 -   String.      IndexOf : 00:00:07.6490042
  - MyString.PublicIndexOf : 00:00:05.6676471
  - MyString.InternIndexOf : 00:00:06.1191796
  - MyString.PublicIndexOf2: 00:00:09.1363687
  - MyString.InternIndexOf2: 00:00:09.1182569 
```

我至少运行了 20 次这些测试，每次都得到几乎相同的结果。我的机器是 XP SP3、VS 2008 SP1、P4 3.0 GHz，没有超线程和 1 GB RAM。我发现结果真的很奇怪。如您所见，`String.IndexOf`它比我的`PublicIndexOf`. 更奇怪的是，我写了与 相同的方法`internal`，但它比那个慢了大约 8% `public`！我不明白发生了什么，希望你能帮助我理解！

测试代码如下。（很抱歉重复的代码，但我发现使用委托会显示不同的时间，而`public`和`internal`方法需要相同的时间。）

```
public static class MyString {
    public static int PublicIndexOf(string str, char value) {
        for (int i = 0; i < str.Length; ++i)
            if (str[i] == value) return i;
        return -1;
    }

    internal static int InternIndexOf(string str, char value) {
        for (int i = 0; i < str.Length; ++i)
            if (str[i] == value) return i;
        return -1;
    }

    public static int PublicIndexOf2(string str, char value, int startIndex) {
        if (startIndex < 0 || startIndex >= str.Length)
            throw new ArgumentOutOfRangeException("startIndex");
        for (; startIndex < str.Length; ++startIndex)
            if (str[startIndex] == value) return startIndex;
        return -1;
    }

    internal static int InternIndexOf2(string str, char value, int startIndex) {
        if (startIndex < 0 || startIndex >= str.Length)
            throw new ArgumentOutOfRangeException("startIndex");
        for (; startIndex < str.Length; ++startIndex)
            if (str[startIndex] == value) return startIndex;
        return -1;
    }
}

class Program {
    static void Main(string[] args) {
        int iterations = 100 * 1000 * 1000; // 100 millions
        char separator = '\\';
        string str = @"91023m lkajsdfl;jkasdf;piou-09324\\adf \asdf\45\ 65u\ 86\ 8\\\;";
        Stopwatch watch = new Stopwatch();

        // test String.IndexOf
        int sum = 0;
        watch.Start();
        for (int i = 0; i < iterations; ++i)
            sum += str.IndexOf(separator);
        watch.Stop();
        Console.WriteLine("  String.      IndexOf : ({0}, {1})", watch.Elapsed, sum);

        // test MyString.PublicIndexOf
        sum = 0;
        watch.Reset(); watch.Start();
        for (int i = 0; i < iterations; ++i)
            sum += MyString.PublicIndexOf(str, separator);
        watch.Stop();
        Console.WriteLine("MyString.PublicIndexOf : ({0}, {1})", watch.Elapsed, sum);

        // test MyString.InternIndexOf
        sum = 0;
        watch.Reset(); watch.Start();
        for (int i = 0; i < iterations; ++i)
            sum += MyString.InternIndexOf(str, separator);
        watch.Stop();
        Console.WriteLine("MyString.InternIndexOf : ({0}, {1})", watch.Elapsed, sum);

        // test MyString.PublicIndexOf2
        sum = 0;
        watch.Reset(); watch.Start();
        for (int i = 0; i < iterations; ++i)
            sum += MyString.PublicIndexOf2(str, separator,0);
        watch.Stop();
        Console.WriteLine("MyString.PublicIndexOf2: ({0}, {1})", watch.Elapsed, sum);

        // test MyString.InternIndexOf2
        sum = 0;
        watch.Reset(); watch.Start();
        for (int i = 0; i < iterations; ++i)
            sum += MyString.InternIndexOf2(str, separator,0);
        watch.Stop();
        Console.WriteLine("MyString.InternIndexOf2: ({0}, {1})", watch.Elapsed, sum);
    }
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-03T15:15:58.987

即使“手动”执行它会更快，但这样做也不明智。今天可能更快，在您的 .net 版本中，您的 CLR 设置。也许。至少对于那个特定的字符串。但是你可以很确定，随着时间的推移，内置函数会有更好的改进机会。用你的语言去。IndexOf 也更加清晰。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-03T15:19:45.670

也许这 25% 是**调用**函数的成本。

您的方法 (testManualIndexOf) 不调用任何函数。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-03T15:26:41.413

您的测试并不公平，因为您没有实现相同的功能：

1.  `IndexOf`您没有将任何参数传递给手动测试，而是使用 const 引用，与在实际方法中传递参数时相比，它需要执行的操作码更少。
2.  您的`IndexOf`测试实际上进行了两次方法调用，而不是一次。外部方法调用很可能会在不在调试器下运行的 Release 构建中内联，但您的测试并未指示它运行的条件（如果是这种情况，那么您可以忽略这一点）。

但本质上，鉴于您的方法做得更少，我并不感到惊讶它运行得更快。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-03T15:42:31.880

（更新）

使用您新发布的钻机，我得到以下数字，这符合我的预期：

```
String.      IndexOf : (00:00:06.3134669, -994967296)
MyString.PublicIndexOf : (00:00:07.0769368, -994967296)
MyString.InternIndexOf : (00:00:08.3463652, -994967296)
MyString.PublicIndexOf2: (00:00:12.0049268, -994967296)
MyString.InternIndexOf2: (00:00:12.4344756, -994967296) 
```

* * *

（原来的）

我无法在控制台发布时重现您的数字。我进行了 25M 次迭代，结果如下：

*   1556ms, (825000000) (testIndexOf)
*   1798ms, (825000000) (testManualIndexOf)

所以`IndexOf`更快。我怀疑您的测试装备没有在命令行以发布模式运行（您无法在附加调试器的情况下运行性能测试；即使是 IDE 也会增加太多开销）。

这是我的装备：

```
static void Main()
{
    const int LOOP = 25000000;
    int chk1 = 0, chk2 = 0;
    Stopwatch watch1 = Stopwatch.StartNew();
    for (int i = 0; i < LOOP; i++)
    {
        chk1 += testIndexOf();
    }
    watch1.Stop();
    Stopwatch watch2 = Stopwatch.StartNew();
    for (int i = 0; i < LOOP; i++)
    {
        chk2 += testManualIndexOf();
    }
    watch2.Stop();

    Console.WriteLine("{0}ms, ({1})", watch1.ElapsedMilliseconds, chk1);
    Console.WriteLine("{0}ms, ({1})", watch2.ElapsedMilliseconds, chk2);

} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-03T15:41:44.830

您的测试或您的环境肯定有问题。

我只是运行这段代码：

```
 static void Main(string[] args)
    {
        {
            Stopwatch sw = new Stopwatch();
            sw.Start();
            for (int i = 0; i < 25000000; i++)
                testIndexOf();
            sw.Stop();
            Console.WriteLine(sw.Elapsed); //2.27 s
        }
        {
            Stopwatch sw = new Stopwatch();
            sw.Start();
            for (int i = 0; i < 25000000; i++)
                testManualIndexOf();
            sw.Stop();
            Console.WriteLine(sw.Elapsed); //9.81 s
        }

        Console.ReadLine();
    } 
```

在两台不同的机器上，一台 Vista，一台 Linux/mono，发现内部 IndexOf 快 4 倍。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-03T15:14:33.573

是不是可以下载.net框架的代码看看str.IndexOf到底做了什么？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-03T15:15:12.623

这个特定搜索的时间真的很关键，还是你在做致命的“无故优化”？你试过用更短和更长的字符串吗？使用不同的搜索字符串？内置函数*可能*会针对搜索可能较慢并且您的特定情况最终变慢的其他情况进行优化。在我对更多案例进行更多测试之前，我不会谴责 IndexOf API“总是较慢”。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-03T15:20:08.557

好吧，在第一个实例中，您有额外的函数调用开销。您是否尝试将手动搜索包装在一个方法中并从您的测试中调用它 - 这确实是最好的比较，因为您不太可能每次想要在字符串中搜索一个字符时都想要编写该循环。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-03T15:28:38.057

正如已经说过的，我认为函数调用可能会造成一些差异。参数传递和检查需要时间。

我试图用 Reflector 查看 IndexOf 的代码，但是......运气不好，这是一个内部 CLR 调用。我认为仅凭这一点就足以取代手动方法，因为它可能会随着 CLR 的改进而改进。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-03T16:14:00.070

我把你的代码变成了一个实际的方法，并添加了一个测试来检查空值。然后我编写了一个循环来生成一千万个随机长度的随机字符串（`1 <= length <= 250`），并使用实例方法`String.IndexOf`和自定义方法比较时间`testManualIndexOf`。`String.IndexOf`耗时 5159 毫秒，`testManualIndexOf`耗时 4838 毫秒，相差 6.2%。以下是不太漂亮的代码：

```
public static void Main(string[] args) {
    int nTrials = 10000000;
    Random rg = new Random(1);
    Stopwatch sw = new Stopwatch();
    for (int i = 0; i < nTrials; i++) {
        int len = 1 + rg.Next(250);
        char[] randomChar = new char[len];
        for(int j = 0; j < len; j++) {
            randomChar[j] = GetRandomLetterOrDigit(rg);
        }
        string s = new string(randomChar);
        char findChar = GetRandomLetterOrDigit(rg);
        sw.Start();
        int index = s.IndexOf(findChar);
        //int index = testManualIndexOf(s, findChar);
        sw.Stop();
    }
    Console.WriteLine(sw.ElapsedMilliseconds);
}

private static char GetRandomLetterOrDigit(Random rg) {
    char c;
    int rc = rg.Next(62);

    if (rc < 26) {
        c = (char)('A' + rc);
    }
    else if (rc < 52) {
        c = (char)('a' + rc - 26);
    }
    else {
        c = (char)('0' + rc - 52);
    }
    return c;
}

private static int testManualIndexOf(string s, char c) {
    if (s == null) {
        throw new ArgumentNullException("s");
    }
    for (int i = 0; i < s.Length; ++i) {
        if (s[i] == c) return i;
    }
    return -1;
} 
```

# java - OpenOffice.org 使用 Java 导入 csv

> ID：409173
> 
> 赞同：1
> 
> 时间：2009-01-03T15:10:29.043
> 
> 标签：java, csv, import, openoffice.org

如何使用 OpenOffice.org API 导入 CSV 文件？我想使用与使用“CVS 文本”过滤器打开同一文件时提供的相同功能来执行此操作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T15:44:25.700

这是使用 OO.org 宏语言的解决方案，但它应该是一个很好的起点：[http ://user.services.openoffice.org/en/forum/viewtopic.php?f=45&t=12835](http://user.services.openoffice.org/en/forum/viewtopic.php?f=45&t=12835)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T14:24:17.377

这是真正有效的解决方案：

```
XComponentContext xLocalContext = Bootstrap.bootstrap();
XMultiComponentFactory xLocalServiceManager = xLocalContext.getServiceManager();
Object desktop = xLocalServiceManager.createInstanceWithContext("com.sun.star.frame.Desktop", xLocalContext);
XComponentLoader xComponentLoader = (XComponentLoader) UnoRuntime.queryInterface(XComponentLoader.class, desktop);
PropertyValue[] mypv = new PropertyValue[3];
mypv[0] = new PropertyValue();
mypv[0].Name = new String("FilterName");
mypv[0].Value = new String("Text - txt - csv (StarCalc)");
mypv[1] = new PropertyValue();
mypv[1].Name = "Hidden";
mypv[1].Value = new Boolean(false);
mypv[1] = new PropertyValue();
mypv[1].Name = "CharacterSet";
mypv[1].Value = "UTF-8";
mypv[2] = new PropertyValue();
mypv[2].Name = "FilterOptions";
mypv[2].Value = "59,34,0,1,1/1/2/1/3/5";
String internalFile = ExternalUriReferenceTranslator.create(xLocalContext).translateToInternal("file://" + csvFile.getAbsolutePath());
XComponent comp = xComponentLoader.loadComponentFromURL(internalFile, "_parent", 0, mypv); 
```

# c++ - 删除还是不删除（调用函数）？

> ID：409198
> 
> 赞同：1
> 
> 时间：2009-01-03T15:19:25.297
> 
> 标签：c++

我记得有人说如果你通过一个库创建一个类，你应该通过库来销毁它。那么，这是否意味着我不应该调用删除？我应该打电话`myclass.deleteMe()`吗？重载删除会解决问题吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-03T15:32:35.067

> 我记得有人说如果你通过 lib 创建一个类，你应该通过 lib 销毁它。

这意味着如果您在库中调用一个函数来为您创建一个对象，您应该阅读该函数的文档，其中必须说明您如何再次释放该对象。通常，免费功能的名称类似于分配功能。例如，该库`pcre`有两个称为`pcre_malloc`和的函数`pcre_free`。

原因是，因为库以对您不透明的方式分配（这就是您首先使用该函数的原因）。它可以从程序的数据部分获取内存，而您会（错误地）假设它在使用`delete`.

如果**你**是那个图书馆作者，同样的规则也适用。确保当您的函数之一返回动态分配的对象时，您说明调用者必须如何处理它

1.  对象是否封装成智能指针？然后智能指针将负责调用您指定的适当*删除器。*
2.  你返回一个原始指针吗？您应该避免这种情况，因为调用者必须跟踪指针，并且调用者必须将指针传递给*您*在接口中记录的函数。这只是您对库用户负担的另一层依赖，智能指针可以优雅地合理化。
3.  您是否按值返回一个对象，该对象本身包装分配的资源？如果是这种情况，请重载该对象类的复制构造函数、复制赋值运算符和析构函数，然后通过正确复制资源或在其对象的所有其他实例之间共享资源来管理资源（请参阅[此答案](https://stackoverflow.com/questions/370504/reference-counting-in-c#370520)）。

*除非*您还重载了 new 运算符，否则您几乎不应该为您的类重载 delete 运算符。重载 delete 运算符并不是字面意思：这意味着您只是重载对象关联内存的*释放*。仅当您拥有自己的内存池或想要记录对象的每个内存分配/释放时才有意义。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T15:26:32.740

应用程序删除在 lib 中创建的内容的问题是该 lib 可能使用不同的堆/内存管理器。

解决方案包括：

*   确保您的应用程序是使用与库相同的堆管理器构建的。
*   在类中实现一个（非内联）deleteMe 方法，其实现可以是`delete this;`
*   在类中定义自定义`operator delete`，在库中实现......如果有一个自定义运算符删除，那么当您的应用程序删除对象的一个​​实例时，它将调用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-03T17:13:32.507

此规则适用于**您**设计的类。经验法则（虽然并不总是使用）是，如果一个类创建了一个对象，它应该删除它。

但是如果你问的是别人设计的某个库，你不知道他是否遵守这个规则，你必须通过他自己/文档/代码来检查。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-04T00:17:10.670

您应该查阅库的文档以了解如何删除它创建的对象。除了其他人提到的之外，有时库对何时删除对象有一个期望。例如，在 wxWidgets 中，您不应该自己删除小部件，因为当它们的父小部件被销毁时，wxWidgets 会尝试为您删除它们——如果您已经删除了它们，那么您就有了双重释放（未定义的行为）。无法仅通过查看类型来确定这一点——即使库不返回智能指针，它们也可能以这种方式运行。此外，库可能依赖于以特定顺序发生的释放（例如，它可能总是先释放所有一种类型的对象），而自己删除事物会破坏顺序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-04T00:19:47.873

如果您的库在内存管理器等方面提供了构造对象的特定方法，那么您应该**没有**办法摆脱该对象，除非通过一种有意义的方式以类似于处理对象的方式处理该对象被建造/分配。

换句话说，如果您的对象倾向于以某种方式分配，请确保所有摆脱它们的方法都遵循您的“某种方式”。

# c# - ado.net 的 Microsoft Sync 框架可以与 Java 一起使用吗？

> ID：409209
> 
> 赞同：1
> 
> 时间：2009-01-03T15:29:02.377
> 
> 标签：c#, java, synchronization, microsoft-sync-framework

我计划为其中一个应用程序使用以下架构：客户端：基于 Java 的应用程序，将使用 MySQL 数据库服务器：将基于 C#，数据库将是 SQL Server

现在可以在 Java 中使用 Microsoft Sync Framework 吗？（可能通过实现一些接口？）。我希望来自 Java 客户端的数据同步到服务器，反之亦然。这可能吗？

如果没有，那么您能否建议一些其他同步框架。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-12T12:11:07.373

首先，我不熟悉 Sync，但快速阅读[概述](http://msdn.microsoft.com/en-us/sync/bb821992.aspx)表明您的客户端将需要提供 Web 服务或 RSS 提要，以便 Sync 运行时从Java 进程。

我在您的设计中看到的问题是，通常有不止一个客户端，但从语义上讲，只有一个后端——在这种情况下是 MySQL 数据库。我怀疑这会导致同步认为在多个客户端运行时存在冲突，但我可能是错的。

无论如何，除此之外，我假设您的目标是保持 MySQL 和 MSSQL 数据库同步？如果是这种情况，那么为什么不在成为同步参与者的 MySQL 数据库前面运行服务器端进程。如果您已经在服务器端安装了 .Net，您甚至可以用 C# 编写它，这必然会缓解互操作问题。

如果您将客户端设置为同步参与者，请查看 Jakarta Commons，我认为其中包含您需要将客户端变成一个简单的 Web 服务器所需的代码，以充当网络服务或 RSS 提要。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T15:59:29.397

您需要在 Java 和 Sync 框架之间找到一些“粘合剂”。[Java Native Interface](http://java.sun.com/j2se/1.4.2/docs/guide/jni/)将为您提供一个良好的开端。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-09T19:14:05.433

您可以让 Sync Framework 的“客户端”部分成为单独的 C#.NET 应用程序或服务。这意味着将同步客户端和 .NET 框架部署到客户端计算机。您还必须为 Sync Framework 构建一个 MySQL 客户端提供程序（尽管您可能可以从 codeplex 找到或调整某些东西）。

如果您无法在客户端计算机上安装 .NET，您可能需要考虑利用构建在 Java 堆栈上的同步系统并使用它。类似于此处建议的解决方案之一：[开源框架 à la Microsoft Sync Framework 建议？](https://stackoverflow.com/questions/2704130/open-source-framework-a-la-microsoft-sync-framework-suggestions/). 至少那里的一些建议可以与 MSSQL 和 MySQL 对话。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-09T17:50:08.317

实际上，您可以直接从 SQL Server 使用更改跟踪。

[http://msdn.microsoft.com/en-us/library/cc280462(SQL.100).aspx](http://msdn.microsoft.com/en-us/library/cc280462(SQL.100).aspx)

# asp.net - 如何根据用户的角色创建具有不同显示的视图？

> ID：409213
> 
> 赞同：16
> 
> 时间：2009-01-03T15:31:26.210
> 
> 标签：asp.net, asp.net-mvc, roles

我想根据用户的角色创建一个具有不同显示的视图。

我应该为不同的角色创建不同的视图，还是应该在 Veiw 页面本身而不是在操作中检查角色？

如何在查看页面上查看角色？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-03T16:24:40.313

> 或者我应该使用检查 Veiw 页面上的角色而不是动作，如果可以的话，有人可以告诉我如何在查看页面上检查

你需要两者都做。检查操作中的角色作为安全措施并检查视图中的角色以启用/禁用特定控件。

在您的视图页面中，检查角色的长形式是

```
HttpContext.Current.User.IsInRole("Administrator") 
```

许多开发人员将创建页面帮助方法，以便您最终为您的应用程序提供更简洁的东西，例如

```
public static bool IsAdmin(this ViewUserControl pg)
{
    return pg.Page.User.IsInRole("Administrator")
} 
```

那么在您看来，您可以只使用*this.IsAdmin()*

为了使您的视图保持混乱，请考虑使用部分视图

```
<% if (IsAdmin())
   {
      Html.RenderPartial("AdminPanel");
   }
   else
   {
      Html.RenderPartial("UserPanel");
   }
%> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-03T16:09:51.763

如果显示根据角色发生变化——而且变化很小——那么我会在视图中进行检查。如果某些视图基于角色受到限制，那么我会在控制器中进行检查。如果视图完全不同（这很难想象），那么每个角色的单独视图可能是合适的。

您可能希望将某些特定于角色的视图组件抽象为部分视图以简化您的视图逻辑——基本上您只需根据角色检查是否包含部分视图。

此外，除了检查“IsAuthenticated”之外，我会将角色检查逻辑移动到控制器并（作为数据）传递给视图信息，以了解基于角色要包含/排除哪些元素。这可以防止实际的业务逻辑渗入您的视图。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-03T15:53:52.717

如果您使用的是 MVC，那么整个开发点就是将逻辑保持在视图之外和控制器中。在我看来，WebForms 开发轨道比 MVC 轨道更好。

话虽如此，我使用这样的检查对我的很多页面进行了管理员检查：

```
<% if ((bool)ViewData["Admin"]) { %>
    <!-- Show admin controls here -->
<% } %> 
```

但是，如果您尝试将实际逻辑构建到视图中，那么您需要弄清楚您可以将什么推回控制器以完成工作，并让视图尽可能愚蠢，对发送给它的标志进行操作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-03T15:46:30.390

如果不研究 asp.net mvc 用于角色的确切机制，我会尖叫不将您的任何业务逻辑放在视图中，如果您在视图中检查角色，那么您正在做的事情

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-03T16:28:21.803

是的，这也让我感到困扰......但与此同时，为这么小的变化加载完全不同的视图似乎很荒谬。

顺便说一句，您是如何在控制器中进行设置的。现在，我的控制器看起来像下面的代码，我认为它不正确。

```
[Authorize(Roles = "Admin, Member")]
public ActionResult RegistrationInformation()
{

    return View();
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-03T15:53:24.573

我对 ASP.NET MVC（还）不太熟悉，但你不能在视图中做某种条件过滤器吗？如果控制器将角色传递给视图，那么如果用户是管理员，您应该能够进行条件过滤并显示某个代码块。如果你想显示一个完全独立的页面，那么你会有多个视图，否则你可以使用一个并做一些有条件的。

在 Ruby on Rails 中，它类似于（抱歉，我还不知道 ASP.NET MVC）：

```
<% if @user.admin? # is the user an admin %>
  <h3>Admin Tools</h3>
<% end %>
<p>Regular site content</p> 
```

在 Rails 中，您将从部分加载额外内容；ASP.NET MVC 有类似的东西，但我忘记了它叫什么。也许调查一下？

抱歉，我无法提供更多帮助——就像我说的我还没有真正开始使用 ASP.NET MVC。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-13T19:02:34.327

我有从所有其他模型扩展的基本模型。在这个模型中，我已经加载了用户的角​​色。它基于 httpcontext.user.isinrole() 方法。所有视图都是强类型的，需要基本模型类型。所以我总是可以检查所有视图，比如 Model.CurrentUser.IsInRoles(Role1 | Role2)。当然不仅在视图中，而且在孔应用中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-03-23T15:20:22.830

我喜欢在视图中完全控制它，我发现：

```
<% if (User.IsInRole("Super User")) { %>
    <h1>Hello world!</h1>
<% } %> 
```

适用于大多数情况。它还允许您轻松地为其他角色进行条件格式化，例如“内容管理员”、“已注册”等。

I do like Todd Smith's answer, because you might change the name of the Admin role, and that will require only one change, whereas, if you put the "Super User" or "Administrator" string directly in the view, you will have to change it wherever you've used the value.

# python - Python邮箱编码错误

> ID：409217
> 
> 赞同：6
> 
> 时间：2009-01-03T15:32:56.267
> 
> 标签：python, encoding, email-formats

首先，让我说我是 Python 的完全初学者。我从来没有学过这门语言，当谷歌只找到 Python 片段来解决我的问题时，我只是想“这有多难”。:)

我有一堆 Maildir 格式的邮箱（从我的旧 Web 主机上的邮件服务器备份），我需要从中提取电子邮件。到目前为止，我发现的最简单的方法是将它们转换为 Thunderbird 支持的 mbox 格式，而且似乎 Python 有一些用于读取/写入这两种格式的类。看起来很完美。

Python 文档甚至有这个小代码片段完全符合我的需要：

```
src = mailbox.Maildir('maildir', factory=None)
dest = mailbox.mbox('/tmp/mbox')

for msg in src:   #1
    dest.add(msg) #2 
```

*除非*它不起作用。这就是我对 Python 完全缺乏了解的地方。在一些消息中，我在迭代期间收到 UnicodeDecodeError （即，当它试图`msg`从`src`, on line读取时`#1`）。在其他人身上，我在尝试添加`msg`到`dest`(line `#2`) 时收到 UnicodeEncodeError。

显然，它对所使用的编码做出了一些错误的假设。但我不知道如何在邮箱上指定编码（就此而言，我也不知道编码应该是什么，但一旦我找到一种实际指定编码的方法，我可能会弄清楚）。

我得到类似于以下内容的堆栈跟踪：

```
 File "E:\Python30\lib\mailbox.py", line 102, in itervalues
    value = self[key]
  File "E:\Python30\lib\mailbox.py", line 74, in __getitem__
    return self.get_message(key)
  File "E:\Python30\lib\mailbox.py", line 317, in get_message
    msg = MaildirMessage(f)
  File "E:\Python30\lib\mailbox.py", line 1373, in __init__
    Message.__init__(self, message)
  File "E:\Python30\lib\mailbox.py", line 1345, in __init__
    self._become_message(email.message_from_file(message))
  File "E:\Python30\lib\email\__init__.py", line 46, in message_from_file
    return Parser(*args, **kws).parse(fp)
  File "E:\Python30\lib\email\parser.py", line 68, in parse
    data = fp.read(8192)
  File "E:\Python30\lib\io.py", line 1733, in read
    eof = not self._read_chunk()
  File "E:\Python30\lib\io.py", line 1562, in _read_chunk
    self._set_decoded_chars(self._decoder.decode(input_chunk, eof))
  File "E:\Python30\lib\io.py", line 1295, in decode
    output = self.decoder.decode(input, final=final)
  File "E:\Python30\lib\encodings\cp1252.py", line 23, in decode
    return codecs.charmap_decode(input,self.errors,decoding_table)[0]
UnicodeDecodeError: 'charmap' codec can't decode byte 0x9d in position 37: character maps to <undefined> 
```

在 UnicodeEncodeErrors 上：

```
 File "E:\Python30\lib\email\message.py", line 121, in __str__
    return self.as_string()
  File "E:\Python30\lib\email\message.py", line 136, in as_string
    g.flatten(self, unixfrom=unixfrom)
  File "E:\Python30\lib\email\generator.py", line 76, in flatten
    self._write(msg)
  File "E:\Python30\lib\email\generator.py", line 108, in _write
    self._write_headers(msg)
  File "E:\Python30\lib\email\generator.py", line 141, in _write_headers
    header_name=h, continuation_ws='\t')
  File "E:\Python30\lib\email\header.py", line 189, in __init__
    self.append(s, charset, errors)
  File "E:\Python30\lib\email\header.py", line 262, in append
    input_bytes = s.encode(input_charset, errors)
UnicodeEncodeError: 'ascii' codec can't encode character '\xe5' in position 16:
ordinal not in range(128) 
```

任何人都可以在这里帮助我吗？（对于不涉及 Python 的完全不同的解决方案的建议显然也是受欢迎的。我只需要一种方法来访问从这些 Maildir 文件中获取导入邮件。

*更新：*

sys.getdefaultencoding 返回“utf-8”

我上传了导致这两个错误的示例消息。 [这个](http://jalf.dk/python_problem/1187691008.H199308P14265.c1p.hostingzoom.com_2,S)抛出 UnicodeEncodeError，[这个](http://jalf.dk/python_problem/1219438193.H364790P13554.c1p.hostingzoom.com_2,S)抛出 UnicodeDecodeError

我尝试在 Python2.6 中运行相同的脚本，但得到了 TypeErrors：

```
 File "c:\python26\lib\mailbox.py", line 529, in add
    self._toc[self._next_key] = self._append_message(message)
  File "c:\python26\lib\mailbox.py", line 665, in _append_message
    offsets = self._install_message(message)
  File "c:\python26\lib\mailbox.py", line 724, in _install_message
    self._dump_message(message, self._file, self._mangle_from_)
  File "c:\python26\lib\mailbox.py", line 220, in _dump_message
    raise TypeError('Invalid message type: %s' % type(message))
TypeError: Invalid message type: <type 'instance'> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-03T17:32:09.583

在 Python 2.5 或 2.6 而不是 3.0 中尝试。3.0 具有完全不同的 Unicode 处理，并且此模块可能尚未针对 3.0 进行更新。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-03T18:01:10.510

笔记

1.  @Jimmy2Times 说这个模块可能不会更新到 3.0 可能是非常正确的。

2.  这不是一个答案，特别是对正在发生的事情，为什么，如何重现它的可能解释，其他人可以从中受益。我正在尝试进一步完成这个答案。

我已经把我能找到的任何东西都放在下面的**编辑**中

=====

我认为这就是正在发生的事情

在您的数据中的许多其他字符中，您有两个字符 -`\x9d`并且`\xe5`这些字符以某种编码格式编码，例如`iso-8859-1`.

当 Python 3.0 找到编码字符串时，它首先尝试猜测字符串的编码，然后使用猜测的编码将其解码为 un​​icode（它保持编码的 unicode 字符串的方式 - [Link](http://docs.python.org/3.0/whatsnew/3.0.html#text-vs-data-instead-of-unicode-vs-8-bit)）。

我认为它的猜测部分是它出错的地方。

为了显示最有可能发生的事情 -

假设编码是`iso-8859-1`并且错误的猜测是`cp1252`（从第一个回溯开始）。

解码`\x9d`失败。

```
In [290]: unicode(u'\x9d'.encode('iso-8859-1'), 'cp1252')
---------------------------------------------------------------------------
<type 'exceptions.UnicodeDecodeError'>    Traceback (most recent call last)

/home/jv/<ipython console> in <module>()

/usr/lib/python2.5/encodings/cp1252.py in decode(self, input, errors)
     13 
     14     def decode(self,input,errors='strict'):
---> 15         return codecs.charmap_decode(input,errors,decoding_table)
     16 
     17 class IncrementalEncoder(codecs.IncrementalEncoder):

<type 'exceptions.UnicodeDecodeError'>: 'charmap' codec can't decode byte 0x9d in position 0: character maps to <undefined> 
```

解码`\xe5`通过，但是，当从 Python 某处检索消息时，它试图对其进行编码，`ascii`但失败

```
In [291]: unicode(u'\xe5'.encode('iso-8859-1'), 'cp1252').encode('ascii')
---------------------------------------------------------------------------
<type 'exceptions.UnicodeEncodeError'>    Traceback (most recent call last)

/home/jv/<ipython console> in <module>()

<type 'exceptions.UnicodeEncodeError'>: 'ascii' codec can't encode character u'\xe5' in position 0: ordinal not in range(128) 
```

=============

**编辑**：

你的两个问题都在第 2 行。它首先解码为 un​​icode，然后编码为 ascii

首先做**easy_install chardet**

解码错误：

```
In [75]: decd=open('jalf_decode_err','r').read()

In [76]: chardet.detect(decd)
Out[76]: {'confidence': 0.98999999999999999, 'encoding': 'utf-8'}
##this is what is tried at the back - my guess :)
In [77]: unicode(decd, 'cp1252') 
---------------------------------------------------------------------------
<type 'exceptions.UnicodeDecodeError'>    Traceback (most recent call last)

/home/jv/<ipython console> in <module>()

/usr/lib/python2.5/encodings/cp1252.py in decode(self, input, errors)
     13 
     14     def decode(self,input,errors='strict'):
---> 15         return codecs.charmap_decode(input,errors,decoding_table)
     16 
     17 class IncrementalEncoder(codecs.IncrementalEncoder):

<type 'exceptions.UnicodeDecodeError'>: 'charmap' codec can't decode byte 0x9d in position 2812: character maps to <undefined>'

##this is a FIX- this way all your messages r accepted
In [78]: unicode(decd, chardet.detect(decd)['encoding']) 
Out[78]: u'Return-path: <root@apps2.servage.net>\nEnvelope-to: public@jalf.dk\nDelivery-date: Fri, 22 Aug 2008 16:49:53 -0400\nReceived: from [77.232.66.102] (helo=apps2.servage.net)\n\tby c1p.hostingzoom.com with esmtp (Exim 4.69)\n\t(envelope-from <root@apps2.servage.net>)\n\tid 1KWdZu-0003VX-HP\n\tfor public@jalf.dk; Fri, 22 Aug 2008 16:49:52 -0400\nReceived: from apps2.servage.net (apps2.servage.net [127.0.0.1])\n\tby apps2.servage.net (Postfix) with ESMTP id 4A87F980026\n\tfor <public@jalf.dk>; Fri, 22 Aug 2008 21:49:46 +0100 (BST)\nReceived: (from root@localhost)\n\tby apps2.servage.net (8.13.8/8.13.8/Submit) id m7MKnkrB006225;\n\tFri, 22 Aug 2008 21:49:46 +0100\nDate: Fri, 22 Aug 2008 21:49:46 +0100\nMessage-Id: <200808222049.m7MKnkrB006225@apps2.servage.net>\nTo: public@jalf.dk\nSubject: =?UTF-8?B?WW5ncmVzYWdlbnMgTnloZWRzYnJldiAyMi44LjA4?=\nFrom: Nyhedsbrev fra Yngresagen <info@yngresagen.dk>\nReply-To: info@yngresagen.dk\nContent-type: text/plain; charset=UTF-8\nX-Abuse: Servage.net Listid 16329\nMime-Version: 1.0\nX-mailer: Servage Maillist System\nX-Spam-Status: No, score=0.1\nX-Spam-Score: 1\nX-Spam-Bar: /\nX-Spam-Flag: NO\nX-ClamAntiVirus-Scanner: This mail is clean\n\n\nK\xe6re medlem\n\nH\xe5ber du har en god sommer og er klar p\xe5 at l\xe6se seneste nyt i Yngresagen. God forn\xf8jelse!\n\n\n::. KOM TIL YS-CAF\xc8 .::\nFlere og billigere ungdomsboliger, afskaf 24-\xe5rs-reglen eller hvad synes du? Yngresagen indbyder dig til en \xe5ben debat over kaffe og snacks. Yngresagens Kristian Lauta, Mette Marb\xe6k, og formand Steffen M\xf8ller fort\xe6ller om tidligere projekter og vil gerne diskutere, hvad Yngresagen skal bruge sin tid p\xe5 fremover.  \nVil du diskutere et emne, du br\xe6nder for, eller vil du bare v\xe6re med p\xe5 en lytter?\nS\xe5 kom torsdag d. 28/8 kl. 17-19, Kulturhuset 44, 2200 KBH N \n \n::. VIND GAVEKORT & BLIV H\xd8RT .:: \nYngresagen har lavet et sp\xf8rgeskema, s\xe5 du har direkte mulighed for at sige din mening, og v\xe6re med til at forme Yngresagens arbejde. Brug 5 min. p\xe5 at dele dine holdninger om f.eks. uddannelse, arbejde og unges vilk\xe5r - og vind et gavekort til en musikbutik. Vi tr\xe6kker lod blandt alle svarene og finder tre heldige vindere. Sp\xf8rgeskemaet er her: www.yngresagen.dk\n\n::. YS SPARKER NORDJYLLAND I GANG .::\nNordjylland bliver Yngresagens sunde region. Her er regionsansvarlig Andreas M\xf8ller Stehr ved at starte tre projekter op: 1) L\xf8beklub, 2) F\xf8rstehj\xe6lpskursus, 3) Mad til unge-program.\nVi har brug for flere frivillige til at sparke projekterne i gang. Vi tilbyder gratis fede aktiviteter, gratis t-shirts og ture til K\xf8benhavn, hvor du kan m\xf8de andre unge i YS. Har det fanget din interesse, s\xe5 t\xf8v ikke med at kontakte os: nordjylland@yngresagen.dk tlf. 21935185\. \n\n::. YNGRESAGEN I PRESSEN .::\nL\xe6s her et udsnit af sidste nyt om Yngresagen i medierne. L\xe6s og lyt mere p\xe5 hjemmesiden under \u201dYS i pressen\u201d.\n\n:: Radionyhederne: Unge skal informeres bedre om l\xe5n \nUnge ved for lidt om at l\xe5ne penge. Det udnytter banker og rejseselskaber til at give dem l\xe5n med t\xe5rnh\xf8je renter. S\xe5dan lyder det fra formand Steffen M\xf8ller fra landsforeningen Yngresagen. \n\n:: Danmarks Radio P1: Dansk Folkeparti - de \xe6ldres parti? \nHvorfor er det kun fattige \xe6ldre og ikke alle fattige, der kan s\xf8ge om at f\xe5 nedsat medielicens?\nDansk Folkepartis ungeordf\xf8rer, Karin N\xf8dgaard, og Yngresagens formand Steffen M\xf8ller debatterer medielicens, \xe6ldrecheck og indflydelse til unge \n\n:: Frederiksborg Amts Avis: Turen til Roskilde koster en holdning!\nFor at skabe et m\xf8de mellem politikere og unge fragter Yngresagen unge gratis til \xe5rets Roskilde Festival. Det sker med den s\xe5kaldte Yngrebussen, der kan l\xe6ses mere om p\xe5 www.yngrebussen.dk\n\n \n \nMed venlig hilsen \nYngresagen\n\nLandsforeningen Yngresagen\nKulturhuset Kapelvej 44\n2200 K\xf8benhavn N\n\ntlf. 29644960\ninfo@yngresagen.dk\nwww.yngresagen.dk\n\n\n-------------------------------------------------------\nUnsubscribe Link: \nhttp://apps.corecluster.net/apps/ml/r.php?l=16329&e=public%40jalf.dk%0D%0A&id=40830383\n-------------------------------------------------------\n\n' 
```

现在它是 unicode，所以它不应该给你任何问题。

现在是编码问题：这是一个问题

```
In [129]: encd=open('jalf_encode_err','r').read()

In [130]: chardet.detect(encd)
Out[130]: {'confidence': 0.78187650822865284, 'encoding': 'ISO-8859-2'}

#even after the unicode conversion the encoding to ascii fails - because the criteris is strict by default
In [131]: unicode(encd, chardet.detect(encd)['encoding']).encode('ascii')
---------------------------------------------------------------------------
<type 'exceptions.UnicodeEncodeError'>    Traceback (most recent call last)

/home/jv/<ipython console> in <module>()

<type 'exceptions.UnicodeEncodeError'>: 'ascii' codec can't encode character u'\u0159' in position 557: ordinal not in range(128)'

##changing the criteria to ignore
In [132]: unicode(encd, chardet.detect(encd)['encoding']).encode('ascii', 'ignore')
Out[132]: 'Return-path: <info@kollegierneskontor.dk>\nEnvelope-to: alf@5elements.net\nDelivery-date: Tue, 21 Aug 2007 06:10:08 -0400\nReceived: from pfepc.post.tele.dk ([195.41.46.237]:52065)\n\tby c1p.hostingzoom.com with esmtp (Exim 4.66)\n\t(envelope-from <info@kollegierneskontor.dk>)\n\tid 1INQgX-0003fI-Un\n\tfor alf@5elements.net; Tue, 21 Aug 2007 06:10:08 -0400\nReceived: from local.com (ns2.datadan.dk [195.41.7.21])\n\tby pfepc.post.tele.dk (Postfix) with SMTP id ADF4C8A0086\n\tfor <alf@5elements.net>; Tue, 21 Aug 2007 12:10:04 +0200 (CEST)\nFrom: "Kollegiernes Kontor I Kbenhavn" <info@kollegierneskontor.dk>\nTo: "Jesper Alf Dam" <alf@5elements.net>\nSubject: Fornyelse af profil\nDate: Tue, 21 Aug 2007 12:10:03 +0200\nX-Mailer: Dundas Mailer Control 1.0\nMIME-Version: 1.0\nContent-Type: Multipart/Alternative;\n\tboundary="Gark=_20078211010346yhSD0hUCo"\nMessage-Id: <20070821101004.ADF4C8A0086@pfepc.post.tele.dk>\nX-Spam-Status: No, score=0.0\nX-Spam-Score: 0\nX-Spam-Bar: /\nX-Spam-Flag: NO\nX-ClamAntiVirus-Scanner: This mail is clean\n\n\n\n--Gark=_20078211010346yhSD0hUCo\nContent-Type: text/plain; charset=ISO-8859-1\nContent-Transfer-Encoding: Quoted-Printable\n\nHej Jesper Alf Dam=0D=0A=0D=0AHusk at forny din profil hos KKIK inden 28.=\n august 2007=0D=0ALog ind p=E5 din profil og benyt ikonet "forny".=0D=0A=0D=\n=0AVenlig hilsen=0D=0AKollegiernes Kontor i K=F8benhavn=0D=0A=0D=0Ahttp:/=\n/www.kollegierneskontor.dk/=0D=0A=0D=0A\n\n--Gark=_20078211010346yhSD0hUCo\nContent-Type: text/html; charset=ISO-8859-1\nContent-Transfer-Encoding: Quoted-Printable\n\n<html>=0D=0A<head>=0D=0A=0D=0A<style>=0D=0ABODY, TD {=0D=0Afont-family: v=\nerdana, arial, helvetica; font-size: 12px; color: #666666;=0D=0A}=0D=0A</=\nstyle>=0D=0A=0D=0A<title></title>=0D=0A=0D=0A</head>=0D=0A<body bgcolor=3D=\n#FFFFFF>=0D=0A<hr size=3D1 noshade>=0D=0A<table cellpadding=3D0 cellspaci=\nng=3D0 border=3D0 width=3D100%>=0D=0A<tr><td >=0D=0AHej Jesper Alf Dam<br=\n><br>Husk at forny din profil inden 28\. august 2007<br>=0D=0ALog ind p=E5=\n din profil og benyt ikonet "forny".=0D=0A<br><br>=0D=0A<a href=3D"http:/=\n/www.kollegierneskontor.dk/">Klik her</a> for at logge ind.<br><br>Venlig=\n hilsen<br>Kollegiernes Kontor i K=F8benhavn=0D=0A</td></tr>=0D=0A</table=\n>=0D=0A<hr size=3D1 noshade>=0D=0A</body>=0D=0A</html>=0D=0A\n\n--Gark=_20078211010346yhSD0hUCo--\n\n'

In [133]: len(encd)
Out[133]: 2303

In [134]: len(unicode(encd, chardet.detect(encd)['encoding']).encode('ascii', 'ignore'))
Out[134]: 2302 
```

注意：如您所见，在此过程中可能会有轻微到中度的数据丢失。因此，使用与否取决于用户。

所以代码应该看起来像

```
import chardet

for msg in src:
    msg=unicode(msg, chardet.detect(msg)['encoding']).encode('ascii', 'ignore')
    dest.add(msg) 
```

# c# - 泛型和锁定集合

> ID：409226
> 
> 赞同：0
> 
> 时间：2009-01-03T15:40:41.540
> 
> 标签：c#, generics

有什么区别：

```
lock((IDictionary) _collection).SyncRoot) 
```

或者

```
lock(_collection) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-03T15:45:26.197

是的，Monitor 是在每个不同的对象上取出的，因此两者不是功能等价物。SyncRoot 是公开的，因此您可以锁定它以进行集合成员访问（并且集合内部使用相同的锁定）。这允许集合中的代码和它外部的代码就特定的锁定对象达成一致。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-03T16:02:25.367

我相信有两个问题。

> 是一样的吗？

答案是“视情况而定”。仅当通过返回“this”来实现 SyncRoot 时才相同。IDictionary 是一个接口，没有详细说明应为 SyncRoot 属性返回什么对象的合同。实现者可以自由地返回“this”或完全不同的对象（IDictionary<TKey,TValue> 执行此操作）。

> 这是个好主意吗？

不。IDictionary 实现者倾向于返回不同的对象（所有标准集合类都这样做）。因此，创建有效锁定结构的可能性不大。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T19:28:00.223

您应该使用本机线程安全字典实现而不是锁定整个字典。

[http://devplanet.com/blogs/brianr/archive/2008/09/26/thread-safe-dictionary-in-net.aspx](http://devplanet.com/blogs/brianr/archive/2008/09/26/thread-safe-dictionary-in-net.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T15:50:11.770

这取决于 IDictionary 的实现。如果字典返回 " `this`" 作为`SyncRoot`，则语句是等价的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-03T15:52:01.517

很容易看出它是不一样的：

```
Monitor.Enter((IDictionary) _collection).SyncRoot));
Monitor.Exit(_collection); 
```

这可能会抛出一个异常，说对象不一样。

我建议使用 SyncRoot 对象。IDictionary 可能会简单地返回`this`并且实际上是相同的，但这不能保证。

# c# - 使用 string[] 进行包含的最快方法

> ID：409236
> 
> 赞同：4
> 
> 时间：2009-01-03T15:46:29.533
> 
> 标签：c#

我正在从第 3 方库中取回“字符串 []”。我想做一个包含它。这样做的最有效方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-03T15:48:27.220

Array.IndexOf：

```
bool contains = Array.IndexOf(arr, value) >= 0; 
```

或者只使用 LINQ：

```
bool contains = arr.Contains(value); 
```

对于大多数用途，LINQ 应该“足够快”。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-03T15:53:23.857

如果您只检查一次，请使用`Array.IndexOf`Marc 建议的 LINQ Contains 方法。如果您要检查多次，首先将字符串数组转换为`HashSet<string>`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-03T15:52:27.010

除非您知道字符串数组是按特定顺序排序的，否则您可以做的最有效的事情是线性算法（即比较数组中的每个字符串，直到找到匹配项或数组末尾。

如果对数组进行排序，则二进制搜索会快得多。

优化算法的另一种方法（尽管复杂度没有降低）是将字符串比较向量化。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-03T15:50:54.330

`for`如果您关心绝对速度，我相当肯定循环会更快。IE，

```
for (int i = 0; i < arr.Length; ++i)
  if (arr[i] == value) return true;
return false; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-03T16:38:12.110

如果您要搜索一次或两次，请使用线性搜索或 IndexOf。

如果要搜索几次，请将字符串放入 HashSet。

如果您以时间紧迫的方式搜索无数次，请使用 HashSet 并自己管理其存储桶数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-03T19:24:06.253

您可以使用**IEnumerable.Foreach**自定义扩展

```
public static class CollectionExtensions
{
    public static void ForEach<T>(this IEnumerable list, Action<T> action)
    {
        foreach (T item in list)
        {
            action(item);
        }
    }
}

class Program
{
    static void Main(string[] args)
    {
        String[] list = new String[] { "Word1", "Word2", "Word3" };

        list.ForEach<String>(p => Console.WriteLine(p));
        list.ForEach(delegate(String p) { Console.WriteLine(p); });
    }
} 
```

希望这可以帮助。

# artificial-intelligence - 为什么安全要求不鼓励使用人工智能？

> ID：409252
> 
> 赞同：4
> 
> 时间：2009-01-03T15:55:57.610
> 
> 标签：artificial-intelligence, requirements

似乎安全要求似乎不喜欢使用 AI 来满足安全相关要求的系统（尤其是在涉及巨大潜在破坏/死亡风险的情况下）。谁能建议**为什么**？我一直认为，只要您正确地编写逻辑，您在算法中投入的智能越多，该算法就越有可能预防危险情况。实际情况有什么不同吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-03T16:00:05.450

大多数人工智能算法都是*模糊*的——通常是在进行过程中学习。对于具有关键安全重要性的项目，您想要的是确定性的。这些算法更容易证明是正确的，这对于许多安全关键应用程序来说是必不可少的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-03T16:01:31.623

我认为原因是双重的。

首先，人工智能可能会做出不可预测的决定。诚然，它们可能是有益的，但在谈到安全问题时，你不能冒这样的风险，尤其是当人们的生命处于危险之中时。

第二个是决策背后的“推理”不能总是被追踪（有时有一个随机元素用于使用 AI 生成结果），当出现问题时，无法确定“为什么”（在非常精确的方式）成为一种责任。

最后，它归结为问责制和可靠性。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-03T16:10:49.903

系统越复杂，测试就越困难。一个系统越重要，100% 全面的测试就越重要。

因此，对于关键系统，人们更喜欢具有可以测试的次优特性，并依赖人工交互来进行复杂的决策。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-03T16:31:12.203

从安全的角度来看，人们通常关心行为的可预测性/确定性和快速响应时间。虽然可以使用 AI 风格的编程技术中的任何一个或两个都做，但随着系统的控制逻辑变得更加复杂，很难就系统的行为提供令人信服的论据（足以让审计员满意）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-03T16:01:59.657

我猜人工智能系统通常被认为更复杂。复杂性通常是一件坏事，尤其是当它与“魔法”有关时，这是一些人对人工智能系统的看法。

这并不是说替代方案必然更简单（或更好）。

当我们完成控制系统编码时，我们必须为每个单独的代码路径和输入的排列显示跟踪表。这是为了确保我们不会将设备置于危险状态（对于员工或基础设施），并“证明”这些程序做了它们应该做的事情。

正如@tvanfosson 所指出的那样，如果程序是模糊且不确定的，那将非常棘手。我认为你应该接受这个答案。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-03T16:13:21.537

关键语句是“只要你正确地编程你的逻辑”。那么，**你如何**“提供”它？经验表明，大多数程序都充满了错误。

保证没有错误的唯一方法是形式验证，但这对于除了最原始简单的系统之外的所有系统实际上都是不可行的，而且（更糟糕的是）通常是在规范而不是代码上完成的，所以你仍然不知道在您证明规范完美无缺后，代码正确地实现了您的规范。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-03T17:30:59.633

我认为这是因为人工智能非常难以理解，并且无法维持。

即使一个人工智能程序被认为是模糊的，或者它在发布的那一刻就“学习”了，它甚至在完成之前就已经对所有已知案例（并且它已经从中学习）进行了很好的测试。大多数情况下，这种“学习”会改变程序中的一些“阈值”或权重，之后，即使对于创建者来说，也很难真正理解和维护该代码。

在过去的 30 年中，通过创建更易于数学家理解的语言，使他们更容易测试和围绕问题提供新的伪代码（如 mat lab AI 工具箱），这种情况已经发生了变化

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-01T10:38:07.890

普通算法有足够多的方式，如果设计和测试质量不佳，最终可能会杀人。如果您还没有阅读过它，您应该查看[Therac 25](http://courses.cs.vt.edu/~cs3604/lib/Therac_25/Therac_1.html)的案例。这是一个行为应该是完全确定性的系统，但事情仍然非常糟糕，非常糟糕。想象一下，如果它也试图“智能地”推理。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-03-02T22:29:43.557

由于没有公认的人工智能定义，问题应该更加具体。

我的答案是自适应算法仅仅使用参数估计——一种学习——来提高输出信息的安全性。即使这在功能安全中也不受欢迎，尽管看起来提议的算法的行为不仅是确定性的（所有计算机程序都是）而且很容易确定。

准备好迎接评估员要求您展示涵盖输入数据和故障模式的所有组合的测试报告。您的算法是自适应的，这意味着它不仅取决于当前输入值，还取决于许多或所有早期值。您知道在宇宙时代不可能进行完整的测试覆盖。

一种评分方法是表明以前接受的更简单的算法（最先进的）是不安全的。如果您知道您的问题空间，这将很容易（如果不知道，请远离 AI）。

您的问题可能存在另一种可能性：一个引人注目的监控功能，指示参数是否被准确估计。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-03-05T00:58:26.723

复杂问题空间的“普通算法”往往是有问题的。另一方面，一些“智能”算法具有简单的结构。对于贝叶斯推理的应用尤其如此。您只需要知道数据的似然函数（如果数据分成统计独立的子集，则应用复数）。

可以测试似然函数。如果测试无法覆盖足够远的尾部以达到所需的置信水平，只需添加更多数据，例如来自另一个传感器的数据。你的算法结构不会改变。

一个缺点是/是贝叶斯推理所需的 CPU 性能。

此外，提到 Therac 25 并没有什么帮助，因为*根本没有*涉及任何算法，只是多任务处理意大利面条代码。引用作者的话，“[这些]事故在涉及软件编码错误方面是相当独特的——大多数与计算机相关的事故不涉及编码错误，而是涉及软件要求中的错误，例如遗漏和错误处理的环境条件和系统状态。”

# c# - 在 C# 中使用字节数组

> ID：409256
> 
> 赞同：13
> 
> 时间：2009-01-03T16:00:03.280
> 
> 标签：c#, .net, networking, .net-3.5, bytearray

我有一个代表完整 TCP/IP 数据包的字节数组。为了清楚起见，字节数组的顺序如下：

（IP 标头 - 20 字节）（TCP 标头 - 20 字节）（有效负载 - X 字节）

我有一个`Parse`接受字节数组并返回`TCPHeader`对象的函数。它看起来像这样：

```
TCPHeader Parse( byte[] buffer ); 
```

给定原始字节数组，这是我现在调用此函数的方式。

```
byte[] tcpbuffer = new byte[ 20 ];
System.Buffer.BlockCopy( packet, 20, tcpbuffer, 0, 20 );
TCPHeader tcp = Parse( tcpbuffer ); 
```

有没有一种方便的方法可以将 TCP 字节数组（即完整 TCP/IP 数据包的 20-39 字节）传递给`Parse`函数，而无需先将其提取到新的字节数组中？

在 C++ 中，我可以执行以下操作：

```
TCPHeader tcp = Parse( &packet[ 20 ] ); 
```

C#中有类似的东西吗？如果可能，我想避免临时字节数组的创建和后续垃圾收集。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-03T16:05:17.327

您可以在 .NET 框架中看到并且我建议在此处使用的一种常见做法是指定偏移量和长度。所以让你的 Parse 函数也接受传递数组中的偏移量，以及要使用的元素数量。

当然，与在 C++ 中传递指针一样的规则适用 - 不应修改数组，否则如果您不确定何时使用数据，则可能导致未定义的行为。但是，如果您不再要修改数组，这没有问题。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-01-03T16:06:46.247

[`ArraySegment<byte>`](http://msdn.microsoft.com/en-us/library/1hsbd92d.aspx)在这种情况下，我会通过一个。

您可以将`Parse`方法更改为：

```
// Changed TCPHeader to TcpHeader to adhere to public naming conventions.
TcpHeader Parse(ArraySegment<byte> buffer) 
```

然后您将调用更改为：

```
// Create the array segment.
ArraySegment<byte> seg = new ArraySegment<byte>(packet, 20, 20);

// Call parse.
TcpHeader header = Parse(seg); 
```

使用`ArraySegment<T>`不会复制数组，它会在构造函数中为您检查边界（这样您就不会指定不正确的边界）。然后你改变你的`Parse`方法以使用段中指定的边界，你应该没问题。

您甚至可以创建一个接受完整字节数组的便利重载：

```
// Accepts full array.
TcpHeader Parse(byte[] buffer)
{
    // Call the overload.
    return Parse(new ArraySegment<byte>(buffer));
}

// Changed TCPHeader to TcpHeader to adhere to public naming conventions.
TcpHeader Parse(ArraySegment<byte> buffer) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-03T16:05:01.647

如果`IEnumerable<byte>`可以接受 an 作为输入而不是`byte[]`，并且您使用的是 C# 3.0，那么您可以编写：

```
tcpbuffer.Skip(20).Take(20); 
```

请注意，这仍然在幕后分配枚举器实例，因此您不会完全逃避分配，因此对于少量字节，它实际上可能比分配新数组并将字节复制到其中要慢。

老实说，我不会太担心小型临时数组的分配和 GC。.NET 垃圾收集环境在这种类型的分配模式下非常有效，尤其是在数组寿命很短的情况下，所以除非您对其进行分析并发现 GC 是一个问题，否则我会以最直观的方式编写它并且当你知道你有性能问题时修复它们。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-03T16:06:06.293

如果你真的需要这种控制，你必须看看`unsafe`C# 的特性。它允许您拥有一个指针并将其固定，以便 GC 不会移动它：

```
fixed(byte* b = &bytes[20]) {
} 
```

但是，如果没有性能问题，则不建议将这种做法用于仅托管代码。`Stream`您可以像在课堂上一样传递偏移量和长度。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-03T16:11:44.113

如果您可以更改 parse() 方法，请将其更改为接受应该开始处理的偏移量。TCPHeader Parse( byte[] buffer , int offset);

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-03T16:09:14.090

您可以使用 LINQ 执行以下操作：

```
tcpbuffer.Skip(20).Take(20); 
```

但是 System.Buffer.BlockCopy / System.Array.Copy 可能更有效。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-03T18:16:54.987

这就是我从 ac 程序员到 ac# 程序员的解决方法。我喜欢使用 MemoryStream 将其转换为流，然后使用 BinaryReader 来分解二进制数据块。必须添加两个辅助函数才能从网络顺序转换为小端序。也用于构建一个 byte[] 发送看看 [有没有办法将一个对象转换回它的原始类型而不指定每种情况？](https://stackoverflow.com/questions/360111)它具有允许从对象数组转换为字节 [] 的功能。

```
 Hashtable parse(byte[] buf, int offset )
  {

     Hashtable tcpheader = new Hashtable();

     if(buf.Length < (20+offset)) return tcpheader;

     System.IO.MemoryStream stm = new System.IO.MemoryStream( buf, offset, buf.Length-offset );
     System.IO.BinaryReader rdr = new System.IO.BinaryReader( stm );

     tcpheader["SourcePort"]    = ReadUInt16BigEndian(rdr);
     tcpheader["DestPort"]      = ReadUInt16BigEndian(rdr);
     tcpheader["SeqNum"]        = ReadUInt32BigEndian(rdr);
     tcpheader["AckNum"]        = ReadUInt32BigEndian(rdr);
     tcpheader["Offset"]        = rdr.ReadByte() >> 4;
     tcpheader["Flags"]         = rdr.ReadByte() & 0x3f;
     tcpheader["Window"]        = ReadUInt16BigEndian(rdr);
     tcpheader["Checksum"]      = ReadUInt16BigEndian(rdr);
     tcpheader["UrgentPointer"] = ReadUInt16BigEndian(rdr);

     // ignoring tcp options in header might be dangerous

     return tcpheader;
  } 

  UInt16 ReadUInt16BigEndian(BinaryReader rdr)
  {
     UInt16 res = (UInt16)(rdr.ReadByte());
     res <<= 8;
     res |= rdr.ReadByte();
     return(res);
  }

  UInt32 ReadUInt32BigEndian(BinaryReader rdr)
  {
     UInt32 res = (UInt32)(rdr.ReadByte());
     res <<= 8;
     res |= rdr.ReadByte();
     res <<= 8;
     res |= rdr.ReadByte();
     res <<= 8;
     res |= rdr.ReadByte();
     return(res);
  } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-03T16:03:43.383

我不认为你可以在 C# 中做这样的事情。您可以让 Parse() 函数使用偏移量，或者创建 3 字节数组开始；一个用于 IP 标头，一个用于 TCP 标头，一个用于有效负载。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-03T16:06:22.643

没有办法使用可验证的代码来做到这一点。如果您的 Parse 方法可以处理 IEnumerable<byte> 那么您可以使用 LINQ 表达式

```
TCPHeader tcp = Parse(packet.Skip(20)); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-03T16:42:03.803

为什么不翻转问题并创建覆盖缓冲区的类以提取位？

```
// member variables
IPHeader ipHeader = new IPHeader();
TCPHeader tcpHeader = new TCPHeader();

// passing in the buffer, an offset and a length allows you
// to move the header over the buffer
ipHeader.SetBuffer( buffer, 0, 20 );

if( ipHeader.Protocol == TCP )
{
    tcpHeader.SetBuffer( buffer, ipHeader.ProtocolOffset, 20 );
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-04-28T16:17:33.553

一些回答的人

```
tcpbuffer.Skip(20).Take(20); 
```

做错了。这是一个**很好**的解决方案，但代码应如下所示：

```
packet.Skip(20).Take(20); 
```

您应该在主**数据包**上使用 Skip 和 Take 方法，并且您发布的代码中不应存在**tcpbuffer 。**你也不必使用 then `System.Buffer.BlockCopy`。

**JaredPar**几乎是正确的，但他忘记了 Take 方法

```
TCPHeader tcp = Parse(packet.Skip(20)); 
```

但他没有弄错**tcpbuffer**。您发布的代码的最后一行应如下所示：

```
TCPHeader tcp = Parse(packet.Skip(20).Take(20)); 
```

但是，如果您仍然想使用 System.Buffer.BlockCopy 而不是 Skip and Take，因为 Steven Robbins 回答的性能可能更好：“但是 System.Buffer.BlockCopy / System.Array.Copy 可能更有效”，或者您的Parse 函数**无法**处理`IEnumerable<byte>`，或者您在发布的问题中更习惯 System.Buffer.Block，那么我建议您**只**使 tcpbuffer**不是局部**变量，而是**私有**或**受保护**或**公共**或**内部**和**静态**或非**字段**（在换句话说，它应该在**外部定义和创建**执行您发布的代码的方法）。因此 tcpbuffer 只会被创建**一次**，并且每次你传递你在 System.Buffer.BlockCopy 行发布的代码时都会设置他的值（字节）。

这样你的代码可以看起来像：

```
class Program
{
    //Your defined fields, properties, methods, constructors, delegates, events and etc.
    private byte[] tcpbuffer = new byte[20];
    Your unposted method title(arguments/parameters...)
    {
    //Your unposted code before your posted code
    //byte[] tcpbuffer = new byte[ 20 ]; No need anymore! this line can be removed.
    System.Buffer.BlockCopy( packet, 20, this.tcpbuffer, 0, 20 );
    TCPHeader tcp = Parse( this.tcpbuffer );
    //Your unposted code after your posted code
    }
    //Your defined fields, properties, methods, constructors, delegates, events and etc.
} 
```

或者只是必要的部分：

```
private byte[] tcpbuffer = new byte[20];
...
{
...
        //byte[] tcpbuffer = new byte[ 20 ]; No need anymore! This line can be removed.
        System.Buffer.BlockCopy( packet, 20, this.tcpbuffer, 0, 20 );
        TCPHeader tcp = Parse( this.tcpbuffer );
...
} 
```

如果你这样做了：

```
private byte[] tcpbuffer; 
```

相反，您必须在构造函数上添加以下行：

```
this.tcpbuffer = new byte[20]; 
```

或者

```
tcpbuffer = new byte[20]; 
```

你知道你不必输入**这个。**在 tcpbuffer 之前，它是可选的，但是如果你将它定义为静态的，那么你**就不能**这样做。相反，您必须输入类名，然后输入点“.”，或者留下它（只需输入字段的名称，仅此而已）。

# mysql - 运动会数据库设计（MySQL中）

> ID：409258
> 
> 赞同：0
> 
> 时间：2009-01-03T16:00:47.210
> 
> 标签：mysql

我正在尝试为运动会设计一个数据库。

我想我有一些好东西，但我不太确定。

情况如下。

有会议，几个体育俱乐部会各自派出一些运动员：1名或更多。运动员可以参加一个以上的项目。有几个项目：马拉松，跳杆，投矛，......

每个项目都有第一轮，四分之一决赛，半决赛和决赛。每个单项赛事都有 1 名官员记录数据，无论是时间、高度还是距离。

所以基本上，这里与运动员和赛事存在 N:M 关系。1 运动员可以参加很多项目并且有很多项目可以由不止一名运动员参加。

我认为俱乐部和运动员会有同样的事情，但我只是在运动员表中放置了一个字段“club_id”来表示来自哪个俱乐部。

我所拥有的是：

```
Table Clubs:
club_id int primary key auto_increment not null,
club_name varchar(50) not null

Table Athletes:
athlete_id int primary key auto_increment not null,
athlete_name varchar(40) not null,
athlete_club int not null,
index (athlete_club),
foreign key (athlete_club) references Clubs(club_id)

Table Events:
event_id int primary key auto_increment not null, (if there's a new round, it's a new event too)
event_name varchar(40) not null,
official_id int not null,
round enum('FIRST','QUARTER','HALF','FINAL')

Table Participations:
athlete_id int not null,
event_id int not null,
primary key (athlete_id,event_id),
index (athlete_id),
index (event_id),
foreign key (athlete_id) references Athletes(athlete_id),
foreign key (event_id) references Events(event_id) 
```

我认为基本上就是这样。缺少的是一种将系列与结果联系起来的方法。所以我认为应该存在另一种 N:M 关系，因为运动员可以进入决赛或介于两者之间的某个位置，但他们完成的每一轮比赛都需要记录下他们的分数。

因此，例如，我需要能够进行查询，该查询基本上给了我“在某一轮的某一事件中，所有时间快于 5 分钟的运动员的姓名”

或者是一位运动员在一项赛事中完成的回合列表，或者是进入某一回合的所有运动员的列表……

我不太确定如何添加它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-03T16:27:10.527

在参与表中添加结果字段

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T16:31:25.183

您的要求更多的是应用程序问题，而不是数据库问题。您的数据库设计看起来很适合您的需要。您现在需要做的是编写应用程序来查询数据库。一些 SELECTS 和 JOINS，你应该没有问题！

# ios - 在 UITableViewCell 中有一个 UITextField

> ID：409259
> 
> 赞同：180
> 
> 时间：2009-01-03T16:01:16.600
> 
> 标签：ios, objective-c, uitableview, cocoa-touch, uitextfield

我现在正在尝试这样做几天，并且在阅读了大量尝试这样做的人的消息之后，我仍然无法`UITextField`在我的某些内容中完全工作`UITableViewCells`，就像在这个例子中一样：

![截屏](https://i.stack.imgur.com/gD4cE.png)

要么我的表单工作，但文本不可见（尽管我将其颜色设置为蓝色），当我点击它时键盘进入该字段并且我无法正确实现键盘事件。我尝试了一堆来自 Apple 的示例（主要是`UICatalog`，其中有一个类似的控件），但它仍然无法正常工作。

有人可以帮助我（以及所有试图实现这种控制的人）并在 a`UITextField`中发布一个简单的实现`UITableViewCell`，效果很好吗？

* * *

## 回答 #1

> 赞同：225
> 
> 时间：2010-02-09T16:19:47.780

试试这个。对我来说就像一个魅力（在 iPhone 设备上）。我曾经将此代码用于登录屏幕。我将表格视图配置为有两个部分。您当然可以摆脱部分条件。

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {

UITableViewCell *cell = [self.tableView dequeueReusableCellWithIdentifier:kCellIdentifier];
if (cell == nil) {
    cell = [[[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault 
                                   reuseIdentifier:kCellIdentifier] autorelease];
    cell.accessoryType = UITableViewCellAccessoryNone;

    if ([indexPath section] == 0) {
        UITextField *playerTextField = [[UITextField alloc] initWithFrame:CGRectMake(110, 10, 185, 30)];
        playerTextField.adjustsFontSizeToFitWidth = YES;
        playerTextField.textColor = [UIColor blackColor];
        if ([indexPath row] == 0) {
            playerTextField.placeholder = @"example@gmail.com";
            playerTextField.keyboardType = UIKeyboardTypeEmailAddress;
            playerTextField.returnKeyType = UIReturnKeyNext;
        }
        else {
            playerTextField.placeholder = @"Required";
            playerTextField.keyboardType = UIKeyboardTypeDefault;
            playerTextField.returnKeyType = UIReturnKeyDone;
            playerTextField.secureTextEntry = YES;
        }       
        playerTextField.backgroundColor = [UIColor whiteColor];
        playerTextField.autocorrectionType = UITextAutocorrectionTypeNo; // no auto correction support
        playerTextField.autocapitalizationType = UITextAutocapitalizationTypeNone; // no auto capitalization support
        playerTextField.textAlignment = UITextAlignmentLeft;
        playerTextField.tag = 0;
        //playerTextField.delegate = self;

        playerTextField.clearButtonMode = UITextFieldViewModeNever; // no clear 'x' button to the right
        [playerTextField setEnabled: YES];

        [cell.contentView addSubview:playerTextField];

        [playerTextField release];
    }
}
if ([indexPath section] == 0) { // Email & Password Section
    if ([indexPath row] == 0) { // Email
        cell.textLabel.text = @"Email";
    }
    else {
        cell.textLabel.text = @"Password";
    }
}
else { // Login button section
    cell.textLabel.text = @"Log in";
}
return cell;    
} 
```

结果如下所示：

![登录表单](https://i.stack.imgur.com/n98KE.png)

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2014-02-05T23:26:31.490

**这是一个在 iOS6/7/8/9 下看起来不错的解决方案**。

**2016-06-10 更新：这仍然适用于 iOS 9.3.3**

**感谢您的所有支持，现在位于[https://github.com/fulldecent/FDTextFieldTableViewCell的 CocoaPods/Carthage/SPM](https://github.com/fulldecent/FDTextFieldTableViewCell)**

基本上，我们将库存`UITableViewCellStyleValue1`和订书钉放在应该在的`UITextField`地方`detailTextLabel`。这为我们提供了所有场景的自动放置：iOS6/7/8/9、iPhone/iPad、Image/No-image、Accessory/No-accessory、Portrait/Landscape、1x/2x/3x。

![在此处输入图像描述](https://i.stack.imgur.com/ZhmAA.png)

注意：这是使用带有`UITableViewCellStyleValue1`名为“word”的类型单元格的故事板。

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    cell = [tableView dequeueReusableCellWithIdentifier:@"word"];
    cell.detailTextLabel.hidden = YES;
    [[cell viewWithTag:3] removeFromSuperview];
    textField = [[UITextField alloc] init];
    textField.tag = 3;
    textField.translatesAutoresizingMaskIntoConstraints = NO;
    [cell.contentView addSubview:textField];
    [cell addConstraint:[NSLayoutConstraint constraintWithItem:textField attribute:NSLayoutAttributeLeading relatedBy:NSLayoutRelationEqual toItem:cell.textLabel attribute:NSLayoutAttributeTrailing multiplier:1 constant:8]];
    [cell addConstraint:[NSLayoutConstraint constraintWithItem:textField attribute:NSLayoutAttributeTop relatedBy:NSLayoutRelationEqual toItem:cell.contentView attribute:NSLayoutAttributeTop multiplier:1 constant:8]];
    [cell addConstraint:[NSLayoutConstraint constraintWithItem:textField attribute:NSLayoutAttributeBottom relatedBy:NSLayoutRelationEqual toItem:cell.contentView attribute:NSLayoutAttributeBottom multiplier:1 constant:-8]];
    [cell addConstraint:[NSLayoutConstraint constraintWithItem:textField attribute:NSLayoutAttributeTrailing relatedBy:NSLayoutRelationEqual toItem:cell.detailTextLabel attribute:NSLayoutAttributeTrailing multiplier:1 constant:0]];
    textField.textAlignment = NSTextAlignmentRight;
    textField.delegate = self;
    return cell;
} 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-12-31T13:42:28.913

Here is how I have achieved this:

**TextFormCell.h**

```
#import <UIKit/UIKit.h>

#define CellTextFieldWidth 90.0
#define MarginBetweenControls 20.0

@interface TextFormCell : UITableViewCell {
 UITextField *textField;
}

@property (nonatomic, retain) UITextField *textField;

@end 
```

**TextFormCell.m**

```
#import "TextFormCell.h"

@implementation TextFormCell

@synthesize textField;

- (id)initWithReuseIdentifier:(NSString *)reuseIdentifier {
    if (self = [super initWithReuseIdentifier:reuseIdentifier]) {
  // Adding the text field
  textField = [[UITextField alloc] initWithFrame:CGRectZero];
  textField.clearsOnBeginEditing = NO;
  textField.textAlignment = UITextAlignmentRight;
  textField.returnKeyType = UIReturnKeyDone;
  [self.contentView addSubview:textField];
    }
    return self;
}

- (void)dealloc {
 [textField release];
    [super dealloc];
}

#pragma mark -
#pragma mark Laying out subviews

- (void)layoutSubviews {
 CGRect rect = CGRectMake(self.contentView.bounds.size.width - 5.0, 
        12.0, 
        -CellTextFieldWidth, 
        25.0);
 [textField setFrame:rect];
 CGRect rect2 = CGRectMake(MarginBetweenControls,
       12.0,
         self.contentView.bounds.size.width - CellTextFieldWidth - MarginBetweenControls,
         25.0);
 UILabel *theTextLabel = (UILabel *)[self textLabel];
 [theTextLabel setFrame:rect2];
} 
```

It may seems a bit verbose, but it works!

Don't forget to set the delegate!

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-01-05T08:36:51.693

这应该不难。为表格创建单元格时，将 UITextField 对象添加到单元格的内容视图

```
UITextField *txtField = [[UITextField alloc] initWithFrame....]
...
[cell.contentView addSubview:txtField] 
```

将 UITextField 的委托设置为 self（即您的视图控制器） 给文本字段一个标签，以便您可以识别在您的委托方法中编辑了哪个文本字段。当用户点击文本字段时，键盘应该会弹出。我让它像这样工作。希望能帮助到你。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2010-11-29T13:16:28.853

试试这个。它也可以处理滚动，您可以重复使用单元格，而无需删除之前添加的子视图。

```
- (NSInteger)tableView:(UITableView *)table numberOfRowsInSection:(NSInteger)section{
    return 10;
}   

- (UITableViewCell *)tableView:(UITableView *)table cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    UITableViewCell *cell = [table dequeueReusableCellWithIdentifier:@"Cell"];
    if( cell == nil)
        cell = [[[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:@"Cell"] autorelease];   

    cell.textLabel.text = [[NSArray arrayWithObjects:@"First",@"Second",@"Third",@"Forth",@"Fifth",@"Sixth",@"Seventh",@"Eighth",@"Nineth",@"Tenth",nil] 
                           objectAtIndex:indexPath.row];

    if (indexPath.row % 2) {
        UITextField *textField = [[UITextField alloc] initWithFrame:CGRectMake(0, 0, 200, 21)];
        textField.placeholder = @"Enter Text";
        textField.text = [inputTexts objectAtIndex:indexPath.row/2];
        textField.tag = indexPath.row/2;
        textField.delegate = self;
        cell.accessoryView = textField;
        [textField release];
    } else
        cell.accessoryView = nil;

    cell.selectionStyle = UITableViewCellSelectionStyleNone;
    return cell;        
}

- (BOOL)textFieldShouldEndEditing:(UITextField *)textField {
    [inputTexts replaceObjectAtIndex:textField.tag withObject:textField.text];
    return YES;
}

- (void)viewDidLoad {
    inputTexts = [[NSMutableArray alloc] initWithObjects:@"",@"",@"",@"",@"",nil];
    [super viewDidLoad];
} 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2017-02-10T12:28:47.180

## 细节

*   Xcode 10.2 (10E125)、斯威夫特 5

## 完整示例代码

> TextFieldInTableViewCell

```
import UIKit

protocol TextFieldInTableViewCellDelegate: class {
    func textField(editingDidBeginIn cell:TextFieldInTableViewCell)
    func textField(editingChangedInTextField newText: String, in cell: TextFieldInTableViewCell)
}

class TextFieldInTableViewCell: UITableViewCell {

    private(set) weak var textField: UITextField?
    private(set) weak var descriptionLabel: UILabel?

    weak var delegate: TextFieldInTableViewCellDelegate?

    override init(style: UITableViewCell.CellStyle, reuseIdentifier: String?) {
        super.init(style: style, reuseIdentifier: reuseIdentifier)
        setupSubviews()
    }

    private func setupSubviews() {
        let stackView = UIStackView()
        stackView.distribution = .fill
        stackView.alignment = .leading
        stackView.spacing = 8
        contentView.addSubview(stackView)
        stackView.translatesAutoresizingMaskIntoConstraints = false
        stackView.topAnchor.constraint(equalTo: topAnchor, constant: 6).isActive = true
        stackView.bottomAnchor.constraint(equalTo: bottomAnchor, constant: -6).isActive = true
        stackView.leftAnchor.constraint(equalTo: leftAnchor, constant: 16).isActive = true
        stackView.rightAnchor.constraint(equalTo: rightAnchor, constant: -16).isActive = true

        let label = UILabel()
        label.text = "Label"
        stackView.addArrangedSubview(label)
        descriptionLabel = label

        let textField = UITextField()
        textField.textAlignment = .left
        textField.placeholder = "enter text"
        textField.setContentHuggingPriority(.fittingSizeLevel, for: .horizontal)
        stackView.addArrangedSubview(textField)
        textField.addTarget(self, action: #selector(textFieldValueChanged(_:)), for: .editingChanged)
        textField.addTarget(self, action: #selector(editingDidBegin), for: .editingDidBegin)
        self.textField = textField

        stackView.layoutSubviews()
        selectionStyle = .none

        let gesture = UITapGestureRecognizer(target: self, action: #selector(didSelectCell))
        addGestureRecognizer(gesture)
    }

    required init?(coder aDecoder: NSCoder) { super.init(coder: aDecoder) }
}

extension TextFieldInTableViewCell {
    @objc func didSelectCell() { textField?.becomeFirstResponder() }
    @objc func editingDidBegin() { delegate?.textField(editingDidBeginIn: self) }
    @objc func textFieldValueChanged(_ sender: UITextField) {
        if let text = sender.text { delegate?.textField(editingChangedInTextField: text, in: self) }
    }
} 
```

> 视图控制器

```
import UIKit

class ViewController: UIViewController {

    private weak var tableView: UITableView?
    override func viewDidLoad() {
        super.viewDidLoad()
        setupTableView()
    }
}

extension ViewController {

    func setupTableView() {

        let tableView = UITableView(frame: .zero)
        tableView.register(TextFieldInTableViewCell.self, forCellReuseIdentifier: "TextFieldInTableViewCell")
        view.addSubview(tableView)
        tableView.translatesAutoresizingMaskIntoConstraints = false
        tableView.topAnchor.constraint(equalTo: view.topAnchor).isActive = true
        tableView.bottomAnchor.constraint(equalTo: view.bottomAnchor).isActive = true
        tableView.leftAnchor.constraint(equalTo: view.leftAnchor).isActive = true
        tableView.rightAnchor.constraint(equalTo: view.rightAnchor).isActive = true
        tableView.rowHeight = UITableView.automaticDimension
        tableView.estimatedRowHeight = UITableView.automaticDimension
        tableView.tableFooterView = UIView()
        self.tableView = tableView
        tableView.dataSource = self

        let gesture = UITapGestureRecognizer(target: tableView, action: #selector(UITextView.endEditing(_:)))
        tableView.addGestureRecognizer(gesture)
    }
}

extension ViewController: UITableViewDataSource {

    func numberOfSections(in tableView: UITableView) -> Int { return 1 }
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int { return 2 }
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let cell = tableView.dequeueReusableCell(withIdentifier: "TextFieldInTableViewCell") as! TextFieldInTableViewCell
        cell.delegate = self
        return cell
    }
}

extension ViewController: TextFieldInTableViewCellDelegate {

    func textField(editingDidBeginIn cell: TextFieldInTableViewCell) {
        if let indexPath = tableView?.indexPath(for: cell) {
            print("textfield selected in cell at \(indexPath)")
        }
    }

    func textField(editingChangedInTextField newText: String, in cell: TextFieldInTableViewCell) {
        if let indexPath = tableView?.indexPath(for: cell) {
            print("updated text in textfield in cell as \(indexPath), value = \"\(newText)\"")
        }
    }
} 
```

## 结果

[![在此处输入图像描述](https://i.stack.imgur.com/jUG38.png)](https://i.stack.imgur.com/jUG38.png)

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2011-04-22T18:30:29.443

我一直在通过`[cell.contentView bringSubviewToFront:textField]`每次出现我的单元格时调用一个方法来运行来避免这种情况，但后来我发现了这个相对简单的技术：

```
cell.accessoryView = textField; 
```

似乎没有相同的背景过度粘贴问题，并且它自己（有点）对齐。此外， textLabel 会自动截断以避免溢出到（或下）它，这很方便。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-02-07T13:24:43.827

我遇到了同样的问题。似乎设置`cell.textlabel.text`属性会将 UILabel 带到单元格的 contentView 的前面。在设置之后添加 textView `textLabel.text`，或者（如果不可能的话）调用这个：

```
[cell.contentView bringSubviewToFront:textField] 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-09-11T20:58:47.140

我真的在 iPad 上为这个任务而苦苦挣扎，文本字段在 UITableView 中显示为不可见，并且当它获得焦点时整行变成蓝色。

最后对我有用的是 Apple 的 [Table View Programming Guide](http://developer.apple.com/library/ios/#documentation/UserExperience/Conceptual/TableView_iPhone/TableViewCells/TableViewCells.html#//apple_ref/doc/uid/TP40007451-CH7-SW1)中“静态行内容的技术”中描述的技术。我将标签和 textField 都放在 NIB 中的 UITableViewCell 中以获取视图，然后通过`cellForRowAtIndexPath:`. 生成的代码比 UICatalog 整洁得多。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-11-27T23:04:40.103

这就是它的完成方式，我相信正确的方法。当我测试它时，它适用于 Ipad 和 Iphone。我们必须通过对 uitableviewcell 进行分类来创建自己的 customCells：

从 interfaceBuilder 开始...创建一个新的 UIViewcontroller 将其命名为 customCell （当你在那里时自愿参加 xib）确保 customCell 是 uitableviewcell 的子类

现在擦除所有视图并创建一个视图，使其具有单个单元格的大小。使该视图成为customcell的子类。现在创建另外两个视图（复制第一个）。
转到您的连接检查器并找到 2 个您现在可以连接到这些视图的 IBOutlets。

-backgroundView -SelectedBackground

将这些连接到您刚刚复制的最后两个视图，不要担心它们。扩展 customCell 的第一个视图，将您的标签和 uitextfield 放入其中。进入 customCell.h 并连接您的标签和文本字段。将此视图的高度设置为 75（每个单元格的高度）全部完成。

在您的 customCell.m 文件中，确保构造函数看起来像这样：

```
- (id)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString *)reuseIdentifier
{
self = [super initWithStyle:style reuseIdentifier:reuseIdentifier];
if (self) {
    // Initialization code
    NSArray *nibArray = [[NSBundle mainBundle] loadNibNamed:@"CustomCell"       owner:self options:nil]; 
    self = [nibArray objectAtIndex:0];
}
return self;
} 
```

现在创建一个 UITableViewcontroller 并在此方法中使用 customCell 类，如下所示：

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
static NSString *CellIdentifier = @"Cell";
// lets use our customCell which has a label and textfield already installed for us

customCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier];
if (cell == nil) {
    //cell = [[[customCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier] autorelease];

    NSArray *topLevelsObjects = [[NSBundle mainBundle] loadNibNamed:@"NewUserCustomCell" owner:nil options:nil];
    for (id currentObject in topLevelsObjects){
        if ([currentObject  isKindOfClass:[UITableViewCell class]]){
            cell = (customCell *) currentObject;
            break;
        }
    }

    NSUInteger row = [indexPath row];

switch (row) {
    case 0:
    {

        cell.titleLabel.text = @"First Name"; //label we made (uitextfield also available now)

        break;
    }

        }
return cell; 
```

}

```
- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath{

return 75.0;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-11-16T22:28:22.437

这是一个插入式子类，`UITableViewCell`它用可编辑的替换detailTextLabel **（**`UITextField`或者，在 的情况下`UITableViewCellStyleDefault`，替换**textLabel**）。这样做的好处是它允许你重用所有熟悉的 UITableViewCellStyles、accessoryViews 等，刚才细节是可编辑的！

```
@interface GSBEditableTableViewCell : UITableViewCell <UITextFieldDelegate>
@property UITextField *textField;
@end

@interface GSBEditableTableViewCell ()
@property UILabel *replace;
@end

@implementation GSBEditableTableViewCell

- (instancetype)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString *)reuseIdentifier
{
    self = [super initWithStyle:style reuseIdentifier:reuseIdentifier];
    if (self) {
        _replace = (style == UITableViewCellStyleDefault)? self.textLabel : self.detailTextLabel;
        _replace.hidden = YES;

        // Impersonate UILabel with an identical UITextField
        _textField = UITextField.new;
        [self.contentView addSubview:_textField];
        _textField.translatesAutoresizingMaskIntoConstraints = NO;
        [_textField.leftAnchor constraintEqualToAnchor:_replace.leftAnchor].active = YES;
        [_textField.rightAnchor constraintEqualToAnchor:_replace.rightAnchor].active = YES;
        [_textField.topAnchor constraintEqualToAnchor:_replace.topAnchor].active = YES;
        [_textField.bottomAnchor constraintEqualToAnchor:_replace.bottomAnchor].active = YES;
        _textField.font = _replace.font;
        _textField.textColor = _replace.textColor;
        _textField.textAlignment = _replace.textAlignment;

        // Dont want to intercept UITextFieldDelegate, so use UITextFieldTextDidChangeNotification instead
        [NSNotificationCenter.defaultCenter addObserver:self
                                           selector:@selector(textDidChange:)
                                               name:UITextFieldTextDidChangeNotification
                                             object:_textField];

        // Also need KVO because UITextFieldTextDidChangeNotification not fired when change programmatically
        [_textField addObserver:self forKeyPath:@"text" options:0 context:nil];
    }
    return self;
}

- (void)textDidChange:(NSNotification*)notification
{
    // Update (hidden) UILabel to ensure correct layout
    if (_textField.text.length) {
        _replace.text = _textField.text;
    } else if (_textField.placeholder.length) {
        _replace.text = _textField.placeholder;
    } else {
        _replace.text = @" "; // otherwise UILabel removed from cell (!?)
    }
    [self setNeedsLayout];
}

- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)context
{
    if ((object == _textField) && [keyPath isEqualToString:@"text"]) [self textDidChange:nil];
}

- (void)dealloc
{
    [_textField removeObserver:self forKeyPath:@"text"];
}

@end 
```

使用简单 - 只需像以前一样创建您的单元格，但现在使用**cell.textField**而不是**cell.detailTextLabel**（或**cell.textLabel**的情况下`UITableViewCellStyleDefault`）。例如

```
GSBEditableTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"Cell"];
if (!cell) cell = [GSBEditableTableViewCell.alloc initWithStyle:UITableViewCellStyleValue2 reuseIdentifier:@"Cell"];

cell.textLabel.text = @"Name";
cell.textField.text = _editablename;
cell.textField.delegate = self; // to pickup edits
... 
```

受FD的回答启发并改进

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-01-31T10:43:50.887

对于此方法中 UITableViewCell 内的多个 UITextfield 上的下一个/返回事件，我在情节提要中采用了 UITextField。

```
@interface MyViewController () {
    NSInteger currentTxtRow;
}
@end
@property (strong, nonatomic) NSIndexPath   *currentIndex;//Current Selected Row

@implementation MyViewController

- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {

        UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"CELL" forIndexPath:indexPath];
        cell.selectionStyle = UITableViewCellSelectionStyleNone;

        UITextField *txtDetails = (UITextField *)[cell.contentView viewWithTag:100];
        txtDetails.delegate = self;

        txtDetails.placeholder = self.arrReciversDetails[indexPath.row];
        return cell;
}

#pragma mark - UITextFieldDelegate
- (BOOL)textFieldShouldBeginEditing:(UITextField *)textField {

    CGPoint point = [textField convertPoint:CGPointZero toView:self.tableView];
    self.currentIndex = [self.tableView indexPathForRowAtPoint:point];//Get Current UITableView row
    currentTxtRow = self.currentIndex.row;
    return YES;
}

- (BOOL)textFieldShouldReturn:(UITextField *)textField {
    currentTxtRow += 1;
    self.currentIndex = [NSIndexPath indexPathForRow:currentTxtRow inSection:0];

    UITableViewCell *cell = [self.tableView cellForRowAtIndexPath:self.currentIndex];
    UITextField *currentTxtfield = (UITextField *)[cell.contentView viewWithTag:100];
    if (currentTxtRow < 3) {//Currently I have 3 Cells each cell have 1 UITextfield
        [currentTxtfield becomeFirstResponder];
    } else {
        [self.view endEditing:YES];
        [currentTxtfield resignFirstResponder];
    }

} 
```

从文本字段中获取文本-

```
- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string {
      switch (self.currentIndex.row) {

            case 0:
                NSLog(@"%@",[NSString stringWithFormat:@"%@%@",textField.text,string]);//Take current word and previous text from textfield
                break;

            case 1:
                 NSLog(@"%@",[NSString stringWithFormat:@"%@%@",textField.text,string]);//Take current word and previous text from textfield
                break;

            case 2:
                 NSLog(@"%@",[NSString stringWithFormat:@"%@%@",textField.text,string]);//Take current word and previous text from textfield
                break;

            default:
                break;
        }
} 
```

# language-agnostic - What do you write in your log book?

> ID：409280
> 
> 赞同：11
> 
> 时间：2009-01-03T16:12:13.147
> 
> 标签：language-agnostic, time-management

Everywhere I've worked, programmers carry about a ruled A4 hard-back note book. To avoid attracting attention, I dutifully carry one also, and once or twice in every meeting I nod sagely and pretend to write down something interesting. Occasionally people leave theirs unattended and I sneak a look. Mostly they seem to be writing a complete narrative of everything they do in the order it happened. Some fill book after book with tiny scrawl like the Kevin Spacey character in 'Seven'.

I can't seem to organize these books like everyone else. Almost all of the paper I generate I throw away, so I work with loose sheets. The things which need preserving end up in design docs or a wiki. TODOs are best tracked as Post-Its on my monitor. Browser bookmarks take care of most day-to-day info about 3rd party tools, and so on.

Could anyone who has an effective log book system please share?

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-12T17:01:04.360

> Day 417\.
> 
> Still here. We have no source code.
> 
> We lost the last of Joel's 12 tests two days ago.
> 
> I can not get out.
> 
> The end comes.
> 
> Management failures.
> 
> Management failures in the deep.
> 
> They are coming.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-03T16:18:57.423

You don't need to do things the way other people do it. Different people work in different ways. I'm actually more like you. I will write stuff down during meetings but typically the act of writing stuff down is all that is necessary for me to actually remember it. Important stuff goes into a wiki (edited live during the meeting). I do use post-its to help me remember what comes next or stuff that I need to right away -- those go on my monitor. Even if I had an *effective* log book system for getting data entered -- I'd never look at it, rendering it completely useless.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-03T16:16:09.567

I put all the things you listed (wiki, docs, etc.) into the logbook initially. Once the notes are entered into OneNote, the Wiki, etc., I cross them off the logbook. I don't throw the notes away as there's some possibility that I might need to check back into them.

I use the logbook as just a short term memory buffer. I get its contents into a searchable computer regularly--usually immediately.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-03T16:44:19.430

I use my log book for two purposes. The first is in meetings, where I try to record any decisions or discussions that are taking place from a developer's point of view. At the end of the meeting I'll put my edited notes into an e-mail and sent them to whomever is publishing the meeting minutes. I often find that this helps make sure any "unimportant" details are not left off the minutes - and the minute taker is almost always glad for the second set of notes to work off.

I also use the log book when doing something non-routine. Usually this involves either setting up an application server, installing a new version of some software, or approaching a problem where I'm not sure where to start and intend to "try things out". The purpose of the log book is to be able to retrace my steps in case things go wrong, and to be able to replicate the solution if things go right.

As to physical media, I used to carry around a series of college ruled notebooks. However, I now either enter notes directly into a draft wiki page or into Evernote. I also sketch ideas on graph paper and scan them in to Evernote - ditto with my whiteboard and a digital camera. Evernote has great handwriting recognition. My final notes end up on a relevant wiki page.

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-03T17:58:57.673

My notebooks tend to fall apart, which can be very frustrating.

But here's what tends to go into them.

On the organisation front:

*   Write a date and project name at the top!
*   Small Todo (from the daily scrum)
*   I rewrite my days todo list, evey day it seems (integrate with list from scrum)
*   Notes on decisions (often todo items) from meetings (and why)

New Ideas

*   If I have a random idea, that might be useful keep a note
*   Diagrams of how ideas might work etc

Bugs

*   Bugs that cause me a lot of grief... and how they are resolved

I've previously used a wiki, and I'm thinking it might be valuable again, just the ability to have a page behind that 1 item, is invaluable.

My plan in 2009 is to get a small notebook for each project I work on (rather than 1 unified notebook) then I can refer to project notes, rather than searching chronologically.

Good luck

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-03T16:22:42.050

Keep a log if you need to report on what you are doing in the day but cant recall instantly when asked. Note things like what you have done , time devoted to research time devoted to revising current code/designs as needed.

I used to also keep a notebook but mostly so that i could take notes in meetings and stuff , otherwise its just a waste of time , rather use a digital notepad.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-03T16:13:45.437

I have a file, "todo.txt". It is located in the Startup folder, so it is the first thing I see when I start Windows. I don't have an actual "log-book", though I guess I could use one sometimes, I have loads of single A4 papers laying around.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-03T17:49:56.600

It's a bad habit to "sneak a peek", that said, you seem to be a beginner, don't worry It'll come to you. Like tvanfosson said, don't try to do what others do, be yourself. When at meetings try to pick out the important stuff, like on architectures or patterns discussed and make some notes to remember, or an important advice or point from another peer. Also start drawing some diagrams on the projects(s) you are working on. Remember, overtime it'll just come to you, don't beat yourself up. And yes...carry the book and also a pencil!

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-25T16:44:55.310

**To-do list!** I use my notebook to capture any to-do's that pop up during work. I have a simple system that works wonders, I never forget tasks that I capture this way:

1.  If there's a big O in the left margin, then that line is a do to
2.  I put a tick mark in the O when the task is done (or when I've moved the task into another system).
3.  When a page is all done, I put a big slash over the entire page. It's easy to see that it's done.
4.  If there's just one or two tasks left on a page, then I transfer those tasks to the next empty page so I can strike the old page out. Works as a "notebook defrag" of sorts.

I could use a bunch of single papers but they'd get **disorganized and lost**. A notebook **stays with me.** I also take down interesting tidbits during meetings, names and contact details of coworkers I need to work with, bits of code or parameters, and stuff that I can't memorize with sufficient precision.

It's true that it **looks more professional** and busy to carry a notebook than going empty-handed. I often carry it with me for just that reason, as it reduces unnecessary guilt about leaving the workstation.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-03T17:13:27.580

I've noticed that the people who use logbooks religiously at my company are those that started off at companies that do a lot of government contracts - defense contracting and the like. They had to log their billable hours and this was a way to define what they did every day.

I have one that I use for three purposes.

1) Doodling and sketching during large, boring, mandatory department meetings - I can't stand just sitting and listening to someone droning on. A sketchbook would be preferred, but too obvious.
2) Capturing white board drawings when we need to erase the board (I could use a camera but they aren't allowed in all areas).
3) Taking notes in stand-up meetings to transfer into electronic format if needed.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-03T17:18:30.877

I write down things that I've been tasked to do and any supporting information/drawings/diagrams that points me in the right direction. When I've finished the tasks, I put my notes in the recycling bin. Anything I need to remember in the future is recorded electronically, either as part of the solution or a Word document with instructions on what to do next time. For example, I made a Word document with a list of things to do at the end of each year based on all the things I was given to do at the end of last year.

If you feel you need the written notes for future reference, keep them. If not, don't. I think it's better to have them electronically so that if you change positions in the company, the next person who has to do your job has access to the relevant information.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-03T18:45:41.543

We had this weird (and pointless) practice pushed down our throats at university. Personally, I never got the idea, and if you asked me today where those logbooks went, I couldn't tell you. I do have a small Moleskine notebook for ideas, but I mainly try to stick with entering cases into the Inbox in FobBugz, since that's where most of my software-related ideas and development tracking actually happens. The benefits being that a) this stuff will never get lost; and b) I don't have to carry it with me, and cannot lose it.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-04T05:12:23.307

Consider writing your notes in your obligatory log book, then scanning them into the free Evernote application, available on Win, Mac and web. It'll translate your text automatically, making your notes searchable from anywhere. They're even shareable. It's a very useful utility, as you can also capture from FireFox or Thunderbird with just a click. Check out [www.evernote.com](http://www.evernote.com)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-12T16:49:11.160

I use a logbook/notebook to record todo items from meetings (minutes) and to record conversations after they have happened and todo items from those conversations. Somewhere in sachachua.com she writes about recording three main points from significant conversations - I try to do this - my brain will always remember one thing and at a stretch will remember three. If the conversation is significant enough I will take the notes as we speak. (Sacha's main note on recording conversations is [here](http://sachachua.com/wp/2006/05/30/networking-with-moleskines/) but I can't find the 3-things comment)

The notebooks are then kept in chronological order on one shelf and refered to as required. They help in 'remembering' things like - did I agree to give Pawel a wage increase of 15 or 50 euro? did I tell Joan her redundancy notice would start from Monday or today? When did I tell the client the first payment was due and when did he agree the final payment would be made?

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-07-05T09:00:13.567

Sounds to me like you're doing it right (at least, the same way I do it). Things stay on the paper only long enough to be transferred into an appropriate electronic form (usually wiki, or the bug tracking system, or an electronic todo list).

I used to keep my old notes filed away with the thought that someday I might want to revisit them. After over ten years of never having needed to revisit any of it, I gave up, and now throw things away as soon as I'm done with them.

Paper can't be easily searched, and can't easily be backed up, and as such is an inferior medium for information storage. IMO.

# mysql - 我应该在 MySQL 中使用 datetime 还是 timestamp 数据类型？

> ID：409286
> 
> 赞同：2959
> 
> 时间：2009-01-03T16:14:37.090
> 
> 标签：mysql, datetime, timestamp, sqldatatypes

你会推荐使用[日期](https://dev.mysql.com/doc/refman/5.0/en/datetime.html)时间或[时间戳](https://dev.mysql.com/doc/refman/5.0/en/datetime.html)字段，为什么（使用 MySQL）？

我在服务器端使用 PHP。

* * *

## 回答 #1

> 赞同：1998
> 
> 时间：2009-01-03T16:26:17.313

MySQL 中的时间戳一般用于跟踪记录的更改，并且经常在每次记录更改时更新。如果要存储特定值，则应使用日期时间字段。

如果您的意思是要在使用 UNIX 时间戳或原生 MySQL 日期时间字段之间做出决定，请使用原生格式。您可以通过这种方式在 MySQL 中进行计算， 如果您想使用 PHP 对其进行操作，则在查询记录时`("SELECT DATE_ADD(my_datetime, INTERVAL 1 DAY)")`将值的格式更改为 UNIX 时间戳很简单。`("SELECT UNIX_TIMESTAMP(my_datetime)")`

* * *

## 回答 #2

> 赞同：1010
> 
> 时间：2009-03-02T11:49:07.727

在 MySQL 5 及更高版本中，**TIMESTAMP**值从当前时区转换为 UTC 进行存储，并从 UTC 转换回当前时区进行检索。（这仅适用于 TIMESTAMP 数据类型，*而不*适用于其他类型，例如 DATETIME。）

默认情况下，每个连接的当前时区是服务器的时间。可以在每个连接的基础上设置时区，如*[MySQL Server Time Zone Support](http://dev.mysql.com/doc/refman/5.5/en//time-zone-support.html)*中所述。

* * *

## 回答 #3

> 赞同：588
> 
> 时间：2009-01-04T04:26:29.780

我总是将 DATETIME 字段用于除行元数据（创建或修改日期）之外的任何内容。

如MySQL 文档中所述[：](http://dev.mysql.com/doc/refman/5.1/en/datetime.html)

> 当您需要包含日期和时间信息的值时，使用 DATETIME 类型。MySQL 以 'YYYY-MM-DD HH:MM:SS' 格式检索和显示 DATETIME 值。支持的范围是“1000-01-01 00:00:00”到“9999-12-31 23:59:59”。
> 
> ...
> 
> TIMESTAMP 数据类型的范围为 '1970-01-01 00:00:01' UTC 到 '2038-01-09 03:14:07' UTC。它具有不同的属性，具体取决于 MySQL 版本和服务器运行的 SQL 模式。

您很可能会达到一般使用的 TIMESTAMP 的下限——例如​​存储生日。

* * *

## 回答 #4

> 赞同：361
> 
> 时间：2011-08-21T08:45:29.977

下面的示例显示了`TIMESTAMP`日期类型在更改`time-zone to 'america/new_york'`where`DATETIME`不变后如何更改值。

```
mysql> show variables like '%time_zone%';
+------------------+---------------------+
| Variable_name    | Value               |
+------------------+---------------------+
| system_time_zone | India Standard Time |
| time_zone        | Asia/Calcutta       |
+------------------+---------------------+

mysql> create table datedemo(
    -> mydatetime datetime,
    -> mytimestamp timestamp
    -> );

mysql> insert into datedemo values ((now()),(now()));

mysql> select * from datedemo;
+---------------------+---------------------+
| mydatetime          | mytimestamp         |
+---------------------+---------------------+
| 2011-08-21 14:11:09 | 2011-08-21 14:11:09 |
+---------------------+---------------------+

mysql> set time_zone="america/new_york";

mysql> select * from datedemo;
+---------------------+---------------------+
| mydatetime          | mytimestamp         |
+---------------------+---------------------+
| 2011-08-21 14:11:09 | 2011-08-21 04:41:09 |
+---------------------+---------------------+ 
```

我已将我的答案转换为文章，以便更多人可以发现这很有用，*[MySQL: Datetime Versus Timestamp Data Types](http://www.tech-recipes.com/rx/22599/mysql-datetime-vs-timestamp-data-type/)*。

* * *

## 回答 #5

> 赞同：215
> 
> 时间：2010-01-14T14:26:35.403

主要区别在于 DATETIME 是常量，而 TIMESTAMP 受`time_zone`设置影响。

因此，只有当您拥有（或将来可能拥有）跨时区同步集群时才重要。

简而言之：**如果我在澳大利亚有一个数据库，并转储该数据库以同步/填充美国的数据库，则 TIMESTAMP 将更新以反映新时区中事件的实时时间，而 DATETIME 将仍然在 au 时区反映事件发生的时间**。

在 Facebook 中应该使用 TIMESTAMP 的地方使用 DATETIME 的一个很好的例子，他们的服务器永远无法确定跨时区发生的时间。有一次我进行了一次对话，其中时间说我是在消息实际发送之前回复消息。（当然，如果发布时间而不是同步时间，这也可能是由于消息传递软件中的时区转换错误造成的。）

* * *

## 回答 #6

> 赞同：135
> 
> 时间：2009-01-03T17:11:46.193

我在语义基础上做出这个决定。

当我需要记录（或多或少）固定时间点时，我会使用时间戳。例如，当一条记录插入数据库或发生某些用户操作时。

当可以任意设置和更改日期/时间时，我使用日期时间字段。例如，当用户可以保存以后更改约会时。

* * *

## 回答 #7

> 赞同：133
> 
> 时间：2014-06-11T23:02:10.827

我建议**既不**使用 DATETIME 也不使用 TIMESTAMP 字段。如果您想将特定的一天作为一个整体来表示（例如生日），请使用 DATE 类型，但如果您比这更具体，您可能对记录实际时刻而不是单位感兴趣时间（日、周、月、年）。不要使用 DATETIME 或 TIMESTAMP，而是使用 BIGINT，并简单地存储自纪元以来的毫秒数（如果您使用的是 Java，则为 System.currentTimeMillis()）。这有几个优点：

1.  您可以避免供应商锁定。几乎每个数据库都以相对相似的方式支持整数。假设您要移动到另一个数据库。您是否要担心 MySQL 的 DATETIME 值与 Oracle 如何定义它们之间的差异？即使在不同版本的 MySQL 中，TIMESTAMPS 也有不同的精度级别。直到最近，MySQL 才在时间戳中支持毫秒。
2.  没有时区问题。关于不同数据类型的时区会发生什么，这里有一些有见地的评论。但这是常识吗，你的同事都会花时间去学习吗？另一方面，很难将 BigINT 更改为 java.util.Date。使用 BIGINT 会导致时区出现很多问题。
3.  无需担心范围或精度。您不必担心未来日期范围会缩短什么时间（TIMESTAMP 只到 2038 年）。
4.  第三方工具集成。通过使用整数，第 3 方工具（例如 EclipseLink）与数据库的接口是微不足道的。并非每个第三方工具都会像 MySQL 那样对“日期时间”有相同的理解。如果您正在使用这些自定义数据类型，是否想尝试在 Hibernate 中确定是否应该使用 java.sql.TimeStamp 或 java.util.Date 对象？使用您的基本数据类型使得与 3rd-party 工具的使用变得微不足道。

这个问题与您应该如何在数据库中存储货币价值（即 1.99 美元）密切相关。您应该使用 Decimal，还是数据库的 Money 类型，或者最糟糕的是 Double？由于上面列出的许多相同原因，所有这 3 个选项都很糟糕。解决方案是使用 BIGINT 以美分存储货币的价值，然后在向用户显示价值时将美分转换为美元。数据库的工作是存储数据，而不是解释数据。您在数据库（尤其是 Oracle）中看到的所有这些花哨的数据类型几乎没有什么作用，并让您开始锁定供应商。

* * *

## 回答 #8

> 赞同：123
> 
> 时间：2013-12-21T11:12:10.113

1.  `TIMESTAMP`是 4 个字节，而`DATETIME`.

2.  数据库上的时间戳也更轻，索引速度更快。

3.  `DATETIME`当您需要包含日期和时间信息的值时使用该类型。MySQL 以格式检索和显示`DATETIME`值。`YYYY-MM-DD HH:MM:SS`支持的范围是`1000-01-01 00:00:00`to `9999-12-31 23:59:59`。数据类型的`TIMESTAMP`范围为`1970-01-01 00:00:01 UTC`to `2038-01-09 03:14:07 UTC`。它具有不同的属性，具体取决于 MySQL 版本和服务器运行的 SQL 模式。

4.  `DATETIME`是恒定的，而`TIMESTAMP`受`time_zone`设置影响。

* * *

## 回答 #9

> 赞同：105
> 
> 时间：2009-01-04T09:00:36.573

TIMESTAMP 是 4 个字节，而 DATETIME 是 8 个字节。

[http://dev.mysql.com/doc/refman/5.0/en/storage-requirements.html](http://dev.mysql.com/doc/refman/5.0/en/storage-requirements.html)

但是就像 scronide 说的那样，它确实有 1970 年的下限。不过，这对于未来可能发生的任何事情都很好；）

* * *

## 回答 #10

> 赞同：54
> 
> 时间：2010-10-26T21:07:28.183

取决于应用程序，真的。

考虑为在桑海约会的用户设置一个时间戳到纽约的服务器。现在，当用户在 Sanghai 连接时，他从东京的镜像服务器访问相同的约会时间戳。他将在东京时间看到约会，与原来的纽约时间有偏差。

因此，对于代表用户时间的值（如约会或日程安排），日期时间更好。它允许用户控制所需的确切日期和时间，而不管服务器设置如何。设置时间是设置时间，不受服务器时区、用户时区或夏令时计算方式变化的影响（是的，它确实会改变）。

另一方面，对于表示系统时间的值，如支付交易、表修改或日志记录，始终使用时间戳。将服务器移动到另一个时区，或者在不同时区的服务器之间进行比较时，系统不会受到影响。

数据库上的时间戳也更轻，索引速度更快。

* * *

## 回答 #11

> 赞同：50
> 
> 时间：2016-02-17T22:36:09.280

## *2016 +*：我建议将您的 Mysql 时区设置为 UTC 并使用 DATETIME：

任何最近的前端框架（Angular 1/2、react、Vue 等）都可以轻松自动地将您的 UTC 日期时间转换为本地时间。

此外：

*   DATETIME 现在可以**自动**设置为当前时间值[如何为 MySQL Datetime 列设置默认值？](https://stackoverflow.com/questions/168736/how-do-you-set-a-default-value-for-a-mysql-datetime-column/10603198#10603198)
*   与人们的想法相反，DATETIME 比TIMESTAMP 更快， **http** [: //gpshumano.blogs.dri.pt/2009/07/06/mysql-datetime-vs-timestamp-vs-int-performance-and-benchmarking-with -myisam/](http://gpshumano.blogs.dri.pt/2009/07/06/mysql-datetime-vs-timestamp-vs-int-performance-and-benchmarking-with-myisam/)
*   TIMESTAMP 仍然限于 1970-2038

（除非您可能会更改服务器的时区）

* * *

AngularJs 示例

```
// back-end: format for angular within the sql query
SELECT DATE_FORMAT(my_datetime, "%Y-%m-%dT%TZ")...

// font-end Output the localised time
{{item.my_datetime | date :'medium' }} 
```

此处提供的所有本地化时间格式： [https ://docs.angularjs.org/api/ng/filter/date](https://docs.angularjs.org/api/ng/filter/date)

* * *

## 回答 #12

> 赞同：44
> 
> 时间：2019-12-23T18:56:35.603

两者都不。对于通用用例， [`DATETIME`](https://dev.mysql.com/doc/refman/5.7/en/datetime.html)and[`TIMESTAMP`](https://dev.mysql.com/doc/refman/5.7/en/datetime.html)类型从根本上被破坏了。MySQL 将来会改变它们。您应该使用`BIGINT`UNIX 时间戳，除非您有特定的理由使用其他东西。

# 特别案例

以下是一些特定情况，您的选择更容易，您不需要此答案中的分析和一般建议。

*   **仅日期**- 如果您只关心日期（例如下一个农历新年的日期，2022-02-01）并且您清楚地了解该日期适用的时区（或者不关心，如案例农历新年）然后使用[`DATE`](https://dev.mysql.com/doc/refman/5.7/en/datetime.html)列类型。

*   **记录插入时间**——如果您正在记录数据库中行的插入日期/时间，并且您不关心您的应用程序[将在未来 17 年内中断](https://dev.mysql.com/doc/refman/5.7/en/datetime.html)，那么请继续使用`TIMESTAMP`默认值`CURRENT_TIMESTAMP()`.

# 为什么`TIMESTAMP`坏了？

该`TIMESTAMP`类型以 UTC 时区存储在磁盘上。这意味着，如果您实际移动服务器，它不会中断。这很好✅。但目前定义的时间戳将在 2038 年完全停止工作❌。

每次您`INSERT INTO`或列时，都会考虑您的客户端/应用程序服务器的物理位置（即时区配置）`SELECT FROM`。`TIMESTAMP`如果您移动应用程序服务器，那么您的日期就会中断 ❌。

# 为什么`VARCHAR`坏了？

该`VARCHAR`类型允许以 ISO 8601 格式明确存储非本地日期/时间/两者，并且适用于 2037 年以后的日期。通常使用 Zulu 时间，但 ISO 8601 允许对任何偏移量进行编码。这不太有用，因为虽然 MySQL 日期和时间函数确实支持字符串作为任何预期日期/时间/两者的输入，但如果输入使用时区偏移量，则结果不正确。

还`VARCHAR`使用额外的存储字节。

# 为什么`DATETIME`坏了？

A`DATETIME`将 a`DATE`和 a存储`TIME`在同一列中。除非了解时区，否则这些事情都没有任何意义，并且时区不存储在任何地方❌。您应该将预期的时区作为注释放在列中，因为时区与数据有着千丝万缕的联系。很少有人使用专栏评论，因此这是等待发生的错误。我从亚利桑那州继承了一台服务器，因此我总是需要将所有时间戳从亚利桑那时间转换为另一个时间。

*（更新 2021-12-08 我在运行多年后重新启动了服务器，并且数据库客户端（带有升级）重置为 UTC。这意味着我的应用程序需要以不同的方式处理重置前后的日期。硬编码！）*

唯一`DATETIME`正确的情况是完成这句话：

> 您的 2020 年太阳能新年正好从`DATETIME("2020-01-01 00:00:00")`.

s没有其他好的用途`DATETIME`。也许您会想象特拉华州一个市政府的 Web 服务器。当然，这个服务器的时区和所有访问这个服务器的人都可以暗示在特拉华州，使用东部时区，对吧？错误的！在这个千禧年，我们都认为服务器存在于“云”中。因此，在任何特定时区考虑您的服务器总是错误的，因为您的服务器总有一天会被移动。

注意：MySQL 现在支持文字中的[时区偏移](https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-19.html)`DATETIME`（[感谢@Marko](https://stackoverflow.com/questions/409286/should-i-use-the-datetime-or-timestamp-data-type-in-mysql/59460086?noredirect=1#comment112665253_59460086)）。这可能使插入`DATETIME`s 对您来说更方便，但不能解决数据的不完整和无用的含义，这个致命问题在上面标识 ("❌")。

# 如何使用`BIGINT`？

**定义：**

```
CREATE TEMPORARY TABLE good_times (
    a_time BIGINT
) 
```

**插入特定值：**

```
INSERT INTO good_times VALUES (
    UNIX_TIMESTAMP(CONVERT_TZ("2014-12-03 12:24:54", '+00:00', @@global.time_zone))
); 
```

或者当然这从您的应用程序中要好得多，例如：

```
$statement = $myDB->prepare('INSERT INTO good_times VALUES (?)');
$statement->execute([$someTime->getTimestamp()]); 
```

**选择：**

```
SELECT a_time FROM good_times; 
```

过滤相对时间的技术（选择过去 30 天内的帖子，查找在注册后 10 分钟内购买的用户）超出了这里的范围。

* * *

## 回答 #13

> 赞同：43
> 
> 时间：2010-08-25T23:21:57.363

TIMESTAMP 始终采用 UTC（即自 1970-01-01 以来经过的秒数，采用 UTC），您的 MySQL 服务器会自动将其转换为连接时区的日期/时间。从长远来看，TIMESTAMP 是可行的方法，因为您知道您的时间数据将始终采用 UTC。例如，如果您迁移到其他服务器或更改服务器上的时区设置，您不会搞砸日期。

注意：默认连接时区是服务器时区，但这可以（应该）在每个会话中更改（参见 参考资料`SET time_zone = ...`）。

* * *

## 回答 #14

> 赞同：41
> 
> 时间：2009-01-03T16:21:04.190

字段是字段的`timestamp`特例`datetime`。您可以创建`timestamp`具有特殊属性的列；它可以设置为在创建和/或更新时更新自身。

在“更大”的数据库术语中，`timestamp`有几个特殊情况的触发器。

什么是正确的完全取决于你想做什么。

* * *

## 回答 #15

> 赞同：35
> 
> 时间：2017-08-11T09:53:30.207

DATETIME、TIMESTAMP 和 DATE 之间的比较

[![在此处输入图像描述](https://i.stack.imgur.com/ANc33.png)](https://i.stack.imgur.com/ANc33.png)

**那 [.fraction] 是什么？**

*   DATETIME 或 TIMESTAMP 值可以包括以微秒（6 位）精度为单位的尾随小数秒部分。特别是，插入到 DATETIME 或 TIMESTAMP 列中的值中的任何小数部分都会被存储而不是被丢弃。这当然是可选的。

资料来源：

*   [MySQL 日期/时间数据类型参考](https://dev.mysql.com/doc/refman/5.7/en/datetime.html)
*   [MySQL 存储要求参考](https://dev.mysql.com/doc/refman/5.7/en/storage-requirements.html)

* * *

## 回答 #16

> 赞同：29
> 
> 时间：2012-01-06T23:04:05.227

值得注意的是，在 MySQL 中，您可以在创建表列时使用以下内容：

```
on update CURRENT_TIMESTAMP 
```

这将更新您修改行的每个实例的时间，有时对于存储的最后编辑信息非常有帮助。这仅适用于时间戳，但不适用于日期时间。

* * *

## 回答 #17

> 赞同：27
> 
> 时间：2009-01-03T16:18:25.520

在使用 MySQL 和 PHP 时，我总是使用 Unix 时间戳。主要原因是 PHP 中的默认[日期](http://uk3.php.net/manual/en/function.date.php)方法使用时间戳作为参数，因此不需要解析。

要在 PHP 中获取当前的 Unix 时间戳，只需执行`time();`
并且在 MySQL 中执行`SELECT UNIX_TIMESTAMP();`.

* * *

## 回答 #18

> 赞同：20
> 
> 时间：2012-02-06T03:34:03.820

根据我的经验，如果您想要一个仅插入一次的日期字段，并且您不想对该特定字段进行任何更新或任何其他操作，请使用**date time**。

例如，考虑一个`user`带有**REGISTRATION DATE**字段的表。在该`user`表中，如果您想知道特定用户的上次登录时间，请使用**时间戳**类型的字段，以便该字段得到更新。

如果您从[phpMyAdmin](http://en.wikipedia.org/wiki/PhpMyAdmin)创建表，则默认设置将在发生行更新时更新**时间戳字段。**如果您的时间戳字段未随行更新而更新，您可以使用以下查询使**时间戳**字段自动更新。

```
ALTER TABLE your_table
      MODIFY COLUMN ts_activity TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP; 
```

* * *

## 回答 #19

> 赞同：17
> 
> 时间：2012-12-20T08:48:36.037

timestamp 数据类型存储日期和时间，但采用 UTC 格式，而不是像 datetime 那样采用当前时区格式。当您获取数据时，时间戳再次将其转换为当前时区时间。

因此，假设您在美国并从具有美国时区的服务器获取数据。然后您将根据美国时区获得日期和时间。时间戳数据类型列总是在其行更新时自动更新。因此，跟踪上次更新特定行的时间会很有用。

有关更多详细信息，您可以阅读博文*[Timestamp Vs Datetime](http://codebucket.co.in/timestamp-vs-datetime/)*。

* * *

## 回答 #20

> 赞同：16
> 
> 时间：2012-01-05T02:50:33.843

我总是使用 Unix 时间戳，只是为了在处理大量日期时间信息时保持理智，尤其是在执行时区调整、添加/减去日期等时。在比较时间戳时，这排除了时区的复杂因素，并允许您在服务器端处理（无论是应用程序代码还是数据库查询）中节省资源，因为您使用轻量级算法而不是较重的日期时间加/减职能。

另一件值得考虑的事情：

如果您正在构建一个应用程序，您永远不知道您的数据可能会被如何使用。如果您最终不得不将数据集中的一堆记录与第三方 API 中的一堆项目进行比较，然后将它们按时间顺序排列，您会很高兴拥有行的 Unix 时间戳。即使您决定使用 MySQL 时间戳，也要存储一个 Unix 时间戳作为保险。

* * *

## 回答 #21

> 赞同：16
> 
> 时间：2016-02-07T12:49:37.137

[来自这篇文章的参考：](http://www.dbrnd.com/2015/09/difference-between-datetime-and-timestamp-in-mysql/)

**主要区别：**

TIMESTAMP 用于跟踪记录的更改，并在每次记录更改时更新。DATETIME 用于存储不受记录更改影响的特定静态值。

TIMESTAMP 也受不同 TIME ZONE 相关设置的影响。DATETIME 是常数。

TIMESTAMP 在内部将当前时区转换为 UTC 进行存储，并在检索期间转换回当前时区。DATETIME 不能这样做。

TIMESTAMP 支持范围：'1970-01-01 00:00:01' UTC 到 '2038-01-19 03:14:07' UTC DATETIME 支持范围：'1000-01-01 00:00:00' 到 '9999 -12-31 23:59:59'</p>

* * *

## 回答 #22

> 赞同：16
> 
> 时间：2017-02-24T18:19:01.243

就我而言，我每次都将 UTC 设置为所有内容的时区：系统、数据库服务器等。如果我的客户需要另一个时区，那么我会在应用程序上对其进行配置。

我几乎总是更喜欢时间戳而不是日期时间字段，因为时间戳隐含地包含时区。因此，由于来自不同时区的用户将访问应用程序并且您希望他们查看其本地时区的日期和时间，因此与将数据保存在日期时间字段中相比，此字段类型更容易做到.

另外，在将数据库迁移到具有另一个时区的系统的情况下，我会更有信心使用时间戳。更不用说在计算两个时刻之间的差异时可能存在的问题，并且两者之间的总和时间变化并且需要 1 小时或更短的精度。

所以，总而言之，我看重时间戳的这个优点：

*   准备在国际（多时区）应用程序上使用
*   时区之间的轻松迁移
*   很容易计算差异（只需减去两个时间戳）
*   不用担心夏季时间段的日期

出于所有这些原因，我尽可能选择 UTC 和时间戳字段。而且我避免头痛;）

* * *

## 回答 #23

> 赞同：15
> 
> 时间：2013-10-04T06:00:22.683

当您对表执行 UPDATE 语句时，请注意时间戳更改。如果您有一个包含 'Name' (varchar)、'Age' (int) 和 'Date_Added' (timestamp) 列的表，并且您运行以下 DML 语句

```
UPDATE table
SET age = 30 
```

那么“Date_Added”列中的每个值都将更改为当前时间戳。

* * *

## 回答 #24

> 赞同：14
> 
> 时间：2018-04-12T03:11:02.100

```
+---------------------------------------------------------------------------------------+--------------------------------------------------------------------------+
|                                       TIMESTAMP                                       |                                 DATETIME                                 |
+---------------------------------------------------------------------------------------+--------------------------------------------------------------------------+
| TIMESTAMP requires 4 bytes.                                                           | DATETIME requires 8 bytes.                                               |
| Timestamp is the number of seconds that have elapsed since January 1, 1970 00:00 UTC. | DATETIME is a text displays 'YYYY-MM-DD HH:MM:SS' format.                |
| TIMESTAMP supported range: ‘1970-01-01 00:00:01′ UTC to ‘2038-01-19 03:14:07′ UTC.    | DATETIME supported range: ‘1000-01-01 00:00:00′ to ‘9999-12-31 23:59:59′ |
| TIMESTAMP during retrieval converted back to the current time zone.                   | DATETIME can not do this.                                                |
| TIMESTAMP is used mostly for metadata i.e. row created/modified and audit purpose.    | DATETIME is used mostly for user-data.                                   |
+---------------------------------------------------------------------------------------+--------------------------------------------------------------------------+ 
```

* * *

## 回答 #25

> 赞同：12
> 
> 时间：2011-11-01T19:42:18.347

我发现 TIMESTAMP 能够根据当前时间自动更新自身而无需使用不必要的触发器，这一点非常有用。但这只是我，尽管 TIMESTAMP 就像人们所说的那样是 UTC。

它可以跨不同时区跟踪，因此如果您需要显示相对时间，例如，UTC 时间就是您想要的。

* * *

## 回答 #26

> 赞同：12
> 
> 时间：2019-12-28T16:45:42.927

日期时间与时间戳：

TIMESTAMP 用于跟踪记录的变化，并在每次记录发生变化时更新。

DATETIME 用于存储不受记录更改影响的特定静态值。

TIMESTAMP 也受不同 TIME ZONE 相关设置的影响。DATETIME 是常数。

TIMESTAMP 在内部将当前时区转换为 UTC 进行存储，并在检索期间将其转换回当前时区。

DATETIME 不能这样做。

TIMESTAMP 为 4 个字节，DATETIME 为 8 个字节。

TIMESTAMP 支持范围：'1970-01-01 00:00:01' UTC 到 '2038-01-19 03:14:07' UTC DATETIME 支持范围：'1000-01-01 00:00:00' 到 '9999 -12-31 23:59:59'</p>

* * *

## 回答 #27

> 赞同：10
> 
> 时间：2014-03-07T12:09:05.187

主要区别在于

*   时间戳上的索引 - 有效
*   日期时间的索引 -[不起作用](https://stackoverflow.com/questions/4013301/mysql-datetime-index-is-not-working)

查看这篇[文章以查看日期时间索引的问题](https://stackoverflow.com/questions/95183/how-does-one-create-an-index-on-the-date-part-of-datetime-field-in-mysql)

* * *

## 回答 #28

> 赞同：10
> 
> 时间：2019-02-05T19:18:27.107

`datetime`在遇到与时区相关的许多问题和错误后，我停止在我的应用程序中使用。**恕我直言，使用`timestamp`比`datetime`大多数情况下**要好。

当你问什么时候？答案类似于'2019-02-05 21:18:30'，没有完成，没有定义答案，因为它缺少另一部分，在哪个时区？华盛顿？莫斯科？北京 ？

使用不带时区的日期时间意味着您的应用程序只处理 1 个时区，但是时间戳为您提供了`datetime`在不同时区显示相同确切时间点的灵活性。

以下是一些会让您后悔使用`datetime`并希望您将数据存储在时间戳中的案例。

1.  为了让您的客户感到舒适，您希望根据他们喜欢的时区向他们展示时间，而不是让他们进行数学运算并将时间转换为他们有意义的时区。您只需要更改时区，您的所有应用程序代码都将相同。*（实际上，您应该始终在应用程序开始时定义时区，或者在 PHP 应用程序的情况下进行请求处理）*

    ```
    SET time_zone = '+2:00'; 
    ```

2.  您更改了您所在的国家/地区，并继续维护数据，同时在不同的时区查看数据（不更改实际数据）。

3.  您接受来自世界各地不同客户的数据，他们每个人都在他的时区插入时间。

## 简而言之

`datetime`= 应用程序支持 1 个时区（用于插入和选择）

`timestamp`= 应用程序支持任何时区（用于插入和选择）

* * *

*这个答案只是为了强调时间戳在时区方面的灵活性和易用性，它没有涵盖任何其他差异，如[列大小或范围或分数](https://stackoverflow.com/a/45632196/5407848)。*

* * *

## 回答 #29

> 赞同：9
> 
> 时间：2014-01-19T11:06:09.197

Timestamp 和 Datetime 之间的另一个区别是 Timestamp 您不能将默认值设置为 NULL。

* * *

## 回答 #30

> 赞同：8
> 
> 时间：2009-01-04T07:49:18.933

我更喜欢使用时间戳，以便将所有内容保持在一种通用的原始格式中，并在 PHP 代码或 SQL 查询中格式化数据。在某些情况下，它可以在您的代码中派上用场，让一切都在几秒钟内完成。

* * *

## 回答 #31

> 赞同：7
> 
> 时间：2016-06-23T14:12:01.610

A`TIMESTAMP`需要 4 个字节，而 a`DATETIME`需要 8 个字节。

* * *

## 回答 #32

> 赞同：6
> 
> 时间：2011-04-28T17:34:02.793

我喜欢 Unix 时间戳，因为您可以转换为数字而只需担心数字。另外，您可以添加/减去并获取持续时间等。然后以任何格式将结果转换为日期。此代码找出文档中的时间戳与当前时间之间经过的时间（以分钟为单位）。

```
$date  = $item['pubdate']; (etc ...)
$unix_now = time();
$result = strtotime($date, $unix_now);
$unix_diff_min = (($unix_now  - $result) / 60);
$min = round($unix_diff_min); 
```

* * *

## 回答 #33

> 赞同：6
> 
> 时间：2016-10-27T07:59:30.140

当您有来自不同国家和不同时区的访问者时，TIMESTAMP 很有用。您可以轻松地将 TIMESTAMP 转换为任何国家时区

* * *

## 回答 #34

> 赞同：5
> 
> 时间：2019-09-03T13:38:50.203

A`DATETIME`不携带任何时区信息，并且始终显示与会话有效的时区无关的相同时区，除非您明确更改它，否则默认为服务器的时区。但是，如果我使用诸如 之类的函数而不是诸如 之类的文字来初始化`DATETIME`列，那么存储的值当然将是本地化到会话时区的当前日期和时间。`NOW()``'2020-01-16 12:15:00'`

`TIMESTAMP`相比之下， A确实隐式携带时区信息：当您`TIMESTAMP`使用值初始化列时，该值会在存储之前转换为 UTC。如果要存储的值是诸如 之类的文字`'2020-01-16 12:15:00'`，则出于转换目的，它会被解释为处于会话的当前时区中。相反，当`TIMESTAMP`显示一列时，它将首先从 UTC 转换为会话的当前时区。

**何时使用其中一种？案例研究**

一个社区剧团的网站正在展示它正在售票的几场戏剧表演。这些表演的日期和时间将出现在一个下拉列表中，希望购买表演门票的客户可以从中选择一个。`performance_date_and_time`将数据库列作为一种`DATETIME`类型是有意义的。如果演出在纽约，则理解为涉及隐含时区（“纽约当地时间”），理想情况下，我们希望日期和时间显示为“2019 年 12 月 12 日晚上 8:00”无论会话的时区如何，也不必费心进行任何时区转换。

另一方面，一旦 2019 年 12 月 12 日晚上 8 点表演开始，我们可能不再想出售它的门票，因此不再在下拉菜单中显示该表演。因此，我们希望能够知道“2019-12-12 20:00:00”是否发生。这将争论有一个`TIMESTAMP`列，将会话的时区设置为“America/New_York”，`set session time_zone='America/New_York'`然后存储`'2019-12-12 20:00:00'`到该`TIMESTAMP`列中。此后，我们可以通过将此列与`NOW()`当前会话时区的独立性进行比较来测试性能是否已经开始。

或者为这两个不同的目的设置一个`DATETIME`和一个列可能是有意义的。`TIMESTAMP`或不。显然，任何一个都可以同时达到两个目的。如果您只使用一`DATETIME`列，则必须将当前时区设置为您的本地时区，然后再与`NOW()`. 如果您只使用一`TIMESTAMP`列，则必须在显示该列之前将会话时区设置为您的本地时区。

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2016-05-23T11:20:02.590

`BIGINT`我只是在存储 UTC 时使用 unsigned ...

然后仍然可以在 PHP 中将其调整为本地时间。

用`DATETIME`选择`FROM_UNIXTIME( integer_timestamp_column )`。

显然应该在该列上设置一个索引，否则将没有任何进展。

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2016-06-28T07:50:40.287

这里的很多答案都建议存储为时间戳，以防您必须代表明确定义的时间点。但是，如果您按照惯例将它们全部存储在 UTC 中，您也可以使用 datetime 时间点。

* * *

## 回答 #37

> 赞同：3
> 
> 时间：2016-11-03T19:27:00.107

到目前为止没有提到的是，DEFAULT CURRENT_TIMESTAMP 仅适用于 Timestamp，但不适用于 DateTime 类型的字段。

这与只能使用 DateTime 而不能使用 Timestamp 的 MS Access 表相关。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2018-06-30T00:20:15.520

`timestamp`是计算机通过**网络时间协议 (NTP)**记录的事件的当前时间。

`datetime`是在您的**PHP**配置中设置的当前时区。

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2019-03-29T14:54:51.537

如果您想保证您的应用程序在 2038 年 2 月无法运行，请使用 TIMESTAMP。有关支持的日期范围，请参阅您的 REFMAN。

# eclipse - 字符串搜索：Eclipse IDE 有没有现代的“查找”UI（比如 Firefox）

> ID：409287
> 
> 赞同：10
> 
> 时间：2009-01-03T16:15:19.117
> 
> 标签：eclipse

**Eclipse ide**让我非常恼火的一件事是：它的 find UI 风格太旧了。

我更喜欢*Firefox*或*Safari*之类的东西，它们不会用无用的窗口弄乱我的屏幕空间。

[![老式的 Eclipse 查找窗口](https://i.stack.imgur.com/4rcAK.jpg)](https://i.stack.imgur.com/4rcAK.jpg)
[（来源：[eclipse-blog.org](https://www.eclipse-blog.org/wp-content/uploads/2007/04/blog_004.jpg)）]

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-03T16:30:00.897

按 ctrl+j。那是你要的吗？按住 shift 向后退。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-14T15:28:28.073

您也可以选择要搜索的单词并使用 ctrl+K，使用 shift 向后移动。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-12-17T10:17:26.420

而且，如果 Eclipse 的增量搜索还不够，您总是可以使用像[Glance](http://marketplace.eclipse.org/node/1012)这样的插件。
从他们的网站：

> Glance 是一个 Eclipse 插件，在 Eclipse 中提供可扩展的有用的增量文本搜索。该插件支持以下功能：
> 
> *   突出显示所有找到的匹配项
>     
> *   永远不会阻塞文本框的后台搜索
>     
> *   在表格和树中搜索
>     
> *   目标内容更改时更新匹配
>     
> *   可以通过扩展点支持新的文本容器
>     
> *   很多搜索设置

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T16:30:32.627

你的意思是，像... Ctrl+F，然后是Ctrl+K？

您不必使用“搜索”菜单。

另一方面，如果您只是不喜欢弹出对话框，我认为您现在是 SOL。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-03T16:33:26.553

Eclipse“查找”对话框在您提到的浏览器上做的不仅仅是“查找”（例如搜索和替换等）。拥有更多选项意味着更多的空间来控制它们。

# orm - 有人使用 .netTiers 吗？

> ID：409290
> 
> 赞同：3
> 
> 时间：2009-01-03T16:16:18.270
> 
> 标签：orm, .nettiers

我正在考虑为一个新项目采用 .nettiers，因为它似乎提供了很多我可以使用的功能。

有没有人在愤怒中使用它（我感觉它没有像以前那样），如果是这样，你对它的看法是什么？

此外，我找不到任何与 SubSonic 之类的比较性能指标。有人对它的性能和可扩展性有什么强烈的感受吗？

非常感谢

托尼

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T17:12:06.740

看看[这个](http://forums.subsonicproject.com/forums/p/340/1517.aspx)。它为您提供了两者之间的良好 X 与 Y 比较。

在选择要使用的框架时，我总是修改的一个关键点是：

**这是否会简化，让我更有效率**，如果您对此回答“当然是”，那么其他基准测试怎么说都没有关系，即使它的运行速度比 SubSonic 慢 10% 甚至更快，您应该使用您开发的框架最快，最让你最舒服的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T18:40:47.247

当我使用 NetTiers 时，我在某种程度上对此感到非常满意。您确实需要学习使用它的最佳方法。肯定有一些奇怪的错误，有任意限制的东西等等。你必须小心它，但如果你学习它肯定可以提高你的工作效率。我知道 CodeSmith 已经开始在其中投入更多资源。2.3 版可能非常可靠。虽然，当前最新的稳定版本可能非常可靠，但我有一段时间没有使用它了。

老实说，在这一点上我更喜欢 LLBLGen。我确实尝试过几次 SubSonic。我没有遇到重大错误，但在这两种情况下，我最终都切换到了 NetTiers。使用 SubSonic，我觉得我只是输入了太多的字符串文字，而且感觉不像其他替代品那样成熟。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-04T16:38:32.813

今天下午我有一些时间来比较 netTiers 和 SubSonic。

我使用了使用 SubStage（SubSonic 2.1 版本的一部分）生成的代码，并使用 RepositoryRecord 作为我的基类。

我使用 .netTiers 2.2 生成的代码对同一个数据库进行了相同的测试

该测试是 Rob Conery 在他的帖子中使用的测试的衍生产品：

[http://blog.wekeroad.com/blog/subsonic-scaling/](http://blog.wekeroad.com/blog/subsonic-scaling/)

当我说导数时，我的意思是我刚刚将 100,000 条记录写入数据库。

我在同一台 PC 上重复了每个测试三遍。

我发现 .netTiers 在 90 秒内完成了任务。

亚音速在 104 秒内完成。

与这些平均值的偏差不超过一秒。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T17:25:42.547

> 看这个。它为您提供了两者之间的良好 X 与 Y 比较

谢谢 - 我之前已经读过这篇文章，但它已有两年多的历史了，从那时起，这两个项目都取得了很大进展。

询问一个框架是否会让我更有效率是一个非常重要的考虑因素，但它不是唯一的一个。

另一个对我来说必须是“我是否会因为我采用的框架充满错误、难以使用或只是一个 PIA 而失去潜在的生产力收益？” 这就是为什么我问人们是否在愤怒中使用它以及他们的经历是什么。

如果 .nettiers 比 subsonic 慢 10%，但给了我一大堆更多的功能（例如更好的验证、业务规则执行等），那么我可以忍受。如果它慢十倍，那么我不会考虑它。

非常感谢

托尼

# c# - P/Invoke GetDiskFreeSpaceEx

> ID：409293
> 
> 赞同：3
> 
> 时间：2009-01-03T16:18:33.510
> 
> 标签：c#, windows-mobile, compact-framework

**完全重复：** [使用 c# 获取 Windows Mobile 手机驱动器的大小（免费、总计）](https://stackoverflow.com/questions/409069/getting-the-size-free-total-of-a-windows-mobile-phone-drive-using-c-not-solve)

* * *

亲爱的大家;

我知道我的问题花了很多时间，你们中的许多人帮助了我，但我是 C# 新手，这是我的第一个应用程序..

现在我读了一篇文章：

C#签名：

```
 [DllImport("coredll.dll", SetLastError=true, CharSet=CharSet.Auto)]
  [return: MarshalAs(UnmanagedType.Bool)]
  static extern bool GetDiskFreeSpaceEx(string lpDirectoryName,
                                        out ulong lpFreeBytesAvailable,
                                        out ulong lpTotalNumberOfBytes,
                                        out ulong lpTotalNumberOfFreeBytes); 
```

示例代码：

```
 ulong FreeBytesAvailable;
   ulong TotalNumberOfBytes;
   ulong TotalNumberOfFreeBytes;

   bool success = GetDiskFreeSpaceEx("C:\\", out FreeBytesAvailable, out  
                                    TotalNumberOfBytes,out TotalNumberOfFreeBytes);
   if (!success)
         throw new System.ComponentModel.Win32Exception();

   Console.WriteLine("Free Bytes Available:      {0,15:D}", FreeBytesAvailable);
   Console.WriteLine("Total Number Of Bytes:     {0,15:D}", TotalNumberOfBytes);
   Console.WriteLine("Total Number Of FreeBytes: {0,15:D}", TotalNumberOfFreeBytes); 
```

现在如何使用这个函数 GetDiskFreeSpaceEx ，我应该在某处添加 C# 签名吗？！？那么 coredll.dll 呢？！？

我的代码是这样的：

```
 FolderInfo = (CONADefinitions.CONAPI_FOLDER_INFO)Marshal.PtrToStructure(Buffer,     
                                      typeof(CONADefinitions.CONAPI_FOLDER_INFO));
  if (FolderInfo.pstrName[0].ToString() != "C" && level == 0) 
  {
      // here i want to get the Total Size of the currentDirectory and freeSize
      // i want them in Bytes
  } 
```

我在谷歌上搜索，但我没有足够的经验知道正确的标签

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-03T16:35:34.207

基本上，在您的情况下，您可以像任何其他静态方法一样调用它，如下所示：

```
FolderInfo = (CONADefinitions.CONAPI_FOLDER_INFO)Marshal.PtrToStructure(Buffer, typeof(CONADefinitions.CONAPI_FOLDER_INFO));
if (FolderInfo.pstrName[0].ToString() != "C" && level == 0) 
{
  ulong FreeBytesAvailable;
  ulong TotalNumberOfBytes;
  ulong TotalNumberOfFreeBytes;

  bool success = GetDiskFreeSpaceEx("C:\\", out FreeBytesAvailable, out TotalNumberOfBytes,out TotalNumberOfFreeBytes);

  if (!success)
    throw new System.ComponentModel.Win32Exception();
} 
```

我建议创建一个包装器来为你处理异常的抛出（除非你想每次都检查返回值而不处理异常）：

```
[DllImport("coredll.dll", SetLastError=true, CharSet=CharSet.Auto, EntryPoint="GetDiskFreeSpaceEx")]
[return: MarshalAs(UnmanagedType.Bool)]
static extern bool InternalGetDiskFreeSpaceEx(string lpDirectoryName, out ulong lpFreeBytesAvailable, out ulong lpTotalNumberOfBytes, out ulong lpTotalNumberOfFreeBytes);

static GetDiskFreeSpaceEx(string directoryName, out ulong freeBytesAvailable, out ulong totalNumberOfBytes, out totalNumberOfFreeBytes);
{
  if (!GetDiskFreeSpaceEx(directoryName, out freeBytesAvailable, out totalNumberOfBytes, out totalNumberOfFreeBytes))
    throw new System.ComponentModel.Win32Exception();
} 
```

呼叫站点将变为：

```
FolderInfo = (CONADefinitions.CONAPI_FOLDER_INFO)Marshal.PtrToStructure(Buffer, typeof(CONADefinitions.CONAPI_FOLDER_INFO));
if (FolderInfo.pstrName[0].ToString() != "C" && level == 0) 
{
  ulong FreeBytesAvailable;
  ulong TotalNumberOfBytes;
  ulong TotalNumberOfFreeBytes;

  GetDiskFreeSpaceEx("C:\\", out FreeBytesAvailable, out TotalNumberOfBytes,out TotalNumberOfFreeBytes);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T16:57:33.867

您的原始代码真的很混乱，您可以在[这里使用上一个问题原始问题](https://stackoverflow.com/questions/409069/getting-the-size-free-total-of-a-windows-mobile-phone-drive-using-c-not-solve)链接的原始代码。事实上，您不应该首先提出另一个问题，而应该在原件中添加评论，要求进一步澄清。

您有一个 P/Invoke 定义。这只是一个静态方法调用。你把它放在一个班级里。像这样的东西：

```
public class MyClass
{
  [DllImport("coredll.dll", SetLastError=true, CharSet=CharSet.Auto)]
  [return: MarshalAs(UnmanagedType.Bool)]
  internal static extern bool GetDiskFreeSpaceEx(string lpDirectoryName,
    out ulong lpFreeBytesAvailable,
    out ulong lpTotalNumberOfBytes,
    out ulong lpTotalNumberOfFreeBytes);
} 
```

然后你调用它（不知道你想用你的所有编组的东西做什么）：

```
ulong GetDiskSize(string volumeName)
{
  ulong avail;
  ulong total;
  ulong totalfree;

  MyClass.GetDiskFreeSpaceEx(volumeName, out avail, out total, out totalFree);

  return total;
  // return others as desired
} 
```

然后使用它是这样的：

```
ulong diskSize = GetDiskSize("\\Storage Card"); 
```

# javascript - Javascript 的执行顺序 - 它是怎么做到的？

> ID：409296
> 
> 赞同：1
> 
> 时间：2009-01-03T16:21:38.947
> 
> 标签：javascript, jquery

我很困惑为什么 Javascript 会以这种方式做某些事情，或者我可能编码错误。但是 $.getJSON 之后的代码怎么会在回调完成之前被执行呢？

```
window.ratingCallback = function(data){

     if(data[0].code == 3){  
         ratingHTML = buildHTML(0);
         console.log('a'+ratingHTML);
         return;
     }

     ratingHTML = buildHTML(data[0].rating);
     console.log('b'+ratingHTML);
     return;
 };

  function buildHTML(pageRating){

     for(counter = 1; counter <= 5; counter++){

         if(counter == pageRating){
                 ratingHTML += '<input name="star1" type="radio" class="star" value="'+counter+'" checked="checked"/>';
         } else {
                 ratingHTML += '<input name="star1" type="radio" class="star" value="'+counter+'"/>';    
         }
     }

     return ratingHTML;
 }

$.getJSON("https://domain.com/"+data+"?jsoncallback=?");

console.log(ratingHTML+"WHY DOES THIS EXECUTE FIRST AND NOT AFTER THE CALLBACK SINCE IT IS PLACED AFTER getJSON????"); 
```

我希望这有所不同的原因是我需要 ratingHTML 作为全局变量。

我知道当远程服务器给出响应时会调用回调，但是我可以让脚本的其余部分等待进一步执行吗？没有将所有代码放在回调函数或任何函数中？

非常感谢！

冰

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-03T16:25:20.657

getJSON() 调用是异步的。

[它甚至在文档（ http://docs.jquery.com/Ajax/jQuery.getJSON](http://docs.jquery.com/Ajax/jQuery.getJSON) ）中提到：

> 注意：请记住，此函数之后的行将在回调之前执行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-03T16:26:39.310

getJSON 是一种异步方法，基本上意味着当您调用它时，它会立即返回主程序流程。所以它是“非阻塞的”。如果您希望它在 getJSON 完成后记录，您应该将您的 console.log 放入回调方法中。或者，如果您不想遵循回调模式并且希望您的调用是同步的，请使用 ajax 调用并将 async 选项设置为 false。但请注意，这将导致浏览器阻塞，或者在获取数据时似乎被冻结。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-03T16:27:23.863

AJAX 请求通常是异步完成的（AJAX 中的第一个 A）。这意味着请求将开始，然后它将继续执行它正在执行的代码，而无需等待请求返回。

如果您希望它等待，您可以将请求设置为同步模式，但我不确定如何在 jquery 中执行此操作。

# gcc - 如何使用 gcc 进行矢量化？

> ID：409300
> 
> 赞同：20
> 
> 时间：2009-01-03T16:22:31.270
> 
> 标签：gcc, compiler-optimization, simd, auto-vectorization, vector-processing

v4 系列编译器可以使用一些现代 CPU 上的[SIMD](http://en.wikipedia.org/wiki/SIMD)`gcc`处理器自动矢量化循环，例如 AMD Athlon 或 Intel Pentium/Core 芯片。这是怎么做到的？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-03T16:24:39.503

原始页面提供了有关让 gcc 自动矢量化循环的详细信息，包括一些示例：

[http://gcc.gnu.org/projects/tree-ssa/vectorization.html](http://gcc.gnu.org/projects/tree-ssa/vectorization.html)

虽然这些示例很棒，但事实证明，使用最新 GCC 调用这些选项的语法似乎发生了一些变化，现在看：

*   [https://gcc.gnu.org/onlinedocs/gcc/Developer-Options.html#index-fopt-info](https://gcc.gnu.org/onlinedocs/gcc/Developer-Options.html#index-fopt-info)

总之，以下选项将适用于具有 SSE2 的 x86 芯片，给出已矢量化的循环日志：

```
gcc -O2 -ftree-vectorize -msse2 -mfpmath=sse -ftree-vectorizer-verbose=5 
```

请注意，-msse 也是一种可能，但它只会使用浮点数对循环进行矢量化，而不是双精度数或整数。（SSE2 是 x86-64 的基线。也适用于 32 位代码`-mfpmath=sse`。这是 64 位的默认设置，但不是 32 位。）

* * *

**现代版本的 GCC 启用`-ftree-vectorize`，`-O3`所以只需在 GCC4.x 及更高版本中使用它**：

```
gcc   -O3 -msse2 -mfpmath=sse  -ftree-vectorizer-verbose=5 
```

（Clang 启用自动矢量化`-O2`。ICC 默认启用优化 + 快速数学。）

* * *

以下大部分内容是由彼得·科德斯（Peter Cordes）撰写的，他本可以写一个新的答案。随着时间的推移，随着编译器的变化，选项和编译器输出也会发生变化。我不完全确定是否值得在这里详细跟踪它。评论？ - 作者

要同时使用您正在编译的硬件支持的指令集扩展并对其进行调整，请使用`-march=native`.

归约循环（如数组的总和）将需要 OpenMP 或`-ffast-math`将 FP 数学视为关联和矢量化。 [Godbolt 编译器资源管理器上的示例，`-O3 -march=native -ffast-math`](https://godbolt.org/z/Z7ApPy)其中包含一个没有`-ffast-math`. （好吧，GCC8 及更高版本执行 SIMD 加载，然后将其解压缩为标量元素，这与简单展开相比毫无意义。一个`addss`依赖链延迟的循环瓶颈。）

有时你不需要`-ffast-math`，只是可以帮助 gcc 内联数学函数并对涉及和/或/的`-fno-math-errno`东西进行矢量化。`sqrt``rint``nearbyint`

其他有用的选项包括`-flto`（用于跨文件内联、常量传播等的链接时间优化）和/或`-fprofile-generate`使用实际输入的测试运行的配置文件引导优化/ `-fprofile-use`。PGO 为“热”循环启用循环展开；在现代 GCC 中，即使在 -O3 时也默认关闭。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-11-03T12:10:05.090

有一个 gimple（GCC 的中间表示） pass `pass_vectorize`。此通道将在 gimple 级别启用自动矢量化。

为了启用自动矢量化（GCC V4.4.0），我们需要执行以下步骤：

1.  根据目标架构提及向量中的单词数。这可以通过定义宏来完成`UNITS_PER_SIMD_WORD`。
2.  可能的矢量模式通常需要在单独的文件中定义`<target>-modes.def`。该文件必须位于包含机器描述的其他文件所在的目录中。（根据配置脚本。如果您可以更改脚本，您可以将文件放在您希望它所在的任何目录中）。
3.  根据目标体系结构要考虑用于矢量化的模式。例如，4 个字将构成一个向量，或者 8 个半字将构成一个向量，或者两个双字将构成一个向量。这个细节需要在`<target>-modes.def`文件中提及。例如：

    `VECTOR_MODES (INT, 8);     /*       V8QI V4HI V2SI */
    VECTOR_MODES (INT, 16);    /* V16QI V8HI V4SI V2DI */
    VECTOR_MODES (FLOAT, 8);   /*            V4HF V2SF */`
4.  建造港口。可以使用命令行选项启用矢量化`-O2 -ftree-vectorize`。

# gcc - 除了 gcc 还有哪些编译器可以向量化代码？

> ID：409309
> 
> 赞同：4
> 
> 时间：2009-01-03T16:27:35.627
> 
> 标签：gcc, compiler-construction, loops, simd, vector-processing

当指定某些选项并给出正确的条件时，GCC 可以自动[矢量化循环。](ftp://gcc.gnu.org/pub/gcc/summit/2004/Autovectorization.pdf)是否有其他广泛可用的编译器可以做同样的事情？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-03T17:10:58.690

[国际商会](http://www.intel.com/cd/software/products/asmo-na/eng/277618.htm)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-04T10:01:11.273

[llvm](http://www.llvm.org/)也可以做到这一点，[vector pascal](http://www.dcs.gla.ac.uk/~wpc/reports/compilers/compilerindex/x25.html)也可以，而且不是免费[的 VectorC](http://www.codeplay.com/technology/vectorc.html)。这些只是我记得的一些。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T02:14:41.203

[Mono](http://www.mono-project.com/)项目是微软 Silverlight 项目的开源替代品，它添加了使用 SIMD 指令的对象。虽然不是编译器，但 Mono CLR 是第一个在本地[生成向量操作的托管代码系统。](http://tirania.org/blog/archive/2008/Nov-03.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-11T21:33:20.320

IBM 的 xlc 也可以在一定程度上自动矢量化 C 和 C++。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-12T04:49:13.403

还有[PGI 的编译器](http://www.pgroup.com/products/workpgi.htm)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-03-11T21:14:50.620

尽管这是一个旧线程，但我会添加到此列表中 - [Visual Studio 11](http://msdn.microsoft.com/en-us/library/hh409293%28v=vs.110%29.aspx "视觉工作室 11")也将​​具有自动矢量化功能。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-03T15:14:34.710

[VectorC](http://www.codeplay.com)也可以做到这一点。您还可以指定所有目标 CPU，以便它利用不同的指令集（例如 MMX、SIMD、SIMD2...）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-08-21T09:33:30.307

Visual C++ (I'm using VS2005) can be forced to use SSE instructions. It seems not to be as good as Intel's compiler, but if someone already uses VC++, there's no reason not to turn this option on.

Go to project's properties, Configuration properties, C/C++, Code Generation: Enable Enhanced Instruction Set. Set "Streaming SIMD Instructios" or "Streaming SIMD Instructios 2". You will have to set floating point model to fast. Some other options will have to be changed too, but compiler will tell you about that.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-12T04:19:29.953

实际上，在很多情况下，GCC 过去在自动代码矢量化方面比 ICC 差很多，我不知道它最近是否改进得足够，但我对此表示怀疑。

# cloud - 购买集群/网格/云时间？

> ID：409311
> 
> 赞同：3
> 
> 时间：2009-01-03T16:28:40.103
> 
> 标签：cloud, cluster-computing, grid-computing

我在工业和学术环境中使用过集群，但它们归我工作的组织所有。我从来没有从一家销售集群/云/网格时间的公司购买时间。

假设我想运行一些计算密集型程序，例如大型模拟或数据挖掘应用程序。或者，也许我想通过在外包基础设施上运行分布式构建来优化大型产品套件的完整构建。**我在哪里可以购买集群时间来运行这些程序？**

我有兴趣了解运行 Linux、BSD、Mac OS X 和 Windows 等流行操作系统平台的集群。

显然，现在有使用快速、廉价硬件的构建你自己的集群解决方案，但我对外包解决方案特别感兴趣。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-03T16:38:51.267

您可能想查看 Amazon 的 EC2 服务：

[http://aws.amazon.com/ec2/](http://aws.amazon.com/ec2/)

有些人已经在 EC2 集群方面做了一些工作：

[http://www.google.com/search?q=cluster+computing+amazon+ec2&rls=com.microsoft:*&ie=UTF-8&oe=UTF-8&startIndex=&startPage=1](http://www.google.com/search?q=cluster+computing+amazon+ec2&rls=com.microsoft:*&ie=UTF-8&oe=UTF-8&startIndex=&startPage=1)

此外，微软还提供了[Windows Azure](http://www.microsoft.com/windowsazure/windowsazure/)，它具有 .NET 的本机钩子，允许您运行任何东西（Java、php），因为您能够从存储加载运行时和代码（或与您的应用程序一起部署，但有它自己的一组优点/缺点）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T16:33:21.870

该网站目前正在更新，但我知道 Sun 运营这样的服务[http://www.network.com/](http://www.network.com/)，我已经有一段时间没有查看它了，但如果我没记错的话，它的价格相当不错，有很多选择.
我目前正在为我的最后一年大学项目使用一个集群，它有 496 个核心，幸运的是不需要付费使用它:)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-03T16:42:09.997

亚马逊的[弹性计算云](http://aws.amazon.com/ec2/)非常有趣。您为所使用的（内存、CPU、持久存储）许多操作系统选项付费。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-09T15:51:14.380

我目前对Microsoft（将于今年发布）具有 .NET 支持的**[Azure](http://www.microsoft.com/azure/default.mspx)云计算技术非常感兴趣。**

此外还有：

*   **[Google App Engine](http://code.google.com/appengine/)** - Google 的 Python 框架
*   **[云 vService](http://www.vmware.com/technology/virtual-datacenter-os/cloud-vservices/)** - 由 VMWare 提供
*   **[亚马逊网络服务](http://aws.amazon.com/)**

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-14T09:35:47.983

有一项名为[Amazon Elastic MapReduce](http://aws.amazon.com/elasticmapreduce/)的新服务在 EC2 集群之上运行。它具有许多编程语言的 API，包括 Ruby 和 PHP。此外，如果您需要更成熟的服务，请查看[GreenPlum](http://www.greenplum.com/)

# php - MySQL简单论坛

> ID：409321
> 
> 赞同：1
> 
> 时间：2009-01-03T16:35:06.673
> 
> 标签：php, sql, mysql, forum

所以我正在尝试建立一个简单的论坛。它将是按主题（如果没有回复）或最新回复的日期降序排列的主题列表。这是数据库结构：

**论坛主题**

> ID、姓名、电子邮件、正文、日期

**论坛回复**

> id、电子邮件、正文、日期、topic_id

论坛本身将包含一个带有以下标题的 HTML 表格：

> 主题，上次修改，# 回复

生成这样一个结构的查询会是什么样子？我在想它会涉及交叉连接，但不确定......在此先感谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-03T16:50:25.910

有点像这样：

```
select * from forum_topic
inner join forum_reply on forum_topic.id=topc_id 
```

但是，不要使用`select *`

这是不好的做法:)

而且我不喜欢你避免标准化的方式！意思是我宁愿：

**用户**

*   用户身份
*   姓名
*   电子邮件

**线程**

*   线程ID
*   学科
*   已回答
*   AskedByUserID
*   日期

**回复**

*   回复ID
*   线程ID
*   用户身份
*   回答
*   日期

然后像这样选择一个线程：

```
select ThreadID, Subject, Answered, AksedByUserID, Date from Threads 
```

并选择所有这样的回复

```
select Answer, Date, Name, Email from Threads
inner join Replies on Threads,ThreaID=Replies.ThreadID
inner join Users on AskedByUserID=UserID 
where Threads.ThreadID=xxx 
```

现在这只是从我的脑海中写出来的，但您可能还需要添加一些分组依据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T16:50:57.483

是的，您应该能够通过如下查询获得它：

```
SELECT 
  forum_topic.id, 
  forum_topic.name AS Topic,  
  MAX(forum_reply.date) AS Last_Modified, 
  count(*) AS  Replies
FROM forum_topic 
INNER JOIN forum_reply ON (forum_topic.id=forum_reply.topic_id)
GROUP BY forum_topic.id 
```

“分组依据”是每个主题为我们提供一行的魔力，[MAX()](http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_max)和[COUNT()](http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_count)函数为我们提供所需的聚合数据。

*（编辑：我错过了第一篇文章的正文在主题表中，因此上述查询会错过没有回复的帖子。Filip 有正确的想法，建议您对数据进行规范化。一旦规范化，类似于上述的查询会给你你需要的数据）。*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T20:39:58.410

首先，在我看来，实际上没有人回答您的问题，即：

> 生成这样一个结构的查询会是什么样子？

具有要求的结构

主题，LastModified，# 回复。

给定您提供的表结构，生成具有该结构的结果表的 SQL 将是：

```
SELECT t.Id, t.Name AS Topic, 
       MAX(r.Date) AS LastModified, 
       COUNT(*) AS NumReplies
FROM Forum_Topic t
LEFT OUTER JOIN Forum_Reply r ON t.id = r.topic_id
GROUP BY t.Id, t.Name 
```

（抱歉，这仅在 SQL Server 上进行了测试，因为我目前无法访问 MySql）

此外，您的结构**已经**标准化。相反的建议是对您想要做什么做出假设，例如，假设您对跟踪用户名以及*电子邮件*地址感兴趣。这是非常合理的，但仍然是一个假设。从规范化的角度来看，使用电子邮件地址作为唯一的用户标识符并没有错。

现在，如果您正在寻找有关如何设置数据库的一般建议，我们可以为您提供很多建议。在规范化之前，我会先不使用潜在的关键字作为对象名称（例如，不要给列名称，如“名称”和“日期”）。

关于 Matt 在没有回复时关于值为 NULL 的评论：使用 COALESCE() 函数将解决该问题。COALESCE() 返回第一个非 NULL 参数（如果所有参数都为 NULL，则返回 NULL）。因此，将 MAX(r.Date) 替换为 MAX(COALESCE(r.Date, t.Date))。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T17:19:22.373

所谓“规范化”，是指去掉“forum_topic”的body栏目，真正的topic body应该是第一个回复？

# file - 检查文件是否从另一个进程打开

> ID：409325
> 
> 赞同：3
> 
> 时间：2009-01-03T16:36:35.920
> 
> 标签：file, process, io, powerbuilder

如何检查文件是否已被 Powerscript 中的另一个进程使用？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-04T21:10:38.037

我发现最好的方法是调用 WinAPI CreateFile 以独占模式打开给定文件。

首先，声明如下局部外部函数（PB10）

```
FUNCTION Long CreateFile(ref string lpszName, long fdwAccess, long fdwShareMode, long lpsa, &
long fdwCreate, long fdwAttrsAndFlags, long hTemplateFile) LIBRARY "Kernel32.dll" &
ALIAS FOR "CreateFileA;Ansi"
FUNCTION boolean CloseHandle (long file_hand) LIBRARY "KERNEL32.DLL" 
```

然后从 Powerscript ：

```
CONSTANT ulong GENERIC_ACCESS = 268435456  //  &H10000000
CONSTANT ulong EXCLUSIVE_ACCESS = 0
CONSTANT ulong OPEN_EXISTING = 3

long ll_handle
String ls_file 

ls_file = "c:\temp\myfile.xls"

ll_handle = CreateFile ( ls_file, GENERIC_ACCESS, EXCLUSIVE_ACCESS,  0, OPEN_EXISTING, 0, 0) 
IF ll_handle < 1 THEN 
    MessageBox("", "Can't open, maybe missing or already opened ?!?")
ELSE
    MessageBox("","File can be opened")
END IF

CloseHandle(ll_handle) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-04T01:17:37.553

您可以尝试打开它，如果它出错，那么它可能已经被锁定。

# gcc - 自动矢量化的实际使用？

> ID：409329
> 
> 赞同：4
> 
> 时间：2009-01-03T16:38:08.897
> 
> 标签：gcc, loops, simd, vector-processing

有没有人利用 gcc 可以做的自动矢量化？在现实世界中（与示例代码相反）？是否需要重组现有代码才能利用？在任何生产代码中是否有大量可以通过这种方式矢量化的案例？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-10-20T19:47:13.213

我还没有看到 GCC 或 Intel C++ 自动矢量化除了非常简单的循环之外的任何东西，即使给定可以（并且在我使用 SSE 内在函数手动重写它们之后）可以矢量化的算法代码。

这部分是保守的——尤其是在面对可能的指针别名时，C/C++ 编译器很难向自己“证明”向量化是安全的，即使作为程序员的你知道它是安全的。大多数编译器（明智地）宁愿不优化代码，也不愿冒错误编译的风险。至少在理论上，这是高级语言比 C 具有真正优势的一个领域（我说理论上是因为我实际上并不知道任何自动矢量化 ML 或 Haskell 编译器）。

另一部分只是分析限制——据我所知，向量化的大多数研究都与优化经典数值问题（比如流体动力学）有关，这是几年前大多数向量机的基础（当时，在 CUDA /OpenCL、Altivec/SSE 和 STI Cell，各种形式的矢量编程在商业系统中变得广泛可用）。

考虑到为标量处理器编写的代码对于编译器来说很容易向量化是不太可能的。令人高兴的是，您可以做很多事情来使编译器更容易理解如何对其进行矢量化，例如循环平铺和部分循环展开，即使编译器不知道如何处理，也（倾向于）提高现代处理器的性能向量化它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-04T07:31:03.167

它很难在任何业务逻辑中使用，但是当您以相同的方式处理大量数据时会加快速度。

很好的例子是声音/视频处理，您对每个样本/像素应用相同的操作。我为此使用了 VisualDSP，您必须在编译后检查结果——如果它真的用在了它应该使用的地方。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-05T01:53:17.810

矢量化将主要用于数值程序。矢量化程序可以在矢量处理器上运行得更快，例如 PS3 游戏机中使用的 STI 单元处理器。在那里，用于渲染游戏图形的数值计算可以通过矢量化大大加快。这种处理器称为 SIMD（单指令多数据）处理器。

在其他处理器上不会使用矢量化。矢量化程序在不适用于非 SIMD 处理器的矢量化指令集上运行。

英特尔的 Nehalem 系列处理器（2008 年底发布）实现 SSE 4.2 指令，即 SIMD 指令。来源：[维基百科](http://en.wikipedia.org/wiki/Nehalem_(microarchitecture))。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T05:47:49.063

矢量化指令不仅限于 Cell 处理器——大多数现代工作站之类的 CPU 都有它们（PPC、x86 自 pentium 3、Sparc 等）。当用于浮点运算时，它可以为计算密集型任务（过滤器等）提供很大帮助。根据我的经验，自动矢量化效果并不好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-31T06:12:34.007

您可能已经注意到，实际上几乎没有人知道如何充分利用 GCC 的自动矢量化。如果你在网上搜索人们的评论，总是会想到 GCC 允许你启用自动矢量化，但它很少实际使用它，所以如果你想使用 SIMD 加速（例如：MMX， SSE、AVX、NEON、AltiVec），那么您基本上必须弄清楚如何使用编译器内在函数或汇编语言代码来编写它。

但是内在函数的问题在于，您实际上需要了解它的汇编语言方面，然后还要学习描述您想要的内容的内在方法，这可能会导致代码效率低于您使用汇编代码编写的代码（例如 10 倍），因为编译器仍然难以充分利用您的内在指令！

例如，您可能正在使用 SIMD Intrinsics，以便可以同时并行执行许多操作，但是您的编译器可能会生成汇编代码，在 SIMD 寄存器和普通 CPU 寄存器之间来回传输数据，从而有效地使您的SIMD 代码的运行速度与普通代码相似（甚至更慢）！

所以基本上：

*   如果您想要高达 100% 的加速（2 倍速度），那么要么购买官方的 Intel/ARM 编译器，要么将您的一些代码转换为使用 SIMD C/C++ Intrinsics。
*   如果您想要 1000% 的加速（10 倍速度），请使用 SIMD 指令手动将其编写为汇编代码。或者，如果在您的硬件上可用，请改用 GPU 加速，例如 OpenCL 或 Nvidia 的 CUDA SDK，因为它们可以在 GPU 中提供与 SIMD 在 CPU 中类似的加速。

# web-services - 最佳 SOAP/REST/RPC Web API 的示例？你为什么喜欢他们？他们有什么问题？

> ID：409338
> 
> 赞同：48
> 
> 时间：2009-01-03T16:46:04.513
> 
> 标签：web-services, rest, soap, rpc

在我的公司，我们开始涉足 Web API 以访问和更新我们的数据；最初是为合作伙伴提供的，但将来可能会向公众提供。目前 API 的外观（例如 SOAP、REST、RPC）是完全开放的，我们还没有做出任何决定，所以我对人们认为好的 Web API 的两个示例以及您认为的原因很感兴趣那。

我感兴趣的是来自使用不同语言的人的意见（我们可能会向使用多种平台的人提供 API，特别是包括 .NET、Java、ActionScript 和 JavaScript）关于您认为好的 Web API例子，你有很好的经验。

我想介绍的几点：

1.  你更喜欢 SOAP 类型的服务还是 REST/RPC 风格的服务？我怀疑有平台支持（例如.NET、Java）的人会更喜欢SOAP，而使用没有平台支持的语言的人会更喜欢其他人，但我想验证这个假设。

2.  您是否关心 API 是否实际上是 RESTful 或是否是普通的旧 RPC 样式 HTTP GET/POST？如果是这样，你为什么在乎？一个 API 是否正确地描述自己（即如果它是 RPC 风格就不要声称是 RESTful）比它是否实际上是两者之一更重要？

3.  我们需要验证谁在使用该服务。我一直在研究 Amazon S3 身份验证，它使用公共标识符和私有令牌，用于将请求的参数散列为验证令牌（这也类似于 flickr）。您以前是否使用过这种类型的身份验证，您是如何使用它的？是否有任何您发现有问题的哈希算法（即您的平台不支持）？您希望在 HTTP 标头中还是在 URI 中发送散列？

4.  应该如何处理版本控制？拥有一个类型子目录是一个好主意，`/v1/`以便可以在旁边添加未来的版本，还是你会做一些不同的事情，比如在请求有效负载或查询中使用版本？您期望支持您构建的 API 版本多长时间（即，如果引入 v2，您对 v1 生命周期的期望是多少）。

此外，任何其他意见和要点都会很有用。

我故意对我们正在实现的 API 的实际类型保持模糊，因为我正在寻找关于人们认为好的 API 和实现机制的一般指导，所以这篇文章及其答案将对更多人有用在将来。

* * *

*注意：我已经搜索并找不到关于此的通用问题 - 它们似乎都特定于某种类型的 API - 但如果它是重复的，请告诉我。另外，如果它应该是社区 wiki（我认为人们应该得到答案，所以我没有做到这一点），那么请告诉我，我会改变它。*

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-06T10:35:59.377

这是我的看法。

1.  尽管从 Java 的角度来看，我实际上更喜欢 REST。具有多个名称空间的 SOAP 信封及其复杂的结构令人厌恶。它试图解决大多数想象中的问题，但不能有效地解决任何问题。我发现 SOAP 唯一有用的是它具有授权和错误标准。另一方面，通过在根 XML 元素中包含四个标准属性（用户名、密码、errorCode、errorDescription）可以更轻松地解决这两个问题。

2.  好的 API 描述和文档确实是最重要的。成熟框架中 REST 和 SOAP 的区别主要在于几行配置。

3.  对于 SOAP，发送散列作为 SOAP 安全性的一部分；对于 REST，我喜欢将所有内容打包在有效负载中，并避免使用 HTTP 标头进行身份验证。不过，我只有主观原因，因为我不得不与那些不容易暴露 HTTP 标头的框架作斗争。

4.  我个人的偏好是为不同的协议版本使用不同的 URI。根据我的经验，这为您在较新版本中提供了更大的灵活性，并且连接到不受支持的协议版本的旧客户端由于显而易见的原因而立即停止工作。此外，有时您可以将旧版本的应用程序映射到旧的 URI，以避免在新的服务器版本中有旧的支持代码。

    至于您支持旧版本协议的时间......理想情况下，只要您有使用它的客户端。这比技术决策更重要。您应该至少支持一个以前的协议版本。将客户推向新版本以降低遗留支持成本通常符合您的利益；从客户端来看，新版本应该意味着新功能、更好的协议和某种额外的业务激励（如果仅新功能还不够的话）。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-06T07:27:05.047

您可能对 Joshua Bloch 的演讲“如何设计一个好的 API 及其重要性”感兴趣。Joshua Bloch 是“Effective Java”一书的作者，也是 Google 的首席软件工程师和首席 Java 架构师。

摘要：[http ://portal.acm.org/citation.cfm?id=1176622](http://portal.acm.org/citation.cfm?id=1176622)

幻灯片： http: [//lcsd05.cs.tamu.edu/slides/keynote.pdf](http://lcsd05.cs.tamu.edu/slides/keynote.pdf)

视频：[http ://www.youtube.com/watch?v=aAb7hSCtvGw](http://www.youtube.com/watch?v=aAb7hSCtvGw)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-04T12:18:46.707

使用 Content-Type 标头的 REST 版本控制在这里很好地介绍了：http: [//barelyenough.org/blog/2008/05/versioning-rest-web-services/](http://barelyenough.org/blog/2008/05/versioning-rest-web-services/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-05T13:30:56.777

我会看看亚马逊在做什么 - [http://aws.amazon.com/](http://aws.amazon.com/) - 从这些东西上赚钱的人显然会比其他人学到更多的教训。

我会看的其他 API - salesforce.com 和 Microsoft 的 CRM api 相当有趣。Twitter 也有一个久经沙场的 REST api。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-09-02T06:58:41.313

RPC 方法也是一个不错的选择。它减少了开销，Ice、Google Protocol Buffers 和 Apache Thrift 等项目使开发基于 RPC 的服务变得更容易。

如果您不必提供基于 Web 的 API，那么 RPC 也可以是您想要探索的选择。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-03T22:12:41.517

恕我直言，这完全取决于您提供的应用程序类型。如果您正在做重要的、大型的交易，那么一定要使用 SOAP（他们称之为 WS “死星”）。但是，如果您提供社交应用程序，那么请使用 REST，因为它更简单，更适合公共黑客攻击。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-05T15:19:53.283

REST，如果做得正确，很容易理解（模型 HTTP），直接（面向资源）并且可以被几乎所有的编程语言 (XML) 解析。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-04T12:49:04.197

如果您最终无法下定决心，则可以全部实施。在这些情况下，看看其他人是如何做到的很有用。我向您推荐 Open Source XML Native Database [eXist](http://exist.sourceforge.net/)，它提供了您正在研究**的三种类型的接口。**

# agile - 是否可以在 SCRUM 流程中担任多个角色

> ID：409342
> 
> 赞同：6
> 
> 时间：2009-01-03T16:48:38.267
> 
> 标签：agile, scrum

您认为一个人在想要使用 SCRUM 的软件开发公司中担任多个角色是否可行？

例如，如果一个人是

*   SCRUM 大师和团队成员
*   产品负责人和团队成员
*   SCRUM 主管和产品负责人

你认为哪些组合是可能的？你在这样的团队工作吗？如果一个人有多个角色，应该考虑什么？

感谢您的任何提示。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-03T17:01:12.207

我们所有的 Scrum-master 都是参与的团队成员，我认为这很好。这个过程很好地处理了生产力的差异。

我真的认为产品负责人应该是外部的，但我只是认为团队应该与产品负责人保持一定的距离。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-03T16:59:29.633

产品负责人不应是开发人员或项目管理角色；关键是要有一个可以接受结果并且是主题专家的人。如果你让他们成为团队成员，你又要让产品开发人员定义产品；这是一件坏事。如果你让他们成为 SCRUM 主管，首先，他们可能没有 SCRUM 主管需要了解问题和评估的开发背景，其次，他们控制了 SCRUM 主管应该充当的确切流程和产品平衡。

SCRUM 大师当然可以承担一些团队成员的职责，尤其是在一个小团队中。然而，在大多数情况下，随着团队规模超过 3-4 人，SCRUM 大师将没有大量时间进行常规开发工作。

[更新：“SCUM”掌握一个非常不便的错字。]

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T17:00:26.747

搜索[scrumdiscussion 列表的档案。](http://groups.yahoo.com/group/scrumdevelopment/msearch?query=combining+roles&submit=Search&charset=ISO-8859-1)这在过去已经被广泛讨论过。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-03T17:39:11.317

我们的 SCRUM 大师和产品所有者是同一个人，但他是一个独特的人，当他戴着他的 SCRUM 大师帽（或本例中的空手道小子头带）时，他知道他不是产品所有者，反之亦然。

哦，是的，我绝对推荐 SCRUM 大师的空手道小子头带。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-09T00:19:18.607

感谢您的所有回答。我不能选择其中一个作为接受的答案，因为它们都很有价值。因此，我接受此答案以从我的个人资料页面中删除提醒。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-02-18T22:25:24.787

在“理想的 Scrum 情况”中，您不会共享角色。

`Scrum master and team member`
有时，在他们需要完成任务和需要消除团队成员报告的障碍之间存在利益冲突。在他们的每个角色中，他们都“承诺”在冲刺结束之前完成他们的角色——哪个应该优先？然而，实际上这可能是最常见的角色配对

`Product owner and team member`
你真的不应该让同一个人接受完成和完成的工作并实际完成工作。这应该只发生在单人公司中，在这种情况下，您可能会质疑首先使用 Scrum 的想法

`Scrum master and product owner`
我再次看到，想要完成已承诺的 sprint 的 Scrum master 与需要接受 sprint 已被接受的产品所有者之间存在潜在的利益冲突。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-02-19T11:21:08.563

Scrum 有意拆分传统的项目管理职责，以防范传统的项目管理陷阱，包括压力和微观管理。根据定义，Scrum Master 没有权力，而 Product Owner 有权力，所以如果我们将这两者结合为一个人，我们应该诚实地称那个人为常规项目经理（也许具有一些敏捷技能）。

其他组合（PO 是团队成员，SM 是团队成员）也有缺点，但危害较小。

# c++ - 迭代 std::vector：无符号与有符号索引变量

> ID：409348
> 
> 赞同：488
> 
> 时间：2009-01-03T16:52:24.593
> 
> 标签：c++, stl, unsigned, signed

在 C++ 中迭代向量的正确方法是什么？

考虑这两个代码片段，这个工作正常：

```
for (unsigned i=0; i < polygon.size(); i++) {
    sum += polygon[i];
} 
```

和这个：

```
for (int i=0; i < polygon.size(); i++) {
    sum += polygon[i];
} 
```

生成`warning: comparison between signed and unsigned integer expressions`.

我是 C++ 领域的新手，所以这个`unsigned`变量对我来说看起来有点吓人，我知道`unsigned`如果使用不当，变量会很危险，所以 - 这是正确的吗？

* * *

## 回答 #1

> 赞同：854
> 
> 时间：2009-01-03T17:17:48.927

要向后迭代，请参阅[此答案](https://stackoverflow.com/questions/275994/whats-the-best-way-to-do-a-backwards-loop-in-c-c-c#276053)。

向前迭代几乎是相同的。只需按增量更改迭代器/交换减量。您应该更喜欢迭代器。有人告诉你使用`std::size_t`作为索引的变量类型。但是，这不是便携式的。始终使用`size_type`容器的 typedef（虽然您可以在前向迭代情况下只进行转换，但在使用 时，它实际上可能在反向迭代情况下一直出错`std::size_t`，以防万一`std::size_t`比 typedef 的类型更宽`size_type`） ：

* * *

# 使用 std::vector

## 使用迭代器

```
for(std::vector<T>::iterator it = v.begin(); it != v.end(); ++it) {
    /* std::cout << *it; ... */
} 
```

重要的是，对于您不知道其定义的迭代器，始终使用前缀增量形式。这将确保您的代码尽可能通用。

### 使用范围 C++11

```
for(auto const& value: a) {
     /* std::cout << value; ... */ 
```

### 使用索引

```
for(std::vector<int>::size_type i = 0; i != v.size(); i++) {
    /* std::cout << v[i]; ... */
} 
```

* * *

# 使用数组

## 使用迭代器

```
for(element_type* it = a; it != (a + (sizeof a / sizeof *a)); it++) {
    /* std::cout << *it; ... */
} 
```

### 使用范围 C++11

```
for(auto const& value: a) {
     /* std::cout << value; ... */ 
```

### 使用索引

```
for(std::size_t i = 0; i != (sizeof a / sizeof *a); i++) {
    /* std::cout << a[i]; ... */
} 
```

不过，请阅读向后迭代的答案，该`sizeof`方法可以解决什么问题。

* * *

## 回答 #2

> 赞同：178
> 
> 时间：2013-03-05T17:10:17.500

四年过去了，*谷歌*给了我这个答案。使用[标准*C++11*](http://en.wikipedia.org/wiki/C++11)（又名*C++0x*）实际上有一种新的令人愉快的方法（以破坏向后兼容性为代价）：new`auto`关键字。当很明显（对于编译器）要使用哪种类型时，它可以避免您必须显式指定要使用的迭代器的类型（再次重复向量类型）。作为`v`你的`vector`，你可以做这样的事情：

```
for ( auto i = v.begin(); i != v.end(); i++ ) {
    std::cout << *i << std::endl;
} 
```

*C++11*更进一步，为您提供了一种特殊的语法来迭代向量等集合。它消除了编写总是相同的东西的必要性：

```
for ( auto &i : v ) {
    std::cout << i << std::endl;
} 
```

要在工作程序中查看它，请构建一个文件`auto.cpp`：

```
#include <vector>
#include <iostream>

int main(void) {
    std::vector<int> v = std::vector<int>();
    v.push_back(17);
    v.push_back(12);
    v.push_back(23);
    v.push_back(42);
    for ( auto &i : v ) {
        std::cout << i << std::endl;
    }
    return 0;
} 
```

在写这篇文章时，当你用*g++*编译它时，你通常需要通过提供一个额外的标志来设置它以使用新标准：

```
g++ -std=c++0x -o auto auto.cpp 
```

现在您可以运行示例：

```
$ ./auto
17
12
23
42 
```

*请注意*，编译和运行的说明是特定于*Linux上的**gnu c++*编译器的，程序应该是平台（和编译器）独立的。

 ** * *

## 回答 #3

> 赞同：43
> 
> 时间：2009-01-03T18:03:29.803

在您的示例中的特定情况下，我将使用 STL 算法来完成此操作。

```
#include <numeric> 

sum = std::accumulate( polygon.begin(), polygon.end(), 0 ); 
```

对于更一般但仍然相当简单的情况，我会选择：

```
#include <boost/lambda/lambda.hpp>
#include <boost/lambda/bind.hpp>

using namespace boost::lambda;
std::for_each( polygon.begin(), polygon.end(), sum += _1 ); 
```

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2010-02-27T20:51:58.723

关于约翰内斯·绍布的回答：

```
for(std::vector<T*>::iterator it = v.begin(); it != v.end(); ++it) { 
...
} 
```

这可能适用于某些编译器，但不适用于 gcc。这里的问题是 std::vector::iterator 是类型、变量（成员）还是函数（方法）的问题。我们使用 gcc 得到以下错误：

```
In member function ‘void MyClass<T>::myMethod()’:
error: expected `;' before ‘it’
error: ‘it’ was not declared in this scope
In member function ‘void MyClass<T>::sort() [with T = MyClass]’:
instantiated from ‘void MyClass<T>::run() [with T = MyClass]’
instantiated from here
dependent-name ‘std::vector<T*,std::allocator<T*> >::iterator’ is parsed as a non-type, but instantiation yields a type
note: say ‘typename std::vector<T*,std::allocator<T*> >::iterator’ if a type is meant 
```

解决方案是使用关键字“typename”，如下所示：

```
typename std::vector<T*>::iterator it = v.begin();
for( ; it != v.end(); ++it) {
... 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2009-01-03T16:59:29.620

调用`vector<T>::size()`返回一个类型的值`std::vector<T>::size_type`，而不是 int、unsigned int 或其他。

通常在 C++ 中对容器的迭代也是使用*iterators*完成的，就像这样。

```
std::vector<T>::iterator i = polygon.begin();
std::vector<T>::iterator end = polygon.end();

for(; i != end; i++){
    sum += *i;
} 
```

其中 T 是您存储在向量中的数据类型。

或者使用不同的迭代算法（`std::transform`, `std::copy`, `std::fill`,`std::for_each`等等）。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2009-01-03T16:59:18.933

使用`size_t`：

```
for (size_t i=0; i < polygon.size(); i++) 
```

引用[维基百科](http://en.wikipedia.org/wiki/Stdlib.h)：

> stdlib.h 和 stddef.h 头文件定义了一个名为的数据类型`size_t`，用于表示对象的大小。采用 size 的库函数期望它们的类型为`size_t`，并且 sizeof 运算符的计算结果为`size_t`。
> 
> 的实际类型`size_t`取决于平台；一个常见的错误是假设`size_t`与 unsigned int 相同，这可能导致编程错误，尤其是在 64 位体系结构变得更加普遍的情况下。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-01-03T17:04:36.817

一点历史：

要表示一个数字是否为负数，计算机使用“符号”位。 `int`是有符号数据类型，意味着它可以保存正值和负值（大约 -20 亿到 20 亿）。 `Unsigned`只能存储正数（并且由于它不会在元数据上浪费一点点，它可以存储更多：0 到大约 40 亿）。

`std::vector::size()`返回一个`unsigned`，因为向量怎么可能有负长度？

警告告诉您，不等式语句的右操作数可以比左操作数容纳更多的数据。

本质上，如果您有一个包含超过 20 亿个条目的向量，并且您使用一个整数来索引，您将遇到溢出问题（int 将返回到负 20 亿）。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-01-03T17:23:31.350

我通常使用 BOOST_FOREACH：

```
#include <boost/foreach.hpp>

BOOST_FOREACH( vector_type::value_type& value, v ) {
    // do something with 'value'
} 
```

它适用于 STL 容器、数组、C 风格的字符串等。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2014-10-28T22:11:33.170

[完整地说，C++11 语法为迭代器（ ref](http://www.cplusplus.com/reference/iterator/begin/) ）启用了另一个版本：

```
for(auto it=std::begin(polygon); it!=std::end(polygon); ++it) {
  // do something with *it
} 
```

这对于反向迭代也很舒服

```
for(auto it=std::end(polygon)-1; it!=std::begin(polygon)-1; --it) {
  // do something with *it
} 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2014-11-12T07:56:44.403

# 在 C++11 中

我会使用通用算法`for_each`来避免搜索正确类型的迭代器和 lambda 表达式，以避免额外的命名函数/对象。

针对您的特定情况的简短“漂亮”示例（假设多边形是整数向量）：

```
for_each(polygon.begin(), polygon.end(), [&sum](int i){ sum += i; }); 
```

*测试：http: [//ideone.com/i6Ethd](http://ideone.com/i6Ethd)*

不要忘记**包括：**算法，当然还有向量 :)

微软实际上也有一个很好的例子：
*来源：http: [//msdn.microsoft.com/en-us/library/dd293608.aspx](http://msdn.microsoft.com/en-us/library/dd293608.aspx)*

```
#include <algorithm>
#include <iostream>
#include <vector>
using namespace std;

int main() 
{
   // Create a vector object that contains 10 elements.
   vector<int> v;
   for (int i = 1; i < 10; ++i) {
      v.push_back(i);
   }

   // Count the number of even numbers in the vector by 
   // using the for_each function and a lambda.
   int evenCount = 0;
   for_each(v.begin(), v.end(), [&evenCount] (int n) {
      cout << n;
      if (n % 2 == 0) {
         cout << " is even " << endl;
         ++evenCount;
      } else {
         cout << " is odd " << endl;
      }
   });

   // Print the count of even numbers to the console.
   cout << "There are " << evenCount 
        << " even numbers in the vector." << endl;
} 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-01-03T17:01:13.983

```
for (vector<int>::iterator it = polygon.begin(); it != polygon.end(); it++)
    sum += *it; 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-01-03T17:12:20.873

首先是类型正确，并且在某种严格意义上是正确的。（如果您考虑一下，大小永远不会小于零。）不过，这个警告让我觉得是被忽略的好人选之一。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-10-19T08:53:40.943

# 考虑是否需要迭代

`<algorithm>`标准标题为我们提供了以下功能：

```
using std::begin;  // allows argument-dependent lookup even
using std::end;    // if the container type is unknown here
auto sum = std::accumulate(begin(polygon), end(polygon), 0); 
```

算法库中的其他函数执行常见任务 - 如果您想节省自己的精力，请确保您知道可用的内容。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2018-01-31T20:11:43.627

晦涩但重要的细节：如果您按如下方式说“for(auto it)”，您将获得对象的副本，而不是实际元素：

```
struct Xs{int i} x;
x.i = 0;
vector <Xs> v;
v.push_back(x);
for(auto it : v)
    it.i = 1;         // doesn't change the element v[0] 
```

要修改向量的元素，需要将迭代器定义为引用：

```
for(auto &it : v) 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-03-25T18:46:09.590

如果您的编译器支持它，您可以使用基于范围的 for 来访问向量元素：

```
vector<float> vertices{ 1.0, 2.0, 3.0 };

for(float vertex: vertices){
    std::cout << vertex << " ";
} 
```

打印：1 2 3 。请注意，您不能使用此技术来更改向量的元素。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-05-29T11:19:54.487

这两个代码段的工作方式相同。但是，无符号整数“路线是正确的。使用无符号整数类型将更好地与您使用它的实例中的向量一起使用。在向量上调用 size() 成员函数会返回一个无符号整数值，因此您希望比较变量"i" 为其自身类型的值。

此外，如果您对代码中“unsigned int”的外观仍然有些不安，请尝试“uint”。这基本上是“unsigned int”的缩短版本，它的工作原理完全相同。您也不需要包含其他标题来使用它。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-05-16T15:26:02.250

添加这个因为我在任何答案中都找不到它：对于基于索引的迭代，我们可以使用`decltype(vec_name.size())`which 将评估为`std::vector<T>::size_type`

### 例子

```
for(decltype(v.size()) i{ 0 }; i < v.size(); i++) {
    /* std::cout << v[i]; ... */
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-07-07T12:04:18.277

```
auto polygonsize = polygon.size(), i=polygonsize;
for (i=0; i < polygonsize; i++) {
    sum += polygon[i];
} 
```

这

*   用于`auto`避免我们担心类型。
*   它需要任何函数调用，例如`size()`循环中的函数调用，以避免不必要的重复函数调用。
*   它使循环计数器可用。纯粹主义者会想在不知道 n 值的情况下使用第 n 个元素，并认为这很糟糕。
*   它似乎有一个不必要的语句`i=polygonsize`在声明循环变量时对其进行初始化，但如果有一个半体面的代码优化器，这应该会消失，并且只是为了确保`i`具有正确的类型。

我并不是说任何人都应该像我刚才那样编写任何东西。

我只是将它作为**另一种替代方案**来提供，它可以避免担心类型，将函数调用排除在循环之外，并使循环计数器可用于实际操作，例如在更复杂的场景中调试信息。

# php - $_POST 与 $_SERVER['REQUEST_METHOD'] == 'POST'

> ID：409351
> 
> 赞同：137
> 
> 时间：2009-01-03T16:56:23.387
> 
> 标签：php

有人称我的 Snipplr 提交之一为“废话”，因为我使用`if ($_SERVER['REQUEST_METHOD'] == 'POST')`了`if ($_POST)`

检查请求方法对我来说似乎更正确，因为那是我真正想做的。两者之间是否存在一些操作差异，或者这只是代码清晰度问题？

* * *

## 回答 #1

> 赞同：178
> 
> 时间：2009-01-03T17:27:11.577

嗯，他们不做同样的事情，真的。

`$_SERVER['REQUEST_METHOD']`包含请求方法（惊喜）。

`$_POST`包含任何帖子数据。

POST 请求可能不包含 POST 数据。

我检查了请求方法——实际上我从未想过要测试`$_POST`数组。不过，我检查了必填的帖子字段。所以一个空的发布请求会给用户很多错误信息——这对我来说很有意义。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-01-03T17:46:13.457

`if ($_SERVER['REQUEST_METHOD'] == 'POST')`是正确的方法，您可以在没有任何发布数据的情况下发送发布请求。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2010-03-22T13:15:56.507

我曾经检查过，`$_POST`直到遇到较大的 POST 数据和上传的文件时遇到问题。有配置指令`post_max_size`，并且`upload_max_filesize`- 如果超过任何一个，`$_POST`则不会填充数组。

所以“安全的方法”是检查`$_SERVER['REQUEST_METHOD']`。不过，您仍然必须`isset()`在每个`$_POST`变量上使用，无论您检查还是不检查`$_SERVER['REQUEST_METHOD']`.

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2013-06-11T23:39:58.553

如果您的应用程序需要对 post 类型的请求做出反应，请使用以下命令：

```
if(strtoupper($_SERVER['REQUEST_METHOD']) === 'POST') { // if form submitted with post method
    // validate request, 
    // manage post request differently, 
    // log or don't log request,
    // redirect to avoid resubmition on F5 etc
} 
```

如果您的应用程序需要对通过 post 请求收到的任何数据做出反应，请使用：

```
if(!empty($_POST)) {  // if received any post data
   // process $_POST values, 
   // save data to DB,
   // ... 
}

if(!empty($_FILES)) { // if received any "post" files
   // validate uploaded FILES
   // move to uploaded dir
   // ...
} 
```

它是特定于实现的，但是您将同时使用这两者，+ $_FILES 超全局。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-03T17:08:57.667

他们都是正确的。就我个人而言，我更喜欢你的方法，因为它的冗长，但这真的取决于个人喜好。

另一方面，运行**`if($_POST)`**不会引发错误 -**`$_POST`**无论请求是否带有`POST`标头发送，数组都存在。在布尔检查中将空数组强制转换为 false。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-08-07T16:44:41.147

在大多数浏览器中，您可以通过按回车键（即不单击提交按钮）提交表单，但这并不一定将提交作为变量发送 - 因此可以提交一个空表单，即为`$_POST`空但表单仍然已生成对 php 页面的 http post 请求。这种情况下`if ($_SERVER['REQUEST_METHOD'] == 'POST')`比较好。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-10-05T23:15:30.807

只要我可能需要使用不止一种方法访问我的 PHP 脚本，我实际上要做的是：

```
if (in_array($_SERVER['REQUEST_METHOD'],array("GET","POST","DELETE"))) {
// do wathever I do 
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-02-27T13:13:09.180

```
$this->method = $_SERVER['REQUEST_METHOD'];
if ($this->method == 'POST' && array_key_exists('HTTP_X_HTTP_METHOD', $_SERVER)) {
    if ($_SERVER['HTTP_X_HTTP_METHOD'] == 'DELETE') {
        $this->method = 'DELETE';
    } else if ($_SERVER['HTTP_X_HTTP_METHOD'] == 'PUT') {
        $this->method = 'PUT';
    } else {
        throw new Exception("Unexpected Header");
    }
} 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2014-01-27T06:33:41.457

它检查页面是否已通过 POST（而不是 GET、HEAD 等）调用。当您在菜单栏中键入 URL 时，将通过 GET 调用该页面。但是，当您使用 method="post" 提交表单时，会使用 POST 调用操作页面。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2009-01-03T20:24:25.400

这真的是一个六分之一，六分之一的其他情况。

反对您的方法的唯一可能的论点是 $_SERVER['REQUEST_METHOD'] == 'POST' 可能不会在某些网络服务器/配置上填充，而 $_POST 数组将始终存在于 PHP4/PHP5 中（如果它不存在） t 存在，你有更大的问题 (-:)

* * *

## 回答 #11

> 赞同：-18
> 
> 时间：2009-01-03T17:01:12.377

它们的工作方式相同，但`$_POST`应该使用它，因为它更清洁。您可以添加`isset()`到它以检查它是否存在。

# python - Cocoa 客户端/服务器应用程序

> ID：409354
> 
> 赞同：10
> 
> 时间：2009-01-03T16:57:11.980
> 
> 标签：python, cocoa, web-services, client-server, pyobjc

Cocoa 中是否有一种方法目前被认为是创建多层或客户端服务器应用程序的最佳实践？

我是一位经验丰富的 Web 开发人员，我真的很喜欢 Python。不过，我是 Cocoa 的新手。我正在尝试编写的应用程序是一家大型医院的患者管理系统。该系统预计会随着时间的推移存储大量数据，但在单个会话期间传输的数据非常少（主要是文本）。假设通信发生在本地网络（有线或无线）上。当然，它必须是高度安全的。

我能想到的最好办法是编写一个 Python REST Web 服务并通过 Cocoa 应用程序连接到它。也许我什至会使用 Python 来编写 Cocoa 应用程序本身。

看看 Cocoa，我在 Cocoa 中看到了非常棒的技术，比如 CoreData，但我找不到任何类似的用于客户端服务器开发的技术。我只是想确保我没有遗漏任何东西。

你怎么看？

现实世界的例子将不胜感激。

提前致谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-03T21:51:49.793

如果您可以同时控制客户端和服务器，并且可以将客户端限制为仅 OS X，那么我将支持 Marc 的回答。Cocoa 的分布式对象是一项了不起的技术，它使 RPC 风格的客户端-服务器应用程序变得非常简单。

如果上述要求对您来说过于严格，您仍然可以在 Cocoa 世界中使用许多选项：

1.  您可以使用 PyObjC 在 Python 中编写整个客户端应用程序。通过这种方法，您可以使用您熟悉的 Python 标准库中的标准网络代码。[Twisted](http://twistedmatrix.com)还与 Cocoa 运行循环（PyObjC 示例代码中的示例）很好地集成在一起，我在 Cocoa 应用程序中使用 Twisted 进行网络通信取得了很大成功。如果您选择走这条路，您可能希望在 Objective-C 中编写客户端应用程序并将 python 代码作为插件加载（使用 NSBundle）。PyObjC`py2app`可以从 python 代码编译可加载包。

2.  您可以使用 NSURLConnection 对基于 HTTP 的服务器进行高级访问。

3.  降低一个抽象层次，您可以使用 Cocoa 的 NSStream 来实现您的网络协议。类文档在[此处](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/Foundation/Classes/NSStream_Class/Reference/Reference.htmlhttp://developer.apple.com/DOCUMENTATION/Cocoa/Reference/Foundation/Classes/NSStream_Class/Reference/Reference.html)，其中包含演示 HTTP 和 SOAP 协议的示例代码的链接。

4.  您可以进一步降低并使用 CFNetwork 类。NSStream 基于 CFNetwork，但您可以使用 CFNetwork 对线路进行较低级别的控制。

最后，用于客户端-服务器架构的 Apple 技术是[WebObjects](http://developer.apple.com/tools/webobjects/)框架。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-03T20:48:13.543

Cocoa 具有[Portable Distributed Objects](http://en.wikipedia.org/wiki/Portable_Distributed_Objects)，它让您可以在纯 Objective-C 和 Cocoa 中构建客户端/服务器应用程序，它可以跨进程或跨网络通信。

不幸的是，这是在 Cocoa 中更难学习的东西之一。分布式对象尚未更新以跟上绑定等新技术，没有很多示例或文档（而且许多教程都是旧的，有些甚至早于 OS X）。即使对于经验丰富的 Cocoa 程序员来说，也有很多“陷阱”，对象作为副本或代理对象通过网络传输的方式。例如，您可以从服务器传输一个 NSURL，如果您将其转换为字符串或在调试器中查看它看起来会很好，但如果您尝试在 NSURLConnection 中使用它，您的客户端会崩溃。

根据您的经验，使用 Web 服务可能更容易和更快，但如果您想将整个项目保留在 Cocoa 中，仍然值得研究。如果你想看一个例子，这里有一个[教程。](http://cocoadevcentral.com/articles/000062.php)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T17:39:43.033

一般来说，所有其他客户端/服务器框架的想法都是适用的。

看看这个链接：http: [//developer.apple.com/internet/webservices/webservicescoreandcfnetwork.html](http://developer.apple.com/internet/webservices/webservicescoreandcfnetwork.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T13:25:52.643

我已经编写了一个用于 Cocoa 的服务器和客户端类。使用这些类可以很容易地在不了解套接字和 C-stuff 的情况下生成服务器或客户端应用程序只需看看[我的网站](http://www.1-more-thing.de/code/simpleserver)或[sourceforge.net 项目站点](http://sourceforge.net/projects/simpleserver)。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-03T17:45:45.640

查看[NSConnection](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSURLConnection_Class/Reference/Reference.html)和[NSDownload](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSURLDownload_Class/Reference/Reference.html)的 api来处理网络连接。[NSString](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html)类也有像[+ stringWithContentsOfURL:encoding:error:](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/clm/NSString/stringWithContentsOfURL:encoding:error:)这样可能有用的方法。

然后是[NSXMLParser](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSXMLParser_Class/Reference/Reference.html)和[NSXMLDocument](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSXMLDocument_Class/Reference/Reference.html)用于读取 xml 数据。

# python - 在 Python 中对嵌套列表进行排序和分组

> ID：409370
> 
> 赞同：54
> 
> 时间：2009-01-03T17:05:30.340
> 
> 标签：python

我有以下数据结构（列表列表）

```
[
 ['4', '21', '1', '14', '2008-10-24 15:42:58'], 
 ['3', '22', '4', '2somename', '2008-10-24 15:22:03'], 
 ['5', '21', '3', '19', '2008-10-24 15:45:45'], 
 ['6', '21', '1', '1somename', '2008-10-24 15:45:49'], 
 ['7', '22', '3', '2somename', '2008-10-24 15:45:51']
] 
```

我希望能够

1.  使用函数重新排序列表，以便我可以按列表中的每个项目进行分组。例如，我希望能够按第二列进行分组（以便所有 21 都在一起）

2.  使用函数仅显示每个内部列表中的某些值。例如，我想将此列表减少为仅包含“2somename”的第四个字段值

所以列表看起来像这样

```
[
     ['3', '22', '4', '2somename', '2008-10-24 15:22:03'], 
     ['7', '22', '3', '2somename', '2008-10-24 15:45:51']
] 
```

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-01-03T17:29:07.390

对于第一个问题，您应该做的第一件事是使用operator 模块中的[itemgetter按第二个字段对列表进行排序：](https://docs.python.org/3/library/operator.html#operator.itemgetter)

```
x = [
 ['4', '21', '1', '14', '2008-10-24 15:42:58'], 
 ['3', '22', '4', '2somename', '2008-10-24 15:22:03'], 
 ['5', '21', '3', '19', '2008-10-24 15:45:45'], 
 ['6', '21', '1', '1somename', '2008-10-24 15:45:49'], 
 ['7', '22', '3', '2somename', '2008-10-24 15:45:51']
]

from operator import itemgetter

x.sort(key=itemgetter(1)) 
```

然后你可以使用 itertools 的[groupby](https://docs.python.org/3/library/itertools.html#itertools.groupby)函数：

```
from itertools import groupby
y = groupby(x, itemgetter(1)) 
```

现在 y 是一个包含 (element, item iterator) 元组的迭代器。解释这些元组比显示代码更令人困惑：

```
for elt, items in groupby(x, itemgetter(1)):
    print(elt, items)
    for i in items:
        print(i) 
```

哪个打印：

```
21 <itertools._grouper object at 0x511a0>
['4', '21', '1', '14', '2008-10-24 15:42:58']
['5', '21', '3', '19', '2008-10-24 15:45:45']
['6', '21', '1', '1somename', '2008-10-24 15:45:49']
22 <itertools._grouper object at 0x51170>
['3', '22', '4', '2somename', '2008-10-24 15:22:03']
['7', '22', '3', '2somename', '2008-10-24 15:45:51'] 
```

对于第二部分，您应该使用这里已经提到的列表推导：

```
from pprint import pprint as pp
pp([y for y in x if y[3] == '2somename']) 
```

哪个打印：

```
[['3', '22', '4', '2somename', '2008-10-24 15:22:03'],
 ['7', '22', '3', '2somename', '2008-10-24 15:45:51']] 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-01-03T17:26:37.193

如果您将其分配给 var "a" ...

蟒蛇2.x：

#1：

```
a.sort(lambda x,y: cmp(x[1], y[1])) 
```

#2：

```
filter(lambda x: x[3]=="2somename", a) 
```

蟒蛇3：

#1：

```
a.sort(key=lambda x: x[1]) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-03T17:17:32.500

如果我正确理解您的问题，以下代码应该可以完成这项工作：

```
l = [
 ['4', '21', '1', '14', '2008-10-24 15:42:58'], 
 ['3', '22', '4', '2somename', '2008-10-24 15:22:03'], 
 ['5', '21', '3', '19', '2008-10-24 15:45:45'], 
 ['6', '21', '1', '1somename', '2008-10-24 15:45:49'], 
 ['7', '22', '3', '2somename', '2008-10-24 15:45:51']
]

def compareField(field):
   def c(l1,l2):
      return cmp(l1[field], l2[field])
   return c

# Use compareField(1) as the ordering criterion, i.e. sort only with
# respect to the 2nd field
l.sort(compareField(1))
for row in l: print row

print
# Select only those sublists for which 4th field=='2somename'
l2somename = [row for row in l if row[3]=='2somename']
for row in l2somename: print row 
```

输出：

```
['4', '21', '1', '14', '2008-10-24 15:42:58']
['5', '21', '3', '19', '2008-10-24 15:45:45']
['6', '21', '1', '1somename', '2008-10-24 15:45:49']
['3', '22', '4', '2somename', '2008-10-24 15:22:03']
['7', '22', '3', '2somename', '2008-10-24 15:45:51']

['3', '22', '4', '2somename', '2008-10-24 15:22:03']
['7', '22', '3', '2somename', '2008-10-24 15:45:51'] 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-03T17:27:29.470

> 使用函数重新排序列表，以便我可以按列表中的每个项目进行分组。例如，我希望能够按第二列进行分组（以便所有 21 都在一起）

列表有一个内置的排序方法，您可以提供一个提取排序键的函数。

```
>>> import pprint
>>> l.sort(key = lambda ll: ll[1])
>>> pprint.pprint(l)
[['4', '21', '1', '14', '2008-10-24 15:42:58'],
 ['5', '21', '3', '19', '2008-10-24 15:45:45'],
 ['6', '21', '1', '1somename', '2008-10-24 15:45:49'],
 ['3', '22', '4', '2somename', '2008-10-24 15:22:03'],
 ['7', '22', '3', '2somename', '2008-10-24 15:45:51']] 
```

> 使用函数仅显示每个内部列表中的某些值。例如，我想将此列表减少为仅包含“2somename”的第四个字段值

这看起来像是[列表推导的工作](http://docs.python.org/tutorial/datastructures.html#list-comprehensions)

```
>>> [ll[3] for ll in l]
['14', '2somename', '19', '1somename', '2somename'] 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-03T17:37:59.603

如果您要进行大量排序和过滤，您可能会喜欢一些辅助函数。

```
m = [
 ['4', '21', '1', '14', '2008-10-24 15:42:58'], 
 ['3', '22', '4', '2somename', '2008-10-24 15:22:03'], 
 ['5', '21', '3', '19', '2008-10-24 15:45:45'], 
 ['6', '21', '1', '1somename', '2008-10-24 15:45:49'], 
 ['7', '22', '3', '2somename', '2008-10-24 15:45:51']
]

# Sort and filter helpers.
sort_on   = lambda pos:     lambda x: x[pos]
filter_on = lambda pos,val: lambda l: l[pos] == val

# Sort by second column
m = sorted(m, key=sort_on(1))

# Filter on 4th column, where value = '2somename'
m = filter(filter_on(3,'2somename'),m) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-03T18:15:03.210

对于第 (2) 部分，x 是您的数组，我认为您想要，

```
[y for y in x if y[3] == '2somename'] 
```

这将返回一个仅包含第四个值为“2somename”的数据列表的列表......虽然看起来 Kamil 为您提供了使用 SQL 的最佳建议......

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-03T17:56:59.643

看起来很像您正在尝试将列表用作数据库。

如今，Python 在核心发行版中包含了 sqlite 绑定。如果您不需要持久性，那么创建内存中的 sqlite 数据库真的很容易（请参阅[如何创建 sqllite3 内存数据库？](https://stackoverflow.com/questions/304393/how-do-i-create-a-sqllite3-in-memory-database)）。

然后，您可以使用 SQL 语句来完成所有这些排序和过滤，而无需重新发明轮子。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-03T19:39:45.817

您只是在结构上创建索引，对吗？

```
>>> from collections import defaultdict
>>> def indexOn( things, pos ):
...     inx= defaultdict(list)
...     for t in things:
...             inx[t[pos]].append(t)
...     return inx
... 
>>> a=[
...  ['4', '21', '1', '14', '2008-10-24 15:42:58'], 
...  ['3', '22', '4', '2somename', '2008-10-24 15:22:03'], 
...  ['5', '21', '3', '19', '2008-10-24 15:45:45'], 
...  ['6', '21', '1', '1somename', '2008-10-24 15:45:49'], 
...  ['7', '22', '3', '2somename', '2008-10-24 15:45:51']
... ] 
```

这是您的第一个请求，按位置 1 分组。

```
>>> import pprint
>>> pprint.pprint( dict(indexOn(a,1)) )
{'21': [['4', '21', '1', '14', '2008-10-24 15:42:58'],
        ['5', '21', '3', '19', '2008-10-24 15:45:45'],
        ['6', '21', '1', '1somename', '2008-10-24 15:45:49']],
 '22': [['3', '22', '4', '2somename', '2008-10-24 15:22:03'],
        ['7', '22', '3', '2somename', '2008-10-24 15:45:51']]} 
```

这是您的第二个请求，按位置 3 分组。

```
>>> dict(indexOn(a,3))
{'19': [['5', '21', '3', '19', '2008-10-24 15:45:45']], '14': [['4', '21', '1', '14', '2008-10-24 15:42:58']], '2somename': [['3', '22', '4', '2somename', '2008-10-24 15:22:03'], ['7', '22', '3', '2somename', '2008-10-24 15:45:51']], '1somename': [['6', '21', '1', '1somename', '2008-10-24 15:45:49']]}
>>> pprint.pprint(_)
{'14': [['4', '21', '1', '14', '2008-10-24 15:42:58']],
 '19': [['5', '21', '3', '19', '2008-10-24 15:45:45']],
 '1somename': [['6', '21', '1', '1somename', '2008-10-24 15:45:49']],
 '2somename': [['3', '22', '4', '2somename', '2008-10-24 15:22:03'],
               ['7', '22', '3', '2somename', '2008-10-24 15:45:51']]} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-09-27T14:30:47.970

您可以使用 for 循环对嵌套列表中的元素进行排序和分组。代码将是：

```
l = [['3', '21', '1', '14', '2008-10-24 15:42:58'], 
['4', '22', '4','2somename','2008-10-24 15:22:03'], 
['5', '21', '3', '19', '2008-10-24 15:45:45'], 
['6', '21', '1', '1somename', '2008-10-24 15:45:49'], 
['7', '35', '3','2somename', '2008-10-24 15:45:51']]
col = int(input("Enter the column to search(1-5):"))
val = str(input("Enter the element to group by:"))
val1=[]
print('Searching...')
for x in l:
    cmp=x[col-1]
    if cmp==val:
        val1=x
        print(val1)
emp=[]
if val1 == emp:
    print('No search result. Please Try Again!!') 
```

输出将如下所示：

```
Enter the column to search(1-5):4
Enter the element to group by:2somename
Searching...
['4', '22', '4', '2somename', '2008-10-24 15:22:03']
['7', '35', '3', '2somename', '2008-10-24 15:45:51'] 
```

# html - 刷新后html静态页面位置

> ID：409372
> 
> 赞同：4
> 
> 时间：2009-01-03T17:06:35.300
> 
> 标签：html, static, refresh

我有一个页面，我希望它在刷新后保持静止，并且不会再次默认返回首页，因为它会破坏我上次查看它的位置。因此，我一直有时间再次向下滚动以找到我上次查看的区域。有没有办法消除再次向下滚动的负担？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-12T18:21:53.843

抱歉 - 我删除了上面引用的博客（在重定向统计中注意到），但该帖子仍可从 archive.org 获得：http: [//web.archive.org/web/20050508195342/patrickfoley.com/2005/01/21 /滚动保护程序/](http://web.archive.org/web/20050508195342/patrickfoley.com/2005/01/21/scroll-saver/)

这是该页面中完整的 PHP 示例：

```
<HTML>
<HEAD>
<TITLE>Test</TITLE>
<script>
  function SaveScrollXY() {
    document.Form1.ScrollX.value = document.body.scrollLeft;
    document.Form1.ScrollY.value = document.body.scrollTop;
  }
  function ResetScrollPosition() {
    var hidx, hidy;
    hidx = document.Form1.ScrollX;
    hidy = document.Form1.ScrollY;
    if (typeof hidx != 'undefined' && typeof hidy != 'undefined') {
      window.scrollTo(hidx.value, hidy.value);
    }
  }
</script>
</HEAD>
<BODY onload="ResetScrollPosition()">
  <form name="Form1" id="Form1" method="post"
    onsubmit="SaveScrollXY()" action="index.php">
    <input name="ScrollX" id="ScrollX" type="hidden"
      value="<?php echo $_REQUEST['ScrollX'] ?>" />
    <input name="ScrollY" id="ScrollY" type="hidden"
      value="<?php echo $_REQUEST['ScrollY'] ?>" />
    <p>This is just a paragraph to make a very long page.</p>
    …
    <P>This is just a paragraph to make a very long page.</P>
    <P>
      <input name="TextBox1" type="text"
        value="<?php $v = $_REQUEST['TextBox1']; echo $v ? $v + 1 : 1 ?>"
        readonly="readonly" id="TextBox1" /></P>
    <P>
      <input type="submit" name="Button1" value="Post Form"
        id="Button1" /></P>
  </form>
</BODY>
</HTML> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T17:17:55.963

[这是使用 PHP 保留滚动位置](http://patrickfoley.com/2005/01/21/scroll-saver/)的示例。

[这是ASP.NET](http://www.dotnetjunkies.ddj.com/Article/E474B0FC-20D2-48B3-93B5-DC4CB3C4A1AB.dcik)的示例。

如果这些还不够，谷歌搜索“保留滚动位置”将提供更多示例。

# wcf - 在 2 个 WCF 服务之间进行通信

> ID：409373
> 
> 赞同：1
> 
> 时间：2009-01-03T17:07:24.550
> 
> 标签：wcf, web-services, communication

如何在 2 台不同机器上托管的 2 个 WCF 服务之间进行通信。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T17:10:20.003

简单的！使用 WCF！

为它们中的每一个添加一个指向另一个的服务引用，你就完成了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-04T15:28:07.650

这个问题有点模糊，因为它实际上取决于您希望在两台机器之间进行通信的内容以及您使用的绑定。

我解释问题的第一种方式是服务 A 需要与服务 B 通信，反之亦然。最简单的方法是让服务 A 成为服务 B 的客户端，服务 B 成为服务 A 的客户端。当主机启动每个服务时，它也会打开客户端代理进行通信。无论使用何种绑定，这都会起作用。

我解释问题的第二种方式是服务 A 需要成为服务 B 的客户端，但允许服务 B 回调服务 A。只需修改服务合同以包含回调合同就足够了。当然，这不适用于所有绑定，尤其是在您使用消息队列时。

# c# - 将持久的 ADO 2.8 COM 记录集转换为 ADO.Net 数据集

> ID：409385
> 
> 赞同：4
> 
> 时间：2009-01-03T17:13:14.833
> 
> 标签：c#, vb6, performance

我有一个要转换为 .net 的 VB6 应用程序。我分阶段执行此操作，因此客户端将同时拥有 VB6 和 .net 应用程序。应用程序的一部分将 ADO 2.8 COM 记录集缓存到 SQL Server 中的表中，并根据需要检索它们。.net 应用程序使用相同的持久记录集。我有检索持久记录集并将其转换为数据集的 c# 代码。我的问题是——我是否以最有效的方式做这件事？

这是我从数据库中检索记录集的代码——

```
Stream adoStream = null;
SqlParameter cmdParameter;
SqlCommand cmd = null;
SqlDataReader dr = null;

string cmdText;
int bytesReturned;
int chunkSize = 65536;
int offSet = 0;

UnicodeEncoding readBytes;

try
{
    cmdParameter = new SqlParameter(parameterName, idParamter);

    cmdText = sqlString;

    cmd = new SqlCommand();
    cmd.CommandType = CommandType.Text;
    cmd.CommandTimeout = 0;
    cmd.CommandText = cmdText;
    cmd.Connection = this.pbiSQLConnection;
    cmd.Parameters.Add(cmdParameter);
    dr = cmd.ExecuteReader(CommandBehavior.SequentialAccess);
    dr.Read();

    if (dr.HasRows)
    {
        readBytes = new UnicodeEncoding();
        byte[] byteChunk = new byte[chunkSize];

        adoStream = new Stream();
        adoStream.Type = StreamTypeEnum.adTypeText;
        adoStream.Open(Type.Missing, ConnectModeEnum.adModeUnknown,
            StreamOpenOptionsEnum.adOpenStreamUnspecified, "", "");

        do
        {
            bytesReturned = (int)dr.GetBytes(0, offSet, byteChunk, 0,
                chunkSize);
            size += bytesReturned;
            if (bytesReturned > 0)
            {
                if (bytesReturned < chunkSize)
                {
                    Array.Resize(ref byteChunk, bytesReturned);
                }

                adoStream.WriteText(readBytes.GetString(byteChunk),
                    StreamWriteEnum.stWriteChar);
                adoStream.Flush();
            }

            offSet += bytesReturned;
        } while (bytesReturned == chunkSize);
    }
}
catch (Exception exLoadResultsFromDB)
{
    throw (exLoadResultsFromDB);
}
finally
{
    if (dr != null)
    {
        if (!dr.IsClosed)
        {
            dr.Close();
        }

        dr.Dispose();
    }

    if (cmd != null)
    {
        cmd.Dispose();
    }
} 
```

这是将 ado 流转换为数据集的代码——

```
adoStream = LoadTextFromDBToADODBStream(resultID, "@result_id",
    "some sql statement", ref size);
if (adoStream.Size == 0)
{
    success = false;
}
else
{
    adoStream.Position = 0;

    DataTable table = new DataTable();
    Recordset rs = new Recordset();
    rs.Open(adoStream, Type.Missing, CursorTypeEnum.adOpenStatic,
              LockTypeEnum.adLockBatchOptimistic, -1);

    if (adoStream != null)
    {
        adoStream.Close();
        adoStream = null;
    }

    source.SourceRows = rs.RecordCount;
    table.TableName = "Source";
    source.Dataset = new DataSet();
    source.Dataset.Tables.Add(table);

    OleDbDataAdapter adapter = new OleDbDataAdapter();
    adapter.MissingSchemaAction = MissingSchemaAction.AddWithKey;
    adapter.Fill(source.Dataset.Tables[0], rs);

    if (adapter != null)
    {
        adapter.Dispose();
        adapter = null;
    }

    if (adoStream != null)
    {
        adoStream.Close();
        adoStream = null;
    }

    if (rs != null)
    {
        if (rs.State == 1)
        {
            rs.Close();
        }

        rs = null;
    }
} 
```

谢谢大家

编辑：我添加了一个赏金，看看是否有人可以使代码更有效率。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-14T20:56:09.147

一般来说，您没有充分利用 using 语句并自己处理它。不幸的是，您这样做是错误的，因为如果您有一个 IDisposable 的实现，它在调用 Dispose 时引发异常，则不会发生对 Dispose 的其他调用。如果使用 using 语句，则 IDisposable.Dispose 的所有实现都将被调用，无论它们如何嵌套。

我们先来看看 LoadTextFromDBToADODBStream。这里**最大**的问题是，您在不应该共享连接时共享连接。您应该为您的操作创建连接，使用它，然后关闭它。这里情况不同。

因此，假设您以单独的方法创建连接，如下所示：

```
SqlConnection CreateConnection()
{
    // Create the connection here and return it.
    return ...;
} 
```

您还需要以下结构来正确管理您的 COM 引用：

```
struct ComReference<T> : IDisposable where T : class, new()
{
    private T reference;

    public T Reference { get { return reference; } }

    public static ComReference<T> Create()
    {
        // Create the instance.
        ComReference<T> retVal = new ComReference<T>();

        // Set the reference.
        retVal.reference = new T();

        // Return.
        return retVal;
    }

    public ComReference<T> Release()
    {
        // Create a copy for return.
        // Note, this is copied on the stack.
        ComReference<T> retVal = this;

        // Set this reference to null;
        this.reference = null;

        // Return the reference.
        return retVal;
    }

    public void Dispose()
    {
        // If there is a reference, then release.
        Marshal.ReleaseComObject(reference);
    }
} 
```

您想用它来管理您的 COM 引用，以便在完成它们时释放它们，而不是通过垃圾收集。COM 依赖于确定性终结，您不能仅仅因为您在 .NET 中而忽略这一点。上面的结构利用 IDisposable（事实上它是一个结构以及随之而来的细微差别）以一种确定性的方式帮助实现这一点。

type 参数`T`将是为 COM 互操作创建的类类型，在流的情况下，它将是 ADODB.StreamClass。

您的 LoadTextFromDBToADODBStream 然后看起来像这样：

```
ComReference<StreamClass> LoadTextFromDBToADODBStream(int idParameter,
    string parameterName, string sqlString, ref int size)
{
    int bytesReturned;
    int chunkSize = 65536;
    int offSet = 0;

    // Create the command.
    using (SqlCommand cmd = new SqlCommand())
    {
        // Set the parameters.
        cmd.CommandType = CommandType.Text;
        cmd.CommandTimeout = 0;
        cmd.CommandText = sqlString;

        // See (1).
        using (SqlConnection connection = CreateConnection())
        {
            // Set the connection on the command.
            cmd.Connection = connection;

            // Create the parameter and add to the parameters.
            SqlParameter cmdParameter = new SqlParameter(
                parameterName, idParameter);
            cmd.Parameters.Add(cmdParameter);

            // Create the reader.
            using (SqlDataReader dr = cmd.ExecuteReader(
                CommandBehavior.SequentialAccess))
            {
                dr.Read();

                // See (2)
                if (!dr.HasRows)
                {
                    // Return an empty instance.
                    return new ComReference<StreamClass>();
                }

                // Create the stream here.  See (3)
                using (ComReference<StreamClass> adoStreamClass =
                    ComReference<StreamClass>.Create())
                {
                    // Get the stream.
                    StreamClass adoStream = adoStreamClass.Reference;

                    // Open the stream.
                    adoStream.Type = StreamTypeEnum.adTypeText;
                    adoStream.Open(Type.Missing, 
                        ConnectModeEnum.adModeUnknown,
                        StreamOpenOptionsEnum.adOpenStreamUnspecified, 
                        "", "");

                    // Create the byte array.
                    byte[] byteChunk = new byte[chunkSize];

                    // See (4)
                    Encoding readBytes = Encoding.Unicode;

                    // Cycle.
                    do
                    {
                        bytesReturned = (int)dr.GetBytes(0, offSet, 
                            byteChunk, 0, chunkSize);
                        size += bytesReturned;
                        if (bytesReturned > 0)
                        {
                            if (bytesReturned < chunkSize)
                            {
                                Array.Resize(ref byteChunk,
                                    bytesReturned);
                            }

                            adoStream.WriteText(
                                readBytes.GetString(byteChunk),
                                StreamWriteEnum.stWriteChar);
                            adoStream.Flush();
                        }

                        offSet += bytesReturned;
                    } while (bytesReturned == chunkSize);

                    // Release the reference and return it.
                    // See (5).
                    return adoStreamClass.Release();
                }
            }
        }
    }
} 
```

笔记：

1.  这是您要创建连接的地方。你想在 using 语句中使用它，因为你想确保你的资源在成功或失败时被清理干净。
2.  在这里短路代码并返回`ComReference<StreamClass>`. 当您创建它时，它具有返回没有引用的结构的效果（这是您想要的，而不是调用静态 Create 方法）。
3.  在调用静态 Create 方法时，您正在创建 ADODB.StreamClass 的新实例。你要确保如果出现问题，它会在发布时被处理掉（因为它是一个 COM 接口实现，并且依赖于确定性的终结）。
4.  无需创建新的 UnicodeEncoding。您可以只使用 Encoding 类上的 Unicode 属性来使用预制实例。
5.  在调用 release 时，您将当前堆栈上的实例上的引用字段设置为 null，并将其传递给`ComReference<StreamClass>`返回的实例。这样，StreamClass 引用仍然有效，并且当对堆栈变量调用 Dispose 时，它​​不会将该引用传递给 ReleaseComObject。

继续调用 LoadTextFromDBToADODBStream 的代码：

```
// See (1)
using (ComReference<StreamClass> adoStreamClass =
    LoadTextFromDBToADODBStream(resultID, "@result_id",
    "some sql statement", ref size))
{
    // Set to the class instance.  See (2)
    StreamClass adoStream = adoStreamClass.Reference;

    if (adoStream.Size == 0)
    {
        success = false;
    }
    else
    {
        adoStream.Position = 0;

        DataTable table = new DataTable();

        // See (3)
        using (ComReference<RecordsetClass> rsClass = 
        ComReference<RecordsetClass>.Create())
        {
            Recordset rs = rsClass.Reference;
            rs.Open(adoStream, Type.Missing, CursorTypeEnum.adOpenStatic,
                      LockTypeEnum.adLockBatchOptimistic, -1);

            if (adoStream != null)
            {
                adoStream.Close();
                adoStream = null;
            }

            source.SourceRows = rs.RecordCount;
            table.TableName = "Source";
            source.Dataset = new DataSet();
            source.Dataset.Tables.Add(table);

            // See (4)
            using (OleDbDataAdapter adapter = new OleDbDataAdapter())
            {
                adapter.MissingSchemaAction = 
                    MissingSchemaAction.AddWithKey;
                adapter.Fill(source.Dataset.Tables[0], rs);
            }
        }
    }
} 
```

1.  这将在 LoadTextFromDBToADODBStream 中接收对 Release 的调用的返回值。它将包含对在那里创建的 ADODB.Stream 的实时引用，并且 using 语句将保证在离开范围时将其清除。
2.  和以前一样，这使得引用直接引用更容易，而不必总是调用`adoStreamClass.Reference.<method>`
3.  这次使用另一个 ComReference `ComReference<RecordsetClass>`。
4.  让编译器为你做脏活。

在多使用using语句的过程中，你可以清理很多让阅读变得非常困难的代码。此外，一般来说，您正在清理一些在遇到异常时会出现的资源问题，以及处理未正确处理的 COM 实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T17:35:12.200

如果您说整个 COM 记录集作为二进制对象（字节数组）被持久保存到数据库表中的单个列，那么我看不出任何解决复杂性的方法。您必须先将字节数组转换为从（COM 记录集）序列化的同一个具体对象，然后才能对其进行操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T16:39:33.700

不回答您的具体问题....但是由于您指定了效率，我认为您想要速度。
您是否考虑过两次将其持久化为 ADO 和 ADO.Net，然后，请求者可以检索最合适的并跳过运行时转换（这是假设读取多于写入）。为了获得额外的提升，也许可以在内存中存储 n 个数据集，它们可以立即返回，而不是从数据库中重新加载。同样，这仅根据您的特定数据和请求才有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T08:34:08.463

总体而言，该代码看起来非常有效。虽然我同意需要通用的 COM 处理例程（只是为了保持一致性，如果没有别的），我不知道你会从他的不重用数据库连接的建议中获得什么额外的性能。

我唯一担心的是您正在使用 ADO Stream。这个特殊的物体有一个小的副作用，就是像糖果店里的孩子一样吃掉记忆。我会查看这篇文章 ( [http://www.vbrad.com/article.aspx?id=12](http://www.vbrad.com/article.aspx?id=12) ) 并确保您的代码没有这个问题。

# objective-c - 在 Cocoa 中运行 Socket 服务器

> ID：409418
> 
> 赞同：3
> 
> 时间：2009-01-03T17:27:25.553
> 
> 标签：objective-c, cocoa, macos, sockets

我正在尝试编写一个程序，该程序使用套接字通过网络与自身的其他实例连接。因为最终我也想编写一个 Windows 版本，所以我目前在 OS X 端使用 BSD 套接字，以便我可以确保它与（最终）Windows 版本兼容。

到目前为止，我能够让它工作的唯一方法是在创建服务器套接字时指定我的实际 IP 地址。如果我改用 127.0.0.1，那么我只能从本地计算机连接。

虽然这在理论上很好，但他们的问题变成了我如何知道要使用哪个 IP 地址？我不确定如何通过 Cocoa 获取当前机器的 IP 地址，即使可以，如果有多个有效的 IP 地址（例如机场和以太网连接）怎么办。我怎么知道该使用哪一个？我可以问用户，但这似乎不是他们可以/应该知道的事情。

如有必要，我可以提供我的客户端和服务器连接代码，但是鉴于我能够从远程机器建立连接，我认为问题不在我的代码中。

感谢您的时间。:)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-03T17:30:40.320

使用 0.0.0.0 作为要监听的 IP 地址。它会监听所有地址。

可能在您使用的套接字 API 中为此地址定义了一个常量。如果您使用标准 C 套接字 API，则为 INADDR_ANY。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-03T18:15:38.733

有一个名为[Bonjour](http://developer.apple.com/documentation/Cocoa/Conceptual/NetServices/Introduction.html)的网络可发现协议，您可以使用它在网络上发布您的服务器，然后您的客户端可以自动连接到它们。它是跨平台的，但在其他系统上通常称为零配置。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-04T04:11:58.390

在进行任何类型的套接字编程时，请查看 Beej 的套接字指南。它已经存在了很长时间，涵盖了大部分基础知识。

[http://beej.us/guide/bgnet/](http://beej.us/guide/bgnet/)

# objective-c - 带有绑定的可编辑 NSTableView 不会在模型中设置值

> ID：409424
> 
> 赞同：2
> 
> 时间：2009-01-03T17:30:09.557
> 
> 标签：objective-c, cocoa, cocoa-bindings

这是我的设置。

在我的应用程序委托中，我有一个名为 currentFoo 的属性。currentFoo 属性设置为当前选定的 Foo 实例。每个 Foo 实例都有一个名为 results 的 NSMutableArray 属性。结果中的对象可以是各种类型，NSNumber，NSString等......

我有一个在特定时间显示的 NSTableView，它允许用户查看 currentFoo 中的结果集合。还有 UI 允许从结果中添加和删除。

NSTableView 有一个绑定到 NSArrayController 的排列对象控制器键的单列。我编写了一个 NSValueTransformer 子类，该子类在此绑定中用于将结果数组中的各种可能类型转换为我希望在表列中显示的字符串表示形式。

NSArrayController 的内容数组绑定连接到 NSObjectController 的选择控制器键，currentFoo.results 作为模型键路径。最后 NSObjectController 从应用程序委托中获取其内容。

这一切都很好，在 NSTableView 中添加、删除和显示 currentFoo.results 就像我想要的那样工作。

我的问题是当我尝试编辑表格视图的内容时。我已将我的 NSValueTransformer 子类设置为允许反向转换并实现了 reverseTransformedValue:，单步执行代码显示当我编辑 NSTableView 行中的值时，它被正确地发送到我的值转换器的该方法，转换并返回。

然后，当绑定尝试使用反向转换的值更新模型时，就会发生错误：

> Cocoa Bindings：对象 0 的键路径设置值错误（来自绑定对象（null））：[ setValue:forUndefinedKey:]：此类与键的键值编码不兼容。

所以基本上有这个数组绑定到表视图，当用户编辑行时，我想将字符串转换回适当的对象。Cocoa bindings 给了我这个错误，这让我相信我需要在 NSTableColumn 绑定的关键路径中设置一些东西，但我不确定是什么。我试过“自我”，但没有奏效。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-03T23:56:36.313

模型键不能为空 - 因此您会收到错误消息。

将结果对象从原始对象（字符串、盒装数字等）更改为模型对象（FooResult 类），并将绑定的模型键路径设置为您将拥有表格视图的模型对象的属性名称变异。

基本上，您不能直接绑定到原始对象数组。您必须绑定到模型对象数组的某些属性。

# excel - 在单元格更改时自动执行 Excel 宏

> ID：409434
> 
> 赞同：95
> 
> 时间：2009-01-03T17:33:22.327
> 
> 标签：excel, vba, automation

每次特定单元格中的值发生变化时，如何自动执行 Excel 宏？

现在，我的工作代码是：

```
Private Sub Worksheet_Change(ByVal Target As Range)
    If Not Intersect(Target, Range("H5")) Is Nothing Then Macro
End Sub 
```

其中`"H5"`是被监视的特定单元格，并且`Macro`是宏的名称。

有没有更好的办法？

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2009-01-06T01:59:23.490

你的代码看起来很不错。

但是要小心，因为您调用 to`Range("H5")`是对 的快捷命令`Application.Range("H5")`，相当于`Application.ActiveSheet.Range("H5")`. 这可能很好，如果唯一的更改是用户更改 - 这是最典型的 - 但是当工作表的单元格值不是活动工作表时，它可能会通过编程更改（例如 VBA）进行更改。

考虑到这一点，我会利用`Target.Worksheet.Range("H5")`：

```
Private Sub Worksheet_Change(ByVal Target As Range)
    If Not Intersect(Target, Target.Worksheet.Range("H5")) Is Nothing Then Macro
End Sub 
```

或者`Me.Range("H5")`，如果事件处理程序位于相关工作表的代码页上（通常是），您也可以使用：

```
Private Sub Worksheet_Change(ByVal Target As Range)
    If Not Intersect(Target, Me.Range("H5")) Is Nothing Then Macro
End Sub 
```

希望这可以帮助...

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-03T17:36:36.220

处理`Worksheet_Change`事件或`Workbook_SheetChange`事件。

事件处理程序采用参数“Target As Range”，因此您可以检查正在更改的范围是否包括您感兴趣的单元格。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2018-07-11T22:51:50.953

在真正搞砸了事件触发器之后，我花了很多时间研究这个并了解它是如何工作的。由于有这么多分散的信息，我决定将我发现的所有内容分享在一个地方，一步一步如下：

1) 打开 VBA 编辑器，在 VBA 项目 (YourWorkBookName.xlsm) 下打开 Microsoft Excel 对象并选择更改事件将涉及的工作表。

2) 默认代码视图是“常规”。从顶部中间的下拉列表中，选择“工作表”。

3) Private Sub Worksheet_SelectionChange 应该已经存在，不要管它。从上面复制/粘贴 Mike Rosenblum 的代码并将 .Range 引用更改为您正在观察更改的单元格（在我的情况下为 B3）。但是，不要放置您的宏（我在“然后”之后删除了“宏”这个词）：

```
Private Sub Worksheet_Change(ByVal Target As Range)
    If Not Intersect(Target, Me.Range("H5")) Is Nothing Then
End Sub 
```

或从左上角的下拉列表中选择“更改”，然后在 Private Sub 和 End Sub 之间的空白处粘贴`If Not Intersect(Target, Me.Range("H5")) Is Nothing Then`

4）在“然后”关闭事件之后的行上，这样当您调用宏时，它不会触发事件并尝试在永无止境的循环中再次运行此 Worksheet_Change，这会导致 Excel 崩溃和/或以其他方式将一切搞砸：

```
Application.EnableEvents = False 
```

5）调用你的宏

```
Call YourMacroName 
```

6）重新打开事件，以便下一个更改（和任何/所有其他事件）触发：

```
Application.EnableEvents = True 
```

7) 结束 If 块和 Sub：

```
 End If
End Sub 
```

整个代码：

```
Private Sub Worksheet_Change(ByVal Target As Range)
    If Not Intersect(Target, Me.Range("B3")) Is Nothing Then
        Application.EnableEvents = False
        Call UpdateAndViewOnly
        Application.EnableEvents = True
    End If
End Sub 
```

这会将事件从模块中打开/关闭，这会产生问题，并且只是让更改触发、关闭事件、运行宏并重新打开事件。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-04T11:58:04.313

我更喜欢这种方式，不使用单元格，而是使用范围

```
 Dim cell_to_test As Range, cells_changed As Range

    Set cells_changed = Target(1, 1)
    Set cell_to_test = Range( RANGE_OF_CELLS_TO_DETECT )

    If Not Intersect(cells_changed, cell_to_test) Is Nothing Then 
       Macro
    End If 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-20T16:46:12.487

我有一个链接到在线股票数据库并经常更新的单元格。我想在单元格值更新时触发一个宏。

我相信这类似于程序或任何外部数据更新的单元格值更改，但以上示例对我不起作用。我认为问题在于没有触发excel内部事件，但那是我的猜测。

我做了以下，

```
Private Sub Worksheet_Change(ByVal Target As Range) 
  If Not Intersect(Target, Target.Worksheets("Symbols").Range("$C$3")) Is Nothing Then
   'Run Macro
End Sub 
```

# python - 用于完整性检查的循环函数参数

> ID：409449
> 
> 赞同：3
> 
> 时间：2009-01-03T17:41:09.253
> 
> 标签：python, function, parameters, arguments, sanitization

我有一个 Python 函数，我正在对输入参数进行一些清理：

```
def func(param1, param2, param3):
    param1 = param1 or ''
    param2 = param2 or ''
    param3 = param3 or '' 
```

这迎合了作为*None*而不是空字符串传递的参数。是否有更简单/更简洁的方法来循环函数参数以将这样的表达式应用于所有参数。我的实际函数有九个参数。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-03T18:43:01.063

对于装饰师来说，这看起来是一份不错的工作。这个怎么样：

```
def sanitized(func):
    def sfunc(*args, **kwds):
        return func(*[arg or '' for arg in args],
                    **dict((k, v or '') for k,v in kwds.iteritems()))
    sfunc.func_name = func.func_name
    sfunc.func_doc = func.func_doc
    return sfunc 
```

你可以像这样在你的函数上使用它：

```
@sanitized
def func(param1, param2, param3):
    print param1, param2, param3 
```

如果参数为假，则参数将被空字符串替换：

```
>>> func('foo', None, 'spam')
foo  spam 
```

（请注意，正如 Ned Batchelder 在他的回答中指出的那样，这仍然会弄乱函数签名。要解决这个问题，您可以使用[Michele Simionato 的装饰器模块](http://pypi.python.org/pypi/decorator)——我认为您只需要`@decorator`在定义之前添加一个`sanitized`）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T18:19:10.177

你可以做一些列表操作：

```
def func(param1, param2, param3):
    param1, param2, param3 = map(lambda x: x or '', (param1, param2, param3)) 
```

但我不确定这是否比写出九行更好，因为一旦你得到九个参数，那是一条长得令人发指的行。

您可以更改函数的声明：

```
def func(*args):
    param1, param2, param3 = map(lambda x: x or '', args) 
```

但是随后您会丢失来自具有真实参数名称的文档，以及更改默认值的可能性等。而且您仍然有一条非常模糊的线来解压缩它们。

我说写出九行，或者更改函数以减少参数：无论如何，九是很多！

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-01-03T17:51:38.547

```
def func(x='', y='', z='hooray!'):
    print x, y, z

In [2]: f('test')
test  hooray!

In [3]: f('test', 'and')
test and hooray!

In [4]: f('test', 'and', 'done!')
test and done! 
```

# c#-3.0 - 通用包装类可能吗？

> ID：409454
> 
> 赞同：1
> 
> 时间：2009-01-03T17:46:15.127
> 
> 标签：c#-3.0

在 C# 3.0 和 .NET 3.5 上，想象有一个接口：

```
public interface INameable
{
  string Name {get;}
} 
```

以及许多实现接口的不可变类。

我想要一个扩展方法

```
public static T Rename<T>(this T obj) where T : INameable
{ 
  ...
} 
```

它返回原始对象的包装实例，仅更改名称，所有其他属性读取和方法调用路由到原始对象。

如何为此获得一个通用包装类，而不为所有 INameable 实现类型实现它？你认为这可能吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-03T18:08:37.263

不，这是不可能的，除非`T`被约束为接口或所有成员为虚拟的类，并且无法在编译时指定此约束（尽管您可以编写运行时检查，如果您满意的话用这种方法）。

您不能对任意类型执行此操作的原因是，如果您采用类型的对象，`T`那么您必须返回一个可分配给的对象`T`。如果我传递一个如下所示的对象...

```
public sealed class SomeClass : INameable
{
    public string Name { get; }
    public string Abc { get; }
} 
```

...那么您就无法创建另一种可分配给`SomeClass`. 不使用`Reflection.Emit`或任何其他方法，因为类型是密封的。

但是，如果您对我提到的限制感到满意，那么您可以使用 Castle DynamicProxy 框架之类的东西来创建一个代理传入对象的类型，并根据需要拦截转发或重新实现的调用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T17:58:11.513

嗯，是的，这是可能的，但它涉及在内存中生成代码。

您可以查看[Reflection.Emit](http://msdn.microsoft.com/en-us/library/3y322t50.aspx)和[此处](http://msdn.microsoft.com/en-us/library/system.reflection.emit.aspx)。

请注意，它将涉及大量代码。

也就是说，如果我假设我理解正确。

这就是我认为你要求的：

```
SomeNameableObject a1 = new SomeNameableObject("ThisIsTheFirstName");
SomeNameableObject a2 = a1.Rename("ThisIsTheSecondName");
// a1 works, still has the name ThisIsTheFirstName
// a2 works, but everything is routed to a1,
//    except for the name, which is ThisIsTheSecondName 
```

那是对的吗？

# browser - 如何找出我的浏览器在访问网页时加载的所有文件？

> ID：409456
> 
> 赞同：1
> 
> 时间：2009-01-03T17:46:51.083
> 
> 标签：browser

我可以使用 Firebug，它会显示很多有关已加载文件的信息，甚至是 http 返回码，但它似乎并没有显示所有这些信息。
例如，我访问了一个加载 Flash 文件的页面。在 firebug 中它会显示文件已加载，但如果该 swf 本身加载其他 swf 并访问其他资源，则这些将不会在 firebug 中显示。与 ajax 调用相同。
所以我想知道如何监控在浏览页面时进行的所有活动、加载了哪些文件、从哪里加载等等......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-03T17:56:54.293

我用来检查请求和响应的工具之一是[Fiddler](http://www.fiddlertool.com/fiddler/)。它工作得很好，而且是免费的。从他们的主页[http://www.fiddlertool.com/fiddler/](http://www.fiddlertool.com/fiddler/)

> Fiddler 是一个 HTTP 调试代理，它记录您的计算机和 Internet 之间的所有 HTTP 流量。Fiddler 允许您检查所有 HTTP 流量、设置断点以及“摆弄”传入或传出数据。Fiddler 包括一个强大的基于事件的脚本子系统，并且可以使用任何 .NET 语言进行扩展。

我也用过[IEWatch](http://www.iewatch.com/)，但是 IEWatch 不是免费的，只适用于 IE。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T17:49:38.443

您可以设置一个简单的本地 HTTP 代理并通过它传递您的所有请求。然后监视代理日志文件以查看请求的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T17:50:33.777

我用这个：

[http://www.httpwatch.com/](http://www.httpwatch.com/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-03T17:54:54.063

有一个名为[lori (life-of-request info)](https://addons.mozilla.org/en-US/firefox/addon/1743)的 Firefox 插件可以做到这一点：它在工具栏上显示字节总数和其他统计信息，如果您右键单击它，它会提供将详细统计信息复制到包含网址本身的剪贴板。它适用于 ajax 请求，但我不确定 swf。

此外，Safari 或 Chrome 等 Webkit 浏览器中的资源检查器也会为您做同样的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-03T17:50:11.763

Firebug 确实记录了 AJAX 请求。Safari 网络检查器将是接下来要尝试的东西，但我认为任何浏览器工具都不会记录发送的闪存数据。为此，像wireshark这样的数据包记录器会更好。

# wpf - WPF 数据绑定不调用！

> ID：409457
> 
> 赞同：1
> 
> 时间：2009-01-03T17:47:14.813
> 
> 标签：wpf, data-binding

我有 UserControl，其中包含一个 TextBox 和一个 Button 控件。按钮打开一个 FileDialog 并且用户选择文件。选定的文件被传输到作为依赖属性的 FileName 属性中。由于某种原因，TextBox 未绑定到此属性。这是代码：

```
<UserControl x:Class="WPF3D.FileInputBox"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Height="300" Width="300" x:Name="root">
    <Grid>

        <StackPanel>            
        <TextBox Name="txtFile" Text="{Binding FileName, ElementName=root}" Width="300" Height="20" />
        <Button Content="Select File" Width="100" Height="20" Click="SelectFile"  /> 
        </StackPanel>

    </Grid>
</UserControl> 
```

这是 UserControl.cs 文件的代码：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;
using Microsoft.Win32;
using System.Windows.Markup;

namespace WPF3D
{
    [ContentProperty("FileName")]
    public partial class FileInputBox : UserControl
    {
        public static readonly DependencyProperty FileNameProperty = DependencyProperty.Register("FileName",
                                                                                                 typeof (String),
                                                                                                 typeof (FileInputBox));

        public event EventHandler<EventArgs> FileNameChanged; 

        public FileInputBox()
        {
            InitializeComponent();
            txtFile.TextChanged += new TextChangedEventHandler(txtFile_TextChanged);
        }

        void txtFile_TextChanged(object sender, TextChangedEventArgs e)
        {
            e.Handled = true; 
            if(FileNameChanged != null)
            {
                FileNameChanged(this, EventArgs.Empty); 
            }

        }

        public string FileName
        {
            get { return (string) GetValue(FileNameProperty); }
            set { SetValue(FileNameProperty,value);}
        }

        private void SelectFile(object sender, RoutedEventArgs e)
        {
            // select the file 
            var fileDialog = new OpenFileDialog();
            fileDialog.ShowDialog();

            this.FileName = fileDialog.FileName;
        }

        protected override void OnContentChanged(object oldContent, object newContent)
        {
            if(oldContent != null)
                throw new InvalidOperationException("You can't change the content"); 
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-04T18:20:48.720

我认为这只是一个范围界定问题，从调试窗口中的输出可以看出：

```
System.Windows.Data Error: 4 : Cannot find source for binding with reference 'ElementName=root'. BindingExpression:Path=FileName; DataItem=null; target element is 'TextBox' (Name='txtFile'); target property is 'Text' (type 'String') 
```

如果您只是将其更改为此，它可以正常工作：

```
<UserControl x:Class="TestApp.FileInputBox"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Height="300" Width="300">
    <Grid x:Name="_grid">
        <StackPanel>
            <TextBox Name="txtFile" Text="{Binding FileName}" Width="300" Height="20" />
            <Button Content="Select File" Width="100" Height="20" Click="SelectFile"  />
        </StackPanel>
    </Grid>
</UserControl> 
```

以及代码隐藏的重要部分：

```
public FileInputBox()
{
    InitializeComponent();
    txtFile.TextChanged += new TextChangedEventHandler(txtFile_TextChanged);
    _grid.DataContext = this;
} 
```

请注意，设置`DataContext`在`Grid`而不是`UserControl`是有意的。如果您在`UserControl`级别上执行此操作，您的控件的使用者只需通过`DataContext`更改`UserControl`.

# eclipse - 如何让 Eclipse 退出 MDI 模式？

> ID：409465
> 
> 赞同：7
> 
> 时间：2009-01-03T17:51:13.773
> 
> 标签：eclipse, mdi, sdi

有谁知道使 Eclipse 成为 SDI 应用程序而不是 MDI 应用程序的方法？SDI - 单文档界面，每个窗格都是自己的窗口 MDI - 多文档界面，所有窗格都卡在一个“主”窗口中。

Eclipse 是一个 MDI 应用程序。所有的小窗格（如调用堆栈、变量查看器等）都是一个主 Eclipse 窗口的一部分。我不想让所有的窗口都卡在一个主“eclipse”窗口中，而是希望它们都是它们自己的自由浮动窗口。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-05T07:58:32.143

要使窗格“自由浮动”，只需将该窗格拖到 Eclipse 主窗口之外。

如果您只有一个显示器，则必须首先调整 eclipse 窗口的大小：您不能在所有屏幕空间上让 eclipse 最大化。
然后你必须**将你的窗格拖到 Eclipse 窗口之外，直到你看到光标变成一个中间有一个“+”的小窗口**。

一旦您的所有窗格都在所需的位置，将您的配置保存在一个新的[透视图](http://www.eclipse.org/articles/using-perspectives/PerspectiveArticle.html)中。（菜单`Window\Save Perspective As`）

这样，您可以轻松地在窗格配置之间切换。

* * *

然而，关于 SDI 方面，eclipse 的编辑器部分用于编辑多个文档（因此，仅限 MDI）。
Karl 的双击建议是最有效地关注那些编辑过的文档之一。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T18:12:22.670

点击每个文档旁边的小 X，直到只有一个打开。

或者，双击选项卡将其最大化。

然后编辑您的问题，以提供有关您真正想做的更多信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-21T20:50:47.363

不，遗憾的是 Eclipse 3.x 和更低版本不允许编辑器窗口位于应用程序窗口之外。您可以将其他窗口拖到主窗口之外以提供更多编辑器空间，但是您不能例如将主 Eclipse 窗口之外的编辑器拖到第二个监视器上并在主监视器上打开另一个代码窗口。此功能似乎计划用于 Eclipse 4。有关此功能，请参阅[https://bugs.eclipse.org/bugs/show_bug.cgi?id=8886](https://bugs.eclipse.org/bugs/show_bug.cgi?id=8886)。

# authentication - 运行 OpenID 组织

> ID：409480
> 
> 赞同：1
> 
> 时间：2009-01-03T17:58:10.563
> 
> 标签：authentication, openid

我最近写了一个应用程序，它依赖于 OpenID 进行身份验证。如今，许多 Web 应用程序都在迁移到 OpenID，因为它们*已经*具有用户 ID/密码身份验证方案，而 OpenID 只是一个附加组件。由于我的应用程序是一个新应用程序，因此我认为当我可以完全依赖 OpenID 进行所有身份验证时，编写基于用户 ID/密码的单独身份验证机制是没有意义的。

但肯定的是，一旦我向客户展示了应用程序，她就问“好吧，我们如何创建用户帐户并重置他们的密码”？从概念上讲，如果用户还没有 OpenID，她不想让他们创建自己的 OpenID。

我对此有一种预先做出的回应，那就是：“你总是可以运行你自己的 OpenID 服务器”。我想我并没有在这个答案上考虑太多，因为 OpenID 服务器的许多实现都非常原始，需要大量工作才能在生产中运行。

所以，我的问题是：这里有没有人有运行私有 OpenID 服务器的经验，纯粹是为了验证她自己的用户。以下是我正在寻找的开箱即用支持的功能：

*   能够批量加载用户帐户
*   通过验证电子邮件自助重置密码
*   管理功能（锁定/解锁/禁用帐户、故障排除等）
*   漂亮的外观

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-03T19:01:06.800

这并不能直接回答他们的问题，但是有多少人在互联网上并且没有 Yahoo、Flickr、AIM、WordPress、Myspace、Google 或 MSN 的帐户？他们都是 OpenID 提供者。

我认为对于不使用这些服务的极少数“网络人口”，只需将他们指向 Vidoop 或 MyOpenID 并让他们在已经拥有安全基础设施的人那里获得一个帐户。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T19:28:44.857

这是我最初的想法......但是该应用程序是针对非互联网极客类型的用户，因此期望他们可能拥有也可能没有上述任何帐户。

另一件事是：MyOpenID 为您提供了一个简洁、漂亮的 URL，而 Yahoo（例如）却没有。即使您知道某人拥有 yahoo 帐户，您也不能只使用 username.yahoo.com。谷歌也是一样的——你必须首先使用你的谷歌账户来激活一个 blogspot 账户，**然后**你有一个 OpenID，它可能与你的 gogle id 相关，也可能很多不相关。所以，如果你有一个用户列表，即使*你*知道他们都在 google 或 yahoo 上——即使这样你也不能对他们的 OpenID url 做出假设

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-03T19:47:01.387

我在自己的应用程序中使用 OpenID，但如果我要去客户那里，他们提出了有关拥有密码和其他东西的问题，我可能会告诉他们供应商会为他们处理这些问题。如果他们不喜欢这个主意，我会向他们收取设置会员系统所需的额外时间。这样您就可以收取更多费用，并且您会拥有满意的客户。我不认为公众会在未来几年内了解 OpenId。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T23:50:01.770

有现成的框架。你只需要把它们放在一起。这可以快速完成。

你没有写你的平台，但如果你喜欢使用 php，那么看看“zend framework”或“php openid”

# java - 在 C++ 之后学习 Java 的最佳方法是什么？

> ID：409483
> 
> 赞同：9
> 
> 时间：2009-01-03T17:59:14.117
> 
> 标签：java, c++

我已经使用 C++ 大约 6 或 7 年了，我认为自己精通它。直到现在我从来没有为 Java 烦恼过，但我发现自己失业了（公司倒闭了），我需要扩展我的技能。有人推荐了 Java，所以我想知道是否有任何建议可以让像我这样的人从哪里开始。我也很想知道 Java 的哪些关键方面最有可能在面试中出现。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-03T18:18:42.657

当我们谈论 Java 时，我会想到一些热门领域

*   **OOP 的概念**：我确信这与 C++ 没有太大区别：类、抽象类、接口、多态性、覆盖、重载、继承、静态成员……接口可能是您可能想要关注的领域。由于这在 C++ 中不直接可用，我不知道。
*   **Core Java**：基本语法和常用类如Math、String、System.out、Scanner、Basic file I/O、Stream。了解垃圾收集的概念、引用类型（因为此处没有指针。）了解 Java 平台/技术、J2SE、J2EE。带有 Swing 及其布局管理器的基本 GUI。带有 Servlet/JSP 的 Web 应用程序。
*   **流行的工具、框架和库**：这可能不如上面的要点重要。但也许您应该知道 Eclipse、Netbeans、Spring、Struts、Hibernate、EJB、Ant、JUnit、JavaDoc 的用途。

您可以随时在 Google 中搜索“C++ to Java”。我相信会有很多好的起点。下次编写 Java 代码时，别忘了不要在 var name 前面加上 * :)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-03T18:03:21.800

我建议您阅读《[Effective Java](http://java.sun.com/docs/books/effective/) cover to cover》一书。您不仅会学到很多好的编程实践，而且会比其他方式学到更多关于 Java 的知识。强烈推荐。:-)

举个简单的例子，在 Java 中，不是手动滚动位域（这在 Java 中是相当痛苦的，而且有充分的理由），而是使用 an `EnumSet`。这记录在第 32 条中。

顺便说一句，如果您不介意阅读 PDF（无 DRM）版本，它也比硬拷贝便宜：http: [//www.informit.com/title/0132345285](http://www.informit.com/title/0132345285)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-03T18:26:41.050

有许多很棒的“深入的”Java 书籍不仅可以教您 Java，还可以教您最佳编程实践。

如果您只是对语法和类层次结构的介绍感兴趣，那么*24 小时 Java*就不错了。从那里，您将了解足够多的知识，可以自己去探索更多。

我强烈建议您考虑一个小项目来帮助您学习。事实上，想想一个**很小的**项目——它会比你想象的要大得多！;) 也许是简单的射击游戏或*Daleks* - 或*Asteroids* -类似的，或类似的。

最主要的是：对于专家级程序员，不要试图从书本上学习 Java。您可以通过一本书了解 Java，但随后您必须自己（或从其他人那里）学习。这就像学习驾驶汽车——您可以从一本书中获得基础知识，但您需要探索 &尝试一些东西，知道如​​何做的人会很有帮助。

一些有帮助的事情：

*   下载 HTML Java 文档并为其添加书签。你会经常引用它们。
*   有一个小项目、一个简单的游戏或实用程序，您估计需要几天时间才能编写完成。花几个星期写它；）
*   请注意，“Java”是三件事：
    *   Java 编程语言。像 C++ 或 Lisp 或 Perl。
    *   Java 类层次结构。像 STL 或 Cocoa。
    *   Java 运行时虚拟机，JVM。

人们使用“Java”这个词来表示所有 3 件事，并且在没有太多注意的情况下在它们之间滑动，所以当你开始与人们谈论 Java 时要注意这一点。

祝你好运！

（并让我们知道您的游戏何时可用 :)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-03T18:08:58.997

C++ 到 Java 转换的最大问题是它们非常相似——您会发现自己在一段时间内从事 C++ 主义。但这没什么大不了的：按照建议，阅读 Josh Bloch 的书，并浏览 java.sun.com 上的教程，你会做得很好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-03T18:16:35.690

在我看来，Java 在三个方面将自己与 C++ 区分开来：

1.  自动内存管理
2.  简化的语法（并且没有预处理器）
3.  Java 标准库

作为一个前 C++ 人，前两个应该不是问题。（事实上​​，我敢打赌它们会让你耳目一新。）为了习惯这些库，我推荐 Bruce Eckel 的[Thinking in](http://www.mindview.net/Books/TIJ/ "用 Java 思考") Java——第 3 版可免费下载。虽然开始的章节可能有点过于基础，但关于 GUI 编程、并发和各种容器类的部分会很有帮助。

除此之外，学习任何语言的最好方法就是阅读好的代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-03T18:20:48.613

我首先阅读了当时（2001 年）的 Java 语言规范第 2 版。在我看来，随着规范的发展，它是非常易读的。

有效的 Java 是个好建议。

Java Puzzlers 非常适合学习极端情况和可能的陷阱。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-01-15T15:01:51.407

Peter Norton 的 Java 编程指南，[“从 C/C++ 到 Java 的过渡”](http://www.sheetudeep.com/res/javaapn/ch2.htm#MakingtheTransitionfromcctoJava)。

# c# - 如何使用诺基亚 API 获取手机驱动器的大小（免费、总计）？

> ID：409487
> 
> 赞同：4
> 
> 时间：2009-01-03T18:02:54.063
> 
> 标签：c#, mobile, nokia

我想获得手机驱动器的大小。我正在使用“Nokia-PC-Connectivity”。关于文件系统 API，我在名为 CONA_Folder_Info 的 CONADifinition 函数上找到，但此函数不支持 FreeSize 和 Total Size，但有 CONA_Folder.Info2 及其实例支持这些变量.

但是当我按如下方式使用 CONA_Folder.Info2 时：

```
CONADefinitions.CONAPI_FOLDER_INFO2 FolderInfo;
int iResult = 0;// Allocate memory for buffer
IntPtr Buffer = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(CONADefinitions.CONAPI_FOLDER_INFO2)));                      
iResult = CONAFileSystem.CONAFindNextFolder(hFindHandle, Buffer);
while (iResult == PCCSErrors.CONA_OK )
{
  FolderInfo = (CONADefinitions.CONAPI_FOLDER_INFO2)Marshal.PtrToStructure(Buffer,    typeof(CONADefinitions.CONAPI_FOLDER_INFO2));
  if (FolderInfo.pstrName[0].ToString() != "C" && level == 0) 
  {
  } 
```

我得到这个例外：

> 检测到 FatalExecutionEngineError 消息：运行时遇到致命错误。错误地址位于线程 0x1278 上的 0x7a0ba769。错误代码为 0xc0000005。此错误可能是 CLR 中的错​​误或用户代码的不安全或不可验证部分中的错误。此错误的常见来源包括 COM 互操作或 PInvoke 的用户封送错误，这可能会损坏堆栈。

注：我使用的是[S60 软件平台](http://en.wikipedia.org/wiki/S60_(software_platform))。应用程序语言是 C#。

如需更多解释，请询问我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-04T12:29:39.547

当您尝试将缓冲区中的数据转换为与最初由 CONAFileSystem.CONAFindNextFolder 创建的不同类型的结构时，出现异常是正确的。

您正试图将 CONADefinitions.CONAPI_FOLDER_INFO 类型的数据结构强制转换为 CONADefinitions.CONAPI_FOLDER_INFO2 类型的结构。它们几乎肯定有不同的长度等等，所以这种方法极不可能奏效。

根据在 Symbian OS 上进行 C++ 开发的经验，诺基亚很可能在这里使用的模式是，他们随后开发了更新版本的 API，因此创建了更新版本的 CONADefinitions.CONAPI_FOLDER_INFO 结构（即 CONADefinitions.CONAPI_FOLDER_INFO2 ）。

假设这是正确的，则有 3 种可能性：
1) 第一个函数有一个枚举参数，它指定要创建哪个版本的输出结构。
2) 有一个返回新结构的新函数，例如 CONAFileSystem.CONAFindFirstFolder2, CONAFileSystem.CONAFindNextFolder2
3) 诺基亚内部开发了新版本，但尚未公开发布。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T19:20:27.573

我对诺基亚 API 一无所知，但总的来说，我看到以下内容：

1.  Find API 通常有一个 FindFirst，然后是 FindNext 的迭代，然后是 FindClose。我看到你用 hFindHandle 调用 FindNext，但我没有看到它在任何地方被初始化（这通常发生在 FindFirst 调用中）。如果这是零，那肯定会导致访问冲突。
2.  如果没有更多的 while() 循环，它看起来就像一个无限循环——我假设你在某个地方还有另一个 FindNext？
3.  通常 Find 调用要求传入的结构完成一些初始化 - 例如设置长度成员。检查您的 API 文档以查看此处是否需要。
4.  我没有看到您释放 Buffer 变量或关闭查找句柄（假设它有效）。

# ssis - 通过 SSIS 传输 SFTP 或 FTPS 文件的最佳方法

> ID：409491
> 
> 赞同：31
> 
> 时间：2009-01-03T18:03:39.507
> 
> 标签：ssis, service, integration, sftp, ftps

这个问题最初询问哪种是在 SSIS 中通过 SFTP 或 FTPS 上传文件的最佳方法。它现在只是列出了每种解决方案的优缺点。这些天我个人使用 CozyRoc 的 SFTP 库，但我曾经使用过以下每个解决方案。

SSIS 组件库

[方法：在每个开发和生产服务器上安装来自CozyRoc](http://www.cozyroc.com/support/ssis_home.html)、[Codeplex](http://ssissftp.codeplex.com/)、[BizCrypto](http://www.eldos.com/bizcrypto/ssis-sftp-connection-task.php)、[PragmaticWorks](http://pragmaticworks.com/Products/Business-Intelligence/TaskFactory/SSIS-FTPS-SFTP-Task.aspx)或其他供应商的 SSIS 组件库，并使用 SFTP 任务上传文件。

优点：易于使用。它的外观、气味和感觉都像是一个普通的 SSIS 任务。SSIS 还将密码识别为敏感信息，并允许您使用所有常规选项来保护敏感信息，而不仅仅是以不安全的方式以明文形式存储它。适用于其他 SSIS 任务，例如 ForEach 循环容器。上传和下载失败时出错。当您不知道远程 FTP 站点上要下载的文件的名称，或者直到运行时才知道要上传的文件的名称时，它的效果很好。

缺点：除了 Codeplex 解决方案之外，在生产环境中获得许可需要花钱。需要在每台开发和生产机器上安装库。如果它是 Codeplex 解决方案，那么您正在使用不受任何特定供应商支持的软件。这也使您依赖供应商在每个版本之间更新他们的库。例如，在 2008 RTM'd 之前，我在 2008 的 CTP 版本上开发了一个新服务器，而 CozyRoc 2005 库与它不兼容。最终他们发布了 2008 兼容版本，但我不得不暂时使用命令行解决方案来解决这个问题。

命令行 SFTP 程序

方法：安装一个免费的命令行SFTP应用程序，如Putty和WinSCP，并通过运行批处理文件或操作系统进程任务来执行它。[此处](http://www.codeproject.com/KB/database/SSIS_SFTP.aspx)列出了通过 WinSCP 执行此操作的说明。

优点：免费，免费和免费。如果您使用的是 Putty，您可以确定它是安全的，因为许多 GUI FTP 客户端似乎都在使用 Putty。您肯定知道您使用的是 SSH2 而不是 SSH。

缺点：我尝试的两个命令行实用程序（Putty 和 Cygwin）需要将 SFTP 密码存储在不安全的位置。我还没有找到在上传文件时捕获失败或错误的好方法。这个过程看起来和闻起来都不像 SSIS。大多数代码都封装在文本文件中，而不是 SSIS 本身。如果您不知道要上传或下载的文件的确切名称，则很难使用。

第三方 C# 或 VB.NET 库

方法：安装 SFTP 或 FTPS 库并使用引用该库的脚本任务来上传文件。（我从来没有尝试过，所以我会猜测利弊）

优点：可能很容易捕获错误。应该可以很好地使用变量，因此即使您不知道要上传或下载的文件的确切名称，它也可能很容易使用。

缺点：这是一个结合 .NET 库的脚本任务。如果您使用的是 SSIS，那么您可能更喜欢 SSIS 任务而不是 .NET 代码。脚本任务也很难排除故障，因为它们没有与常规 .NET 项目相同的调试工具和功能。创建对 3rd 方代码的依赖项，该依赖项可能在不同版本的 SQL Server 之间不起作用。公平地说，它可能比第 3 方 SSIS 任务库更可能在不同版本的 SQL Server 之间工作。另一个巨大的骗局——到目前为止，我还没有找到一个免费的 C# 或 VB.NET 库。所以如果有人知道，请告诉我！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-04T00:01:58.860

以下问题可能有用：

[执行 SFTP 或 FTPS 任务的 SSIS 组件的推荐选择是什么？](https://stackoverflow.com/questions/152981/recommend-one-favorite-ssis-component-that-does-sftp-ftps)

**Cozyroc：**

通过将服务器设置为“仅允许 SSHv2”并进行测试，应该很容易测试 ssh 协议的可用性。您是否尝试过询问 Cozy 的销售部门？

**命令行 sftp：**

未知文件名问题可以通过简单的脚本/通配符的使用来解决（至少在 Cygwin 下）。

**第 3 方库：**

为什么 FTPS 需要第三方库？.NET 从 2.0 左右开始就支持这个协议。

[http://msdn.microsoft.com/en-us/library/system.net.ftpwebrequest.enablessl.aspx](http://msdn.microsoft.com/en-us/library/system.net.ftpwebrequest.enablessl.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-13T15:38:34.183

我只是想提供有关我们实际决定采取哪些措施来解决 SSIS 中的 SFTP 问题的更新。以下是发生的事情的细分：

1.  我最初尝试使用 Putty 和一些批处理文件来上传文件，但很难捕获错误。此外，我将 SFTP 凭据存储在明文文件中，因为它是 Putty 上传脚本的一部分。

2.  我们以每年几百美元的价格为我们的 SSIS 服务器购买了 CozyRoc 许可证，我对使用他们产品的结果完全满意。使用 CozyRoc 的产品，如果上传有任何问题，控制流任务会引发错误。由于我的团队中还有几位初级 SSIS 程序员，因此他们更容易理解如何设置控制流任务，而不是使用 Putty 脚本方法。最后，使用 SSIS 的本机加密对密码进行加密，以保护敏感数据。我的服务器上不再有任何以明文形式存储的密码。

我确实查看了此问题中推荐的其他一些 3rd 方库，但 CozyRoc 似乎是供应商中最便宜的，而且他们还有一些其他 SSIS 任务，我可以在我的 BI 团队中使用。谢谢，舒适洛克！

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2011-04-27T06:34:38.440

没有组件，您可以使用脚本任务。看到[这个链接](http://www.xoowiki.com/en-US/Article/SQL-Server/ssis-sftp-task-475.aspx)

```
Imports System
Imports Microsoft.SqlServer.Dts.Runtime
Imports Ftp
Imports System.IO

Public Class ScriptMain

    Public Sub Main()

        Try

            Dim cm As ConnectionManager = Dts.Connections.Add("FTP")
            cm.Properties("ServerName").SetValue(cm, Dts.Variables("SFTPServerName").Value.ToString)
            cm.Properties("ServerUserName").SetValue(cm, Dts.Variables("SFTPLogin").Value.ToString)
            cm.Properties("ServerPassword").SetValue(cm, Dts.Variables("SFTPPassword").Value.ToString)
            cm.Properties("ServerPort").SetValue(cm, Dts.Variables("SFTPPortNumber").Value.ToString)
            cm.Properties("Timeout").SetValue(cm, "0")
            cm.Properties("ChunkSize").SetValue(cm, "0") '1000 kb
            cm.Properties("Retries").SetValue(cm, "0")
            Dts.Variables("Continue").Value = 0

            Dim ftp As FtpClientConnection = New FtpClientConnection(cm.AcquireConnection(Nothing))
            Dim FilesList() As String
            Dim FolderName() As String

            Dim Separator As String = ";"
' \\ServerName\Share1;\\ServerName\Share2 : Local copy
            Dim FolderLocalListSrc As String = Dts.Variables("FolderLocalListSrc").Value.ToString
            Dim FolderLocalListDst() As String = Split(FolderLocalListSrc, Separator)
            Dim Counter As Integer

            ftp.Connect()
            ftp.GetListing(FolderName, FilesList)

            If FilesList IsNot Nothing Then

                Dim FileName As String

                For Each FileName In FilesList

                    Dim FileToProcess(0) As String
                    Dim FileToMove(0) As String

                    For Counter = 0 To FolderLocalListDst.GetUpperBound(0)

                        FileToProcess(0) = FileName
                        FileToMove(0) = FolderLocalListDst(Counter) + FileName

                        If (File.Exists(FileToMove(0)) = False) Then

                            ' Téléchargement en local
                            ftp.ReceiveFiles(FileToProcess, FolderLocalListDst(Counter), True, True)

                        End If

                    Next

                    ' Upload du fichier dans les archives du FTP
                    ftp.SendFiles(FileToMove, "/Archives", True, False)

                    ' Suppression du fichier à la racine du FTP
                    ftp.DeleteFiles(FileToProcess)

                Next

            End If

            ftp.Close()

            Dts.TaskResult = Dts.Results.Success
        Catch ex As Exception
            Dts.TaskResult = Dts.Results.Failure
        End Try

    End Sub

End Class 
```

# php - 如何将值从外部页面传递到框架内？

> ID：409492
> 
> 赞同：1
> 
> 时间：2009-01-03T18:04:34.167
> 
> 标签：php, html

我在一个页面中有一个文件，这个名为（mainframe.php）的页面是一个包含两个子框架文件（文件 1：topframe.php，文件 2 底部 frame.php）的框架集，我需要从外部页面传递一个值（文件：extarnalpage.php）到框架内（顶框和底框）。但我不能这样做......页面如下：

*   大型机.php

..................................................

*   topframe.php

顶框顶框内容

?>

..................................................... ......

*   底部框架.php

底框底框内容

.....................................................

*   外部页面.php

底框底框内容

..................................................... ……

我的问题是如何从 externalpage.php 到 topframe.php 和 bottomframe.php 获取文本的值。谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-04T10:54:13.960

想到的是会话。

会话存储在服务器上，它是这样的：

**在会话中设置变量：**

```
<?php
session_start();

$_SESSION['some_variable_name_1']='some_variable_value_1';
$_SESSION['some_variable_name_2']='some_variable_value_2';
...
$_SESSION['some_variable_name_n']='some_variable_value_n';
?> 
```

**从其他页面上的会话中检索变量：**

```
<?php
session_start();

$some_variable_value_1 = $_SESSION['some_variable_name_1'];
$some_variable_value_2 = $_SESSION['some_variable_name_2'];
...
$some_variable_value_n = $_SESSION['some_variable_name_n'];
?> 
```

有关会话的更多信息，[请访问 http://www.php.net/session](http://www.php.net/session)

但我真的鼓励您保留框架和表格，并使用 css 进行元素定位 - 它更容易，并且您获得更具可读性的 html。

# language-agnostic - 如何将数据验证与我的简单域对象 (POCO) 分开？

> ID：409495
> 
> 赞同：8
> 
> 时间：2009-01-03T18:05:35.743
> 
> 标签：language-agnostic, separation-of-concerns, solid-principles, modular-design

这个问题与语言无关，但我是 C# 人，所以我使用 POCO 一词来表示仅执行数据存储的对象，通常使用 getter 和 setter 字段。

我刚刚将我的域模型重新设计为超级骗子 POCO，并且对如何确保属性值在域中有意义存在一些担忧。

例如，服务的结束日期不应超过该服务所依据的合同的结束日期。但是，将检查放入 Service.EndDate 设置器似乎违反了 SOLID，更不用说随着需要完成的验证数量的增加，我的 POCO 类将变得混乱。

我有一些解决方案（将在答案中发布），但它们有其缺点，我想知道解决这个困境的一些最喜欢的方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-03T18:24:27.747

我认为您从一个错误的假设开始，即您应该拥有除了存储数据之外什么都不做的对象，并且除了访问器之外没有任何方法。拥有对象的全部意义在于封装数据*和行为*。如果你有一个基本上只是一个结构的东西，你封装了什么行为？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-03T18:12:51.267

我总是听到人们争论“Validate”或“IsValid”方法。

我个人认为这可能有效，但对于大多数 DDD 项目，您通常最终会得到多个验证，这些验证是允许的，具体取决于对象的特定状态。

所以我更喜欢“IsValidForNewContract”、“IsValidForTermination”或类似的，因为我相信大多数项目最终每个类都有多个这样的验证器/状态。这也意味着我没有接口，但我可以编写聚合的验证器，这些验证器可以*很好*地反映我所断言的业务条件。

我真的相信，在这种情况下，通用解决方案通常会将注意力*从*重要的事情（代码正在做什么）上转移，以在技术优雅（接口、委托或其他方面）方面获得非常小的收益。就投票给我吧；）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-10-14T19:22:05.313

我的一位同事提出了一个非常有效的想法。我们从来没有为它想出一个好名字，但我们称它为 Inspector/Judge。

检查员会查看一个对象并告诉您它违反的所有规则。法官将决定如何处理。这种分离让我们做一些事情。它让我们将所有规则放在一个地方（检查员），但我们可以有多个法官并根据上下文选择法官。

使用多个法官的一个例子是围绕客户必须有地址的规则展开​​的。这是一个标准的三层应用程序。在 UI 层，Judge 会生成一些 UI 可以用来指示必须填写的字段的内容。UI Judge 没有抛出异常。在服务层有另一个法官。如果它在保存期间发现没有地址的客户，它将引发异常。到那时，您真的必须阻止事情继续进行。

随着对象状态的变化，我们也有更严格的法官。这是一份保险申请，在报价过程中，允许将保单保存为不完整的状态。但是，一旦该策略准备好激活，就必须设置很多东西。所以服务端的报价法官没有激活法官那么严格。然而，Inspector 中使用的规则仍然是相同的，因此即使您决定不做任何事情，您仍然可以分辨出哪些是不完整的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-03T18:13:34.680

一种解决方案是让每个对象的 DataAccessObject 获取一个验证器列表。当 Save 被调用时，它会对每个验证器进行检查：

```
public class ServiceEndDateValidator : IValidator<Service> {
  public void Check(Service s) {
    if(s.EndDate > s.Contract.EndDate)
      throw new InvalidOperationException();
  }
}

public class ServiceDao : IDao<Service> {
  IValidator<Service> _validators;
  public ServiceDao(IEnumerable<IValidator<Service>> validators) {_validators = validators;}
  public void Save(Service s) {
    foreach(var v in _validators)
      v.Check(service);
    // Go on to save
  }
} 
```

好处是非常明确的 SoC，缺点是在调用 Save() 之前我们不会得到检查。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-03T20:19:31.867

过去，我通常将验证委托给它自己的服务，例如 ValidationService。原则上，这仍然符合 DDD 的理念。

在内部，这将包含一个验证器集合和一组非常简单的公共方法，例如 Validate()，它可以返回一个错误对象的集合。

很简单，在 C# 中是这样的

```
public class ValidationService<T>
{
  private IList<IValidator> _validators;

  public IList<Error> Validate(T objectToValidate)
  {
    foreach(IValidator validator in _validators)
    {
      yield return validator.Validate(objectToValidate);
    }
  }
} 
```

验证器可以添加到默认构造函数中，也可以通过其他一些类（例如 ValidationServiceFactory）注入。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-03T18:11:25.620

实际上，我认为这可能是逻辑的最佳位置，但这只是我。您可以使用某种 IsValid 方法来检查所有条件并返回真/假，也许是某种 ErrorMessages 集合，但这是一个不确定的主题，因为错误消息实际上并不是域模型的一部分。我有点偏见，因为我已经对 RoR 做了一些工作，这基本上就是它的模型所做的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-03T18:18:21.863

另一种可能性是让我的每个类都实现

```
public interface Validatable<T> {
  public event Action<T> RequiresValidation;
} 
```

并让每个类的每个设置器在设置之前引发事件（也许我可以通过属性来实现）。

优点是实时验证检查。但更混乱的代码，不清楚谁应该做附件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-04T01:46:12.443

这是另一种可能性。验证是通过 Domain 对象上的代理或装饰器完成的：

```
public class ServiceValidationProxy : Service {
  public override DateTime EndDate {
    get {return EndDate;}
    set {
      if(value > Contract.EndDate)
        throw new InvalidOperationexception();
      base.EndDate = value;
    }
  }
} 
```

优点：即时验证。可以通过 IoC 轻松配置。

缺点：如果是代理，经过验证的属性必须是虚拟的，如果是装饰器，所有域模型都必须是基于接口的。验证类最终会有点重量级——代理必须继承类，装饰器必须实现所有方法。命名和组织可能会令人困惑。

# php - 防止直接访问 php 包含文件

> ID：409496
> 
> 赞同：176
> 
> 时间：2009-01-03T18:07:11.697
> 
> 标签：php, include, include-guards

我有一个 php 文件，我将专门用作包含。因此，当通过键入 URL 而不是被包含在内直接访问它时，我想抛出一个错误而不是执行它。

基本上我需要在 php 文件中进行如下检查：

```
if ( $REQUEST_URL == $URL_OF_CURRENT_PAGE ) die ("Direct access not premitted"); 
```

是否有捷径可寻？

* * *

## 回答 #1

> 赞同：212
> 
> 时间：2009-01-03T18:15:10.683

将此添加到您只想包含的页面

```
<?php
if(!defined('MyConst')) {
   die('Direct access not permitted');
}
?> 
```

然后在包含它的页面上添加

```
<?php
define('MyConst', TRUE);
?> 
```

* * *

## 回答 #2

> 赞同：183
> 
> 时间：2009-01-03T18:14:15.863

对于通用的“在您可能完全控制或可能不完全控制的 Apache 服务器上运行的 PHP 应用程序”情况，最简单的方法是将您的包含放在一个目录中，并在您的 .htaccess 文件中拒绝访问该目录。为了省去谷歌搜索的麻烦，如果您使用的是 Apache，请将其放在您不想访问的目录中名为“.htaccess”的文件中：

```
Deny from all 
```

如果您实际上可以完全控制服务器（这些天甚至对于小应用程序比我第一次写这个答案时更常见），最好的方法是将要保护的文件粘贴到您的 Web 服务器提供服务的目录之外. 因此，如果您的应用程序位于 中`/srv/YourApp/`，请将服务器设置为从其中提供文件`/srv/YourApp/app/`并将包含内容放入 中`/srv/YourApp/includes`，因此实际上没有任何 URL 可以访问它们。

* * *

## 回答 #3

> 赞同：120
> 
> 时间：2009-01-03T20:09:39.237

我有一个文件，当它被包含与直接访问时（主要是`print()`vs `return()`），我需要采取不同的行动。这是一些修改后的代码：

```
if(count(get_included_files()) ==1) exit("Direct access not permitted."); 
```

被访问的文件始终是包含文件，因此 == 1。  

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2014-03-27T05:00:56.170

### 1：检查包含文件的数量

```
if( count(get_included_files()) == ((version_compare(PHP_VERSION, '5.0.0', '>='))?1:0) )
{
    exit('Restricted Access');
} 
```

**逻辑：**如果未满足最小包含计数，则 PHP 退出。请注意，在 PHP5 之前，基本页面不被视为包含。

* * *

### 2：定义和验证一个全局常量

```
// In the base page (directly accessed):
define('_DEFVAR', 1);

// In the include files (where direct access isn't permitted):
defined('_DEFVAR') or exit('Restricted Access'); 
```

**逻辑：**如果未定义常量，则执行不是从基本页面开始，PHP 将停止执行。

***请注意**，为了跨升级和未来更改的可移植性，使这种身份验证方法模块化将显着减少编码开销，因为更改不需要对每个文件进行硬编码。*

```
// Put the code in a separate file instead, say 'checkdefined.php':
defined('_DEFVAR') or exit('Restricted Access');

// Replace the same code in the include files with:
require_once('checkdefined.php'); 
```

*通过这种方式，可以添加额外的代码* `checkdefined.php` *用于记录和分析目的，以及生成适当的响应。*

***应得的信用：**可移植性的绝妙想法来自[这个答案](https://stackoverflow.com/a/20420778/1543356)。然而，这种方法有一个缺点。不同文件夹中的文件可能需要不同的地址来寻址该文件。如果您从主站点的子文件夹中运行当前网站，则基于服务器根的寻址可能不起作用。*

* * *

### 3：远程地址授权

```
// Call the include from the base page(directly accessed):
$includeData = file_get_contents("http://127.0.0.1/component.php?auth=token");

// In the include files (where direct access isn't permitted):
$src = $_SERVER['REMOTE_ADDR']; // Get the source address
$auth = authoriseIP($src); // Authorisation algorithm
if( !$auth ) exit('Restricted Access'); 
```

这种方法的缺点是隔离执行，除非内部请求提供了会话令牌。在单服务器配置的情况下通过环回地址进行验证，或者在多服务器或负载平衡服务器基础架构的情况下通过地址白名单进行验证。

* * *

### 4：令牌授权

与前一种方法类似，可以使用 GET 或 POST 将授权令牌传递给包含文件：

```
if($key!="serv97602"){header("Location: ".$dart);exit();} 
```

当以正确的方式使用时，这是一种非常混乱的方法，但同时也可能是最安全和最通用的方法。

* * *

### 5：Webserver具体配置

大多数服务器允许您为单个文件或目录分配权限。您可以将所有包含在此类受限目录中，并将服务器配置为拒绝它们。

例如在 APACHE 中，配置存储在`.htaccess`文件中。教程[在这里](http://httpd.apache.org/docs/2.4/howto/htaccess.html)。

***但是请注意**，我不推荐特定于服务器的配置，因为它们不利于跨不同 Web 服务器的可移植性。在拒绝算法复杂或拒绝目录列表相当大的内容管理系统等情况下，它可能只会使重新配置会话相当可怕。最后最好在代码中处理这个问题。*

* * *

### 6：将包括放在站点根目录之外的安全目录中

由于服务器环境中的访问限制，最不受欢迎，但如果您可以访问文件系统，这是一种相当强大的方法。

```
//Your secure dir path based on server file-system
$secure_dir=dirname($_SERVER['DOCUMENT_ROOT']).DIRECTORY_SEPARATOR."secure".DIRECTORY_SEPARATOR;
include($secure_dir."securepage.php"); 
```

逻辑：

*   用户不能请求文件`htdocs`夹之外的任何文件，因为链接将超出网站地址系统的范围。
*   php 服务器本机访问文件系统，因此可以访问计算机上的文件，就像具有所需权限的普通程序一样。
*   通过将包含文件放在此目录中，您可以确保 php 服务器可以访问它们，同时拒绝用户进行热链接。
*   即使网络服务器的文件系统访问配置没有正确完成，这种方法也可以防止这些文件意外公开。

* * *

*请原谅我非正统的编码约定。任何反馈表示赞赏。*

* * *

## 回答 #5

> 赞同：37
> 
> 时间：2009-01-03T18:14:13.620

防止直接访问文件的最佳方法是将它们放在 Web 服务器文档根目录之外（通常是上一层）。您仍然可以包含它们，但不可能有人通过 http 请求访问它们。

我通常一路走下去，将我所有的 PHP 文件放在文档根目录之外，除了[引导文件](http://devzone.zend.com/node/view/id/70)- 文档根目录中的一个单独的 index.php 开始路由整个网站/应用程序。

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2009-01-03T18:48:18.010

Chuck 解决方案的替代方案（或补充方案）是通过在 .htaccess 文件中添加类似内容来拒绝访问与特定模式匹配的文件

```
<FilesMatch "\.(inc)$">
    Order deny,allow
    Deny from all
</FilesMatch> 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2009-01-03T19:00:08.300

实际上我的建议是做所有这些最佳实践。

*   将文档放在 webroot 之外或在网络服务器拒绝访问的目录中，并且
*   在隐藏文档检查的可见文档中使用定义：

```
 if (!defined(INCL_FILE_FOO)) {
          header('HTTP/1.0 403 Forbidden');
          exit;
      } 
```

这样，如果文件以某种方式放错了位置（错误的 ftp 操作），它们仍然受到保护。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2010-03-09T21:56:46.180

我曾经遇到过这个问题，解决了：

```
if (strpos($_SERVER['REQUEST_URI'], basename(__FILE__)) !== false) ... 
```

但理想的解决方案是将文件放在 Web 服务器文档根目录之外，如另一个 anwser 中所述。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2017-11-08T08:27:09.427

我想直接限制对**PHP**文件的访问，但也可以通过`jQuery $.ajax (XMLHttpRequest)`. 这对我有用。

```
if (empty($_SERVER["HTTP_X_REQUESTED_WITH"]) && $_SERVER["HTTP_X_REQUESTED_WITH"] != "XMLHttpRequest") {
    if (realpath($_SERVER["SCRIPT_FILENAME"]) == __FILE__) { // direct access denied
        header("Location: /403");
        exit;
    }
} 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2013-03-28T23:51:15.757

你最好用一个入口点构建应用程序，即所有文件都应该从 index.php 到达

把它放在 index.php 中

```
define(A,true); 
```

此检查应在每个链接文件中运行（通过要求或包含）

```
defined('A') or die(header('HTTP/1.0 403 Forbidden')); 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-01-03T18:12:21.813

最简单的方法是在调用include的文件中设置一些变量，比如

```
$including = true; 
```

然后在包含的文件中，检查变量

```
if (!$including) exit("direct access not permitted"); 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-01-22T23:27:32.213

```
debug_backtrace() || die ("Direct access not permitted"); 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2013-12-06T09:48:38.283

我的答案在方法上有所不同，但包括此处提供的许多答案。我会推荐一个多管齐下的方法：

1.  .htaccess 和 Apache 的限制是肯定的
2.  `defined('_SOMECONSTANT') or die('Hackers! Be gone!');`

**然而**，这种`defined or die`方法有许多失败之处。首先，测试和调试的假设是一个真正的痛苦。其次，如果你改变主意，它会涉及到可怕的、令人麻木的、无聊的重构。“查找和替换！” 你说。是的，但是你有多确定它在任何地方都写得完全一样，嗯？现在将它与数千个文件相乘...... oO

然后是.htaccess。如果您的代码被分发到管理员不那么谨慎的网站上会发生什么？如果您仅依靠 .htaccess 来保护您的文件，您还需要 a) 备份，b) 一盒用来擦干眼泪的纸巾，c) 一个灭火器来扑灭来自人们的所有仇恨邮件中的火焰使用您的代码。

所以我知道这个问题要求“最简单”，但我认为这需要更多“防御性编码”。

我的建议是：

1.  在您的任何脚本之前`require('ifyoulieyougonnadie.php');`（**不是** `include()`并且作为替代`defined or die`）
2.  在`ifyoulieyougonnadie.php`中，做一些逻辑工作——检查不同的常量、调用脚本、本地主机测试等——然后实现你的`die(), throw new Exception, 403`等。

    我正在使用两个可能的入口点创建自己的框架——主要的 index.php（Joomla 框架）和 ajaxrouter.php（我的框架）——所以根据入口点，我检查不同的东西。如果请求`ifyoulieyougonnadie.php`不是来自这两个文件之一，我知道正在进行恶作剧！

    但是如果我添加一个新的入口点呢？不用担心。我只是改变`ifyoulieyougonnadie.php`，我被排序，加上没有“查找和替换”。万岁！

    如果我决定移动我的一些脚本来做一个没有相同常量的不同框架怎么办`defined()`？...万岁！^_^

我发现这种策略使开发变得更有趣，但更少：

```
/**
 * Hmmm... why is my netbeans debugger only showing a blank white page 
 * for this script (that is being tested outside the framework)?
 * Later... I just don't understand why my code is not working...
 * Much later... There are no error messages or anything! 
 * Why is it not working!?!
 * I HATE PHP!!!
 * 
 * Scroll back to the top of my 100s of lines of code...
 * U_U
 *
 * Sorry PHP. I didn't mean what I said. I was just upset.
 */

 // defined('_JEXEC') or die();

 class perfectlyWorkingCode {}

 perfectlyWorkingCode::nowDoingStuffBecauseIRememberedToCommentOutTheDie(); 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-01-04T13:06:53.613

除了 .htaccess 方式之外，我还在各种框架中看到了一种有用的模式，例如在 ruby​​ on rails 中。它们在应用程序根目录中有一个单独的 pub/ 目录，而库目录位于与 pub/**相同级别**的目录中。像这样的东西（不理想，但你明白了）：

```
app/
 |
 +--pub/
 |
 +--lib/
 |
 +--conf/
 |
 +--models/
 |
 +--views/
 |
 +--controllers/ 
```

您将 Web 服务器设置为使用 pub/ 作为文档根目录。这为您的脚本提供了更好的保护：虽然它们可以从文档根目录中访问以加载必要的组件，但无法从 Internet 访问这些组件。除了安全性之外的另一个好处是一切都在一个地方。

此设置比仅在每个包含的文件中创建检查要好，因为“不允许访问”消息是攻击者的线索，并且比 .htaccess 配置更好，因为它不是基于白名单的：如果你搞砸了文件扩展名它在 lib/、conf/ 等目录中不可见。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2010-05-07T13:11:11.747

什么Joomla！确实是在根文件中定义一个常量并检查是否在包含的文件中定义了相同的常量。

```
defined('_JEXEC') or die('Restricted access'); 
```

要不然

正如大多数框架（如 CodeIgniter）所推荐的那样，可以通过将所有文件放在 webroot 目录之外来将所有文件放在 http 请求的范围之外。

甚至通过在包含文件夹中放置一个 .htaccess 文件并编写规则，您可以防止直接访问。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2015-05-08T21:37:03.793

如果更准确地说，你应该使用这个条件：

```
if (array_search(__FILE__, get_included_files()) === 0) {
    echo 'direct access';
}
else {
    echo 'included';
} 
```

[get_included_files()](http://php.net/manual/en/function.get-included-files.php)返回包含所有包含文件的名称的索引数组（如果文件被执行，则它被包含并且它的名称在数组中）。因此，当直接访问文件时，它的名称是数组中的第一个，数组中的所有其他文件都被包括在内。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-01-03T18:18:48.117

执行以下操作：

```
<?php
if ($_SERVER['SCRIPT_FILENAME'] == '<path to php include file>') {
    header('HTTP/1.0 403 Forbidden');
    exit('Forbidden');
}
?> 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2010-05-07T13:00:37.817

```
<?php
if (eregi("YOUR_INCLUDED_PHP_FILE_NAME", $_SERVER['PHP_SELF'])) { 
 die("<h4>You don't have right permission to access this file directly.</h4>");
}
?> 
```

将上面的代码放在包含的 php 文件的顶部。

前任：

```
<?php
if (eregi("some_functions.php", $_SERVER['PHP_SELF'])) {
    die("<h4>You don't have right permission to access this file directly.</h4>");
}

    // do something
?> 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2010-07-18T00:44:38.763

[Flatnux CMS ( http://flatnux.altervista.org](http://flatnux.altervista.org) )中使用了以下代码：

```
if ( strpos(strtolower($_SERVER['SCRIPT_NAME']),strtolower(basename(__FILE__))) )
{
    header("Location: ../../index.php");
    die("...");
} 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2011-02-16T16:08:30.693

我发现这个仅适用于 php 且不变的解决方案适用于 http 和 cli ：

定义一个函数：

```
function forbidDirectAccess($file) {
    $self = getcwd()."/".trim($_SERVER["PHP_SELF"], "/");
    (substr_compare($file, $self, -strlen($self)) != 0) or die('Restricted access');
} 
```

在文件中调用要阻止直接访问的函数：

```
forbidDirectAccess(__FILE__); 
```

上面针对这个问题给出的大多数解决方案都不适用于 Cli 模式。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2013-10-01T11:17:53.280

```
if (basename($_SERVER['PHP_SELF']) == basename(__FILE__)) { die('Access denied'); }; 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2014-03-08T04:42:26.697

```
<?php       
$url = 'http://' . $_SERVER['SERVER_NAME'] . $_SERVER['REQUEST_URI'];
  if (false !== strpos($url,'.php')) {
      die ("Direct access not premitted");
  }
?> 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2019-03-08T15:35:33.950

多次提到将包含文件存储在 Web 可访问目录之外，并且在可能的情况下肯定是一个好策略。但是，我还没有提到另一个选项：确保您的包含文件*不包含任何可运行代码*。如果你的包含文件只定义了函数和类，没有其他代码，直接访问它们只会产生一个空白页。

无论如何允许从浏览器直接访问这个文件：它*不会做任何事情*。它定义了一些函数，但没有一个被调用，所以它们都没有运行。

```
<?php

function a() {
    // function body
}

function b() {
    // function body
} 
```

这同样适用于仅包含 PHP 类的文件，而没有其他内容。

* * *

尽可能将文件保存在 Web 目录之外仍然是一个好主意。

*   您可能不小心停用了 PHP，在这种情况下，您的服务器可能会将 PHP 文件的内容发送到浏览器，而不是运行 PHP 并发送结果。这可能会导致您的代码（包括数据库密码、API 密钥等）泄露。
*   web 目录中的文件占用了您可能希望用于您的应用程序的 URL。我使用的 CMS 不能有一个名为 的页面`system`，因为这会与用于代码的路径冲突。我觉得这很烦人。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2011-09-10T00:53:10.860

您可以使用下面的方法，但它确实存在缺陷，因为它可以被伪造，除非您可以添加另一行代码以确保请求仅来自您的服务器，或者使用 Javascript。您可以将此代码放在 HTML 代码的 Body 部分中，以便在那里显示错误。

```
<?
if(!isset($_SERVER['HTTP_REQUEST'])) { include ('error_file.php'); }
else { ?> 
```

将您的其他 HTML 代码放在这里

```
<? } ?> 
```

像这样结束它，因此错误的输出将始终显示在正文部分中，如果这是您想要的那样。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2012-04-23T15:56:45.833

我建议不要`$_SERVER`出于安全原因使用。
您可以使用`$root=true;`包含另一个文件的第一个文件中的变量。
并`isset($root)`在包含的第二个文件的开头使用。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2013-02-05T17:30:26.227

您还可以做的是密码保护目录并将所有 php 脚本保存在其中，当然除了 index.php 文件，因为在包含密码时不需要，因为它仅用于 http 访问。它还会为您提供访问脚本的选项，以防您需要它，因为您将拥有访问该目录的密码。您需要为该目录​​设置 .htaccess 文件和一个 .htpasswd 文件来验证用户身份。

好吧，您也可以使用上面提供的任何解决方案，以防您觉得不需要正常访问这些文件，因为您始终可以通过 cPanel 等访问它们。

希望这可以帮助

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2013-08-14T14:34:13.413

最简单的方法是将包含的内容存储在 web 目录之外。这样服务器就可以访问它们，但没有外部机器。唯一的缺点是您需要能够访问服务器的这一部分。好处是它不需要设置、配置或额外的代码/服务器压力。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2015-09-10T08:17:30.443

我没有发现 .htaccess 的建议这么好，因为它可能会阻止该文件夹中您可能希望允许用户访问的其他内容，这是我的解决方案：

```
$currentFileInfo = pathinfo(__FILE__);
$requestInfo = pathinfo($_SERVER['REQUEST_URI']);
if($currentFileInfo['basename'] == $requestInfo['basename']){
    // direct access to file
} 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2015-12-17T19:16:56.343

前面提到的添加了 PHP 版本检查的解决方案：

```
 $max_includes = version_compare(PHP_VERSION, '5', '<') ? 0 : 1;
    if (count(get_included_files()) <= $max_includes)
    {
        exit('Direct access is not allowed.');
    } 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2017-01-31T08:23:43.043

您可以使用 phpMyAdmin 样式：

```
/**
 * block attempts to directly run this script
 */
if (getcwd() == dirname(__FILE__)) {
    die('Attack stopped');
} 
```

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2015-10-16T12:38:13.820

```
if ( ! defined('BASEPATH')) exit('No direct script access allowed'); 
```

会顺利完成工作

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2017-05-27T20:06:31.733

从该文件重定向到其他页面。（如 index.html）

.ht 访问：

```
Redirect 301 LINK_TO_YOUR_PHP LINK_TO_INDEX.HTML 
```

* * *

## 回答 #33

> 赞同：-7
> 
> 时间：2011-10-02T15:50:32.457

您也可以尝试重命名您不希望人们能够访问的文档。例如，您可以将其重命名为 47d8498d3w.php。只是编造一些人们很可能不会作为 http 请求输入的内容。如果您在 SSI 或 PHP 中包含该文件，则用户无论如何都无法看到该文档的名称。

# powershell - PowerShell 可以编写 SQL Server Reporting Services RDL 文件的脚本吗？

> ID：409507
> 
> 赞同：6
> 
> 时间：2009-01-03T18:13:11.700
> 
> 标签：powershell, reporting-services, reporting, service

是否可以使用 PowerShell 在 SQL Server 2008 中编写 SQL Server Reporting Services rdl 文件的脚本？如果是这样，有人可以提供这样做的代码示例吗？这将是使用 3rd 方工具编写由我的商业智能部门之外的业务用户创建的 RDL 文件的有用替代品。

*澄清“脚本输出”一词*

通过“脚本输出”，我的意思是我想为服务器上的每个报告自动生成底层 RDL 文件。例如，当您在 BIDS 中编写报告代码时，您正在生成一个 RDL 文件。当您将文件部署到服务器时，该文件以某种方式导入到 SQL Server ReportServer 数据库中，并且不再是单独的物理 RDL 文件。我想以 RDL 文件格式从服务器中提取所有报告。

我使用 RSScripter 工具将报告提取为 RDL 文件，因此我知道可以使用 PowerShell 以外的工具。我特别想知道是否可以使用 PowerShell 来执行此操作，如果可以，请获取执行此操作的代码示例。

*关于我为什么要生成报告的 RDL 版本的说明*

为什么将报告“脚本化”为 RDL 文件很重要？我想每晚一次将 RDL 文件签入我的源代码控制系统，以跟踪由我的商业智能部门以外的用户创建的所有报告。自从我们在 BIDS 中开发报告以来，我已经跟踪了我的部门生成的所有报告，但是我无法跟踪在线 Report Builder 工具中构建的报告的版本控制历史。

*澄清为什么使用 POWERSHELL 而不是其他东西*

1.  好奇心。我有一个我知道可以通过两种方法（API 或 RSSCripter）之一解决的问题，我想知道它是否可以通过第三种方法解决。

2.  有机会通过 PowerShell 扩展我的问题解决工具集。使用 PowerShell 解决这个问题可能会为学习如何使用 PowerShell 解决我尚未尝试解决的其他问题提供基础。

3.  对于我和我的团队来说，PowerShell 更容易理解。一般来说，我和我的团队成员可以比 .NET 代码更容易理解 PowerShell 代码。虽然我知道这个问题可以通过使用 API 的一些 .NET 代码来解决（毕竟这就是 RSScripter 的工作方式），但我觉得我们编写和维护 PowerShell 脚本会更容易。我还意识到 PowerShell 脚本可能会使用 .NET 代码，但我希望 PowerShell 已经能够以某种方式将报告视为对象，因此我不必使用 Reporting Services API 来提取文件。

4.  RSScripter 还不支持 2008。过去，我使用 RSScript 编写报告脚本。不幸的是，它似乎还不支持 2008。这意味着我现在必须针对 API 编写代码，因为这是我目前知道如何以自动无人值守方式提取文件的唯一方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-03-29T06:45:56.517

有点晚了，但是给你

此 PowerShell 脚本： 1\. 连接到您的报表服务器 2\. 创建与报表服务器中相同的文件夹结构 3\. 将所有 SSRS 报表定义 (RDL) 文件下载到各自的文件夹中

[https://sqlbelle.wordpress.com/2011/03/28/how-to-download-all-your-ssrs-report-definitions-rdl-files-using-powershell/](https://sqlbelle.wordpress.com/2011/03/28/how-to-download-all-your-ssrs-report-definitions-rdl-files-using-powershell/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-03T19:38:02.153

PowerShell 不为此提供任何原生的 PowerShell 式功能，不。您可以在 PowerShell 中执行此操作（如上一个答案中所述），仅因为 PowerShell 可以访问底层框架类。正如您在对上一个答案的评论中指出的那样，这与在 C# 或 VB 中使用 API 没有什么不同。

SQL Server 团队还没有提供太多特定于 PowerShell 的东西。他们主要依赖 .NET 和 T-SQL 作为“脚本语言”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-07-07T21:26:12.367

我刚刚意识到 ReportServer.dbo.Catalog 中的 Content 列包含 Image 格式的定义。我编写了以下代码将其转换为可读文本：

```
SELECT CONVERT(VARCHAR(MAX), CONVERT(NVARCHAR(MAX), CONVERT(XML, CONVERT(VARBINARY(MAX), Content))))
FROM [ReportServer].[dbo].[Catalog]
WHERE Type = 2 
```

使用上面的代码，我现在可以自动将结果写入平面文件，然后将文件导入我的版本控制系统。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T18:18:27.743

任何支持 .Net 的东西都可以做到这一点。有关 API 文档的一些链接，请参阅[此 Stackoverflow 帖子](https://stackoverflow.com/questions/407367/list-reports-with-inline-sql-in-sql-server-reporting-services#407433)。这个过程实际上相当简单——API 调用上传或下载 .rdl 文件。

报告模型有点复杂。如果您上传新的报告模型，您必须获取相关报告（再次调用 API）并重新连接数据源。再次，不是很费劲。

Powershell 应该可以做到这一点。我已经用 IronPython 和 C# 做了各种不同的事情。还有一个名为 rs.exe 的工具，它接受一个 vb.net 脚本，在它的顶部和尾部添加一些包含，然后在后台编译和运行它。

# vba - 从查询中调用自定义 VBA 函数

> ID：409512
> 
> 赞同：0
> 
> 时间：2009-01-03T18:14:16.113
> 
> 标签：vba, ms-access

是否可以从该数据库中编写的查询中调用保存在同一 Access Db 中的自定义 VB 函数，如果可以，如何？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T18:23:15.770

是的，您可以从 Access 查询中调用宏或函数。公开您的功能。然后在你的 SQL 中调用它，如下所示：

```
 CustomFunction([field]) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T18:41:14.860

好的，这是交易，Paul W.

在我提出这个问题之前，我试图完成这项工作，并且经过反思（不是 .NET 类型的！）我认为我的问题可能需要更多的阐述。

当您回答时（我认为您的回答也可能需要更多详细说明），它似乎与我尝试过的没有什么不同，所以我再次查看了我的代码。我发现了一个愚蠢的错误，它阻止我得到我正在寻找的结果。我已经修好了，现在一切都很好。

所以，最后，我没有问真正困扰我的问题，因此你没有给我我正在寻找的解决方案。但是，你确实让我找到了解决方案，所以我想给你你的道具。但是，我显然还没有足够的声誉来接受您的回答或对此发表评论，所以这个回复将不得不这样做。（我一直点击复选标记，但没有任何反应。）

# python - 避免异常？

> ID：409529
> 
> 赞同：8
> 
> 时间：2009-01-03T18:19:50.830
> 
> 标签：python, django, exception

此特定示例与 Python 中的 Django 相关，但应适用于任何支持异常的语言：

```
try:
    object = ModelClass.objects.get(search=value)
except DoesNotExist:
    pass

if object:
    # do stuff 
```

Django 模型类提供了一个简单的方法*get*，它允许我从数据库中搜索*一个且只有一个*对象，如果它或多或少地找到它会引发异常。*如果可以使用另一种过滤*方法找到零个或多个，该方法返回一个列表：

```
objects = ModelClass.objects.filter(search=value)
if len(objects) == 1:
    object = objects[0]
    # do stuff 
```

**我是否过于厌恶例外？**对我来说，例外似乎有点浪费，据猜测，四分之一到一半的时间将是“例外”。我更喜欢在失败时返回*None的函数。*我会更好地使用Django的*过滤*方法并自己处理列表吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-03T23:57:18.123

信不信由你，这实际上是一个在每种语言中都有所不同的问题。在 Python 中，对于语言本身并非异常的事件，会定期抛出异常。因此我认为“你应该只在特殊情况下抛出异常”规则并不完全适用。我认为你在这个论坛上得到的结果会倾向于这个观点，考虑到大量的 .Net 程序员（参见[这个问题](https://stackoverflow.com/questions/351400/why-are-net-programmers-so-afraid-of-exceptions)）以获得更多信息）。

至少，我最好不要抓住任何坚持该规则的人在 Python 中使用生成器或 for 循环（这两者都涉及在非异常情况下抛出异常）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-03T19:52:37.587

围绕异常使用的编程语言存在很大分歧。

*   多数意见认为**例外应该是例外**。例如，在大多数带有异常的语言中，通过异常进行的控制转移比通过过程返回要昂贵得多。

*   有一种强烈的少数观点认为异常只是另一种控制流结构，它们应该很便宜。New Jersey和[Objective Caml](http://caml.inria.fr/)编译器的[标准 ML 都](http://www.smlnj.org/)同意该观点。如果你有便宜的例外，你可以编写一些花哨的回溯算法，这些算法使用其他机制更难以干净地编码。

我已经看到这种关于新语言设计的辩论重复了很多次，而且几乎总是获胜者认为异常应该是昂贵且罕见的。当您关心性能时，明智的做法是考虑到这一点进行编程。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-03T18:25:14.890

线索就在名称中-异常应该是异常的。

如果您总是希望该项目存在`get`，则使用`filter`.

因此，正如您指出的那样，预计不存在 1 比 2 和 1 比 4 之间的情况，我肯定会写一个包装器`filter`，因为这绝对不是例外情况。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-03T18:27:19.113

我同意另一个答案，但我想添加这样的异常传递会给您带来非常明显的性能影响。强烈建议您检查结果是否存在（如果这是过滤器所做的）而不是传递异常。

* * *

编辑：

为了响应对此的数字请求，我运行了这个简单的测试......

```
import time

def timethis(func, list, num):
  st=time.time()
  for i in xrange(0,1000000):
    try:
      func(list,num)
    except:
      pass
  et = time.time()
  print "Took %gs" % (et-st)

def check(list, num):
  if num < len(list):
    return list[num]
  else:
    return None

a=[1]
timethis(check, a, 1)
timethis(lambda x,y:x[y], a, 1) 
```

输出是..

```
Took 0.772558s
Took 3.4512s 
```

HTH。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-03T18:26:10.583

答案将取决于代码的意图。（我不确定您的代码示例是什么意思，例外情况下的传递令人困惑，其余代码将如何处理`object`变量？）

在许多情况下，是使用异常还是使用将情况视为非异常的方法是个人喜好问题。当然，如果 except 子句中的实际代码与您必须使用以避免异常的过滤器方法一样复杂，那么请使用过滤器方法。更简单的代码是更好的代码。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-03T18:57:31.817

对异常的厌恶是一个见仁见智的问题——但是，如果有理由相信一个函数或方法将被多次调用或快速调用，异常将导致显着减速。我从[之前的问题](https://stackoverflow.com/questions/395599/java-graphic-library-for-multicoloured-text)中了解到这一点，我之前依靠抛出的异常来返回默认值，而不是进行参数检查来返回该默认值。

当然，由于任何原因，异常仍然可能存在，如果有必要，您不应该害怕使用或抛出异常——尤其是那些可能破坏调用函数正常流程的异常。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-04T14:35:42.997

我不同意上面的评论，即在这种情况下异常是低效的，特别是因为它被用于 I/O 绑定操作。

这是一个使用 Django 和内存中 sqlite 数据库的更现实的示例。运行 100 个不同查询中的每一个，然后对 100 个运行中的每一个进行平均。虽然我怀疑这是否重要，但我也改变了执行顺序。

```
With ObjectDoesNotExist... 0.102783939838
Without exception ........ 0.105322141647

With ObjectDoesNotExist... 0.102762134075
Without exception ........ 0.101523952484

With ObjectDoesNotExist... 0.100004930496
Without exception ........ 0.107946784496 
```

您可以在自己的 Django 环境中对此进行检测，但我怀疑您的时间是否花在避免此异常上。

# java - 用于干净和简单的 gui 代码的模式和更多内容

> ID：409541
> 
> 赞同：7
> 
> 时间：2009-01-03T18:25:43.797
> 
> 标签：java, user-interface, design-patterns, gwt

每次我编写 gui 代码时（在我使用 GWT 的情况下，以前从未接触过 gui 编程），我注意到当应用程序变得更加复杂时，我的代码变得一团糟。

查看我的代码并为对象构造函数中的所有这些设置器以及这些杂乱无章的组合感到头疼，真是令人沮丧。

我正在使用 MVC 模式，它确实有助于更清晰。不幸的是，我的整个视图组件在任何时候都不清楚。;-) 我尝试使用大量接口从构建过程中抽象出来，并且只将几个实现的接口添加到一起，（我想我可以在不同的库之间切换，比如 Gwt-Ext 和 Gxt，很容易）但我仍然不是很开心。

我相信你也有这个问题，我想问你你遵循什么做法来获得更清晰的代码？除 MVC 外，是否有 gui 编码的设计模式？你的高可读性和漂亮的用户界面代码的技巧是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-03T18:33:45.700

Martin Fowler 就这个主题写了一篇有趣的文章：[GUI 架构](http://martinfowler.com/eaaDev/uiArchs.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-03T18:37:38.533

当我在 GWT 中编写 GUI 时，我喜欢创建只执行一些小任务的小部件。这样，当您在最终视图中组合这些小部件时，它会变得更加清晰。另一方面，您可能会弄得一团糟。因此，请尝试平衡新小部件中可以包含的内容（在许多地方使用）和视图中的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-05T00:13:18.293

看起来更像是一个非常普遍的编程问题，而不是与 GUI 相关的问题。为什么你觉得这只发生在你的 GUI 代码上？您唯一的问题是您的视图组件感觉被具有许多参数的 getter/setter 和 constsructor 弄乱了吗？

除了确保实际需要所有参数之外，您对具有许多参数的构造函数无能为力。您可能想看看 Builder 模式顺便说一句。它可能不会减少参数的数量，但最好限制 new 关键字的使用。

可能不是您正在寻找的答案，但看看您是否可以更具体地了解问题以及为什么您觉得它只发生在您的 GUI 代码中。

# php - jquery & php：保存一些数据而不重新加载

> ID：409555
> 
> 赞同：1
> 
> 时间：2009-01-03T18:35:48.677
> 
> 标签：php, jquery

我有三个按钮，需要保存一些数据。我有一个想法，我必须为每个按钮设置一个 ID，然后让 JS 确定已按下的女巫按钮，例如：

```
$("#mySpecifikButton").click(function()
{
....some code here...
}); 
```

但后来我卡住了。例如，我有 9 个用户。他们在数据库中都有一个 ID。所以现在我们将所有用户放在单独的行中：

```
<p><a id="userID">user 0</a></p>
<p><a id="userID">user 1</a></p>
<p><a id="userID">user 2</a></p>
<p><a id="userID">user 3</a></p>
... 
```

当我按下特定用户时，我想在 jquery 的帮助下通过 php 将其添加到 db 中。但是如何使用 JS（jquery）将它发送到 php？

我想对了还是有更好的方法？

如果我没有很好地描述它，问我。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-03T18:45:33.477

据我所知，您可以使用 Ajax 将已按下的按钮的值发送到 php 脚本。[在jQuery 站点](http://jquery.com)上搜索有关 $.get 和 $.post 的文档。:)

编辑：现在我不在我的 iPod 上，打字会容易得多。:P

这就是我的意思：

```
<input type="button" value="Button 1" id="1" />
<input type="button" value="Button 2" id="2" />
<input type="button" value="Button 3" id="3" />
<input type="button" value="Button 4" id="4" /> 
```

然后，使用一些 JS：

```
<script type="text/javascript">
$("input[type=button]").click(function() {
  $.post("myPHPscript.php",{buttonID: $(this).attr("id")},function(d) {
    //d is the response from the PHP page.
    //Do something with it!
  });
});
</script> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T19:06:59.503

听起来您正在对数据库进行更改，我建议您使用`$.post( url, [data], [callback], [type] );` [链接](http://docs.jquery.com/Ajax/jQuery.post#urldatacallbacktype)。您可以将表单发布到服务器并像处理任何其他表单一样进行处理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-03T18:56:32.923

您不必为此使用 jquery。通过 ajax 很简单。

用户 0

用户 1

用户 2

用户 3

------------------------------script.js 文件---------------- --------------------

```
var xmlHttp;

ajaxFunction(id){

url = anypage.php?Sentid=id; // here you are sending id through GET to any simple db connection mysql and php based page to add to db or anyother function.

xmlHttp.onreadystatechange=stateChanged; xmlHttp.open("GET",url,true) xmlHttp.send(null)

}//end of function

function stateChanged(){        
if(xmlHttp.readyState == 4 || xmlHttp.readyState == "complete" ){       // any operation you want to perform here

    }//end of if 
}//end of function

function GetXmlHttpObject(){    
var xmlHttp =null; 
var xmlHttp =null; 
if (window.XMLHttpRequest){

          // If IE7, Mozilla, Safari, etc: Use native object
          var xmlHttp = new XMLHttpRequest()    
}   
else    {   
    if (window.ActiveXObject){

          // ...otherwise, use the ActiveX control for IE5.x and IE6
          var xmlHttp = new ActiveXObject("Microsoft.XMLHTTP"); 
          }

    }    
    return xmlHttp;
 }//end of function 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T19:36:54.730

您可以使用 AJAX 向 PHP 页面发送请求（如上所述`$.post`）。最简单的方法是创建一个 PHP 页面 - 比如说 /insert.php：

```
<?php
    some_insert_function($_REQUEST["userid"], ...);
?> 
```

然后使用：

```
function go(el) {
    $.post("/insert.php?items="+el.id);
} 
```

**编辑：**您还应该添加一些数据已发送的视觉指示 - 至少是状态栏消息（`setStatus("Sent data")`虽然这些并不总是有效），但最好是颜色更改或消息在-a-div。

# optimization - 自动矢量化与手动矢量化代码

> ID：409560
> 
> 赞同：5
> 
> 时间：2009-01-03T18:40:39.370
> 
> 标签：optimization, gcc, loops, vector-processing

在某种意义上，手动矢量化代码，使用显式编译指示还是依赖或使用自动矢量化更好？为了使用自动矢量化获得最佳性能，必须监视编译器输出以确保循环被矢量化或修改它们直到它们可矢量化。

使用手动编码，可以确定正在发出所需的指令，但现在代码可能不可移植（对于其他架构或其他编译器）。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-03T18:52:34.023

自动矢量化对我来说从来都不是很好。对我来说，目前自动矢量化似乎只适用于非常微不足道的循环。

我使用 pragma/intrinsic 方法并查看程序集。如果编译器生成错误代码（例如将 SSE 寄存器溢出到堆栈上或添加冗余移动），我将内联汇编程序用于整个循环体。

顺便说一句，便携性不是问题。通常，您从 C/C++ 循环开始并使用内在函数对其进行优化。只需保留旧循环并将其用作 SIMD 实现的单元测试/备用。此外，能够通过编译时定义从项目中删除所有 SIMD 代码总是明智的。这样调试应用程序*要*容易得多。相同的定义可用于交叉编译。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-03T20:01:11.280

我永远不会依赖*任何*编译器的自动矢量化。`gcc`我会加倍小心，因为 's 优化的效果总是`gcc`因版本而异。我认识的几乎每个依赖特殊优化或 gcc 扩展的人都必须在新`gcc`版本发布时处理损坏问题。

您通常可以信任 pragma 和内在函数，但您应该密切关注新 gcc 版本的发行说明，并且应该告诉您自己的用户编译您的代码需要什么 gcc 版本。

有一次或两次，当向量化真的很重要时，我们在测试套件中添加了一些东西来调用`objdump`和验证向量指令是否真正被使用。能够自动检测“坏矢量代码”（如 Nils 所描述的那样）会很好，但我们从未走到那一步。

# c# - Java 或 C# 中异常管理的最佳实践

> ID：409563
> 
> 赞同：118
> 
> 时间：2009-01-03T18:41:52.377
> 
> 标签：c#, java, exception, error-handling

我一直在决定如何处理我的应用程序中的异常。

如果我的异常问题来自 1) 通过远程服务访问数据或 2) 反序列化 JSON 对象。不幸的是，我不能保证这些任务中的任何一个都能成功（切断网络连接，我无法控制的格式错误的 JSON 对象）。

因此，如果我确实遇到异常，我只需在函数中捕获它并将 FALSE 返回给调用者。我的逻辑是调用者真正关心的是任务是否成功，而不是为什么不成功。

这是一个典型方法的一些示例代码（在 JAVA 中））

```
public boolean doSomething(Object p_somthingToDoOn)
{
    boolean result = false;

    try{
        // if dirty object then clean
        doactualStuffOnObject(p_jsonObject);

        //assume success (no exception thrown)
        result = true;
    }
    catch(Exception Ex)
    {
        //don't care about exceptions
        Ex.printStackTrace();
    }
    return result;
} 
```

我认为这种方法很好，但我真的很想知道管理异常的最佳实践是什么（我真的应该在调用堆栈中一直冒泡异常吗？）。

**总结关键问题：**

1.  是否可以只捕获异常但不将它们冒泡或正式通知系统（通过日志或通知用户）？
2.  对于不会导致所有内容都需要 try/catch 块的异常，有哪些最佳实践？

**跟进/编辑**

感谢所有的反馈，在网上找到了一些关于异常管理的优秀资源：

*   [异常处理的最佳实践 | 奥莱利媒体](http://www.onjava.com/pub/a/onjava/2003/11/19/exceptions.html)
*   [.NET 中的异常处理最佳实践](http://www.codeproject.com/KB/architecture/exceptionbestpractices.aspx)
*   [最佳实践：异常管理](http://web.archive.org/web/20081207002838/http://www.dotnetjunkies.ddj.com/Article/197E493F-BA73-45A2-B39A-4EA282A2E562.dcik)（文章现在指向 archive.org 副本）
*   [异常处理反模式](http://today.java.net/pub/a/today/2006/04/06/exception-handling-antipatterns.html)

似乎异常管理是因上下文而异的事情之一。但最重要的是，他们在系统内管理异常的方式应该保持一致。

此外，请注意通过过多的尝试/捕获或不尊重异常（异常警告系统，还需要警告什么？）来防止代码腐烂。

[此外，这是来自m3rLinEz](https://stackoverflow.com/users/12460/m3rlinez)的一个不错的选择评论。

> 我倾向于同意 Anders Hejlsberg 和您的观点，即大多数呼叫者只关心操作是否成功。

从这个评论中，它提出了一些在处理异常时需要考虑的问题：

*   抛出这个异常有什么意义？
*   处理它有什么意义？
*   调用者真的关心异常还是只关心调用是否成功？
*   强制调用者管理潜在的异常是否正常？
*   ***你尊重语言的习惯吗？***
    *   你真的需要返回一个像布尔值这样的成功标志吗？返回 boolean（或 int）比 Java（在 Java 中你只需要处理异常）更像是一种 C 思维方式。
    *   遵循与语言相关的错误管理结构 :) ！

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-01-03T18:49:36.730

你想捕获异常并将它们转换为错误代码对我来说似乎很奇怪。当后者在 Java 和 C# 中都是默认设置时，为什么您认为调用者更喜欢错误代码而不是异常？

至于你的问题：

1.  您应该只捕获您可以实际处理的异常。在大多数情况下，仅仅捕获异常并不是正确的做法。有一些异常（例如线程之间的日志记录和编组异常），但即使在这些情况下，您通常也应该重新抛出异常。
2.  你的代码中绝对不应该有很多 try/catch 语句。同样，这个想法是只捕获您可以处理的异常。您可以包含一个最顶层的异常处理程序，以将任何未处理的异常转换为对最终用户有用的东西，但否则您不应该尝试在每个可能的位置捕获每个异常。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-01-03T18:51:46.133

这取决于应用程序和情况。如果你构建一个库组件，你应该冒泡异常，尽管它们应该被包装成与你的组件相关联。例如，如果您构建一个 Xml 数据库，假设您正在使用文件系统来存储数据，并且您正在使用文件系统权限来保护数据。您不想冒泡 FileIOAccessDenied 异常，因为这会泄漏您的实现。相反，您将包装异常并引发 AccessDenied 错误。如果您将组件分发给第三方，则尤其如此。

至于是否可以吞下异常。这取决于你的系统。如果您的应用程序可以处理失败情况并且通知用户失败原因没有任何好处，那么请继续，尽管我强烈建议您记录失败。我总是发现被调用来帮助解决问题并发现他们正在吞下异常（或替换它并抛出一个新异常而不设置内部异常）令人沮丧。

一般来说，我使用以下规则：

1.  在我的组件和库中，如果我打算处理它或基于它做某事，我只会捕获一个异常。或者，如果我想在异常中提供额外的上下文信息。
2.  我在应用程序入口点或可能的最高级别使用一般的 try catch。如果出现异常，我只是记录它并让它失败。理想情况下，异常永远不应该出现在这里。

我发现以下代码有异味：

```
try
{
    //do something
}
catch(Exception)
{
   throw;
} 
```

像这样的代码没有任何意义，不应包含在内。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-03T21:24:44.733

我想推荐另一个关于这个话题的好资料。这是对 C# 和 Java 的发明者 Anders Hejlsberg 和 James Gosling 分别就 Java 的 Checked Exception 主题进行的采访。

[失败和异常](http://www.artima.com/intv/solidP.html)

页面底部也有很好的资源。

我倾向于同意 Anders Hejlsberg 和您的观点，即大多数呼叫者只关心操作是否成功。

> **Bill Venners**：您提到了与检查异常有关的可伸缩性和版本控制问题。你能澄清一下这两个问题是什么意思吗？
> 
> **Anders Hejlsberg**：让我们从版本控制开始，因为在那里很容易看到问题。假设我创建了一个方法 foo，它声明它会抛出异常 A、B 和 C。在 foo 的第二版中，我想添加一堆功能，现在 foo 可能会抛出异常 D。这对我来说是一个突破性的变化将 D 添加到该方法的 throws 子句中，因为该方法的现有调用者几乎肯定不会处理该异常。
> 
> 在新版本中向 throws 子句添加新异常会破坏客户端代码。这就像向接口添加方法一样。发布接口后，它实际上是不可变的，因为它的任何实现都可能具有您想要在下一个版本中添加的方法。所以你必须创建一个新界面。与异常类似，您要么必须创建一个名为 foo2 的全新方法来引发更多异常，要么必须在新的 foo 中捕获异常 D，并将 D 转换为 A、B 或 C。
> 
> **Bill Venners**：但是在这种情况下，你不会破坏他们的代码吗，即使是在没有检查异常的语言中？如果新版本的 foo 将抛出一个客户应该考虑处理的新异常，那么他们的代码不只是因为他们在编写代码时没有预料到该异常而被破坏了吗？
> 
> **Anders Hejlsberg**：不，因为在很多情况下，人们并不关心。他们不会处理任何这些异常。他们的消息循环周围有一个底层异常处理程序。该处理程序只会弹出一个对话框，说明出了什么问题并继续。程序员通过在任何地方都编写 try finally 来保护他们的代码，因此如果发生异常，他们会正确退出，但他们实际上对处理异常并不感兴趣。
> 
> throws 子句，至少它在 Java 中实现的方式，不一定强制您处理异常，但如果您不处理它们，它会强制您准确确认哪些异常可能通过。它要求您要么捕获已声明的异常，要么将它们放入您自己的 throws 子句中。为了解决这个要求，人们会做一些荒谬的事情。例如，他们用“抛出异常”来装饰每个方法。这完全破坏了该功能，并且您只是让程序员编写了更多狼吞虎咽的东西。这对任何人都没有帮助。

编辑：添加了有关 converstaion 的更多详细信息

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-03T19:07:13.607

受检查的异常通常是一个有争议的问题，尤其是在 Java 中（稍后我将尝试为支持和反对它们的人找到一些示例）。

根据经验，异常处理应该围绕这些准则进行，没有特定的顺序：

*   为了可维护性，请始终记录异常，以便当您开始看到错误时，日志将帮助您指出错误可能开始的位置。永远不要离开`printStackTrace()`或类似情况，您的一个用户可能最终会获得其中一个堆栈跟踪，并且对于如何处理它的**知识完全为零。**
*   捕获您可以处理的异常，并且只有那些，**并处理它们**，不要只是将它们扔到堆栈上。
*   总是捕获一个特定的异常类，通常你不应该捕获 type `Exception`，你很可能会吞下其他重要的异常。
*   **永远（永远）抓到`Error`s！！**, 意思是：**永远不要捕获`Throwable`s**，因为`Error`s 是后者的子类。`Error`s 是您很可能永远无法处理的问题（例如`OutOfMemory`，或其他 JVM 问题）

关于您的具体情况，请确保任何调用您的方法的客户端都将收到正确的返回值。如果某事失败，返回布尔值的方法可能会返回 false，但请确保您调用该方法的地方能够处理该问题。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-03T18:57:45.433

您应该只捕获您可以处理的异常。例如，如果您正在处理通过网络读取并且连接超时并且您遇到异常，您可以重试。但是，如果您正在通过网络阅读并获得 IndexOutOfBounds 异常，那么您真的无法处理它，因为您不（好吧，在这种情况下您不会）知道是什么导致了它。如果您要返回 false、-1 或 null，请确保它是针对特定异常的。当抛出的异常是堆内存不足时，我不希望我使用的库在网络读取时返回 false。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-03T19:14:17.710

异常是不属于正常程序执行的错误。根据您的程序所做的事情及其用途（即文字处理器与心脏监视器），当您遇到异常时，您将希望做不同的事情。我使用过在正常执行过程中使用异常的代码，这绝对是一种代码异味。

前任。

```
try
{
   sendMessage();

   if(message == success)
   {
       doStuff();
   }
   else if(message == failed)
   {
       throw;
   }
}
catch(Exception)
{
    logAndRecover();
} 
```

这段代码让我呕吐。IMO 你不应该从异常中恢复，除非它是一个关键程序。如果你抛出异常，那么坏事正在发生。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-03T19:16:13.353

以上所有似乎都是合理的，而且您的工作场所通常可能有政策。在我们这里，我们定义了异常类型：（`SystemException`未选中）和`ApplicationException`（选中）。

我们已经同意`SystemException`s 不太可能被恢复并且将在顶部处理一次。为了提供进一步的上下文，我们`SystemException`的 s 被扩展以指示它们发生的位置，例如`RepositoryException`,`ServiceEception`等。

`ApplicationException`s 可能具有商业意义`InsufficientFundsException`，应该由客户端代码处理。

Witohut 是一个具体的例子，很难评论你的实现，但我永远不会使用返回码，它们是一个维护问题。您可能会吞下一个异常，但您需要确定原因，并始终记录事件和堆栈跟踪。最后，由于您的方法没有其他处理，因此它相当多余（封装除外？），因此`doactualStuffOnObject(p_jsonObject);`可以返回布尔值！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-03T18:56:38.790

经过一番思考并查看您的代码，在我看来，您只是将异常重新抛出为布尔值。您可以让该方法通过此异常（您甚至不必捕获它）并在调用者中处理它，因为这是重要的地方。如果异常会导致调用者重试此函数，则调用者应该是捕获异常的人。

有时可能会发生您遇到的异常对调用者没有意义（即，它是网络异常），在这种情况下，您应该将其包装在特定于域的异常中。

另一方面，如果异常表明程序中出现不可恢复的错误（即，此异常的最终结果将是程序终止），我个人喜欢通过捕获它并抛出运行时异常来明确这一点。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-03T21:30:17.967

如果要在示例中使用代码模式，请将其命名为 TryDoSomething，并仅捕获特定异常。

在记录异常以进行诊断时，还应**考虑使用[异常过滤器。](http://blogs.msdn.com/greggm/archive/2008/04/21/exception-filter-inject.aspx)**VB 对异常过滤器有语言支持。Greggm 博客的链接有一个可以在 C# 中使用的实现。与 catch 和 rethrow 相比，异常过滤器具有更好的可调试性。具体来说，您可以在过滤器中记录问题并让异常继续传播。该方法允许附加的 JIT（即时）调试器拥有完整的原始堆栈。重新抛出会在重新抛出时切断堆栈。

TryXXXX 有意义的情况是，当您包装第三方函数时，该函数会抛出并非真正异常的情况，或者在不调用该函数的情况下简单难以测试。一个例子是这样的：

```
// throws NumberNotHexidecimalException
int ParseHexidecimal(string numberToParse); 

bool TryParseHexidecimal(string numberToParse, out int parsedInt)
{
     try
     {
         parsedInt = ParseHexidecimal(numberToParse);
         return true;
     }
     catch(NumberNotHexidecimalException ex)
     {
         parsedInt = 0;
         return false;
     }
     catch(Exception ex)
     {
         // Implement the error policy for unexpected exceptions:
         // log a callstack, assert if a debugger is attached etc.
         LogRetailAssert(ex);
         // rethrow the exception
         // The downside is that a JIT debugger will have the next
         // line as the place that threw the exception, rather than
         // the original location further down the stack.
         throw;
         // A better practice is to use an exception filter here.
         // see the link to Exception Filter Inject above
         // http://code.msdn.microsoft.com/ExceptionFilterInjct
     }
} 
```

是否使用 TryXXX 之类的模式更像是一个风格问题。捕获所有异常并吞下它们的问题不是风格问题。确保允许传播意外异常！

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-04T00:57:56.237

我建议您从标准库中获取您正在使用的语言的提示。我不能说 C#，但让我们看看 Java。

例如 java.lang.reflect.Array 有一个静态`set`方法：

```
static void set(Object array, int index, Object value); 
```

C方式将是

```
static int set(Object array, int index, Object value); 
```

...返回值是成功指标。但是你已经不在 C 世界了。

一旦你接受了异常，你应该会发现它使你的代码更简单、更清晰，因为它把你的错误处理代码从你的核心逻辑中移开了。目标是在一个`try`块中有很多语句。

正如其他人所指出的 - 您应该尽可能具体地了解您捕获的异常类型。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-03T18:52:29.533

如果你要捕获一个异常并返回 false，它应该是一个非常具体的异常。您没有这样做，您正在捕获所有这些并返回错误。如果我得到一个 MyCarIsOnFireException 我想马上知道它！其余的例外我可能不关心。因此，您应该有一堆异常处理程序，对某些异常（重新抛出，或捕获并重新抛出一个新的异常，以更好地解释发生的事情）说“哇哇哇，这里出了点问题”，并为其他异常返回 false。

如果这是您将要发布的产品，您应该在某处记录这些异常，它将帮助您在未来进行调整。

编辑：关于将所有内容包装在 try/catch 中的问题，我认为答案是肯定的。异常在您的代码中应该非常罕见，以至于 catch 块中的代码执行得非常少，以至于它根本不会影响性能。异常应该是您的状态机损坏并且不知道该怎么做的状态。至少重新抛出一个异常，解释当时发生的事情，并在其中包含捕获的异常。“doSomeStuff() 方法中的异常”对于那些在你度假（或新工作）时必须弄清楚它为什么会崩溃的人来说并不是很有帮助。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-03T19:37:53.153

我的策略：

如果原始函数返回*void*我将其更改为 return *bool*。如果发生异常/错误返回*false*，如果一切正常返回*true*。

如果函数应该返回一些东西，那么当发生异常/错误时返回*null*，否则返回可返回项。

可以返回包含错误描述的字符串*，*而不是*bool 。*

 *在每种情况下，在返回任何内容之前记录错误。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-03T21:34:51.513

这里有一些很好的答案。我想补充一点，如果你最终得到了像你发布的东西，至少打印比堆栈跟踪更多。说出你当时在做什么，以及 Ex.getMessage()，给开发者一个战斗的机会。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-04T00:14:15.140

try/catch 块形成嵌入在第一组（主）集上的第二组逻辑，因此它们是消除不可读、难以调试意大利面条代码的好方法。

尽管如此，合理使用它们在可读性方面创造了奇迹，但你应该遵循两个简单的规则：

*   在低级别（谨慎地）使用它们来捕获库处理问题，并将它们流回主逻辑流。我们想要的大多数错误处理应该来自代码本身，作为数据本身的一部分。如果返回的数据不特殊，为什么要制定特殊条件？

*   在较高级别使用一个大型处理程序来管理代码中未在低级别捕获的任何或所有奇怪情况。对错误（日志、重新启动、恢复等）做一些有用的事情。

除了这两种类型的错误处理之外，中间的所有其余代码都应该是自由的，并且没有 try/catch 代码和错误对象。这样一来，无论您在哪里使用它，或者用它做什么，它都能简单地按预期工作。

保罗。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-02-01T21:42:34.107

我的答案可能有点晚了，但错误处理是我们总是可以随着时间改变和发展的东西。如果你想了解更多关于这个主题的内容，我在我的新博客中写了一篇关于它的文章。[http://taoofdevelopment.wordpress.com](http://taoofdevelopment.wordpress.com)

快乐编码。

# perl - Emacs 的 ido-completion 是否有 Perl 等价物？

> ID：409587
> 
> 赞同：2
> 
> 时间：2009-01-03T18:57:41.003
> 
> 标签：perl, emacs, menu, autocomplete, prompt

我已经构建了许多特定于工作的帮助函数，这些函数可能对我团队的其他成员有用&mdash。但是我已经将它们全部写在 Emacs 的 Elisp 中，让它们从 Notepad++ 转换是不会发生的。

所以，我正在考虑将函数转换为 Perl。没问题。

除了我一直使用 ido-completion 来限制响应：

```
 (setq client (ido-completing-read "Select a Client: " '("IniTrade" "HedgeCorp" "GlobalTech" "OCP") nil t)) 
```

编辑： ido-completing-read 类似于 complete- [read](http://www.gnu.org/software/emacs/elisp/html_node/Minibuffer-Completion.html)，除了所有选项都是可见的，并且可以通过循环 [箭头键，通常] 或键入完成来选择。在上面的例子中，提示看起来像

```
 Select a Client: {IniTrade | HedgeCorp | GlobalTech | OCP} 
```

可以通过点击 RET 或部分输入在最左边的项目上进行选择（在这种情况下，第一个字母都是唯一的，所以这就是所有需要的，匹配的项目将成为最左边的）。

示例中的 nil 是未使用的参数，但“t”需要完全匹配——例如，用户必须做出选择之一。该函数返回一个字符串，例如“IniTrade”。

我的“辅助功能”是针对内部需求的——打开特定的错误日志，将批处理恢复到服务器等。对于这些操作，用户需要指定测试或生产环境、客户端、阶段等。几乎在所有情况下，这些是用于构建另一个 shell 命令的字符串选择。如果返回数字项，则可以将其重新转换为字符串——但由于选择通常是所需的字符串，如果可以跳过该步骤会很好。[结束编辑]

有 Perl 等价物吗？我查看了[Term::Prompt](http://search.cpan.org/~persicom/Term-Prompt-1.04/lib/Term/Prompt.pm) ，它提供了一个编号菜单......我找到的最接近的。这不如 ido-completion 漂亮，而且我仍然必须将数字结果向后转换为字符串（不是主要问题；只是烦人）。

在撰写本文时，我注意到我使用了“菜单”一词，因此进行了更多搜索并提出了[Term::Menus。](http://search.cpan.org/dist/Term-Menus-1.32/lib/Term/Menus.pm)这个我还没试过。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-05T16:48:31.060

Term::ReadLine 可能会做您正在寻找的事情，尽管它可能更像是“完成阅读”而不是“ido-完成阅读”。

# svn - 如何防止没有更改的 subversion 更新导致 IIS 重新编译网站？

> ID：409589
> 
> 赞同：0
> 
> 时间：2009-01-03T18:58:08.333
> 
> 标签：svn, iis

对于我的登台站点，我有一个 subversion 存储库，当我需要查看登台服务器上的更改时，我会更新它。当我需要检查某些内容时，我不需要每隔几分钟手动更新登台服务器 subversion 文件夹，而是有一个脚本可以自动检查任何 subversion 更新。我的问题是，每次检查更新时，即使没有任何更改，我认为 subversion 可能会更改站点上 .svn 文件夹中的一些文件，这会导致 IIS 重新编译需要大约40 秒。如果没有任何代码文件更改，我不希望 IIS 重新编译网站。有谁知道解决此问题的好方法，以便站点仅在代码更改时重新编译，而不是在每次更新检查后重新编译？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-03T19:08:54.663

您可以先更改脚本以执行差异（使用--summarize），然后仅在相关文件在差异摘要列表（*.cs 等）中时才执行更新。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T19:01:45.847

在进行更新之前，您必须有一个脚本检查存储库的当前修订号。如果修订号未更改，请不要执行更新。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-03T19:09:39.140

不如将该代码放在提交后挂钩中，这样它应该只在正确提交后运行？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T19:22:31.780

您的解决方案可能在您的问题中：防止 IIS 查看 .svn 文件夹。这里没有想法，但是 IIS 应该在某处进行设置，以从扫描更改的文件中排除某些目录。也许使用隐藏文件属性标记 .svn 文件夹？

Google 将此论坛作为询问 IIS 配置问题的地方：

[http://forums.iis.net/1034.aspx?PageIndex=18&forumoptions=0:1:11](http://forums.iis.net/1034.aspx?PageIndex=18&forumoptions=0:1:11) ::

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-03T19:24:59.717

请参阅 subversion 常见问题解答：[“我在我的存储库中管理一个网站。如何让实时网站在每次提交后自动更新？”](http://subversion.tigris.org/faq.html#website-auto-update)

您还可以尝试配置设置“使用提交时间”。有关详细信息，请参阅 Subversion 书籍：http: [//svnbook.red-bean.com/en/1.5/svn.advanced.confarea.html#svn.advanced.confarea.opts.config](http://svnbook.red-bean.com/en/1.5/svn.advanced.confarea.html#svn.advanced.confarea.opts.config)

# sql-server - 跨多个数据库查找对象的依赖关系？

> ID：409598
> 
> 赞同：5
> 
> 时间：2009-01-03T19:02:00.963
> 
> 标签：sql-server

如何找到跨数据库的表的依赖关系？

通常`sp_depends`会为特定对象上的所有依赖对象提供信息，或者通过 GUI 工具您可以以更结构化的方式查看它。现在这些方法显示的依赖关系仅限于单个数据库 - 如果我们在其他数据库中有依赖关系怎么办？

有什么查询可以做吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T20:25:03.450

AFAIK，SQL Server 不能开箱即用。

[您很可能需要像 Red-Gate 的SQL Dependency Tracker](http://www.red-gate.com/products/SQL_Dependency_Tracker/index.htm)这样的第三方程序来执行此操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T19:28:14.467

我将把寻找跨数据库依赖项的任务留给其他人来写，因为我今天早上就要出门了，但想在 sp_depends 上留下一个简短的说明。坏了，别用了。它是出了名的不可靠。根据 Microsoft“使用 sys.dm_sql_referenced_entities 和 sys.dm_sql_referenced_entities ”，它即将退出。这就是 sp_depends 被破坏的原因，它依赖于创建顺序。假设您有两个存储过程，ProcA 和 ProcB。ProcB 依赖于 ProcA。If you create ProcA THEN create ProcB sp_depends 会报告依赖关系，但由于支持后期绑定，如果你创建 ProcB，THEN create ProcA sp_depends 不会报告依赖关系。

值得一提的是，我使用了一些工具，它们在正确报告依赖关系方面做得很好，但到目前为止我最喜欢，如果你可以访问它，一个可以处理跨数据库依赖关系的工具是 Visual Studio for Database Professionals。它相当昂贵，但是如果您可以访问它，它具有出色的依赖关系工具并支持轻重构，例如您更改列的名称，它可以找到所有视图和过程，甚至在多个数据库中，并为您更新列名称你的依赖。

对于一个便宜的单数据库 GUI 替代方案，ApexSql 是一个不错的工具。在免费方面，您可以找到或创建一个存储过程来为您进行依赖性检查，但我现在没有任何链接可以帮助您解决这个问题。

# cocoa-touch - 如何移动 UIAlertView 中的按钮为插入的 UITextField 腾出空间？

> ID：409599
> 
> 赞同：7
> 
> 时间：2009-01-03T19:03:23.003
> 
> 标签：cocoa-touch

[编辑] 嗯。也许这个问题应该标题为“CocoaTouch 中调用的默认用户输入对话框视图是什么？” 我意识到我可以创建一个正是我想要的完整视图，并将其包装在视图控制器和 presentModalView 中——但我有点希望有一个标准的、正常的用户输入“对话”视图出现——带有可可触感。“输入你的名字”、“输入文字进行搜索”等等，都是很常见的事情！

无论如何......这是我最初提出的问题：

这段代码：

```
UIAlertView* find = [[UIAlertView alloc] init];
[find setDelegate:self];
[find setTitle:@"Find"];

[find addButtonWithTitle:@"Cancel"];
[find addButtonWithTitle:@"Find & Bring"];
[find addButtonWithTitle:@"Find & Go"];
[find addButtonWithTitle:@"Go To Next"];

[find addSubview:_findText];

CGRect frm = find.frame;
int height = frm.size.height + _findText.frame.size.height + 100; // note how even 100 has no effect.
[find setFrame:CGRectMake(frm.origin.x, frm.origin.y, frm.size.width, height)];

[find setNeedsLayout];
[find show];
[find release]; 
```

生成此警报视图：

[查找警报 http://www.publicplayground.com/IMGs/Misc/FindAlert.png](http://www.publicplayground.com/IMGs/Misc/FindAlert.png)

（我从[emi1Faber 的这个问题](https://stackoverflow.com/questions/376104/uitextfield-in-uialertview-on-iphone-how-to-make-it-responsive#376546 "另一个人的问题")的代码开始，它像宣传的那样工作；但是，正如我在评论中所说，取消按钮覆盖了文本字段。）

如何重新调整所有内容以使文本字段正确适合？[findAlert setNeedsLayout] 似乎没有做任何事情，即使在我 [findAlert setFrame:tallerFrame] 之后也是如此。提示？

谢谢！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-05T09:12:06.240

向下移动文本视图的最简单（也是最合适的方法）是添加一条消息

```
[find setMessage:@"\n"]; 
```

此外，您的框架未生效的原因是`-show`在开始动画之前设置框架并创建视图层次结构。您还应该使文本视图成为第一响应者，以便弹出键盘。

完整示例：

```
// Create Alert
UIAlertView* av = [UIAlertView new];
av.title = @"Find";
// Add Buttons
[av addButtonWithTitle:@"Cancel"];
[av addButtonWithTitle:@"Find & Bring"];
[av addButtonWithTitle:@"Find & Go"];
[av addButtonWithTitle:@"Go to Next"];
// Make Space for Text View
av.message = @"\n";
// Have Alert View create its view heirarchy, set its frame and begin bounce animation
[av show];
// Adjust the frame
CGRect frame = av.frame;
frame.origin.y -= 100.0f;
av.frame = frame;
// Add Text Field
UITextField* text = [[UITextField alloc] initWithFrame:CGRectMake(20.0, 45.0, 245.0, 25.0)];
text.borderStyle = UITextBorderStyleRoundedRect;
[av addSubview:text];
[text becomeFirstResponder]; 
```

注意：您也可以修改 UIAlertView 的子视图，但由于 Apple 已经更改了 UIAlertView 布局，因此您应该在设置新值之前检查它们的类描述和框架与已知值。你甚至可以得到这样的东西：

[![预览](https://i.stack.imgur.com/HkwOZ.png)](https://i.stack.imgur.com/HkwOZ.png)
[（来源：[booleanmagic.com](http://booleanmagic.com/uploads/UIAlertViewHack.png)）]

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-03T19:58:47.057

即使你能得到这个工作，它也不会是非常 iPhone-y。`UIAlertView`真的不是为这样的用户输入而设计的。如果您查看所有 Apple 应用程序，您会发现它们使用了一个新视图，该视图`presentModalViewController:`使用`UIViewController`.

**编辑**：这个建议不再像我写它时那样正确。Apple 越来越多地使用警报视图作为文本输入框，iOS5 甚至包括原生支持，而不必乱用视图（查看[`alertViewStyle`](http://developer.apple.com/library/ios/#documentation/uikit/reference/UIAlertView_Class/UIAlertView/UIAlertView.html)属性）。

我想也许如果你需要四个按钮，那么使用自定义`UIViewController`可能仍然是正确的方法。但是，如果您只想使用 OK/Cancel 按钮输入密码，那也没关系。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-26T07:46:59.150

Zoul 提出了最好的方法，捕获用户输入只需执行以下操作：

a) 将 UITextFieldDelegate 协议添加到您的类中。

b）做类似的事情

```
 UIAlertView *insertScore = [UIAlertView new];
    [insertScore setDelegate:self];
    [insertScore setTitle:@"New Title!"];
    [insertScore addButtonWithTitle:@"Cancel"];
    [insertScore addButtonWithTitle:@"Ok"];

    insertScore.message = @"\n";

    [insertScore addTextFieldWithValue:@"Input" label:@"player"];

    [[insertScore textField] setDelegate:self];

    [insertScore show]; 

    [insertScore release]; 
```

c) 关键部分是将 textField 的委托设置为 self，然后您可以简单地访问数据：

```
- (void)alertView:(UIAlertView *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex 
{
  NSLog(@"%@",[[alertView textField] text]);
} 
```

希望这对某人有所帮助，因为我不得不考虑一下才能做到正确。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-05T09:24:42.937

很可能您想`addTextFieldWithValue`研究`UIAlertView`? 在您的班级顶部的某处添加以下代码：

```
@interface UIAlertView ()
- (void) addTextFieldWithValue: (NSString*) val label: (NSString*) label;
- (UITextField*) textField;
@end 
```

这不是官方的，但恕我直言，它并没有让你被 App Store 拒绝，而且它比你自己将文本字段侵入对话框中更好的解决方案。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-07T14:34:30.400

解释如何设置列数，没有测试过。

[http://iloveco.de/uikit-alert-types/](http://iloveco.de/uikit-alert-types/)

> 但是有一个私有方法 setNumberOfRows:(int)n 允许您设置显示按钮的最大行数。要使用此方法，我们需要将我们自己的添加添加到 UIAlertView 类中。我们通过在 .m 文件中为 UIAlertView 添加一个@interface 来做到这一点。

```
// extend the UIAlertView class to remove the warning caused
// by calling setNumberOfRows.
@interface UIAlertView (extended)
- (void) setNumberOfRows:(int)num;
@end 
```

这将允许我们在没有编译器向我们发出警告的情况下调用该方法。

```
[myAlert setNumberOfRows:2]; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-05T08:32:09.067

尝试在 UIAlertView 初始化中的标题后添加一些 (\n)。这将按下按钮。我同意斯蒂芬的观点。如果应用程序以不应该的方式使用控件，Apple 可能会拒绝该应用程序。（人机界面指南中有一些关于此的条款！）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-10T14:14:34.403

这种更简单的方法对我有用：

```
UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"UIAlertView"
    message:@"<Alert message>" delegate:self cancelButtonTitle:@"OK"
    otherButtonTitles:nil];
[alert addTextFieldWithValue:@"" label:@"Text Field"]; 
```

希望有帮助。哦，如果您需要多个按钮行，那么它是：

```
[alert setNumberOfRows:3]; 
```

干杯

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-07-18T17:47:22.760

[https://github.com/TomSwift/TSAlertView](https://github.com/TomSwift/TSAlertView)

这个库实际上是从头开始创建控件，而不是试图破解 UIAlertView，这通常是一个 Bad Plan (TM)

# p2p - VoIP 应用程序使用什么架构，P2P 还是客户端-服务器？

> ID：409612
> 
> 赞同：6
> 
> 时间：2009-01-03T19:13:51.907
> 
> 标签：p2p, voip

请让我知道 VoIP 应用程序使用什么架构，P2P 还是客户端-服务器？

谢谢你。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-03T19:29:28.553

一般情况下各有一些。通常涉及三种协议。其中之一，例如 SIP，用于建立连接。你需要一个服务器，因为必须有人建立原始连接；这意味着广告可用性等。另外两个本质上总是 RTP 和 RTCP——“实时协议”和“实时控制协议”，它们是更好的 P2P，因为你想要快速传输而没有中间瓶颈。

这里有[一篇关于整个讨论的好文章](http://www.packetizer.com/ipmc/papers/understanding_voip/voip_protocols.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T19:30:33.557

通常有某种“存在服务器”：设备注册（“我在这里！”）并通过服务器建立呼叫（当您说“我想连接到设备**(555) 555-1234** ”时，连接请求被路由通过存在服务器）。

在建立呼叫并且实时语音/媒体流式传输后，该流量通常是点对点的（绕过任何中央服务器），除非存在诸如两个设备都位于防火墙后面的复杂情况。

# java - GWT 中的进程监控

> ID：409619
> 
> 赞同：1
> 
> 时间：2009-01-03T19:17:52.163
> 
> 标签：java, gwt

有谁知道如何在 GWT 中监控长时间运行的服务器端进程，而不是轮询服务器？我们需要在服务器上做一些耗时的、多步骤的、I/O 密集型的处理，在浏览器中显示这个处理的进度会很好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-03T23:16:16.863

这在 GWT 中相当容易处理。

长时间运行的进程要么由 GWT RPC 调用触发，在这种情况下你有你的入口点，或者它没有，在这种情况下你需要手动启动它。

请记住，GWT RPC 调用是异步的，因此它们不需要立即返回。您需要一个 RPC 调用，例如`checkStatus()`. 因此，您可以执行以下操作：

```
public class JobStatus {
  private boolean done;
  // other info
  // ...
}

public class JobStatusCallback<JobStatus> extends AsyncCallback {
    public final void onSuccess(JobStatus result) {
       if (result.isDone()) {
            done();
        } else {
            checkAgain();
        }
    }

    public final void onFailure(Throwable caught) {
       error(caught);
       checkAgain();
    }

    public void done() { // override
    }

    public void checkAgain() {
        service.checkStatus(this);
    }

    public void error(Thorwable t) { // override
    }
}); 
```

在您的 RPC 服务中：

```
void checkStatus(AsyncCallback<JobStatus> callback); 
```

您的服务器可以根据需要（在合理范围内）从 checkStatus() 返回。它可以返回，因为工作已完成或只是工作状态更新。以上将继续循环，直到设置了作业状态完成标志。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T19:53:39.987

我认为这取决于您的流程，但如果您要做数据流之类的事情，您可以使用服务器推送（或彗星）技术。GWT 支持彗星实现。google GWT+Comet 或 GWT+COMET+Tomcat，我在“Google Web Toolkit Applications”一书（gwtapps.com）中读到了彗星和 gwt。

# c# - 由属性组成的下拉列表DataTextField？

> ID：409648
> 
> 赞同：10
> 
> 时间：2009-01-03T19:34:28.293
> 
> 标签：c#, asp.net, data-binding, drop-down-menu

有没有办法通过 c# 使 asp.net 中下拉列表的 datatextfield 属性由对象的多个属性组成？

```
public class MyObject
{
  public int Id { get; set; }
  public string Name { get; set; }
  public string FunkyValue { get; set; }
  public int Zip { get; set; }
}

protected void Page_Load(object sender, EventArgs e)
{
  List<MyObject> myList = getObjects();
  ddList.DataSource = myList;
  ddList.DataValueField = "Id";
  ddList.DataTextField = "Name";
  ddList.DataBind();
} 
```

我想例如不使用“名称”，而是使用“名称（邮编）”，例如。

当然，我可以更改 MyObject 类，但我不想这样做（因为 MyObject 类在模型类中，不应该在 UI 中做我需要的事情）。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-03T19:38:58.907

将另一个属性添加到 MyObject 类并绑定到该属性：

```
public string DisplayValue
{
 get { return string.Format("{0} ({1})", Name, Zip); }
} 
```

或者如果你不能修改 MyObject，在表现层创建一个包装对象（只是为了显示）。这也可以使用一些 LINQ 来完成：

```
List<MyObject> myList = getObjects();
ddList.DataSource = (from obj in myList
                    select new
                    {
                      Id = obj.Id,
                      Name = string.Format("{0} ({1})", obj.Name, obj.Zip)
                    }).ToList();
ddList.DataValueField = "Id";
ddList.DataTextField = "Name";
ddList.DataBind(); 
```

（对不起，我没有可用的 Visual Studio，所以代码中可能有错误）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-03T19:44:49.363

我建议阅读以下内容：[http ://martinfowler.com/eaaDev/PresentationModel.html](http://martinfowler.com/eaaDev/PresentationModel.html)

本质上，您希望创建一个表示绑定到特定 UI 的类。因此，您可以将您的模型（在您的示例中为 My Object）映射到 ViewModel 对象，然后以这种方式绑定下拉列表。这是考虑关注点分离的一种很酷的方式。

编辑：这是关于 ViewModel 的另一个博客系列：http: [//blogs.msdn.com/dancre/archive/2006/10/11/datamodel-view-viewmodel-pattern-series.aspx](http://blogs.msdn.com/dancre/archive/2006/10/11/datamodel-view-viewmodel-pattern-series.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-13T09:21:16.423

顺便说一句，在分配数据源之前尝试分配“DataTextField”和“DataValueField”。这样做将防止在数据绑定时触发“SelectedIndexChanged”事件......

# python - 什么版本的 Python 和 wxPython 对应 OSX 的每个版本？

> ID：409677
> 
> 赞同：0
> 
> 时间：2009-01-03T19:37:41.127
> 
> 标签：python, macos, wxpython, compatibility

我想知道每个 OSX 版本对应的 Python 和 wxPython 版本。我很想知道在必须安装较新版本的 Python 和 wxPython 之前，我的一些应用程序将在 Mac 上保持兼容多久。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-03T19:49:20.150

Tiger 附带 Python 2.3.5 和 wxPython 2.5.3，Leopard 附带 python 2.5.1 和 wxPython 2.8.4。

wxPython 没有随以前的版本一起提供。

* * *

OSX Lion 有 2.7.1

# perl - 如何使用 mod_perl 让 Apache 处理 .pl (Perl) 文件？

> ID：409686
> 
> 赞同：7
> 
> 时间：2009-01-03T19:40:22.040
> 
> 标签：perl, apache, mod-perl

我正在使用 Apache 2。我知道如何将 .pl 文件作为“cgi-script”处理，但 mod_perl 应该更快。我成功构建并安装了 mod_perl，但是如何更改 httpd.conf 以便 .pl 文件将由 mod_perl 处理（而不是作为 cgi 脚本）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-03T20:10:45.973

如何执行此操作在[此处](http://perl.apache.org/docs/2.0/user/intro/start_fast.html)的 mod_perl 文档中进行了描述。特别是，请阅读“注册表脚本”部分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-17T21:49:09.263

以下是我自己未经测试的，可以添加到现有的 vhost 指令文件中

```
PerlModule ModPerl::Registry
<Files ~ "\.(pl|cgi)$">
SetHandler perl-script
PerlResponseHandler ModPerl::Registry
Options +ExecCGI
PerlSendHeader On
</Files> 
```

然后将执行任何目录中的任何 .pl 或 .cgi 文件。

由于安全原因，我通常如何做：

```
PerlModule ModPerl::Registry
<Directory /opt/myawesomescripts/>
SetHandler perl-script
PerlResponseHandler ModPerl::Registry
PerlOptions +ParseHeaders
Options +ExecCGI
AllowOverride None
</Directory> 
```

如果您需要，以前的方法将拒绝目录浏览，您应该执行以下操作：

```
PerlModule ModPerl::Registry
<Directory /var/www/>
Options FollowSymLinks MultiViews ExecCGI Indexes
AddHandler perl-script .cgi .pl
PerlResponseHandler ModPerl::Registry
AllowOverride None
Order allow,deny
allow from all
</Directory> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T19:44:18.040

我相当肯定，只要您加载了模块，您就可以添加一个

`AddHandler mod_perl .pl`

# c++ - 多线程妄想症

> ID：409688
> 
> 赞同：29
> 
> 时间：2009-01-03T19:42:32.537
> 
> 标签：c++, c, multithreading, hardware

这是一个复杂的问题，请在回答之前仔细考虑。

考虑这种情况。两个线程（一个读取器和一个写入器）访问一个全局`int`. 这安全吗？通常，我会不假思索地回应，是的！

然而，在我看来，赫伯萨特并不这么认为。在他关于有效并发的文章中，他讨论了一个[有缺陷的无锁队列](http://www.ddj.com/cpp/210600279)和[更正的版本](http://www.ddj.com/hpc-high-performance-computing/210604448)。

在第一篇文章的结尾和第二篇文章的开头，他讨论了一个很少被考虑的变量特征，即写顺序。整数是原子的，很好，但整数不一定是有序的，这可能会破坏任何无锁算法，包括我上面的场景。我完全同意，在当前和未来的所有平台上***保证***正确的多线程行为的唯一方法是使用原子（AKA 内存屏障）或互斥锁。

我的问题; 在真正的硬件上写重排是一个问题吗？还是多线程的偏执狂只是迂腐？
那么经典的单处理器系统呢？
更简单的 RISC 处理器（如嵌入式 power-pc）呢？

*澄清*：我对 Sutter 先生所说的关于硬件（处理器/缓存）重新排序变量写入的内容更感兴趣。我可以通过编译器开关或在编译后手动检查程序集来阻止优化器破坏代码。但是，我想知道硬件在实践中是否仍然会弄乱代码。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-03T19:59:07.433

您检查组件的想法不够好；重新排序可以发生在硬件级别。

要回答您的问题“这是否是读取硬件的问题：”**是的！** 事实上，我自己也遇到过这个问题。

可以绕过单处理器系统或其他特殊情况的问题吗？我会争辩说“不”，因为五年后你可能需要在多核上运行，然后找到所有这些位置会很棘手（不可能？）。

一个例外：专为嵌入式硬件应用程序设计的软件，您确实可以完全控制硬件。事实上，在 ARM 处理器等情况下，我已经像这样“作弊”了。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-03T19:56:55.470

是的 - 在需要的地方使用内存屏障来防止指令重新排序。在一些 C++ 编译器中，volatile 关键字已扩展为每次读取和写入插入隐式内存屏障——但这不是一个可移植的解决方案。（对于 Interlocked* win32 API 也是如此）。Vista 甚至添加了一些新的更细粒度的 Interlocked API，让您可以指定读取或写入语义。

不幸的是，C++ 的内存模型如此松散，以至于任何类型的代码在某种程度上都是不可移植的，您必须为不同的平台编写不同的版本。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-03T19:51:13.547

就像您说的那样，由于在缓存或处理器级别进行了重新排序，您实际上确实需要某种内存屏障来确保正确同步，尤其是对于多处理器（尤其是在非 x86 平台上）。（我相信单处理器系统不存在这些问题，但请不要引用我的话——我当然更倾向于安全行事，无论如何都要进行同步访问。）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-03T20:16:50.627

我们遇到了这个问题，尽管在指令重新排序比 x86/x64 更激进的安腾处理器上。

解决方法是使用 Interlocked 指令，因为（当时）没有办法告诉编译器只是在赋值后设置一个写屏障。

我们真的需要语言扩展来干净地处理这个问题。在您试图从一段代码中挤出尽可能多的性能的情况下，使用 volatile（如果编译器支持）过于粗略。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-03T20:16:37.397

> 这是真实硬件上的问题吗？

绝对可以，尤其是现在，随着当前和未来 CPU 转向多核。如果您依赖有序原子性来实现应用程序中的功能，并且您无法通过您选择的平台或使用同步原语来保证这一要求，那么在*所有*情况下，即客户从单核 CPU 移动到多核 CPU ，那么您只是在等待问题发生。

引用 Herb Sutter 的文章（第二篇）

> 有序原子变量在流行的平台和环境中以不同的方式拼写。例如：
> 
> *   `volatile`在 C#/.NET 中，如`volatile int`.
> *   `volatile`或 * Atomic* 在 Java 中，如`volatile int`, `AtomicInteger`.
> *   `atomic<T>`在即将发布的 ISO C++ 标准 C++0x 中，如`atomic<int>`.

我还没有看到 C++0x 如何实现有序原子性，所以我无法指定即将推出的语言功能是纯库实现还是依赖于对语言的更改。在新标准可用之前，您可以查看该提案以查看它是否可以作为非标准扩展合并到您当前的工具链中，甚至可能已经适用于您的情况。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-03T20:08:40.360

这是真实硬件上的问题。我的一个朋友在 IBM 工作，主要靠找出客户代码中的这类问题为生。

如果您想了解情况会变得多么糟糕，请搜索有关 Java 内存模型（以及现在的 C++ 内存模型）的学术论文。考虑到真正的硬件可以做的重新排序，试图找出高级语言中的安全是一场噩梦。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-10-17T05:03:05.363

No this isn't safe and there is real hardware avaialble that exhibits this problem, for example the memory model in the powerpc chip on xbox 360 allows writes to be reordered. This is exacerbated by the lack of barriers in the intrinsics, see this article on [msdn](http://msdn.microsoft.com/en-us/library/ee418650%28VS.85%29.aspx) for more details.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-05T09:55:04.453

“它是否安全”这个问题的答案本质上是模棱两可的。

从某种意义上说，您的计算机不会着火，即使是双打也始终是安全的。它是安全的，因为你总是会得到一个 int 在过去某个时间持有的值，它是不安全的，因为你可能会得到一个被/将被另一个线程更新的值。

“原子”意味着您获得了第二个保证。由于 double 通常不是原子的，因此您可以获得 32 个旧位和 32 个新位。这显然是不安全的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-05T16:09:36.660

当我问到我对单处理器powerpc 最感兴趣的问题时。[InSciTek Jeff](https://stackoverflow.com/users/1553/inscitek-jeff)在其中一条评论中提到了 powerpc SYNC 和 ISYNC 指令。确定答案的关键所在。我在 IBM 的网站上找到了[它](http://www.ibm.com/developerworks/eserver/articles/powerpc.html)。

这篇文章很大而且很密集，但带走的是不，它不安全。在较旧的 powerpc 上，内存优化器不够复杂，不会导致单处理器出现问题。然而，较新的更具侵略性，甚至可以破坏对全局 int 的简单访问。

# sql - MySQL - 从具有相同结构但数据不同的多个表中选择数据

> ID：409705
> 
> 赞同：83
> 
> 时间：2009-01-03T19:53:05.057
> 
> 标签：sql, mysql, join, mysql-error-1052

好的，这是我的困境，我有一个数据库设置了大约 5 个表，所有表都具有完全相同的数据结构。出于本地化目的，数据以这种方式分离，总共拆分出大约 450 万条记录。

大多数时候只需要一张桌子，一切都很好。但是，有时需要来自 2 个或更多表的数据，并且需要按用户定义的列进行排序。这是我遇到问题的地方。

数据列：

```
id, band_name, song_name, album_name, genre 
```

MySQL 语句：

```
SELECT * from us_music, de_music where `genre` = 'punk' 
```

MySQL 吐出这个错误：

```
#1052 - Column 'genre' in where clause is ambiguous 
```

显然，我做错了。有人愿意为我解释一下吗？

* * *

## 回答 #1

> 赞同：179
> 
> 时间：2009-01-03T20:00:37.413

我认为您正在寻找[UNION](http://dev.mysql.com/doc/refman/5.1/en/union.html)子句，a la

```
(SELECT * from us_music where `genre` = 'punk')
UNION
(SELECT * from de_music where `genre` = 'punk') 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-01-03T20:00:43.483

听起来你会喜欢一张桌子。这五个具有相同的模式，有时需要将它们呈现为好像它们来自一个表，这意味着将它们全部放在一个表中。

添加一个可用于区分五种语言的新列（我假设它是表中不同的语言，因为您说它是用于本地化的）。不要担心有 450 万条记录。任何真正的数据库都可以处理这个大小没有问题。添加正确的索引，您可以轻松地将它们作为单个表处理。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-03T20:06:50.193

以上任何答案都是有效的，或者另一种方法是扩展表名以包含数据库名称 - 例如：

```
SELECT * from us_music, de_music where `us_music.genre` = 'punk' AND `de_music.genre` = 'punk' 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-03T20:12:00.323

该列是模棱两可的，因为它出现在两个表中，您需要完全指定 where（或排序）字段，例如 us_music.genre 或 de_music.genre，但如果您随后要将它们连接在一起，您通常会指定两个表一些时尚。您处理的结构有时被称为分区表，尽管它通常也将数据集分成不同的文件，而不是任意拆分数据集。如果您负责数据库结构并且没有充分的理由对数据进行分区，那么我将构建一个包含国家代码的额外“来源”字段的大表，但您可能出于正当的性能原因这样做. 使用联合来加入您对[http://dev.mysql 感兴趣的表。](http://dev.mysql.com/doc/refman/5.0/en/union.html)或通过使用合并数据库引擎[http://dev.mysql.com/doc/refman/5.1/en/merge-storage-engine.html](http://dev.mysql.com/doc/refman/5.1/en/merge-storage-engine.html)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-05T23:51:04.437

您最初尝试跨越两个表会创建一个隐式 JOIN。大多数有经验的 SQL 程序员都不赞成这种做法，因为它将要组合的表与如何组合的条件分开。

对于这些表来说，这`UNION`是一个很好的解决方案，但应该没有理由不能将它们放入一个具有良好索引的表中。我已经看到将正确的索引添加到大表中可以将查询速度提高三个数量级。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-11-07T13:33:31.903

该`union`声明导致大量数据的交易时间。最好分两步执行选择：

1.  选择身份证
2.  然后用它选择主表

# proxy - 如何从http请求中判断客户端的唯一性？

> ID：409716
> 
> 赞同：1
> 
> 时间：2009-01-03T19:59:07.510
> 
> 标签：proxy, httpwebrequest

我注意到，当客户端通过代理服务器发出 http 请求时，请求的 IP 地址始终是代理的 IP 地址。因此，如果来自具有代理服务器的大公司的许多客户访问网站，我无法判断这些请求是否来自独特的客户。如果http请求是通过代理，有什么方法可以确定客户端的唯一性？我知道mac地址不包含在http请求中，所以我几乎排除了这一点。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-03T20:01:01.967

最简单的方法是在响应中设置一个 cookie，并在请求中检查它。如果它在那里，那么您之前已经看过该客户端（并且您可以在 cookie 中包含一些标识）。当然，这依赖于客户端感知 cookie 并且用户没有禁用 cookie（或手动清除它们）。

还有一些客户端的问题，它们可能知道 cookie，但每次都会有效地从头开始 - 例如，如果有人运行程序来抓取您的网站，它可能每次都会从一个新的 cookie jar 开始，不管你如何设置cookie。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T20:00:15.743

[为每个具有GUID](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)的新用户提供一个 cookie 。您可以跟踪它，甚至可以在服务器日志中包含 GUID。

我们使用我们的公共网络服务器执行此操作，以跟踪通过我们网站的“唯一路径”。

# html - 如何最好地编写针对 HTML 和 PDF 的文档？

> ID：409717
> 
> 赞同：20
> 
> 时间：2009-01-03T19:59:19.087
> 
> 标签：html, pdf, documentation, latex, pdf-generation

我过去见过的 Latex-to-html 转换器非常糟糕。编辑原始 html 并不好玩，而且似乎不能很好地转换为打印页面。其他人如何解决这个问题？示例链接（pdf 和 html）会很棒。

补充：刚刚问了另一个类似的问题：

[我应该为项目文档使用什么格式语言](https://stackoverflow.com/questions/603272/what-formatting-language)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-04T04:31:48.940

对于记录代码，我还推荐 Sphinx。ReStructured Text 很好，因为它可读并且在某种程度上以纯文本形式标记，并且可以很好地转换为 html 和 pdf。对于某些事情，我仍然喜欢 LaTeX。我和我的妻子使用 LaTeX 写圣诞信，然后通过普通邮件寄出。pdf 版本非常漂亮，有两列，页眉和页脚。html版本更简单。我用塑料转换。这里的例子：http: [//fedibblety.com/annualReports](http://fedibblety.com/annualReports)

对于 10 年后您可能想阅读的任何类型的文档，我认为任何二进制格式都不是一个好的选择（Word）。这是 LaTeX 的优点之一。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-03T22:01:04.550

经过多年的痛苦和几次错误的开始，我将重新审视这一点，我将尝试一下[Sphinx](http://sphinx.pocoo.org/)。[它可以从ReStructured Text](http://en.wikipedia.org/wiki/ReStructuredText)生成 HTML 或 LaTeX 。

我希望这将是一个比完整 DocBook 更“轻”的选项，但具有许多优点。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-03T20:09:58.753

是的，LaTeX-to-HTML 转换器过去很糟糕（您可能已经尝试过 LaTeX2HTML），但最近它们变得更好了。[Tex4ht](http://www.cse.ohio-state.edu/~gurari/TeX4ht/mn.html)是高度可配置的，并且可以生成漂亮的 XHTML+CSS。另请参阅[其他转换器](http://www.tex.ac.uk/cgi-bin/texfaq2html?label=LaTeX2HTML)。

你也可以使用[Docbook](http://www.docbook.org/)，如果你能忍受在里面写的话。有从 DocBook 到 HTML 和 LaTeX（或直接到 PDF）的转换器；后者的一个例子是[dblatex](http://dblatex.sourceforge.net/)。

请参阅这篇文章：[LaTeX vs Docbook](http://www.serpentine.com/blog/2006/06/20/latex-vs-docbook/)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-03T20:08:26.883

您可以退后一步，使用 DocBook 之类的东西，并通过 LaTeX 和 HTML 直接从 DocBook 文件呈现为 PDF。或者，Adobe Technical Communication Suite (Framemaker) 可让您将文档单一来源转换为 PDF 和 HTML。有关各种技术文档系统的概要，请参阅[此帖子](https://stackoverflow.com/questions/371654/application-not-a-markup-language-for-producing-a-user-manual#372017)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-03T20:31:43.577

[PlasTeX](http://plastex.sourceforge.net/)看起来像一个不错的 latex-to-html 转换器，虽然我自己没有尝试过。

我的朋友 Rob Felty 写了一篇博文来赞美它的优点： [http ://blog.robfelty.com/2008/03/19/finally-a-better-latex-to-html-converter/](http://blog.robfelty.com/2008/03/19/finally-a-better-latex-to-html-converter/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-03T20:32:45.103

[AsciiDoc](http://www.methods.co.nz/asciidoc/)看起来是一个有趣的可能性。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-03T21:41:50.907

这是个人选择，但乳胶在理论上是完美的，但在实践中它是痛苦的。我在需要时使用 VS.NET HTML 编辑器 + 原始 HTML 编辑器。

所以我认为使用 WSIWYG HTML 编辑器是最好的选择。您始终可以使用简单的工具将其转换为 PDF，并且您可以在需要高级内容时随时编辑 HTML。此外，当您需要时，它更容易上线。

这就是我管理我的软件文档并为我工作的方式。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-02-23T17:45:03.120

阅读 EPUB 格式。它的电子书格式。[http://en.wikipedia.org/wiki/EPUB](http://en.wikipedia.org/wiki/EPUB)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-03-06T07:00:49.240

由于提到[Asciidoc](http://www.methods.co.nz/asciidoc/)的答案在示例上有些不足，因此这里有一些您正在寻找的东西：

*   使用 Asciidoc 生成的[pdf](http://www.methods.co.nz/asciidoc/asciidoc.pdf)
*   与Asciidoc标记和 html 结果并排的备忘单[。](http://powerman.name/doc/asciidoc)
*   使用Asciidoc 完成的出版物[列表](http://www.methods.co.nz/asciidoc/#X6)，包括 O'Reilly 书籍和 git 文档（查看用户规模的两端）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-07T09:25:48.910

我们一直在使用 WebWorks ePublisher (www.webworks.com)，它提供多种单一来源格式（我们使用 Word）和输出多种输出格式的能力（我们输出到 Adob​​e PDF 和在线帮助 (.CHM) .

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-03T20:35:33.287

我过去使用过[TeXinfo](http://www.gnu.org/software/texinfo/)，它做得很好。这是一个示例：http: [//yootles.com/api](http://yootles.com/api)。我宁愿坚持使用 LaTeX 而不是使用另一种语言。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-03T20:10:49.420

我不确定乳胶是否真的是最好的工具。您在使用通常的乳胶到 html 转换器时遇到的问题表明了这个问题：html 很简单，不如乳胶那么富有表现力。

如果您坚持将latex转为html，请注意使用可以合理转换的有限子集。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-04T05:23:01.960

如果其他一切都失败了，您可以获取一个 LaTeX 到 XML 转换器并编写一个简单的 XSLT 样式表将其转换为 HTML，或者创建一个 CSS 样式表并将其直接附加到 XML 文件。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-01-28T11:59:51.680

我没有足够的评论点，但为了支持 plastex 的答案，这里是更新的 plastex 示例链接：

[http://robfelty.com/2008/03/19/finally-a-better-latex-to-html-converter](http://robfelty.com/2008/03/19/finally-a-better-latex-to-html-converter)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-12-28T20:05:35.267

我们在一个涉及 Eclipse 软件的学术项目中遇到了这个问题，我们使用 platex 将 Latex 转换为 HTML 和 Eclipse 帮助。让它工作起来相当困难，但最终的结果看起来非常好。您可以在此处查看所有三个版本：

[http://handbook.event-b.org/](http://handbook.event-b.org/)

此外，由于这是一个开放项目，因此可以使用代码（构建脚本）。我们有一个持续构建系统（Jenkins），当新的 Latex 被签入时，它会重建所有内容。这特别好，因为贡献者不需要在他们的系统上安装工具链。他们只需签入新的 Latex 并在服务器上检查 HTML 是否正确生成。资料来源：

[http://sourceforge.net/p/rodin-b-sharp/svn/HEAD/tree/trunk/Handbook/org.rodinp.handbook.feature/](http://sourceforge.net/p/rodin-b-sharp/svn/HEAD/tree/trunk/Handbook/org.rodinp.handbook.feature/)

最好的，迈克尔

* * *

## 回答 #16

> 赞同：-16
> 
> 时间：2009-01-03T20:41:03.433

乳胶？严重地？我不知道学术界以外的任何人仍在使用它。我会使用 HTML，您可以从网络浏览器将其保存为 PDF。如果你真的必须有一些高级的印刷材料，请改用 Word - 它有一种保存为 HTML 的方法（可能不像人们想要的那样干净），你可以使用免费插件（可单独下载）另存为 PDF .

哦，我不会费心使用 InDesign 之类的东西——它们太过分了。此外，不必费心为 Acrobat Professional 付费 - 有无数免费的解决方案可供使用。

# openid - 如何将现有用户转换为 OpenID

> ID：409718
> 
> 赞同：4
> 
> 时间：2009-01-03T19:59:56.307
> 
> 标签：openid

我不想疏远我的用户，但是有多种登录网站的方式违背了实现 OpenID 的目的。这不是一个全新的网站，大约有 3k 用户，这些用户有点顽固（我们有一个很棒的社区），但并非所有人都是，而且我不想因为登录过程而失去任何人。

有没有一种简单的方法可以将现有帐户转换为 OpenId？还是我将不得不创建某种“与旧帐户关联”。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-03T20:06:08.090

要为每个用户创建 OpenId，您需要提供自己的身份提供者服务来控制这些用户。这可能比拥有两种身份验证方式需要更多的工作。我建议您提供两种方式，这是大多数网站处理此问题的方式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T20:09:08.037

OpenID 的优势在于它允许人们在您的站点上使用他们现有的身份。我不认为有两种登录方式会破坏这个目的，因为没有现有身份的用户会发现 openID 不方便。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-04T14:59:54.977

查看 UserVoice（由 SO 使用）处理传统登录和 OpenID 登录的方式。它们以直接的方式共存。

# security - 如何强制 SharePoint 任务只能由“分配给”编辑？

> ID：409725
> 
> 赞同：1
> 
> 时间：2009-01-03T20:04:36.580
> 
> 标签：security, sharepoint, permissions

我们正在使用团队网站中的默认任务列表，并希望仅允许任务“分配给”的那些人编辑任务。您如何执行此操作？

当我们尝试“高级设置”时，我们发现“Only their own”仅表示当前用户创建的那些任务。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-04T23:29:38.660

看起来您需要创建一个事件处理程序，每次更改分配的用户时更新任务的权限。

过去有不少人遇到过这个问题。

查看[此](http://suguk.org/forums/thread/11068.aspx)站点以获取人们遇到的问题的示例。也就是说，如果您在设置任务列表时复制内容，它应该可以开箱即用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-11T17:29:11.060

看起来，事件处理程序是要走的路。我在一些搜索中找到了这个页面，它解释了很多与这个问题相关的问题：

[电子邮件通知和警报 - Sharepoint 任务列表](http://geekswithblogs.net/DanielC/archive/2008/02/10/email-notifications-and-alerts---sharepoint-tasks-list.aspx)

不幸的是，客户不想要自定义代码，只想要 SP Designer 工作流程和基于浏览器的自定义......

# database - 为什么 PostgreSQL 会占用我所有宝贵的 HD 空间？

> ID：409727
> 
> 赞同：2
> 
> 时间：2009-01-03T20:05:56.950
> 
> 标签：database, linux, postgresql, configuration, rdbms

我刚刚完成了尽可能多的关于维基百科（英语）的链接结构数据的传输。[基本上，我从维基百科的最新转储存储库](http://download.wikimedia.org/enwiki/latest/)下载了一堆 SQL 转储。由于我使用的是 PostgreSQL 而不是 MySQL，因此我决定使用[管道 shell 命令](http://jhacks.anzix.net/space/kocka/my2pg)将所有这些转储加载到我的数据库中。

无论如何，其中一张表有 2.95 亿行：*pagelinks*表；它包含所有内部 wiki 超链接。从我的笔记本电脑上，使用 pgAdmin III，我将以下命令发送到我的数据库服务器（另一台计算机）：

```
SELECT pl_namespace, COUNT(*) FROM pagelinks GROUP BY (pl_namespace); 
```

它已经在那里待了一个小时左右。问题是邮政局长似乎越来越多地占用我非常有限的高清空间。我认为到目前为止它吃了大约 20 GB。我之前曾使用过 postgresql.conf 文件，以便为它提供更大的性能灵活性（即让它使用更多资源），因为它使用 12 GB 的 RAM 运行。我想我基本上将这个文件的大多数字节和这些相关变量增加了四倍，认为它会使用更多的 RAM 来完成它的工作。

但是，数据库似乎并没有使用太多 RAM。使用 Linux 系统监视器，我可以看到 postmaster 正在使用 1.6 GB 的共享内存 (RAM)。无论如何，我想知道你们是否可以帮助我更好地理解它在做什么，因为我似乎真的不明白*PostgreSQL 如何使用 HD 资源*。

关于 wikipedia 数据库的元结构，它们提供了一个很好的[模式](http://upload.wikimedia.org/wikipedia/commons/4/41/Mediawiki-database-schema.png)，可能有用，甚至你感兴趣。

请随时向我询问更多详细信息，谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-03T21:25:01.813

这可能是导致问题的 GROUP BY。为了进行分组，数据库必须对行进行排序以将重复项放在一起。索引可能无济于事。粗略计算：

假设每行占用 100 字节空间，即 29,500,000,000 字节，或大约 30GB 的存储空间。它无法将所有这些都放入内存中，因此您的系统正在抖动，这会使操作速度减慢 1000 倍或更多。如果它正在使用交换文件，您的 HD 空间可能会消失在交换空间中。

如果您只需要执行一次此计算，请尝试将其分解为更小的数据子集。假设 pl_namespace 是数字且范围为 1-2.95 亿，请尝试以下操作：

```
SELECT pl_namespace, COUNT(*)
FROM pagelinks
WHERE pl_namespace between 1 and 50000000
GROUP BY (pl_namespace); 
```

然后对 50000001-100000000 执行相同的操作，依此类推。使用 UNION 将您的答案组合在一起，或者使用外部程序简单地将结果制成表格。忘记我写的关于索引对 GROUP BY 没有帮助的内容；在这里，索引将有助于 WHERE 子句。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T20:27:50.807

究竟是*什么*声称它只占用 9.5MB 的 RAM？这在我看来不太可能——共享内存几乎可以肯定*是*在不同 Postgres 进程之间共享的 RAM。（据我记得，每个客户最终都是一个单独的进程，虽然已经有一段时间了，所以我可能会错。）

`pl_namespace`列上有索引吗？如果有大量不同的结果，我可以想象在没有索引的 2.95 亿行表上查询会非常繁重。话虽如此，10GB 的容量实在是太大了。你知道它正在写入哪些文件吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-03T21:43:02.557

好的，这是它的要点：

GROUP BY 子句使索引无效，因此 postmaster（postgresql 服务器进程）决定创建一组位于 $PGDATA/base/16384/pgsql_tmp 目录中的表（23GB 表）。

在修改 postgresql.conf 文件时，我已允许 postgreSQL 使用 1.6 GB 的 RAM（我现在将它加倍，因为它可以访问 11.7 GB 的 RAM）；postmaster 进程确实使用了 1.6 GB 的 RAM，但这还不够，因此 pgsql_tmp 目录。

正如 Barry Brown 所指出的，由于我只是执行此 SQL 命令来获取有关*pagelinks.namespaces*之间链接分布的一些统计信息，因此我可以查询 2.96 亿个页面链接中的一个子集*（*这就是他们所做的用于调查）。

当命令返回结果集时，所有临时表都被自动删除，就好像什么都没发生一样。

谢谢你们的帮助！

# python - 更改列表的元素

> ID：409732
> 
> 赞同：15
> 
> 时间：2009-01-03T20:07:28.990
> 
> 标签：python, coding-style

我有一个布尔值列表，有时我会将它们全部重置为 false。在首先将复位写为：

```
for b in bool_list:
    b = False 
```

我发现它不起作用。我花了一点时间挠头，然后想起这当然行不通，因为我只是更改了对 bool 的引用，而不是它的值。所以我改写为：

```
for i in xrange(len(bool_list)):
    bool_list[i] = False 
```

一切正常。但我发现自己在问，“这真的是改变列表中所有元素的最 Pythonic 的方式吗？” 还有其他方法可以更有效或更清晰吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-03T20:13:14.517

如果您只有一个对列表的引用，则以下内容可能更容易：

```
bool_list = [False] * len(bool_list) 
```

这将创建一个填充有`False`元素的新列表。

有关类似示例，请参阅我对[Python dictionary clear](https://stackoverflow.com/questions/369898/python-dictionary-clear#369925)的回答。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-01-03T20:30:42.267

这是另一个版本：

```
bool_list = [False for item in bool_list] 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-04T01:09:25.450

**总结** 性能方面，numpy 或列表乘法是明显的赢家，因为它们比其他方法快 10-20 倍。

我对提出的各种选项进行了一些性能测试。我在 Linux (Ubuntu 8.10) 上使用 Python 2.5.2 和 1.5 Ghz Pentium M。

**原来的：**

```
python timeit.py -s 'bool_list = [True] * 1000' 'for x in xrange(len(bool_list)): bool_list[x] = False' 
```

1000 个循环，最好的 3 个：每个循环 280 微秒

**使用列表理解的基于切片的替换：**

```
python timeit.py -s 'bool_list = [True] * 1000' 'bool_list[:] = [False for element in bool_list]' 
```

1000 个循环，3 个循环中的最佳：每个循环 215 微秒

**使用生成器理解的基于切片的替换：**

```
python timeit.py -s 'bool_list = [True] * 1000' 'bool_list[:] = (False for element in bool_list)' 
```

1000 个循环，最好的 3 个：每个循环 265 微秒

**枚举**：

```
python timeit.py -s 'bool_list = [True] * 1000' 'for i, v in enumerate(bool_list): bool_list[i] = False' 
```

1000 个循环，3 个循环中的最佳：每个循环 385 微秒

**麻木**：

```
python timeit.py -s 'import numpy' -s 'bool_list = numpy.zeros((1000,), dtype=numpy.bool)' 'bool_list[:] = False' 
```

10000 个循环，最好的 3 个：每个循环 15.9 微秒

**使用列表乘法的基于切片的替换：**

```
python timeit.py -s 'bool_list = [True] * 1000' 'bool_list[:] = [False] * len(bool_list)' 
```

10000 次循环，3 次中的最佳：每个循环 23.3 微秒

**使用列表乘法替换引用**

```
 python timeit.py -s 'bool_list = [True] * 1000' 'bool_list = [False] * len(bool_list)' 
```

10000 个循环，最好的 3 个：每个循环 11.3 微秒

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-01-03T23:11:59.977

```
bool_list[:] = [False] * len(bool_list) 
```

或者

```
bool_list[:] = [False for item in bool_list] 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-03T20:26:03.307

如果您愿意使用[numpy](http://numpy.scipy.org/)数组，那么使用数组切片实际上很容易做到这样的事情。

```
import numpy

bool_list = numpy.zeros((100,), dtype=numpy.bool)

# do something interesting with bool_list as if it were a normal list

bool_list[:] = False
# all elements have been reset to False now 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-03T20:13:52.270

我不会使用范围和 len。使用 enumerate() 更简洁

```
for i, v in enumerate(bool_list): #i, v = index and value
    bool_list[i] = False 
```

在这种情况下，它留下了一个未使用的变量，但在我看来它仍然看起来更干净。性能也没有明显变化。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-03T20:14:17.667

对于诸如 int、bool 和 string 之类的值类型，您的第二个示例与它所获得的一样漂亮。您的第一个示例将适用于任何引用类型，例如类、字典或其他列表。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-03T22:39:19.340

我认为

```
bool_list = [False for element in bool_list] 
```

就像它得到的一样pythonic。使用这样的列表通常应该比 python 中的 for 循环更快。

# php - 为什么我的 MySQL 数据列中只保存了 64kB 的数据？

> ID：409761
> 
> 赞同：12
> 
> 时间：2009-01-03T20:28:36.593
> 
> 标签：php, mysql, text, blob

我试图在 MySQL Blob 列中插入一个很长的文本字符串，但 MySQL 只保存了 64kB 的数据。该字符串的长度为 75360 个字符。我正在连接 PHP 的`mysql_connect()`.

有任何想法吗？

如果它是 Blob 或 Text，它会有所不同吗？我最初将它作为文本，但更改它没有任何影响。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-03T20:31:13.450

因为这是 BLOB 列的[最大大小](http://dev.mysql.com/doc/refman/5.0/en/storage-requirements.html)。您需要使用 MEDIUMBLOB/LONGBLOB 或 MEDIUMTEXT/LONGTEXT。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-03T20:36:29.353

MySQL 中的一个`BLOB`类型最多可以存储 65,534 个字节，如果您尝试存储超过这个数据量，MySQL 将截断数据。 `MEDIUMBLOB`最多可存储 16,777,213 字节，`LONGBLOB`最多可存储 4,294,967,292 字节。

如果启用严格的 SQL 模式（[MySQL 模式](http://dev.mysql.com/doc/refman/5.0/en/server-sql-mode.html)），当您尝试存储不适合列类型的数据时，您将收到错误消息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-03T23:39:44.740

您还询问了 BLOB 和 TEXT BLOBS 用于二进制数据是否有区别。如果您对 BLOB 字段执行 LIKE 查询，它将区分大小写。

IE

```
SELECT 'TEXT' LIKE 'TEXT';
=> 1 for both BLOB and TEXT

SELECT 'TEXT' LIKE 'text';
=> 1 for TEXT
=> 0 for BLOB 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T20:33:20.717

[根据文档](http://dev.mysql.com/doc/refman/4.1/en/storage-requirements.html)，blob 列只有 64Kb

请尝试使用 mediumblob 列类型...

# string - 字符串长度是否等于字节大小？

> ID：409765
> 
> 赞同：15
> 
> 时间：2009-01-03T20:30:54.653
> 
> 标签：string, byte

正是这样：字符串长度是否等于字节大小？对语言有影响吗？

我想是的，但我只是想确定一下。

附加信息：我只是想知道。我的具体情况是 PHP 和 MySQL。

答案是否定的，这就是我所需要知道的。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-01-03T20:32:40.203

没有。以零结尾的字符串有一个额外的字节。帕斯卡字符串（Delphi 短字符串）有一个额外的字节作为长度。并且 unicode 字符串每个字符有一个以上的字节。

通过 unicode，它取决于编码。每个字符可以是 2 或 4 个字节，甚至可以是 1,2 和 4 个字节的混合。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-01-03T20:40:08.643

这完全取决于平台和代表。

例如，在 .NET中，每个 UTF-16 代码点的字符串占用*内存中的两个字节。*但是，代理对需要两个 UTF-16 值来表示 U+100000 到 U+10FFFF 范围内的完整 Unicode 字符。内存形式也有字符串长度的开销，可能还有一些填充，以及类型指针的正常对象开销等。

现在，当您从 .NET 将字符串写入磁盘（或网络等）时，您需要指定编码（大多数类默认为 UTF-8）。此时，大小很大程度上取决于编码。ASCII 总是每个字符占用一个字节，但非常有限（没有重音等）；UTF-8 提供了具有可变编码的完整 Unicode 范围（所有 ASCII 字符都以单个字节表示，但其他字符占用更多）。UTF-32 总是为任何 Unicode 字符使用 4 个字节——这个列表还在继续。

如您所见，这不是一个简单的话题。要确定一个字符串将占用多少空间，您需要*准确*指定情况 - 它是否是某个平台上的内存中的对象（如果是，哪个平台 - 甚至可能细化到实现和操作系统设置），或者它是否是原始编码形式（例如文本文件），如果是，则使用哪种编码。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-03T20:32:51.310

这取决于您所说的“长度”是什么意思。如果您的意思是“字符数”，那么，不，许多语言/编码方法每个字符使用多个字节。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-03T20:32:48.003

并非总是如此，这取决于编码。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-03T20:45:56.667

没有单一的答案；它取决于语言*和*实现（请记住，有些语言有多种实现！）

以零结尾的 ASCII 字符串*至少*比字符串的“内容”多一个字节。（可能会分配更多，具体取决于字符串的创建方式。）

非零终止字符串使用描述符（或类似结构）来记录长度，这会在*某处*占用额外的内存。

Unicode 字符串（在各种语言中）每个字符使用两个字节。

对象存储中的字符串可以通过句柄引用，这增加了一层间接（和更多数据）以简化内存管理。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-03T20:47:00.143

你是对的。如果编码为 ASCII，则每个字符有一个字节。否则，它是每个字符一个或多个字节。

特别是，重要的是要知道这如何影响子字符串操作。如果每个字符没有一个字节，s[n] 会得到第 n 个字节还是第 n 个字符？对于较大的 n 而不是常量，获取第 n 个字符效率低下，因为每个字符一个字节。

# python - 在python中解析嵌入在HTML中的固定格式数据

> ID：409769
> 
> 赞同：0
> 
> 时间：2009-01-03T20:32:20.610
> 
> 标签：python, html, google-app-engine, parsing, html-content-extraction

我正在使用谷歌的 appengine api

```
from google.appengine.api import urlfetch 
```

获取网页。的结果

```
result = urlfetch.fetch("http://www.example.com/index.html") 
```

是 html 内容的字符串（在 result.content 中）。问题是我要解析的数据并不是真正的 HTML 格式，所以我不认为使用 python HTML 解析器对我有用。我需要解析 html 文档正文中的所有纯文本。唯一的问题是 urlfetch 返回整个 HTML 文档的单个字符串，删除所有换行符和多余的空格。

**编辑：** 好的，我尝试获取不同的 URL，显然 urlfetch 没有去除换行符，这是我试图解析的原始网页以这种方式提供 HTML 文件...... **结束编辑**

如果文件是这样的：

```
<html><head></head><body>
AAA 123 888 2008-10-30 ABC
BBB 987 332 2009-01-02 JSE
...
A4A       288        AAA
</body></html> 
```

在 urlfetch 获取它之后，result.content 将是这样的：

```
'<html><head></head><body>AAA 123 888 2008-10-30 ABCBBB 987     2009-01-02 JSE...A4A     288            AAA</body></html>' 
```

使用 HTML 解析器不会帮助我处理 body 标签之间的数据，所以我打算使用正则表达式来解析我的数据，但是正如你所看到的，一行的最后一部分与下一行的第一部分结合在一起，我不知道如何拆分它。我试过

```
result.content.split('\n') 
```

和

```
result.content.split('\r') 
```

但结果列表只是 1 个元素。我在谷歌的 urlfetch 函数中看不到任何不删除换行符的选项。

有什么想法可以解析这些数据吗？也许我需要以不同的方式获取它？

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-03T20:36:30.413

我能想到的唯一建议是将其解析为具有固定宽度的列。HTML 不考虑换行符。

如果您可以控制源数据，请将其放入文本文件而不是 HTML。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T21:13:07.360

我了解文档的格式是您发布的格式。在这种情况下，我同意像[Beautiful Soup](http://www.crummy.com/software/BeautifulSoup/)这样的解析器可能不是一个好的解决方案。

我假设您已经使用正则表达式获得了有趣的数据（在 BODY 标签之间）

```
import re
data = re.findall('<body>([^\<]*)</body>', result)[0] 
```

那么，它应该很简单：

```
start = 0
end = 5
while (end<len(data)):
   print data[start:end]
   start = end+1
   end = end+5
print data[start:] 
```

（注意：我没有根据边界情况检查此代码，我确实希望它会失败。这里只是为了展示一般的想法）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-04T00:18:04.413

将正文文本作为单个长字符串后，您可以将其分解如下。这假定每条记录是 26 个字符。

```
body= "AAA 123 888 2008-10-30 ABCBBB 987     2009-01-02 JSE...A4A     288            AAA"
for i in range(0,len(body),26):
    line= body[i:i+26]
    # parse the line 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-04T01:08:14.500

编辑：阅读理解是一件可取的事情。我错过了关于线条一起运行而它们之间没有分隔符的一点，这有点像这一切，不是吗？所以，别管我的回答，它实际上并不相关。

* * *

如果您知道每行是 5 个以空格分隔的列，那么（一旦您删除了 html）您可以执行类似（未经测试）的操作：

```
def generate_lines(datastring):
    while datastring:
        splitresult = datastring.split(' ', 5)
        if len(splitresult) >= 5:
            datastring = splitresult[5]
        else:
            datastring = None
        yield splitresult[:5]

for line in generate_lines(data):
    process_data_line(line) 
```

当然，您可以根据需要更改拆分字符和列数（甚至可能将它们作为附加参数传递给生成器函数），并根据需要添加错误处理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T21:52:46.303

`s`将字符串拆分为 26 个字符块的进一步建议：

作为一个列表：

```
>>> [s[x:x+26] for x in range(0, len(s), 26)]
['AAA 123 888 2008-10-30 ABC',
 'BBB 987     2009-01-02 JSE',
 'A4A     288            AAA'] 
```

作为生成器：

```
>>> for line in (s[x:x+26] for x in range(0, len(s), 26)): print line
AAA 123 888 2008-10-30 ABC
BBB 987     2009-01-02 JSE
A4A     288            AAA 
```

如果很长`range()`，`xrange()`请在 Python 2.x 中替换为。`s`

# ruby-on-rails - 带有开放 id 的 Rails 友好 url 路由

> ID：409782
> 
> 赞同：1
> 
> 时间：2009-01-03T20:37:09.993
> 
> 标签：ruby-on-rails, security, rest, routing, openid

我想为用户的开放ID创建一个rails路线。网址看起来像

```
http://mysite.com/identity/:html_encoded_openid
or
http://mysite.com/identity/:html_encoded_openid.xml 
```

这样就可以向站点查询一个打开的 id 并查看该身份的信息或接收包含该信息的 xml 文档。标准 Rails 的东西。

我正在寻找您在以下方面的专业知识：

1.  标准的 rails 路线似乎在 openid 中阻塞了 .s ，因此：

    [http://mysite.com/identity/openid](http://mysite.com/identity/openid)

    会找到一条路线，但

    [http://mysite.com/identity/openid.myopenid.com](http://mysite.com/identity/openid.myopenid.com)

    不会。

2.  我需要注意哪些安全问题？

3.  有没有更好的方法来编码查询，也许是查询字符串？

而且我宁愿不使用标准的友好 url 方法：

```
my-friendly-openid-com
or
23-my-friendly-openid-com 
```

如果可能的话。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T21:08:32.067

您可以使用类似这样的方式处理第二条路线（将动作名称替换为真实的名称）。

```
map.connect 'identity/:id', :controller => "identity", 
                            :action => "foo", 
                            :requirements => {:id => /(\w+\.?)+/} 
```

# python - socket.shutdown 与 socket.close

> ID：409783
> 
> 赞同：146
> 
> 时间：2009-01-03T20:37:55.153
> 
> 标签：python, sockets, asynchronous

我最近看到了一些看起来像这样的代码（当然 sock 是一个套接字对象）：

```
sock.shutdown(socket.SHUT_RDWR)
sock.close() 
```

在套接字上调用shutdown然后关闭它的目的到底是什么？如果有所不同，则此套接字用于非阻塞 IO。

* * *

## 回答 #1

> 赞同：272
> 
> 时间：2009-02-28T21:58:05.953

调用`close`和`shutdown`对底层套接字有两种不同的影响。

首先要指出的是，套接字是底层操作系统中的一种资源，**多个进程可以拥有同一个底层套接字的句柄。**

当您调用`close`它时，将句柄计数减一，如果句柄计数达到零，则套接字和关联的连接将通过正常的关闭过程（有效地向对等方发送 FIN / EOF）并释放套接字。

这里要注意的是，如果句柄计数没有达到零，因为另一个进程仍然有套接字的句柄，那么连接**不会关闭，套接字也不会被释放。**

另一方面，调用`shutdown`读取和写入会关闭底层连接并向对等方发送 FIN / EOF，而不管有多少进程拥有套接字的句柄。但是，它**不会**释放套接字，您仍然需要在之后调用 close。

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2009-01-03T21:10:08.210

这是一种[解释](http://publib.boulder.ibm.com/infocenter/systems/index.jsp?topic=/com.ibm.aix.progcomm/doc/progcomc/skt_shutdn.htm)：

> 一旦不再需要套接字，调用程序可以通过对套接字描述符应用关闭子例程来丢弃套接字。如果在发生关闭时可靠的传递套接字具有与之关联的数据，则系统会继续尝试数据传输。但是，如果数据仍未交付，系统将丢弃该数据。如果应用程序对任何未决数据没有用处，它可以在关闭套接字之前使用套接字上的关闭子例程。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-01-04T01:28:29.593

关闭和关闭的解释：[Graceful shutdown (msdn)](http://msdn.microsoft.com/en-us/library/ms738547(VS.85).aspx)

关闭（在您的情况下）表明连接的另一端没有进一步读取或写入套接字的意图。然后关闭释放与套接字关联的所有内存。

省略关闭可能会导致套接字在操作系统堆栈中逗留，直到连接正常关闭。

IMO 名称“关闭”和“关闭”具有误导性，“关闭”和“销毁”会强调它们的区别。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-09-25T16:05:00.033

它在 Socket Programming HOWTO ( [py2](http://docs.python.org/2/howto/sockets.html#disconnecting) / [py3](http://docs.python.org/3/howto/sockets.html#disconnecting) )中有提到

> **断开连接**
> 
> 严格来说，您应该先`shutdown`在套接字上使用`close`它。这`shutdown`是对另一端套接字的建议。根据您传递的参数，它可以表示“<em>我不再发送，但我仍然会听”，或“<em>我不听，再见！”。然而，大多数套接字库都习惯于程序员忽略使用通常 a`close`与`shutdown(); close()`. 所以在大多数情况下，不需要显式关闭。
> 
> ...

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-04-09T08:21:53.857

上面这段代码是不是错了？

在关闭调用之后直接关闭调用可能会使内核丢弃所有传出缓冲区。

根据 [http://blog.netherlabs.nl/articles/2009/01/18/the-ultimate-so_linger-page-or-why-is-my-tcp-not-reliable](http://blog.netherlabs.nl/articles/2009/01/18/the-ultimate-so_linger-page-or-why-is-my-tcp-not-reliable) 需要在关机和关闭直到读取返回 0。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-04T01:52:19.717

有一些关闭的味道：http: [//msdn.microsoft.com/en-us/library/system.net.sockets.socket.shutdown.aspx](http://msdn.microsoft.com/en-us/library/system.net.sockets.socket.shutdown.aspx)。*nix 类似。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-03-31T16:03:46.890

Shutdown(1) ，强制套接字不发送更多数据

这在

1- 缓冲区刷新

2-奇怪的错误检测

3- 安全防护

让我再解释一下，当您从 A 向 B 发送数据时，并不保证会发送到 B ，只保证会发送到 A os 缓冲区，然后再将其发送到 B os 缓冲区

因此，通过在 A 上调用 shutdown(1) ，您可以刷新 A 的缓冲区，如果缓冲区不为空，则会引发错误，即：数据尚未发送到对等方

但是，这是不可撤销的，因此您可以在完全发送所有数据之后执行此操作，并且您希望确保它至少在对等操作系统缓冲区中

# java - 打印 Java 数组的最简单方法是什么？

> ID：409784
> 
> 赞同：2228
> 
> 时间：2009-01-03T20:39:39.440
> 
> 标签：java, arrays, printing

在 Java 中，数组不会覆盖`toString()`，因此如果您尝试直接打印一个，您会得到`className`+ '@' +[`hashCode`](https://en.wikipedia.org/wiki/Java_hashCode())数组的十六进制值，定义如下`Object.toString()`：

```
int[] intArray = new int[] {1, 2, 3, 4, 5};
System.out.println(intArray);     // prints something like '[I@3343c8b3' 
```

但通常，我们实际上想要更像`[1, 2, 3, 4, 5]`. 最简单的方法是什么？以下是一些示例输入和输出：

```
// Array of primitives:
int[] intArray = new int[] {1, 2, 3, 4, 5};
//output: [1, 2, 3, 4, 5]

// Array of object references:
String[] strArray = new String[] {"John", "Mary", "Bob"};
//output: [John, Mary, Bob] 
```

* * *

## 回答 #1

> 赞同：2995
> 
> 时间：2009-01-03T20:43:44.893

从 Java 5 开始，您可以在数组中使用[`Arrays.toString(arr)`](https://docs.oracle.com/javase/9/docs/api/java/util/Arrays.html#toString-int:A-)or[`Arrays.deepToString(arr)`](https://docs.oracle.com/javase/9/docs/api/java/util/Arrays.html#deepToString-java.lang.Object:A-)来表示数组。请注意，`Object[]`版本调用`.toString()`数组中的每个对象。输出甚至以您要求的确切方式进行装饰。

例子：

*   ### 简单数组：

    ```
    String[] array = new String[] {"John", "Mary", "Bob"};
    System.out.println(Arrays.toString(array)); 
    ```

    输出：

    ```
    [John, Mary, Bob] 
    ```

*   ### 嵌套数组：

    ```
    String[][] deepArray = new String[][] {{"John", "Mary"}, {"Alice", "Bob"}};
    System.out.println(Arrays.toString(deepArray));
    //output: [[Ljava.lang.String;@106d69c, [Ljava.lang.String;@52e922]
    System.out.println(Arrays.deepToString(deepArray)); 
    ```

    输出：

    ```
    [[John, Mary], [Alice, Bob]] 
    ```

*   ### `double`大批：

    ```
    double[] doubleArray = { 7.0, 9.0, 5.0, 1.0, 3.0 };
    System.out.println(Arrays.toString(doubleArray)); 
    ```

    输出：

    ```
    [7.0, 9.0, 5.0, 1.0, 3.0 ] 
    ```

*   ### `int`大批：

    ```
    int[] intArray = { 7, 9, 5, 1, 3 };
    System.out.println(Arrays.toString(intArray)); 
    ```

    输出：

    ```
    [7, 9, 5, 1, 3 ] 
    ```

* * *

## 回答 #2

> 赞同：398
> 
> 时间：2009-01-03T20:48:43.790

始终首先检查标准库。

```
import java.util.Arrays; 
```

然后尝试：

```
System.out.println(Arrays.toString(array)); 
```

或者如果您的数组包含其他数组作为元素：

```
System.out.println(Arrays.deepToString(array)); 
```

* * *

## 回答 #3

> 赞同：108
> 
> 时间：2010-05-12T21:01:09.077

很高兴知道，但是，至于“总是先检查标准库”，我永远不会偶然发现`Arrays.toString( myarray )`

--因为我专注于 myarray 的类型以了解如何执行此操作。我不想遍历这件事：我想要一个简单的调用来使它类似于我在 Eclipse 调试器中看到的那样，而 myarray.toString() 只是没有这样做。

```
import java.util.Arrays;
.
.
.
System.out.println( Arrays.toString( myarray ) ); 
```

* * *

## 回答 #4

> 赞同：103
> 
> 时间：2014-02-06T23:35:32.600

在 JDK1.8 中，您可以使用聚合操作和 lambda 表达式：

```
String[] strArray = new String[] {"John", "Mary", "Bob"};

// #1
Arrays.asList(strArray).stream().forEach(s -> System.out.println(s));

// #2
Stream.of(strArray).forEach(System.out::println);

// #3
Arrays.stream(strArray).forEach(System.out::println);

/* output:
John
Mary
Bob
*/ 
```

* * *

## 回答 #5

> 赞同：48
> 
> 时间：2015-12-23T18:51:48.707

从 Java 8 开始，还可以利用[String 类](https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#join-java.lang.CharSequence-java.lang.CharSequence...-)`join()`提供的方法打印出数组元素，不带括号，并由选择的分隔符分隔（这是下面示例中的空格字符）：

```
String[] greeting = {"Hey", "there", "amigo!"};
String delimiter = " ";
String.join(delimiter, greeting) 
```

输出将是“嘿，朋友！”。

* * *

## 回答 #6

> 赞同：46
> 
> 时间：2016-03-11T05:36:49.473

## 数组.toString

作为直接答案，[包括 @Esko 在内的几个](https://stackoverflow.com/a/409795/365237)使用[`Arrays.toString`](https://docs.oracle.com/javase/7/docs/api/java/util/Arrays.html#toString%28java.lang.Object%5B%5D%29)and[`Arrays.deepToString`](https://docs.oracle.com/javase/7/docs/api/java/util/Arrays.html#deepToString%28java.lang.Object%5B%5D%29)方法提供的解决方案简直是最好的。

## Java 8 - Stream.collect(joining()), Stream.forEach

下面我尝试列出一些其他建议的方法，尝试进行一些改进，最值得注意的添加是使用[`Stream.collect`](https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#collect-java.util.stream.Collector-)运算符，使用 a来模仿正在做的事情。[`joining`](https://docs.oracle.com/javase/8/docs/api/java/util/stream/Collectors.html#joining-java.lang.CharSequence-) `Collector``String.join`

```
int[] ints = new int[] {1, 2, 3, 4, 5};
System.out.println(IntStream.of(ints).mapToObj(Integer::toString).collect(Collectors.joining(", ")));
System.out.println(IntStream.of(ints).boxed().map(Object::toString).collect(Collectors.joining(", ")));
System.out.println(Arrays.toString(ints));

String[] strs = new String[] {"John", "Mary", "Bob"};
System.out.println(Stream.of(strs).collect(Collectors.joining(", ")));
System.out.println(String.join(", ", strs));
System.out.println(Arrays.toString(strs));

DayOfWeek [] days = { FRIDAY, MONDAY, TUESDAY };
System.out.println(Stream.of(days).map(Object::toString).collect(Collectors.joining(", ")));
System.out.println(Arrays.toString(days));

// These options are not the same as each item is printed on a new line:
IntStream.of(ints).forEach(System.out::println);
Stream.of(strs).forEach(System.out::println);
Stream.of(days).forEach(System.out::println); 
```

* * *

## 回答 #7

> 赞同：42
> 
> 时间：2015-06-19T06:10:28.327

## 在 Java 8 之前

我们可以用来`Arrays.toString(array)`打印一维数组和`Arrays.deepToString(array)`多维数组。

## 爪哇 8

现在我们可以选择`Stream`并`lambda`打印数组。

**打印一维数组：**

```
public static void main(String[] args) {
    int[] intArray = new int[] {1, 2, 3, 4, 5};
    String[] strArray = new String[] {"John", "Mary", "Bob"};

    //Prior to Java 8
    System.out.println(Arrays.toString(intArray));
    System.out.println(Arrays.toString(strArray));

    // In Java 8 we have lambda expressions
    Arrays.stream(intArray).forEach(System.out::println);
    Arrays.stream(strArray).forEach(System.out::println);
} 
```

输出是：

> [1, 2, 3, 4, 5]
> [约翰，玛丽， 鲍勃 ]
> 1
> 2
> 3
> 4
> 5
> 约翰玛丽鲍勃

**打印多维数组** 如果我们想打印多维数组，我们可以使用`Arrays.deepToString(array)`：

```
public static void main(String[] args) {
    int[][] int2DArray = new int[][] { {11, 12}, { 21, 22}, {31, 32, 33} };
    String[][] str2DArray = new String[][]{ {"John", "Bravo"} , {"Mary", "Lee"}, {"Bob", "Johnson"} };

    //Prior to Java 8
    System.out.println(Arrays.deepToString(int2DArray));
    System.out.println(Arrays.deepToString(str2DArray));

    // In Java 8 we have lambda expressions
    Arrays.stream(int2DArray).flatMapToInt(x -> Arrays.stream(x)).forEach(System.out::println);
    Arrays.stream(str2DArray).flatMap(x -> Arrays.stream(x)).forEach(System.out::println);
} 
```

现在要观察的一点是方法`Arrays.stream(T[])`，如果`int[]`返回我们`Stream<int[]>`，然后方法`flatMapToInt()`将流的每个元素映射到通过将提供的映射函数应用于每个元素而生成的映射流的内容。

输出是：

> [[11, 12], [21, 22], [31, 32, 33]]
> [[John, Bravo], [Mary, Lee], [Bob, Johnson]]
> 11
> 12
> 21
> 22
> 31
> 32
> 33
> John
> Bravo
> Mary
> 李
> ·鲍勃·
> 约翰逊

* * *

## 回答 #8

> 赞同：40
> 
> 时间：2009-01-03T21:44:05.333

如果您使用的是 Java 1.4，则可以改为：

```
System.out.println(Arrays.asList(array)); 
```

（当然，这也适用于 1.5+。）

* * *

## 回答 #9

> 赞同：27
> 
> 时间：2013-10-05T19:13:40.413

`Arrays.deepToString(arr)`只打印一行。

```
int[][] table = new int[2][2]; 
```

要真正将表格打印为二维表格，我必须这样做：

```
System.out.println(Arrays.deepToString(table).replaceAll("],", "]," + System.getProperty("line.separator"))); 
```

似乎该`Arrays.deepToString(arr)`方法应该采用分隔符字符串，但不幸的是它没有。

* * *

## 回答 #10

> 赞同：18
> 
> 时间：2011-01-24T04:25:54.827

```
for(int n: someArray) {
    System.out.println(n+" ");
} 
```

* * *

## 回答 #11

> 赞同：18
> 
> 时间：2016-08-07T14:05:06.923

**在 Java 中打印数组的不同方法：**

1.  简单的方法

    ```
    List<String> list = new ArrayList<String>();
    list.add("One");
    list.add("Two");
    list.add("Three");
    list.add("Four");
    // Print the list in console
    System.out.println(list); 
    ```

> 输出：[一、二、三、四]

2.  使用**`toString()`**

    ```
    String[] array = new String[] { "One", "Two", "Three", "Four" };
    System.out.println(Arrays.toString(array)); 
    ```

> 输出：[一、二、三、四]

3.  打印数组数组

    ```
    String[] arr1 = new String[] { "Fifth", "Sixth" };
    String[] arr2 = new String[] { "Seventh", "Eight" };
    String[][] arrayOfArray = new String[][] { arr1, arr2 };
    System.out.println(arrayOfArray);
    System.out.println(Arrays.toString(arrayOfArray));
    System.out.println(Arrays.deepToString(arrayOfArray)); 
    ```

> 输出：[[Ljava.lang.String;@1ad086a [[Ljava.lang.String;@10385c1, [Ljava.lang.String;@42719c] [[第五、第六]、[第七、第八]]

资源：[访问数组](http://howtodoinjava.com/core-java/collections/how-to-print-the-content-of-array-in-java/)

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2013-12-27T23:31:15.130

在我看来，使用常规**for**循环是打印数组的最简单方法。在这里，您有一个基于您的 intArray 的示例代码

```
for (int i = 0; i < intArray.length; i++) {
   System.out.print(intArray[i] + ", ");
} 
```

它提供您的输出 1, 2, 3, 4, 5

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2016-05-13T11:01:00.150

它应该始终适用于您使用的任何 JDK 版本：

```
System.out.println(Arrays.asList(array)); 
```

`Array`如果包含对象，它将起作用。如果`Array`包含原始类型，则可以使用包装类而不是将原始类型直接存储为..

例子：

```
int[] a = new int[]{1,2,3,4,5}; 
```

将其替换为：

```
Integer[] a = new Integer[]{1,2,3,4,5}; 
```

**更新 ：**

是的 ！值得一提的是，将数组转换为对象数组或使用对象数组的成本很高，并且可能会减慢执行速度。它是由称为自动装箱的java的性质发生的。

因此仅用于打印目的，不应使用。我们可以创建一个函数，它将数组作为参数并将所需的格式打印为

```
public void printArray(int [] a){
        //write printing code
} 
```

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2016-03-11T11:50:38.673

我最近在[Vanilla #Java](http://vanillajava.blogspot.com/2016/03/printing-arrays-by-hacking-jvm.html)中看到了这篇文章。写起来不是很方便`Arrays.toString(arr);`，然后一直导入`java.util.Arrays;`。

**请注意，这绝不是永久修复。只是一个可以使调试更简单的技巧。**

直接打印一个数组会给出内部表示和 hashCode。现在，所有类都`Object`作为父类型。那么，为什么不破解`Object.toString()`呢？未经修改，Object 类如下所示：

```
public String toString() {
    return getClass().getName() + "@" + Integer.toHexString(hashCode());
} 
```

如果将其更改为：

```
public String toString() {
    if (this instanceof boolean[])
        return Arrays.toString((boolean[]) this);
    if (this instanceof byte[])
        return Arrays.toString((byte[]) this);
    if (this instanceof short[])
        return Arrays.toString((short[]) this);
    if (this instanceof char[])
        return Arrays.toString((char[]) this);
    if (this instanceof int[])
        return Arrays.toString((int[]) this);
    if (this instanceof long[])
        return Arrays.toString((long[]) this);
    if (this instanceof float[])
        return Arrays.toString((float[]) this);
    if (this instanceof double[])
        return Arrays.toString((double[]) this);
    if (this instanceof Object[])
        return Arrays.deepToString((Object[]) this);
    return getClass().getName() + "@" + Integer.toHexString(hashCode());
} 
```

这个修改后的类可以通过在命令行中添加以下内容来简单地添加到类路径中：`-Xbootclasspath/p:target/classes`.

现在，随着`deepToString(..)`Java 5 的可用性，`toString(..)`可以轻松更改`deepToString(..)`以添加对包含其他数组的数组的支持。

我发现这是一个非常有用的 hack，如果 Java 可以简单地添加它，那就太好了。我理解拥有非常大的数组的潜在问题，因为字符串表示可能有问题。也许通过类似 a`System.out`或 a`PrintWriter`这样的可能性。

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2016-06-26T15:30:48.243

在 java 8 中，这很容易。有两个关键字

1.  溪流：`Arrays.stream(intArray).forEach`
2.  方法参考：`::println`

    ```
    int[] intArray = new int[] {1, 2, 3, 4, 5};
    Arrays.stream(intArray).forEach(System.out::println); 
    ```

如果要在同一行中打印数组中的所有元素，则只需使用`print`而不是`println`ie

```
int[] intArray = new int[] {1, 2, 3, 4, 5};
Arrays.stream(intArray).forEach(System.out::print); 
```

另一种没有方法参考的方法只是使用：

```
int[] intArray = new int[] {1, 2, 3, 4, 5};
System.out.println(Arrays.toString(intArray)); 
```

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2016-07-20T23:55:49.147

您可以循环遍历数组，在循环时打印出每个项目。例如：

```
String[] items = {"item 1", "item 2", "item 3"};

for(int i = 0; i < items.length; i++) {

    System.out.println(items[i]);

} 
```

输出：

```
item 1
item 2
item 3 
```

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2017-09-25T13:29:39.970

**有以下打印数组的方法**

```
 // 1) toString()  
    int[] arrayInt = new int[] {10, 20, 30, 40, 50};  
    System.out.println(Arrays.toString(arrayInt));

// 2 for loop()
    for (int number : arrayInt) {
        System.out.println(number);
    }

// 3 for each()
    for(int x: arrayInt){
         System.out.println(x);
     } 
```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2014-04-29T07:34:31.177

如果您的数组是 char[] 类型，还有另一种方法：

```
char A[] = {'a', 'b', 'c'}; 

System.out.println(A); // no other arguments 
```

印刷

```
abc 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2015-02-17T08:02:36.950

我试过的一个简化的捷径是这样的：

```
 int x[] = {1,2,3};
    String printableText = Arrays.toString(x).replaceAll("[\\[\\]]", "").replaceAll(", ", "\n");
    System.out.println(printableText); 
```

它会打印

```
1
2
3 
```

这种方法不需要循环，最好只用于小型阵列

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2015-08-06T11:24:55.813

使用 org.apache.commons.lang3.StringUtils.join(*) 方法可以是一个选项
例如：

```
String[] strArray = new String[] { "John", "Mary", "Bob" };
String arrayAsCSV = StringUtils.join(strArray, " , ");
System.out.printf("[%s]", arrayAsCSV);
//output: [John , Mary , Bob] 
```

我使用了以下依赖项

```
<groupId>org.apache.commons</groupId>
<artifactId>commons-lang3</artifactId>
<version>3.3.2</version> 
```

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2016-12-05T20:10:38.257

For-each 循环也可用于打印数组元素：

```
int array[] = {1, 2, 3, 4, 5};
for (int i:array)
    System.out.println(i); 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2014-02-18T20:21:26.310

要添加到所有答案，也可以选择将对象打印为 JSON 字符串。

使用杰克逊：

```
ObjectWriter ow = new ObjectMapper().writer().withDefaultPrettyPrinter();
System.out.println(ow.writeValueAsString(anyArray)); 
```

使用 Gson：

```
Gson gson = new Gson();
System.out.println(gson.toJson(anyArray)); 
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2018-03-16T01:17:33.763

```
// array of primitives:
int[] intArray = new int[] {1, 2, 3, 4, 5};

System.out.println(Arrays.toString(intArray));

output: [1, 2, 3, 4, 5] 
```

* * *

```
// array of object references:
String[] strArray = new String[] {"John", "Mary", "Bob"};

System.out.println(Arrays.toString(strArray));

output: [John, Mary, Bob] 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2020-12-01T17:06:26.310

这里有一个可能的打印功能：

```
 public static void printArray (int [] array){
        System.out.print("{ ");
        for (int i = 0; i < array.length; i++){
            System.out.print("[" + array[i] + "] ");
        }
        System.out.print("}");
    } 
```

例如，如果 main 是这样的

```
public static void main (String [] args){
    int [] array = {1, 2, 3, 4};
    printArray(array);
} 
```

输出将是 { [1] [2] [3] [4] }

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2014-09-21T09:11:52.200

```
public class printer {

    public static void main(String[] args) {
        String a[] = new String[4];
        Scanner sc = new Scanner(System.in);
        System.out.println("enter the data");
        for (int i = 0; i < 4; i++) {
            a[i] = sc.nextLine();
        }
        System.out.println("the entered data is");
        for (String i : a) {
            System.out.println(i);
        }
      }
    } 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2018-06-22T19:17:10.180

这被标记为重复[打印 byte[]](https://stackoverflow.com/questions/50977959/cannot-see-the-contents-of-the-array-printed-in-console)。注意：对于字节数组，还有其他可能适用的方法。

如果它包含 ISO-8859-1 字符，则可以将其打印为字符串。

```
String s = new String(bytes, StandardChars.ISO_8559);
System.out.println(s);
// to reverse
byte[] bytes2 = s.getBytes(StandardChars.ISO_8559); 
```

或者如果它包含一个 UTF-8 字符串

```
String s = new String(bytes, StandardChars.UTF_8);
System.out.println(s);
// to reverse
byte[] bytes2 = s.getBytes(StandardChars.UTF_8); 
```

或者如果您想将其打印为十六进制。

```
String s = DatatypeConverter.printHexBinary(bytes);
System.out.println(s);
// to reverse
byte[] bytes2 = DatatypeConverter.parseHexBinary(s); 
```

或者如果您想将其打印为 base64。

```
String s = DatatypeConverter.printBase64Binary(bytes);
System.out.println(s);
// to reverse
byte[] bytes2 = DatatypeConverter.parseBase64Binary(s); 
```

或者如果你想打印一个有符号字节值的数组

```
String s = Arrays.toString(bytes);
System.out.println(s);
// to reverse
String[] split = s.substring(1, s.length() - 1).split(", ");
byte[] bytes2 = new byte[split.length];
for (int i = 0; i < bytes2.length; i++)
    bytes2[i] = Byte.parseByte(split[i]); 
```

或者如果你想打印一个无符号字节值数组

```
String s = Arrays.toString(
               IntStream.range(0, bytes.length).map(i -> bytes[i] & 0xFF).toArray());
System.out.println(s);
// to reverse
String[] split = s.substring(1, s.length() - 1).split(", ");
byte[] bytes2 = new byte[split.length];
for (int i = 0; i < bytes2.length; i++)
    bytes2[i] = (byte) Integer.parseInt(split[i]); // might need a range check. 
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2018-12-10T07:57:58.497

如果您正在运行 jdk 8。

```
public static void print(int[] array) {
    StringJoiner joiner = new StringJoiner(",", "[", "]");
    Arrays.stream(array).forEach(element -> joiner.add(element + ""));
    System.out.println(joiner.toString());
}

int[] array = new int[]{7, 3, 5, 1, 3};
print(array); 
```

输出：

```
[7,3,5,1,3] 
```

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2021-03-29T16:36:57.350

如果您使用的是 Java 11

```
import java.util.Arrays;
public class HelloWorld{

     public static void main(String []args){
        String[] array = { "John", "Mahta", "Sara" };
       System.out.println(Arrays.toString(array).replace(",", "").replace("[", "").replace("]", ""));
     }
} 
```

输出 ：

```
John Mahta Sara 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2018-04-20T18:25:43.057

在 Java 8 中：

```
Arrays.stream(myArray).forEach(System.out::println); 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2019-01-01T23:34:11.747

如果使用[Commons.Lang 库](https://commons.apache.org/proper/commons-lang/)，我们可以这样做：

`ArrayUtils.toString(array)`

```
int[] intArray = new int[] {1, 2, 3, 4, 5};
String[] strArray = new String[] {"John", "Mary", "Bob"};
ArrayUtils.toString(intArray);
ArrayUtils.toString(strArray); 
```

输出：

```
{1,2,3,4,5}
{John,Mary,Bob} 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2020-06-04T06:23:56.120

在 JDK1.8 中，您可以使用聚合操作和 lambda 表达式：

```
String[] strArray = new String[] {"John", "Mary", "Bob"};

// #1
Arrays.asList(strArray).stream().forEach(s -> System.out.println(s));

// #2
Stream.of(strArray).forEach(System.out::println);

 // #3
 Arrays.stream(strArray).forEach(System.out::println);

/* output:
John
Mary
Bob
*/ 
```

此外，从 Java 8 开始，还可以利用 String 类提供的 join() 方法打印出数组元素，不带括号，并由选择的分隔符（即所示示例的空格字符）分隔以下）

```
string[] greeting = {"Hey", "there", "amigo!"};
String delimiter = " ";
String.join(delimiter, greeting) 
```

` 输出将是“嘿，朋友！”

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2021-06-15T04:42:11.733

通过使用 java.util.Arrays：

```
String mRole = "M_XXX_ABC";        
System.out.println(Arrays.asList(mRole.split("_")).toString()); 
```

输出：[M，XXX，ABC]

* * *

## 回答 #33

> 赞同：-1
> 
> 时间：2018-07-01T15:45:41.087

打印数组元素有几种方法。首先，我会解释一下，什么是数组？..数组是一种简单的数据结构，用于存储数据..定义数组时，分配一组辅助内存块在 RAM 中。那些内存块被占用一个单元..

好的，我将创建一个这样的数组，

```
class demo{
      public static void main(String a[]){

           int[] number={1,2,3,4,5};

           System.out.print(number);
      }
} 
```

现在看看输出，

[![在此处输入图像描述](https://i.stack.imgur.com/AwGkn.jpg)](https://i.stack.imgur.com/AwGkn.jpg)

你可以看到一个未知的字符串被打印出来。正如我之前提到的，它声明的数组（数字数组）的内存地址被打印出来。如果你想显示数组中的元素，你可以使用“for循环”，像这样..

```
class demo{
      public static void main(String a[]){

           int[] number={1,2,3,4,5};

           int i;

           for(i=0;i<number.length;i++){
                 System.out.print(number[i]+"  ");
           }
      }
} 
```

现在看看输出，

[![在此处输入图像描述](https://i.stack.imgur.com/yrBhs.jpg)](https://i.stack.imgur.com/yrBhs.jpg)

好的，成功打印一维数组的元素..现在我将考虑二维数组..我将二维数组声明为“number2”并使用“Arrays.deepToString()”关键字打印元素。在使用之前您必须导入“java.util.Arrays”库。

```
 import java.util.Arrays;

 class demo{
      public static void main(String a[]){

           int[][] number2={{1,2},{3,4},{5,6}};`

           System.out.print(Arrays.deepToString(number2));
      }
} 
```

考虑输出，

[![在此处输入图像描述](https://i.stack.imgur.com/FzgGn.jpg)](https://i.stack.imgur.com/FzgGn.jpg)

同时，使用两个for循环，可以打印2D元素..谢谢！

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2019-10-20T16:56:57.803

toString 是一种将数组转换为字符串的方法。

此外，您可以使用：

```
for (int i = 0; i < myArray.length; i++){
System.out.println(myArray[i] + " ");
} 
```

这个 for 循环将使您能够按顺序打印数组的每个值。

# asp.net - 本地化 CMS - 为内容编辑器编辑本地化文件的管理功能？

> ID：409791
> 
> 赞同：3
> 
> 时间：2009-01-03T20:42:35.627
> 
> 标签：asp.net, localization

是否有解决方案/教程/开源解决方案来提供让内容编辑器编辑 ASP.net 本地化文件的功能？

例如，

使用 Labels.resx 和 Labels.fr.resx，如果有一个允许最终用户结束文件内容的编辑器，那就太好了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T13:27:20.590

我建议使用缓存的数据库解决方案。我发现这篇文章可能会有所帮助。它有一个完整的提供者以及一个非常好的文章。

创建数据驱动的 ASP.NET 本地化资源提供程序和编辑器

[http://www.west-wind.com/presentations/wwDbResourceProvider/](http://www.west-wind.com/presentations/wwDbResourceProvider/)

> ASP.NET 2.0 引入了一个提供程序模型，用于创建自定义资源提供程序，该资源提供程序可以将本地化数据存储在 Resx 文件以外的存储中。Resx 资源都很好，但是将数据放在更灵活的资源存储中为您提供了更多选项来交互式地甚至在运行时编辑和管理资源。在本文中，我将演示如何创建一个新的资源提供程序，将资源信息存储在数据库中，并展示一个资源编辑工具，该工具可以更轻松地在实时 ASP.NET 应用程序的上下文中以交互方式编辑资源。

特别要注意的一点：

> Resx 资源也是静态的——它们毕竟被编译成一个程序集。如果要更改资源，则需要重新编译才能看到这些更改。ASP.NET 2.0 引入了全局和本地资源，它们可以存储在服务器上并且可以动态更新——ASP.NET 编译器实际上可以在运行时编译它们。但是，如果您使用预编译的 Web 部署模型，资源最终仍然是静态的，并且无法在运行时更改。所以一旦你完成了编译，资源就固定了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T21:26:47.583

我刚刚写了一个这样的应用程序，因为我找不到可以进行*resx*编辑的免费软件：

*   从文件夹中读取所有*resx文件的内容*
*   显示来自不同文化但彼此相同的*resx的值*
*   生成/保存*resx*文件

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-04T23:29:44.980

您可以考虑使用结构化 XML 文件。似乎这将是一个比破解 .resx 文件以非常规方式工作更优雅的解决方案。您可以使用 LINQ 查询以类似于 resx 文件的强类型方式获取 XML。此外，用户可以通过表示层编辑 XML 文件，因为它们没有被编译到应用程序中。

# c++ - 异常与断言？

> ID：409794
> 
> 赞同：52
> 
> 时间：2009-01-03T20:43:35.033
> 
> 标签：c++, exception, throw

> **可能的重复：**
> [通过断言或异常进行合同测试设计？](https://stackoverflow.com/questions/117171/design-by-contract-tests-by-assert-or-by-exception)

在决定使用异常而不是断言（反之亦然）时，是否有一个经验法则可以遵循。现在我只会抛出我认为在用户端运行时会发生的事情（比如套接字或文件错误）。几乎我使用的所有其他东西都断言。

另外，如果我要抛出一个断言，那么抛出一个好的标准对象是什么？如果我没记错的话，有`std::logic_error`，但这不是扔的好东西吗？我会为丢失的文件或意外输入（例如从命令行而不是前端应用程序）抛出什么？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-01-03T22:12:49.707

我的经验法则：

异常用于运行时错误情况（IO 错误、内存不足、无法获得数据库连接等）。

断言用于编码错误（此方法不接受空值，开发人员还是通过了一个）。

对于具有公共类的库，在公共方法上抛出异常（因为这样做很有意义）。断言是用来捕捉你的错误，而不是他们的。

编辑：由于空值示例，这可能并不完全清楚。我的观点是，您将断言（正如其他人指出的那样）用于永远不会发生的条件，用于永远不会进入生产代码的条件。这些条件在单元测试或 QA 测试期间绝对必须失败。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-01-03T21:08:34.827

断言你*知道*不可能发生的事情（即如果它发生了，那是你不称职的错）。

提出程序的常规控制流未处理的异常情况。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-03T22:03:08.743

我将断言用于那些不*应该发生*但确实发生的事情。当它发生时，开发人员需要重新审视不正确的假设。

我对其他一切都使用例外。

在可重用代码中，我更喜欢异常，因为它让调用者可以选择处理或不处理问题。试着捕捉和处理一个断言！

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-03T20:48:36.757

您在**异常**情况下使用异常。例如内存不足或网络故障。

您使用 assert 来**确定**满足某些前提条件。例如，指针不是 NULL 或整数在一定范围内。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-03T20:49:57.593

断言是一种验证程序是否处于可能状态的方法。如果一个函数在应该只返回正整数时返回 -1，并且您有一个断言来验证这一点，那么您的程序应该停止，因为它使您的程序处于危险状态。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-03T21:37:14.817

作为一般规则，我从以下位置抛出异常：

1.  包的公共函数以捕获编程错误。
2.  报告系统错误或传递子系统错误的内部函数。

我只在内部使用断言来捕获实现错误。

# asp.net - ASP.NET 动态数据和成员资格（角色）

> ID：409799
> 
> 赞同：2
> 
> 时间：2009-01-03T20:45:54.093
> 
> 标签：asp.net, asp.net-mvc, web-config, dynamic-data, roles

我正在尝试在动态数据网站中设置角色.. 问题是我无法通过 simpy 来设置它。

```
 <location path="List.aspx">
    <system.web>
      <authorization>
        <allow roles="Administrators" />
        <deny users="*" />
      </authorization>
    </system.web>
  </location> 
```

所以即使我以名为“成员”的角色登录，它仍然允许我进入 List.aspx

任何人都可以请指导我这个..

哦，顺便说一句，我也在同一个站点上使用 mvc

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-22T17:20:39.120

动态数据页面忽略了所有的爵士乐。

在此处查看安全动态数据项目：

[http://www.codeplex.com/aspnet/Release/ProjectReleases.aspx?ReleaseId=14473](http://www.codeplex.com/aspnet/Release/ProjectReleases.aspx?ReleaseId=14473)

...

或者还有另一种对我有用的方法。

将您的位置路径更改为：

```
 <location path="Admin/<TableName>/List.aspx">
    <system.web>
      <authorization>
        <allow roles="Administrators" />
        <deny users="*" />
      </authorization>
    </system.web>
  </location> 
```

然后（在您的 global.asax.cs 文件中）将您的动态数据路由更改为：

```
routes.Add(new DynamicDataRoute("Admin/{table}/{action}.aspx") 
```

这使我能够提供表级安全性。如果这不起作用，请发表评论，我会再次调查。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T22:05:54.680

正如我朋友所说，你的问题需要更多细节，无论如何

1.  首先尝试检查您是否在 web.config 中**启用了角色。**

2.  你有没有通过**WAT**做到这一点？尝试替代方法作为测试。

3\. 将 web.config 中的身份验证设置为**Forms**。希望对您有所帮助问候-MHM-

# security - To what does "zero day" refer?

> ID：409807
> 
> 赞同：10
> 
> 时间：2009-01-03T20:48:15.633
> 
> 标签：security, terminology, exploit

Does "zero-day" or "0-day" (in context of software vulnerabilities and exploits) refer to the software release, or a particular type of exploit?

[I did not find an answer to this on SO. Though it is answered elsewhere on the Internet, my understanding of SO is that it's [okay to ask/answer basic questions](https://stackoverflow.com/faq)]

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-03T20:52:24.767

Simply put it means that it [the exploit] was released before the company was notified, and had the opportunity to fix it, because the company had 0-days of notification.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-03T20:50:54.083

Wikipedia has two entries which are relevant:

*   [Zero-day virus](http://en.wikipedia.org/wiki/Zero_day_virus)
*   [Zero day attack](http://en.wikipedia.org/wiki/Zero_day_attack)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2021-12-10T04:02:02.630

This is kind of a pet peeve of mine because people usually get this so wrong, and then back up their claim by linking to a PHB executive summary that is also wrong (usually written by a journalist who got their knowledge through word of mouth and really doesn't understand security all that well.)

The term zero-day started in the warez scene. Back when software only had physical releases, warez groups (collectively, the "warez scene") prided themselves on releasing cracked copies of software (especially games) earlier than the other groups (and to this day, they still do.) If they distributed (with a crack if it had copy protection) it on the same day as the release, they would call that 0-day warez. Being able to crack the software on the same day they got it was also seen as a mark of being a skilled cracker.

Eventually this extended to warez releases that came BEFORE the release date of the software, which was usually done by a member of the group obtaining a copy from either a retail distribution center or store that they worked at before the official sale date. These were also labeled as 0-day releases until the day AFTER the retail release date has passed.

The crackers who broke the copy protection tended to have both the means and motive to find vulnerabilities in software of all stripes. They would develop exploits that they then termed 0-day exploits. These remained labeled as 0-day exploits until the day after a patch was released by the software developer, prior to which they were the most useful. Naturally, the professional side of cybersecurity had to "know thy enemy" so to speak, so they would of course learn the language, including slang terms like "zero day" (as well as many other slang terms like "fraggle", "smurf", etc, that are also commonly found in cybersecurity textbooks.)

So, and here's where this becomes my opinion, it's best to describe the term "zero day" thus: The day of or before a relevant software release. In other words, zero full days have passed since the release.

What that means, exactly, depends on the context. I described the context of warez already. In the context of a vulnerability (meaning software flaw or bug that is open to exploitation) that doesn't mean the day the software developer is aware of it. In fact it turns out, that many vulnerabilities are known by the vendor but also haven't been patched by the time they've been exploited in the wild. Recent example:

[https://www.zdnet.com/article/everything-you-need-to-know-about-microsoft-exchange-server-hack/](https://www.zdnet.com/article/everything-you-need-to-know-about-microsoft-exchange-server-hack/)

In other words, that exchange vulnerability was known about three months prior to Microsoft issuing a patch, and was being exploited in the wild for at least a few weeks prior. It remained a zero-day exploit until the day after Microsoft had issued a patch (in other words, it has been zero full days since a patch was released.)

The idea of the definition being 0-days of notification, or 0-days to respond, is bogus for a few reasons:

*   The vulnerability existed on the same day the vulnerable software was released, and from that point to the point of a patch release it could have been exploited at any time, and unless the attacker announced the day of their first use of the exploit or when they first developed the exploit, the vendor always had zero days of notification.
*   You as an end user of vulnerable software theoretically always have zero days to respond. If your systems were broken into with a zero day exploit, there's a good chance that you're none the wiser, and on average, this takes about 100 days (cybersecurity people often call this "dwell time".) So realistically speaking, all of those days were zero day.
*   Let's assume that you have a critical business system exposed to the open internet, and you really can't do anything to mitigate a vulnerability on it (i.e. disabling public access) without causing more harm to your business and/or your customers than if you just do nothing: Each day that passes before a patch is released is also zero days to respond.

Thus, it only makes sense to refer to zero day in relation to the day when a patch is released.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T21:19:58.470

A zero-day vulnerability or attack means that an exploit has been found active in the "wild" without being announced or the developers notified.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-03T21:27:37.050

A zero-day exploit or vulnerability is an exploit for a bug that is not known to the general public (i.e. no patch was released for it).

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-03T21:53:08.200

Three major uses of "Zero Day"

*   [http://en.wikipedia.org/wiki/Zero_day_virus](http://en.wikipedia.org/wiki/Zero_day_virus)
*   [http://en.wikipedia.org/wiki/Zero_day_attack](http://en.wikipedia.org/wiki/Zero_day_attack)
*   And also "zero day" warez (pirated) software: software cracked and/or released to the public by some pirate on (or before!) the day said software was available for sale.

I personally was aware of the third sense before the other two.

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2015-10-15T06:08:36.637

Zero-day should be defined as exploits written to activate on machines simultaneously at a particular date/time or based on a certain condition or external signal, such as Stuxnet.

Web pages seem to be defining zero-day as vulnerabilities merely not known to the public, or company, nor fixed yet. That doesn't make sense because it describes 100% of them for at least a part of the life cycle of the flaw. Hackers don't announce their attacks before putting them in place, that would be pretty stupid, the term is meaningless under many of the definitions out there because it would apply to just about any security bug.

As the author of an encryption program, I'd say it is of course sexier to say zero-day than security bug. However it should not be popularly used in relation to the flaw (that's the big mistake), instead, as particular types of attacks. A security bug can be exploited immediately or used to cause something to happen later, on "zero-day".

Kaspersky about zero-day: "Exploit occurs when a system weakness is discovered and attacked within a day". In other words, they are saying the hacker accomplished their task within 24 hours after finding the flaw. How do they know? Are they sitting at the desk of the hacker with a stopwatch? In this case, the flaw is in the definition.

Ground zero is where something terrible happens.

Day zero is **when** something terrible happens.

See paragraph one.

When the majority are in error, do not succumb to peer pressure.

Interesting quote by an early Microsoft guy, heard today: *[A falsehood] is half-way around the world before the truth has put on its pants.* I will add, because people lay out the welcome mat for it.

In the book Zero Day by Mark Russinovich, whom I respect (mainly because of his sensible software, now via Microsoft) it sounds like he portrays coordinated software attacks as a sort of 'doomsday'.

While many zero day threats are small, this flavor/meaning of the term zero-day is the one that makes sense to me, like a ticking time bomb counting down, to zero day, when it triggers, to do its damage, versus just spreading/establishing itself prior to zero day.

# java - 如何在 Eclipse 编辑器插件中提供链接？

> ID：409811
> 
> 赞同：5
> 
> 时间：2009-01-03T20:48:38.707
> 
> 标签：java, eclipse-plugin

我正在为自定义文件格式编写一个 Eclipse 编辑器插件，并希望提供一种从命名引用快速跳转到实体定义的方法——基本上是 Eclipse Java 编辑器的“打开声明”功能。

我知道我可以通过注册一个编辑器操作并将其放在上下文菜单中来做到这一点，但我真的很喜欢当你在 Java 编辑器中按 CTRL 时所有 Java 标识符都变成指向其声明的链接的方式——我该怎么做? 我在文档中找不到任何关于它的信息。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-03T21:28:48.623

我认为您正在寻找超链接检测器。扩展点是：[org.eclipse.ui.workbench.texteditor.hyperlinkDetectors](http://help.eclipse.org/stable/topic/org.eclipse.platform.doc.isv/reference/extension-points/org_eclipse_ui_workbench_texteditor_hyperlinkDetectors.html)，这是来自 Mylyn plugin.xml 的片段：

```
<extension point="org.eclipse.ui.workbench.texteditor.hyperlinkDetectors">
  <hyperlinkDetector            
        class="org.eclipse.mylyn.internal.tasks.ui.editors.TaskHyperlinkDetector"
        id="org.eclipse.mylyn.tasks.ui.hyperlinks.detectors.task"
        name="%TaskHyperlinkDetector.name"
        targetId="org.eclipse.ui.DefaultTextEditor">
  </hyperlinkDetector> 
```

另请查看[AbstractHyperlinkDetector](http://help.eclipse.org/stable/topic/org.eclipse.platform.doc.isv/reference/api/org/eclipse/jface/text/hyperlink/AbstractHyperlinkDetector.html)，这是一个有用的抽象类，您可以扩展它以提供您的自定义检测器。

# php - 可以使用 Regex/preg_replace 为关键字添加锚标记吗？

> ID：409813
> 
> 赞同：1
> 
> 时间：2009-01-03T20:48:58.720
> 
> 标签：php, regex

我希望能够切换这个...

`My sample [a id="keyword" href="someURLkeyword"] test keyword test[/a] link this keyword here.`

到...

`My sample [a id="keyword" href="someURLkeyword"] test keyword test[/a] link this [a href="url"]keyword[/a] here.`

我不能简单地替换“关键字”的所有实例，因为有些是在现有的锚标记中或之内使用的。

注意：在 Linux 上使用 PHP5 preg_replace。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-03T22:04:26.227

您不能仅使用正则表达式来做到这一点。正则表达式是上下文无关的——它们只是匹配一个模式，而不考虑周围环境。为了做你想做的事，你需要将源解析为抽象表示，然后将其转换为目标输出。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-05T22:39:59.650

使用正则表达式可能不是解决此问题的最佳方法，但这里有一个快速的解决方案：

```
function link_keywords($str, $keyword, $url) {
    $keyword = preg_quote($keyword, '/');
    $url = htmlspecialchars($url);

    // Use split the string on all <a> tags, keeping the matched delimiters:
    $split_str = preg_split('#(<a\s.*?</a>)#i', $str, -1, PREG_SPLIT_DELIM_CAPTURE);

    // loop through the results and process the sections between <a> tags
    $result = '';
    foreach ($split_str as $sub_str) {
        if (preg_match('#^<a\s.*?</a>$#i', $sub_str)) {
            $result .= $sub_str;
        } else {
            // split on all remaining tags
            $split_sub_str = preg_split('/(<.+?>)/', $sub_str, -1, PREG_SPLIT_DELIM_CAPTURE);
            foreach ($split_sub_str as $sub_sub_str) {
                if (preg_match('/^<.+>$/', $sub_sub_str)) {
                    $result .= $sub_sub_str;
                } else {
                    $result .= preg_replace('/'.$keyword.'/', '<a href="'.$url.'">$0</a>', $sub_sub_str);
                }
            }
        }
    }
    return $result;
} 
```

总体思路是将字符串拆分为链接和其他所有内容。然后将链接标签之外的所有内容拆分为标签和纯文本，并将链接插入纯文本中。这将阻止 [p class="keyword"] 扩展为 [p class="[a href="url"]keyword[/a]"]。

同样，我会尝试找到一个不涉及正则表达式的更简单的解决方案。

# asp.net-mvc - 使用 ASP.NET MVC 在用户控件中命名 ASP.NET 控件

> ID：409823
> 
> 赞同：0
> 
> 时间：2009-01-03T20:55:42.200
> 
> 标签：asp.net-mvc

我想知道是否有办法让 ASP.NET 控件与我的 ASP.NET MVC 应用程序很好地配合使用。这就是我正在做的事情。

我有一个订单页面，其中显示有关单个订单对象的信息。该页面通常会有一堆数据行，每一行代表一个 OrderItem 对象。每行都是一个 ASP.NET 用户控件。在用户控件上有一个带有两个文本框（数量和价格）的表单元素和一个更新按钮。

当我单击更新按钮时，我希望表单将单个 OrderItem 行的数据发布到控制器方法并更新数据库中的 OrderItem 记录。

这是我的问题：当帖子发生时，框架会抱怨，因为表单上的字段与控制器方法上的参数不匹配。每个表单字段都类似于“OrderItem_1$Quantity”或“OrderItem_2$Price”，而不仅仅是与我的方法参数匹配的“Quantity”或“Price”。

有人告诉我，我可以通过确保我的所有控件的**ID**对于页面是唯一的来克服这个问题，但允许**NAME**在不同的表单之间重复，这样如果发布了单个行的表单，该名称可以与我的控制器方法上的名称相匹配。

唯一的问题是我正在为我的文本框使用 ASP.NET 控件（我真的想继续这样做）并且我找不到任何方法来覆盖名称字段。ASP.NET 控件上没有 Name 属性，即使我尝试使用 Attributes 访问器属性通过说“control.Attributes["Name"] = "Price";" 来设置它 它只是将另一个 name= 属性添加到不起作用的 HTML 标记中。

有谁知道我怎样才能使这项工作？我真的不喜欢所有的 HtmlHelper 函数，比如 TextBox 和 DropDown，因为我讨厌让我的 .aspx 像 PHP 或 ASP 那样带有 <%%> 标记和所有内容。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-04T01:16:35.340

我认为您跨越了 ASP.NET WebForms 和 ASP.NET MVC 的两个世界。您确实需要在 MVC 中使用 Html.TextBox 方法等。这使您可以完全控制标记，这是 MVC 的主要优点之一。

您在控制生成的 HTML 时遇到的问题，例如获取两个名称属性，正是 MVC 旨在解决的问题。如果你停止对抗它并顺其自然，它会工作得更好。

<% %> 标签不是问题，除非你有逻辑。将简单的表示逻辑放在您的视图上很好。

如果您不喜欢这样，那么最好还是坚持使用标准的 ASP.NET。

# c++ - Boost::Tuples vs Structs 返回值

> ID：409827
> 
> 赞同：44
> 
> 时间：2009-01-03T20:57:30.467
> 
> 标签：c++, tuples, boost-tuples

我试图让我的头脑围绕元组（感谢@litb），他们使用的常见建议是返回> 1值的函数。

这是我通常会使用 struct 的东西，在这种情况下我无法理解元组的优势 - 对于最终懒惰的人来说，这似乎是一种容易出错的方法。

[借用一个例子](https://stackoverflow.com/questions/321068/returning-multiple-values-from-a-c-function)，我会用这个

```
struct divide_result {
    int quotient;
    int remainder;
}; 
```

使用元组，您将拥有

```
typedef boost::tuple<int, int> divide_result; 
```

但是，如果不阅读您正在调用的函数的代码（或注释，如果您愚蠢到相信它们），您将不知道哪个 int 是商，反之亦然。好像比较像...

```
struct divide_result {
    int results[2]; // 0 is quotient, 1 is remainder, I think
}; 
```

...这不会让我充满信心。

那么，元组与弥补歧义的结构相比有什么优势*？*

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-03T21:53:37.980

### 元组

我想我同意你的观点，即什么位置对应什么变量的问题会引起混淆。但我认为有两个方面。一个是*调用方*，另一个是*被调用方*：

```
int remainder; 
int quotient;
tie(quotient, remainder) = div(10, 3); 
```

我认为我们得到了什么非常清楚，但是如果您必须一次返回更多值，它可能会变得混乱。一旦调用者的程序员查阅了 的文档`div`，他就会知道什么位置是什么，并且可以编写有效的代码。根据经验，我会说不要一次返回超过 4 个值。除此之外，更喜欢结构。

### 输出参数

当然也可以使用输出参数：

```
int remainder; 
int quotient;
div(10, 3, &quotient, &remainder); 
```

现在我认为这说明了元组如何优于输出参数。我们将 的输入`div`与输出混合在一起，却没有获得任何优势。更糟糕的是，我们让该代码的读者对 be 的*实际*返回值产生了疑问`div`。当输出参数有用时，有*很多很好的例子。*在我看来，只有在没有其他方法的情况下才应该使用它们，因为返回值已经被采用并且不能更改为元组或结构。`operator>>`是使用输出参数的一个很好的例子，因为返回值已经为流保留，所以你可以链接`operator>>`来电。如果您不使用运算符，并且上下文不是很清楚，我建议您使用指针，在调用端发出信号表明该对象实际上用作输出参数，以及适当的注释。

### 返回一个结构

第三种选择是使用结构：

```
div_result d = div(10, 3); 
```

我认为这绝对赢得了**清晰**奖。但是请注意，您仍然必须访问该结构中的结果，并且结果不会“裸露”在桌子上，就像输出参数和与`tie`.

我认为这些天的一个重点是让一切尽可能通用。所以，假设你有一个可以打印元组的函数。你可以做

```
cout << div(10, 3); 
```

并显示您的结果。我认为另一方面，元组显然因其**多功能**性而获胜。使用 div_result 执行此操作，您需要重载 operator<<，或者需要单独输出每个成员。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-03T22:48:45.843

另一种选择是使用 Boost Fusion 映射（代码未经测试）：

```
struct quotient;
struct remainder;

using boost::fusion::map;
using boost::fusion::pair;

typedef map<
    pair< quotient, int >,
    pair< remainder, int >
> div_result; 
```

您可以相对直观地访问结果：

```
using boost::fusion::at_key;

res = div(x, y);
int q = at_key<quotient>(res);
int r = at_key<remainder>(res); 
```

还有其他优点，例如*遍历*地图字段的能力等。有关更多信息，请参阅[文档](http://www.boost.org/doc/libs/1_37_0/libs/fusion/doc/html/index.html)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-03T21:05:19.093

使用元组，您可以使用`tie`，这有时非常有用：`std::tr1::tie (quotient, remainder) = do_division ();`. 这对于结构来说并不容易。其次，在使用模板代码时，有时依赖对比为结构类型添加另一个 typedef 更容易。

如果类型不同，那么一对/元组实际上并不比结构差。例如`pair<int, bool> readFromFile()`，int 是读取的字节数，bool 是 eof 是否被命中。在这种情况下添加一个结构对我来说似乎有点矫枉过正，特别是因为这里没有歧义。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-03T21:46:26.343

元组在 ML 或 Haskell 等语言中非常有用。

在 C++ 中，它们的语法降低了它们的优雅性，但在以下情况下很有用：

*   您有一个必须返回多个参数的函数，但结果对于调用者和被调用者来说是“本地的”；你不想为此定义一个结构

*   您可以使用 tie 函数来做一种非常有限的模式匹配“a la ML”，这比为相同目的使用结构更优雅。

*   它们带有预定义的 < 运算符，可以节省时间。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-03T22:27:15.090

我倾向于将元组与 typedef 结合使用，以至少部分缓解“无名元组”问题。例如，如果我有一个网格结构，那么：

```
//row is element 0 column is element 1
typedef boost::tuple<int,int> grid_index; 
```

然后我将命名类型用作：

```
grid_index find(const grid& g, int value); 
```

这是一个有点做作的例子，但我认为大多数时候它在可读性、明确性和易用性之间达到了一个愉快的平衡。

或者在您的示例中：

```
//quotient is element 0 remainder is element 1
typedef boost:tuple<int,int> div_result;
div_result div(int dividend,int divisor); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-06-25T10:04:57.953

结构体所没有的元组的一个特性是它们的初始化。考虑以下内容：

```
struct A
{
  int a;
  int b;
}; 
```

除非您编写`make_tuple`等效或构造函数，否则要将此结构用作输入参数，您首先必须创建一个临时对象：

```
void foo (A const & a)
{
  // ...
}

void bar ()
{
   A dummy = { 1, 2 };
   foo (dummy);
} 
```

还不错，但是，以维护出于任何原因向我们的结构添加新成员的情况为例：

```
struct A
{
  int a;
  int b;
  int c;
}; 
```

聚合初始化的规则实际上意味着我们的代码将继续编译而不会发生变化。因此，我们必须搜索此结构的所有用法并更新它们，而无需编译器的任何帮助。

将此与元组进行对比：

```
typedef boost::tuple<int, int, int> Tuple;
enum {
  A
  , B
  , C
};

void foo (Tuple const & p) {
}

void bar ()
{
  foo (boost::make_tuple (1, 2));  // Compile error
} 
```

编译器无法使用 的结果初始化“Tuple” `make_tuple`，因此会生成允许您为第三个参数指定正确值的错误。

最后，元组的另一个优点是它们允许您编写迭代每个值的代码。这根本不可能使用结构。

```
void incrementValues (boost::tuples::null_type) {}

template <typename Tuple_>
void incrementValues (Tuple_ & tuple) {
   // ...
   ++tuple.get_head ();
   incrementValues (tuple.get_tail ());
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-03T21:08:22.410

防止你的代码被许多结构定义乱七八糟。当您只记录元组中的每个元素是什么而不是编写自己的结构/让人们查找结构定义时，编写代码的人以及使用它的其他人更容易。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-03T21:19:15.023

元组将更容易编写 - 无需为每个返回某些内容的函数创建一个新结构。关于什么去哪里的文档将转到功能文档，无论如何都需要。要使用该函数，无论如何都需要阅读函数文档，并且将在那里解释元组。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-01-03T21:24:45.933

我同意你 100% 罗迪。

要从一个方法返回多个值，除了元组之外，您还有几个选项，哪个最好取决于您的情况：

1.  创建一个新结构。当您返回的多个值是**相关**的时，这很好，并且适合创建新的抽象。例如，我认为“divide_result”是一个很好的通用抽象，传递这个实体让你的代码比传递一个无名元组更清晰。然后，您可以创建对该新类型进行操作的方法，将其转换为其他数字类型等。

2.  使用“输出”参数。通过引用传递多个参数，并通过分配给每个 out 参数返回多个值。当您的方法返回几个**不相关**的信息时，这是合适的。在这种情况下创建一个新结构将是矫枉过正的，并且使用 Out 参数可以强调这一点，而且每个项目都会获得应有的名称。

元组是邪恶的。

# c++ - 如何对关键内存扫描仪的离线形式进行编程

> ID：409832
> 
> 赞同：1
> 
> 时间：2009-01-03T21:00:57.433
> 
> 标签：c++, windows, memory

我喜欢您可以从关键 ( [http://www.crucial.com/systemscanner/index.aspx](http://www.crucial.com/systemscanner/index.aspx) ) 获得的内存扫描仪，但它仅适用于在线计算机。

我希望能够尽可能多地做它所做的事情，但要离线。

我想提供足够的信息，以便能够将此信息带到另一台在线计算机并使用它来订购内存升级。

我想对此进行编程，对目标计算机上的内容做出最低限度的假设。

我选择的语言是 C++。

（C# 是我目前最喜欢的语言，但使用它需要 .Net 环境，这是我不喜欢的假设。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-04T08:30:11.627

WMI（在 root\cimv2 命名空间中）具有 Win32_MemoryArray、Win32_MemoryDe​​vice、Win32_MemoryDe​​viceArray、Win32_PhysicalMemory 和 Win32_PhysicalMemoryArray 类（以及其他几个）。这些可能会有所帮助。

# c# - 用 asp.net 打开一个新窗口

> ID：409846
> 
> 赞同：2
> 
> 时间：2009-01-03T21:14:23.287
> 
> 标签：c#, javascript, asp.net, ajax, modal-dialog

我对那个 asp.net 的东西很陌生，但是这里有。

我得到了 ImageButton，当它被点击时，我希望图像显示在另一个窗口中。如果我可以避免使用 ajax，我想这样做。如果可能的话，想制作窗口模式，但仍然避免使用 ajax，因为我还没有准备好混合更多技术。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-03T21:21:04.177

JavaScript 的现有答案很好，但只是建议一个替代方案 - 您可以使用[HyperLink](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.hyperlink.aspx)（设置[ImageUrl](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.hyperlink.imageurl.aspx)以便您仍然获得图像）并设置其[Target](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.hyperlink.target.aspx)属性吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T21:18:19.690

有点像这样：

```
<asp:ImageButton ID="imbJoin" CssClass="btn-find" AlternateText="Find" ToolTip="Find" runat="server" ImageUrl="~/library/btn-find.gif" onClick="javascript:popUp("ServicesLocator.aspx")" /> 
```

资源：[http ://www.experts-exchange.com/Programming/Languages/.NET/ASP.NET/Q_22832169.html](http://www.experts-exchange.com/Programming/Languages/.NET/ASP.NET/Q_22832169.html)

使用 ImageButton 您需要使用 JavaScript 在新窗口中打开它。您还可以查看 OnClientClick 事件

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-03T21:19:28.707

您可以使用 ImageButton 的 OnClientClick 属性：

```
<asp:ImageButton ... OnClientClick="javascript:window.open('url_to_image');" > 
```

但是这个弹出窗口不会是模态的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T21:20:20.030

以下 javascript 将满足您的需求：

```
window.open('page.html','WindowTitle','width=400,height=200') 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-03T21:36:11.247

恕我直言，显示图片的最佳做法是在内容顶部的同一页面中。我个人使用[Lightbox](http://www.huddletogether.com/projects/lightbox2/)。您可以在他们的页面上找到文档，因此您应该很容易集成他们的 JavaScript 代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-03T23:41:52.413

可能值得指出优秀[EFNet 的 #javascript FAQ](http://xkr.us/js/)中的两个相关条目：

1.  [正确使用弹出窗口](http://xkr.us/js/popups)- 是的可访问性！
2.  [如何使弹出窗口与我的图像大小相同？](http://xkr.us/js/picpop)
3.  [如何创建自定义“确定”对话框或类似内容？](http://xkr.us/js/modal)- 模态窗口不是很有用，建议的[灯箱](http://www.huddletogether.com/projects/lightbox2/)或类似脚本之类的东西会是更好的“模态”选项
4.  [正确使用链接](http://xkr.us/js/links)- 这只是部分主题，但之前的答案使用“javascript：”伪协议使其成为必要：它在应该跨浏览器工作的网页中从来不需要也没有用。毕竟，JavaScript 是默认的（也是唯一的）脚本语言。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-04T18:56:35.873

谢谢大家的回答！我最终使用了灯箱，我发现了这个例子 [http://neutrongenious.wordpress.com/2007/09/08/lightbox-for-asp-net-2-0/](http://neutrongenious.wordpress.com/2007/09/08/lightbox-for-asp-net-2-0/)

它完美地工作

# sql - SQL，选择和更新

> ID：409849
> 
> 赞同：1
> 
> 时间：2009-01-03T21:16:57.570
> 
> 标签：sql, select, sql-update

我正在尝试在包含 100000 行的数据库中选择 100 行并在之后更新这些行。

问题是我不想为此目的两次访问数据库，因为更新仅将这些行标记为“已读”。

有什么办法可以在java中使用简单的jdbc库来做到这一点？（希望不使用存储过程）

更新：好的，这里有一些澄清。

有几个相同应用程序的实例运行在不同的服务器上，它们都需要选择根据 creation_date 列排序的 100 条“未读”行，读取其中的 blob 数据，将其写入文件并将该文件通过 ftp 传输到某个服务器。（我知道史前，但要求是要求）

读取和更新部分是为了确保每个实例获得不同的数据集。（按顺序，像赔率和偶数这样的技巧不会起作用：/）

我们选择数据进行更新。数据通过线路传输（我们等待并等待），然后我们将它们更新为“READ”。然后释放锁定以进行阅读。整个事情花费的时间太长了。通过同时读取和更新，我想减少锁定时间（从我们使用 select 进行更新到实际更新的时间），以便使用多个实例会增加每秒读取的行数。

还有想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-03T21:57:40.983

在我看来，在这里解释这个问题的方法可能不止一种。

1.  您选择行的唯一目的是更新它们而不是读取它们。
2.  您正在选择要向某人显示的行，并将它们标记为一次读取一个或全部作为一组读取。
3.  您希望在选择行时选择行并将其标记为已读。

让我们先选择选项 1，因为这似乎是最简单的。您不需要选择行来更新它们，只需使用 WHERE 子句发出更新：

```
update table_x
set read = 'T'
where date > sysdate-1; 
```

查看选项 2，您希望在用户阅读它们时将它们标记为已读（或下游系统已收到它，或其他）。为此，您可能需要进行另一次更新。如果您查询主键，除了在第一次选择中需要的其他列之外，您可能会更轻松地进行更新，因为数据库不必进行表或索引扫描来查找行.

在 JDBC (Java) 中，有一种工具可以进行批量更新，您可以在其中一次执行一组更新。当我需要执行大量完全相同形式的更新时，效果很好。

选项 3，您要在其中一次性选择和更新所有内容。我个人觉得这没什么用，但这并不意味着其他人没有。我想某种存储过程会减少往返。我不确定您在这里使用的是什么数据库，也无法真正提供细节。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T21:25:01.113

去数据库还不错。如果您没有“通过网络”返回任何内容，那么更新不应该对您造成太大的损害，而且它只有几十万行。你担心什么？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T21:41:45.417

如果您在 JDBC 中执行 SELECT 并遍历 ResultSet 以更新每一行，那么您做错了。这是一个 (n+1) 查询问题，永远不会很好地执行。

只需使用 WHERE 子句执行 UPDATE，以确定哪些行需要更新。这是一个单一的网络往返方式。

不要太以代码为中心。让数据库完成它设计的工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T21:20:33.010

你不能只使用相同的连接而不关闭它吗？

# asp.net - 在网站中放置广告的最佳做法是什么？

> ID：409852
> 
> 赞同：9
> 
> 时间：2009-01-03T21:18:21.640
> 
> 标签：asp.net, javascript, html, design-patterns, seo

我想在我的网站上放置广告，但我不确定放置这些广告的常见做法。例如，一些很酷的 asp.net 文章网站在文章中间显示广告！所以你读了 2-3 段，读了一些广告，然后读完文章……

另一个担忧是关于破坏的。我的一位客户的 Google Adsense 帐户被禁止，因为一些竞争对手在 goodle 广告中点击了很多次……有一些 javascript 技术可以阻止*[编辑] 不受欢迎的点击泛滥！[/编辑]* ?

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-03T21:27:33.650

谷歌（不出所料）非常了解人们在页面上的位置。他们有[一篇关于在哪里放置广告的文章](https://www.google.com/adsense/support/bin/answer.py?hl=en&answer=17954)。

就我个人而言，我的 C# 文章中的广告就在底部——当你到达那里时，你已经获得了该页面的所有好处。这样我就不会觉得我在扰乱我的用户。再说一次，我并不是真的想从他们那里赚大钱。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-03T21:22:50.617

我发现文章中间的广告很烦人。尽可能避免这种情况。将广告放在侧面和顶部，但也要记住为内容留出足够的空间。请记住，无论如何，>90% 的用户都会为内容而来，并且无论您将广告放在哪里，都不会关心它们。那些想要它们的人，会很容易地在侧面发现它们。但是那些不这样做的人（绝大多数人）如果广告打扰他们只会非常恼火 - 因此不太可能回到您的网站。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-03T21:22:45.640

我会为此而发火，但是：*绝对的最佳做法是根本不在那里放置任何广告*。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-03T21:28:53.617

> goodle 广告...有一些 javascript 技术可以阻止这个吗？

我不会尝试做这样的事情，因为这也算作破坏活动。只需插入 Adsense 代码即可。

我喜欢*stackoverflow*的广告位置：

*   他们根本不会打扰你
*   它们是用品味创造的，让你好奇
*   更不用说他们是有针对性的

# delphi - TextMate 的 Delphi 语法

> ID：409866
> 
> 赞同：4
> 
> 时间：2009-01-03T21:23:59.337
> 
> 标签：delphi, syntax, textmate, pascal, oxygene

[我与RefactorMyCode.com](http://RefactorMyCode.com/)的 Marc-André Cournoyer 交换了关于在他的网站上支持 Delphi 的电子邮件。由于他的站点使用[Ruby 的 UltraViolet](http://ultraviolet.rubyforge.org/)进行语法高亮显示，并且它使用[TextMate](http://macromates.com/)语法，因此他需要 TextMate 的 Delphi 语法。事实证明它已经有了[Pascal 语法](http://macromates.com/svn/Bundles/trunk/Bundles/Pascal.tmbundle/)，所以它已经完成了 90%。

有谁知道我在哪里可以找到已经为 Delphi 更新的软件？Delphi Prism / Oxygene 也很棒！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-03T21:38:58.837

没有官方的 delphi 语法。我正忙着编译一个，但有一些家庭问题占用了我大部分时间。我将在下周继续努力，并希望在本周末完成。

另见：[寻找完整的delphi对象pascal语法](https://stackoverflow.com/questions/171827/looking-for-a-complete-delphi-object-pascal-syntax)

# c# - 使用直接输入向游戏发送击键

> ID：409886
> 
> 赞同：7
> 
> 时间：2009-01-03T21:31:01.910
> 
> 标签：c#

`PostMessage`我可以使用api发送任何 Windows 应用程序按键。但我无法通过使用将击键发送到游戏窗口`PostMessage`。

任何人都知道有关使用直接输入函数从 C# 向游戏发送密钥的任何信息。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-04T00:30:21.317

另一种方法是直接挂钩 DirectInput API - Microsoft Research 已经提供了一个库来执行此操作：[http ://research.microsoft.com/en-us/projects/detours/](http://research.microsoft.com/en-us/projects/detours/)

一旦你连接到 API，你就可以用它做任何你想做的事情。然而，值得注意的是，在最近的 Windows 版本中，用于鼠标和键盘输入的 DirectInput 只是 Win32 Windows 消息的包装。DirectInput 在后台生成一个线程，并在将窗口消息传递回应用程序之前简单地截取它们。这是微软不再推荐使用 DirectInput 的原因之一——这意味着像 PostMessage 这样的消息传递 API*应该*可以正常工作。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2014-01-03T07:31:57.923

一种替代方法是使用键盘驱动程序（这不是 SendInput()）来模拟按键和事件鼠标按下，而不是挂接到 DirectX。

您可以使用[Oblita 的 Interception 键盘驱动程序](http://oblita.com/interception.html)（适用于 Windows 2000 - Windows 7）和[C# 库 Interception](https://github.com/jasonpang/Interceptor)（包装要在 C# 中使用的键盘驱动程序）。

有了它，你可以做一些很酷的事情，比如：

```
input.MoveMouseTo(5, 5);
input.MoveMouseBy(25, 25);
input.SendLeftClick();

input.KeyDelay = 1; // See below for explanation; not necessary in non-game apps
input.SendKeys(Keys.Enter);  // Presses the ENTER key down and then up (this constitutes a key press)

// Or you can do the same thing above using these two lines of code
input.SendKeys(Keys.Enter, KeyState.Down);
Thread.Sleep(1); // For use in games, be sure to sleep the thread so the game can capture all events. A lagging game cannot process input quickly, and you so you may have to adjust this to as much as 40 millisecond delay. Outside of a game, a delay of even 0 milliseconds can work (instant key presses).
input.SendKeys(Keys.Enter, KeyState.Up);

input.SendText("hello, I am typing!");

/* All these following characters / numbers / symbols work */
input.SendText("abcdefghijklmnopqrstuvwxyz");
input.SendText("1234567890");
input.SendText("!@#$%^&*()");
input.SendText("[]\\;',./");
input.SendText("{}|:\"<>?"); 
```

因为这些按键背后的机制是键盘驱动程序，所以它几乎不受限制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-04T00:12:12.803

现在可以通过 DirectInput API 执行此操作。

存档相同效果的唯一方法是编写您自己的 DirectInput COM 对象，该对象只包装普通的 DirectInput 对象。之后，您可以添加代码来模拟击键。诀窍是用您的版本替换 Win32 dinput.dll。然后所有游戏将在启动时加载您的 DLL。

不过，恐怕您无法从托管语言中做到这一点。您必须使用本机代码来执行此操作，因为它需要相当多的低级黑客技术。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-08T13:14:49.830

您可以为此使用非托管的 SendInput 函数。它将输入发布在低于 DirectInput 的级别。知道要发送什么键码非常重要。这些可能因游戏而异。如果 Windows 虚拟键码对游戏不起作用，您可以尝试发送 DIKEYBOARD 常量（如 DIKEYBOARD_A 等），如果仍然不起作用，请继续尝试。例如，《半条命》或《反恐精英》期望 ASCII 码作为键码（我花了一段时间才弄清楚）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-06-14T10:35:04.353

为没有问题的朋友游戏（Nostale）工作：

[这里](http://www.kbdedit.com/manual/low_level_vk_list.html)还有一个有用的*虚拟键代码列表*

```
 [DllImport("user32.dll")]
        public static extern IntPtr FindWindow(string lpClassName, string lpWindowName);

        [DllImport("user32.dll")]
        static extern bool PostMessage(IntPtr hWnd, UInt32 Msg, int wParam, int lParam);

        private void button1_Click(object sender, EventArgs e)
        {
            const int WM_SYSKEYDOWN = 0x0104;
            const int VK_SPACE = 0x20;

            IntPtr WindowToFind = FindWindow(null, "WINDOW NAME");

            PostMessage(WindowToFind, WM_SYSKEYDOWN, VK_SPACE, 0);
        } 
```

# c# - 您可以从 System.Net.Sockets.TcpClient 检索主机名和端口吗？

> ID：409906
> 
> 赞同：7
> 
> 时间：2009-01-03T21:41:58.300
> 
> 标签：c#, networking

是否可以从新的 TcpClient 检索底层主机名/端口？

```
TcpListener listener = new TcpListener(IPAddress.Any, port);
TcpClient client = listener.AcceptTcpClient();
// get the hostname
// get the port 
```

我在`client.Client`(a `System.Net.Socket`) 中四处走动，但也找不到任何东西。有任何想法吗？

谢谢大家。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-03T22:51:43.217

未经测试，但我会尝试以下方法：

```
TcpListener listener = new TcpListener(IPAddress.Any, port);
TcpClient client = listener.AcceptTcpClient();

IPEndPoint endPoint = (IPEndPoint) client.Client.RemoteEndPoint;
// .. or LocalEndPoint - depending on which end you want to identify

IPAddress ipAddress = endPoint.Address;

// get the hostname
IPHostEntry hostEntry = Dns.GetHostEntry(ipAddress);
string hostName = hostEntry.HostName;

// get the port
int port = endPoint.Port; 
```

如果您可以使用 IPAddress，我会跳过反向 DNS 查找，但您特别要求提供主机名。

# php - PHP可以安装在本地机器上吗？

> ID：409913
> 
> 赞同：2
> 
> 时间：2009-01-03T21:46:57.713
> 
> 标签：php, wysiwyg, localhost, offline

对于 Web-dev，PHP 处理器是否可以安装在普通的 Windows XP 机器上，这样通过浏览器查看 PHP 文件会执行 PHP 脚本？*（不是 Windows Server 2003）*

我什至[下载了 PHP](http://www.php.net/downloads.php)，但似乎他们希望将它安装在服务器上。

有没有其他方法可以**在本地机器上快速预览和运行 PHP 而**无需将文件上传到服务器？*（[Dreamweaver](http://www.adobe.com/products/dreamweaver/)可以处理 PHP 文件中的静态 HTML..）*

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-03T21:48:31.377

我建议：

[http://www.wampserver.com/en/](http://www.wampserver.com/en/)

或者

[http://www.apachefriends.org/en/xampp.html](http://www.apachefriends.org/en/xampp.html)

这些是用于 windows 的 apache+php+mysql 的易于安装的软件包。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T21:49:59.750

我使用[XAMPP LAMP 堆栈](http://www.apachefriends.org/en/xampp.html)。在 Windows XP Pro 和 Home 版本上一键安装。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-03T21:51:13.213

当然。只需从 php 下载页面下载 windows 二进制文件。[http://www.php.net/downloads.php](http://www.php.net/downloads.php)

如果您想解析网页，您将需要安装一个网络服务器（例如 apache）。但是，只需该下载，您就可以运行 php 脚本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-03T21:52:32.367

XAMPP 是显而易见的，但还有另一个不错的：Uniform Server，它被设计为可移动的（即用于 CD-ROM 等可移动媒体）：

[http://www.uniformserver.com/](http://www.uniformserver.com/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-03T22:00:21.167

到目前为止，我对不那么臃肿的[XAMPP Lite](http://www.apachefriends.org/en/xampp-windows.html#646)感到非常满意。尽管该链接上有注释，但它的更新频率与 XAMPP 一样。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-04T02:23:56.720

[Microsoft Web Platform Installer](http://www.microsoft.com/web/channel/products/WebPlatformInstaller.aspx)看起来是一个不错的解决方案，但您需要 Vista。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-04T07:46:18.690

如前所述，您可以通过安装 XAMPP（我个人最喜欢的）之类的东西来更简单地进行操作，或者，如果您想模仿更接近服务器环境的东西，安装 VirtualBox/VirtualPC 并创建一个运行 Debian 或其他的虚拟机您需要的服务器操作系统，以及适当的 PHP、Apache2（等等）包。

我发现这有时比使用 XAMPP 更可取，因为 XAMPP 与一组特定的 Apache 或 PHP 模块打包在一起，您可能需要一些尚未与 XAMPP 一起打包的东西。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-04T19:49:37.293

XAMPP 将为您完成这项工作，但请注意大多数 php 服务器在某种 unix 上运行，因此它经常接近但并不完全相同。

我正在考虑路径、路径分隔符、符号链接等基本差异

随意搜索“WAMP vs LAMP”以获取更多信息。

/约翰

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-12-31T17:24:08.007

你可以在 XAMPP 的帮助下在本地机器上安装 PHP，有时如果本地机器上安装了 skype，那么 apache 服务器在启动时会出现问题。按照本教程解决问题。[http://www.feelzdroid.com/2015/12/install-php-server-local-machine.html](http://www.feelzdroid.com/2015/12/install-php-server-local-machine.html)。

# image - Netbeans 中的 J2ME（gif 图像问题）

> ID：409916
> 
> 赞同：2
> 
> 时间：2009-01-03T21:47:45.293
> 
> 标签：image, netbeans, java-me, wait, gif

我正在创建一个室内导航应用程序（目的是用户可以在手机文件系统中存储不同建筑物的地图）。该应用程序通过要求用户选择所需建筑物的地图来启动。选择此选项后，将使用文件解析器来解析和转换文件中的地图数据。在发生这种情况时，我创建了一个等待屏幕，说请稍候......并且还放置了一个加载/处理图像，它是一个 gif。但是当我在 Sun 的 WTK 模拟器中运行它时，gif 并没有改变，它变成了静态图片。顺便说一句，我为此使用了 Netbeans 6.1。有任何想法吗？非常感谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-04T11:57:50.477

[正如诺基亚论坛](http://discussion.forum.nokia.com/forum/showpost.php?p=304842&postcount=11)上所说，即使是旧手机也不支持 gif 图像处理。

然而，Dr. Dobb's Journal 中的[一篇文章使用免费提供的](http://www.ddj.com/mobile/184406435)[GifEncoder.java](http://www.fmsware.com/stuff/gif.html)类提供了关于“在 J2ME 移动电话上显示 GIF 图像”的解决方案。它的 J2ME 端口可从[此处](http://ftp://66.77.27.238/sourcecode/ddj/2006/0602.zip)的同一页面获得。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-03T22:52:03.230

默认情况下，MIDP 不支持动画 gif，因此如果您真的想播放动画 gif，则需要使用 MMAPI。我建议您将动画拆分为单独的文件并手动制作动画。这是最便携的方式。

此代码可让您在最后播放动画 gif

```
InputStream is = getClass().getResourceAsStream("/OceanFish.gif");
DataInputStream di = new DataInputStream(is);
StaticAnimation simage = StaticAnimation.createAnimation(di); 
```

但我也不建议这样做，因为它不是很便携。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-05T14:35:29.627

也许不是理想的解决方案，但您始终可以将 gif 动画帧提取到 png 格式的精灵表，然后使用 Sprite 类来处理动画。由于 Sprite 类是 MIDP 2 标准的一部分，因此这将更加可移植。

# java - 如何克服 Java 的静态 Main() 方法的限制

> ID：409919
> 
> 赞同：0
> 
> 时间：2009-01-03T21:49:26.710
> 
> 标签：java

我正在努力解决这个问题。

在我的项目中，我有一个名为“Hello.java”的文件，它是带有 main() 参数的文件，在编译程序时会调用它。我还有另一个名为 MyObj.java 的文件，其中包含一个随机类，用于测试 java 的 OO 功能。我正在尝试这样做：

```
class Hello
{
    public MyObj an_obj;
    public static void main(String[] args)
    { 
        setObj();
    }       

    public void setObj()
    {
        this.an_obj.set_size(7);
        say("size is " + this.an_obj.get_size());
    }    
} 
```

在 MyObj.java 类中，我有以下代码：

```
public class MyObj
{
    private int size;

    public MyObj()
    {
        //do nothing
    }

    public void set_size(int new_size)
    {
        this.size=new_size;
    }

    public int get_size()
    {
        return this.size;
    }   
} 
```

然而，这给出了错误：

> “无法从 Hello 类型对非静态方法 setObj() 进行静态引用”。

如果我在 setObj 的声明中添加“静态”，即

```
public static void setObj() 
```

然后我得到：

> 无法对非静态字段 an_obj 进行静态引用。

我的问题是，如果启动程序的唯一方法是使用 Main 方法，而 main 方法只能调用静态方法，我该如何完成我正在做的事情，即设置和检索对象的字段？在什么方面，由于只能调用静态方法的限制，我怎么能做任何事情？？？？？？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-03T21:52:57.187

您也可以将“静态”添加到成员变量中，或者从您的 main 方法中实例化该类。以下是这两种方法的一些示例代码：

```
/* Static */
class Hello {
    public static MyObj an_obj;
    public static void main(String[] args) { 
        setObj();
    }           

    public static void setObj() {
        this.an_obj.set_size(7);
        say("size is " + this.an_obj.get_size());
    }
}

/* Non-Static */
class Hello {
    public MyObj an_obj;
    public static void main(String[] args) {
        Hello hello = new Hello(); 
        hello.setObj();
    }           

    public void setObj() {
        this.an_obj.set_size(7);
        say("size is " + this.an_obj.get_size());
    }
} 
```

这两种方法的主要区别在于，在第一种方法中，“an_obj”是静态的——也就是说，整个程序只有一个变量。如果您要实例化多个 Hello 对象，它们都将具有相同的“一个 obj”引用。在第二种情况下，每个 Hello 对象都有自己的“一个 obj”引用，每个引用都可以指向不同的 MyObj 实例。

显然，在这种简单的情况下，无论哪种方式都没有任何区别，但一般来说，应尽可能避免使用静态成员和方法。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-03T21:53:32.693

同时创建`setObj()`方法和`an_obj`变量`static`，或执行以下操作：

```
public static void main(String[] args) {
    new Hello().setObj();
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-03T21:59:37.610

除了所有以前的答案，我想提一下，只是因为您不了解不一定构成“限制”的语言概念。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-03T21:57:25.773

您从未创建过`MyObj`.

有两个逻辑位置可以创建必要的对象。

1.  你好的初始化。

    ```
    public MyObj an_obj= new MyObj();
    public static void main(String[] args)
    { 
        setObj();
    } 
    ```

2.  内部 main()

    ```
    public MyObj an_obj;
    public static void main(String[] args)
    { 
        an_obj= new MyObj()
        setObj();
    } 
    ```

无论哪种方式，您都必须实际创建一个对象。

此外，您可以制作`setObj`静态。但是，这很少是您想要的。

正确的做法是（1）创建相关对象，（2）将控制权交给这些对象。这是你应该做的。

```
class Hello
{
    public MyObj an_obj= new MyObj();
    public static void main(String[] args)
    { 
        Hello aHelloObject= new Hello();
        aHelloOject.setObj();
    }       

    public void setObj()
    {
        this.an_obj.set_size(7);
        say("size is " + this.an_obj.get_size());
    }    
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-03T22:40:24.313

`static`当你有一个类的实例时，你只能调用实例方法（即非方法）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-04T00:04:19.200

从简单的角度来看，Java 中有两种不同的东西：

*   对象
*   静态变量/函数

对象在运行时创建，当您创建它们时。静态的东西（全部）总是在那里，并根据需要加载。

虽然您可以在课程中混合和匹配这些，但您必须小心使用它们。静态事物可以调用对象，但必须先创建对象的版本。一个对象，一旦创建就可以调用它喜欢的任何静态事物。

我们确实倾向于创建对象类并且也有一些静态位，但是如果你愿意，你可以在一个类中拥有所有静态的东西，或者你可以只拥有所有基于对象的东西。

静态的东西通常不受欢迎，因为它本质上是全局的，这为奇怪的行为开辟了更多的可能性。没有静态位的对象是最好的，如果它们不调用内部数据之外的东西，通常是线程安全的（使 95% 的代码简单安全，然后在某些特殊类中处理复杂的 5%）。

保罗。

# java - Java Timer vs ExecutorService？

> ID：409932
> 
> 赞同：286
> 
> 时间：2009-01-03T21:54:27.700
> 
> 标签：java, timer, scheduled-tasks, scheduling, executorservice

我有代码，我使用`java.util.Timer`. 我环顾四周，看到`ExecutorService`可以做同样的事情。所以这里的这个问题，你有没有使用`Timer`和`ExecutorService`安排任务，一个使用比另一个有什么好处？

还想检查是否有人使用过该`Timer`课程并遇到`ExecutorService`为他们解决的任何问题。

* * *

## 回答 #1

> 赞同：340
> 
> 时间：2009-01-03T22:22:53.493

根据[实践中的Java并发](http://jcip.net/)：

*   `Timer`可以对系统时钟的变化敏感，`ScheduledThreadPoolExecutor`不是。
*   `Timer`只有一个执行线程，所以长时间运行的任务会延迟其他任务。`ScheduledThreadPoolExecutor`可以配置任意数量的线程。此外，如果需要（通过提供`ThreadFactory`），您可以完全控制创建的线程。
*   抛出的运行时异常`TimerTask`杀死一个线程，从而使`Timer`死:-( ... 即计划任务将不再运行。`ScheduledThreadExecutor`不仅捕获运行时异常，而且它允许您在需要时处理它们（通过覆盖`afterExecute`方法 from `ThreadPoolExecutor`）。任务抛出的异常将被取消，但其他任务将继续运行。

如果您可以使用`ScheduledThreadExecutor`代替`Timer`，请这样做。

还有一件事......虽然`ScheduledThreadExecutor`在 Java 1.4 库中不可用，但有一个[JSR 166 ( `java.util.concurrent`) 到 Java 1.2, 1.3, 1.4](http://backport-jsr166.sourceforge.net/)的反向移植，它具有`ScheduledThreadExecutor`类。

* * *

## 回答 #2

> 赞同：66
> 
> 时间：2009-01-04T01:19:12.293

如果您可以使用它，那么很难想出*不*使用 Java 5 执行器框架的理由。来电：

```
ScheduledExecutorService ex = Executors.newSingleThreadScheduledExecutor(); 
```

将为您提供`ScheduledExecutorService`与`Timer`（即它将是单线程的）类似的功能，但其访问可能更具可扩展性（在后台，它使用并发结构而不是与`Timer`类完全同步）。使用 a`ScheduledExecutorService`还可以为您带来以下优势：

*   如果需要，您可以自定义它（参见`newScheduledThreadPoolExecutor()`或`ScheduledThreadPoolExecutor`类）
*   “一次性”执行可以返回结果

`Timer`关于我能想到的坚持的唯一原因是：

*   它在 Java 5 之前可用
*   J2ME 中提供了一个类似的类，它可以使您的应用程序更容易移植（但在这种情况下添加一个公共抽象层并不是很困难）

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2009-01-03T22:06:24.523

ExecutorService 更新更通用。计时器只是一个定期运行您为其安排的内容的线程。

ExecutorService 可能是一个线程池，甚至可以分布在集群中的其他系统中，并执行一次性批量执行等操作...

看看每个提供什么来决定。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-01-04T00:34:18.983

以下是有关计时器使用的更多良好实践：

[http://tech.puredanger.com/2008/09/22/timer-rules/](http://tech.puredanger.com/2008/09/22/timer-rules/)

一般来说，我会使用 Timer 来处理快速而肮脏的东西，而使用 Executor 来获得更强大的使用。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2016-10-29T09:33:09.130

[来自ScheduledThreadPoolExecutor](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ScheduledThreadPoolExecutor.html)上的 Oracle 文档页面

> 一个**ThreadPoolExecutor**，可以额外安排命令在给定延迟后运行，或定期执行。当需要多个工作线程时，或者需要额外的灵活性或 ThreadPoolExecutor（此类扩展）的功能时，此类比**Timer**更可取。

`ExecutorService/ThreadPoolExecutor`或者`ScheduledThreadPoolExecutor`当您有多个工作线程时是明显的选择。

`ExecutorService`结束的优点`Timer`

1.  `Timer`不能利用可用的 CPU 内核，这与 使用[ForkJoinPool](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinPool.html)之类`ExecutorService`的多任务的情况不同`ExecutorService`
2.  `ExecutorService`如果您需要在多个任务之间进行协调，则提供协作 API。假设您必须提交 N 个工作任务并等待所有任务完成。您可以使用[invokeAll](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html#invokeAll-java.util.Collection-) API 轻松实现它。如果您想通过多个`Timer`任务实现相同的目标，那就不简单了。
3.  [ThreadPoolExecutor](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ThreadPoolExecutor.html)为管理线程生命周期提供了更好的 API。

    > 线程池解决了两个不同的问题：由于减少了每个任务的调用开销，它们通常在执行大量异步任务时提供改进的性能，并且它们提供了一种限制和管理资源的方法，包括执行一组线程时消耗的线程。任务。每个 ThreadPoolExecutor 还维护一些基本的统计信息，例如完成任务的数量

    几个优点：

    一种。您可以创建/管理/控制线程的生命周期并优化线程创建成本开销

    湾。您可以控制任务的处理（Work Stealing、ForkJoinPool、invokeAll）等。

    C。您可以监控线程的进度和健康状况

    d。提供更好的异常处理机制

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-04-12T20:52:27.367

我有时更喜欢 Timer 而不是 Executors.newSingleThreadScheduledExecutor() 的原因是，当我需要计时器在守护线程上执行时，我会得到更清晰的代码。

比较

```
private final ThreadFactory threadFactory = new ThreadFactory() {
    public Thread newThread(Runnable r) {
        Thread t = new Thread(r);
        t.setDaemon(true);
        return t;
    }
};
private final ScheduledExecutorService timer = Executors.newSingleThreadScheduledExecutor(threadFactory); 
```

和

```
private final Timer timer = new Timer(true); 
```

当我不需要 executorservice 的健壮性时，我会这样做。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2021-03-10T04:06:10.583

我确实遇到了 Timer 问题，我*用 ScheduledExecutorService*替换它来修复它。

问题是*计时器*取决于系统时间，每次我更改它时，它都会影响应用程序的功能。所以我用*ScheduledExecutorService替换了**Timer* ，现在它工作正常。

 *# c# - 学习 C#/.NET 是否需要 MSDN 订阅？

> ID：409933
> 
> 赞同：2
> 
> 时间：2009-01-03T21:54:30.523
> 
> 标签：c#, .net, jakarta-ee

我是一名想要攀登 .NET 学习曲线的 Java EE 人。

我一直认为 Java 和 .NET 之间的一个重要区别是 Microsoft 套件要求您（或您的雇主）投入一些硬币来访问这些工具。Java 人员的优势在于能够下载 JVM、Eclipse 或 NetBeans、Tomcat 或 Glassfish、MySQL 或 PostgreSQL，并且他们正在开展业务。这还公平吗？对于在 Java EE 商店工作的人来说，在不花钱的情况下学习 C# 的最佳方式是什么？没有付费订阅 MSDN 是否可以很好地学习 C#？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-03T21:55:49.177

无需订阅。您甚至可以下载免费的[Visual Studio Express Edition](http://www.microsoft.com/express/)，并且还可以免费访问[MSDN 库](http://msdn.microsoft.com/en-us/library/default.aspx)。还有免费的[Sql Server Express 版本](http://www.microsoft.com/express/)。

添加所有很棒的免费在线资源，如 stackoverflow、[asp.net](http://asp.net)、[codeproject](http://www.codeproject.com)、博客等，您就可以开始使用了。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-03T23:12:12.643

除了已经提到的 Express 工具之外，您还需要 IIS 来进行 Web 开发。这包含在 Windows 的各种专业/商业版本中。

MSDN 文档也可以在线免费获得。

免费 Express 版和付费版 Visual Studio的[主要区别](http://msdn.microsoft.com/en-us/vs2005/aa700921.aspx "主要区别")在于您不支持插件、一些调试工具、一些项目（如 Windows 服务）、Crystal Reports、安装程序和其他工具对商业有用，但对学习不重要。

学习 C# 后，如果您需要免费版本中没有的功能，您可以从 MSDN 单独购买所需的工具并节省一些现金。Visual Studio 标准版约为 250 美元，SQL Developer 约为 50 美元。MSDN 的主要优势在于它为您提供了使用 Microsoft 堆栈进行开发所需的*所有工具。*根据[MSDN (pdf) 的类型，](http://download.microsoft.com/download/1/d/2/1d28cf80-667f-4d68-bb70-48875e0e10f5/80024_msdnSubscription.pdf "MSDN 类型 (pdf)")您可以获得桌面和服务器操作系统、Office、Visual Studio 和各种服务器应用程序。这些可能非常有用，但肯定不是学习所必需的。

Microsoft 还为其许多专业工具提供 30 天以上的评估。 [Windows Server](http://msdn.microsoft.com/en-us/evalcenter/cc137233.aspx "视窗服务器") , [Visual Studio](http://msdn.microsoft.com/en-us/visualc/aa700831.aspx "视觉工作室") , [SQL](http://www.microsoft.com/sqlserver/2008/en/us/trial-software.aspx "SQL") , [Sharepoint](http://www.microsoft.com/downloads/details.aspx?FamilyId=2E6E5A9C-EBF6-4F7F-8467-F4DE6BD6B831&displaylang=en "共享点") ,[表达式](http://www.microsoft.com/expression/try-it/Default.aspx "表达")

在我看来，完全没有理由需要订阅 MSDN 才能学好 C#。但它对于专注于 Microsoft 工具的专业开发人员很有用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-03T21:56:28.520

[http://www.microsoft.com/Express/](http://www.microsoft.com/Express/) - Express IDE 是轻量级的免费 IDE，适用于学生或业余爱好者。它们不包括所有的花里胡哨，但应该足以学习如何编写任何代码。

.Net 的编译器与框架一起分发，因此您实际上可以在记事本中编写代码（尽管我只是获得免费的 IDE）

此外，如果您是一家新公司（成立不到 3 年），年收入少于 100 万并且是私有的，您应该[查看 http://www.microsoft.com/BizSpark/](http://www.microsoft.com/BizSpark/)。使用 Bizspark，您可以获得带有 VSTS 的 MSDN 的全功能许可证。当您退出该计划时，您只需支付 100.00 美元。

如果我们在八个月前知道这一点，我们就会为自己节省大量现金。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-03T21:56:54.090

您可以免费下载[Visual Studio Express](http://www.microsoft.com/Express/)，文档可在 MSDN 站点上找到。另一个很棒的工具是[Reflector](http://www.red-gate.com/products/reflector/)，它也是免费的。因此，如果您自己研究 .NET，则不必花任何钱。

另一个深入研究 .NET 细节的好工具（也是免费的）是[Windows 调试工具](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)（WinDbg + SoS.dll 将让您查看 Visual Studio 无法访问的大量细节）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-03T21:56:28.037

如果您是学生，您可以访问 MSDN Academic Alliance。此外，您可以使用速成版来学习这些语言，但它们的功能并不完整，如果您打算在它们上实际开发商业软件，则必须购买完整许可证。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-03T21:56:54.167

没有付费订阅 MSDN 是否可以很好地学习 C#？

简而言之，是的。

1.  [下载VS2008 Express](http://www.microsoft.com/express/)
2.  买书
3.  [MSDN上线了](http://msdn.microsoft.com/en-us/library/default.aspx)
4.  程序
5.  问问题
6.  利润！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-03T21:57:39.487

嗯，MSDN 在网络上是免费的，所以您的参考不是问题。

.NET Framework 和编译器也是免费的。

Visual Studio 不是免费的，但这只是一个开发环境。您可以只使用记事本编写代码，并且那里的一些书籍就是这样做的，因为它们是在教授 c# 而不是如何使用 VS IDE。

所以你当然可以，但使用 Visual Studio 会容易得多。

*编辑*确认！我忘记了 c# Express - 展示你可以多么容易地迷上“Da Man！”

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-03T21:58:18.237

获取 Visual Studio 的“Express”版本（包括编译器和库）和 Microsoft Windows SDK（包括帮助文件），这两者都是免费的......如果需要，还可以获取 SQL Server 的 express 版本.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-03T21:58:59.297

最好的学习方式就是下载[Microsoft Visual Studio Express for C#](http://www.microsoft.com/express/)。这具有完整/专业版的所有或几乎所有功能，但非常适合爱好/学习。

您可以在线访问 MSDN 帮助。我认为您所指的 MSDN 订阅是针对软件等的，并不是开发代码所必需的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-03T22:04:28.600

借助当今在线提供的大量信息，您**无需**订阅 MSDN 即可开始使用 .NET/C#。

1.  阅读并下载您感兴趣的工具的[快速版本](http://www.microsoft.com/express/product/default.aspx)
2.  浏览[MSDN 开发人员中心](http://msdn.microsoft.com/en-us/default.aspx)
3.  阅读在线提供的许多[入门指南中的一些](http://www.google.co.nz/search?source=ig&hl=en&q=getting%20started%20with%20.net)
4.  希望你早点完成

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-09T14:35:01.157

还有两件事尚未提及：

1.  MSDN 库不仅可以在线免费获得，而且还可以[免费下载](http://www.microsoft.com/express/download/msdn/Default.aspx)，有两种版本：300MB 快速（核心）版或 2GB 完整版。

2.  除了 Microsoft 的免费 Visual C# Express 之外，还有一个用于 C#、VB.NET 和 Boo 的完整、高质量、开源的 IDE，称为[#develop](http://sharpdevelop.net/OpenSource/SD/Default.aspx)（或 SharpDevelop）。这具有许多[VC#E 中不存在的特性](http://community.sharpdevelop.net/blogs/mattward/pages/VisualStudioExpressComparison.aspx)，反之亦然。

# c# - 表单可以判断是否打开了任何模式窗口？

> ID：409945
> 
> 赞同：27
> 
> 时间：2009-01-03T21:57:57.083
> 
> 标签：c#, .net, winforms

如何在我的 WinForm 应用程序的主窗体中判断是否有任何模式窗口/对话框打开属于主窗体？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-01-19T14:45:48.567

```
if (this.Visible && !this.CanFocus)
{
    // modal child windows are open
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2015-03-26T11:12:20.473

您也许可以将事件用于`EnterThreadModal`和`LeaveThreadModal`。这是一个示例，您可以这样做：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Windows.Forms;

namespace WindowsFormsApplication1
{
    static class Program
    {
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);

            Application.EnterThreadModal += new EventHandler(Application_EnterThreadModal);
            Application.LeaveThreadModal += new EventHandler(Application_LeaveThreadModal);

            Application.Run(new Form1());
        }

        private static void Application_EnterThreadModal(object sender, EventArgs e)
        {
            IsModalDialogOpen = true;
        }

        private static void Application_LeaveThreadModal(object sender, EventArgs e)
        {
            IsModalDialogOpen = false;
        }

        public static bool IsModalDialogOpen { get; private set; }
    }
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-03T22:21:17.957

长话短说：只要模态窗口打开，打开模态窗体就会阻止主窗体上的执行，因此在*模态窗体关闭之前*，您的主窗体永远无法检查它是否打开了任何模态窗体。换句话说，您的问题是基于对模态形式如何工作的误解，因此完全没有实际意义。

对于它的价值，*可以*判断是否打开了任何模态表单：

```
foreach (Form f in Application.OpenForms)
{
    if (f.Modal)
    {
        // do stuff
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-07-12T15:15:13.163

这说明了为什么[这个答案](https://stackoverflow.com/a/457804/1574221)是正确的，而[这个答案](https://stackoverflow.com/a/409989/1574221)中的假设有时是错误的。

```
if (MyForm.CanFocus == false && MyForm.Visible == true)
{
    // we are modal            
} 
```

这适用于模态显示的子表单和消息框。

* * *

一些演示代码：

```
private void modalTest_Click(object sender, EventArgs e)
{
    // Timer which fires 100ms after the first message box is shown
    System.Windows.Forms.Timer canFocusTimer = new System.Windows.Forms.Timer();
    canFocusTimer.Tick += CanFocusTimer_Tick;
    canFocusTimer.Interval = 100;
    canFocusTimer.Start();

    // First MessageBox shows that CanFocus == true
    MessageBox.Show($"First MessageBox: { nameof(this.CanFocus) } == { this.CanFocus }");
}

private void CanFocusTimer_Tick(object sender, EventArgs e)
{
    (sender as System.Windows.Forms.Timer).Stop();

    // Even though there is already a MessageBox shown the second gets
    // displayed. But now CanFocus == false
    MessageBox.Show($"Second MessageBox: { nameof(this.CanFocus) } == { this.CanFocus }");
} 
```

结果：

[![在此处输入图像描述](https://i.stack.imgur.com/mQq9r.png)](https://i.stack.imgur.com/mQq9r.png)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2017-12-22T10:36:41.837

如果你谷歌一下，你会发现 Form.ShowDialog() 会禁用其他表单，以防止用户输入当前表单的那些表单。但大多数其他东西（如计时器和来自显示表单外部源的其他事件）继续运行。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2017-12-22T10:33:14.410

计时器仍然运行并触发事件。
有效的例子...

```
public partial class Form1 : Form
{
    Form2 f2 = new Form2();
    public Form1()
    {
        InitializeComponent();
    }

    private void timer1_Tick(object sender, EventArgs e)
    {
        f2.UpdateData(DateTime.Now.ToString());
        if (!f2.Visible) f2.ShowDialog();
    }

    private void button1_Click(object sender, EventArgs e)
    {
        f2.ShowDialog();
        MessageBox.Show("Done");
    }
} 
```

# python - 如何使用 Python 将专辑封面嵌入到 MP3 中？

> ID：409949
> 
> 赞同：32
> 
> 时间：2009-01-03T21:59:30.060
> 
> 标签：python, mp3, metadata, id3, albumart

我一直在使用 mutagen 来读取和写入 MP3 标签，但我希望能够将专辑封面直接嵌入到文件中。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-12-20T23:02:50.517

以下是如何使用诱变剂将 example.png 作为专辑封面添加到 example.mp3 中：

```
from mutagen.mp3 import MP3
from mutagen.id3 import ID3, APIC, error

audio = MP3('example.mp3', ID3=ID3)

# add ID3 tag if it doesn't exist
try:
    audio.add_tags()
except error:
    pass

audio.tags.add(
    APIC(
        encoding=3, # 3 is for utf-8
        mime='image/png', # image/jpeg or image/png
        type=3, # 3 is for the cover image
        desc=u'Cover',
        data=open('example.png').read()
    )
)
audio.save() 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-06-16T17:13:44.330

我已经使用[eyeD3](http://eyed3.nicfit.net/)模块来做这件事。

```
def update_id3(mp3_file_name, artwork_file_name, artist, item_title):    
    #edit the ID3 tag to add the title, artist, artwork, date, and genre
    tag = eyeD3.Tag()
    tag.link(mp3_file_name)
    tag.setVersion([2,3,0])
    tag.addImage(0x08, artwork_file_name)
    tag.setArtist(artist)
    tag.setDate(localtime().tm_year)
    tag.setTitle(item_title)
    tag.setGenre("Trance")
    tag.update() 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-03T22:20:00.800

看起来您必须在 MP3 中添加一种特殊类型的帧。[在ID3 标签](http://www.id3.org/id3v2.3.0#head-70a65d30522ef0d37642224c2a40517ae35b7155)上查看网站

此外，诱变剂教程暗示您可以在诱变剂中添加 ID3 标签，[请参阅](http://svn.sacredchao.net/svn/quodlibet/trunk/mutagen/TUTORIAL)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-17T03:31:38.283

[可能的解决方案](http://blog.lostpaperclips.com/2010/10/16/embedding-images-in-mp3-files-redux)

您是否尝试将图像嵌入到大量文件中？如果是这样，我找到了一个脚本（见链接），它通过一组目录，查找图像，并将它们嵌入到 MP3 文件中。当我想在我的（现已不复存在的）iPhone 上的 CoverFlow 中实际查看一些内容时，这对我很有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-25T20:49:06.147

mid3v2 是一个很好的小型 CLI 工具，它帮助我检查了我在开发 id3 东西时所做的工作，它是 id3v2 的诱变版本。它与 Python mutagen 库捆绑在一起。这个小工具的来源也给了我很多关于如何使用诱变剂的答案。

# unit-testing - 单元测试期间调试断言的最佳实践

> ID：409955
> 
> 赞同：52
> 
> 时间：2009-01-03T22:01:03.473
> 
> 标签：unit-testing, assert

大量使用单元测试是否会阻止使用调试断言？似乎在被测代码中触发的调试断言意味着单元测试不应该存在或调试断言不应该存在。“只能有一个”似乎是一个合理的原则。这是常见的做法吗？还是在单元测试时禁用调试断言，以便它们可以用于集成测试？

编辑：我更新了“断言”以调试断言，以区分被测代码中的断言与单元测试中在测试运行后检查状态的行。

这里还有一个例子，我相信它显示了困境：单元测试通过了一个受保护函数的无效输入，断言它的输入是有效的。单元测试不应该存在吗？这不是公共功能。也许检查输入会杀死性能？或者断言不应该存在？该功能受到保护而不是私有的，因此它应该检查它的输入以确保安全。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2010-06-30T14:16:35.083

这是一个完全有效的问题。

首先，很多人建议您错误地使用断言。我认为许多调试专家会不同意。尽管用断言检查不变量是一种很好的做法，但断言不应仅限于状态不变量。事实上，除了检查不变量之外，许多专家调试器会告诉您断言任何可能导致异常的条件。

例如，考虑以下代码：

```
if (param1 == null)
    throw new ArgumentNullException("param1"); 
```

没关系。但是当抛出异常时，堆栈会展开，直到有东西处理异常（可能是一些顶级默认处理程序）。如果此时执行暂停（您可能在 Windows 应用程序中有一个模态异常对话框），您有机会附加一个调试器，但您可能丢失了很多可以帮助您解决问题的信息，因为大部分堆栈已展开。

现在考虑以下几点：

```
if (param1 == null)
{
    Debug.Fail("param1 == null");
    throw new ArgumentNullException("param1");
} 
```

现在如果出现问题，会弹出模态断言对话框。执行立即暂停。您可以自由地附加您选择的调试器，并准确调查堆栈上的内容以及系统在确切故障点的所有状态。在发布版本中，您仍然会遇到异常。

现在我们如何处理您的单元测试？

考虑一个单元测试来测试上面包含断言的代码。您想检查当 param1 为空时是否引发了异常。您希望该特定断言失败，但任何其他断言失败都表明有问题。您希望允许特定测试的特定断言失败。

您解决此问题的方式将取决于您使用的语言等。但是，如果您使用.NET，我有一些建议（我实际上没有尝试过，但我会在未来更新帖子）：

1.  检查 Trace.Listeners。查找 DefaultTraceListener 的任何实例并将 AssertUiEnabled 设置为 false。这会阻止模式对话框弹出。您也可以清除 listeners 集合，但您不会得到任何跟踪。
2.  编写您自己的 TraceListener 来记录断言。如何记录断言取决于您。记录失败消息可能不够好，因此您可能需要遍历堆栈以找到断言来自的方法并记录它。
3.  测试结束后，检查发生的唯一断言失败是否是您所期望的。如果发生任何其他情况，则测试失败。

对于一个包含代码的 TraceListener 示例，我将搜索 SUPERASSERT.NET 的 SuperAssertListener 并检查其代码。（如果您真的很想使用断言进行调试，那么集成 SUPERASSERT.NET 也是值得的）。

大多数单元测试框架都支持测试设置/拆卸方法。您可能希望添加代码来重置跟踪侦听器并断言在这些区域中没有任何意外的断言失败，以最大限度地减少重复并防止错误。

更新：

这是一个示例 TraceListener，可用于对断言进行单元测试。您应该向 Trace.Listeners 集合添加一个实例。您可能还想提供一些简单的方法来让您的测试能够掌握侦听器。

注意：这要归功于 John Robbins 的 SUPERASSERT.NET。

```
/// <summary>
/// TraceListener used for trapping assertion failures during unit tests.
/// </summary>
public class DebugAssertUnitTestTraceListener : DefaultTraceListener
{
    /// <summary>
    /// Defines an assertion by the method it failed in and the messages it
    /// provided.
    /// </summary>
    public class Assertion
    {
        /// <summary>
        /// Gets the message provided by the assertion.
        /// </summary>
        public String Message { get; private set; }

        /// <summary>
        /// Gets the detailed message provided by the assertion.
        /// </summary>
        public String DetailedMessage { get; private set; }

        /// <summary>
        /// Gets the name of the method the assertion failed in.
        /// </summary>
        public String MethodName { get; private set; }

        /// <summary>
        /// Creates a new Assertion definition.
        /// </summary>
        /// <param name="message"></param>
        /// <param name="detailedMessage"></param>
        /// <param name="methodName"></param>
        public Assertion(String message, String detailedMessage, String methodName)
        {
            if (methodName == null)
            {
                throw new ArgumentNullException("methodName");
            }

            Message = message;
            DetailedMessage = detailedMessage;
            MethodName = methodName;
        }

        /// <summary>
        /// Gets a string representation of this instance.
        /// </summary>
        /// <returns></returns>
        public override string ToString()
        {
            return String.Format("Message: {0}{1}Detail: {2}{1}Method: {3}{1}",
                Message ?? "<No Message>",
                Environment.NewLine,
                DetailedMessage ?? "<No Detail>",
                MethodName);
        }

        /// <summary>
        /// Tests this object and another object for equality.
        /// </summary>
        /// <param name="obj"></param>
        /// <returns></returns>
        public override bool Equals(object obj)
        {
            var other = obj as Assertion;

            if (other == null)
            {
                return false;
            }

            return
                this.Message == other.Message &&
                this.DetailedMessage == other.DetailedMessage &&
                this.MethodName == other.MethodName;
        }

        /// <summary>
        /// Gets a hash code for this instance.
        /// Calculated as recommended at http://msdn.microsoft.com/en-us/library/system.object.gethashcode.aspx
        /// </summary>
        /// <returns></returns>
        public override int GetHashCode()
        {
            return
                MethodName.GetHashCode() ^
                (DetailedMessage == null ? 0 : DetailedMessage.GetHashCode()) ^
                (Message == null ? 0 : Message.GetHashCode());
        }
    }

    /// <summary>
    /// Records the assertions that failed.
    /// </summary>
    private readonly List<Assertion> assertionFailures;

    /// <summary>
    /// Gets the assertions that failed since the last call to Clear().
    /// </summary>
    public ReadOnlyCollection<Assertion> AssertionFailures { get { return new ReadOnlyCollection<Assertion>(assertionFailures); } }

    /// <summary>
    /// Gets the assertions that are allowed to fail.
    /// </summary>
    public List<Assertion> AllowedFailures { get; private set; }

    /// <summary>
    /// Creates a new instance of this trace listener with the default name
    /// DebugAssertUnitTestTraceListener.
    /// </summary>
    public DebugAssertUnitTestTraceListener() : this("DebugAssertUnitTestListener") { }

    /// <summary>
    /// Creates a new instance of this trace listener with the specified name.
    /// </summary>
    /// <param name="name"></param>
    public DebugAssertUnitTestTraceListener(String name) : base()
    {
        AssertUiEnabled = false;
        Name = name;
        AllowedFailures = new List<Assertion>();
        assertionFailures = new List<Assertion>();
    }

    /// <summary>
    /// Records assertion failures.
    /// </summary>
    /// <param name="message"></param>
    /// <param name="detailMessage"></param>
    public override void Fail(string message, string detailMessage)
    {
        var failure = new Assertion(message, detailMessage, GetAssertionMethodName());

        if (!AllowedFailures.Contains(failure))
        {
            assertionFailures.Add(failure);
        }
    }

    /// <summary>
    /// Records assertion failures.
    /// </summary>
    /// <param name="message"></param>
    public override void Fail(string message)
    {
        Fail(message, null);
    }

    /// <summary>
    /// Gets rid of any assertions that have been recorded.
    /// </summary>
    public void ClearAssertions()
    {
        assertionFailures.Clear();
    }

    /// <summary>
    /// Gets the full name of the method that causes the assertion failure.
    /// 
    /// Credit goes to John Robbins of Wintellect for the code in this method,
    /// which was taken from his excellent SuperAssertTraceListener.
    /// </summary>
    /// <returns></returns>
    private String GetAssertionMethodName()
    {

        StackTrace stk = new StackTrace();
        int i = 0;
        for (; i < stk.FrameCount; i++)
        {
            StackFrame frame = stk.GetFrame(i);
            MethodBase method = frame.GetMethod();
            if (null != method)
            {
                if(method.ReflectedType.ToString().Equals("System.Diagnostics.Debug"))
                {
                    if (method.Name.Equals("Assert") || method.Name.Equals("Fail"))
                    {
                        i++;
                        break;
                    }
                }
            }
        }

        // Now walk the stack but only get the real parts.
        stk = new StackTrace(i, true);

        // Get the fully qualified name of the method that made the assertion.
        StackFrame hitFrame = stk.GetFrame(0);
        StringBuilder sbKey = new StringBuilder();
        sbKey.AppendFormat("{0}.{1}",
                             hitFrame.GetMethod().ReflectedType.FullName,
                             hitFrame.GetMethod().Name);
        return sbKey.ToString();
    }
} 
```

对于您期望的断言，您可以在每个测试开始时将断言添加到 AllowedFailures 集合。

在每次测试结束时（希望您的单元测试框架支持测试拆解方法）：

```
if (DebugAssertListener.AssertionFailures.Count > 0)
{
    // TODO: Create a message for the failure.
    DebugAssertListener.ClearAssertions();
    DebugAssertListener.AllowedFailures.Clear();
    // TODO: Fail the test using the message created above.
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2014-08-24T20:48:02.027

恕我直言 debug.asserts 摇滚。这篇[很棒的文章](http://netitude.bc3tech.net/2013/11/04/keep-debug-assert-windows-from-halting-your-unit-tests/)展示了如何通过将 app.config 添加到您的单元测试项目并禁用对话框来阻止他们中断您的单元测试：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
<system.diagnostics>
    <assert assertuienabled="false"/>
</system.diagnostics> 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-04-07T20:45:04.957

正如其他人所提到的，Debug 断言适用于*应该始终为 true*的事物。（这个花哨的术语是*不变量*）。

如果您的单元测试传递的虚假数据会触发断言，那么您必须问自己一个问题——为什么会发生这种情况？

*   如果被测函数*应该*处理虚假数据，那么显然该断言不应该存在。
*   如果该功能*没有*配备处理那种数据（如断言所示），那么您为什么要对其进行单元测试？

第二点是相当多的开发人员似乎陷入的。单元测试你的代码要处理的所有事情，并为其他所有事情断言或抛出异常 - 毕竟，如果你的代码不是为了处理这些情况而构建的，并且你导致它们发生，该怎么办你期望发生吗？
您知道 C/C++ 文档中谈论“未定义行为”的那些部分吗？就是这个。保释和保释。

* * *

更新澄清：另一方面是你最终意识到你应该只使用`Debug.Assert`内部事物调用其他内部事物。如果您的代码暴露给第三方（即它是一个库或其他东西），那么您可以期望的输入没有限制，因此您应该正确验证并抛出异常或其他任何东西，您也应该对此进行单元测试

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-04T00:55:41.017

代码中的断言是（应该是）对读者的陈述，即“此时此条件应始终为真”。完成一些纪律后，它们可以成为确保代码正确的一部分；大多数人将它们用作调试打印语句。单元测试是*证明*您的代码正确执行特定测试用例的代码；做得好，他们既可以记录要求，又可以提高您对代码确实正确的信心。

得到区别？程序断言帮助您使其正确，单元测试帮助您建立其他人对代码正确的信心。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-03T22:08:19.887

一个好的单元测试设置将能够捕获断言。如果触发了断言，则当前测试应该失败并运行下一个测试。

在我们的库中，诸如 TTY/ASSERTS 之类的低级调试功能具有被调用的处理程序。默认处理程序将 printf/break，但客户端代码可以为不同的行为安装自定义处理程序。

我们的 UnitTest 框架安装了自己的处理程序，用于记录消息并在断言上抛出异常。然后，UnitTest 代码将捕获这些异常（如果它们发生）并将它们记录为失败，以及断言的语句。

您还可以在单​​元测试中包含断言测试 - 例如

CHECK_ASSERT(someList.getAt(someList.size() + 1); // 如果发生断言，则测试通过

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-08-07T20:39:11.053

我采取了仅在需要时禁用断言的方法，而不是在项目范围内进行。这是一种可以暂停断言的方法，因此它不会干扰测试流程。

```
public static class TraceListenerCollectionEx
{
    /// <summary>
    /// This is a helper class that allows us to suspend asserts / all trace listeners
    /// </summary>
    public class SuspendTrackerDisposable : IDisposable
    {
        private readonly TraceListenerCollection _traceListenerCollection;
        private readonly TraceListener[] _suspendedListeners;

        public SuspendTrackerDisposable(TraceListenerCollection traceListenerCollection)
        {
            _traceListenerCollection = traceListenerCollection;

            var numListeners = traceListenerCollection.Count;
            _suspendedListeners = new TraceListener[numListeners];
            for( int index = 0; index < numListeners; index += 1 )
                _suspendedListeners[index] = traceListenerCollection[index];

            traceListenerCollection.Clear();
        }

        public void Dispose()
        {
            _traceListenerCollection.AddRange(_suspendedListeners);
        }
    }

    public static SuspendTrackerDisposable AssertSuspend(this TraceListenerCollection traceListenerCollection) => new SuspendTrackerDisposable(traceListenerCollection);
} 
```

这是测试中的示例用法：

```
 [TestMethod]
    public void EnumDefaultTest()
    {
        using(Trace.Listeners.AssertSuspend()) {
            Enum<CarClass>.DefaultValue.ShouldBe(CarClass.Unknown);  
        }
    } 
```

在 using 块中执行的代码（在这种情况下只有一行）将禁用其断言。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-03T22:09:29.260

您是指用于“按合同编程”断言的 C++/Java 断言，还是 CppUnit/JUnit 断言？最后一个问题让我相信是前者。

有趣的问题，因为据我了解，当您部署到生产环境时，这些断言通常会在运行时关闭。（有点违背了目的，但这是另一个问题。）

我会说当你测试它时它们应该留在你的代码中。您编写测试以确保正确执行前提条件。测试应该是一个“黑匣子”；测试时，您应该充当班级的客户。如果您碰巧在生产中将它们关闭，它不会使测试无效。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-04T17:39:01.647

First to have both Design by Contract assertions **and** unit tests, your unit testing framework shall be able to catch the assertions. If your unit tests abort because of a DbC abort, then you simply cannot run them. The alternative here is to disable those assertions while running (read compiling) your unit tests.

Since you're testing non-public functions, what is the risk of having a function invoked with invalid argument ? Don't your unit tests cover that risk ? If you write your code following the TDD (Test-Driven Development) technique, they should.

If you really want/need those Dbc-type asserts in your code, then you can remove the unit tests that pass the invalid arguments to the methods having those asserts.

However, Dbc-type asserts can be useful in lower level functions (that is not directly invoked by the unit tests) when you have coarse-grained unit tests.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-08-25T14:44:46.137

即使有单元测试，您也应该保留调试断言。

这里的问题不是区分错误和问题。

如果一个函数检查它的参数是错误的，它不应该导致一个调试断言。相反，它应该返回一个错误值。使用错误的参数调用函数是错误的。

如果一个函数被传递了正确的数据，但由于运行时内存不足而无法正常运行，那么代码应该由于这个问题发出一个调试断言。这是一个基本假设的例子，如果它们不成立，“所有赌注都没有”，所以你必须终止。

在您的情况下，请编写提供错误值作为参数的单元测试。它应该期望一个错误返回值（或类似的）。获得断言？-- 重构代码以产生错误。

注意没有错误的问题仍然可以触发断言；例如，硬件可能会损坏。在您的问题中，您提到了集成测试；事实上，对不正确组合的集成系统进行断言是断言领域；例如，加载了不兼容的库版本。

请注意，“调试”-asserts 的原因是在勤奋/安全和快速/小型之间进行权衡。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-04-07T21:08:29.033

就像其他人提到的那样，`Debug.Assert`陈述应该始终是**真实的**，即使争论不正确，断言也应该是真实的，以阻止应用程序进入无效状态等。

```
Debug.Assert(_counter == somethingElse, "Erk! Out of wack!"); 
```

您应该无法对此进行测试（并且可能不想这样做，因为您真的无能为力！）

我可能会走得很远，但我的印象是，您可能正在谈论的断言可能更适合作为“参数例外”，例如

```
if (param1 == null)
  throw new ArgumentNullException("param1", "message to user") 
```

您的代码中的那种“断言”仍然非常可测试。

PK :-)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-07-20T16:18:05.203

自从提出这个问题以来已经有一段时间了，但我认为我有一种不同的方式来使用 C# 代码在单元测试中验证 Debug.Assert() 调用。请注意该`#if DEBUG ... #endif`块，当不在调试配置中运行时跳过测试所需的块（在这种情况下，无论如何都不会触发 Debug.Assert()）。

```
[TestClass]
[ExcludeFromCodeCoverage]
public class Test
{
    #region Variables              |

    private UnitTestTraceListener _traceListener;
    private TraceListenerCollection _originalTraceListeners;

    #endregion

    #region TestInitialize         |

    [TestInitialize]
    public void TestInitialize() {
        // Save and clear original trace listeners, add custom unit test trace listener.
        _traceListener = new UnitTestTraceListener();
        _originalTraceListeners = Trace.Listeners;
        Trace.Listeners.Clear();
        Trace.Listeners.Add(_traceListener);

        // ... Further test setup
    }

    #endregion
    #region TestCleanup            |

    [TestCleanup]
    public void TestCleanup() {
        Trace.Listeners.Clear();
        Trace.Listeners.AddRange(_originalTraceListeners);
    }

    #endregion

    [TestMethod]
    public void TheTestItself() {
        // Arrange
        // ...

        // Act
        // ...
        Debug.Assert(false, "Assert failed");

    // Assert

#if DEBUG        
    // NOTE This syntax comes with using the FluentAssertions NuGet package.
    _traceListener.GetWriteLines().Should().HaveCount(1).And.Contain("Fail: Assert failed");
#endif

    }
} 
```

UnitTestTraceListener 类如下所示：

```
[ExcludeFromCodeCoverage]
public class UnitTestTraceListener : TraceListener
{
    private readonly List<string> _writes = new List<string>();
    private readonly List<string> _writeLines = new List<string>();

    // Override methods
    public override void Write(string message)
    {
        _writes.Add(message);
    }

    public override void WriteLine(string message)
    {
        _writeLines.Add(message);
    }

    // Public methods
    public IEnumerable<string> GetWrites()
    {
        return _writes.AsReadOnly();
    }

    public IEnumerable<string> GetWriteLines()
    {
        return _writeLines.AsReadOnly();
    }

    public void Clear()
    {
        _writes.Clear();
        _writeLines.Clear();
    }
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-01-09T00:17:32.600

> 大量使用单元测试是否会阻止使用调试断言？

不，相反。单元测试通过在运行您编写的白盒测试时仔细检查内部状态，使 Debug 断言更有价值。在单元测试期间启用 Debug.Assert 是必不可少的，因为您很少发布启用 DEBUG 的代码（除非性能根本不重要）。运行 DEBUG 代码的唯一两次是当您 1) 进行您真正做的那一点点集成测试，抛开所有的好意，以及 2) 运行单元测试。

使用 Debug.Assert 测试来检测代码很容易，以便在编写代码时检查不变量。这些检查在单元测试运行时用作健全性检查。

Assert 所做的另一件事是准确地指出代码中出现问题的第一个点。*当您的单元测试确实*发现问题时，这可以大大减少调试时间。

这增加了单元测试的价值。

> 似乎在被测代码中触发的调试断言意味着单元测试不应该存在或调试断言不应该存在。

举个例子。这个问题是关于发生的真实事情。正确的？因此，您需要在代码中进行调试断言，并且需要在单元测试期间触发它们。在单元测试期间可能触发调试断言的可能性清楚地表明在单元测试期间应该启用调试断言。

断言触发意味着您的测试错误地使用了您的内部代码（并且应该修复），或者某些被测代码错误地调用了其他内部代码，或者某个基本假设是错误的。你不写测试是因为你认为你的假设是错误的，你……实际上，你这样做了。您编写测试是因为至少您的某些假设可能是错误的。在这种情况下，冗余是可以的。

> “只能有一个”似乎是一个合理的原则。这是常见的做法吗？还是在单元测试时禁用调试断言，以便它们可以用于集成测试？

冗余只会伤害单元测试的运行时间。如果你*真的*有 100% 的覆盖率，那么运行时可能是个问题。否则，不，我强烈不同意。在测试过程中自动检查你的假设并没有错。这实际上就是“测试”的定义。

> 这里还有一个例子，我相信它显示了困境：单元测试通过了一个受保护函数的无效输入，断言它的输入是有效的。单元测试不应该存在吗？这不是公共功能。也许检查输入会杀死性能？或者断言不应该存在？该功能受到保护而不是私有的，因此它应该检查它的输入以确保安全。

通常，单元测试框架的目的不是在违反不变假设时测试代码的行为。换句话说，如果您编写的文档说“如果您将 null 作为参数传递，则结果未定义”，您无需验证结果确实是不可预测的。如果明确定义了失败结果，则它们不是未定义的，并且 1) 它不应该是 Debug.Assert，2) 您应该准确定义结果是什么，以及 3) 测试该结果。如果您需要对内部调试断言的质量进行单元测试，那么 1) 应该检查 Andrew Grant 使断言框架成为可测试资产的方法，并且 2) 哇，您的测试覆盖率真棒！而且我认为这在很大程度上是基于项目要求的个人决定。

换句话说：Debug.Assert() 大大增加了单元测试的价值，冗余是一个特性。

# oop - 多态性 - 仅用两句话定义

> ID：409969
> 
> 赞同：88
> 
> 时间：2009-01-03T22:06:40.310
> 
> 标签：oop, polymorphism, terminology

我看过其他定义和解释，但没有一个能让我满意。我想看看是否有人可以在不使用任何代码或示例的情况下最多用两句话定义多态性。我不想听到“所以你有一个人/汽车/开罐器......”或者这个词是如何派生的（没有人对你知道 poly 和 morph 的含义印象深刻）。如果您非常了解什么是多态性并且对英语有很好的掌握，那么您应该能够用简短但密集的定义来回答这个问题。如果您的定义准确地定义了多态性，但过于密集以至于需要进行几次阅读，那么这正是我正在寻找的。

为什么只有两句话？因为定义简短而明智。解释很长，包含示例和代码。在此处查找解释（这些页面上的答案对我的问题不满意）：

[多态性 vs 覆盖 vs 重载](https://stackoverflow.com/questions/154577/polymorphism-vs-overriding-vs-overloading)
[尝试尽可能简单地描述多态性](https://stackoverflow.com/questions/210460/try-to-describe-polymorphism-as-easy-as-you-can)

我为什么要问这个问题？因为我被问到同样的问题，我发现我无法给出一个令人满意的定义（按照我的标准，这是相当高的）。我想看看这个网站上是否有任何伟大的头脑可以做到这一点。

如果你真的不能做到两句话的要求（这是一个很难定义的主题），那么你再过去就可以了。这个想法是有一个定义，它实际上定义了多态性是什么，而不是解释它的作用或如何使用它（得到区别？）。

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2009-01-03T22:13:04.027

多态性允许表达某种契约，可能有许多类型以不同的方式实现该契约（无论是否通过类继承），每种方式都根据自己的目的。*使用*该合约的代码不应该（*）关心涉及哪个实现，只需要遵守合约即可。

(*) 无论如何，在理想情况下——显然调用代码经常非常慎重地选择适当的实现！

* * *

## 回答 #2

> 赞同：74
> 
> 时间：2009-01-03T22:10:29.070

一般来说，水果是可以吃的，但不同种类的水果吃法不同。一个苹果，它是一种水果，可以吃（因为它是一种水果）。香蕉也可以吃（因为它也是一种水果），但方式与苹果不同。你先剥皮。

好吧，至少我知道，但我在某些方面很奇怪，所以我知道什么。

这说明了继承（水果可以吃）、多态性（吃水果的东西可以吃所有类型的水果）和封装（香蕉有皮）。

说真的，对象继承、多态、封装、虚拟事物、抽象事物、私有事物、公共事物，这些都是硬概念。如果有人绝对想要对此有 2 个句子的定义，那么请将该问题标记为代码高尔夫变体，因为两个这样的句子必须非常简洁，除非您知道它已经是什么，否则您将不会学到足够的知识它知道您需要了解更多信息。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2009-01-03T22:12:37.880

多态性声明了一个不识别类型的统一接口，将实现细节留给实现该接口的具体类型。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-01-03T22:12:47.787

Wikipedia：多态性是一种编程语言功能，允许使用统一接口处理不同数据类型的值。对我来说很简单。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2009-01-03T22:53:30.810

实际上，多态的形式有很多种，也有不少争议。您甚至可能会看到无法正确定义它的 CS 教授。我知道三种类型：

*   ad-hoc 多态性（看起来像鸭子，走路像鸭子 => 是鸭子）。例如，可以在 Haskell 和 Python 中看到。

*   泛型多态性（其中类型是某个泛型类型的实例）。例如可以在 C++ 中看到（int 的向量和字符串的向量都具有成员函数大小）。

*   子类型多态性（一种类型继承自另一种类型）。在大多数 OO 编程语言中都可以看到（即三角形是一个形状）。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2009-07-05T21:41:03.310

我真的明白，你为什么要问这个问题。我了解多态性，但我在面试时被要求对多态性给出简短而清晰的定义。因为我无法给出清晰而简短的定义，所以我开始考虑它，这是我的定义：

**一种类型的对象具有一个相同的接口，但该接口的实现不同的能力。**

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2009-04-07T06:54:36.457

**定义**：

多态性是一个 1 美元想法的 10 美元词——当我要求做某事时，只要最终结果合适，我不在乎它是如何实现的。只要*服务*提供正确，我*不*关心*实施*。

*讨论*

虽然它通常用于软件开发，特别是在遵循面向对象原则开发的系统中，但多态性从根本上说是现实世界的原则，应该用现实世界的术语而不是技术术语来定义。

*例子*

当我想打电话时，我拿起电话，拨一个号码并与另一端的一方通话。我不关心电话是谁制造的，它使用什么技术，是有线、无线、移动还是 VOIP，或者它是否在保修期内。

当我想打印文档时，我会打印它。我不关心实现语言、打印机品牌、连接方式、耗材选择或纸张质量。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-11-14T17:17:57.663

同一接口的多个实现。

示例：许多型号的电话都实现了数字键盘接口。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-01-03T22:11:08.447

多态是设计对象模型时使用的面向对象的策略，以帮助简化代码。多态性的核心是定义两个相似但不同的对象，然后将这两个对象视为相同的能力。

好吧，这很难……

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2014-01-14T11:29:46.577

我只是想添加我自己对多态性的解释：非常一般地，多态性是为*不同类型*的实体提供*单个接口*的行为。

 *这是相当通用的，但这是我能想到的唯一方法来包装我所知道的所有三种类型的多态性：*ad hoc*、*parametric*和*subtype*。我将在下面详细介绍，并按名称按字母顺序对多态类型进行排序。您感兴趣的最有可能是*subtype polymorphism*，这是最后一个。

## 特设多态性

*Ad hoc 多态性*是为不同的参数类型提供同一方法的多个实现的行为。在[OOP](http://en.wikipedia.org/wiki/Object-oriented_programming)中，它通常被称为*方法重载*。例如：

```
public String format(int a) {
    return String.format("%2d", a);
}

public String format(Date a) {
    return new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss'Z'").format(a);
} 
```

这两种`format`方法共享一个*接口，但它们适用于**不同类型*的实体。

## 参数多态性

*参数多态性*是使类（或方法）在本身是类（或方法）参数的类型上工作的行为。它通常被称为*泛型*。

例如，Java在实例化时`List[T]`需要一个参数`T`，这个参数定义了结果对象的类型。

纯粹主义者请注意，我故意忽略*原始类型*，因为我觉得在这种情况下它们只会使水变得浑浊。

`List[String]`并`List[Date]`共享一个*界面*，但使用（并且是）*不同的类型*。

## 亚型多态性

*子类型多态性*可能是您最初在问题中的意思：它是为同一类型的多个实现提供单个接口的行为。

使用习惯示例：`Animal`提供所有实现都必须遵守的契约。`Dog`是一个`Animal`，因此支持所有`Animal`声明的操作。根据[Liskov 替换原则](https://en.wikipedia.org/wiki/Liskov_substitution_principle)，这允许您使用期望`Dog`的实例的实例（但不能反过来）。`Animal`

如果`Cat`和`Dog`都是 的子类`Animal`，那么它们共享一个*接口*，但实际上是*不同的类型*。

我在这里有点切题，但是（我认为）子类型多态是唯一允许*覆盖*的：重新定义由父类定义的方法的行为的行为。这经常与*重载*相混淆，正如我们之前所见，重载是一种多态性，实际上不需要子类化（实际上也不需要类）。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2009-01-07T15:11:55.153

多态性 == 多个类 + 相同的方法签名 + 特定于类的行为。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2014-10-21T00:03:14.227

似乎这里提供了最好的定义，所以让我加[两分钱](https://en.wiktionary.org/wiki/two_cents#Noun)，只是为了其他观察者。我希望它可以帮助更多。

## 多态性有两种：

```
1\. Compile-time (static) polymorphism or (ad hoc) polymorphism. 
```

*那就是方法重载和运算符重载*

```
2\.  Run time or (dynamic) polymorphism. 
```

***第一个术语***继承自 Java 和 C++ 术语。

但在**.NET**术语中，只有**第二个**（*我的意思是**运行时多态性***）真正被认为是多态性并简称为***多态性***。

据我所知，有三种方法可以实现（*运行时*）**多态性**。

```
 1\. Parametric polymorphism or simply the use of generics (templates in C++).

 2\. Inheritance-based polymorphism or subtyping.

 3\. Interface-based polymorphism. 
```

**基于接口的多态性的一个简单示例：**

```
interface Imobile
{
    void Move();
}

class Person :Imobile
{
    public void Move() { Console.WriteLine("I am a person and am moving in my way."); }
}

class Bird :Imobile
{
    public void Move() { Console.WriteLine("I am a bird and am moving in my way."); }
}

class Car :Imobile
{
    public void Move() { Console.WriteLine("I am a car and am moving in my way."); }
}

class Program
{

    static void Main(string[] args)
    {
        // Preparing a list of objects
        List<Imobile> mobileList = new List<Imobile>();

        mobileList.Add(new Person());
        mobileList.Add(new Bird());
        mobileList.Add(new Car());

        foreach (Imobile mobile in mobileList)
        {
            mobile.Move();
        }

        // Keep the console open
        Console.WriteLine("Press any key to exit the program:");
        Console.ReadKey();
    }
} 
```

* * *

## 输出：

```
 I am a person and am moving in my way.
 I am a bird and am moving in my way.
 I am a car and am moving in my way.
 Press any key to exit the program: 
```

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2009-01-03T23:50:39.960

多态性是一种软件编码抽象，其中几个不同的底层实体（通常是数据，但总是不存在）都共享一个公共接口，允许它们在运行时看起来和行为相同。我们将其用作一种开发技术，以在大量相似但不相同的实例上强制执行一致的行为，并实现绝对最小化，从而减少对错误和不一致的预期。

保罗。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-01-03T22:44:35.570

单个对象的多种形式称为多态。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-01-04T22:12:48.317

**多态性**

不同的对象可以以不同的方式响应同一消息，使对象能够在不知道其确切类型的情况下相互交互。

通过： [http ://www.agiledata.org/essays/objectOrientation101.html](http://www.agiledata.org/essays/objectOrientation101.html)

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2012-03-07T20:02:43.307

多态性是对象在同一调用中出现和表现不同的能力。例如：每只动物的外观和声音都不同（当你击中它时:)）

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2013-01-07T09:16:44.777

多态性是编程语言的一个特性，它允许将对象视为其超类型的实例。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-01-03T22:39:05.440

为不同类型上的一组类似操作赋予一个名称。如果做得好，类比是显而易见的，例如通过算术“添加”数字和通过连接（将它们的长度相加）“添加”字符串。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2010-01-08T14:19:50.110

这是我一直遵循的定义：

如果两个对象以相同的语义响应相同的消息，则它们之间是多态的（相对于特定协议）。

多态性是关于消息的，是关于能够以相同的语义响应同一组消息。

如果两个对象可以响应空？但是消息的语义不同，那么..它们不是多态的。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2010-01-08T14:33:24.510

较低级别的多态性是从接口实例调用接口实现者定义的方法的能力。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2010-01-08T15:45:35.737

多态性是一种编程特性，它允许对象具有多种类型（“形状”），并允许您根据需要执行的操作将其视为任何类型，而无需了解或关心它的其他类型。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2011-06-16T06:14:25.330

**多态性是一种语言功能，允许高级算法代码对多种类型的数据进行不变的操作。** 还有一句话，不管它是为了…… ;-P。

（C++ 支持的类型在我的回答中列出并进行了对比：[C++ 中的多态性](https://stackoverflow.com/questions/5854581/polymorphism-in-c/5854862#5854862)）

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-02-14T21:07:14.413

相同类型的实体（即实现相同的接口或从相同的类派生）以不同的方式（在相同的方法名称下）表现。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2013-03-03T03:22:05.937

多态性概念最近成为一种现象。这是实际的漂移。运行时定义应该由超类的引用调用哪个子方法。现在，在实践中意味着什么？它实际上没有任何意义。您可以在没有多态性的情况下简单地编写代码。所以为什么？因为，如果我们没有多态性，我们必须记住所有子类函数的定义。多态性在实践中使我们免于这种情况。

您可以按如下方式定义列表：

```
List list = new List(); 
```

但如果您检查`IList`，您可以从界面中受益：

```
IList list = new List(); 
```

`IList`并自由使用参考。假设`IList`也在另一个类中实现，您可以通过再次`IList`引用使用该未知类的方法，而无需尝试记住该类名。很奇妙，不是吗？

现在，更多有价值的信息来了：
Java 默认是多态的，而 .NET 和 C++ 不是，在 MS 中，您必须声明基本函数`virtual`（并且在 .NET`override`关键字中）。

此外，多态性中有两条积分规则。一种是继承（通过接口实现或通过类扩展），另一种是覆盖。没有覆盖，多态性就不存在。请注意，方法重载（始终在单个类中）也是一种“简约”多态性。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2013-03-11T10:55:12.410

我认为在不同的类中实现相同签名的方法（使用扩展或实现具有某种继承关系）是方法覆盖和多态性，因为通过这种方式我们实现了相同方法签名的多种形式。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2014-04-18T16:50:13.290

对于给定的方法签名，为不同的、分层相关的类运行不同的方法实现。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2014-09-16T19:53:21.650

多态性是使用不同的类以一种通用的方式实现一个公共接口（或扩展一个公共基类）的能力，而不需要现在具体的实现，并且只使用公共接口中可用的方法。

即：在Java中，由于ArrayList和LinkedList都实现了List，如果你将一个变量声明为List，你总是可以执行List中允许的操作，无论你的变量是实例化为ArrayList还是LinkedList。

* * *

## 回答 #28

> 赞同：-2
> 
> 时间：2010-01-17T05:48:10.617

我想有时对象是动态调用的。您不确定对象是否是经典形状多边形中的三角形、正方形等。例子。

因此，为了抛开所有这些事情，我们只需调用派生类的函数并假设将调用动态类中的一个。

你不会在乎它是正方形、三角形还是矩形。你只关心这个地区。因此将根据传递的动态对象调用 getArea 方法。

* * *

## 回答 #29

> 赞同：-2
> 
> 时间：2015-08-21T16:51:55.763

多态性是函数自动适应接受不同数据类型的输入数据的能力。您可以“添加”两个双打“1.1”和“2.2”并获得“3.3”或“添加”两个字符串“Stack”和“Overflow”并获得“StackOverflow”。

* * *

## 回答 #30

> 赞同：-3
> 
> 时间：2013-05-02T09:48:26.557

多态性是指不同的对象以不同的方式响应相同的方法。例如，汽车在路上行驶，而人在路上行走。这是两个对象以不同的方式响应同一条道路。

* * *

## 回答 #31

> 赞同：-5
> 
> 时间：2009-04-07T06:20:03.903

执行不同方法的单个类称为多态性。

# sql - PostgreSQL 查询不一致

> ID：409991
> 
> 赞同：2
> 
> 时间：2009-01-03T22:22:09.857
> 
> 标签：sql, postgresql, rdbms, wikipedia

我正在尝试执行此 SQL 命令：

```
SELECT page.page_namespace, pagelinks.pl_namespace, COUNT(*) 
    FROM page, pagelinks
    WHERE 
        (page.page_namespace <=3 OR page.page_namespace = 12 
            OR page.page_namespace = 13
        ) 
        AND 
        (pagelinks.pl_namespace <=3 OR pagelinks.pl_namespace = 12 
            OR pagelinks.pl_namespace = 13
        )
        AND 
        (page.page_is_redirect = 0)
        AND 
        pagelinks.pl_from = page.page_id 
    GROUP BY (page.page_namespace, pagelinks.pl_namespace) 
; 
```

当我这样做时，我收到以下错误：

```
 ERROR:  could not identify an ordering operator for type record
    HINT:  Use an explicit ordering operator or modify the query.

    ********** Error **********

    ERROR: could not identify an ordering operator for type record
    SQL state: 42883
    Hint: Use an explicit ordering operator or modify the query. 
```

我尝试将：*ORDER BY (page.page_namespace, pagelinks.pl_namespace) ASC*添加到查询的末尾，但没有成功。

更新：

我也试过这个：

```
SELECT page.page_namespace, pagelinks.pl_namespace, COUNT(*) 
    FROM page, pagelinks
    WHERE pagelinks.pl_from = page.page_id 
    GROUP BY (page.page_namespace, pagelinks.pl_namespace) 
; 
```

但我仍然得到同样的错误。

谢谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-03T23:01:38.030

我没有检查任何文档，但你`GROUP BY`在括号中表达的事实对我来说看起来很不寻常。如果你不在这里使用括号会发生什么？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T22:46:59.637

我不是真正的专家，但我对该消息的理解是 PostgreSQL 抱怨无法处理`page.page_namespace <=3`或`pagelinks.pl_namespace <=3`. 要进行这样的比较，您需要定义一个顺序，并且这些字段之一可能不是标准的数字字段。或者整数与浮点可能存在一些问题——例如，如果“3.0 = 3”这个问题并不那么容易回答，因为 3.0 的浮点表示很可能不完全是 3。

一切都只是猜测，但我很确定这两个`<=`是你的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-03T22:51:51.797

好吧，我不知道您使用的架构 (*)，但错误消息似乎很清楚。您的一列是[RECORD](http://www.postgresql.org/docs/current/static/plpgsql-declarations.html)类型，并且没有操作符来订购 RECORD。但是您的查询的某些部分（例如 <=）需要这样的排序操作符。使用 ORDER BY 不太可能有帮助，因为问题的症结在于缺少操作员来订购......

(*) 根据您的其他问题，我假设您的架构是[http://download.wikimedia.org/enwiki/latest/enwiki-latest-page.sql.gz](http://download.wikimedia.org/enwiki/latest/enwiki-latest-page.sql.gz)中的维基百科页面转储对吗？

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2012-01-04T15:46:28.623

我有一些错误。但我找到了这个页面， [http://www.w3schools.com/sql/sql_groupby.asp](http://www.w3schools.com/sql/sql_groupby.asp) 这很容易，你必须不带括号进行分组，例如：

GROUP BY (page.page_namespace, pagelinks.pl_namespace) 正确的是GROUP BY page.page_namespace, pagelinks.pl_namespace

问候！！

# truncate - 在停止字符匹配处截断文本

> ID：409995
> 
> 赞同：1
> 
> 时间：2009-01-03T22:24:27.107
> 
> 标签：truncate

我将如何截断某个字符的句子：

$sentence = '堆栈溢出 - 在这里提问';

以便仅回显以下内容：

堆栈溢出

字符数不同，但停止点始终是“Space Dash Space”

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-03T23:11:24.253

如果使用 python 非正则表达式方法将是：

```
>>> s = 'Stack Overflow - Ask Questions Here'  
>>> s.split(' - ')  
['Stack Overflow', 'Ask Questions Here']  
>>> # To get the substring before the match  
>>> s.split(' - ')[0]  
'Stack Overflow' 
```

正则表达式方法可能是：

```
>>> import re
>>> re.split(' - ', s)[0]
'Stack Overflow' 
```

当然，您可以构建一个正则表达式以将整个字符串与您预期的标记匹配，并对第一部分进行分组，但鉴于这两种方法的工作量比必要的要多。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-03T22:45:46.520

`$variable`尽管您没有提到语言，但由于名称，我会猜测 Perl 。在 Perl 中，最简单的方法之一是使用简单的正则表达式：

```
$sentence = 'Stack Overflow - Ask Questions Here';

if ($sentence =~ /^(.*?) - /) {
  print "Found match: '$1'\n";
} 
```

这以非贪婪方式匹配字符串的第一部分，直到第一个空格-破折号-空格序列。表达式第一部分周围的括号表示应该“捕获”匹配部分，在 Perl 中它将存储在变量 $1 中（其他捕获的模式存储在 $2、$3 等中）。如果找到匹配项，则将匹配部分存储到 $1 中，然后打印。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-03T23:13:27.507

假设 Perl，试试这个：

```
$sentence1 = 'Stack Overflow - Ask Questions Here - And more here';
$sentence2 = 'Just Stack Overflow';

$sentence1 =~ /^(.*?)( - |$)/;
print $1, "\n";

$sentence1 =~ /^(?|(.*) - |(.*)$)/;
print $1, "\n";

$sentence2 =~ /^(.*?)( - |$)/;
print $1, "\n";

$sentence2 =~ /^(?|(.*) - |(.*)$)/;
print $1, "\n"; 
```

这些将匹配第一个或最后一个“ - ”，如果没有“ - ”，则匹配整个字符串

# php - 从 IP 地址获取位置

> ID：409999
> 
> 赞同：209
> 
> 时间：2009-01-03T22:27:01.597
> 
> 标签：php, geolocation, ip, geoip

我想从他们的 IP 地址中检索访问者的城市、州和国家等信息，以便我可以根据他们的位置自定义我的网页。在 PHP 中有没有好的可靠的方法来做到这一点？我使用 JavaScript 编写客户端脚本，使用 PHP 编写服务器端脚本，使用 MySQL 编写数据库。

* * *

## 回答 #1

> 赞同：266
> 
> 时间：2013-07-25T17:13:47.130

您可以下载免费的 GeoIP 数据库并在本地查找 IP 地址，或者您可以使用第三方服务并执行远程查找。这是更简单的选项，因为它不需要设置，但它确实会引入额外的延迟。

您可以使用的一项第三方服务是我的[http://ipinfo.io](http://ipinfo.io)。它们提供主机名、地理位置、网络所有者和其他信息，例如：

```
$ curl ipinfo.io/8.8.8.8
{
  "ip": "8.8.8.8",
  "hostname": "google-public-dns-a.google.com",
  "loc": "37.385999999999996,-122.0838",
  "org": "AS15169 Google Inc.",
  "city": "Mountain View",
  "region": "CA",
  "country": "US",
  "phone": 650
} 
```

这是一个 PHP 示例：

```
$ip = $_SERVER['REMOTE_ADDR'];
$details = json_decode(file_get_contents("http://ipinfo.io/{$ip}/json"));
echo $details->city; // -> "Mountain View" 
```

您也可以在客户端使用它。这是一个简单的 jQuery 示例：

```
$.get("https://ipinfo.io/json", function (response) {
    $("#ip").html("IP: " + response.ip);
    $("#address").html("Location: " + response.city + ", " + response.region);
    $("#details").html(JSON.stringify(response, null, 4));
}, "jsonp");
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<h3>Client side IP geolocation using <a href="http://ipinfo.io">ipinfo.io</a></h3>

<hr/>
<div id="ip"></div>
<div id="address"></div>
<hr/>Full response: <pre id="details"></pre>
```

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2013-05-16T14:05:43.833

以为我会发布，因为似乎没有人提供有关此特定 API 的信息，但它返回的正是我所追求的，你可以让它以多种格式返回，`json, xml and csv`.

```
 $location = file_get_contents('http://freegeoip.net/json/'.$_SERVER['REMOTE_ADDR']);
 print_r($location); 
```

这将为您提供您可能想要的所有东西：

```
{
      "ip": "77.99.179.98",
      "country_code": "GB",
      "country_name": "United Kingdom",
      "region_code": "H9",
      "region_name": "London, City of",
      "city": "London",
      "zipcode": "",
      "latitude": 51.5142,
      "longitude": -0.0931,
      "metro_code": "",
      "areacode": ""

} 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2016-10-13T13:29:38.450

一个纯 Javascript 示例，使用[https://geolocation-db.com](https://geolocation-db.com)的服务，它们提供 JSON 和 JSONP 回调解决方案。

*   JSON：[https ://geolocation-db.com/json](https://geolocation-db.com/json)
*   JSONP 回调：[https ://geolocation-db.com/jsonp](https://geolocation-db.com/jsonp)

不需要 jQuery！

```
<!DOCTYPE html>
<html>
<head>
<title>Geo City Locator by geolocation-db.com</title>
</head>
<body>
    <div>Country: <span id="country"></span></div>
    <div>State: <span id="state"></span></div>
    <div>City: <span id="city"></span></div>
    <div>Postal: <span id="postal"></span></div>
    <div>Latitude: <span id="latitude"></span></div>
    <div>Longitude: <span id="longitude"></span></div>
    <div>IP address: <span id="ipv4"></span></div>                             
</body>
<script>

    var country = document.getElementById('country');
    var state = document.getElementById('state');
    var city = document.getElementById('city');
    var postal = document.getElementById('postal');
    var latitude = document.getElementById('latitude');
    var longitude = document.getElementById('longitude');
    var ip = document.getElementById('ipv4');

    function callback(data)
    {
        country.innerHTML = data.country_name;
        state.innerHTML = data.state;
        city.innerHTML = data.city;
        postal.innerHTML = data.postal;
        latitude.innerHTML = data.latitude;
        longitude.innerHTML = data.longitude;
        ip.innerHTML = data.IPv4;
    }

    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.src = 'https://geoilocation-db.com/json/geoip.php?jsonp=callback';
    var h = document.getElementsByTagName('script')[0];
    h.parentNode.insertBefore(script, h);

</script> 
</html> 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2012-08-23T18:20:38.227

使用谷歌 APIS：

```
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script>
contry_code = google.loader.ClientLocation.address.country_code
city = google.loader.ClientLocation.address.city
region = google.loader.ClientLocation.address.region
</script> 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-01-03T22:33:54.997

您需要使用外部服务...例如[http://www.hostip.info/](http://www.hostip.info/)如果您在 Google 上搜索“geo-ip”，您可以获得更多结果。

Host-IP API 基于 HTTP，因此您可以根据需要在 PHP 或 JavaScript 中使用它。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2016-05-22T13:55:32.917

我使用来自[ipapi.co](https://ipapi.co/)的 API 编写了一个机器人，以下是获取 IP 地址（例如`1.2.3.4`）位置的方法`php`：

设置标题：

```
$opts = array('http'=>array('method'=>"GET", 'header'=>"User-Agent: mybot.v0.7.1"));
$context = stream_context_create($opts); 
```

获取 JSON 响应

```
echo file_get_contents('https://ipapi.co/1.2.3.4/json/', false, $context); 
```

获取特定字段（国家、时区等）

```
echo file_get_contents('https://ipapi.co/1.2.3.4/country/', false, $context); 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2016-09-14T14:38:24.937

这个问题是受保护的，我理解。但是，我在这里没有看到答案，我看到的是很多人展示了他们从同样的问题中得出的结论。

目前有五个具有不同程度功能的区域互联网注册管理机构作为知识产权所有权方面的第一联络点。这个过程是不断变化的，这就是为什么这里的各种服务有时工作而有时不工作的原因。

然而，Who Is（显然）是一个古老的 TCP 协议——它最初的工作方式是连接到端口 43，这使得通过租用连接、防火墙等进行路由变得有问题。

目前——大部分 Who Is 是通过 RESTful HTTP 和 ARIN、RIPE 和 APNIC 完成的 RESTful 服务。LACNIC 返回 503 而 AfriNIC 显然没有这样的 API。（不过，它们都有在线服务。）

这会给你——IP 的注册所有者的地址，但——不是你客户的位置——你必须从他们那里得到它，而且——你必须要求它。此外，在验证您认为是发起者的 IP 时，代理是您最不必担心的问题。

人们不喜欢他们被跟踪的想法，所以——我的想法是——直接从你的客户那里得到他们的许可，并期待很多人对这个想法犹豫不决。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2014-11-12T17:46:35.317

Ben Dowling 响应中的服务已更改，因此现在更简单了。要查找位置，只需执行以下操作：

```
// no need to pass ip any longer; ipinfo grabs the ip of the person requesting
$details = json_decode(file_get_contents("http://ipinfo.io/"));
echo $details->city; // city 
```

坐标以单个字符串形式返回，例如 '31,-80'，因此您只需：

```
$coordinates = explode(",", $details->loc); // -> '31,-89' becomes'31','-80'
echo $coordinates[0]; // latitude
echo $coordinates[1]; // longitude 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-01-03T22:38:30.823

查看 hostip.info 中的 API - 它提供了大量信息。
PHP 中的示例：

```
$data = file_get_contents("http://api.hostip.info/country.php?ip=12.215.42.19");
//$data contains: "US"

$data = file_get_contents("http://api.hostip.info/?ip=12.215.42.19");
//$data contains: XML with country, lat, long, city, etc... 
```

如果您信任 hostip.info，它似乎是一个非常有用的 API。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2009-01-03T22:57:58.443

我喜欢 Maxmind 的免费[G​​eoLite City](http://www.maxmind.com/app/geolitecity)，它适用于大多数应用程序，如果不够精确，您可以从中升级到付费版本。包括一个[PHP API](http://www.maxmind.com/app/api)，以及其他语言。如果您将 Lighttpd 作为网络服务器运行，您甚至可以使用一个[模块](http://redmine.lighttpd.net/wiki/1/Docs:ModGeoip)来获取每个访问者的 SERVER 变量中的信息（如果这是您需要的话）。

我应该补充一下，还有一个免费的[Geolite Country](http://www.maxmind.com/app/geolitecountry)（如果您不需要查明 IP 来自的城市会更快）和 Geolite ASN（如果您想知道谁拥有 IP），最后所有这些都是可在您自己的服务器上下载，每月更新一次，并且使用提供的 API 可以快速查找，因为它们声明“每秒可进行数千次查找”。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2017-11-15T01:00:02.553

我在[IPLocate.io](https://www.iplocate.io)运行该服务，您可以通过一个简单的电话免费连接：

```
<?php
$res = file_get_contents('https://www.iplocate.io/api/lookup/8.8.8.8');
$res = json_decode($res);

echo $res->country; // United States
echo $res->continent; // North America
echo $res->latitude; // 37.751
echo $res->longitude; // -97.822

var_dump($res); 
```

该`$res`对象将包含您的地理位置字段，如`country`,`city`等。

查看[文档](https://iplocate.docs.apiary.io)以获取更多信息。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2009-01-03T22:39:12.787

假设您想自己做而不依赖其他提供商，[IP2Nation](http://www.ip2nation.com/)提供了一个映射的 MySQL 数据库，该数据库会随着区域注册机构的变化而更新。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2011-12-12T21:51:07.780

PHP 对此有一个[扩展。](http://www.php.net/manual/en/intro.geoip.php)

来自 PHP.net：

> GeoIP 扩展允许您查找 IP 地址的位置。城市、州、国家、经度、纬度和其他信息，如 ISP 和连接类型都可以在 GeoIP 的帮助下获得。

例如：

```
$record = geoip_record_by_name($ip);
echo $record['city']; 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2017-09-04T20:24:43.073

[Ipdata.co](https://ipdata.co?utm_campaign=stackoverflow-answer-409999&utm_medium=answer&utm_source=stackoverflow)是一个快速、高度可用的 IP 地理定位 API，具有可靠的性能。

它具有极强的可扩展性，全球有 10 个端点，每个端点每秒能够处理超过 10,000 个请求！

> 此答案使用非常有限的“测试”API 密钥，仅用于测试几个调用。[注册](https://ipdata.co?utm_campaign=stackoverflow-answer-409999-free-plan-cta&utm_medium=answer&utm_source=stackoverflow)您自己的免费 API 密钥并每天收到多达 1500 个开发请求。

在php中

```
php > $ip = '8.8.8.8';
php > $details = json_decode(file_get_contents("https://api.ipdata.co/{$ip}?api-key=test"));
php > echo $details->region;
California
php > echo $details->city;
Mountain View
php > echo $details->country_name;
United States
php > echo $details->latitude;
37.751 
```

这是一个客户端示例，展示了如何获取国家、地区和城市；

```
$.get("https://api.ipdata.co?api-key=test", function (response) {
	$("#response").html(JSON.stringify(response, null, 4));
  $("#country").html('Country: ' + response.country_name);
  $("#region").html('Region ' + response.region);
  $("#city").html('City' + response.city);  
}, "jsonp");
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<div id="country"></div>
<div id="region"></div>
<div id="city"></div>
<pre id="response"></pre>
```

**免责声明；**

我建立了服务。

有关多种语言的示例，请参阅[文档](https://ipdata.co/docs.html?utm_campaign=stackoverflow-answer-409999-docs-cta&utm_medium=answer&utm_source=stackoverflow)

另请参阅对最佳 IP 地理定位 API[的](https://medium.com/@ipdata_co/what-is-the-best-commercial-ip-geolocation-api-d8195cda7027)详细分析。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2017-01-06T02:39:57.817

万一有人偶然发现了这个线程，这里有另一个解决方案。在[timezoneapi.io](https://timezoneapi.io)，您可以请求一个 IP 地址并获得几个对象作为回报（我已经创建了该服务）。创建它是因为我需要知道我的用户在哪个时区、世界上的哪个地方以及现在是什么时间。

在 PHP 中 - 返回位置、时区和日期/时间：

```
// Get IP address
$ip_address = getenv('HTTP_CLIENT_IP') ?: getenv('HTTP_X_FORWARDED_FOR') ?: getenv('HTTP_X_FORWARDED') ?: getenv('HTTP_FORWARDED_FOR') ?: getenv('HTTP_FORWARDED') ?: getenv('REMOTE_ADDR');

// Get JSON object
$jsondata = file_get_contents("http://timezoneapi.io/api/ip/?" . $ip_address);

// Decode
$data = json_decode($jsondata, true);

// Request OK?
if($data['meta']['code'] == '200'){

    // Example: Get the city parameter
    echo "City: " . $data['data']['city'] . "<br>";

    // Example: Get the users time
    echo "Time: " . $data['data']['datetime']['date_time_txt'] . "<br>";

} 
```

使用 jQuery：

```
// Get JSON object
$.getJSON('https://timezoneapi.io/api/ip', function(data){

    // Request OK?
    if(data.meta.code == '200'){

        // Log
        console.log(data);

        // Example: Get the city parameter
        var city = data.data.city;
        alert(city);

        // Example: Get the users time
        var time = data.data.datetime.date_time_txt;
        alert(time);

    }

}); 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2017-07-29T13:34:17.493

如果您需要从 IP 地址获取位置，您可以使用可靠的地理 ip 服务，您可以[在此处](https://ip-api.io/)获取更多详细信息。它支持 IPv6。

作为奖励，它允许检查 ip 地址是否是 tor 节点、公共代理或垃圾邮件发送者。

您可以使用 javascript 或 php，如下所示。

Javascript代码：

```
$(document).ready(function () {
        $('#btnGetIpDetail').click(function () {
            if ($('#txtIP').val() == '') {
                alert('IP address is reqired');
                return false;
            }
            $.getJSON("http://ip-api.io/json/" + $('#txtIP').val(),
                 function (result) {
                     alert('City Name: ' + result.city)
                     console.log(result);
                 });
        });
    }); 
```

php代码：

```
$result = json_decode(file_get_contents('http://ip-api.io/json/64.30.228.118'));
var_dump($result); 
```

输出：

```
{
"ip": "64.30.228.118",
"country_code": "US",
"country_name": "United States",
"region_code": "FL",
"region_name": "Florida",
"city": "Fort Lauderdale",
"zip_code": "33309",
"time_zone": "America/New_York",
"latitude": 26.1882,
"longitude": -80.1711,
"metro_code": 528,
"suspicious_factors": {
"is_proxy": false,
"is_tor_node": false,
"is_spam": false,
"is_suspicious": false
} 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2013-08-29T13:42:27.587

以下是我发现的一个片段的修改版本，它使用[http://ipinfodb.com/ip_locator.php](http://ipinfodb.com/ip_locator.php)来获取其信息。请记住，您也可以向他们申请 API 密钥并直接使用 API 来获取您认为合适的信息。

## 片段

```
function detect_location($ip=NULL, $asArray=FALSE) {
    if (empty($ip)) {
        if (!empty($_SERVER['HTTP_CLIENT_IP'])) { $ip = $_SERVER['HTTP_CLIENT_IP']; }
        elseif (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) { $ip = $_SERVER['HTTP_X_FORWARDED_FOR']; }
        else { $ip = $_SERVER['REMOTE_ADDR']; }
    }
    elseif (!is_string($ip) || strlen($ip) < 1 || $ip == '127.0.0.1' || $ip == 'localhost') {
        $ip = '8.8.8.8';
    }

    $url = 'http://ipinfodb.com/ip_locator.php?ip=' . urlencode($ip);
    $i = 0; $content; $curl_info;

    while (empty($content) && $i < 5) {
        $ch = curl_init();
        $curl_opt = array(
            CURLOPT_FOLLOWLOCATION => 1,
            CURLOPT_HEADER => 0,
            CURLOPT_RETURNTRANSFER  => 1,
            CURLOPT_URL => $url,
            CURLOPT_TIMEOUT => 1,
            CURLOPT_REFERER => 'http://' . $_SERVER['HTTP_HOST'],
        );
        if (isset($_SERVER['HTTP_USER_AGENT'])) $curl_opt[CURLOPT_USERAGENT] = $_SERVER['HTTP_USER_AGENT'];
        curl_setopt_array($ch, $curl_opt);
        $content = curl_exec($ch);
        if (!is_null($curl_info)) $curl_info = curl_getinfo($ch);
        curl_close($ch);
    }

    $araResp = array();
    if (preg_match('{<li>City : ([^<]*)</li>}i', $content, $regs)) $araResp['city'] = trim($regs[1]);
    if (preg_match('{<li>State/Province : ([^<]*)</li>}i', $content, $regs)) $araResp['state'] = trim($regs[1]);
    if (preg_match('{<li>Country : ([^<]*)}i', $content, $regs)) $araResp['country'] = trim($regs[1]);
    if (preg_match('{<li>Zip or postal code : ([^<]*)</li>}i', $content, $regs)) $araResp['zip'] = trim($regs[1]);
    if (preg_match('{<li>Latitude : ([^<]*)</li>}i', $content, $regs)) $araResp['latitude'] = trim($regs[1]);
    if (preg_match('{<li>Longitude : ([^<]*)</li>}i', $content, $regs)) $araResp['longitude'] = trim($regs[1]);
    if (preg_match('{<li>Timezone : ([^<]*)</li>}i', $content, $regs)) $araResp['timezone'] = trim($regs[1]);
    if (preg_match('{<li>Hostname : ([^<]*)</li>}i', $content, $regs)) $araResp['hostname'] = trim($regs[1]);

    $strResp = ($araResp['city'] != '' && $araResp['state'] != '') ? ($araResp['city'] . ', ' . $araResp['state']) : 'UNKNOWN';

    return $asArray ? $araResp : $strResp;
} 
```

## 使用

```
detect_location();
//  returns "CITY, STATE" based on user IP

detect_location('xxx.xxx.xxx.xxx');
//  returns "CITY, STATE" based on IP you provide

detect_location(NULL, TRUE);    //   based on user IP
//  returns array(8) { ["city"] => "CITY", ["state"] => "STATE", ["country"] => "US", ["zip"] => "xxxxx", ["latitude"] => "xx.xxxxxx", ["longitude"] => "-xx.xxxxxx", ["timezone"] => "-07:00", ["hostname"] => "xx-xx-xx-xx.host.name.net" }

detect_location('xxx.xxx.xxx.xxx', TRUE);   //   based on IP you provide
//  returns array(8) { ["city"] => "CITY", ["state"] => "STATE", ["country"] => "US", ["zip"] => "xxxxx", ["latitude"] => "xx.xxxxxx", ["longitude"] => "-xx.xxxxxx", ["timezone"] => "-07:00", ["hostname"] => "xx-xx-xx-xx.host.name.net" } 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2013-12-23T15:55:33.163

您还可以使用“智能 IP”服务：

```
$.getJSON("http://smart-ip.net/geoip-json?callback=?",
    function (data) {
        alert(data.countryName);
        alert(data.city);
    }
); 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2015-09-04T08:44:09.373

我已经对 IP 地址服务进行了大量测试，这里有一些我自己做的方法。首先是我使用的一些有用网站的链接：

[https://db-ip.com/db](https://db-ip.com/db) 有免费的 ip-lookup 服务，还有一些免费的 csv 文件可以下载。这使用附加到您的电子邮件的免费 api 密钥。它限制在每天 2000 个查询。

[http://ipinfo.io/](http://ipinfo.io/) 没有 api-key PHP 功能的免费 ip-lookup 服务：

```
//uses http://ipinfo.io/.
function ip_visitor_country($ip){
    $ip_data_in = get_web_page("http://ipinfo.io/".$ip."/json"); //add the ip to the url and retrieve the json data
    $ip_data = json_decode($ip_data_in['content'],true); //json_decode it for php use

    //this ip-lookup service returns 404 if the ip is invalid/not found so return false if this is the case.
    if(empty($ip_data) || $ip_data_in['httpcode'] == 404){
        return false;
    }else{
        return $ip_data; 
    }
}

function get_web_page($url){
    $user_agent = 'Mozilla/5.0 (Windows NT 6.1; rv:8.0) Gecko/20100101 Firefox/8.0';

    $options = array(
        CURLOPT_CUSTOMREQUEST  =>"GET",        //set request type post or get
        CURLOPT_POST           =>false,        //set to GET
        CURLOPT_USERAGENT      => $user_agent, //set user agent
        CURLOPT_RETURNTRANSFER => true,     // return web page
        CURLOPT_HEADER         => false,    // don't return headers
        CURLOPT_FOLLOWLOCATION => true,     // follow redirects
        CURLOPT_ENCODING       => "",       // handle all encodings
        CURLOPT_AUTOREFERER    => true,     // set referer on redirect
        CURLOPT_CONNECTTIMEOUT => 120,      // timeout on connect
        CURLOPT_TIMEOUT        => 120,      // timeout on response
        CURLOPT_MAXREDIRS      => 10,       // stop after 10 redirects
    );
    $ch = curl_init( $url );
    curl_setopt_array( $ch, $options );
    $content = curl_exec( $ch );
    $err     = curl_errno( $ch );
    $errmsg  = curl_error( $ch );
    $header  = curl_getinfo( $ch );
    $httpCode = curl_getinfo( $ch, CURLINFO_HTTP_CODE );
    curl_close( $ch );  
    $header['errno']   = $err; //curl error code
    $header['errmsg']  = $errmsg; //curl error message
    $header['content'] = $content; //the webpage result (In this case the ip data in json array form)
    $header['httpcode'] = $httpCode; //the webpage response code
    return $header; //return the collected data and response codes
} 
```

最后你会得到这样的东西：

```
Array
(
    [ip] => 1.1.1.1
    [hostname] => No Hostname
    [city] => 
    [country] => AU
    [loc] => -27.0000,133.0000
    [org] => AS15169 Google Inc.
) 
```

* * *

[http://www.geoplugin.com/](http://www.geoplugin.com/) 稍旧，但这项服务为您提供了许多额外有用的信息，例如国家/地区以外的货币、大陆代码、经度等。

* * *

[http://lite.ip2location.com/database-ip-country-region-city-latitude-longitude](http://lite.ip2location.com/database-ip-country-region-city-latitude-longitude) 提供了一堆可下载的文件，其中包含将它们导入数据库的说明。一旦您在数据库中拥有这些文件之一，您就可以相当轻松地选择数据。

```
SELECT * FROM `ip2location_db5` WHERE IP > ip_from AND IP < ip_to 
```

使用 php 函数 ip2long(); 将 IP 地址转换为数值。例如 1.1.1.1 变为 16843009。这使您可以扫描数据库文件给您的 ip 范围。

所以为了找出 1.1.1.1 属于哪里，我们要做的就是运行这个查询：

```
SELECT * FROM `ip2location_db5` WHERE 16843009 > ip_from AND 16843009 < ip_to; 
```

这将返回此数据作为示例。

```
FROM: 16843008
TO: 16843263
Country code: AU
Country: Australia
Region: Queensland
City: Brisbane
Latitude: -27.46794
Longitude: 153.02809 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2019-07-09T09:25:09.160

执行 IP 地理定位有两种广泛的方法：一种是下载数据集，将其托管在您的基础架构上并保持最新状态。这需要时间和精力，尤其是当您需要支持大量请求时。另一种解决方案是使用现有的 API 服务来管理您的所有工作以及更多。

有很多 API Geolocation 服务：Maxmind、Ip2location、Ipstack、IpInfo 等。最近，我工作的公司已经切换到*Ipregistry*（[https://ipregistry.co](https://ipregistry.co)），我参与了决策和实施过程。以下是您在寻找 IP 地理定位 API 时应考虑的一些要素：

*   服务准确吗？他们是否使用单一信息源？
*   他们真的能承受你的负担吗？
*   它们是否在全球范围内提供一致且快速的响应时间（除非您的用户是特定国家/地区的）？
*   他们的定价模式是什么？

这是一个获取 IP 地理位置信息的示例（但也可以通过一次调用获取威胁和用户代理数据）：

```
$ip = $_SERVER['REMOTE_ADDR'];
$details = json_decode(file_get_contents("https://api.ipregistry.co/{$ip}?key=tryout"));
echo $details->location; 
```

*注意：我不是来推广 Ipregistry 并说它是最好的，但我花了很长时间分析现有的解决方案，他们的解决方案确实很有希望。********