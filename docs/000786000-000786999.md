# StackOverflow 问答 000786000-000786999

# deployment - 使用 MageUI 创建未签名的 ClickOnce 部署

> ID：786004
> 
> 赞同：7
> 
> 时间：2009-04-24T14:10:35.417
> 
> 标签：deployment, clickonce

使用 .Net 3.5 SP1，不再需要对 ClickOnce 清单文件进行签名。我们已将 MageUI 整合到我们的部署过程中，并希望部署一些未签名的应用程序。Mage 会让我创建一个未签名的应用程序清单。但是，它*不会*让我将部署清单指向未签名的应用程序清单。它说，“应用程序清单未签名”。

这是一个错误吗？我正在运行版本 3.5.30729.1；有没有更新的版本可以解决这个问题？任何解决方法的想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-09-25T00:11:40.100

只是一个警告-您是否仅在内部部署此功能？允许删除签名，但不建议这样做。它会删除文件的所有散列，并使您的应用程序容易受到恶意软件替换文件的影响。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-09T11:40:20.837

我有同样的问题。

解决方法是手动将 XML 片段添加到应用程序清单 XML

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-09-09T13:55:08.423

What XML Fragment needs to go into the Application Manifest XML to create unsigned deployment manifests?

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-12-24T16:34:13.800

尝试 .Net 框架 4.0

# iphone - 使用 UIImage 进行 iPhone 内存管理

> ID：786009
> 
> 赞同：1
> 
> 时间：2009-04-24T14:12:31.730
> 
> 标签：iphone, memory-management, memory-leaks, uiimage

```
- (void)imagePickerController:(UIImagePickerController *)picker 
        didFinishPickingImage:(UIImage *)image 
                  editingInfo:(NSDictionary *)editingInfo {
    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
    [self.pickerTrigger setImage:image];
    [self.button setTitle:@" " forState:UIControlStateNormal];
    [self.button setTitle:@" " forState:UIControlStateSelected];
    [self.button setTitle:@" " forState:UIControlStateHighlighted];

    CGSize oldSize = [image size];
    CGFloat width = oldSize.width;
    CGFloat height = oldSize.height;
    CGSize targetSize = CGSizeMake(320.0, 400.0);
    CGFloat targetWidth = targetSize.width;
    CGFloat targetHeight = targetSize.height;
    CGFloat scaleFactor = 0.0;
    CGFloat scaledWidth = targetWidth;
    CGFloat scaledHeight = targetHeight;
    CGPoint thumbnailPoint = CGPointMake(0.0,0.0);

    if (CGSizeEqualToSize(oldSize, targetSize) == NO)
    {
        CGFloat widthFactor = targetWidth / width;
        CGFloat heightFactor = targetHeight / height;

        if (widthFactor > heightFactor)
            scaleFactor = widthFactor;
        else
            scaleFactor = heightFactor;
        scaledWidth = width * scaleFactor;
        scaledHeight = height * scaleFactor;

        if (widthFactor > heightFactor)
            thumbnailPoint.y = (targetHeight - scaledHeight) * 0.5;
        else if (widthFactor < heightFactor)
            thumbnailPoint.x = (targetWidth - scaledWidth) * 0.5;
    }

    UIGraphicsBeginImageContext(targetSize);

    CGRect thumbnailRect = CGRectZero;
    thumbnailRect.origin = thumbnailPoint;
    thumbnailRect.size.width = scaledWidth;
    thumbnailRect.size.height = scaledHeight;
    [image drawInRect:thumbnailRect];

    self.selectedImage = UIGraphicsGetImageFromCurrentImageContext();

    NSLog([NSString stringWithFormat:@"After getting from DB %d", [selectedImage retainCount]]);
    UIGraphicsEndImageContext();
    [pool release];
    [picker dismissModalViewControllerAnimated:YES];
} 
```

变量 selectedImage 已在接口文件中声明为保留属性。正如你可以猜到的，我将一个图像缩略图存储在 selectedImage 中。然后我在另一个函数中重用它并在 dealloc 函数中释放它。

Instruments 显示该对象确实被释放但内存不断增加？这是否意味着释放对象不一定释放内存？

我经常用 UIImages 面对这种事情？有什么猜测吗？

我已将 [selectedImage release] 添加到确实被调用的 (void)dealloc 函数中，保留计数变为零并且对象确实被释放。但是分配了一些内存（我相信在使用 UIGraphicsGetImageFromCurrentImageContext(); 我猜）这没有被释放。我添加了 4-5 个图像，内存在模拟器中达到了惊人的 117 MB，然后在模拟器中回落到 48 MB。但是该应用程序在 iPhone 上崩溃了。创建图像时我应该采取其他方法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T14:54:43.157

如果您已将 selectedImage 声明为“保留属性”，则必须向其发送消息以释放它。

这是因为图像保留在对 setter 的隐式调用中：**self.selectedImage = XXX**。您看不到它，因为它在编译器为属性设置器创建的代码中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T14:54:50.957

> Instruments 显示该对象确实被释放但内存不断增加？这是否意味着释放对象不一定释放内存？

当您释放一个对象时，它会将其引用计数器减少 1，仅当该计数器达到零时才会从内存中释放它。

如果其他东西正在使用它，您的 UIImage 将不会被释放，这可能是您的代码或您在界面生成器中创建的视图。

可能您调用的保留时间太长，因此参考计数器永远不会达到零。

另外，请记住，在 iPhone 上的每个事件循环开始时，都会创建一个自动释放池。您始终可以将您的对象添加到其中并自动清理它。

# delphi - ADO 数据库表布尔列

> ID：786021
> 
> 赞同：1
> 
> 时间：2009-04-24T14:14:24.097
> 
> 标签：delphi, ado, field

我在使用 ADO 时遇到了一些麻烦。我已经部署了一个使用 Access 的数据库应用程序。随着不同版本的发布，数据库表有不同的字段，一些添加了一些删除了等等。我无法开始工作的是如何在数据库中添加一个 BOOLEAN 字段。

出于升级目的，我使用标准 sql 查询组件和如下所示的 sql：

```
ALTER TABLE XXX ADD COLUMN YY BOOLEAN 
```

虽然这适用于其他数据类型，例如 VARCHAR、INTEGER、DOUBLE 等，但它不适用于 BOOLEAN。我怀疑这是 Access 的错，布尔值是 YES/NO，但谁知道呢。

另外，如何使用 TADOTable 向表中添加字段？

提前致谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-24T17:56:02.627

在 Microsoft Access SQL 中，BIT 列直接对应 YES/NO 字段。如果您稍后尝试将其转换为 SQL Server，我会遇到一个奇怪的行为，我的建议是执行以下操作：

当您对这个字段进行检查时，请记住语法应该是 (FIELD <> 0) 用于检查 TRUE，而 (FIELD = 0) 用于检查 false。SQL Server 不理解 TRUE/FALSE 的概念，访问时返回 -1 和 0，而在 SQL Server 中返回值为 1 和 0。

在访问中，如果您还将该字段设置为非空，它只会呈现一个复选框。如果允许空值，那么它将显示 0 或 -1 或空。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T14:17:48.860

不确定 Access，但 SQL Server 使用位类型来处理布尔值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T14:17:24.837

尝试 BIT，而不是 BOOLEAN

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T14:34:07.277

您不能对 BIT（或您自己的自定义）类型执行很多操作，更好的是 TINYINT(1) 并使用 0 / 1。

# sql-server - 在编写数据库脚本时如何阻止 SSMS 插入日期？

> ID：786025
> 
> 赞同：0
> 
> 时间：2009-04-24T14:14:38.823
> 
> 标签：sql-server, scripting, ssms, sql-server-2008

使用 SQL Server Management Studio (SSMS) 编写数据库脚本时，它会生成如下行：

```
/****** Object:  ForeignKey [FK_NoteLinkAssociation_Link]    Script Date: 04/24/2009 10:04:46 ******/ 
```

有没有办法阻止它生成该行或该行的日期部分？

原因：数据库正在编写脚本并存储在源代码控制中，当您对其进行比较时，与以前相比，有数百行数据不同，这无助于找到真正的差异，因此任何解决此问题的解决方案都会也可以接受。

（SSMS2008 用于 2005 数据库。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T17:29:45.717

在 SSMS 2008 工具..>选项..>SQL Server 对象资源管理器..>脚本

“常规脚本选项”下的第一项，使“包括描述性标题”为假

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T14:53:57.870

在 SSMS 2005 中，希望 SSMS 2008 没有太大的不同：

*   工具...选项...脚本
*   “一般脚本选项”
*   “包括描述性标题”= false

# iphone - 你如何使用 Obj C 检测 iPhone v. iPhone 3G

> ID：786026
> 
> 赞同：2
> 
> 时间：2009-04-24T14:14:46.840
> 
> 标签：iphone, objective-c

设备有型号属性，但不区分 iPhone 和 iPhone 3G。有没有更好的办法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T18:24:40.703

Stephan 发布的项目中特别有趣的部分是：

您可能会看到的字符串值：

```
/*
 Platforms
 iPhone1,1 -> iPhone 1G
 iPhone1,2 -> iPhone 3G 
 iPod1,1   -> iPod touch 1G 
 iPod2,1   -> iPod touch 2G 
*/ 
```

如何获得这些值之一：

```
size_t size;
sysctlbyname("hw.machine", NULL, &size, NULL, 0);
char *machine = malloc(size);
sysctlbyname("hw.machine", machine, &size, NULL, 0);

NSString *platform = [NSString stringWithCString:machine encoding: NSUTF8StringEncoding];

free(machine); 
```

然后，您可以检查平台的开头`@"iPhone"`或`@"iPod"`并判断您是否有带 GPS 的设备。我不建议将整个字符串匹配为您想要的，因为下次设备出现时（例如今年夏天，很可能）您将无法在不更改代码的情况下匹配它。

此外，如果您还没有看过它们，Erica Sadun（项目作者）在[ArsTechnica.com](http://arstechnica.com/)上有一些关于 iPhone 开发的优秀文章，并且至少有一本关于它的书。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T14:30:46.787

看这里：

[ars / uidevice-extension](http://github.com/ars/uidevice-extension/tree/master)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-11T15:58:48.450

实际上他们可以使用代码来检测一个没有的模型并假设所有其他模型都有它

这样他们就不必在未来更改代码，除非他们再次推出没有 GPS 的 iPhone……

另外——作为对 Oregon Ghost 的回应——SDK 无法检测到许多功能（蓝牙是另一个我能想到的）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T22:04:41.843

看来您可能在这里尝试解决错误的问题。你真的不想知道你是在 iPhone 3G 还是原来的 iPhone 上运行。如果您编写的代码试图根据其型号推断设备是否具有 GPS 硬件，那么当新型号问世时（例如带 GPS 的 iPod Touch 或具有 GPS 的新上网本产品），您将不得不更改它，或没有 GPS 的 iPhone 3G Nano）。

从您的描述中不清楚为什么您认为您需要关心设备是否具有 GPS 硬件。您可以从 CoreLocation 获取位置信息，其中包括准确度测量。只需使用它，如果准确性不够高，请通知用户。

# sql-server - SQL Server PWDEncrypt 值比较

> ID：786029
> 
> 赞同：4
> 
> 时间：2009-04-24T14:15:07.340
> 
> 标签：sql-server, sql-server-2005, encryption, hash, passwords

我认为我要问的问题是不可能的，但是，我认为值得在这里试一试。

我们有一个使用 SQL Server 的 PWDEncrypt 和 PWDCompare 函数的应用程序。

系统的一部分会创建用户的副本（相同的登录名和密码）。由于系统中的一个错误，它没有复制密码的二进制存储 PWDEncrypt，而是执行另一个密码的 PWDEncrypt。因此二进制值不匹配。

是否可以找出两个二进制值是否是相同密码的哈希？

例如 PWDEncrypt('abc') = PWDEncrypt('abc')

如果我能做到这一点，那么这意味着我可以找出这个错误实际影响了多少用户，而不必处理成千上万的用户！

编辑：为了澄清， PWDEncrypt('abc') = PWDEncrypt('abc') 不会返回 true，因为密码被散列为不同的值。

虽然我知道不可能从哈希中获取密码，但 PWDCOMPARE('abc', PWDENCRYPT('abc')) 工作，因此，内部 SQL Server 必须做的不仅仅是散列您正在比较的密码并检查值是相同的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T23:51:18.670

似乎 Joel 的陈述在 SQL Server 2000 中是正确的，但在 SQL Server 2005 中却不是。

当您在 2000 年的同一个语句中一起生成哈希时，它们最终会得到相同的盐（开头的随机种子编号），这使得它们相同。2005 年总是产生不同的盐，所以它们永远不会匹配

如果您在 SQL Server 2000 上尝试此操作：

`PRINT PWDEncrypt('abc')
PRINT PWDEncrypt('abc')
PRINT PWDEncrypt('aaa')
PRINT PWDEncrypt('bbb')`

you always have the same salt at the beginning of the hash, where as in 2005 its always different. Also notice that in SQL Server 2005, the hash is shorter as it no longer maintains a copy of the hash in uppercase for case in-sensitive password compatibility.

If you can generate the hash with the same salt, then you can compare them (which means trying a brute force or dictionary attack) Have a look at [this article](http://www.ngssoftware.com/papers/cracking-sql-passwords.pdf) on how to do it. It shows you how to crack SQL Server password in C using the [CryptCreateHash](http://msdn.microsoft.com/en-us/library/aa379908(VS.85).aspx) function.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-11-22T12:14:52.723

Just try with a function that implements pwdencrypt('YourPa$$w0rd') to store it and then another one that returns a BIT 0/1 with the builtin fct pwdcompare('The EnteredPassWord', (Select Pwd From dbo.Users Where Uid = 'UserName')) That's it ;-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T14:19:13.990

您只需`SELECT CASE WHEN PWDEncrypt('abc') = PWDEncrypt('abc') THEN 1 ELSE 0 END`在查询窗口中输入并查看结果。

# sql - 从具有非唯一外键的表中选择 N 行

> ID：786047
> 
> 赞同：2
> 
> 时间：2009-04-24T14:18:39.687
> 
> 标签：sql, mysql, database

我之前问过一个[类似的问题](https://stackoverflow.com/questions/780236/limit-the-return-of-non-unique-values)，虽然我得到的答案很精彩，但我可能需要澄清一下。

就像[这个问题](https://stackoverflow.com/questions/104971/sql-query-help-selecting-rows-that-appear-a-certain-number-of-times)一样，我想根据列中的值返回 N 行。

我的例子是我有一个博客，我想在其中显示我的帖子以及评论的预览。准确地说是最后三个评论。

我有我需要的帖子，但我正在绞尽脑汁才能得到正确的评论。评论表有一个 post_id 的外键，显然多个评论可以附加到一个帖子，所以如果一个帖子有 20 条评论，那么我只想返回最后三个。让这有点棘手的是我想在一个查询中完成它，而不是每个博客帖子的“限制 3”查询，这使得呈现包含大量帖子的页面非常查询繁重。

```
SELECT *
FROM replies
GROUP BY post_id
HAVING COUNT( post_id ) <=3 
```

此查询执行我想要的操作，但仅返回每个评论中的一个，而不是三个。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T14:23:12.547

```
SELECT  l.*
FROM    (
        SELECT  post_id,
                COALESCE(
                (
                SELECT  id
                FROM    replies li
                WHERE   li.post_id = dlo.post_id
                ORDER BY
                        li.post_id, li.id
                LIMIT 2, 1
                ), CAST(0xFFFFFFFF AS DECIMAL)) AS mid
        FROM    (
                SELECT  DISTINCT post_id
                FROM    replies dl
                ) dlo
        ) lo, replies l
WHERE   l.replies >= lo.replies
        AND l.replies <= lo.replies
        AND l.id <= lo.mid 
```

有一个索引`replies (post_id, id)`（按此顺序）将大大改进此查询。

注意`l.replies >= lo.replies AND l.replies <= lo.replies`: 这是为了使索引可用。

详情请看我博客中的文章：

*   [**Advanced row sampling**](http://explainextended.com/2009/03/06/advanced-row-sampling/) (how to select `N` rows from a table for each `GROUP`)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T14:22:35.263

你跟踪评论日期吗？您可以对这些结果进行排序以仅获取 3 个最近的结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T20:42:41.433

following ian Jacobs idea

declare @PostID int

```
select top 3 post_id, comment
from replies
where post_id=@PostID
order by createdate desc 
```

# silverlight - 在 Silverlight 中使用 TransformToVisual 定位 HTML 元素

> ID：786050
> 
> 赞同：0
> 
> 时间：2009-04-24T14:19:18.810
> 
> 标签：silverlight, transform

我正在开发“托​​管”Flash 实例的 Silverlight 自定义控件。当然，您执行此操作的方法是将相关的 HTML 元素放置在您的 Silverlight 实例上，如此[处](http://blogs.msdn.com/markda/archive/2008/05/21/displaying-html-using-silverlight-2.aspx)所述。我遇到的问题是，当我使用 GeneralTransform.Transform() 方法获取控件的绝对坐标，以便我可以正确定位 HTML 元素时，返回的 Point 对象始终具有 .X=0 和.Y=0。

```
public void InitControl(string id)
{
    GeneralTransform gt = this.TransformToVisual(Application.Current.RootVisual);
    Point localPos = gt.Transform(new Point(_htmlControlLeft, _htmlControlTop));

    // Create the containing DIV tag.
    HtmlDocument doc = HtmlPage.Document;
    divHost = doc.CreateElement("div");
    divHost.SetAttribute("id", System.Guid.NewGuid().ToString());
    divHost.SetStyleAttribute("position", "absolute");
    divHost.SetStyleAttribute("left", localPos.X.ToString() + "px"); // always 0
    divHost.SetStyleAttribute("top", localPos.Y.ToString() + "px"); // always 0
    Debug.WriteLine("x,y=" + localPos.X.ToString() + "," + localPos.Y.ToString());
    divHost.SetStyleAttribute("width", Width.ToString() + "px");
    divHost.SetStyleAttribute("height", Height.ToString() + "px");
    divHost.SetStyleAttribute("z-index", _htmlZIndex.ToString());
} 
```

我无法找到有关 GeneralTransform.Transform() 方法的出色文档，但*似乎*我正确使用了它。对我做错了什么有任何想法吗？

编辑 4/28/09：我仍然没有找到答案，但我正在正确使用 Transform() 方法。只有当我在 Page.Loaded 事件期间调用 InitControl() 方法时，才会出现问题。如果我等待几秒钟，然后从 Button_Click 事件中调用它（比如说），相同的代码可以正常工作。根据 SL 文档，在 Page.Loaded 事件触发时，所有内容都应适当布置，但显然情况并非如此。

我还应该注意，每隔一段时间，上面的代码都可以正常工作，即使它是从 Page.Loaded 事件中调用的。嗯。

到目前为止，我的解决方法是在表单加载后隐藏控件几秒钟，然后显示它。这是一个丑陋的黑客，但除非有人有更好的想法......？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-02T04:07:04.457

这是由于 RootVisual 具有 0,0 x/y 轴。尝试使用树中的下一个元素，通常默认为 layoutRoot（假设您没有更改其名称等）。那或利用 FindName() 来确保您直接引用要放置 iFrame 的所述图层。

**Scott Barnes / Rich Platforms 产品经理 / Microsoft。**

# ms-access - 是否有任何理由在 VBA 中使用 ENUM？

> ID：786052
> 
> 赞同：1
> 
> 时间：2009-04-24T14:19:27.080
> 
> 标签：ms-access, vba

我曾尝试在 Access 2007 的代码中使用 ENUMS。但这很不舒服。使用集合可能会更好吗？

我的代码不起作用，我认为它会很有用。

```
Public Function 

    GetEnumId(Name As String, ReferenceTable As String) As Long
        Dim rs As DAO.RecordSet

        Set rs = CurrentDb.OpenRecordset("Select * From " & ReferenceTable & _
                    " Where Name= '" & Name & "'")
        GetEnumId = rs("ID")

        rs.Close

    End Function

    ' Doesn't work because of wrong type params
    Public Function GetEnumName(ID As Long, ReferenceTable As String) As String
        Dim rs As DAO.RecordSet

        Set rs = CurrentDb.OpenRecordset("Select * From " & ReferenceTable & _
                    " Where ID= '" & ID & "'")
        GetEnumName = rs("Name")

        rs.Close

    End Function 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T15:49:21.030

身份证不是数字吗？然后不要用引号括起来：

```
Set rs = CurrentDb.OpenRecordset("Select * From " & ReferenceTable & _
            " Where ID= " & ID ) 
```

# asp.net-mvc - ASP.NET MVC 和 Expression XAML - 如何集成？

> ID：786053
> 
> 赞同：3
> 
> 时间：2009-04-24T14:20:13.707
> 
> 标签：asp.net-mvc, xaml, expression

一些背景知识：
ASP.net MVC 主要是在您构建和开发 ASP.NET 应用程序的方式上的一种范式转变。从“代码隐藏”类型的心态转变为更像标准 MVC Ruby on Rails 之类的心态。我赞赏它作为简化单元测试和代码分离的工具所做的努力（尽管 html 内联代码可能值得商榷）。

表达式和 XAML 是一种描述表示层的方法，对设计人员来说很简单。

问题是：

**如果我们要使用 ASP.NET MVC 来开发我们的下一个网站，那么使用 Expression 和 XAML 的设计团队应该如何创建 (V) 视图或集成到开发流程中？**

**更具体地说，Expression 用户还能在 ASP.NET MVC 世界中操作吗？**

请注意，Expression 模型中的页面也使用范例代码。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-08-02T11:18:31.940

这是一个 hack，但您可以使用 XAML 在 ASP.NET MVC 中呈现静态图像。查看我的帖子 XAML Meets ASP.NET MVC - Serverside Image Rendering - 展示了如何在 ASP.NET MVC 中将 XAML 和 WPF 控件呈现为图像

[http://amazedsaint.blogspot.com/2010/07/xaml-meets-aspnet-mvc-create-databound.html](http://amazedsaint.blogspot.com/2010/07/xaml-meets-aspnet-mvc-create-databound.html)

还有一个[MvcXaml 项目](http://mvcxaml.codeplex.com)，它是一个视图引擎，允许基于 XAML 视图动态生成图像。

[http://mvcxaml.codeplex.com](http://mvcxaml.codeplex.com)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-17T21:21:04.460

我将尝试回答这个问题，做出几个可能是错误的假设。

ASP.Net MVC 是一种**Web 技术**，而 XAML 是一种**桌面**技术。您可以在 Internet Explorer 中使用 XAML，但它基本上是一种 hack，它最适合桌面或 silverlight 应用程序。

如果你想要一个类似于 MVC 的桌面范式，你应该尝试**MV-VM 模式**，它更适合 WPF 和 XAML。
使用 MV-VM，您可以创建几乎**免费的代码隐藏**视图。MV-VM
的**精彩介绍是**[Jason Dolinger 的这个视频](http://blog.lab49.com/archives/2650)

如果您正在使用 MVC**制作网站**并且您正在尝试整合设计团队，您应该让他们创建您网站的 HTML+CSS 视图，而开发人员创建控制器和模型。

如果我误解了这个问题，请在这个答案中发表评论。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-17T16:50:12.217

我目前正在对这些条款进行抨击。但是，也许这篇 [silverlight-as-a-view-in-aspnet-mvc](http://timheuer.com/blog/archive/2009/02/09/silverlight-as-a-view-in-aspnet-mvc.aspx)文章会有所帮助？你问过 XAML，我认为这就是 Silverlight 使用的......

# c# - 使用 C# 的 Excel 互操作的格式问题

> ID：786054
> 
> 赞同：-1
> 
> 时间：2009-04-24T14:20:15.597
> 
> 标签：c#, .net, excel, interop

我有一个 C# 应用程序，它使用现有的 Excel 电子表格作为模板并填写数据。在模板中有一个空白行，其中包含一些样式格式，例如字体/边框和数据格式，例如货币和百分比。从应用程序填写数据时，我复制了这一行*n*次并填写数据。样式格式有效，但就数据格式而言，它不适用，直到我打开电子表格单击列然后关闭它。这是否与 Excel 将值解释为字符串数据而无法格式化有关？我是否坚持必须在应用程序中进行数据格式化？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-05T18:06:47.640

您可以在填充后尝试显式格式化每一行。这是 Excel 2003 还是 2007？

# c# - Html.BeginForm 中的 Ajax.BeginForm

> ID：786055
> 
> 赞同：13
> 
> 时间：2009-04-24T14:20:17.903
> 
> 标签：c#, asp.net-mvc, asp.net-ajax

我有一个用于编辑东西的视图，比如订单。订单有可以任意添加的行项目。所以一个主视图和嵌套的局部视图。

每个部分都应该有一个 ajax 表单，用于调整每个行项目的数量或其他。

因此：

```
Html.BeginForm()
{%>
    Ship to: blah blah blah  
    <%
    Ajax.BeginForm("EditLineItem", "Order", new { OrderLineItemID = Model.ObjectID }, itemAjaxOptions))
    {
        Item qty blah blah blah

        <--! (ajax form's submit button, etc.)-->
    }
    %>
    <--! (ajax form's submit button, etc.)-->
<%
} 
```

我有一个看起来像这样的控制器：

```
[ActionName("Edit")]
[AcceptVerbs(HttpVerbs.Post)]
[ValidateAntiForgeryToken]
public ActionResult Edit(int orderID)
{
    blah, blah
}

[ActionName("EditLineItem")]
[AcceptVerbs(HttpVerbs.Post)]
[ValidateAntiForgeryToken]
public ActionResult EditLineItem(Guid orderLineItemID)
{
    blah, blah
} 
```

我的麻烦是，当我提交 Ajax 表单时，我得到的是 Edit 方法而不是 EditLineItem 方法。两条路线都已映射。是否有一些我不知道的问题，例如“您不能在 Html 表单中提交 Ajax 表单”？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-07-21T16:35:50.773

不久前我尝试了完全相同的事情。不管我做什么，它都不会做 AJAX 提交。所以我认为答案是：是的，您不能将 AJAX 表单的提交按钮放在常规的 html 表单中。

但是，为什么要将部分提交与完整提交合并？这个 imo 最简单的解决方法是使用带有 jQ​​uery 的 JSON 请求。

例如，当您更改下拉列表 (id=Order) 时更新数量范围文本：

```
<script type="text/javascript">
    $(document).ready(function() {
        $('select#Order').change(function() {
            $.getJSON('/Orders/UpdateQty/' + this.value, {},
              function(data) {
                  $('#qty').html(data);
              });
        });
    });

</script> 
```

以及“订单”控制器中的代码：

```
public class OrdersController : Controller
{
    public ActionResult UpdateQty(int id)
    {
        return Json(yourLibrary.getQuantities(id));
    }
} 
```

此[链接](http://www.chadmyers.com/Blog/archive/2007/12/13/using-jquery-with-asp.net-mvc.aspx)可能会有所帮助。问候

**编辑：**

所以..链接不再存在。但是多亏了互联网回程机，我们有了[这个副本](http://web.archive.org/web/20100201165536/http://www.chadmyers.com/blog/archive/2007/12/13/using-jquery-with-asp.net-mvc.aspx):)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-28T10:09:29.747

AFAIA AjaxForm 仍然呈现为表单标记，因此您将嵌套表单，您发现这是不可以的。

我认为弗朗西斯科是正确的（我建议在您更新某些内容时实施帖子而不是获取）。

亲切的问候，TP

# c# - C# 使用 Excel 互操作更新公式

> ID：786065
> 
> 赞同：0
> 
> 时间：2009-04-24T14:23:32.700
> 
> 标签：c#, .net, excel, interop

我有一个从现有模板构建 Excel 文件的 C# 应用程序。在模板上，我希望我的行总计/平均值到位，并更新到应用程序插入的行数（在页眉和页脚行之间）。这应该很简单，但我在试图记住如何做这样的事情时画了一个空白。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-28T14:12:22.490

Excel 应自动更新页脚公式中的范围，前提是页脚公式引用至少两行并且插入发生在这两行之间。

*更新以反映以下 ewbi 评论中的建议*

# silverlight - 将图像传输到 Silverlight 客户端的最有效方式

> ID：786067
> 
> 赞同：1
> 
> 时间：2009-04-24T14:24:32.963
> 
> 标签：silverlight, image, bandwidth

我有一个显示图像缩略图屏幕的应用程序，每个图像大约 80k，它们存储在数据库中。为了保持合理的响应时间，应用程序在第一次启动时显示一个占位符图像，然后从服务器下载图像。我希望一次在屏幕上显示大约 40 张图像，这就是我的批量大小。将这些图像提供给客户的最佳方式是什么？我有两个选择。

1.  创建一个向客户端公开图像数据库表的 ADO.NET 数据服务。客户端可以一次异步地请求图像，并在图像从服务器返回时显示它们。我已经实现了这个解决方案，它似乎工作正常；速度不是很好，我觉得我可以通过一次请求 3 张图像来更好地利用 Http 管道。

2.  在服务器上创建一个 HttpModule 来查找类似于 /Images/1.jpg 的请求，然后读取数据库并返回请求的数据。在客户端，我可以有许多 Image 对象，它们的源指向服务器上的虚拟 URL。我的理论是，只要给 Silverlight 多个 Url 来处理它，就可以比我在选项 1 中的代码更有效地传输图像。

这些方法中的任何一种会更有效，还是有另一种技术可以完成这项工作？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T14:33:10.323

我不知道它是否更有效，但我使用 HTTP 处理程序 (ashx) 完成了一项非常相似的任务。处理程序根据 uri（图像 ID）中的参数从数据库中提取图像，然后 Silverlight 通过将 Image 控件的 Source 属性设置为具有我想要的特定 ID 的处理程序的 URI 来异步获取它们查询字符串。反过来，Image 控件位于 ItemsControl 内部，它允许我显示多个图像。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T14:32:47.453

我们正在做一些非常相似的事情，我们只是使用一个 ASPX 页面来为它们提供图像标识符的查询参数。我们也在缓存图像，如果存在，ASPX 页面将使用缓存的值。如果没有，我们将其从数据存储中提取、缓存并发送下来。它对我们来说非常有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-25T14:42:17.373

你看过使用 Deep Zoom 吗？它对于渐进式图像加载非常有效，并且在图像完全加载时为您提供更好的用户体验。

例子：

*   [硬石纪念品](http://memorabilia.hardrock.com)网站
*   [深变焦像素](http://deepzoompix.com/Default.aspx)

# asp.net - 为什么 JavaScript 和 VB.NET 之间的字符串长度不同（通过 ASP.NET 表单发回）？

> ID：786068
> 
> 赞同：1
> 
> 时间：2009-04-24T14:24:44.307
> 
> 标签：asp.net, javascript, vb.net

当我将 JavaScript 中的多行修剪`textarea`到一定长度 (JS: `.substring(0, x)`)，然后将该字段回发时，在 VB.NET 中检查长度仍会发现长度大于 JavaScript (VB: `.Length > x`) 的修剪长度。

我已经确定这是换行符的问题，但我想确保没有其他人不得不花这么长时间寻找答案（显然它[也适用于 JSP 的某些实现](https://stackoverflow.com/questions/462348/string-length-differs-from-javascript-to-java-code)）。

在整个 ASP.NET 方案中的某个地方，一个多行值正在从“\n”（vbLf）换行符的土地进入“\r\n”（vbCrLf）换行符的土地这个区别换行符是长度不一致的原因。这是在 VB.NET 中解决它的简单方法（尽管正则表达式可能会这样做）：

```
 SomeString = SomeString.Replace(vbCrLf, vbCr) 
```

在 VB.NET 中处理它会使自己面临潜在的重复，并且当有人添加另一个时仍然很容易错过这个逻辑`textarea`；在 JavaScript 中处理它可以做同样的事情。是否有某种方法可以防止 VB.NET/ASP.NET 以这种方式处理换行符，或者是否有更好的方法使这成为非问题？这个最佳实践问题的答案肯定是这个问题的正确答案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T12:23:40.223

罪魁祸首似乎是`System.Web.dll`; `System.Web.HttpMultipartContentTemplateParser`. 使用反射器，我找到了这段代码；

```
private bool GetNextLine()
{
    int num = this._pos;
    this._lineStart = -1;
    while (num < this._length)
    {
        if (this._data[num] == 10)
        {
            this._lineStart = this._pos;
            this._lineLength = num - this._pos;
            this._pos = num + 1;
            if ((this._lineLength > 0) && (this._data[num - 1] == 13))
            {
                this._lineLength--;
            }
            break;
        }
        if (++num == this._length)
        {
            this._lineStart = this._pos;
            this._lineLength = num - this._pos;
            this._pos = this._length;
        }
    }
    return (this._lineStart >= 0);
} 
```

注意一些神奇的数字，尤其是 10 和 13。它们是 vbLf 和 vbCr。在我看来，这是处理来自帖子的原始字节，并且“一行”被认为是以 vbLf (10) 结尾的任何内容。

随着原始字节被解析（`ParsePartData`也参见方法），正在清除 vbcr 和 vblf 的复杂性。

最终，我认为再次用 LF 替换 CrLF 是安全的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T14:49:22.607

欢迎来到 Unix 行尾与基于 Windows 操作系统的行尾的世界。

IIS 是否没有某种 HTTP 请求过滤器，甚至没有配置选项来在请求进入时不对其进行修改？那将是最好的答案。

否则，搜索和替换是您的最佳答案。

# asp.net-mvc - 为什么要使用 HTTP POST 或 DELETE 而不是 GET 来删除？

> ID：786070
> 
> 赞同：39
> 
> 时间：2009-04-24T14:25:23.010
> 
> 标签：asp.net-mvc, http, http-delete

我一直在研究 Microsoft 的 ASP.NET MVC 教程，最后在这个页面

[http://www.asp.net/learn/mvc/tutorial-32-cs.aspx](http://www.asp.net/learn/mvc/tutorial-32-cs.aspx)

本页底部有以下声明：

> 通常，您不希望在调用修改 Web 应用程序状态的操作时执行 HTTP GET 操作。执行删除时，您希望执行 HTTP POST，或者更好的是 HTTP DELETE 操作。

这是真的？谁能提供更详细的解释这个声明背后的理由？

## 编辑

[维基百科](http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol)声明如下：

> 某些方法（例如，HEAD、GET、OPTIONS 和 TRACE）被定义为安全的，这意味着它们仅用于信息检索，不应更改服务器的状态。
> 
> 相比之下，POST、PUT 和 DELETE 等方法适用于可能对服务器造成副作用的操作

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-04-24T14:30:17.677

Jon Skeet 的答案是典型的答案。但是：假设您有一个链接：

```
href = "\myApp\DeleteImportantData.aspx?UserID=27" 
```

和 google-bot 出现并索引您的页面？那会发生什么？

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-04-24T14:26:41.773

GET 通常没有副作用——换句话说，它不会改变状态。这意味着可以缓存结果，可以安全地制作书签等。

来自[HTTP 1.1 RFC 2616](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.1)

> 实施者应该意识到软件代表了他们在互联网上的交互，并且应该小心让用户意识到他们可能采取的任何可能对他们自己或他人产生意想不到的意义的行动。
> 
> 特别是，已经建立了约定，即 GET 和 HEAD 方法不应该具有采取除检索之外的操作的意义。这些方法应该被认为是“安全的”。这允许用户代理以特殊的方式表示其他方法，例如 POST、PUT 和 DELETE，以便用户意识到正在请求可能不安全的操作。
> 
> 当然，不可能确保服务器不会因为执行 GET 请求而产生副作用；事实上，一些动态资源认为这是一个特性。这里的重要区别是用户没有请求副作用，因此不能对它们负责。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-04-24T14:29:25.480

除了关于幂等的纯粹问题之外，还有一个实际的方面：蜘蛛/机器人/爬虫等将跟随超链接。如果您将“删除”操作作为执行 GET 的超链接，那么 google 可以愉快地删除您的所有数据。参见“[末日蜘蛛](http://thedailywtf.com/Articles/The_Spider_of_Doom.aspx)”。

对于帖子，这不是风险。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2011-03-11T17:08:13.793

另一个例子..

```
http://example.com/admin/articles/delete/2 
```

如果您已登录并拥有正确的权限，这将删除该文章。例如，如果您的网站接受评论并且用户将该链接作为图像提交；像这样：

```
<img src="http://example.com/admin/articles/delete/2" alt="This will delete your article."/> 
```

然后，当您自己作为管理员用户浏览您网站上的评论时，浏览器将尝试通过向该 URL 发送请求来获取该图像。但是由于您在浏览器执行此操作时已登录，因此该文章将被删除。

如果不查看源代码，您甚至可能不会注意到，因为如果找不到图像，大多数浏览器都不会显示任何内容。

希望这是有道理的。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-04-24T14:29:28.350

[请在此处查看我的答案](https://stackoverflow.com/questions/705782/why-shouldnt-data-be-modified-on-an-http-get-request/705789#705789)。它同样适用于这个问题。

> *   **预取：**很多网络浏览器都会使用预取。这意味着它会在您单击链接之前加载一个页面。预计您稍后会单击该链接。
> *   **机器人：**有几个机器人可以扫描和索引互联网以获取信息。他们只会发出 GET 请求。由于这个原因，您不想从 GET 请求中删除某些内容。
> *   **缓存：** GET HTTP 请求不应该改变状态，它们应该是幂等的。幂等意味着发出一次请求，或多次发出请求会给出相同的结果。即没有副作用。因此，GET HTTP 请求与缓存紧密相关。
> *   **HTTP 标准是这样说**的：HTTP 标准说明了每种 HTTP 方法的用途。有几个程序是为使用 HTTP 标准而构建的，它们假定您将按照您应该的方式使用它。因此，如果您不遵循，您将在大量随机程序中出现未定义的行为。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-24T18:07:54.813

除了蜘蛛和请求必须是幂等的之外，get 请求还有一个安全问题。有人可以轻松地向您的用户发送一封电子邮件

```
<img src="http://yoursite/Delete/Me" /> 
```

在文本中，浏览器会很高兴地继续尝试访问资源。使用 POST 并不能解决此类问题（因为您可以很容易地用 javascript 将表单帖子放在一起），但这是一个好的开始。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-24T14:30:04.853

关于这个话题（HTTP 方法的使用），我推荐阅读这篇博文：http: [//blog.codevader.com/2008/11/02/why-learning-http-does-matter/](http://blog.codevader.com/2008/11/02/why-learning-http-does-matter/)

这实际上是相反的问题：为什么在没有数据更改的情况下不使用 POST。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-25T09:01:42.060

假设我们有一个网上银行应用程序，我们访问了转账页面。登录的用户选择将 10 美元转移到另一个帐户。

单击提交按钮重定向（作为 GET 请求）到[https://my.bank.com/users/transfer?amount=10&destination=23lk3j2kj31lk2j3k2j](https://my.bank.com/users/transfer?amount=10&destination=23lk3j2kj31lk2j3k2j)

但是互联网连接很慢和/或服务器很忙，所以在点击提交按钮后，新页面加载速度很慢。

用户感到沮丧并开始疯狂地按 F5（刷新页面）。猜猜会发生什么？可能会发生多次转账，可能会清空用户的帐户。

* * *

现在，如果请求是作为 POST（或除 GET 之外的任何其他内容）发出的，第一个 F5（刷新页面）用户会让浏览器轻轻询问“你确定要这样做吗？它可能会产生副作用 [bla bla bla ]……”

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-09-29T01:32:02.910

除了这里提到的所有极好的原因之外，GET 请求可以由接收服务器记录，例如在`access.log`. 如果您在请求中发送敏感数据（例如密码），它们将被记录为纯文本。

即使为了安全的数据库存储而对它们进行了散列/加盐处理，违规（或有人在 IT 人员的肩膀上看着）也可能会暴露它们。这些数据应该放在 POST 正文中。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-24T15:02:48.473

GET 的另一个问题是命令转到浏览器的地址栏。因此，如果您刷新页面，则再次发出命令，无论是“删除最后的东西”、“提交订单”还是类似的命令。

# sharepoint - 从 Active Directory 导入和导出用户

> ID：786077
> 
> 赞同：1
> 
> 时间：2009-04-24T14:27:12.660
> 
> 标签：sharepoint, active-directory

我正在尝试将 SharePoint 网站从一台服务器移动到另一台服务器。我也应该使用他们的权限移动所有用户。有人告诉我，最好的方法是从 AD 中导出用户，然后在目标服务器上导入列表。

这是实现这一目标的最佳方法吗？如何仅导出用户和权限，然后导入它们？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T14:34:59.850

纯粹的答案是使用带有 includeusersecurity 选项的 stsadm 导出操作。就我个人而言，我不是 stsadm 粉丝，建议您使用[SP 部署向导](http://www.codeplex.com/SPDeploymentWizard)工具并确保选择“用户信息更新”以全部导入。这将为他们的个人资料带来安全性+用户信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-13T20:20:57.240

显然，除非您在其之间移动的服务器已联网，否则您无法使用用户及其权限移动活动目录。然后，您可以更改服务器角色并以这种方式移动目录。可以在[此处](http://windowsitpro.com/article/articleid/39959/how-can-i-move-the-active-directory-ad-global-catalog-gc-to-another-domain-controller-dc.html)找到更详尽的示例。由于 AD 中的用户一开始并没有太多，所以我最终自己手动添加了他们。

# c++ - 使用 SecureZeroMemory() 真的有助于使应用程序更安全吗？

> ID：786093
> 
> 赞同：7
> 
> 时间：2009-04-24T14:32:13.757
> 
> 标签：c++, security, winapi

WinAPI 中有一个 SecureZeroMemory() 函数，用于在不再需要缓冲区时擦除用于存储密码/加密密钥/类似内容的内存。它与 ZeroMemory() 的不同之处在于它的调用不会被编译器优化。

擦除用于存储敏感数据的内存真的有必要吗？它真的让应用程序更安全吗？

我知道数据可以写入交换文件或休眠文件，其他进程可能会读取我程序的内存。但是，当数据仍在使用时，也会发生同样的情况。为什么*使用，然后擦除*比*使用*更好？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-24T14:37:19.797

确实如此。例如，休眠文件未加密。如果你不安全地清除内存，你可能会遇到麻烦。不过，这只是一个例子。您应该始终仅在需要时将秘密内容保存在内存中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-24T14:43:41.403

它的存在是有原因的。:) 如果您将敏感数据保存在内存中，那么其他进程可能会读取它。

当然，在您的应用程序中，密码或其他安全数据可能不是那么重要，以至于需要这样做。但在某些应用程序中，恶意代码不能仅仅窥探您的密码或信用卡号或应用程序使用的任何其他数据，这一点非常重要。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-24T14:40:07.717

另请注意，某些操作系统可能不会在将内存分配给应用程序之前将其归零，这意味着应用程序可能会随机请求内存，扫描它以查找可能有趣的内容并对其进行处理。

如果该应用程序只能获得零内存，那么尝试获取有趣的数据当然会更加困难。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-24T15:04:23.570

`SecureZeroMemory()`肯定不会使您的应用程序完全安全。密码已经在内存中的事实已经是一个安全漏洞。使用`SecureZeroMemory()`肯定会降低您的密码被找回的可能性。我看不出有什么理由不使用它，那为什么不呢？请记住，您还需要担心许多其他事情。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-24T15:31:27.657

如果您确实有密码数据或其他机密，您还需要确保它们所在的内存不会被换出，否则交换文件可能会成为问题（我认为您想要的功能是 ' VirtualLock' 用于 Windows 应用程序）。此外，您还需要检测进入休眠状态的窗口并在此时擦除数据。我相信 Windows 会在每个应用程序即将休眠时向它发送一条消息。

# c# - 打印嵌入式 Excel 工作表

> ID：786094
> 
> 赞同：0
> 
> 时间：2009-04-24T14:32:20.263
> 
> 标签：c#, excel, pdf

编辑：我有一个带有嵌入式 Excel 工作表和网格视图（WinForm）的用户控件。我有一个具有该用户控件的表单。我在顶部有一个打印按钮，我想将整个表单转换为可打印格式。关于如何继续前进的任何建议？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T14:38:52.290

可以使用以下[`Workbook.ExportAsFixedFormat`](http://msdn.microsoft.com/en-us/library/bb238907.aspx)方法打印 Excel 文档：

```
ActiveWorkbook.ExportAsFixedFormat Type:=xlTypePDF 
    FileName:=“sales.pdf” 
    Quality:=xlQualityStandard 
    DisplayFileAfterPublish:=True 
```

应该优先使用此方法，`SaveAs`因为它还允许指定所有 PDF / XPS 选项。

注意：此方法已通过 Excel 2007 添加到 Excel 对象模型中，并且需要安装[Save as PDF or XPS Add-in](http://www.microsoft.com/downloads/details.aspx?FamilyID=4d951911-3e7e-4ae6-b059-a2e79ed87041) for 2007 Microsoft Office 程序。

请参阅此相关问题：[通过 API 将文件另存为 PDF 所需的 Excel 2007 中 PDF 的 FileType 编号是多少？](https://stackoverflow.com/questions/738829/what-is-the-filetype-number-for-pdf-in-excel-2007-that-is-needed-to-save-a-file-a)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T14:44:47.220

对于 2007 之前的版本，您可以嵌入/安装 PDF 打印机并使用该`PrintOut`方法，`ActivePrinter`根据需要指定。

# design-patterns - 在 MFC 应用程序中使用 Model-View-Presenter 模式

> ID：786109
> 
> 赞同：2
> 
> 时间：2009-04-24T14:35:27.320
> 
> 标签：design-patterns, mfc, mvp

我在一个“相当”大的 MFC 应用程序的 ui 中工作。

我们试图将应用程序拆分为模块以隔离业务逻辑，但无论如何，仍然有很多地方 ui 有一些不应该存在的业务逻辑。这种业务逻辑很难测试，更改控件有时会很痛苦。但是……你们都知道我的意思……

现在我们想使用 MVP 模式来尝试真正隔离 ui。我已经阅读了很多关于该模式的论文，并看到了一些小例子。理解模式没有问题，但无论如何我想在开始之前先了解一些更复杂的示例（如果它们来自 MFC 应用程序更好）。

如果有人有一些好的资源或知道一本关于这种模式的好书（带有示例），那将非常有用。

谢谢。

* * *

## 回答 #1

> 赞同：-2
> 
> 时间：2009-04-25T20:09:50.100

阅读 GOF 的设计模式（Addison Wesley）

示例使用 C++

你也可以去我的博客[http://sujayghosh.wordpress.com](http://sujayghosh.wordpress.com)搜索设计模式。

有一个例子

高温高压

苏杰

# mysql - 如何使用多台机器扩展 MySQL？

> ID：786112
> 
> 赞同：27
> 
> 时间：2009-04-24T14:36:44.447
> 
> 标签：mysql, performance, scaling

我有一个运行 LAMP 的网络应用程序。我们最近增加了负载，现在正在寻找可扩展的解决方案。扩展 apache 非常简单，我们只需让多台机器托管它并循环传入流量。

但是，每个 apache 实例都会与 MySQL 对话，最终 MySQL 会超载。如何在此设置中跨多台机器扩展 MySQL？我已经看过[这个](https://stackoverflow.com/questions/189903/scaling-solutions-for-mysql-replication-clustering)，但特别是我们需要立即使用数据库中的更新，所以我认为复制在这里不是一个好策略？也希望这可以通过最少的代码更改来完成。

PS。我们有大约 1:1 的读写比率。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-24T14:45:41.493

只有两种策略：复制和分片。当您的写入流量较少而读取流量较多时，复制通常会到位，因此您可以将读取重定向到许多从属服务器，但随着时间的推移和不一致的可能性会出现大量复制流量的陷阱。

通过分片，您可以在多台机器上对数据库表进行分片（称为功能分片），这使得连接变得更加困难。如果这不再适合，您还需要在多台机器上对行进行分片，但这并不有趣，并且取决于在您的应用程序和数据库之间实现的分片层。

面向文档的数据库或列存储可以为您完成这项工作，但它们目前针对 OLAP 而不是针对 OLTP 进行了优化。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-04-27T20:28:46.353

取决于应用程序后端（即如何处理 PK、事务和插入 ID），您可能会考虑使用不同的 auto_increment 设置进行 MASTER-MASTER 复制。这可能很棘手，需要彻底测试，但它可以工作。

此外，在新的 MySQL 5.6 中，有一个 GTID（全局事务标识符）通常有助于保持复制同步，尤其是在这种情况下。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T14:47:02.880

你应该看看[MySQL 性能博客](http://www.mysqlperformanceblog.com/)。也许你会发现一些有用的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-05-20T21:31:14.160

嗯……祝你好运，将所有这些写入扩展到真正的大规模。数据库引擎成为瓶颈，太多的锁和缓冲区管理和东西......

我发现真正有效的唯一方法是横向扩展，分片，不幸的是，没有为 MySQL “开箱即用”提供分片（就像在某些 NoSQL 中，如 Mongo 一样）。[ScaleBase](http://www.scalebase.com/products/product-architecture/)（免责声明：我在那里工作）是一个完整的横向扩展解决方案的制造商，如果你愿意的话，它是一个“自动分片机”。ScaleBae 分析您的数据和 SQL 流，在 DB 节点之间拆分数据，路由命令并在运行时聚合结果——因此您不必这样做！

# jquery - JQuery中附加字段的自动完成

> ID：786117
> 
> 赞同：1
> 
> 时间：2009-04-24T14:38:41.730
> 
> 标签：jquery, autocomplete

我正在使用 JQuery 通过单击链接来创建其他输入字段。目前，我实现了一个自动完成插件，该插件适用于在页面加载时创建的字段。当用户添加新字段时，自动完成功能不适用于这些特定字段。我只是想知道是否有人可以帮助我弄清楚如何让它工作。

```
<script type="text/javascript">
    $(document).ready(function() {
        $('#addingredient').click(function() {
            $('<li />').append('<input type="text" class="ingredient" name="ingredient[]" id="ingredient[]" size="60" />')
            .append('<input type="text" class="amount" name="amount[]" id="amount[]" size="5" />')
            .append('<select class="unit" name="unit[]" id="unit[]"><?=$units ?></select>')
            .appendTo('#ingredients')
            .hide()
            .fadeIn('normal');
        });
</script>

<script>
    $(document).ready(function(){
        var data = "http://mywebsite.com/ingredients.php";
        $(".ingredient").autocomplete(data);
    });
</script>

<ul id="ingredients">
    <li><input type="text" class="ingredient" name="ingredient[]" id="ingredient[]" size="60" /><input type="text" class="amount" name="amount[]" id="amount[]" size="5" /><select class="unit" name="unit[]" id="unit[]"><?=$units ?></select></li>
    <li><input type="text" class="ingredient" name="ingredient[]" id="ingredient[]" size="60" /><input type="text" class="amount" name="amount[]" id="amount[]" size="5" /><select class="unit" name="unit[]" id="unit[]"><?=$units ?></select></li>
    <li><input type="text" class="ingredient" name="ingredient[]" id="ingredient[]" size="60" /><input type="text" class="amount" name="amount[]" id="amount[]" size="5" /><select class="unit" name="unit[]" id="unit[]"><?=$units ?></select></li>
</ul> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T14:50:35.803

将新元素添加到 DOM 后，您需要在新元素上重新运行自动完成功能。以下将等到元素淡入，然后在具有正确类的新元素上设置自动完成。

```
<script type="text/javascript">
    var data = "http://mywebsite.com/ingredients.php";
    $(document).ready(function() {
        $('#addingredient').click(function() {
            $('<li />').append('<input type="text" class="ingredient" name="ingredient[]" id="ingredient[]" size="60" />')
            .append('<input type="text" class="amount" name="amount[]" id="amount[]" size="5" />')
            .append('<select class="unit" name="unit[]" id="unit[]"><?=$units ?></select>')
            .appendTo('#ingredients')
            .hide()
            .fadeIn('normal', function() {
                $(this).find('.ingredient').autocomplete(data);
            });
        });
        $(".ingredient").autocomplete(data);
    });
</script> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T14:46:14.130

因为您在创建新的之前进行了自动完成。它不只是自动应用它，它只在 DOM 准备好时才这样做。

```
<script type="text/javascript">

$(document).ready(function() {
    $('#addingredient').click(function() {
        $('<li />').append('<input type="text" class="ingredient" name="ingredient[]" id="ingredient[]" size="60" />')
        .append('<input type="text" class="amount" name="amount[]" id="amount[]" size="5" />')
        .append('<select class="unit" name="unit[]" id="unit[]"><?=$units ?></select>')
        .appendTo('#ingredients')
        .hide()
        .fadeIn('normal');

        var data = "http://mywebsite.com/ingredients.php";
        $('.ingredient').autocomplete(data);
    });
}

</script> 
```

试试那个。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T14:44:02.573

问题在于仅在页面加载时才初始化自动完成功能。因此不会被添加到动态添加的输入中。您也应该通过再次调用自动完成功能来添加自动完成功能。因此，在您添加新输入后，只需再次调用自动完成功能：

```
 $(".ingredient").autocomplete(data); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-27T06:11:25.997

改进 tvanfosson 先前的答案（防止不必要的 DOM 查找）：

```
<script type="text/javascript">
    var data = "http://mywebsite.com/ingredients.php";
    $(document).ready(function() {
        $('#addingredient').click(function() {
            var newIngredient = $('<input type="text" class="ingredient" name="ingredient[]" id="ingredient[]" size="60" />');
            $('<li />').append(newIngredient)
                .append('<input type="text" class="amount" name="amount[]" id="amount[]" size="5" />')
                .append('<select class="unit" name="unit[]" id="unit[]"><?=$units ?></select>')
                .appendTo('#ingredients')
                .hide()
                .fadeIn('normal');
            newIngredient.autocomplete(data);
        });
        $(".ingredient").autocomplete(data);
    });
</script> 
```

# c# - ComboBox 的编辑框部分被自动选中

> ID：786119
> 
> 赞同：18
> 
> 时间：2009-04-24T14:39:02.650
> 
> 标签：c#, .net, winforms, combobox

我有一个小问题困扰了我几个小时。

在我的 WinForms (.NET 3.5) 应用程序中，我在运行时在 TableLayoutPanel 中创建了一些 ComboBoxes (DropDownStyle = DropDown) 并用字符串填充它。组合框配置为自动调整大小（锚点 = 左 | 右）。

问题在于，每当调整组合框的大小（即调整对话框的大小）时，组合框的编辑框部分都会被完全选中/突出显示。在我看来，这对我想要避免的客户造成了非常混乱的影响。

如果 ComboBox 具有固定大小，则不会出现此问题。

另请注意，更改 DropDownStyle 不是一个选项 - 我需要手动输入文本的可能性。

我已经尝试过重写 OnPaint 方法，但效果不太好。我还尝试清除 ComboBox.Resize 事件中的选择，这在某种程度上起作用，但似乎是一个非常丑陋的解决方案 - 有很多闪烁，故意选择的文本被取消选择，我必须将事件处理程序添加到每个以及我对话框中的每个 ComboBox。

这个问题有更好的解决方案吗？

先感谢您。

问候，安迪

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-06-23T05:06:06.593

这是一个老问题，但我发现它正在寻找答案并最终实现了我自己的解决方案。还不如发在这里，对吧？

```
 foreach (var cb in Controls.OfType<ComboBox>())
    {
        cb.Resize += (sender, e) => {
            if (!cb.Focused)
                cb.SelectionLength = 0;
        };
    } 
```

> 有意选择的文本被取消选择

这个 WinForms 错误不会影响选定的组合框，因此通过忽略具有焦点的组合框，我们可以解决丢失当前选择的问题。

> 我必须将事件处理程序添加到对话框上的每个 ComboBox 中。

由 foreach 循环处理。如果您不想破坏设计器，或者让设计器破坏它，请将其放在 InitializeComponent() 或您的 .ctor 中。

> 有很多闪烁

如果我快速调整大小，我只会看到闪烁，但我在 Win7 上，所以在 XP 上可能会有所不同。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2016-11-22T00:01:48.943

这似乎是`ComboBox`with `DropDownStyle`of的本机 Windows 实现中的一个错误`DropDown`。

此处其他答案中详述的修复（在's事件中将`SelectionLength`属性设置为 0（零））在大多数情况下都能正常工作。`ComboBox``Resize`

但是，我发现即使是解决此错误的修复程序也并不总是有效。如果`ComboBox`是 在 a 中`TableLayoutPanel`，并且如果它`TableLayoutPanel`有多个具有`Percent`Size Type 的列，那么该修复通常不起作用。

一张图片胜过千言万语。请参阅以下我为演示问题而制作的表单的屏幕截图。

[![在此处输入图像描述](https://i.stack.imgur.com/xPmGP.png)](https://i.stack.imgur.com/xPmGP.png)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2019-10-10T05:17:13.120

`WM_WINDOWPOSCHANGED`为我工作，在被调用时将 selectionLength 更改为 0 。即使 tableLayoutPanel 设置为 % 也可以工作。

```
protected override void WndProc(ref Message m) {
    base.WndProc(ref m);

    if(m.Msg == 0x0047) {   // WM_WINDOWPOSCHANGED = 0x0047 
        if (SelectionLength != 0) {
            SelectionLength = 0;
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-03-30T18:25:24.173

哇。感谢你们！

显然，这个错误已经持续了很多年。我正在使用 .Net 4 (Visual Studio 2010) 构建用户控件。这是我对 bsneeze 代码的轻微修改版本。

干杯

```
using System.Windows.Forms;
using System.Linq;

public MyUserControlCtor()
{
    InitializeComponent();

    foreach( Control ctrl in Controls)
    {
        ComboBox cb = ctrl as ComboBox;
        if (cb != null)
        {
            cb.Resize += (sender, e) =>
            {
                if (!cb.Focused)
                    this.FCHZ_ComboBox.SelectionLength = 0;
            };
        }
    } 
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-10-07T20:01:25.293

到目前为止，没有一个答案对我有用。我发现的唯一可靠方法是在控件上的所有其他活动完成后通过`BeginInvoke`将设置`SelectionLength`回零的异步发布消息。闪烁的数量非常烦人且不专业，但这是我能想到的最好的......到目前为止。

```
internal class FixedComboBox : ComboBox
{
    protected override void OnResize(EventArgs e)
    {
        if (IsHandleCreated && !Focused)
        {
            BeginInvoke((Action)(() =>
                {
                    SelectionLength = 0;
                }));
        }
        base.OnResize(e);
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-11-04T01:22:25.393

处理 ComboBox 的父容器的 Resize 事件。把这条线放在那里：

MyComboBox.SelectionLength = 0

一个例子（显然是VB）：

```
Private Sub MyControl_Resize(sender As Object, e As EventArgs) Handles Me.Resize

    MyComboBox.SelectionLength = 0

End Sub 
```

祝你好运！

--BP

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-08-28T14:36:43.233

我发现在组合框所在的任何控件的调整大小事件上将组合框的选择长度设置为 0 会导致**闪烁**更少，而不是在调整组合本身的大小时进行。

我实际上在 VB.Net 中实现了这一点，但它应该同样适用于 C#。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-06-21T20:54:27.827

对于 TableLayoutPanel 中的 ComboBox，在 ComboBox.Resize 事件上设置 .SelectionLength = 0 不起作用，但在 TableLayoutPanel.Resize 事件上执行此操作：

```
Private Sub TableLayoutPanel_Resize(sender As Object, e As EventArgs)
    Dim curr_panel = TryCast(sender, System.Windows.Forms.TableLayoutPanel)
    For Each curr_combo As ComboBox In curr_panel.Controls.OfType(Of ComboBox)
        If ((Not curr_combo.Focused) And curr_combo.DropDownStyle = ComboBoxStyle.DropDown) Then
                curr_combo.SelectionLength = 0
        End If
    Next
End Sub

dim panel as new TableLayoutPanel with {
    ...
}
AddHandler panel.Resize, AddressOf TableLayoutPanel_Resize 
```

# .net - 具有方向感知的 NET CF 本地化

> ID：786120
> 
> 赞同：0
> 
> 时间：2009-04-24T14:39:15.643
> 
> 标签：.net, compact-framework, localization

是否有人成功本地化了使用方向感知控件以支持多种分辨率的移动应用程序。CultureInfo 需要在运行时设置，而不是从系统中读取。不确定这是否受支持。请帮忙。

普拉门

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-25T10:49:47.090

我从未使用过您提到的控件，也不知道您必须在运行时为所述控件设置 CultureInfo 的原因。因此，我的回复是基于您如何在运行时设置 CultureInfo 的问题。如果这不是您想要的，请忽略我的回复。

如果我们正在编写桌面应用程序，可以使用以下方法更改 CultureInfo：

```
Thread.CurrentThread.CurrentCulture = CultureInfo.CreateSpecificCulture("en-US")
'en-US = American English 
```

不幸的是，这在 CF.NET 中是不可能的。

事实上，据我所知，没有官方或支持的方式可以在运行时更改 CF.NET 中设备的 CultureInfo（和区域设置）。也许可以更改注册表中的区域设置，但这意味着必须重新启动设备。

然而，在我的代码库中，我有一个代码片段，这是我前段时间发现的，我只在一个运行良好的模拟器中进行了测试。**它被认为是“黑客”并且可能有风险**，但是在模拟器中对其进行测试时，我从未遇到任何问题。这是在 VB.Net 中：

```
'I declare the following statement

Dim myCIintl As New Globalization.CultureInfo("en-US") 'where en-US is for Ame-English

'Then I call the following sub

SetDefaultLocale(myCIintl)

'Here is the code of the sub

Public Shared Sub SetDefaultLocale(ByVal locale As System.Globalization.CultureInfo)
        If Nothing Is locale Then
            Throw New ArgumentNullException("locale")
        End If

        Dim fi As System.Reflection.FieldInfo = GetType(System.Globalization.CultureInfo).GetField _
        ("m_userDefaultCulture", System.Reflection.BindingFlags.NonPublic Or System.Reflection.BindingFlags.Static)
        If Nothing Is fi Then
            Throw New NotSupportedException("Setting locale is not supported in this version of the framework.")
        End If
        fi.SetValue(Nothing, locale)
End Sub 
```

注意：请注意，如果私有变量*m_userDefaultCulture*将在未来版本中更改其名称，则上述代码可能会中断。此外，该变量的名称在 Windows Mobile 的本地化版本中可能有另一个名称 - 也许在西班牙语版本中它被称为其他名称。我不知道，所以我想你必须自己尝试一下。

除了上面提到的注释之外，只要设备上存在您希望使用的区域设置，上述代码应该可以工作（交叉手指）。要查看设备支持哪些区域设置，您可以使用 Ctacke[在此处](https://stackoverflow.com/questions/435951/compact-framework-retrieve-a-list-of-countries-and-regions "这里")显示的出色代码。

祝你好运！

# nhibernate - 让 NHibernate.Mappings.Attributes 工作选项

> ID：786124
> 
> 赞同：2
> 
> 时间：2009-04-24T14:40:25.657
> 
> 标签：nhibernate, attributes, nhibernate-mapping

我在项目中使用 NHibernate.dll 的 v2.1 和 NHibernate.Mappings.Attributes v2.1。

当我在下面进一步运行代码时，我得到以下异常，并将感谢任何指针。在同一个项目上，如果我删除属性并使用 xml 映射文件，它工作正常。

```
NHibernate.MappingException was unhandled 
Message="Could not compile the mapping document: 
DomainModel.hbm.xml" 
Source="NHibernate" 

InnerException: System.NullReferenceException 
Message="Object reference not set to an instance of an object." 
Source="NHibernate" 
StackTrace: 
at NHibernate.Cfg.XmlHbmBinding.ClassBinder.BindClass 
(XmlNode node, PersistentClass model) 
at NHibernate.Cfg.XmlHbmBinding.RootClassBinder.Bind 
(XmlNode node, HbmClass classSchema) 
at NHibernate.Cfg.XmlHbmBinding.MappingRootBinder.AddRootClasses(XmlNode 
parentNode) 
at NHibernate.Cfg.XmlHbmBinding.MappingRootBinder.Bind(XmlNode node) 
at NHibernate.Cfg.Configuration.AddValidatedDocument(NamedXmlDocument doc) 
InnerException: 
```

我有一个如下的联系人类（域类只有一种方法，没有属性）：

```
[NHibernate.Mapping.Attributes.Class] 
public class Contact : DomainClass 
{ 
    [NHibernate.Mapping.Attributes.Id(Name = "Id")] 
    [NHibernate.Mapping.Attributes.Generator(1, Class ="Identity")] 
    public virtual int ID { get; set; } 

    [NHibernate.Mapping.Attributes.Property] 
    public virtual string Name { get; set; } 

    [NHibernate.Mapping.Attributes.Property] 
    public virtual string Town { get; set; } 
} 
```

和会话代码如下：

```
Configuration cfg = new Configuration(); 
cfg.Configure(); 
cfg.AddInputStream(NHibernate.Mapping.Attributes.HbmSerializer.Default.Serialize( 
typeof(Contact).Assembly), "DomainModel.hbm.xml"); 
_sessionFactory=cfg.BuildSessionFactory(); 
```

我的 hibernate.cfg.xml 文件是：

```
<hibernate-configuration xmlns="urn:nhibernate-configuration-2.2"> 
<session-factory> 
<property name="dialect">NHibernate.Dialect.MsSql2005Dialect</property> 
<property name="connection.provider">NHibernate.Connection.DriverConnectionProvider</ 
property> 
<property name="connection.connection_string">Server=SERVER 
\EXPRESS2008;Initial Catalog=Contacts;Integrated Security=True</property> 
<property name="proxyfactory.factory_class">NHibernate.ByteCode.LinFu.ProxyFactoryFac­    tory, NHibernate.ByteCode.LinFu</property> 
</session-factory> 
</hibernate-configuration> 
```

* * *

斯图尔特，

据我了解，“DomainModel.hbm.xml”是 NHibernate.Mappings.Attributes 应该创建的文件 - 异常发生在文件创建之前（它不在输出目录中），所以很遗憾我不能发布它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-25T10:56:59.990

斯图尔特，

再次感谢您的回复。

设法让它工作使用：

```
using (MemoryStream stream = new MemoryStream()) 
{ 
HbmSerializer.Default.HbmNamespace = "NSpace.DomainLayer.Entities"; 
HbmSerializer.Default.HbmAssembly = "NSpace"; 
HbmSerializer.Default.Serialize(stream, 
System.Reflection.Assembly.GetExecutingAssembly()); 
stream.Position = 0; 
Configuration cfg = new Configuration(); 
cfg.Configure(); 
cfg.AddInputStream(stream); 
_sessionFactory = cfg.BuildSessionFactory(); 
} 
```

并在类属性中指定表名（我的疏忽，因为这些与类名不同！）。

不知道为什么我们需要单独指定命名空间，因为我假设 NHibernate 可以计算出从程序集中序列化的类型。

以上希望对遇到类似问题的人有所帮助，尽管我的印象是很少有人使用 NHibernate.Mappings.Attributes。文档似乎严重缺乏。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-06T20:23:07.583

有一段时间，NHMA 没有自动检测类名，因为它们现在在 NHibernate 中是可选的（在某些情况下，您可以使用 entity-name 代替）。然而，最新版本通过设置在需要时将其关闭来恢复自动检测行为。

属性必须手动排序，因为 .NET 在编译时不保证它（与 Java 不同）。

NHMA 的最终目标是忠实地复制您编写 XML 版本的方式；所以如果你有：

```
<something>
  <innerData/>
</something> 
```

NHMA 版本将是：

```
[Something]
  [InnerData(2)] 
```

NHMA 试图巧妙地推断某些值（如名称），但只有在需要该值时才会这样做。

它还为喜欢`NameType=typeof(XXX)`从智能感知、编译时验证和重构中受益的助手提供帮助。

文档中的更多详细信息： [http ://www.nhforge.org/doc/nh/en/index.html#mapping-attributes](http://www.nhforge.org/doc/nh/en/index.html#mapping-attributes)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-28T07:12:32.053

如果你还没有解决你的问题，试试这个

```
[NHibernate.Mapping.Attributes.Class(Table="youtable",NameType=typeof(Contact ))] 
public class Contact : DomainClass 
{ 
    [NHibernate.Mapping.Attributes.Id(Name = "Id")] 
    [NHibernate.Mapping.Attributes.Generator(1, Class ="Identity")] 
    public virtual int ID { get; set; } 

    [NHibernate.Mapping.Attributes.Property(Name="Name")] 
    public virtual string Name { get; set; } 

    [NHibernate.Mapping.Attributes.Property(Name="Town")] 
    public virtual string Town { get; set; } 
} 
```

我正在使用这样，它工作正常......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-15T06:49:31.190

每当您使用**hbm.xml**文件时，您将像这样设置您的配置类：

```
Configuration cfg = new Configuration();
cfg.Configure();
// Add class mappings to configuration object
cfg.AddAssembly(Assembly.GetCallingAssembly());
ISessionFactory sessionFactory = cfg.BuildSessionFactory(); 
```

每当您使用 Nhibernate.Mapping.Attributes 之类的类时，您将使用：

例如，您在 Product Class 中使用了 Mapping.attributes

```
Configuration cfg = new Configuration();
cfg.Configure();

// Add class mappings attributes to configuration object
cfg.AddInputStream(HbmSerializer.Default.Serialize(typeof(Model.Product);
ISessionFactory sessionFactory = cfg.BuildSessionFactory(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-27T01:33:23.633

我必须说 NHibnerate.Mapping.Atributes 组件写得不好。下面的代码会导致生成格式错误的映射xml

```
[Class()]
public class Bar{} 
```

同时，下面的代码很好：

```
[Class(Name="Bar")]
public class Bar{} 
```

此外，如果将 [Generator] 属性放在 [Id] 属性之后，那么有关生成器的信息将不会包含在 xml 中，但将 [Generator] 放在 [Id] 之前会起作用。

3.0 正在运行，我希望这些“讨厌的”错误将得到修复。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-12-06T16:50:48.197

几乎是**mitjast**答案的副本，有一些小的修复和格式化：

```
[Class(NameType = typeof(DomainClass))]
public class DomainClass
{
    [NHibernate.Mapping.Attributes.Generator(Class = "guid")]
    [NHibernate.Mapping.Attributes.Id(Name = "DomainID")]
    public virtual Guid DomainID { get; set; }
    [NHibernate.Mapping.Attributes.Property]
    public virtual string Name { get; set; }
} 
```

该定义帮助我解决了所有异常并生成有效的 hbm 映射。正如**Cold 先生**所提到的，**Generator**和**Id**属性的顺序确实很重要。但在我的情况下，我们发现，对于一个类**Id**应该首先在 hbm 中实际提及，而对于另一个类，第一个属性应该是**Generator**。*当我在一个类中更改这些属性的顺序以使两个类具有相同的顺序时，其中一个类的 hbm 变得错误... NHibernate.Mapping.Attributes-for-NHibernate-3.0*发布后情况没有改变*.0.Alpha2*。不幸的是，这些古怪事物的存在足以让我转向另一种解决方案......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-05-25T09:15:22.560

如上所述，自第 2 版以来，您必须指定类的名称......我已经发布了一篇关于如何通过派生 HbmWriter 来解决这个问题的文章：http: [//blog.hopla.org/2009/12/fix- for-nhibernate-mapping-attributes-2-1/](http://blog.hopla.org/2009/12/fix-for-nhibernate-mapping-attributes-2-1/)

# java - 如何在 S60 OS 中运行 .jar 文件？

> ID：786125
> 
> 赞同：0
> 
> 时间：2009-04-24T14:41:38.040
> 
> 标签：java, symbian, nokia, n73

我想在我的诺基亚 N73 手机上运行一个 .jar 文件。我无法弄清楚我需要做什么。我已经下载了 Sun Java Wireless Kit，但它只是连接到它自己的模拟器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T17:16:50.383

您必须将该文件传输并安装到手机上。你在这里有几个选择：

1.  安装诺基亚 PC 套件并使用它的应用程序安装程序将 JAR 文件传输到手机。

2.  通过蓝牙发送到手机

3.  将jar文件上传到某个文件托管服务并从手机浏览到它

所有这一切都考虑到您的文件是移动 Java 应用程序 (J2ME)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-27T12:41:18.087

我会补充

4.  将 .jar 文件复制到存储卡中，然后在手机文件管理器中打开它

对 Vitaly Polonetsky 的回答。

作为一般规则，应将 J2ME 应用程序部署为 .jad 文件，而不是 .jar 文件。

.jad 文件是一个简单的、小得多的文本文件，其中包含指向 jar 文件的 http:// 链接，供手机 Web 浏览器下载和安装。.jad 文件还允许对应用程序进行签名，因此当它尝试访问移动网络或手机内存时，您可以扩展它的好处。

# ruby-on-rails - 下载开源 Rails 项目后，是否需要 db:migrate？

> ID：786126
> 
> 赞同：0
> 
> 时间：2009-04-24T14:43:03.077
> 
> 标签：ruby-on-rails, ruby

对于 Rails 人来说，这可能是一个非常简单的问题，但让我感到困惑不已。我下载了几个开源 Rails 项目，但无法运行它们。通常，您应该在尝试运行 Rails 项目之前执行 db:migrate 吗？我以为他们应该只是跑。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T14:58:04.537

我想这取决于数据库的配置方式。如果它指向一个 sqlite db，那么它可能已经准备就绪，否则如果它是一个完整的 RDBMS，那么是的，当然，假设 database.yml 中的设置配置正确，则需要迁移数据库。

# c++ - 如何维护 C++/STL 中的函数列表？

> ID：786131
> 
> 赞同：2
> 
> 时间：2009-04-24T14:43:58.610
> 
> 标签：c++, multithreading, vector, glfw

在直接问你我的问题之前，我将描述我的问题的性质。我正在使用 C++/OpenGL 和 GLFW 库编写 2D 模拟。而且我需要正确管理很多线程。在 GLFW 中我们必须调用函数：thread = glfwCreateThread(ThreadFunc, NULL); （第一个参数是执行线程的函数，第二个代表这个函数的参数）。而且glfwCreateThread，每次都必须调用！（即：在每个周期中）。这种工作方式并没有真正帮助我，因为它破坏了我构建代码的方式，因为我需要在主循环范围之外创建线程。所以我正在创建一个 ThreadManager 类，它将具有以下原型：

```
class ThreadManager {

  public:
         ThreadManager();
         void AddThread(void*, void GLFWCALL (*pt2Func)(void*)); 
         void DeleteThread(void GLFWCALL (*pt2Func)(void*));
         void ExecuteAllThreads();

  private:
         vector<void GLFWCALL (*pt2Func)(void*)> list_functions;
         // some attributs             

}; 
```

例如，如果我想添加一个特定线程，我只需要使用特定参数和特定函数调用 AddThread。目标只是能够调用： ExecuteAllThreads(); 在主循环范围内。但为此我需要有类似的东西：

```
void ExecuteAllThreads() {

      vector<void GLFWCALL (*pt2Func)(void*)>::const_iterator iter_end = list_functions.end();
      for(vector<void GLFWCALL (*pt2Func)(void*)>::const_iterator iter = list_functions.begin();
      iter != iter_end; ++iter) {

           thread = glfwCreateThread(&(iter*), param);
      }
} 
```

在 AddThread 中，我只需要将 pt2Func 引用的函数添加到向量：list_functions。

好吧，这是我想做的事情的总体思路..这是正确的方法吗？你有更好的主意吗？如何做到这一点，真的吗？（我的意思是问题在于语法，我不知道该怎么做）。

谢谢 ！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T14:49:53.667

您需要在每个模拟周期中创建线程吗？这听起来很可疑。创建一次线程，然后重复使用它们。

线程创建不是一项廉价的操作。您绝对不想在每个迭代步骤中都这样做。

如果可能的话，我建议您使用 Boost.Thread 来代替线程，以便为您提供类型安全和其他方便的功能。线程足够复杂，不会抛弃类型安全性并针对原始 C API 工作。

也就是说，您要问的是可能的，尽管它会变得混乱。首先，您还需要存储函数的参数，因此您的类看起来像这样：

```
class ThreadManager {

  public:
         typedef void GLFWCALL (*pt2Func)(void*); // Just a convenience typedef
         typedef std::vector<std::pair<pt2Func, void*> > func_vector;
         ThreadManager();
         void AddThread(void*, pt2Func); 
         void DeleteThread(pt2Func);
         void ExecuteAllThreads();

  private:
         func_vector list_functions;
}; 
```

然后执行所有线程：

```
void ExecuteAllThreads() {

      func_vector::const_iterator iter_end = list_functions.end();

      for(func_vector::const_iterator iter = list_functions.begin();
      iter != iter_end; ++iter) {

           thread = glfwCreateThread(iter->first, iter->second);
      }
} 
```

当然，在 AddThread 中，您必须向向量添加一对函数指针和参数。

请注意，Boost.Thread 会更干净地解决大部分问题，因为它希望线程是函子（可以保持状态，因此不需要显式参数）。

您的线程函数可以这样定义：

```
class MyThread {
  MyThread(/* Pass whatever arguments you want in the constructor, and store them in the object as members */);

  void operator()() {
    // The actual thread function
  }

}; 
```

而且由于 operator() 不带任何参数，因此启动线程变得更加简单。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T14:48:07.743

尝试使用 boost::function 存储它们怎么样？

它们可以模拟您的特定功能，因为它们的行为类似于真实对象，但实际上是简单的函子。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-24T15:02:01.703

考虑[Boost 线程和线程组](http://www.boost.org/doc/libs/1_35_0/doc/html/thread/thread_management.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T14:50:35.117

我不熟悉您使用的线程系统。所以请耐心等待。

你不应该维护一个线程标识符列表吗？

```
 class ThreadManager {
     private:
       vector<thread_id_t> mThreads;
     // ...
 }; 
```

然后`ExecuteAllThreads`你会做：

```
 for_each(mThreads.begin(), mThreads.end(), bind(some_fun, _1)); 
```

（使用 Boost Lambda 绑定和占位符参数）其中 some_fun 是您为所有线程调用的函数。

还是您想为给定线程调用一*组函数？*

# c# - 可以在运行时从 .NET WinForms ListView 中删除复选框吗？

> ID：786133
> 
> 赞同：1
> 
> 时间：2009-04-24T14:44:22.137
> 
> 标签：c#, .net, winforms, listview, checkbox

是否可以在运行时从 .NET WinForms ListView 控件中删除复选框？

当 '.Checkboxes' 最初设置为 'true' 并且控件已呈现到具有可用于每个列表视图项的复选框的表单上时，以下代码似乎无效：

```
// C#:
testListView.BeginUpdate();  
testListView.Checkboxes = false;  
testListView.EndUpdate(); 
```

是否有必须调用的方法来执行此更改？当 .Checkboxes 属性默认为“false”并且仅在设置为“true”时才有效时，提供它有什么用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T14:48:33.513

我刚刚使用 VS 2008 使用以下代码创建了一个示例项目，它似乎有效：

```
 private void Form1_Load(object sender, EventArgs e)
    {
        for (int i = 0; i < 10; i++)
        {
            ListViewItem lvi = new ListViewItem("Test");
            listView1.Items.Add(lvi);
        }
    }

    private void button1_Click(object sender, EventArgs e)
    {
        listView1.CheckBoxes = false;
    } 
```

我的列表视图的属性如下：

```
 this.listView1.CheckBoxes = true;
        this.listView1.Columns.AddRange(new System.Windows.Forms.ColumnHeader[] {
        this.columnHeader1});
        this.listView1.GridLines = true;
        this.listView1.Location = new System.Drawing.Point(12, 12);
        this.listView1.Name = "listView1";
        this.listView1.Size = new System.Drawing.Size(224, 174);
        this.listView1.TabIndex = 0;
        this.listView1.UseCompatibleStateImageBehavior = false;
        this.listView1.View = System.Windows.Forms.View.Details; 
```

# wpf - WPF：绑定到选定的 TreeViewItem

> ID：786134
> 
> 赞同：2
> 
> 时间：2009-04-24T14:44:32.947
> 
> 标签：wpf, binding, treeview, hierarchicaldatatemplate

我有一个`TreeView`基于 XML 文件构建的，每个 `TreeViewItem`. 另外，我有一个`TextBlock`和一个`Image`，我想绑定到选定的`TreeViewItem`.

我怎样才能做到这一点？

这是我的 XAML：

```
<Window.Resources>
<HierarchicalDataTemplate DataType="Node" ItemsSource ="{Binding XPath=ChildNode}">
    <StackPanel Orientation="Horizontal">
        <Image Source="{Binding XPath=@Image}"/>
        <TextBlock Text="{Binding XPath=@Name}" />
    </StackPanel>
</HierarchicalDataTemplate>
<HierarchicalDataTemplate DataType="ChildNode" ItemsSource ="{Binding XPath=GrandchildNode}">
    <StackPanel Orientation="Horizontal">
        <Image Source="{Binding XPath=@Image}" />
        <TextBlock Text="{Binding XPath=@Name}" />
    </StackPanel>
</HierarchicalDataTemplate>
<DataTemplate DataType="GrandchildNode">
    <StackPanel Orientation="Horizontal">
        <Image Source="{Binding XPath=@Image}" />
        <TextBlock Text="{Binding XPath=@Name}" />
    </StackPanel>
</DataTemplate>
<XmlDataProvider x:Key="xmlNodeList" Source="XMLFile1.xml" XPath="Root"/></Window.Resources><StackPanel>
<TreeView Name="treeView1" ItemsSource="{Binding Source={StaticResource xmlNodeList}, XPath=Node}" />
<TextBlock />
<Image /></StackPanel> 
```

这是一个 XML 数据：

```
<Root>
<Node Name="AAA" Image="images/1.ico" />
<Node Name="BBB" Image="images/2.ico">
    <ChildNode Name="bbb 1" Image="images/3.ico">
        <GrandchildNode Name="b 1.1" Image="images/4.ico"/>
        <GrandchildNode Name="b 1.2" Image="images/5.ico"/>
        <GrandchildNode Name="b 1.3" Image="images/6.ico"/>
    </ChildNode>
    <ChildNode Name="bbb 2" Image="images/7.ico"/>
    <ChildNode Name="bbb 3" Image="images/8.ico">
        <GrandchildNode Name="b 3.1" Image="images/9.ico"/>
        <GrandchildNode Name="b 3.2" Image="images/10.ico"/>
    </ChildNode>
    <ChildNode Name="bbb 4" Image="images/11.ico"/>
</Node>
<Node Name="CCC" Image="images/12.ico">
    <ChildNode Name="ccc 1" Image="images/13.ico">
        <GrandchildNode Name="c 1.1" Image="images/14.ico"/>
        <GrandchildNode Name="c 2.2" Image="images/15.ico"/>
    </ChildNode>
</Node></Root> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-24T14:55:26.977

如果您将 TextBlock 和 Image 粘贴在另一个 StackPanel 中以使其更容易一些，您可以执行以下操作：

```
<StackPanel DataContext="{Binding ElementName=treeView1, Path=SelectedItem}">
   <TextBlock Text="{Binding XPath=@Name}" />
   <Image Source="{Binding XPath=@Image}" />
</StackPanel> 
```

# python - 如何设计一个电子邮件系统？

> ID：786138
> 
> 赞同：3
> 
> 时间：2009-04-24T14:45:27.703
> 
> 标签：python, linux, email

我在一家为其客户提供客户支持的公司工作。我正在尝试设计一个系统，当某些事件发生时会自动向客户发送电子邮件。该系统将由后端部分和 Web 界面部分组成。后端将处理与 Web 界面的通信（仅供内部使用以更改电子邮件模板），最重要的是它将检查一些数据库表，并根据这些结果发送电子邮件......很多。

现在，我想知道如何设计它以使其可扩展并提供必要的性能，因为它可能必须每小时处理数千封电子邮件（这应该是一瞥）。我最感兴趣的是应该如何考虑这种架构，以便将来在需要时轻松扩展。

Python 将在后端与 Postgres 一起使用，并且可能在 Python Web 框架和前端的 GWT 之间首先出现（这似乎是最简单的任务）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-24T14:51:48.717

这是使用一些现成软件的真正好选择。周围有许多开源邮件列表管理器包；他们已经知道如何进行群发邮件。这些邮件是否每次都发给*同一组人尚不完全清楚。*如果是这样，请获取任何一个常规邮件列表程序。

如果没有，简单的答案是

```
$ mail address -s subject < file 
```

每封邮件一次。

顺便说一下，在网络上调查你上游的任何人的政策。一些 ISP 将大量邮件视为可能的垃圾邮件，并且可能会通过切断或计量您的 Internet 访问来让您感到惊讶。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-24T19:11:25.880

只要您的外发邮件服务器愿意及时接受它们，每小时几千封电子邮件并不算多。

我会使用本地 mta 发送它们，例如 postfix 或 exim（如果需要，它们会通过您的传出中继发送它们）。然后，该服务负责邮件队列、重试、退回等。如果您正在寻找更多“邮件列表”功能，请尝试将 mailman 添加到组合中。它是用 python 编写的，您可能已经看过它，因为它运行着大量的互联网邮件列表。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-24T14:51:16.050

这听起来对我来说，您正在尝试优化批处理，其中热量不会发生在 Web 界面上但在后端。这听起来也是排队架构的一项工作。

例如，如果您确实需要大规模，[亚马逊会提供排队系统。](http://aws.amazon.com/sqs/)因此，您可以添加多台机器以将消息作为电子邮件传递。因此，您允许一台机器一次只能从队列中获取 100 条消息。

电子邮件系统的模式应该是异步的，所以如果您不喜欢队列，请查看其他异步架构。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T19:23:34.243

您可能想尝试使用 Twisted Mail 在纯 Python 中实现您自己的后端。

# ruby-on-rails - Rails：如何防止 2 个活动记录属性与验证相等？

> ID：786139
> 
> 赞同：2
> 
> 时间：2009-04-24T14:45:39.433
> 
> 标签：ruby-on-rails, security, validation

出于安全原因，我想阻止用户使用密码 = 登录进行注册。我试过这样的事情：

```
 validates_each :password do |record, attr, value|
    if(value == self.login)
      record.errors.add(attr)
    end
  end 
```

但我总是收到以下错误： undefined method login for self. 我猜它与类层次结构有关，但我如何访问更高级别。

我有点卡在这里，请帮忙。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T15:01:41.970

尝试

```
if value == record.login 
```

记录作为局部变量传递到块中`record`，在这种情况下不是`self`.

# jquery - 如何在jQuery中检索复选框值

> ID：786142
> 
> 赞同：244
> 
> 时间：2009-04-24T14:45:48.140
> 
> 标签：jquery, html, checkbox

如何使用[jQuery](http://en.wikipedia.org/wiki/JQuery)获取选中的复选框值，并立即将其放入 textarea？

就像这段代码：

```
<html>
  <head>
  </head>

  <body>
    <div id="c_b">
      <input type="checkbox" value="one_name" checked>
      <input type="checkbox" value="one_name1">
      <input type="checkbox" value="one_name2">
    </div>  

    <textarea id="t"></textarea>
  </body>
</html> 
```

如果`id="c_d"`由[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)更新，则下面的 altCognito 代码不起作用。有什么好的解决办法吗？

* * *

## 回答 #1

> 赞同：326
> 
> 时间：2009-04-24T15:01:15.903

这是一个有效的方法（[参见示例](http://jsbin.com/ujuse)）：

```
 function updateTextArea() {         
     var allVals = [];
     $('#c_b :checked').each(function() {
       allVals.push($(this).val());
     });
     $('#t').val(allVals);
  }
 $(function() {
   $('#c_b input').click(updateTextArea);
   updateTextArea();
 }); 
```

## 更新

几个月后，另一个问题是关于如何在 ID 更改时保持上述工作。好吧，解决方案归结为将 updateTextArea 函数映射到使用 CSS 类的通用函数，并使用 live 函数来监视 DOM 的这些更改。

* * *

## 回答 #2

> 赞同：128
> 
> 时间：2011-05-24T20:42:42.300

您还可以以逗号分隔的字符串返回所有选中的复选框值。当您将其作为参数发送到 SQL 时，这也将使您更容易

这是一个示例，它以逗号分隔的字符串返回所有选定的复选框值，其名称为“chkboxName”

这是javascript

```
function showSelectedValues()
{
  alert($("input[name=chkboxName]:checked").map(function () {
    return this.value;
  }).get().join(","));
} 
```

这是 HTML 示例

```
<html>
  <head>
 </head>
 <body>
  <div>
   <input name="chkboxName" type="checkbox" value="one_name" checked>
   <input name="chkboxName" type="checkbox" value="one_name1">
   <input name="chkboxName" type="checkbox" value="one_name2">
  </div>  
 </body>
 </html> 
```

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2009-04-24T14:51:19.950

你的问题很模糊，但我认为这是你需要的：

```
$(function() { 
    $('input[type="checkbox"]').bind('click',function() {
        if($(this).is(':checked')) {
            $('#some_textarea').html($(this).val());
         }
   });
}); 
```

**编辑：**哦，好吧..你去...你之前没有HTML。无论如何，是的，我认为您的意思是在单击该值时将其放入文本区域。如果您希望在页面加载时将选中的复选框的值放入 textarea（可能带有一个很好的逗号分隔符），它会很简单：

```
$(function() { 
    $('#c_b input[type="checkbox"]:checked').each(function() { 
        $('#t').append(', '+$(this).val());
    });
}); 
```

**编辑 2**正如人们所做的那样，您也可以这样做来缩短我写的冗长选择器：

```
$('#c_b :checkbox:checked').each(function() {
    $('#t').append(', '+$(this).val());
}); 
```

...我完全忘记了那个捷径。;)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-06-11T10:11:47.707

感谢 altCognito，您的解决方案有所帮助。我们也可以通过使用复选框的名称来做到这一点：

```
function updateTextArea() {         
   var allVals = [];
   $('[name=chkbox]:checked').each(function() {
      allVals.push($(this).val());
   });
   $('#t').val(allVals)
} 
$(function() { 
    $('#c_b input').click(updateTextArea);
    updateTextArea();
}); 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-12-28T05:00:41.307

以下内容可能很有用，因为我来这里是为了寻找一个稍微不同的解决方案。我的脚本需要自动循环输入元素并且必须返回它们的值（对于 jQuery.post() 函数），问题是复选框返回它们的值而不管检查状态如何。这是我的解决方案：

```
jQuery.fn.input_val = function(){

    if(jQuery(this).is("input[type=checkbox]")) {
        if(jQuery(this).is(":checked")) {
            return jQuery(this).val();
        } else {
            return false;
        }
    } else {
        return jQuery(this).val();
    }
}; 
```

用法：

```
jQuery(".element").input_val(); 
```

如果给定的输入字段是一个复选框，则 input_val 函数仅在选中时返回一个值。对于所有其他元素，无论检查状态如何，都会返回该值。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-04-04T13:48:17.500

如果您需要将值保存到变量中，这是一种替代方法：

```
var _t = $('#c_b :checkbox:checked').map(function() {
    return $(this).val();
});
$('#t').append(_t.join(',')); 
```

（map() 返回一个数组，我发现它比 textarea 中的文本更方便）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-24T15:10:50.233

```
$(document).ready(function() {
  $(':checkbox').click(function() {
    var cObj = $(this);
    var cVal = cObj.val();
    var tObj = $('#t');
    var tVal = tObj.val();
    if (cObj.attr("checked")) {
      tVal = tVal + "," + cVal;
      $('#t').attr("value", tVal);
    } else {
      //TODO remove unchecked value.
    }
  });
}); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-03-04T07:03:25.527

```
 function updateTextArea() {         
     var allVals = $('#c_b :checked').map(function() {
       return $(this).val();
     }).get();
     $('#t').val(allVals)
  }
 $(function() {
   $('#c_b input').click(updateTextArea);
   updateTextArea();
 }); 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-24T14:51:13.460

```
$("#t").text($("#cb").find(":checked").val()) 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-24T14:52:18.687

无论如何，你可能需要这样的东西：

```
 var val = $('#c_b :checkbox').is(':checked').val();
 $('#t').val( val ); 
```

这将获取页面上第一个选中复选框的值，并将其插入到文本区域中`id='textarea'`。

请注意，在您的示例代码中，您应该将复选框放在一个表单中。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-01-09T22:54:06.247

使用另一篇文章的答案，我用来完成相同任务的一种更简单、更简短的方法是这样的：

```
var checkedCities = $('input[name=city]:checked').map(function() {
    return this.value;
}).get(); 
```

最初，城市是从 MySQL 数据库中检索的，并在 PHP while 循环中循环：

```
while ($data = mysql_fetch_assoc($all_cities)) {
<input class="city" name="city" id="<?php echo $data['city_name']; ?>" type="checkbox" value="<?php echo $data['city_id']; ?>" /><?php echo $data['city_name']; ?><br />
<?php } ?> 
```

现在，使用上面的 jQuery 代码，我得到所有 city_id 值，并使用 $.get(...) 提交回数据库

这让我的生活变得如此轻松，因为现在代码是完全动态的。为了添加更多的城市，我只需要在我的数据库中添加更多的城市，不用担心 PHP 或 jQuery 端。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-24T14:55:03.843

如果您想在检查时立即插入任何复选框的值，那么这应该适合您：

```
$(":checkbox").click(function(){
  $("#id").text(this.value)
}) 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-11-05T20:00:44.030

我遇到了类似的问题，这就是我使用上面的示例解决它的方法：

```
 $(".ms-drop").click(function () {
        $(function showSelectedValues() {
            alert($(".ms-drop input[type=checkbox]:checked").map(
               function () { return this.value; }).get().join(","));
        });
    }); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-11-17T19:13:27.250

试试这个。。

```
var listCheck = [];
console.log($("input[name='YourCheckBokName[]']"));
$("input[name='YourCheckBokName[]']:checked").each(function() {
     console.log($(this).val());
     listCheck .push($(this).val());
});
console.log(listCheck); 
```

# python - Django中的基本MVT问题

> ID：786149
> 
> 赞同：6
> 
> 时间：2009-04-24T14:46:45.890
> 
> 标签：python, django, django-templates

我有一个 Django 网站，如下所示：

*   网站有几个视图
*   每个视图都有自己的模板来显示其数据
*   每个模板扩展一个基本模板
*   基础模板是网站的基础，拥有所有的 JS/CSS 和基本布局

所以到目前为止一切都很好。所以现在我们有了站点的主负责人（存在于基本模板中），并且所有视图都是通用的。

但现在我想让它动态化，并为其添加一些动态数据。我应该在哪个观点上这样做？我所有的看法基本上都是`render_to_response('viewtemplate.html', someContext)`。那么如何将通用视图添加到基本模板中呢？

显然我不会将通用代码复制到每个单独的视图中......

我认为我在 Django 的 MVT 基础中遗漏了一些基本的东西。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-24T15:08:44.310

您想使用`context_instance`和`RequestContext`s。

首先，在您的顶部添加`views.py`：

```
from django.template import RequestContext 
```

然后，将所有视图更新为如下所示：

```
def someview(request, ...)
    ...
    return render_to_response('viewtemplate.html', someContext, context_instance=RequestContext(request)) 
```

在您的`settings.py`中，添加：

```
TEMPLATE_CONTEXT_PROCESSORS = (
    'django.core.context_processors.auth',
    ...
    'myproj.app.context_processors.dynamic',
    'myproj.app.context_processors.sidebar',
    'myproj.app.context_processors.etc',
) 
```

其中每一个`context_processors`都是一个函数，它接受`request`对象并以字典的形式返回上下文。只需将所有功能`context_processors.py`放入适当的应用程序中即可。例如，博客可能有一个带有最近条目和评论列表的侧边栏。`context_processors.py`只会定义：

```
def sidebar(request):
    recent_entry_list = Entry.objects...
    recent_comment_list = Comment.objects...
    return {'recent_entry_list': recent_entry_list, 'recent_comment_list': recent_comment_list} 
```

您可以根据需要添加尽可能多或尽可能少的内容。

有关更多信息，请查看[Django 模板文档](http://docs.djangoproject.com/en/dev/ref/templates/api/#id1)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-27T11:51:17.847

上下文处理器和 RequestContext（请参阅 Tyler 的回答）是获取在每次页面加载时使用的数据的方法。对于您可能需要的各种视图上的数据，但不是全部（尤其是与视图的主要目的无关，但出现在导航侧边栏之类的数据），定义自定义模板通常最有意义用于检索数据的标签。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-24T15:50:48.700

或使用[通用视图](https://docs.djangoproject.com/en/1.4/ref/generic-views/)，因为它们会自动传递请求上下文。

可以使用简单的直接模板通用视图来避免在请求上下文中导入/传递。

# windows - 重定向网络请求

> ID：786151
> 
> 赞同：0
> 
> 时间：2009-04-24T14:47:23.627
> 
> 标签：windows, http

我使用第三方应用程序从他们的 Internet 站点请求配置文件。该文件已过期，但我可以使用更新的信息创建自己的文件。

如何将来自我的计算机对特定 URL 的任何请求重定向到不同的文件？例如，如果有任何应用程序请求`http://www.theirsite.com/path/to/file.html`，则使其改为接收`http://www.example.com/blah.html`或`C:\My Documents\blah.html`？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T14:52:21.587

为什么不更改您的主机文件以将查找到他们的网站指向您控制的 Web 服务器？然后添加你自己的配置文件。但是，如果应用程序将网站用于其他资源，您*可能*必须将其他请求重定向到他们的服务器。

# groovy - groovy 使用包含空格的参数执行

> ID：786160
> 
> 赞同：33
> 
> 时间：2009-04-24T14:49:38.660
> 
> 标签：groovy

如何为groovy中字符串的execute方法提供包含空格的参数？只是像在 shell 中那样添加空格并没有帮助：

```
println 'ls "/tmp/folder with spaces"'.execute().text 
```

这将为 ls 调用提供三个损坏的参数。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-25T06:54:08.840

诀窍是使用列表：

```
println(['ls', '/tmp/folder with spaces'].execute().text) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-06-02T09:33:24.527

对不起，上面的技巧都不适合我。这段可怕的代码是唯一通过的：

```
 def command = 'bash ~my_app/bin/job-runner.sh -n " MyJob today_date=20130202 " ' 
    File file = new File("hello.sh")
    file.delete()       
    file << ("#!/bin/bash\n")
    file << (command)
    def proc = "bash hello.sh".execute()                 // Call *execute* on the file 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-01-04T13:19:53.100

对于需要常规报价处理、管道等的人来说，一个奇怪的技巧：使用`bash -c`

```
['bash','-c',
'''
docker container ls --format="{{.ID}}" | xargs -n1 docker container inspect --format='{{.ID}} {{.State.StartedAt}}' | sort -k2,1
'''].execute().text 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-10-16T14:23:04.370

使用列表对我来说有点笨拙。

这将完成这项工作：

```
def exec(act) { 
 def cmd = []
 act.split('"').each { 
   if (it.trim() != "") { cmd += it.trim(); }
 }
 return cmd.execute().text
}

println exec('ls "/tmp/folder with spaces"') 
```

更复杂的例子：

```
println runme('mysql "-uroot" "--execute=CREATE DATABASE TESTDB; USE TESTDB; \\. test.sql"'); 
```

唯一的缺点是需要在所有参数周围加上引号，我可以忍受！

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2009-04-24T15:05:50.400

你试过逃避空间吗？

```
println 'ls /tmp/folder\ with\ spaces'.execute().text 
```

# vb.net - LINQ to Objects - 不在？

> ID：786163
> 
> 赞同：2
> 
> 时间：2009-04-24T14:49:58.003
> 
> 标签：vb.net, linq-to-objects

我有一个自定义对象的通用列表，并希望将该列表减少为特定属性值不在排除列表中的对象。

我尝试了以下方法：

```
Private Sub LoadAddIns()
  // Get add-in templates
  Dim addIns = GetTemplates(TemplateTypes.AddIn)
  // Get the current document
  Dim sectionId As String = CStr(Request.QueryString("sectionId"))
  Dim docId As Integer = CInt(Split(sectionId, ":")(0))
  Dim manual = GetTempManual(docId)
  Dim content As XElement = manual.ManualContent
  // Find which templates have been used to create this document.
  Dim usedTemplates = (From t In content.<header>.<templates>.<template> _
                       Select CInt(t.<id>.Value)).ToList
  // Exclude add-ins that have already been used.
  If usedTemplates IsNot Nothing Then
    addIns = addIns.Where(Function(a) usedTemplates.Contains(a.TemplateID) = False)
  End If
  // Bind available add-ins to dropdown
  With ddlAddIns
    .DataSource = addIns
    .DataTextField = "Title"
    .DataValueField = "TemplateID"
    .DataBind()
    .Items.Insert(0, New ListItem("[select an add-in]", 0))
  End With
End Sub 
```

但得到错误：

> System.InvalidCastException：无法转换类型为“WhereListIterator `1[MyApp.Classes.Data.Entities.Template]' to type 'System.Collections.Generic.List`1 [MyApp.Classes.Data.Entities.Template]”的对象。

如何仅选择模板 ID 不在排除列表中的模板？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-24T15:05:59.260

将 ToList() 扩展添加到 Where 扩展的末尾，以将其转换回适当类型的列表。

```
If usedTemplates IsNot Nothing Then
    addIns = addIns.Where(Function(a) usedTemplates.Contains(a.TemplateID) = False) _
                   .ToList()
End If 
```

# c# - 使用wii nunchuck进行鼠标控制

> ID：786164
> 
> 赞同：3
> 
> 时间：2009-04-24T14:50:14.040
> 
> 标签：c#, mouse

目前，我可以在 C# 应用程序中读取来自 wii 双节棍的信息。

为了学习 pourposes，我想编写一个使用 wii 双节棍控制鼠标的应用程序。

以编程方式控制鼠标的最简单方法是什么？我需要使用 Windows API 吗？

我需要移动指针并模拟点击。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T14:56:32.327

我在 CodePlex 上找到[了 WiiCursor](http://www.codeplex.com/WiiCursor)，它看起来就像你想要的那样，或者你可以从那里提升光标代码并与你自己的代码集成。

顺便说一句，你见过 Johnny Chung Lee 的超级酷[触摸白板吗](http://www.youtube.com/watch?v=5s5EvhHy7eQ&feature=related)

# wcf - 使用 WCF、依赖注入和单元测试的服务间通信架构

> ID：786168
> 
> 赞同：0
> 
> 时间：2009-04-24T14:51:13.447
> 
> 标签：wcf, unit-testing, architecture, soa

我是 WCF 的新手，在很大程度上，我也是分布式编程。我正在做一个需要 4 个离散服务的项目。

我正在尝试正确定义每个服务的每个组件的职责。假设我有需要与服务 A 通信的服务 B。对于每个服务，我定义了服务实现类、服务主机和代理类。

为了进行单元测试，我使用依赖注入 - 因为服务 B 需要与服务 A 通信，所以我已将 A 的代理类的实例作为构造函数参数传递给服务 B。

当我对服务 B 进行单元测试时，我必须让 A 的服务主机启动并运行。

1.  这是进行依赖注入的错误方式吗？如果是这样，为什么，你建议我怎么做？
2.  有没有更好的方法来进行依赖注入？
3.  我是否必须运行服务主机才能在单元测试中获得正确的结果？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T15:15:50.190

考虑使用

*   [ChannelFactory](http://msdn.microsoft.com/en-us/library/ms576132.aspx)而不是生成的客户端。

    ```
    ChannelFactory<IHello> clientFactory = new ChannelFactory<IHello>("targetConfiguration");
    IHello client = clientFactory.CreateChannel();
    string result = client.SayHello(); 
    ```

*   尽可能使用接口类型

*   在编写测试时注入接口实现的模拟对象框架（[示例）之一。](http://ayende.com/projects/rhino-mocks.aspx)

关于您的第三个问题，如果您的目标是测试特定的小单元（单元测试的重点:)，答案是“否”。但是编写一些集成测试以确保您没有任何序列化/托管问题总是更好。

# javascript - 禁用表中的控件 - JQuery/Javascript

> ID：786175
> 
> 赞同：4
> 
> 时间：2009-04-24T14:51:34.333
> 
> 标签：javascript, jquery

我有一个复杂的 UI，其中包含多个嵌套表、一个中继器控件和几个其他 HTML 控件，它们的禁用属性基于 JQuery 中的业务逻辑设置。

我需要一种方法来禁用整个表格（包括嵌套控件、UI 元素等）并在用户切换按钮时重新启用它们。

我可以遍历控件，找到它们中的每一个并应用“禁用”属性，但是当用户选择启用时，我需要检查每个控件最初是否启用（基于第 1 段中解释的业务逻辑）

我所需要的只是一种单独保留初始 UI 并在 UI 上覆盖禁用/启用功能的方法。

有没有一种简单的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T15:11:00.450

这就是 jQuery 选择器发挥作用的地方。如果你给这些项目中的每一个赋予一个类说“禁用”，那么你可以通过执行一个简单的 $(“.disable”) 来使用 jQuery 选择所有项目。

现在你已经拥有了所有的元素，你可以一次对它们做任何你想做的事情，例如

```
$(".disable").attr("disable","disable"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-24T22:30:52.297

我会使用一个 div 在整个表格上分层，基本上使它“不可点击”。为此检查[BlockUI 插件](http://malsup.com/jquery/block/)。

但是，这不会阻止用户使用 TAB 键浏览底层输入元素和超链接，然后他们可以使用 ENTER 键调用它们。为防止这种情况，您必须禁用所有输入元素和锚点（并在适当时重新启用它们）。当然，这可以很容易地完成，使用 jQuery...

```
// Disable
$("#tableIdHere").children(":input, a").attr("disabled", "disabled");

// Enable
$("#tableIdHere").children(":input, a").removeAttr("disabled"); 
```

也许更有效的方法是禁用整个表而不是循环遍历其子表。在使用 IE 之前，我已经成功地做到了这一点，但我不确定结果是否会在浏览器之间保持一致；我将把它留给你来测试......

```
$("#tableIdHere").attr("disabled", "disabled"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T14:53:40.727

签出[blockUI](http://malsup.com/jquery/block/)插件。您可以用它在整个表格上放置一个灰色 div。

这与禁用每个表格控件的效果相同。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T22:40:16.547

如果您选择编写自己的脚本在禁用所有控件时对其进行迭代，请在执行此操作之前检查 disabled 的值。对于禁用时未禁用的控件，请将它们放入窗口（或类）级别的数组变量中。然后，当您想重新启用它们时，仅迭代数组，而不是所有控件。

示例禁用代码：

```
window.enableList = new Array();
controls = tableElement.getElementsByTagName("input"); // May need to repeat this for "select" and "textarea"
for(i = 0; i < controls.length; i++) {
    control = controls[i];
    if(!control.disabled) {
        control.disabled = true;
        window.enableList[enableList.length] = control;
    }
} 
```

重新启用代码示例：

```
for(i = 0; i < window.enableList.length; i++) {
     window.enableList[i].disabled = false;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-27T03:46:48.120

for(var i =0; i< window.enebalelist.length; i++) { window.enablesList[i].disable = True;}

# c++ - 我应该如何将数据类链接到我的 GUI 代码（在 C++ 中显示对象的属性）？

> ID：786182
> 
> 赞同：0
> 
> 时间：2009-04-24T14:52:57.187
> 
> 标签：c++, database, qt, visualization, boost-graph

我有一个类（在 C++ 中），调用它`Data`，当代码运行时它有数千个实例（对象）。我有一个小部件（在 Qt 中），调用它`DataWidget`来显示对象的属性。为了快速构建小部件，我只是将对象属性写入文件并让小部件解析文件中的属性 - 这种方法有效，但不可扩展或不美观。

更清楚地说，我的要求是：
*1* -`DataWidget`应该能够同时显示多个不同的`Data`对象属性
*2* -`DataWidget`应该能够`Data`每秒显示数千个对象
*3* -`DataWidget`应该与生成新`Data`对象的代码一起运行
*4* - 每个`Data`对象都需要永久保存到文件/数据库

目前，GUI 已创建并`DataWidget`创建，然后实验运行并生成数千个`Data`对象（定期将其中一些写入文件）。实验运行后，`DataWidget`显示最后`Data`写入文件的对象（它们被写入 XML 文件）。

使用我当前的文件方法，我可以通过在实验运行后抓取多个文件来满足*(1) 。*由于实验与无关，因此没有并发性，因此在添加一个通知新文件存在的信号之前`DataWidget`，我无法执行*(3) 。*`DataWidget`

我没有继续使用这种方法有两个原因：首先，即使文件没有立即写入磁盘，我无法想象这种方法是可扩展的，除非*我*实现一个缓存系统——但是，这似乎是我我要重新发明轮子？其次，`Data`是图形数据结构的包装器，我正在使用 Graphml（通过 Boost 图形库，即*write_graphml()*）将结构写入 XML 文件，并使用 Boost 的*read_graphml()*将结构读回需要我将文件读回`Data`对象...这意味着程序的实验部分将对象编码为 XML，将 XML 写入文件（但希望在内存中而不是磁盘中），然后`DataWidget`从文件中读取 XML 并将其解码为对象！

在我看来，我应该使用一个可以处理所有缓存等的数据库。此外，似乎我应该能够跳过文件/数据库`Data`步骤`DataWidget`并将的列表`Data`）。然而，我还想将文件保存`Data`到文件/数据库步骤并非完全没有意义——我只是在错误的时间以错误的方式使用它。

考虑到我的要求，更好的方法是什么？

是否有任何通用资源和/或指南来处理和显示此类数据？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T15:04:23.210

> 在我看来，我应该使用一个可以处理所有缓存等的数据库。此外，我似乎应该能够跳过文件/数据库步骤并将数据传递给程序中的 DataWidget（也许将它传递给参考数据列表）。然而，我还想将数据保存到文件/数据库步骤并非完全没有意义——我只是在错误的时间以错误的方式使用它。

如果您需要显示如此快速变化的数据，拥有中间文件或数据库会减慢速度并可能成为瓶颈。我认为 Widget 应该直接从内存中读取新生成的数据。不过，这并不妨碍您将数据存储在文件或数据库中，它可以在单独的线程/进程中完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T15:21:05.823

如果所有数据项都适合内存，我会说将它们放在向量/列表中，并将对它的引用传递给 DataWidget。当需要保存它们时，将引用传递给您的序列化方法。然后，您的实验只是填充数据结构以供其他进程使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T17:02:29.997

我看到你正在使用 Qt。这很好，因为 Qt 4.0 及更高版本包含一个强大的模型/视图框架。我认为这就是你想要的。

[模型/视图](http://doc.trolltech.com/4.5/model-view-programming.html)

基本上，让您的`Data`类继承并实现 QAbstractItemModel 或不同的 Qt Model 类，具体取决于您想要的模型类型。然后设置您的视图小部件（很可能是 QListView）以`Data`用于其模型。

他们的站点上有很多示例，并且该解决方案可以很好地适应大型数据集。

补充：来自 labs.trolltech.com 的模型测试代码非常方便：

[http://labs.trolltech.com/page/Projects/Itemview/Modeltest](http://labs.trolltech.com/page/Projects/Itemview/Modeltest)

# wpf - WPF：在运行时从 App.xaml 更改资源（颜色）

> ID：786183
> 
> 赞同：12
> 
> 时间：2009-04-24T14:53:05.423
> 
> 标签：wpf, xaml, resources, customization, app.xaml

我试图通过允许用户从颜色选择器对话框中选择一种颜色来使我的应用程序更具可定制性，然后实时更改应用程序的样式（使用`DynamicResource`）

**如何更改驻留在 中的特定资源`app.xaml`？**

* * *

我已经尝试过这样的事情，但没有运气（只是一个测试）：

```
var colorDialog = new CustomControls.ColorPickerDialog();
var dResult = colorDialog.ShowDialog();
var x = Application.Current.Resources.Values.OfType<LinearGradientBrush>().First();
x = new LinearGradientBrush();
x.GradientStops.Add(new GradientStop(colorDialog.SelectedColor,1)); 
```

这是文件的摘录`app.xaml`：

```
<Application.Resources>
    <LinearGradientBrush x:Key="HeaderBackground" StartPoint="0.5,0" EndPoint="0.5,1">
        <GradientStop Color="#82cb02" Offset="1"/>
        <GradientStop Color="#82cb01" Offset="0.2"/>
        <GradientStop Color="#629a01" Offset="0.5"/>
    </LinearGradientBrush>
</Application.Resources> 
```

**允许这种形式的可定制性（基本上只是更改一些颜色）到应用程序的最佳方式是什么？**

* * *

**[更新]**

我刚刚从之前提出的问题中找到[了这个答案](https://stackoverflow.com/questions/529621/wpf-edit-resource/529687#529687)，并尝试了它，但我得到了与给定答案的评论中提到的相同的**InvalidOperationException**异常 Petoj。以下是答案中的示例代码：

*xml* :

```
<LinearGradientBrush x:Key="MainBrush" StartPoint="0,0.5" EndPoint="1,0.5" >
    <GradientBrush.GradientStops>
        <GradientStop Color="Blue" Offset="0" />
        <GradientStop Color="Black" Offset="1" />
    </GradientBrush.GradientStops>
</LinearGradientBrush> 
```

*C＃：*

```
LinearGradientBrush myBrush = FindResource("MainBrush") as LinearGradientBrush;
myBrush.GradientStops[0].Color = Colors.Red; 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-24T19:32:30.773

看起来你正在尝试做某种剥皮？

我建议在包含在单独文件中的资源字典中定义资源。然后在代码中（App.cs 加载默认值，然后在其他地方进行更改）您可以像这样加载资源：

```
//using System.Windows
ResourceDictionary dict = new ResourceDictionary();
dict.Source = new Uri("MyResourceDictionary.xaml", UriKind.Relative);

Application.Current.Resources.MergedDictionaries.Add(dict); 
```

You could also define the default resource dictionary in App.xaml and unload it in code just fine.

Use the MergedDictionaries object to change the dictionary you're using at runtime. Works like a charm for changing an entire interface quickly.

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-27T12:43:11.373

Changing application wide resources in runtime is like:

```
Application.Current.Resources("MainBackgroundBrush") = Brsh 
```

About the InvalidOperationException, i guess WallStreet Programmer is right. Maybe you should not try to modify an existing brush, but instead create a new brush in code with all the gradientstops you need, and then assign this new brush in application resources.

Another Approach on changing the color of some GradientStops is to define those colors as DynamicResource references to Application Wide SolidColorBrushes like:

```
<LinearGradientBrush x:Key="MainBrush" StartPoint="0, 0.5" EndPoint="1, 0.5" >
<GradientBrush.GradientStops>
    <GradientStop Color="{DynamicResource FirstColor}" Offset="0" />
    <GradientStop Color="{DynamicResource SecondColor}" Offset="1" />
</GradientBrush.GradientStops> 
```

and then use

```
Application.Current.Resources["FirstColor"] = NewFirstColorBrsh
Application.Current.Resources["SecondColor"] = NewSecondColorBrsh 
```

HTH

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-05-05T19:07:15.283

Use the `Clone()` method to make a deep copy of the brush (or any other freezable object like `Storyboard`) and then use it:

```
LinearGradientBrush myBrush = FindResource("MainBrush") as LinearGradientBrush;
myBrush = myBrush.Clone();
myBrush.GradientStops[0].Color = Colors.Red; 
```

@WallstreetProgrammer is right - all application level resources are frozen by default.

Thats why you need to clone the object first.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-24T19:02:11.470

你得到一个异常，因为你试图修改一个冻结的对象。如果它们是可冻结的并且 LinearGradientBrush 是，则所有应用程序级别的资源都会自动冻结。如果您将其添加到较低级别（例如窗口级别），它将起作用。

# python - Django restapi 将参数传递给 read()

> ID：786199
> 
> 赞同：0
> 
> 时间：2009-04-24T14:56:40.297
> 
> 标签：python, django

在第 19 行的测试示例[http://django-rest-interface.googlecode.com/svn/trunk/django_restapi_tests/examples/custom_urls.py](http://django-rest-interface.googlecode.com/svn/trunk/django_restapi_tests/examples/custom_urls.py)中，他们解析 request.path 以获取 poll_id。这在我看来非常脆弱。如果 url 更改，则此行会中断。我试图传递 poll_id 但这没有用。所以我的问题是如何使用从 url 收集的 poll_id （或任何其他值）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T15:34:02.033

仅当关联的 url 匹配时才调用视图。通过正确制作 url 正则表达式，您可以保证传递给您的视图的任何请求都将`poll_id`位于请求路径中的正确位置。这就是示例的作用：

```
url(r'^json/polls/(?P<poll_id>\d+)/choices/$', json_choice_resource, {'is_entry':False}), 
```

视图是的`json_choice_resource`一个实例，`django_restapi.model_resource.Collection`因此该`read()`方法`Collection`只会对具有预期格式路径的请求起作用。

# iphone - 如何获取 UIWebView 上的当前滚动位置

> ID：786214
> 
> 赞同：11
> 
> 时间：2009-04-24T15:01:07.587
> 
> 标签：iphone, objective-c, uiwebview, webview

我有一个 UIWebView 我怎样才能得到它的滚动位置？

我知道，那 UIWebView 有一个 UIScroller 子视图。但我无法得到这个 UIScroller 的偏移量（（（

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2012-05-07T11:22:21.443

有一种更好、更资源友好的方法可以做到这一点：

```
UIWebView *webView;
CGFloat offset = webView.scrollView.contentOffset.y; 
```

通过[http://developer.apple.com/library/ios/#documentation/uikit/reference/UIWebView_Class/Reference/Reference.html](http://developer.apple.com/library/ios/#documentation/uikit/reference/UIWebView_Class/Reference/Reference.html)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-24T17:23:09.557

这个技巧对我有用。

```
UIWebView *webView;
int scrollPosition = [[webView stringByEvaluatingJavaScriptFromString:@"window.pageYOffset"] intValue]; 
```

请参考 zamber 给出的答案，以获得 iOS 5 及更高版本的更好解决方案。我的答案是针对 iOS 4 及更低版本。

# css - 缩进层次表结构

> ID：786219
> 
> 赞同：2
> 
> 时间：2009-04-24T15:02:04.810
> 
> 标签：css, html-table, hierarchical

我正在尝试创建嵌套表的分层显示，其中每个子级别都从父级进一步缩进。我愿意使用表格或 div。我最接近的是下面。它在 IE 中看起来大部分是正确的（除了右边的边框被混合在一起）。在 Chrome 中，子项边框超出了右侧的父项。

我也愿意使用 div。

```
<html> 
<head> 
<style type="text/css"> 
.ItemTable
{
    width: 100%;
    margin-left: 20px;
    border: solid 1px #dbdce3;
}
</style> 
</head> 
<body> 
    <table class="ItemTable">
        <tr>
            <td>Item 1</td>
        </tr>
        <tr>
            <td>
                <table class="ItemTable">
                    <tr>
                        <td>Item  1A</td>
                    </tr>
            </td>
        </tr>
    </table>
</body> 
</html> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T15:12:17.343

看起来有几件事。您的子表缺少它的关闭标记，我在 TD 中添加了填充以帮助缩进：

```
<style type="text/css">
    .ItemTable
    {
        width: 100%;

        border: solid 1px #dbdce3;
    }
    .ItemTable td
    {
        width: auto;
        padding-left: 20px;
        border: solid 1px #dbdce3;
    }
</style>

<table class="ItemTable">
    <tr>
        <td>
            Item 1
        </td>
    </tr>
    <tr>
        <td>
            <table class="ItemTable">
                <tr>
                    <td>
                        Item 1A
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table> 
```

在 Chrome、FF、IE6、IE7 和 Safari 中对其进行了测试，看起来它可以正常工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-25T19:51:36.460

您打算显示表格数据吗？如果不是这样，您最好只使用 div 并为子元素应用边距，如下所示

```
<style>
    #container {border:1px solid #999}
    .indent {margin-left:50px; border:1px solid #999;}
    .item {background:#99cc00;}
</style>

<div id="container">
    <span class="item">This is item 1</span>

    <div class="indent">
        <span class="item">This is item 2</span>

        <div class="indent">
            <span class="item">This is item 3</span>
        </div>

    </div>

</div> 
```

当然，这实际上取决于您要显示的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T15:09:17.677

改变

```
margin-left: 20px; 
```

至

```
padding-left: 20px; 
```

在 IE7、firefox 和 chrome 上为我工作（尽管使用 chrome 我不得不取消最大化窗口然后重新最大化它 - 对我来说看起来像是一个渲染错误）

# php - 邮件返回假

> ID：786221
> 
> 赞同：18
> 
> 时间：2009-04-24T15:02:35.697
> 
> 标签：php

我目前在工作中使用定制的库。直到最近，图书馆才运转良好。从今天开始，它显然返回错误。

库本身基本上是函数邮件的包装器。它建立了“边界”部分和一切。

由于课程足够大，我不会在这里发布......但我想知道，理论上为什么邮件会返回错误的原因是什么？

*   SMTP 在 PHP.ini 中设置
*   发件人在标头中设置
*   发件人的形式是：`sender<sender@email.com`>
*   一切都正确发送（正文+标题+主题）
*   假设 mail() 在网站上正常工作，但在这个特定页面上却不能。我知道它一定来自我，但有地方开始寻找会很有趣。
*   哦，是的，图书馆是无证的。

[edit] 刚找到一个小函数还是不行，那我打印一下：

```
function send_html($from, $email, $subject = "AUCUN", $message, $cc = "", $bcc ="", $priotity = "3") {
    $headers = "";
    $headers .= "MIME-Version: 1.0\r\n"; 
    $headers .= "Content-type: text/html; charset=iso-8859-1\r\n";

    if (strpos($from, "ourwebsite.com") != false || strpos($from, "rencontresportive.com") != "") {
        $headers .= "From: Ourwebsite.com <" . $from . ">\r\n";
    } else {
        $headers .= "From: " . $from . " <" . $from . ">\r\n";
    }

    $headers .= "X-Sender: <" . $from . ">\r\n";
    $headers .= "X-Priority: " . $priotity . "\r\n";
    $headers .= "X-Mailer: PHP\r\n";
    $headers .= "Return-Path: <admin@ourwebsite.com>\r\n";

    if ($cc != "") {
        $headers .= "cc:" . $cc . "\r\n";
    }
    if ($bcc != "") {
        $headers .= "bcc:" . $bcc . "\r\n";
    }
        if (mail($email, $subject, $message, $headers)) {
        return true;
    } else {
        return false;
    }
} 
```

我用以下方式调用它：

```
send_html(contact@ourwebsite.com, me@me.com, utf8_decode("the subject"), "<h1>test</h1>"); 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-09-08T19:55:51.527

我只是有同样的问题。php 升级后，mail 函数总是返回 false。

我用这个小片段来检查它：

```
<?php
error_reporting(E_ALL|E_STRICT);
ini_set('display_errors', 1);
echo 'I am : ' . `whoami`;
$result = mail('myaddress@mydomain.com','Testing 1 2 3','This is a test.');
echo '<hr>Result was: ' . ( $result === FALSE ? 'FALSE' : 'TRUE') . $result;
echo '<hr>';
echo phpinfo(); 
```

解决方案是在我的 php.ini 中为“sendmail_from”和“sendmail_path”设置一个值。在我的情况下，正确的值是：

```
sendmail_from = "no-reply@mydomain.net"
sendmail_path = "/usr/sbin/sendmail -t -i" 
```

（我使用的是带有 Zend Server CE 的 CentOS 5.3。）

您可以使用 ini_set() 设置 'sendmail_from' 的值，但必须在 php.ini 或 http.conf 中设置 'sendmail_path' 变量。

*   [http://us3.php.net/manual/en/configuration.changes.modes.php](http://us3.php.net/manual/en/configuration.changes.modes.php)
*   [http://us3.php.net/manual/en/ini.list.php](http://us3.php.net/manual/en/ini.list.php)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-08-18T16:12:01.140

我有类似的问题，即使成功接收到邮件，邮件功能也总是返回 false。

我在php配置文件php.ini中找到，我已经设置好了

```
; For Win32 only.
;sendmail_from = me@example.com

; For Unix only.
sendmail_path = "/usr/sbin/sendmail -t -i -f "care@mydomain.com" 
```

我已将其更改为以下

```
; For Win32 only.
;sendmail_from = me@example.com

; For Unix only.
sendmail_path = /usr/sbin/sendmail -t -i -f care@mydomain.com 
```

根据这个 sendmail_from 是针对 win32 的，所以在 *unix 操作系统中，我们需要设置值，如 sendmail_path 变量中所示。

问候米内什

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-24T15:12:23.100

如果该类只是函数邮件的包装器，我会尝试将调用邮件函数时使用的参数打印到文件中

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-24T17:33:59.607

尝试设置

```
ini_set('sendmail_from', $from); 
```

如果您可以向我们展示代码，则更容易看出出了什么问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-24T15:07:04.280

您尝试将其发送到的地址，处理它的服务器可能会拒绝邮件。

涉及的变量太多，无法确定。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-04-09T12:22:37.983

一个好的开始是检查错误日志。

对于 apache 和 Ubuntu（例如），错误日志位于`/var/log/apache2/error.log`.

这可以为您提供有关到底是什么失败的线索。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-24T15:30:55.737

您是否假设 mail() 函数有效，您已经测试过？我会检查以确保库不只是传递了 mail() 函数的失败。

如果您已经测试了假设，我会查看库中的 return 语句，看看我是否能找到导致错误值的原因。即使在未记录的代码中，这通常也是合理的。

# c# - ASP.NET MVC 身份验证的用户在登录后被定向到错误的路由

> ID：786228
> 
> 赞同：1
> 
> 时间：2009-04-24T15:04:37.783
> 
> 标签：c#, asp.net-mvc, asp.net-mvc-routing

我正在使用 Visual Web Developer Express（临时）使用 1.0 版本构建一个 ASP.NET MVC 应用程序。我正在使用 SqlMembership Provider 和表单身份验证来处理站点的安全性。我的站点安全要求用户在看到任何内容之前先登录——除了登录页面本身之外，没有匿名用户页面。

我更改了 global.asax.cs 中的路由，如下所示：

```
 routes.MapRoute(
        "Default",                                              // Route name
        "{controller}/{action}/{id}",                           // URL with parameters
        new { controller = "Patients", action = "Search", id = "" }  // Parameter defaults
    ); 
```

我在我的本地 IIS (Windows XP) 上发布了该应用程序并点击了虚拟目录，如下所示： [http://mymachinename/App/](http://mymachinename/App/)。我按预期被定向到登录（帐户/登录）页面。但是，在使用新用户帐户成功登录后，我被重定向到主页/索引而不是患者/搜索。Home 控制器和 Index 视图仍然存在于应用程序中，因为我还没有删除它们（我们可能决定将主页显示为应用程序的第一页）。

我即将从项目中删除 Home 控制器和相关视图，因为我已经尝试了许多其他事情，包括从头开始干净发布、重新启动 Web 服务器和清除我的浏览器缓存。但是我很好奇为什么会发生这种情况，因为我在我的任何项目文件中都找不到对 Home/Index 的任何其他引用，包括 global.asax.cs 和 web.config。有人有什么想法吗？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T15:30:37.267

主页/索引是否有可能被定义为 web.config 中的 defaultUrl？

```
<authentication mode="Forms">
    <forms loginUrl="~/Account/LogOn" timeout="2880" 
        defaultUrl="~/Home/Index" />
</authentication> 
```

# iphone - 如果我不手动加载笔尖，是否必须释放笔尖的顶级对象？

> ID：786248
> 
> 赞同：0
> 
> 时间：2009-04-24T15:08:39.630
> 
> 标签：iphone, cocoa-touch, memory-management

据我了解，如果我自己以编程方式加载它，我必须从我的 Nib 文件中释放顶级对象（包括窗口、自定义控制器对象……）。

但是我必须在一个只有一个主 nib 文件的简单的基于视图的应用程序中关心它们吗？

当有一个使用 UITabBarController 和多个 Nib 文件的基于视图的应用程序时，我是否必须关心它们？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T18:10:19.317

不会。在所有情况下，nib 都会加载一次，然后在您的应用关闭时卸载 - 您不必管理内存。当您不创建多个给定对象时，不会发生内存泄漏。

# internet-explorer - iframe、pdf 和 Internet Explorer 的焦点

> ID：786252
> 
> 赞同：3
> 
> 时间：2009-04-24T15:08:47.680
> 
> 标签：internet-explorer, pdf, iframe, adobe, focus

所以 - 我有一个页面，其中包含一个 textarea 和一个动态创建的 IFrame，它使用 adobe acrobat 插件显示 PDF。

最初，文本区域是聚焦的。

我希望 textarea 被聚焦，但是 IFrame 在加载 pdf 时会窃取焦点。

在 Firefox 中，将 textarea 重置为焦点元素是微不足道的。

我通过监听 iframe“加载”事件然后在文本框上调用 .focus() 来做到这一点。

M$ IE 不会触发动态创建的 Iframe 的 onload 事件，因此要确定它何时准备就绪，我使用 IFrame 的 readyState 属性：

```
var ieIframeReadyHandler = function() { 
    if( iframe.readyState=="complete" ) {
           textarea.focus();
    } else {
        setTimeout(ieIframeReadyHandler, 100);
    }
}

setTimeout(ieIframeReadyHandler, 100); 
```

注意：我不听 iframe 的 readystatechanged 事件，因为它似乎不会为 readyState=="complete" 案例触发！

那么当这段代码执行时会发生什么？.....好吧，什么都没有。Iframe pdf 仍然是焦点，但是如果我使用 document.activeElement 检查哪个元素具有焦点（以前这只是 IE，但是 firefox 3 现在支持这一点）我被告知 textarea 确实有焦点！

我勒个去？？！？

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-27T20:15:01.317

尝试将焦点设置延迟 200-500 毫秒。这是很常见的IE问题。

编辑：

在 IFRAME 中使用 onLoad 事件：

```
<body onLoad="parent.window.check_focus()"> .... </body> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-27T01:03:00.897

`iframe.attachEvent("onload", function(){ })`是在 IE 中做`iframe` `onload`事件的方式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T06:49:24.670

在 Internet Explorer 中，iframe 的 readystate 属性仅在 iframe 内部更新，而不在其外部更新。无论出于何种原因，这是设计使然。从 iframe 外部没有可靠的方法来确定 iframe 内容是否已加载。

如果在页面加载时立即显示 iframe 并不重要，您可以简单地等待加载它，直到用户请求它（通过链接或按钮）。这样他们就可以期待了。

如果 PDF 在本地托管（或者您不介意进行一些缓存），另一种选择是使用 Flash 和 SWFTools 中的[PDF2SWF](http://www.swftools.org/)等工具在后端进行转换。

# java - 是否有任何 Java 库可用于 Windows GUI 的自动化测试？

> ID：786253
> 
> 赞同：1
> 
> 时间：2009-04-24T15:08:52.623
> 
> 标签：java, windows, user-interface, automated-tests, fitnesse

目前我正在使用 FitNesse (Java) 进行自动化集成测试，并已成功插入 Watij 以访问基于 Web 的应用程序。我想扩展它以驱动 Windows GUI（非 Java）应用程序。为此，是否有任何可用的 Java 库可供我以类似方式使用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-20T20:43:22.040

马特，

我不认为您将能够使用 Java 库测试您的非 Java GUI。

话虽如此，您可以查看 AutomationAnywhere (.com)，看看它是否符合您的需求。该工具非常强大且非常昂贵，如果您的公司要为此付费，这可能不是问题。您可以尝试免费试用，看看您的想法。

祝你好运，

-罗伯特

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T18:04:15.900

[Abbot](http://abbot.sourceforge.net/doc/overview.shtml)是我所知道的，它很好而且免费。我不知道这是否适合你的情况。您还可以查看[UISpec4J](http://www.uispec4j.org/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-01T18:48:58.573

有用于 GUI 测试的基于 Java 的（商业）工具，例如[Squish](http://www.froglogic.com/squish/)或[GUIdancer](http://www.guidancer.com/)。

如果他们还没有公开 Java API，我相信您可以与他们的支持人员交谈以添加此类功能。

# dll - 使用 DLL 中的动态链接库 (wxWidgets) 的问题

> ID：786264
> 
> 赞同：0
> 
> 时间：2009-04-24T15:09:39.347
> 
> 标签：dll, wxwidgets

我们创建了一个插件；它是一个 DLL（运行时动态链接），它使用第 3 方库（wxWidgets）并动态链接到该库。主机软件似乎扫描了我们的插件，但没有调用导出的函数。我们使用 DependencyWalker 检查了所有依赖项。

我们在调试器中看到插件被加载了，但是 DllMain 没有被调用，插件被卸载了。

我们尝试使用 LoadLibrary 和 GetProcAddress 从一个简单的测试应用程序加载我们的插件，它们识别并调用导出的函数。

不过，静态链接 wxWidgets 效果很好。

有谁知道为什么不调用导出的函数，分别是 DllMain，或者可以指出一个能够监视整个 DLL 加载过程的工具？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T15:16:41.683

如果在您的插件加载之前 wxWidgets 已经加载到进程地址空间中（主机应用程序可以这样做，或者可能有另一个插件链接到 wxWidgets 在您之前加载），那么它可能是另一个版本，缺少您的插件需要的一些入口点。在 DependencyWalker 或 WinDbg 下运行主机应用程序应该会显示加载了哪个 wxWidgets DLL，并且您可以尝试使用完全相同的 wxWidgets DLL 从测试应用程序加载插件。这应该揭示是否缺少依赖项。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T15:16:59.280

也许主机软件在加载插件时做了一些时髦的事情并且不喜欢 wxWindows。

无论如何，尝试使用[SysInternals](http://technet.microsoft.com/en-us/sysinternals/bb842062.aspx)套件中的 ProcessExplorer 来检查进程在做什么。

# c# - 如何在不使用 foreach 的情况下将 ArrayList 转换为强类型泛型列表？

> ID：786268
> 
> 赞同：65
> 
> 时间：2009-04-24T15:10:17.987
> 
> 标签：c#, .net, list, arraylist, generic-list

请参阅下面的代码示例。我需要`ArrayList`成为一个通用列表。我不想使用`foreach`.

```
ArrayList arrayList = GetArrayListOfInts();  
List<int> intList = new List<int>();  

//Can this foreach be condensed into one line?  
foreach (int number in arrayList)  
{  
    intList.Add(number);  
}  
return intList; 
```

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2009-04-24T15:11:27.983

尝试以下

```
var list = arrayList.Cast<int>().ToList(); 
```

这仅在使用 C# 3.5 编译器时才有效，因为它利用了 3.5 框架中定义的某些扩展方法。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-24T15:16:18.753

这是低效的（它不必要地创建了一个中间数组）但是很简洁并且可以在 .NET 2.0 上工作：

```
List<int> newList = new List<int>(arrayList.ToArray(typeof(int))); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-02-22T17:30:13.407

使用扩展方法怎么样？

来自[http://www.dotnetperls.com/convert-arraylist-list](http://www.dotnetperls.com/convert-arraylist-list)：

```
using System;
using System.Collections;
using System.Collections.Generic;

static class Extensions
{
    /// <summary>
    /// Convert ArrayList to List.
    /// </summary>
    public static List<T> ToList<T>(this ArrayList arrayList)
    {
        List<T> list = new List<T>(arrayList.Count);
        foreach (T instance in arrayList)
        {
            list.Add(instance);
        }
        return list;
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-07-04T11:50:12.947

在 .Net 标准 2 中使用`Cast<T>`更好的方法：

```
ArrayList al = new ArrayList();
al.AddRange(new[]{"Micheal", "Jack", "Sarah"});
List<int> list = al.Cast<int>().ToList(); 
```

> `Cast`并且`ToList`是`System.Linq.Enumerable`类中的扩展方法。

# asp.net - 本地 ASP.Net 连接问题

> ID：786269
> 
> 赞同：1
> 
> 时间：2009-04-24T15:10:19.140
> 
> 标签：asp.net, web-services, connection

我一直在尝试设置我最近重新映像的工作站，以使用我们的一个 ASP.Net 应用程序，该应用程序由一个 ASP.Net 网站和一些 C# Web 服务组成。我可以成功启动每个服务和网站的调试实例。但是，一旦该站点尝试连接并使用其中一项 Web 服务，我就会收到以下异常。

> 无法建立连接，因为目标机器主动拒绝它 127.0.0.1:80
> 
> **说明：**执行当前 Web 请求期间发生未处理的异常。请查看堆栈跟踪以获取有关错误及其源自代码的位置的更多信息。
> 
> **异常详细信息：** System.Net.Sockets.SocketException：无法建立连接，因为目标机器主动拒绝它 127.0.0.1:80

所以看起来我的电脑拒绝连接到自己。我的第一个想法是检查 Windows 防火墙是否已禁用并且已禁用（服务未运行）。我认为 IT 部门没有在这台 PC 上运行任何其他防火墙软件，所以我有点不知道还有什么可能导致连接被拒绝。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T15:13:45.513

愚蠢的问题，但你真的在你的机器上安装了 IIS 吗？当您运行应用程序的调试实例时，它在 IIS 之外运行。如果您正在运行站点和服务的调试实例，则您的服务可能未在端口 80 上运行。

仔细检查您的 IIS 安装...然后正确设置在端口 80 上运行的服务。

# c# - 为什么 DirectoryInfo.GetFiles() 匹配不匹配掩码的文件？

> ID：786278
> 
> 赞同：7
> 
> 时间：2009-04-24T15:11:12.993
> 
> 标签：c#, windows

基本上，我有这个代码：

```
DirectoryInfo dir = new DirectoryInfo(@"\\MYNETWORK11\ABCDEFG\ABCDEFGHIJKL\00806\");
FileInfo[] files = dir.GetFiles("200810*"); 
```

我希望它匹配以 200810 开头的任何文件。但是，它匹配名为

*20070618_00806.bak 和 20070817_00806.bak*（星星不在文件名中，这是我可以包含下划线的唯一方法）

我在命令提示符下使用 dir 进行了尝试，它也与这些文件匹配。为什么？

编辑：

也许使用 C: 作为示例并不是一件好事。我实际查询的目录是网络共享 \\MYNETWORK11\ABCDEFG\ABCDEFGHIJKL\00806\

如果检查短名称与它有关，那么20070817_00806.bak不会是200708~1.bak吗？这也不匹配

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-24T15:17:40.043

[msdn](http://msdn.microsoft.com/en-us/library/8he88b63.aspx)指出

> “由于此方法同时检查具有 8.3 文件名格式和长文件名格式的文件名，因此类似于“ `*1*.txt`”的搜索模式可能会返回意外的文件名。例如，使用“”的搜索模式`*1*.txt`将返回“ `longfilename.txt`”，因为等效的 8.3 文件名格式为“ `longf~1.txt`”。

这可能是原因吗？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-24T15:41:54.400

从命令行试试这个：

```
dir /x 200810* 
```

"/x" 将使它显示短文件名和长文件名。这将让您查看短文件名是否确实以“200810”开头。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-24T15:16:49.407

无论是从命令行还是在测试应用程序中，我都无法重现这一点：

```
c:\Users\Jon\Test>echo > 20070618_00806.bak

c:\Users\Jon\Test>echo > 2007081700806.bak

c:\Users\Jon\Test>dir 200810*
 Volume in drive C is OS
 Volume Serial Number is B860-7E20

 Directory of c:\Users\Jon\Test

File Not Found 
```

和 C# 应用程序：

```
using System;
using System.IO;

class Test
{
    static void Main()
    {
        foreach (var file in new DirectoryInfo(".").GetFiles("200810*"))
        {
            Console.WriteLine(file);
        }
    }
} 
```

（这不会打印任何结果。）

也许某处的某些操作系统设置会有所不同……您使用的是哪个操作系统？（我在 32 位 Vista 上。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T15:17:53.973

GetFiles 将搜索长文件名和短文件名......它与短文件名不匹配是吗？

# asp.net-mvc - 我如何根据 mvc asp.net 中的登录用户切换视图

> ID：786282
> 
> 赞同：0
> 
> 时间：2009-04-24T15:11:41.493
> 
> 标签：asp.net-mvc, authentication

我需要根据登录用户的用户类型重定向用户或显示未授权页面。

这里有一些会给你一个想法。

```
public ActionResult Index()
{
    if (Request.Cookies["isadmin"].Value != "true")
        return View("NotAuthorized","Index");
    else
        return View();
} 
```

在这里，我创建了以 NotAuthorized 作为视图名称和 projectname.Models.NotAuthorized 作为强类型视图的新视图。

构建并运行项目后，它给了我以下错误。

> 解析器错误消息：无法加载类型“System.Web.Mvc.ViewPage”。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T15:29:26.147

你用的是最终版吗？您是否使用 VS 模板创建了项目？此外，请检查您的项目参考。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-25T07:56:20.657

是的 ：-）

我明白了，这里有解决方案。

```
if (Request.Cookies["isadmin"].Value != "true")
    //return Redirect(Request.UrlReferrer.ToString());
    return RedirectToAction("NotAuthorized", "Users");
    //return View("NotAuthorized");
else
    return View(); 
```

# opengl - OpenGL围绕一个点旋转

> ID：786293
> 
> 赞同：6
> 
> 时间：2009-04-24T15:13:22.987
> 
> 标签：opengl, rotation

我想以`gluSphere`圆周运动围绕固定点旋转 a，就像行星围绕太阳运行一样。

最好使用 glRotatef 或 glTranslate 吗？如果是这样，我应该按什么顺序打电话给他们？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T15:28:05.790

您必须同时做一些事情：

*   确保`gluSphere`它“面向”固定点，以便相对于球体向前平移使您更靠近其轨道中心
*   `glTranslatef``gluSphere`向前到您希望它旋转的点
*   `glRotatef`您希望球体运行的方向
*   `glTranslatef`就像你向前一样向后

这样，您的球体与中心的距离保持不变，但会在一个不错的轨道上“围绕”翻译。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T15:20:20.193

平移远离中心，然后一直旋转

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-04-24T15:17:05.537

glRotatef 将当前矩阵乘以旋转矩阵。这可以（给定正确的向量）做你正在尝试的事情。

glTranslatef 将当前矩阵乘以一个平移矩阵，这将有效地“移动”对象，而不是旋转它，所以它不会是你想要的。

# php - 从子类 PHP 调用父类

> ID：786295
> 
> 赞同：0
> 
> 时间：2009-04-24T15:13:39.633
> 
> 标签：php, oop, non-english

[$this->a->b->c->d 从 php 中的超类调用方法](https://stackoverflow.com/questions/742097/this-a-b-c-d-calling-methods-from-a-superclass-in-php)

我在这个链接上问了一个问题我对这个技术有问题我可以从一个类中调用子类

像这样

$chesterx->db->query();

我想从子班再上一班

例如

我想查询来自 sql 类的执行

```
 ROOT
             |
sql <---  chesterx --->  db 
```

我想使用 db 中的 sql 类

我无法从 db 类返回chesterx 类的问题

/*编辑*/

我有一些类，如新闻、成员、类别、数据库和查询

我喜欢主题顶部的链接

公共函数 __construct(){

```
 function __construct(){  
      if(!$this->db){                                       
                 include(ROOT."/func/class/bp.db.class.php");
                 $this->db = new db;
            }
if(!$this->chester){                                        
                 include(ROOT."/func/class/bp.chester.class.php");
                 $this->db = new chester;
            }
        } 
```

我用这段代码调用了 db 类，现在我可以很好地调用和使用 db 类方法

例如

我想使用 db 的方法

该方法包含一个从chester 类的方法返回数据的值

我希望我能澄清自己/*编辑*/

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T15:26:48.320

下面的代码片段可能是一个解决方案，尽管我不太喜欢循环引用。试一试，并在你认为合适的时候使用它。顺便说一句，您所说的 class 和 subclass 实际上是*包含和包含的 class*。

```
class Database
{
    public $chesterx;

    public function __construct($chesterx)
    {
        $this->chesterx = $chesterx;
    }
}

class Sql
{
    public $chesterx;

    public function __construct($chesterx)
    {
        $this->chesterx = $chesterx;
    }
}

class Chesterx
{
    public $db;

    public $sql;

    public function __construct()
    {
        $this->db  = new Database($this);
        $this->sql = new Sql($this);
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-24T22:34:53.800

我发现 Ionut G. Stan 的解决方案适合您的情况，但您可能还想考虑[factory/singleton 模式](http://il2.php.net/manual/en/language.oop5.patterns.php)，尽管只有当您的chesterx 类是全局类并且只调用一次时它才有用

# windows-xp - 能否在 XP 机器上运行 Target Designer for NT 4.0？

> ID：786297
> 
> 赞同：0
> 
> 时间：2009-04-24T15:13:45.840
> 
> 标签：windows-xp, compatibility, windows-nt

我试图在 Windows XP 系统上运行 Microsoft Windows NT Embedded 4.0 [Target Designer](http://msdn.microsoft.com/en-us/library/ms854318(WinEmbedded.4).aspx)，但是当我尝试构建时，我得到了错误。你有没有这样做过，如果是这样，有没有让它工作的诀窍？

到目前为止，我从 Microsoft 找到的最好线索是[开发系统硬件要求](http://msdn.microsoft.com/en-us/library/ms853895(WinEmbedded.4).aspx)文档包括“Windows NT 4.0 Service Pack 4 或更高版本”，但我不知道 XP 是否被视为 NT 4.0 的有效“或更高版本” .

当我尝试通过在 Windows NT 4.0 或 Windows 2000 兼容模式下运行 Target Designer 来构建映像时，在构建注册表/添加组件参数期间出现此错误：

```
ERROR: Couldn't get security error = 5 
```

当我在XP下正常运行时，在Build Registry / Binding Network过程中出现的错误是：

```
ERROR: Failed to bind network - Incorrect function 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-27T15:59:51.370

您有两种选择（您可能已经尝试过）；

1.  右键单击 Target Designer 可执行文件的链接并选择属性，然后选择兼容性选项卡并设置“以兼容模式运行此程序：”并从下拉列表中选择“Windows NT (SP5)”。你应该可以运行 TD 了。
2.  如果这不起作用，请从 Microsoft（免费）下载 Virtual PC 并为 Windows NT 创建一个新的虚拟机（您可以从 MSDN 获得 NT 的 ISO 映像，但您需要一个有效的帐户，否则使用您的 NT 光盘）。

我希望这会有所帮助。

瑞安

# sharepoint - 用于 SharePoint v1.3 CTP 的 Visual Studio 2008 扩展的用户体验

> ID：786300
> 
> 赞同：0
> 
> 时间：2009-04-24T15:14:26.603
> 
> 标签：sharepoint

一月份，[MS 发布了一个 CTP 的 VS Extensions for SharePoint v1.3。](http://weblogs.asp.net/jan/archive/2009/01/12/visual-studio-2008-extensions-for-windows-sharepoint-services-1-3-ctp.aspx) 有人用过这些吗？你的经历是什么？

我们使用了以前的版本，不喜欢开发人员隐藏/抽象了多少。我们最终放弃了扩展并使用 MakeCab.exe 创建了我们自己的 WSP。

...彼得

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T15:46:26.230

运行 web 服务的网站的安装完全失败，我永远无法让它工作，所以我卸载了它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T08:01:58.460

直到今天我还没有遇到 VSeWSS 1.3 的任何问题。除了 VSeWSS 的 Web 服务的一些问题，这些问题与我的 PC 的名称解析问题有关。

# c# - 从 DB2 表中选择并插入到 SQL 表中

> ID：786301
> 
> 赞同：0
> 
> 时间：2009-04-24T15:14:50.627
> 
> 标签：c#, .net, sql, db2

我觉得这可能是一个疯狂的问题，如果有人对如何做到这一点有更好的想法，请务必告诉我。

我有一个 .Net C# 项目正在工作，它根据他们必须遵守的公司标准验证某些表。这些表可以在 SQL Server 或 DB2 上。最初将表添加到程序中时，我使用`information_schema.columns`SQL 或`syscat.columns`db2 的 select 语句收集有关表的元数据/信息。获得该数据后，我将其存储在 sql server 上的一个表中（我们称之为`all_table_information`），其中包含在程序中验证的每个表的相同信息。

如果该表是 SQL 表，我可以运行此查询（当然将其限制为我想要的表中的列）：

```
insert into [all_table_information]
    (table_id, column_name, data_type, max_char_length)
select table_id, column_name, data_type, character_maximum_length
    from information_schema.columns 
    where ...restrict to needed table... 
```

然后在 SqlCommand 中执行它。但如果它是一个 DB2 表，我必须运行这个查询（再次限制在我需要的列）：

```
select tabschema, tabname, colname, typename, length 
from syscat.columns 
where ...restrict to needed table... 
```

然后得到一个带有结果的 DataReader 并循环使用它插入每一行：

```
while (dr.Read())
{
   insert into [all_table_information]
   (table_id, column_name, data_type, max_char_length) values 
   (..."'" + dr["whatever"] + "', '" + ....)

   ...execute sql here...

} 
dr.Close(); 
```

这样做是可行的，但是速度很慢，所以我只是想知道是否有任何方法可以在一个语句中执行此操作？我知道您也可以将 db2 表信息保存到数据表中，但是您可以直接对数据表运行查询吗？

谢谢，瑞安

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T15:19:21.477

您是否考虑过使用 SSIS，而不是编写应用程序来实现它？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T15:24:37.967

您最好在`SqlCommand`外部创建`dr.Read()`和使用参数。这将提高性能和安全性，并且您不必担心动态地正确形成语法。像这样...

```
SqlCommand insertCommand = new SqlCommand(connection);

insertCommand.CommandText = @"
insert into [all_table_information]
(table_id, column_name, data_type, max_char_length)
values
(@table_id, @column_name, @data_type, @max_char_length)";

...create your parameters and add them here

insertCommand.Prepare(); //precompiles the query
while (dr.Read())
{
    ...set parameter values

    insertCommand.ExecuteNonQuery();
} 
dr.Close(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T15:40:08.010

您可能想使用 SqlBulkCopy： [MSDN](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlbulkcopy.aspx)

它比为每一行单独插入要快得多。

# c# - 在安装时更改 app.config

> ID：786315
> 
> 赞同：5
> 
> 时间：2009-04-24T15:17:45.753
> 
> 标签：c#, linq, deployment

如何动态更改 app.config 文件中的 connectionString？

我有一个用 windows 窗体、c# 3.0 和 Linq to Sql 编写的应用程序。安装应用程序时需要更改连接字符串。我该怎么做？

当用户安装程序时，它必须显示一个带有选项的表单，如果存在则更改连接字符串，如果不存在则添加一个。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-24T15:25:09.463

如果您使用的是 .NET 部署项目，则可以使用自定义操作来实现此目的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-24T15:24:44.973

使用安装程序中的设置编写带有 appSettings 块的辅助配置文件。在您的主配置文件中，使用 appSettings 中的 file 属性来引用第二个配置文件，如下所示：

```
<appSettings file="User.config"> 
```

辅助配置中的设置将覆盖主配置中的任何匹配键。

在您的安装程序中：

```
public override void Install(IDictionary stateSaver)
{
    base.Install(stateSaver);

    string server = Context.Parameters["Server"];
    string port = Context.Parameters["Port"];
    string targetDir = Context.Parameters["TargetDir"];
    // Build your connection string from user-input parameters and add them to dictionary

    WriteAppConfig(targetDir, server, port);
}

private void WriteAppConfig(string targetDir, string server, string port)
{
    string configFilePath = Path.Combine(targetDir, "User.config");

    IDictionary<string, string> userConfiguration = new Dictionary<string, string>();

    userConfiguration["Server"] = server;
    userConfiguration["Port"] = port;

    ConfigGenerator.WriteExternalAppConfig(configFilePath, userConfiguration);
}

public class ConfigGenerator
{
    public static void WriteExternalAppConfig(string configFilePath, IDictionary<string, string> userConfiguration)
    {
        using (XmlTextWriter xw = new XmlTextWriter(configFilePath, Encoding.UTF8))
        {
            xw.Formatting = Formatting.Indented;
            xw.Indentation = 4;
            xw.WriteStartDocument();
            xw.WriteStartElement("appSettings");

            foreach (KeyValuePair<string, string> pair in userConfiguration)
            {
                xw.WriteStartElement("add");
                xw.WriteAttributeString("key", pair.Key);
                xw.WriteAttributeString("value", pair.Value);
                xw.WriteEndElement();
            }

            xw.WriteEndElement();
            xw.WriteEndDocument();
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T15:24:31.260

看看[这个问题](https://stackoverflow.com/questions/314055/change-connectionstring-in-vs2005-c)。它具有通过代码动态更改 app.config 中的值所需的功能。

# iphone - 为什么我的 iPhone 应用程序在 xcode 未启动时会崩溃

> ID：786322
> 
> 赞同：2
> 
> 时间：2009-04-24T15:20:20.210
> 
> 标签：iphone, cocoa-touch

我正在开发的 iPhone 应用程序有一个奇怪的怪癖，当 xcode 启动它时它运行正常，但直接在设备上启动时就不行。

我检查了崩溃日志，异常似乎发生在 xmlParseCharData 的 libxml2.2 中。这是一个相当大的 xml 文档，正在被解析，所以我认为这可能是问题所在。

我尝试使用较小的 xml 文档，这很好。因此，要么是文档的大小，要么是文档中的某些内容导致了它，但是当通过 xcode 启动时，同一个大文档被解析得很好。

任何想法为什么会发生这种情况或我如何开始尝试调试它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T15:52:02.113

我发现了问题。该应用程序启动时间过长。我最终在控制台登录管理器中注意到这是问题所在。我更改了应用程序，使其具有正确的登录屏幕，并且现在可以正常工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-02T06:35:28.730

我找到了有关此问题的 Apple 技术问答。 [http://developer.apple.com/iphone/library/qa/qa2009/qa1592.html](http://developer.apple.com/iphone/library/qa/qa2009/qa1592.html)

# windows - HPET 是否可以在 Windows 中直接访问？

> ID：786324
> 
> 赞同：11
> 
> 时间：2009-04-24T15:20:47.977
> 
> 标签：windows, winapi, timer

我想使用高性能事件计时器 (HPET) 作为分析工具，以快速进行非常高精度的测量。timeGetTime 在 1ms 时没有提供足够的分辨率，而且每次读取的 QueryPerformanceCounter 比我想要的慢得多。我在研究这个问题时遇到了 HPET，但我看不到任何关于如何实际解决它的示例。

那么我可以直接使用它（组装很好），还是我必须依赖已经内置在 Win32 API 中的多媒体/高性能计时工具？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-13T19:26:34.907

我也有兴趣使用 HPET，但作为计时器。我理解它的方式，QueryPerformanceCounter 和 QueryPerformanceFrequency 实际上是访问 HPET 的计数器和时钟，这在 Windows XP 下工作（例如，[参见 http://www.geisswerks.com/ryan/FAQS/timing.html](http://www.geisswerks.com/ryan/FAQS/timing.html)） .

就计时代码而言，我认为通过使用 QueryPerformanceCounter，您实际上可以访问构成 HPET 基础的计数器，而这一切都存在于芯片组（而不是处理器）中。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-04-24T16:00:52.047

我在四处挖掘时发现[了这个信息](http://www.ccsl.carleton.ca/~jamuir/rdtscpm1.pdf)，它似乎是最具成本效益的方式。当我有胆量进行组装时，我会尝试一下。:)

**更新**

我用我的探查器对此进行了测试。虽然速度有点快，但似乎我还有很多其他开销:(（我没有打扰时间，因为我似乎没有足够的好处）

# asp.net - 在提交表单时调用 ScriptMethod？

> ID：786331
> 
> 赞同：0
> 
> 时间：2009-04-24T15:23:30.640
> 
> 标签：asp.net, ajax, asp.net-ajax, postback

当我使用 OnClientClick 属性从 ASP.NET 按钮调用 ScriptMethod 时，ScriptMethod 有 95% 的时间返回（显示警报框），并且页面提交。

如果我从 HTML 输入按钮调用该方法，则 ScriptMethod 有 100% 的时间返回，但页面当然不会提交。如果我更改要提交的类型，我会回到接下来的 95%。

我是否必须改变我的方法，并在我的 ScriptMethod 返回后从 javascript 调用提交，或者有没有办法让它 100% 成功？通过成功，我的意思是在表单提交之前实际返回 100% 的时间。ScriptMethod 实际上永远不会失败。

页：

```
<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Default.aspx.cs" Inherits="ScriptServiceMadness._Default" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title>Untitled Page</title>    
</head>
<body>
    <form id="form1" runat="server">
        <asp:ScriptManager ID="ScriptManager1" runat="server">
            <Services>
                <asp:ServiceReference Path="Chewbacca.asmx" />
            </Services>
        </asp:ScriptManager>
    <div>
        <asp:TextBox ID="VerifyPostbackTextBox" runat="server" Text="true" />        
        <asp:Button ID="SubmitFormButton" runat="server" OnClientClick="attack()" Text="Works 90%" OnClick="SubmitFormButton_Click" />        
        <input type="button" id="InputButton" value="Works 100%" onclick="attack()" />
    </div>
    </form>

    <script type="text/javascript">
        function attack()
        {
            ScriptServiceMadness.Chewbacca.ShootImperialProbeDroid(true, speak, youvefailedme);            
        }

        function speak(result)
        {
            alert(result);            
        }

        function youvefailedme(error)
        {
            alert(error);
        }
    </script>
</body>
</html> 
```

后面的代码：

```
using System;
using System.Data;
using System.Configuration;
using System.Collections;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;

namespace ScriptServiceMadness
{
    public partial class _Default : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {

        }

        protected void SubmitFormButton_Click(object sender, EventArgs e)
        {
            VerifyPostbackTextBox.Text = DateTime.Now.Ticks.ToString();
        }
    }
} 
```

脚本服务：

```
using System;
using System.Data;
using System.Web;
using System.Collections;
using System.Web.Services;
using System.Web.Services.Protocols;
using System.ComponentModel;
using System.Web.Script.Services;
using System.Threading;

namespace ScriptServiceMadness
{
    /// <summary>
    /// Summary description for Chewbacca
    /// </summary>
    [ScriptService]
    [WebService(Namespace = "http://tempuri.org/")]
    [WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
    [ToolboxItem(false)]
    public class Chewbacca : System.Web.Services.WebService
    {
        [ScriptMethod]
        [WebMethod]
        public string ShootImperialProbeDroid(bool letHanDoIt)
        {
            if (letHanDoIt)
            {
                return "rrrroooorrrr";
            }
            else
            {
                return "rrrraaaarrrr";
            }
        }
    }
} 
```

有趣的一件事......我在写这个问题时从 SciptMethod 中删除了 bool 参数，它似乎 100% 的时间都有效。这当然可能是巧合。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-25T06:10:01.037

由于脚本方法是异步执行的，因此您不能保证它会在表单回发之前返回。当您在线部署并且您的用户与 Web 服务的连接速度较慢时，它不会增加的更改。我可能会建议您在收到响应后通过调用 __doPostBack 例程手动回发。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-25T06:48:06.593

你忘了 ：

```
using TheForce;

namespace Luke {
} 
```

# jquery - jQuery验证在Thickbox显示ajax调用中不起作用

> ID：786332
> 
> 赞同：2
> 
> 时间：2009-04-24T15:23:53.163
> 
> 标签：jquery, ajax, validation, thickbox

我正在使用带有验证插件的 jQuery 1.3.2 的Thickbox 3.1，当我单独运行页面时一切都很好，但是当我使用Thickbox 时，页面弹出（应该如此）但页面上的验证现在不起作用（在Thickbox内），对此的任何帮助都会很棒。

顺便说一句，奇怪的是，Thickbox 看起来在 Thickbox 内部工作，但不是验证（在页面本身上）。

添加代码：

> **page1.html (JavaScript)**

```
$(document).ready(function () {
    $("#page1Form").validate({
        rules: {
            "field1": {
                required: true,
                digits: true
            },
            "field2": {
                required: true
            }
        },
        errorElement: "div"
    });
}); 
```

> **index.html（厚框链接）**

```
<a href="page1.html" class="thickbox">Page 1</a> 
```

我可以在Thickbox 弹出窗口中查看源代码，我看到所有的JS 代码和库都在那里，但它没有在Thickbox 弹出窗口中运行验证。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-02T17:12:14.380

我认为偶数处理程序是在页面加载时设置的，所以它们没有在厚盒生成的 html 上设置。在thickbox ajax加载内容后，你不能设置一个回调来启动验证吗？

# android - 为什么 Android TabHost 从 TextView 中窃取焦点？

> ID：786334
> 
> 赞同：6
> 
> 时间：2009-04-24T15:24:19.637
> 
> 标签：android, focus

我有一个使用以下布局的应用程序：

[替代文字 http://img15.imageshack.us/img15/238/screenshot003xbo.png](http://img15.imageshack.us/img15/238/screenshot003xbo.png)

当应用程序启动时，焦点位于第一个 TextView 上，但如果您尝试在其中键入任何字母，焦点将直接转到选项卡。似乎我不是唯一一个[与这个问题作斗争的](http://groups.google.com/group/android-developers/browse_thread/thread/f3fdd1eb17288886/0d28c51a6b9ffdfe?lnk=gst&q=tab+focus#0d28c51a6b9ffdfe)人，也许这与以下有关：

[http://groups.google.com/group/android-developers/browse_thread/thread/435791bbd6c550a/8022183887f38f4f?lnk=gst&q=tabs+focus#8022183887f38f4f](http://groups.google.com/group/android-developers/browse_thread/thread/435791bbd6c550a/8022183887f38f4f?lnk=gst&q=tabs+focus#8022183887f38f4f)

不管怎样，你知道为什么会这样吗？当然，任何解决方法都会受到赞赏。

* * *

我发布下面的代码以避免使问题重载：

XML：

```
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="vertical" android:layout_width="fill_parent"
    android:layout_height="fill_parent">

    <LinearLayout 
          android:padding="5px"
          android:orientation="vertical" 
          android:id="@+id/task_edit_panel"
          android:layout_width="fill_parent"
          android:layout_height="fill_parent"
           android:layout_weight="50" >

        <LinearLayout android:orientation="vertical"
            android:layout_width="fill_parent"
            android:layout_height="wrap_content">

            <TextView android:layout_width="wrap_content"
                android:layout_height="wrap_content" 
                android:text="@string/title" 
                android:textStyle="bold" />

            <EditText android:id="@+id/title" 
              android:layout_width="fill_parent"
                android:layout_height="fill_parent" />

        </LinearLayout>

        <TabHost android:id="@+id/edit_item_tab_host"
                android:layout_width="fill_parent"
                android:layout_height="fill_parent"> 

            <TabWidget android:layout_width="fill_parent"
                        android:layout_height="wrap_content" 
                        android:id="@android:id/tabs" /> 

            <FrameLayout
              android:id="@android:id/tabcontent"
              android:layout_width="fill_parent"
              android:layout_height="fill_parent"
              android:paddingTop="65px"> <!--  you need that if you don't want the tab content to overflow --> 

              <LinearLayout
                   android:id="@+id/edit_item_date_tab"
                   android:orientation="vertical"
                    android:layout_width="fill_parent"
                    android:layout_height="fill_parent"
                    android:padding="5px" > 

                    <TextView android:layout_width="wrap_content"
                            android:layout_height="wrap_content" 
                            android:text="date" 
                             android:textStyle="bold" />

                </LinearLayout>

                <LinearLayout
                   android:id="@+id/edit_item_geocontext_tab"
                   android:orientation="vertical"
                    android:layout_width="fill_parent"
                    android:layout_height="fill_parent"
                    android:padding="5px" > 

                <TextView android:layout_width="wrap_content"
                            android:layout_height="wrap_content" 
                            android:text="lieu" 
                             android:textStyle="bold" />

                </LinearLayout>

                <LinearLayout
                   android:id="@+id/edit_item_text_tab"
                   android:orientation="vertical"
                    android:layout_width="fill_parent"
                    android:layout_height="fill_parent"
                     android:padding="5px"> 

                <EditText android:id="@+id/details" 
                        android:layout_width="fill_parent"
                        android:layout_height="fill_parent"
                        android:scrollbars="vertical" />

                </LinearLayout>

            </FrameLayout>

        </TabHost>

    </LinearLayout>

    <!-- Bottom pannel with "add item" button -->
    <LinearLayout 
          android:padding="5px"
          android:orientation="horizontal" 
          android:layout_weight="1"
          android:id="@+id/task_edit_panel"
          android:layout_width="fill_parent"
          android:layout_height="wrap_content"
          android:background="#E7E7E7" >

          <!--  Let the height set to fill_parent until we find a better way for the layout  -->
          <Button android:id="@+id/item_edit_ok_button"
                android:layout_width="fill_parent"
                android:layout_height="wrap_content"
                android:layout_gravity="bottom"
                android:text="@string/ok"
                style="?android:attr/buttonStyleSmall"
                android:layout_weight="1" />

           <Button android:id="@+id/item_edit_cancel_button"
                android:layout_width="fill_parent"
                android:layout_height="wrap_content"
                android:layout_gravity="bottom"
                android:text="@string/cancel"
                style="?android:attr/buttonStyleSmall"
                android:layout_weight="1" />

    </LinearLayout>

</LinearLayout> 
```

和Java代码：

```
 TabHost tab_host = (TabHost) findViewById(R.id.edit_item_tab_host);
    // don't forget this setup before adding tabs from a tabhost using a xml view or you'll get an nullpointer exception
    tab_host.setup(); 

    TabSpec ts1 = tab_host.newTabSpec("TAB_DATE");
    ts1.setIndicator(getString(R.string.when), getResources().getDrawable(R.drawable.ic_dialog_time));
    ts1.setContent(R.id.edit_item_date_tab);
    tab_host.addTab(ts1);

    TabSpec ts2 = tab_host.newTabSpec("TAB_GEO");
    ts2.setIndicator(getString(R.string.where),  getResources().getDrawable(R.drawable.ic_dialog_map));
    ts2.setContent(R.id.edit_item_geocontext_tab);
    tab_host.addTab(ts2);

    TabSpec ts3 = tab_host.newTabSpec("TAB_TEXT");
    ts3.setIndicator(getString(R.string.what),  getResources().getDrawable(R.drawable.ic_menu_edit));
    ts3.setContent(R.id.edit_item_text_tab);
    tab_host.addTab(ts3);

    tab_host.setCurrentTab(0); 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-05T06:51:41.743

好吧，绝对是一个错误：[http](http://code.google.com/p/android/issues/detail?id=2516) ://code.google.com/p/android/issues/detail?id=2516 。

希望它会在下一个版本中得到修复，因为对于具有高级布局的复杂应用程序来说，这确实是一个令人讨厌的问题。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-12-30T10:55:07.170

我在使用 HoneyComb 时遇到了同样的问题，但找到了一个非常简单的解决方案。所以我认为有人分享我的经验会有所帮助。每次单击选项卡时，焦点都在编辑文本上，您实际上可以使用硬键盘键入，但永远不会弹出软键盘。即使使用以下代码，它也没有解决问题：

```
input1.requestFocusFromTouch();
((InputMethodManager)getSystemService(Context.INPUT_METHOD_SERVICE)).showSoftInput(input1, InputMethodManager.SHOW_FORCED); 
```

解决方案：在您处理 Tabs 的主类中，只需编写以下 Java 代码：

```
myTabHost.setOnTabChangedListener(new OnTabChangeListener(){    
    public void onTabChanged(String tabID) {    
        myTabHost.clearFocus(); 
    }   
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-04T08:59:14.550

如果它与您指出的其他错误无关（看起来可能是），并且如果您在 G1（而不是模拟器）上遇到此问题，我怀疑您的问题是焦点不是'在方向更改之前（当您折叠键盘并进入横向模式时）不会被冻结或在重新创建视图后解冻。您可以尝试覆盖活动的**onSaveInstanceState()**和**onRestoreInstanceState()**方法来保存/恢复焦点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-27T16:00:56.880

此示例显示如何解决此问题：

```
userNameEditText.setOnTouchListener(new OnTouchListener() {
            @Override
            public boolean onTouch(View v, MotionEvent event) {
                userNameEditText.requestFocusFromTouch();
                return false;
            }
        }); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-11-12T08:26:37.220

添加所有规范后，将 requestFocus 方法添加到**java 文件中的 edittext**

# sql - SQL 和 ADO.net：使用输出参数指定的参数过多

> ID：786339
> 
> 赞同：1
> 
> 时间：2009-04-24T15:25:08.293
> 
> 标签：sql, sql-server, vb.net, ado.net

```
ALTER PROCEDURE dbo.uspGetOrderTrackingHeaderInfo
  @ContractID varchar(9)
, @SalesRepID int
, @StatusID int
, @TypeID int
, @StartDate datetime
, @EndDate datetime
, @Identity int = null output

AS

INSERT INTO [dbo].[tblOrderTracking]
           ([ContractID]
           ,[StatusID]
           ,[TypeID]
           ,[SalesRepID]
           ,[StartDate]
           ,[EndDate])
     VALUES
           (@ContractID
           ,@StatusID
           ,@TypeID
           ,@SalesRepID
           ,@StartDate
           ,@EndDate)

SET @Identity = Scope_Identity() 
```

* * *

```
Using oConn As New SqlConnection(Me.Master.Master.AdminNetConnString)
        Try
            With cmd
                .Connection = oConn
                .CommandType = CommandType.StoredProcedure
                .CommandText = "dbo.uspInsertOrderTrackingInfo"
                .Parameters.AddWithValue("@ContractID", Session("@OrderContractID"))
                .Parameters.AddWithValue("@SalesRepID", Integer.Parse(Me.ddlSalesRep.SelectedValue.ToString()))
                .Parameters.AddWithValue("@StatusID", Integer.Parse(Me.ddlStatus.SelectedValue.ToString()))
                .Parameters.AddWithValue("@TypeID", Integer.Parse(Me.ddlOrderType.SelectedValue.ToString()))
                .Parameters.AddWithValue("@StartDate", CDate(txtStartDate.Text.Trim))
                .Parameters.AddWithValue("@EndDate", CDate(txtEndDate.Text.Trim))
                .Parameters.Add("@Identity", SqlDbType.Int, ParameterDirection.Output)
            End With

            oConn.Open()

            cmd.ExecuteNonQuery()
            Session("WorkingOrderID") = cmd.Parameters("@Identity").Value

            Response.Redirect("OrderOverview.aspx")
        Catch ex As Exception
            Me.Master.Master.HandleException(ex, True, "An error occured while attempting to save the order setup information")
        Finally
            If Not cmd Is Nothing Then
                cmd.Dispose()
            End If
        End Try
    End Using 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T15:41:36.803

您已经发布了过程“uspGetOrderTrackingHeaderInfo”的代码，并且您正在调用过程“uspInsertOrderTrackingInfo”。也许您修改了错误的过程并且在插入过程中没有输出。

# java - 带开关的循环与不同的循环

> ID：786341
> 
> 赞同：2
> 
> 时间：2009-04-24T15:25:34.847
> 
> 标签：java, performance

我有一个循环用户元素的方法，并根据给定的约束设置一个布尔值：

```
public void checkUsers( int constraint ) {
    for(int i=0; i<nodeUsers().size(); i++) {
        UserElement elem = nodeUsers().getUsersElementAt(i);

        switch (constraint) {
          case CHECK_ALL:
              elem.setChecked(true); break;
          case CHECK_NONE:
               elem.setChecked(false); break;
          case CHECK_NO_LANG:
               if (elem.getLanguage() == null)
                   elem.setChecked(true);
               else
                   elem.setChecked(false);
               break;
          // More cases         
        }
    }
} 
```

我想知道这个解决方案是否可以。也许我可以更好地编写不同的方法，例如：

```
public void checkAllUsers() {
    for(int i=0; i<nodeUsers().size(); i++) {
        UserElement elem = nodeUsers().getUsersElementAt(i);
        elem.setChecked(true);  
    }
}

public void checkNoUsers() {
    for(int i=0; i<nodeUsers().size(); i++) {
        UserElement elem = nodeUsers().getUsersElementAt(i);
        elem.setChecked(false); 
    }
} 
```

// 编辑：我添加了第三种情况。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-24T15:33:32.703

在我看来，您可以通过使您的约束成为真正的枚举来更有效地做到这一点：

```
public enum Constraint
{
    CHECK_NONE
    {
        @Override void apply(UserElement element)
        {
            element.setChecked(false);
        }
    },
    CHECK_ALL
    {
        @Override void apply(UserElement element)
        {
            element.setChecked(true);
        }
    };

    public abstract void apply(UserElement element);
} 
```

然后你可以拥有：

```
public void checkUsers(Constraint constraint) {
    for(int i=0; i<nodeUsers().size(); i++) {
        UserElement elem = nodeUsers().getUsersElementAt(i);
        constraint.apply(elem);
    }
} 
```

或者，有一个具有相同“应用”方法的接口，并将接口的一个实例传递给您的`checkUsers`方法。这是相同的基本模式 - 将所有用户元素的迭代与“如何处理元素”分开。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-24T15:31:23.427

第二个会稍微好一些，但它会根据您的 JIT 设置而有所不同。

在最坏的情况下，每次迭代都会检查约束，这可能会导致性能下降。在最好的情况下，约束只检查一次。

另一种解决方案，它具有所有优点，并且没有任何潜在的缺点：

```
public void checkUsers(bool setTo) {
    for(int i=0; i<nodeUsers().size(); i++) {
        UserElement elem = nodeUsers().getUsersElementAt(i);
        elem.setChecked(setTo); break;  
    } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-24T16:13:00.037

你在评论中提到你被困在 1.4 中，所以这应该让你开始类似于 Jon Skeet 建议的东西，但作为一个类型安全的枚举。

```
public abstract class Constraint {
  public static final Constraint CHECK_NONE = new Constraint(){
      @Override 
      public void apply(UserElement elem) {
        elem.setChecked(false);
      }
    };
  // etc. for other cases...

  // reduce visibility of ctor
  private Constraint() {};

  public abstract void apply();
} 
```

用法与 Jon Skeet 的回答相同。

请注意，仅当您坚持使用 1.4 时才需要这样做。如果您使用的是现代 Java，请使用真正的枚举。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-24T15:29:17.707

两种方法的实现效果更好。其他人将更容易理解您的代码，因为他们只需要读取方法名称，而不是必须了解您的参数在第一个实现中的作用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-24T16:05:16.420

鉴于您被困在 1.4 中，我建议将 case 语句从循环中提取出来，这样虽然您不会避免条件，但至少可以隔离它。循环变得更简单，圈复杂度下降，当您确实切换到更现代的 Java 时，您需要查看的转换代码更少（嗯，在一个函数中，您将升级以利用 foreach；在另一个方面，利用更好的枚举 - 但它是关注点的分离）：

```
public void checkUsers(int constraint) {
    for (int i = 0; i < nodeUsers().size(); i++)
        checkUser(constraint, nodeUsers().getUsersElementAt(i));
}

private void checkUser(int constraint, UserElement elem) {
    switch (constraint) {
    case CHECK_ALL:
        elem.setChecked(true);
        break;
    case CHECK_NONE:
        elem.setChecked(false);
        break;
    case CHECK_NO_LANG:
        if (elem.getLanguage() == null)
            elem.setChecked(true);
        else
            elem.setChecked(false);
        break;
    // More cases
    }
} 
```

这与您是否将各个案例拆分为各自的功能无关。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-24T15:29:35.193

我不明白为什么不，只要您正确记录所有内容:)

您可以提前计算循环的长度（节省时间和资源）
，所以

> nodeUsers().size() -> 使它成为一个变量:)

祝你好运 ：）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-24T16:06:20.723

这是访问者模式的正常变化。缺乏泛型支持并不是什么大问题，因为您只发送一种类型的值。接口（或抽象类型）实现似乎最正确；如果您的部署案例使依赖注入成为一个有吸引力的选择，这既允许更简单的单元测试，也为更好的可扩展性打开了大门。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-24T16:10:24.067

哦地狱。这个更好：

```
private void checkUser(int constraint, UserElement elem) {
    elem.setChecked(shouldCheck(constraint, elem));
}

private boolean shouldCheck(int constraint, UserElement elem) {
    switch (constraint) {
    case CHECK_ALL: return true;
    case CHECK_NONE:    return false;
    case CHECK_NO_LANG: return elem.getLanguage() == null;
    // More cases
    }
} 
```

你避免了所有的**break**。

# javascript - iframe后退按钮问题（不想后退按钮影响iframe）

> ID：786348
> 
> 赞同：4
> 
> 时间：2009-04-24T15:29:10.360
> 
> 标签：javascript, iframe, button, back

我有一个非常简单的问题，我自己无法解决（我在操作 iframe 时遇到了麻烦）。

基本上，去说这个页面....

[http://andrew.koallo.ca/new/393NelsonSt-JordanFisher](http://andrew.koallo.ca/new/393NelsonSt-JordanFisher)

点击“点击这里地图”...地图应该为你加载......现在如果你他的背部一次......它只会收回iframe......所以基本上你必须点击后退按钮两次以返回您的原始页面。

是否可以避免这种情况？...单击“单击此处映射”按钮后，我将 iframe 的 src 设置为等于相应的源...。

我正在阅读也许 l​​ocation.replace 可以提供帮助？无法让它工作。

感谢您的帮助，安德鲁

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-04-04T13:30:56.093

您提到的页面是离线 atm，但您需要像这样设置 iframe 的 url：

```
$('#myIframe').get(0).contentWindow.location.replace('http://...'); 
```

因此该网址不会进入浏览器历史记录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-01-16T19:11:35.240

要么在页面中放置一个带有 onclick 事件的“返回”按钮，要么将 iframe 的代码更改为仅使用 Ajax 调用。

# c# - 使用 ObjectDataProvider 时可以有不同的项目文本和项目值吗？

> ID：786354
> 
> 赞同：0
> 
> 时间：2009-04-24T15:30:18.313
> 
> 标签：c#, .net, wpf, data-binding

在设置项目控件（例如 ComboBox）的源时，是否可以让 SelectedValue 属性与显示的文本不同。我有一个 ComboBox，我只想显示 DateTime 的时间部分，并且每个项目的值都是 DateTime 对象本身。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T15:52:03.160

组合框有一个 ItemStringFormat 属性，该属性指示项目在控件的下拉列表和文本框部分中的显示方式。

在[这个来自 MSDN 的示例](http://msdn.microsoft.com/en-us/library/system.windows.controls.itemscontrol.itemstringformat.aspx)中，SelectedValue 将是一个日期时间对象，而控件本身将显示格式化的字符串。

请参阅[此处](http://msdn.microsoft.com/en-us/library/97x6twsz.aspx)了解如何创建适用于您的问题的格式字符串。（我猜想像“HH：mm：ss”）

# html - html 将文本值附加到表单操作

> ID：786363
> 
> 赞同：3
> 
> 时间：2009-04-24T15:32:48.883
> 
> 标签：html, webforms

我有一个表单、文本输入和一个提交按钮。如何将文本框的值附加到表单操作，即

action="https://www.mywebsite.com/" & txtSessionId

表格如下所示：

```
<form name="form1" method="post" action="https://www.mywebsite.com/">
  <label>Your Sessions ID:
    <input type="text" name="txtSessionId" id="txtSessionId">
  </label>
  <label>
<input type="submit" name="btnContinue" id="btnContinue" value="Continue">
</label>
</form> 
```

我希望链接看起来像这样：[https ://www.mywebsite.com/123456](https://www.mywebsite.com/123456)

其中 123456 由用户输入到文本框中。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T15:37:01.510

您必须使用 javascript 或服务器端的东西来做到这一点（或两者兼而有之）。

**Javascript：**

```
<form name="form1" method="post" action="https://www.mywebsite.com/" 
  onsubmit="location.href = this.action + this.txtSessionId.value; return false;"> 
```

**服务器端 (PHP)**

```
if (!empty($_POST['txtSessionId']))
{
    header('Location: https://.....' . (int)$_POST['txtSessionId']);
    exit();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T15:59:32.627

正确的行为是将输入字段发送到现有表单，对其进行处理并重定向。您还不知道用户是否发送了有效的输入值！

在这种情况下，我总是推荐 javascript，除非对您有严格的要求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T15:53:47.353

如果您接受这样的 URL，我假设您正在服务器上使用类似 mod-rewrite 的东西。那么，为什么不直接在上面写一条规则来检查是否`txtSessionId`已设置，然后将其重写为您想要的任何内容？

我不知道如何很好地编写 mod-rewrite 规则，但是，我绝对知道你可以做到。

如果您使用的是 PHP，Greg 确实提供了一个相当可行的替代方案来使用 mod-rewrite（或类似的东西）。

# javascript - Javascript按键缓冲区问题

> ID：786364
> 
> 赞同：1
> 
> 时间：2009-04-24T15:32:53.457
> 
> 标签：javascript, internet-explorer, javascript-events

我有一个功能，它在按下热键后开始吞噬键，并在序列结束时触发 AJAX 进程（条形码扫描）。

问题是如果用户不小心按下了热键会发生什么？

我的餐巾纸解决方案是：

```
on hotkey: if(okay(true)) {buffer=""; ts=now(); consumekey();}
on EOTkey: if(okay(false)) {AJAX(buffer); consumekey();}
on datakey: if(okay(false)) {appendbuffer(key); consumekey();}
on otherkey: dumpbuffer();    

var status=false;
var ts=0;
var buffer="";

function okay(bool state)
{
 if (state && !status) || (!state && status && !timeout(ts) ) return true;
 dumpbuffer();
}

function dumpbuffer()
{
 mybuffer=buffer;
 buffer="";
 ts=0;
 status=false;
 sendkeys(mybuffer);
} 
```

那么我们如何在 Javascript 中编写 sendkeys 呢？（顺便说一句，这可能是特定于 IE 的）。当前的实现使用 jQuery，但我们的代码没有 sendkeys 函数的任何内容。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T19:57:49.293

简单的 sendKeys 示例，仅适用于 IE。您必须启用 ActiveX，因为它需要实例化 WScript Shell。

```
<script>
function pageSetup()
{
    var shell;
    shell = new ActiveXObject("WScript.Shell");
    shell.SendKeys("%fu");
}
</script>

<div onclick="pageSetup();" style="cursor:pointer;">Open Page Setup</div> 
```

# asp.net - 将用户从一个 ASP .NET 应用程序安全地转移到另一个

> ID：786366
> 
> 赞同：5
> 
> 时间：2009-04-24T15:33:24.670
> 
> 标签：asp.net, forms-authentication

我有一个使用表单身份验证的 ASP .NET Web 应用程序。我们称这个应用程序为“Foo”。我正在创建另一个名为“Bar”的 ASP .NET 应用程序。

我想要发生的是用户登录到 Foo，然后单击一个链接，将他们带到 Bar 应用程序中的一个页面。Bar 应用程序不应要求 Foo 用户再次登录。Foo 应用程序应该将安全票传递给 Bar 应用程序，然后用户可以在 Bar 应用程序中开展他/她的业务。

我还想限制对 Bar 应用程序的访问。因此，如果用户在未登录的情况下尝试访问 Bar 应用程序，他们将被重定向到 Foo 登录页面。

这可能吗？如果是这样，我该如何实施？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T17:43:50.490

我做过一次，它位于 PHP 站点和 ASP.NET 站点之间（我是 ASP.NET 开发人员，但也了解一些关于 PHP 的知识）。

如果 App1 是用户的入口点，那么在登录时 App1 应该为该用户创建一个键值对，其中包含用户名和生成的键（例如 GUID）。以编程方式，它应该与 App2 通信并发送此密钥（例如启动后台线程）。假设用户 JohnDoe 在 App1 上成功登录。

App1 生成一个密钥 (3l3kjlk3j4lkj34, JohnDoe) 并通过某种通信方式将其发送给 App2（例如通过 HTTP 调用一个 URL，例如 www.app2.com/SetTempKey.aspx?userId=JohnDoe&key=3l3kjlk3j4lkj34 - 一个允许出于安全原因，仅来自某个 IP 的请求）。

App2 将收到临时访问密钥并存储它。假设 App2 的登录页面位于 www.app2.com/login.aspx。

在 app1 中，您将生成一个指向 www.app2.com/login.aspx?tempKey=3l3kjlk3j4lkj34 的链接，并带有一个不错的标签，例如“转到我们的 app2”。当用户单击链接时，会调用 app2 上的 login.aspx 页面。检查查询字符串是否存在 tempKey 查询字符串参数，然后检查存储在 app2 的临时密钥中的密钥的有效性，发现这**确实**是 JohnDoe。

App2 只需调用 FormsAuthentication.RedirectFromLoginPage("JohnDoe", true) （首先是用户名，然后是 formsAuth cookie 是否应该是持久的/not_session_lived）来记录他。

......差不多就是这样。

# cmd - 如何将 CMD.EXE 窗口置于顶部

> ID：786368
> 
> 赞同：6
> 
> 时间：2009-04-24T15:33:50.597
> 
> 标签：cmd

如何将 CMD.EXE 窗口置顶？（我更喜欢不需要编译任何东西的命令或脚本）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-24T15:52:34.843

可从 Windows 脚本宿主（VBS 或 JS）访问的 Wscript.Shell 对象有一个名为“AppActivate”的方法，当传递一个窗口标题时，该方法将尝试“激活”（如果未最小化，可能会将其带到前台） .

VBScript 中的以下代码片段在我的机器上运行：

```
Set WShell = CreateObject("WScript.Shell")
WShell.AppActivate "Command Prompt" 
```

（编辑：最初我没有尝试过。然后我做了）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T15:48:35.727

通过编译：

很简单，只需使用 Win32 API 根据其标题或类别查找窗口，然后发送消息或将其带到前面。

无需编译：

我建议您找到一个命令行实用程序，它可以执行与 FindWindow 和 SetForgroundWindow 等效的操作，因此您可以从批处理文件或任何其他脚本中调用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-12-19T19:00:16.553

你可以制作一个 AutoHotkey 脚本：

```
^SPACE::  Winset, Alwaysontop, , Ahere
Return 
```

将其保存为 .ahk 文件。安装 Autohotkey 后运行它。现在单击您选择的窗口并点击`CTRL`+ `Space`，该窗口应始终位于顶部

# c# - 我的 Windows 窗体正在 SQL 数据库中为 RadioButton 保存空值。

> ID：786371
> 
> 赞同：0
> 
> 时间：2009-04-24T15:34:32.203
> 
> 标签：c#, .net, .net-2.0

我建立了一个零件申请表，其中一部分是审批流程。此表格向请求者发送一封电子邮件，表明该决定。在我的主管表单上有两个单选按钮，一个用于批准，一个用于拒绝。

现在我的问题是，在查看应用程序中的请求时，并不总是显示该决定。我发现这是由于表单将未选中的值保留为空。
我尝试将相反的值隐式设置为 false。但这并没有改变将值保存为空的形式。

这是我正在使用的代码。

```
private void sUP_APVRadioButton_CheckedChanged(object sender, EventArgs e)
{
    sUP_REJRadioButton.Checked = false;
    SupDec = "Supervisor Approved Request #" + requestRecordNumberLabel1.Text;
    RouteAddress = PurchAuthUserName + Emaildomain;
    CcAddress = user_NameLabel1.Text.Substring(6) + Emaildomain + DevEmail;

}

private void sUP_REJRadioButton_CheckedChanged(object sender, EventArgs e)
{
    sUP_APVRadioButton.Checked = false;
    SupDec = "Supervisor Rejected Request#" + requestRecordNumberLabel1.Text;
    RouteAddress = user_NameLabel1.Text.Substring(6) + Emaildomain;

} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T15:37:20.527

如果有人将单选按钮的值从一个值更改为另一个值，那只会设置单选按钮的值。您是否在表单中明确说明默认情况下应检查哪些按钮？

# .net - 使用 XML 序列化格式化元素/属性值

> ID：786373
> 
> 赞同：3
> 
> 时间：2009-04-24T15:35:54.120
> 
> 标签：.net, xml, xml-serialization, string-formatting

我有一个代表信用卡详细信息的类。为了表示有效期和到期月份和年份，我使用了四个类型的属性`int`：

```
public int ValidFromMonth { get; set; }
public int ValidFromYear { get; set; }
public int ExpiresEndMonth { get; set; }
public int ExpiresEndYear { get; set; } 
```

我正在对此类进行 XML 序列化以供第三方使用。如果值小于 10，该第三方要求我的月份和年份值以前导零作为前缀

```
<validFromMonth>02</validFromMonth>
<validFromYear>09</validFromYear>
<expiresEndMonth>10</expiresEndMonth>
<expiresEndYear>14</expiresEndYear> 
```

.NET 是否支持将强制执行此规则的任何属性（或者我是否可以创建自定义属性），可能使用格式字符串（例如`{0:00}`）？

注意：我知道我可以添加我自己`string`的在内部进行格式化的`[XmlIgnore]`属性，并向我的属性添加一个属性`int`，但这感觉像是一个二流的解决方案。

**编辑：** 经过一番考虑，我想知道这是否真的不可行。序列化没有问题，但为了使反序列化工作，您需要取消格式化序列化字符串。在上面的简单示例中，这很容易，但我不确定它是否可以在更一般的情况下工作。

**Edit2：** 定义两位数要求的 XML 模式如下。

简单类型定义：

```
<xs:simpleType name="CreditCardMonthType">
  <xs:annotation>
   <xs:documentation>Two digit month</xs:documentation>
  </xs:annotation>
  <xs:restriction base="xs:string">
   <xs:minLength value="2" />
   <xs:maxLength value="2" />
  </xs:restriction>
 </xs:simpleType>
<xs:simpleType name="CreditCardYearType">
  <xs:annotation>
   <xs:documentation>Two digit year</xs:documentation>
  </xs:annotation>
  <xs:restriction base="xs:string">
   <xs:minLength value="2" />
   <xs:maxLength value="2" />
  </xs:restriction>
</xs:simpleType> 
```

使用这些类型的信用卡定义：

```
<xs:attribute name="ExpiryMonth" type="CreditCardMonthType" use="required">
 <xs:annotation>
  <xs:documentation>Credit/debt card's expiry month.</xs:documentation>
 </xs:annotation>
</xs:attribute>
<xs:attribute name="ExpiryYear" type="CreditCardYearType" use="required">
 <xs:annotation>
  <xs:documentation>Credit/debt card's expiry year.</xs:documentation>
 </xs:annotation>
</xs:attribute>
<xs:attribute name="StartMonth" type="CreditCardMonthType" use="optional">
 <xs:annotation>
  <xs:documentation>Switch card's start month.</xs:documentation>
 </xs:annotation>
</xs:attribute>
<xs:attribute name="StartYear" type="CreditCardYearType" use="optional">
 <xs:annotation>
  <xs:documentation>Switch card's start year.</xs:documentation>
 </xs:annotation>
</xs:attribute> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T16:48:13.493

这是很多代码，但它可以满足您的需求。要点是您可以创建一个新类（`LeadingZero`在此示例中）并实现`IXmlSerializable`以控制您如何从 XML 流中读取/写入。希望这可以帮助：

```
 using System;
    using System.IO;
    using System.Xml.Serialization;

namespace StackOverflow
{
    [Serializable]
    public class LeadingZero : IXmlSerializable
    {
        public int Value { get; set; }

        public LeadingZero()
        {
            Value = 0;
        }

        public LeadingZero(int value)
        {
            this.Value = value;
        }

        public override string ToString()
        {
            return Value.ToString("00");
        }

        #region IXmlSerializable Members

        public System.Xml.Schema.XmlSchema GetSchema()
        {
            return null;
        }

        public void ReadXml(System.Xml.XmlReader reader)
        {
            string s = reader.ReadElementString();
            int i;
            if (int.TryParse(s, out i))
            {
                Value = i;
            }
        }

        public void WriteXml(System.Xml.XmlWriter writer)
        {
            writer.WriteString(Value.ToString("00"));
        }

        #endregion
    }

    [Serializable]
    public class Complex
    {
        public LeadingZero ValidFromMonth { get; set; }
        public LeadingZero ValidFromYear { get; set; }
        public LeadingZero ExpiresEndMonth { get; set; }
        public LeadingZero ExpiresEndYear { get; set; }
    }

    class Program
    {
        static void Main()
        {
            var seven = new LeadingZero(7);

            XmlSerializer xml = new XmlSerializer(typeof(LeadingZero));

            StringWriter writer;

            writer = new StringWriter();
            xml.Serialize(writer, seven);

            string s = writer.ToString();

            Console.WriteLine(seven);
            Console.WriteLine();
            Console.WriteLine(s);

            Console.WriteLine();
            var newSeven = xml.Deserialize(new StringReader(s)) as LeadingZero;
            Console.WriteLine(newSeven ?? new LeadingZero(0));

            var complicated = new Complex()
            {
                ValidFromMonth = new LeadingZero(7),
                ValidFromYear = new LeadingZero(2009),
                ExpiresEndMonth = new LeadingZero(6),
                ExpiresEndYear = new LeadingZero(2010)
            };

            Console.WriteLine();
            writer = new StringWriter();

            xml = new XmlSerializer(typeof(Complex));
            xml.Serialize(writer, complicated);
            s = writer.ToString();
            Console.WriteLine(s);

            var newComplicated = xml.Deserialize(new StringReader(s)) as Complex;
            if (newComplicated != null)
            {
                Console.WriteLine();
                Console.WriteLine("Woo hoo!");
            }

            Console.ReadLine();
        }
    }
} 
```

这是我得到的输出：

```
07

<?xml version="1.0" encoding="utf-16"?>
<LeadingZero>07</LeadingZero>

07

<?xml version="1.0" encoding="utf-16"?>
<Complex xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http:/
/www.w3.org/2001/XMLSchema">
  <ValidFromMonth>07</ValidFromMonth>
  <ValidFromYear>2009</ValidFromYear>
  <ExpiresEndMonth>06</ExpiresEndMonth>
  <ExpiresEndYear>2010</ExpiresEndYear>
</Complex>

Woo hoo! 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-26T04:49:57.197

好的，忽略我之前的代码示例（不过，我会保留它，因为它可能会帮助其他人）。我只记得你可以使用[XmlEnumAttribute](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlenumattribute.aspx)来做到这一点：

```
public enum LeadingZeroMonth
{
    [XmlEnum("01")]
    January,

    ...

    [XmlEnum("12")]
    December
} 
```

然后将您的用法更改为枚举：

```
public LeadingZeroMonth ValidFromMonth { get; set; } 
```

这实际上是一个非常好的方法，因为您现在有一个本月的枚举（这实际上是您从一开始就应该做的）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-27T08:52:15.483

这种需求通常来自不了解 XML 的公司。我不会假设这里是这种情况，而是要问：他们是否为您提供了描述前导零日格式的 XML 模式？如果是这样，您可以发布定义日期的部分吗？

* * *

**基于编辑的编辑**

感谢您发布架构。它证实了我担心的另一件事。你的整数不是整数。注意`<restriction base="xs:string"/>`. 这些是字符串，而不是整数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T11:29:19.870

使用 XmlEnum 的缺点是它不能为空

我会推荐

```
 [XmlIgnore]
    private int? _startMonth;

    /// <remarks/>
    [XmlAttributeAttribute]
    public string StartMonth
    {
        get { return _startMonth == null ? null : _startMonth.ToString().PadLeft(2, '0'); }
        set { _startMonth = string.IsNullOrEmpty(value) ? (int?)null : int.Parse(value); }
    } 
```

这将允许您使属性可以为空

# matlab - 如何在矩阵或二进制图像中绘制多边形以使用图像处理功能？

> ID：786375
> 
> 赞同：7
> 
> 时间：2009-04-24T15:36:02.560
> 
> 标签：matlab, image-processing, image-manipulation, polygon

我正在开发一个使用多边形（凹面或凸面）的 matlab 程序。我需要在多边形上使用 imdilate 或 imerode 等图像处理功能。为此，我应该将我的多边形转换为图像。我想知道是否有办法直接在二进制矩阵中绘制多边形（1 代表前景，0 代表背景）？

目前，我使用“getframe”，然后使用“frame2im”，然后使用“im2bw”函数来执行此操作。但它的缺点是我无法控制最终图像的大小（=矩阵）（即，将帧转换为图像时图像的大小（以像素为单位），因为 matlab 不以像素为单位显示其图（？）。因此，每次有人在绘图上“放大”或“缩小”时，生成的矩阵（=图像）都会有所不同。

我的代码：

```
Polygon = [ 15    45    33    30  40 23 ; 9    9    24    15 13 13]';
figure(1); clf; patch(Polygon(:,1),Polygon(:,2),'black');
axis off

%convert the plot to binary image
frame = getframe(gca);
im =frame2im(frame);
level = graythresh(im);
bw = ~im2bw(im,level);

%draw the resulting image
imtool(bw)
%dilate the image
SE = strel('square',5);
bw2 = imdilate(bw,SE);

%draw the dilated image
imtool(bw2) 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-24T16:26:59.800

也许您可以使用它`poly2mask`来计算感兴趣的区域，而不是像在脚本中那样使用补丁来绘制它。例如

```
Polygon = [ 15    45    33    30  40 23 ; 9    9    24    15 13 13]';
ImageWidth = 100;
ImageHeight = 50;
bw = poly2mask(Polygon(:,1),Polygon(:,2),ImageHeight,ImageWidth);
imshow(bw) 
```

上面代码的结果 bw 就是这个图像。

[![体重](https://i.stack.imgur.com/fdYMu.jpg)](https://i.stack.imgur.com/fdYMu.jpg)

# linux - 如何从 Linux shell 运行具有与当前不同工作目录的程序？

> ID：786376
> 
> 赞同：404
> 
> 时间：2009-04-24T15:36:23.337
> 
> 标签：linux, shell, environment

使用**Linux shell**，如何使用与当前工作目录不同的工作目录启动程序？

例如，我有一个在**当前目录**`helloworld`中创建文件的二进制文件。 这个文件在目录里面。`hello-world.txt` **`/a`**

 **目前，我在目录中`/b`。我想开始运行我的程序`../a/helloworld`并获得`hello-world.txt`第三个目录中的某个位置`/c`。

* * *

## 回答 #1

> 赞同：637
> 
> 时间：2009-04-24T15:46:04.983

像这样调用程序：

```
(cd /c; /a/helloworld) 
```

括号导致生成子外壳。然后，此子 shell 将其工作目录更改为`/c`，然后`helloworld`从执行`/a`。程序退出后，子 shell 终止，将您返回到父 shell 的提示符，位于您开始的目录中。

**错误处理：**为避免在未更改目录的情况下运行程序，例如拼写错误时`/c`，请根据条件执行`helloworld`：

```
(cd /c && /a/helloworld) 
```

**减少内存使用：**为避免在 hello world 执行时让 subshel​​l 浪费内存，请`helloworld`通过 exec 调用：

```
(cd /c && exec /a/helloworld) 
```

[感谢[Josh 和 Juliano](https://stackoverflow.com/questions/786376/how-do-i-run-a-program-with-a-different-working-directory-from-current-from-linu/786515#786515)提供改进此答案的提示！]

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2009-04-24T16:05:06.733

类似于[David Schmitt](https://stackoverflow.com/questions/786376/how-to-start-a-programm-with-working-directory-different-from-current-from-linux/786419#786419)的回答，加上 Josh 的建议，但不会让 shell 进程运行：

```
(cd /c && exec /a/helloworld) 
```

这种方式更类似于您通常在 shell 上运行命令的方式。要查看实际差异，您必须`ps ef`使用每个解决方案从另一个 shell 运行。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2015-07-13T19:28:35.250

一个不需要 subshel​​l 并且内置于 bash 的选项

```
(pushd SOME_PATH && run_stuff; popd) 
```

演示：

```
$ pwd
/home/abhijit
$ pushd /tmp # directory changed
$ pwd
/tmp
$ popd
$ pwd
/home/abhijit 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2009-04-24T15:49:37.550

```
sh -c 'cd /c && ../a/helloworld' 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-04-24T17:15:27.123

我一直认为 UNIX 工具应该写成过滤器，从标准输入读取输入并将输出写入标准输出。如果可能，您可以更改 helloworld 二进制文件以将文本文件的内容写入标准输出而不是特定文件。这样您就可以使用 shell 在任何地方写入文件。

```
$ cd ~/b

$ ~/a/helloworld > ~/c/helloworld.txt 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2016-03-29T08:07:35.327

只需将最后一个“&&”改成“;” 无论命令失败还是成功，它都会返回：

```
cd SOME_PATH && run_some_command ; cd - 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-24T15:46:04.967

一种方法是创建一个包装外壳脚本。

shell 脚本会将当前目录更改为 /c，然后运行 ​​/a/helloworld。一旦 shell 脚本退出，当前目录将恢复到 /b。

这是一个 bash shell 脚本示例：

```
#!/bin/bash
cd /c
/a/helloworld 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-01-02T03:27:56.337

为什么不保持简单

`cd SOME_PATH && run_some_command && cd -`

最后一个“cd”命令将带您回到最后一个 pwd 目录。这应该适用于所有 *nix 系统。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-24T15:40:18.337

如果您总是希望它转到 /C，请在写入文件时使用绝对路径。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-04-24T16:16:50.183

如果您想在程序中执行此操作，那么我会执行以下操作：

```
#include <unistd.h>
int main()
{
  if(chdir("/c") < 0 )  
  {
     printf("Failed\n");
     return -1 ;
  }

  // rest of your program...

} 
```

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2017-06-20T10:23:23.757

从当前目录提供脚本目录的完整路径以执行命令

```
/root/server/user/home/bin/script.sh 
```

# c# - 动态加载图片到 ReportView

> ID：786377
> 
> 赞同：0
> 
> 时间：2009-04-24T15:36:26.847
> 
> 标签：c#, linq, reportviewer

我的名字是 Ed，我需要从 ReportView dinamic 加载图像。我该怎么做？我使用 Windows 窗体、c# 3.0 和 linq to sql，我需要将图像加载到我的动态报告中。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T18:53:53.380

我假设您正在使用 C# 中的 Microsoft Report Viewer 组件，并且您希望动态地将图像添加到报告中。

这当然是可能的，您需要创建一个具有表示序列化位图的 byte[] 属性的类。

```
class ReportImage {
    public byte[] Image {get;set;}

    // Other stuff here if you want...
} 
```

将此对象的属性设置为您的位图的每像素 24 位序列化版本（即将您的位图保存到 MemoryStream，然后调用 MemoryStream.ToArray()）。您*必须*使用每像素 24 位，并且您保存的格式*必须*是 BMP，这在报告查看器中似乎是必需的。

然后，您可以绑定到对象数据源（有关绑定到对象的详细信息，请参阅[MSDN 文档，另请参阅](http://msdn.microsoft.com/en-us/library/ms251784(VS.80).aspx)[此处](http://www.gotreportviewer.com/Objectds.zip)的示例）。使用图像项在报告中显示您的图像。

限制是报告中的图像必须是固定大小的。您必须事先重新采样图像以适应它们，或者按照 Jon 的建议，为报告动态创建 RDLC 文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-28T20:59:11.007

[这个答案](https://stackoverflow.com/a/826394/8313)非常有帮助（它让我过去在我的报告中出现了一些“损坏的图像”框），但有点误导。

严格来说，“图像”（实际上是一个字节数组）不是 BMP 格式的要求。在一个测试项目中，我能够从磁盘读取 jpeg 文件（即 File.ReadAllBytes(filename); ）并将生成的字节数组添加到“rptrow”列表中的 byte[] 属性（其中 rptrow 是一个表示报告表中一行的所有数据）。报告中的图像将 MIMEType 设置为“image/jpeg”，并将 Source 属性设置为“Database”。我还注意到，只要指定了某些内容（即不是空白），我使用什么 MIMEType 并不重要。

我很着急，所以我什至没有考虑检查它必须是 24bpp 图像的声明。

简化的 rptobj：

```
public class rptobj
{
    public string FileName { get; set; }
    public byte[] Photo { get; set; }

    private List<rptobj> photos;
    public List<rptobj> GetList()
    {
        if (photos == null)
        {
            photos = LoadPhotos();
        }
        return photos;
    }

    private List<rptobj> LoadPhotos()
    {
        var rslt = new List<rptobj>();
        byte[] rawData;
        var path = HttpContext.Current.Server.MapPath(@"~\images");

        DirectoryInfo di = new DirectoryInfo(path);
        FileSystemInfo[] fis = di.GetFileSystemInfos("*.jpg");

        foreach(var fi in fis){
            rawData = File.ReadAllBytes(string.Format(@"{0}\{1}", path, fi.Name ));
            rslt.Add(new rptobj() { Photo = rawData, FileName = fi.Name });
        }
        return rslt;
    }
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-05T18:17:46.103

简短的回答是您不能这样做，至少不能使用内置的报表查看器功能。

但是，如果您确定要这样做，您可以尝试动态创建 RDLC 文件。如果您动态创建 RDLC 文件，您可以动态地将图像添加到报告中。

[您可以在此处](http://gotreportviewer.com/DynamicMatrix.zip)找到一些有关如何动态创建 RDLC 文件的示例代码。

# javascript - 在 jQuery 中使用 Youtube 的 javascript API

> ID：786380
> 
> 赞同：20
> 
> 时间：2009-04-24T15:37:16.893
> 
> 标签：javascript, jquery, api, events, youtube

我目前正在尝试将 YouTube API 用作 jQuery 插件的一部分，但遇到了一些问题。

YT api 的工作方式是加载 Flash 播放器，当它准备好时，它会向名为`onYouTubePlayerReady(playerId)`. 然后，您可以使用该 id 结合`getElementById(playerId)`将 javascript 调用发送到 Flash 播放器（即`player.playVideo();`）。

您可以将事件侦听器附加到播放器，通过该事件侦听器`player.addEventListener('onStateChange', 'playerState');`将任何状态更改发送到另一个全局函数（在本例中`playerState`）。

问题是我不确定如何将状态更改与特定玩家相关联。我的 jQuery 插件可以愉快地将多个视频附加到一个选择器并为每个附加事件，但是当状态实际发生变化时，我会忘记它发生在哪个播放器中。

我希望一些示例代码可以使事情变得更清楚一些。下面的代码应该可以在任何 html 文件中正常工作。

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="application/text+html;utf-8"/>

  <title>Sandbox</title>

  <link type="text/css" href="http://jqueryui.com/latest/themes/base/ui.all.css" rel="stylesheet" />
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
    google.load("jquery", "1.3.2");
    google.load("jqueryui", "1.7.0");
</script>
<script type="text/javascript" src="http://swfobject.googlecode.com/svn/tags/rc3/swfobject/src/swfobject.js"></script>
<script type="text/javascript">
(function($) {
    $.fn.simplified = function() {
        return this.each(function(i) {
            var params = { allowScriptAccess: "always" };
            var atts = { id: "ytplayer"+i };
            $div = $('<div />').attr('id', "containerplayer"+i);
            swfobject.embedSWF("http://www.youtube.com/v/QTQfGd3G6dg&enablejsapi=1&playerapiid=ytplayer"+i, 
                               "containerplayer"+i, "425", "356", "8", null, null, params, atts);
            $(this).append($div);
        });
    }
})(jQuery);
function onYouTubePlayerReady(playerId) {
    var player = $('#'+playerId)[0];
    player.addEventListener('onStateChange', 'playerState');
}
function playerState(state) {
    console.log(state);
}

$(document).ready(function() {
    $('.secondary').simplified();
});
</script>
</head>
<body>
    <div id="container">
        <div class="secondary">

        </div>
        <div class="secondary">

        </div>
        <div class="secondary">

        </div>
        <div class="secondary">

        </div>

    </div>
</body>

</html> 
```

您将看到 console.log() 输出有关状态更改的信息，但是，就像我说的，我不知道如何判断它与哪个玩家相关联。

有人对解决此问题有任何想法吗？

编辑：对不起，我还应该提到我已经尝试将事件调用包装在闭包中。

```
function onYouTubePlayerReady(playerId) {
    var player = $('#'+playerId)[0];
    player.addEventListener('onStateChange', function(state) { 
    return playerState(state, playerId, player); } );
}

function playerState(state, playerId, player) {
    console.log(state);
    console.log(playerId);
} 
```

在这种情况下`playerState`永远不会被调用。这更令人沮丧。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-24T15:46:05.110

编辑：

显然调用`addEventListener`对象`player`会导致脚本被用作传递给 flash 对象的 XML 属性中的字符串 - 这排除了闭包等，所以是时候进行老式的丑陋黑客攻击了：

```
function onYouTubePlayerReady(playerId) {
    var player = $('#'+playerId)[0];

    player.addEventListener('onStateChange', '(function(state) { return playerState(state, "' + playerId + '"); })' );
}

function playerState(state, playerId) {
    console.log(state);
    console.log(playerId);
} 
```

测试和工作！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-09-22T17:02:19.380

我正在使用 Jquery SWFobject 插件，[SWFobject](http://jquery.thewikies.com/swfobject/)

在视频末尾添加 &enablejsapi=1 很重要

HTML：

```
<div id="embedSWF"></div> 
```

查询：

```
 $('#embedSWF').flash({ 
                swf: 'http://www.youtube.com/watch/v/siBoLc9vxac',
                params: { allowScriptAccess: "always"},   
                flashvars: {enablejsapi: '1', autoplay: '0', allowScriptAccess: "always", id: 'ytPlayer' },   
                height: 450,   width: 385 });

function onYouTubePlayerReady(playerId) {
                $('#embedSWF').flash(function(){this.addEventListener("onStateChange", "onPlayerStateChange")});
            }
function onPlayerStateChange(newState) {
                   alert(newState);
                 } 
```

onYouTubePlayerReady 必须在 $(document).ready(function() 之外才能被解雇

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-08T18:59:21.053

我遇到了同样的问题并尝试了接受的答案。这对我不起作用；playerState() 函数从未被调用过。然而，它让我走上了正确的道路。我最终做的是：

```
// Within my mediaController "class"
window["dynamicYouTubeEventHandler" + playerID] = function(state) { onYouTubePlayerStateChange(state, playerID); }
  embedElement.addEventListener("onStateChange", "dynamicYouTubeEventHandler" + playerID);
// End mediaController class

// Global YouTube event handler
function onYouTubePlayerStateChange(state, playerID) {
  var mediaController = GetMediaControllerFromYouTubeEmbedID(playerID);
  mediaController.OnYouTubePlayerStateChange(state);
} 
```

这很糟糕，但 YouTube JavaScript API 的当前状态也是如此。

* * *

如果您使用任何类型的高级原型设计模式，这里还有一些其他有用/讨厌的代码。这基本上允许您从 YouTube 播放器 ID 中检索“类”实例：

```
// Within my mediaController "class"
// The containerJQElement is the jQuery wrapped parent element of the player ID
// Its ID is the same as the player ID minus "YouTubeEmbed".
var _self = this;
containerJQElement.data('mediaController', _self);
// End mediaController class

// Global YouTube specific functions
function GetMediaControllerFromYouTubeEmbedID(embedID) {      
  var containerID = embedID.replace('YouTubeEmbed', '');
  var containerJQObject = $("#" + containerID);
  return containerJQObject.data('mediaController');      
}

function onYouTubePlayerReady(playerId) {
  var mediaController = GetMediaControllerFromYouTubeEmbedID(playerId);
  mediaController.OnYouTubeAPIReady();
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-19T09:52:29.000

这是一篇很好的文章，它通过创建一个类来包装单个播放器，包括使用与先前答案中提到的方法类似的方法将事件分派到单个对象。

[http://blog.jcoglan.com/2008/05/22/dispatching-youtube-api-events-to-individual-javascript-objects/](http://blog.jcoglan.com/2008/05/22/dispatching-youtube-api-events-to-individual-javascript-objects/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-07T18:33:54.683

像这样的东西怎么样：

```
var closureFaker = function (func, scope) {
    var functionName = 'closureFake_' + (((1+Math.random())*0x10000000)|0).toString(16);
    window[functionName] = function () {
        func.apply(scope || window, arguments);
    };
    console.log('created function:', functionName, window[functionName]);
    return functionName;
};

ytplayer.addEventListener("onStateChange", closureFaker(function () {
    //place your logic here
    console.log('state change', arguments)
})); 
```

# javascript - 文本区域上的智能感知插件？

> ID：786382
> 
> 赞同：7
> 
> 时间：2009-04-24T15:37:25.520
> 
> 标签：javascript, jquery, intellisense

是否有任何用于在文本区域中进行智能感知的 jQuery 插件？（只是javascript也可以）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-24T15:59:36.700

您可以在 textareas 上使用[Autocomplete 插件](http://docs.jquery.com/Plugins/Autocomplete)，在代码中指定内联关键字或从数据库中提取关键字，查看此[演示页面](http://view.jquery.com/trunk/plugins/autocomplete/demo/)。

# c# - C# 事件和线程安全

> ID：786383
> 
> 赞同：241
> 
> 时间：2009-04-24T15:37:35.660
> 
> 标签：c#, multithreading, events

**更新**

从 C# 6 开始，这个问题[的答案](https://stackoverflow.com/a/45949862/3195477)是：

```
SomeEvent?.Invoke(this, e); 
```

* * *

我经常听到/阅读以下建议：

`null`在检查并触发它之前，请务必制作一个事件的副本。这将消除线程的潜在问题，即事件`null`位于您检查 null 和触发事件的位置之间的位置：

```
// Copy the event delegate before checking/calling
EventHandler copy = TheEvent;

if (copy != null)
    copy(this, EventArgs.Empty); // Call any handlers on the copied list 
```

*更新*：我从阅读有关优化的文章中想到，这可能还需要事件成员是易失的，但 Jon Skeet 在他的回答中指出 CLR 不会优化副本。

但与此同时，为了让这个问题发生，另一个线程必须做了这样的事情：

```
// Better delist from event - don't want our handler called from now on:
otherObject.TheEvent -= OnTheEvent;
// Good, now we can be certain that OnTheEvent will not run... 
```

实际的顺序可能是这种混合：

```
// Copy the event delegate before checking/calling
EventHandler copy = TheEvent;

// Better delist from event - don't want our handler called from now on:
otherObject.TheEvent -= OnTheEvent;    
// Good, now we can be certain that OnTheEvent will not run...

if (copy != null)
    copy(this, EventArgs.Empty); // Call any handlers on the copied list 
```

关键是`OnTheEvent`在作者退订之后运行，但他们只是专门退订以避免发生这种情况。当然，真正需要的是在`add`和`remove`访问器中具有适当同步的自定义事件实现。此外，如果在触发事件时持有锁，则可能会出现死锁问题。

这就是[Cargo Cult 编程](http://en.wikipedia.org/wiki/Cargo_cult_programming)吗？看起来是这样 - 很多人必须采取这一步骤来保护他们的代码免受多线程的影响，而实际上在我看来，事件需要比这更多的关注才能被用作多线程设计的一部分. 因此，没有采取额外注意的人可能会忽略此建议 - 对于单线程程序来说这根本不是问题，事实上，鉴于`volatile`大多数在线示例代码中没有，该建议可能没有完全没有效果。

（在成员声明上分配空值不是更简单，`delegate { }`这样您就不需要首先检查了`null`吗？）

*更新：*如果不清楚，我确实掌握了建议的意图——在所有情况下都避免出现空引用异常。我的观点是，这个特定的空引用异常只有在另一个线程从事件中删除时才会发生，这样做的唯一原因是确保不会通过该事件接收到进一步的调用，这显然不是通过这种技术实现的. 你会隐瞒比赛条件 - 最好揭示它！该空异常有助于检测组件的滥用。如果您希望您的组件免受滥用，您可以按照 WPF 的示例 - 将线程 ID 存储在您的构造函数中，然后在另一个线程尝试直接与您的组件交互时抛出异常。或者实现一个真正线程安全的组件（不是一件容易的事）。

所以我认为仅仅做这个复制/检查习惯就是货物崇拜编程，给你的代码添加混乱和噪音。要真正防止其他线程需要更多的工作。

**更新以响应 Eric Lippert 的博客文章：**

所以我错过了关于事件处理程序的一件主要事情：“即使在事件被取消订阅后，事件处理程序也必须在被调用时保持健壮”，因此显然我们只需要关心事件的可能性代表存在`null`。*对事件处理程序的要求是否记录在任何地方？*

所以：“还有其他方法可以解决这个问题；例如，初始化处理程序以拥有一个永远不会删除的空操作。但是进行空检查是标准模式。”

所以我的问题剩下的一个片段是，*为什么显式空检查是“标准模式”？*另一种方法是分配空代表，只`= delegate {}`需要添加到事件声明中，这样就消除了每个发起事件的地方的那些小堆臭名昭著的仪式。很容易确保空委托的实例化成本很低。还是我还缺少什么？

肯定是（正如 Jon Skeet 所建议的）这只是 .NET 1.x 的建议，并没有像 2005 年那样消亡吗？

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2009-04-24T15:53:30.393

由于条件的原因，不允许 JIT 执行您在第一部分中谈论的优化。我知道这是不久前提出的一个幽灵，但它是无效的。（我不久前曾与 Joe Duffy 或 Vance Morrison 核对过；我不记得是哪个了。）

如果没有 volatile 修饰符，获取的本地副本可能会过时，但仅此而已。它不会导致`NullReferenceException`.

是的，肯定有竞争条件——但总会有的。假设我们只是将代码更改为：

```
TheEvent(this, EventArgs.Empty); 
```

现在假设该委托的调用列表有 1000 个条目。在另一个线程取消订阅列表末尾附近的处理程序之前，列表开头的操作很可能已经执行。但是，该处理程序仍将被执行，因为它将是一个新列表。（代表是不可变的。）据我所知，这是不可避免的。

使用空委托当然可以避免无效性检查，但不能修复竞争条件。它也不能保证您总是“看到”变量的最新值。

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-04-24T15:56:33.023

我看到很多人都在朝着这样做的扩展方法...

```
public static class Extensions   
{   
  public static void Raise<T>(this EventHandler<T> handler, 
    object sender, T args) where T : EventArgs   
  {   
    if (handler != null) handler(sender, args);   
  }   
} 
```

这为您提供了更好的语法来引发事件......

```
MyEvent.Raise( this, new MyEventArgs() ); 
```

并且还取消了本地副本，因为它是在方法调用时捕获的。

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2009-05-11T06:15:16.140

# “为什么显式空检查'标准模式'？”

我怀疑其原因可能是空检查性能更高。

如果您总是在创建事件时为事件订阅一个空委托，则会产生一些开销：

*   构建空委托的成本。
*   构建委托链以包含它的成本。
*   每次引发事件时调用无意义委托的成本。

（请注意，UI 控件通常有大量事件，其中大多数从未订阅过。必须为每个事件创建一个虚拟订阅者然后调用它可能会对性能造成重大影响。）

我做了一些粗略的性能测试以查看 subscribe-empty-delegate 方法的影响，以下是我的结果：

```
Executing 50000000 iterations . . .
OnNonThreadSafeEvent took:      432ms
OnClassicNullCheckedEvent took: 490ms
OnPreInitializedEvent took:     614ms <--
Subscribing an empty delegate to each event . . .
Executing 50000000 iterations . . .
OnNonThreadSafeEvent took:      674ms
OnClassicNullCheckedEvent took: 674ms
OnPreInitializedEvent took:     2041ms <--
Subscribing another empty delegate to each event . . .
Executing 50000000 iterations . . .
OnNonThreadSafeEvent took:      2011ms
OnClassicNullCheckedEvent took: 2061ms
OnPreInitializedEvent took:     2246ms <--
Done 
```

请注意，对于零个或一个订阅者（对于 UI 控件很常见，其中事件很多），使用空委托预初始化的事件明显较慢（超过 5000 万次迭代......）

有关更多信息和源代码，请访问我在提出这个问题的前一天发布的关于[.NET 事件调用线程安全](http://www.danielfortunov.com/software/%24daniel_fortunovs_adventures_in_software_development/2009/04/23/net_event_invocation_thread_safety)的博客文章（！）

（我的测试设置可能存在缺陷，因此请随时下载源代码并自行检查。非常感谢任何反馈。）

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2011-04-27T19:47:35.887

我真的很喜欢这篇文章——不！即使我需要它来处理称为事件的 C# 功能！

为什么不在编译器中解决这个问题？我知道有 MS 人读过这些帖子，所以请不要喷这个！

**1 - Null 问题**）为什么不首先将事件设为 .Empty 而不是 null ？将保存多少行代码用于空检查或必须将 a`= delegate {}`粘贴到声明上？让编译器处理 Empty 情况，IE 什么也不做！如果这对事件的创建者来说很重要，他们可以检查 .Empty 并做任何他们关心的事情！否则，所有空检查/委托添加都是围绕问题的黑客攻击！

老实说，我厌倦了必须对每个事件都这样做 - 也就是样板代码！

```
public event Action<thisClass, string> Some;
protected virtual void DoSomeEvent(string someValue)
{
  var e = Some; // avoid race condition here! 
  if(null != e) // avoid null condition here! 
     e(this, someValue);
} 
```

**2 - 竞争条件问题**）我阅读了 Eric 的博客文章，我同意 H（处理程序）在取消引用自身时应该处理，但不能使事件不可变/线程安全吗？IE，在其创建时设置一个锁定标志，以便每当它被调用时，它会在执行时锁定所有订阅和取消订阅它？

**结论**，

现代语言不应该为我们解决这些问题吗？

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2017-08-29T23:47:18.297

对于**C# 6**及更高版本，可以使用 new`?.`运算符简化代码，如下所示：

`TheEvent?.Invoke(this, EventArgs.Empty);`

[这](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/member-access-operators#thread-safe-delegate-invocation)是 MSDN 文档。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-11-11T00:18:03.010

根据 Jeffrey Richter 在[CLR via C#](https://rads.stackoverflow.com/amzn/click/com/0735627045)一书中的说法，正确的方法是：

```
// Copy a reference to the delegate field now into a temporary field for thread safety
EventHandler<EventArgs> temp =
Interlocked.CompareExchange(ref NewMail, null, null);
// If any methods registered interest with our event, notify them
if (temp != null) temp(this, e); 
```

因为它强制引用副本。有关更多信息，请参阅书中的事件部分。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-07-16T21:49:43.123

我一直在使用这种设计模式来确保事件处理程序在取消订阅后不会被执行。到目前为止，它运行得很好，尽管我还没有尝试过任何性能分析。

```
private readonly object eventMutex = new object();

private event EventHandler _onEvent = null;

public event EventHandler OnEvent
{
  add
  {
    lock(eventMutex)
    {
      _onEvent += value;
    }
  }

  remove
  {
    lock(eventMutex)
    {
      _onEvent -= value;
    }
  }

}

private void HandleEvent(EventArgs args)
{
  lock(eventMutex)
  {
    if (_onEvent != null)
      _onEvent(args);
  }
} 
```

这些天，我主要使用 Mono for Android，当您在 Activity 发送到后台后尝试更新 View 时，Android 似乎不喜欢它。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-24T16:04:24.643

这种做法并不是要强制执行特定的操作顺序。它实际上是关于避免空引用异常。

人们关心空引用异常而不是竞争条件的原因需要一些深入的心理学研究。我认为这与修复空引用问题要容易得多这一事实有关。一旦解决了这个问题，他们就会在代码上挂一个大大的“任务完成”横幅，然后解开飞行服的拉链。

注意：修复竞争条件可能涉及使用同步标志跟踪处理程序是否应该运行

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-01T05:33:16.987

所以我在这里聚会有点晚了。:)

至于使用 null 而不是 null 对象模式来表示没有订阅者的事件，请考虑这种情况。您需要调用一个事件，但构造对象 (EventArgs) 并非易事，而且在通常情况下，您的事件没有订阅者。如果您可以优化您的代码以检查您是否有任何订阅者，然后再提交处理工作以构造参数和调用事件，这对您将是有益的。

考虑到这一点，一个解决方案是说“嗯，零订阅者由 null 表示”。然后在执行昂贵的操作之前简单地执行空检查。我想另一种方法是在 Delegate 类型上使用 Count 属性，因此只有在 myDelegate.Count > 0 时才执行昂贵的操作。使用 Count 属性是一种很好的模式，可以解决原始问题允许优化，并且它还具有能够在不导致 NullReferenceException 的情况下被调用的良好属性。

但是请记住，由于委托是引用类型，因此它们可以为空。也许根本没有什么好的方法可以隐藏这个事实并仅支持事件的空对象模式，因此替代方案可能会迫使开发人员同时检查空订阅者和零订阅者。那将比现在的情况更丑陋。

注意：这是纯粹的猜测。我不涉及 .NET 语言或 CLR。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-24T15:46:10.367

对于单线程应用程序，您是正确的，这不是问题。

但是，如果您正在制作一个公开事件的组件，则无法保证您的组件的使用者不会使用多线程，在这种情况下，您需要为最坏的情况做好准备。

使用空委托确实可以解决问题，但也会导致每次调用事件时性能受到影响，并且可能会产生 GC 影响。

您是对的，消费者尝试取消订阅以使这种情况发生，但如果他们通过临时副本，则考虑该消息已经在传输中。

如果你不使用临时变量，也不使用空委托，并且有人取消订阅，你会得到一个空引用异常，这是致命的，所以我认为这个成本是值得的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-24T17:31:31.097

我从来没有真正认为这是一个很大的问题，因为我通常只在我的可重用组件上的静态方法（等）中防止这种潜在的线程错误，并且我不制作静态事件。

我做错了吗？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-27T18:49:38.667

在施工中连接您的所有活动，不要管它们。Delegate 类的设计不可能正确处理任何其他用法，我将在本文的最后一段中解释。

首先，当您的事件*处理程序*必须已经就是否/如何**响应通知做出同步决定时，尝试***拦截*事件**通知**是没有意义的。

 ***任何可能被通知的事情，都应该被通知。如果您的事件处理程序正确处理通知（即他们有权访问权威的应用程序状态并仅在适当时响应），那么可以随时通知他们并相信他们会正确响应。

唯一不应该通知处理程序事件发生的情况是事件实际上没有发生！因此，如果您不希望通知处理程序，请停止生成事件（即禁用控件或首先负责检测和使事件存在的任何东西）。

老实说，我认为 Delegate 类是无法挽救的。向 MulticastDelegate 的合并/转换是一个巨大的错误，因为它有效地将事件的（有用的）定义从发生在某个时刻的事情变成了在一段时间内发生的事情。这种变化需要一种同步机制，可以在逻辑上将其折叠回单个瞬间，但 MulticastDelegate 缺少任何此类机制。同步应该包括事件发生的整个时间跨度或瞬间，以便一旦应用程序做出开始处理事件的同步决定，它就会完全（事务性地）完成处理。使用 MulticastDelegate/Delegate 混合类的黑盒，这几乎是不可能的，所以**坚持使用单订阅者和/或实现您自己的 MulticastDelegate 类型，它具有可以在使用/修改处理程序链时取出的同步句柄**。我推荐这个，因为替代方案是在所有处理程序中冗余地实现同步/事务完整性，这将是荒谬/不必要的复杂。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-04-26T16:10:57.903

请看这里：[http](http://www.danielfortunov.com/software/%24daniel_fortunovs_adventures_in_software_development/2009/04/23/net_event_invocation_thread_safety) ://www.danielfortunov.com/software/%24daniel_fortunovs_adventures_in_software_development/2009/04/23/net_event_invocation_thread_safety 这是正确的解决方案，应始终使用而不是所有其他解决方法。

“您可以通过使用无操作匿名方法对其进行初始化来确保内部调用列表始终具有至少一个成员。因为没有外部方可以引用匿名方法，所以没有外部方可以删除该方法，因此委托永远不会为空” — 编程 .NET 组件，第 2 版，作者：Juval Löwy

```
public static event EventHandler<EventArgs> PreInitializedEvent = delegate { };  

public static void OnPreInitializedEvent(EventArgs e)  
{  
    // No check required - event will never be null because  
    // we have subscribed an empty anonymous delegate which  
    // can never be unsubscribed. (But causes some overhead.)  
    PreInitializedEvent(null, e);  
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-10-22T01:56:36.917

我不相信这个问题仅限于 c#“事件”类型。消除这个限制，为什么不重新发明轮子并按照这些思路做点什么？

[安全地引发事件线程 - 最佳实践](https://stackoverflow.com/questions/3668953/raise-event-thread-safely-best-practice/19507576#19507576)

*   能够在提升期间从任何线程订阅/取消订阅（竞争条件已删除）
*   += 和 -= 在类级别的运算符重载。
*   通用调用者定义的委托

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-10-18T07:18:30.600

感谢您的有用讨论。我最近正在解决这个问题，并制作了以下课程，它有点慢，但可以避免调用已处置的对象。

这里的要点是即使引发事件也可以修改调用列表。

```
/// <summary>
/// Thread safe event invoker
/// </summary>
public sealed class ThreadSafeEventInvoker
{
    /// <summary>
    /// Dictionary of delegates
    /// </summary>
    readonly ConcurrentDictionary<Delegate, DelegateHolder> delegates = new ConcurrentDictionary<Delegate, DelegateHolder>();

    /// <summary>
    /// List of delegates to be called, we need it because it is relatevely easy to implement a loop with list
    /// modification inside of it
    /// </summary>
    readonly LinkedList<DelegateHolder> delegatesList = new LinkedList<DelegateHolder>();

    /// <summary>
    /// locker for delegates list
    /// </summary>
    private readonly ReaderWriterLockSlim listLocker = new ReaderWriterLockSlim();

    /// <summary>
    /// Add delegate to list
    /// </summary>
    /// <param name="value"></param>
    public void Add(Delegate value)
    {
        var holder = new DelegateHolder(value);
        if (!delegates.TryAdd(value, holder)) return;

        listLocker.EnterWriteLock();
        delegatesList.AddLast(holder);
        listLocker.ExitWriteLock();
    }

    /// <summary>
    /// Remove delegate from list
    /// </summary>
    /// <param name="value"></param>
    public void Remove(Delegate value)
    {
        DelegateHolder holder;
        if (!delegates.TryRemove(value, out holder)) return;

        Monitor.Enter(holder);
        holder.IsDeleted = true;
        Monitor.Exit(holder);
    }

    /// <summary>
    /// Raise an event
    /// </summary>
    /// <param name="args"></param>
    public void Raise(params object[] args)
    {
        DelegateHolder holder = null;

        try
        {
            // get root element
            listLocker.EnterReadLock();
            var cursor = delegatesList.First;
            listLocker.ExitReadLock();

            while (cursor != null)
            {
                // get its value and a next node
                listLocker.EnterReadLock();
                holder = cursor.Value;
                var next = cursor.Next;
                listLocker.ExitReadLock();

                // lock holder and invoke if it is not removed
                Monitor.Enter(holder);
                if (!holder.IsDeleted)
                    holder.Action.DynamicInvoke(args);
                else if (!holder.IsDeletedFromList)
                {
                    listLocker.EnterWriteLock();
                    delegatesList.Remove(cursor);
                    holder.IsDeletedFromList = true;
                    listLocker.ExitWriteLock();
                }
                Monitor.Exit(holder);

                cursor = next;
            }
        }
        catch
        {
            // clean up
            if (listLocker.IsReadLockHeld)
                listLocker.ExitReadLock();
            if (listLocker.IsWriteLockHeld)
                listLocker.ExitWriteLock();
            if (holder != null && Monitor.IsEntered(holder))
                Monitor.Exit(holder);

            throw;
        }
    }

    /// <summary>
    /// helper class
    /// </summary>
    class DelegateHolder
    {
        /// <summary>
        /// delegate to call
        /// </summary>
        public Delegate Action { get; private set; }

        /// <summary>
        /// flag shows if this delegate removed from list of calls
        /// </summary>
        public bool IsDeleted { get; set; }

        /// <summary>
        /// flag shows if this instance was removed from all lists
        /// </summary>
        public bool IsDeletedFromList { get; set; }

        /// <summary>
        /// Constuctor
        /// </summary>
        /// <param name="d"></param>
        public DelegateHolder(Delegate d)
        {
            Action = d;
        }
    }
} 
```

用法是：

```
 private readonly ThreadSafeEventInvoker someEventWrapper = new ThreadSafeEventInvoker();
    public event Action SomeEvent
    {
        add { someEventWrapper.Add(value); }
        remove { someEventWrapper.Remove(value); }
    }

    public void RaiseSomeEvent()
    {
        someEventWrapper.Raise();
    } 
```

**测试**

我以以下方式对其进行了测试。我有一个线程可以创建和销毁这样的对象：

```
var objects = Enumerable.Range(0, 1000).Select(x => new Bar(foo)).ToList();
Thread.Sleep(10);
objects.ForEach(x => x.Dispose()); 
```

在`Bar`（监听器对象）构造函数中，我订阅`SomeEvent`（如上所示实现）并取消订阅`Dispose`：

```
 public Bar(Foo foo)
    {
        this.foo = foo;
        foo.SomeEvent += Handler;
    }

    public void Handler()
    {
        if (disposed)
            Console.WriteLine("Handler is called after object was disposed!");
    }

    public void Dispose()
    {
        foo.SomeEvent -= Handler;
        disposed = true;
    } 
```

我也有几个线程在循环中引发事件。

所有这些操作都是同时执行的：创建和销毁许多侦听器，同时触发事件。

如果有竞争条件，我应该在控制台中看到一条消息，但它是空的。但是如果我像往常一样使用 clr 事件，我会看到它充满了警告消息。因此，我可以得出结论，可以在 c# 中实现线程安全事件。

你怎么看？

# visual-studio - VisualSVN 和 Web 部署项目的推荐文件设置

> ID：786385
> 
> 赞同：2
> 
> 时间：2009-04-24T15:38:47.670
> 
> 标签：visual-studio, svn, visualsvn

我们的 ASP.NET 网上商店开始从 VisualSourceSafe 迁移到 Subversion (VisualSVN/TortoiseSVN)。

Subversion 需要将所有文件都放在一个目录树中。这在使用 Web 应用程序项目时很简单 - 一切都存在于

*   **\Visual Studio 2008\Projects\MyProject**

但是，对于 Web 部署项目，它有点混乱。你有

*   **\Visual Studio 2008\Website\MyProject**用于网站本身
*   **\Visual Studio 2008\Projects\MyProject**用于解决方案文件
*   **\Visual Studio 2008\Projects\MyProject\MyProject_deploy**包含网站的完整“部署”版本

在 SVN 中管理这个的最佳实践是什么？我是否应该将网站移动到**\Visual Studio 2008\Projects\MyProject**下并将整个内容添加到存储库中，包括网站的部署版本？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T17:26:30.000

最佳做法是将解决方案文件保留在项目结构的根目录中，每个项目都放在一个子文件夹中。这样，如果人们愿意，可以在没有解决方案文件的情况下单独签出每个项目。

因此，在您的情况下，您应该在您的 SVN 存储库中具有以下内容：

svn://{repository_root}/MyProject/Website/ {所有网站文件包括 .proj 文件} svn://{repository_root}/MyProject/WebsiteDeployment/ {所有部署文件包括 .proj 文件} svn://{repository_root} /MyProject/MyProject.sln

所以你的问题的答案是肯定的，你应该把所有东西都移到一个名为“MyProject”的文件夹下。

编辑：您还应该考虑拥有 MyProject/Trunk、MyProject/Tags 和 MyProject/Branches，根据[SVN 手册](http://svnbook.red-bean.com/en/1.5/svn.reposadmin.planning.html)，这被认为是最佳实践。

# windows - 这就是我在 Windows 上安装 JRuby 的方式 -> 为什么它不起作用？

> ID：786387
> 
> 赞同：3
> 
> 时间：2009-04-24T15:38:58.777
> 
> 标签：windows, installation, jruby

```
* Download JRuby 1.20\. (zip file)
* Extract the zip into C:\JRuby120
* Edit sytem "environment variables":
* Add JRUBY_HOME -> point it to C:\JRuby120
* Modify the PATH environment variable to point to C:\JRuby120\bin; 
```

毕竟，我打开 cmd.exe 并输入**jruby**

->“系统找不到指定的路径”

我做错什么了？

我从 C:\JRuby120\bin\jruby.bat、C:\JRuby120\bin_jrubyvars.bat 和 C:\JRuby120\bin_jrubyvmopts.bat 中删除了 echo_off，并从 cmd.exe 调用了 jruby。这是输出：

```
C:\>rem --------------------------------------------------------------------------- 

C:\>rem jruby.bat - Start Script for the JRuby Interpreter 

C:\>rem

C:\>rem for info on environment variables, see internal batch script _jrubyvars.bat 

C:\>setlocal

C:\>rem Sometimes, when jruby.bat is being invoked from another BAT file, 

C:\>rem C:\JRuby120\bin\ is incorrect and points to the current dir, not to JRuby's bin dir, 

C:\>rem so we look on the PATH in such cases. 

C:\>IF EXIST "C:\JRuby120\bin\_jrubyvars.bat" (set FULL_PATH=C:\JRuby120\bin\ )  ELSE (set FULL_PATH=C:\JRuby120\bin\ ) 

C:\>call "C:\JRuby120\bin\_jrubyvars.bat"  

C:\>rem Environment Variable Prequisites: 

C:\>rem

C:\>rem   JRUBY_OPTS    (Optional) Default JRuby command line args. 

C:\>rem

C:\>rem   JAVA_HOME     Must point at your Java Development Kit installation. 

C:\>rem

C:\>rem ----- Save Environment Variables That May Change -------------------------- 

C:\>set _CLASSPATH=.; 

C:\>set _CP= 

C:\>set _JRUBY_CP= 

C:\>set JRUBY_BAT_ERROR=0 

C:\>rem ----- Verify and Set Required Environment Variables ----------------------- 

C:\>if not "C:\Program Files\Java\jdk1.6.0_11\bin" == "" goto gotJava 

C:\>set JRUBY_HOME=C:\JRuby120\bin\.. 

C:\>rem ----- Prepare Appropriate Java Execution Commands ------------------------- 

C:\>if not "" == "" goto gotCommand 

C:\>set _JAVA_COMMAND= 

C:\>set JAVA_COMMAND=java 

C:\>if not "Windows_NT" == "Windows_NT" goto noTitle 

C:\>rem set _STARTJAVA=start "JRuby" "C:\Program Files\Java\jdk1.6.0_11\bin\bin\java" 

C:\>set _STARTJAVA=C:\Program Files\Java\jdk1.6.0_11\bin\bin\java 

C:\>goto gotTitle 

C:\>rem ----- Set up the VM options 

C:\>call "C:\JRuby120\bin\_jrubyvmopts"  

C:\>set _MEM=-Xmx500m 

C:\>if not defined JAVA_MEM goto memOptDone 

C:\>set _STK=-Xss1024k 

C:\>if not defined JAVA_STACK goto stackOptDone 

C:\>set _VM_OPTS= 

C:\>set _RUBY_OPTS= 

C:\>set _DFLT_VM_OPTS= 

C:\>set _JAVA_VM=-client 

C:\>set SAFE_JAVA_HOME=C:\Program Files\Java\jdk1.6.0_11\bin 

C:\>set SAFE_JAVA_HOME=C:\Program Files\Java\jdk1.6.0_11\bin 

C:\>rem

C:\>rem Can you believe I'm rewriting batch arg processing in batch files because batch 

C:\>rem file arg processing sucks so bad? Can you believe this is even possible? 

C:\>rem http://support.microsoft.com/kb/71247 

C:\>rem Escape any quotes. Use _S for ', _D for ", and _U to escape _ itself. 

C:\>rem We have to escape _ itself, otherwise file names with _S and _D 

C:\>rem will be converted to to wrong ones, when we un-escape. See JRUBY-2821\. 

C:\>set _ARGS= 

C:\>if not defined _ARGS goto vmoptsDone 

C:\>set _VM_OPTS= -client -Xmx500m -Xss1024k  

C:\>set _DFLT_VM_OPTS= 

C:\>set _MEM= 

C:\>set _STK= 

C:\>set _ARGS= 

C:\>set _VAL= 

C:\>set _CMP= 

C:\>set _CMP1= 

C:\>set _JAVA_VM= 

C:\>set _RUNJAVA="C:\Program Files\Java\jdk1.6.0_11\bin\bin\java" 

C:\>rem ----- Set Up The Boot Classpath ---------------------------------------- 

C:\>for %i in ("C:\JRuby120\bin\..\lib\jruby*.jar") do @call :setjrubycp %i 

C:\>if not "" == "" goto addjrubycp 

C:\>set JRUBY_CP=C:\JRuby120\bin\..\lib\jruby.jar 

C:\>goto :EOF 

C:\>for %i in ("C:\JRuby120\bin\..\lib\bsf*.jar") do @call :setjrubycp %i 

C:\>if not "C:\JRuby120\bin\..\lib\jruby.jar" == "" goto addjrubycp 

C:\>set JRUBY_CP=C:\JRuby120\bin\..\lib\jruby.jar;C:\JRuby120\bin\..\lib\bsf.jar 

C:\>goto :EOF 

C:\>rem ----- Set Up The System Classpath ---------------------------------------- 

C:\>for %i in ("C:\JRuby120\bin\..\lib\*.jar") do @call :setcp %i 

C:\>if not "" == "" goto add 

C:\>set CP=C:\JRuby120\bin\..\lib\bsf.jar 

C:\>goto :EOF 

C:\>if not "C:\JRuby120\bin\..\lib\bsf.jar" == "" goto add 

C:\>set CP=C:\JRuby120\bin\..\lib\bsf.jar;C:\JRuby120\bin\..\lib\jruby.jar 

C:\>goto :EOF 

C:\>if not "C:\JRuby120\bin\..\lib\bsf.jar;C:\JRuby120\bin\..\lib\jruby.jar" == "" goto add 

C:\>set CP=C:\JRuby120\bin\..\lib\bsf.jar;C:\JRuby120\bin\..\lib\jruby.jar;C:\JRuby120\bin\..\lib\profile.jar 

C:\>goto :EOF 

C:\>goto :EOF 

C:\>if 0 == 0 "C:\Program Files\Java\jdk1.6.0_11\bin\bin\java"  -client -Xmx500m -Xss1024k  -Xbootclasspath/a:"C:\JRuby120\bin\..\lib\jruby.jar;C:\JRuby120\bin\..\lib\bsf.jar" -classpath "C:\JRuby120\bin\..\lib\bsf.jar;C:\JRuby120\bin\..\lib\jruby.jar;C:\JRuby120\bin\..\lib\profile.jar;.;" -Djruby.home="C:\JRuby120\bin\.." -Djruby.lib="C:\JRuby120\bin\..\lib" -Djruby.shell="cmd.exe" -Djruby.script=jruby.bat org.jruby.Main   

C:\>set E=3 

C:\>call "C:\JRuby120\bin\_jrubycleanup" 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-24T15:44:05.737

嗯，这就是你应该做的。转到命令行并输入`echo %PATH%`并确保您的 jruby bin 目录在那里。

* * *

## 编辑：

忽略上述内容，这不是您因为 jruby 不在路径中而得到的错误。“系统找不到指定的路径”错误是因为路径不存在，很可能是您的 Java JDK 的路径。运行`echo %JAVA_HOME%`。确保路径正确。如果您没有 Java JDK，可以[在此处下载](http://java.sun.com/javase/downloads/index.jsp)。

* * *

## 编辑2：

看到 jruby.bat 的输出后，问题似乎出在 find`_jrubyvars.bat`或在其中找到调用的内容。它唯一调用的是`_jrubyvmopts.bat`，它不调用其他任何东西。确保它存在`C:\JRuby120\bin\_jrubyvars.bat`，`C:\JRuby120\bin\_jrubyvmopts.bat`尽管我看不出他们不应该这样做的原因。如果它们都存在，那么下一步就是`@echo off`从它们中删除行，看看我们是否能准确找到错误调用发生的位置。

* * *

## 编辑 3：

看到所有输出后，看起来`JAVA_HOME`设置为“ `C:\Program Files\Java\jdk1.6.0_11\bin\`” `JAVA_HOME`应该是父目录： `C:\Program Files\Java\jdk1.6.0_11\`“。试一试，这次交叉手指。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-29T09:37:04.010

将 JAVA_HOME 的值从 C:\Program Files\Java\jdk1.6.0_11\bin 更改为 C:\Program Files\Java\jdk1.6.0_11\ 对我有用。我的环境：Win XP，将 c:\jruby\bin 添加到 PATH 变量并创建指向 c:\jruby 的 JRUBY_HOME。

谢谢你

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-03T09:36:38.867

我的 JAVA_HOME 环境变量丢失了。修复在 Windows 7 中对我有用的问题

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-12-16T08:04:42.370

我遇到了同样的问题，并尝试了这里提到的所有内容，但均未成功。

我的解决方案：重启你的电脑。为我工作！

# ruby-on-rails - 如何折叠这个非常重复的 Ruby/Rails 代码？

> ID：786390
> 
> 赞同：1
> 
> 时间：2009-04-24T15:40:10.787
> 
> 标签：ruby-on-rails, ruby

我有两个小的结构性问题，鉴于我对 RoR 的相对新手，我不确定如何处理。

**第一个问题：**在我的一个观点中，我的代码如下所示：

```
<ul style="list-style-type: circle">
  <li><%= @apples.size %> apples</li>
  <li><%= @oranges.size %> oranges</li>
  <li><%= @bananas.size %> bananas</li>
  <li><%= @grapefruits.size %> grapefruits</li>
</ul> 
```

是否可以重构它，以便我只需要在一些不同种类的水果列表上迭代一次，并`<li>`自动生成适当的 '？**编辑：**我忘了添加`@apples`，`@oranges`等，可能是`nil`。有没有一种惯用的方法来处理它？

**第二个问题：**在我的控制器中，我的代码如下所示：

```
@apples = Apple.find(:all)
@apples.each { |apple| apple.do_stuff(:xyz) }

@bananas = Banana.find(:all)
@bananas.each = { |banana| banana.do_stuff(:xyz) }

# ... &c 
```

如您所见，相同的操作以完全相同的方式被多次调用。有没有办法将其缩短为类似的东西`[Apple.find(:all), ...].each { |fruit| ... }`并改为使用它？

非常感谢您的帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-24T15:51:40.133

我会在帮手中做到这一点

```
def fruit_size(fruit)
  list = @fruits[fruit]
  return if list.empty?

  content_tag(:li, "#{list.size} #{fruit}")
end 
```

这在视图中：

```
<% ["apples", "oranges", "bananas", .....].each do |fruit| %>
  <%= fruit_size(fruit)
<% end %> 
```

在您的控制器中：

```
@fruits = {}
["apples", "oranges", "bananas", ......].each do |fruit|
  @fruits[fruit] = fruit.classify.constantize.find(:all).each {|record|
    record.whatever_here
  end
end 
```

将所有项目存储在哈希中是有意义的`@fruits`，这样您就不必使用`instance_variable_get`和填充。

也许您还想在某处定义该数组，这样您就不必在控制器和视图中重复它。让我们假设你有一个水果模型。

```
class Fruit < ActiveRecord::Base
  FRUITS = ["apples", "oranges", "bananas", ....]
end 
```

然后，在视图和控制器中使用 Fruit::FRUITS。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T15:49:55.600

对于第一部分：

```
 @li = ''
    [@apples, @oranges, @bananas, @grapefruit].each{|fruit| 
       @li << "<li>#{fruit.size}</li>"}

    <ul style="list-style-type: circle">
    <%=@li%>
    </ul> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T17:10:26.433

你实际上可以很简单地做到这一点。

在您的控制器中：

```
def whatever
  @fruits = {
    :apples => Apple.find(:all).each{ |a| a.do_stuff(:xyz) }, 
    :bananas => Banana.find(:all).each{ |a| a.do_stuff(:xyz) } # ... 
  }
end 
```

在您看来：

```
<% @fruits.each |k, v| %>
  <li><%= v.nil? ? 0 : v.size %> <%= k.to_s %></li>
<% end %> 
```

尽管您可能想考虑是否`do_stuff`可以通过更复杂的查找器或命名范围来完成某些事情。

# delphi - *有时*在 Delphi 中分配给常量时会出错

> ID：786403
> 
> 赞同：8
> 
> 时间：2009-04-24T15:43:13.603
> 
> 标签：delphi, delphi-2007

我正在使用带有所有补丁和更新的 Delphi 2007。

我有一个文件被两个不同的项目使用。该文件中有一个过程，我将简化如下：

```
procedure MyProcedure;
const
  UniqueValue: integer = 0;
begin
  //some code
  Inc(UniqueValue);
  //some more code
end; 
```

Inc() 命令应该失败，因为您不能分配给常量。在一个项目中，我得到了一个错误（我称该项目为“准确”）。在另一个项目中，我没有收到任何错误（我将其称为“Bogus”）。我也没有收到任何警告。我不明白为什么编译器会让这个不正确的代码通过。

这是我在 Bogus 项目中尝试过的：

1 - 引入一个明显的错误，比如在一行中间输入“slkdjflskdjf”

结果：我得到一个错误，这证明它确实在尝试编译这个文件。

2 - 删除.DCU，并重建项目

结果：.DCU 重新生成，再次证明该项目确实在编译此错误代码。

有没有人想过为什么会发生这种行为？更具体地说，为什么它会发生在一个项目中而不是另一个项目中？是否有一些模糊的编译器选项允许分配给常量？

最后一点：两个项目都是从 Delphi 5 转换而来的。在具有相似代码的 Delphi 5 下，它们都可以正常编译。

**编辑：感谢您的所有帮助。更改可分配类型常量指令后，我可以在两个项目中获得一致的行为。我今天学了些新东西...**

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-24T15:53:30.440

在编译器选项中有一个名为“可分配类型常量”的选项。它也可以在您的代码中使用“{$J+}”启用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-24T15:52:38.993

难道这些项目在 $J 编译器指令的设置上有所不同吗？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-24T15:58:10.447

我建议检查项目选项，*编译器*部分，看看你是否能发现任何差异。也许您在 Bogus 项目中启用了选项*Assignable typed constants 。*

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-24T15:55:39.920

正如其他人所说，这几乎可以肯定是`{$J+}`指令。

如果您有差异工具，您可以比较项目文件以了解它们的不同之处 - 它们只是文本文件 - 以解决将来类似的问题。

# asp.net - 自动调整文本区域（多行 asp:TextBox）

> ID：786405
> 
> 赞同：4
> 
> 时间：2009-04-24T15:43:38.763
> 
> 标签：asp.net, html, css

我有一个 MultiLine asp:Textbox（一个标准的 html 文本区域，适用于那些非 asp 的人），我想自动调整大小以仅通过 css 来适应它的所有内容。这样做的原因是我希望它在 Web 浏览器中具有指定的高度，并启用滚动。

但是，我已经实现了一个打印样式表，并且希望在打印时显示位于 textarea 中的所有文本，并且不隐藏溢出。

我可以在 print.css 文件问题中手动指定文本区域的高度，因为这些字段是可选的，并且 350 像素的空白框不是最佳的，并且总有可能出现比这更多的文本......

我试过使用：

```
height: auto;
height: 100%; 
```

在 IE 和 Firefox 中，当您没有在 asp:Textbox 标记上指定高度时，这些似乎被 html 标记中必须由 .NET 生成的表单的指定行数覆盖，这似乎只接受数值测量，如 px em 等......

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T16:02:25.070

您所要求的（CSS 解决方案）是不可能的。

textarea的内容不是html元素，所以不能被css用来计算textarea的大小。

唯一可以工作的是Javascript，例如读取`scrollHeight`属性并使用它来设置元素的高度。该`scrollHeight`属性仍然是非标准的，因此它可能不适用于所有浏览器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T15:59:21.240

jQuery 或 javascript 函数来查找和扩大文本框可能是最好的解决方案 - 至少我发现的就是这样

我们使用这组函数并在页面加载后调用干净的表单（我知道这不是最好的解决方案，并且正在努力转移到更优雅的 jQuery 解决方案） - 一个注意确保你的文本区域有行和列指定或它不能正常工作。

```
function countLines(strtocount, cols)
{ 
    var hard_lines = 1; 
    var last = 0; 
    while (true) 
    { 
        last = strtocount.indexOf("\n", last + 1); 
        hard_lines++; 
        if (last == -1) break; 
    } 
    var soft_lines = Math.round(strtocount.length / (cols - 1)); 
    var hard = eval("hard_lines  " + unescape("%3e") + "soft_lines;"); 
    if (hard) soft_lines = hard_lines; return soft_lines; 
}

function cleanForm() 
{
    var the_form = document.forms[0];
    for (var i = 0, il = the_form.length; i < il; i++)
    { 
        if (!the_form[i]) continue; 
        if (typeof the_form[i].rows != "number") continue;
        the_form[i].rows = countLines(the_form[i].value, the_form[i].cols) + 1; 
    }    
    setTimeout("cleanForm();", 3000);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-25T10:33:44.273

如果您将行数设置为高得离谱的数字，则 CSS 高度规则应在屏幕上覆盖它。

然后在打印样式表中将高度设置为自动。这可能会导致一些大的空白区域，其中所有可用行都没有被填满，但至少所有文本都是可见的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-14T07:34:07.283

试试 jQuery 的 autogrow() @

[http://plugins.jquery.com/project/autogrow](http://plugins.jquery.com/project/autogrow)

# sharepoint - 从 Layouts 目录运行 MasterPages

> ID：786409
> 
> 赞同：3
> 
> 时间：2009-04-24T15:44:31.710
> 
> 标签：sharepoint, sharepoint-2007, master-pages

为了简化我们的 SharePoint 环境，我希望有一个中央和单一的位置来存储所有母版页，因此我希望直接从 _layouts 目录引用母版页文件。

我将文件添加到“\LAYOUTS\MyMasterPages”目录，然后更新 SPWeb 对象以使用该路径：

```
web.MasterUrl = "/_layouts/MyMasterPages/newdefault.master" 
```

但是当我访问该站点时，我得到：

> 此页面上不允许引用的文件“/_layouts/MyMasterPages/newdefault.master”。在 System.Web.UI.TemplateParser.ProcessError(String message) 在 System.Web.UI.BaseTemplateParser.GetReferencedType(VirtualPath virtualPath, Boolean allowNoCompile)
> 在 System.Web.UI.PageParser.ProcessMainDirectiveAttribute(String deviceName, String name, String value , IDictionary parseData) 在 System.Web.UI.TemplateParser.ProcessMainDirective(IDictionary mainDirective)

我假设这可能是由于信任级别的安全策略和 CAS 配置，但我不完全确定。有没有办法允许这种在整个企业中使用母版页的中心方式，还是我被 /_catalog/ 虚拟路径卡住了？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-09-12T14:21:07.287

This worked for me:

```
protected override void OnPreInit(EventArgs e)
{
    base.OnPreInit(e);
    this.MasterPageFile = "path to masterpage";
} 
```

as proposed on: [How to use the site's masterpage from a _layout SharePoint page?](https://stackoverflow.com/questions/435019/how-to-use-the-sites-masterpage-from-a-layout-sharepoint-page)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-02-18T20:06:15.343

The master page used by a SharePoint site must be located in the master page gallery. This is a hard requirement by SharePoint as far as I know.

This gives you more benefit than you might think. This allows you to change the master page in realtime using SharePoint designer with the changes only visible to you. Once the master page is check-in and published as a major version, the change becomes visible to the public. You also have version history on the master page.

I understand you pain, I have been in the same situation as you are. What I learned is: don't fight the platform, just work within it.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T16:22:23.553

我的理解（但我不知道为什么）是母版页需要位于每个网站集的母版页库中。

由于您需要将这些包部署到场中的每个 SharePoint 服务器（前端、应用程序、数据库等），我认为该要求要么与集群有关，要么与数据库和重影有关。

无论哪种情况，请务必使用自定义功能作为部署母版页的方式，无论您的场大小如何。

我理解想要使用 SharePoint 以自己的方式做事，虽然我通常会接受这种想法，但过去一年的痛苦告诉我，生活在推荐的 SharePoint 范围内是最好的方法。

# ruby-on-rails - python的getattr的红宝石等价物是什么

> ID：786412
> 
> 赞同：11
> 
> 时间：2009-04-24T15:44:47.013
> 
> 标签：ruby-on-rails, ruby, language-comparisons

我是 Rails 的新手，并尝试进行一些重构（放置一个在 app/views/shared 中列出标题的部分渲染器）渲染器显示日期和标题。然而，渲染器的不同用户使用不同的日期。通过重构我有的一部分

```
title_date = list_titles.created_on 
```

对于渲染器的其他用户，我想要

```
title_date = list_titles.updated_on 
```

那么我可以使用我通过的字符串（使用 :locals 参数）吗？我知道在 Python 中我可以做到

```
date_wanted = 'created_on'
title_date = getattr(list_titles, date_wanted) 
```

但我不知道如何在红宝石中做到这一点。（显然，在 Rails 中，我会从调用部分渲染器的视图中传递 date_wanted 字符串。）

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-24T15:51:40.977

Ruby 中的等效语句：

```
date_wanted = :created_on
title_date = list_titles.send(date_wanted) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-02T16:04:08.103

我认为原始问题的答案是发送：

```
irb(main):009:0> t = Time.new
=> Thu Jul 02 11:03:04 -0500 2009
irb(main):010:0> t.send('year')
=> 2009 
```

send 允许您在对象上动态调用任意命名的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T15:51:34.813

你可以像这样向模型添加一个函数

```
def get_date(date)
  return created_on if date == 'created'
  return updated_on
end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-25T09:12:43.250

马特的回答对于您的确切问题是正确的，我可能无法理解您的情况，但是......

我会通过本地哈希将整个用户对象传递给部分。

```
render( 
  :partial => "shared/titles", 
  :object => @titles, 
  :locals => { :user => @user } 
) 
```

然后在部分调用一个辅助方法来返回每个标题的正确日期，例如：

```
<p><%= title_date_for_user(title, user) %></p> 
```

将用户和每个标题对象传递给辅助方法。

```
def title_date_for_user(title, user)
  case user.date_i_like_to_see
  when "created_on"
    title_date = title.created_on
  when "updated_on"
    title_date = title.updated_on
  end
  return title_date.to_s(:short)
end 
```

该`date_i_like_to_see`方法驻留在 User 模型中，并根据特定于给定用户的某些逻辑返回一个字符串 (`created_on`或)。`updated_on`

这种方法隐藏了大部分逻辑，并使您的视图保持整洁。此外，以后可以轻松添加特定于给定用户的更多功能。

# .net - 大学软件开发：从 Datatel/同事那里获取数据

> ID：786413
> 
> 赞同：2
> 
> 时间：2009-04-24T15:44:57.700
> 
> 标签：.net

我在北卡罗来纳州的一所社区学院工作。我们最中央的数据存储库是一个名为 Datatel 的软件系统，又名 Colleague（为什么它有两个名字，我不知道）。

在我们的例子中，底层数据存储是 IBM Unidata。我使用 .net 技术进行开发。

有没有人知道以任何方式使用来自 Datatel/Colleague 的数据？IBM Unidata 怎么样？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-26T14:11:15.460

Datatel 是公司的名称 ( [http://www.datatel.com](http://www.datatel.com) )，Colleague 是他们的 ERP/SIS 解决方案。

使用来自 Datatel 同事系统的数据的一种选择是绕过应用程序层并直接查询底层数据库。在您的情况下，它似乎是 IBM 的 Unidata。

另一种选择是使用 Colleague 应用程序提供的集成点之一。

一种称为 EDX（Envision Data Exchagne），它允许您创建基于 XML 的实时数据事务。 [http://clients.datatel.com/uploads/9FF92652-B087-9615-48FF427AF8071E20/EDX_AdministrationR18.pdf](http://clients.datatel.com/uploads/9FF92652-B087-9615-48FF427AF8071E20/EDX_AdministrationR18.pdf)

另一种称为 ELF（电子文件传输），它允许您在同事应用程序中创建批处理，以将数据以平面文件格式推送到预先指定的位置。 [http://clients.datatel.com/uploads/873EF32F-B799-11D5-AF510002A5070708/elf.pdf](http://clients.datatel.com/uploads/873EF32F-B799-11D5-AF510002A5070708/elf.pdf)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T16:10:40.290

看看 Rocket U2 [U2 Toolkit for .NET](http://www.rocketsoftware.com/products/rocket-u2-clients-and-dbtools)和他们的[开发者指南](http://www.rocketsoftware.com/brand/rocket-u2/technical-documentation) [直接链接到 pdf](http://docs.rocketsoftware.com/nxt/gateway.dll/RKBnew20/u2%20toolkit%20for%20.net/v130/u2%20toolkit%20for%20.net.pdf)

请参阅：[从何处获取适用于 .NET 的 UniObjects？](https://stackoverflow.com/questions/1126574/where-to-get-uniobjects-for-net)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-26T14:18:38.407

另一种选择是使用 IBM 的 Visual Schema Generator (VSG)，然后通过 ODBC 附加到基础表

我建议您先下载 IBM 个人版 Unidata 以熟悉应用程序和界面，然后再对实时数据进行此操作

[在此处](http://www14.software.ibm.com/webapp/download/search.jsp?rs=u2trials&S_TACT=104CBW71&status=Active&S_CMP=rnav&q=unidata&ibm-search=Search)下载试用版

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T19:34:07.460

将 Uniobjects 用于 .NET - 不要使用 VSG/ODBC，因为它不能很好地扩展，尤其是对于 Web 应用程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-14T23:31:39.393

我直接从 Envision 编写工具，允许将数据放入 DataMarts，或直接从数据中生成 EXCEL 电子表格。然后，我将这些转储直接放在同事的菜单上，并将它们保护给最终用户。这允许用户访问他们需要的数据。我还在设计一种工具，该工具允许用户提取他们自己的数据，而无需我为他们编写屏幕或报告。它基于同事 SECLASSes、DEPTS 和覆盖访问。它通过您具有安全性的屏幕查看您可用的数据，并允许您从该数据创建报告。

数据集市和直接 EXCEL 对我们的校园用户非常有用，人们喜欢能够在需要时提取数据。

# objective-c - 我需要在我的 Nib 的文件所有者中为其创建 Outlet 的顶级对象是哪些，以便减少内存问题？

> ID：786414
> 
> 赞同：2
> 
> 时间：2009-04-24T15:45:19.820
> 
> 标签：objective-c, iphone, memory-management, uikit

Apple 说，我需要在我的文件所有者中为 Nib 文件中的所有顶级对象设置 Outlets。

据我所知，这些对象不是文件所有者本身（没有意义，对吧？）和第一响应者。

我不确定：Nib 中的 View 对象，以及 nib 中的任何控制器对象。我需要为 File's Owner 中的人提供一个出口吗？

这个问题是关于内存管理的。他们说：

> 您应该始终在某处保留指向这些对象的指针，因为您的应用程序负责通过使用它们来释放它们

所以当用户关闭应用程序时，如果我错过了这些出口，我会遇到笨重的内存泄漏吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T16:53:46.740

这是正确的。Nib 文件的文件所有者是该 nib 的入口点。由于您的 nib 之外的任何内容都不能引用除文件所有者之外的任何内容，因此只有文件所有者可以引用 nib 中的其他顶级项目。如果文件的所有者不引用它们，那么当不再需要 nib 时就无法释放这些对象，它们将在内存中徘徊。

nib 的生命周期是这样的：

1.  nib 已加载，并且文件的所有者与您指定的对象相关联。
2.  为 nib 中的所有顶级对象分配内存。
3.  所有的插座都按照笔尖的规定连接起来。
4.  ……事情发生了……
5.  文件的所有者对象被发送一个释放消息。
6.  文件的所有者释放连接到其出口的所有对象。

如您所见，如果在最后一步中未释放，则在第二步中分配的任何对象仍将在内存中浮动。

# open-source - 如何开源现有的代码库？

> ID：786415
> 
> 赞同：3
> 
> 时间：2009-04-24T15:45:28.463
> 
> 标签：open-source

我工作的公司正面临一些困难，我们的未来，可以说是不确定的。在过去几年中，我们开发了一个框架来构建社区应用程序和社交网络。我们相信这个倡议不应该完全失去，它可能对社区有用，所以我们决定开源它。

我对这个过程有一些疑问：

*   知道原作者仍然可以贡献和/或做一些咨询，如何选择最合适的许可证？
*   我们必须在代码库中做哪些必要的修改？
*   您是否对一些涵盖这一广泛主题的现有文档/书籍有一些指示？

我知道这些问题很开放，没有简单的答案，但我想听听一些有类似经历的人的意见。

提前致谢 ！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-24T16:03:54.177

对于许可证，您必须询问您的许可证目标是什么。您的目标是建立一个由贡献代码的人组成的社区，而不是让其他人创建您的代码的专有分支吗？那么[GPL](http://www.gnu.org/copyleft/gpl.html)将是一个不错的选择。您的目标是允许您保留版权，将其作为开源分发，但为想要将其链接到专有软件的人提供替代许可证吗？同样，GPL 可能是一个不错的选择，但在这种情况下，您需要确保您设置了来自任何其他将更改发回给您的贡献者的版权分配，以便您可以重新许可他们的贡献。

听起来您的代码可能是服务器端软件，在这种情况下，您可能需要查看[AGPL](http://www.fsf.org/licensing/licenses/agpl-3.0.html)；AGPL 类似于 GPL，但如果人们在自己的服务器上运行它，还需要人们分发源代码以进行更改（GPL 不需要，因为它只在分发时才需要任何东西）。

如果您希望人们能够在编写专有软件时基于它进行构建，但仍将更改贡献回您的软件本身，那么[LGPL](http://www.gnu.org/copyleft/lesser.html)非常好。如果您不关心专有分叉，并且想要一些简单的许可，那么[MIT](http://www.opensource.org/licenses/mit-license.php)许可证是一个不错的选择。

唯一需要的修改是那些删除您在法律上无法发布的任何代码。如果你拥有所有代码的版权，那么一切都很好，但要小心任何密码代码，如果你的程序中有任何密码，请咨询律师。出口限制可能很难处理，尽管它们确实有一些规定可以简化开源软件的流程。

除了必要的修改之外，最好确保您的代码易于在尽可能多的系统上构建和运行。例如，您应该检查哪些依赖项是必需的，哪些是可选的。一些关于如何构建和安装软件的好文档也很好，以及您在任何软件开发（不仅仅是开源）中想要的所有常见的东西，比如易于构建的系统、单元和回归测试等。

其他一些需要考虑的事情是：

1.  其他人将如何对您进行更改？邮件列表上的补丁？附加到错误报告的补丁？[GitHub](https://github.com/)上的分叉？
2.  您将使用什么版本控制系统？我通常提倡使用[Git](http://git-scm.com/)或[Mercurial](http://www.selenic.com/mercurial/)等分布式版本控制系统，但[Subversion](http://subversion.tigris.org/)也很受欢迎，应该可以胜任。
3.  确保你清楚社区应该如何运作；描述如何获取软件以及如何贡献的网页，指向您的邮件列表或 IRC 频道或您希望在其上讨论的任何媒体的指针。如果您要拥有一组核心提交者或其他东西，请记录选择提交者的过程是如何工作的。

我可以继续列出更多和细节，但我可能会重复已经说过的话。如果您想了解更多信息，我建议您阅读Karl Fogel 的《[生产开源软件》。](http://producingoss.com/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T16:28:49.343

如果您正在寻找将这个软件的开源整合到为您的公司赚钱的战略中的方法，那么[Joel Spolsky 的](http://www.joelonsoftware.com/articles/StrategyLetterV.html)观点是我读过的最清醒的观点之一。

如果您只阅读一本关于开源许可主题的书，那么很难比Lawrence Rosen 的[Open Source Licensing做得更好。](http://rosenlaw.com/oslbook.htm)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T16:18:16.980

上周我们已经完成了相同的过程。我们选择 Mercurial 作为版本控制系统，它就像一个魅力。Bitbucket 是一家托管公司，为开源项目提供免费托管。你还需要更多的文档，因为来自世界以外的人希望能加入你的项目——这与向隔壁的同事解释事情不同。

还有一件重要的事情是你必须记住，你现在有一个你不想惹恼的观众。通过内部开发，您经常更改您的 API、数据库架构或类似的东西。对于开源，您必须牢记，次要版本之间应该有兼容性，必要时应该有明确的迁移路径。

# ruby-on-rails - Rails - 两个控制器或添加动作？

> ID：786416
> 
> 赞同：5
> 
> 时间：2009-04-24T15:45:30.413
> 
> 标签：ruby-on-rails, dry, controllers

设计具有管理部分和面向公众部分的 Web 应用程序。感觉就像为“索引”和“显示”设置一个面向公众的控制器有点多余。我读过的所有建议都为管理员建议了一个命名空间，这很好。我只是想知道我是否应该有一个带有附加操作的控制器，比如“list_public”或类似的东西。

我是 Rails 的新手，所以也许我什么都不关心。我只是不喜欢将所有这些具有相同名称的控制器、视图、助手分散在我的项目目录中的想法。

有人对此有任何见解吗？提前致谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-24T15:54:11.283

我会说拥有两个控制器（一个公共和一个管理员）是最好的解决方案。

现在你可以做的是让两个控制器调用相同的方法来执行操作中的相关操作。

```
class MyController < ApplicationController
  def show
    MyModel.do_all_sorts_of_stuff
  end
end

class Admin::MyController < ApplicationController
  def show
    MyModel.do_all_sorts_of_stuff
    # Admin only stuff goes here
  end
end 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-09-05T08:38:59.503

正如马特所说，但你也可以这样做：

```
class MyController < ApplicationController
  def show
    MyModel.do_all_sorts_of_stuff
  end
end

class Admin::MyController < MyController
  def show
    super
    # Admin only stuff goes here
  end
end 
```

这意味着您可以只关注 Admin::MyController 的更专业的案例，而不是重复代码。

# c# - 是否有支持 C++ 和 C# 的 ORM（对象关系映射器）框架

> ID：786417
> 
> 赞同：4
> 
> 时间：2009-04-24T15:45:55.170
> 
> 标签：c#, c++, sql, database

我正在寻找一个允许我编写 C# 用户界面和 C++ 服务的 ORM。两者都需要访问同一个数据库中的数据。理想情况下，我希望从数据库模式生成 C# 和 C++ 类，然后我可以对其进行编程。

数据库可能是 SQLServer，但尚未确定。

注意：我是在 Windows 环境中执行此操作，但由于我不想进入的原因，我实际上不能使用 COM，因此不能选择 COM 解决方案。

这类似于这个问题：

[具有多种编程语言支持的 ORM（对象关系管理器）解决方案](https://stackoverflow.com/questions/482612/orm-object-relational-manager-solution-with-multiple-programming-language-suppo)

但是，这没有得到很好的回答，我不能为此筹集奖金。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T16:13:46.773

不幸的是，这可能对您没有任何帮助，但是如果您放弃尝试寻找预构建解决方案，那么开发仅支持您需要的内部版本并不是那么困难。

我们有一种内部数据定义语言，用于为我们的数据生成 SQL 模式，并为原生 C++ 和 .NET 生成 ORM 类。唯一真正的技巧是将生成的模式与数据库中已有的模式进行比较，以便更轻松地迁移到下一个版本。

# wpf - WPF C# System.Deployment 问题

> ID：786426
> 
> 赞同：0
> 
> 时间：2009-04-24T15:46:55.107
> 
> 标签：wpf, deployment, xbap

我正在用 C# 开发一个 XBAP 应用程序，并且希望能够使用 System.Deployment 对象方法。在对象浏览器中，我可以看到所有对象，当我尝试通过代码访问这些方法时，它不起作用并指出这些方法不在名称空间中。

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-25T16:36:27.367

不确定这是否是您的问题，但您的 XBAP 是否在“完全信任模式”下运行？

默认情况下，XBAP 是沙盒...

[这](http://scorbs.com/2007/01/10/xbap-trust-levels/)是一篇关于如何让您的 XBAP 完全信任的文章

更多信息

*   [Windows Presentation Foundation 安全沙盒](http://msdn.microsoft.com/en-us/library/aa480229.aspx)

# winforms - 为什么我的 winsock 控件在 Form_QueryUnload 的上下文中的 vb6 中无法正常运行？

> ID：786431
> 
> 赞同：1
> 
> 时间：2009-04-24T15:48:20.063
> 
> 标签：winforms, vb6, winsock

我的目标是让这个程序在用户注销或关闭他们的电脑时发送一个注销命令。

该程序使用 Winsock 对象通过 tcp 套接字连接到服务器应用程序。呼叫`singleSock.SendData "quit" & vbCrLf`只是一种退出的方式。我将开始使用 Wireshark 捕获数据，但我想知道我是否试图做一些根本错误的事情。

奇怪的是，如果我将 Cancel 设置为 True，并允许我运行的计时器执行注销命令，然后调用另一个卸载，它可以工作，但是在测试此配置（不同的代码）时，这会阻止用户注销第一个时间。他们必须启动注销，它什么也没做，然后他们再次注销，我的程序在那时就消失了。同样奇怪的是，在 Vista 中，在短暂显示一个屏幕说我的程序阻止注销后注销。我的大部分部署都在 XP 上，它有两个注销问题。

```
 Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer)

   If UnloadMode = vbFormControlMenu Then
      Me.WindowState = vbMinimized
      Cancel = True
   Else

      If SHUTDOWN_FLAG = True Then
        Cancel = False
      Else
        Cancel = True
        SHUTDOWN_FLAG = True
      End If
      tmrSocket.Enabled = False
      SHUTDOWN_FLAG = True
      Sleep (1000)
      singleSock.SendData "quit" & vbCrLf

      Call pUnSubClass
      'If singleSock.state <> sckConnected Then
      '   singleSock.Close
      '   tmrSocket.Enabled = False
      '   LogThis "tmrSocket turned off"
      'End If
      DoEvents
   End If

End Sub 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-25T03:35:11.567

您无需等待 Winsock 控件实际发送“退出”消息。该`SendData`方法是异步的：它可以在数据实际通过网络发送之前返回。数据在您的机器上本地缓冲，稍后由网络驱动程序发送。

在您的情况下，您尝试发送“退出”消息，然后几乎立即关闭套接字。因为`SendData`是异步的，调用可能会在“退出”消息实际发送到服务器之前返回，因此代码可能会在有机会发送消息之前关闭套接字。

当您首先取消表单的卸载并让计时器发送“退出”消息时，它会起作用，因为您为套接字提供了足够的额外时间，以便在套接字关闭之前将消息发送到服务器。但是，我不会指望这总是有效的。巧合的是，额外的步骤给了套接字足够的时间来发送消息，并且不能保证总是这样。

`SendCompleted`您可以通过在发送“退出”消息后和关闭套接字之前等待套接字引发事件来解决此问题。下面是一个基本的例子。请注意，`QueryUnload`代码要简单得多。

```
Private m_bSendCompleted As Boolean
Private m_bSocketError As Boolean

Private Sub singleSock_Error(ByVal Number As Integer, Description As String, ByVal Scode As Long, ByVal Source As String, ByVal HelpFile As String, ByVal HelpContext As Long, CancelDisplay As Boolean)
   'Set error flag so we know if a SendData call failed because of an error'
   'A more robust event handler could also store the error information so that'
   'it can be properly logged elsewhere'
   m_bSocketError = True
End Sub

Private Sub singleSock_SendCompleted()
   'Set send completed flag so we know when all our data has been sent to the server'
   m_bSendCompleted = True
End Sub

'Helper routine. Use this to send data to the server'
'when you need to make sure that the client sends all the data.'
'It will wait until all the data is sent, or until an error'
'occurs (timeout, connection reset, etc.).'
Private Sub SendMessageAndWait(ByVal sMessage As String)

   m_bSendCompleted = False
   singleSock.SendData sMessage

   singleSock.SendData sMessage

   Do Until m_bSendCompleted or m_bSocketError
      DoEvents
   Loop

   If m_bSocketError Then
      Err.Raise vbObjectError+1024,,"Socket error. Message may not have been sent."
   End If

End Sub

Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer)

   'This is (almost) all the code needed to properly send the quit message'
   'and ensure that it is sent before the socket is closed. The only thing'
   'missing is some error-handling (because SendMessageAndWait could raise an error).'

   If UnloadMode = vbFormControlMenu Then
      Me.WindowState = vbMinimized
      Cancel = True
   Else
      SendMessageAndWait "quit" & vbCrLf
      singleSock.Close
   End If

End Sub 
```

您可以通过将发送消息的逻辑放在单独的类中等待它发送来使代码更简洁。这将私有变量和事件处理程序保存在一个地方，而不是让它们乱扔您的主代码。当您有多个套接字时，它还可以更轻松地重用代码。`SynchronousMessageSender`由于没有更好的名字，我给班级打电话。这个例子还有更完整的错误处理：

**SynchronousMessageSender.cls**

```
Private WithEvents m_Socket As Winsock
Private m_bAttached As Boolean

Private m_bSendCompleted As Boolean
Private m_bSocketError As Boolean

Private Type SocketError
    Number As Integer
    Description As String
    Source As String
    HelpFile As String
    HelpContext As Long
End Type

Private m_LastSocketError As SocketError

'Call this method first to attach the SynchronousMessageSender to a socket'
Public Sub AttachSocket(ByVal socket As Winsock)

    If m_bAttached Then
        Err.Raise 5,,"A socket is already associated with this SynchronousMessageSender instance."
    End If

    If socket Is Nothing Then
        Err.Raise 5,,"Argument error. 'socket' cannot be Nothing."
    End If

    Set m_Socket = socket

End Sub

Private Sub socket_SendCompleted()
    m_bSendCompleted = True
End Sub

Private Sub socket_Error(ByVal Number As Integer, Description As String, ByVal Scode As Long, ByVal Source As String, ByVal HelpFile As String, ByVal HelpContext As Long, CancelDisplay As Boolean)

    m_bSocketError = True

    'Store error information for later use'
    'Another option would be to create an Error event for this class'
    'and re-raise it here.'

    With m_lastSocketError
        .Number = Number
        .Description = Description
        .Source = Source
        .HelpFile = HelpFile
        .HelpContext = HelpContext
    End With

End Sub

'Sends the text in sMessage and does not return'
'until the data is sent or a socket error occurs.'
'If a socket error occurs, this routine will re-raise'
'the error back to the caller.'

Public Sub SendMessage(ByVal sMessage As String)

    If Not m_bAttached Then
        Err.Raise 5,,"No socket is associated with this SynchronousMessageSender. Call Attach method first."
    End If

    m_bSendCompleted = False
    m_bSocketError = False

    m_socket.SendData sMessage & vbCrLf

    'Wait until the message is sent or an error occurs'
    Do Until m_bSendCompleted Or m_bSocketError
        DoEvents
    Loop

    If m_bSocketError Then
        RaiseLastSocketError
    End If

End Sub

Private Sub RaiseLastSocketError()

    Err.Raise m_lastSocketError.Number, _
              m_lastSocketError.Source, _
              m_lastSocketError.Description, _
              m_lastSocketError.HelpFile, _
              m_lastSocketError.HelpContext

End Sub 
```

**示例使用**

```
Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer)

    Dim sender As New SynchronousMessageSender

   'Ignore errors since the application is closing...'
   On Error Resume Next

   If UnloadMode = vbFormControlMenu Then
      Me.WindowState = vbMinimized
      Cancel = True
   Else

      Set sender = New SynchronousMessageSender
      sender.AttachSocket singleSock
      sender.SendMessage "quit"
      singleSock.Close

   End If

End Sub 
```

通过使用一个单独的类，现在所有必要的代码都可以放在 中`Form_QueryUnload`，这让事情变得更整洁。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-27T15:15:51.880

如果没有 QUIT 命令就不会更容易了。在您的服务器代码中，只需假设关闭套接字与接收退出执行相同的操作。

另外，您要注意的一件事是客户端软件的突然关闭。例如，断电或网络连接中断的机器或进入睡眠或休眠模式的机器。

在这些情况下，您应该定期检查来自服务器的所有客户端的连接，并关闭任何不响应某种 ping 命令的连接。

# iphone - 在多视图应用程序中，当涉及到低内存警告时，我必须考虑什么？

> ID：786451
> 
> 赞同：1
> 
> 时间：2009-04-24T15:53:10.427
> 
> 标签：iphone, objective-c, memory-management, uikit

我在某处读到，如果由于内存不足警告（一旦用户想要查看它就再次加载它）而临时放弃视图时，我会遇到内存问题，如果 ViewController 类不做这样的事情在每个该观点的出处：

```
-(void)dealloc {
    [myView release], myView = nil;
    [myLabel release], myLabel = nil;
    [super dealloc];
} 
```

我在这里很困惑，因为实际上我认为 [myView release] 也会使 nil-thing，说变量不再包含对象。为什么两次？还是我错过了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-24T16:17:06.547

调用`[myView release]`不会改变 的值`myView`，它会减少`myView`指向的对象的保留计数（并且当对象的保留计数变为零时，它`dealloc`本身）。调用后`[myView release]`，`myView`仍然包含视图对象的地址，但如果`myView`是唯一的所有者，则该对象已`dealloc`编辑自己并且内存不再有效（我现在被另一个对象或其他数据占用）。通过设置`myView`为`nil`，您可以确保您不会意外使用曾经属于 的旧内存`myView`，并且您现在可以测试是否`myView`已被初始化或丢弃。

请注意，您不需要在您的方法中设置`myView`为，因为此时您的视图控制器无论如何都会消失，但是如果您丢弃视图以响应低内存警告，您会想要这样做。如果视图不可见，您也可以考虑丢弃整个视图控制器。`nil``-dealloc`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T18:30:05.103

当视图控制器收到内存警告并且视图不在屏幕上时，它可能会将视图属性设置为 nil。但这不会释放您可能保留在其他属性中的任何子视图。所以这里是你可以如何处理：

```
- (void)setView:(UIView *)view
{
  [super setView:view];
  if (view == nil)
  {
    // Release-and-nil any subviews that you might be retaining.
  }
} 
```

# linux - 更改在 linux 上使用 JFS 驱动程序启动的参数

> ID：786459
> 
> 赞同：0
> 
> 时间：2009-04-24T15:53:52.000
> 
> 标签：linux, driver

我更喜欢 QNX 操作系统，我可以在启动时更改 ide 驱动程序的参数。我想为安装闪存卡的 jfs 文件系统更改在 linux 内核中启动的参数。我似乎无法为这些信息找到一个好的网络资源，但我确信我没有“谷歌搜索”它是正确的。

jfs/ide 驱动程序有哪些不同的可用选项，我在哪里为当前正在运行的驱动程序更改它们？

谢谢你，我很抱歉这不完全是编程，但是当我问一个编程问题时，这个网站总是能给出很好的答案，所以我认为它在这里也可能有帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T16:04:11.290

好的，我终于发现它是在 /etc/fstab 文件中定义的。现在我只需要找出哪些选项可用且最适合紧凑型闪存卡。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-25T17:54:08.660

大多数文件系统的选项都显示在“mount”手册页中。

ata 驱动程序也可能有各种可调参数。您可能可以使用“hdparm”实时更改这些。

一些选项可能是文件系统创建时间选项，在这种情况下 mkfs 将记录它们。

请参阅相关的手册页。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-17T11:10:40.030

如果要将选项传递给 jfs，则需要将它们作为内核引导行的一部分传递，这在 grub.conf 或 lilo.conf 文件中指定。您可以在内核源代码的 Documentation/ 目录或 jfs 源代码本身中找到支持的选项。

至于推荐的挂载选项，您需要查看 mount(8) 手册页。我会推荐*noatime,nodirtime*至少。默认值为*atime*，这会导致每次查看文件时都会更新文件 inode。

# database - Visual Studio 2008 数据库版

> ID：786462
> 
> 赞同：0
> 
> 时间：2009-04-24T15:54:42.623
> 
> 标签：database, visual-studio-2008, sql-server-2005, teamsystem

使用 Visual Studio Team System Database Edition 管理开发人员工作站和其他部署环境之间的服务器登录和数据库用户

大家好，

查看从“Visual Studio Team System 2008 Database Edition”升级到 **[Visual Studio Team System 2008 Database Edition GDR R2](http://www.microsoft.com/downloads/details.aspx?FamilyID=bb3ad767-5f69-4db9-b1c9-8f55759846ed&displaylang=en)**。

vstsdb 中的参数化通常很弱，我们必须应用变通方法来让数据库项目在每个开发人员工作站上本地部署，以便他们在本地部署符合沙盒原则的应用程序数据库时工作。基本上，回到开头，当我使用 vstsdb import 2005 向导项目类型导入应用程序数据库时，我只是删除了它生成的用户脚本，并且必须添加一个由项目变量驱动的登录预部署脚本 SQLCMD变量只能在这个特殊的脚本位置中使用:( ...

它处理登录和数据库用户，然后将它们链接起来。

看起来像这样..

```
BEGIN TRY
    BEGIN TRANSACTION

        IF UPPER('$(DeployToDev)') = 'FALSE'
        BEGIN
            -- SMRBtsService
            IF EXISTS (SELECT * FROM master.dbo.syslogins WHERE loginname = N'$(DomainAppUserAccount)')
            DROP LOGIN [$(DomainAppUserAccount)] 
            CREATE LOGIN [$(DomainAppUserAccount)] FROM WINDOWS

            IF EXISTS (SELECT * FROM sys.database_principals WHERE NAME = 'SMRBtsService')
            DROP USER [SMRBtsService]
            CREATE USER [SMRBTSService] FOR LOGIN [$(DomainAppUserAccount)] WITH DEFAULT_SCHEMA=[dbo]

            -- WebUser
            IF EXISTS (SELECT * FROM master.dbo.syslogins WHERE loginname = N'$(DomainWebUserAccount)')
            DROP LOGIN [$(DomainWebUserAccount)] 
            CREATE LOGIN [$(DomainWebUserAccount)] FROM WINDOWS

            IF EXISTS (SELECT * FROM sys.database_principals WHERE NAME = 'WebUser')
            DROP USER [WebUser]
            CREATE USER [WebUser] FOR LOGIN [$(DomainWebUserAccount)] WITH DEFAULT_SCHEMA=[dbo]

        END
        ELSE IF UPPER('$(DeployToDev)') = 'TRUE'
        BEGIN
            -- BTSSERVICE
            IF EXISTS (SELECT * FROM master.dbo.syslogins WHERE loginname = N'$(COMPUTERNAME)\BTSSERVICE')
            DROP LOGIN [$(COMPUTERNAME)\BTSSERVICE] 
            CREATE LOGIN [$(COMPUTERNAME)\BTSSERVICE] FROM WINDOWS

            IF EXISTS (SELECT * FROM sys.database_principals WHERE NAME = 'SMRBtsService')
            DROP USER [SMRBtsService]
            CREATE USER [SMRBTSService] FOR LOGIN [$(COMPUTERNAME)\BTSSERVICE] WITH DEFAULT_SCHEMA=[dbo]

            -- WebUser
            IF EXISTS (SELECT * FROM master.dbo.syslogins WHERE loginname = N'$(COMPUTERNAME)\WebUser')
            DROP LOGIN [$(COMPUTERNAME)\WebUser] 
            CREATE LOGIN [$(COMPUTERNAME)\WebUser] FROM WINDOWS

            IF EXISTS (SELECT * FROM sys.database_principals WHERE NAME = 'WebUser')
            DROP USER [WebUser]
            CREATE USER [WebUser] FOR LOGIN [$(COMPUTERNAME)\WebUser] WITH DEFAULT_SCHEMA=[dbo]
        END 

    COMMIT TRANSACTION
END TRY
BEGIN CATCH

    IF (XACT_STATE()) <> 0
        ROLLBACK TRANSACTION

    DECLARE @ErrorMessage NVARCHAR(4000),
      @ErrorNumber INT,
      @ErrorSeverity INT,
      @ErrorState INT,
      @ErrorLine INT,
      @ErrorProcedure NVARCHAR(200) ;

    SELECT  @ErrorNumber = ERROR_NUMBER(), @ErrorSeverity = 20,
            @ErrorState = ERROR_STATE(), @ErrorLine = ERROR_LINE(),
            @ErrorProcedure = ISNULL(ERROR_PROCEDURE(), '-') ;

    SELECT  @ErrorMessage = N'Error %d, Level %d, State %d, Procedure %s, Line %d, ' +
            'Message: ' + ERROR_MESSAGE() ;

    RAISERROR (@ErrorMessage, @ErrorSeverity, 1, @ErrorNumber, -- parameter: original error number.
      @ErrorSeverity, -- parameter: 20, we want to stop the entire deploy process.
      @ErrorState, -- parameter: original error state.
      @ErrorProcedure, -- parameter: original error procedure name.
      @ErrorLine-- parameter: original error line number.
            ) ;

END CATCH 
```

问题;

使用 GDR 版本将如何实现这种功能，我看到它支持在引用层次结构中链接项目的概念。你有两个项目类型，一个数据库和一个服务器项目。但是您仍然需要创建这样的脚本来实现项目在开发模式下部署在任何机器上的相同动态能力吗？

创建服务器项目类型只是在数据库项目类型的所有对象（脚本）之外添加服务器对象。

复合项目结构的文档讨论......但我仍然没有看到明显的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-02T20:34:56.000

我们还在 VSDBCMD、架构比较和 MSBuild 部署方面遇到了相当多的问题，这些问题涉及用户和登录，以及针对不同的服务器。

我强烈建议您安装 RC2！

按照安装说明（非常重要）！

希望这会有所帮助......让我知道！

# python - 如何从 Python 中的 HTML / CSS（包括图像）源生成 PDF？

> ID：786463
> 
> 赞同：5
> 
> 时间：2009-04-24T15:54:42.793
> 
> 标签：python, html, css, pdf, pdf-generation

假设我有一个 HTML / CSS 页面，其中包含一些图像，我想从 Python 中的源代码生成 PDF - 可能吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T16:00:53.060

[http://www.xhtml2pdf.com/](http://www.xhtml2pdf.com/)

install 对我来说有点古怪，但除此之外它工作得很好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-24T16:11:01.087

您可以使用以下方法执行此类操作[`Pisa`](http://www.xhtml2pdf.com/)：

```
def receipt(request, id):
    import ho.pisa as pisa
    from django.template.loader import render_to_string
    from datetime import datetime

    r = get_or_404(id, request.affiliate)    
    now = datetime.now()
    contents = render_to_string('home/reservations/receipt.html', {
        'reservation': r,
        'today': now
    })
    filename = now.strftime('%Y-%m-%d') + '.pdf'
    response = HttpResponse(mimetype='application/pdf')
    response['Content-Disposition'] = 'attachment; filename=' + filename
    pdf = pisa.CreatePDF(contents, response)
    if pdf.err:
        message(request, 'Unable to generate the receipt.')
        return HttpResponseRedirect(reverse('view_reservation', args=[r.id]))    
    else:
        return response 
```

（这是一个生成收据的 Django 视图，但显然您可以在任何设置中使用 Pisa）

不过，您将不得不调整 HTML 以使其在 Pisa 中尽可能好地运行。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-11-03T18:28:16.013

wkhtmltopdf 是我最近开始用于我的项目的一个可能更好的选择。它不仅支持几乎完整的 CSS，还支持 javascript。首先尝试 wkhtmltopdf 命令以了解它的强大功能。然后你使用它的python扩展。

这里是链接

*   [https://github.com/mreiferson/py-wkhtmltox](https://github.com/mreiferson/py-wkhtmltox)
*   [http://code.google.com/p/wkhtmltopdf/](http://code.google.com/p/wkhtmltopdf/)

安装对我来说有点棘手。所以我写了这个又快又脏的脚本。

*   [https://github.com/shon/cowspa3/blob/master/wkhtmltox-installer.sh](https://github.com/shon/cowspa3/blob/master/wkhtmltox-installer.sh)

# asp.net - 将属性（System.Attribute 种类）添加到 .aspx 页面 - 而不是代码隐藏

> ID：786465
> 
> 赞同：1
> 
> 时间：2009-04-24T15:54:57.427
> 
> 标签：asp.net, custom-attributes

我正在创建一个自定义属性（扩展 System.Attribute）。我知道我可以通过执行以下操作轻松地将它放在另一个类上。

```
[MattsAttribute]
public class SomeClassWhichIsACodeBehind { 
```

但是，我需要能够轻松地测试这个属性，并且将它放在代码隐藏中会导致很多额外的工作来将它部署到一个可以响应属性行为的环境中。

我想做的事：以声明方式将此属性应用于 .aspx 页面本身（这实际上只是从代码隐藏继承的另一个类）。这可能吗？如果是这样，这样做的正确语法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T15:58:18.090

查看 ScottGu 的这篇文章：

[http://weblogs.asp.net/scottgu/archive/2005/08/02/421405.aspx](http://weblogs.asp.net/scottgu/archive/2005/08/02/421405.aspx)

您必须扩展 Page，但它看起来最接近您可以做您想做的事情，而不需要在 CodeBehind 中添加一些东西。

# c# - 在 2D 中将一个点旋转另一个点

> ID：786472
> 
> 赞同：53
> 
> 时间：2009-04-24T15:55:57.923
> 
> 标签：c#, math, rotation, angle

我想知道当相对于另一个点旋转一个角度时如何计算一个点的新坐标。

我有一个方块箭头，想将它相对于箭头底部中间的一个点旋转一个角度 theta。

这是允许我在 2 个屏幕控件之间绘制多边形所必需的。我无法使用和旋转图像。

从我目前所考虑的情况来看，更复杂的是，屏幕的原点位于左上角。

* * *

## 回答 #1

> 赞同：135
> 
> 时间：2009-04-24T16:03:52.040

如果您逐点旋转`(px, py)`点，您将获得：`(ox, oy)``theta`

```
p'x = cos(theta) * (px-ox) - sin(theta) * (py-oy) + ox
p'y = sin(theta) * (px-ox) + cos(theta) * (py-oy) + oy

```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-24T15:58:29.930

如果您使用 GDI+ 来执行此操作，则可以使用对象`Transform`的方法`Graphics`：

```
graphics.TranslateTransform(point of origin);
graphics.RotateTransform(rotation angle); 
```

然后画出实际的东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-08-02T14:49:52.890

如果您有可用的`System.Windows.Media`命名空间，那么您可以使用内置的转换：

```
 using System.Windows.Media;

    var transform = new RotateTransform() {Angle = angleInDegrees, CenterX = center.X, CenterY = center.Y};
    var transformedPoint = transform.Transform(point); 
```

# c# - MVP 和多个用户控件

> ID：786476
> 
> 赞同：17
> 
> 时间：2009-04-24T15:56:56.690
> 
> 标签：c#, design-patterns, oop, user-controls, mvp

我正在尝试使用 MVP 模式，但遇到了设计问题。我正在开发一个具有多个 UserControls 的应用程序。UserControls 本身彼此无关，仅代表实际模型的一个子集。根据我的阅读，人们倾向于说每个视图应该使用一个演示者。这似乎是有道理的，但如果我有 30 个用户控件，我真的想要 30 个演示者吗？另一方面，如果我有 1 个 Presenter 和 1 个 View 代表整个“应用程序”视图，那么我将拥有臃肿的 View 和 Presenter 界面。然后每个视图都必须实现与它无关的方法。我的问题是，有没有更好的方法来处理多个用户控件，或者我应该为每个视图创建 1 个演示者？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-26T07:10:35.160

您应该为每个控件做一个演示者，因为：

*   这将允许您有**集中的单元测试**只处理该控件
*   **由于您不需要支持包含所有控件的呈现逻辑联合的巨大演示者，因此**提高了可维护性****
***   这将防止在多个页面上具有相同控制的情况下**出现冗余***   **通过在页面执行容器特定角色时让控件专注于其特定逻辑来**提高 SRP ：******

 ****通常提到与决策“每个控件的演示者”相关的两个问题：

*   **共享上下文**是一个问题，由于所有控件只显示同一页面数据上下文的不同部分，这种情况可能看起来像一个有问题的用例，导致每个控件中都有大量数据检索冗余代码。这可以通过依赖注入轻松解决，其中页面（或控制器）执行单个数据检索，然后将数据上下文对象注入每个演示者\视图（通常实现一些启用该功能的接口）。在 MV-VM 模式（Silverlight、WPF）的情况下，可以通过数据边界实现相同的效果，其中页面将设置其 DataContext，然后从视图本身使用
*   **同一页面上视图之间的通信**是第二个问题，可以使用以下几种方法轻松解决：
*   控件发布页面订阅的**事件**，然后直接调用其他控件中的适当方法（页面是所有控件的容器，这意味着它知道它们的所有成员）
*   **观察者**设计模式
*   **事件聚合器**模式

在这些方法中的每一种中，控件都在相互通信而彼此不知道

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-24T18:01:20.540

将相关的代码分组到一个对象中会更有意义。因此，在这种情况下，如果视图是相关代码的特定分组，那么演示者也会模仿这些分组。为不同的视图设置一个“全局”演示者会将不相关的代码分组到一个对象中。它肯定也会使演示者的界面膨胀。查看[单一责任原则](http://www.objectmentor.com/resources/articles/srp.pdf)。

现在，您可以拥有一个 Presenter Manager 类，也许它可以让您访问每个演示者接口，[如接口隔离原则](http://www.objectmentor.com/resources/articles/isp.pdf)状态，通过任一继承（有一个实现许多演示者接口的全局具体演示者......哪种违反了单一职责) 或聚合（每个接口和 get 函数都有单独的演示者......因此全局接口将是 get 函数）或两者的组合（全局演示者在某种程度上是一个适配器）。

我认为最好的解决方案就是拥有 30 位不同的演示者。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T16:22:15.863

每个 View 不必实现相同的接口... 为什么不为每个控件定义接口，并为包含所有控件的整个屏幕设置一个 Presenter？Presenter 可以根据每个视图需要的接口定义事件“连接”每个视图上的事件，连接到 Presenter 上的适当事件处理程序（如果您正在执行 MVPC，则在控制器上）。您可能还需要另一个接口来表示所有视图都需要共同访问的 Presenter 功能......

*   如果您正在执行 MVPC，则影响模型的视图事件将在控制器中“处理”，而仅影响视图其他部分的视图事件将在演示器上处理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-04-18T12:48:52.853

老问题，但我要直言不讳，不得不不同意其他答案：您不希望每个 UserControl 有一个演示者，就像您希望对每个 UserControl 进行单元测试一样——这将是对 a 的盲目滥用设计模式。

UserControl 不是视图。

应用程序的每个逻辑区域都应该有一个演示者；每一个是如何被分解的——有多少控制，什么显示什么——仅仅是一个*组合*的问题。

# sql - 在 SQL 中计算增值税

> ID：786477
> 
> 赞同：-1
> 
> 时间：2009-04-24T15:57:22.477
> 
> 标签：sql, math

如何编写 SQL 查询来计算增值税，然后将其添加到 Total？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T16:01:03.823

肯定是功课。

但是，请告诉我们您的尝试。一般来说，在 SO 上的人会帮助你之前，你应该先做出努力。

你的桌子是什么样子的？总数是如何计算的？什么查询返回总数？您需要对总额执行什么操作才能添加 tge 增值税？

保罗

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T17:48:13.623

UP 的计算非常容易，让第 1 步向下

01) 淡水河谷是政府确定的 100 增值税假设 15% 公式应用总和（价值*15） 商品的总成本加到 15%

# iis-7 - 将下载处理转移到 IIS7？

> ID：786478
> 
> 赞同：0
> 
> 时间：2009-04-24T15:57:47.233
> 
> 标签：iis-7, download

我有一个系统，允许用户下载一些文件，用户需要先登录，然后他被授权或不下载。下载页面是 Download.aspx?FileId=42 并且此页面中的代码打开文件并不断向用户发送小块。我们这样做是因为我们需要保证只有授权用户才能下载。

我们最近将此系统移至 IIS7 并且它工作正常，但我不喜欢让自定义 c# 代码将块发送到客户端的想法，所以我想知道是否有一种方法可以在何时请求制作file.zip，执行自定义代码授权与否，如果授权，我只是告诉IIS7继续下载而不是运行Download.aspx中的代码。

这可能吗？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T15:59:09.837

重定向到 zip 文件。使用非常规命名将 zip 文件隐藏在一个不起眼的位置。“通过默默无闻的安全。”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-12T07:40:18.140

IIS7 具有对所有文件类型使用 Forms 或 Windows 身份验证的授权 -*如果*它在集成管道模式下运行。语法与 ASP.NET 应用程序的语法类似，但它在 web.config 中的位置不同，<system.web>。也可以使用 IIS7 管理界面添加规则。有几个区别，IIS7 URL 授权评估从父级向下的规则，拒绝规则优先。

# asp.net - ASP.Net 按钮单击事件未触发

> ID：786482
> 
> 赞同：4
> 
> 时间：2009-04-24T15:58:17.403
> 
> 标签：asp.net, .net-3.5, asp.net-ajax, ajaxcontroltoolkit

这可能与[这个问题有关](https://stackoverflow.com/questions/705743/control-events-not-firing-after-asp-net-3-5-conversion)，但我有更多的信息。

在使用 Linq 编写了一些新代码后，我最近将一个 ASP.Net 应用程序更新为 .NET 3.5。现在我的页面间歇性地停止触发事件处理程序。我将其范围缩小到带有 Ajax 的页面，并且我认为是 ScriptManager 或 AjaxControlToolkit 注册导致了问题。

真正棘手的部分是页面似乎在大约 2/3 秒的时间内可以正常工作，而控件只有 1/3 的时间会丢失其事件处理程序。我想知道发生了某种类型的错误并且页面无法正确呈现，但我找不到这方面的证据。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-08-17T06:03:18.533

我们确实遇到了这个问题，正如您所说，它只在某些时候发生，并且只发生在带有 Ajax 请求的页面上。我们发现禁用 HTTP Keep-Alive 的答案中建议 [为什么 Internet Explorer 在失败后不会在 Ajax 调用上发送 HTTP 帖子正文？](https://stackoverflow.com/questions/4796305/why-does-internet-explorer-not-send-http-post-body-on-ajax-call-after-failure/4856707#4856707)工作。

这可以按照[如何在 IIS 7 中配置 HTTP KEEP-ALIVE 中的说明在 IIS7 中完成](http://msmvps.com/blogs/bernard/archive/2007/07/10/how-to-configure-http-keep-alive-in-iis-7.aspx "如何在 IIS 7 中配置 HTTP KEEP-ALIVE")

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T16:18:24.237

到目前为止，我只使用了 Telerik Ajax 控件，我的观察是，如果在启用 Ajax 的控件中发生异常，则不会发生任何事情。无异常报告，无操作。没有。

也许您应该在没有 ajax 的情况下测试您的应用程序以确定任何问题点

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T17:07:31.917

我最初的想法是 javascript 出错（未捕获）并中止异步回发的地方正在发生一些事情。

如果您可以在开发环境中实现这一点，您可能想尝试错误处理[window.onerror](http://www.javascriptkit.com/javatutors/error2.shtml)事件并抛出一些警报框。查看可能发生错误的位置可能会有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T16:33:41.137

你有没有尝试过：

`ScriptManager.GetCurrent(this).RegisterAsyncPostBackControl(yourButton);`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-07T10:03:33.220

如果有，请尝试注释掉更新面板。然后尝试单击按钮，页面上一定有错误。我也遇到过类似的问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-09T12:51:31.803

在我看来，您对更新面板有疑问。

如果您使用多个更新面板并且更新一个面板会更改其他更新面板的数据，请定义更新面板的以下属性。

对于更新面板

1.  ChildrenAsTriggers = true
2.  EnableViewState = true（如果您正在使用此功能）
3.  更新模式 = 总是

对同一页面中的其他更新面板使用相同的属性。

如果您觉得有用，请将其标记为您的答案，否则请告诉我......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-07-01T08:33:28.503

在我的情况下，没有任何事件（按钮或复选框）被触发。我能够使用以下方式克服这个问题。

在我的母版页中，我关闭了一个引用外部 .js 文件的标记，该标记使用 /> 符号而不是`<script></script>`.

例如：更改`<script src='../../Scripts/common/menu.Js' type='text/javascript' />` 为`<script src='../../Scripts/common/menu.Js' type='text/javascript' ></script>`

希望这会对你有所帮助，拉梅什

# java - 使用 Axis 1.4 设置自定义 SOAP 标头

> ID：786488
> 
> 赞同：14
> 
> 时间：2009-04-24T15:58:56.670
> 
> 标签：java, .net, web-services, soap, axis

我正在尝试使用 Axis 使用 .NET 2.0 Web 服务。我使用 Eclipse WST 插件生成了 Web 服务客户端，到目前为止似乎还可以。

这里是预期的 SOAP 标头：

```
<soap:Header>
<Authentication xmlns="http://mc1.com.br/">
    <User>string</User>
    <Password>string</Password>
</Authentication>
</soap:Header> 
```

我没有找到任何关于如何从 Axis 客户端配置此标头的文档。当我使用 Visual Studio C# Express 2008 生成客户端时，它会生成一个以`Authentication`两个字符串属性 (`User`和`Password`) 命名的类，并且所有客户端方法都接收该类的对象作为第一个参数，但 Axis WS 客户端不会发生这种情况。

如何在客户端调用中设置此标头？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-26T20:05:51.660

也许你可以使用`org.apache.axis.client.Stub.setHeader`方法？像这样的东西：

```
MyServiceLocator wsLocator = new MyServiceLocator();
MyServiceSoap ws = wsLocator.getMyServiceSoap(new URL("http://localhost/MyService.asmx"));

//add SOAP header for authentication
SOAPHeaderElement authentication = new SOAPHeaderElement("http://mc1.com.br/","Authentication");
SOAPHeaderElement user = new SOAPHeaderElement("http://mc1.com.br/","User", "string");
SOAPHeaderElement password = new SOAPHeaderElement("http://mc1.com.br/","Password", "string");
authentication.addChild(user);
authentication.addChild(password);
((Stub)ws).setHeader(authentication);

//now you can use ws to invoke web services... 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-06-15T17:45:10.767

如果你有一个对象代表`Authentication`带有用户 ID 和密码的容器，你可以这样做：

```
import org.apache.axis.client.Stub;

//...

MyAuthObj authObj = new MyAuthObj("userid","password");
((Stub) yourServiceObject).setHeader("urn://your/name/space/here", "partName", authObj); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-05-15T16:49:27.573

我有同样的问题，并通过以下片段解决：

```
ServiceSoapStub clientStub = (ServiceSoapStub)new ServiceLocator().getServiceSoap(url);
org.apache.axis.message.SOAPHeaderElement header = new org.apache.axis.message.SOAPHeaderElement("http://www.abc.com/SSsample/","AuthHeader");
SOAPElement node = header.addChildElement("Username");
node.addTextNode("aat");
SOAPElement node2 = header.addChildElement("Password");
node2.addTextNode("sd6890");

((ServiceSoapStub) clientStub).setHeader(header); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-03-03T08:21:43.083

我使用了与前面提到的几乎相同的解决方案：

```
SOAPHeaderElement cigWsHeader = new SOAPHeaderElement("https://ws.creditinfo.com", "CigWsHeader");
cigWsHeader.addChildElement("用户名").setValue("用户名");
cigWsHeader.addChildElement("密码").setValue("密码");

var port = new ServiceLocator().getServiceSoap(someUrl);
((Stub) 端口).setHeader(cigWsHeader);
```

并花了几个小时搜索“找不到安全标头”的原因。答案是......命名空间中的冗余符号“/”：“https://ws.creditinfo.com/”。严重地！记在心上。

# c# - 使用带有递归的数组

> ID：786490
> 
> 赞同：-1
> 
> 时间：2009-04-24T15:59:13.470
> 
> 标签：c#, arrays, recursion

现在我使用递归来计算数字的总和，我想做一些稍微不同的事情。以下是我的代码，它将对数字 1、2、3、4、5 求和。我将如何修改我的代码以将数字 1、2、3、4、5 放入一个数组中，然后在递归方法中使用它？我尝试了很多不同的尝试，但显然我错过了一些东西。我知道在递归方法中，我想使用数组的 Length 属性来控制它。

苏珊

```
 static void Main(string[] args)
    {
        Console.WriteLine(Sum(5));
        Console.Read();
    }

    static int Sum(int value)
    {
        if (value > 0) 
        {
            return value + Sum(value - 1);
        }
        else
        {
            return 0;
        }
    } 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-24T16:35:08.703

```
let seq = [1;2;3;4;5]

let rec samp nums = 
  match nums with
  | []      -> 0
  | h::t    -> h + samp t 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-06-20T22:11:36.113

```
static int Sum(int[] a, int index = 0)
{
    if (a[index] == a[a.Length - 1])
    {
        return a[a.Length - 1];
    }
    return a[index] + Sum(a, index + 1);
}

static void Main()
{
    int[] arr = {1, 2, 3, 9, 15};
    Console.WriteLine(Sum(arr));
} 
```

我也是初学者，但这是我的解决方案，它对我有用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-24T16:15:30.140

使用[堆栈](http://msdn.microsoft.com/en-us/library/3278tedw.aspx)怎么样？：

```
Stack<int> stack = new Stack<int>(new int [] {1,2,3,4,5});
Console.WriteLine(SumStack(stack));

public static int SumStack(Stack<int> input)
{
    return input.Count > 0 ? input.Pop() + SumStack(input) : 0;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T16:04:16.813

闻，闻，闻起来像我的作业。

不过，一个提示。添加长度为“n”的数组的所有元素与添加长度为“n-1”的数组的所有元素，然后添加元素“n”的值相同。

将长度为 '1' 的数组的所有元素相加的结果只是一个元素的值

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-24T16:09:55.207

我相信您需要在 Sum 函数中传递数组**和**索引来控制递归性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-24T16:22:28.670

您想要执行通常称为“折叠”又名“减少”的操作。

幸运的是，.NET 团队为您完成了（家庭）工作！

```
 static int sum(int[] values)
    {
        return values.Aggregate<int>((hd, tl) => hd + tl);            
    } 
```

如果您愿意，可以重写它以便于阅读。;)

编辑：使用示例

```
int[] values = new int[]{1,2,3,4,5};
Console.WriteLine(sum(values)); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-24T16:30:25.783

如果你不擅长 lambda 表达式或者你只有 .net 2.0，这很简单；

```
static void Main(string[] args)
{

    int[] myArray = new int[5] {1,2,3,4,5 };

    Console.WriteLine(Sum1(myArray));
    Console.Read();

}

private static int Sum1(int[] myArray)
{

    if (myArray.Length > 0)
    {
        int lengthZeroAdjusted = myArray.Length - 1;
        int element = myArray[lengthZeroAdjusted];

        Array.Resize<int>(ref myArray, lengthZeroAdjusted);
        return element + Sum1(myArray);
    }
    else
    {
        return 0;
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-09-09T03:57:02.000

递归本质上意味着做一小部分，并将大部分交给其他人。现在如果你必须'n'数组的元素，你要求某人给你最后n-1个元素的总和，而你自己只是第一个......只需处理没有什么可做的情况......

一个伪代码是：

```
 sum array start_index   =  if ( start_index >= length(array) ) return 0
                              else return array[start_index] = sum array (start_index + 1)

   print (sum array 0 ) 
```

# php - MVC - 它在现实世界中是如何工作的？

> ID：786496
> 
> 赞同：4
> 
> 时间：2009-04-24T16:00:42.233
> 
> 标签：php, model-view-controller, design-patterns

我已经阅读了很多关于计算器和温度计的微不足道的 MVC 示例，但我似乎无法将这种模式映射到现实世界的应用程序中。

假设您有一个更复杂的场景。假设您有一个网站购物车，要求用户在添加到购物车之前登录。首先，用户看到产品页面（/product/detail）并点击添加商品（/cart/add/207366）。用户尚未登录，因此他们需要访问登录页面 (/user/login)，然后根据流程智能将他们带到购物车视图 (/cart/list)。从那里，他们可以链接回原始产品详细信息页面以继续购物。

假设我们有 3 个数据库表：users、usercart 和 products。在这种情况下，模型是什么？整个流程是否会被封装到 ShoppingCart 模型的 addProductToCartFlow 函数中？这似乎有点混乱，因为它需要访问用户表以进行登录/身份验证，并访问产品表以将产品详细信息/价格拉入购物车。

相反，您会说 ShoppingCart 模型是 SELF-CONTAINED 并且只处理从购物车中添加商品、删除商品等吗？登录用户的“逻辑”然后将在其他地方检查：也许在控制器本身？这将使控制器非常繁忙，有很多“业务逻辑”，例如检查用户是否登录，检查购物车是否为空等，并且模型只是成为数据库表的漂亮名称。

或者，登录或注销的事实本身就是处理此类功能的 UserAuthentication 模型的一部分。或者，也许我们需要一个 UserPageState 模型来告诉我们用户应该在登录页面、购物车页面还是产品详细信息页面上？

在您看来，这种情况下最好的 MVC 设计是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T16:14:33.543

您的模型本质上是业务对象。您将拥有 ShoppingCarts、Users 和 Items（在大多数情况下，每个客户可能只有一个购物车，但谁能说呢？）。您将拥有驱动流程的控制器 - /cart/add/207366 的控制器方法将检查用户是否被授权，如果没有，则将它们传递给 /login 的控制器。登录控制器应该足够聪明，可以将正确的信息传递回 /cart/add/207366 的控制器，然后控制器应该将项目添加到购物车中。

控制器会调用 Cart.AddItem()，但业务逻辑包含在购物车模型中 - 它可能会查找商品的价格、基于用户的首选客户折扣等。控制器不会知道或关心对这个。控制器*确实*需要知道用户是否登录（如果这对应用程序很重要），因为这会影响他们的工作（确定要呈现的视图）。他们不需要知道客户是否是首选客户，或者是否处于信用保留状态，或者任何其他对业务逻辑很重要的条件。这一切都由模型处理。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T16:12:51.347

我将为我的简单站点中的每个表创建一个模型。我可以在我的控制器中使用任意数量的模型。在更复杂的示例中，客户和购物车没有分开，我有一个模型将它们与了解这两个表的方法结合在一起。

在你的视图中有很多模型、非常纤细的控制器和只有 HTML。您的控制器应该有很多从控制器获得结果的“if”语句。您的视图可以具有循环和重复结果的“fors”，但没有其他逻辑。除了在您的视图中，任何地方都没有 HTML 标记。

所以要回答你的问题，你可以有以下模型

*   用户 [进入用户表]
*   购物车 [进入购物车表]
*   产品表和用户表]
*   产品 [进入产品表]
*   订单 [用户、购物车和产品表（作为一个基本的简单示例）]
*   PageState 一个模型，用于跟踪您网站中的用户状态

您有以下控制器

*   大车
*   用户
*   产品

控制器可能很长，但每个动作都很小，都有特定的工作。我认为拥有一个具有 10 个动作的控制器是可以的，只要这些动作本身很好并且很短。

这些操作调用的模型可能相当长，通常会考虑业务逻辑。我还使用辅助类来做一些不是业务逻辑但仍然很关键的事情。像安全和验证一样思考。

还有一大堆观点。购物车视图、登录框视图、产品摘要视图、产品详细信息、结帐的每个阶段、收据、HTML 格式的电子邮件收据视图、类别列表、菜单、页脚。很多很多的意见。

你会想要一些你的所有控制器都继承的 ApplicationClass，这样你就可以一遍又一遍地做一些事情。

您提到了 php，因此您有组成模板的视图，但如果您使用 ASP，您将有一个执行部分视图的母版页。我不确切知道你在 Ruby 或 Python 中做了什么，但它是相似的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-25T01:02:04.460

我认为您不必担心繁忙的控制器：这是他们的目的。具有 add 操作的购物车控制器将依赖用户控制器或身份验证助手来查看用户是否已登录。上面的两个回复很好地捕捉到了这一点。

此外，我不会为页面创建另一个模型，而是使用会话变量或表中的另一个字段。另一个模型实际上只会使事情复杂化，它实际上并不代表您需要自包含的实体。你什么时候看到需要访问一堆页面？它实际上只是用户用于访问登录表单的 url 字符串，您可以使用会话变量以更少的代码和内存密集型方式跟踪它。只需让 addItem() 检查它是否已登录，如果没有则重定向到登录页面并存储当前请求。然后一旦登录，检查是否设置了重定向变量，如果是，则转到它并重置它。我认为不需要比这更复杂的东西。

此外，看起来您的 pastebin 代码是 CakePHP。好的选择。如果可以，请利用烘焙控制台和脚手架代码生成。它为你做了这么多的工作，只为你留下了好东西。

# asp-classic - 上传照片 - 我怎样才能保证我们的网站安全/稳定

> ID：786507
> 
> 赞同：3
> 
> 时间：2009-04-24T16:03:15.253
> 
> 标签：asp-classic, upload

我的网站希望用户上传他们的照片……但我如何保护我们的服务器免受伤害？只允许 JPG 应该可以避免病毒问题，但是如果有人选择了 10Gb 文件怎么办 - 这会减慢整个网站的速度吗？

我们使用的是 Classic ASP 和 IIS6（抱歉，就是这样，无法改变！）。以前，我们使用了一家名为 Persits 的公司的 DLL 来处理上传。但是，如果我们也将此讨论扩展到其他语言/技术，对其他人会有所帮助。

ASP 在完成上传之前无法检测文件的大小，所以这很痛苦。或者我可以在开始传输之前检查 HTTP 标头中的内容长度吗？

Q1。还有其他方法可以有人滥用上传工具吗？
Q2。如何限制风险以保持站点运行和服务器安全？

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T16:21:34.383

在 Persists 中，您可以设置用户可以上传的最大文件大小：

```
Upload.SetMaxSize 100000, True 
```

上面的“True”表示如果超过最大大小，文件将被拒绝。如果设置为 False，则文件将被截断。

见[http://www.aspupload.com/object_upload.html#SetMaxSize](http://www.aspupload.com/object_upload.html#SetMaxSize)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T16:41:30.543

如果您使用的是 ASP.Net，您可以在 web.config（或 machine.config）中指定文件的最大大小，上传时超过大小后 ASP.Net 会抛出错误。也就是说，如果您指定了 4Mb 的限制，并且有人尝试上传 100Mb，.Net 将在上传超过 4Mb 时立即报错。

有问题的属性是**maxRequestLength**，根据 MSDN “指定输入流缓冲阈值的限制，以 KB 为单位。此限制可用于防止拒绝服务攻击，例如，用户将大文件发布到服务器。”

例如。

```
<configuration>
  <system.web>
    <httpRuntime maxRequestLength="4000" .... 
```

我不确定经典 ASP 中是否有等价物。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T16:06:47.553

有一个很棒的组件使用 Flash 上传文件。看看这个

[http://www.codeproject.com/KB/aspnet/FlashUpload.aspx](http://www.codeproject.com/KB/aspnet/FlashUpload.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T16:07:07.680

这似乎强制文件上传大小：[http ://www.aspupload.com/](http://www.aspupload.com/)

我不确定它是如何处理的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-27T10:50:38.773

我刚刚找到一篇关于如何在 IIS 中使用名为“AspMaxRequestEntityAllowed”的设置来限制大小的文章： [http ://www.banmanpro.com/support2/File_Upload_limits.asp](http://www.banmanpro.com/support2/File_Upload_limits.asp)

但是，它不起作用 - 我的服务器已经有 200k 的设置，但我们目前正在上传 1Mb 的文件，好吧！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-27T16:04:26.210

您可以使用 Microsoft 的 UrlScan 工具在 IIS 级别拒绝超大请求，甚至在它们到达您的应用程序之前：[http ://technet.microsoft.com/en-us/security/cc242650.aspx](http://technet.microsoft.com/en-us/security/cc242650.aspx)

对于 IIS 6，看起来您甚至可能不需要它。您应该能够将 MaxRequestEntityAllowed 和 ASPMaxRequestEntityAllowed 元数据库属性设置为您想要的最大值，此时请求将被切断。

# asp.net - 使用 DataContext 静态变量

> ID：786516
> 
> 赞同：4
> 
> 时间：2009-04-24T16:05:11.023
> 
> 标签：asp.net, linq-to-sql, datacontext

我最近继承了一个使用 Linq2SQL 的 ASP.Net 应用程序。目前，它在每个页面中都将其 DataContext 对象声明为静态，并且在我第一次发现它们为空（单例）时创建它们。

如果这是好的或坏的，我需要评论。在我只需要从数据库中读取的情况下以及在我需要写入的情况下。

整个应用程序只有一个 DataContext 实例怎么样？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-24T18:27:08.777

恐怕每个应用程序一个 DataContext 的性能会很差。DataContext 对于初学者来说不是线程安全的，因此即使将其用作页面的静态成员也是一个坏主意。正如 asgerhallas 所提到的，将上下文用于工作单元是理想的 - 通常是单个请求。其他任何事情，您都会开始发现所有数据都在内存中，并且如果没有显式刷新，您将看不到更新。这里有几篇讨论这两个主题的帖子：[身份映射](http://odetocode.com/Blogs/scott/archive/2008/12/07/12372.aspx)和[工作单元](http://odetocode.com/Blogs/scott/archive/2008/12/11/12384.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-24T17:58:57.193

我曾经每个请求都有一个 DataContext ，但这取决于您面临的场景。我认为 L2S 的重点是将它与工作单元模式一起使用，在这种模式下，每个......以及工作单元都有一个上下文。但它在大型应用程序中效果不佳，因为以后很难将实体重新附加到新上下文。

Rick Strahl 在这里对该主题进行了很好的介绍：

[http://www.west-wind.com/weblog/posts/246222.aspx](http://www.west-wind.com/weblog/posts/246222.aspx)

我可以说我过去遇到过问题的一件事是，有一个上下文来读取和写入场景。当您只是阅读时，在数据上下文中完成的更改跟踪是相当大的开销，这是大多数 web 应用程序大部分时间都倾向于做的事情。您可以将 datacontext 设为只读，它会大大加快速度 - 但随后您将需要另一个上下文来编写。

# iphone - 您知道哪些 iPhone OS 内存管理规则和操作方法？

> ID：786528
> 
> 赞同：5
> 
> 时间：2009-04-24T16:07:08.257
> 
> 标签：iphone, objective-c, memory-management, uikit

目前，我正在跳入被称为“iPhone OS 中的内存管理”的冰冷水中。

这是我学到的一条规则：

每次在我的方法中看到一个 alloc 时，我都会在方法的底部释放相应的变量。

每次我在我的头文件中创建一个 @property(...) 表示复制或保留时，我都会将该变量上的释放消息放入 dealloc 方法中。

每次我有一个 IBOutlet 时，我都会做同样的事情。唯一的例外：如果 IBOutlet 有类似 @property(...assign) 的东西，或者换句话说：如果它有 assign 关键字。然后我不在乎在dealloc方法中释放它。

我觉得还有很多好的规则要知道！只要写下你有什么。让我们一起刮掉它们。也欢迎提供精彩描述的链接。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T16:17:31.540

实际上，每当您初始化一个对象并且方法名称包含“init”时，您都有责任释放它。如果您使用不包含“init”一词的 Class 方法创建对象，那么您不会。

例如：

```
 NSString *person = [NSString stringWithFormat:"My name is %@", name]; 
```

不需要发布。但：

```
 Person *person = [[Person alloc] init]; 
```

需要释放（如您在问题中所述）。同样地：

```
 Person *person = [[Person alloc] initWithName:@"Matt"]]; 
```

也需要发布。

这是一个约定，而不是语言规则，但您会发现它适用于所有 Apple 提供的 API。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-25T05:35:20.420

我使用的规则

*   释放您使用名称以“alloc”或“new”开头或包含“copy”的方法创建的所有对象。

*   释放您保留的所有对象。

*   不要释放使用 +className 便利构造函数创建的对象。（类创建它并负责释放它。）

*   不要释放您以其他方式收到的对象 例如 mySprockets = [widget sprockets];

*   如果您将收到的对象存储在实例变量中，请保留或复制它。（除非它是弱引用——只是指向另一个对象的指针，通常是为了避免循环引用。）

*   接收到的对象在（通常）接收它们的方法中是有效的，并且如果传递回调用者也是有效的。

一些很好的链接：

1.  [http://www.gehacktes.net/2009/02/iphone-programming-part-2-objective-c-memory-management/](http://www.gehacktes.net/2009/02/iphone-programming-part-2-objective-c-memory-management/)
2.  [http://mauvilasoftware.com/iphone_software_development/2008/01/iphone-memory-management-a-bri.html](http://mauvilasoftware.com/iphone_software_development/2008/01/iphone-memory-management-a-bri.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-24T21:04:33.610

当您看到每个看似无辜的代码行都出现段错误时，内存管理似乎令人生畏，但一旦您掌握了它，它实际上就很容易了。花一点时间阅读[这个页面](http://www.cocoadev.com/index.pl?MemoryManagement)，然后阅读[Apple 的文档](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html)，你应该很快就能编写出没有错误的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T16:43:25.203

我倾向于只创建自动释放的对象，要么使用类方法，要么在创建后立即自动释放它，除非我可以说明不这样做的理由。例如：

*   我将它分配给一个成员变量，因为我打算保留它一段时间。
*   我只是创建它以立即将其传递给另一个方法，并在该方法调用之后立即向它发送一条发布消息。
*   出于性能原因，我需要在最近的 NSAutoreleasePool 释放之前释放该内存，例如在循环内创建大量对象或对象持有大量数据（例如图像）。

这样，我不太可能泄漏对象。默认情况下，我创建它们是自动释放的，当我故意决定不自动释放它们时，我立即面临它们将在哪里释放的问题。

对于对象属性，我喜欢将 nil 分配给它们，而不是在我的 dealloc 方法中释放它们。这样，保留或复制的属性会被发送一个版本，而分配的属性会被简单地覆盖，如果我将属性更改为保留/保留，我不必更新我的 dealloc 方法。

# c# - 与在 Sql Server 上执行的 .NET 存储过程相关的开销是多少？

> ID：786531
> 
> 赞同：2
> 
> 时间：2009-04-24T16:07:56.647
> 
> 标签：c#, .net, sql-server, performance, stored-procedures

当您选择在 NET 与 T/SQL 中编写存储过程时，肯定会发生某种类型的上下文切换、编组、序列化等。

在决定使用 .NET 还是 T/SQL 进行存储过程时，是否有关于这种开销的确切事实？

您使用哪些因素来做出决定？

对我来说，由于我的学习曲线，用 C# 开发比用 T/SQL 开发快 1000%，但是这种增益什么时候不能抵消性能损失（如果有的话）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T16:14:50.407

开销与切换、编组等无关，除非……您的数据尚未在数据库中。

也就是说，我倾向于尽可能多地使用 T-SQL 来做几乎没有存储过程——包装在 ORM 中。

真的，这就是那里的答案。查看实体框架、NHibernate、Linq To SQL 等。不要编写存储过程（我现在可以听到反对票了），并使用 C# 来完成。

编辑：添加了更多信息存储过程很难测试（本质上是数据绑定），它们没有提供超过动态 sql 的速度优势，并且真的不再安全。也就是说，对于排序和过滤之类的事情，关系数据库比 C# 更有效。

但是，如果您必须使用存储过程（并且有时），请尽可能使用 TSQL。如果您有大量需要执行的逻辑，而不是基于设置的，那么请使用 C#。

我这样做的一次是在我的数据库中添加一些额外的日期处理。我所在的公司使用 5-4-4 周到月的会计日历。这在 SQL 中几乎是不可能做到的。所以我用 C# 来做那个。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T16:31:01.443

我会说这取决于。

有些事情你会发现使用 CLR 过程更好

1.  使用本机 .NET 对象——文件系统、网络等
2.  使用 TQL 不提供或不如 .NET 的功能，例如正则表达式

对于其他人，您会发现 TSQL 过程更好，无论是在易用性还是原始执行速度方面

1.  使用基于集合的逻辑（其中 abc 在 def 或 abc 不在 ghi 中）
2.  CRUD 操作

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T16:28:49.343

这是一个宗教问题，但根据您正在做什么、您的模式以及您正在使用多少记录，可能会有很大差异。测试确实是了解您的情况的最佳方式。

一般来说，存储过程会更好地扩展；但在您的情况下可能不是这样，或者这对您来说可能不是一个重要的考虑因素。

# caching - 使用 Fiddler 确认 HTTP 缓存

> ID：786533
> 
> 赞同：7
> 
> 时间：2009-04-24T16:09:53.430
> 
> 标签：caching, fiddler

如何使用 Fiddler 确认 HTTP 缓存是否正常工作？还有其他更好的方法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-24T16:21:36.177

您可以通过让页面获取资源来确认缓存，并注意 Fiddler 中没有出现对该资源的请求。我想不出更好的方法来做到这一点。为我工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-08-14T10:46:45.213

右键单击提琴手中的URL并单击属性，您可以在“WININET CACHE INFO”下的弹出窗口中检查缓存信息

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-24T16:27:53.900

通过 Fiddler 作为代理浏览站点。在每个响应详细信息中，都有一个“缓存”选项卡。这显示了有关响应标头的有用信息——例如不同的 Cache-Control 和 Expires 值的含义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T16:29:33.477

我认为最好的方法是使用大多数缓存教程中演示的方法 - 在页面上显示当前服务器时间的标签。如果该值已缓存，则在重新生成缓存之前，您不会看到它随着后续页面刷新而更新。

如果你的需求比较复杂（需要使用 Fiddler），Anthony 的建议是我过去成功使用的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-24T16:38:33.437

Fiddler 肯定会对此有所帮助。您将看到服务器以 HTTP 304 响应（未修改 - 它告诉客户端缓存的项目仍然有效）进行响应，或者对于其 Web 到期设置正确的内容，您根本看不到请求。

事实上，您会发现 Firefox 和 FireBug 也会为您做到这一点。

# ruby-on-rails - 命名根控制器

> ID：786535
> 
> 赞同：18
> 
> 时间：2009-04-24T16:10:06.063
> 
> 标签：ruby-on-rails

在开始一个新项目时，我总是被这个问题打败。当我查看 Mephisto、Typo 等示例时，它们会将其根路由到与特定资源/模型相关的控制器。

我的问题是，几乎我曾经建立的每一个网站，我都觉得我的首页实际上是我所有模型的协作，我看不到自己指向一个与特定控制器相关的控制器作为我的登录页面.

有没有人倾向于创建一个专门用于网站前端的控制器？或者，如果我认为这完全错误，请告诉我。

编辑：

这是我的困惑所在：

[rboard 的路由](http://github.com/radar/rboard/blob/60af975e7d9aa2d3948071fa21489d79375302c5/config/routes.rb)将根映射到名为 index 的控制器...但我什至找不到索引控制器

[mephisto 的路由](http://github.com/technoweenie/mephisto/blob/1473acf8307ec21d2002acab94691841d8003580/config/routes.rb)使用一些[自定义路由](http://github.com/technoweenie/mephisto/blob/1473acf8307ec21d2002acab94691841d8003580/lib/mephisto/routing.rb)的东西，没有根，甚至没有 map.connect to '/'

[radiant 的](http://github.com/radiant/radiant/blob/e4b8fc8f3281d2888556d569f2241e14a1942ec9/config/routes.rb)大部分应用程序的路线都转到一个控制器，然后它会做一些疯狂的魔法

[轨道的路线](http://github.com/bsag/tracks/blob/2f8b454ac0222c321b8f6774ba927fede84ad60d/config/routes.rb)转到与资源相关的控制器（这是与我上面描述的最接近的示例）......但不适合我，因为正如我所说，我的根源往往有很多东西。

[发现我们](http://github.com/spot-us/spot-us/blob/abf04c077a1f1589b2d0025bd90aea8a9fce4310/config/routes.rb)实际上做了类似于我所做的事情，有一个只有显示动作的家庭控制器，这就是我的首页。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-25T05:12:51.113

> 我的问题是，几乎我曾经建立的每一个网站，我都觉得我的首页实际上是我所有模型的协作，我看不到自己指向一个与特定控制器相关的控制器作为我的登录页面.

确切地。所以你的做法是正确的。

我经常制作两个控制器来与不常见的 REST 内容进行交互：“欢迎”和“仪表板”。欢迎控制器映射到我站点的根目录，“仪表板”控制器类似，但适用于登录用户。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-24T20:40:59.207

> 有没有人倾向于创建一个专门用于网站前端的控制器？或者，如果我认为这完全错误，请告诉我。

**简短的回答是“是”。**

对于它的价值，我通常采用与 Spot.Us 类似的方法，并定义一个带有索引操作/视图的 HomeController，然后将其保留。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-24T16:20:25.633

不确定这是否是您正在寻找的答案，但这就是我所做的。我通常使用两种控制器类型的组合，即前端控制器和动作控制器。Front Controller 负责 URL 路由并确定要采取的操作，而 Action Controller 提供实际功能。这与 Zend Framework 的做法类似。

话虽如此，我将通过前端控制器传输所有流量，包括首页流量。我通常有一个名为“IndexController”的动作控制器来处理各种页面请求，并且首页通常属于该类别（以及隐私政策页面、联系表格等）。

如果一个页面与站点的任何业务域逻辑没有特别相关，我倾向于将它放在我的索引操作控制器下，尽管我努力尽可能地对站点功能进行分组。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-25T04:44:45.173

SiteController 对我来说似乎是最好的名字。SiteController 将包含您最重要的操作、索引，而我的 SiteController 始终包含其他操作，如联系、关于等。

# javascript - 处理语言与 javascript？

> ID：786538
> 
> 赞同：3
> 
> 时间：2009-04-24T16:10:40.400
> 
> 标签：javascript, processing, visualization, simulation

我将开发一个在浏览器上运行并具有许多可视化和模拟工作（静电和电磁可视化、2D 和 3D）的综合教育软件。

哪种语言（[处理](http://processing.org/)、javascript 或其他）最适合我的目的？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-24T16:21:17.537

这个问题确实很广泛，但我会根据我的经验来回答。

Javascript 并不是真的要进行数学计算，这可能是快速计算大量 E&M 现象所必需的（特别是如果它们没有表示为封闭形式的解决方案）。它还涉及到您想要在图表中包含多少细节（更多步骤 = 更多计算）。您可能会发现自己需要进行更多优化以弥补性能差异。

我在 Flash 中做了一些天线阵列的可视化（他们有封闭形式的解决方案，只有简单的阵列），结果很好。Javascript 绝对无法与您可能想做的任何 3D 模拟相提并论。

我想知道 Silverlight 是否是一个更好的解决方案，因为您可能会发现 .NET 的数学库比 Actionscript 的要多，这可以为您节省大量自己编写数学的工作（但您可能最终还是会这样做，因为性能问题）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-24T16:34:47.673

正如其他人所建议的那样，在可视化方面，javascript 并不是那么强大的语言。

[处理](http://processing.org/)对于您正在尝试做的事情来说是一门非常好的语言，它很容易学习并且是基于 Java 的。数据可视化直接内置于语言以及时间空间中（即及时推进“1 个滴答”并让可视化对此做出反应。）

此外，如果您有兴趣走这条路，我建议您选择[可视化数据](http://oreilly.com/catalog/9780596514556/)，这几乎是一个处理入门。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-24T16:24:28.900

对于您正在寻找的东西，Flash 可能是目前更常见的应用程序堆栈，但 Silverlight 正准备根据它所包含的强大功能从它们那里获得称号。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-24T16:35:40.730

我自己会去 Flex 或 Silverlight

1.  大量可重用的库
2.  对多媒体的原生支持
3.  对图形和动画的原生支持

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-24T20:16:59.280

我有点晚了，但是你想要的，已经用 JavaScript 实现了，你会发现这非常有用。我建议在 Chrome 下运行它，因为 JS 处理引擎非常快。（您甚至可能想尝试更快的 Chrome 2）

*   [http://ejohn.org/blog/processingjs/](http://ejohn.org/blog/processingjs/)
*   [http://ejohn.org/apps/processing.js/examples/basic/（91](http://ejohn.org/apps/processing.js/examples/basic/)个基本演示。）
*   [http://ejohn.org/apps/processing.js/examples/topics/（51](http://ejohn.org/apps/processing.js/examples/topics/)更大，主题，演示。）
*   [http://ejohn.org/apps/processing.js/examples/custom/（4](http://ejohn.org/apps/processing.js/examples/custom/)个自定义“野外”演示。）

另见： http: [//www.chromeexperiments.com/](http://www.chromeexperiments.com/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-24T16:56:31.337

我赞同 LFSR Consulting 的观点：Processing 被大量用于教育目的，它是免费的，而且速度快（Java 通常比 Flash 快）并且易于学习，因此您可以获得更快的结果。它支持 3D，您可以处理用于模拟和计算的 Java 库等。它有一个很棒的社区！:-)

JavaScript 对于这种用法有点轻。JavaFX 被炒作了，但它还不是真正的 3D（尽管有人使用 Java3D）而且它仍然有点年轻。
Flash 和 Silverlight：不予置评，在该领域没有太多经验。OpenLazlo 可以是一个替代方案......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-24T16:17:25.173

您确实有两种选择 Flash 中的 ActionScript 或 Silverlight 中的 VB.NET/C#/other。

因此，首先您需要确定您将针对哪些平台。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-11-07T01:49:59.943

您可能应该尝试 python。它是用于教育和计算目的的非常好的语言，它有一个相当不错的社区，而且语法也不是那么难。即使它是为命令行设计的，您也可以使用一些外部包为其创建前端 gui，它还提供**Scipy**、**Numpy**和**Matplotlib**等包，用于高级绘图和数据可视化。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-24T16:30:30.213

您可以将问题分为两部分，用户交互和显示部分，以及繁重的计算部分。

如果您可以将繁重的计算移至服务器，那么您仍然可以在 javascript 中显示所有内容。

javascript 的一个困难是它是被解释的，你需要自己编写更多的方程，所以会影响性能和开发时间，但它可以在没有任何插件的情况下工作，除非你不想在画布标签。

Flash 和 Silverlight 可能有更好的选择，但是您正在学习新语言并需要插件，具体取决于您要使用的 Flash 版本。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-03-03T23:51:56.177

查看 processing.js、xcode 和 iprocessing！ProcessingJS 非常适合数据可视化，但缺乏交互性。

# shoes - 穿线

> ID：786539
> 
> 赞同：0
> 
> 时间：2009-04-24T16:10:55.783
> 
> 标签：shoes

是否有可能从 shoooes 中生成一个单独的线程，该线程将从命名管道中读取，然后将该命名管道中写入的任何内容打印到文本框中？有人可以举例说明如何设置吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T16:51:09.040

跨线程操作文本非常容易。试试这个代码，例如：

```
Shoes.app do
  @text = para 'Do you like ponies?'

  Thread.new do 
    sleep(4)
    @text.text += "  Of course I do!"
  end

  timer(2) {@text.text += "\nWhat a silly question."}
end 
```

至于从命名管道读取，它们可以像任何其他文件一样对待，但需要注意的是，它们将阻塞，直到管道的另一端设置完成。因此，要么使它们不阻塞，要么在打开管道之前将另一侧设置好。

# settings - 包括文件而不必指定 $_SERVER['DOCUMENT_ROOT']

> ID：786542
> 
> 赞同：2
> 
> 时间：2009-04-24T16:11:02.397
> 
> 标签：settings, php

在 PHP 版本更新之前，我曾经能够在不指定文档根目录的情况下包含以下文件：

```
<?php include '/absolute/path/to/files/file1.php'; ?> 
```

但是我现在必须包含与以下相同的文件：

```
<?php include $_SERVER['DOCUMENT_ROOT'].'/absolute/path/to/files/file1.php'; ?> 
```

什么 php.ini 设置可以覆盖以前的行为？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-24T16:13:38.553

你需要 php.ini 指令`include_path`

请参阅：[http ://us.php.net/manual/en/ini.core.php#ini.include-path](http://us.php.net/manual/en/ini.core.php#ini.include-path)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-24T16:31:49.443

包括绝对路径应该直接通过 PHP 5.2.9 以相同的方式工作（没有尝试过 5.3，但这不应该改变）。由于您指定的是绝对路径，因此 include_path 指令没有任何意义。

你能提供更多信息吗？什么 PHP 版本、平台和您从 include 返回的错误将是一个很好的开始。

> Linux：RHEL 5 PHP：版本 PHP 5.2.9 我收到的错误消息是：PHP 警告：需要（/conf/common.php）：无法打开流：/var/www/vhosts/DOMAIN/ 中没有这样的文件或目录httpdocs/tell-a-friend-fns.php 在第 63 行 PHP 致命错误：require(): Failed opening required '/conf/common.php' (include_path='.:/usr/share/pear:/usr/lib /php:/tmp') 在第 63 行的 /var/www/vhosts/DOMAIN/httpdocs/tell-a-friend-fns.php

好的，看起来您的应用程序位于 /var/www/vhosts/DOMAIN 中，并且您正在寻找 /conf/common.php，对吗？我不知道您的文件实际上是在 /conf/ 中还是在 /var/www/vhosts/DOMAIN/conf/ 中（我假设是后者，并提供了信息）。如果它在 /conf/ 中，请确保您的 Web 服务器用户可以读取该目录。如果没有，请将您的包含更改为 /var/www/vhosts/DOMAIN/httpdocs/conf/common.php。

更好的是，您可能可以这样做`include '../conf/common.php`，具体取决于 common.php 与请求页面的主脚本相关的位置。

请记住，任何带有前导“/”的路径都是相对于文件系统的绝对路径，而不是 Web 服务器文档根目录。任何不带“/”的路径都被假定为相对路径，相对于您的执行脚本（不是当前文件）。我的猜测是在您的路径前添加 $_SERVER['DOCUMENT_ROOT'] 会将绝对路径更改为相对路径。我不知道为什么绝对路径会充当升级前的相对路径，除非您在升级期间被删除的监禁环境（常见于虚拟主机）中操作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-24T18:22:48.943

我总是使用类似的东西：

```
require( dirname( __FILE__ ) . '/../../subdir/somefile.php' ); 
```

它为您提供当前文件的相对路径，但解析为绝对路径（通过在当前文件上使用 dirname）。

# perl - 如何告诉 CPAN.pm 将所有模块安装在特定目录中？

> ID：786544
> 
> 赞同：8
> 
> 时间：2009-04-24T16:11:44.297
> 
> 标签：perl, cpan

我已经设定

```
makepl_arg         [INSTALLDIRS=site PREFIX=~/perl]
mbuildpl_arg       [--install_base ~/perl] 
```

在 CPAN.pm 配置中。我曾希望这会导致模块安装在同一个地方，但我仍然需要在 PERL5LIB 中设置多个路径：

```
export PERL5LIB=~/perl/share/perl/5.10.0:~/perl/lib/perl5/:~/perl/lib/perl/5.10.0 
```

这种情况已经存在很长时间了，我只是忍受它，但我想知道是否有人知道如何让 CPAN.pm 将所有模块放在同一个目录中？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-24T16:29:33.053

安装[local::lib](http://search.cpan.org/perldoc?local::lib)。它将为您处理所有配置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T19:21:22.127

您是否尝试过两者都使用 INSTALL_BASE ？您必须设置多个目录，因为您告诉 CPAN.pm 安装在多个目录中。告诉它在同一个地方安装所有东西：

```
makepl_arg         [INSTALL_BASE=~/perl]
mbuildpl_arg       [--install_base ~/perl] 
```

# c++ - 从 fread() 失败中恢复的好方法是什么？

> ID：786547
> 
> 赞同：3
> 
> 时间：2009-04-24T16:12:18.180
> 
> 标签：c++, c, error-handling, recovery, fread

如果对 fread() 的调用返回 0 并且 ferror() 指示错误（相对于 EOF），是否可以重试读取，还是关闭并重新打开文件更好？

我不能完全重新开始——输入文件已经以一种无法撤消的方式进行了部分处理（比如我一次将一个块写入一个套接字，并且由于现有协议，没有办法告诉远端，“没关系，我需要重新开始”）。

我可以 fclose() 和 fopen() 文件， fseek() 过去已处理的数据，然后从那里继续 fread()-ing，但这一切是否必要？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-24T16:20:31.720

没有“一刀切”的解决方案，因为不同的错误可能需要不同的处理。错误`fread()`是不寻常的；如果您正确调用它，则错误可能表明情况已使`FILE*`处于奇怪的错误状态。在这种情况下，您最好调用`fclose()`,来让事情恢复到良好状态。`fopen()``fseek()`

如果您正在为正在发生的事情进行编码，请提及您从中获得的实际错误`ferror()`......

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-24T16:23:10.340

你可以[`clearerr`](http://www.cplusplus.com/reference/clibrary/cstdio/clearerr/)看看这个函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T16:46:43.620

`perror()`您可以使用or向用户显示错误，`strerror()`并询问她是否要重试。

但是，实现提供这样的错误消息并不是强制性的。您应该`errno`在调用之前设置为 0 `fread()`；如果失败并且`errno`仍然为 0，那么将没有可用的错误信息。

# java - 如何升级 maven 插件的版本？

> ID：786552
> 
> 赞同：31
> 
> 时间：2009-04-24T16:13:45.947
> 
> 标签：java, maven-2, build-process, maven-ear-plugin

我正在使用 maven-ear-plugin 版本 2.3.1 - 我知道有一个新版本可用：[http ://maven.apache.org/plugins/maven-ear-plugin/](http://maven.apache.org/plugins/maven-ear-plugin/)

我不知道如何升级到最新版本？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2010-12-31T04:22:37.323

尽管这已经得到了“认可的答案”，但事实证明，有这个[AWESOME 版本插件](http://www.mojohaus.org/versions-maven-plugin/)可以处理永无止境的版本维护问题。

对于那些懒惰的人，这里有一些目标：

*   **versions:display-dependency-updates**扫描项目的依赖关系并生成具有更新版本可用的依赖关系的报告。
*   **versions:display-plugin-updates**扫描项目的插件并生成具有更新版本可用插件的报告。
*   **版本：display-property-updates**扫描项目并生成用于控制工件版本的那些属性的报告，以及哪些属性有更新的版本可用。
*   **版本：更新父**更新项目的父部分，以便它引用最新的可用版本。例如，如果您使用公司根 POM，如果您需要确保使用的是最新版本的公司根 POM，则此目标会很有帮助。
*   **版本：更新属性**更新项目中定义的属性，以便它们对应于特定依赖项的最新可用版本。如果必须将一组依赖项都锁定到一个版本，这将很有用。
*   **版本：更新子模块**更新项目的子模块的父部分，以便版本与当前项目的版本匹配。例如，如果您有一个聚合器 pom，它也是它聚合的项目的父级，并且子级和父级版本不同步，则此 mojo 可以帮助修复子模块的版本。（请注意，如果您的项目严重损坏以至于由于版本不匹配而无法构建，您可能需要使用 -N 选项调用 Maven 以运行此目标）。
*   **版本：lock-snapshots**在 pom 中搜索所有 -SNAPSHOT 版本并将它们替换为该 -SNAPSHOT 的当前时间戳版本，例如 -20090327.172306-4
*   **版本：解锁快照**在 pom 中搜索所有时间戳锁定的快照版本，并用 -SNAPSHOT 替换它们。
*   **versions:set**可用于从命令行设置项目版本。
*   **versions:use-releases**在 pom 中搜索所有已发布的 -SNAPSHOT 版本，并将其替换为相应的发布版本。
*   **versions:use-next-releases**在 pom 中搜索所有较新版本的非 SNAPSHOT 版本，并用下一个版本替换它们。
*   **versions:use-latest-releases**在 pom 中搜索所有较新版本的非 SNAPSHOT 版本，并将它们替换为最新版本。
*   **版本：use-next-snapshots**在 pom 中搜索所有非 SNAPSHOT 版本，这些版本是较新的 -SNAPSHOT 版本，并用下一个 -SNAPSHOT 版本替换它们。
*   **版本：use-latest-snapshots**在 pom 中搜索所有非 SNAPSHOT 版本，这些版本是较新的 -SNAPSHOT 版本，并用最新的 -SNAPSHOT 版本替换它们。
*   **versions:use-next-versions**在 pom 中搜索所有较新版本的版本，并将它们替换为下一个版本。
*   **版本：使用最新版本**在 pom 中搜索所有较新版本的版本，并用最新版本替换它们。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-24T16:29:25.410

默认插件版本继承自 Super POM，您可以使用`mvn help:effective-pom`.

如果您想覆盖那里提供的版本，请将其添加到您的 POM：

```
<project>
  <build>
    <plugins>
      <plugin>
        <artifactId>maven-ear-plugin</artifactId>
        <version>2.3.1</version>
      </plugin>
    </plugins>
  </build>
</project> 
```

将版本替换为您需要的版本。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-26T01:10:32.090

如何选择插件的版本，以及关于 superpom 中插件版本的讨论在[这里](http://maven.40175.n5.nabble.com/Plugin-Versions-in-the-Super-pom-td208080.html)详细介绍。

实际上当前选择的答案并不完全正确。它应该是

```
<project>
  <build>
   <pluginManagement>
    <plugins>
      <plugin>
        <artifactId>maven-ear-plugin</artifactId>
        <version>2.3.1</version>
      </plugin>
    </plugins>
   </pluginManagement>
  </build>
</project> 
```

[我在这里](http://www.sonatype.com/people/2008/05/optimal-maven-plugin-configuration/)解释了原因：

“常规插件部分还允许定义版本和默认配置，这就是混乱所在。在这里定义插件版本和默认配置在技术上是有效的，但我发现遵循这个更容易理解 pom指导方针：

如果插件块没有定义执行（因此绑定 maven 以在生命周期中做某事），则将该块放入 pluginManagment"

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-24T18:29:42.580

一些 maven 插件仅限于 maven 版本。例如，这里的项目通常使用 Maven 2.0.4，它被限制为使用 war 插件 2.0.2 - 这适用于覆盖。然而，Maven 2.0.9 使用的 2.1-alpha 没有——所以我们不得不手动降级。除非另有说明，否则 Maven 将尝试根据其版本使用最新版本的插件。

# c++ - C++ 流到内存

> ID：786555
> 
> 赞同：7
> 
> 时间：2009-04-24T16:14:21.967
> 
> 标签：c++, stream

如何创建`std::ostream`和`std::istream`对象指向我分配和管理的一块内存（我不希望流释放我的内存）。

我正在寻找使用`rdbuf()->pubsetbuf()`来修改其他流之一 - 比如说`sstringstream`。但是我认为使用的 streambuf`stringstream`之后会释放缓冲区吗？

基本上我正在尝试将一些东西序列化到共享内存。

谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-24T16:17:22.863

看一下[Boost.Interprocess](http://www.boost.org/doc/libs/1_38_0/doc/html/interprocess.html)库中的[bufferstream](http://www.boost.org/doc/libs/1_38_0/doc/html/interprocess/streams.html#interprocess.streams.bufferstream)类：

> bufferstream 类提供 iostream 接口，可在固定大小的内存缓冲区中直接格式化，以防止缓冲区溢出。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2020-03-16T15:44:13.870

```
#include <iostream>
#include <streambuf>

//...
size_t length = 100;
auto pBuf = new char[length]; // allocate memory

struct membuf: std::streambuf // derive because std::streambuf constructor is protected
{
   membuf(char* p, size_t size) 
   {
       setp( p, p + size); // set start end end pointers
   }
   size_t written() {return pptr()-pbase();} // how many bytes were really written?
};

membuf sbuf( pBuf, length ); // our buffer object
std::ostream out( &sbuf );   // stream using our buffer

out << 12345.654e10 << std::endl;
out.flush();

std::cout << "Nr of written bytes: " << sbuf.written() << std::endl;
std::cout << "Content: " << (char*)pBuf << std::endl;

//...
delete [] pBuf; // free memory 
```

# c# - 如何在 dll 中满足 VC++ 运行时要求？

> ID：786558
> 
> 赞同：3
> 
> 时间：2009-04-24T16:15:14.103
> 
> 标签：c#, c++, dll, runtime

我在 VS2008 中编写了一个我在 C# 应用程序中使用的 dll，但我的用户不喜欢他们同时需要 .NET 框架和 VC++ 运行时这一事实。

有没有办法可以避免我的 C++ dll 中的“必备”VC++ 运行时？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-24T16:18:05.517

您可以使用静态链接的运行时构建您的 dll（/MT 而不是 /MD - 在属性->配置属性->C/C++->代码生成->运行时库下）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-24T16:17:41.443

您可以将静态运行时库链接到您的 dll 中。这样，它将始终存在，并且不需要带有 C++ 运行时的 .dll。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T16:31:51.083

就像其他人说的那样，您可以静态链接，但是如果您合并了非静态链接的第 3 方 C++ dll（几乎是所有内容），那将成为一场噩梦。这种情况会导致随机崩溃，这将需要您永远进行调试。最简单的方法是使用一个安装程序，它对您的用户隐藏它。如果您使用 vs 安装程序，则可以使用合并模块，或者作为 nsis 安装的一部分进行安装。这将使每个人的生活更轻松。尤其是你的。没有理由反对安装这些，就像反对安装 .NET 框架一样。除非您需要它们并且没有它们，否则在稳定性方面没有区别。

# groovy - Groovy 扩展元类

> ID：786560
> 
> 赞同：4
> 
> 时间：2009-04-24T16:15:24.773
> 
> 标签：groovy, metaprogramming, expandometaclass

我开发了一个类，它有一些增强整数的方法，它主要让我这样做：

```
def total = 100.dollars + 50.euros 
```

现在我必须扩展 Integer.metaClass 做这样的事情：

```
Integer.metaClass.getDollars = {->
    Money.Dollar(delegate)
} 
```

我试着把它放在文件的底部，在 Money 类声明之前，但是编译器说一个名为 Money 的类已经存在，我知道它为什么会发生（因为 groovy 创建了一个带有空静态文件名的类void main 运行此代码）。

我还尝试在类中使用静态块，如下所示：

```
static {
    Integer.metaClass.getDollars = {->
        Money.Dollar(delegate)
    }
} 
```

这都不起作用。

第三种解决方案是更改文件名（如 MoneyClass.groovy）并保留类名（类 Money），但这似乎有点奇怪。

还有什么我可以做的吗？谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T21:07:59.907

只需将它放在任何类的任何方法中，也许是一个 bean TypeEnhancer.groovy：

```
public class TypeEnhancer {
  public void start() {
    Integer.metaClass.getDollars() = {-> Money.Dollar(delegate) }
  }

  public void stop() {
    Integer.metaClass = null
  }
} 
```

只需通过调用 start(): 来创建和初始化`new TypeEnhancer().start();`。要禁用增强功能，请调用`new TypeEnhancer().stop();`。该bean也可以用作Spring bean。

# c++ - 将项目添加到 Internet Explorer 的右键单击上下文菜单

> ID：786566
> 
> 赞同：3
> 
> 时间：2009-04-24T16:17:19.573
> 
> 标签：c++, internet-explorer, dll, resources, registry

我正在尝试在 Internet Explorer 的右键单击上下文菜单中添加一个新条目。我知道这可以通过创建一个包含 JavaScript 的 HTML 文件来实现，然后从注册表中的某个位置链接到该文件。我还读到您还可以将 HTML 添加到资源文件并将其编译为 DLL（请参阅 Microsoft KB：[将条目添加到标准上下文菜单](http://msdn.microsoft.com/en-us/library/aa753589.aspx)）。这是我开始遇到问题的地方。

这里有一些关于我到目前为止所做的事情的背景。

*   我在文件中有以下 JavaScript `C:\test.htm`：

> ```
> <script type="text/javascript">
>     alert('Hello, world!');
> </script> 
> ```

*   我在以下位置的注册表中添加了一个新`REG_SZ`值：`'c:\test.htm'`

> ```
> HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\MenuExt 
> ```

如果我现在重新启动 IE，我的新菜单项会出现在上下文菜单中。如果我选择我的新菜单项，我的消息框警报会按预期显示。到目前为止，一切都很好。但是，如果脚本在 DLL 中，我似乎无法访问它。以下是我采取的步骤：

1.  在 VS 2005 中创建了一个新的 Visual C++ 类库项目，命名`'IETest'`为`c:\IETest`
2.  将我的`C:\test.htm`文件导入到默认`app.rc`资源文件中。我已经改变`ID`了`TEST`
3.  在调试模式下编译 DLL
4.  更改了注册表项以读取

> ```
> res://C:\IETest\debug\IETest.dll/TEST 
> ```

如果我现在重新启动 IE 并重试，当我右键单击并选择我的新上下文菜单条目时不会出现消息框。我还尝试了 DLL 的发布版本，但没有任何运气，还尝试用逗号替换最后一个正斜杠并将路径单反斜杠更改为双斜杠。

我只能假设我在创建我的 DLL 时做错了什么。谁能指出我正确的方向？有什么方法可以检查编译的 DLL 以检查资源和关联的 ID？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T18:55:14.607

您是否尝试过将 ID 设为 TEST.html？我的猜测是 IE 不知道如何处理该文件，因为它没有列出扩展名，但这完全是基于某些 MS .dll 识别它们的事实的猜测（即 res://c: \windows\system32\shdoclc.dll/navcancl.htm)

我能想到的唯一另一件事是确保您的资源属于 23 类。

ResourceHacker 可以随意查看资源文件：[http ://angusj.com/resourcehacker/](http://angusj.com/resourcehacker/)

# asp.net-mvc - 大型 ASP.NET MVC 应用程序注意事项

> ID：786570
> 
> 赞同：0
> 
> 时间：2009-04-24T16:17:33.800
> 
> 标签：asp.net-mvc

我已经对使用 MVC 进行了大量研究，感谢这里的人们，我已经为我解决了很多围绕它的问题。

我现在遇到的问题围绕着我们的应用程序的庞大规模以及如何在项目本身中组织它。例如，我们有诸如[http://mylocalapp/folder/nestedfolder/subfolder/theapp](http://mylocalapp/folder/nestedfolder/subfolder/theapp)之类的 url 。我们这样做的原因是因为应用程序确实很大。我们*需要*这种文件夹结构，否则应用程序将无法管理。

Phil Haack[在他的一篇博客文章中介绍了嵌套文件夹的路由注册，](http://haacked.com/archive/2008/11/04/areas-in-aspnetmvc.aspx)这确实非常有用，但我们的应用程序中有子应用程序和子应用程序。不能再简化了。

需要采取哪些步骤来管理如此庞大的应用程序，该应用程序跨越大量文件夹，文件夹深度可达 7 级，并且拥有大约 15 个数据库？MVC 真的是这种规模的应用程序的答案吗？

另一种选择是否只是为所有单独的子文件夹应用大量 URL 路由和映射路由区域？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T20:49:18.267

如果您不需要将所有内容都包含在一个应用程序中，为什么不在每个文件夹中创建一个 MVC 应用程序呢？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-11T08:54:29.170

根据评论“您指的是“区域”吗？” 最终是答案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T17:15:26.447

我有类似的情况，我们所做的不是制作“胖”控制器，而是让它们“瘦”。伊恩库珀在[这里](http://codebetter.com/blogs/ian_cooper/archive/2008/12/03/the-fat-controller.aspx)有一篇出色的文章。

所以我们所做的是将“子应用程序”分解为自己的应用程序。我认为这也是以前的海报试图传达的内容。

# jquery - jQuery 内容滑块 - 多个框

> ID：786573
> 
> 赞同：0
> 
> 时间：2009-04-24T16:18:12.147
> 
> 标签：jquery

我正在尝试找到一个 jquery 内容滑块，其中一次包含 3 个框，您可以滚动显示更多内容。

我已经尝试过 jquery 插件存储库和 google，我找到了像我使用过的 Coda Slider 这样的插件。类似的东西，但一次显示三个内容框。

我要将它用于我的投资组合网站的最新项目吗？有人有他们会推荐的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T16:19:34.280

看一看：

[http://sorgalla.com/projects/jcarousel/](http://sorgalla.com/projects/jcarousel/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T16:21:42.230

[http://www.gmarwaha.com/jquery/jcarousellite/](http://www.gmarwaha.com/jquery/jcarousellite/)

或者

[http://demos.flesler.com/jquery/scrollTo/](http://demos.flesler.com/jquery/scrollTo/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-14T19:13:58.453

Smooth Div Scroll 非常适合这个！

[http://www.maaki.com/thomas/SmoothDivScroll](http://www.maaki.com/thomas/SmoothDivScroll)

/托马斯

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-06-18T21:50:53.803

由于这个问题出现在当前的搜索中，我想我会在这里加入一些更新的东西：[Revolver.js](https://github.com/johnnyfreeman/revolver)

它在其他滑块中非常独特，因为它不是开箱即用的解决方案，它更像是一个框架，可以按照您在模型中设想的方式构建滑块。它是一个用于制作您自己的内容滑块的库（完全兼容但不依赖于 jQuery）。

完全披露：我创建了左轮手枪。

# c# - 单元测试：用于测试的数据库设置

> ID：786580
> 
> 赞同：21
> 
> 时间：2009-04-24T16:19:50.753
> 
> 标签：c#, database, unit-testing

我正在为使用数据库的应用程序编写单元测试，我希望能够针对一些示例/测试数据运行应用程序 - 但我不确定设置初始测试数据的最佳方法用于测试。

我正在寻找的是一种针对我当前在调试时使用的同一数据库（或示意性相同）运行被测代码的方法 - 在每次测试之前，我想确保数据库重置为插入测试数据之前的一张白纸。

我意识到使用 IRepository 模式可以让我消除针对实际数据库进行测试的复杂性，但我不确定在我的情况下这是否可行。

有什么建议或文章可以为我指明正确的方向吗？

谢谢！

- 编辑 -

谢谢大家，这些是一些很好的建议！我可能会走模拟我的数据访问层的路线，并结合一些简单的设置类来准确生成每次测试所需的数据。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-24T16:59:01.970

这是我尝试使用的一般方法。我构想了大约三个或四个级别的测试：单元测试、交互测试、集成测试、验收测试。

在单元测试级别，它只是代码。任何数据库交互都被模拟出来，无论是手动还是使用流行的框架之一，因此加载数据不是问题。它们运行得很快，并确保对象按预期工作。这允许非常快速的写测试/写代码/运行测试周期。模拟对象提供每个测试所需的数据。

交互测试测试非平凡类交互的交互。同样，不需要数据库，它被模拟出来了。

现在在集成级别，我正在测试组件的集成，这就是真正的数据库，队列，服务，yada yada，投入其中。如果可以，我将使用流行的内存数据库之一，所以初始化不是问题。它总是从空的开始，我使用实用程序类来清理数据库并在每次测试之前准确加载我想要的数据，这样测试之间就没有耦合。

我使用内存数据库遇到的问题是它们通常不支持我需要的所有功能。例如，也许我需要一个外连接，而内存数据库不支持它。在这种情况下，我通常会再次针对 MySQL 等本地传统数据库进行测试，并在每次测试之前对其进行清理。由于应用程序在单独的环境中部署到生产环境中，因此测试周期不会触及该数据。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T17:59:57.973

我发现处理此问题的最佳方法是使用具有已知数据的静态测试数据库，并使用事务来确保您的测试不会改变任何内容。

在您的测试设置中，您将启动一个事务，在您的测试清理中，您将回滚事务。这使您可以修改测试中的数据，但也可以确保在测试完成时一切都恢复到原始状态。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T16:31:17.527

我知道您使用的是 C#，但在 Java World 中有 Spring 框架。它允许您在事务中运行数据库微计算，并在此事务之后回滚此事务。这意味着您可以在测试完成后对真实数据库进行操作而无需触及状态。也许这可能是对 C# 进一步研究的提示。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-07-28T21:16:14.953

模拟是对代码进行单元测试的最佳方式。

就集成测试而言，我在使用 SQLite 等内存数据库时遇到了一些问题，主要是因为行为和/或语法上的微小差异。

我一直在使用 MySql 的本地实例在几个项目中进行集成测试。返回的问题是服务器设置和测试数据的创建。我创建了一个名为 Mysql.Server 的小型 Nuget 包（在[https://github.com/stumpdk/MySql.Server](https://github.com/stumpdk/MySql.Server)上查看更多信息），它只是在每次运行测试时设置一个 MySql 的本地实例。

通过运行此实例，您可以轻松地为您的测试设置表结构和示例数据，而无需担心您的生产环境或本地服务器设置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-24T16:28:11.467

我不认为有一个简单的方法来完成这个。您只需要创建那些 Pre-Test sql setup 脚本和 post-test Tear-down 脚本。然后，您需要为每次运行触发这些脚本。很多人建议将 SQLLite 用于单元测试设置。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-24T16:34:14.133

我发现最好让我的测试转到不同的数据库，这样我就可以把它擦干净并放入我想要的测试数据。

您可能希望数据库可以在程序中设置，然后您的测试可以告诉类更改数据库。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-11-10T16:20:49.753

此代码清除 MS SQL Server 中所有用户表中的所有数据：

```
private DateTime _timeout;

public void ClearDatabase(SqlConnection connection)
{
    _timeout = DateTime.Now + TimeSpan.FromSeconds(30);
    do
    {
        SqlCommand command = connection.CreateCommand();
        command.CommandText = "exec sp_MSforeachtable 'DELETE FROM ?'";
        try
        {
            command.ExecuteNonQuery();
            return;
        }
        catch (SqlException)
        {
        }
    } while (!TimeOut());

    if (TimeOut())
        Assert.Fail("Fail to clear DB");
}

private bool TimeOut()
{
    return DateTime.Now > _timeout;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-11-09T19:48:53.860

如果您正在考虑真正的数据库使用，那么我们很可能在这里讨论集成测试。即测试，它将应用程序行为检查为不同组件的组合，这与单元测试相反，单元测试应该单独测试组件。

定义了测试范围后，我不建议像其他作者建议的那样使用内存数据库或模拟库之类的东西。问题是内存数据库的行为通常略有不同或功能集有所减少，并且根本没有模拟数据库，因此您将测试一般意义上的其他应用程序，而不是您将要测试的应用程序交付给您的客户。

我宁愿建议通过仅覆盖逻辑的关键部分而将其余部分用于单元测试来最小化集成测试的数量，同时使用设置尽可能接近生产环境的真实数据库。如果有很多集成，测试运行可能会太慢而且真的很痛苦。

您还可以使用一些技巧来优化测试执行的速度：

*   针对它们引入的数据突变将测试拆分为读取和写入，并并行运行前者，无需任何清理。（例如，如果被测系统是 webapp 并且测试更像是端到端的，那么 HTTP GET 请求可以安全地并行运行）；
*   对所有数据使用唯一的插入/删除脚本并尽可能优化。您可能会发现我目前正在开发[的 Reseed库很有帮助。](https://github.com/v-zubritsky/Reseed)它能够为您生成插入和删除脚本。所以基本上你所要求的。或者查看可用于数据库清理的[Respawn ；](https://github.com/jbogard/Respawn)
*   使用数据库快照进行还原，这可能比完整的插入/删除周期更快；
*   将每个测试包装在事务中，然后将其还原（这也不是 100% 诚实且有些脆弱）；
*   通过使用数据库池而不是唯一的来并行化您的测试。Docker 和[TestContainers](https://github.com/HofmeisterAn/dotnet-testcontainers)可能适合这里；

# web-applications - 程序大小的度量

> ID：786582
> 
> 赞同：3
> 
> 时间：2009-04-24T16:20:17.787
> 
> 标签：web-applications, size, metrics

我被要求给出一个关于公司应用程序大小的度量标准。有问题的应用程序是一个基于 Web 的应用程序，我不确定如何量化它的大小。明显但无用的指标是代码行数、文件数量等。有哪些建议的方法可以确定应用程序的大小，从而提供真正的意义？

申请注意事项：

*   基于 ASP.NET Web 窗体的 C# 应用程序
*   分层架构
*   所有数据库交互都通过存储过程

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-24T16:22:29.140

**用户可以访问的“页面”或“区域”的数量**

***问题***：这可以通过将部分分成不同的页面或部分来伪造，而将它们合并到一个单一的“控制中心”界面会更有意义。

* * *

**班级数**

***问题***：与其他类相比，这没有考虑某些类的复杂性（或简单性）。您可能有一个包含两个属性和一个方法的类，而另一个类可能是核心。

* * *

**非查找表的数量**

***问题***：这不会考虑您的软件的复杂性，只考虑它所依赖的数据层。与类数量相关的一些相同问题也可以在这里应用，因为某些表比其他表更复杂。

* * *

**代码行**

***问题***：这是一个相当标准的指标，但它对具有大量行的程序赋予了更多积极的含义，而不是鼓励更高效和优雅的代码。

* * *

**开发需要多少工时**

***问题***：在创建一个软件时，没有两个开发人员具有相同的技能，也没有两个开发人员可能会花费完全相同的时间（或遵循相同的路径）。因此，单个开发人员所花费的时间可能与由 3 名技术/经验较低的开发人员组成的团队编写相同数量的代码所花费的时间相同。此外，如果你开始让更多的人来解决一个问题，而不是真正需要，整个“神话人物月”就会开始抬头。

* * *

总的来说，我认为指标的最大问题是他们试图衡量软件的一些可量化的属性，而实际上软件是关于**质量**而不是**数量**的，这就是指标真正失败的地方。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-24T16:30:54.253

**SLOC**（源代码行）是一种普遍接受的大小度量。

您的问题仅询问大小，但我敢打赌，您被要求提出这些指标，以便管理层可以确定支持此应用程序所需的工作量。在这种情况下，我也会查看代码的复杂性。

您可能想下载一个试用版的[了解](http://www.scitools.com/products/understand/)它适用于多种编程语言，它将为您提供所需的指标，免费试用版将持续足够长的时间来获得管理所需的数字。

**至于指标，我会看看：**

**圈复杂度**V(G) 是复杂度的一个很好的度量。

**SEI 可维护性指数**有助于了解维护代码库的难度。

**代码与注释的比例**至少为 15%，以及其他必要的高级和低级设计文档。意识到其中大部分都将过时，但它们仍然可以帮助您的员工入门。

**测试覆盖率**也是需要关注的其他内容。他们有单元测试吗？当你有一个很好的单元测试套件时，代码更容易维护，你可以运行它给自己一个“合理”的感觉，你没有破坏任何东西。80% 的测试覆盖率通常是最低要求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T17:22:09.230

功能点分析法，我认为适合大中型应用，独立于编程语言：

[http://en.wikipedia.org/wiki/Function_point_analysis](http://en.wikipedia.org/wiki/Function_point_analysis)

分析的结果是一个功能点值，可用于估计执行时间。这种方法很容易理解和实现（使用简单的电子表格），但是它需要一些经验，因为计算中的一些关键因素是可变的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T16:23:30.120

*有哪些建议的方法来确定将提供真正意义的应用程序的大小？*

如果您找到了一个非常好的答案，请正确地写出来，好吗？

根据我的经验，代码指标几乎普遍都很糟糕。他们中的一些人只是很糟糕。

[附录]

公平地说，问题不在于“代码度量很烂”，毕竟它们只是度量（希望是定义明确的度量）；问题是他们似乎从来没有衡量人们希望他们衡量的东西，*而是像他们那样被使用*。将这种滥用行为归咎于数字并不公平。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-24T16:38:49.833

一个指标只有在你知道它的用途时才能提供真正的意义。你知道测量尺寸的目的吗？如果没有，请问。

# asp.net - 从 asp.net AJAX 应用程序获取数据的 Python

> ID：786603
> 
> 赞同：5
> 
> 时间：2009-04-24T16:24:09.743
> 
> 标签：asp.net, python, asp.net-ajax, screen-scraping

使用 Python，我正在尝试读取[http://utahcritseries.com/RawResults.aspx](http://utahcritseries.com/RawResults.aspx)上的值。我可以很好地阅读该页面，但是很难更改年份组合框的值以查看其他年份的数据。除了默认的 2002 年之外，我如何读取其他年份的数据？

一旦年份组合框发生更改，该页面似乎正在执行 HTTP Post。控件的名称是 ct100$ContentPlaceHolder1$ddlSeries。我尝试使用 urllib.urlencode(postdata) 为这个控件设置一个值，但我一定做错了——页面上的数据没有改变。这可以在 Python 中完成吗？

如果可能的话，我宁愿不使用 Selenium。

我一直在使用这样的代码（来自stackoverflow用户dbr）

```
import urllib

postdata = {'ctl00$ContentPlaceHolder1$ddlSeries': 9}

src = urllib.urlopen(
    "http://utahcritseries.com/RawResults.aspx",
    data = urllib.urlencode(postdata)
).read()

print src 
```

但似乎拉高了相同的 2002 年数据。我尝试使用 firebug 来检查标头，我看到很多无关的和随机的数据被来回发送 - 我是否还需要将这些值发布回服务器？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T19:47:01.847

使用优秀的[机械化](http://wwwsearch.sourceforge.net/mechanize/)库：

```
from mechanize import Browser

b = Browser()
b.open("http://utahcritseries.com/RawResults.aspx")
b.select_form(nr=0)

year = b.form.find_control(type='select')
year.get(label='2005').selected = True

src = b.submit().read()
print src 
```

机械化在 PyPI 上可用：`easy_install mechanize`

# jquery - jQuery Style 效果 - 淡出其他框

> ID：786604
> 
> 赞同：0
> 
> 时间：2009-04-24T16:24:14.987
> 
> 标签：jquery

我一直在尝试创建类似的东西：http: [//jquerystyle.com/index.php](http://jquerystyle.com/index.php) - 当你越过一个时，它会在翻转时设置一个类，而另一个则淡出，有没有人听说过这样做的资源？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T17:37:34.170

**这可能正是您想要的：**

[当一个悬停在上面时，jQuery 淡化/变暗其他列表元素，我在那里 90%..？](https://stackoverflow.com/questions/760280/jquery-fading-dimming-other-list-elements-when-one-is-hovered-over-im-90-there/760460#760460)

[它包括一个例子。](http://jsbin.com/usobe)

（当然，我有点偏见，但这正是您想要做的）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T16:48:50.760

您不需要插件或任何东西，因为它应该相当简单。

假设您使用无序列表来包含元素，并且给它一个名为“nav”的 id。

您将使用悬停事件将您的项目设置为“活动”，将其他项目设置为“非活动”。

```
$(document.ready() {
    $('ul#nav li').hover(function() {
        $(this).closest('ul#nav').find('li').addClass('inactive');
        $(this).removeClass('inactive').addClass('active');
    },
    function() {
        $(this).closest('ul#nav').find('li').removeClass('inactive');    
        $(this).removeClass('active');
    }
}); 
```

您现在可以使用活动和非活动类来设置每个样式。您还可以通过添加到链中对每个项目执行淡入淡出/其他动画。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T17:00:41.933

这应该让你开始。

Javascript：

```
$(function() {
    $(".InnerBox").hover(function() {
        $(this).css('color', 'black').siblings(".InnerBox").css('color', 'gray')
    });
    $(".OuterBox").mouseout(function() {
        $(this).find(".InnerBox").css('color', 'black')
    });
}); 
```

HTML

```
 <div class="OuterBox">
   <div class="InnerBox">1</div>
   <div class="InnerBox">2</div>
   <div class="InnerBox">3</div>   
   </div> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T17:09:47.607

[http://docs.jquery.com/Effects/fadeOut](http://docs.jquery.com/Effects/fadeOut) [http://docs.jquery.com/Effects/fadeIn](http://docs.jquery.com/Effects/fadeIn)

虽然效果是“淡出”，但我想这样做的方法是淡入一个背景为半像素透明、半像素黑色的 div。

像这样尝试

```
$(".box").hover(function () {
    $(".box:not(:hover) > div").fadeIn("slow");
}); 
```

其中 > div 是具有深色背景的。未经测试，将其视为伪代码:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-24T17:12:59.737

这可能类似于他们在该页面上的操作方式：

```
$(function() {
    $('img.fader').bind('mouseover',function() {
        $(this).siblings('.fader').fadeOut('slow');
    }).bind('mouseout',function() {
        $('img.fader').fadeIn('slow');
    });
}); 
```

# javascript - 通过从 DOM 中删除它的代码来清理 javascript 变量范围

> ID：786608
> 
> 赞同：2
> 
> 时间：2009-04-24T16:27:06.790
> 
> 标签：javascript, jquery, dom

希望这个基于 jquery 的简单代码将有助于解释这个问题。

html:

```
<script> 
  $('#remover').click(function(){
   $('#block').empty();
  })
  $('#test').click(function(){
   alert(remove1);  // still displays the varibale
  })
</script>
<div id="block">  
 <script>
    var remove1 = 'asasdsds';
    var remove2 = 'asasdsds';
    var remove3 = 'assdsdsdas';         
    var blabla = 'blablabl';
 </script>
</div>

<span id="remover">Remove ALL</span>
<span id="test">Test</span>  // it will still displays the variable. 
```

我需要通过删除块内容来清除全局范围内的所有变量。块内容是动态的，可以包含任何 JavaScript 代码。

谢谢阅读。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-24T16:31:53.127

这肯定不会像您期望的那样工作。JavaScript 堆不与 DOM 耦合——一旦脚本执行并改变了堆，您就不能通过删除它们相关的源代码来“取消执行”它们。

全局变量通常设置在窗口对象上，因此如果您知道名称，则可以从那里删除它们。如果您想撤消块内任何 JavaScript 的影响，那么您将非常不走运。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-24T16:33:49.097

Javascript 不能那样工作！解析脚本块后，将其从 DOM 中删除不会做任何事情......我唯一能想到的就是这样一个非常**丑陋的 hack**：

```
<script>
var blockKeys = [];
var oldKeys = {};
for (var i in window)
    oldKeys[i] = true;
</script>
<div id="block">  
 <script>
    var remove1 = 'asasdsds';
    var remove2 = 'asasdsds';
    var remove3 = 'assdsdsdas';         
    var blabla = 'blablabl';
 </script>
</div>
<script>
for (var i in window)
{
    if (!oldKeys[i])
        blockKeys.push(i);
}
alert(remove1);
</script> 
```

然后您的删除功能如下所示：

```
<script>
function remove()
{
    for(var i = 0; i < blockKeys.length; i++)
        eval(blockKeys[i] + ' = null');
}
</script> 
```

# apache-flex - Flex：在不复制+粘贴的情况下为多个项目重用类？

> ID：786620
> 
> 赞同：0
> 
> 时间：2009-04-24T16:29:55.533
> 
> 标签：apache-flex, classpath, code-reuse

好的，我有一些我已经制作或在网上找到的类，我计划在多个项目中使用，我宁愿将这些类存储在一个中心位置，而不是将它们复制+粘贴到每个项目中。

我的 Flex 项目在路径 Flex/WorkSpaces/<workSpaceName> 中有自己的工作区

如果我想在 Flex 目录中放置另一个文件夹并将包设置为 com.mydomain.whatever

我需要制作什么文件夹结构，以及如何使我的项目可以访问代码？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T16:40:41.483

您可以在 FB3 中导入整个项目。看看[文档](http://livedocs.adobe.com/flex/3/html/help.html?content=projects_4.html)。

使用包总是更好。保持 src 组织如下：

> com
> 
> |__ 约翰尼萨克斯
> 
> ```
>  |_____ utils
>          |_____ components
>                        |____ video
>          |_____ assets 
> ```

```
 .... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T20:36:18.703

我通常会创建一个新的库项目并将这些类存储在该项目中。

要将该库项目链接到您当前的项目，您只需将其添加到当前项目的库路径（项目属性 -> Flex/ActionScript 构建路径 -> 库路径选项卡）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T23:47:27.353

进入**项目属性**，选择**构建路径**。在“**源路径**”选项卡中，您可以从文件系统的任何位置添加包含 ActionScript 文件的文件夹。在**库路径**选项卡中，您可以添加单个 SWC 或包含多个 SWC 的文件夹。

一个示例（对于 Windows，但在 Mac 上应该类似）：

假设您有一个文件夹`C:/Development/classes`，您可以在其中保存跨项目重复使用的所有“共享”源文件。在该文件夹中，您想保留一个类，`com.example.MyClass`. 您应该使用此文件夹结构：

C:/Development/classes/com/example/MyClass.as

# visual-studio-2008 - c# 设计器运行什么代码？

> ID：786632
> 
> 赞同：1
> 
> 时间：2009-04-24T16:33:06.883
> 
> 标签：visual-studio-2008, designer

我的代码编译和运行良好，但没有加载到设计器中，我一直遇到问题。然后我必须使用第二个 Visual Studio 实例来调试我的 Visual Studio 以找出问题所在。设计者执行什么代码，以什么顺序执行？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T17:18:39.520

唔。我刚刚注意到，当我在设计器中查看名为“MainForm”的表单时，实际上创建了一个 System.Windows.Forms.Form 类型的对象，而不是 MainForm 类型的对象。添加的控件中的某些代码要求其父级是 MainForm。执行代码时一切都很好，但在设计器中却不是，因为没有创建 MainForm。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T16:44:29.400

如果您正在创建一个 WinForms 应用程序，那么它就是 .designer.cs 中的代码

# string - 测试字符串中的日文/中文字符

> ID：786637
> 
> 赞同：6
> 
> 时间：2009-04-24T16:34:24.773
> 
> 标签：string, unicode, language-detection

我有一个程序可以读取一堆文本并对其进行分析。文本可能是任何语言，但我需要专门测试日语和中文，以便以不同的方式分析它们。

我读过我可以测试它的 unicode 数字上的每个字符，以确定它是否在 CJK 字符范围内。这很有帮助，但是如果可能的话，我想将它们分开以针对不同的字典处理文本。有没有办法测试一个字符是日文还是中文？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-24T16:52:19.567

由于 unihan 代码点在 Unicode 标准中的实现方式，您将无法测试单个字符来确定它是日语还是中文。基本上，每个汉字都是一个潜在的日本汉字。然而，反过来是不正确的。此外，还有许多约定可用于测试一个文本*块是否使用一种语言或另一种语言。*

1.  简化 - 如果您正在测试的字符是中国[简化](http://en.wikipedia.org/wiki/Simplified_Chinese_characters)，例如门，则仅在大陆中文中可用。
2.  假名 - 如果字符是许多[日文假名](http://en.wikipedia.org/wiki/Kana)字符之一，例如あいうえお，那么您正在使用的文本块肯定是日文。

问题在于共同的字符和单词的绝对数量。但是，如果我需要一个快速而肮脏的解决方案来解决这个问题，我会检查我的整个文本块是否有假名 - 如果文本包含假名，那么我知道它是日语。如果您还需要区分韩语，我会测试韩文。另外，如果您需要区分什么类型的中文，测试简化类型将是最好的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T16:43:55.983

统一码的发展过程包括汉统一。这是因为很多日文字符是从汉字衍生出来的，或者和汉字相同的。韩语也一样。日语中常用的一些字符（片假名和平假名 - 参见Unicode 标准 v5.1.0 的[第 12 章](http://www.unicode.org/versions/Unicode5.0.0/ch12.pdf)）表明文本是日语而不是中文，但我相信这将是一个统计测试而不是确定性。

查看 O'Reilly 关于[CJKV 信息处理](http://oreilly.com/catalog/9780596514471/)的书（CJKV 是中文、日文、韩文、越南文的缩写；我有 CJK 的前身潜伏在某处）。还有 O'Reilly 关于[Unicode Explained](http://oreilly.com/catalog/9780596101213)的书，它可能会有所帮助，尽管可能不适用于这个问题（我不记得讨论过如何识别日文和中文文本）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T16:38:29.973

你可能无法可靠地做到这一点。日语使用了很多与中文相同的字符。我认为你能做的最好的就是看一段文字。如果您看到任何独特的日文字符，那么您可以假设整个块都是日文。如果不是，那可能是中文。

但是，我只是在学习中文，所以我不是专家。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-04T10:14:56.333

测试片假名或平假名范围内的字符应该是确定文本是否为日语的一种非常可靠的方法，尤其是在您处理“常规”用户生成的文本时。如果您正在查看法律文件或其他更官方的票价，则可能会稍微困难一些，因为复杂的汉字将占主导地位 - 但它仍然应该非常可靠。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-01T02:44:12.463

一种解决方法是在将编码转换为 Unicode 之前检查编码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-12-15T16:05:52.467

有许多字符仅（通常）用于日语或仅用于中文。

日本和中国都简化了许多字符，但通常采用不同的方式。您可以检查日文 Shinjitai 和简体中文字符。后者比前者多得多。如果两者都没有，那么您可能有繁体中文。

当然，如果您正在处理 Unicode 文本，您可能会发现偶尔出现的稀有字符或混合语言，这可能会引发启发式算法，因此您最好通过计算字符类型来做出判断。

找出哪些字符在一种语言中常见而在其他语言中不常见的一个好方法是将旧编码相互比较。您可以在 Internet 上轻松找到每个到 Unicode 的映射。

我曾经写过一些代码，它通过代码点进行二进制搜索，即使在 JavaScript 中它也非常快 - 虽然我可能在旅行中丢失了它（-：

# asp.net - 如何在 IIS7 中进行 gzip 压缩？

> ID：786638
> 
> 赞同：70
> 
> 时间：2009-04-24T16:34:31.810
> 
> 标签：asp.net, .net-3.5, iis-7, compression, gzip

我已经为 IIS7 安装了静态和动态压缩，并`web.config`在我的应用程序`Virtual Folder`级别设置了这两个值。据我了解，我不再需要在服务器或站点级别启用压缩，我可以使用我的 web.config 文件在每个文件夹的基础上对其进行管理。

我的`.config`文件中有两个设置，我已经设置为我的应用程序自定义 gzip：

```
<httpCompression dynamicCompressionDisableCpuUsage="90"
    dynamicCompressionEnableCpuUsage="0">
  <scheme name="gzip" dll="%Windir%\system32\inetsrv\gzip.dll" />
  <dynamicTypes>
    <remove mimeType="*/*"/>
    <add mimeType="*/*" enabled="true" />
  </dynamicTypes>
</httpCompression>
<urlCompression doDynamicCompression="true"
    dynamicCompressionBeforeCache="true" /> 
```

但是，当我运行应用程序时，我可以清楚地看到没有使用 gzip，因为我的页面大小相同。我还在为 FireFox 使用[YSlow](http://developer.yahoo.com/yslow/)，这也证实了我的页面没有被压缩。

我在这里想念什么？在 IIS6 中，指定文件类型并将压缩级别设置在 0-10 之间很简单。我没有看到需要指定文件类型或压缩级别，因为默认值似乎涵盖了文件类型，而且我在任何地方都没有看到级别。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-04-24T19:34:47.897

在 iis 7 beta 期间，forums.iis.net 上有一个关于此的主题。原来那个人没有安装模块，但听起来你已经从你的开场白中排除了这一点。

微软对他的关键建议是启用失败的请求跟踪以找出问题所在。这可能是 IIS7 中最被低估的功能之一，但肯定是最强大的功能之一。

*   打开 IIS 管理器。
*   转到您的站点，然后在操作窗格（最右侧）上，单击“配置”部分下的“失败的请求跟踪...”。
*   点击“启用”。
*   然后，在功能视图中，单击“失败的请求跟踪规则”。点击添加，下一步，状态码输入200，下一步，点击完成。

如果在操作窗格中没有看到“Failed Request Tracing”，则需要将该功能添加到服务器 - 使用“添加角色服务”向导（Health and Diagnostics\Tracing）或通过 Web 平台安装程序（产品\服务器\IIS：跟踪），然后关闭并重新打开 IIS 管理器。

接下来，重新运行您的测试。这将生成一些日志信息供我们检查。

查看 c:\inetpub\logs\FailedReqLogFiles\w3svcx。您将看到一堆名为 fr000xx.xml 的文件。在浏览器中打开其中任何一个。（顺便说一句，如果您将这些文件复制到任何地方，请确保 freb.xsl 在那里。另外，不要删除 freb.xsl - 如果这样做，只需删除整个目录或从另一个位置复制它，因为 IIS 只会创建每个文件夹一次。）

单击“请求详细信息”选项卡并选择“完整请求跟踪”。在页面中搜索“压缩”——您应该可以在多个区域找到它；一次用于静态内容，一次用于动态内容。

如果您没有找到其中任何一个，则说明 IIS 配置不正确。如果您确实找到了它们，您应该会看到它们后跟一个compression_success 和一个compression_do。成功是不言自明的；“do”表示它做了什么——在我的例子中，它显示“OriginalSize 1462784 CompressedSize 179482”

由于您的不起作用，希望您会看到一些不同的东西来帮助您解决问题。

确保在完成后通过在您的网站的操作窗格中禁用失败的请求跟踪来关闭此功能。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-07-07T17:24:04.750

我们遇到了类似的问题，事实证明 IIS7 在这里做了一些基于动态 CPU 的节流。

[http://www.iis.net/ConfigReference/system.webServer/httpCompression](http://www.iis.net/ConfigReference/system.webServer/httpCompression)

> `dynamicCompressionDisableCpuUsage`
> 
> 可选的 uint 属性。
> 
> 指定将禁用动态压缩的 CPU 利用率百分比。
> 
> 注意：此属性充当关闭动态压缩的 CPU 上限。当 CPU 利用率低于 dynamicCompressionEnableCpuUsage 属性中指定的值时，将重新启用动态压缩。
> 
> **默认值为 90。**
> 
> * * *
> 
> dynamicCompressionEnableCpuUsage
> 
> 可选的 uint 属性。
> 
> 指定将启用动态压缩的 CPU 利用率百分比。该值必须介于 0 和 100 之间。平均 CPU 利用率每 30 秒计算一次。
> 
> 注意：此属性充当 CPU 下限，低于该下限动态压缩被打开。当 CPU 利用率超过 dynamicCompressionDisableCpuUsage 属性中指定的值时，动态压缩将被禁用。
> 
> **默认值为 50。**

请注意默认值——如果您的 IIS7 达到 90% 的 CPU 使用率，它将*禁用所有动态压缩内容*，直到 CPU 使用率回落到 50% 以下！

此外，这里还有一些关于 GZIP 实际 CPU 成本的很好的建议和基准测试。

[http://weblogs.asp.net/owscott/archive/2009/02/22/iis-7-compression-good-bad-how-much.aspx](http://weblogs.asp.net/owscott/archive/2009/02/22/iis-7-compression-good-bad-how-much.aspx)

长话短说，除非您经常拥有超过 200kb 的动态页面，否则这不是问题。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2010-10-16T14:13:40.690

遵循 JohnW 的出色建议，我也启用了日志记录以找到罪魁祸首，尽管失败的原因结果不同：

```
STATIC_COMPRESSION_NOT_SUCCESS 
Reason 14 
Reason NOT_FREQUENTLY_HIT 
```

简而言之，如果你没有足够频繁地点击页面，那么 IIS7 将不认为它值得压缩，这对我来说似乎有点奇怪。尽管如此，在这种情况下还是有意义的，因为我只是想在本地机器上测试它。

根据[这个页面](http://www.iis.net/ConfigReference/system.webServer/serverRuntime#005)，默认似乎是一个页面必须在 10 秒内被点击 2 次才能成为“频繁点击”。如果你真的想要，你可以覆盖 applicationHost.config (%systemroot%\Windows\System32\inetsrv\config) 中的默认值。至少对我来说这是一个锁定的属性，所以你不能在你自己的 web.config 中覆盖它。

```
<serverRuntime frequentHitThreshold="1" /> 
```

另外，我现在注意到 SO 在这里已经有了这个答案：[在 IIS7 中，gzipped files do not stay that way](https://stackoverflow.com/questions/2203798/in-iis7-gzipped-files-do-not-stay-that-way)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-05T13:15:16.830

在 Web.config 文件的 system.webServer 部分中，添加以下行：

```
<remove fileExtension=".js" />  
<mimeMap fileExtension=".js" mimeType="application/x-javascript" /> 
```

IIS7 中的压缩方案默认启用，但它只映射一个要压缩的 javascript mime 类型，application/x-javascript。添加上面的行告诉 IIS 为您的所有 .js 文件提供 mime 类型，这反过来使压缩工作。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-03-01T02:38:25.743

我通过在添加/删除程序中安装动态压缩解决了我的问题。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-24T16:35:38.140

开启静态压缩。动态压缩适用于 asp、php、aspx 等动态页面。

这是[压缩的 IIS 配置参考](http://www.iis.net/ConfigReference/system.webServer/httpCompression)的链接：

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-01-23T00:20:18.770

对我来说，它原来是设置

```
noCompressionForProxies 
```

因为我们在这里使用代理...让自己脱离代理，瞧，压缩。

# asp.net - AJAX 控件工具包：Multiview 内的 TabContainer，选项卡按钮样式问题

> ID：786642
> 
> 赞同：0
> 
> 时间：2009-04-24T16:35:23.150
> 
> 标签：asp.net, asp.net-ajax

我在 Multiview 中有一个 TabContainer。当我打开一个特定的编辑页面，该页面列出了 Gridview 中的记录进行编辑，然后单击其中一个项目......它从所选记录中获取该数据并在 Multiview 内的另一个视图上填充一个表单。

该视图包含一个选项卡容器。我的问题是，如果我进入页面的编辑部分，选择一条记录，然后切换到带有 TabContainer 的视图，则 TabContainer 不会显示按钮的样式，只会显示标题文本。

我假设这是当我进入页面时视图不可见的问题，因为我最初正在使用另一个视图。有没有办法解决？

```
<asp:MultiView ID="PersonPanelView" runat="server">
   <asp:View ID="AddPersonView" runat="server">
      <ajaxToolkit:TabContainer ID="PersonInformationTabContainer" runat="server" 
                                Width="80%">
          <ajaxToolkit:TabPanel ID="PersonalInformationPanel" runat="server" >
                        <HeaderTemplate>
                            Personal Information
                        </HeaderTemplate>
                        <ContentTemplate>...</ContentTemplate>
          </ajaxToolkit:TabPanel>
          <ajaxToolkit:TabPanel ID="CompanyInformationPanel" runat="server">
                        <HeaderTemplate>
                            Company Information
                        </HeaderTemplate>
                        <ContentTemplate>...</ContentTemplate>
          </ajaxToolkit:TabPanel>
       </ajaxToolkit:TabContainer>
    </asp:View>
    <asp:View ID="EditPersonView" runat="server">
         ... Gridview that has records to select
    </asp:View>
</asp:MultiView> 
```

所有这些都在 UpdatePanel 中。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T17:59:37.113

我能够通过解决这个问题来解决这个问题。我只是在 UpdatePanel 之外添加了一个空的 TabContainer 并将其设置为 Visible=True 以呈现 CSS。对于 MaskedEdit 的样式问题，这基本上是相同的解决方法

# mobile - 将蓝牙设备连接到未知设备

> ID：786643
> 
> 赞同：1
> 
> 时间：2009-04-24T16:35:34.083
> 
> 标签：mobile, bluetooth

是否可以将蓝牙设备连接到未知设备？我认为所有蓝牙设备都必须与另一个蓝牙设备配对才能一起使用。有人提到了一个可能的应用程序，其中蓝牙设备（很可能是 Windows Mobile 手机，因为 iPhone SDK[不支持蓝牙连接](https://stackoverflow.com/questions/441609/access-to-iphones-bluetooth-abilities-via-sdk)）可用于读取给定区域的电表。我认为电话必须与每个仪表配对，然后才能进行任何其他通信。这个对吗？手机可以在配对之前从蓝牙提供商处接收任意数据吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T08:40:07.510

You don't have to have security set up (no pin code) so you could have a bluetooth device that is always discoverable and will always connect/pair. So this could be used for the 'read a meter' type application.

Also, in Bluetooth 2.1, you have Extended Inquiry data so you could get the meter reading by having the meter encode the reading into the Extended Inquiry response. Then you don't even have to connect/pair. Just have a device that does an inquiry and gets the data that way.

There are some new standards coming for BlueTooth for Low Energy devices that would basically act like sensors, which are specifically targeted at this type of application.

There is more info then you could possibly want at www.bluetooth.org

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T16:45:23.233

如果您知道蓝牙设备的 MAC 地址并且可以连接，则可以直接与其通话。

# cocoa-touch - 如何通过 Cocoa Touch 中的变量赋值来遍历类层次结构？

> ID：786646
> 
> 赞同：1
> 
> 时间：2009-04-24T16:36:03.087
> 
> 标签：cocoa-touch

我创建了一个名为 MyViewController 的 UIViewController 类，其 XIB 文件中有一个 UIImageView。然后我将这个类导入另一个类。我创建了一个类的实例，并使用代码更改 UIImageView 中的图像：

```
myViewController.myImageView.image = [UIImage imageNamed:@"myImage.png"]; 
```

这很有效。我的应用本质上是一个图像查看器。我想通过预加载带有图像的子视图来缓存下一张和上一张图像。当我将 myViewController 放入这样的变量中时：

```
UIViewController *pager = myViewController; 
```

并尝试使用该变量为 UIImageView 设置图像，如下所示：

```
pager.myImageView.image = [UIImage imageNamed:@"myImage.png"]; 
```

我收到“错误：在非结构或联合的情况下请求成员 'myImageView'”。我试过用方括号来做：

```
[[[pager myImageView] setImage:[UIImage imageNamed:@"myImage.png"]]; 
```

我收到“警告 'UIViewController' 可能无法响应 '-myImageView'”。如何访问层次结构以访问 myImageView？我在标题中使用了@class 和#import，并且我已经合成了类实例。到目前为止，我唯一的解决方案是 hack，通过这样做：

```
UIImageView *pager = myViewController.myImageView;
pager.image = [UIImage imageNamed:@"myImage.png"]; 
```

这使我拥有的变量数量增加了一倍，一个用于 UIImageView 变量，一个用于 UIViewController 变量。提前感谢任何可以提供帮助的人。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T16:42:48.200

**快速回答**：

您需要更改该行：

```
UIViewController *pager = myViewController; 
```

到：

```
MyViewController *pager = myViewController; 
```

能够访问您在`MyViewController`类中添加的自定义属性。

**解释**：

您的`MyViewController`课程可能看起来像这样（简化）：

```
// MyViewController.h:
@interface MyViewController : UIViewController
{
    UIImageView * myImageView;
}
@property (readonly) UIImageView * myImageView;
@end 
```

 ````
// MyViewController.m:
@implementation MyViewController
@synthesize myImageView;
@end 
```

您通过向原始类添加成员变量和属性 ( ) 来*扩展类。*`UIViewController``myImageView`

当您使用指向基类 ( `UIViewController`) 的指针来访问您的变量时，您是在告诉编译器将该变量视为普通 old `UIViewController`，而普通 old`UIViewController`没有 a 的概念`myImageView`。这就是导致编译器错误的原因。

# c# - 验证的更好方法/地点是什么？

> ID：786650
> 
> 赞同：1
> 
> 时间：2009-04-24T16:37:51.193
> 
> 标签：c#, asp.net, asp.net-mvc, validation

在我的 asp.net mvc 应用程序中，我有服务层，它与业务对象一起操作，将其传递给存储库层并返回到控制器。不，我无法决定我需要在哪里验证对象。第一名 - 在业务对象类中使用带有组件模型注释属性的数据注释验证，例如：

```
[AcceptVerbs("POST")]
    public ActionResult Edit(Source src)
    {
        if(!ModelState.IsValid){            
            return View("EditSource", src);

        _sourceService.SaveSource(src);

        return RedirectToAction("Index");
    }

[MetadataType(typeof(Source.MetaSource))]
public class Source
{
    private class MetaSource
    {
        [Required]
        public string Name { set; get; }
        [Required]
        public string Url { set; get; }
    }

    public int? ID { set; get; }
    public string Name { set; get; }
    public string Url { set; get; }

    public Source()
    {
        ID = null;
    } 
```

第二种方式 - 通过将验证字典传递给服务层来验证服务层中的对象，例如：

```
 [AcceptVerbs("POST")]
    public ActionResult Edit(Source src)
    {
        if (!_sourceService.ValidateSource(src)){           
            return View("EditSource", src);

        _sourceService.SaveSource(src);

        return RedirectToAction("Index");
    }

public bool ValidateSource(Source srcToValidate)
    {
        if (string.IsNullOrEmpty(srcToValidate.Name))
            _validationDictionary.AddError("Name", "Name is required.");
        else
            if (srcToValidate.Name.Trim().Length == 0)
                _validationDictionary.AddError("Name", "Name is required.");

        if (string.IsNullOrEmpty(srcToValidate.Url))
            _validationDictionary.AddError("Url", "Url is required.");
        else
            if (srcToValidate.Url.Trim().Length == 0)
                _validationDictionary.AddError("Url", "Url is required.");

        return _validationDictionary.IsValid;
    } 
```

我想创建客户端验证，并为验证错误添加本地化，​​我还需要创建自定义规则来调用数据库等。这两种方式的优缺点是什么，或者我需要选择另一种方式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T19:45:56.857

asp.net 网站针对三种情况提供了指导：

*   [使用服务层进行验证](http://www.asp.net/learn/mvc/tutorial-38-cs.aspx)
*   [简单验证](http://www.asp.net/learn/mvc/tutorial-36-cs.aspx)
*   [使用 IDataErrorInfo](http://www.asp.net/learn/mvc/tutorial-37-cs.aspx)

在做出任何决定之前，这些内容可能值得一读。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-25T20:31:58.110

绝对值得阅读各种选项 - 选择您认为最适合您的需求和风格的选项。

但是，您几乎可以肯定最终会在某个时候在您的服务上创建一个验证功能以应对业务规则，因此这可能是决胜局:-)

这里有一些额外的链接也可能有用：

*   [xVal 验证框架](http://xval.codeplex.com/)
*   [数据注释模型绑定示例](http://aspnet.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=24471)

# asp.net - 什么是基本的 ASP.NET 表单安全实践？

> ID：786651
> 
> 赞同：3
> 
> 时间：2009-04-24T16:38:14.267
> 
> 标签：asp.net, security, forms, sanitization

假设我有一个带有一些禁用复选框的表单，因为登录的用户不应该能够检查它们。我应该在哪里添加一些清理安全性以确保他们没有破解复选框并导致回发？

在页面中？数据库层？在数据库中？

我意识到这很可能是一个相当广泛的问题。

谢谢，马克

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T16:43:26.780

如果您确实需要使其安全，请在所有层上实施检查……至少，从数据库和数据访问层开始。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T16:48:11.980

我更喜欢尽可能让用户无法与之交互的东西完全不可见。你不能破解你看不到的东西（我不是说隐藏在页面上，我的意思是服务器不会为未登录用户看不到的东西生成代码）。

也就是说，假设您需要让控件可见但禁用，我会在前端和后端添加代码来进行检查。前端验证代码容易受到黑客攻击，但为使用系统的用户提供快速验证反馈是很好的 - 但是，后端应该是您真正的故障安全位置，以确保一切都符合预期并在提交更改之前进行最终检查。

不幸的是，这有时意味着您需要重复努力，但对于真正重要的东西，这是值得的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T16:39:04.420

ASP.NET 事件验证机制负责这一点。我想它从 2.0 开始就已经存在了。

# security - 漏洞利用案例研究

> ID：786656
> 
> 赞同：3
> 
> 时间：2009-04-24T16:38:46.917
> 
> 标签：security, buffer-overflow, exploit

我了解如何利用漏洞的总体思路。缓冲区溢出之类的东西，但我想我真的不*明白*。

是否有有用的信息来源可以很好地解释这一领域？也许是关于如何利用特定漏洞的案例研究？

更有趣的是您从事的项目如何遭受这些问题的困扰。

我并不是想了解我可以利用的当前存在的漏洞。我试图了解这个领域如何对我可能从事的任何项目产生影响。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T17:00:01.407

[iss.net](http://www.iss.net/security_center/advice/Underground/Hacking/Methods/default.htm)有关于不同漏洞利用示例的文章，主要解释如何保护您的系统。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-09-18T13:12:58.963

corelancoder 教程！必读 [https://www.corelan.be/index.php/2009/07/19/exploit-writing-tutorial-part-1-stack-based-overflows/](https://www.corelan.be/index.php/2009/07/19/exploit-writing-tutorial-part-1-stack-based-overflows/)

第 1 部分是 windows 上的单个 BOF，...，第 12 部分是 ROP。这很难，但第一个可以在一两天内完成，它应该让你真正感受到在编写漏洞利用时发现了哪些困难，以及哪些对策是无用/有用的。

这个领域的问题是，在你自己尝试之前还不清楚，但这需要时间。您还可以检查 Metasploit 以直接利用问题（以了解影响） - 您将找到要向目标发射的利用列表。如果您需要目标，请使用 Metasploitable [http://www.offensive-security.com/metasploit-unleashed/Requirements#Metasploitable](http://www.offensive-security.com/metasploit-unleashed/Requirements#Metasploitable)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-12-24T07:45:25.140

如果你想要现实生活中的实际例子，我完全推荐这本书 `"A Bug Hunter's Diary: A Guided Tour Through the Wilds of Software Security"`

这正是你想要的。它充满了几乎所有类型的漏洞利用的案例研究和现实生活中的例子，并从发现到完整编写一个有效的漏洞利用来解释它。

书中也有一些例子，`"The shellcoders handbook"`但没有`"The bug hunter's diary"`Also那么全面`"The shellcoders handbook"`，我只在需要时将其用作参考。

此外，有时我会不断阅读“ [http://www.exploit-db.com](http://www.exploit-db.com) ”中的漏洞利用，它对我帮助很大，但请记住，并非所有内容都可以教授，因此有时您需要根据您所拥有的和您所拥有的进行即兴创作一开始很难控制它，但是当漏洞利用运行并且你看到 calc.exe 时，它​​会让你感觉很棒 :)

当然 corlan 教程和其他教程是了解基本知识的必要条件，但它们只教你基本概念，你必须看到一些现实生活中的利用才能真正理解可能性。

# asp.net - 使用 ASPNet_Regiis 加密自定义配置部分 - 你能做到吗？

> ID：786661
> 
> 赞同：36
> 
> 时间：2009-04-24T16:39:16.790
> 
> 标签：asp.net, encryption, web-config, aspnet-regiis.exe, system.configuration

我有一个带有自定义配置部分的 Web 应用程序。该部分包含我想加密的信息（希望使用 ASPNet_RegIIS 而不是自己做）。

网络配置：

```
<?xml version="1.0"?>

    <configuration xmlns="http://schemas.microsoft.com/.NetConfiguration/v2.0">
      <configSections>
          <section name="MyCustomSection" 
                   type="MyNamespace.MyCustomSectionHandler, MyAssembly"/>
    </configSections>
<configProtectedData>
    <providers>
      <clear />
      <add name="DataProtectionConfigurationProvider"
           type="System.Configuration.RsaProtectedConfigurationProvider, System.Configuration, Version=2.0.0.0,
                   Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a,
                   processorArchitecture=MSIL"
           keyContainerName="MyKeyContainer"
           useMachineContainer="true" />
    </providers>
  </configProtectedData>
    <MyCustomSection>
       <blah name="blah1">
          <blahChild name="blah1Child1" />
       </blah>
    </MyCustomSection> 
```

配置处理程序在尝试加密之前工作得很好。当我尝试使用以下方法对其进行加密时：

> aspnet_regiis -pef "MyCustomSection" c:\inetpub\wwwroot\MyWebsite -prov DataProtectionConfigurationProvider

我收到一个错误：

> 加密配置部分...为 MyCustomSection 创建配置部分处理程序时出错：无法加载文件或程序集“MyAssembly”或其依赖项之一。该系统找不到指定的文件。（c:\inetpub\wwwroot\MyWebsite\web.config 第 5 行）

我尝试过配置/不配置提供程序。有/无部分组。有/没有事先启动网站。我已经尝试暂时将我的程序集放在 GAC 中进行注册。我还尝试了我的 log4net 部分，只是为了尝试不属于我的东西，但没有运气。我以管理员身份运行命令提示符。有任何想法吗？或者 ASPNet_RegIIS 不能用于自定义部分？

[查看MSDN](http://msdn.microsoft.com/en-us/library/system.configuration.iconfigurationsectionhandler.aspx)后的最后一个镜头是将我的处理程序更改为从 ConfigurationSection 继承而不是实现 IConfigurationSectionHandler，因为它在 2.0 中技术上已弃用（希望它与 aspnet_regiis 版本有关）。那里也没有运气。

任何想法让我知道。谢谢！

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2011-06-15T20:02:46.233

`aspnet_regiis`必须能够绑定程序集。正常的 .net 绑定规则适用。

我通过创建`aspnet_regiis_bin`在同一目录中 调用的目录`aspnet_regiis.exe`和一个具有如下私有路径的`aspnet_regiis.exe.config`文件来解决此问题：`aspnet_regiis_bin`

```
<configuration>
   <runtime>
      <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
         <probing privatePath="aspnet_regiis_bin"/>
      </assemblyBinding>
   </runtime>
</configuration> 
```

然后，我将定义自定义配置部分的程序集复制到其中，`aspnet_regiis_bin`以便`aspnet_regiis`可以找到它们。

此过程不要求程序集是强命名的或在 GAC 中，但确实需要在框架目录中搞乱。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2013-07-19T01:29:21.420

我正在使用一种解决方法，我暂时注释掉 configSections 元素的内容：

```
<configSection>
    <!--
    <section name="CustomSection" type="" />
    -->
</configSection> 
```

`aspnet_regiis -pef`然后，您可以照常运行加密。运行后，只需取消注释该部分，您的站点就可以运行了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-24T17:21:40.463

这是一个彻底的黑客，但我不确定是否有另一种方法可以做到这一点，而无需强烈命名定义您的自定义部分的程序集并对其进行 GAC 化（尽管您提到这也不起作用，而且我不确定为什么它不会）。由于aspnet_regiis运行在<驱动器>:\Windows\Microsoft.Net\Framework\<版本>文件夹（在WinXP中），你可以将定义你的配置部分的DLL复制到相关的Framework\<版本>文件夹中，然后应该管用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-07-19T12:16:38.150

作为记录，我最终得到了一个小的维护页面来为我做这件事。

```
var currentConfig = System.Web.Configuration.WebConfigurationManager.OpenWebConfiguration("~/");
// Unprotect
ConfigurationSection section = currentConfig.GetSection("MyCustomSection");
if (section.SectionInformation.IsProtected)
{
   section.SectionInformation.UnprotectSection();
   currentConfig.Save();
}

// Protect
if (!section.SectionInformation.IsProtected)
{
     section.SectionInformation.ProtectSection("DataProtectionConfigurationProvider");
     currentConfig.Save();
} 
```

注意事项：您的进程将需要对正在修改的配置文件的写入权限。您需要某种方式来授权谁可以运行它。[保存时通常](https://stackoverflow.com/a/2155154/1907 "您可以修改 web.config 并且不重新启动 ASP.NET 应用程序吗？ [复制]")会重新启动网站。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-01-23T20:04:00.840

显示为正确的答案是正确的。我想添加评论，但由于评论太长（示例配置条目）无法添加。

部分名称应使用程序集的全名。运行时程序集限定不适用于 aspnet_regiis.exe。

这工作：

```
<configSections>
  <section name="securityConfiguration" type="Microsoft.Practices.EnterpriseLibrary.Security.Configuration.SecuritySettings, Microsoft.Practices.EnterpriseLibrary.Security, Version=5.0.414.0, Culture=neutral, PublicKeyToken=9c844884b2afcb9e" />
</configSections> 
```

但这不起作用：

```
<configSections>
  <section name="securityConfiguration" type="Microsoft.Practices.EnterpriseLibrary.Security.Configuration.SecuritySettings, Microsoft.Practices.EnterpriseLibrary.Security" />
</configSections>

<runtime>
  <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
     <qualifyAssembly partialName="Microsoft.Practices.EnterpriseLibrary.Security" fullName="Microsoft.Practices.EnterpriseLibrary.Security, Version=5.0.414.0, Culture=neutral, PublicKeyToken=9c844884b2afcb9e" />
    </assemblyBinding>
</runtime> 
```

# sharepoint - 列表模板所有者

> ID：786662
> 
> 赞同：5
> 
> 时间：2009-04-24T16:39:18.007
> 
> 标签：sharepoint, moss, wss, sharepoint-2007, wss-3.0

我会保持简短和甜蜜。有谁真的知道elements.xml 的**“Receivers”**节点的**“ListTemplateOwner”**标签的真正含义？

 **从微软的网站： http: [//msdn.microsoft.com/en-us/library/ms431081 (loband).aspx](http://msdn.microsoft.com/en-us/library/ms431081(loband).aspx)

> ListTemplateOwner：可选文本。***如果列表模板是通过 Features 注册的，则指定列表模板所有者的 GUID；如果列表模板是通过***站点定义注册的，则指定站点定义的名称。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T20:35:31.340

如果列表由 Feature 中的 ListTemplate 定义，则**ListTemplateOwner 是定义列表的特征的 ID**。

当您引用任何标准列表（ListTemplateId < 10000）时，您不需要指定 ListTemplateOwner（由于向后兼容）

当您引用由您或第三方定义的列表时，您需要 ListTemplateId (> 10000 并匹配定义 ListTemplate 的 Type 属性) 和 ListTemplateOwner 的组合，以匹配定义 ListTemplate 的功能的 FeatureId。

这是因为当您定义 ListTemplate 时，规则是 Type 应该 > 10000 并且在功能内部是唯一的，但是任何数量的功能都可能有自己的 ListTemplate 类型为 10001（并且定义列表的功能通常只是从10001)

如果列表由站点定义中的 ListTemplate 定义，则**ListTemplateOwner 是该站点定义的名称**，但不在站点定义中定义列表，请在功能中执行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-04T08:40:07.287

这是不正确的，当设置为包含列表类型的列表定义的当前特征时，特征 ID 不能正确地定位接收者......

```
<ListTemplate
    Name="SomeList"
    Type="99002"
    BaseType="0"
    OnQuickLaunch="TRUE"
    SecurityBits="11"
    Sequence="410"
    DisplayName="Some List"
    Description="Custom List used for whatnot"
    Image="/_layouts/images/itgen.gif"/>

<Receivers ListTemplateId="99002" ListTemplateOwner="B1E4631D-52A1-48d0-A319-2DDC2893AA57"> 
```

你需要做的是给每个列表模板一个唯一的 ID，不管拥有的特性是什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T16:44:05.140

我猜它指的是拥有列表模板的 SharePoint 对象的 ID (GUID)。把它想象成数据库的 ID 列，这就是它的外键。

# ruby - 创建按需打印质量的 PDF（如果可行，最好使用 Ruby）

> ID：786670
> 
> 赞同：1
> 
> 时间：2009-04-24T16:42:22.900
> 
> 标签：ruby, pdf, pdf-generation

**主要问题**

您在 Linux 服务器上的应用程序中创建按需、类似报纸（如“使用高级布局或排​​版”）PDF 的快速可靠（如“稳定”）解决方案是什么？

因此：不，HTML2PDF 不是我正在寻找的解决方案。;-)

* * *

**奖金问题**

如果它不是基于 Ruby 的：有没有办法让你的解决方案脱离 Rails 应用程序？最好通过网络服务或某物-2-Ruby-bridge-kind-of-thing？

非常感谢您的建议！

**更新**

有一个[类似的问题](https://stackoverflow.com/questions/780932)，那里建议的[rtex gem](http://github.com/bruce/rtex/tree/master)看起来像我正在寻找的东西。如果有其他建议，我将不回答这个问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T16:46:10.253

排版好难。

如果你找不到 ruby​​ 排版库，你可能想看看运行一个后台 pdflatex。LaTeX 源代码很容易以编程方式生成。

这个想法有多有用将取决于您的文档有多复杂，以及您对输出质量的关心程度。如果您只有简单的文本，并且只想要比 html 更好的东西，那么您可能有更多选择。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T16:47:15.103

[Prawn](http://prawn.majesticseacreature.com/)是为这类东西设计的，目前正在开发中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T18:11:46.927

使用 php，我对 FPDF 非常幸运。我每天都会用它生成几千份高质量的报告。从不错过任何一个节拍，而且速度非常快。随着 php 在网络服务器上运行，我认为设置 ruby​​ 向 php 页面提供生成所需的数据然后 ruby​​ 获取结果并不难。

编辑：看起来Ruby有一个端口。 [http://zeropluszero.com/software/fpdf/](http://zeropluszero.com/software/fpdf/)

# c# - 在c#中每x秒执行一次操作y分钟

> ID：786672
> 
> 赞同：10
> 
> 时间：2009-04-24T16:42:58.763
> 
> 标签：c#, timer

我需要每 5 秒运行一次函数，持续 10 分钟。

我使用计时器将其运行 5 秒，但如何将计时器限制为仅 10 分钟？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-24T21:14:20.810

只需从 elapsed 处理程序中捕获您想要停止的时间并结束您的计时器。这是一个示例（注意：我使用了`System.Threading.Timer` `timer`. 为您正在做的事情选择适当的计时器。例如，`System.Windows.Forms.Timer`如果您在 Winforms 中编写，您可能会在 a 之后。）

```
public class MyClass
{
    System.Threading.Timer Timer;
    System.DateTime StopTime;
    public void Run()
    {
        StopTime = System.DateTime.Now.AddMinutes(10);
        Timer = new System.Threading.Timer(TimerCallback, null, 0, 5000);
    }

    private void TimerCallback(object state)
    {
        if(System.DateTime.Now >= StopTime)
        {
            Timer.Dispose();
            return;
        }
        // Do your work...
    }
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-24T16:47:30.313

让你的计时器循环如下：

```
DateTime endTime = DateTime.Now.AddMinutes(10);

while(endTime < DateTime.Now)
{
  // Process loop
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-24T16:46:33.420

将 Y 分钟除以 X 间隔即可得到它需要运行的次数。之后，您只需要计算该函数被调用了多少次。

在您的情况下，需要 10 分钟 = 600 秒 / 5 秒 = 120 次通话。只要有一个计数器来记录你的函数被调用了多少次。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-24T16:44:55.530

`Timer.Stop()`在 120 个刻度之后。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-24T16:46:07.397

只需使用 DateTime 变量来跟踪它应该何时结束并在开始之前设置它。在您的 Elapsed 事件处理程序上，检查信号时间是否小于结束时间。如果不是，请停止计时器。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-24T16:46:26.913

您可以计算您的函数将被调用的次数，并创建递减计数器，在您取消订阅计时器滴答之后。或者您可以运行另一个具有滴答周期的计时器 - 10 分钟，并在滴答时取消订阅计时器滴答调用您的函数。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-24T21:24:34.593

您可以使用第二个计时器：

```
class Program
{
    static void Main(string[] args)
    {
        int interval = 5 * 1000; //milliseconds
        int duration = 10 * 60 * 1000; //milliseconds

        intervalTimer = new System.Timers.Timer(interval);
        durationTimer = new System.Timers.Timer(duration);

        intervalTimer.Elapsed += new System.Timers.ElapsedEventHandler(intervalTimer_Elapsed);
        durationTimer.Elapsed += new System.Timers.ElapsedEventHandler(durationTimer_Elapsed);

        intervalTimer.Start();
        durationTimer.Start();
    }

    static void durationTimer_Elapsed(object sender, System.Timers.ElapsedEventArgs e)
    {
        intervalTimer.Stop();
        durationTimer.Stop();
    }

    static void intervalTimer_Elapsed(object sender, System.Timers.ElapsedEventArgs e)
    {
        //call your method
    }

    private static System.Timers.Timer intervalTimer;
    private static System.Timers.Timer durationTimer;
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-24T16:45:28.070

注意开始时间。在每次通话中，测试 currentTime + 5 seconds > startTime + 10 minutes。如果是这样，请禁用计时器。

我更喜欢这种只运行 N 个滴答声的方法，因为定时器不能保证在您希望它们触发时触发。120 个滴答声可能会超过 10 分钟的真实世界时间。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-24T17:08:20.933

您可以设置两个计时器，一个运行 5 秒，另一个运行 10 分钟，然后禁用第一个

# c# - 使用反射调用静态方法时如何通过 ref 传递参数？

> ID：786679
> 
> 赞同：12
> 
> 时间：2009-04-24T16:44:28.603
> 
> 标签：c#, .net, reflection

我正在使用反射在对象上调用静态方法：

```
MyType.GetMethod("MyMethod", BindingFlags.Static).Invoke(null, new object[] { Parameter1, Parameter2 }); 
```

您如何通过 ref 传递参数，而不是通过值传递参数？我认为默认情况下它们是按价值计算的。第一个参数（数组中的“Parameter1”）应该是 ref，但我不知道如何以这种方式传递它。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-24T16:47:09.423

对于引用参数（或 C# 中的 out），反射会将新值复制到对象数组中与原始参数相同的位置。您可以访问该值以查看更改的引用。

```
public class Example {
  public static void Foo(ref string name) {
    name = "foo";
  }
  public static void Test() {
    var p = new object[1];
    var info = typeof(Example).GetMethod("Foo");
    info.Invoke(null, p);
    var returned = (string)(p[0]);  // will be "foo"
  }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T16:57:42.130

如果您调用`Type.GetMethod`并使用`BindingFlag`just `BindingFlags.Static`，它将找不到您的方法。删除标志或添加`BindingFlags.Public`，它将找到静态方法。

```
public Test { public static void TestMethod(int num, ref string str) { } }

typeof(Test).GetMethod("TestMethod"); // works
typeof(Test).GetMethod("TestMethod", BindingFlags.Static); // doesn't work
typeof(Test).GetMethod("TestMethod", BindingFlags.Static
                                     | BindingFlags.Public); // works 
```

# asp.net-mvc - 带有数组的 MVC 强类型视图数据

> ID：786687
> 
> 赞同：1
> 
> 时间：2009-04-24T16:45:52.080
> 
> 标签：asp.net-mvc, viewdata

我有一个使用强类型 ViewData 的视图，类似于：

```
namespace Site.web2.Models
{
    public class MySubData
    {
        public string Note { get; set; }
        public bool IsValid { get; set; }
    }
    public class MyViewData
    {
        public int DataId { get; set;}
        public List<MySubData> SubData { get; set; }

        public MyViewData()
        {
        }

        public void LoadDummyData()
        {
            DataId = 42;
            SubData = new List<MySubData>();
            SubData.Add(new MySubData() { Note = "Item 1" });
            SubData.Add(new MySubData() { Note = "Item 2" });
        }
    }
} 
```

控制器：

```
[AcceptVerbs(HttpVerbs.Get)]
public ActionResult Test1()
{
    Site.web2.Models.MyViewData data = new Site.web2.Models.MyViewData();
    data.LoadDummyData();
    return View(data);
}

[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Test1(Site.web2.Models.MyViewData data)
{
    return RedirectToAction("Index");
} 
```

视图是这样的：

```
<%@ Page Title="" Language="C#" MasterPageFile="~/Content/Site.Master"
     Inherits="System.Web.Mvc.ViewPage<Site.web2.Models.MyViewData>"
%>
<%= Html.BeginForm<HomeController>(c => c.Test1(null)) %>
<p>Id:</p>
<p><%= Html.TextBox("DataId")%></p>
<p>Note 1:</p>
<p><%= Html.TextBox("SubData[0].Note")%></p>
<p>Note 2:</p>
<p><%= Html.TextBox("SubData[1].Note")%></p>

<input type="submit" value="Submit" />
<% Html.EndForm(); %> 
```

好的，如果我创建一个 MyViewData，调用 LoadDummyData()，并在视图中使用它，我在 TextBoxes 中看不到我的数据。

有趣的是，如果我在 TextBoxes 中输入数据，它将被填充到 Post 控制器中返回的 MyViewData 中。

我究竟做错了什么？这在更高版本的 MVC 中修复了吗？我想我有 RC 1。

基思

**更新 1**

这

```
<%= Html.TextBox("DataId")%> 
```

工作得很好。我想我的问题是，这应该

```
<%= Html.TextBox("SubData[0].Note")%> 
```

以同样的方式工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T17:06:35.803

试试这个：

```
<p>Id:</p>
<p><%= Html.TextBox("DataId", Model.DataId)%></p>
<p>Note 1:</p>
<p><%= Html.TextBox("SubData[0].Note", Model.SubData[0].Note)%></p>
<p>Note 2:</p>
<p><%= Html.TextBox("SubData[1].Note", Model.SubData[1].Note)%></p> 
```

# python - Python中有Vector3类型吗？

> ID：786691
> 
> 赞同：6
> 
> 时间：2009-04-24T16:46:17.880
> 
> 标签：python, vector

我很快检查了 numPy，但它看起来像使用数组作为向量？我正在寻找可以实例化和处理的合适的 Vector3 类型。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T17:44:07.650

[ScientificPython](http://dirac.cnrs-orleans.fr/plone/software/scientificpython/)有一个[Vector](http://dirac.cnrs-orleans.fr/ScientificPython/ScientificPythonManual/Scientific.Geometry.Vector-class.html)类。例如：

```
In [1]: from Scientific.Geometry import Vector
In [2]: v1 = Vector(1, 2, 3)
In [3]: v2 = Vector(0, 8, 2)               
In [4]: v1.cross(v2)
Out[4]: Vector(-20.000000,-2.000000,8.000000)
In [5]: v1.normal()
Out[5]: Vector(0.267261,0.534522,0.801784)
In [6]: v2.cross(v1)
Out[6]: Vector(20.000000,2.000000,-8.000000)
In [7]: v1*v2 # dot product
Out[7]: 22.0 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T17:01:46.940

我不相信有任何标准（但我可能是错的，我没有跟上 python 的步伐）。

不过它很容易实现，而且您可能希望在 numpy 数组之上构建它作为它的容器，这为您提供了很多好的（和高效的）点点滴滴。

# sql-server-2005 - 如何创建一个接受查询字符串并返回查询结果集的 UDF

> ID：786698
> 
> 赞同：0
> 
> 时间：2009-04-24T16:46:58.910
> 
> 标签：sql-server-2005, stored-procedures, exec, user-defined-functions

我想创建一个存储过程，它采用简单的 SELECT 语句并将结果集作为 CSV 字符串返回。所以基本思想是从用户输入中获取 sql 语句，使用 EXEC(@stmt) 运行它并使用游标将结果集转换为文本。但是，由于 SQLServer 不允许：

*   从存储过程中选择 *（@sqlStmt）
*   带有 EXEC 的 UDF（@sqlStmt）

所以我尝试插入#tempTable EXEC（@sqlStmt），但这不起作用（错误=“无效的对象名称#tempTable”）。

我被困住了。您能否对此事有所了解？

非常感谢

**编辑：**

实际上输出（例如 CSV 字符串）并不重要。问题是我不知道如何将游标分配给 EXEC 返回的结果集。SP 和 UDF 不能与 Exec() 一起使用，而在不知道输入语句的情况下，在插入值之前创建临时表是不可能的。

我想到了 OPENQUERY，但它不接受变量作为其参数。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T16:51:22.707

在插入之前，您需要创建与存储过程返回的列相同的临时表。

但是，输出到 CSV 听起来并不是特别适合 SQL 的工作。您是否仅限于使用存储过程，或者您可以编写脚本或程序来获取结果并存储在 CSV 中？这可能是一种整体上更容易的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-19T12:36:52.607

如果我没记错的话，您需要一个接受 SELECT 语句并返回结果的存储过程，可选为 CSV。

所以 EXEC prExecute 'select * from tablea' 是你想要调用的？那是相当东方：

```
CREATE PROC prExecute ( @sql varchar(2000))
AS
    EXEC (@sql);
GO 
```

但我不明白这里需要光标。

# file - .ccf CommView 文件格式

> ID：786701
> 
> 赞同：1
> 
> 时间：2009-04-24T16:47:18.660
> 
> 标签：file

我需要做一个能够转储 CommView .ccf 文件内容的小型应用程序。

有谁知道这种文件类型的格式？

内容是否被破坏或加密？

任何帮助都会很有用：D

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T17:22:11.897

[看看这个](http://aluigi.altervista.org/papers/ncf2cap.zip)，它是从 NCF 或 CCF 文件到 Wireshark 使用的 CAP 格式的转换器。源代码包含在可执行文件中，因此应该可以让您深入了解格式的结构。

# c# - 无法在 C# 中通过 http 流式传输 Jpegs 图像

> ID：786703
> 
> 赞同：0
> 
> 时间：2009-04-24T16:47:37.287
> 
> 标签：c#, http, stream, jpeg, vlc

我有一个 Jpegs 图像流，我正在尝试使用 HTTP 将它们流式传输到 VLC

如果代码如下：

```
 public HttpListenerResponse StartListening(String where)
    {
        listener = new HttpListener();
        listener.Start();
        Console.WriteLine("listening on " + where);
        listener.Prefixes.Add(where);
        HttpListenerContext context = listener.GetContext();
        HttpListenerRequest request = context.Request;
        // Obtain a response object.
        HttpListenerResponse response = context.Response;
        return response;
    }
public void StartStream()
    {
        HttpListenerResponse response = StartListening("http://localhost:8080/");
        MemoryStream mem = null;

        for (;;)
        {
            Bitmap b = generateBitmap();
            //pictureBox1.Image = frm.GetFormImage();
            byte[] ar = BitmapToArray(b);

            // Construct a response.
            byte[] buffer = ar;
            response.ContentType = "multipart/x-mixed-replace; boundary=--testboundary";
            ASCIIEncoding ae = new ASCIIEncoding();
            byte[] boundary = ae.GetBytes("\r\n--testboundary\r\nContent-Type: image/jpeg\r\nContent-Length:" + buffer.Length + "\r\n\r\n");
            mem = new MemoryStream(boundary);
            mem.WriteTo(response.OutputStream);
            mem = new MemoryStream(buffer);
            mem.WriteTo(response.OutputStream);
        }   
        mem.Close();
        listener.Stop();    

    } 
```

出于某种原因，如果我尝试在 Firefox 中打开流，它会返回全黑，如果我尝试使用 VLC 打开它，我会得到“无法打开流”

如果我只流式传输 1 个图像，Firefox 处理它没有问题。

提前谢谢，何塞

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-13T03:29:06.367

您可以尝试一个多部分范围请求。VLC 可能正在请求“块”中的数据，但您的 HTTPHandler 没有提供该功能。下面是一些（冗长的）示例代码。尝试将音乐流式传输到我的 iPod Touch 时，我遇到了类似的问题。像浏览器中的魅力一样工作，但不适用于 Touch。事实证明，iPod 通过多个请求向我的处理程序请求 byte[] 块，但处理程序没有实现它需要的功能。

我在这里混合了一些我自己的库类，但你会很好地理解图片。

```
public abstract class MultipartRangeHandler : IHttpHandler
{
    protected const String HEADER_RANGE = "range";
    protected const String HEADER_CONTENT_TYPE = "Content-Type";
    protected const String HEADER_CONTENT_LENGTH = "Content-Length: ";
    protected const String HEADER_CONTENT_DISPOSITION = "Content-Disposition";
    protected const String HEADER_CONTENT_RANGE = "Content-Range";
    protected const String HEADER_BOUNDARY_DELIMETER = "--";
    protected const String HEADER_STATUS_PARTIAL_CONTENT = "Partial Content";

    private const char COMMA = ',';
    private const char EQUALS = '=';
    private const char NEW_LINE = '\n';

    protected const String QS_OBJECT_ID = "cid";

    public void ProcessRequest(HttpContext context)
    {
        if (StringUtils.isNullOrEmpty(context.Request.QueryString[QS_OBJECT_ID]))
        {
            sendResponse(400, "400 Bad Request", "No resource was specified in the query string to retrieve.", context);
        }
        else
        {
            ContentItem contentItem = getContentItem(context.Request.QueryString[QS_OBJECT_ID]);

            if (contentItem != null)
            {
                context.Response.Clear();
                context.Response.ClearHeaders();
                context.Response.ClearContent();

                if (context.Request.Headers[HEADER_RANGE] != null)
                {

                    string range = context.Request.Headers[HEADER_RANGE];
                    range = range.Substring(range.LastIndexOf(EQUALS) + 1);
                    bool isMultipartRange = range.Contains(COMMA.ToString());

                    if (!isMultipartRange)
                    {
                        addHeader(context.Response, HEADER_CONTENT_TYPE, contentItem.MimeType);
                        addHeader(context.Response, HEADER_CONTENT_DISPOSITION, "inline; filename=\"" + contentItem.Filename + "\"");

                        string[] startEnd = range.Split('-');

                        long startPos;

                        long.TryParse(startEnd[0], out startPos);

                        long endPos;
                        int fileSize = contentItem.FileBytes.Length;

                        if (startEnd.GetUpperBound(0) >= 1 && startEnd[1] != String.Empty)
                        {
                            long.TryParse(startEnd[1], out endPos);
                        }
                        else
                        {
                            endPos = fileSize - startPos;
                        }

                        if (endPos > fileSize)
                        {
                            endPos = fileSize - startPos;
                        }

                        context.Response.StatusCode = 206;
                        context.Response.StatusDescription = HEADER_STATUS_PARTIAL_CONTENT;
                        addHeader(context.Response, HEADER_CONTENT_RANGE, "bytes " + startPos + "-" + endPos + "/" + fileSize);

                        context.Response.BinaryWrite(ByteUtils.subByte(contentItem.FileBytes, (int)startPos, (int)(endPos - startPos) + 1));
                    }
                    else
                    {

                        string boundary = "waynehartmanansmach";
                        addHeader(context.Response, HEADER_CONTENT_TYPE, "multipart/byteranges; boundary=" + boundary);

                        List<string[]> ranges = new List<string[]>();
                        string[] multiRange = range.Split(new string[] { "," }, StringSplitOptions.RemoveEmptyEntries);
                        foreach (string mr in multiRange)
                        {
                            ranges.Add(mr.Split(new string[] { "-" }, StringSplitOptions.RemoveEmptyEntries));
                        }

                        //  process the list of ranges
                        foreach (string[] rangeArray in ranges.ToArray())
                        {
                            context.Response.Write(HEADER_BOUNDARY_DELIMETER + boundary + NEW_LINE);
                            context.Response.Write(HEADER_CONTENT_TYPE + ": " + contentItem.MimeType + NEW_LINE);
                            context.Response.Write(HEADER_CONTENT_RANGE + ": bytes " + rangeArray[0] + "-" + rangeArray[1] + "/" + contentItem.FileBytes + NEW_LINE + NEW_LINE);
                            long startPos = long.Parse(rangeArray[0]);
                            long endPos = long.Parse(rangeArray[1]);

                            context.Response.BinaryWrite(ByteUtils.subByte(contentItem.FileBytes, (int)startPos, (int)(endPos - startPos) + 1));

                            context.Response.Write(NEW_LINE);
                            context.Response.Flush();
                        }

                        context.Response.Write(HEADER_BOUNDARY_DELIMETER + boundary + HEADER_BOUNDARY_DELIMETER + NEW_LINE + NEW_LINE);
                    }
                }
                else
                {
                    context.Response.ContentType = contentItem.MimeType;
                    addHeader(context.Response, HEADER_CONTENT_DISPOSITION, "attachment; filename=\"" + contentItem.Filename + "\"");
                    addHeader(context.Response, HEADER_CONTENT_LENGTH, contentItem.FileBytes.Length.ToString());

                    context.Response.OutputStream.Write(contentItem.FileBytes, 0, contentItem.FileBytes.Length);
                }
            }
            else
            {
                sendResponse(404, "404 Not Found", "The resource requested does not exist.", context);                    
            }
        }
    }

    private void sendResponse(int statusCode, String status, String statusMessage, HttpContext context)
    {
        System.Text.StringBuilder data = new System.Text.StringBuilder();

        data.AppendLine("<html><body>");
        data.AppendLine("<h1>"+status+"</h1>");
        data.AppendLine("<p>"+statusMessage+"</p>");
        data.AppendLine("</body></html>");

        byte[] headerData = System.Text.Encoding.ASCII.GetBytes(data.ToString());

        context.Response.ContentType = "text/html";
        context.Response.StatusCode = statusCode;
        context.Response.Status = status;

        addHeader(context.Response, HEADER_CONTENT_LENGTH, headerData.Length.ToString());

        //context.Response.AddHeader("Content-Length: ", headerData.Length.ToString());
        context.Response.OutputStream.Write(headerData, 0, headerData.Length);
        context.Response.End();
    }

    protected void addHeader(HttpResponse response, String key, String value)
    {
        response.AddHeader(key, value);
    }

    protected abstract com.waynehartman.util.web.handlers.multipartrange.ContentItem getContentItem(String objectID);

    public bool IsReusable
    {
        get { return true; }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T17:56:15.077

设置您的前缀，*然后*调用`Start()`.

从我在代码和其他地方看到的情况来看，您无法使用 HttpListener 流式传输数据。您可能必须将请求转发到另一个写回数据的本地 TCP 套接字。

# c# - 为什么没有没有参数的 IsNullOrEmpty 重载方法？

> ID：786706
> 
> 赞同：7
> 
> 时间：2009-04-24T16:48:25.130
> 
> 标签：c#

当试图确定一个字符串是空还是空时，我通常已经有了这个字符串。这就是为什么我希望像 String.IsNullOrEmpty() 这样的实用程序函数可以在没有参数的情况下工作：

```
String myString;
bool test=myString.IsNullOrEmpty(); 
```

但是，这不起作用，因为 IsNullOrEmpty 需要一个 String 参数。相反，我必须写：

```
String myString;
bool test=String.IsNullOrEmpty(myString); 
```

为什么会这样？它似乎不必要地笨重。当然我可以很容易地为此编写自己的扩展方法，但这似乎是一个非常明显的遗漏，所以我想知道这是否有什么好的理由。我不敢相信这个函数的无参数重载刚刚被微软遗忘了。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-24T16:50:23.770

如果 String 是`null`，调用`IsNullOrEmpty()`会导致`NullReferenceException`.

```
 String test = null;

 test.IsNullOrEmpty(); // Instance method causes NullReferenceException 
```

现在我们有了扩展方法，我们可以用扩展方法来实现它并避免异常。但请记住，这仅适用于扩展方法只不过是静态方法的语法糖。

```
public static class StringExtension
{
   public static Boolean IsNullOrEmpty(this String text)
   {
      return String.IsNullOrEmpty(text);
   }
} 
```

使用此扩展方法，以下将永远不会引发异常

```
 String test = null;

 test.IsNullOrEmpty(); // Extension method causes no NullReferenceException 
```

因为这只是语法糖。

```
 StringExtension.IsNullOrEmpty(test); 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-04-24T16:50:09.993

这个方法早在扩展方法被添加到 C# 之前就已经存在了，在扩展方法之前，没有办法定义实例方法/属性，例如`xyz.IsNullOrEmpty()`你仍然可以调用 if `xyz`is `null`。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-24T16:50:26.467

在 C# 3.0 和扩展方法之前，无法调用空对象的方法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-24T16:50:43.550

没有实例方法的原因是因为如果字符串确实为空， myString.IsNullOrEmpty 会抛出。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-24T17:15:26.563

我创建了一个扩展方法——IsNothing——它不仅会检查它是空还是空，而且只包含空格。

```
public static bool IsNothing( this string source )
{
    if (source == null || source.Length == 0)
    {
        return true;
    }
    else if (source.Trim().Length == 0)
    {
        return true;
    }
    return false;
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-24T17:48:37.403

虽然完全有可能（并且有效）定义扩展方法来实现这一点，但我担心它在语法上看起来很奇怪，因为它*似乎*是对可能为空的对象的方法调用。

YMMV，但我会坚持使用`String.IsNullOrEmpty`.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-24T17:00:53.900

您可以在 C# 3.0 中实现这一点：

```
public static class StringExtensions
{
    public static bool IsNullOrEmpty(this string value)
    {
        return string.IsNullOrEmpty(value);
    }
} 
```

然后，这将起作用：

```
test.IsNullOrEmpty(); 
```

**但**

重要的是要知道许多人认为这是不好的做法。这是因为它违背了用户的期望。请谨慎使用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-24T17:32:47.800

如果您正在添加扩展方法或辅助方法来测试您的字符串，您可能还想添加一个修剪字符串的方法，而且我们大多数人在许多情况下也不想要有空格的字符串，例如制表符或空格。

这是我们的一种测试方法

public static bool IsTrimStringNullOrEmpty(string value)
{
    if(value == null) return true;
    if(value.Trim() == string.Empty) 返回真；
    返回假；
}

或者

如果您想测试该值并在 NotNullOrEmpty 的情况下同时对其进行修剪

public static bool IsTrimStringNullOrEmpty(ref string value)
{
    if(value == null) return true;
    价值=价值。修剪（）；
    if(value == string.Empty) 返回真；
    返回假；
}

# java - 如何检查 Jar 文件之间的依赖关系？

> ID：786708
> 
> 赞同：29
> 
> 时间：2009-04-24T16:48:51.400
> 
> 标签：java, jar, dependencies, redundancy

我最近接受了用 JSF 编写的 Web 系统的支持和编程。代码有点凌乱和冗余，是的，​​不存在文档。

系统有 40 多个 jar 库，其中大部分是由于旧版本和测试的冗余。要删除一个 jar，我必须检查它没有在代码中导入，所以我在代码中搜索了 jar 导入路径（我使用的是 IntelliJ IDE），确保它没有被使用，然后将其删除。

但是，在编译代码后，在测试过程中出现了一些运行时错误。我发现我删除了一些其他现有罐子使用的罐子。

问题是，在删除一个 jar 之前，我如何确保它没有被另一个 jar/java 类使用？

尽管 jars 已经编译了类，但编译后的类*确实*具有所需库的导入路径。但我不能用 IntelliJ 搜索它们（不在 jars 文件中搜索）。

我现在做的唯一方法是每次删除 jar 时测试系统，看看我是否可以让它崩溃！由于要测试的功能数量庞大，这完全不是一个简单的方法。

我希望有一个工具可以提交许多 java 文件/jar，并显示它们之间的依赖关系。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-24T16:53:43.010

我知道 JBoss 项目中有一个名为 JBoss TattleTale 的工具，可能值得一看：

[http://www.jboss.org/tattletale](http://www.jboss.org/tattletale)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-24T17:08:55.410

[JDepend](http://clarkware.com/software/JDepend.html)将为您分析任意数量的 JAR、类文件等的依赖关系。将它报告的包与这些 JAR 相关联应该是一个微不足道的额外步骤。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T16:53:16.150

为什么不将 Maven 用于您的项目？这将帮助您管理依赖项。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-17T08:20:05.157

我还找到[了 JarAnalyzer](http://www.kirkk.com/main/Main/JarAnalyzer)，但它似乎不再维护了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-09-26T02:39:56.190

嗯，现在是 2013 年，所以我不确定这个工具在 2009 年是否很棒。刚刚使用它，发现它很有用： **Class Dependency Analyzer** (CDA) (V1.14) [http://www.dependency- Analyzer.org/](http://www.dependency-analyzer.org/) 这个工具有一个图形用户界面（Swing？）。添加 lib jar 和 Java 类后，它将显示 Class/Package/Container(jar) 级别的依赖关系。它也可以显示家属。所以很容易找到依赖的jar和依赖的jar。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-24T18:15:01.663

还有来自 Jini SDK 的 ClassDep。

[http://java.sun.com/products/jini/2.0/doc/api/com/sun/jini/tool/ClassDep.html](http://java.sun.com/products/jini/2.0/doc/api/com/sun/jini/tool/ClassDep.html)

# iis-7 - IIS7 以编程方式获取位置节点

> ID：786709
> 
> 赞同：0
> 
> 时间：2009-04-24T16:48:59.497
> 
> 标签：iis-7

我需要设置 IIS 站点的身份验证。我看到您可以执行 .GetLocationPaths() 并返回位置的字符串数组。但我需要进入他们的子元素。

这些`<location>`元素未嵌套在 system.applicationHost 或 system.webServer 元素中，因此无法使用 config.getSection 提取。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T19:09:39.580

我最终把我需要的东西放在了 web.config

```
Allow Anonymous Access
<authorization>
   <allow users="?" />
</authorization>

Disable Anonymous Access
<authorization>
   <deny users="?" />
</authorization> 
```

然后我只是用我的应用程序更改了允许或拒绝。

```
Public Shared Function GetWebConfigFileName(ByVal sitePath As String) As String
    Return IO.Path.Combine(sitePath, "web.config")
End Function

Private Shared Function IIS7EnableActiveDir(ByVal sitepath As String, ByVal EnableAD As Boolean) As Boolean
    Using manager As New ServerManager

        For Each Site In manager.Sites

            If Not IsNothing(manager.Sites(Site.Name)) Then
                If Not IsNothing(manager.Sites(Site.Name).Applications.Item("/")) Then
                    For Each Application In manager.Sites(Site.Name).Applications
                        If Application.VirtualDirectories.Item(0).PhysicalPath.ToString.ToLower = sitepath.ToLower Then
                            If Not String.IsNullOrEmpty(sitepath) Then
                                Dim config As Xml.XmlDocument = New Xml.XmlDocument
                                config.Load(SettingsManager.GetWebConfigFileName(sitepath))
                                For Each node In config.SelectSingleNode("configuration/system.web/authorization")
                                    If TypeOf node Is Xml.XmlElement Then
                                        If EnableAD Then
                                            If node.Name = "allow" Then
                                                'Create new xml attribute
                                                Dim newElement As Xml.XmlElement = config.CreateElement("deny")
                                                Dim newElementAtt As Xml.XmlAttribute = config.CreateAttribute("users")
                                                newElementAtt.Value = "?"
                                                newElement.Attributes.Append(newElementAtt)
                                                config.SelectSingleNode("configuration/system.web/authorization").RemoveAll()
                                                config.SelectSingleNode("configuration/system.web/authorization").AppendChild(newElement)
                                                config.Save(SettingsManager.GetWebConfigFileName(sitepath))
                                                Return True
                                            End If
                                        Else
                                            If node.Name = "deny" Then
                                                'Create new xml attribute
                                                Dim newElement As Xml.XmlElement = config.CreateElement("allow")
                                                Dim newElementAtt As Xml.XmlAttribute = config.CreateAttribute("users")
                                                newElementAtt.Value = "?"
                                                newElement.Attributes.Append(newElementAtt)
                                                config.SelectSingleNode("configuration/system.web/authorization").RemoveAll()
                                                config.SelectSingleNode("configuration/system.web/authorization").AppendChild(newElement)
                                                config.Save(SettingsManager.GetWebConfigFileName(sitepath))
                                                Return True
                                            End If
                                        End If
                                    End If
                                Next
                            End If
                        End If
                    Next
                End If
            End If
        Next
    End Using 
```

# c# - Castle ActiveRecord - 命令行程序集与 VB.Net 程序集问题

> ID：786711
> 
> 赞同：0
> 
> 时间：2009-04-24T16:50:00.320
> 
> 标签：c#, vb.net, assemblies, castle-activerecord

好的，这就是交易。我有一个名为 Import.exe 的项目。它会寻找一个文件，解析它并使用 Castle AR 来导入。这在命令行上运行得很好。

现在，在文件上传后，需要从 VB.NET Web 程序运行相同的 Import.exe。我正在使用 System.Debug.Process.Start 来调用 exe。文件上传正常，程序运行（我在任务管理器中看到它几秒钟），我已经重定向了错误输出，它给了我这个：

> 未处理的异常：System.IO.FileLoadException：无法加载文件或程序集“Castle.ActiveRecord，版本=1.0.3.0，文化=中性，PublicKeyToken=407dd0808d44fbdc”或其依赖项之一。访问被拒绝。

我将dll与exe放在同一个文件夹中。我已将这些添加到 GAC，甚至将程序集引用添加到网站 web.config 文件。

现在，由于我来自 Linux/Ruby 阵营，我身在异国他乡，已经耗尽了我所有的资源。任何帮助将不胜感激！哎呀，即使是用于了解命令行与 VB.NET 程序集差异的良好参考的解释或链接也会很棒。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T17:00:01.857

.NET Framework 为 Web 端提供了一些相当严格的默认安全设置。我猜你需要为你的调用程序授予一些更宽松的信任设置。

MSDN 上有一个小[示例程序](http://blogs.msdn.com/shawnfa/archive/2004/08/30/222918.aspx)，您可以尝试从您的 Web 程序（而不是 Import.exe）启动它，以查看默认情况下授予您哪种访问权限。

一旦您了解了您的特定应用程序需要什么样的信任，您就可以[按照这些步骤](http://support.microsoft.com/default.aspx/kb/815147)来修改您调用的程序集的信任级别。

祝你好运！从 Linux 到 Windows 的过渡可能特别痛苦 :)

# iphone - 是否可以在 XCode 中进行调试后构建步骤/触发器？

> ID：786712
> 
> 赞同：1
> 
> 时间：2009-04-24T16:50:00.337
> 
> 标签：iphone, xcode, build-process, build-automation, coverstory

我想在测试运行时自动在 XCode 中对我们的 iPhone 应用程序的单元测试运行一些代码覆盖率分析（使用 CoverStory）。问题是我们使用的是 Google Toolbox for Mac，而测试似乎运行的方式实际上并没有从 gcov 生成代码覆盖率报告，所以我得到的分析已经过时，除非我手动重新生成覆盖率 html经过构建并开始。我想知道是否有任何晦涩的方法来触发可以为我执行此操作的调试后步骤，因此我不必手动重新运行 CoverStory。是否可以？

编辑：澄清一下，如果可能的话，我希望在程序运行完成后运行构建步骤，而不是在我开始调试之前运行。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T17:55:05.780

是的，您可以轻松添加构建步骤。

在目标文件夹中，选择您的目标，然后右键单击 -> 添加 | 新建阶段 | 新的运行脚本阶段..."

您可以通过双击将任何 shell 命令输入到生成的脚本阶段。这就是单元测试的运行方式。

[替代文字 http://img178.imageshack.us/img178/9718/addbuildphase.png](http://img178.imageshack.us/img178/9718/addbuildphase.png)

# java - 如何访问 WAR 的根目录？

> ID：786716
> 
> 赞同：0
> 
> 时间：2009-04-24T16:50:30.587
> 
> 标签：java, jsp, jsp-tags, war

我需要确定图像是否存在于 JSP 标记中，以便在不存在时显示默认值。访问 War 根目录以便我可以检查图像是否存在的最佳方法是什么？还是有更好的解决方案？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T16:59:31.313

[getResource](http://localhost/tomcat-docs/servletapi/javax/servlet/ServletContext.html#getResource(java.lang.String))`ServletContext`方法可用于此类功能。如果资源（图像）不存在，则此方法返回. 在这种情况下，可以显示默认图像。`null`

请注意，此方法返回的 URL*不是*`<img>`在标记中用作“src”属性的 URL 。它很可能是在其他主机上没有意义的`file:`或协议 URL。在这个应用程序中，它只是通过 JSP`jar:`来测试它是否是，而不是实际。`null`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T18:36:06.103

另请注意，不能保证 Web 容器已经分解了您的 WAR 文件，因此您应该避免偷看文件系统。

是否可以在部署时生成可用图像列表？

# c# - 有什么高调的开源金融项目吗？

> ID：786719
> 
> 赞同：16
> 
> 时间：2009-04-24T16:51:10.240
> 
> 标签：c#, open-source, finance

*在金融*行业——特别是投资银行领域——是否有我可以贡献的高知名度开源项目（最好是 .NET）？我想加强我在这个领域的简历。

我更喜欢算法交易领域的东西，但对任何途径都持开放态度（例如前台应用程序等）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-24T16:55:41.867

[量化库](http://quantlib.org/index.shtml)

[Mohawke's Best of the Best Free and Open Source Software Collection](http://www.digitaldarknet.net/thelist/)展示了许多金融开源项目，只是“按类型排序”。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-24T17:04:28.133

[Codeplex 上的金融 AI](http://www.codeplex.com/financeAI)

FinanceAI 是一个在 Ms-RL 许可下的开源项目，旨在为业余和成熟的投资者提供先进的人工智能、统计和数学工具。一旦完成 FinanceAI 将是一个完整的算法交易平台，具有全面的 AI 和量化金融库。

有关 C# 开源项目的列表，请查看[此处](http://csharp-source.net/)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-11-18T12:00:04.793

我没有比演示更进一步地使用它，但[Marketcetera](http://www.marketcetera.com/site/)最近制造了很多噪音。它们为自动战略开发提供了一个平台，直至执行和簿记。从记忆中我认为技术是Java、ActiveMQ、Ruby on Rails。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-18T11:40:24.463

OpenAMQ - 消息/中间件

R - 用于统计的编程语言

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-05T10:34:08.153

QLNet 是 C# 中 Quantlib 库的端口。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-03-20T18:13:23.097

（不高调，但有机地健康成长）

[JStock - 免费股市软件](http://jstock.sourceforge.net)

上面提到的 URL 更倾向于最终用户。如果您正在寻找与开发人员相关的信息，您可以开始查看他们的[wiki](http://sourceforge.net/apps/mediawiki/jstock/)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-02-28T10:53:44.923

有一个您可能感兴趣的研究项目：[http](http://www-rocq.inria.fr/mathfi/Premia/index.html) ://www-rocq.inria.fr/mathfi/Premia/index.html 。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-08-16T16:40:49.387

开源 FIX 实现 - [http://www.fixprotocol.org/](http://www.fixprotocol.org/)

QuickFIX - [http://www.quickfixengine.org/](http://www.quickfixengine.org/)和 QuickFIX/J - [http://www.quickfixj.org/](http://www.quickfixj.org/)

我在生产环境中使用过 QuickFIX/J，它非常稳定，代码库易于浏览和理解。事实上，Marketcetera 使用 QuickFIX/J 作为他们的修复引擎。

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2009-05-05T00:08:57.017

有一个日食开放金融市场平台

大多数金融公司不喜欢开源，因为他们害怕修改软件时的许可问题。

# .net - 捕获标准输出并仍然在控制台窗口中显示

> ID：786726
> 
> 赞同：6
> 
> 时间：2009-04-24T16:53:28.957
> 
> 标签：.net, process, stdout

我正在生成一个在可见控制台窗口中运行的子进程（它是一个运行 MSBuild 的批处理文件），我希望该进程生成的输出显示在可见控制台窗口中，并捕获该输出所以我可以在代码中处理它。我已经阅读了其他几个问题和处理 ProcessStartInfo.RedirectStandardOutput 等的 MSDN 文档，我可以从重定向流中捕获输出并在代码中处理它就好了：

```
Process msBuild = new Process();
msBuild.StartInfo.FileName = "Build.bat";
msBuild.StartInfo.UseShellExecute = false;
msBuild.StartInfo.RedirectStandardOutput = true;
msBuild.Start();
string output = msBuild.StandardOutput.ReadToEnd();
msBuild.WaitForExit(); 
```

问题是子进程的控制台窗口中没有显示输出；我只是在进程运行时在屏幕上看到一个空白的控制台窗口，它在完成后消失。

我想我可以隐藏实际的子进程窗口，并显示第二个窗口，我只需将输出写入到它被捕获的位置，但这似乎比必要的工作更多。有没有办法让输出显示在控制台窗口中，并在完成后仍然捕获它以进行处理？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T17:08:18.343

这是我使用的，没有使用单独的线程：

```
 using(System.Diagnostics.Process proc = new System.Diagnostics.Process())
{
   proc.EnableRaisingEvents = false;
   proc.StartInfo.RedirectStandardOutput = true;
   proc.StartInfo.CreateNoWindow = true;
   proc.StartInfo.UseShellExecute = false;
   proc.StartInfo.Verb = "open";
   proc.StartInfo.FileName = "XXXX";
   proc.Start();
   String sLine = "";
   while ((sLine = proc.StandardOutput.ReadLine()) != null)
   {
      System.Console.WriteLine(sLine);
   }
   proc.WaitForExit(); //Jon Skeet was here!
   errorCode = proc.ExitCode;
   proc.Close();
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-24T17:02:59.777

一旦您将标准重定向出去，它就不再指向控制台。要写入控制台，您必须手动执行。

如果您想在流程执行时显示输出，而不是在最后显示 1 个大转储，您可以使用 Process 类的“OutputDataReceived”事件。

# sql-server - 受密码保护的 SQL Server 备份

> ID：786729
> 
> 赞同：0
> 
> 时间：2009-04-24T16:54:12.480
> 
> 标签：sql-server

我有一个需要恢复的受密码保护的 sql server 备份文件。在检查所有可用文档时，我相信“密码保护”不会以任何方式改变备份文件，它是完全可读的，它只是为了帮助确保不会对错误的数据库进行还原。

有没有办法让我在不知道密码的情况下进行恢复（我可以从备份文件中取出它还是远程它）？

谢谢，

蒂姆

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T18:42:25.917

尝试使用第三方数据比较工具，例如 RedGate 的 SQL 数据比较。它可能会让你绕过它。您可以从他们的网站免费演示它。

[http://www.red-gate.com/products/SQL_Data_Compare/index.htm](http://www.red-gate.com/products/SQL_Data_Compare/index.htm)

# grails - Grails：如何将数组传递给 GSP 页面

> ID：786731
> 
> 赞同：3
> 
> 时间：2009-04-24T16:54:26.740
> 
> 标签：grails

我需要在 GSP 页面中显示目录列表。你能指导我如何将这个数组传递给 GSP。

这是我下面的示例代码。

```
 File dir = new File(petl_dir_path)
          def list= []                      
          dir.eachDir{ list << it.name } 
```

请指导

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-24T20:16:21.650

您的“列表”不是数组，而是 ArrayList 的一个实例。但是，您可以简单地将其传递给您的视图（在以下示例中，我假设您有 index 操作），例如：

```
def index = {
  File dir = new File(petl_dir_path)
  def list= []                          
  dir.eachDir{ list << it.name }
  [dirs: list as String[]]
} 
```

然后你可以在你的 GSP 中处理'dirs'。

# xpath - 具有默认命名空间且无前缀的 BizTalk xpath

> ID：786732
> 
> 赞同：1
> 
> 时间：2009-04-24T16:54:31.840
> 
> 标签：xpath, biztalk

我正在努力使用 BizTalk xpath 功能
- 我收到的消息有一个空白的默认命名空间
- 在 C# 中我会添加一个 NameSpaceManager
- 但我看不到如何在 BizTalk Expression 中做到这一点？

我没有做的就是获取 HasErrors 和 NumberOfErrors 的值

```
<?xml version="1.0" encoding="utf-8"?>
<ImportIndexDocumentResponse   
      xmlns:xsd="http://www.w3.org/2001/XMLSchema"        
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://www.aniteps.com/xml/schemas/awm/images4">
  <HasErrors>false</HasErrors>
  <NumberOfErrors xsi:type="xsd:int">0</NumberOfErrors>
  <ErrorDescription xsi:type="xsd:string">No exception ocurred.</ErrorDescription>
  ... 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-26T21:39:59.093

using 的答案`local-name()`是错误的，因为它允许选择不需要的元素，例如：

*   OhMy:有错误
*   不同：HasErrors
*   不需要：有错误

* * *

这是一个正确的解决方案：

**如果无法将前缀绑定到默认命名空间**“ [http://www.aniteps.com/xml/schemas/awm/images4](http://www.aniteps.com/xml/schemas/awm/images4) ”，**可以使用标准 XPath 函数[`namespace-uri()`](http://www.w3.org/TR/xpath#function-namespace)**指定元素必须位于给定的命名空间。

**因此，选择所需的两种节点的 XPath 表达式的一个示例是**：

```
/*/*[命名空间-uri() = 'http://www.aniteps.com/xml/schemas/awm/images4'
   和
     名称（）='有错误'
    ]

```

和表达式：

```
/*/*[命名空间-uri() = 'http://www.aniteps.com/xml/schemas/awm/images4'
   和
     name() = 'NumberOfErrors'
    ]

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T11:15:32.550

如果您的元素没有重复，您可以将它们从响应模式中提升为可区分字段。那么您不必担心编码。只需使用：

```
x = YourMessageName.HasErrors; 
```

如果它是 web/wcf 引用，您可以提升 reference.xsd（或带有“使用 Wcf 服务向导”的 xyz.xsd）中的值。请注意，如果您更新参考，它们将“消失”。

# oracle - Oracle PL/SQL：动态循环触发列

> ID：786733
> 
> 赞同：4
> 
> 时间：2009-04-24T16:54:52.057
> 
> 标签：oracle, dynamic, plsql, database-trigger

在触发器内部，我试图遍历表上的所有列并将新值与旧值进行比较。这是我到目前为止所拥有的：

```
CREATE OR REPLACE TRIGGER "JOSH".TEST#UPD BEFORE 
UPDATE ON "JOSH"."TEST_TRIGGER_TABLE" REFERENCING OLD AS OLD NEW AS NEW FOR EACH ROW
declare    
   oldval varchar(2000);   
   newval varchar(2000);   
begin    
   for row in (SELECT column_name from user_tab_columns where table_name='TEST_TRIGGER_TABLE') loop  
     execute immediate 'select :old.'||row.column_name||' from dual'   into oldval;  
     execute immediate 'select :new.'||row.column_name||' from dual'   into newval;  
     --Do something here with the old and new values
   end loop;  
end; 
```

触发器编译，但是当触发器触发时，我得到：

> ORA-01008: 并非所有变量都绑定

在第一次执行时立即执行，因为它期望`:old`. `:old`并且`:new`已经被定义为触发器的一部分，但是执行立即似乎看不到这些变量。

有没有办法动态迭代触发器中的列值？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-24T17:25:32.250

不，您不能动态引用 :old 和 :new 值。正如 Shane 建议的那样，您可以编写代码来生成静态触发代码，如果这样可以让生活更轻松。此外，您可以将“在这里做某事”制作成一个包过程，以便您的触发器变为：

```
CREATE OR REPLACE TRIGGER JOSH.TEST#UPD BEFORE 
UPDATE ON JOSH.TEST_TRIGGER_TABLE
begin    
   my_package.do_something_with (:old.col1, :new.col1);
   my_package.do_something_with (:old.col2, :new.col2);
   my_package.do_something_with (:old.col3, :new.col3);
   -- etc.
end; 
```

（顺便说一句，您可以放弃毫无意义的 REFERENCING 子句）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-24T17:08:50.010

我不确定你是否能做你想做的事。您不想在 PL/SQL 代码中显式命名表列的原因是什么？如果表字段经常更改，您可以构建 PL/SQL，为每个表动态构建 PL/SQL 触发器（每个表中都有明确的字段名称）。每次表更改时，您都可以运行该 PL/SQL 来生成新触发器。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-24T17:29:58.090

您实际上是在尝试构建自己的系统来审核对表的所有更改吗？（我的最佳猜测是您可能会对任意列的旧值和新值执行什么操作。）如果是这样，您可能需要研究 Oracle 自己的审计功能。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-24T17:19:13.123

我有一个类似的问题，虽然在 MSSQL 中。

我的解决方案是编写一个存储过程，它遍历表和列信息（通过字典视图或自定义存储库）并生成所需的触发器。仅当数据模型更改时才需要运行该过程。

优点是您不必在每次更新中都在元模型中游标，而是提前生成触发器。

# asp.net-mvc - Visual Web Developer Express 中的 SubSonic ASP.NET MVC 示例

> ID：786734
> 
> 赞同：7
> 
> 时间：2009-04-24T16:55:00.043
> 
> 标签：asp.net-mvc, subsonic, t4

在 Visual Web Developer Express 2008 中，SubSonic ASP.NET MVC 模板似乎不适用于我添加的新数据库。我删除了 Chinook 数据库并创建了自己的数据库。我了解 Models 文件夹中的 .tt 文件用于生成代码，但它们没有（尽管将 ConnectionStringName 更改为我在 web.config 中设置的内容）

右键单击每个 .tt 文件并选择“运行自定义工具”不会生成任何内容，除了错误消息：

```
Cannot find custom tool 'TextTemplatingFileGenerator' on this system. 
```

那个工具保存在哪里？CodeTemplates 中有 .tt 文件，当您创建新的控制器或视图时会使用这些文件，因此我假设有一个工具可以执行此操作。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-17T23:03:06.660

根据[Adam 的](https://stackoverflow.com/questions/786734/subsonic-asp-net-mvc-sample-in-visual-web-developer-express/791415#791415)评论，您可以在 VS Express 中执行此操作，但正如 Adam 建议的那样，需要对模板进行更改。

Visual Studio 要求仅用于获取活动项目的路径，然后用于查找 web.config 文件和 app_data 路径。由于这些值在项目中通常是已知的，我们可以硬编码替代值

像这样更新 _Settings.tt 文件：

```
...
const string ConnectionStringName="Chinook";
//Use this when not building inside visual studio standard or higher
//make sure to include the trailing backslash!
const string ProjectPathDefault="c:\\path\\to\\project\\";

...

public EnvDTE.Project GetCurrentProject()  {

        if (Host is IServiceProvider)
        {
            IServiceProvider hostServiceProvider = (IServiceProvider)Host;
            if (hostServiceProvider == null)
                throw new Exception("Host property returned unexpected value (null)");

            EnvDTE.DTE dte = (EnvDTE.DTE)hostServiceProvider.GetService(typeof(EnvDTE.DTE));
            if (dte == null)
                throw new Exception("Unable to retrieve EnvDTE.DTE");

            Array activeSolutionProjects = (Array)dte.ActiveSolutionProjects;
            if (activeSolutionProjects == null)
                throw new Exception("DTE.ActiveSolutionProjects returned null");

            EnvDTE.Project dteProject = (EnvDTE.Project)activeSolutionProjects.GetValue(0);
            if (dteProject == null)
                throw new Exception("DTE.ActiveSolutionProjects[0] returned null");

            return dteProject;
         }
         return null;
}

...

public string GetConfigPath(){
        EnvDTE.Project project = GetCurrentProject();
        if (project != null)
        {
            foreach(EnvDTE.ProjectItem item in project.ProjectItems)
            {
             // if it is the configuration, then open it up
             if(string.Compare(item.Name, "Web.config", true) == 0)
             {
              System.IO.FileInfo info =
                new System.IO.FileInfo(project.FullName);
                return info.Directory.FullName + "\\" + item.Name;
             }
            }
            return "";
        }
        else
        {
            return ProjectPathDefault+"web.config";
        }
    }

    public string GetDataDirectory(){
        EnvDTE.Project project=GetCurrentProject();
        if (project != null)
        {
            return System.IO.Path.GetDirectoryName(project.FileName)+"\\App_Data\\";
        }
        else
        {
            return ProjectPathDefault+"App_Data\\";
        }
    }
... 
```

然后使用 VS External Tools 功能设置一个 T4 工具（Tools->External Tools）：设置这些属性：

*   **标题：** T4
*   **命令：** C:\Program Files\Common Files\Microsoft Shared\TextTemplating\1.2\TextTransform.exe
*   **参数：** $(ProjectDir)\Models\Classes.tt
*   **初始目录：** $(ProjectDir)
*   **应检查**使用输出窗口**和**提示参数。****

 **单击“确定”，然后从“工具”->“外部工具”菜单中执行新创建的工具。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-24T18:26:39.560

事实证明，我不知道，T4 模板只能在 VS Standard 或更好的环境上运行 :(。我曾认为它曾经可以在 VS SDK 中使用——也许你可以在那里找到它： (

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-26T19:11:20.853

您可以使用一个命令行 TextTransform 工具：

[ [http://msdn.microsoft.com/en-us/library/bb126461.aspx][1]](http://msdn.microsoft.com/en-us/library/bb126461.aspx][1])

默认情况下，在 Express 版本中，它安装到 C:\Program Files\Common Files\Microsoft Shared\TextTemplating\1.2

然而，MVC 模板要求 t4 模板在 Visual Studio 中运行，所以我很确定如果没有模板的至少一个补丁，你将无法让它们工作。

# java - 覆盖java 1.4中的方法时如何避免“未使用的参数”警告？

> ID：786740
> 
> 赞同：5
> 
> 时间：2009-04-24T16:57:07.950
> 
> 标签：java, params, overriding, suppress-warnings

在这段代码中：

```
public class MyClass {
    private Object innerValue;
    public Object getInnerValue() {
        return this.innerValue;
    }
    public void setInnerValue(Object innerValue) {
        this.innerValue = innerValue;
    }
}

public class MyClassReadOnly extends MyClass {
    MyClassReadOnly(MyClass cls) {
        // Make a field by field copy
        super.setInnerValue(cls.getInnerValue());
    }
    public void setInnerValue(Object innerValue) {
        throw new UnsupportedOperationException(
                            "This is a read-only instance"
                        );
    }
} 
```

编译器正确地抱怨*MyClassReadOnly.setInnerValue()*中未使用的参数（从不读取） *innerValue*。

 *我不想禁用这种警告，因为它通常非常有用，我也不希望有任何警告以具有高信噪比。

我不能将*@SuppressWarnings()*构造用作另一个建议的问题，因为它仅适用于 Java 1.4。

我想过插入这样的虚拟代码，但不是很令人满意：

```
public void setInnerValue(Object innerValue) {
    if (innerValue != null) { /* Do Nothing, but keep the compiler happy */ }
    throw new UnsupportedOperationException("This is a read-only instance");
} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-24T17:10:51.863

警告不是问题，恐怕是设计问题。

您当前的层次结构违反了 Liskov 的替换原则，因为接收 MyClass 实例的类期望 setInnerValue 工作，并且可能无法正确处理此异常。你可以说一个可读写的 X 是一种可读的 X，但你不能说一个可读的 X 是一种可读写的 X。

当我遇到这种情况时，我创建了一个名为 IMyX 的带有读取的接口，一个名为 IMutableMyX 的带有写入的子接口，然后实际的类实现了 IMutableMyX，因此也实现了 IMyX。然后我非常小心，只在需要时通过 IMutableMyX，并在所有其他情况下通过 IMyX。

我觉得使用编译器和类型来限制访问比依靠运行时异常更好。它还使您的代码更清晰，并在您确实需要写访问时强制您显式地向下转换接口。

我意识到这并不能回答您关于摆脱警告的问题。但是警告可以被抑制、忽略或解决。未使用的参数通常是一种难闻的气味，表明您的方法可能没有按照预期进行。方法应该只获取必要的参数。如果不使用该参数，则该参数不是必需的，因此需要更改某些内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T17:03:50.710

恐怕你被虚拟代码困住了。在 C/C++ 中，您可以使用宏 ( `#define _unused(x) ((void) x)`)，但`(void) variable;`在 Java 中不是有效的语句。

如果它让你感觉更好，编译器可能会优化掉空的 if 块。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T17:05:02.407

您可以安全地输入以下行 `innerValue = null`：在所有未使用的参数的函数顶部。它不会影响调用者，但会让编译器满意。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T17:09:07.467

我不会为了让编译器警告消失而玩任何“代码技巧”，希望编译器能够优化这些技巧。事实上，这个编译器警告真的有用吗？我只会禁用它。使用 Java 5 后，您可以使用`@SuppressWarnings`并重新启用它。

*IMO，仅仅因为它们存在就启用所有*可能的警告是一个坏主意，然后着手让每一个警告消失。找出哪些警告实际上对您的环境有意义，然后禁用其余警告。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-24T17:21:23.570

如果您使用的是 Eclipse (?)，您可以打开 Parameter Is Never Read 警告，但忽略覆盖和实现方法（这将解决这个特定问题）的情况，以及单独使用“@param”标签记录的情况（虽然这当然不适用于 Java 1.4）。我希望大多数其他 Java IDE 都可以使用类似的设置。

# powershell - 打印对象比 Write-Host 更好的方法

> ID：786741
> 
> 赞同：6
> 
> 时间：2009-04-24T16:57:27.200
> 
> 标签：powershell, pretty-print

我使用 Write-Host 分析对象，但有时很难理解对象实际上是什么。

考虑：

```
Write-Host $null
Write-Host @()
Write-Host @($null, $null) 
```

印刷：

```
# Actually it prints nothing 
```

我想要这样的东西：

```
Null
@()
@(Null, Null) 
```

有什么建议么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-02-02T20:15:32.883

对于这个特定的示例，您可以通过将它们粘贴到对象的属性中来轻松获得所需的内容。举个例子，让我们创建一个包含三个测试的数组：

```
$tests = @($null,@(), @($null,$null))

function Write-Visible {
   param($InputObject) 

   New-Object PSObject -Property @{ Object=$InputObject } | 
       Out-String | Out-Host 
} 
```

当然，这些`Out-String | Out-Host`东西只是为了确保我们实际上不会将对象输出到管道，而是像 Write-Host 那样表现。

所以现在我们可以运行我们的测试：

```
PS> Write-Visible $tests[0]

Object
------

PS> Write-Visible $tests[1]

Object
------
{}

PS> Write-Visible $tests[2]

Object
------
{$null, $null} 
```

当然，这样做的问题是它对于真实对象往往不是那么好，因为它会将它们变成对象的属性，在那里它们被渲染为“ToString（）”......但是，在我的脑海中，如果没有新对象，我想不出如何调用那里发生的渲染魔法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T17:30:06.480

您可以编写一个为您进行漂亮打印的函数。类似以下内容可能会满足您的需求：

```
function pp($a) {
    if ($a -eq $null) {
        return "Null"
    } elseif ($a -is [object[]]) {
        $b = @()
        foreach ($x in $a) {
            $b += (pp $x)
        }
        $s = "@(" + [string]::Join(",", $b) + ")"
        return $s
    } else {
        return $a
    }
} 
```

但是，shell 上的空数组仍然存在问题（不过，从 .ps1 文件中可以正常工作）。也不支持哈希表，但嵌套数组是。可能仍然需要一些管道，但可能会给出一个大致的方向。

阵法仿佛是一头丑陋的`@($null, $null)`野兽，甚至不敢与它相比`$null`。诡异的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-01T01:49:40.213

尝试做这样的事情会有多个问题。

1.  更改 write-host 工作方式的“正确”或“powershell”方法是使用格式化文件来定义您希望使用的主机如何显示相关对象。`get-help about_format.ps1xml`您可以从或从[MSDN PowerShell 格式化文件](http://msdn.microsoft.com/en-us/library/gg580944%28v=VS.85%29.aspx)页面获取更多信息。
2.  您需要特定于您正在使用的“主机”。有关`get-help get-host`详细信息，请参阅或访问[TechNet 页面](http://technet.microsoft.com/en-us/library/dd315254.aspx)。您*至少*需要了解三个常见的主机：
    *   基本的命令行，`ConsoleHost`
    *   基本的 PowerShell ISE，`Windows PowerShell ISE Host`
    *   Quest PowerGUI 主机，`PowerGUIScriptEditorHost`
3.  PowerShell 以一种特殊的方式处理 @() 语法，这有时会使处理空数组变得困难。根据[此 MSDN PowerShell 博客文章](http://blogs.msdn.com/b/powershell/archive/2007/01/23/array-literals-in-powershell.aspx)：

    > ... 这
    > 
    > `@( … )`
    > 
    > 操作是语法糖
    > 
    > `[array] $( … )`
    > 
    > 所以——如果@()中的语句返回一个标量，它将被包装在一个数组中，但如果结果已经是一个数组，那么它就不会被嵌套......

我很想能够为此提供一些代码，但在这一点上它有点超出我的范围......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-30T15:38:43.113

不适用于空数组，但您可以使用 format-xxx 命令之一。这有助于格式化没有有用的 ToString 覆盖的对象。例如

```
> $cmd = Get-Command -Name get-command
> $cmd

CommandType     Name                                                Definition
-----------     ----                                                ----------
Cmdlet          Get-Command                                         Get-Command...

> write-host $cmd
Get-Command
> format-table -InputObject $cmd | out-string | out-host

CommandType     Name                                                Definition
-----------     ----                                                ----------
Cmdlet          Get-Command                                         Get-Command... 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2013-01-25T13:41:36.640

你可以试试这个：

```
Write-Host '$null'
Write-Host '@()'
Write-Host '@($null, $null)' 
```

# powershell - Powershell: Practical usage of $^ and $$?

> ID：786753
> 
> 赞同：3
> 
> 时间：2009-04-24T17:00:09.470
> 
> 标签：powershell

I am wondering whether anyone came up with good use cases of the `$^` and `$$` automatic variables in Powershell. At the moment I am not seeing much use for them, at least from a programmer perspective.

When using PS interactively and executing a long command you could use `.$^` to repeat it and with `$$` you could get the last argument, but `.$^` looks awkward enough to me that I don't consider that something people would use every day. Furthermore, since `$$` only yields the last argument it's probably similarly difficult to use effectively.

But maybe I'm just mistaken and they have useful uses and I just can't see them.

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-24T17:03:45.063

I use the $$ constantly during my day. I find little use for it in scripts but one operation I commonly do from the command line is to checkout a file and then open it in vim. The $$ reduces keystrokes in that circumstance.

```
PS> tf edit some\Long\Path\To\This\File\I\Need\To\Edit.cpp
Edit.cpp checked out
PS> gvim $$ 
```

# ruby-on-rails - Contextual ActiveRecord Model filtering

> ID：786757
> 
> 赞同：1
> 
> 时间：2009-04-24T17:01:19.077
> 
> 标签：ruby-on-rails, ruby, activerecord, authorization

Throughout our site there's a common model, let's say Video, that has a number of attributes like private/public/pending, downloadable, etc.

Based on the controller, action, request parameters and current user, we want to filter out particular videos from display. For instance, on the homepage we only want to show videos that are public. If there is a logged in user on the homepage we also want to show public downloadable videos.

We also want to make sure that these filters can be applied through sql queries alone, so that using Sphinx we can filter out undesired videos when a user does a search on the site.

Is this best handled through an authorization plugin, such as rails-authorization-plugin? Bottom line our goal is to prevent programmers from accidentally forgetting to filter out particular videos when they add a new action. The solution we're looking for should be very programmatic.

Here's a solution I'm thinking of (haven't written any code yet)

1.  Make use of an authroization plugin or roll our own that allows setting which videos are displayed, defined at the controller or action level.

2.  Create an association extension for any model that has_many(:videos) or has_one(:video), which allows us to overload the finder for videos in the association.

3.  Overload Video.find in a similar manner to restrict what to display based on the current rules.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T14:26:16.077

Your general strategy seems sound, but I'd strongly suggest you don't override rails default finders. Instead, here's something I've done in the past:

```
class Video < ActiveRecord::Base
  named_scope :available_to, lambda {|user|
    if user.nil?
      :conditions => {:public_accessible => true}
    elsif user.omnipotent?
      {}
    else 
      :conditions => [%{
        videos.public_accessible = ? OR EXISTS (
          ....boring security stuff linking to users....
        )
      }, true, user.id]
    end 
  }
end 
```

Then in video_shop.rb:

```
class VideoShop < ActiveRecord::Base
  has_many :videos 
end 
```

Finally, put it all together:

```
# All videos available to a user
Video.available_to(user)

# All videos in a given shop
video_shop.videos

# All videos in a given shop available to a given user
video_shop.videos.available_to(user) 
```

Note that these work even if user is nil.

# mysql - MySQL：跨多个表的多列连接？

> ID：786759
> 
> 赞同：3
> 
> 时间：2009-04-24T17:01:52.337
> 
> 标签：mysql, join

我有一组三个表：

```
Dining_Tables；
+--------------------+-------------+------+------+ ---------+--------+
| 领域 | 类型 | 空 | 钥匙 | 默认 | 额外 |
+--------------------+-------------+------+------+ ---------+--------+
| 餐桌 | 整数(11) | 否 | 优先级 | 空 | |
| 巴士男孩 | varchar(35) | 否 | | 空 | |
| 服务员 | varchar(35) | 否 | | 空 | |
| 服务器 | varchar(35) | 否 | | 空 | |
+--------------------+-------------+------+------+ ---------+--------+

扑克桌;
+--------------------+-------------+------+------+ ---------+--------+
| 领域 | 类型 | 空 | 钥匙 | 默认 | 额外 |
+--------------------+-------------+------+------+ ---------+--------+
| 扑克桌 | 整数(11) | 否 | 优先级 | 空 | |
| 经销商 | varchar(35) | 否 | | 空 | |
| 坑老板 | varchar(35) | 否 | | 空 | |
+--------------------+-------------+------+------+ ---------+--------+

计算机_表；
+--------------------+-------------+------+------+ ---------+--------+
| 领域 | 类型 | 空 | 钥匙 | 默认 | 额外 |
+--------------------+-------------+------+------+ ---------+--------+
| 电脑桌 | 整数(11) | 否 | 优先级 | 空 | |
| 程序员 | varchar(35) | 否 | | 空 | |
+--------------------+-------------+------+------+ ---------+--------+

```

这些行中的每一行都有与之关联的全局唯一表 id： ( `dining_table`, `poker_table`, `computer_table`) 其他列存储完成卷的人的名字/姓氏。

在我的模型中，一个人可以做多件事。例如，Joe Smith 可以同时`computer_table`作为程序员坐在`poker_table`a 处，作为经销商坐在 a 处，并`dining_table`作为服务员在 a 处等待。

我的问题是：我想要一个允许我检索`table_ids`给定人的所有信息的查询。具体来说，查询将返回`table_ids`Joe Smith 当前所在的列表。

我可以按照以下方式做一些事情：

```
从 Dining_Tables 中选择 Dining_table，其中
      bus_boy = "乔·史密斯" 或
      服务员 =“乔·史密斯”或
      服务器=“乔·史密斯”；

从 Poker_Tables 中选择 poker_table
      经销商=“乔·史密斯”或
      pit_boss = "乔·史密斯";

从 Computer_Tables 中选择 computer_table
      程序员 = "乔·史密斯";

```

但是，这是三个单独的查询，如果可能的话，我真的更愿意避免这样做。我可以使用联接在一个查询中完成吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-24T17:08:21.993

您的数据模型不是最佳的。考虑：

```
Person PersonRole 角色表
------ ---------- ---- -----
Id* PersonId* Id* Id*
姓名 RoleId* 姓名 姓名
                          表 ID

```

话虽如此...

```
select dining_table from Dining_Tables where 
      bus_boy = "Joe Smith" or
      waiter = "Joe Smith" or 
      server = "Joe Smith"
union
select poker_table from Poker_Tables where 
      dealer = "Joe Smith" or 
      pit_boss = "Joe Smith"
union
select computer_table from Computer_Tables where 
      programmer = "Joe Smith" 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-24T17:06:32.717

如果您想在单个查询中返回它，您可以使用 UNION 语句将这三个查询合并为一个。

> ```
> select dining_table as Table from Dining_Tables where 
>       bus_boy = "Joe Smith" or
>       waiter = "Joe Smith" or 
>       server = "Joe Smith"
> UNION
> select poker_table as Table from Poker_Tables where 
>       dealer = "Joe Smith" or 
>       pit_boss = "Joe Smith"
> UNION
> select computer_table as Table from Computer_Tables where 
>       programmer = "Joe Smith" 
> ```

尽管它是三个语句，但它会作为单个结果集返回。

如果您将“工作”分开到单独的表中，则查询会容易得多。

我可以想象以下内容：

表、表类型、人员、角色、表角色

```
TableTypes
ID    TypeName
-----------------------
1     Dining
2     Poker
3     Computer

Tables
ID    TableTypeID
----------------------------
1     1
2     1
3     2
4     3
5     2
6     3

Persons
ID    Name
---------------------------
1     Joe Smith
2     Mary Belcher
3     Norma Grey

Roles
ID    RoleName
-----------------------------
1     Bus Boy
2     Waiter
3     Server
4     Dealer
5     Pit Boss
6     Programmer

TableRoles
TableID    RoleID    PersonID
-----------------------------
1          1         1
//etc
//etc 
```

这将使您的所有查询变得非常简单明了，并使其具有可扩展性（因此您可以向每个表添加更多角色而不会破坏您的数据库）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-24T17:09:37.590

我认为你应该从你的用户表开始，然后从那里加入其他表：

```
SELECT U.user_id, d.dining_table, p.poker_table, c.computer_table
FROM Users U
LEFT JOIN Dining_Table D
  ON D.bus_boy = U.user_id OR D.waiter = U.user_id or D.server = U.user_id
LEFT JOIN Poker_Table P
  ON P.dealer = U.user_id OR P.pit_boss = U.user_id
LEFT JOIN Computer_Table C
 ON C.programmer = U.user_id
WHERE U.Name = 'Joe Smith'

-- only return rows with at least one table match
-- or leave off to always return the user)
AND NOT (
  d.dining_table IS NULL 
  AND p.poker_table IS NULL 
  AND c.computer_table IS NULL
) 
```

这将为每个用户提供一行，指示用户在哪个表（或为空）。

如果您真的只想要单个用户的直接列表，那么联合方法可能是首选。但是，如果此查询将为名册或用户运行，我认为我的方法更好。

# sql-server-2008 - SQL Server 2008 sp1

> ID：786767
> 
> 赞同：1
> 
> 时间：2009-04-24T17:04:05.763
> 
> 标签：sql-server-2008, installation, asp.net-3.5

当我尝试在我的系统上安装 SQL Server 2008 sp1 时，安装程​​序运行并检查先决条件，一切正常，除了它说我的机器有一个挂起的重新启动并且在完成之前不会继续。我冷重启机器，运行安装程序并出现相同的消息。所以我无法安装 sp1 更新。有任何想法吗 ？

信息：操作系统 Win XP sp3 x32，VS 2008 sp1，SQL 2008 标准

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T17:14:49.373

挂起的重新启动问题通常表明以前的安装没有自行清理。在您的注册表中查找此键：

```
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager
\PendingFileRenameOperations 
```

删除该键下的所有值并再次尝试安装。

**法律细则：** *在对注册表进行更改之前导出并保存......等等，等等，等等......*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-01T00:51:17.087

检查以确保在开始安装之前停止所有 SQL Server 服务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T17:07:24.040

您是否尝试再次重新启动它？然后再次？IIRC 我在全新安装时重启了几次（我尽量避免安装 SQL 服务器）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T17:19:31.717

尝试使用 /quiet 和 /allinstances 开关从命令提示符安装。我在安装服务包时遇到了类似的问题。

# sql - 是否可以向 SQL Server 2005 添加语言/区域设置？

> ID：786768
> 
> 赞同：2
> 
> 时间：2009-04-24T17:04:21.800
> 
> 标签：sql, sql-server-2005, localization, locale

列出了几种语言/区域设置的内容`sys.syslanguages`，但是可以添加语言吗？例如，我想添加澳大利亚英语和加拿大法语。

任何帮助表示赞赏！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T21:10:40.913

`sys.syslanguages`遗憾的是，在**SQL Server 2005**及更高版本中无法修改表的内容。（在以前的版本中，系统目录是可编辑的）

我假设您想添加这些语言/区域设置，以便以相应的格式显示货币和日期。如果是这种情况，则需要在应用程序的 UI 端进行处理。

您可以为每个用户定义用户首选项，也可以基于用户所在的位置，并以各自的格式显示数据。

# .net - 我可以使用 ADO.Net Entity Framework 延迟加载标量属性吗？

> ID：786783
> 
> 赞同：2
> 
> 时间：2009-04-24T17:08:21.493
> 
> 标签：.net, entity-framework, lazy-loading

我有一个数据库表*Image*，其中包含一个巨大的列：*Data*。

![一个实体](https://i.stack.imgur.com/uDktk.gif)

我宁愿延迟加载那一列，所以当我获得所有图像的列表时，我不会查询所有内容。

我知道我可以将数据放入它自己的列和实体中，如下所示：

![两个实体](https://i.stack.imgur.com/1aJ3v.gif)

但是，我必须这样做吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T17:19:04.650

是的，我相信你必须这样做。我认为EF不可能。

您可以对所需的列进行显式查询，然后再对数据列进行查询。就像这篇文章中的建议一样：

[如何仅在需要时使用 ADO.NET Entity Framework 加载 varbinary(max) 字段？](https://stackoverflow.com/questions/662873/how-to-load-varbinarymax-fields-only-when-necessary-with-ado-net-entity-framewo)

但似乎 Linq To SQL 提供了这种可能性，所以我会尝试研究它是否也会出现在 EF 中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-06-19T21:01:15.070

您有权访问数据模式吗？在实体框架中，您不能有两个实体引用同一个表，**至少您过去不能。照这样说。您可以使用数据列创建一个 Sql VIEW。

```
CREATE VIEW [dbo].[ImageData]
SELECT
    Id,
    Data
FROM Image 
```

现在，您可以创建一个名为 Image Data 的实体来反映您的上述模式。

如果您需要更新视图，这也是可能的，您只需在视图上创建一个名为 INSTEAD OF TRIGGER 的触发器。

```
-- INSERT Trigger
CREATE TRIGGER [dbo].[TR_ImageData_Update] ON [ImageData]
INSTEAD OF INSERT
AS
BEGIN
    UPDATE [Image]
    SET Data = i.Data
    FROM Inserted AS i
END;
GO 
```

在大多数情况下，这可能是理想的。但是，如果您无权访问数据库架构，则可能无法执行此操作。相反，您将从图像实体中创建一个默认查询。

```
public static IQueryable GetImages(this DbContext db)
{
    var query = db.Images.AsQueryable();
    return query.Select(r => new Image() { Id = r.id....});
}

public static IQueryable GetImageData(this DbContext db, int imageId)
{
    var query = db.Images.AsQueryable();
    query = query.Where(x => x.Id == imageId);
    query = query.Select(x => new ImageData() { Id = r.Id, Data = r.Data });
    return query;
} 
```

# flash - 如何在 Flash 中加载不同尺寸的图像一次

> ID：786788
> 
> 赞同：0
> 
> 时间：2009-04-24T17:09:20.947
> 
> 标签：flash, image

我使用了以下 AS2 代码

```
frontLoader = new ImageLoader(object1,"fit",iWidth,iHeight);
frontLoader.loadImage(src.Url);   

frontLoader = new ImageLoader(object1,"fit",iWidth2,iHeight2);
frontLoader.loadImage(src.Url); 
```

它生成2个对服务器的外部调用，我如何加载一次图像并在不同维度上多次使用它

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T17:12:35.027

使用[`Bitmap`](http://livedocs.adobe.com/flex/2/langref/flash/display/Bitmap.html)和[`BitmapData`](http://livedocs.adobe.com/flex/2/langref/flash/display/BitmapData.html)类来缩放您的图像。以最大可能的分辨率加载它，然后应用合适的变换。

[这是](http://livedocs.adobe.com/flex/3/html/help.html?content=Working_with_Bitmaps_03.html)关于如何使用这些类的 AS3 文档。它应该让您对使用 AS2 可以做什么有一个大致的了解。

# api - 带有谷歌图表API的垂直标签？

> ID：786789
> 
> 赞同：27
> 
> 时间：2009-04-24T17:09:27.873
> 
> 标签：api, charts, graph, google-visualization

任何人都知道如何使用谷歌图表 API 使 x 轴标签垂直？

我需要在一个小图表中放置很多标签。

谢谢

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2014-01-29T05:40:43.263

添加带有 slantedtextangle:90 度的参数选项以垂直显示标签

```
var options ={ hAxis: {title: "Years" , direction:-1, slantedText:true, slantedTextAngle:90 }} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2012-11-27T22:29:04.597

这是一个旧线程。但我自己正在寻找这个并遇到了这个......

[https://developers.google.com/chart/interactive/docs/gallery/areachart#Configuration_Options](https://developers.google.com/chart/interactive/docs/gallery/areachart#Configuration_Options)

查找：hAxis.slantedTextAngle 和 hAxis.slantedText。将您的角度设置为 90 以进行垂直显示（或任何介于两者之间的倾斜显示）。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2013-12-17T12:46:26.120

现在是可能的

```
var options = {
  title: "Test",
   hAxis: {
        direction:-1,
        slantedText:true,
        slantedTextAngle:90 // here you can even use 180
    }
}; 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2016-04-22T22:01:25.540

对角线文本在这里。这是我的做法，希望对他们有所帮助。

[https://jsfiddle.net/8tvm9qk5/](https://jsfiddle.net/8tvm9qk5/)

编码：

```
 <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <div id="chart_div"></div> 
```

和

```
google.charts.load('current', {packages: ['corechart', 'bar']});
google.charts.setOnLoadCallback(drawStacked);

function drawStacked() {
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Departamentos');
      data.addColumn('number', 'Entregados');
      data.addColumn('number', 'En Stock');

      data.addRows([
        ['abdasdasa', 925, 786],
        ['bbdasdas', 652, 156],
        ['cbdasdas', 300, 200],
        ['ddasdasb', 925, 786],
        ['edasdb', 652, 156],
        ['fasdasb', 300, 200],
        ['gdasdasdb', 925, 786],
        ['abdasdasa', 925, 786],
        ['bbdasdas', 652, 156],
        ['cbdasdas', 300, 200],
        ['ddasdasb', 925, 786],
        ['edasdb', 652, 156],
        ['fasdasb', 300, 200],
        ['gdasdasdb', 925, 786]

      ]);

      var options = {
        title: 'Motivation and Energy Level Throughout the Day',
        isStacked: true,
        height:600,
        chartArea: {
            height:300,
          top:100,
        },
        hAxis: {
          title: 'Departamentos',
          titleTextStyle: {
            color: '#FF0000',            
          },

          slantedText:true,
          slantedTextAngle:45,

        },
        vAxis: {
          title: 'Kits'
        }
      };

      var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
      chart.draw(data, options);
    } 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2011-04-05T20:19:00.350

您可以“解决”此问题的另一种可能方法是添加 x 轴：

```
chxt=x,y 
```

可以改为：

```
chxt=x,y,x 
```

（确保您对原始 x 轴所做的任何事情都应用了相同的应用）然后在一个轴上每隔一个设置标签，并在另一个 x 轴上每隔一个偏移设置一个（或每隔三分之一，具体取决于标签的长度）。

```
chx1=0:|Alpha||Gamma||Epsilon||Eta|2:||Beta||Delta||Zeta 
```

注意这两个 || 之间的空标签。这样，在您的图表上，标签会关闭轴，并且您有更多空间：

```
Alpha    Gamma    Epsilon    Eta
    Beta      Delta      Zeta 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-12-01T06:03:48.670

我还**没有**找到旋转轴的方法，但是，我所做的是缩短标签，然后创建一个图例来解释标签实际代表的内容。

单击[此处](http://chart.apis.google.com/chart?cht=bvs&chs=500x300&chd=t:50,60,80,40,20,40,30&chxt=x,y&chxl=0%3a|A|B|C|D|E|F|G&chdl=A%3DStupidTest1|B%3DStupidTest2|C%3DStupidTest3|D%3DStupidTest4|E%3DStupidTest5|F%3DStupidTest6|G%3DStupidTest7)获取示例 Google 图表。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-05-22T18:44:32.393

是的！

将 hAxis.slantedText 设置为 true，然后设置 hAxis.slantedTextAngle=90。像这样...

```
var ac = new google.visualization.ComboChart(document.getElementById('visualization'));
    ac.draw(data, {
      title : 'Equipment Performance Chart',
      isStacked:true,
      vAxis: {
        viewWindowMode: 'explicit',
        viewWindow: {
            max: 100
            },
        title: "Percentage"
        },
      hAxis: {
        title: "Area",
        slantedText:true,
        slantedTextAngle:90
        },
      seriesType: "bars",

    }); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-04-22T21:58:04.527

诀窍在于 chartArea.height = 300 和 chartArea.top = 100, height:600

```
var options = {
    title: 'Motivation and Energy Level Throughout the Day',
    isStacked: true,
    height:600,
    chartArea: {
        height:300,
        top:100,
    },
    hAxis: {
      title: 'Departamentos',
      titleTextStyle: {
        color: '#FF0000',            
      },

      slantedText:true,
      slantedTextAngle:45,

    },
    vAxis: {
      title: 'Kits'
    }
  }; 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-24T17:14:44.660

API 无论如何都没有提供获取垂直 x 轴标签（除非我错过了它，因为我也需要它）我们所做的是数据点标签和常规 x 轴标签的组合 - 不完美但有效

如果您需要更多控制权，可以尝试类似 Dundas 图表

# asp.net - asp.net cms 的日期时间

> ID：786792
> 
> 赞同：1
> 
> 时间：2009-04-24T17:10:13.503
> 
> 标签：asp.net, datetime, localization

在 asp.net Web 应用程序中处理日期时间时，我必须考虑哪些事项？

我也在使用sql server。

如何确保我不会遇到日期问题？（不想释放它然后处理它嘿嘿）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T17:16:52.300

如果您还要处理时区，您将需要考虑与 GMT 的偏移量 - 最好在您的标签中记录 GMT 时间，然后您可以为任何时区的任何人计算正确的时间

这真的取决于时间和日期的使用

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T19:51:15.987

如果您的用户都在同一个时区和国家，答案并不多……但是，如果您有一点印象或知道您将拥有跨越时区和不同国家的用户，那么有几个项目可以真正脱颖而出。

* * *

*首先*，将数据库中的所有日期时间值存储为**GMT 时间**。当它们显示给用户时，您可以从中计算出偏移量。

*其次*，不同国家的日期格式不同。它几乎每个国家（**dd-mm-yyyy**）与美国（**mm-dd-yyyy**）在这个上。您需要确保允许相应地对 UI 进行本地化。

*第三*，如果您在 Web 应用程序中使用或可能使用 JavaScript，请考虑在 Google 上搜索**Date.js**，因为您需要一些特殊的脚本来处理不同文化的日期设置。

* * *

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T17:34:07.050

解析日期时始终考虑文化，在美国我们使用 MM/DD/YYYY，但在海外通常是 DD/MM/YYYY。

DateTime 类有一个重载来接受预期的文化。用它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T20:02:24.773

这是一个非常（非常）广泛的话题。但是，如果您要处理不同的时区、不同的文化和不同的语言，您可以考虑坚持使用[ISO 标准](http://en.wikipedia.org/wiki/ISO_8601)来表示日期和时间。此外，最好将所有内容存储在同一时区，例如所有 UTC。这是一篇[很棒的文章](http://technet.microsoft.com/en-us/library/ms180878.aspx)，介绍了 technet 中与日期时间相关的所有内容。SQL Server 2008中还有一些您可能感兴趣的[新日期时间数据类型。](http://technet.microsoft.com/en-us/magazine/2008.04.datatypes.aspx?pr=blog)

# eclipse - Weblogic 带有 Eclipse 断点的速度很慢

> ID：786799
> 
> 赞同：2
> 
> 时间：2009-04-24T17:13:27.177
> 
> 标签：eclipse, weblogic, breakpoints

有时当我使用设置了断点的 Eclipse 时，我的 Weblogic 的性能很慢。有任何想法吗？

性能通常很慢 - 不仅在遇到断点时很慢。

我正在本地机器上使用 Weblogic 进行调试。

当我禁用所有断点时，一切都会立即加速。

我并不总是有这个问题。不知道为什么有时会发生。

我将 Eclipse 3.2.2 与[Forthnet](http://sourceforge.net/projects/mywl/) Eclipse WL 插件的 1.0.11 一起使用。

* * *

更新：这似乎是由于使用了方法断点（即：方法开始/退出时中断）。不知道为什么会这样，但问题来来去去取决于我是否设置了方法断点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-10-08T21:27:55.707

这似乎是由于使用了方法断点（即：方法开始/退出时中断）。不知道为什么会这样，但问题来来去去取决于我是否设置了方法断点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T20:15:52.743

检查你的堆使用情况......至少它曾经是调试使用了大量堆并且速度变慢是由于 GC 运行造成的。删除所有断点可能会允许重新声明内存。

回到几个版本（在旧的 Workshop 中，在 Eclipse 之前），您必须将调试会话限制为 2 - 3 小时，然后才需要重新启动服务器。

HTH 汤姆

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-10-12T14:20:20.947

如果你去掉方法断点，只在方法的第一行设置断点，那么问题就解决了！我不知道为什么，但它一直在为我工作！

# tomcat - log4j 与 Tomcat6

> ID：786811
> 
> 赞同：2
> 
> 时间：2009-04-24T17:17:31.003
> 
> 标签：tomcat, logging, log4j, web-applications, tomcat6

我对 Log4j 有一个特殊的问题。我们正在使用`log4j.xml`. 这很好用。我们想出了一种方法来运行 Tomcat 6，这样我们就可以在这个平台上开发并在 Weblogic 10 上部署。

我已经想出了如何`log4j.properies`使用 Tomcat 6 与使用 Tomcat 6 中的 JULI 日志记录机制的其他 JAs 一起使用。不幸的是，我的`log4j.xml`（与 Weblogic 一起使用的）无法与 Tomcat 6 一起使用。所以我被迫使用`log4j.properties`.

我无法弄清楚如何在`log4j.properties`. 所以我的问题是如何将以下`log4j.xml`条目转换为`log4j.properties`

```
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE log4j:configuration SYSTEM "log4j.dtd">

<log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/">

<appender name="vccashib" class="org.apache.log4j.DailyRollingFileAppender">
    <param name="DatePattern" value="'.'yyyy-MM-dd"/>
    <param name="File" value="vccashib_10.log"/>
    <layout class="org.apache.log4j.PatternLayout">
        <param name="ConversionPattern" value="%d{ISO8601} %t %-5p %c - %m%n"/>
    </layout>
  </appender>

  <logger name="org.hibernate">
    <level value="DEBUG"/>
    <appender-ref ref="vccashib" />
  </logger>

</log4j:configuration> 
```

因此，假设我要编写一个记录器来捕获`com.abc.xyz`层次结构中类的日志。我如何在 中表示`log4j.properties`？（我已经处理了其他值，例如附加程序的类型、DatePattern、ConversionPattern、FileName、布局等）

请注意，我已向您发送了唯一特定于问题的代码。

或者，如果您知道如何将`log4j.xml`其作为我使用 Tomcat 6 的战争档案的一部分的答案（JULI jars 已经到位并且可以很好地使用`log4j.properties`），请告诉我

请帮忙。

苏哈斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T17:46:25.163

我对你的问题并不完全清楚。我已经部署`log4j`在tomcat 6上没有问题（你能发布你在xml配置中遇到的具体问题吗？）。我不确定您所说的“我已经弄清楚如何`log4j.properies`使用 Tomcat 6 以及在 Tomcat 6 中使用 JULI 日志记录机制的其他 jars”是什么意思）。

*   配置是否在正确的位置？
*   `$TOMCAT_HOME/lib`是否从全局 tomcat ( ) 目录加载了一些 jar ？如果是这样，库可能会从全局目录而不是您的 webapp 中查找配置。

如果您只是在谈论如何在`log4j`配置中管理单独的类层次结构，则类似于：

```
log4j.rootCategory=INFO,stdout

#e.g. not interested in most stripes or spring warnings
log4j.logger.net.sourceforge.stripes=ERROR
log4j.logger.org.springframework=ERROR

log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%-d %-5p [%t] %c{1} %3x - 
%m%n

#This creates the separate log "Foo" at DEBUG level. Everythign within 
#the "com.foo" package will
# get logged here
log4j.category.com.foo=DEBUG,Foo
log4j.appender.Foo=org.apache.log4j.RollingFileAppender
log4j.appender.Foo.layout=org.apache.log4j.PatternLayout
log4j.appender.Foo.layout.ConversionPattern=%-d %-5p [%t] %c{1} %3x - %m%n
log4j.appender.DetailLogFile.File=foo.log
#this is the important line - if this isn't here the stuff in
#com.foo package will show up in both logs.
log4j.additivity.com.foo=false 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T11:43:28.647

我们正在使用带有`log4j`. 我们按照[以下手册](http://tomcat.apache.org/tomcat-6.0-doc/logging.html)在 tomcat中安装`log4j`- 它比旧版本（4.1-5.5）更复杂。我相信你应该把你`log4j.xml`的`WEB-INF/classes`目录放在你的战争中。

另一种方法是为此使用 spring 框架 - 请参阅[Log4jConfigListener 的 API](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/web/util/Log4jConfigListener.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-04T19:21:28.393

在我看来，即使使用 log4j.xml，创建日志也没有问题

我确实按照建议使用[http://tomcat.apache.org/tomcat-6.0-doc/logging.html](http://tomcat.apache.org/tomcat-6.0-doc/logging.html)来创建日志记录机制。

有趣的是，日志是在 Tomcat 6 的 bin 目录中创建的！！！这与当前工作目录有关，在我的情况下，根据某些 Catalina 设置，它似乎是 bin 目录

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-04T19:39:13.437

根据[http://boncy.org/2006_7_25_log4j_with_xml_configuration](http://boncey.org/2006_7_25_log4j_with_xml_configuration)

1.  `export CATALINA_OPTS="-Dlog4j.configuration=log4j.xml"`（我想强迫它寻找`.xml`而不是`.properties`）
2.  将`log4j.xml`文件放入`WEB-INF/classes`

我有一个类似的问题，这对我有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-06-22T13:35:20.727

下面描述的几个简单步骤将帮助您设置要初始化的 Web 应用程序的 log4j：

1）复制`log4j.xml`到您的`(TOMCAT_HOME)/CATALINA_HOME/conf`目录。我的`log4j.xml`应用程序如下所示：

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE log4j:configuration SYSTEM "log4j.dtd" >
<log4j:configuration>
 <appender name="stdout" class="org.apache.log4j.ConsoleAppender">
   <layout class="org.apache.log4j.PatternLayout">
     <param name="ConversionPattern" value="%d{ABSOLUTE}
      %5p %c{1}:%L -Preetam %m%n"/>

        </layout>
     </appender>
       <root>
        <!--   <priority value="info"></priority> -->
               <priority value="debug"></priority>
          <appender-ref ref="stdout"/>
        </root>
</log4j:configuration> 
```

2）停止tomcat

```
tomcat6 stop /var/tmp/tomcat-20120622.log (use your application specific stop.sh script) 
```

3）在`(TOMCAT_HOME)/CATALINA_HOME/conf`目录中，您将拥有该`tomcat6.conf`文件。如下所述编辑文件。如果 中没有`CATALINA_OPTS`，则`tomcat6.conf`创建一个。

```
# Settings for the CATALINA_OPTS to pick web application's log4j.xml from the specified location
CATALINA_OPTS="${CATALINA_OPTS}-Dlog4j.debug - Dlog4j.configuration=file:${CATALINA_HOME}/conf/log4j.xml" 
```

4) 使用您的应用程序特定`startup.sh`脚本启动 tomcat。

5) 就这样，你们都完成了。查看日志看tomcat是否在读取`log4j.xml`你指定的`tomcat6.conf`.

`tail -f /var/tmp/tomcat-20120622.log`

```
Jun 22, 2012 3:28:35 PM org.apache.catalina.startup.HostConfig deployDirectory
INFO: Deploying web application directory examples
Jun 22, 2012 3:28:35 PM org.apache.coyote.http11.Http11Protocol start
INFO: Starting Coyote HTTP/1.1 on http-8080
Jun 22, 2012 3:28:35 PM org.apache.jk.common.ChannelSocket init
INFO: JK: ajp13 listening on /0.0.0.0:8009
Jun 22, 2012 3:28:35 PM org.apache.jk.server.JkMain start
INFO: Jk running ID=0 time=0/12  config=null
Jun 22, 2012 3:28:35 PM org.apache.catalina.startup.Catalina start
INFO: Server startup in 547 ms
log4j: Using URL [file:/opt/otccalypso/guiadmd01/tomcat6/conf/log4j.xml] for automatic    log4j configuration.
log4j: Preferred configurator class: org.apache.log4j.xml.DOMConfigurator
log4j: System property is :null
log4j: Standard DocumentBuilderFactory search succeded.
log4j: DocumentBuilderFactory is: com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderFactoryImpl
log4j: debug attribute= "null".
log4j: Ignoring debug attribute.
log4j: Threshold ="null".
log4j: Level value for root is  [debug].
log4j: root level set to DEBUG
log4j: Class name: [org.apache.log4j.ConsoleAppender]
log4j: Parsing layout of class: "org.apache.log4j.PatternLayout"
log4j: Setting property [conversionPattern] to [%d{ABSOLUTE}        %5p %c{1}:%L -Preetam %m%n].
log4j: Adding appender named [stdout] to category [root]. 
```

# vb.net - .NET 1.1 中的 Visual Basic 添加事件

> ID：786827
> 
> 赞同：2
> 
> 时间：2009-04-24T17:23:36.170
> 
> 标签：vb.net, events

我没有像往常一样添加事件的顶部的照明螺栓。如何在 .NET 1.1 for Visual basic 2002 中添加事件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T17:38:25.807

这篇[文章](http://msdn.microsoft.com/en-us/magazine/cc163775.aspx)几乎涵盖了关于 VB.Net 1.1 事件的所有内容

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T17:40:05.130

我不知道 Visual Studio 2002 是否有这个，但是在对象的属性窗口中查看（如果这是一个表单或类似的东西），那里会有一个闪电，你可以点击查看事件，否则只需创建您的事件处理程序方法并在方法定义的末尾添加“Handles Me.SomeEvent”。

# dns - 使用“www”的优点/缺点是什么？

> ID：786828
> 
> 赞同：3
> 
> 时间：2009-04-24T17:23:52.643
> 
> 标签：dns, subdomain, naming, bare-domain

### 复制：

> [我是否应该将我的网站默认为 www.foo？](https://stackoverflow.com/questions/355217/should-i-default-my-website-to-www-foo-or-not)

* * *

老实说，我不知道“ [http://example.com](http://example.com) ”和“ [http://www.example.com](http://www.example.com) ”之间的区别是什么。

我通常总是使用较短的版本，只是为了长度而没有“www”。但我知道（认为）当用户在交替使用的版本时尝试访问站点时可能会出现 cookie 冲突。所以在我所有的网站上，我只是将“ [http://www.foo.com/bar](http://www.foo.com/bar) ”重定向到“ [http://foo.com/bar](http://foo.com/bar) ”。但是关于使用“www”有什么要说的吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-24T17:26:47.770

`www`只是一个与其他任何子域一样的子域。它本身并没有什么特别之处。当与 Internet 的大多数交互是 HTTP 以外的服务时，让 HTTP 流量使用特定的子域是有意义的。如今，绝大多数域名的存在只是为了提供 HTTP 流量，因此没有必要区分。我认为通常首选使用您所称的“较短版本”，并将 www 重定向到主域。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T17:27:25.257

www 子域是对过去有一个用于 FTP 服务器等的 ftp 子域的回忆。没有理由保留它。许多严肃的网站，包括这里的 stackoverflow.com 甚至将 www.site.com 重定向到 site.com。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-24T17:28:11.837

只需将 WWW 作为域的 CNAME 并将所有流量定向到域名

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T17:27:34.863

www 是一个子域，通常用于将 Web 服务器与运行在同一域上的其他服务器分开。可以使用其他子域，例如 ftp 或 irc。

我个人认为人们仍然使用它只是为了保持“兼容”，因为很多使用互联网的人认为 www 实际上是域名本身的一部分。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-24T17:27:44.520

是的，可能存在 cookie 冲突，我在网络论坛上看到过很多次。

至于任何一种方法的可取性，我真的不能告诉你一个比另一个更好，但我可以说（鉴于前面提到的 cookie 问题），你应该接受这两种方法，但让其中一个重定向到其他，以便所有 URL 都将使用相同的格式。

# javascript - jQuery click 方法被多次调用

> ID：786829
> 
> 赞同：1
> 
> 时间：2009-04-24T17:25:22.653
> 
> 标签：javascript, jquery

我正在为我的动画插件实现一个点击按钮，但我发现了一个问题。如果我单击按钮太多次，元素就会失控。我将只显示代码：

```
options.prev.click(function() {
            $(this)
                .siblings()
                .filter('img')
                .slice(0, 1)
                .effect('drop', {direction: 'left'}, 1000)
                .unbind('click');
        }) 
```

基本上，如果用户单击按钮，则会为第一个元素提供拖放效果。但是如果用户点击次数过多。所有元素都将被切片，然后所有元素都将具有我没有预料到的下降效果。

我希望这个效果能够顺利运行，无论用户点击多少次按钮，只有第一个元素会有下降效果。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T17:31:57.380

如果您只打算让这种情况发生一次，您应该首先将您的 unbind 向上移动，以便单击停止立即响应进一步的事件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T17:36:16.670

jQuery 有一个称为**[one](http://docs.jquery.com/Events/one#typedatafn)**的事件挂钩，它允许您为每个匹配的元素只执行一次事件。

似乎非常适合这种情况。

# asp.net - 在场中的服务器之间使用视图状态

> ID：786832
> 
> 赞同：1
> 
> 时间：2009-04-24T17:26:31.030
> 
> 标签：asp.net, iis

使用 Asp.net 2.0 在 Server1 上生成的视图状态是否可以由同一场中的 server2 使用？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T17:30:48.303

是的你可以。有几个选项可以确保您的视图状态可以在场中的每台服务器上进行解码。通常，您在每个服务器上手动设置每个 machine.config 中的 machineKey，因此它们都是相同的。 [但也有其他选择。](http://www.codinghorror.com/blog/archives/000132.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T17:27:33.210

只要防篡改/MAC被关闭，我相信它可以。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T17:29:34.173

是的，您在 web.config 中的“machineKey”设置在每台服务器上必须相同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T17:30:28.680

在所有节点上使用相同的 machineKey。将它放在 machine.config 或 web.config 中

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-24T17:36:33.313

阅读本文：[如何：在 ASP.NET 2.0 中配置 MachineKey](http://msdn.microsoft.com/en-us/library/ms998288.aspx)

基本上，您使用以下代码：

```
using System;
using System.Text;
using System.Security;
using System.Security.Cryptography;

class App {
  static void Main(string[] argv) {
    int len = 128;
    if (argv.Length > 0)
      len = int.Parse(argv[0]);
    byte[] buff = new byte[len/2];
    RNGCryptoServiceProvider rng = new 
                            RNGCryptoServiceProvider();
    rng.GetBytes(buff);
    StringBuilder sb = new StringBuilder(len);
    for (int i=0; i<buff.Length; i++)
      sb.Append(string.Format("{0:X2}", buff[i]));
    Console.WriteLine(sb);
  }
} 
```

生成在您的场中共享的机器密钥。

# java - Struts 2 中的注解支持

> ID：786840
> 
> 赞同：2
> 
> 时间：2009-04-24T17:27:59.513
> 
> 标签：java, struts2, web-frameworks

我目前正在评估 Struts 2。官方文档包含一个带有以下 Java 和 JSP 代码的 HelloWorld 示例：

爪哇

```
import com.opensymphony.xwork2.ActionSupport;

public class HelloWorld extends ActionSupport {

    public static final String MESSAGE = "Struts is up and running ...";

    public String execute() throws Exception {
        setMessage(MESSAGE);
        return SUCCESS;
    }

    private String message;

    public void setMessage(String message){
        this.message = message;
    }

    public String getMessage() {
        return message;
    }
} 
```

JSP

```
<%@ taglib prefix="s" uri="/struts-tags" %>

<html>
    <head>
        <title>Hello World!</title>
    </head>
    <body>
        <h2><s:property value="message" /></h2>
    </body>
</html> 
```

该示例使用以下 XML 文件指定此操作的 URL，并将操作和视图绑定在一起

```
<!DOCTYPE struts PUBLIC "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
    "http://struts.apache.org/dtds/struts-2.0.dtd">
<struts>
    <package name="tutorial" extends="struts-default">
        <action name="HelloWorld" class="tutorial.HelloWorld">
            <result>/HelloWorld.jsp</result>
        </action>
    </package>
</struts> 
```

我的问题（最后）是：这真的是 Struts2 的最新技术吗？我一直认为 XML 配置和子类化特定基类 (ActionSupport) 的必要性已被弃用。我认为注释可以用于配置。

几个更具体的问题：

*   是否需要为每种请求类型设置一个 Action 类，或者是否可以在一个 eaction 中定义多个方法，每个方法可以处理不同的请求？
*   是否有必要为要提供给视图的数据成员（上例中的“消息”）定义公共 getter 和 setter？

如果这是 Struts2 中的最新技术，那么它似乎对 Struts1 没有太大的改进，但我怀疑这只是一个不好的例子。

谢谢，唐

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-26T16:42:13.600

很抱歉缺少资源，但我无法在此处复制和粘贴这些资源。

但这应该让您对 2.1.x 功能有所了解。

struts.xml：

```
<!DOCTYPE struts PUBLIC 
    "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
    "http://struts.apache.org/dtds/struts-2.0.dtd">
<struts>
    <!-- Include webwork default (from the Struts JAR). -->
    <include file="struts-default.xml"/>
    <!-- Configuration for the default package. -->
    <package name="default" extends="struts-default">
        <interceptors>
            <interceptor name="appLogin" class="us.pdinc.client.com.usgoldnetwork.support.struts.LoginInterceptor" />   
            <interceptor-stack name="loginStack">
                <interceptor-ref name="appLogin"/>
                <interceptor-ref name="paramsPrepareParamsStack"/>
            </interceptor-stack>
        </interceptors>     
        <!-- Default interceptor stack. -->
        <default-interceptor-ref name="loginStack"/>        
        <global-results>
            <result name="login">/WEB-INF/jsp/login-input.jsp</result>
        </global-results>
    </package>
</struts>
<!--  http://struts.apache.org/2.1.6/docs/convention-plugin.html  --> 
```

struts.properties：

```
struts.custom.i18n.resources=guest
struts.convention.result.path=/WEB-INF/jsp
struts.ognl.allowStaticMethodAccess=true 
```

AddrAction.java

```
 package us.pdinc.client.com.usgoldnetwork.action;

import java.util.List;

import javax.servlet.http.HttpServletRequest;

import org.apache.struts2.convention.annotation.Result;
import org.apache.struts2.convention.annotation.Results;
import org.apache.struts2.interceptor.ServletRequestAware;
import org.hibernate.Session;
import org.hibernate.Transaction;

import us.pdinc.client.com.usgoldnetwork.beans.model.hibernate.Addr;
import us.pdinc.client.com.usgoldnetwork.beans.model.hibernate.AddrType;
import us.pdinc.client.com.usgoldnetwork.beans.model.hibernate.Tx;
import us.pdinc.client.com.usgoldnetwork.servlet.support.RequestScopeHibernateSession;

import com.opensymphony.xwork2.ActionSupport;
import com.opensymphony.xwork2.Preparable;

@Results({
      @Result(name="list", type="redirect", location="/addr", params={"transaction.id","${transaction.id}"})
    })
public class AddrAction extends ActionSupport implements Preparable , ServletRequestAware 
{
    private static final long serialVersionUID = 1L;

    private List<Addr> addrs;
    private List<AddrType> addrTypes;
    private List<Tx> txs;
    private Addr addr;
    private AddrType addrtype;
    private HttpServletRequest httpServletRequest;
    private Tx transaction;
    long txId = 0;

    @Override
    public void prepare() throws Exception
    {
        if (addr!=null && addr.getId()!=null) 
            {
                Session session = RequestScopeHibernateSession.getSession(httpServletRequest);
                addr=(Addr) session.get(Addr.class, addr.getId());
            }
    }

    public String index()
    {
        return list();
    }

    public String list()
    {
        System.out.println("LIST");
        if (transaction==null)throw new RuntimeException();
        if (transaction.getId()==null) throw new RuntimeException();
        if (transaction.getId()<=0) throw new RuntimeException();
        Session session = RequestScopeHibernateSession.getSession(httpServletRequest);
        transaction=(Tx)session.get(Tx.class, transaction.getId());
        addrs=transaction.getAddrs();

        return SUCCESS;
    }

    public String input() 
    {
        Session session = RequestScopeHibernateSession.getSession(httpServletRequest);
        addrTypes=session.createCriteria(AddrType.class).list();
        //txs = session.createCriteria(Tx.class).list();
        return INPUT;
    }

    public String save() 
    {
        System.out.println("SAVE");

        if(transaction != null && transaction.getId() != null){
            txId = transaction.getId();
        }
        if(addr != null && addr.getTx() != null && addr.getTx().getId() != null){
            txId = addr.getTx().getId();
        }
        /*if (transaction==null || addr == null)throw new RuntimeException();
        System.out.println("******************************************************************");
        System.out.println("Transaction value ==" + transaction);
        System.out.println("Addr value ==" + addr);
        if (addr.getTx() == null) throw new RuntimeException();
        System.out.println("Transaction ID value ==" + transaction.getId());
        System.out.println("Addr Transaction value ==" + addr.getTx());
        if ( addr.getTx().getId() == null ) throw new RuntimeException();
        System.out.println("********************************************************************");
        System.out.println("Addr Transaction ID value ==" + addr.getTx().getId());*/

        Session session = RequestScopeHibernateSession.getSession(httpServletRequest);
        transaction=(Tx)session.get(Tx.class, txId);
        //String addrTypeId = httpServletRequest.getParameter("addr.addrType.id");
        //Long Id = Long.valueOf(addrTypeId);
        addrtype=(AddrType) session.get(AddrType.class, addr.getAddrType().getId());
        if (addr.getId()==null)
        {   
            System.out.println("Addr is null");
            addr.setTx(transaction);
            addr.setAddrType(addrtype);
            Transaction tx = session.getTransaction();
            tx.begin();
            session.save(transaction);
            session.persist(addr);
            tx.commit();
        }
        else
        {
            System.out.println("Addr is not null");
            Transaction tx = session.getTransaction();
            tx.begin();
            session.update(addr);
            tx.commit();        
        }
        return "list";
    }

    public String delete() 
    {
        Session session = RequestScopeHibernateSession.getSession(httpServletRequest);
        Transaction tx = session.getTransaction();
        tx.begin();
        session.delete(session.get(Addr.class, addr.getId()));
        tx.commit();        
        return "list";
    }

    @Override
    public void setServletRequest(HttpServletRequest arg0)
    {
        httpServletRequest=arg0; 
    }

    public Addr getAddr()
    {
        return addr;
    }

    public void setAddr(Addr addr)
    {
        this.addr = addr;
    }

    public List<Addr> getAddrs()
    {
        return addrs;
    }

    public List<AddrType> getAddrTypes()
    {
        return addrTypes;
    }

    public List<Tx> getTxs()
    {
        return txs;
    }

    public Tx getTransaction() {
        return transaction;
    }

    public void setTransaction(Tx transaction) {
        this.transaction = transaction;
    }

} 
```

addr.jsp：

```
<%@ page language="java" contentType="text/html;charset=UTF-8" pageEncoding="ISO-8859-1"%>
<%@ taglib prefix="s" uri="/struts-tags" %>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <link href="<s:url value='/css/main.css'/>" rel="stylesheet" type="text/css"/>
    <title>Addresses Screen</title>
       <jsp:include page = "barcodeextractor.jsp" />
</head>
<body>
<div class="titleDiv">USGN Core Process</div>
<h1>Addresses</h1>
<s:url id="url" action="addr!input" >
<s:param name="transaction.id" value="transaction.id" />
</s:url>
<a href="<s:property value="#url"/>">Add New Address</a>
<br/><br/>
<table class="borderAll">
    <tr>
        <th>Customer</th>
        <th>Name</th>
        <th>Type</th>
        <th>Street 1</th>
        <th>Street 2</th>
        <th>Street 3</th>
        <th>Street 4</th>
        <th>Street 5</th>
        <th>Street 6</th>
        <th>City</th>
        <th>State</th>
        <th>Postal</th>
        <th>Country</th>
        <th>&nbsp;</th>
    </tr>
    <s:iterator value="addrs" status="status">
        <tr class="<s:if test="#status.even">even</s:if><s:else>odd</s:else>">
            <td class="nowrap"><s:property value="tx.id"/></td>
            <td class="nowrap"><s:property value="name"/></td>
            <td class="nowrap"><s:property value="addrType.addrType"/></td>
            <td class="nowrap"><s:property value="street1"/></td>
            <td class="nowrap"><s:property value="street2"/></td>
            <td class="nowrap"><s:property value="street3"/></td>
            <td class="nowrap"><s:property value="street4"/></td>
            <td class="nowrap"><s:property value="street5"/></td>
            <td class="nowrap"><s:property value="street6"/></td>
            <td class="nowrap"><s:property value="city"/></td>
            <td class="nowrap"><s:property value="state"/></td>
            <td class="nowrap"><s:property value="postal"/></td>
            <td class="nowrap"><s:property value="country"/></td>
            <td class="nowrap">
                <s:url action="addr!input" id="url">
                    <s:param name="addr.id" value="id"/>
                </s:url>
                <a href="<s:property value="#url"/>">Edit</a>
                &nbsp;&nbsp;&nbsp;
                <s:url action="addr!delete" id="url" >
                    <s:param name="addr.id" value="id"/>
                </s:url>
                <a href="<s:property value="#url"/>">Delete</a>
            </td>
        </tr>
    </s:iterator>
    </table>
</body>
</html> 
```

地址输入.jsp：

```
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="s" uri="/struts-tags" %>
<s:if test="addr==null || addr.id == null">
    <s:set name="title" value="%{'Add new contact type'}"/>
</s:if>
<s:else>
    <s:set name="title" value="%{'Update contact type'}"/>
</s:else>

<html>
<head>
    <link href="<s:url value='/css/main.css'/>" rel="stylesheet" type="text/css"/>
    <style>td { white-space:nowrap; }</style>
    <title><s:property value="#title"/></title>
     <jsp:include page = "barcodeextractor.jsp" />
</head>
<body>
<div class="titleDiv">USGN Core Process</div>
<h1><s:property value="#title"/></h1>
<s:actionerror />
<s:actionmessage />
<s:form action="addr!save" method="post">
    <s:select name="addr.addrType.id" label="Address Type" list="addrTypes" listKey="id" listValue="addrType" value="%{addr.addrType.id}"/>
    <s:textfield name="addr.name" value="%{addr.name}" label="Name" size="40"/>
    <s:textfield name="addr.street1" value="%{addr.street1}" label="Street 1" size="40"/>
    <s:textfield name="addr.street2" value="%{addr.street2}" label="Street 2" size="40"/>
    <s:textfield name="addr.street3" value="%{addr.street3}" label="Street 3" size="40"/>
    <s:textfield name="addr.street4" value="%{addr.street4}" label="Street 4" size="40"/>
    <s:textfield name="addr.street5" value="%{addr.street5}" label="Street 5" size="40"/>
    <s:textfield name="addr.street6" value="%{addr.street6}" label="Street 6" size="40"/>
    <s:textfield name="addr.city" value="%{addr.city}" label="City" size="40"/>
    <s:textfield name="addr.state" value="%{addr.state}" label="State" size="40"/>
    <s:textfield name="addr.postal" value="%{addr.postal}" label="Postal" size="40"/>
    <s:textfield name="addr.country" value="%{addr.country}" label="Country" size="40"/>
    <s:hidden name="addr.id" value="%{addr.id}"/>
    <s:hidden name="transaction.id" value="%{transaction.id}"/>
    <s:submit value="Submit"/>
    <s:submit value="Cancel" name="redirectAction:addr!list"/>
</s:form>
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T17:46:04.743

一些答案（不是全部）：

*   您可以将多个方法添加到同一个 Action 类。每个都需要返回一个字符串。
*   我认为需要公共 getter 和 setter。
*   提供的基类只定义了某些有用的值，例如常量 SUCCESS。

您可以通过“零配置”功能（[零配置文档](http://struts.apache.org/2.0.14/docs/zero-configuration.html)）使用注释

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T18:36:52.170

这个例子是老式的struts2。正如@pgb 所说，您几乎可以对所有内容使用注释。

还有 2 种不同风格的配置可供选择；一种叫“约定”，一种叫“注解”。约定受 Rails 影响，并通过路径/命名在操作和结果之间创建默认绑定。使用注释可以声明所有内容，就像使用 xml 一样，但仅限于控制器类中。我发现两者都是很好的简化，并且目前只为大型站点运行一个很小的 ​​xml 文件。

# visual-studio - 在 VisualStudio 中如何处理多个打开的同名文件？

> ID：786864
> 
> 赞同：7
> 
> 时间：2009-04-24T17:34:38.187
> 
> 标签：visual-studio

当您打开一堆名称相同的文件时，任何人都知道 VisualStudio 中有什么可以让您的生活更轻松吗？很多时候我会打开一堆同名的文件，我不知道有什么方法可以区分它们，所以我只需要通过解决方案资源管理器。是否有设置为这个愚蠢的东西的完整路径添加悬停文本？

[替代文字 http://img518.imageshack.us/img518/2094/91544289.png](http://img518.imageshack.us/img518/2094/91544289.png)

这与 Visual Studio 的问题不太一样 [——管理许多打开文件的工作的技巧](https://stackoverflow.com/questions/299437/visual-studio-tips-for-managing-work-on-many-open-files)

我知道 ctrl-tab 给出了完整路径，但它仍然有点麻烦，因为你必须四处箭头才能看到完整路径，而且当有很多文件打开时，它并不比使用解决方案资源管理器快。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-24T17:35:24.050

我将鼠标悬停在选项卡上，它显示了文件目录。

此外，由于您使用的是 Resharper，您可以使用此键盘快捷键，它会在解决方案资源管理器中突出显示该文件。

> `Alt`+ `Shift`+`L`

由于您使用的是 Resharper，因此您可以使用它的导航而不是 Visual Studio 的导航。在此示例中，您正在寻找 Default.aspx

> `Ctrl`+ `Shift`+`N`

该快捷方式将显示其文件搜索屏幕。键入“Def”并根据您想要的文件夹选择一个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T17:42:28.090

尝试右键单击代码窗口上方选项卡旁边的空白区域。您将看到一些新“选项卡组”的选项，您可以选择水平或垂直。

If you have enough monitor space, you should be able to keep your similarly named files in different areas.

Good luck!

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T18:19:37.830

If you hit Ctrl+Tab it will bring open a document list with preview and the full file path.

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-24T17:51:53.510

If possible at all, avoid having duplicate names. Not only that navigation might be confusing, it might get even worse.

I have experienced rather strange behavior with duplicate file names within the same solution, both with Visual Studio (e.g. when debugging) and especially with third party tools, which were not able to distinguish between the files.

It seemed to me that this is especially a problem with resource file names and project names.

# .net - 除非最终用户有 VS2008，否则 ClickOnce 下载失败

> ID：786870
> 
> 赞同：3
> 
> 时间：2009-04-24T17:37:22.750
> 
> 标签：.net, .net-3.5, deployment, clickonce

我仍在处理[此处](https://stackoverflow.com/questions/760920/clickonce-deployment-error-on-upgraded-net-application)描述的问题，试图让 ClickOnce 从 Visual Studio 2008 中工作。我最初认为问题与我正在部署的应用程序是从 2005 年升级的事实有关。但事实并非如此。我创建了一个新的 VS2008 应用程序并以相同的结果部署它。

我已经尝试过（我认为）所有可能的发布设置组合（除了签署清单，我不需要这样做，因为我正在通过 Intranet 进行部署）。大多数用户都会收到相同的信息。

*无法继续。应用程序格式不正确。请联系应用程序供应商寻求帮助。*

我让另一个拥有 VS2008 的开发人员尝试打开该应用程序，它对他有用。其他未从 2005 升级的用户会收到错误消息。我的目标是 3.5，并且 3.5 框架包含在先决条件中。

用户已经安装了 3.5 框架。我想知道它是否安装不完整或不正确。谁能想到没有安装 VS2008 的用户无法运行 VS2008 生成的 ClickOnce 应用程序的任何其他原因？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T13:01:09.637

对于“应用程序验证未成功。无法继续”。错误，这就是我所做的：查看 ClickOnce 错误日志，我看到了消息

> 强名称签名对此程序集无效。

就我而言，此错误与“延迟签名”的 Microsoft.mshtml.dll 有关。在网上搜索我在*[Microsoft.mshtml .dll 问题中找到了解决方案......以及解决方案！](http://peitor.blogspot.com/2007/12/microsoftmshtml-dll-problems-und.html)*. 我刚刚下载了上面链接中提到的文件并将项目中的引用更改为指向下载的DLL文件（在Visual Studio 2005中：右键单击项目->单击左侧选项卡中的“引用”->删除旧的引用 DLL 并添加新的）。

我希望它可以帮助某人...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T02:57:30.660

事实证明，PC 上安装的不是完整的 .NET 3.5 框架。此外，我们的系统管理员不希望我们使用 ClickOnce。所以我认为问题几乎肯定出在环境中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T18:10:01.283

> *无法继续。应用程序格式不正确。请联系应用程序发布者寻求帮助。*
> 
> *应用程序验证未成功。无法继续。*
> 
> *无法检索应用程序文件。文件在部署中损坏。*
> 
> 部署中的清单文件之一在语法上无效，或者包含无法与相应文件协调的哈希。此错误还可能表明嵌入在程序集中的清单已损坏。重新创建部署并重新编译应用程序，或者在清单中手动查找并修复错误。

从[ClickOnce 部署故障排除](http://msdn.microsoft.com/en-us/library/ms229001.aspx)

也许清单文件搞砸了？

检查您的引用以确保您没有循环引用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-24T02:52:19.183

*[我在安装 VS2008 后使用“mshtml.dll 问题](http://www.pcreview.co.uk/forums/thread-3419651.php)*”中提到的“复制本地”技巧解决了这个问题。

# jquery - jquery插件通知用户促销

> ID：786874
> 
> 赞同：0
> 
> 时间：2009-04-24T17:38:00.067
> 
> 标签：jquery

我正在寻找一个好的弹出窗口，或者向下滑动，或者任何通知用户促销的东西（想想商店）。我曾经看到过类似的东西，但我再也找不到链接了。

我在寻找“性感”的东西，所以它会吸引用户的注意力，但*不会妨碍事情*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T18:01:51.617

[jQuery Growl 插件](http://plugins.jquery.com/project/Growl)怎么样？它不是模态的，但会显示通知。

这是[演示页面](http://projects.zoulcreations.com/jquery/growl/)

我也使用了[jQuery BlockUI](http://malsup.com/jquery/block/)的咆哮实现。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T18:02:31.210

[jGrowl](https://github.com/stanlemon/jGrowl)是惊人的。我用它来通知用户最近对我网站中特定页面的更改。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-24T18:32:59.857

幻灯片有什么问题？你可以随心所欲地设计风格。

```
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js" type="text/javascript">
</script>

<script type="text/javascript">
$(document).ready(
    function() {
        $("#show").click(function() {
            $("#slide").slideToggle();
        }
        )
    }
); 
</script>

<style>
#slide
{
    height: 30px;
    width: 100%;
    text-align: center;
    vertical-align: middle;
    background-color: Red;
    color: White;
    display: none;
    top:0px;
}
</style>
<div id="slide" style="">
    Super Sexy promotion!
</div>
<a id="show" href="#">toggle</a>` 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T18:11:56.757

我见过使用[Page Peel](http://www.smartredfox.com/2008/12/corner-page-peel-advert-with-jquery/)效果来宣传促销的网站。

我认为它非常吸引人，并且可以很好地吸引用户的注意力。这是一个[演示](http://www.smartredfox.com/test/index.htm)。

# ruby - 如何有效地提取 Ruby 数组中的重复元素？

> ID：786879
> 
> 赞同：6
> 
> 时间：2009-04-24T17:39:04.760
> 
> 标签：ruby, arrays, count, elements

我有一个类似 [1,1,1,2,4,6,3,3] 的数组，我想获取重复元素的列表，在本例中为 [1,3]。我写了这个：

```
my_array.select{|obj|my_array.count(obj)>1}.uniq 
```

但可悲的是效率低下（o（n²））。你有更好的主意吗？如果可能的话简明扼要。

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-24T18:49:26.680

灵感来自 Ilya Haykinson 的回答：

```
def repeated(array)
  counts = Hash.new(0)
  array.each{|val|counts[val]+=1}
  counts.reject{|val,count|count==1}.keys
end 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-24T18:09:02.083

使用 Ruby 的[Set](http://www.ruby-doc.org/stdlib/libdoc/set/rdoc/index.html)库：

```
require 'set'

ary = [1,1,1,2,4,6,3,3]
dups = Set.new
test_set = Set.new
ary.each {|val| dups.add(val) unless test_set.add?(val)}
dups.to_a # [1, 3] 
```

我相信这应该是 O(n)，因为 Set#add 和 Set#add? 据我所知，是恒定时间操作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-24T18:34:31.910

这样的事情怎么样？它将在 O(n) 中运行。

```
a = [1,1,1,2,4,6,3,3]
b = {}
a.each { |v| if b.has_key? v then b[v] = b[v]+1 else b[v]=1 end }
b.reject { |k,v| if v > 1 then false else true end }.keys 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-12-10T19:00:26.390

AO(n) 解决方案（更改`<< x`为`+ [x]`并`update`使其`merge`成为纯功能）：

```
rs = xs.inject([[], {}]) do |(out, seen), x| 
  [(seen[x] == 1 ? (out << x) : out), seen.update(x => (seen[x] || 0)+1)]
end[0] 
```

一种更简单但空间效率更低的方法：

```
rs = xs.group_by { |x| x }.select { |y, ys| ys.size > 1 }.keys 
```

使用“列表理解”避免中间散列的相同想法：

```
rs = xs.group_by { |x| x }.map { |y, ys| y if ys.size > 1 }.compact 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-07-19T18:59:23.387

使用`inject`

```
[1,1,1,2,4,6,3,3].inject({}){ |ele, n| ele[n] = nil; ele }.keys 
# => [1, 2, 4, 6, 3] 
```

### 解释：

`ele`hash 它被初始化为`{}`，每次迭代都会将一个带有数字`n`和`nil`值的键添加到`ele`哈希中。最后`ele`返回为：

```
{1=>nil, 2=>nil, 4=>nil, 6=>nil, 3=>nil} 
```

我们只想要钥匙，所以`.keys`结束工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-24T17:45:17.443

一些想法：您必须找出正确的库数据结构：

> **1**对数组排序O(nlogn)，然后遍历数组
> 
> **2**创建一个集合，在集合中搜索当前数组元素，如果没有找到，插入并继续查找所有元素 - 再次 O(nlogn)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-18T06:05:22.127

我正在考虑计算一个唯一元素在数组中出现的次数。就像最初的建议一样，它可能真的效率低下，但看这个问题很有趣。我没有在更大的阵列上做任何基准测试，所以这只是一个练习。

```
a = [1,1,1,2,4,6,3,3]

dupes = []
a.uniq.each do |u|
  c = a.find_all {|e| e == u}.size
  dupes << [u, c] unless c == 1
end

puts dupes.inspect

# dupes = [[1, 3], [3, 2]]
# 1 appears 3 times
# 3 appears twice

# to extract just the elment a bit cleaner
dupes = a.uniq.select do |u|
  a.find_all {|e| e == u}.size != 1
end
puts dupes.inspect
# returns [1,3] 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-18T06:45:20.317

如果重复的条目总是连续的，这将起作用，如您的示例所示；否则你必须先排序。each_cons 检查指定大小的滚动窗口。

```
require 'set'

my_array = [1,1,1,2,4,6,3,3]
dups = Set.new
my_array.each_cons(2) {|a,b| dups.add(a) if (a == b)}
p dups.to_a 
```

# python - 我尝试在 Python 中进行字符串替换操作有什么问题？

> ID：786881
> 
> 赞同：2
> 
> 时间：2009-04-24T17:39:56.380
> 
> 标签：python

我在这里做错了什么？

```
import re
x = "The sky is red"
r = re.compile ("red")
y = r.sub(x, "blue")
print x  # Prints "The sky is red"
print y  # Prints "blue" 
```

我如何让它打印“天空是蓝色的”？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-24T17:46:05.537

您的代码的问题是 re 模块中有两个子函数。一种是通用的，一种与正则表达式对象相关联。您的代码不遵循任何一个：

这两种方法是：

`re.sub(pattern, repl, string[, count])` [（此处的文档）](http://docs.python.org/library/re.html#re.sub)

像这样使用：

```
>>> y = re.sub(r, 'blue', x)
>>> y
'The sky is blue' 
```

当你事先编译它时，正如你所尝试的那样，你可以使用：

`RegexObject.sub(repl, string[, count=0])` [（此处的文档）](http://docs.python.org/library/re.html#re.RegexObject.sub)

像这样使用：

```
>>> z = r.sub('blue', x)
>>> z
'The sky is blue' 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-24T17:50:36.090

你读错了 API

[http://docs.python.org/library/re.html#re.sub](http://docs.python.org/library/re.html#re.sub)

pattern.sub(repl, string[, count])¶

```
r.sub(x, "blue")
# should be
r.sub("blue", x) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-24T17:50:41.610

您对`sub`错误的调用方式有争论，应该是：

```
 import re
x = "The sky is red"
r = re.compile ("red")
y = r.sub("blue", x)
print x  # Prints "The sky is red"
print y  # Prints "The sky is blue" 

```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-26T01:25:09.450

顺便说一句，对于这样一个简单的示例，该`re`模块是多余的：

```
x= "The sky is red"
y= x.replace("red", "blue")
print y 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-24T17:42:06.110

尝试：

```
x = r.sub("blue", x) 
```

# c# - 我的延迟加载方法有缺陷吗？

> ID：786885
> 
> 赞同：0
> 
> 时间：2009-04-24T17:41:05.130
> 
> 标签：c#, resharper, lazy-loading, warnings

**平台**：带有 Resharper 4.1、.NET 3.5 的 Visual Studio 2008 SP1

我有一个带有静态方法的类，`GetProperty<T>`它懒惰地返回一个属性值。

```
private static T GetProperty<T>(T backingField, Func<T> factory) 
    where T : class 
{
    if (backingField == null)
        backingField = factory();
    return backingField;
} 
```

但是，当我使用上述方法返回属性时，我收到两个警告，指出未分配私有支持字段。但只有在需要时才会分配它们。

![替代文字](https://farm4.static.flickr.com/3616/3470693703_71b6cc553b_o.png)

这个警告*可以忽略*吗？
-- 或者 --
我加载属性的方法有缺陷吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-24T17:44:26.523

你的方法有缺陷。要采用这种方法，您需要创建`backingField`一个`ref`参数。

```
private static T GetProperty<T>(ref T backingField, Func<T> factory) 
```

然后`GetProperty`，通过`ref _ImagXpress`或`ref _PdfXpress`。

您现在执行的方式只是为参数分配一个新值，而不是实际的支持字段。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-24T17:46:27.957

你的方法有缺陷。你的领域永远不会被设置为任何东西。该`backingField`参数正在`GetProperty<T>`方法中设置，但这不会更新您传入的字段。您需要传入带有`ref`附加关键字的参数，如下所示：

```
private static T GetProperty<T>(ref T backingField, Func<T> factory) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-24T18:16:49.350

正如我在另一个答案的评论中所说，对 ref 参数的需求是代码异味。首先，如果你在一个方法中这样做，你就打破了单一责任原则，但更重要的是，代码只能在你的继承层次结构中重用。

这里有一个模式可以推导出来：

```
public class LazyInit<T>
    where T : class
{
    private readonly Func<T> _creationMethod;
    private readonly object syncRoot;
    private T _instance;

    [DebuggerHidden]
    private LazyInit()
    {
        syncRoot = new object();
    }

    [DebuggerHidden]
    public LazyInit(Func<T> creationMethod)
        : this()
    {
        _creationMethod = creationMethod;
    }

    public T Instance
    {
        [DebuggerHidden]
        get
        {
            lock (syncRoot)
            {
                if (_instance == null)
                    _instance = _creationMethod();
                return _instance;
            }
        }
    }

    public static LazyInit<T> Create<U>() where U : class, T, new()
    {
        return new LazyInit<T>(() => new U());
    }

    [DebuggerHidden]
    public static implicit operator LazyInit<T>(Func<T> function)
    {
        return new LazyInit<T>(function);
    }
} 
```

这使您可以这样做：

```
public class Foo
{
    private readonly LazyInit<Bar> _bar1 = LazyInit<Bar>.Create<Bar>();
    private readonly LazyInit<Bar> _bar2 = new LazyInit<Bar>(() => new Bar("foo"));

    public Bar Bar1
    {
        get { return _bar1.Instance; }
    }

    public Bar Bar2
    {
        get { return _bar2.Instance; }
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T17:55:24.923

提出不同的解决方案：

我想说的是，通过将该逻辑封装到一个单独的方法中，您并没有节省很多。您正在增加复杂性而没有太多收获。我建议这样做：

```
protected PdfXpress PdfXpress
{
    get
    {
        if (_PdfXpress == null)
            _PdfXpress = PdfXpressSupport.Create();

        return _PdfXpress;
    }
}

protected ImagXpress ImagXpress
{
    get
    {
        if (_ImagXpress == null)
            _ImagXpress = IMagXpressSupport.Create();

        return _ImagXpress;
    }
} 
```

您添加了几行，但大大降低了复杂性。

# c# - 在 LINQ to SQL 中查找或创建对象的通用方法？

> ID：786890
> 
> 赞同：3
> 
> 时间：2009-04-24T17:43:04.360
> 
> 标签：c#, linq, linq-to-sql

[在我的LINQ to SQL](http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL_.28formerly_called_DLINQ.29)代码中，我经常需要“查找或创建”这样的实体：

```
var invoiceDb = ctx.Invoices.FirstOrDefault(a => a.InvoicerId == InvoicerId &&
                                                 a.Number == invoiceNumber);
if (invoiceDb == null)
{
    invoiceDb = new Invoice();
    invoiceDb.Number = invoiceNumber;
    ctx.Invoices.InsertOnSubmit(invoiceDb);
} 
```

我正在寻找使其成为一种通用方法...有什么好主意吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T17:55:44.860

我想出了这些似乎对我很有效的扩展方法。

```
 public static T FindOrCreate<T>(this Table<T> table, Func<T, bool> find, Action<T> create) where T : class, new()
    {
        T val = table.FirstOrDefault(find);
        if (val == null)
        {
            val = new T();
            create(val);
            table.InsertOnSubmit(val);
        }
        return val;
    }

    public static T FindOrCreate<T>(this Table<T> table, Func<T, bool> find) where T : class, new()
    {
        return FindOrCreate(table, find, a => { });
    } 
```

它是这样使用的：

```
 var invoiceDb = ctx.Invoices.FindOrCreate(a => a.InvoicerId == InvoicerId &&
                                                     a.Number == invoiceNumber);
    invoiceDb.Number = invoiceNumber; 
```

或者

```
 var invoiceDb = ctx.Invoices.FindOrCreate(a => a.InvoicerId == InvoicerId &&
                                                     a.Number == invoiceNumber,
                                              a => a.Number = invoiceNumber); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-05T13:53:11.807

VB.NET 版本：

```
Module dbi
    <System.Runtime.CompilerServices.Extension()> _
    Public Function FindOrCreate( _
        Of T As {Class, New})(ByVal table As Data.Linq.Table(Of T), _
        ByVal find As Func(Of T, Boolean), _
        ByVal create As Action(Of T)) _
        As T

        Dim val As T = table.FirstOrDefault(find)
        If val Is Nothing Then
            val = New T()
            create(val)
            table.InsertOnSubmit(val)
        End If
        Return val
    End Function

    <System.Runtime.CompilerServices.Extension()> _
    Public Function FindOrCreate( _
        Of T As {Class, New})(ByVal table As Data.Linq.Table(Of T), _
        ByVal find As Func(Of T, Boolean)) _
        As T

        Return FindOrCreate(table, find, Function(a))
    End Function

End Module 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-26T02:02:12.623

如何使用这样的扩展方法：

```
public static T FirstOrCreate<T>(this IEnumerable<T> source) where T : class, new()
{
    var result = source.FirstOrDefault();
    return result != null ? result : new T();
} 
```

如果你希望它能够接受一个谓词，你可以使用这个定义：

```
public static T FirstOrCreate<T>(this IQueryable<T> source, Expression<Func<T, bool>> predicate) where T : class, new()
{
    var result = source.FirstOrDefault(predicate);
    return result != null ? result : new T();
} 
```

这样你就可以像这样使用它来代替 FirstOrDefault() ：

```
Invoice selectedInvoice = (from i in Invoices
                           where i.ID == invoiceID
                           select i).FirstOrCreate(); 
```

..或使用谓词：

```
Invoice selectedInvoice = db.Invoices.FirstOrCreate(i => i.ID == invoiceID); 
```

将返回匹配的实体或新的（非空）实体。

编辑：我今天一直在考虑这个问题，我突然想到上面将要求您检测实体是新的（不存在的）并将其附加到 DataContext，所以我想出了这个折衷方案，使用相同的方法：

```
public static T FirstOrCreate<T>(this IEnumerable<T> source, DataClassesDataContext db) where T : class, new()
{
    var result = source.FirstOrDefault();
    if (result == null)
    {
        result = new T();
        db.GetTable<T>().InsertOnSubmit(result);
    }
    return result;
} 
```

缺点是您必须将 DataContext 作为参数传递，但它应该可以很好地工作：

```
Customer selectedCustomer = (from c in db.Customers
                             where c.CustomerId == selectedCustomerId
                             select c).FirstOrCreate(db); 
```

肯定有一个赞成票吗？:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T17:46:31.137

可以缩短为。

```
if(invoiceDb == null) ctx.Invoices.InsertOnSubmit(invoiceDB = new Invoice() {Number = invoiceNumber}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-24T17:47:18.250

您可以使用[Null-Coalescing 运算符 (??)](http://msdn.microsoft.com/en-us/library/ms173224.aspx)

```
var invoice = ctx.Invoices.SingleOrDefault(a => a.InvoicerId == InvoicerId &&
                                             a.Number == invoiceNumber) ??
                          new Invoice(); 
```

# asp.net - 使用 LDAP 进行身份验证的 Web 服务

> ID：786891
> 
> 赞同：0
> 
> 时间：2009-04-24T17:43:10.803
> 
> 标签：asp.net, web-services, ldap

我在 ASP.net 中编写了一个 Web 服务。我需要使用本地网络用户 ID 和密码对 Web 服务进行身份验证。我正在使用 LDAP 检查这个值。我怎样才能在没有最少编码的情况下做到这一点。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T18:00:33.240

查看[System.DirectoryServices.Protocols](http://msdn.microsoft.com/en-us/library/system.directoryservices.protocols.aspx)和[LdapConnection 类](http://msdn.microsoft.com/en-us/library/system.directoryservices.protocols.ldapconnection.aspx)。

此命名空间对于 LDAP 来说比 System.DirectoryServices 命名空间更通用，后者更特定于 Active Directory。我发现如果您需要获取特定于 LDAP 的其他属性（例如 pwdChangedTime），使用它也会更好。

您可以建立 LDAP 连接并使用 Bind 功能检查它是否可以绑定到给定密码的用户的特定 dn。

```
ldapConnection.Credential = new NetworkCredential(dn, password);
try
{
     ldapConnection.Bind();
}
catch (Exception exc)
{
     // return failurecode depending on exception
}
// return successcode 
```

# c# - DataBindings.Add 使用 IFormatProvider

> ID：786903
> 
> 赞同：3
> 
> 时间：2009-04-24T17:46:10.903
> 
> 标签：c#, .net, data-binding

我正在尝试使用 IFormatProvider 来自定义一些数据绑定；但是永远不会调用 IFormatProvider 类。我在自定义格式化类中的两个函数的开头都设置了断点，并且都没有被数据绑定命中。当我将自定义格式化类与 String.Format 一起使用时，它可以工作。

我正在使用 .Net 2.0 和 winforms。

这就是我进行数据绑定的方式：

```
label1.DataBindings.Add("Text", textBox1, "Text", true, 
                            DataSourceUpdateMode.OnPropertyChanged, 
                "<NULL>","{0:H}",new MyFormat()); 
```

这就是我使用 String.Format 的方式：

```
string test =(string.Format(_superFormat, "{0}", "this is my arg")); 
```

这是我的自定义格式化类：

```
 class MyFormat : IFormatProvider, ICustomFormatter
    {
        string ICustomFormatter.Format(string format, object arg, IFormatProvider formatProvider)
        {
            string result = ((string)arg).ToUpper();
            return result ;
        }
        object IFormatProvider.GetFormat(Type formatType)
        {
            if (formatType == typeof(ICustomFormatter))
                return this;
            else
                return null;
        }
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T20:07:40.987

你到底想做什么？

假设`Text`属性是一个字符串，那么据我所知它*不能*使用格式化程序，因为`string`没有实现`IFormattable`.

类（它的`Binding`基础`DataBindings.Add`）有一个[`Format`](http://msdn.microsoft.com/en-us/library/system.windows.forms.binding.format.aspx)事件和[`Parse`](http://msdn.microsoft.com/en-us/library/system.windows.forms.binding.parse.aspx)可用于控制格式的事件。您还可以`TypeConverter`在目标绑定属性上使用 a，我喜欢它，因为它将这个逻辑从 UI 中移开。

所以：你有一个你想做的例子吗？

# git - 使用 git-p4 获取整个文件历史记录

> ID：786909
> 
> 赞同：16
> 
> 时间：2009-04-24T17:46:44.583
> 
> 标签：git, migration, perforce, git-p4

正如我在上一个[问题](https://stackoverflow.com/questions/783906/git-under-windows-msys-or-cygwin)中提到的，我正在考虑将我们的源代码控制从 Perforce 迁移到 git。
环顾四周，我发现了[git-p4](http://git.or.cz/gitwiki/InterfacesFrontendsAndTools#head-bb56c0cc211da9af16917d005ac59179224373f3)（你必须多挖一点，因为它甚至不在链接指向的存储库中。实际的[git-p4 脚本](http://repo.or.cz/w/git.git?a=blob_plain;f=contrib/fast-import/git-p4;hb=maint)更难找到）。

我现在正在运行这个脚本，它将文件的当前版本导入到一个新的 git 存储库中，但无论我做什么，我都无法获取历史记录。

这是我使用的当前命令行：

```
P4CLIENT=my-p4-clientspec git-p4 clone --max-changes=1000 --use-client-spec //p4/path/to/be/imported/...
```

所以，真正的问题是：如果有人设法导入了 P4 仓库，*包括历史*，我想知道你是如何做到的。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-29T13:08:48.830

尝试将“@all”附加到文件路径。例如，这为我生成了一个单一修订的 repo：

```
python /usr/share/doc/git-core/contrib/fast-import/git-p4 clone --destination=master-pom \
    //depot/services/master-pom/trunk/... 
```

此命令导入了完整的历史记录：

```
python /usr/share/doc/git-core/contrib/fast-import/git-p4 clone --destination=master-pom \
    //depot/services/master-pom/trunk/...@all 
```

我尝试使用示例 git-p4 但由于几个原因放弃了并编写了自己的快速导入泵。很久以前了，所以现在可能已经解决了一些问题：但是 git-p4 在处理大型变更列表时遇到了问题（例如最初创建分支）（尽管使用客户端规范可能有所帮助，但我没有想我试过了）和带有“+S”文件类型修饰符的文件（这是Bad And Evil，但我们曾经使用它）。而且我的 Python-fu 无法让我解决我遇到的问题。

编辑：既然有人要求，就在这里。

[https://github.com/araqnid/p4utils](https://github.com/araqnid/p4utils)有几个 p4 东西，其中 p4-git-xfer 是 p4->git（单向）复制器。但它有很多问题，因为它主要是一个个人方便的工具，而不是一个真正的基础设施。

入门：

```
p4-git-xfer clone -d $PWD/dictionary.git -n //depot/services/midoffice/dictionary/... \
  trunk 'release/*' 'branch/*' \
  trunk=master release/*=r* branch/*=dev/* 
```

将将该 perforce 路径克隆到裸露的“dictionary.git”。基本路径之后的第一个参数是“分支规范”，它告诉复制器在哪里可以找到基本路径下的分支。后面的那些（带有'='符号）是“镜像规范”，它告诉复制器如何从导入的分支创建本地分支。分支规范导致“refs/remotes/p4/trunk”、“refs/remotes/p4/release/1.0”等被创建。镜像规范强制“refs/heads/master”镜像“refs/remotes/p4/trunk”，“refs/heads/r1.0”镜像“refs/remotes/p4/release/1.0”等。作为一种允许我从复制的分支中选择特定分支以传播到克隆的方法。

它将尝试检测分支是如何创建的，但这对于 Perforce 来说还是有点猜测。除此之外，它根本不尝试进行任何分支跟踪：即使是全分支合并也不会这样写出来，抱歉。

在初始克隆之后，`p4-git-xfer fetch`从 git 副本内部运行将执行增量更新。高水位变更列表取自`marks/p4`git repo。这是一个可以快速导入加载的标记文件，所以如果你做任何花哨的动作，比如使用 filter-branch 重写东西，请注意你可能也必须更新它。

它不漂亮，并且有一些中度到严重的问题；我使用它主要是为了我自己的方便，将自己与 Perforce 问题隔离开来，而不是作为日常关键的基础设施组件。这是单向的：我通常使用 p4-am 脚本来应用由`git format-patch`. 这本身只在大多数情况下有效，一般解析令人讨厌，文件结尾换行符问题，二进制更改等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-03-31T19:39:22.383

1.  安装 git bash (cli)
2.  安装 p4 cli
3.  安装python 2.7
4.  获取 git-p4 脚本>> [http://git.kernel.org/cgit/git/git.git/plain/git-p4.py](http://git.kernel.org/cgit/git/git.git/plain/git-p4.py)
5.  将此脚本放入 c/program/files/git/bin/
6.  现在通过键入 python done, p4 done, git done, git p4 打开 git bash 或 cmd 检查，
7.  创建名为 git 的客户端工作区。
8.  git p4 clone depo/path/@all repo/path

* * *

如果python创建问题集P4CLIENT = git，以防万一在python的环境变量中设置路径不起作用

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2012-08-08T03:37:57.343

git-p4 的帮助其实很不错：

```
man git-p4 
```

在 Ubuntu 12.04 上，它包含在`git-man`包中。

# java - EJB3 原生查询问题

> ID：786911
> 
> 赞同：1
> 
> 时间：2009-04-24T17:48:11.210
> 
> 标签：java, ejb-3.0

我有以下内部类：

```
@Entity
    @Table(name = "SATTET0")
    public class SATTET0Key {
        @Column(name="IESTATUT")
        public String       estatut;
        @Column(name="IINICIO")
        public Date dataInicio;   
    } 
```

在同一个类中，我有以下代码：

```
Query q = exp.createNativeQuery("SELECT IESTATUT, IINICIO FROM  "
                + "\n SATTET0  WHERE IESTATUT=? AND DATAFIM IS NULL ", SATTET0Key.class);
        q.setParameter(1, estatuto);

        try {
            key = (SATTET0Key) q.getSingleResult();
            return key;
        } catch (NoResultException e) {
            return null;
        } 
```

当我运行此代码时，我得到以下信息：

```
javax.ejb.EJBException: EJB Exception: ; nested exception is: 
    <openjpa-1.1.0-r422266:657916 nonfatal user error> org.apache.openjpa.persistence.ArgumentException: Índice de colunas inválido
    at weblogic.ejb.container.internal.RemoteBusinessIntfProxy.unwrapRemoteException(RemoteBusinessIntfProxy.java:105)
    at weblogic.ejb.container.internal.RemoteBusinessIntfProxy.invoke(RemoteBusinessIntfProxy.java:87)
    at $Proxy0.lookupSATTET0Key(Unknown Source)
    at com.siemens.eori.service.testEstatutoServiceBean.testLookups(testEstatutoServiceBean.java:58)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
    at java.lang.reflect.Method.invoke(Unknown Source)
    at junit.framework.TestCase.runTest(TestCase.java:154)
    at junit.framework.TestCase.runBare(TestCase.java:127)
    at junit.framework.TestResult$1.protect(TestResult.java:106)
    at junit.framework.TestResult.runProtected(TestResult.java:124)
    at junit.framework.TestResult.run(TestResult.java:109)
    at junit.framework.TestCase.run(TestCase.java:118)
    at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:130)
    at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)
Caused by: <openjpa-1.1.0-r422266:657916 nonfatal user error> org.apache.openjpa.persistence.ArgumentException: Índice de colunas inválido
    at org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:813)
    at org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:774)
    at kodo.kernel.KodoQuery.execute(KodoQuery.java:43)
    at org.apache.openjpa.kernel.DelegatingQuery.execute(DelegatingQuery.java:533)
    at org.apache.openjpa.persistence.QueryImpl.execute(QueryImpl.java:235)
    at org.apache.openjpa.persistence.QueryImpl.getSingleResult(QueryImpl.java:300)
    at com.siemens.eori.service.ejb3.session.EstatutoServiceBean.lookupSATTET0Key(EstatutoServiceBean.java:159)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at java.lang.reflect.Method.invoke(Method.java:597)
    at com.bea.core.repackaged.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:281)
    at com.bea.core.repackaged.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:187)
    at com.bea.core.repackaged.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:154)
    at com.bea.core.repackaged.springframework.aop.support.DelegatingIntroductionInterceptor.doProceed(DelegatingIntroductionInterceptor.java:126)
    at com.bea.core.repackaged.springframework.aop.support.DelegatingIntroductionInterceptor.invoke(DelegatingIntroductionInterceptor.java:114)
    at com.bea.core.repackaged.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:176)
    at com.bea.core.repackaged.springframework.jee.spi.MethodInvocationVisitorImpl.visit(MethodInvocationVisitorImpl.java:15)
    at weblogic.ejb.container.injection.EnvironmentInterceptorCallbackImpl.callback(EnvironmentInterceptorCallbackImpl.java:54)
    at com.bea.core.repackaged.springframework.jee.spi.EnvironmentInterceptor.invoke(EnvironmentInterceptor.java:30)
    at com.bea.core.repackaged.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:176)
    at com.bea.core.repackaged.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:89)
    at com.bea.core.repackaged.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:176)
    at com.bea.core.repackaged.springframework.aop.support.DelegatingIntroductionInterceptor.doProceed(DelegatingIntroductionInterceptor.java:126)
    at com.bea.core.repackaged.springframework.aop.support.DelegatingIntroductionInterceptor.invoke(DelegatingIntroductionInterceptor.java:114)
    at com.bea.core.repackaged.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:176)
    at com.bea.core.repackaged.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:210)
    at $Proxy335.lookupSATTET0Key(Unknown Source)
    at com.siemens.eori.service.ejb3.session.EstatutoServiceBean_jfjn40_EstatutoServiceImpl.lookupSATTET0Key(EstatutoServiceBean_jfjn40_EstatutoServiceImpl.java:297)
    at com.siemens.eori.service.ejb3.session.EstatutoServiceBean_jfjn40_EstatutoServiceImpl_WLSkel.invoke(Unknown Source)
    at weblogic.rmi.internal.BasicServerRef.invoke(BasicServerRef.java:589)
    at weblogic.rmi.cluster.ClusterableServerRef.invoke(ClusterableServerRef.java:230)
    at weblogic.rmi.internal.BasicServerRef$1.run(BasicServerRef.java:477)
    at weblogic.security.acl.internal.AuthenticatedSubject.doAs(AuthenticatedSubject.java:363)
    at weblogic.security.service.SecurityManager.runAs(Unknown Source)
    at weblogic.rmi.internal.BasicServerRef.handleRequest(BasicServerRef.java:473)
    at weblogic.rmi.internal.wls.WLSExecuteRequest.run(WLSExecuteRequest.java:118)
    at weblogic.work.ExecuteThread.execute(ExecuteThread.java:201)
    at weblogic.work.ExecuteThread.run(ExecuteThread.java:173)
Caused by: java.lang.Exception: java.sql.SQLException: Índice de colunas inválido
    at org.apache.openjpa.util.Exceptions.replaceNestedThrowables(Exceptions.java:249)
    at org.apache.openjpa.persistence.ArgumentException.writeObject(ArgumentException.java:107)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at java.lang.reflect.Method.invoke(Method.java:597)
    at weblogic.utils.io.ObjectStreamClass.writeObject(ObjectStreamClass.java:282)
    at weblogic.corba.utils.ValueHandlerImpl.writeValueData(ValueHandlerImpl.java:231)
    at weblogic.corba.utils.ValueHandlerImpl.writeValue(ValueHandlerImpl.java:182)
    at weblogic.iiop.IIOPOutputStream.write_value(IIOPOutputStream.java:1963)
    at weblogic.iiop.IIOPOutputStream.write_value(IIOPOutputStream.java:2001)
    at weblogic.iiop.IIOPOutputStream.writeObject(IIOPOutputStream.java:2266)
    at weblogic.utils.io.ObjectStreamClass.writeFields(ObjectStreamClass.java:413)
    at weblogic.corba.utils.ValueHandlerImpl.writeValueData(ValueHandlerImpl.java:235)
    at weblogic.corba.utils.ValueHandlerImpl.writeValue(ValueHandlerImpl.java:182)
    at weblogic.iiop.IIOPOutputStream.write_value(IIOPOutputStream.java:1963)
    at weblogic.iiop.UnknownExceptionInfo.writeEncapsulation(UnknownExceptionInfo.java:40)
    at weblogic.iiop.ServiceContext.writeEncapsulatedContext(ServiceContext.java:130)
    at weblogic.iiop.UnknownExceptionInfo.write(UnknownExceptionInfo.java:35)
    at weblogic.iiop.ServiceContextList.write(ServiceContextList.java:41)
    at weblogic.iiop.Message.writeServiceContexts(Message.java:230)
    at weblogic.iiop.ReplyMessage.write(ReplyMessage.java:425)
    at weblogic.iiop.Message.flush(Message.java:193)
    at weblogic.iiop.OutboundResponseImpl.writeUncheckedException(OutboundResponseImpl.java:337)
    at weblogic.iiop.OutboundResponseImpl.sendThrowable(OutboundResponseImpl.java:180)
    at weblogic.rmi.internal.BasicServerRef.handleThrowable(BasicServerRef.java:694)
    at weblogic.rmi.internal.BasicServerRef.postInvoke(BasicServerRef.java:650)
    at weblogic.rmi.internal.BasicServerRef.handleRequest(BasicServerRef.java:492)
    ... 3 more 
```

您在哪里看到“Índice de colunas inválido”，它是“无效列索引”的葡萄牙语翻译

我在这里想念什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-06-11T13:42:52.343

您应该这样编写本机查询（使用：1 而不是？） WHERE IESTATUT=:1

```
Query q = exp.createNativeQuery
          (
              "SELECT IESTATUT, IINICIO FROM \n SATTET0  WHERE IESTATUT=:1 AND DATAFIM IS NULL",
              SATTET0Key.class
          );

q.setParameter(1, estatuto); 
```

它运作良好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T20:32:11.770

参数的索引 (1) 可能有问题。可能应该从 0 开始。

无论如何，我更喜欢在查询中使用命名参数（:param 而不是？）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-27T12:11:34.973

我通过完全实现实体并将原始本机查询更改为普通查询解决了这个问题。这不应该是必需的，但由于某种原因，实现似乎使这件事感到困惑。

# sql - 多对多关系：在列中使用关联表或分隔值？

> ID：786918
> 
> 赞同：16
> 
> 时间：2009-04-24T17:50:49.160
> 
> 标签：sql, database, database-design, architecture, many-to-many

**2009.04.24 更新**

我的问题的重点不是开发人员的困惑以及如何处理它。

关键是要了解分隔值何时是正确的解决方案。

我见过商业产品数据库中使用的分隔数据（Ektron 哈哈）。

SQL Server 甚至具有 XML 数据类型，因此可以用于与分隔字段相同的目的。

**/结束更新**

我正在设计的应用程序有一些多对多的关系。过去，我经常使用关联表在数据库中表示这些。这给开发者带来了一些困惑。

这是一个示例数据库结构：

```
Document
---------------
ID (PK)
Title
CategoryIDs (varchar(4000))

Category
------------
ID (PK)
Title 
```

**Document 和 Category 之间存在多对多的关系。**

在此实现中，Document.CategoryIDs 是一个大的以竖线分隔的 CategoryID 列表。

对我来说，这很糟糕，因为它需要在查询中使用子字符串匹配——这不能使用索引。我认为这会很慢并且不会扩展。

使用该模型，要获取某个类别的所有文档，您需要以下内容：

```
select * from documents where categoryids like '%|' + @targetCategoryId + '|%' 
```

我的解决方案是创建一个关联表，如下所示：

```
Document_Category
-------------------------------
DocumentID (PK)
CategoryID (PK) 
```

这让开发人员感到困惑。我缺少一些优雅的替代解决方案吗？

我假设 Document 中会有数千行。类别可能像 40 行左右。主要关注的是查询性能。我是否过度设计了这个？

是否存在优先将 ID 列表存储在数据库列中而不是将数据推送到关联表的情况？

还要考虑我们可能需要在文档之间创建多对多关系。这将建议一个关联表 Document_Document。这是首选设计还是将关联的文档 ID 存储在单个列中更好？

谢谢。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-04-24T17:53:56.503

> 这让开发人员感到困惑。

获得更好的开发人员。这是正确的做法。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-04-24T18:09:19.383

您的建议是优雅、强大、最佳实践的解决方案。

由于我认为其他答案不够强烈，因此我将这样做。

如果您的开发人员 1) 无法理解如何在关系数据库中建模多对多关系，并且 2) 强烈坚持将您的 CategoryID 存储为分隔字符数据，

然后他们应该立即失去所有数据库设计权限。至少，他们需要一个真正有经验的专业人士加入他们的团队，有权阻止他们做这种不明智的事情，并且可以为他们提供他们完全缺乏的数据库设计培训。

最后，您不应该再次将他们称为“数据库开发人员”，直到他们适当地跟上速度，因为这对我们这些真正有能力的开发人员和设计人员来说是轻微的。

我希望这个答案对你很有帮助。

**更新**

> 我的问题的重点不是开发人员的困惑以及如何处理它。
> 
> 关键是要了解分隔值何时是正确的解决方案。

除极少数情况外，分隔值是错误的解决方案。当单个值将被查询/插入/删除/更新时，这证明这是错误的决定，因为您必须解析并触摸所有其他值才能使用所需的值。通过这样做，您违反了**第一个**（!!!）正常形式（这句话对您来说应该听起来像一个令人难以置信的卑鄙的咒骂）。使用 XML 做同样的事情也是错误的。在列中存储分隔值或多值 XML*可能*是有意义的，因为它被视为不可分割且不透明的“属性包”，数据库不查询但始终将其全部发送给另一个消费者（可能是 Web 服务器或EDI 收件人）。

这让我回到我最初的评论。在我的书中，那些认为违反第一范式是个好主意的开发人员是非常缺乏经验的开发人员。

我承认有一些非常复杂的非关系数据存储实现，使用文本属性包（例如 Facebook（？）和其他在数千台服务器上运行的数百万用户站点）。好吧，当您的数据库、用户群和每秒事务量大到足以需要它时，您将有足够的钱来开发它。同时，坚持最佳实践。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-04-24T17:55:39.087

使用逗号分隔的 ID 几乎总是一个大错误。
**RDBMS 旨在存储关系。**

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-04-24T17:56:10.677

> 我的解决方案是创建一个关联表，如下所示：这让开发人员感到困惑

真的吗？这是数据库 101，如果这让他们感到困惑，那么他们可能需要远离他们的向导生成的代码并学习一些基本的数据库规范化。

你提出的是正确的解决方案！

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-04-24T17:57:09.647

您设计中的 Document_Category 表无疑是解决问题的正确方法。如果可能的话，我建议您教育开发人员，而不是提出次优的解决方案（并且会影响性​​能，并且没有参照完整性）。

您的其他选项可能取决于您使用的数据库。例如，在 SQL Server 中，您可以拥有一个 XML 列，该列允许您将数组存储在预定义的架构中，然后根据该字段的内容进行连接。其他数据库系统可能有类似的东西。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-04-24T17:55:39.510

您正在执行的多对多映射很好且已标准化。如果需要，它还允许稍后添加其他数据。例如，假设您想添加将类别添加到文档的时间。

我建议在 document_category 表上也有一个代理主键。如果这样做有意义的话，还有一个 Unique(documentid, categoryid) 约束。

为什么开发人员会感到困惑？

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-04-24T18:14:58.137

“这让开发人员感到困惑”的设计意味着您的开发人员教育不足。这是更好的关系数据库设计 - 如果可能，您应该使用它。

如果您真的想使用列表结构，请使用能够理解它们的 DBMS。此类数据库的示例是[U2](http://www.ibm.com/software/data/u2/) (Unidata, Universe) DBMS，它是（或曾经是很久以前）基于 Pick DBMS。可能还有其他类似的 DBMS 提供程序。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-04-24T18:34:06.717

这是经典的对象关系映射问题。开发人员可能并不愚蠢，只是缺乏经验或不习惯以正确的方式做事。大喊“3NF！” 一遍又一遍不会说服他们正确的方法。

我建议您请您的开发人员向您解释他们将如何使用管道分隔的方法按类别获取文档计数。这将是一场噩梦，而链接表使它变得非常简单。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-05-09T19:52:20.433

我的开发人员尝试这种“数据库列中的逗号分隔值”方法的第一个原因是，他们认为添加一个新表来满足对多个值的需求将花费太长时间来添加到数据模型和数据库。

他们中的大多数人都知道由于各种原因他们的工作很糟糕，但他们选择了这种次优方法，因为他们**只是可以**。他们可以做到这一点并且可能永远不会被抓住，或者他们会在项目的后期被抓住，因为修复它的成本太高且风险太大。他们为什么这样做呢？因为它们的性能仅根据速度而不是质量或合规性来衡量。

也可能是，就像在我的一个项目中一样，开发人员*有*一个表来放置多个值，但他们认为在父表中复制该数据会提高性能。他们错了，他们被叫出来了。

因此，虽然您确实需要解决如何处理这些代价高昂、风险大且**损害商业信心的**技巧，但您还应该尝试找出开发人员认为采取这种行动方案在短期和长期内更好的原因为项目和公司。然后修复感知和数据结构。

是的，这可能只是懒惰、恶意或无知，但我敢打赌，大多数时候开发人员都会做这些事情，因为他们经常被告知“完成它”。我们在数据模型和数据库设计方面需要确保我们不会发送错误信息，说明我们对满足新实体/表/信息的业务需求的请求的响应速度。

我们还应该看到，数据人员需要不断监控我们数据架构的“竣工”部分。

就个人而言，我从不授权在关系数据库中使用逗号分隔值，因为实际上构建新表比构建解析例程来创建、更新和管理列中的多个值*并*处理所有引入异常是因为有时该数据也嵌入了逗号。

最重要的是，不要使用逗号分隔值，而是找出开发人员想要这样做的原因并解决该问题。

# .net-2.0 - 我什么时候使用 AppDomain？

> ID：786923
> 
> 赞同：8
> 
> 时间：2009-04-24T17:52:19.953
> 
> 标签：.net-2.0, appdomain

我对反射很陌生，我想知道我会使用（第二个）AppDomain 做什么？在业务应用程序中会有什么实际应用程序？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-24T17:57:43.047

有很多用途。辅助 AppDomain 可以提供一定程度的隔离，类似于操作系统提供的进程隔离。

我使用它的一个实际用途是动态加载“插件”DLL。我想支持在主可执行文件启动时扫描目录以查找 DLL，加载它们并检查它们的类型以查看是否有任何实现特定接口（即插件的合同）。如果不创建辅助 AppDomain，您将无法卸载可能没有实现所寻求接口的任何类型的 DLL/程序集。与其在您的流程中携带额外的程序集和类型等，您可以创建一个辅助 AppDomain，在那里加载程序集，然后检查类型。完成后，您可以摆脱辅助 AppDomain 以及您的类型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T17:57:39.050

99% 的时间我会避免使用额外的 AppDomain。它们本质上是独立的过程。您必须将数据从一个域编组到另一个域，这会增加复杂性和性能问题。

人们试图使用 AppDomain 来解决程序集一旦加载到 AppDomain 中就无法卸载的问题。因此，您创建了第二个 AppDomain，您可以在其中加载动态程序集，然后卸载完整的 AppDomain 以释放与程序集关联的内存。

除非您需要动态加载和卸载程序集，否则它们并不值得担心。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T17:59:50.903

当您必须拥有多个单例实例时，AppDomains 很有用。例如，您有一个为某些设备实现通信协议的程序集，并且该程序集使用单例。如果您想实例化此类的多个实例（与多个设备通信）并且您希望这些实例不会相互干扰，那么 AppDomains 非常适合此目的。

但是，它确实使编程变得更加困难，因为您必须做更多的工作才能跨 AppDomain 边界进行通信。

# logging - 如何设置中央日志服务器并将日志事件与测试和生产分开？

> ID：786924
> 
> 赞同：2
> 
> 时间：2009-04-24T17:53:06.363
> 
> 标签：logging, log4j, slf4j

我应该如何最好地设置一个中央日志记录（或者可能是 2 个，每个都专用于测试或产品）服务器，这样：

我不必担心引用任何条件的代码可能会意外地将非生产错误记录到生产错误 log4j 总线中。换句话说，我不想有这样的代码：

```
if (!production)
  logWrapper.logTest(error);
else 
  logWrapper.logProd(error); 
```

我不想要这个，因为它紧密耦合了诸如服务器名称之类的东西，引用它，现在代码只能在两个服务器名称之一上工作：prod 和 test。我也不能在配置中声明性地设置它，因为开发人员可能不会正确设置它并污染日志存储库。**有什么建议么？**

一些细节，有些不会考虑，但我还是列出了它们：

*   **仅在Oracle 应用服务器**10.1.3.4上运行的 Web 应用程序，以及未来的 Oracle WebLogic
*   将使用中央日志服务器，如本示例所示：[http](http://timarcher.com/?q=node/10) ://timarcher.com/?q=node/10 ...除了中央服务器将记录文本文件而不执行电子邮件！
*   将使用 log4j，也许它会通过 slf4j 包装（slf4j 有点不敬，所以大部分情况下忽略它..）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T18:24:53.590

如果没有关于您所在环境的大量详细信息，很难给出具体答案，但如果我设置日志记录以处理多个环境，这就是我要采取的方法。

1) 应用程序不应该关心日志记录。例如，以下内容应适用于所有环境：

```
logger.warn("message", error); 
```

2）创建一个log4j（或任何日志框架）配置来配置日志。这可以通过以下两种方式之一来完成。第一种方法是为每个环境创建一个 test_log4j.{xml,properties}、prod_log4j.{xml,properties} 等。这使得每个环境的配置都非常简单，添加新环境只是添加一个新文件。另一种方法是创建一个 log4j.{xml,properties} 并使用 ant 样式的属性替换为每个环境插入适当的值。可以从特定于环境的属性文件或从传递给 JVM 的 -Dkey=value 参数中获取属性值。假设每个环境的配置都非常相似，这更像是 DRY 配置风格。作为在环境之间更改日志记录级别的示例：

```
<logger name="my.example">
  <level value="${my.example.level}"/>
</logger> 
```

3）创建一个确定环境的启动脚本（可能基于机器或机器上的某些文件），然后加载正确的配置。这可以是正确的 log4j 配置、正确的属性文件或正确的 -Dkey=value 参数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T21:22:11.947

这个特定问题在**[logFaces中得到解决](http://www.moonlit-software.com)**，事实上，这是它旨在解决的主要问题之一 - 集中和减少日志泛滥。在您的应用程序配置中。您指定应用程序名称，例如“我的生产应用程序”。来自应用程序的所有日志语句随后将流入集中式日志服务器，并将在存储中用于查询和实时查看。您无需更改代码，这只是配置问题。通常我们在开发中有几个相同应用程序的实例，在 QA 中有几个版本，每个开发人员都可以调整它的查看器以获取其他人正在发生的事情。我经常关注 QA 主持人，甚至在他们意识到之前就知道存在问题。另一个有趣的场景是，当您想同时查看所有应用程序中发生的事情但只关注数据层等情况时。

**披露**：我是该产品的作者。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T19:27:28.400

你没有提到你正在使用什么 RDBMS。如果您使用的是 Oracle，则可以使用 SYS_CONTEXT() 函数来获取数据库名称。从那里，您可以确定您是否处于生产/dev/qa/test/etc 中。

[这是一篇关于 sys_context() 的好文章](http://www.oracle.com/technology/oramag/code/tips2003/011903.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T18:01:41.990

为生产和登台使用不同的日志记录配置文件。

你可以用几种不同的方式做到这一点

1）在您的应用程序中保留两个不同的配置文件（一个用于阶段，一个用于生产）并让您的应用程序有一些启动代码，这些代码知道根据它所在的机器或应用程序配置文件中的某些设置要使用哪个配置文件设置环境设置。

2) 只需一个文件，但在测试或生产时换出适当的文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-24T18:04:39.377

我真的认为你需要在配置中设置它。这是一个正确的决定。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T22:41:33.207

mattkemp 几乎把这个搞定了。我可能要补充的一件事是，我期望生产和测试之间的主要区别是测试版本可能会永久激活调试日志记录，而在生产环境中，您只会在罕见的奇怪行为情况下激活调试日志记录.

除此之外，至少我希望测试和生产中的日志条目类型大致相同，因为在测试期间可能发生的任何事情也可能在生产期间发生（并且将会发生）。

当涉及到服务器设置本身时，我会说只使用 syslog 或 windows NT 事件日志，并使用适当的 log4j 设置。这样，您还可以在同一日志服务器中记录最终系统的其他部分。一个好的日志系统会显示事件是在哪个服务器上生成的，所以应该相当清楚事件是来自 prod 还是 testing。

对于一个好的基于 Web 的系统日志 gui，您可以查看[http://www.phplogcon.org/](http://www.phplogcon.org/ "phpLogCon")

# jsp - 一个大的包含文件还是几个较小的文件？

> ID：786929
> 
> 赞同：3
> 
> 时间：2009-04-24T17:55:30.133
> 
> 标签：jsp, asp-classic, include

我正在写一些jsp，我想知道是否最好有一个大的包含文件，我会在每个页面中包含一个或者几个较小的文件，我会根据需要只包含在某些页面上。

任何给定的页面最多只需要调用几个方法（<5）。如果我使用一个文件，那将是 2500 多行代码。

我主要关心的是性能，其次是维护。

我们正在使用 jsp 包含指令`<%@ include file="FileToInclude" %>`

**编辑：**我也会对 asp 页面做同样的事情。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-24T18:02:45.793

任何将包含在**每个**JSP 中的内容，都可以随意添加到单个包含的文件中。对于仅包含在少数 JSP 中的内容，请为它们创建单独的包含文件。

庞大的 JSP 难以维护。

然而，更好的是，将尽可能多的代码从 JSP 中**移出**并移入您的域对象或模型或 servlet 中。任何纯 Java 的内容通常不属于 JSP，而是属于您的 JAR 文件：

1.  IDE 在导航和重构纯 Java 代码方面做得更好。
2.  当 JSP 主要是 HTML 和 JSP 标记（使用尽可能少的 Java 代码）时，它们变得更易于维护和理解。
3.  纯 Java 更容易理解，因为没有混入 HTML 标记。
4.  它使 JSP 更容易理解，因为大量 Java 代码被一个非常短的 Java 代码调用所取代。
5.  它使 JSP 的维护更容易，而不会使代码库的维护更加困难。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T18:09:52.173

您应该仅将 JSP 用于查看目的。业务逻辑不应该放在 JSP 文件中，而应该放在普通的 java 类中。请阅读模型-视图-控制器设计模式。请参阅[此维基百科文章](http://en.wikipedia.org/wiki/Model-view-controller)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T18:00:41.073

这是Java吧？肯定是小包含文件。

更不用说它还会使重构、测试和调试变得更容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T18:01:04.223

这样做是经典的 ASP - 我会说平衡是为了

我会仔细查看您在所有页面中需要的函数/方法/调用，并为那些构建一个大的包含，然后较小的较少使用的方法使单个包含 - 这种平衡它的性能和易于构建

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-27T09:36:20.353

在 ASP 中，我有一个在每一页上使用的包含文件……但是那个文件中包含大约 5 个或更多。通过这种方式，我可以将函数分成逻辑组（这使得查找内容更容易，并且仅在更新一个文件时更安全），但在创建需要这些函数的新页面时只需要记住一行。

# visual-studio - Visual Studio 2008 中的多个 Web 应用程序部署目标？

> ID：786936
> 
> 赞同：2
> 
> 时间：2009-04-24T17:56:41.783
> 
> 标签：visual-studio, deployment

我目前为一个应用程序维护几个不同的环境——生产、登台、开发等。

我想知道是否有 Visual Studio 的设置或加载项可以促进发布到多个部署目标（最好为每个目标使用不同的 web.config）？

我正在考虑编写几个 nant 脚本，但如果有一个集成的解决方案会很好。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-05T15:18:39.323

在 VS 2008 中开箱即用是不可能的。我不知道是否有此插件，但您可以尝试搜索[VisualStudio Gallery](http://www.visualstudiogallery.com)。

从我从演示视频中看到的，VS2010 将支持拥有不同的 web.configs，并部署到 dev/staging/production。

# mysql - mySQL：选择 * 结合 UNIX_TIMESTAMP

> ID：786939
> 
> 赞同：0
> 
> 时间：2009-04-24T17:57:34.840
> 
> 标签：mysql, select

现在我正在从我的数据库中检索数据，如下所示：

`SELECT id, UNIX_TIMESTAMP(cdate) as myunixdate, permalink, title FROM mytable`

但我想按如下方式进行，但它不起作用。

`SELECT *, UNIX_TIMESTAMP(cdate) FROM mytable`

我的问题是，如何组合 UNIX_TIMESTAMP 而不必指定所有其他字段？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T18:11:43.980

你确定你没试过这个？

```
SELECT UNIX_TIMESTAMP(cdate), * FROM mytable 
```

这不起作用，因为 * 必须先出现：

```
SELECT *, UNIX_TIMESTAMP(cdate) FROM mytable 
```

别名将使您的代码更容易引用：

```
SELECT *, UNIX_TIMESTAMP(cdate) AS cdate_timestamp FROM mytable 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T18:01:27.233

```
SELECT *, UNIX_TIMESTAMP(cdate) AS my_time_stamp FROM mytable 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T18:01:47.433

它在 MySQL 6 中对我有用，您确定第二个查询是您真正尝试的查询吗？你用的是什么版本的mysql？

# ruby-on-rails - Rails：具有自定义路由的数据库记录......？

> ID：786948
> 
> 赞同：0
> 
> 时间：2009-04-24T17:59:52.773
> 
> 标签：ruby-on-rails, routes

我有一个模型，目标，它包含许多带时间戳的记录。在相应的控制器上，我通过执行以下操作列出了这些记录的月份：

在**模型/target.rb**

```
def month
   self.recorded_on.strftime('%B')
end 
```

在**控制器/targets_controller.rb**

```
@records = Target.find :all 
```

在**视图/目标/index.html.haml**

```
%ul
  - @records.group_by(&:month).sort.each do |month, data|
    %li= link_to month, '' 
```

这一切都非常适合列出我拥有的记录的可用月份。接下来，我希望能够单击月份并获取该月所有记录的报告，在以下路径生成年份和月份：**/targets/2009/04**

我该怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T18:28:19.133

将一些[命名范围](http://railscasts.com/episodes/108-named-scope)添加到您的`Target`模型中，以支持按年和月号查找。就像是：

```
class Target < ActiveRecord::Base
  named_scope :by_month,
    lambda { |month| { :conditions => ['MONTH(recorded_on) = ?',
                        month] }}

  named_scope :by_year,
    lambda { |year| { :conditions => ['YEAR(recorded_on) = ?', year] }} 
  .
  .
  .
end 
```

（注意这里的条件是使用 MySQL 语法。）

假设您使用的是 RESTful 路由，请在文件中设置如下[命名路由](http://railscasts.com/episodes/34-named-routes)`config/routes.rb`（确保在默认路由之前声明它）：

```
map.targets_by_month '/targets/:year/:month', :controller => 'targets',
                :requirements => { :year => /\d{4}/, :month => /\d{1,2}/ },
                :conditions => { :method => :get } 
```

—您可以像这样在视图中使用此路由：

```
<%= link_to 'Show April 2009 Targets', targets_by_month_path('2009', '04') %> 
```

（请注意，月份的前导零是可选的，因为`:requirements`上面定义的命名路由中的正则表达式）

最后，在您的 中`TargetsController`，设置`index`操作以使用之前定义的 named_scopes：

```
def index
  @records = Target.by_year(params[:year]).by_month(params[:month])
  .
  .
  .
end 
```

# c++ - stringstream 无符号转换坏了？

> ID：786951
> 
> 赞同：4
> 
> 时间：2009-04-24T18:00:58.293
> 
> 标签：c++, iostream, stringstream

考虑这个程序：

```
#include <iostream>
#include <string>
#include <sstream>
#include <cassert>

int main()
{
    std::istringstream stream( "-1" );
    unsigned short n = 0;
    stream >> n;
    assert( stream.fail() && n == 0 );
    std::cout << "can't convert -1 to unsigned short" << std::endl;
    return 0;
} 
```

我在 OS X 10.5.6 上的 gcc（版本 4.0.1 Apple Inc. build 5490）上试过这个，断言是真的；它无法将 -1 转换为无符号短。

然而，在 Visual Studio 2005（和 2008）中，断言失败并且 n 的结果值与编译器生成的隐式转换所期望的值相同 - 即“-1”是 65535，“-2”是 65534，等等. 但后来它在“-32769”处变得很奇怪，它转换为 32767。

这里谁对谁错？（-32769 到底是怎么回事？？）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-24T23:42:59.487

GCC 在 Max Lybbert 的帖子中声称的行为是基于 C++ 标准的表格，这些表格将 iostream 行为映射到 printf/scanf 转换器（或者至少是我的阅读）。但是，g++ 的 scanf 行为似乎与 istream 行为不同：

```
#include <iostream>
#include <cstdio>
using namespace std;;

int main()
{
    unsigned short n = 0;
    if ( ! sscanf( "-1", "%hu", &n ) ) {
        cout << "conversion failed\n";
    }
    else {
        cout << n << endl;
    }
} 
```

实际上打印 65535。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-24T22:32:22.463

首先，将字符串“-1”读取为负数取决于语言环境（语言环境可以通过将负数括在括号中来识别负数）。 [您的默认标准是“经典”C 语言环境](http://www.research.att.com/~bs/3rd_loc.pdf)：

> 到目前为止，*语言环境*的主要用途是在流 I/O 中隐式使用。每个*istream*和*ostream*都有自己的*locale*。默认情况下，流的*语言环境是创建流时的全局**语言环境*（第 6 页）。...
> 
> 最初，全局语言环境是标准 C 语言环境，*locale::classic()*（第 11 页）。

~~根据 GCC 家伙的说法，[允许数字溢出使流输入操作失败](http://gcc.gnu.org/ml/gcc-prs/2002-01/msg00693.html)（谈论溢出有符号 int 的负数）：~~

> ~~[T]libstdc++-v3 的行为严格符合标准。...尝试读取时，它不*适合*带符号的 int i，并且失败。~~

感谢另一个答案，[提交了一个错误并且此行为发生了变化](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=39802)：

> 糟糕，显然我们从未正确解析无符号的负值。修复很简单。...
> 
> 已在主线中修复，也将在 4.4.1 中修复。

其次，虽然整数溢出通常是可以预测的，但我相信这是[官方未定义的行为](http://dobbscodetalk.com/index.php?option=com_myblog&show=A-parable-about-undefined-behavior.html&Itemid=29)，所以虽然我不能说为什么 -32769" 转换为 32767，但我认为这是允许的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T18:27:58.947

试试这个代码：

```
#include <iostream>
#include <string>
#include <sstream>
#include <cassert>

int main()
{
    std::istringstream stream( "-1" );
    std::cout << "flags: " << (unsigned long)stream.flags() << std::endl;
    return 0;
} 
```

我在我的 VS2005 上试过这个：

```
flags: 513 
```

在[codepad.org](http://codepad.org/Aiwmy0ZH)（我认为使用 g++）上，这给出了：

```
flags: 4098 
```

这告诉我 gcc 使用不同的 default `fmtflags`。由于`fmtflags`控制了可能的转换，您将获得不同的结果。

# asp.net - 使用 MSBuild 将网站复制到生产环境，同时真正跳过未更改的文件

> ID：786972
> 
> 赞同：3
> 
> 时间：2009-04-24T18:07:44.660
> 
> 标签：asp.net, msbuild

我正在使用 MSBuild 发布网站，然后将发布的网站复制到同一网络上的 Web 服务器。我将复制命令设置为“SkipUnchangedFiles”。

它工作得很好，但 Skip Unchanged 不起作用，因为当我使用 AspNetCompiler 发布网站时，每个文件都是“新的”——它的日期设置为发布的那一刻，所以即使给定文件的内容没有改变，时间戳不同，所以无论如何它都被复制了。

是否有一种解决方法可以防止复制内容未更改的文件？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-03-24T03:54:54.703

由于部署过程不知道部署目标文件系统，因此没有现有的过程。

如果您知道您可以使用[超越比较](http://www.scootersoftware.com/)之类的工具进行比较，然后仅抓取二进制差异项目并将其复制。

想要实现自动化，您可能不得不深入研究编写 msbuild 目标或后期构建脚本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-24T03:34:10.040

根据您发布网站的方式，您可以进行[增量构建](http://msdn.microsoft.com/en-us/library/ms171483.aspx)而不是完整构建。

# c# - 自动化 Microsoft Word 时的 RPC_E_SERVERFAULT

> ID：786982
> 
> 赞同：3
> 
> 时间：2009-04-24T18:10:18.770
> 
> 标签：c#, asp.net, templates, ms-word

我正在通过模板 (.dot) 创建 word 文档`Microsoft.Office.Interop.Word`。下面的代码适用于某些模板，但不适用于其他模板：它不起作用的地方会引发`RPC_E_SERVERFAULT`异常。这是怎么回事，可能是什么原因，我该如何解决？（异常发生在第二行。）

```
wordApp = new Microsoft.Office.Interop.Word.ApplicationClass();
wordDoc = wordApp.Documents.Add(ref oTemplate, ref newTemplate, ref docType, ref isVisible);
wordApp.Visible = false;
wordDoc.Activate(); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T18:15:15.327

您可能会恨我并拒绝我，但在我所有使用 COM 互操作的 .NET 工作经验中，它是一个 PIA（双关语/PIA 也意味着主互操作程序集）。

通常，性能是如此糟糕，以至于整个事情都无法接受。所以我们求助于购买了一个第三方管理的、非 Office 依赖的库，它可以更快地完成同样的事情。

# c++ - 如何在 Vista 中使用 C++ 控制 PC 的风扇速度？

> ID：786984
> 
> 赞同：8
> 
> 时间：2009-04-24T18:10:47.757
> 
> 标签：c++, windows, cpu, windows-vista

如何在 Windows Vista Ultimate 中使用 C++ 控制 CPU 风扇速度？我想使用 ACPI。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-24T18:14:49.633

**ACPI：**

您需要了解和使用 WMI - Windows 系统管理界面。这里有一些资源可以为您提供从哪里开始的线索：

*   [CIM_Fan 类的 SetSpeed 方法](https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/setspeed-method-in-class-cim-fan)
*   [WMI C++ 应用程序示例](http://msdn.microsoft.com/en-us/library/aa394558(VS.85).aspx)
*   [示例：调用提供程序方法](http://msdn.microsoft.com/en-us/library/aa390421(VS.85).aspx)

请注意，某些主板不支持风扇速度更改，即使那些支持的主板也可能不会将其暴露给 WMI。在最好的情况下，您可能仍然需要检测主板类型并直接与风扇管理控制器对话。

**没有 ACPI：**

如果您不想使用 ACPI，那么您将不得不编写自己的代码来访问主板上的 SMBUS，然后控制风扇控制器芯片。

查看程序主板监视器以获取有关如何开始的线索。这很重要，因为每个主板和 BIOS 都是不同的。

# c# - 程序集是否维护其目录结构？

> ID：786985
> 
> 赞同：1
> 
> 时间：2009-04-24T18:11:11.623
> 
> 标签：c#, asp.net, assemblies, asp.net-2.0

1.  既然一个 web 项目中的所有文件都被编译成一个程序集，那么这个程序集是否维护了一个目录结构呢？例如，如果根目录中的文件引用子目录中的文件，那么当这两个文件被编译到同一个程序集中时，这个引用怎么可能仍然有效？

2.  假设一个 Web 项目具有如下所示的目录结构。由于所有 web 项目的 ASPX 文件都被编译成一个程序集`WebProject1.dll`，这个程序集如何能够记录/记忆目录结构？因此，当您部署`WebProject1.dll`到 Web 服务器并且用户发出请求时`http://WebProject1/some_SubDir/default.aspx`，如何`WebProject1.dll`确定要呈现哪个页面？

    WebProject1\SubDir（其中 WebProject1 是根目录） WebProject1 - 包含几个 ASPX 文件 WebProject1\SubDir - 包含一个文件**`default1.aspx`**.

3.  当我们部署 Web 项目时，我们是否必须在 Web 服务器上创建相同的目录结构 ( `WebProject1\SubDir`)，即使我们不会将任何 ASPX 文件放入这些目录中？

4.  我假设`WebProject1.dll`应该放在Web服务器上的`Bin`目录？

谢谢

**编辑：**

> 只有源代码编译成程序集，您仍然需要将 aspx 文件上传到服务器上的匹配目录中。

我的书说，当使用 Web 项目时，所有 Web 代码都被编译成单个程序集。我以为“所有代码”都包含 aspx 文件？！

> 通过类声明在页面和它的代码隐藏文件之间维护链接，该类声明默认情况下位于与目录结构匹配的命名空间中

所以如果我通过*Project --> Add New Item*添加一个新的 aspx 页面，并将这个 aspx 页面存储在一个名为*Hey*的子目录中，那么这个页面将驻留在命名空间*WebProject1.Hey*中？！

但是我如何将新项目添加到子目录中，因为*Project --> Add New Item*没有给我一个选项来浏览并选择我希望保存它的目录，而是自动在根目录中创建 aspx 文件?

> 编译器生成 dll 时会保留相对路径。

我不确定我知道你指的是什么相对路径？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T18:28:19.663

只有源代码编译成程序集，您仍然需要将 aspx 文件上传到服务器上的匹配目录中。例如，您在 Visual Studio 中的项目可能如下所示：

```
WebProject1 (The root project)
  |
  |- some_SubDir (A physical directory inside the project)
      |
      |-default1.aspx
      |-default1.aspx.cs (assuming a C# project) 
```

编译 Web 应用程序后，您需要将以下内容上传到服务器：

```
WebProject1 (The root directory for your website)
 |
 |-bin (The binary directory created by the build)
    |
    |-WebProject1.dll (The compiled source code of the web app)
 |-some_SubDir
    |
    |-default1.aspx (The file that will map to the URL www.websitename.com/some_subdir/default1.aspx) 
```

已编译资源（在程序集中编译和存储的非源代码文件）是您的[其他问题中解决的不同问题](https://stackoverflow.com/questions/786996/are-jpg-doc-pdf-etc-files-also-compiled-into-assembly)

* * *

编辑以添加问题的直接答案：

1.  并非所有文件都编译到程序集中，只有源代码文件。通过类声明在页面和它的代码隐藏文件之间维护链接，默认情况下，该类声明位于与目录结构匹配的命名空间中，但并非必须如此。

2.  您的 default1.aspx 文件将在标题中包含如下内容：

继承行告诉网络服务器当用户请求这个页面时，它应该与定义该类的源代码一起处理，它将在编译的程序集中找到。物理 aspx 文件和已编译类的组合将生成标准 html，然后将其传递回客户端。

3.  是的，您需要创建相同的目录结构，但您*需要*将 aspx 文件放在那里。

4.  是的

（如果有人知道如何让列表项正确编号，可以编辑这个吗？）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T18:19:59.793

所有这些路径信息都将作为元数据/资源文件嵌入，因此，您可以将其安全地部署到服务器。编译器生成 dll 时会保留相对路径。

我建议你使用[Reflector](http://www.red-gate.com/products/reflector/)打开dll，你可以更深入地了解dll里面是什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T18:46:24.160

注意 some_Subdir/default1.apsx 如何在页面声明中有一个“继承”键/值对？

这意味着当您对该资源提出请求时，IIS 会发出“啊哈！Asp.Net 需要处理这个请求！嘿 asp.net 请给我一些 html 以发送下来'

Asp.net 解析该 aspx 文件并动态创建从 WebProject1.some_Subdir._Default1 继承的代理类。然后这个代理类解析出控制树和 html，并开始页面生命周期（这被过度简化了，我确定我错过了一些细节）。

因此，WebProject1.dll 只是您的 Web 应用程序的实际 C#/VB，但与 asp.net 工作进程和标记相结合，您可以将 html 呈现回客户端。

# vb.net - VB.net：CInt 在（看似有效的）字符串上返回 -1

> ID：786995
> 
> 赞同：0
> 
> 时间：2009-04-24T18:15:41.787
> 
> 标签：vb.net

我有一个奇怪的问题，CInt（以及 Convert.ToInt32 甚至 Val）为字符串“500”返回 -1。使用[Gurock 的 SmartInspect](http://www.gurock.com/products/smartinspect/)进行日志记录，我在运行时检查了所有值（SiAuto... 记录一些内容，我将日志发布在代码下方）。将不胜感激一些 hlp :)

谢谢

迈克尔

```
Si.Auto.Main.LogString("QueryString.q1",GetQueryStringParam("q1","0"))
' is it really "500" as it seems?
SiAuto.Main.LogBool("Is q1 = 500 in query-string?","500"=GetQueryStringParam("q1","0"))
q1 = CInt(GetQueryStringParam("q1","0"))
'don't worry abt that q1a-bit, the first string is just the title...
SiAuto.Main.LogInt("q1a",q1)

q1 = Convert.ToInt32(GetQueryStringParam("q1","0"))
SiAuto.Main.LogInt("q1b",q1)

q1 = val(GetQueryStringParam("q1","0"))
SiAuto.Main.LogInt("q1c",q1) 
```

这是日志：

```
QueryString.q1 = "500"
Is q1 = 500 in query-string? = True
q1a = -1
q1b = -1
q1c = -1 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T18:20:22.710

与其重复调用`GetQueryStringParam()`（顺便说一句，您在使用什么？），不如将此值存储在局部`string`变量中。通过消除您的函数以非确定性方式运行的可能性，这将使您的代码和测试更加可靠。

在任何情况下，也要检查`int.Parse()`或`int.TryParse()`检查您的转化，尽管您所拥有的似乎应该有效。

**编辑**

如果这些都不起作用，我唯一的建议是——是的，这实际上可能会做一些事情——在您计算机上的另一个帐户下运行代码，或者完全在另一台计算机上运行代码。如果您的 Windows 配置文件已损坏，则将可格式化数据类型转换为字符串时可能会遇到问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-25T07:31:44.697

哦，太糟糕了，对不起，我发现了错误：*有人*将 q1 声明为布尔值 :(

# c# - JPG、DOC、PDF 等文件是否也编译成程序集？

> ID：786996
> 
> 赞同：3
> 
> 时间：2009-04-24T18:15:45.263
> 
> 标签：c#, .net, asp.net, assemblies

**Q1：**

1.  是否`aspnet_compiler.exe`将网站目录中包含的所有文件（包括 JPG、DOC 和 PDF 类型）编译成程序集？

2.  如果您将图像添加到 Web 项目的文件列表中（从而将它们添加到项目文件中），这些图像是否也会被 VS 编译成程序集？

**Q2：**

当`aspnet_compiler.exe`将应用程序编译成程序集时，它还会编译资源和 Web 引用。

1.  我不确定我是否理解“正在编译的 Web 引用”是什么意思。文本在谈论什么样的网络参考？
2.  文本还提到资源也被编译。哪些文件被视为资源？只是非 ASP.Net 文件，例如 JPG、DOC 等？

谢谢

编辑：

> 但是，我必须要问，为什么您首先要将这些文件嵌入到程序集中？也许你没有朝着正确的方向前进..

我不打算在程序集中嵌入文件，但我不确定这是否会在 Asp.Net 编译网站或 WebProject 时自动发生

无论如何，谢谢你们的帮助

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T18:24:40.220

1A：不，如果您指定“嵌入资源”作为对它们的编译操作，则只能将内容文件添加到生成器程序集中

1B : 同 1A

2：必须将文件标记为“嵌入式资源”才能编译到程序集中。

但是，我必须要问，为什么您首先要将这些文件嵌入到程序集中？也许你没有朝着正确的方向前进..

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T18:26:16.190

第一季度

A）不，他们保留他们的文件名并且在程序集之外。

B）不，他们保留他们的文件名并且在程序集之外。

第二季度

A) Web 引用是指在您的项目中引用的 Web 服务。添加 Web 引用时，会生成一个代理来处理与服务的通信。该代理需要与您的项目一起编译（代理是自动生成的，因此您无需担心）。

B) 资源文件是您的项目中包含的 *.resx。Web 应用程序中资源文件最常见的用途是国际化。这些文件确实会编译到您的应用程序中。

# multithreading - 使用 NXT 的多线程

> ID：786997
> 
> 赞同：4
> 
> 时间：2009-04-24T18:15:59.303
> 
> 标签：multithreading, robotics, mindstorms

在我的机器人俱乐部，我们正试图让多线程功能在 LEGO Mindstorms NXT 上工作，但似乎线程相互干扰并导致程序完全停止。

有谁知道如何在 NXT 可视化编程环境上正确实现多线程。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T18:26:26.160

**有谁知道如何在 NXT 可视化编程环境中正确实现多线程？**

是的，很多人都知道如何在 NXT 可视化编程环境中实现多线程。

但是，除非您更具体，否则您不会发现您的特定问题出了什么问题。不过，有很多陷阱。

例如，如果您在一个循环中有两个线程，则在两个线程都完成之前，循环不会循环。

还有很多其他的——这里不一一列举——所以开始逐个调试你的程序，并发布你的“代码”示例（截图？），然后描述它在做什么，以及你想要它做什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-06T21:24:49.640

这个关于多项任务的教程可能是您正在寻找的内容： [多项任务](http://www.ortop.org/NXT_Tutorial/tasks.html)

# asp.net - 嵌套列表视图数据绑定 - 找不到属性？

> ID：786998
> 
> 赞同：0
> 
> 时间：2009-04-24T18:16:17.087
> 
> 标签：asp.net, linq-to-sql, data-binding, listview

我有一个列表视图，我在代码隐藏中设置数据源 - 这工作正常。当我将另一个列表视图（或数据绑定控件）添加到列表视图的项目模板中，并在代码隐藏中设置该控件的数据源时，查询返回的字段似乎对嵌套列表视图不可用；ASP.NET 引发以下错误：DataBinding：“System.String”不包含名为“j_Name”的属性。

在下面的示例中，d_Description 工作正常，而 j_Role 抛出上述错误。我可以看到查询返回的数据，并且我知道列名匹配，那么是什么导致了错误（以及如何解决它）？

ASPX 页面

```
<asp:ListView ID="LV1" runat="server">
    <LayoutTemplate>
        <table runat="server" id="tblSummary">
            <tr runat="server" id="itemPlaceholder" />
        </table>
    </LayoutTemplate>
    <ItemTemplate>
        <tr>
            <td>
                <%#Eval("d_Description")%>
            </td>
        </tr>
        <tr>
            <td>
                <asp:ListView ID="LV2" runat="server">
                    <ItemTemplate>
                        <%#Eval("j_Role")%>
                    </ItemTemplate>
                    <LayoutTemplate>
                        <asp:placeholder id="itemPlaceholder" runat="server" />
                    </LayoutTemplate>
                </asp:ListView>
            </td>
        </tr>
    </ItemTemplate>
</asp:ListView> 
```

代码背后

```
var qry1 = from q in context.Descriptions select q.d_Description;
LV1.DataSource = qualificationQry;
LV1.DataBind(); 

var qry2 = from q in context.Roles select q.j_Role;
LV2.DataSource = qualificationQry;
LV2.DataBind(); 
```

**编辑：** 我在外部列表视图的 ItemDataBound 事件中添加了类似于下面的代码，但我仍然遇到同样的错误。大概是我误解了教程？

```
protected void LV_ItemDataBound(object sender, ListViewItemEventArgs e)
{
    using (dbDataContext context = new dbDataContext()
    {
        var qry2 = from q in context.Roles select q.j_Role;

        ListView tempLV = (ListView)e.Item.FindControl("LV2");
        tempLV.DataSource = qry2;
        tempLV.DataBind();
    }
} 
```

**编辑：2** 在网上阅读了更多内容之后（现在我知道要搜索什么），建议的答案似乎是正确的 - 但是，它不起作用 - 任何人都可以提出原因吗？

**编辑：3** 如果我放弃 j_Name 的输出，并且只有一个硬编码字符串，则没有错误，并且硬编码字符串输出预期的次数。这表明它只是列名 (j_Name) 是错误的 - 即使我可以看到从查询中返回的具有该确切列名的数据集。

**编辑：4** 修复它。这是错误 `var qry2 = from q in context.Roles select q.j_Role;` 的 这是正确的 `var qry2 = from q in context.Roles select q;`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T18:18:27.550

[您需要在外列表的ItemDataBoundEvent](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listview.itemdatabound.aspx)中为外列表的每一行绑定内列表。

所以这段代码：

```
var qry2 = from q in context.Roles select q.j_Role;
LV2.DataSource = qualificationQry;
LV2.DataBind(); 
```

将需要进入外部列表 ItemDataBound 事件的偶数处理程序：

```
protected void ContactsListView_ItemDataBound(object sender, ListViewItemEventArgs e)
{
  if (e.Item.ItemType == ListViewItemType.DataItem)
  {
    // Bind the inner list on every repeat of the outer list
    var qry2 = from q in context.Roles select q.j_Role;
    LV2.DataSource = qualificationQry;
    LV2.DataBind();
  }
} 
```

并且大概您会希望根据外部列表的当前项中的值过滤内部列表的值*****`*********