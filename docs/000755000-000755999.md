# StackOverflow 问答 000755000-000755999

# .net - WinForm 控件在 .Enabled = false 上的行为不同

> ID：755002
> 
> 赞同：1
> 
> 时间：2009-04-16T06:41:16.437
> 
> 标签：.net, winforms, controls

我在 WinForm 上有一些控件，即：CheckedListBox、ListBox、ListView、TreeView、TextBox。

上

```
ControlName.Enabled = false; 
```

我发现了以下结果：

*   ListView 和 TextBox 的 BackColor 变灰。
*   CheckedListBox、ListBox 和 TreeView 的 BackColor 不会变灰。

为什么会有这种行为？是故意的还是错误的？以及如何统一行为？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T16:47:50.173

AFAIK，这是设计使然，除非您覆盖默认行为。

这并不完全相关，但我想我会发布另一个问题的链接。

[如何使 Windows 窗体控件只读？](https://stackoverflow.com/questions/255955/how-do-i-make-a-windows-forms-control-readonly)

# iphone - 如何将 iphone 库与我的 iPhone 应用程序连接？

> ID：755003
> 
> 赞同：0
> 
> 时间：2009-04-16T06:41:31.410
> 
> 标签：iphone, objective-c

我想做一个需要连接到 iphone 音乐库的项目。当我的应用程序启动音乐文件时，添加我的应用程序并在我想要的时候播放。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T08:01:15.697

当前版本的 SDK 无法实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T15:52:58.463

您将对 3.0 SDK 中的 iPhone / iPod Touch 媒体库具有只读访问权限。即您将能够播放歌曲，但不能修改任何内容。

# java - 字节码如何在 JVM 中得到验证？

> ID：755005
> 
> 赞同：15
> 
> 时间：2009-04-16T06:42:37.960
> 
> 标签：java, jvm, bytecode

字节码如何在 JVM 中得到验证？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-16T06:45:43.740

[Oracle 自己在这里](http://www.oracle.com/technetwork/java/security-136118.html)有一个关于它如何工作的小片段页面。

基本上，JRE 不信任 JDK。那是因为它不知道哪个 JDK 编译器创建了类文件。在验证之前，它将类文件视为敌对文件。

在此基础上，字节码验证是防止 Sun 所谓的“恶意编译器”的必要步骤。Sun 自己的 Java 编译器确保 Java 源代码不违反安全规则，但是，当应用程序导入代码片段时，它实际上并不*知道*代码片段是否遵循 Java 语言安全规则。换句话说，代码可能不是由值得信赖的 Java 编译器生成的。

在这种情况下，您机器上的 Java 运行时系统必须假定该片段是错误的，并对其进行字节码验证。

Java 虚拟机在完成此验证过程之前甚至*看不到字节码。*在加载字节码时执行此操作还有一个优点，即无需在每次执行代码时都执行大量运行时检查。因为它已被验证为正确，所以一旦它开始运行，它就可以比其他方式运行得更快。

链接图的再现如下：

```
 <<<=== Unsafe / Safe ===>>>
                                  \
+---------------+        +-------------------+
|  Java source  |   +--> |   Class loader    | --+
+---------------+   |    | Bytecode verifier |   |
        |           |    +-------------------+   |
        V           |             /              |
+---------------+   |             \              V
| Java compiler |  Network        /    +-------------------+
+---------------+   |             \    |      JVM/JIT      |
        |           |             /    +-------------------+
        V           |             \              |
+---------------+   |             /              V
| Java bytecode | --+             \    +-------------------+
+---------------+                 /    | Operating system  |
                                  \    +-------------------+
                                  /              |
                                  \              V
                                  /    +-------------------+
                                  \    |     Hardware      |
                                  /    +-------------------+
                                  \
                    <<<=== Unsafe / Safe ===>>> 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-16T06:44:28.267

最好的信息来源可能是 JVM 规范中的相关部分，[4.10 Verification of class Files](https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.10)。

有关详细信息，请参阅链接，但范围很广：

> 链接时验证提高了解释器的性能。可以消除在运行时必须执行的昂贵检查以验证每个解释指令的约束。Java 虚拟机可以假定已经执行了这些检查。例如，Java 虚拟机已经知道以下内容：
> 
> *   没有操作数堆栈上溢或下溢。
> *   所有局部变量的使用和存储都是有效的。
> *   所有 Java 虚拟机指令的参数都是有效类型。
> 
> 验证器还执行无需查看 Code 属性的代码数组即可完成的验证（第 4.7.3 节）。执行的检查包括以下内容：
> 
> *   确保最终类没有子类化并且最终方法没有被覆盖（第 5.4.5 节）。
> *   检查每个类（除了`Object`）有一个直接的超类。
> *   确保常量池满足记录的静态约束；例如，`CONSTANT_Class_info`常量池中的每个结构在其`name_index`项中都包含一个结构的有效常量池索引`CONSTANT_Utf8_info`。
> *   检查常量池中的所有字段引用和方法引用是否具有有效的名称、有效的类和有效的类型描述符。

# java - 如何从 Java 中的超类的上下文中检索最低子类的名称？

> ID：755007
> 
> 赞同：2
> 
> 时间：2009-04-16T06:43:01.563
> 
> 标签：java, debugging, stack-trace

### 合理的

我想在几个超类上有更详细的日志调试/日志输出，因此子类名称实际上不会影响实时性能或应用程序逻辑。我也认为正常执行此操作是相当糟糕的设计，但是我确实希望在开发运行期间记录此信息。

### 问题

假设我有一个简单的类结构，如下所示，如何将子类的名称拉入超类而无需显式传递引用？

```
public abstract AbstractClass {
    private Logger logger = LoggerFactory.getLogger(getClass());

    public AbstractClass() {}

    public void execute(ContextObject context) {
        if (logger.debuggingEnabled()) {
            String invokingClassName = ""; // <-- how do I get this?
            logger.debug("Executing {}", invokingClassName);
        }
        // shared application logic is here...
    }
}

public MyClass extends AbstractClass {
    public MyClass() {}

    @Override
    public void execute(ContextObject context) {
        super.execute(context);
        // application logic...
    }
} 
```

我以前曾使用过解析堆栈跟踪，我怀疑如果我想要这些信息，我必须走这条路。有谁知道可以为我做这件事的库或一个好的代码片段？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-16T06:48:06.777

不会[`this.getClass().getName()`](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Class.html#getName())奏效吗？即：

```
public void execute(ContextObject context) {
    if (logger.debuggingEnabled()) {
        String invokingClassName = ""; // <-- how do I get this?
        logger.debug("Executing {}", this.getClass().getName());
    }
    // shared application logic is here...
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T06:53:15.313

执行此行时，您已经获得了该信息：

```
private Logger logger = LoggerFactory.getLogger(getClass()); 
```

*这意味着您将使用实际*课程的类别进行记录。由于该信息已经在日志中，我认为将其*包含*在`execute`方法中没有多大意义。只需确保您的日志输出格式包含类别名称就可以了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-16T06:51:47.533

为什么要显式记录类名。Log4j 已经这样做了。您定义 Logger 的方式将起到作用。检查您的日志文件。

# java - 为什么 Sybase JDBC 驱动程序“吃掉”异常？

> ID：755021
> 
> 赞同：1
> 
> 时间：2009-04-16T06:49:21.220
> 
> 标签：java, jdbc, sybase, sqlexception

我正在使用官方 Sybase JDBC 驱动程序连接到数据库并通过创建 CallableStatement、将参数绑定到它并在其上调用 .execute() 来调用存储过程。

但是，我发现即使存储过程失败，也没有抛出异常。我可以通过使用 Wireshark 嗅探到数据库的流量并观察返回的错误消息来验证故障是否传播回给我。

最后我发现使用 .executeUpdate() 而不是 .execute()*确实*给了我例外，但是我还有两个问题：

1.  为什么 .execute() 和 .executeUpdate() 表现不同？从界面的 SUN 文档看来，他们应该（几乎）做同样的事情......
2.  调用存储过程时将 .execute() 替换为 .executeUpdate() 是否总是合适的？存储过程必须符合某些特定要求才能使用 .executeUpdate() 调用吗？（例如，它必须有一个更新/删除/插入语句作为最后一步吗？）

*更新*：我尝试过 jTDS，它的行为正确（如：它在两种情况下都抛出 SQLException - 使用 .execute() 和使用 .executeUpdate()）。但是，由于我无法控制的限制，切换驱动程序是不可能的。

另外：我对这个存储过程返回的结果不感兴趣，它是一个插入/更新类型的过程。我只会被插入以查看（并且能够捕获/记录）它是否失败。我尝试过的另一件事是在 .execute() 之后从连接中获取警告，但它也不包含任何内容。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T20:34:57.877

因为那些 Sybase 人都疯了，所以才会吃 Exceptions！没有理由避免对准备好的/可调用的语句使用 executeUpdate()。如果这是您必须使用它来使其正常工作，那么请继续这样做。但是您应该向 Sybase 提交错误报告 - 驱动程序没有理由这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-06T11:46:38.933

不确定，sybase的人是否“疯了”。也许。

另一方面，当您不主动检查可调用语句的返回代码时，不同步检索结果可能在性能方面有意义。我还没有完全测试它，但是有一个简单的解决方法可以解决您的问题（ASE 15.5，jconn 7）：

当您从存储过程中获取输出参数时（至少在调用存储过程时），将触发异常：

```
 // one may force the error check by retrieving the return code!
    cs = conn.prepareCall("{ ? = call sp_nested_error @nNestLevels = 1 }");
    cs.registerOutParameter(1, Types.INTEGER);
    cs.execute();
    try {
        cs.getInt(1);
        fail();
    } catch(SQLException e) {
        assertTrue(e.getMessage().indexOf("some error") > -1);
    } 
```

另一个令人好奇的是，这种行为仅在嵌套存储过程调用中触发错误时才会出现，而当最顶层的过程引发错误时，解决方法不是必需的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T07:17:26.817

对 Sybase 一无所知，但是

executeUpdate 返回比执行更多的信息：插入/更新/删除的行数

-> 根据 javadoc，它可用于 UPDATE INSERT DELETE 和 DML 操作。

executeQuery 返回一个 ResultSet，这是用于 SELECT 语句的。

# xml - XML 模式检查错误

> ID：755024
> 
> 赞同：2
> 
> 时间：2009-04-16T06:51:14.257
> 
> 标签：xml, schema

我正在使用以下架构来检查以下 XML 文件。而且我发现当 People 元素中有多个 Information 元素时，模式检查将失败。为什么以及如何解决它（我想让 People 元素能够嵌套多个信息项）？

XML 架构文件：

```
 <xs:element name="People">
    <xs:complexType>
      <xs:sequence>
        <xs:element name="Information">
          <xs:complexType>
            <xs:sequence>
              <xs:element name="Name" type="xs:string"/>
            </xs:sequence>
            <xs:attribute name="Id" type="xs:string"/>
          </xs:complexType>
        </xs:element>
      </xs:sequence>
    </xs:complexType>
  </xs:element> 
```

XML 文件（架构检查将失败）：

```
 <People>
    <Information Id="1">
      <Name>John</Name>
    </Information>
    <Information Id="2">
      <Name>Mike</Name>
    </Information>
  </People> 
```

XML 文件（模式检查将成功）：

```
 <People>
    <Information Id="1">
      <Name>John</Name>
    </Information>
  </People> 
```

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T06:57:40.577

如果不指定序列的 minOccurs 和 maxOccurs，则默认值为 1。

```
<xs:element name="Information" minOccurs = "1" maxOccurs = "unbounded"> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T07:02:14.310

```
<xs:element name="People">
    <xs:complexType>
      <xs:sequence>
        <xs:element minOccurs="1" maxOccurs="unbounded" name="Information">
          <xs:complexType>
            <xs:sequence>
              <xs:element name="Name" type="xs:string"/>
            </xs:sequence>
            <xs:attribute name="Id" type="xs:string"/>
          </xs:complexType>
        </xs:element>
      </xs:sequence>
    </xs:complexType>
  </xs:element> 
```

试试这个它肯定会工作

# c# - 使用 ASP.NET 在加载时更改我的 GridView 中的值

> ID：755027
> 
> 赞同：4
> 
> 时间：2009-04-16T06:52:36.547
> 
> 标签：c#, asp.net, gridview

我有一个 GridView，它填充了来自 SQL 数据库的数据，非常简单。现在我想像这样替换我的一列中的值......

如果 c04_oprogrs 值为 1，则在 GridView 中显示**Take 。**

如果 c04_oprogrs 值为 2，则在 GridView 中显示**可用。**

我必须进行哪些代码更改才能更改我的代码以显示新值。

我的网格

```
<asp:GridView ID="GridView1" runat="server" AutoGenerateColumns="False" 
                Height="281px" Width="940px" 
                Font-Size="X-Small" AllowPaging="True" 
                onpageindexchanging="GridView1_PageIndexChanging">
                <Columns>
                    <asp:BoundField DataField="c04_oprogrs" HeaderText="Order Progress" 
                        SortExpression="c04_oprogrs" />
                    <asp:BoundField DataField="c04_orderno" HeaderText="Order No." 
                        SortExpression="c04_orderno" />
                    <asp:BoundField DataField="c04_orddate" HeaderText="Date of Order" 
                        SortExpression="c04_orddate" DataFormatString="{0:d/MM/yyyy}" />
                    <asp:BoundField DataField="c04_ordval" HeaderText="Order Value" 
                        SortExpression="c04_ordval" DataFormatString="{0:R#,###,###.00}" />
                    <asp:BoundField DataField="c04_delval" HeaderText="Delivered Value" 
                        SortExpression="c04_delval" DataFormatString="{0:R#,###,###.00}" />
                    <asp:BoundField DataField="c04_invval" HeaderText="Invoice Value" 
                        SortExpression="c04_invval" DataFormatString="{0:R#,###,###.00}" />
                    <asp:BoundField DataField="c04_orddesc" HeaderText="Order Description" 
                        SortExpression="c04_orddesc" >
                        <ControlStyle Width="300px" />
                    </asp:BoundField>
                </Columns>
            </asp:GridView> 
```

我的页面加载

```
SqlConnection myConnection;
        DataSet dataSet = new DataSet();
        SqlDataAdapter adapter;

        //making my connection
        myConnection = new SqlConnection(ConfigurationManager.ConnectionStrings["SAMRASConnectionString"].ConnectionString);

        adapter = new SqlDataAdapter("Select TOP 40 c04_credno, c04_orderno, c04_orddate, c04_ordval, c04_delval, c04_invval, c04_oprogrs, c04_orddesc FROM C04ORDS WHERE c04_credno = '" + Session["CreditorNumber"] + "'AND c04_oprogrs <> 9 ORDER BY c04_orddate DESC", myConnection);

        adapter.Fill(dataSet, "MyData");

        GridView1.DataSource = dataSet;
        Session["DataSource"] = dataSet;
        GridView1.DataBind(); 
```

艾蒂安

**编辑：**

*我的最终解决方案*

```
protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)
    {
        if (e.Row.RowType == DataControlRowType.DataRow)
        {
            // Find the value in the c04_oprogrs column. You'll have to use

            string value = e.Row.Cells[0].Text;

            if (value == "1")
            {
                e.Row.Cells[0].Text = "Take";
            }
            else if (value == "2")
            {
                e.Row.Cells[0].Text = "Available";
            }
        }

    } 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-16T07:00:14.190

您可以[`RowDataBound`](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowdatabound.aspx)为此使用事件。使用此事件，您可以在呈现网格之前更改特定列的内容。

澄清一点。首先，您在网格视图中添加一个带有标签的模板列（另请参见 ranomore 的答案）：

```
<asp:TemplateField>
    <ItemTemplate>
        <asp:Label ID="myLabel" runat="server" />
    </ItemTemplate>
</asp:TemplateField> 
```

接下来你实现`RowDataBound`事件（我没有检查下面的代码，所以它可能包含一些语法错误）：

```
protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)
{
    if(e.Row.RowType == DataControlRowType.DataRow)
    {
        // Find the value in the c04_oprogrs column. You'll have to use
        // some trial and error here to find the right control. The line
        // below may provide the desired value but I'm not entirely sure.
        string value = e.Row.Cells[0].Text;

        // Next find the label in the template field.
        Label myLabel = (Label) e.Row.FindControl("myLabel");
        if (value == "1")
        {
            myLabel.Text = "Take";
        }
        else if (value == "2")
        {
            myLabel.Text = "Available";
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T07:16:22.420

您可以使用模板列并在后面的代码中调用函数。

```
 <asp:TemplateField>
        <ItemTemplate>
                       <asp:Label runat="server" Text='<%#FieldDisplay(Eval("c04_oprogrs")) %>'></asp:Label>
        </ItemTemplate>
    </asp:TemplateField> 
```

然后在你的代码后面做

```
protected string FieldDisplay(int c04_oprogrs)
{
 string rtn = "DefaultValue";
 if (c04_oprogrs == 1)
 {
    rtn = "Take";
 }
 else if (c04_oprogrs == 2)
 {
    rtn = "Available";
 }
 return rtn;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T18:54:59.883

不使用函数。三元语句在VB中。如果您必须嵌套另一个三元语句来真正测试 2，那么使用 rwwilden 的解决方案会更容易。

```
<asp:TemplateField HeaderText="Order Progress" SortExpression="c04_oprogrs" >
    <ItemTemplate>
        <asp:Label runat="server" ID="Label1" Text='<%# IIF(CInt(Eval("c04_oprogrs")) = 1, "Take", "Available") %>' />
    </ItemTemplate>
</asp:TemplateField> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T07:04:51.293

您可以在 SQL 语句中添加一个字段

```
 adapter = new SqlDataAdapter("Select TOP 40 c04_credno, c04_orderno, c04_orddate,  
c04_ordval, c04_delval, c04_invval, c04_oprogrs, c04_orddesc **,  
CASE c04_oprogrs WHEN 1 THEN "Take" WHEN 2 THEN "Available" ELSE "DontKnow" END AS  
Status** FROM C04ORDS WHERE c04_credno = '" + Session["CreditorNumber"] + "'AND  
c04_oprogrs  9 ORDER BY c04_orddate DESC", myConnection); 

```

并使该新字段成为标记中 BoundColumn 的一部分。
请原谅我的 SQL 语法，但我希望你明白这一点。

编辑：不要使用语法 `= '" + Session["CreditorNumber"] + "'`。
请参阅 sql 注入攻击以及如何使用参数化 SQL 来避免它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-07-19T09:22:03.190

这是最有效的方法。在 sql server 视图中创建一个案例，例如：-

```
select case <columnname> 
       when 1 then 'available' 
       when 0 then 'not available' 
       end as <columnname> 
from <tablename> 
```

# c++ - 在默认参数上重载方法

> ID：755028
> 
> 赞同：1
> 
> 时间：2009-04-16T06:52:45.800
> 
> 标签：c++, string, delimiter

是否可以在默认参数上重载方法？

例如，如果我有一个 split() 方法来拆分字符串，但该字符串有两个分隔符，比如 '_' 和 "delimit"。我可以有两种方法吗：

```
split(const char *str, char delim = ' ') 
```

和

```
split(const char *str, const char* delim = "delimit"); 
```

或者，有没有更好的方法来实现这一点？不知何故，我的大脑现在不工作，无法想到任何其他解决方案。

编辑：详细的问题：

我有一个带有两个分隔符的字符串，例如 nativeProbableCause_Complete|Alarm|Text。我需要将 nativeProbableCause 和 Complete|Alarm|Text 分开，然后进一步，我需要将 Complete|Alarm|Text 分成单个单词，并在稍后将它们用空格作为分隔符连接起来（为此我已经编写了一个实用程序并且不是没什么大不了的）。困扰我的只是分隔字符串的分离。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T07:04:35.413

不，你不能——如果你仔细想想，默认的概念意味着“除非我另有说明，否则使用它”。如果编译器有 2 个默认选项，它会选择哪一个？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T07:07:00.710

如何实现 2 种不同的方法，例如

*   `split_with_default_delimiter_space`
*   `split_with_default_delimiter_delimit`

就我个人而言，我更喜欢使用这样的东西（更具可读性..意图传达）而不是你提到的重载类型......即使编译器有可能这样做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T07:41:44.340

为什么不直接调用 split() 两次并第二次显式传递分隔符？分隔符总是单个字符吗？

在加入第二组单词之前，您是否对它们进行了任何其他处理？如果不是，那么对于第二个任务，您真正想要做的是替换子字符串。使用 std::string::find 和 std::string::replace 最容易做到这一点。如果您必须使用 c-strings，您可以使用 strstr/strchr/strpbrk、strcpy 和 strcat，或者只使用 strstr/strchr/strpbrk 并将它们连接到位。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T07:30:15.477

您可以使用一个版本的 split 接受可变数量的分隔符（`split(const char*,vector<string>)`如果您愿意的话`split(const char*, const char**)`），或者只使用[Boost Tokenizer](http://www.boost.org/doc/libs/1_38_0/libs/tokenizer/index.html)。

# unicode - unicode.org 文件“UnicodeData.txt”的字段记录在哪里？

> ID：755035
> 
> 赞同：18
> 
> 时间：2009-04-16T06:59:32.413
> 
> 标签：unicode

我找不到 UnicodeData.txt 文件的实际字段的文档。

数据[可在此处获得](http://www.unicode.org/Public/5.1.0/ucd/)。描述它的文档[可在此处获得，](http://www.unicode.org/Public/5.1.0/ucd/UCD.html)但它没有列出实际的字段编号和字段是什么（就像以前在[3.0 版本](http://www.unicode.org/Public/3.0-Update/UnicodeData-3.0.0.html)左右的文档中一样）。

我已经搜索了该站点，并且一定错过了一些就在我眼前的东西，但我找不到它。

有人能指出这些信息现在在哪里吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T07:24:51.167

**更新**

对不起，我误读了这个问题。不过，我认为信息在您提供的链接中，在[UnicodeData.txt](http://www.unicode.org/Public/5.1.0/ucd/UCD.html#UnicodeData.txt)部分下。对于每个字段，文档内的链接会列出其值（如果适用）。似乎与 3.0 版本中的列表相同。

# php - PHP中动态mysqli bind_param参数的简单解决方案是什么？

> ID：755036
> 
> 赞同：7
> 
> 时间：2009-04-16T06:59:32.443
> 
> 标签：php, mysqli

要动态构建 bind_param，我在其他 SO 帖子中发现了这一点。

```
call_user_func_array(array(&$stmt, 'bindparams'), $array_of_params); 
```

有人可以用简单的英语为我分解吗？我特别迷失了第一个参数是一个数组。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-16T07:39:34.470

```
array($stmt, 'bindparams') 
```

是 PHP 在 object 上识别方法 bind_params 的方式`$stmt`，因为 PHP 5 您不再需要使用`&`前面的方法（而 mysqli 是 PHP 5，所以这看起来像是旧帖子中的一个小故障）。

[你可以在这里](http://nz2.php.net/call_user_func_array)看到一个类似的例子

所以

```
call_user_func_array(array($stmt, 'bindparams'), $array_of_params); 
```

基本上意味着

```
$stmt->bind_params($array_of_params[0], $array_of_params[1] ... $array_of_params[N]) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-10-19T06:42:39.393

据我所知，您不能将 eg 的结果传递 `$userid == "ALL"` 给 mysqli-statement-Object 的 bind_param 方法，因为该方法希望通过引用传递参数。显然，对于“就地”评估的表达式的结果，这是不可能的。

作为一种解决方法，我将程序的第二部分更改为

```
$userIdEmpty = $userid == "ALL";
$locationEmpty = $location = "ALL";
$stmt->bind_param( "siiiii", 
  "active", $userid, $userIdEmpty,
  $location, $locationEmpty,
  $limit); 
```

像这样，布尔运算的结果可以通过引用传递。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T07:52:42.643

有一种更简单的方法可以做到这一点。

创建这个准备好的语句：

```
select * from mytable 
 where status = ? and (userid = ? or ?) 
 and (location = ? or ?)
 order by `date` desc, time desc
 limt ? 
```

并像这样传递参数来绑定：

```
$stmt = $mysqli->prepare( [statement above] );
$stmt->bind_param( "siiiii", 
  "active", $userid, $userid == "ALL", 
  $location, $location == "ALL", 
  $limit); 
```

当 user_id 等于第一个替换参数或第二个替换参数为 true 时，谓词`(user_id = ? or ?)`为 true。

`$user_id`当转换为 int 时，当它是数字的字符串表示形式时，将是它的值，否则为零。该表达式`$userid == "ALL"`将计算为一个布尔值，该布尔值将传递给`bind_param`. 我们无法判断`bind_param`一个参数是布尔值（格式字符串只能理解 string、int、double 和 blob），因此 bind_param 会将布尔值转换为 int，这对我们有用。

只要数据库中没有 user_id 或 location_id 为零，就可以了。

# java - 如何在运行时将组件与另一个容器封装在一起？

> ID：755042
> 
> 赞同：0
> 
> 时间：2009-04-16T07:01:43.500
> 
> 标签：java, swing

我想要实现的基本上是 Netbeans 在运行时的“封闭”功能：

假设我有这个组件层次结构：

```
Container
    Label 1
    Label 2
    Label 3 
```

我想这样附上`Label 2`：

```
Container
    Label 1
    Container
        Label 2
    Label 3 
```

而且我还想恢复它，即我想再次“拉起”标签以获得原始层次结构。

**编辑：**问题是在运行时我只知道`Label 2`. 任何其他组件（兄弟姐妹、父母、孩子）都是未知的。这消除了仅重建层次结构的可能性。

当然，我确信我可以通过遍历组件层次结构找到*某种方法来获得此功能，但我想知道：*

有没有更好的办法？也许某种提供这种封装功能的实用程序类？

**编辑 2：**如何获取组件最初添加到容器的布局约束？我需要这些信息，因为新容器必须使用相同的约束。此外，在恢复原始层次结构时，组件必须重新使用其旧约束。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T07:09:15.807

`Container`s 也是`Component`s，因此可以将 s 包含`Container`在`Container`s 中。

因此，也许第一个状态将类似于（伪代码）：

```
Container container1 = new Container();
Label label1 = new Label();
Label label2 = new Label();
Label label3 = new Label();
container1.add(label1);
container1.add(label2);
container1.add(label3); 
```

要转换到第二个状态：

```
Container container2 = new Container();
container1.remove(label2);
container2.add(label2);
container2.add(container1); 
```

现在，`label2`被移入`container2`并且该容器本身包含在`container1`.

并返回原始状态：

```
container2.remove(label2);
container1.add(label1);
container1.remove(container2); 
```

**编辑**

如果我们只知道它`label2`本身，它已经包含在 some 中，我们可以通过调用'方法`Container`来确定父级。`Container``Component`[`getParent()`](http://java.sun.com/javase/6/docs/api/java/awt/Component.html#getParent())

将其应用于上面的代码，用以下内容替换 make 行`container1`：

```
Container container1 = label2.getParent(); 
```

如果要获取`Component`s 中保存的 s，可以调用`Container`该[`getComponents()`](http://java.sun.com/javase/6/docs/api/java/awt/Container.html#getComponents())方法以检索 s 数组`Component`。

# delphi - 在 Delphi 中，如何检查 IInterface 引用是否实现了派生但未明确支持的接口？

> ID：755044
> 
> 赞同：12
> 
> 时间：2009-04-16T07:02:44.980
> 
> 标签：delphi, winapi, types, interface, delphi-2007

如果我有以下接口和实现它们的类 -

```
IBase = Interface ['{82F1F81A-A408-448B-A194-DCED9A7E4FF7}']
End;

IDerived = Interface(IBase) ['{A0313EBE-C50D-4857-B324-8C0670C8252A}']
End;

TImplementation = Class(TInterfacedObject, IDerived)
End; 
```

下面的代码打印出'Bad！' -

```
Procedure Test;
Var
    A : IDerived;
Begin
    A := TImplementation.Create As IDerived;
    If Supports (A, IBase) Then
        WriteLn ('Good!')
    Else
        WriteLn ('Bad!');
End; 
```

这有点烦人但可以理解。支持无法转换为 IBase，因为 IBase 不在 TImplementation 支持的 GUID 列表中。可以通过将声明更改为 -

```
TImplementation = Class(TInterfacedObject, IDerived, IBase) 
```

然而，即使不这样做，我也**已经知道**A 实现了 IBase，因为 A 是一个 IDerived，而 IDerived 是一个 IBase。因此，如果我遗漏支票，我可以投 A，一切都会好起来的 -

```
Procedure Test;
Var
    A : IDerived;
    B : IBase;
Begin
    A := TImplementation.Create As IDerived;
    B := IBase(A);
    //Can now successfully call any of B's methods
End; 
```

但是当我们开始将 IBase 放入一个通用容器（例如 TInterfaceList）时，我们遇到了一个问题。它只能容纳 IInterfaces，所以我们必须做一些转换。

```
Procedure Test2;
Var
    A : IDerived;
    B : IBase;
    List : TInterfaceList;
Begin
    A := TImplementation.Create As IDerived;
    B := IBase(A);

    List := TInterfaceList.Create;
    List.Add(IInterface(B));
    Assert (Supports (List[0], IBase)); //This assertion fails
    IBase(List[0]).DoWhatever; //Assuming I declared DoWhatever in IBase, this works fine, but it is not type-safe

    List.Free;
End; 
```

我非常希望有某种断言来捕获任何不匹配的类型——这种事情可以使用 Is 运算符对对象完成，但这不适用于接口。由于各种原因，我不想将 IBase 显式添加到支持的接口列表中。有什么方法可以编写 TImplementation 和断言，使其评估为真 iff 硬铸造 IBase(List[0]) 是安全的事情吗？

**编辑：**

正如答案之一中出现的那样，我添加了两个主要原因，我不想将 IBase 添加到 TImplementation 实现的接口列表中。

首先，它实际上并没有解决问题。如果，在 Test2 中，表达式：

```
Supports (List[0], IBase) 
```

返回 true，这并不意味着执行硬转换是安全的。QueryInterface 可能会返回一个不同的指针来满足请求的接口。例如，如果 TImplementation 显式实现了 IBase 和 IDerived（以及 IInterface），那么断言将成功通过：

```
Assert (Supports (List[0], IBase)); //Passes, List[0] does implement IBase 
```

但是想象一下，有人错误地将一个项目作为 IInterface 添加到列表中

```
List.Add(Item As IInterface); 
```

断言仍然通过 - 该项目仍然实现 IBase，但添加到列表中的引用仅是 IInterface - 将其硬转换为 IBase 不会产生任何合理的结果，因此断言不足以检查以下是否硬 -演员是安全的。保证工作的唯一方法是使用铸态或支持：

```
(List[0] As IBase).DoWhatever; 
```

但这是一个令人沮丧的性能成本，因为它的目的是由代码将项目添加到列表中以确保它们属于 IBase 类型 - 我们应该能够假设这一点（因此，如果这个假设是，则要捕获的断言错误的）。断言甚至不是必需的，除非有人更改某些类型时捕获以后的错误。这个问题来自的原始代码对性能也相当关键，因此我宁愿避免实现很少的性能成本（它仍然只能在运行时捕获不匹配的类型，但无法编译更快的发布版本） .

第二个原因是我希望能够比较引用是否相等，但如果相同的实现对象由具有不同 VMT 偏移的不同引用持有，则无法做到这一点。

**编辑 2：**用一个例子扩展了上面的编辑。

**编辑3：**注意：问题是我如何制定断言，以便在断言通过时硬转换是安全的，而不是如何避免硬转换。有一些方法可以不同地执行硬转换步骤，或者完全避免它，但是如果存在运行时性能成本，我就不能使用它们。我想要在断言中检查的所有成本，以便以后可以编译出来。

话虽如此，如果有人可以在没有性能成本和类型检查危险的情况下完全避免这个问题，那就太好了！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T12:54:49.243

One thing you can do is *stop type-casting interfaces*. You don't need to do it to go from `IDerived` to `IBase`, and you don't need it to go from `IBase` to `IUnknown`, either. Any reference to an `IDerived` *is an* `IBase` already, so you can call `IBase` methods even without type-casting. If you do less type-casting, you let the compiler do more work for you and catch things that aren't sound.

Your stated goal is to be able to check that the thing you're getting out of your list really is an `IBase` reference. Adding `IBase` as an implemented interface would allow you to achieve that goal easily. In that light, your "two major reasons" for not doing that don't hold any water.

1.  "I want to be able to compare references for equality": No problem. COM requires that if you call `QueryInterface` twice with the same GUID on the same object, you get the same interface pointer both times. If you have two arbitrary interface references, and you `as`-cast them both to `IBase`, then the results will have the same pointer value if and only if they are backed by the same object.

    Since you seem to want your list to only contain `IBase` values, and you don't have Delphi 2009 where a generic `TInterfaceList<IBase>` would be helpful, you can discipline yourself to always explicitly add `IBase` values to the list, never values of any descendant type. Whenever you add an item to the list, use code like this:

    ```
    List.Add(Item as IBase); 
    ```

    That way, any duplicates in the list are easy to detect, and your "hard casts" are assured to work.

2.  "It doesn't actually solve the problem": But it does, given the rule above.

    ```
    Assert(Supports(List[i], IBase)); 
    ```

    When the object explicitly implements all its interfaces, you can check for things like that. And if you've added items to the list like I described above, it's safe to disable the assertion. Enabling the assertion lets you detect when someone has changed code elsewhere in your program to add an item to the list incorrectly. Running your unit tests frequently will let you detect the problem very soon after it's introduced, too.

With the above points in mind, you can check that anything that was added to the list was added correctly with this code:

```
var
  AssertionItem: IBase;

Assert(Supports(List[i], IBase, AssertionItem)
       and (AssertionItem = List[i]));
// I don't recall whether the compiler accepts comparing an IBase
// value (AssertionItem) to an IUnknown value (List[i]). If the
// compiler complains, then simply change the declaration to
// IUnknown instead; the Supports function won't notice. 
```

If the assertion fails, then either you added something to the list that doesn't support `IBase` at all, or the specific interface reference you added for some object cannot serve as the `IBase` reference. If the assertion passes, then you know that `List[i]` will give you a valid `IBase` value.

Note that the value added to the list doesn't *need* to be an `IBase` value explicitly. Given your type declarations above, this is safe:

```
var
  A: IDerived;
begin
  A := TImplementation.Create;
  List.Add(A);
end; 
```

That's safe because the interfaces implemented by `TImplementation` form an inheritance tree that degenerates to a simple list. There are no branches where two interfaces don't inherit from each other but have a common ancestor. If there were *two* decendants of `IBase`, and `TImplementation` implemented them both, the above code wouldn't be valid because the `IBase` reference held in `A` wouldn't necessarily be the "canonical" `IBase` reference for that object. The assertion would detect that problem, and you'd need to add it with `List.Add(A as IBase)` instead.

When you disable assertions, the cost of getting the types right is paid only while adding to the list, not while reading from the list. I named the variable `AssertionItem` to discourage you from using that variable elsewhere in the procedure; it's there only to support the assertion, and it won't have a valid value once assertions are disabled.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T07:31:39.560

您的考试是正确的，据我所知，您遇到的问题确实没有直接的解决方案。原因在于接口之间继承的性质，它与类之间的继承只有模糊的相似之处。继承的接口是一个全新的接口，它与继承的接口有一些共同的方法，但没有直接的联系。因此，通过选择不实现基类接口，您做出了编译程序将遵循的特定假设：TImplementation 不实现 IBase。我认为“接口继承”有点用词不当，接口扩展更有意义！一种常见的做法是让基类实现基接口，然后派生类实现扩展接口，但如果您想要一个实现两者的单独类，只需列出这些接口。您要避免使用的特定原因是：

```
TImplementation = Class(TInterfacedObject, IDerived, IBase) 
```

或者只是你不喜欢它？

**进一步评论**

你不应该，甚至硬类型转换一个接口。当您在接口上执行“as”时，它将以正确的方式调整对象 vtable 指针......如果您进行硬转换（并且有方法可以调用），您的代码很容易崩溃。我的印象是您将接口视为对象（以相同的方式使用继承和强制转换），而它们的内部工作方式确实不同！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T07:27:10.117

在测试2中；

您不应该通过 IBase(A) 将 IDerived 重新键入为 IBase，但要使用：

```
Supports(A, IBase, B); 
```

添加到列表可以只是：

```
List.Add(B); 
```

# iphone - 确定 UILabel 中 NSString 自动换行的最佳方法

> ID：755047
> 
> 赞同：1
> 
> 时间：2009-04-16T07:04:25.070
> 
> 标签：iphone, nsstring, word-wrap

我有这样的一行：

```
-Image-这只是一个测试
 -图片-但我想知道如何
将两条线分开。什么
在这里做什么？

```

我能想到在 iPhone 上实现的最佳方法是：

```
UIImageViewUILabel1
             UILabel1
UILabel2

```

如果有更简单的方法可以使用 UI 元素来做到这一点 - 我全神贯注。否则，我试图找出文本在 UILabel1 中的结束位置，而无需使用 sizeWithFont 进行反复试验。

一种更复杂的方法是使用 sizeWithFont 以该字体大小查找每个字符的大小，然后将它们全部加在一起（找出 UILabel1 的第 1 行以及 Line2 上的换行的位置）。这感觉像是解决一个简单问题的艰难方法。有谁知道简单的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T14:15:01.157

Perhaps this is not the answer you are looking for, but this sort of layout is easier done with a WebView.

From an efficiency point of view, `UILabel` text rendering is implemented via WebViews anyway.

[This article by Craig Hockenberry](http://furbo.org/2008/10/07/fancy-uilabels/) suggests that trying to

> use metrics and line breaking that [match] those used in UILabel’s implementation [...] is far from perfect

and also confirms that `UILabel`s use WebViews under the hood (it's also easily seen in a Shark dump of a text-intensive app).

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T14:57:43.723

NSString s = @"第一行\n第二行\n最后一行";

# joomla - 将整个 joomla 站点移动到不同的目录/子域

> ID：755059
> 
> 赞同：2
> 
> 时间：2009-04-16T07:11:05.210
> 
> 标签：joomla

我目前正在一个临时子域中开发一个基于 joomla 1.5 的站点（它指向安装了所有 joomla 东西的服务器上的一个子文件夹）。目前我正在使用插件 joomgallery 和 kunene 1.0.9（传统模式）。开发完成后，我想将整个站点移动到根目录并删除整个子域。理想情况下如何做到这一点？我可以只移动文件还是还有更多？有什么常见的陷阱需要注意吗？例如，有没有引用的绝对路径？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T07:35:30.360

在您的 configuration.php 文件中，可能会定义基本路径，如下所示：

```
var $live_site = 'http://temp.mysite.com/'; 
```

...虽然我认为现在默认情况下，它会自动为您检测此值。

检查自定义组件的配置，看看它们是否也有“硬编码”的路径。

您可以做的另一件事是设置一个`.htaccess`带有 some `RewriteRule`s 的文件，以便将任何调用`http://temp.mysite.com`重定向到`http://www.mysite.com`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T06:41:07.100

有一个免费的 Joomla！这称为 Joomlapack 的扩展。只需使用 Joomlapack 进行备份，将创建的备份文件移动到新站点/文件夹并运行也在备份中创建的脚本。完毕！Joomlapack 对数据库和站点文件进行完整备份，因此您可以根据需要将站点移动到任何地方。Joomlapack 可以在这里找到：http: [//www.joomlapack.net/](http://www.joomlapack.net/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-23T20:56:04.427

确保按照[这些说明](http://kb.siteground.com/article/How_to_move_Joomla_to_another_directory.html)编辑您的 configuration.php 文件。

# database - 在日志中快速搜索

> ID：755063
> 
> 赞同：4
> 
> 时间：2009-04-16T07:17:13.853
> 
> 标签：database, logging, xml-database

[我和另一个帖子](https://stackoverflow.com/questions/163783/fast-text-search-over-logs)中描述的人有同样的问题。我的应用程序的日志文件很大（~1GB），使用 grep 来关联来自日志文件的信息很繁琐。现在我使用''less''工具，但它也比我想要的慢。

我正在考虑加快搜索速度。有以下方法可以做到这一点：首先，在 XML 中生成日志并使用一些 XML 搜索工具。我不确定使用 XML 搜索会获得多少加速（我猜不多，因为非索引文件搜索仍然需要很长时间）。

其次，使用[XML 数据库](http://en.wikipedia.org/wiki/XML_database)。这会更好，但我在这里没有太多背景。

第三，使用（非 XML）数据库。这会有点乏味，因为必须编写表模式（是否也要为上面的第二个选项完成？）。我还预见到架构一开始会发生很大变化，以包括常见的用例。理想情况下，我想要比用于存储日志的成熟数据库更轻的东西。

第四，使用lucene。它似乎符合目的，但有没有一种简单的方法来指定当前用例的索引？例如，我想说“每当你看到‘迭代’这个词时就索引”。

你有什么意见？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-16T07:21:00.553

问题是使用 XML 会使您的日志文件更大我建议您按日期或行拆分日志文件，否则使用基于文件的数据库引擎，例如[sqlite](http://sqlite.org/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T07:33:10.977

千兆字节并没有*那么*大，真的。你想用这些日志文件做什么样的“相关性”？我经常发现编写自定义程序（或脚本）以特定方式处理日志文件比尝试提出数据库模式来处理您想要使用它做的所有事情更简单。当然，如果您的日志文件由于某种原因难以解析，那么尝试修复该方面可能是值得的。

（顺便说一句，我同意 kuoson 的观点——XML 几乎肯定*不是*要走的路。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T07:29:27.583

如果您可以在 Windows 上检查您的日志，或者使用 Wine，**[LogParser](http://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&displaylang=en)**是一个从日志中挖掘数据的好工具，它实际上允许您**在任何日志上运行 SQL 查询，而无需更改任何代码或日志格式**，而且它甚至可以用来生成快速的 HTML 或 Excel 报告。

同样在几年前，当 XML 大肆宣传时，我正在使用 XML 日志和 XSLT 样式表来生成视图，它实际上还不错，但它占用了大量内存并且会阻塞大文件，所以你可能不会'不想使用 XML。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-11-22T01:41:01.670

处理日志文件的麻烦在于必须单独查询每个文件，如果您可以创建日志文件的索引并搜索/查询，您将获得更清晰的响应。Lucene 将是我的下一个停靠港，然后是 solr。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T08:04:45.627

也许您可以将日志加载到 Emacs 中（前提是您有足够的内存）并使用 Emacs 的各种功能，例如增量搜索和 Alt-X。

免责声明：我没有在大于 100MB 的文件上尝试过这个。

# apache - Apache重写规则

> ID：755065
> 
> 赞同：3
> 
> 时间：2009-04-16T07:17:54.913
> 
> 标签：apache, url-rewriting

我想重定向“ [http://localhost/b.html](http://localhost/b.html) ”->“ [http://localhost/a.html](http://localhost/a.html) ”我为此尝试了 RewriteRule。但不知何故，它对我不起作用。

我正在使用 apache2，我的 httpd.conf 包含：

```
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule proxy_connect_module modules/mod_proxy_connect.so
LoadModule rewrite_module modules/mod_rewrite.so

RewriteEngine On
RewriteRule ^/b.html$ http://localhost/a.html 
```

当我尝试“ [http://localhost/a.html](http://localhost/a.html) ”时，它会显示网页。但是当我尝试“ [http://localhost/b.html](http://localhost/b.html) ”时，apache2/error_log 说“文件不存在：b.html”是否缺少任何设置来启用 rewrite_module？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T07:33:00.773

问题出在您的 RewriteRule 中。这应该工作：

```
RewriteEngine On
RewriteRule ^/b.html$ /a.html [L] 
```

1.  ~~规则匹配 ( `^b.html$`) 不得包含起始斜杠。~~（这适用于 .htaccess，但不适用于服务器配置）
2.  如果可能，重写目标应该是一个相对 URI（即在同一主机上）
3.  规则应该以指令“做什么”结束——在这种情况下，需要`[L]`处理（不再处理规则）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T07:43:52.477

您是否检查过您的 Apache 配置文件（很可能是 httpd.conf）中是否有 Alias 或 VirtualHost 部分的指令：

```
AllowOverride All 
```

我有同样的 modrewrite 不工作的问题，因为我把它关掉了：

```
AllowOverride None 
```

祝你好运。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T07:38:51.600

你在虚拟主机部分有它吗？

```
<VirtualHost *:80>
    RewriteEngine On
    RewriteRule ^/b.html$ /a.html
</VirtualHost> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T09:58:37.007

现在可以了。不得不做两件事：

1.  将 /etc/apache2/sites-available/default 中的“AllowOverride None”更改为“AllowOverride All”。

2.  将重写规则放在 /var/www/.htaccess 而不是 httpd.conf

我不确定为什么它在 httpd.conf 中不起作用。但是在做了以上两件事之后它就起作用了。

# sql-server - 当基础 SQL Server 表的列更改时更新访问链接表

> ID：755069
> 
> 赞同：0
> 
> 时间：2009-04-16T07:19:57.903
> 
> 标签：sql-server, ms-access, vba

在工作中，我们有一个 SQL Server 数据库，几个用户使用 Access 2003 连接到（只读）。

这很好，但现在他们查看的其中一个表被重新创建相当频繁，并且此过程的一部分涉及交叉表查询。

这意味着，根据数据，每次重新生成表时，列的数量和名称可能会发生变化。

但是，当他们从 Access 中查看重新创建的表时，它仍然显示该表第一次链接到时存在的列标题。

有没有一种方法可以在每次打开 Access 数据库时以编程方式重新链接表？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T07:56:25.477

我最终做的是创建一个如下所示的 VBA 函数（需要错误处理！）

```
Public Function ReConnectToLinkTable()

Dim db As Dao.Database
Dim tdf As Dao.TableDef

Set db = CurrentDb
Set tdf = db.CreateTableDef("local_table_name")

tdf.Connect = "ODBC;DRIVER=SQL Server;SERVER=server_name;UID=user_name;" & _ 
              "PWD=password;APP=Microsoft Data Access Conponents;" & _
              "DATABASE=database_name"
tdf.Attributes = TableDefAttributeEnum.dbAttachSavePWD
tdf.SourceTableName = "server_table_name"    

db.TableDefs.Delete ("local_table_name")
db.TableDefs.Append tdf

End Function 
```

然后我创建了一个名为 AutoExec 的宏（该名称保证在打开 Access 文件时调用它），它有一个 RunCode 的 Action，它调用 ReconnectToLinkTable() 函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T22:25:16.197

当服务器上的表或视图被更改时，ODBC 链接表会中断。有些更改可能会导致它们变成只读的，而其他更改将根本不包括所有列。

我发现更新连接字符串并不能成功解决这个问题。它通常会修复缺失的字段，但它仍然可以是只读的。唯一可靠的方法是即时重新创建链接表。

另一种选择是根本不使用链接表，而是使用具有适当连接字符串的已保存 QueryDef。这永远不需要更新，但可能是性能问题，因为存储在表链接中的元数据有助于 Access 确定如何检索数据。如果没有将元数据存储在表链接中，则每次运行查询时都必须从服务器检索该信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T07:43:21.403

通常使用类似[这个片段的东西。](http://www.mvps.org/access/tables/tbl0010.htm)在 google 上搜索“ms 访问刷新链接表”，您会发现各种解决方案都与此类似。

# mod-wsgi - CPython 中子解释器 API 的用途是什么？

> ID：755070
> 
> 赞同：18
> 
> 时间：2009-04-16T07:20:45.153
> 
> 标签：mod-wsgi, python

我不清楚为什么子解释器 API 存在以及为什么它在模块（如 mod_wsgi apache 模块）中使用。它主要用于为在同一进程中运行的不同应用程序创建一个安全沙箱，还是一种允许多线程并发的方法？也许两者兼而有之？还有其他目的吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-16T07:45:18.543

我想目的是创建单独的 python 执行环境。例如，[mod_wsgi](https://code.google.com/p/modwsgi/)（Apache Python 模块）托管一个 Python 解释器，然后在子解释器中托管多个应用程序（在默认配置中）。

[文档](http://docs.python.org/c-api/init.html#Py_NewInterpreter)中的一些关键点：

*   这是一个（几乎）完全独立的 Python 代码执行环境。特别是，新的解释器具有所有导入模块的独立版本，包括基本模块`__builtin__`和.`__main__``sys`
*   加载模块表 (sys.modules) 和模块搜索路径 (sys.path) 也是分开的。
*   因为子解释器（和主解释器）是同一进程的一部分，所以它们之间的隔离并不完美——例如，使用像 os.close() 这样的低级文件操作，它们可以（意外或恶意）影响每个其他人打开的文件。
*   由于（子）解释器之间共享扩展的方式，某些扩展可能无法正常工作；当扩展使用（静态）全局变量时，或者当扩展在其初始化后操作其模块的字典时，这种情况尤其可能发生。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-09-30T22:08:59.297

As I understood it last, the idea was to be able to execute multiple applications as well as *multiple copies of the same application* within the same process.

This is a feature found in other scripting languages (e.g. TCL), and is of particular use to gui builders, web servers, etc.

It breaks in python because many extensions are not multiple-interpreter safe, so one interpreter's actions could affect the variables in another interpreter.

# backup - Joomla 1.5 站点备份策略

> ID：755072
> 
> 赞同：3
> 
> 时间：2009-04-16T07:21:13.780
> 
> 标签：backup, joomla

我想不时对我的整个基于 joomla 1.5 的站点进行完整备份。理想情况下如何做到这一点？有没有常见的陷阱？并不是说我只能通过 ftp 访问托管服务器。某处有分步教程吗？我正在使用最新的 Joomgallery 和 Kunena 1.0.9（传统模式）。

也许有一种自动化的好方法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T07:30:14.867

您必须担心备份的两个部分，即数据库和文件。

1.  第一部分是数据库。可以使用 phpMyAdmin 之类的工具对其进行备份。如果您的服务器上还没有这个可用的，那么上传并自己动手并不难。从那里，您可以将整个数据库导出到 gzip 文件。

2.  第二部分是代码和上传的文件。代码库不应该经常更改，因此您可能只需对此进行备份。有很多方法。最简单的方法是通过 FTP 下载整个文件夹，但如果你是 Linux，我相信有人会知道一个命令行来获取所有更改的文件（rsync？）。

数据库是您必须担心的主要事情：其他所有内容都应该能够通过重新安装来重建。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T08:17:37.747

我认为：[http](http://www.joomlapack.net/) ://www.joomlapack.net/是您所需要的。我自己使用它，它就像一个魅力。用于备份和将我的 Joomla 安装从开发人员站点和实际站点移动。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T07:32:06.517

获取 FTP 同步工具并在本地保存您网站的最新副本。然后你可以运行批处理脚本

```
mysqldump -hhost -uuser -p%1 schema > C:\backup.sql 
```

在不同时间点创建 mysql 表的备份。

**编辑** 您必须在本地计算机上安装 MySQL 服务器，并在 PATH 中安装其 bin 目录的路径，以便轻松运行 mysqldump 命令。-p%1 将采用命令行提供的密码，因为您不想将密码存储在批处理脚本中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T08:35:11.877

I absolutely endorse using Joomlapack - it works great. The optional remote tools allow you to initiate the backup from a Windows desktop machine - it performs the backup and downloads it. The remote has a scheduler, and you can also set it off to backup and download a list of sites.

Joomlapack also provides a file "kickstart.php" which you copy to your empty server account along with the backup, which automates the restore procedure. You do have to create an empty database with PHPMyAdmin or similar, and you are given the opportunity to supply the database parameters (host, database, username, password) during the process.

One pitfall I did run into with this though is that some common components can have absolute URLs in their configuration - e.g. SOBI2, Virtuemart. It's then just a matter of finding the appropriate configuration file, editing it and re-uploading it.

Another problem was one archive file (either ZIP or their JPA format) got a filename with a "?" character in it (from a Linux server) and this caused a bit of a problem trying to install it locally on a Windows WAMP stack - the extract process on the ZIP file failed, and it stopped the process completing cleanly.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T07:30:39.063

如果您只有 FTP 访问权限，您会遇到一些问题，因为除了所有文件之外，您还必须备份数据库。如果不访问数据库，完整备份对您没有任何好处。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T14:10:31.323

无论您选择何种备份策略 - 确保它可以正确处理 UTF-8。Joomla 1.5 使用 UTF-8 存储所有内容，即使数据库字符集设置为“iso-5589-1” - 所以当备份解决方案检测数据库字符集时，一些字符，如 € 或 é 将导致“奇怪”¬ / Ã© - 不是你想要的。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2014-07-13T22:24:10.513

我建议使用[http://www.everlive.net的自动备份服务](http://www.everlive.net)

更新：好的，这里有更多信息。EverLive.net 是一个您可以创建免费帐户的网站。输入您的网站详细信息，一键即可进行备份。同样的方法也可以恢复。

此外，您可以使用自动备份选项以定义的时间间隔进行自动备份。除此之外，如果您的网站不可用，您可以使用网站健康检查服务来通知您。

# sql-server - Subsonic - 如何使用 SQL 模式/所有者名称作为命名空间的一部分？

> ID：755073
> 
> 赞同：6
> 
> 时间：2009-04-16T07:21:54.887
> 
> 标签：sql-server, subsonic, schema, owner

我刚刚开始使用 Subsonic 2.2，到目前为止印象非常深刻 - 认为它会为我节省一些重要的编码时间。

在我开始全职使用它之前，虽然有些事情困扰着我，但我想解决这个问题。

在我当前的数据库（一个 SQL2008 数据库）中，我已按模式/所有者名称将表、视图、sps 等拆分为单独的块，因此所有客户表都在客户中。架构，产品中的产品。架构等，因此要从客户地址表中进行选择，我会从 customer.address 中选择 *

不幸的是，Subsonic 忽略了模式/所有者名称，只给了我基表名称。这很好，因为我在模式之间没有重复（例如 Customer.Address 和 Supplier.Address 都不存在），但我只是觉得如果我可以按模式拆分代码会更清晰。

理想情况下，我希望能够通过模式/所有者更改命名空间 - 我认为这对 SubSonic 的影响最小，但会使生成的代码更易于阅读。

问题是，我已经爬遍了 Subsonic 的源代码并且不知道如何做到这一点（我在 VB 而不是 C# 中编码并没有帮助 = 是的，我知道，责怪 ZX Spectrum ！！）

如果有人以前解决过这个问题或对如何解决它有想法，我将非常感激，

提前致谢。

埃德

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T08:39:31.253

我也打算建议多提供者方法。但是很多管道已经处于亚音速的所有权状态。如果您在 CS_ClassTemplate.aspx 中编辑几行，您可以为每个所有者配置文件创建一个命名空间。将第 58 行（我使用的是 v2.1）更改为

```
namespace <%=provider.GeneratedNamespace%><%=owner%> 
```

所有者在哪里

```
string owner = "." + tbl.SchemaName;
if(owner == ".dbo")
  owner = ""; 
```

你把它放在上面，大约第 14 行。这样你可以为每个所有者都有一个命名空间，例如：Northwind.Suppliers、Northwind.Customers 等。我将 dbo 保留为 Northwind，因此所有测试都无需进行大量编辑即可编译。我运行了一个简单的选择查询，我认为它会按照您想要的方式工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T18:10:22.937

您也可以使用我们的 t4 模板在 3.0 中执行此操作（但仅适用于 3.5）。这是一个非常好的反馈——也许我们应该默认构建它！

很高兴你在这里得到一些帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T10:47:22.890

Just to let you know I have this now working - or at least, compiling! :-) To get the owner solution to work fully though you'll need to make more changes to the Class Template as otherwise the table/key functions sit within the wrong namespace.

I've also hacked around with the stored procedure template. I couldn't (in the short time I have) work out how to split into separate files/namespaces for each owner so instead i've prefixed each sp function with the owner and an underscore.

However, just in case you have the same problem you'll know its possible to fix.

Ed

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T07:53:16.077

您可以尝试使用具有相同底层数据库连接的单独提供程序，如下所示：

```
<SubSonicService defaultProvider="DBData">
<providers>
<clear/>
     <add name="DBData" type="Subsonic.SqlDataProvider, SubSonic" connectionStringName="LocalSqlServer" generatedNamespace="DBData" includeTableList="table_a,table_b" spStartsWith="app,get,set" viewStartsWith="v_" />
     <!--CMS Provider-->
     <add name="CMS" type="SubSonic.SqlDataProvider, SubSonic" connectionStringName="LocalSqlServer" generatedNamespace="CMS" stripTableText="CMS_" includeTableList="CMS_Content,CMS_Page" useSPs="false"/>
</providers>
</SubSonicService> 
```

我认为您不能以这种方式将架构本身用作键，但您至少可以通过组合 includeTableList 和 generatedNamespace 来解决这个问题。你说你在不同的模式中没有重复的表名，所以它可能会起作用。

# c# - c# 从 sql 2005 返回一个字符串

> ID：755083
> 
> 赞同：1
> 
> 时间：2009-04-16T07:29:30.767
> 
> 标签：c#, string

行，

我在这样的 sql 表中有一个字符串

```
hello /r/n this is a test /r/n new line. 
```

当我使用 c# 为使用多行的文本框检索此字符串时，我希望转义字符是换行符。

但他们不是，发生的事情是我得到了与上面完全相同的线。

似乎从表返回的字符串被视为文字，但我想要换行符！

我怎样才能让它工作？

提前致谢..

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T07:31:16.487

/ 不是转义字符，\ 是。你需要的是：

你好 \r\n 这是一个测试 \r\n 新行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T07:35:41.093

诸如“\n”（不是“/n”）之类的东西是*编程语言*中的转义字符，而不是文本中固有的。（特别是，它们依赖于编程语言。）

如果你想做

```
hello\r\nthis is a test\r\nnew line 
```

格式为

```
hello
this is a test
new line 
```

您需要自己进行解析，用回车替换“\r”，用换行符替换“\n”等，将“\”作为文字反斜杠等处理。我通常发现一个简单的解析器只记得是否或者前一个字符不是反斜杠对于大多数用途来说已经足够了。像这样的东西：

```
static string Unescape(string text)
{
    StringBuilder builder = new StringBuilder(text.Length);
    bool escaping = false;
    foreach (char c in text)
    {
        if (escaping)
        {
           // We're not handling \uxxxx etc
           escaping = false;
           switch(c)
           {
               case 'r': builder.Append('\r'); break;
               case 'n': builder.Append('\n'); break;
               case 't': builder.Append('\t'); break;
               case '\\': builder.Append('\\'); break;
               default:
                   throw new ArgumentException("Unhandled escape: " + c);
           }
        }
        else
        {
           if (c == '\\')
           {
               escaping = true;
           }
           else
           {
               builder.Append(c);
           }
        }
    }
    if (escaping)
    {
        throw new ArgumentException("Unterminated escape sequence");
    }
    return builder.ToString();
} 
```

有更有效的方法（基本上从反斜杠跳过到反斜杠并附加非转义文本的整个子字符串），但这很简单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T07:43:06.083

前几天我的 SQLite 数据库也遇到了类似的问题。用户可以在文本框中输入多行文本，当它被插入数据库时​​，它会像这样进入：

```
"This is \r\n a multiline test" 
```

它是这样出来的`System.Data.SQLite`：

```
"This is \\r\\n a multiline test" 
```

我最终使用：

```
String.Replace("\\r","\r").Replace("\\n","\n") 
```

替换每个转义字符，这些字符在多行文本框或标签中显示时会正确格式化文本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T07:44:12.930

看起来您需要在将字符串放入 TextBox 之前对字符串使用 System.Web.HttpUtility.HtmlDecode。

```
 textBox.Value = HttpUtility.HtmlDecode(myString); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T07:45:16.407

我不明白为什么在这种情况下需要解析器，因为所讨论的语言是 C#，并且我假设操作系统是 32 位 Windows，它被视为`\r\n`NewLine 字符。

以下简单代码（Windows 应用程序）适用于我：

```
string s = "hello \r\n this is a test \r\n new line.";

// Set Multiline to True.
textBox1.Multiline = true;

// Expand the height of the textbox to be able to view the full text.
textBox1.Height = 100;
textBox1.Text = s; 
```

文本框将文本显示为：

```
hello
 this is a test 
 new line. 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T08:38:45.687

我认为这里的问题是用户看到的字符串是

你好 \r\n 这是一个测试 \r\n 新行。

而 C# 代码将其视为

```
"hello \\r\\n this is a test \\r\\n new line." 
```

一个更简单的解决方案如下

```
s = Regex.Replace(s, @"\\\\", @"\"); 
```

将@"\\" 替换为@"\"。不要被正则表达式匹配模式所迷惑，\ 必须在匹配中被转义，而不是替换。

# hibernate - 如何制作/开发 Hibernate 缓存？

> ID：755084
> 
> 赞同：1
> 
> 时间：2009-04-16T07:29:45.977
> 
> 标签：hibernate

如何制作/开发 Hibernate 缓存？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T07:42:20.890

您可以使用[ehcache](http://ehcache.sourceforge.net/)。详情[在这里](http://ehcache.sourceforge.net/documentation/hibernate.html)。[这篇不是那么最新的文章](http://www.devx.com/dbzone/Article/29685)中的一些替代方案。

# c# - 使用 LINQ 过滤必要的数据

> ID：755129
> 
> 赞同：1
> 
> 时间：2009-04-16T07:46:34.687
> 
> 标签：c#, linq

一直在玩 linq，但有一件事我似乎无法做到.. 情况就是这样.. 假设你有..

```
public class Job
{
    public DateTime? CreatedDate { get; set; }
}

public class Company
{
    public string Name { get; set; }
    public List<Job> Contract { get; set; }
} 
```

现在我想要做的是填充公司列表，然后只获取在...中创建合同的公司。让我们说一月..像这样..

```
String[] MonthName = { "January", "February", "March", "April", "May", "June", "July", "Agust", "September", "October", "November", "December" };

List<Company> Companies = PopulateData();
List<Company> ValidCompany = Companies.Where(CompanyFilter => CompanyFilter.Contract.Any(ContractFilter => MonthName[ContractFilter.CreatedDate.Value.Month - 1] == "January")).ToList(); 
```

这工作正常，但它返回所有合同，甚至一些不在“一月”中的合同。我错过了一步吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T07:57:22.523

您的查询中没有任何内容可以过滤合同 ( `Company.Contract`) - 只有公司本身。您需要单独执行此操作，也许通过 a `Where`on `.Contract`。

如果您是从 LINQ-to-SQL 加载数据，那么[`AssociateWith`](http://msdn.microsoft.com/en-us/library/bb548919.aspx)可能会有用。

如果您想要范围内的所有合同而不考虑公司，那么也许`SelectMany`：

```
var qry = from company in Companies
          from contract in company.Companies
          where contract.CreatedDate.Value.Month == ... etc
          select new {Company = company, Contract = contract}; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T07:53:17.540

原帖：

```
List<Company> ValidCompany = (
   from c in Companies
   let janContracts = c.Contracts
      .Where(con => MonthName[con.CreatedDate.Value.Month - 1] == "January")
   where janContracts.Any()
   select new Company
   {
       Name = c.Name,
       Contracts = janContracts.ToList()
   }).ToList(); 
```

* * *

**更新：**使用扩展方法

```
var janCompanies = Companies.Select(c=>
    new Company
    {
       Name = c.Name,
       Contracts = c.Contracts
           .Where(con => MonthName[con.CreatedDate.Value.Month - 1] == "January")
           .ToList()
    });
List<Company> ValidCompany = janCompanies
    .Where(c=>c.Contracts.Any())
    .ToList(); 
```

# linq - 如何在 Linq 中订购组结果？

> ID：755132
> 
> 赞同：40
> 
> 时间：2009-04-16T07:48:23.997
> 
> 标签：linq, sql-order-by, group-by

我有以下 linq 查询，它工作正常。我不确定我如何订购该组的结果。

```
from a in Audits
join u in Users on a.UserId equals u.UserId
group a by a.UserId into g
select new { UserId = g.Key, Score = g.Sum(x => x.Score) } 
```

结果当前按 UserId 升序排列。我在分数下降之后。

谢谢 ：）

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-04-16T08:02:18.067

只需添加 orderby 子句；-)

```
from a in Audits
join u in Users on a.UserId equals u.UserId
group a by a.UserId into g
let score = g.Sum(x => x.Score)
orderby score descending
select new { UserId = g.Key, Score = score }; 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-16T08:02:31.403

```
var results =
 (from a in Audits
join u in Users on a.UserId equals u.UserId
group a by a.UserId into g
select new { UserId = g.Key, Score = g.Sum(x => x.Score) })
.OrderByDescending(p=>p.Score); 
```

希望这能解决你的问题，比上面的更容易；）

干杯

# linux - 当程序写入/读取文件时，如何透明地压缩/解压缩文件？

> ID：755144
> 
> 赞同：7
> 
> 时间：2009-04-16T07:56:57.517
> 
> 标签：linux, compression, named-pipes, on-the-fly

我有一个程序可以读取和写入非常大的文本文件。然而，由于这些文件的格式（它们是应该是二进制数据的 ASCII 表示），这些文件实际上很容易压缩。例如，其中一些文件的大小超过 10GB，但 gzip 可实现 95% 的压缩。

我无法修改程序，但磁盘空间很宝贵，因此我需要设置一种方式，以便在透明压缩和解压缩这些文件的同时读取和写入这些文件。

该程序只能读写文件，据我了解，我需要为输入和输出设置一个命名管道。有些人建议使用压缩文件系统，这似乎也可以工作。我如何使任何一个工作？

技术信息：我使用的是现代 Linux。该程序读取一个单独的输入和输出文件。它按顺序读取输入文件，尽管两次。它按顺序写入输出文件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T08:02:26.850

查看 zlibc：http: [//zlibc.linux.lu/](http://zlibc.linux.lu/)。

此外，如果 FUSE 是一个选项（即内核不是太旧），请考虑：compFUSEd [http://www.biggerbytes.be/](http://www.biggerbytes.be/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T08:00:41.860

命名管道不会为您提供全双工操作，因此如果您只需要提供一个文件名，它会有点复杂。

您知道您的应用程序是否需要查找文件吗？

您的应用程序可以使用标准输入、标准输出吗？

也许一个解决方案是创建一个迷你压缩文件系统，其中只包含一个包含文件的目录

由于您有单独的输入和输出文件，您可以执行以下操作：

```
mkfifo readfifo
mkfifo writefifo
zcat your inputfile > readfifo &
gzip writefifo > youroutputfile &

launch your program ! 
```

现在，您可能会遇到按输入顺序读取两次的问题，因为一旦 zcat 完成读取输入文件，您的程序就会收到一个 SIGPIPE 信号

正确的解决方案可能是使用像 CompFUSE 这样的压缩文件系统，因为这样您就不必担心像 seek 这样不受支持的操作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-03-20T19:40:43.143

btrfs：

[https://btrfs.wiki.kernel.org/index.php/Main_Page](https://btrfs.wiki.kernel.org/index.php/Main_Page)

这些天来提供对非常快速的“自动透明压缩/解压缩”的支持，并且在较新的内核中存在（尽管标记为实验性）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T10:18:48.340

FUSE 选项： [http ://apps.sourceforge.net/mediawiki/fuse/index.php?title=CompressedFileSystems](http://apps.sourceforge.net/mediawiki/fuse/index.php?title=CompressedFileSystems)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-16T08:11:21.930

您使用哪种语言？

如果您使用的是 Java，请查看 API 文档中的 GZipInputStream 和 GZipOutputStream 类。

如果您使用 C/C++，zlibc 可能是最好的方法。

# sql - 查找具有包含 xml 字符串值的字段的所有表

> ID：755146
> 
> 赞同：2
> 
> 时间：2009-04-16T07:57:15.723
> 
> 标签：sql, xml, sql-server-2005

我有一个 SQL 2005 数据库，我知道在数据库中有一个表，其中包含一些 xml 字符串。我怎样才能找到这张桌子？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T08:20:28.287

如果字段实际上是 XML 类型，那么此查询将为您提供您正在寻找的内容：

```
select * from information_schema.columns
where DATA_TYPE = 'XML' 
```

马克

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T08:20:39.660

运行这个：

```
select 'select distinct ''' || a.name || '.' || b.name 
|| '''  from ' || b.name 
|| 'where ' || b.name || ' like ''%<%/>%'' union ' 
from systable a 
join syscolumns b on (a.id = b.id)
join systypes c on (b.type = c.xtype) 
where a.type ='U' and c.name = ('CHAR', 'CHARN', 'VARCHAR', 'VARCHARN'); 
```

第一个结果集将在数据库中每个字符列有一行：

从表中选择不同的“table.column”，其中列如“%<%/>%”并集

取出那个结果集，剪掉最后一个并集，然后将结果集作为 SQL 语句运行。它将带回任何列的表名和列名，这些列有一个或多个看起来像 XML 的行。

编辑：这是记忆中的；连接到 systypes 和类型名称可能是错误的，所以从 systypes 中选择并检查。

# c# - 如何在 NHibernate 中映射自引用

> ID：755148
> 
> 赞同：3
> 
> 时间：2009-04-16T07:57:30.027
> 
> 标签：c#, nhibernate-mapping

我有一个非常特殊的 NHibernate 映射案例。该类具有对自身的引用。

```
public class MyClass
{
   public Guid Id { get; set; }
   public MyClass SelfReference { get; set; }
} 
```

数据库表在同一张表的主键上有一个外键字段。更糟糕的是，这个自我引用可能是空的。

这可以映射吗？如何做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T08:17:29.900

好像你愿意映射一棵树：

[http://nhibernate.hibernatingrhinos.com/16/how-to-map-a-tree-in-nhibernate](http://nhibernate.hibernatingrhinos.com/16/how-to-map-a-tree-in-nhibernate)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T11:04:41.880

一对一可用于同步主键并且很少使用，根据我的经验，多对一是“正常”引用的最“自然”关联：

```
<many-to-one name="SelfReference" class="MyClass" column="SelfReference_FK" /> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T08:04:23.677

好像你只是把它当作任何其他一对一的关系一样对待？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T08:13:25.573

我认为这是一个简单的一对一。

我希望这会帮助你

```
<one-to-one
name="PropertyName"
class="ClassName"
cascade="all|none|save-update|delete"
constrained="true|false"
fetch="join|select"
property-ref="PropertyNameFromAssociatedClass"
access="field|property|nosetter|ClassName"/> 
```

# c# - 如何杀死自己的Windows服务

> ID：755149
> 
> 赞同：2
> 
> 时间：2009-04-16T07:58:14.800
> 
> 标签：c#, .net, sql-server, wcf, windows-services

WCF 服务托管在 Windows 服务 (WS) 中。

当数据库 (SqlServer 2005) 出现故障时，由于对数据库执行的操作而引发 SqlException。

我想要完成的是，当数据库也关闭时，托管 WCF 服务的 WS 也应该关闭。

顺便手动重启一下WS。

我的想法是什么都不做。未处理的异常将停止 WS。

这是正确的做法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T08:18:54.360

如果要显式停止 Windows 服务，只需在服务类上调用 .Stop() 方法。

Windows 服务可以配置为在出错时自动重新启动 - 因此仅让 SqlException 流到顶部可能无法实现您想要的。

马克

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T08:06:56.760

首先，您需要检测 SQL 服务器从您将获得的 SQLException 中关闭。其次，为什么要杀死网络服务而不是向客户端返回一个错误，说服务由于某某原因而暂时关闭。

# iis - 无法在具有实时 IIS6 的多个浏览器中显示页面错误

> ID：755161
> 
> 赞同：0
> 
> 时间：2009-04-16T08:03:59.357
> 
> 标签：iis, iis-6

我开发了一个 ASP.NET 页面 (.NET 2.0)，它在开发环境中发挥着一种魅力。它使用 AJAX.ASP.NET 并且仅使用随附的控件（没有第三方控件）。

我将它发布到实时 IIS6 Web 服务器，创建网站，设置 .NET 版本，应用程序池和站点可以运行脚本。我还取消选中匿名访问并检查 Windows 身份验证。

某些东西要么丢失，要么设置错误，因为我的用户在不同位置的不同浏览器中收到“无法显示页面”错误。不同的地方我的意思是当他们试图在网格上翻页时，他们得到了这个错误；当他们点击按钮提交搜索时；当他们提交其他东西时......

但看不到模式，有时会发生，有时不会。有时具有一种功能，有时具有另一种功能。有时与一个用户有时与另一个用户。

用户使用的是 IE6、IE7、Firefox、Mozilla 和 Chrome，所以我认为这与客户端无关。我试图创建另一个网站并将其放在那里，但我得到了相同的症状。

我没有可能在另一个 IIS 上尝试它，所以基本上我被卡住了。

**更多细节：**我确定它以某种方式连接到 IIS，因为网络没有问题，而且现在不止一个网站上发生这种情况。

windows 身份验证有问题，因为 IIS 日志显示如下行：

```
2009-04-29 12:33:17 GET /fakk/OsszLapok.aspx id=1 - 192.168.120.3 401 2 2148074254
2009-04-29 12:33:19 GET /fakk/OsszLapok.aspx id=1 mydomain\username 192.168.120.3 200 0 0 
```

因此，第一个呼叫是在没有 Windows 用户的情况下进行的，并显示 401，而第二个（仅在 2 秒后）带有用户信息并且可以正常工作。

即使在同一秒内，我的日志中也有很多：

```
2009-04-29 12:29:21 GET /fakk/Images/rovat_title_eft.png - 192.168.120.3 401 2 2148074254
2009-04-29 12:29:21 GET /fakk/Images/footer_up.png - 192.168.120.3 401 2 2148074254
2009-04-29 12:29:21 GET /fakk/Images/rovat_title_eft.png - mydomain\username 192.168.120.3 200 0 0
2009-04-29 12:29:21 GET /fakk/Images/footer_up.png - mydomain\username 192.168.120.3 200 0 0 
```

该网页设置为使用 Windows 身份验证，拒绝匿名访问。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T06:38:44.780

可能想看看[这里](http://www.derkeiler.com/Newsgroups/microsoft.public.inetserver.iis.security/2007-05/msg00053.html)和[这里](http://www.justskins.com/forums/iis-web-service-401-error-with-integrated-windows-authentication-79727.html)和[这里](http://www.eggheadcafe.com/conversation.aspx?messageid=31768956&threadid=31768952)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T05:47:38.600

您是否检查过 IIS 是否正在回收 ASP.NET 工作进程？还请查看 EventLogs 以获取任何其他错误信息并将其发布。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-01T07:47:42.593

看看这个

[http://support.microsoft.com/kb/907273](http://support.microsoft.com/kb/907273)

# c++ - COM API - 无法为指针参数传递“NULL”

> ID：755164
> 
> 赞同：0
> 
> 时间：2009-04-16T08:04:34.597
> 
> 标签：c++, winapi, com, midl

我有一个 COM API foo，IDL 看起来像：

```
foo([in] unsigned long ulSize, [in, size_is(ulSize)] unsigned char* pData) 
```

当我使用这个函数时，`foo(0,NULL);` 我得到一个错误 - NULL 参数传递。有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T08:21:10.593

您是否尝试过传递一个空字符串？

```
unsigned char Data = 0;
foo(0,&Data); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T08:45:37.383

您可能应该将 char* 标记为字符串以获得一些编组帮助。

```
foo([in] unsigned long ulSize, [in,string,size_is(ulSize)] unsigned char* pData) 
```

我们没有在 IDL 中使用 size_is 选项，也许它是在强制解决非 NULL 地址的问题？

```
foo([in] unsigned long ulSize, [in,string] unsigned char* pData) 
```

我当然会推荐使用 BSTR 或 SAFEARRAY 而不是 char。那么问题将是如何最好地处理这种空情况，可能将其视为空字符串，或者有一个单独的方法。

在 COM 中传递指针是非常糟糕的形式，就像使用共享内存传递指针一样，（可能/可能）远程进程将无法访问内存。因此，COM 试图通过为您军事化实际数据来提供帮助，但如果您将其隐藏在不同的数据类型后面，它就不会正确地军事化数据。例如，使用 wchar_t* 它将创建一个在进程之间可用的系统分配字符串。或者你可以做同样的事情并有一个接口接受一个 bstring 并将 sysallocstring() 的结果传递给它

或许你可以告诉我们更多关于你想要使用的结构，用这种类型的对象扩展com接口可能更合适。或者可能有一些其他的技巧来传输数据，您可以编写自定义的军事方法来序列化和反序列化内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T12:45:55.443

不要在 COM API 中使用 char* —— 改用 BSTR。然后传递一个空字符串。

```
foo([in] unsigned long ulSize, [in] BSTR pData)

...

foo(1, _bstr_t("")); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T14:50:51.123

如果您要传递 BSTR，您应该只传递 BSTR 值 - 它们已经计算了长度（使用 SysStrLength 来查找长度）。

如果您想传入一个以空字符结尾的字符串，请使用 Greg 所说的 [string] 属性

但是您的实际问题的答案是您需要将字符串参数标记为“唯一” - 这让 MIDL 编译器（和 RPC 运行时库）知道该参数可以为 NULL。

所以使用：

```
foo([in, string] unsigned char* pData) 
```

您不需要长度字段，因为它是一个以空值结尾的字符串 - 因此您可以`strlen`在字符串上使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T15:15:16.883

`foo`可能是这样实现的：

```
HRESULT foo(unsigned long ulSize, unsigned char* pData) {
  if (!pData) {
    return E_POINTER;
  }
  ...
} 
```

在这种情况下，唯一的解决方法是传递非 NULL pData。

# c# - 从目录获取文件时排除某些文件扩展名

> ID：755166
> 
> 赞同：52
> 
> 时间：2009-04-16T08:04:50.977
> 
> 标签：c#, file, directory

从目录中获取文件时如何**排除**某些文件类型？

我试过了

```
var files = Directory.GetFiles(jobDir); 
```

但是好像这个功能只能选择你想包含的文件类型，不能排除。

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2009-04-16T08:13:15.573

你应该自己过滤这些文件，你可以这样写：

```
 var files = Directory.GetFiles(jobDir).Where(name => !name.EndsWith(".xml")); 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2014-12-05T16:36:36.317

> 我知道，这是一个古老的要求，但对我来说它总是很重要。

如果您想排除文件扩展名列表：（基于[https://stackoverflow.com/a/19961761/1970301](https://stackoverflow.com/a/19961761/1970301)）

```
var exts = new[] { ".mp3", ".jpg" };

public IEnumerable<string> FilterFiles(string path, params string[] exts) {
    return
        Directory
        .GetFiles(path)
        .Where(file => !exts.Any(x => file.EndsWith(x, StringComparison.OrdinalIgnoreCase)));
} 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-04-16T08:15:27.097

你可以尝试这样的事情：

```
 var allFiles = Directory.GetFiles(@"C:\Path\", "");
  var filesToExclude = Directory.GetFiles(@"C:\Path\", "*.txt");
  var wantedFiles = allFiles.Except(filesToExclude); 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-04-16T08:12:57.243

我想你可以使用 lambda 表达式

```
var files = Array.FindAll(Directory.GetFiles(jobDir), x => !x.EndWith(".myext")) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-06-16T05:39:11.430

你可以试试这个

```
var directoryInfo = new DirectoryInfo("C:\YourPath");
var filesInfo = directoryInfo.GetFiles().Where(x => x.Extension != ".pdb"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-11-08T22:39:09.190

这是我在上面阅读的答案的版本

```
List<FileInfo> fileInfoList = ((DirectoryInfo)new DirectoryInfo(myPath)).GetFiles(fileNameOnly + "*").Where(x => !x.Name.EndsWith(".pdf")).ToList<FileInfo>(); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T08:09:26.287

Afaik 无法指定排除模式。您必须手动完成，例如：

```
string[] files = Directory.GetFiles(myDir);
foreach(string fileName in files)
{
    DoSomething(fileName);
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-11-23T20:00:39.817

我遇到了这个寻找一种方法来执行此操作，其中排除可以使用搜索模式规则，而不仅仅是 EndWith 类型逻辑。

例如搜索模式通配符说明符匹配：

*   *（星号）该位置的零个或多个字符。
*   ? （问号）该位置的零个或一个字符。

这可以用于上述情况，如下所示。

```
string dir = @"C:\Temp";
var items = Directory.GetFiles(dir, "*.*").Except(Directory.GetFiles(dir, "*.xml")); 
```

或者排除本来应该包含的项目。

```
string dir = @"C:\Temp";
var items = Directory.GetFiles(dir, "*.txt").Except(Directory.GetFiles(dir, "*HOLD*.txt")); 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2018-04-29T13:02:45.173

我用那个

> **`Directory.GetFiles(PATH, "*.dll"))`**

路径是：

> 公共静态字符串 _PATH = Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location);

* * *

## 回答 #10

> 赞同：-5
> 
> 时间：2012-09-27T09:50:51.707

```
string[] filesToDelete = Directory.GetFiles(@"C:\Temp", "*.der");

foreach (string fileName in filesToDelete)
{
    File.Delete(fileName);
} 
```

# wpf - WPF - 使用数据模板显示单个实体

> ID：755167
> 
> 赞同：18
> 
> 时间：2009-04-16T08:06:36.853
> 
> 标签：wpf, datatemplate

我有一个在项目控制中使用的数据模板，我想知道它是否可能在没有项目控制的情况下在单个项目显示上使用它（模板）？

如果不是最好的方法是什么...？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-04-16T08:09:51.090

你可能可以做这样的事情

```
**<DataTemplate x:Key="MyTemplate" DataType="{x:Type MyType}">**
    ...
**</DataTemplate>**
...
<ContentControl ContentTemplate="{StaticResource MyTemplate}" /> <!-- Single instance use -->
<ItemsControl ItemTemplate="{StaticResource MyTemplate}" /> <!-- Multiple instance use --> 
```

# asp.net-mvc - 带有 ModelStateWrappper 的控制器 ModelState

> ID：755170
> 
> 赞同：3
> 
> 时间：2009-04-16T08:07:21.830
> 
> 标签：asp.net-mvc, dependency-injection

大家好，我使用结构图来实现依赖注入。我创建了 ModelStateWrapper 类来在服务层发送模型状态，在构造函数中获取对控制器的 ModelState 的引用。在 bootswrapper 我注册了我的类型：

```
ForRequestedType<ISourceService>()
            .TheDefaultIsConcreteType<SourceService>();
ForRequestedType<IValidationDictionary>()
        .TheDefaultIsConcreteType<ModelStateWrapper>(); 
```

我如何在这里向 ModelStateWrapper 提供控制器模型状态的参考？

ps对不起我的英语:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T13:48:34.763

您需要提供更多信息，但这是我对您所拥有的最好的猜测：

```
public class ModelStateWrapper : IValidationDictionary
{
    ...
     private readonly ModelState _modelState;
     public ModelStateWrapper(ModelState modelState)
     {
          _modelState = modelState;
     }
    ...
} 
```

如果您想将一个变量（在这种情况下为控制器的模型状态）传递给 ModelStateWrapper，您几乎肯定需要通过调用 ObjectFactory 显式执行此操作。

例子：

```
MyController : Controller 
{
   ...
   public MyAction()
   {
      ...
      IValidationDictionary validationDictionary = ObjectFactory
          .With<ModelState>(this.ModelState)
          .GetInstance<IValidationDictionary>();
      ...
   }
   ...
} 
```

有关详细信息，请参阅此文档：

[在运行时将参数传递给 StructureMap](http://structuremap.sourceforge.net/RetrievingServices.htm#section5)

# batch-file - 删除批处理文件中的临时文件

> ID：755171
> 
> 赞同：1
> 
> 时间：2009-04-16T08:07:28.163
> 
> 标签：batch-file, scripting, temp

只是构建一个批处理文件来删除我想添加到任务调度程序的 vista 机器@home 上的临时文件。到目前为止我有这个，但我得到了很多访问被拒绝，它从来没有找到一个 thumbs.db 文件或 index.dat 并且它们有很多。我究竟做错了什么？

```
 attrib +a -s -h -r "%windir%\Temp\*.*" /s
  del /f /s /q "%windir%\Temp\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "thumbs.db" /s
  del /s /f /q "thumbs.db" >>"logs\temp.txt"

 attrib +a -s -h -r *.tmp.log /s
  del /s /f /q "*.tmp.log" >>"logs\temp.txt"

 attrib +a -s -h -r “%userprofile%\Application Data\Microsoft\Office\Recent\*.*” /s
  del /f /q /s “%userprofile%\Application Data\Microsoft\Office\Recent\*.*” >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\*.gid" /s
  del /s /f / q "%systemdrive%\*.gid" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\*.fts" /s
  del /s /f /q "%systemdrive%\*.fts" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\*.cnt" /s
  del /s /f /q "%systemdrive%\*.cnt" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\*.old" /s
  del /s /f /q "%systemdrive%\*.old" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\*.diz" /s
  del /s /f /q "%systemdrive%\*.diz" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\*.bak" /s
  del /s /f /q "%systemdrive%\*.bak" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\*.tmp" /s
  del /s /f /q "%systemdrive%\*.tmp" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\*.chk" /s
  del /s /f /q "%systemdrive%\*.chk" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\*.dmp" /s
  del /s /f /q "%systemdrive%\*.dmp" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\*.00?" /s
  del /s /f /q "%systemdrive%\*.00?" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\index.dat" /s
  del /s /f /q "%systemdrive%\index.dat" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\fw*log.txt" /s
  del /s /f /q "%systemdrive%\fw*log.txt" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\zalog*.txt" /s
  del /s /f /q "%systemdrive%\zalog*.txt" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\backup*.rdb" /s
  del /s /f /q "%systemdrive%\backup*.rdb" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\*._mp" /s  
  del /f /s /q %systemdrive%\*._mp >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\*.log" /s 
  del /f /s /q "%systemdrive%\*.log" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\Temp\*.*" /s
  del /f /s /q "%systemdrive%\Temp\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\Users\Default\AppData\Local\Microsoft\Windows\History\*.*" /s
  del /f /s /q "%systemdrive%\Users\Default\AppData\Local\Microsoft\Windows\History\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\Users\Default\AppData\Local\Microsoft\Windows\Temporary Internet Files\*.*" /s
  del /f /s /q "%systemdrive%\Users\Default\AppData\Local\Microsoft\Windows\Temporary Internet Files\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\Users\Default\AppData\Local\Temp\*.*" /s
  del /f /s /q "%systemdrive%\Users\Default\AppData\Local\Temp\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Cookies\*.*" /s
  del /f /s /q "%systemdrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Cookies\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Recent\*.*" /s
  del /f /s /q "%systemdrive%\Users\Default\AppData\Roaming\Microsoft\Windows\Recent\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%systemdrive%\Windows\Downloaded Program Files\*.*" /s
  del /f /s /q "%systemdrive%\Windows\Downloaded Program Files\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%ProgramData%\Apple\Installer Cache\*.*" /s 
  del /f /s /q "%ProgramData%\Apple\Installer Cache\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%ProgramData%\Apple Computer\Installer Cache\*.*" /s
  del /f /s /q "%ProgramData%\Apple Computer\Installer Cache\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%ProgramData%\Microsoft\Search\Data\Temp\*.*" /s
  del /f /s /q "%ProgramData%\Microsoft\Search\Data\Temp\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%ProgramData%\Temp\*.*" /s
  del /f /s /q "%ProgramData%\Temp\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%appdata%\Adobe\Flash Player\AssetCache\*.*" /s
  del /f /s /q "%appdata%\Adobe\Flash Player\AssetCache\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%appdata%\Macromedia\Flash Player\#SharedObjects\*.*" /s
  del /f /s /q "%appdata%\Macromedia\Flash Player\#SharedObjects\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%appdata%\Macromedia\Flash Player\macromedia.com\support\flashplayer\sys\*.*" /s
  del /f /s /q "%appdata%\Macromedia\Flash Player\macromedia.com\support\flashplayer\sys\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%appdata%\Macromedia\Flash Player\macromedia.com\support\flashplayer\sys\*.*" /s
  del /f /s /q "%appdata%\Macromedia\Flash Player\macromedia.com\support\flashplayer\sys\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%appdata%\Microsoft\Windows\Cookies\*.*" /s
  del /f /s /q "%appdata%\Microsoft\Windows\Cookies\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%appdata%\Microsoft\Windows\Recent\*.*" /s
  del /f /s /q "%appdata%\Microsoft\Windows\Recent\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%appdata%\Mozilla\Firefox\Crash Reports\*.*" /s
  del /f /s /q "%appdata%\Mozilla\Firefox\Crash Reports\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%appdata%\Sun\Java\Deployment\cache*.*" /s
  del /f /s /q "%appdata%\Sun\Java\Deployment\cache*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%appdata%\uTorrent\*.*" /s
  del /f /s /q "%appdata%\uTorrent\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%userprofile%\AppData\Local\Temp" /s
  del /f /s /q "%userprofile%\AppData\Local\Temp" >>"logs\temp.txt"

 attrib +a -s -h -r "%userprofile%\AppData\LocalLow\Temp" /s
  del /f /s /q "%userprofile%\AppData\LocalLow\Temp" >>"logs\temp.txt"

 attrib +a -s -h -r "%userprofile%\AppData\Local\Microsoft\Windows Photo Gallery\Original Images\*.*" /s 
  del /f /s /q "%userprofile%\AppData\Local\Microsoft\Windows Photo Gallery\original Images\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%userprofile%\AppData\Local\Microsoft\Windows\Burn\*.*" /s 
  del /f /s /q "%userprofile%\AppData\Local\Microsoft\Windows\Burn\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%userprofile%\AppData\Local\Microsoft\Windows\Explorer\*.*" /s 
  del /f /s /q "%userprofile%\AppData\Local\Microsoft\Windows\Explorer\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%userprofile%\AppData\Local\Microsoft\Windows\History\*.*" /s 
  del /f /s /q "%userprofile%\AppData\Local\Microsoft\Windows\History\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%userprofile%\AppData\Local\Microsoft\Windows\Temporary Internet Files\*.*" /s 
  del /f /s /q "%userprofile%\AppData\Local\Microsoft\Windows\Temporary Internet Files\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%userprofile%\AppData\Local\Mozilla\Firefox\Profiles\*\Cache\*.*" /s
  del /f /s /q "%userprofile%\AppData\Local\Mozilla\Firefox\Profiles\*\Cache\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%userprofile%\AppData\Local\Microsoft\Windows\Explorer\*.db" /s
  del /f /s /q "%userprofile%\AppData\Local\Microsoft\Windows\Explorer\*.db" >>"logs\temp.txt"

 attrib +a -s -h -r "%appdata%\Microsoft\Windows\cookies\*.*" /s
  del /f /s /q "%appdata%\Microsoft\Windows\cookies\*.*"  >>"logs\temp.txt"

 attrib +a -s -h -r "%appdata%\Microsoft\Windows\Recent\*.*" /s
  del /f /s /q "%appdata%\Microsoft\Windows\Recent\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%windir%\prefetch\*.*" /s
  del /f /s /q "%windir%\prefetch\*.*" >>"logs\temp.txt"

 attrib +a -s -h -r "%windir%\SoftwareDistribution\Download\*.*" /s
  del /f /s /q "%windir%\SoftwareDistribution\Download\*.*" >>"logs\temp.txt" 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-07-13T19:32:05.583

设置新属性和删除的时候记得设置目标文件夹吗？

这是删除拇指文件的示例，针对网络：

```
attrib +a -s -h -r \\your-sample-network-path\thumbs.db /s
del /s /f /q \\your-sample-network-path\thumbs.db 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T10:47:34.637

I'm guessing that the reason you're getting access denied is because the user running the script doesn't have delete rights to the files in question or perhaps even access rights to the folders.

As for the thumbs.db and index.dat files, these are hidden and/or system files so won't get picked up by the plain delete command. You need to use /A:H and/or /A:S

# .net - 将 My.Settings StringCollection 绑定到多个 ComboBoxes

> ID：755173
> 
> 赞同：2
> 
> 时间：2009-04-16T08:08:05.447
> 
> 标签：.net, combobox, datasource

我有一组组合框。我想主要使用它们，就像短数据输入文本框一样，所以我将它们设置为
`AutoCompleteMode = SuggestAppend`
`AutoCompleteSource = ListItems`
`DropDownStyle = DropDown`

我想要做的是让每个 ComboBox 都有一个公共数据源（My.Settings StringCollection），从而将添加到数据源或从数据源中删除的任何字符串添加到每个组合框的数据源或从数据源中删除。

通过对 BindingSources 和 DataBindings 等的各种实验，我设法让 ComboBoxes 要么都具有相同的 DataSource，但都显示相同的文本，要么让它们都具有相同的 DataSource，但*无法*反映对ComboBoxes 之间的 DataSource 到各种新的和奇妙的抛出异常的方式。

所以，基本上，我想要的是所有 ComboBoxes 使用 StringCollection 作为它们的 DataSource，通过所有 ComboBoxes 将更改传播到 DataSource，但 SelectedItem 的选择在所有 ComboBoxes 之间是独立的。

有任何想法吗？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-01-12T21:54:37.293

```
DropDown.DataSource = My.Settings.StringCollection 
```

这将起作用：

这是我的代码中的一个示例：

```
 ddl_NoMatch_Option.DataSource = My.Settings.NoMatch_Option_List
    ddl_NoMatch_Option.SelectedText = My.Settings.NoMatch_Option 
```

我`StringCollection`在 My.Settings 中添加了一个名为`NoMatch_Option_List`，并将结果保存在`NoMatch_Option`字符串设置中。

# asp.net - 在 .NET 中使用 Web 方法的引用参数

> ID：755178
> 
> 赞同：0
> 
> 时间：2009-04-16T08:10:45.800
> 
> 标签：asp.net, web-services

我正在开发一个使用 Web 服务的 Web 应用程序。Web 服务是用 .NET 编写的。

我想知道对 Web 方法使用引用参数是否是一种好习惯？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T08:30:40.150

您可以将 ref 和 out 参数与 WCF 服务一起使用，但在幕后它们已被包裹起来。

传递给 WebMethod 或服务的任何内容都必须进行序列化 - 您可以通过将其包装在设置值的东西中来使其表现得好像它是一个 ref 或 out，但这很麻烦。

最好使用记录类 - 一个简单的可序列化类，它基本上只是一个自动属性列表，它是 WebMethod 的返回。

这会产生额外的类，但更容易维护。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T08:15:46.583

最好是基于 ws 消息。

当您使用多个参数时，您仍然可以隐式地这样做，您仍然会收到带有这些参数的消息。只需将它们分开，如果您需要多个输出，则为操作返回一个简单的结果类。

# c++ - 删除指向 const (T const*) 的指针

> ID：755196
> 
> 赞同：98
> 
> 时间：2009-04-16T08:18:30.007
> 
> 标签：c++, constants, delete-operator

我有一个关于 const 指针的基本问题。我不允许使用 const 指针调用任何非 const 成员函数。但是，我可以在 const 指针上执行此操作：

```
delete p; 
```

这将调用本质上是非常量“方法”的类的析构函数。为什么允许这样做？是否只是为了支持这一点：

```
delete this; 
```

还是有其他原因？

* * *

## 回答 #1

> 赞同：120
> 
> 时间：2009-04-16T08:21:21.280

是为了支持：

```
// dynamically create object that cannot be changed
const Foo * f = new Foo;

// use const member functions here

// delete it
delete f; 
```

但请注意，问题不仅限于动态创建的对象：

```
{
 const Foo f;
 // use it
} // destructor called here 
```

如果不能在 const 对象上调用析构函数，我们根本就不能使用 const 对象。

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-04-16T08:22:26.053

这么说吧——如果*不允许的*话，不使用 const_cast 就无法删除 const 对象。

从语义上讲， const 表示对象应该是不可变的。但是，这并不意味着不应删除该对象。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-16T08:30:32.240

构造函数和析构函数不应被视为“方法”。它们是初始化和拆除类对象的特殊结构。

'const pointer' 表示对象的状态在对象存活时对其执行操作时不会改变。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-16T13:47:30.693

另一种看待它的方式： const 指针的确切含义是，您将无法对通过该对象或任何其他指针或对同一对象的引用可见的指向对象进行更改。但是当一个对象析构时，所有其他指向先前被现在删除的对象占用的地址的*指针都不再是指向该对象的指针*。它们存储相同的地址，但该地址不再是任何对象的地址（实际上它可能很快会被重用为不同对象的地址）。

如果 C++ 中的指针表现得像弱引用，那么这种区别会更加明显，即一旦对象被销毁，所有现存的指向它的指针都会立即设置为`0`. （这种东西在运行时被认为成本太高，无法强加于所有 C++ 程序，实际上不可能使其完全可靠。）

**更新**：九年后再读一遍，这是律师式的。我现在发现你最初的反应是可以理解的。不允许突变但允许破坏显然是有问题的。const 指针/引用的隐含契约是它们的存在将作为目标对象销毁的块，也就是自动垃圾收集。

通常的解决方案是使用几乎任何其他语言来代替。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-10-13T18:16:41.993

> 我不允许使用 const 指针调用任何非 const 成员函数。

是的，你是。

```
class Foo
{
public:
  void aNonConstMemberFunction();
};

Foo* const aConstPointer = new Foo;
aConstPointer->aNonConstMemberFunction(); // legal

const Foo* aPointerToConst = new Foo;
aPointerToConst->aNonConstMemberFunction(); // illegal 
```

您将指向非常量对象的 const 指针与指向 const 对象的非常量指针混淆了。

话说回来，

```
delete aConstPointer; // legal
delete aPointerToConst; // legal 
```

由于此处其他答案已经说明的原因，删除任何一个都是合法的。

# sql-server - Reporting Services 2008 能否与 SQL Server 2005 一起用作目录数据库？

> ID：755198
> 
> 赞同：1
> 
> 时间：2009-04-16T08:19:20.473
> 
> 标签：sql-server, reporting-services, ssrs-2008

能否设置 Reporting Services 2008 报表服务器以将 SQL Server 2005 用于报表目录数据库？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T10:06:29.400

[是的，你可以](http://msdn.microsoft.com/en-gb/library/ms156016.aspx)。引用：

> 您可以使用 SQL Server 2005 或 SQL Server 2008 中的数据库引擎实例来托管数据库。

在过去，您无法将 SSRS 2005 数据库托管到 SQL Server 2000 上。

# c# - 如何检测一个对象是一个泛型集合，以及它包含哪些类型？

> ID：755200
> 
> 赞同：10
> 
> 时间：2009-04-16T08:20:17.210
> 
> 标签：c#, generics, typechecking

我有一个字符串序列化实用程序，它接受（几乎）任何类型的变量并将其转换为字符串。因此，例如，根据我的约定，整数值 123 将被序列化为“i:3:123”（i=整数；3=字符串长度；123=值）。

该实用程序处理所有原始类型以及一些非泛型集合，例如 ArrayLists 和 Hashtables。接口形式为

`public static string StringSerialize(object o) {}`

在内部我检测对象是什么类型并相应地序列化它。

现在我想升级我的实用程序来处理通用集合。有趣的是，我找不到合适的函数来检测该对象是一个通用集合，以及它包含什么类型——我需要哪些信息才能正确序列化它。迄今为止，我一直在使用表单的编码

`if (o is int) {// do something}`

但这似乎不适用于泛型。

你有什么建议吗？

* * *

编辑：感谢[Lucero](https://stackoverflow.com/questions/755200/how-do-i-detect-that-an-object-is-a-generic-collection-and-what-types-it-contain/755217#755217)，我已经更接近答案了，但我在这里遇到了这个小语法难题：

```
if (t.IsGenericType) {
  if (typeof(List<>) == t.GetGenericTypeDefinition()) {
    Type lt = t.GetGenericArguments()[0];
    List<lt> x = (List<lt>)o;
    stringifyList(x);
  }
} 
```

此代码无法编译，因为`lt`不允许将“”作为对象的`<T>`参数`List<>`。为什么不？什么是正确的语法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T08:27:56.443

使用类型来收集所需的信息。

对于泛型对象，调用 GetType() 来获取它们的类型，然后检查`IsGenericType`它是否是泛型的。如果是，您可以获得泛型类型定义，例如可以像这样进行比较`typeof(List<>)==yourType.GetGenericTypeDefinition()`：要找出泛型类型是什么，请使用 方法`GetGenericArguments`，该方法将返回所用类型的数组。

要比较类型，您可以执行以下操作：`if (typeof(int).IsAssignableFrom(yourGenericTypeArgument))`.

* * *

编辑回答跟进：

只要让你的`stringifyList`方法接受一个`IEnumerable`（非泛型）作为参数，也可能是已知的泛型类型参数，你会没事的；然后，您可以`foreach`根据需要检查所有项目并根据类型参数处理它们。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T09:07:00.423

回答你的难题；我假设`stringifyList`是一个通用方法？您需要通过反射调用它：

```
MethodInfo method = typeof(SomeType).GetMethod("stringifyList")
            .MakeGenericMethod(lt).Invoke({target}, new object[] {o}); 
```

where`{target}`是`null`静态方法，或`this`当前实例上的实例方法。

此外 - 我不会假设所有集合都是 a: 基于`List<T>`, b: 泛型类型。重要的是：**他们是否实施`IList<T>`了一些`T`**？

这是一个完整的例子：

```
using System;
using System.Collections.Generic;
static class Program {
    static Type GetListType(Type type) {
        foreach (Type intType in type.GetInterfaces()) {
            if (intType.IsGenericType
                && intType.GetGenericTypeDefinition() == typeof(IList<>)) {
                return intType.GetGenericArguments()[0];
            }
        }
        return null;
    }
    static void Main() {
        object o = new List<int> { 1, 2, 3, 4, 5 };
        Type t = o.GetType();
        Type lt = GetListType(t);
        if (lt != null) {
            typeof(Program).GetMethod("StringifyList")
                .MakeGenericMethod(lt).Invoke(null,
                new object[] { o });
        }
    }
    public static void StringifyList<T>(IList<T> list) {
        Console.WriteLine("Working with " + typeof(T).Name);
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T10:33:51.737

在最基本的层面上，所有通用列表都实现了`IEnumerable<T>`，它本身就是`IEnumerable`. 如果要序列化列表，则可以将其转换为 IEnumerable 并枚举其中的通用对象。

你做不到的原因

```
Type lt = t.GetGenericArguments()[0];
List<lt> x = (List<lt>)o;
stringifyList(x); 
```

是因为泛型仍然需要静态强类型，而您要做的是创建动态类型。`List<string>`和`List<int>`，尽管使用相同的通用接口，但它们是两种完全不同的类型，您不能在它们之间进行转换。

```
List<int> intList = new List<int>();
List<string> strList = intList; // error! 
```

`stringifyList(x)`会收到什么类型的？您可以在此处传递的最基本接口是`IEnumerable`，因为`IList<T>`它不继承自`IList`.

要序列化通用列表，您需要保留有关列表原始类型的信息，以便您可以重新创建`Activator`. 如果你想稍微优化一下，这样你就不必在你的 stringify 方法中检查每个列表成员的类型，你可以直接传递你从列表中提取的类型。

# oracle - 如何使用 JRuby 和 JDBC 连接到 Oracle

> ID：755207
> 
> 赞同：6
> 
> 时间：2009-04-16T08:22:24.587
> 
> 标签：oracle, jdbc, jruby

第一种方法：裸机

```
require 'java'
require 'rubygems'
require "c:/ruby/jruby-1.2.0/lib/ojdbc14.jar"  # should be redundant, but tried it anyway
odriver = Java::JavaClass.for_name("oracle.jdbc.driver.OracleDriver")
puts odriver.java_class
url = "jdbc:oracle:thin:@myhost:1521:mydb"
puts "About to connect..."
con = java.sql.DriverManager.getConnection(url, "myuser", "mypassword");
if con
    puts " connection good"
else
    puts " connection failed"
end 
```

上面的结果是：

```
sqltest.rb:4: cannot load Java class oracle.jdbc.driver.OracleDriver (NameError) 
```

第二种方法：Active Record

```
require 'rubygems'
gem 'ActiveRecord-JDBC'
require 'jdbc_adapter'
require 'active_record'
require 'active_record/version'
require "c:/ruby/jruby-1.2.0/lib/ojdbc14.jar"  # should be redundant...

ActiveRecord::Base.establish_connection(
   :adapter => 'jdbc',
   :driver => 'oracle.jdbc.driver.OracleDriver',
   :url => 'jdbc:oracle:thin:@myhost:1521:mydb',
   :username=>'myuser',
   :password=>'mypassword'
 )
ActiveRecord::Base.connection.execute("SELECT * FROM mytable") 
```

结果是：

```
C:/ruby/jruby-1.2.0/lib/ruby/gems/1.8/gems/activerecord-jdbc-adapter-0.9.1/lib/active_recordconnection_adapters/jdbc_adapter.rb:330:in `initialize': 
The driver encountered an error: cannot load Java class oracle.jdbc.driver.OracleDriver (RuntimeError) 
```

无论我如何处理，基本上都是相同的错误。

我正在使用 JRuby 1.2.0，我的 JRuby lib 目录中有 ojdbc14.jar

宝石：

*   ActiveRecord-JDBC (0.5)
*   activerecord-jdbc-适配器 (0.9.1)
*   活动记录（2.2.2）

我错过了什么？

谢谢，

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T00:50:25.883

原来我的 ojdbc14.jar 文件已损坏。

此外，jar 文件必须位于 jruby/lib 目录中。简单地将它放在类路径上是行不通的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-06-03T05:42:07.137

```
需要'java'

# 这个require不会将jdbc驱动jar加载到系统类路径中
需要“c:/ruby/jruby-1.2.0/lib/ojdbc14.jar”

# 2种加载类的方法（可能还有更多）

# 1 java类名的ruby语法
Java::OracleJdbcDriver::OracleDriver

# 2 使用线程上下文类加载器
java.lang.Class.forName("oracle.jdbc.driver.OracleDriver", true, java.lang.Thread.currentThread.getContextClassLoader)

url = "jdbc:oracle:thin:@myhost:1521:mydb"
提出“即将连接...”
con = java.sql.DriverManager.getConnection(url, "myuser", "mypassword");
如果骗
    把“连接好”
别的
    提出“连接失败”
结尾

```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-02-18T00:08:13.027

然后在创建后使用它：

```
b = con.create_statement
rs=b.execute_query(“从 SYS.V_$VERSION 中选择 BANNER”)
而（rs.next（））
  pr rs.getObject(1) # 获取第一列
结尾
rs.close

以及如何处理 oracle 时间戳（例如，如果第 3 列是时间戳）：

>> rs.getObject(3).timestamp_value.to_string
=> “1970-01-01 00:00:01.0”
>> Date.parse(rs.getObject(3).timestamp_value.to_string)
# 或者你可以使用时间，比如
>> as_ruby_time= Date.parse(rs.getObject(3).timestamp_value.to_string).to_time #1.9有这个方法
＃ 或者
>> as_ruby_time = Time.at(0) + rs.getObject(3).timestamp_value.get_time

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T08:27:44.947

你安装了oracle客户端吗？您可能至少需要来自客户端的 jdbc 驱动程序文件

# svn - 定期将修订从一个 SVN 存储库复制到另一个活动 SVN 存储库

> ID：755213
> 
> 赞同：0
> 
> 时间：2009-04-16T08:26:17.120
> 
> 标签：svn, version-control, data-synchronization

我公司维护两个 SVN 存储库，Repository 1 和 Repository 2：

1.  该存储库中有多个项目，并且只能由公司内部的开发人员访问。通过 HTTPS 访问，通过 Windows 域进行身份验证。
2.  该存储库中有一个项目，可供公司内的开发人员和我们客户的开发人员访问。通过 svn:// 访问，通过 passwd 文件进行身份验证。

我们在存储库 1 的文件夹中有一些代码，我们希望将其下载给存储库 2 的用户。显而易见的答案是使用 SVN Externals，但据我所知，这需要客户的开发人员拥有帐户我们的领域，我们的 IT 人员不喜欢这样。

因此，我能看到的唯一解决方案是某种定期运行的 cron 作业，以将必要的文件从存储库 1 复制到 2。我找到了一个名为[Tailor](http://wiki.darcs.net/DarcsWiki/Tailor)的工具，它声称可以满足我的需求，但到目前为止我已经没有设法让它正常工作。

在我花更多时间尝试让 Tailor 工作之前，是否有人对另一种方法有任何建议？我最后的手段是敲一个程序来为我做这件事，这应该不会太难，但如果有一个现有的应用程序，最好使用现有的应用程序！

提前感谢您的任何帮助/指点！

富有的

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T09:47:24.100

如果 SVN 外部可以工作，但唯一的绊脚石是访问权限，那么为什么不克隆存储库并将外部指向它呢？

SVN 现在对镜像有很好的支持：

[https://www.opends.org/wiki/page/MirroringASubversionRepository](https://www.opends.org/wiki/page/MirroringASubversionRepository)

您可以使用您喜欢的任何身份验证方案锁定镜像存储库，例如匿名只读访问。

但是，您需要确保唯一更新镜像的是 svn sync 命令 - 存储库 2 的用户将无法将更改提交回存储库 1。

这个页面有一些非常有用的信息：

[http://svn.collab.net/repos/svn/trunk/notes/svnsync.txt](http://svn.collab.net/repos/svn/trunk/notes/svnsync.txt)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T10:02:22.317

我看到您需要从两个存储库中进行更改。

您也许可以使用相同的 svnsync 想法来构建[直写代理](http://subversion.apache.org/docs/release-notes/1.5.html#webdav-proxy)。

使用它，镜像存储库将写入请求传递回主代理。现在我不确定身份验证会发生什么，但在这里可能值得研究。

也可以看看[这个信息](http://svn.apache.org/repos/asf/subversion/trunk/notes/http-and-webdav/webdav-proxy)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T08:51:07.683

您是否需要让外部开发人员更改存储库 2 中文件夹中的代码，如果不需要，您可能根本不需要使用 SVN。

一般来说，拥有两个带有相同代码的 SVN 存储库会让人感到困惑。

其他选项

*   如果您需要外部开发人员编辑存储库 2 中的文件，您是否可以不让外部开发人员以另一种方式进行，所以存储库 1 对存储库有一个外部定义。
*   通过将所有代码放在存储库中来绕过您的 IT 人员。
*   使用 GIT。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T09:51:24.950

有[SVNReplicate](https://open.datacore.ch/DCwiki.open/Wiki.jsp?page=SVNreplicate)，它可能可以定制为与单个项目一起使用，但这似乎是[分布式 VCS](https://stackoverflow.com/questions/tagged/dvcs)应该更合适的情况。

# sql - 获取两个日期之间的差异

> ID：755215
> 
> 赞同：1
> 
> 时间：2009-04-16T08:27:32.047
> 
> 标签：sql, sql-server, sql-server-2005, tsql

我有 2 个约会。我想在存储过程中获取两个日期之间的天数。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T08:30:28.293

DateDiff 函数应该做你需要的

```
declare @var1 Datetime
declare @var2 Datetime

set @var1 = '2009-04-01'
set @var2 = '2009-04-16'

SELECT datediff(day,@var1, @var2 ) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T08:30:07.267

使用 dateDiff 函数怎么样？

例如

```
DECLARE @Dt INT
SET @Dt = DATEDIFF(dd,@StartDate,@EndDate) 
```

应该做的伎俩？

还是我错过了什么？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T08:32:01.740

```
USE tempdb

DECLARE @DATE1 datetime

DECLARE @DATE2 datetime

SET @DATE1 = '01/01/2000'

SET @DATE2 = '02/01/2000'

SELECT DATEDIFF(day, @DATE1, @DATE2) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-14T21:41:29.863

请注意，DATEDIFF 只关注日期部分。如果涉及时间，则转换后的减法可能会产生更好的结果。

```
DECLARE @start DATETIME
DECLARE @end DATETIME
SET @start = '20090514 00:00:00'
SET @end = '20090514 23:59:59'
PRINT CONVERT(FLOAT, (@end-@start))  -- 0.999988
PRINT DATEDIFF(DAY,@start,@end)      -- 0 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T09:11:17.603

DATEDIFF 是这样做的方法

# oracle - 使用变量定义集合

> ID：755228
> 
> 赞同：0
> 
> 时间：2009-04-16T08:31:49.557
> 
> 标签：oracle, plsql

如何在 PL/SQL 中使用变量定义集合？

例如。

```
v_owner varchar(128) := 'SCHEMA_USER';
v_tablename varchar(128) := 'TABLENAME';

TYPE t_tab IS TABLE OF SCHEMA_USER.TABLENAME%ROWTYPE;
v_tab t_tab; 
```

我想要的是使用变量而不是所有者/表的名称。像这样的东西：

```
TYPE t_tab IS TABLE OF v_owner.v_tablename%ROWTYPE; 
```

但这当然行不通。

任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T09:34:39.497

您需要使用类似这样的动态 PL/SQL：

```
SQL> DECLARE
  2     v_owner varchar(128) := 'MYSCHEMA';
  3     v_tablename varchar(128) := 'EMP';
  4     v_str LONG;
  5  BEGIN
  6     v_str := 'DECLARE TYPE t_tab IS TABLE OF ' || v_owner || '.' || v_tablename || '%ROWTYPE;'
  7               || ' v_tab t_tab;'
  8               || ' BEGIN'
  9               || '   SELECT * BULK COLLECT INTO v_tab'
 10               || '     FROM emp WHERE empno = :input1;'
 11               || '   dbms_output.put_line(v_tab(1).ename);'
 12               || 'END;';
 13     EXECUTE IMMEDIATE v_str USING 7839;
 14  END;
 15  /
KING

PL/SQL procedure successfully completed. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T11:46:19.377

非常感谢您的回复。

我不得不对整个事情进行一些修改，但这很有效：

```
DECLARE
v_owner varchar(128) := 'SCHEMA';
     v_tablename varchar(128) := 'TABLE';
     v_str LONG;
  BEGIN
v_str := 'DECLARE TYPE t_tab IS TABLE OF ' || v_owner || '.' || v_tablename || '%ROWTYPE;'
               || ' v_tab t_tab;'
               || ' BEGIN'
               || '   SELECT * BULK COLLECT INTO v_tab'
               || '     FROM ' || v_owner || '.' || v_tablename ||';'
               || 'END;';
     EXECUTE IMMEDIATE v_str;
  END;
/ 
```

# sql - 如何从 CSV 或 XLS 将数据导入 SQL，根据 DB 中的当前记录自动递增字符串字段？

> ID：755231
> 
> 赞同：0
> 
> 时间：2009-04-16T08:32:16.917
> 
> 标签：sql, import, auto-increment

我需要将数据从 Excel 导入 SQL 2000 db。

我需要从工作表中导入 6 个字段，并增加一个字符串字段，其中包含一个填充为 5 个前导零字符的整数。该字段不是主键，数据库不会自动填充它。此外，如果有帮助，数据库*将*允许将此字段输入为 NULL，然后在有帮助时更改。

我可以使用菜鸟 DTS 和插入语句的组合将数据放入我需要的表中，并手动更新我今天必须做的 20 条记录的字符串字段，但下周我需要导入大约 1000 条记录。

我是否应该编写一个 C#/ADO.net 应用程序来执行此操作，[请记住我是新手，所以这需要我几天时间 :-) ] 还是有一种方法可以使用 DTS 增加字符串字段直接或插入语句中的某种循环？

在此先感谢 G

**编辑：**我插入的表构造如下，我需要更新“cedeviceid”、“vanwarehouse”、“username”、“devicesimnumber”、“UserGroup”和“ServiceMgr”。从 Excel 表。“sendercode”是我需要增加的字符串

CREATE TABLE [dbo].[mw_gsmprofile](
[cedeviceid] varchar NOT NULL,
[mainwarehouse] varchar NULL,
[vanwarehouse] varchar NULL,
[username] varchar NULL,
[sendercode] varchar NULL,
[devicesimnumber] varchar NULL,
[usersupportgsm] [int] NULL，
[userisonline] [int] NULL，
[onlinedate] varchar NULL，
[lastsentsequenceno] [int] NULL，
[lastsentdate] varchar NULL，
[lastreceivedsequenceno] [int] NULL，
[lastreceiveddate] varchar NULL，
[EnableAutoDownloading] [int] NULL，
[EnableCompressFile] [int] NULL，
[LogonUserName] varchar NULL，
[LogonPassword] varchar NULL，
[LogonDomain] varchar NULL，
[UserGroup] varchar NULL，
[UseStorageCard] [int] NULL，
[SMSMapProfile] varchar NULL，
[SMPPClientFlag] [int] NULL，
[LASTUPDATE] varchar NULL，
[ServiceMgr] varchar NULL，
[VanLocation] varchar NULL，
[OnHireWarehouse] varchar NULL，
[OnHireWhsRepType] [int] NULL，
[HireDepotWarehouse] varchar NULL，
[HireDepotWhsRepType] [int] NULL，
约束 [PK_mw_gsmprofile] 主键集群
（
[cedeviceid] ASC
）WITH（PAD_INDEX = OFF，STATISTICS_NORECOMPUTE = OFF，IGNORE_DUP_KEY = OFF，ALLOW_ROW_LOCKS = ON，ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

**样本数据**

cedeviceid,vanwarehouse, username, devicesimnumber, UserGroup, ServiceMgr
3431, 999, INSTALL TEAM 1,,INSTAL, AHOA
3441, 999, INSTALL TEAM 2,,INSTAL, AHOA
3451, 999, INSTALL TEAM 3,,INSTAL, AHOA
3461, 999 , 安装团队 4,,安装, AHOA
3471, 999, 安装团队 5,,安装, AHOA
3472, 999, 安装团队 6,,安装, AHOA

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T09:09:50.760

一些自己的小号在这里吹响，但我自己的 FOSS 工具[CSVfix](http://code.google.com/p/csvfix/)可以在不编写任何代码的情况下使用（莫名其妙的）未记录**序列**commanbd 来做到这一点。例如，给定一个 CSV 文件：

```
foo,bar
one,two
three,four 
```

然后：

```
csvfix sequence -n 42 -p 5 afile.csv 
```

将产生输出：

```
00042, foo, bar
00043, one, two
00044, three,four 
```

-p 选项指定填充，-n 选项指定起始编号。

现在找出它是如何从帮助文件中省略的......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T08:38:15.123

我会用一个小应用程序来做到这一点。您必须获取表格的第一项，以相反的顺序排序（这将为您提供 id 的最大值）。在知道最大值之后，您可以使用编程语言的表现力非常轻松地增加它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T08:47:19.893

1.  从数据库中获取起始值
2.  遍历导入的记录，一次将它们插入到数据库中。使用计数器变量来增加字段。使用 tostring("00000") 重载来填充数字。

# ruby - 无法在 Ruby 中将 ffmpeg 作为子进程运行

> ID：755233
> 
> 赞同：5
> 
> 时间：2009-04-16T08:34:02.047
> 
> 标签：ruby, ffmpeg

我正在尝试以下代码，通过将 ffmpeg 实用程序作为子进程运行并获取其输出并解析它来确定视频分辨率：

```
IO.popen 'ffmpeg -i ' + path_to_file do |ffmpegIO|
    # my parse goes here
end 
```

...但是 ffmpeg 输出仍然连接到 stdout 并且 ffmepgIO.readlines 是空的。ffmpeg 实用程序是否需要一些特殊处理？还是有其他方法可以获得 ffmpeg 输出？我在 WinXP 和 Fedora Linux 下测试了这段代码——结果是一样的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T21:25:54.217

To follow-up on mouviciel's comment, you would need to use something like [popen3](http://www.ruby-doc.org/stdlib/libdoc/open3/rdoc/index.html):

```
require 'open3'

Open3.popen3("ffmpeg", "-i", path_to_file) { |stdin, stdout, stderr|
  # do stuff
} 
```

(btw, note that using an array as parameter to popen would be a bit safer, especially if the filename may include spaces or any kind of character that would need to be quoted otherwise)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T08:41:42.230

FFmpeg 标准输出用于媒体输出。对于日志信息（例如分辨率），您必须解析 ffmpeg 标准错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T10:16:25.273

Depending on what you are trying to do it might be easier to use the [rvideo gem](http://rvideo.rubyforge.org/rdoc/).

For example:

```
video = RVideo::Inspector.new(:file => path_to_file)
video.resolution # => "480x272"
video.width # => 480
video.height # => 272 
```

# vb.net - 如何在 SSRS 中使用 VB.NET 动态更改文本颜色？

> ID：755234
> 
> 赞同：0
> 
> 时间：2009-04-16T08:34:05.167
> 
> 标签：vb.net, reporting-services

我正在使用下面的代码来动态更改文本，但我还需要使用 VB.NET 将 SSRS 中整行的颜色从黑色更改为红色。但是， row.Cells.Style.ForeColor = System.Drawing.Color.Red 不起作用。关于如何动态更改特定行中的文本颜色的任何想法？

```
Public Shared Function ChangeWord(ByVal s As String) As String
    Dim strBuilder As New System.Text.StringBuilder(s)
    If s.Contains("Others") Then
        strBuilder.Replace("Others", "Others FIG NOT INCL")
        Return strBuilder.ToString()
    Else : Return s
    End If
End Function

Public Shared Function ExcludeOthers(ByVal rowDesc As String, ByVal rowVal As Integer) As Integer
    If rowDesc.Contains("Others") Then
        rowVal = 0
        Return rowVal
    Else
        Return rowVal
    End If
End Function 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-16T10:49:24.477

我对您的问题的理解是，如果报告中的描述字段包含值“其他”，您希望有条件地将行的文本颜色设置为红色

您不需要任何 VB.Net 代码来执行此操作。

在报表设计器的“布局”选项卡中，通过单击最左侧单元格左侧边缘外的框来选择要设置格式的行。

在该行的属性中，设置“颜色”属性的值，从下拉列表中选择“表达式...”。

在表达式编辑器中，输入以下代码

```
=iif(Fields!~MyColumnName~.Value.ToString().Contains("Others") = True,"Red","Black") 
```

您需要更改`~MyColumnName~`为数据集中列的实际名称。

# sql - 没有外键的SQL级联删除？

> ID：755236
> 
> 赞同：5
> 
> 时间：2009-04-16T08:36:37.343
> 
> 标签：sql, database

我有以下表格：

```
Country: Country_ID, CountryName
Regions: Region_ID, RegionName, Country_ID
Areas: Area_ID, AreaName, RegionID 
```

我没有使用外键，也不打算这样做，我现在想做的就是能够在国家表的 tableAdapter 中的一个查询中删除国家和所有相关地区、地区......

如何？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-16T08:41:44.507

在一个查询中？我怀疑你可以。

但你可以在三个方面做到这一点：

```
delete from Areas where RegionID in (select Region_ID from Regions where Country_ID in (select Country_ID where CountryName='Somelandia'))
delete from Regions where Country_ID in (select Country_ID where CountryName='Somelandia')
delete from Country where CountryName = 'Somelandia' 
```

话虽如此，我强烈建议您为此重新考虑使用外键关系和级联删除。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T08:39:28.117

使用事务。启动一个事务，然后使用三个 DELETE 语句，然后是 COMMIT TRANSACTION 语句。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T08:51:07.340

您可以按照以下方式尝试存储过程：

```
create proc EraseCountry
(
    @countryid int
)
as

BEGIN TRY 
BEGIN TRANSACTION 

    delete areas
    from areas 
        inner join regions on areas.region_id = regions.region_id
    where regions.countryid = @countryid

    delete regions
    where countryid = @countryid

    delete country
    where countryid = @countryid

COMMIT TRAN 
END TRY
BEGIN CATCH
    IF @@TRANCOUNT > 0
    ROLLBACK TRAN 
END CATCH
GO 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T08:44:18.870

如果您的数据库支持，您可以使用触发器，然后在触发器中使用事务。只要删除区域或区域，触发器就会执行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T11:48:48.373

乔恩说的。还，

Areas.RegionID 和 Regions.CountryID 确实是外键。

即使您没有这样声明它们。不声明它们可以使您加快速度，但它也允许您在这两列（字段）中存储非法值。出于与级联删除相同的原因，您希望防止在这些列中进行无效插入。

# eclipse - Zend Studio for eclipse - 为项目中的所有文件切换字符编码

> ID：755245
> 
> 赞同：7
> 
> 时间：2009-04-16T08:40:50.487
> 
> 标签：eclipse, character-encoding, zend-studio

我在 Mac 上使用 Zend Studio for Eclipise，它似乎一直将所有文件设置为具有和编码“Mac Roman”。当我保存文件时，这会成为问题，因为它们都需要是 UTF-8。

我知道如何逐个文件将编码更改为 UTF-8，但我想知道是否可以将这个项目设置为广泛？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-28T09:12:31.527

*   Eclipse-Wide：窗口->首选项->外观->工作区
*   项目范围：右键单击项目-> 属性
*   文件范围：右键单击文件->属性

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-06-16T19:41:41.057

在我的 Eclipse for PHP Helios SR 2 for Mac 上：

*   Eclipse-Wide：Eclipse->Preferences->General->Workspace

其他与@SkaveRat 相同

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-11-01T18:10:19.070

在 Zend Studio 8.x 上，对于 Mac osx 10.5.8，我将其更改为：

顶部菜单选择：`Edit`-> `Set encoding`-> `Other: UTF-8,`。默认情况下，它设置为 Mac Roman。

然后申请。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-27T09:17:30.967

请记住，php 实际上并不支持 utf-8 编码的源文件。在 utf-8 编码文件中创建字符串时，php 只会看到每个字符 2 个静态字节。

尝试使用 utf-8 或 ISO-8859-1 编码运行以下命令。strlen() 将根据编码报告不同的长度。

```
<?php
$string = "äüö";
echo (strlen($string));
?> 
```

# php - 如何通过我网站上的联系我们表格在我的免费 gmail 收件箱中获取用户邮件

> ID：755246
> 
> 赞同：0
> 
> 时间：2009-04-16T08:41:01.250
> 
> 标签：php, email

如何通过我网站上的联系我们表格在我的免费 gmail 收件箱中获取用户邮件。我不使用带有我网站名称的电子邮件。我使用免费的 gmail。我尝试了许多脚本，但都需要域上的电子邮件帐户。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T09:37:52.983

这个问题与[This One 有](https://stackoverflow.com/questions/751259/i-need-a-free-php-ajax-enabled-contact-us-form-script-and-mail-should-come-in-gma "这个？")关系吗？

好吧，所以你的网站上有一个表格，你的用户填写了它，你需要一封包含这些数据的电子邮件，对吧？

简单的例子：

```
<form action="sendMail.php" method="post">
    Name: <input type="text" name="name" id="name" /><br />
    Email: <input type="text" name="email" id="email" /><br />
    Text: <textarea name="text"></textarea><br />
    <input type="submit" value="Send" />
</form> 
```

然后，发送邮件的 php 页面：

```
//php sendThis.php page
<?php
require("class.phpmailer.php");
$name = $_POST['name'];
$email = $_POST['email'];
$text = $name . ', ' . $email . ' has filled the form with the text:<br />' . $_POST['text'];

$from = 'your.email@gmail.com';
$to = 'your.email@gmail.com';
$gmailPass = 'your gmail password';

$mail = new PHPMailer();
$mail->IsSMTP();
// enable SMTP authentication
$mail->SMTPAuth = true;
// sets the prefix to the server
$mail->SMTPSecure = "ssl";
// sets GMAIL as the SMTP server
$mail->Host = 'smtp.gmail.com';
// set the SMTP port
$mail->Port = '465';
// GMAIL username
$mail->Username = $from;
// GMAIL password
$mail->Password = $gmailPass;
$mail->From = $from;
$mail->FromName = $from;
$mail->AddReplyTo($from, $from);
$mail->Subject = 'This is a test!';
$mail->Body = $text;
$mail->MsgHTML($text);
$mail->IsHTML(true);
$mail->AddAddress($to, $to);

if(!$mail->Send()){
    echo $mail->ErrorInfo;
}else{
    echo 'sent!';
    $mail->ClearAddresses();
    $mail->ClearAttachments();
}
?> 
```

**编辑：刚刚测试并且工作正常。确保 3 个文件（class.phpmailer.php、class.pop3.php 和 class.smtp.php）位于正确的包含路径中**

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T08:53:09.537

基本上，它涉及到PHP`mail()`函数：

```
<?php 
     mail(yourGmailAddress, object, message); 
?> 
```

正如您已经观察到的，此解决方案仅在网络服务器运行邮件服务器时才有效。此邮件服务器可能会禁止未知用户。因此，您需要在该网络/邮件服务器上拥有一个电子邮件帐户（我相信是这种情况）。然后第二步是将邮件从您的网站地址转发到您的 gmail 帐户。我 90% 确定您的 gmail 配置是可能的。也可能来自您的网站邮件配置。但不要同时配置！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-24T15:53:16.903

尝试启用`openssl`.

取消注释该行：

```
extension=php_openssl.dll 
```

在你的`php.ini`文件中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T09:08:28.733

您还可以将您的电子邮件地址放入表单元素的“操作”属性中。但这是非常不可靠的。像这样：

```
<form method='post' action='mailto:your@email.com?Subject=Hello'>
...
</form> 
```

用户必须安装和配置电子邮件客户端才能正常工作。还有一些其他的缺点。您必须进行一些研究才能确定此方法是否适合您。 [http://www.google.com/search?client=opera&rls=en&q=form+action+mailto&sourceid=opera&ie=utf-8&oe=utf-8](http://www.google.com/search?client=opera&rls=en&q=form+action+mailto&sourceid=opera&ie=utf-8&oe=utf-8)

# vba - 如何使用 Word VBA 删除命令按钮？

> ID：755247
> 
> 赞同：3
> 
> 时间：2009-04-16T08:41:08.253
> 
> 标签：vba, ms-word

我有一个 Word 文档，其中包含一个名为“更新”的命令按钮。

如何使用 VBA 删除此按钮？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T10:14:47.147

This should do it :

```
For Each o In ActiveDocument.InlineShapes      

   If o.OLEFormat.Object.Name = "update" Then
        o.Delete
    End If

Next 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-23T07:50:59.450

我认为当您说“按钮名称”时，您会提到“按钮标题”；请尝试以下代码 -

```
For Each o In ActiveDocument.InlineShapes
   If o.OLEFormat.Object.Caption = "update" Then
        o.Delete
    End If
Next 
```

问候， 尼莱什

PS：标题区分大小写，因此您可能需要检查标题的大小写。

# c# - 获取传递给方法的参数名称

> ID：755254
> 
> 赞同：3
> 
> 时间：2009-04-16T08:43:17.267
> 
> 标签：c#, reflection, parameters

重复： [确定用作方法参数的变量的名称](https://stackoverflow.com/questions/742350/determine-the-name-of-the-variable-used-as-a-parameter-to-a-method)

有什么方法可以检索传递给方法的参数的名称，例如

```
int someParameter = 1;
Method(someParameter);

public void Method(int parameter)
{
    // I want the name of 'parameter' which will be 'someParameter'.
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T08:45:55.077

不，它只是作为参数传入的*值。*所有方法获取的是整数。就您的方法而言，表达式恰好只是评估变量的事实是未知的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T08:45:45.467

不，没有办法。

接下来会有一群人展示奇怪的 lambda 表达式来更改呼叫站点并获得名称，但简短的回答是否定的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-05T20:06:12.807

唯一的方法可能是使用具有运行时保留的注释。但是，它将是注释的名称，而不是参数本身的名称。参数名称只是语言的语法工件。它不会转移到编译结果中。

# cookies - 在没有用户的网站中，cookie 是防止人们重复操作的唯一方法吗？

> ID：755255
> 
> 赞同：0
> 
> 时间：2009-04-16T08:43:39.760
> 
> 标签：cookies, web

我正在创建一个网站，但我不想拥有用户/会员资格。

但是，使用该网站的人可以进行投票和标记可疑内容等操作。使用 cookie 识别和防止用户重复执行此操作的唯一方法是什么？

我意识到用户可以清除他们的 cookie，但我想不出其他方法。

对这种情况的建议？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T08:48:37.377

好吧，您可以在数据库的数据记录中映射一个 cookie + ip 地址。来识别用户。因此，如果数据库中存在该 ip，则只需添加 cookie，但首先检查 cookie 以避免不必要的数据库调用。

但这并不是最佳选择，因为学校等可能在许多计算机上具有相同的 ip。

你总是可以适应openid！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T08:51:00.303

Marko & Visage 是正确的，

只是要补充一点，您可能希望将每个投票与时间戳、IP 等一起存储......所以至少如果有人试图“玩弄”您的网站，您将能够回滚相同的投票集位置或在很短的时间内（即来自机器人）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T08:53:25.010

+1 对于其他人已经说过的所有内容。这是另一个中间思路：

使用 cookie 作为限制投票的主要手段。如果未找到 cookie，请检查 IP 地址。例如，同一 IP 每 5 分钟最多允许 1 次投票。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T08:47:32.433

是的你是对的。

HTTP 是无状态的，因此无法确定您现在收到的请求的来源与您收到的请求的来源（例如 5 分钟前）是否相同或不同。

Cookie 是解决此问题的唯一方法。甚至服务器端会话也依赖 cookie 来跨请求维护会话身份（忽略在 URL 中传递 sesison ID 的安全噩梦，任何有恶意的人都可以轻松回避）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T08:48:18.173

Cookie 是不够的，正如您所说，它可能会被清除/过期。

由于 DHCP 和防火墙，IP 地址跟踪也不是一种选择。

唯一可以 100% 确定的是用户，但话又说回来，一个人可以注册多个帐户。

我会选择饼干，作为最简单且最不突兀的方式。如果有人真的想玩这个系统，他会想方设法阻止它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T08:48:40.403

即使拥有会员资格，用户也可以多次注册并投票。

Cookie 是处理此问题的一种方法，但知道可以删除 cookie 的人可以再次投票。

您可以捕获选民的 IP 并据此进行限制。但是很多人会有相同的IP。

可惜没有其他办法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T14:19:31.693

如果系统适合他们，总会有人玩这个系统。此外，如果您做到完全不需要 cookie，那么您很容易受到非常简单的攻击。

我认为你会想考虑如何增加在怀疑的阴云下运营的用户的经济成本。

例如，如果具有相同 cookie 的用户试图重新提交投票，那显然很容易被阻止。

如果具有不同 cookie 但来自同一个 IP 的用户执行相同的操作，则它可能来自代理/防火墙，因此您可能需要谨慎并强制他们做一些额外的事情，例如简单的验证码。一旦他们这样做了，如果他们的行为正常，只要他们的新 cookie 留在他们身边，就不需要任何新的东西。

这意味着没有 cookie 的人仍然可以参与，但他们必须每次重新输入字母序列或其他任何内容。很麻烦，但他们可能习惯于没有 cookie 就无法工作的网站。如果需要，他们可以破例。

您真的无法处理坐在 IP 池（真实或其他）上并在您的站点上利用新的和动态的攻击向量的用户。在这种情况下，他们的经济投资将超过你的，坦率地说，你会输。那时，您只是在竞争维护您的系统规则。那时您应该探索要求注册/电子邮件/手机/短信确认来提高赌注。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-16T14:24:25.800

您可以添加 GET 变量和 URL 部分以用作 cookie - 某些站点这样做是为了允许登录和/或在禁用 cookie 时进行跟踪。例如，使用源 IP 和用户代理字符串生成部件。

site.com/vote?cookie=123456

site.com/vote/cookie123456

# php - 如何缓冲 Ajax 请求？

> ID：755269
> 
> 赞同：0
> 
> 时间：2009-04-16T08:48:24.150
> 
> 标签：php, javascript, ajax

我有一个简单的 Ajax 函数，如下所示：

```
var x;
var myRequest = new Array();

function CreateXmlHttpReq(handler) {
    var xmlhttp = null;
    try {
        xmlhttp = new XMLHttpRequest();
    } catch (e) {
        try {
            xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
        } catch (e) {
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
    }
    xmlhttp.onreadystatechange = handler;
    return xmlhttp;
}

function getResults() {
    var r = Math.random();
    var someVar = document.getElementById("myvar").value;
    var myUrl = "url/of/my/phpScript.php?";
    myUrl += "r=" + r;
    //encodeURIComponent() instead of escape() when i aspect normal text
    myUrl += "&someVar=" + escape(someVar);
    //startLoading just show an overlay with a small rotating gif
    startLoading();
    x++;
    myRequest[x] = CreateXmlHttpReq(function () {
        printResultHandler(x);
    });
    myRequest[x].open("GET", myUrl);
    myRequest[x].send(null);
}

//example handler
function printResultHandler(x) {
    if (myRequest[x].readyState == 4 && myRequest[x].status == 200) {
        //usually i use innerHTML for quick requests, the DOM for more complex req
        document.getElementById(div).innerHTML = myRequest[x].responseText;
        //this will hide the overlay showed ith startLoading()
        stopLoading();
    }
} 
```

这很好用。当返回流量很大时（它可以是 XML、HTML 或其他），我只是遇到了一些问题，浏览器似乎“睡着了”一段时间。我不喜欢将大量文本（XML、HTML）合二为一。处理这个不好。

我想知道是否存在某种缓冲该请求的方法。当请求完成并返回`200`状态时，有没有办法逐段获取 responseText（比如说 2048 字节或逐行）？我想是这样的：

```
function printResultHandler(x) {
    if (myRequest[x].readyState == 4 && myRequest[x].status == 200) {
        //usually i use innerHTML for quick requests, the DOM for more complex req
        //document.getElementById(div).innerHTML = myRequest[x].responseText;
        var answer;
        while ((answer = readline(myRequest[x].responseText))) {
            //to something;
        }
        //this will hide the overlay showed ith startLoading()
        stopLoading();
    }
} 
```

总之，相当于PHP的`readdir()`or `fread()`。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T11:55:48.823

同意，缓冲请求并不是您真正可以做的事情。

您可以考虑在一组 HTTP 请求上错开用户对数据的请求，在每个 HTTP 请求返回时对其进行解析和处理。

例如，如果用户希望请求记录 1 到 1000，客户端可以首先请求记录 1 到 100，对其进行处理、解析和渲染，然后请求记录 101 到 200，依此类推。前 100 条记录的显示速度相对较快，并且在很短的一段时间后，接下来的 100 条记录就会显示。只要在用户设法处理前 100 条记录之前显示后 100 条记录，就应该没问题。完成请求的总时间会更长，但是 Web 应用程序会显得更灵敏，并且感知到的任务完成时间会更短。

如果您不只是用数据更新元素的 innerHTML 属性，还应该考虑从 XML 切换到 JSON。

要向用户显示对 AJAX 请求的响应，必须首先将响应解析为数据结构，然后再进行渲染。令人惊讶的是，XML 和 JSON 的解析时间几乎相同。不同之处在于遍历和读取生成的数据结构所需的时间。

用于遍历和访问已解析响应的 DOM 中的数据的浏览器函数相对较慢。浏览器 DOM API 方法掩盖了 DOM 遍历所涉及的复杂性，并使缓慢的过程看起来既漂亮又简单。

访问解析 JSON 格式响应产生的 JavaScript 对象中的数据要快得多。对于相同的数据集，遍历一个 JavaScript 对象比遍历一个 DOM 树快 2 到 3 倍。

在最近的测试中，我使用 10Mb 的源数据对 FireFox 3.1 beta 2 进行了测试，遍历 XML 响应的 DOM 大约需要 30 秒。对从同一原始大型数据集填充的 JavaScript 对象执行相同操作大约需要 15 秒。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T08:57:17.357

不，没有办法缓冲请求。如果您返回大量数据，然后尝试一次将其全部插入页面，则解析所有数据总是需要很长时间。

您可能要考虑是否有其他方法可以获得您想要的结果。您是否有理由通过 AJAX 请求将如此大量的数据插入到页面中？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T09:40:49.653

您必须手动完成（也就是自己编写代码）。

一个简单的解决方案如下（C=客户端，S=服务器）

*   C 发送请求
*   S 准备整个输出
*   S生成某种数据标识符键（例如数据的md5）
*   S 将数据切成块并保存（并确定块数）
*   S 返回数据标识符（可能还有块数）
*   C 从第一个块迭代到最后一个块，向服务器发送数据密钥（和块编号）
*   S 返回请求的块
*   C 显示块（或内容正在加载进度条）

需要注意的是，如果您不继续使用进度条方式而是进行即时处理，那么 S 必须将数据切割成块，作为 C 可以处理的部分正确的代码片段。

# asp.net - IE 7 中 Ajax 调用后的 CSS 样式

> ID：755272
> 
> 赞同：0
> 
> 时间：2009-04-16T08:48:52.197
> 
> 标签：asp.net, css, ajax

我在 AJAX 调用后没有应用我的样式时遇到了问题。我的样式不在页面的 <HEAD> 部分，它们仅在初始 Page_Load 时被 IE 识别。

如果您知道解决此问题的任何其他方法，请在此处发布。

这更多是参考，希望这对某些人有所帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T08:49:29.107

在进行了一些谷歌搜索后，我发现[将我的样式移动到页面的 <HEAD> 标记中可以解决](http://weblogs.asp.net/alessandro/archive/2007/12/31/updatepanel-css-stylesheet-upon-partial-refresh-bug-in-ie.aspx)问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-05-24T18:55:16.067

您还可以从 AJAX HTML 中获取样式，并将其插入头部。这是一些示例代码。在 IE8 和 Chrome 中测试。

```
function enable_embedded_styles(html) {
// Grab style content, and create new style element for it
// Works for first set of <style></style> tags in html
// Tested in IE and Chrome
    if (typeof(html) === 'string') {
        var beg = html.indexOf('<style>'), 
            end = html.indexOf('</style>');

        if (beg !== -1 && end !== -1) {
            var style = html.substr(beg + 7, end - 7 - beg); // everything between style tags
            html = html.substr(end + 8); // everything after closing style tag

            s = document.createElement('style');
            s.setAttribute('type','text/css');

            // For IE
            if (s.styleSheet) {
                s.styleSheet.cssText = style;
            } // endif

            // For every other browser
            else {
                s.appendChild(document.createTextNode(style));
            } // endelse

            // Append stylesheet to head
            document.getElementsByTagName('head')[0].appendChild(s);
        } // endif
    } // endif

    return html;
} // endfunction 
```

# sql - 如何使用实体框架获取 DB2 中的下一个序列号？

> ID：755279
> 
> 赞同：1
> 
> 时间：2009-04-16T08:52:18.897
> 
> 标签：sql, entity-framework, db2

我想通过实体框架中的即席查询检索下一个序列号。我正在使用：

```
LogEntities db = new LogEntities();

ObjectQuery<Int64> seq = db.CreateQuery<Int64>("SELECT AUDITLOG.EVENTID_SEQ.NEXTVAL from sysibm.sysdummy1"); 
```

这将返回以下错误：

*" ErrorDescription = "'sysibm.sysdummy1' 无法在当前范围或上下文中解析。确保所有引用的变量都在范围内，加载了所需的模式，并且正确地引用了命名空间。"*

我猜这是因为 sysdummy1 在我的模型中不是映射表。

任何人都知道我可以使用 LINQ 2 实体上下文执行此查询的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T12:28:18.700

ObjectQuery 需要使用实体 SQL，而不是“常规”SQL。如果要编写“常规” SQL，则需要使用存储连接，而不是 ObjectQuery。也就是说，我有点想知道为什么您要手动检索序列号。如果实体属性在服务器上设置为自动递增，这将在您 SaveChanges 时自动检索。如果您需要获取存储连接，则 EntityConnection 类型上有一个方法[CreateDbCommand](http://msdn.microsoft.com/en-us/library/system.data.entityclient.entityconnection_members.aspx)可以执行此操作。再次，我建议你不要这样做。使用此功能使您的代码提供程序特定。大多数实体框架代码应该与提供者无关。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T07:37:28.957

感谢您的回答克雷格。我无法使用自动递增标识列的原因是因为这个特定的逻辑表在物理上被划分为 31 个单独的（每日）表，并且 ID 需要在所有表中都是唯一的。

我最终创建了一个存储过程来从序列中检索下一个数字，然后将其添加到我的 EF 模型存储中。

```
private static long GetNextEventId(DbConnection dbConnection)
{
    using (DbCommand cmd = dbConnection.CreateCommand())
    {
        cmd.CommandText = "LogEntities.GetNextEventId";
        cmd.CommandType = CommandType.StoredProcedure;

        // Execute the command
        return Convert.ToInt64(cmd.ExecuteScalar());
    }
} 
```

这是在 EF 中调用存储过程的另一种方法，它返回一个标量。

[使用返回非实体类型的存储过程](http://blogs.msdn.com/bindeshv/archive/2008/11/21/using-stored-procedures-that-return-non-entity-type.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-20T15:15:45.850

另一种选择是创建一个带有标识列的表，并在插入后使用标识 val 函数中的值。

# c# - 使用 C# 发送 SOAP 请求

> ID：755282
> 
> 赞同：0
> 
> 时间：2009-04-16T08:53:42.170
> 
> 标签：c#, web-services, soap, c#-3.0, variable-initialization

我正在尝试向第 3 方 Web 服务发送 SOAP 请求。我已经成功地从同一服务中的其他接口发送和接收数据，但是我遇到了这个特定的问题：

```
<SP_GoodsMovement xmlns="http://services.hnseu.com">
  <GoodsMoved xmlns="http://tempuri.org/SP_GoodsMoved.xsd">
    <SerialNumberedGoodsMovements>
      <SerialNumbered>
        <PartNumber>string</PartNumber>
        <SerialNumber>string</SerialNumber>
        <MovementType>string</MovementType>
        <FromLocation>string</FromLocation>
        <FromLocationCategory>string</FromLocationCategory>
        <ToLocation>string</ToLocation>
        <ToLocationCategory>string</ToLocationCategory>
        <AssetMovementTimestamp>dateTime</AssetMovementTimestamp>
        <GoodsInReference>string</GoodsInReference>
      </SerialNumbered>
      <SerialNumbered>
        <PartNumber>string</PartNumber>
        <SerialNumber>string</SerialNumber>
        <MovementType>string</MovementType>
        <FromLocation>string</FromLocation>
        <FromLocationCategory>string</FromLocationCategory>
        <ToLocation>string</ToLocation>
        <ToLocationCategory>string</ToLocationCategory>
        <AssetMovementTimestamp>dateTime</AssetMovementTimestamp>
        <GoodsInReference>string</GoodsInReference>
      </SerialNumbered>
    </SerialNumberedGoodsMovements>
    <NonSerialNumberedGoodsMovements>
      <NonSerialNumbered>
        <PartNumber>string</PartNumber>
        <Quantity>unsignedInt</Quantity>
        <MovementType>string</MovementType>
        <FromLocation>string</FromLocation>
        <FromLocationCategory>string</FromLocationCategory>
        <ToLocation>string</ToLocation>
        <ToLocationCategory>string</ToLocationCategory>
        <Used>boolean</Used>
        <AssetMovementTimestamp>dateTime</AssetMovementTimestamp>
        <GoodsInReference>string</GoodsInReference>
      </NonSerialNumbered>
      <NonSerialNumbered>
        <PartNumber>string</PartNumber>
        <Quantity>unsignedInt</Quantity>
        <MovementType>string</MovementType>
        <FromLocation>string</FromLocation>
        <FromLocationCategory>string</FromLocationCategory>
        <ToLocation>string</ToLocation>
        <ToLocationCategory>string</ToLocationCategory>
        <Used>boolean</Used>
        <AssetMovementTimestamp>dateTime</AssetMovementTimestamp>
        <GoodsInReference>string</GoodsInReference>
      </NonSerialNumbered>
    </NonSerialNumberedGoodsMovements>
  </GoodsMoved>
</SP_GoodsMovement> 
```

所以我的代码如下（如果需要我可以扩展它）：

```
...
if (requestType == "SP_GoodsMovement")
{
  GoodsMoved SOAP_GoodsMoved = new GoodsMoved();
  SOAP_GoodsMoved.SerialNumberedGoodsMovements[0].PartNumber = partNumber[0].InnerXml;
...
  string SOAPMessage;
  SOAPMessage = request.SP_GoodsMovement(header, SOAP_GoodsMoved).Message;
} 
```

当我运行此代码时，我收到“对象引用未设置为对象的实例”错误。

我想我没有正确引用 PartNumber 参数，但我尝试了一些没有成功的事情。

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T08:58:08.150

```
 SOAP_GoodsMoved.SerialNumberedGoodsMovements[0] 
```

似乎没有初始化。

也许试试

```
 GoodsMoved SOAP_GoodsMoved = new GoodsMoved();
   SOAP_GoodsMoved.SerialNumberedGoodsMovements = new WhateverObject[1];
   SOAP_GoodsMoved.SerialNumberedGoodsMovements[0] = new WhateverObject();
   SOAP_GoodsMoved.SerialNumberedGoodsMovements[0].PartNumber = partNumber[0].InnerXml; 
```

或者您可以纠正 GoodsMoved() ctor 的重载，以确保 SerialNumberedGoodsMovements 数组被初始化为特定大小。

# c# - 你什么时候会在 C# 中使用抽象方法而不是虚拟方法？

> ID：755285
> 
> 赞同：6
> 
> 时间：2009-04-16T08:55:09.717
> 
> 标签：c#

> **可能重复：**
> [抽象函数和虚函数有什么区别？](https://stackoverflow.com/questions/391483/what-is-the-difference-between-abstract-function-and-virtual-function)

`abstract`使用优于方法的优点是什么，`virtual`反之亦然？

**抽象方法：**

*   只有抽象类可以保存抽象方法。
*   派生类也需要实现该方法，并且类中没有提供实现。

**虚拟方法：**

*   一个类可以声明这些并提供相同的实现。
*   派生类也需要实现方法来覆盖它。

# sql-server - sql server 的奇怪行为

> ID：755286
> 
> 赞同：0
> 
> 时间：2009-04-16T08:55:31.823
> 
> 标签：sql-server, sql

我的数据库中有以下表结构

```
ID               Name
--------------------------
ID_1             Name1

ID1              Name2 
```

当我执行以下查询时

```
SELECT * FROM tblNames
WHERE ID LIKE '_1' 
```

我选择了两条记录...

任何建议如何摆脱它？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T09:03:47.810

下划线 ( `_`) 是 LIKE 表达式中匹配单个字符的特殊字符。

要匹配实际的下划线，您需要对其进行转义：

```
select * from tblNames where id like '%\_1' escape '\' 
```

在这里，我告诉 SQL Server 考虑将反斜杠作为转义字符，并使用它来转义下划线。

或者，您可以将下划线表示为包含单个字符的字符范围 - 在这种情况下，它将按字面意思解释：

```
select * from tblNames where id like '%[_]1' 
```

哪个更简洁一些。

参考：[MSDN](http://msdn.microsoft.com/en-us/library/aa933232(SQL.80).aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T09:01:27.517

[LIKE 运算符](http://msdn.microsoft.com/en-us/library/aa933232(SQL.80).aspx)

Quickie：_ 是匹配任何内容的通配符。

```
SELECT * FROM tblNames
WHERE ID LIKE '\_1' ESCAPE '\' 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T09:00:38.317

```
选择 * 从 tblNames
WHERE ID LIKE '[_]1'

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T09:04:15.797

下划线字符是`like`运算符的通配符，它​​匹配任何一个字符。在您的情况下，模式 '_1' 与数据中的 '_1' 和 'D1' 匹配。

要在模式中使用文字下划线字符，您需要在其周围放置方括号，使其成为仅包含一个字符的字符范围：

```
SELECT * FROM tblNames
WHERE ID LIKE '[_]1' 
```

# c - C中的空结构

> ID：755305
> 
> 赞同：18
> 
> 时间：2009-04-16T09:04:09.057
> 
> 标签：c, struct, warnings

我有一个没有成员的结构（目前），我想知道是否可以抑制我收到的警告：

```
warning: struct has no members 
```

是否可以添加成员并将`sizeof`结构保持为零？还有其他解决方案吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-16T09:17:22.613

在 c 中，空结构的行为取决于编译器，而 c++ 是规范的一部分（[这里有解释](https://stackoverflow.com/questions/621616/c-what-is-the-size-of-an-object-of-an-empty-class)）

> C++
> 具有空成员序列和基类对象的类是空类。空类类型的完整对象和成员子对象应具有非零大小。

在 C 中，它相当模糊，因为 c99 标准有一些语言暗示不允许真正的空结构（请参阅 TrayMan 的答案），但许多编译器确实允许它（例如[gcc](http://gcc.gnu.org/onlinedocs/gcc-3.3.1/gcc/Empty-Structures.html#Empty%20Structures)）。

由于这取决于编译器，因此在这种情况下您不太可能获得真正可移植的代码。因此，抑制警告的非便携式方式可能是您最好的选择。

*   在 VS 中，您将使用[#pragma 警告](http://msdn.microsoft.com/en-us/library/2c8f766e(VS.80).aspx)
*   在 4.2.1 的 GCC 中，您有[诊断编译指示](http://gcc.gnu.org/onlinedocs/gcc/Diagnostic-Pragmas.html)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2011-05-26T09:53:27.650

如果您只需要用于转换和函数参数的结构符号，那么只需：

```
typedef struct _Interface Interface; 
```

这将为不透明类型创建符号。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2013-03-14T17:30:21.250

从技术上讲，这甚至不是有效的 C.

TrayMan 的分析有点偏离，是的 6.2.6.1 说：

> 除了位域，对象由一个或多个字节的连续序列组成，其数量、顺序和编码要么明确指定，要么由实现定义。

但将其与 6.2.5-20 联系起来，它说：

> —*结构类型*描述了一组顺序分配的**非空**成员对象（在某些情况下，还描述了一个不完整的数组），每个对象都有一个可选的指定名称和可能的不同类型。

现在您可以得出结论，结构将是一个或多个字节***，因为***它们不能为空。您的代码向您发出警告，而相同的代码实际上将*无法*在 Microsoft 的 Visual Studio 上编译并出现错误：

> 错误 C2016：C 要求结构或联合至少有一个成员

所以简短的回答是否定的，没有一种可移植的方法来避免这个警告，因为它告诉你你违反了 C 标准。您必须使用编译器特定的扩展来抑制它。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-16T09:27:10.607

[C99 标准](http://www.open-std.org/JTC1/SC22/WG14/www/docs/n1124.pdf)对此有些模棱两可，但似乎说空结构应该具有非零大小。

> 6.2.6.1 除位域外，对象由一个或多个字节的连续序列组成，其数量、顺序和编码要么明确指定，要么由实现定义。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-05-10T09:37:28.103

```
struct zero_information { int:0; }; 
```

上面的代码片段将从 中产生一个**非零**值`sizeof(struct zero_information)`，但它可能会帮助您获得所需的内容，因为为其分配的所有存储的 100% 是填充（只能通过 hack 访问，尽管我不记得了如果加入填充是未定义的行为，请从我的头顶开始）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-28T08:08:45.730

> 是否可以添加一个成员并将结构的大小保持为零？

没有。FWIW，C++ 允许空结构，但 sizeof() 对于空结构始终为非零。

> 还有其他解决方案吗？

不是任何容易的。值得注意的是，空结构在 C 中仅受到一定程度的支持，而在 C99 中则不允许。

C++ 支持空结构，但不同的编译器以不同的结果实现它们（对于 sizeof 和结构偏移），尤其是当您开始将继承混入其中时。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-16T09:14:43.803

如果您不需要“过于严格”的遵守，您可能会逃脱：

```
struct empty {
  char nothing[0];
}; 
```

不过，这是一个[GCC 扩展](http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Zero-Length.html)。

我有点希望我能够使用称为“灵活数组”的 C99 功能，声明如下：

```
struct empty99
{
  char nothing[]; // This is a C99 "flexible array".
}; 
```

但这不起作用；他们要求至少有一个普通的结构成员，他们不能是唯一的成员。

# c - 套接字编程中addrinfo名称的“提示”是什么意思

> ID：755308
> 
> 赞同：14
> 
> 时间：2009-04-16T09:06:14.653
> 
> 标签：c, sockets

在进行套接字编程时，人们总是将 addrinfo 结构命名为：

```
struct addrinfo hints;
// get ready to connect
status = getaddrinfo("www.example.net", "3490", &hints, &servinfo); 
```

我想知道它代表什么，以便更好地理解结构。

提前致谢。

* * *

感谢您的回答。也许我不清楚：

我想知道变量名“hints”是否是某些单词的缩写？或者如果“提示”这个词意味着它只给出一些地址信息，而让 getaddrinfo() 函数填充其余部分？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-17T02:39:11.157

从[FreeBSD 手册页](http://www.freebsd.org/cgi/man.cgi?query=getaddrinfo&apropos=0&sektion=0&manpath=FreeBSD+7.1-RELEASE&format=html)：

> `hints`是指向结构addrinfo 的可选指针，由...定义`<netdb.h>`。此结构可用于提供有关调用者支持或希望使用的套接字类型的提示。

它被称为“提示”，因为它可以用来提供，嗯，提示（在提示的意义上；可能有用但可以忽略的建议）。这表明调用者想要什么协议系列（例如 IPv4 与 IPv6）、什么套接字类型（数据报与 straming）、什么协议（TCP 与 UDP）等。您可以传入`NULL`并`hints`表明你不关心你得到什么协议族、套接字类型或协议。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T09:13:05.570

来自[http://linux.die.net/man/3/getaddrinfo](http://linux.die.net/man/3/getaddrinfo)

> 提示参数指定首选套接字类型或协议。NULL 提示指定任何网络地址或协议都是可接受的。如果此参数不为 NULL，则它指向 addrinfo 结构，其 ai_family、ai_socktype 和 ai_protocol 成员指定首选套接字类型。ai_family 中的 AF_UNSPEC 指定任何协议族（例如 IPv4 或 IPv6）。ai_socktype 或 ai_protocol 中的 0 指定任何套接字类型或协议也是可接受的。ai_flags 成员指定附加选项，定义如下。通过对它们进行逻辑或运算来指定多个标志。提示参数中的所有其他成员必须包含 0 或空指针。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T09:12:00.240

`struct addrinfo hints;`只是一个变量声明。结构本身在库中定义并通过[`sys/socket.h`](http://www.opengroup.org/onlinepubs/000095399/basedefs/sys/socket.h.html).

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2013-12-12T06:43:45.183

它与**英文单词“hints”**的含义相同。而且它**不是缩写**。

# security - 保存和恢复 ACL

> ID：755309
> 
> 赞同：1
> 
> 时间：2009-04-16T09:06:14.747
> 
> 标签：security, windows-server-2008

我正在将我的专用服务器移动到另一个提供商，并且我正在将所有内容迁移到新服务器。

我无法弄清楚的一件事是如何将 ACL（访问控制列表）从现有系统保存到另一个系统中。

我在 IIS 上使用 3 个不同的本地用户帐户来隔离每个网站的访问，IUSR_SITE1、IUSR_SITE2、IUSR_SITE3。

是否可以将这些目录中的 ACL 保存并恢复到另一台计算机中？所有文件都是一样的，我只需要移动 ACL 并创建相应的本地用户帐户。

感谢您提供的任何帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T08:36:03.793

为了回答我自己的问题，我找到了一个名为 AccessEnum 的程序，它列出了所有与父级权限不同的文件夹。

[http://technet.microsoft.com/en-us/sysinternals/bb897332.aspx](http://technet.microsoft.com/en-us/sysinternals/bb897332.aspx)

这使我能够确定哪些文件夹需要写入或写入/执行权限并手动应用它们。这并不理想，但另一种选择也很耗时且有些复杂。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T09:17:58.617

您可以使用 Windows 资源工具包中的 XCACLS，更多信息请[点击此处](http://www.ss64.com/nt/xcalcs.html)。这不是一个完整的解决方案，但您可以列出您感兴趣的所有权限，并使用该输出生成一个脚本，该脚本再次使用 XCACLS 恢复这些权限。

您还可以使用 Robocopy（也在资源工具包中并默认安装在 Vista 上）复制包含 ACL 的文件。这可能仅在用户与两台服务器位于同一域中时才有效，因为 ACL 的 SID 必须存在于其他系统上才能使用。如果他们不这样做，您最终会为目标系统上不存在的用户提供一堆 ACL。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T10:51:35.657

因为您使用的是本地帐户，所以仅复制 ACL 是行不通的，因为不同机器上的 SID 会有所不同。

我会分几个步骤来解决这个问题：

首先：获取帐户 SID（在旧机器和新机器上）。最快的方法是使用 psgetsid （来自[PSTools](http://technet.microsoft.com/en-us/sysinternals/bb897417.aspx "系统内部")）

```
PS G:\> psgetsid iusr_mymachine

PsGetSid v1.43 - 将 SID 转换为名称，反之亦然
版权所有 (C) 1999-2006 Mark Russinovich
Sysinternals - www.sysinternals.com

MYMACHINE\iusr_mymachine 的 SID：
S-1-5-21-3287596715-1315679848-4222504177-1004

```

第二：获取所需文件的 SDDL（“Security Descriptor Definition Language”，一种以文本形式编写 ACL 的方式，在[MSDN](http://msdn.microsoft.com/en-us/library/aa379567.aspx)上有描述）。Win32 和 .NET 有执行此操作的方法，但最简单的方法是 PowerShell（添加换行符以使结构可见）：

```
PS E:\Dev\Sites> (get-acl .\WebSite).sddl
O:S-1-5-21-1527045006-1366868173-4125010901-1001
G:S-1-5-21-1527045006-1366868173-4125010901-513D:AI
(A;OICI;0x1200a9;;;NS)
(A;OICI;0x1200a9;;;S-1-5-21-1527045006-1366868173-4125010901-1012)
(A;ID;FA;;;S-1-5-21-1527045006-1366868173-4125010901-1001)
(A;OICIIOID;FA;;;CO)
(A;OICIID;FA;;;SY)
(A;OICIID;FA;;;BA)
(A;OICIIOID;FA;;;S-1-5-21-1527045006-1366868173-4125010901-1001)

```

第三：可以对该字符串上的每个{旧机器 SID，新机器 SID) 应用字符串替换。

第四：在文件夹（或文件）上设置新的ACL：

```
$sec = 获取 acl 新文件夹
$sec.SetSecurityDescriptorSddlForm($sddl)

```

显然，对多个文件执行此操作的最佳途径是编写脚本，在旧机器上执行 1 和 2，并在目标机器上生成执行 3 和 4 的脚本（以避免远程设置具有未知 SID 的 ACL ）。

# c++ - 如何在应用程序之间共享图像数据？

> ID：755310
> 
> 赞同：2
> 
> 时间：2009-04-16T09:06:49.317
> 
> 标签：c++, visual-c++

我已经有一个名为“old”的应用程序呈现图像，其中图像数据以会话的形式存储，我需要从这个现有的“old”应用程序读取该数据到一个名为“new”的应用程序。

我如何传递这些数据？我是否需要获取会话的内存地址并将其传递给我的其他应用程序？

即使我有内存地址，我如何读取整个数据？它存储了大量数据。

命名管道和所有其他管道在两个进程之间创建了一个链接，当一个进程写入内存位置时，另一个进程读取它。

但是我有一个进程的内存地址作为输入，难道我唯一要做的就是从另一个进程的内存地址读取数据吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T09:13:57.097

您有很多选项可以在两个进程之间进行通信

*   将数据保存到文件并从其他应用程序读取
*   使用[命名管道](http://msdn.microsoft.com/en-us/library/aa365590(VS.85).aspx)建立连接
*   使用使用 win32 API 调用创建的[命名共享内存](http://msdn.microsoft.com/en-us/library/aa366551(VS.85).aspx)
*   在从两个应用程序加载的 DLL 中使用共享[内存区域](http://msdn.microsoft.com/en-us/library/ms686958(VS.85).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T16:10:39.247

当您使用 C++ 时，我强烈建议您看一下[Boost interprocess](http://www.boost.org/doc/libs/1_38_0/doc/html/interprocess.html)。它提供了对进程间通信的良好平台独立访问，其中大部分繁琐且容易出错的低级细节都被屏蔽了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T09:58:39.957

鉴于您的问题的倾向，我建议@shoosh 的命名共享内存建议。我以前用它来拍摄来自相机等的图像。

# iphone - 为什么使用标准 BMP 位数据的 iphone CGImageCreate 会给出错误的结果？

> ID：755316
> 
> 赞同：0
> 
> 时间：2009-04-16T09:07:54.850
> 
> 标签：iphone, core-graphics

我有一个生成标准 bmp 比特流的 gdi 引擎，现在我想通过 iphone 中的 CG 显示它，我像这样使用它：

```
// size  -> image size 
// rect  -> current view rect
// pBits -> the BITMAPINFO image bits stream

long imgSizePerRow = ((long)(24 * size.width + 31) / 32) * 4;
CGDataProviderRef providerRef = CGDataProviderCreateWithData(NULL, pBits,
                                          imgSizePerRow * size.height, NULL);

CGColorSpaceRef colorSpaceRef = CGColorSpaceCreateDeviceRGB();

CGImageRef imageRef = CGImageCreate(size.width, size.height, 8, 24,
                                    imgSizePerRow, colorSpaceRef,
                                    kCGBitmapByteOrderDefault, providerRef,
                                    NULL, YES, kCGRenderingIntentDefault);

CGContextDrawImage(context, rect, imageRef);

CGImageRelease(imageRef);
CGColorSpaceRelease(colorSpaceRef);
CGDataProviderRelease(providerRef); 
```

注意：我检查行像素是否适合 4 的时间

我的 gdi 生成比特流，在这种情况下，R8G8B8 格式，没有 alpha 通道，我将它用于 CGDataProviderRef 并将 CGImage 绘制到我的视图中。奇怪的是图像的颜色似乎发生了变化，但整个形状看起来还不错，我之前将位图格式的比特流保存到一个文件中，并进行对比，一切看起来都很好，只是整个色彩空间。

谁能告诉我代码中的错误在哪里，或者我错过了一些段落。环境？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T13:48:30.270

CGImageCreate 采用原始像素，.bmp 文件不是（它具有“BITMAPINFO”标题）。相反，使用 .bmp 数据创建 UIImage，然后从该对象获取 CGImage。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T05:01:57.707

我错过了重要的一点：我的 GDI 位图流按 B8->G8->R8 排序。

# c# - 从 Datetime.ToFileTime() 转换为 DateTime 对象

> ID：755330
> 
> 赞同：1
> 
> 时间：2009-04-16T09:13:42.933
> 
> 标签：c#

如何从`DateTime.ToFileTime()`回转换为`DateTime`对象？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T09:16:12.973

我猜 DateTime.FromFileTime()

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T09:16:45.377

```
 long value = DateTime.Now.ToFileTime();
    DateTime when = DateTime.FromFileTime(value); 
```

# python - 匹配长字符串时 finditer 挂起

> ID：755332
> 
> 赞同：4
> 
> 时间：2009-04-16T09:14:26.537
> 
> 标签：python, regex, performance

我有一个有点复杂的正则表达式，我试图匹配一个长字符串（65,535 个字符）。我正在寻找字符串中 re 的多次出现，因此我正在使用 finditer。它可以工作，但由于某种原因，它在识别出前几次出现后挂起。有谁知道这可能是为什么？这是代码片段：

```
pattern = "(([ef]|([gh]d*(ad*[gh]d)*b))d*b([ef]d*b|d*)*c)"

matches = re.finditer(pattern, string)
for match in matches:
    print "(%d-%d): %s" % (match.start(), match.end(), match.group()) 
```

它打印出前四次出现，但随后挂起。当我使用 Ctrl-C 杀死它时，它告诉我它在迭代器中被杀死：

```
Traceback (most recent call last):
  File "code.py", line 133, in <module>
    main(sys.argv[1:])
  File "code.py", line 106, in main
    for match in matches:
KeyboardInterrupt 
```

如果我用更简单的重新尝试它，它工作正常。

我在 Windows XP 上的 Cygwin 上运行的 python 2.5.4 上运行它。

我设法让它用一根非常短的绳子挂起来。使用这 50 个字符的字符串，大约 5 分钟后它再也没有返回：

```
ddddddeddbedddbddddddddddddddddddddddddddddddddddd 
```

使用这 39 个字符的字符串，返回大约需要 15 秒（并且不显示匹配项）：

```
ddddddeddbedddbdddddddddddddddddddddddd 
```

并使用此字符串立即返回：

```
ddddddeddbedddbdddddddddddddd 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T09:22:12.383

会不会是您的表达式触发了 Python RE 引擎中的指数行为？

[这篇文章](http://swtch.com/~rsc/regexp/regexp1.html)处理这个问题。如果您有时间，您可能想尝试在使用这些想法开发的 RE 引擎中运行您的表达式。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T09:35:45.157

绝对是指数行为。你的正则表达式有很多`d*`部分，当它到达一长串 d 时，它会疯狂地回溯，但无法更早地匹配某些东西。您需要重新考虑正则表达式，因此可以尝试的路径更少。

我特别认为：

```
([ef]d\*b|d\*)*</pre></code> and <code><pre>([ef]|([gh]d\*(ad\*[gh]d)\*b))d\*b 
```

可能需要重新考虑，因为他们会强制重试备用比赛。此外，它们在匹配方面也有重叠。例如，它们都与 edb 匹配，但如果一个失败并试图回溯另一部分，则可能会有相同的行为。

所以简而言之，`|`如果可以的话，尽量不要使用，并尽量确保模式不会重叠。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T09:56:54.017

感谢所有的回复，这些回复非常有帮助。最后，令人惊讶的是，它很容易加快速度。这是原始的正则表达式：

```
(([ef]|([gh]d*(ad*[gh]d)*b))d*b([ef]d*b|d*)*c) 
```

我注意到接近末尾的 |d* 并不是我真正需要的，所以我对其进行了如下修改：

```
(([ef]|([gh]d*(ad*[gh]d)*b))d*b([ef]d*bd*)*c) 
```

现在它几乎可以立即在 65,536 个字符串上运行。我想现在我只需要确保正则表达式真的匹配我需要它匹配的字符串......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T09:28:34.193

我认为您会经历所谓的“灾难性回溯”。

您的正则表达式有许多可选/替代部分，所有这些部分仍在尝试匹配，因此先前的子表达式在本地失败时将字符返回给以下表达式。这导致正则表达式中的来回行为和成倍增加的执行时间。

Python（2.7+？，我不确定）支持原子分组和所有格量词，您可以检查您的正则表达式以识别应该匹配或整体失败的部分。这样就可以控制不必要的回溯。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T09:31:19.553

灾难性的倒退！

> 正则表达式可能非常昂贵。某些（无意的和有意的）字符串可能会导致 RegEx 表现出指数行为。我们为此采取了几个修补程序。正则表达式非常方便，但开发人员确实需要了解它们是如何工作的；我们被他们咬了。

示例和调试器：

[http://www.codinghorror.com/blog/archives/000488.html](http://www.codinghorror.com/blog/archives/000488.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-16T09:24:38.600

你已经给自己答案了：正则表达式是复杂和模棱两可的。

您应该尝试找到一个更简单、更独特、更易于处理的表达式。或者告诉我们您想要完成什么，我们会尽力帮助您找到一个。

* * *

**编辑如果您只想像在对**[John Montgomery's answer](https://stackoverflow.com/questions/755332/can-anyone-help-with-this-problem-i-am-having-with-finditer-in-python/755378#755378)`d`的评论中所说的那样在每个位置   允许s ，则应在测试模式之前将其删除：

```
import re

string = "ddddddeddbedddbddddddddddddddddddddddddddddddddddd"
pattern = "(([ef]|([gh](a[gh])*b))b([ef]b)*c)"
matches = re.finditer(pattern, re.sub("d+", "", string))
for match in matches:
    print "(%d-%d): %s" % (match.start(), match.end(), match.group()) 
```

# apache-flex - 弹性写入文件

> ID：755342
> 
> 赞同：0
> 
> 时间：2009-04-16T09:19:04.183
> 
> 标签：apache-flex, file

我检查了 API，写文件只在 Flex Air 中。尽管如此，Flex 中是否还有一种方法可以在服务器或客户端计算机上写入文件？

更具体地说，这是因为我有一个字符串，我将通过 mx.utils.Base64Decoder 将其解码为文档。而且我需要在客户端直接用Word打开，或者写在服务器上，把链接返回给客户端下载。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T12:26:53.663

我正在做类似的事情——我在 Flex 中构建了一个自定义网格，其中包含一个额外的按钮，允许用户在 Excel 中打开数据。我通过在与我的 Flex 对话的服务器上用 PHP 编写一个函数来做到这一点。这将在服务器上创建 CSV 文件，并且该函数将链接传递回客户端，这反过来为用户提供了在 Excel 中打开数据的机会。

我正在使用 Zend 技术来实现这一点——我建议你看看；他们非常好。我曾经使用 Flex Data Services 和 Java 来做到这一点，但最近才切换到 PHP，因为开发时间因此大大缩短。

希望这可以帮助。

杰米。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T11:22:18.327

AIR 应用程序在用户的桌面上运行。它们允许您写入用户的桌面。没有什么能阻止 Flex/AIR 应用程序与服务器通信、在那里写入一些文件（使用合适的后端技术）并将链接返回给用户。

# xml - XML 默认命名空间问题

> ID：755346
> 
> 赞同：5
> 
> 时间：2009-04-16T09:20:22.403
> 
> 标签：xml, schema, namespaces

假设我有以下 XML 模式文件和以下 XML 文档文件。我有两个问题，

1.  由于 XML Schema 文件中没有指定目标名称空间，Information 元素将位于哪个名称空间中？

2.  在 XML 文档文件中，使用 Information 时，它属于哪个命名空间？请注意，在这种情况下，我没有从 XML 文档文件中引用 XML Schema 文件。

XML 架构文件：

```
<?xml version="1.0" encoding="utf-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
elementFormDefault="qualified">
<xs:element name="Information" type="xs:string"/>
</xs:schema> 
```

XML 文档文件：

```
<?xml version="1.0" encoding="utf-8"?>
<Information>Hello XML</Information> 
```

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-16T09:29:21.397

信息元素将不在命名空间中。要将其放入默认命名空间，您必须在标签中指定该命名空间。

```
<Information xmlns="http://www.mydefaultnamespace.com"> 
```

来自[Oracle 文章](http://www.oracle.com/technology/pub/articles/srivastava_namespaces.html)：

> 没有命名空间
> 
> 当范围内没有默认命名空间时，不存在命名空间。{default namespace} 是使用 xmlns 显式声明的名称空间。当 {default namespace} 根本没有使用 xmlns 声明时，说元素在 {default >namespace} 中是不正确的。在这种情况下，我们说元素在 {no namespace} 中。{no namespace} > 也适用于未声明已声明的 {default namespace} 的情况。

这是一个非常全面的命名空间资源：

[XML 命名空间常见问题解答](http://www.rpbourret.com/xml/NamespacesFAQ.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T10:29:54.647

你为什么要为没有目标定义一个模式？它没有任何意义。

# c++ - const_iterators 更快吗？

> ID：755347
> 
> 赞同：37
> 
> 时间：2009-04-16T09:20:54.150
> 
> 标签：c++, stl, iterator, const-iterator

我们的编码指南更喜欢`const_iterator`，因为它们比普通的要快一些`iterator`。似乎编译器在您使用`const_iterator`.

这真的正确吗？如果是，那么在内部真正发生了什么使`const_iterator`速度更快？

编辑：我写了一个小测试来检查`const_iterator`vs`iterator`并发现了不同的结果：

迭代 10,000 个对象所需`const_terator`的时间减少了几毫秒（大约 16 毫秒）。但**并非总是如此**。有一些迭代是相等的。

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-04-16T09:23:35.563

如果没有别的，a`const_iterator` *读起来*更好，因为它告诉任何阅读代码的人“我只是在迭代这个容器，而不是弄乱包含的对象”。

这是一个伟大的胜利，更不用说任何性能差异。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-04-16T11:02:43.133

我们使用的指导方针是：

*总是更喜欢 const 而不是非常量*

如果您倾向于使用 const 对象，那么您会习惯于仅对获得的对象使用常量操作，这与尽可能使用*const_iterator*一样多。

恒常具有*病毒*属性。一旦你开始使用它，它就会传播到你的所有代码。您的非变异方法变为常量，并且只需要对属性使用常量操作，并传递常量引用，这本身只强制执行常量操作......

对我来说，使用常量迭代器相对于非常量迭代器（如果有的话）的性能优势远不如代码本身的改进重要。意味着（设计）为非变异的操作*是*恒定的。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-04-16T20:13:32.423

它们适用于重要的容器/迭代器。养成正确的习惯，在重要的时候你就不会失去表现。

此外，无论如何，有几个原因更喜欢 const_iterator：

1.  const 的使用表达了代码意图（即只读，不改变这些对象）。
2.  使用 const(_iterator) 可以防止意外修改数据。（往上看）
3.  一些库使用缺少常量`begin()`来将数据标记为脏数据（即 OpenSG），并将其同步发送到其他线程/通过网络，因此它具有真正的性能影响。
4.  此外，允许您访问非常量成员函数可能会产生您不希望的副作用（与上述方式大致相同），例如从共享数据中分离写时复制容器。Qt 就是这样做的。

作为上述最后一点的示例，这里是 Qt 中 qmap.h 的摘录：

```
inline iterator begin() { detach(); return iterator(e->forward[0]); }
inline const_iterator begin() const { return const_iterator(e->forward[0]); } 
```

即使 iterator 和 const_iterator 实际上是等效的（除了`const`）， `detach()`如果有两个或更多对象使用它，也会创建数据的新副本。如果您只是要读取数据，这完全没用，您使用`const_iterator`.

当然，还有另一个方向的数据点：

1.  对于 STL 容器和许多简单复制语义容器，性能无关紧要。代码*是*等效的。但是，能够编写清晰的代码并避免错误会胜出。
2.  const 是病毒式的，因此如果您在 const 实现不佳（或根本没有）实现的遗留代码库中工作，您可能必须使用非 const 迭代器。
3.  显然，一些 C++0x 之前的 STL 存在一个错误，即 const_iterators 不能用于从容器中擦除（）元素。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-04-16T09:23:39.227

我不明白为什么会这样- constness 是编译时检查。但显而易见的答案是编写一个测试。

**编辑：**这是我的测试 - 它在我的机器上给出了相同的时间：

```
#include <vector>
#include <iostream>
#include <ctime>
using namespace std;;

int main() {
    vector <int> v;
    const int BIG = 10000000;
    for ( int i = 0; i < BIG; i++ ) {
        v.push_back( i );
    }
    cout << "begin\n";
    int n = 0;
    time_t now = time(0);
    for ( int a = 0; a < 10; a++ ) {
        for( vector <int>::iterator it = v.begin(); it != v.end(); ++it ) {
            n += *it;
        }
    }
    cout << time(0) - now << "\n";
    now = time(0);
    for ( int a = 0; a < 10; a++ ) {
        for( vector <int>::const_iterator cit = v.begin(); cit != v.end(); ++cit ) {
            n += *cit;
        }
    }
    cout << time(0) - now << "\n";;

    return n != 0;

} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-04-19T10:43:57.443

这取决于您使用的容器和实现。

是的，`const_iterator` *可能会*表现得更好。

对于某些容器，常量迭代器和可变迭代器的实现**可能不同**。我能想到的第一个例子是[SGI 的 STL 绳索容器](http://www.sgi.com/tech/stl/Rope.html)。可变迭代器具有指向父绳索的附加指针以支持更新。这意味着浪费了额外的资源用于引用计数更新 + 用于指向父绳索的指针的内存。请参阅[此处的实施说明](http://www.sgi.com/tech/stl/ropeimpl.html)。

但是，正如其他人所说，编译器不能单独使用`const`来进行优化。`const`只是授予对引用对象的只读访问权限，而不是说它是不可变的。对于像这样的容器`std::vector`，其迭代器通常实现为简单的指针，不会有任何区别。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-04-16T09:31:26.650

> 我们的编码指南说更喜欢 const_iterator

在这里查看 Scott Meyers 的这篇[文章](http://www.aristeia.com/Papers/CUJ_June_2001.pdf)。他解释了为什么人们应该更喜欢迭代器而不是 const_iterator。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-04-28T03:37:14.380

它们应该是相同的，因为 constness 是编译时检查。

为了向自己证明没有怪癖，我拿了 anon 的代码，修改为 use `clock_gettime`，添加了一个外部循环以避免缓存偏差，并运行了很多次。结果出人意料地不一致——上下波动了 20%（没有可用的空闲盒子）——但两者的**最短时间**几乎**相同**。`iterator``const_iterator`

 **然后我让我的编译器（GCC 4.5.2 -O3）生成**汇编输出**并直观地比较了两个循环：**相同**（除了几个寄存器加载的顺序颠倒了）

`iterator`环形

```
 call    clock_gettime
    movl    56(%esp), %esi
    movl    $10, %ecx
    movl    60(%esp), %edx
    .p2align 4,,7
    .p2align 3
.L35:
    cmpl    %esi, %edx
    je  .L33
    movl    %esi, %eax    .p2align 4,,7
    .p2align 3
.L34:
    addl    (%eax), %ebx
    addl    $4, %eax
    cmpl    %eax, %edx
    jne .L34
.L33:
    subl    $1, %ecx
    jne .L35
    leal    68(%esp), %edx
    movl    %edx, 4(%esp)
    leal    56(%esp), %esi
    movl    $1, (%esp) 
```

`const_iterator`环形：

```
 movl    60(%esp), %edx
    movl    $10, %ecx
    movl    56(%esp), %esi
    .p2align 4,,7
    .p2align 3
.L38:
    cmpl    %esi, %edx
    je  .L36
    movl    %esi, %eax
    .p2align 4,,7
    .p2align 3
.L37:
    addl    (%eax), %ebx
    addl    $4, %eax
    cmpl    %eax, %edx
    jne .L37
.L36:
    subl    $1, %ecx
    jne .L38
    leal    68(%esp), %edx
    movl    %edx, 4(%esp)
    leal    56(%esp), %esi
    movl    $1, (%esp) 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-04-28T03:03:03.427

当您对其中任何一个进行基准测试时，请确保使用适当的优化级别——使用“-O0”与“-O”等会得到截然不同的时序。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-16T09:23:24.953

`container<T>::const_iterator::operator*`返回 a`const T&`而不是`T&`，因此编译器可以对 const 对象进行通常的优化。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-16T11:57:31.347

与访问限制（公共、受保护、私有）一样，“常量”对程序员的好处多于它对优化的帮助。
由于许多原因（例如 const_cast、可变数据成员、指针/引用别名），编译器实际上无法针对涉及 const 的许多情况进行优化。不过，这里最相关的原因是，仅仅因为 const_iterator 不允许修改它所引用的数据，并不意味着不能通过其他方式更改该数据。如果编译器不能确定数据是只读的，那么它就不能真正优化比非常量迭代器情况更多的优化。
更多信息和示例可以在以下位置找到：[http://www.gotw.ca/gotw/081.htm](http://www.gotw.ca/gotw/081.htm)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-16T09:30:48.757

根据我的经验，编译器在使用 const 迭代器时不会进行任何可衡量的优化。尽管“它可以”的说法是正确的，并且引用未定义为标准中的指针。

但是，您可以对同一个对象有两个引用，因此一个可以是 const，一个可以是非常量。[然后，我猜这个线程中关于限制指针](https://stackoverflow.com/questions/457441/does-restrict-help-in-c-if-a-pointer-is-already-marked-const)的答案适用：编译器无法知道对象是被另一个线程改变了，还是被一些中断处理代码改变了。

# ruby - Ruby：在评估中引发的异常中不需要的上下文

> ID：755348
> 
> 赞同：1
> 
> 时间：2009-04-16T09:21:09.780
> 
> 标签：ruby, exception, eval

Ruby Exceptions 中直接引发的消息和从 evals 中引发的消息之间似乎存在奇怪的差异。例如，下面的代码：

```
def foo
 raise "Help!"
end

puts "\nRescue foo"
begin
 foo
rescue RuntimeError => e
 puts e.message
end

puts "\nRescue eval 'foo'"
begin
 eval "foo"
rescue RuntimeError => e
 puts e.message
end 
```

产生以下输出：

```
Rescue foo
Help!

Rescue eval 'foo'
./temp.rb:2:in `foo': Help! 
```

没有使用正则表达式将其分出，在第二种情况下，有什么方法可以在没有上下文的情况下引发异常？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T09:44:45.247

谢谢。无论如何，我都在定义自​​己的错误，所以这很容易解决。

我做了一点改动，所以超类也被初始化了：

```
class MyException < RuntimeError
  attr_accessor :my_message
  def initialize(m)
    @my_message = String.new(m)
    super
  end
end 
```

（似乎需要调用 String.new 来避免再次出现旧行为；大概 Exception.new 就地修改了消息。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T09:30:20.990

这很不寻常，我以前没有遇到过。我看不到说服 eval 不添加该信息的方法，因此要么执行您提到的正则表达式修改，要么您可以定义自己的错误类型：

```
class MyError < RuntimeError
  attr_accessor :my_message
  def initialize(m)
    @my_message = m.dup
    super
  end
end

def foo
 raise MyError.new("Help!")
end

puts "\nRescue eval 'foo'"
begin
 eval "foo"
rescue RuntimeError => e
 puts e.my_message
end 
```

带输出：

```
Rescue eval 'foo'
Help! 
```

在任何比简单脚本更大的东西中，定义自己的错误类型无论如何都是一种好习惯。

（更新以根据克里斯在他的回答中所说的修复代码）

# api - Crystal Reports API - 图表：“针对所有记录”还是“针对每条记录”？

> ID：755349
> 
> 赞同：2
> 
> 时间：2009-04-16T09:21:29.687
> 
> 标签：api, crystal-reports

有没有办法确定 Crystal Reports 2008 中的图表（使用 RAS SDK 或较旧的 RDC API）是否设置为显示“每条记录”或“所有记录”的值？

我可以访问一个`CrystalDecisions.ReportAppServer.ReportDefModel.ChartObject`但找不到任何 API 来访问它是哪种类型的图表 - “每个”或“所有”。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-23T00:36:42.147

我找不到任何类型的合适枚举搜索带有反射器的 .NET 库。我认为它会在 ChartDefinition 对象中的某个地方......也许它是由 datafields 集合暗示的......

祝你好运

# iphone - 在某个时间触发一个动作，有可能吗？

> ID：755359
> 
> 赞同：0
> 
> 时间：2009-04-16T09:26:06.430
> 
> 标签：iphone, timing

我只是在研究 iPhone 的开发，我想知道是否可以在某个时间触发一个动作？

根据我所阅读的内容，这似乎不是一个选项，因为不允许后台进程。这是真的？如果是这样，你们对替代品有什么想法吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T09:30:33.627

如果您的应用程序没有运行，那么不，目前不可能。

如果您的应用程序正在运行，您可以随时使用`NSTimer`.

此外，这里提到了一种手动触发方法，该方法涉及发送带有链接的电子邮件，这些链接会导致您的应用程序启动。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T09:35:11.430

您可以阅读这篇关于[推送通知服务的文章：Apple 在后台运行 iPhone 应用程序的解决方案](http://www.iphonehacks.com/2008/08/push-notificatn.html)，这可能会有所帮助。

# iphone - iTunes 商店 - iPhone App ... 可自定义背景？

> ID：755367
> 
> 赞同：3
> 
> 时间：2009-04-16T09:30:46.950
> 
> 标签：iphone, itunes

在 iTunes 中，一些 iPhone 应用程序有自己的背景图像屏幕.. 比如模拟城市

我不是在谈论“主屏幕截图/附加屏幕截图”或“512x512 大图标”

我说的是一些著名的 iPhone 应用程序在 iTunes Store 屏幕中出现的大屏幕标题屏幕......比如“Let's GOLF”..“Sim City”等。

如何为我自己的 iPhone 应用程序做同样的事情？:) 非常感谢您的阅读

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T10:12:25.733

你不能。Apple 只允许选定的开发人员拥有自定义页面。

# c++ - 衍生进程失效

> ID：755372
> 
> 赞同：0
> 
> 时间：2009-04-16T09:31:48.180
> 
> 标签：c++, spawning

我使用 posix_spawnp 从我的主进程中生成子进程。

```
 int iRet = posix_spawnp(&iPID, zPath, NULL, NULL, argv, environ);   

    if (iRet != 0)
    {       
        return false;
    } 
```

有时，子进程在没有错误的情况下生成后，它会突然失效。这怎么可能发生？

我使用信号处理程序来获取子进程：

```
void SigCatcher(int n)
{       
    while(waitpid( -1, NULL, WNOHANG ) > 0);        
} 
```

每当我杀死一个子进程时，我都会手动调用它。

```
 kill(oProcID, SIGKILL);

    signal (SIGCHLD, SigCatcher); 
```

这会导致产卵的孩子不复存在（没有我打电话给杀戮）吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T09:38:44.527

这：

```
kill(oProcID, SIGKILL);

signal (SIGCHLD, SigCatcher); 
```

看起来像一个[比赛条件](http://en.wikipedia.org/wiki/Race_condition)。您需要在终止子进程之前安装信号处理程序，否则您可能会丢失信号。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T09:44:43.123

你有没有打电话：

```
signal(SIGCHLD, SigCatcher); 
```

其他地方？

如果您还没有，那么您需要在任何子进程甚至生成之前执行此操作，以确保这些子进程在它们终止时被收割。

正如 Unwind 指出的那样，您当前对`kill`和的调用`signal`是错误的。

典型用途是：

```
signal(SIGCHLD, handler);
posix_spawnp(...);
...
// do other stuff
...
kill(pid, SIGKILL); 
```

# cakephp - Cakephp Tagging - 自动保存新标签和标签关系

> ID：755380
> 
> 赞同：2
> 
> 时间：2009-04-16T09:36:52.427
> 
> 标签：cakephp, tags, tagging, has-and-belongs-to-many

我在 CakePHP 中阅读了很多关于标记的信息，但我找不到一种“干净”的方式来保存帖子和该帖子的标签。我拥有所有必需的 Post 表、模型和控制器、标签表、模型和控制器以及 posts_tags 表。我在帖子和标签模型中创建了 HABTM 关联。

如果我想保存一个新帖子，我希望 CakePHP 自动保存与该帖子关联的标签，但我找不到正确的方法。在大多数教程中，您必须使用“帮助”函数（[http://www.jamesfairhurst.co.uk/posts/view/full_cakephp_application_part_5](http://www.jamesfairhurst.co.uk/posts/view/full_cakephp_application_part_5) =>“_parse_genres”）或类似的东西，但我认为与 CakePHP 的交易是吗，一旦您正确设置，这一切都是由 Cake 完成的。

所以我的问题是，是否有一种“干净”的蛋糕方式来做到这一点，还是我必须使用辅助功能？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T13:51:11.777

我很难相信您没有找到处理 HABTM 的“正确”方法。有很多很多关于它的文章。我相信如果您正确设置数据数组，Cake*会保存您的标签。*快速搜索 The Bakery：

[http://bakery.cakephp.org/articles/search/3/HABTM](http://bakery.cakephp.org/articles/search/3/HABTM)

会暴露足够的。我的猜测是你正在寻找这个：

[http://bakery.cakephp.org/articles/view/simple-tagging-behavior](http://bakery.cakephp.org/articles/view/simple-tagging-behavior)

（请注意，有一个组件做同样的事情，但模型行为是正确的方法）

# visual-studio - 我想删除所有 bin 和 obj 文件夹以强制所有项目重建所有内容

> ID：755382
> 
> 赞同：359
> 
> 时间：2009-04-16T09:37:50.410
> 
> 标签：visual-studio, visual-studio-2008, batch-file, cmd

我处理多个项目，我想递归地删除所有名为“bin”或“obj”的文件夹，这样我确信所有项目都会重建所有内容（有时这是迫使 Visual Studio 忘记所有关于以前的构建）。

有没有一种快速的方法来完成这个（例如使用 .bat 文件）而无需编写 .NET 程序？

* * *

## 回答 #1

> 赞同：567
> 
> 时间：2009-04-16T09:54:45.270

这取决于您喜欢使用的外壳。

如果您在 Windows 上使用 cmd shell，那么以下应该可以工作：

```
FOR /F "tokens=*" %%G IN ('DIR /B /AD /S bin') DO RMDIR /S /Q "%%G"
FOR /F "tokens=*" %%G IN ('DIR /B /AD /S obj') DO RMDIR /S /Q "%%G" 
```

如果您使用的是 bash 或 zsh 类型的 shell（例如 Windows 或大多数 Linux / OS X shell 上的 git bash 或 babun），那么这是一种更好、更简洁的方式来执行您想要的操作：

```
find . -iname "bin" | xargs rm -rf
find . -iname "obj" | xargs rm -rf 
```

这可以用 OR 简化为一行：

```
find . -iname "bin" -o -iname "obj" | xargs rm -rf 
```

请注意，如果您的文件名目录包含空格或引号， find 将按原样发送这些条目，xargs 可能会拆分为多个条目。如果你的 shell 支持它们，`-print0`并且`-0`会解决这个缺点，那么上面的例子就变成了：

```
find . -iname "bin" -print0 | xargs -0 rm -rf
find . -iname "obj" -print0 | xargs -0 rm -rf 
```

和：

```
find . -iname "bin" -o -iname "obj" -print0 | xargs -0 rm -rf 
```

如果您使用的是 Powershell，那么您可以使用它：

```
Get-ChildItem .\ -include bin,obj -Recurse | foreach ($_) { remove-item $_.fullname -Force -Recurse } 
```

如[下面罗伯特 H 的回答所示](https://stackoverflow.com/a/5924807/542251)- 如果您选择对任何内容进行投票，请确保您将 powershell 答案归功于他而不是我 :)

当然，明智的做法是先在安全的地方运行您选择的任何命令来测试它！

* * *

## 回答 #2

> 赞同：363
> 
> 时间：2011-05-08T00:01:46.987

我找到了这个线程并得到了宾果游戏。多一点搜索发现了这个强大的 shell 脚本：

```
Get-ChildItem .\ -include bin,obj -Recurse | ForEach-Object ($_) { Remove-Item $_.FullName -Force -Recurse } 
```

考虑到我在看这里时没有找到答案，我想我会分享。

* * *

## 回答 #3

> 赞同：84
> 
> 时间：2011-08-23T19:00:26.353

这对我有用：

```
for /d /r . %%d in (bin,obj) do @if exist "%%d" rd /s/q "%%d" 
```

基于superuser.com上的[这个答案](https://superuser.com/questions/201888/how-to-create-batch-file-that-delete-all-the-folders-named-bin-or-obj-recursi/201892#201892)

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2009-06-23T15:43:00.717

我过去总是在我的解决方案中添加一个新目标来实现这一目标。

```
<Target Name="clean_folders">
  <RemoveDir Directories=".\ProjectName\bin" />
  <RemoveDir Directories=".\ProjectName\obj" />
  <RemoveDir Directories="$(ProjectVarName)\bin" />
  <RemoveDir Directories="$(ProjectVarName)\obj" />
</Target> 
```

你可以从命令行调用它

```
msbuild /t:clean_folders 
```

这可以是您的批处理文件。

```
msbuild /t:clean_folders
PAUSE 
```

* * *

## 回答 #5

> 赞同：34
> 
> 时间：2012-01-24T13:55:01.240

我写[了一个powershell脚本](https://github.com/doblak/ps-clean)来做到这一点。

优点是它会打印出已删除文件夹的摘要，如果您指定了要忽略的任何子文件夹层次结构，则会打印出忽略的文件夹。

![输出示例](https://i.stack.imgur.com/60MpJ.png)

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2014-11-04T17:46:38.130

没有什么对我有用。我需要删除 bin 和 obj 文件夹中的所有文件以进行调试和发布。我的解决方案：

1.右键项目，卸载，再次右键编辑，到底部

2.插入

```
<Target Name="DeleteBinObjFolders" BeforeTargets="Clean">
  <RemoveDir Directories="..\..\Publish" />
  <RemoveDir Directories=".\bin" />
  <RemoveDir Directories="$(BaseIntermediateOutputPath)" />
</Target> 
```

3.保存，重新加载项目，右键clean and presto。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2014-03-14T09:32:03.887

注意：这是一个旧答案，可能需要对 VS 2019 的较新版本和一些 obj 工件进行调整。在使用这种方法之前，请确保 VS 在您的目标和输出目录中不需要任何东西来成功构建。

在干净的目标之后，这样的事情应该以一种非常优雅的方式完成：

```
<Target Name="RemoveObjAndBin" AfterTargets="Clean">
    <RemoveDir Directories="$(BaseIntermediateOutputPath)" />
    <RemoveDir Directories="$(TargetDir)" />
</Target> 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2019-02-28T21:46:18.223

一种非常快速且轻松的方法是使用`rimraf`npm 实用程序，首先在全局范围内安装它：

```
> npm i rimraf -g 
```

然后来自项目根目录的命令非常简单（可以保存到脚本文件中）：

```
projectRoot> rimraf **/bin **/obj 
```

要优化所需的效果，您可以利用文档中指定的项目事件目标（您可以使用的是`BeforeRebuild`并使其运行上一个命令）：[https ://docs.microsoft.com/en-us/visualstudio/ msbuild/how-to-extend-the-visual-studio-build-process?view=vs-2017](https://docs.microsoft.com/en-us/visualstudio/msbuild/how-to-extend-the-visual-studio-build-process?view=vs-2017)

我喜欢 rimraf 实用程序，因为它是跨平台的并且非常快。但是，`RemoveDir`如果您决定使用目标事件选项，也可以使用 .csproj 中的命令。`RemoveDir`@Shaman 在另一个答案中很好地解释了这种方法： [https ://stackoverflow.com/a/22306653/1534753](https://stackoverflow.com/a/22306653/1534753)

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2014-03-10T17:07:56.623

要在构建添加到项目文件之前删除 bin 和 obj：

```
<Target Name="BeforeBuild">
    <!-- Remove obj folder -->
    <RemoveDir Directories="$(BaseIntermediateOutputPath)" />
    <!-- Remove bin folder -->
    <RemoveDir Directories="$(BaseOutputPath)" />
</Target> 
```

这是文章：[如何在构建或部署之前删除 bin 和/或 obj 文件夹](http://kitsula.com/Article/How-to-remove-bin-obj-folder-before-build-deploy)

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2017-03-13T11:33:25.247

非常类似于 Steve 的 PowerShell 脚本。我刚刚添加了 TestResults 和包，因为大多数项目都需要它。

```
Get-ChildItem .\ -include bin,obj,packages,TestResults -Recurse | foreach ($_) { remove-item $_.fullname -Force -Recurse } 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2018-03-19T06:51:10.737

这是我用于递归删除所有 BIN 和 OBJ 文件夹的批处理文件。

1.  创建一个空文件并将其命名为*DeleteBinObjFolders.bat*
2.  将以下代码复制粘贴到*DeleteBinObjFolders.bat*
3.  将*DeleteBinObjFolders.bat*文件移动到与您的解决方案 (*.sln) 文件相同的文件夹中。

```
@echo off
@echo Deleting all BIN and OBJ folders...
for /d /r . %%d in (bin,obj) do @if exist "%%d" rd /s/q "%%d"
@echo BIN and OBJ folders successfully deleted :) Close the window.
pause > nul 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2013-08-19T15:10:12.090

[这是](https://stackoverflow.com/a/12206011/25812)我对类似问题给出的答案，简单、容易、效果很好，除了 Visual Studio 已有的功能外，不需要其他任何东西。

正如其他人已经响应的那样，Clean 将删除构建生成的所有工件。但它会留下其他一切。

如果您在 MSBuild 项目中有一些自定义，这可能会带来麻烦并留下您认为应该删除的东西。

您可以通过在 .*proj 靠近末尾的某处添加一个简单的更改来规避此问题：

```
<Target Name="SpicNSpan"
        AfterTargets="Clean">
    <RemoveDir Directories="$(OUTDIR)"/>
</Target> 
```

这将删除当前平台/配置的 bin 文件夹中的所有内容。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2013-06-04T19:12:41.643

从[使用 Windows PowerShell 删除 obj、bin 和 ReSharper 文件夹](http://blog.smoura.com/using-windows-powershell-to-remove-obj-bin-and-resharper-folders/)

[与Robert H 的答案](https://stackoverflow.com/a/5924807/184572)非常相似，语法更短

1.  运行powershell
2.  **cd**（更改目录）到项目文件夹的根目录
3.  粘贴并在脚本下面运行

    **dir .\ -include bin,obj, *resharper* -recurse | foreach($* ) { rd $_.fullname –Recurse –Force}**

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2013-02-06T12:37:01.317

看看[CleanProject](http://wf.codeplex.com/wikipage?title=Clean%20Project%20Overview)，它将删除 bin 文件夹、obj 文件夹、TestResults 文件夹和 Resharper 文件夹。源代码也可用。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2019-02-04T14:29:56.617

我使用[Robert H](https://stackoverflow.com/a/5924807/6891713)的轻微修改，跳过错误并打印删除文件。我通常也清除`.vs`,`_resharper`和`package`文件夹：

```
Get-ChildItem -include bin,obj,packages,'_ReSharper.Caches','.vs' -Force -Recurse | foreach ($_) { remove-item $_.fullname -Force -Recurse -ErrorAction SilentlyContinue -Verbose} 
```

另外值得注意的是`git`清除所有更改（包括被忽略的文件和目录）的命令：

```
git clean -dfx 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-04-16T12:56:04.560

I actually hate obj files littering the source trees. I usually setup projects so that they output obj files outside source tree. For C# projects I usually use

```
 <IntermediateOutputPath>..\..\obj\$(AssemblyName)\$(Configuration)\</IntermediateOutputPath> 
```

For C++ projects

```
 IntermediateDirectory="..\..\obj\$(ProjectName)\$(ConfigurationName)" 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-06-23T15:39:26.013

[http://vsclean.codeplex.com/](http://vsclean.codeplex.com/)

> 查找 Visual Studio 解决方案并在其上运行 Clean 命令的命令行工具。这使您可以清理硬盘上所有旧项目的 /bin/* 目录

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-04-16T10:16:50.263

On our build server, we explicitly delete the bin and obj directories, via nant scripts.

Each project build script is responsible for it's output/temp directories. Works nicely that way. So when we change a project and add a new one, we base the script off a working script, and you notice the delete stage and take care of it.

If you doing it on you logic development machine, I'd stick to clean via Visual Studio as others have mentioned.

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-04-16T09:39:21.233

“干净”还不够好吗？请注意，您可以从命令行使用 /t:clean 调用 msbuild。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2012-03-30T19:52:30.927

您实际上可以进一步考虑 PS 建议，并在项目目录中创建一个 vbs 文件，如下所示：

```
Option Explicit
Dim oShell, appCmd
Set oShell  = CreateObject("WScript.Shell")
appCmd      = "powershell -noexit Get-ChildItem .\ -include bin,obj -Recurse | foreach ($_) { remove-item $_.fullname -Force -Recurse -WhatIf }"
oShell.Run appCmd, 4, false 
```

为了安全起见，我已经包含了 -WhatIf 参数，因此如果您对第一次运行的列表感到满意，请将其删除。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2021-11-03T11:29:15.950

上面的几个解决方案给出了如何排除文件夹的答案，但不是在 cmd 中。扩展[史蒂夫威尔科克的答案](https://stackoverflow.com/a/755433/10200388)，排除例如`node_modules`其中可能包含`bin`文件夹的文件夹，可以使用下面的扩展单行。

```
FOR /F "tokens=*" %G IN ('DIR /B /AD /S bin obj ^|find ^"node_modules^" /v /i') DO RMDIR /S /Q "%G" 
```

正如其他人所指出的，如果将上述命令放在 cmd 脚本中而不是直接在命令行中使用它，请替换`%G`为`%%G`.

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2021-10-21T09:00:11.470

这`VS 2019`是唯一明智的解决方案。

在解决方案文件夹（`.sln`文件所在的位置）中，创建一个名为`Directory.Build.props`并添加编辑它的文件，如下所示。[在此处](https://docs.microsoft.com/en-us/visualstudio/msbuild/customize-your-build?view=vs-2019)阅读有关此特殊文件的信息。

## 目录.Build.props

```
<Project>
  <Target Name="RemoveObjAndBinFolders" AfterTargets="Clean">
    <PropertyGroup>
      <!-- Microsoft.NET.Sdk.Web sets $(BaseIntermediateOutputPath) to -->
      <!-- an absolute path. Possibly fixed in MsBuild 16.6? -->
      <BaseIntermediateOutputPathFix>$([MSBuild]::MakeRelative(
        $(ProjectDir),
        $(BaseIntermediateOutputPath)
      ))</BaseIntermediateOutputPathFix>

      <ObjFolder>$(ProjectDir)$(BaseIntermediateOutputPathFix)</ObjFolder>
      <BinFolder>$(ProjectDir)$(BaseOutputPath)</BinFolder>
    </PropertyGroup>

    <ItemGroup>
      <ObjFiles Include="$(ObjFolder)/*.*"
                Exclude="$(ObjFolder)/project.assets.json" />
      <ObjSubFolders
                Include="$([System.IO.Directory]::GetDirectories('$(ObjFolder)'))" />
    </ItemGroup>

    <!-- Remove "obj" sub folders -->
    <RemoveDir Directories="@(ObjSubFolders)" ContinueOnError="true" />
    <!-- Remove "obj" files (keeping necessary asset file)-->
    <Delete Files="@(ObjFiles)" />

    <!-- Remove "bin" folders -->
    <RemoveDir Directories="$(BinFolder)" ContinueOnError="true" />
  </Target>
</Project> 
```

无需修改一堆`.csproj`文件。另外，请注意，我**没有**`$(TargetDir)`像某些人建议的那样删除。`$(OutDir)`如果已将构建系统设置为某个自定义目录（这是常见的做法），这样做可能会削弱构建系统。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-04-16T13:20:59.277

我们有一个包含许多项目文件的大型 .SLN 文件。我开始制定所有非源代码控制文件所在的“ViewLocal”目录的策略。该目录内部是一个“Inter”和一个“Out”目录。分别用于中间文件和输出文件。

这显然可以很容易地转到您的“viewlocal”目录并进行简单的删除，以摆脱一切。

在你花时间想办法用脚本解决这个问题之前，你可能会考虑设置类似的东西。

不过我不会撒谎，事实证明，在大型组织中维持这样的设置……很有趣。尤其是当您使用像 QT 这样的技术来处理文件和创建非源代码控制的源文件时。但那是另一个故事了！

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-12-12T10:09:45.040

我使用带有这个逗号的 .bat 文件来做到这一点。

```
for /f %%F in ('dir /b /ad /s ^| findstr /iles "Bin"') do RMDIR /s /q "%%F"
for /f %%F in ('dir /b /ad /s ^| findstr /iles "Obj"') do RMDIR /s /q "%%F" 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2016-05-16T13:04:14.227

考虑到 PS1 文件存在于 currentFolder 中（您需要在其中删除 bin 和 obj 文件夹的文件夹）

```
$currentPath = $MyInvocation.MyCommand.Path
$currentFolder = Split-Path $currentPath

Get-ChildItem $currentFolder -include bin,obj -Recurse | foreach ($_) { remove-item $_.fullname -Force -Recurse } 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2019-06-04T06:25:43.903

This Works Fine For Me: start for /d /r . %%d in (bin,obj, ClientBin,Generated_Code) do @if exist "%%d" rd /s /q "%%d"

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2019-01-07T06:08:01.567

对于批量解决方案。我正在使用以下命令：

`FOR /D /R %%G in (obj,bin) DO @IF EXIST %%G IF %%~aG geq d RMDIR /S /Q "%%G"`

* * *

不使用的原因`DIR /S /AD /B xxx`
1.`DIR /S /AD /B obj`将返回空列表（至少在我的 Windows10 上） 2.将包含不期望的结果（tobj 文件夹） [![在此处输入图像描述](https://i.stack.imgur.com/knj0w.png)](https://i.stack.imgur.com/knj0w.png)
`DIR /S /AD /B *obj`[![在此处输入图像描述](https://i.stack.imgur.com/cU5a8.png)](https://i.stack.imgur.com/cU5a8.png)

* * *

## 回答 #28

> 赞同：-2
> 
> 时间：2009-04-16T09:40:20.310

我认为您可以右键单击您的解决方案/项目，然后单击“清理”按钮。

*据我记得它是这样工作的。我现在没有 VS.NET，所以无法测试它。*

# asp.net - ASP.NET 元：资源键

> ID：755384
> 
> 赞同：39
> 
> 时间：2009-04-16T09:37:54.590
> 
> 标签：asp.net, webforms

我正在查看一个 ASP.NET 应用程序，它大量使用 meta:resourcekey，它似乎连接到 resx 文件。

这是一个似乎完全从我身边经过的领域。有人对这种方法和最佳实践的好处和目的有任何指导吗？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-04-16T09:53:22.743

该`meta:resourcekey`语法允许您对隐式资源表达式使用声明性语法。这在本地化站点以供国际使用时使用。正如快速入门（链接如下）所解释的，这些类型的表达式链接到位于 App_LocalResources 文件夹中的 .resx 文件。

这种表达式的好处是它可以为单个控件使用多个属性，这些属性在 .resx 文件中定义，而不是 ASPX 本身。

例如，使用下面的标签：

```
<asp:Label ID="myLabel" runat="server" Text="This text is localizable" meta:resourcekey="myLabelResource1">
</asp:Label> 
```

此页面的 resx 文件可能包含附加到标签的多个属性的数据，例如：

```
 <data name="myLabelResource1.Font-Name">
    <value xml:space="preserve">Default Font name</value>
  </data>
  <data name="myLabelResource1.Text">
    <value xml:space="preserve">Text in default language.</value>
  </data>
  <data name="myLabelResource1.ToolTip">
    <value>Tooltip in default language.</value>
  </data> 
```

如果您想了解这个概念[，ASP.NET 快速入门提供了很好的入门知识。](http://quickstarts.asp.net/QuickStartv20/aspnet/doc/localization/localization.aspx#expressions)

# javascript - Javascript变量传递

> ID：755389
> 
> 赞同：3
> 
> 时间：2009-04-16T09:40:16.350
> 
> 标签：javascript, variables

谁能帮我完成我的项目？我将如何在 javascript 中调用文本字段的详细信息？

```
function AddPushpin()
{
    var shape = new VEShape(VEShapeType.Pushpin, map.GetCenter());
    shape.SetTitle(**//it should be coming from a textfield//**);
    shape.SetDescription('This is shape number '+pinid);
    pinid++;
    map.AddShape(shape);
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T09:43:33.470

document.getElementById('myTextElementsId').value

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T09:44:40.520

```
<textfield id="shapeTitle"></textfield>

---- // -----

document.getElementById('shapeTitle').value 
```

其中“shapeTitle”应对应于您需要其值的元素的 ID。

# .net - 在自定义控件中分组属性

> ID：755391
> 
> 赞同：4
> 
> 时间：2009-04-16T09:40:45.163
> 
> 标签：.net, vb.net, custom-controls

在我们的 IDE（例如 Visual Studio）中，如果我们显示 System.Windows.Forms.Button 控件的属性，我们会看到一些属性公开了另一组属性。例如：*平面外观、字体、位置、边距*等。

我想在自定义控件中做类似的事情。

**我知道后面的代码是错误的**，但这是我正在尝试做的一个例子：

```
Public Class StateOfMyCustomControl

    Public Enum EnumVisibility
        Visible
        NonVisible
    End Enum

    Public Enum EnumEventManagement
        Automatic
        Manual
    End Enum

    Private mAssociatedControl As MyCustomControl
    Private mVisibility As EnumVisibility
    Private mEventManagement As EnumEventManagement

    Public Sub New(ByVal AssociatedControl As MyCustomControl)
        mAssociatedControl = AssociatedControl
    End Sub

    Public Property Visibility() As EnumVisibility
        Get
            Return mVisibility
        End Get
        Set(ByVal value As EnumVisibility)

            mVisibility = value

            mAssociatedControl.Visible = False
            If mVisibility = EnumVisibility.Visible Then
                mAssociatedControl.Visible = True
            End If

        End Set
    End Property

    Public Property EventManagement() As EnumEventManagement
        Get
            Return mEventManagement
        End Get
        Set(ByVal value As EnumEventManagement)
            mEventManagement = value
        End Set
    End Property

End Class

Public Class MyCustomControl

    ' ...

    Private mState As StateOfMyCustomControl

    Public Sub New()
        mState = New StateOfMyCustomControl(Me)
    End Sub

    Public Property State() As StateOfMyCustomControl
        Get
            Return mState
        End Get
        Set(ByVal value As StateOfMyCustomControl)
            mState = value
        End Set
    End Property

    ' ...

End Class 
```

在我的 IDE 中，在我的自定义控件的属性窗口中，我想查看我的属性*State*，并可以显示它以设置属性*Visibility*和*EventManagement*。

非常感谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T10:27:56.867

您需要告诉它使用`ExpandableObjectConverter`（或自定义转换器）用于`StateOfMyCustomControl`. 在 C# 中，这是：

```
[TypeConverter(typeof(ExpandableObjectConverter))]
public class StateOfMyCustomControl {...} 
```

但是，您在 VB 中应用属性，请执行此操作；-p

可能：

```
<TypeConverter(GetType(ExpandableObjectConverter))> _
Public Class StateOfMyCustomControl
... 
```

# flash - 为什么 setMask 不工作是这个例子在它工作一次之后

> ID：755394
> 
> 赞同：0
> 
> 时间：2009-04-16T09:42:27.403
> 
> 标签：flash, actionscript, actionscript-2

我正在尝试使用 setMask 在 AS2 (CS3) 中创建 3 个蒙面电影剪辑的“窗口”。

主窗口被很好地掩盖了。

单击一个按钮后，我正在创建两个额外的窗口，但是拒绝被遮罩没有错误，只是没有应用遮罩，并且遮罩矩形仍然可见。

所有 3 个窗口都使用相同的函数进行屏蔽，但 MC 参数不同。

我有嵌套的 MC，但基本上，主窗口被屏蔽为：

```
_level0.GUI.OBJ.mainWinMC.mainWindowMC.mainWindow.setMask(_level0.GUI.OBJ.mainWinMC.mainWindowMC.mainWindow_PlanMask); 
```

其中`mainWindow_PlanMask`包含一个带有红色矩形的 MC。（注意：我正在使用 MovieClip 变量，并在此处发布了他们的电影剪辑跟踪路径。这很好用。

按下按钮后，我又设置了两个掩码：

```
_level0.GUI.OBJ.mainWinMC.side0MC.side0.setMask(_level0.GUI.OBJ.mainWinMC.side0MC.side0_PlanMask);

_level0.GUI.OBJ.mainWinMC.side1MC.side1.setMask(_level0.GUI.OBJ.mainWinMC.side1MC.side1_PlanMask); 
```

`side0_PlanMask and side1_PlanMask`也包含矩形。但在这些情况下，红色矩形保持可见并且不应用蒙版。我不知道为什么。任何帮助将不胜感激。

[编辑] 将 cacheAsBitmap 所有 MC 从 mask 和 masked MC 应用到 _root 导致第一个 mask 操作无法正常工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T10:07:34.857

Flash 中的蒙版可能无法预测。尝试将所有内容的 cacheAsBitmap 设置为 true。

更新：

对于从 _root 向下的每个影片剪辑，尝试将 cacheAsBitmap 设置为 true。尝试将所有字体嵌入到您要屏蔽的影片剪辑内的任何文本字段中 - 事实上，请确保您已将所有字体嵌入到任何地方。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T10:18:03.660

提供的信息很难帮助您调试

你可以试试：

1.  确保您使用不正确的实例名称正确命名了影片剪辑（有时您会发现忘记命名某些影片剪辑）

2.  打开一个新的 fla 并为您想要做的事情制作一个更简单的版本，以便您可以隔离错误。

顺便说一句，不是真的必要，但尝试使用 _root 而不是 _level0，它会更清楚。

# xml - 在xml中使用嵌入标签

> ID：755395
> 
> 赞同：1
> 
> 时间：2009-04-16T09:42:45.967
> 
> 标签：xml

我对 xml 非常陌生。我正在开发一个使用 xml 文件的应用程序。我在 Google 的帮助下创建了这个文件。我的示例 xml 文件是：

```
<?xml version="1.0"?>
<gamelist>
 <game>
  <title>Driver</title>
  <code><EMBED src="http://www.pnflashgames.com/modules/pnFlashGames/games/racer.swf"></EMBED></code>
  <rating>4</rating>
 </game>
 <game>
  <title>ConeCrazy</title>
  <code><EMBED     src="http://www.pnflashgames.com/modules/pnFlashGames/games/ConeCrazy.swf"></EMBED></code>
  <rating>3</rating>
 </game>
</gamelist> 
```

在上面的文件代码元素中有嵌入标签。对于我的应用程序，我需要将标签嵌入为字符串。在代码元素中，如果我使用任何字符串而不是嵌入标签，我可以读取该字符串。如果我使用嵌入标签，我会收到如下错误：

> **[致命错误] gamelist.xml:5:103：对实体“pn_uname”的引用必须以“;”结尾 分隔符。**

我正在使用 Java 读取 xml 文件。在我的 Java 类中，我希望将整个 embed 标记作为字符串。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T10:10:39.420

我想您不是使用合适的工具（DOM API）生成 XML，而是通过连接字符串。

如果进一步假设您在问题中显示的 XML 不是触发错误的 XML。

我认为你有这样的事情：

```
<EMBED src="http://foo/bar/racer.swf?bla&pn_uname=baz"></EMBED> 
```

这将触发一条错误消息，指出字符实体“pn_uname”的格式不正确。

表达上述内容的正确方法是：

```
<EMBED src="http://foo/bar/racer.swf?bla&amp;pn_uname=baz"></EMBED> 
```

...这就是使用 API 生成 XML 会自动为您处理的事情。避免字符串连接以生成 XML。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T10:10:56.797

要将 html 代码作为值放入 XML 元素中，您必须对其进行编码：

```
<?xml version="1.0"?>
<gamelist>
 <game>
  <title>Driver</title>
  <code>&lt;EMBED src=&quot;http://www.pnflashgames.com/modules/pnFlashGames/games/racer.swf&quot;&gt;&lt;/EMBED&gt;</code>
  <rating>4</rating>
 </game>
 <game>
  <title>ConeCrazy</title>
  <code>&lt;EMBED src=&quot;http://www.pnflashgames.com/modules/pnFlashGames/games/ConeCrazy.swf&quot;&gt;&lt;/EMBED&gt;</code>
  <rating>3</rating>
 </game>
</gamelist> 
```

列表：[XML 中的实体](http://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Predefined_entities_in_XML)

# batch-processing - 使用自动热键脚本将 cmd.exe IDE 的内容提取到文本文件

> ID：755397
> 
> 赞同：1
> 
> 时间：2009-04-16T09:43:13.220
> 
> 标签：batch-processing, autohotkey

我正在尝试使用自动热键脚本将 cmd.exe IDE 的内容提取到文本文件中，即一个 test.ahk，其编写如下所示：

```
 WinGetText, text, "C:\WINDOWS\system32\cmd.exe"
 FileAppend, %text%, C:\ThreePartition\ACTUAL.txt 
```

我无法提取内容。谁能建议正确的提取方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T10:15:01.767

> The text retrieved is generally the same as what Window Spy shows for that window.

The Window Spy shows no text elements for CMD windows - what you see is not necessarily what you can get :)

What you can do is to simulate the Select All and Paste commands, and then use the clipboard contents.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T11:09:27.673

我不相信您可以在不以某种方式使用 DllCall 直接读取进程内存的情况下提取 cmd 窗口的内容。

如果您只想要 Grep 或 AWK 等 CLI 命令的输出，则通过 run 命令使用 stdout 应该可以。不过老实说，我不再依赖 AHK，因为这种东西太笨重了。

[http://www.autohotkey.com/docs/commands/Run.htm](http://www.autohotkey.com/docs/commands/Run.htm)。

**编辑评论：** 您想要的是可行的，但解决方案完全取决于您的 IDE 的工作方式。它有什么行为是构建项目所独有的？如果它生成临时文件，您可以使用 AHK 子例程重载“构建”按钮，该子例程监视这些文件的存在，然后检查输出可执行文件的修改日期以查看构建是否成功。如果 IDE 在构建时更改其窗口标题，则同样的解决方案也有效。聪明点。:)

否则，您可能必须安装消息挂钩。

# unmanagedresources - 非托管 dll 代码

> ID：755411
> 
> 赞同：3
> 
> 时间：2009-04-16T09:46:29.797
> 
> 标签：unmanagedresources

我有一个使用 C/C++ 编写的非托管 32 位库的 C#（.NET 3.5，VS2005 Professional）应用程序。我使用的 API 是这样的：

无效*初始化（int x）；

语音GetData（无效*）；

当我在 Windows XP 32bit 上运行它时，这有效，但在 Windows XP64bit 上它会抛出异常：

未处理的异常：System.Reflection.TargetInvocationException：调用的目标已引发异常。---> System.BadImageFormatException：尝试加载格式不正确的程序。（HRESULT 异常：0x8007000B）在 Aktuelizator.CommonLibrary.InitializeRingBuffer(Int32 dim) 在 Aktuelizator.AktuelizatorWService.AktuelizatorWS..ctor()

当从 32 位调用时，这些非托管 DLL 在 64 位 XP 下的工作取消管理 C/C++ 中的应用程序 writetn。

有人有什么主意吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T10:41:43.497

您的构建配置平台设置为“任何 CPU”，这意味着在 64 位操作系统上它以 64 位运行，您无法加载 dll。将其设置为 x86，这将强制它以 32 位运行，无论操作系统如何，您的 dll 都可以正常加载。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T10:17:18.593

It sounds like your DLL is only compiled to 32 bit, but you try to call it from both a 32 bit and 64 bit process. The former will work, of course. The later, however, won't. 32 bit DLLs can only be used in 32 bit processes. Try compiling the DLL to a 64 bit target and let the C# app use that one.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T10:28:15.213

检查所有定义为 Int32 的参数，实际上应该是 IntPtr。

# grails - Grails 的 JasperReports 插件：获取“没有此类报告规范”异常

> ID：755420
> 
> 赞同：1
> 
> 时间：2009-04-16T09:48:48.153
> 
> 标签：grails, groovy, jasper-reports, jasper-plugin

我正在测试 Grails 的 jaspergrails 插件。我正在关注这个插件的教程。我创建了一个简单的碧玉报告，并将其放在 web-app\plugins\jasper-0.9.5\reports\all-races.jasper 下

我遇到了一个例外

**错误 500：java.lang.Exception：没有这样的报告规范：reports\all-races.jasper 或 .jrxml**

任何提示为什么？

提前非常感谢。

路易斯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T10:30:57.513

尝试将 .jasper 文件放在下面`web-app/reports/`。

# design-patterns - Struts 1.x 框架中使用了哪些设计模式？

> ID：755429
> 
> 赞同：1
> 
> 时间：2009-04-16T09:53:20.013
> 
> 标签：design-patterns, struts

Struts 1.x 框架中使用了哪些设计模式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-02-05T10:18:16.013

> ActionServlet --> 前端控制器
> 
> RequestProcessor & ActionMapping --> 应用控制器
> 
> ActionForm --> 上下文对象
> 
> 动作 --> 命令模式

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T09:58:41.703

你在找这本书吗？

[http://java.sun.com/blueprints/patterns/](http://java.sun.com/blueprints/patterns/)

这就是他们的全部。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-23T03:57:43.023

Struts 控制器使用命令设计模式，Action 类使用适配器设计模式，RequestProcessor 的 process() 方法使用模板方法设计模式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T09:59:01.203

MVC 是 struts 开发背后的主要模式。JSP 用于视图，然后是控制器（前端控制器模式），然后是模型。

操作基于命令模式。

Struts 也使用 ValueObject 模式，因为我们通常将所有数据封装在一个对象中，然后将其传递给 JSP。

struts 中还有更多的模式。

# c# - C#：更新 Web 服务引用时出错

> ID：755431
> 
> 赞同：0
> 
> 时间：2009-04-16T09:53:24.337
> 
> 标签：c#, asp.net, web-services

更新参考时，我在 Web 服务中收到此错误消息

无法序列化 System.ComponentModel.Component.Site 类型的成员 System.ComponentModel.ISite，因为它是一个接口。

为什么会这样？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T09:56:41.067

听起来您在 Web 服务接口中使用了控件或组件（即作为返回值或方法参数）。那行不通-因为它需要（通常）序列化为xml。您通常会在对象中发送*数据*- 而不是控件。

服务接口是什么样的？

# subsonic - 将文本附加到类名

> ID：755444
> 
> 赞同：0
> 
> 时间：2009-04-16T10:00:54.473
> 
> 标签：subsonic, code-generation, classname

Subsonic 有没有办法将文本附加到生成的类名？我知道在属性名称与类型名称冲突的情况下可以使用 appendWith 属性，但是有没有办法为每个表执行此操作而不管名称如何？我尝试使用正则表达式匹配和替换，但这也会将文本附加到属性名称。

真的不是什么大问题，就是好奇能不能搞定。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T13:27:35.343

看起来你必须像我今天早上那样修改你的模板——根据你的构建语言，特别看看 VB_ClassTemplate.aspx 或 CS_ClassTemplate.aspx。

找到为每个表构建函数的页面部分，并根据需要进行修改。首先使用配置指向您自己的模板备份您的模板。

如果您遇到困难，请大声告诉我，因为我最近经历过这个（请参阅我的第一个问题）。

希望这可以帮助。

# pascal - 是否有任何有用的工具来分析现有的 Borland Pascal 7.0 应用程序

> ID：755447
> 
> 赞同：1
> 
> 时间：2009-04-16T10:06:24.890
> 
> 标签：pascal, 16-bit, turbo-pascal

我们有大量使用 16 位实模式 Fame 的 Borland Pascal 7.0 编写的遗留应用程序。

您是否知道任何对分析此类软件有用的好工具，例如调用图、交叉引用、IDE？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T10:46:25.700

好吧，如果你有内置的 exe，你可以在[IDA Pro Disassembler](http://www.hex-rays.com/idapro/)中加载它，然后你会得到调用图和交叉引用。

如果你有地图文件，你可以开始重命名函数并更好地理解它。

那就是如果您乐于阅读汇编。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-02T10:07:02.297

如果你有源代码，由于 Delphi 仍然支持大部分 TP 方言，你可以使用 Delphi 工具。Peganza 是最著名的 Pascal 源分析工具供应商：http: [//peganza.com/](http://peganza.com/)

浏览 SIMTEL TurboPas 目录也可能有助于找到一些小工具。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T10:57:08.950

您是否打算在 16 位平台上使用 TP7 再次编译？

就 IDE 而言，您可以使用 Delphi 4,5 或 6 或类似版本重新编译它们——我不知道 Delphi 的较新版本。您还可以使用 Free Pascal 和 Lazarus IDE 重新编译它们。如果您在 TP7 16 位以外的其他设备上重新编译，则需要考虑 16 到 32 或 64 位的转换。

# java - 在 Java 中将双精度数转换为字符串，反之亦然，而不会丢失准确性

> ID：755449
> 
> 赞同：3
> 
> 时间：2009-04-16T10:06:30.833
> 
> 标签：java, types

**C#**应用程序在文件中写入和读取*双*精度的*字符串*表示形式。

 ***C# 应用程序使用以下片段将双精度转换为字符串：

```
value.ToString("R", NumberFormatInfo.InvariantInfo); 
```

C# 应用程序使用以下片段将字符串转换为双精度

```
double num = double.Parse(s, NumberStyles.Float, (IFormatProvider) NumberFormatInfo.InvariantInfo); 
```

**如果Java**应用程序要写入和读取同一个文件，您将如何在不丢失数据的情况下转换类型？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-16T10:12:32.490

我相信，只是使用`Double.parseDouble()`并且`Double.toString()`应该在不丢失数据的情况下工作。特别是，来自文档`Double.toString()`：

> m 或 a 的小数部分必须打印多少位？必须至少有一个数字来表示小数部分，除此之外，必须有尽可能多的数字，但仅能将参数值与相邻的 double 类型值区分开来。也就是说，假设 x 是由该方法为有限非零参数 d 生成的十进制表示所表示的精确数学值。那么 d 必须是最接近 x 的 double 值；或者如果两个双精度值同样接近 x，则 d 必须是其中之一，并且 d 的有效位的最低有效位必须为 0。

另一种选择是，如果你想保留确切的字符串表示（这不是完全相同的东西）是`BigDecimal`在 Java 中使用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T10:16:31.247

双打的精度有限，可能无法完整地保留字符串。BigDecimal 类具有任意精度并保持字符串表示。

要将字符串转换为 BigDecimal：

```
BigDecimal d = new BigDecimal("10.1234567890"); 
```

要将 BigDecimal 转换为字符串：

```
System.out.println(d.toString()); 
```

更多细节在这里： [http ://epramono.blogspot.com/2005/01/double-vs-bigdecimal.html](http://epramono.blogspot.com/2005/01/double-vs-bigdecimal.html)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-16T10:35:25.227

您是否出于任何目的需要字符串表示，或者它仅用于文本数据传输（例如，SOAP/REST 消息）？

对于后者，您可以将 double 值转换为 long using`java.lang.Double.doubleToRawLongBits(double value)`并转换回 double using `java.lang.Double.longBitsToDouble(long value)`。您可以将 long 值作为十六进制编码的字符串传输。

[http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Double.html#doubleToRawLongBits(double)](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Double.html#doubleToRawLongBits(double)) [http://java.sun.com/j2se/1.5.0/docs/ api/java/lang/Double.html#longBitsToDouble(long)](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Double.html#longBitsToDouble(long))

这将保留您拥有的确切的 64 位双精度值，但它不会是人类可读的（对于大多数人来说！;)）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T10:13:23.937

只需使用大写“D”“Double”的Java Double 包装器类

int String s = Double.toString(yourDoubleVariable);

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T10:14:27.930

从双精度到字符串：

```
String stringValue = Double.toString(value); 
```

从字符串到双倍

```
double doubleValue = Double.valueOf(value); 
```

# c - C 中的 ASM 使用 -std=c99 给出错误

> ID：755457
> 
> 赞同：4
> 
> 时间：2009-04-16T10:07:35.557
> 
> 标签：c, assembly, c99, inline-assembly

我现在愿意编译我的项目，`-std=c99`但我遇到了一个我暂时不理解的错误。这一行：

```
my_type* td = ({ register kmy_type* arg0 asm("eax"); arg0; }); 
```

仅在 C99 中给我以下错误：

```
warning: ISO C forbids nested functions
error: syntax error before ‘asm’
error: ‘arg0’ undeclared (first use in this function)
error: (Each undeclared identifier is reported only once
error: for each function it appears in.)
warning: ISO C forbids braced-groups within expressions 
```

欢迎任何线索帮助我理解这意味着什么。这行不是我写的，我也不确定它的目的是什么。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T10:32:30.100

线

```
my_type* td = ({ register my_type* arg0 asm("eax"); arg0; }); 
```

应该在`eax`寄存器中获取一个值，解释为一个指针，放入`td`变量中。然而，它使用了很多 GNU 扩展，特别是语句表达式和这种使用`asm`（显式寄存器分配）。我建议您切换到 -std=gnu99 （或其他名称）。否则，您可能想使用双下划线（例如`asm`-> `__asm`）或`__extension__`关键字，但我不知道它在 c99 模式下是否有帮助。

编辑：我刚刚尝试过，只是简单地改变`asm`了`__asm`工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T10:25:17.077

`asm()`似乎不适用于`-std=c99`. 在我看来，这是一个坏主意，因为标准实际上建议编译器支持`asm()`关键字，但这不是强制性的。

我建议你`-pedantic`改用。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-16T10:11:09.717

那里的问题不是asm，看起来像它的arg0

# asp.net - ASP.NET 协议

> ID：755459
> 
> 赞同：0
> 
> 时间：2009-04-16T10:08:32.047
> 
> 标签：asp.net, protx

有没有人有任何将 ASP.NET 应用程序连接到 protx 的经验。

我正在寻找需要注意的事情和任何陷阱以及流程的高级摘要

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-01-26T09:50:12.923

当我们说话时，我正在做一个整合，坦率地说，这是一个正确的痛苦。我强烈建议避免使用该站点中极其糟糕的 SagePay ASP.NET 集成工具包。它根本不是 .NET。这显然是一些移植的 ASP 版本。效率低下且令人费解。

我从 www.dotnetcharge.com 获取了 dotnetcharge 库。但请注意，他们的支持（优先支持不少于）是个笑话。它是 125 美元，公平地说，它运作良好。我遇到的最大问题是 3D Secure。这是一场可悲的噩梦。几乎没有文档，而存在的通常是 SagePay 抽出的挽歌。SagePay 在支持方面是最大的笑话，他们似乎采用“剪切 n 粘贴”回复政策来支持包含某些字词的电子邮件。我收到的电子邮件是逐字逐句相同的，除了不同的收件人，而且不考虑我提出的问题！

我可以使用 dotnetcharge 库来写一些我在这里的代码，但你会发现它很容易做到公平。

我希望这个帮助能祝你好运！

# javascript - 电子邮件 ID 的 JavaScript 验证

> ID：755461
> 
> 赞同：4
> 
> 时间：2009-04-16T10:09:18.957
> 
> 标签：javascript, regex

### 复制 ：

> [在 JavaScript 中验证电子邮件地址？](https://stackoverflow.com/questions/46155/validate-email-address-in-javascript)

我想使用 JavaScript 验证 emailid。我正在使用以下代码：

```
var emailPat = /^(\".*\"|[A-Za-z]\w*)@(\[\d{1,3}(\.\d{1,3}){3}]|[A-Za-z]\w*(\.[A-Za-z]\w*)+)$/ ;
var emailid=document.getElementById("<%=txtEmail.ClientID %>").value; 
var matchArray = emailid.match(emailPat);
if (txtemail.value!="")
{  
  if (matchArray == null)
  {
        alert("Your email address seems to be incorrect. \n Please type the proper email address and try again.") 
        return false
  }
} 
```

此代码适用于诸如 abc@xyz.com 之类的电子邮件

但是当我输入像 ab.cd@xyz.com 或 abc@xy-z.com 这样的有效邮件 ID 时，它会显示警报。我应该在我的编码中进行哪些更改，这样它就不会像上面那样显示有效邮件 ID 的警报？谁能给我建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T10:13:47.790

Nice info with many examples:

[http://www.regular-expressions.info/email.html](http://www.regular-expressions.info/email.html)

btw: + is valid character, I hate validators where I can't enter myemail+somenote@gmail.com (because gmail supports this)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T10:15:36.240

[http://regexlib.com/Search.aspx?k=&c=1&m=3&ps=50](http://regexlib.com/Search.aspx?k=&c=1&m=3&ps=50)

Use whichever suits you best.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T10:13:54.217

I'd try changing your regular expression to this:

```
[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9]) 
```

# interface - 描述接口的用途？

> ID：755479
> 
> 赞同：3
> 
> 时间：2009-04-16T10:15:26.257
> 
> 标签：interface

您如何向了解基本 OOP 设计的学生描述接口的目的？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T10:17:17.720

我更喜欢术语“合同”来接口，它定义了任何实现者都必须遵守的“合同”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T14:47:57.740

作为很久以前的n00b，“合同”一词对我来说从来没有真正意义。我想了很久，还是无法接受。它根本没有帮助我理解接口……至少没有。

所以，当我教别人的时候，我用“特征”来代替。

所以一个接口描述了一个类型的特征。并且特定类型可以具有多组特征。但是，当开发人员决定一个类型必须具有这些特性时，这些特性必须由开发人员专门定义（实现）。

然后，为了更进一步，我在定义示例界面时使用动物之类的东西，而不是典型的现实软件解决方案。这使学生更容易想象对界面的需求。有时，我也会使用建筑物/房屋作为示例。

有时，根据听众的不同，我还会使用 Lowe's 或 Home Depot 的插头和插座来举例说明。IE：桌子上有几个插头。他们都有不同的特点。但有两个观察结果：

1.  插头未实施。它们没有连接到封装电源或“代码库”的电线，用于定义接口在运行时将提供什么。
2.  我只使用一种类型的插座，它只适合样品中的一个插头。另一个的“特性”不允许容器使用接口，因为容器没有“实现”接口特性。

我希望这有帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T10:24:43.677

引用自[http://java.sun.com/docs/books/tutorial/java/concepts/interface.html](http://java.sun.com/docs/books/tutorial/java/concepts/interface.html)

> 实现一个接口可以让一个类对它承诺提供的行为更加正式。 **接口在类和外部世界之间形成一个契约**，并且这个契约在编译时由编译器强制执行。如果您的类声称实现了一个接口，则该接口定义的所有方法都必须出现在其源代码中，然后该类才能成功编译。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T10:18:49.713

首先，我想说我们有一个团队，编程经理将强制你实现一些特定的功能，例如在 Java 或 C# 中。他们通过实现该接口来设计接口和“你”，保证你的类具有相同的功能。之后我会和他们谈谈界面可能带来的一些好处

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T10:18:59.697

接口是实现者承诺要做的事情。这就像他支持的功能列表。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T10:25:50.147

就像已经提到的那样，合同是一个好词，但它也可以让您拥有同一事物的不同实现（例如 jdbc 驱动程序..）。另一个好处是使用接口增加了代码的可测试性，但这可能更难解释..

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T10:28:08.910

接口是合约的一部分。它指定实现类必须提供的成员。但是，它没有具体说明这些成员必须做什么。

这就是为什么接口定义总是需要一个额外的文档（或注释）来解释每个成员必须“做什么”。

例如，如果接口包含一个方法 Add，带有两个整数参数和一个整数结果，您需要提供结果必须是两个参数之和的信息。（这是一个微不足道的例子，但此时误解可能会很麻烦）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-16T10:38:25.220

使用 peters 链接和信息，并为自己找到一些示例。示例是一个重要的教学工具。（例如，应该用一些击败手册页作者）

补充：有一些非常简单但具有描述性的方法，例如 IComparable、ISerializable...

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-16T14:31:51.990

正如其他人所说的那样，接口就是合同。实现接口的类承诺提供指定的方法。但在我自己的研究中，我真的很想知道为什么这很重要，为什么不直接使用继承呢？

我对 OOP 没有太多经验，但我在下面写下了我的想法。我确信其他更有经验的 OOP 程序员可以为此添加更多内容（或者如果我犯了错误，请纠正我）。

在不支持多重继承的语言中，不相关的类可以通过实现相同的接口来共享功能。

我发现通过根据关系查看继承和接口更容易理解差异。从基类继承的类与该类具有*is-a*关系，而实现接口的类与该接口具有*实现*关系。

借用[Programming C# 第 4 版](http://oreilly.com/catalog/9780596006990/)中的一个例子，汽车是一辆车，房子是一栋建筑，但两个类都可能实现 CanBeBoughtWithABigLoan 功能。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-08-27T21:10:44.700

当一个类 X 继承自另一个类 Y 时，有两个效果：

1.  X 类接收 Y 类的大部分或全部功能的默认实现，因此只需为自己定义与 Y 类不同的东西。
2.  X 类对象几乎可以在任何可以使用 Y 类对象的地方使用。

继承非常强大，但有一个基本的限制：除了 Object 之外的每个类都必须精确地从另一个类派生。如果继承是一种类型的对象可以替换为另一种类型的唯一方法，那将意味着一种类型可以替换两个或多个超类型的唯一方法是，如果这些超类型中的一个本身可以替换为另一种. 不幸的是，在许多情况下，类型关系并没有形成良好的层次结构。例如，在图形程序中，可能希望能够将 FilledRectangle 和 FilledEllipse 都视为 FilledShape 的替代品，并将 FilledEllipse 和 OutlineEllipse 视为 EllipseShape 的替代品，

接口通过提供一种方法来绕过这个限制，通过这种方法，一个类型可以声明自己可以替代许多其他类型（接口），而不必从它们继承。例如，在上面的图形示例中，可能有一个接口 IFilledShape，其成员如 FillColor，以及一个接口 IEllipseShape，成员如 SetCenter、GetMajorAxis 等。如果例程需要一个类型为 IFilledShape 的参数，则可以传入一个FilledRectangle、FilledEllipse、FilledTriangle 或任何其他实现 IFilledShape 的类型。FilledEllipse 实现 IFilledShape 的事实并不妨碍它也实现 IEllipseShape、IDrawableShape 或任何其他接口。

# sql-server - 在 SQL Server 中将索引声明为唯一

> ID：755486
> 
> 赞同：21
> 
> 时间：2009-04-16T10:16:39.577
> 
> 标签：sql-server, performance, indexing, unique

如果我知道索引将具有唯一值，那么如果我声明它，它将如何影响插入或选择的性能。

如果优化器知道索引是唯一的，那将如何影响查询计划？

我知道指定唯一性可以保持完整性，但暂时搁置讨论，性能后果是什么。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-16T12:07:37.640

**长话短说：如果您的数据本质上是`UNIQUE`，您将从为`UNIQIE`它们创建索引中受益。**

详细解释见我博客中的文章：

*   [**制作索引`UNIQUE`**](http://explainextended.com/2009/04/23/making-an-index-unique/)

* * *

现在，血腥的细节。

正如**@Mehrdad**所说，`UNIQUENESS`会影响计划生成器中的估计行数。

`UNIQUE`index 具有最大可能的选择性，这就是为什么：

```
SELECT  *
FROM    table1 t2, table2 t2
WHERE   t1.id = :myid
        AND t2.unique_indexed_field = t1.value 
```

几乎肯定会使用`NESTED LOOPS`，而

```
SELECT  *
FROM    table1 t2, table2 t2
WHERE   t1.id = :myid
        AND t2.non_unique_indexed_field = t1.value 
```

`HASH JOIN`如果优化器认为这`non_unique_indexed_field`不是选择性的，则可能会受益。

如果您的索引是`CLUSTERED`（即行本身包含在索引叶子中）和非`UNIQUE`，则将一个名为的特殊隐藏列`uniquifier`添加到每个索引键，从而使键更大并且索引更慢。

这就是为什么`UNIQUE CLUSTERED`索引实际上比索引更有效的原因`non-UNIQUE CLUSTERED`。

在`Oracle`中，`UNIQUE INDEX`这样的调用需要连接`key preservation`，以确保表中的每一行最多被选择一次，并使视图可更新。

这个查询：

```
UPDATE  (
        SELECT  *
        FROM    mytable t1, mytable t2
        WHERE   t2.reference = t1.unique_indexed_field
        )
SET     value = other_value 
```

将在 中工作`Oracle`，而这个：

```
UPDATE  (
        SELECT  *
        FROM    mytable t1, mytable t2
        WHERE   t2.reference = t1.non_unique_indexed_field
        )
SET     value = other_value 
```

将失败。

不过，这不是问题`SQL Server`。

**还有一件事：**对于这样的桌子，

```
CREATE TABLE t_indexer (id INT NOT NULL PRIMARY KEY, uval INT NOT NULL, ival INT NOT NULL)
CREATE UNIQUE INDEX ux_indexer_ux ON t_indexer (uval)
CREATE INDEX ix_indexer_ux ON t_indexer (ival) 
```

，这个查询：

```
/* Sorts on the non-unique index first */
SELECT  TOP 1 *
FROM    t_indexer
ORDER BY
        ival, uval 
```

将使用`TOP N SORT`, 而这个：

```
/* Sorts on the unique index first */
SELECT  TOP 1 *
FROM    t_indexer
ORDER BY
        uval, ival 
```

将只使用索引扫描。

对于后一个查询，在 上进行额外排序是没有意义的`ival`，因为`uval`无论如何都是唯一的，优化器会考虑到这一点。

`200,000`在行 ( ) 的样本数据上`id == uval == ival`，前一个查询运行`15`几秒钟，而后一个查询是即时的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T10:18:42.053

当然，优化器会考虑唯一性。它会影响查询计划中的预期行数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T10:55:16.287

插入数据时性能会受到负面影响。它需要检查唯一性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-04-15T04:53:56.630

我刚刚在我的机器上测试了一个包含超过 100 万行的生产表，因为我认为这是一个很好的测试。结果很有趣，这是原始数字：

-- 无索引：

```
 Setup Time: 8888, Insert Time: 501690 
```

-- 唯一约束：

```
 Setup Time:   42, Insert Time: 488030 
```

设置包括获取我添加唯一约束的字段的最大值 - 因此从逻辑上讲，通过添加约束可以显着提高性能。当通过这个外键搜索时，这也将提高性能。

有趣的是，插入时间也略有改善（提高了 2.7228%），因此只有添加约束（+ 固有索引）的积极影响 [在我的测试用例中]。

测试仅显示添加约束的积极影响 - 没有性能影响。

注意：对于我们的测试系统，我希望这些值几乎总是唯一的，所以我没有测试插入非唯一值，在这个数据中它确实是一个例外 - 而不是我们需要高性能的东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T10:28:40.657

是的，它会被查询引擎考虑在内。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T10:28:55.147

也许更重要的是：唯一性将保护数据的完整性。性能将有理由忽略这一点。

性能可能会受到正面或负面影响或根本不受影响：这取决于查询，是否使用索引等

# c# - Routed events in wpf

> ID：755488
> 
> 赞同：0
> 
> 时间：2009-04-16T10:16:55.847
> 
> 标签：c#, wpf, routed-events

A very well known fact is that routed events only travel up or down the ancestry and not through all the elements.

But an equally known fact is that an event handler can be wired in the common parent of two disparate controls.

My questions is how, some pointers please.

I have XAML that looks like

```
<Grid Name="MainGrid">
    <Listbox Name="lb1"/>
    <Grid Name="InnerGrid">
       <Listbox Name="lb2"/>
    </Grid>
</Grid> 
```

The Mouse Event handlers defined on "lb1" will not get fired as it gets "burried" under "InnerGrid". My question is how can I wrote some code in the "MainGrid" or somewhere else wherein the event handlers defined on "lb1" get fired. Or may be some other technique of achieveing this.

Many Thanks.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T16:46:28.700

我不确定你到底在问什么，但似乎你希望能够为已经处理的事件被调用。

尝试这个：

在构造函数后面的代码中`InitializeComponent()`，调用

```
this.AddHandler(RoutedEvent, Delegate, bool); 
```

传入事件（`MouseDown`或等）、要调用的委托（类似于`lb1_MouseDown`），然后`true`表明您希望为已处理的事件调用。

# http - how to record http traces from browser?

> ID：755502
> 
> 赞同：0
> 
> 时间：2009-04-16T10:20:27.663
> 
> 标签：http, browser

are there any methods to record http traces that are issued from the browser?

I would be mainly interested in the GET / POST methods to understand the interaction with a webpage. Maybe helpful the browser I am using is FireFox.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T10:22:03.247

You can use the [Firebug](http://getfirebug.com), [HTTPFox](https://addons.mozilla.org/en-US/firefox/addon/6647) or [Live HTTP Headers](http://livehttpheaders.mozdev.org/) Firefox addons.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T10:21:55.400

For Firefox: [Live HTTP Headers](https://addons.mozilla.org/en-US/firefox/addon/3829)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T15:12:04.110

[HttpWatch](http://www.httpwatch.com)是一个商业工具，可以在 IE 和 Firefox 中记录跟踪。还有一个免费版本可以显示基本信息，例如时间表、访问的 URL、HTTP 方法和从服务器返回的状态代码。

免责声明：此答案由 HttpWatch 的制造商 Simtec Limited 提供。

# sharepoint-2007 - 如何自定义 SharePoint 2007 自定义列表中列的显示？

> ID：755504
> 
> 赞同：1
> 
> 时间：2009-04-16T10:20:58.693
> 
> 标签：sharepoint-2007, list, bdc

我为公开出版物目录的 Web 服务创建了一个 BDC 条目。每个出版物都有一组作者。当我在业务数据列表中显示数据时，“作者”列显示“BDC.Authors []”。

如何让 Sharepoint 2007 显示姓氏，用“，”分隔？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-18T15:40:19.473

我曾经收到类似的错误消息，发现原因与我返回到 BDC 的数据不可序列化有关。我必须修复我的 Web 服务以返回一些可序列化的数据（我认为 String[] 是我使用的），这很好。

不完全相同，但也许它可以让你走上正确的道路。

# sharepoint - 将 SPGridView 导出到文档

> ID：755506
> 
> 赞同：1
> 
> 时间：2009-04-16T10:21:41.220
> 
> 标签：sharepoint, wss, sharepoint-2007

我有一个使用 SPGridView 呈现表格数据的 webpart。我需要在 webpart 中提供一个按钮，单击该按钮会将 SPGridView 导出到文档中，最好是 Excel 工作表或 Word 文档。如何从 SPGridView 导出数据？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T20:58:45.050

[http://mattberseth.com/blog/2007/04/export_gridview_to_excel_1.html](http://mattberseth.com/blog/2007/04/export_gridview_to_excel_1.html)

我也将它用于 SPGridView ......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T14:41:20.207

要导出到 .xls 文件，请查看[此示例代码](http://www.tech-archive.net/Archive/SharePoint/microsoft.public.sharepoint.portalserver.development/2007-06/msg00048.html)。

要导出到 .csv 文件，[这是另一篇文章](http://www.velocityreviews.com/forums/t366404-gridview-to-csv.html)，它用于从 GridView 导出，但也适用于 SPGridView。

# ios - 自定义 UISlider 外观

> ID：755510
> 
> 赞同：10
> 
> 时间：2009-04-16T10:22:42.823
> 
> 标签：ios, cocoa-touch, uikit, uislider

要自定义 UISlider 的视觉外观，您可以设置拇指和轨道图像。部分轨道图像被拉伸到适当的位置。从文档中：

> 可拉伸区域位于两个端盖区域之间。端盖定义了图像中保持原样且未拉伸的部分。可拉伸区域是端盖之间的 1 点宽区域，可以复制该区域以使图像看起来更长。

现在我遇到的问题是我的可拉伸区域需要超过 1 点宽。（这是一种模式）不幸的是，SDK 中似乎对 1 点宽度进行了硬编码。

有人知道如何解决这个问题吗？还是我必须为此从头开始编写自己的滑块？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-06-11T10:27:19.150

只需使用透明图像作为轨道图像，并在下面放一个 UIImageView :)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-09T04:19:22.947

我知道这是迟到的答案。

但我解决了以下问题：

4 是 png 文件中圆帽的宽度。

```
UIImage *minimum = [UIImage imageNamed:@"slider_minimum.png"];
[slider setMinimumTrackImage:[minimum stretchableImageWithLeftCapWidth:4 topCapHeight:0]
                      forState:UIControlStateNormal]; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T10:30:21.633

我相信您必须编写自己的滑块才能做到这一点。似乎没有（公共）API 可以改变 UISlider 关于可拉伸区域的行为。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T13:33:23.677

您可以将图像创建为您需要的宽度，并预先渲染图案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-17T03:15:26.373

您需要使用 stretchableImageWithLeftCapWidth:topCapHeight: 初始化图像。leftCapWidth 和 topCapHeight 是图像对象的只读属性，但使用该函数可以设置它们。你只设置 left 和 top 因为左右 caps 的大小相同，top 和 bottom 也相同。因此，要使用左侧大小为 5 像素的自定义滑块轨道，您需要有一个 11 像素宽的图像，无论您需要什么高度：左帽为 5，轨道拉伸为 1 像素宽，右边还有 5 个。没有玩过它，我不知道使用大于 0 的 topCapHeight 是否按预期工作，但我怀疑它不会引起很多问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-19T14:33:30.540

我想要 UISlider 后面的模式。我最终将两个图像都设置为 nil 并在滑块下添加了一个视图，因为我不需要它在拇指的任何一侧都不同。如果您需要根据位置更改它，这将更加困难，但非常可行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-01-16T11:30:07.143

要制作您的自定义 UISlider，您有很多方法。取决于你想要什么定制。您可以设置默认属性来自定义 UIslider，如下所示： setThumbImage:forState: setMinimumTrackImage:forState: setMaximumTrackImage:forState: 如果您想要进一步自定义，可以参考以下链接 [https://medium.com/@0209neha/creating -a-custom-uislider-7756bf898832#.o1l4qhymo](https://medium.com/@0209neha/creating-a-custom-uislider-7756bf898832#.o1l4qhymo) [https://github.com/0209Neha/ExploringSlider](https://github.com/0209Neha/ExploringSlider)

# delphi - Rave Reports exporting to excel

> ID：755513
> 
> 赞同：1
> 
> 时间：2009-04-16T10:24:01.137
> 
> 标签：delphi, rave-reports

i have a rave report with 5 pages inside it, we need to export to excel two page from those 5 report pages, each page is a report itself... we use gnostice v2.5 to do the exporting. currently using Rave 6.5 with BDS2006.

Hi, maybe i was not clear enough, i have 1 Report which consists of 5 pages, Page1, Page2, Page3, Page4, Page5, each page work as a differente report, i can export the entire report without a problem, bu we only need to export Page1 and Page2\. and yes my question is how do i do it? Thanks.

thanks, Vladimir

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T08:23:22.777

通过 Rave，您可以生成一些以一个打印作业结束的报告（请参阅[Nevrona.com 上的 tipp #41](http://nevrona.com/Products/RaveReports/TipsTricks/TipsRaveGeneral/Tip041MultipleReportsinSinglePrintJob/tabid/122/Default.aspx)）。因此，您可以将您的报告拆分为每页一份报告并将它们正常打印在一起 - 或为您的 Excel 导出生成所需的页面。

问候克劳斯

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-09-08T15:29:22.170

据我记得，报告不能超过5页。因此，您必须操纵报表更改页面顺序，以确保报表呈现不会通过第 1 页和第 2 页。

您可以配置参数并在报告本身内的脚本上解释它们 - 允许对其进行自动配置。

我不记得看到有关仅导出报告的一小部分的内容。

# c# - 在非键盘事件方法调用中确定键盘状态

> ID：755525
> 
> 赞同：0
> 
> 时间：2009-04-16T10:28:54.617
> 
> 标签：c#, winforms, .net-2.0

在 textbox.TextChanged 事件中，如果仍然按住某个键，我想阻止执行某些特定（处理器密集型）功能。例如，当用户通过按住删除键删除大块文本时，如果仍然按住删除键，我想阻止代码触发。

我查看`Control.ModifierKeys`了谷歌搜索最接近的内容，但在我的具体情况下，我想捕获是否按下了删除或退格键 - ModifierKeys 没有提供。

有谁知道如何做到这一点？理想情况下，我不必为每个文本框跟踪 keyup/keydown 的状态（尽管如果没有其他方法，我会这样做）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T10:33:46.230

为什么不处理[KeyUp 事件](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.keyup(VS.80,loband).aspx)而不是处理`KeyPress`. 这样，您始终可以确定该键已经被按下并且正在被... errr.. 释放（因为没有更好的词！）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T10:35:45.023

如果您想知道当前的键盘状态（通过 KeyPreview），您不能在主窗体上附加事件。

然后检查来自文本框事件处理程序的存储状态。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T10:37:52.710

覆盖`Control.ProcessKeyPreview`应该这样做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T12:41:49.900

最后我求助于外部功能`GetKeyboardState`

因此，为了将来参考，我正在做一些事情：

```
[DllImport("user32.dll")] public static extern int GetKeyboardState(byte[] lpKeyState);

private void myFunc()
{
    byte[] keyboardState = new byte[255];
    int keystate = GetKeyboardState(keyboardState);

    if (keyboardState[(int)Keys.Back] == 128)
    {
       // backspace still pressed
       return;
    }
    else if (keyboardState[(int)Keys.Delete] == 128)
    {
       // Delete key still pressed
       return;
    }

    // More processor intensive code ...
} 
```

我不确定函数调用开销，但我很确定它会小于函数不存在时执行的处理。

# asp.net - ASP 超链接控件文本换行

> ID：755538
> 
> 赞同：1
> 
> 时间：2009-04-16T10:33:06.137
> 
> 标签：asp.net, html, controls, web-controls

我试图让 ASP 超链接控件中的文本在放置在 html 表中时不换行，如下所示：

```
<table style="width: 320px" class="noLines">
<tr><td style="width: 300px"> <asp:HyperLink Target="_self" ID="frmSuggest"  Text ="Click Click Click Click Click" Visible="false" runat="server"></asp:HyperLink> 
</td></tr>
<table> 
```

我已经尝试向 HyperLink 添加一个宽度属性，不幸的是，它确实将这个表中的所有其他控件也移动了这个宽度！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T10:44:09.853

```
<td style="white-space:nowrap;">
  <!-- You link here -->
</td> 
```

覆盖宽度设置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T11:08:21.263

除了 El Greco 的回答，[nobr](http://www.htmlcodetutorial.com/linepar/_NOBR.html)标签是另一种选择

```
<asp:HyperLink Target="_self" ID="frmSuggest" Visible="false" runat="server">
    <nobr>Click Click Click Click Click</nobr>
</asp:HyperLink> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T15:53:09.787

我不知道我是否理解你的意思，但这是一个 VB 函数，它可以在不剪切单词的情况下修剪字符串，你可以在这里将它转换为 c# [http://converter.telerik.com/](http://converter.telerik.com/)

功能整洁（strToTrim，desiredLength）'==== strToTrim = trim（strToTrim）

```
if len( strToTrim ) < desiredLength then
    neatTrim = strToTrim
    exit function
else
    if inStrRev( strToTrim, " ", desiredLength ) = 0 then
        strToTrim = left( strToTrim, desiredLength - 1 ) & "&#133;"
     else
        strToTrim = left( strToTrim, inStrRev( strToTrim, " ", desiredLength + 1 ) -1 ) & "&#133;" 'no carriage return here
    end if
end if

neatTrim = trim( strToTrim )
End Function 
```

# architecture - 企业、系统和应用架构（最佳实践？）

> ID：755540
> 
> 赞同：14
> 
> 时间：2009-04-16T10:33:16.200
> 
> 标签：architecture, enterprise, togaf

我目前的任务是为软件开发创建一个文档化的、一致的架构指南。我们有很多聪明的人在做正确的事情，但不是始终如一和可重复的。

我们使用 Microsoft 的应用程序架构指南 2.0 作为起点。因此，提出一个应用程序架构是相当直接的（我不会说容易）。可能是因为我有几年的开发经验，所以我对这个领域有很好的了解，并且也有大量的例子和指导。

由于我们的组织有几个应用程序构成了一个或多个系统，然后我们将它们安装在“客户端”......我们认为创建系统架构和企业架构也是有意义的。这就是问题开始的地方。

那里没有一致的指导。如果您搜索“系统架构示例”，您得到的东西是如此不同，以至于我想知道是否有“标准”方式来做到这一点。

根据我（有限 - 清楚地）对这一切的理解，系统架构是一个或多个应用程序架构的抽象，描述了它们如何协同工作以形成一个系统。此外，企业架构是一个进一步的抽象，展示了您的系统如何适应组织企业，以及它如何与业务流程、IT 战略交互，以及它如何集成到企业中的其他系统中。

*   我完全错了吗？
*   是否有任何标准（我在哪里可以找到它们）？
*   是否应该有标准，或者“好的”系统架构是否只是任何格式的任何文档，这些文档对于读者来说是清晰易懂和有用的？
*   但是，经验丰富的建筑师会如何看待这种方法？

我不想简单地列出一组可能有用的 SOA 相关模式……我想让它更加专注于我们所做的事情，即在面向服务的架构上构建财务解决方案。

[更新： TOGAF(9)](http://www.opengroup.org/architecture/togaf9-doc/arch/toc.html)怎么样。有没有人有过这方面的经验，是否值得努力详细了解它。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-17T14:34:57.020

几天前我提交了这个问题，但是通过继续研究和阅读[littlegeek](https://stackoverflow.com/users/962/littlegeek)的回复后，我想我找到了一份有趣的白皮书，我发现它非常有用和有趣。

阅读：[四大企业架构方法的比较](http://msdn.microsoft.com/en-us/library/bb466232.aspx) 作者：Roger Sessions

一个片段...

-- - - - - - - - - - - 8< - - - - - - - - - - - -

在过去的 20 年里，许多企业架构方法来来去去。在这一点上，大约 90% 的领域使用以下四种方法之一：

*   企业架构的 Zachman 框架——虽然自称是一个框架，但实际上更准确地定义为一个分类法
*   The Open Group Architectural Framework (TOGAF)——虽然被称为框架，但实际上更准确地定义为一个过程
*   联邦企业架构——既可以被视为已实施的企业架构，也可以被视为创建企业架构的限制性方法
*   Gartner 方法论——可以最好地描述为一种企业架构实践

本白皮书讨论了企业架构的这四种方法。它是在一家面临一些非常非虚构的运营问题的虚构公司的背景下进行的。这些问题包括：

*   IT 系统变得难以管理且维护成本越来越高。
*   IT 系统阻碍了组织以具有成本效益的方式及时响应当前和未来市场条件的能力。
*   始终过时和/或完全错误的关键任务信息。
*   组织的业务和技术方面之间存在不信任的文化。

-- - - - - - - - - - - 8< - - - - - - - - - - - -

白皮书在几个方面帮助了我。

1.  它给了我很好的建筑介绍和历史（特别是企业建筑）
2.  它向我介绍了作者建议的 4 种领先的企业架构。
3.  然后继续以合乎逻辑和简单的方式将它们与我可能涉及的好例子进行比较。

我不能说我所有的问题都已得到解答，我现在已经准备好去死了:-)，但很多事情已经变得更加清晰，因此我认为那里的其他人也可能会发现这很有用。

我仍然会重视您对此主题的任何其他意见、建议和问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T09:11:30.010

您似乎对情况和对建筑领域的理解非常了解。

“系统”架构更难定义——可能是寻找“解决方案”或“IT”，但这听起来像是您在寻找您的软件架构与物理服务器世界的关系，并加入了一些网络

> “我们有很多聪明的人在做正确的事情，但并不是始终如一地重复。”

然后，我自己获得了 TOGAF 8 的认证，我想说 TOGAF 为定义架构的不同方面带来了一种“方法论”的感觉，以及一种将各种专业技术团队聚集在一起并将其牢牢固定在业务目标上的方式。TOGAF 还有助于理解架构治理的需求，并将变革的理念（从技术、数据、系统、软件和业务的所有部分）牢牢地带入流程中。

这

1.  架构开发方法
2.  技术参考模型
3.  标准信息库
4.  企业连续体

所有这些都有助于收集有关架构工作的信息，并为开发和 EA 提供一致的方法。

它还可以帮助客户了解您在做什么以及如何将 TOAGF 展示为展示它如何组合在一起的方法。

PS - 我只说 TOGAF 是有用的，因为 TOAGF 会为你解决这个问题。

那里还有其他架构师框架。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T17:02:39.347

我没有 EA 的实际操作经验，但我实际上已经加入了它。在前 4 种 EA 方法中，我遇到了前三种。我只是不知道 Gartner 那个，可能是因为它的文件不可用。恕我直言，当我们谈论 EA 时，我们实际上是在谈论使业务与技术保持一致。所以所有的 EA 方法都必须是面向业务的。如果不是，那根本就不是 EA。

我认为 TOGAF 非常有用且易于理解。是的，这是一个将当前基线架构演变为目标架构的过程。架构原则充当 EA 开发的高级指导。TOGAF的核心组件是业务架构、信息架构和技术架构。他们每个人都可以有自己的架构模式。[NIH](http://enterprisearchitecture.nih.gov)已经使用 FEAF 实施了 EA。这是实施 EA 的一个很好的例子。我认为它与 TOGAF 方法非常相似，至少从可交付成果的角度来看。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-02-06T23:59:01.540

迄今为止，为 EA 创建建模框架的唯一明智尝试是 Archimate：[https ://en.wikipedia.org/wiki/ArchiMate](https://en.wikipedia.org/wiki/ArchiMate)

ArchiMate 是 The Open Group 的技术标准，基于 IEEE 1471 标准的概念。

此外，请参阅以下有关 EA 工件和它们之间的可追溯性的链接：

[https://www.ontario.ca/document/go-its-56-ops-enterprise-architecture-principles-and-artefacts-appendix-ontario-public-service](https://www.ontario.ca/document/go-its-56-ops-enterprise-architecture-principles-and-artefacts-appendix-ontario-public-service)

# php - Zend Framework：如何获取默认参数？

> ID：755541
> 
> 赞同：2
> 
> 时间：2009-04-16T10:33:20.177
> 
> 标签：php, zend-framework, url-routing

如果未指定，我如何获得“默认”参数？

考虑以下：

```
http://localhost/controller/action/id/123 
```

在我的控制器中，我可以使用 'id' 的值

```
$request = $this->getRequest();
$id = $request->getParam('id'); 
```

如果网址是

```
http://localhost/controller/action/456 
```

如何获得 456 的值？“参数”名称是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T10:37:18.357

默认情况下 ZF URL 必须遵循模式：

```
/controller/action/param1Name/param1Val/param2Name/param2Val ... 
```

你应该使用[路由器](http://framework.zend.com/manual/en/zend.controller.router.html)。例如在`bootstrap.php`：

```
$frontController = Zend_Controller_Front::getInstance(); 
//^^^this line should be already there

$router = $frontController->getRouter();
$route = new Zend_Controller_Router_Route(
    'yourController/yourAction/:id',
    array(
        'id'       => 1, //default value
        'controller' => 'yourController',
        'action'     => 'yourAction'
    ),
    array('id' => '\d+')
);
$router->addRoute('yourController', $route); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T14:52:13.627

只是想分享。

上述路由器设置必须与 $frontController 一起使用。

并确保将其放在控制器调度之前。

```
<..above router code goes here...>

// Dispatch the request using the front controller. 
$frontController->dispatch (); 
```

希望不要像我一样浪费时间。;-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T10:49:13.697

尝试将此路由添加到路由器：

```
$route = new Zend_Controller_Router_Route_Regex(
    'my_controller/my_action/(\d+)',
    array(
        'controller' => 'my_controller',
        'action'     => 'my_action'
    )
);

$router->addRoute('my_route', $route); 
```

# sql-server - 删除 MS SQL Server 中的列

> ID：755544
> 
> 赞同：48
> 
> 时间：2009-04-16T10:34:22.733
> 
> 标签：sql-server, sql-server-2005

如何从现有表中删除列？

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2009-04-16T10:40:29.240

您正在寻找的命令是：

```
alter table tblName drop column columnName 
```

where`tblName`是表`columnName`的名称和列的名称，但您可能需要先做一些事情。

*   如果该列有任何外键引用，您需要先删除它们。
*   如果有使用该列的索引，则需要删除它或将其调整为不使用该列。

* * *

请记住，此命令的性能不一定很好。一种选择是等待一段停机时间，当您可以确定没有人会访问数据库时，重命名当前表，然后使用`create table`和`insert into ... select from`传输您不想删除的列。

Oracle 的较晚版本之一实际上具有软删除功能，它可以仅将列标记为未使用，而无需物理删除它。它具有相同的效果，因为您不能再引用它，并且有一个命令`alter table ... drop unused columns`应该在安静的时间内运行，它实际上是在物理上删除它的艰苦工作。

这具有立即“消失”列的优点，而不会在繁忙时间拖累数据库性能。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-16T10:36:20.387

`ALTER TABLE XXX DROP COLUMN YYY;`

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2016-04-11T21:02:36.430

这也可以通过 SSMS GUI 完成。

我喜欢这种方法，因为它会警告您该列是否存在任何关系，并且还可以自动删除这些关系。正如 PaxDiablo 所说，如果存在关系，则必须先将其删除。

1.  将表格放在设计视图中（右键单击表格），如下所示：

[![在此处输入图像描述](https://i.stack.imgur.com/IFzXk.png)](https://i.stack.imgur.com/IFzXk.png)

2.  右键单击表格设计视图中的列，然后单击“删除列”

[![在此处输入图像描述](https://i.stack.imgur.com/LEB7a.png)](https://i.stack.imgur.com/LEB7a.png)

此时，如果有任何关系也需要删除，它会询问您是否也想删除这些关系。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-16T12:34:46.233

对于大型表，这可能**非常**慢。创建一个新表（旧表的副本但有更改）并插入数据通常会快得多。删除旧表，然后重命名新表。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-03-11T06:51:54.620

```
ALTER TABLE [Intake].[MER_SF_Opportunity_History] DROP COLUMN [[IntakeIsDeleted]]]
GO 
```

# html - 有效的网页加载速度更快吗？

> ID：755547
> 
> 赞同：12
> 
> 时间：2009-04-16T10:35:36.787
> 
> 标签：html, performance, validation, browser

我是**有效**网页的粉丝，并且总是花时间通过[W3C 验证器](http://validator.w3.org/)传递新站点。

当试图说明为什么公司应该验证网页时，我很快想到了可**访问****性**和网站在更原始的设备上的可访问性，例如手机、冰箱、手表、下一件大事等。

但是，我想知道在渲染未验证的网页时是否涉及计算开销？

有没有在这方面进行过任何研究？某些浏览器是否比其他浏览器更好地处理无效内容？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-16T10:37:18.483

一个无效页面可能需要更长的时间来呈现，因为浏览器需要实现一些故障恢复（推断工作以查找下一个有效内容的位置以及浏览器如何继续呈现它），这可能会引入开销。

只有在仔细测量和（如果可能）浏览器源代码分析之后才能知道实际差异。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T10:52:36.153

I think your stronger argument will be in maintenance. I designed the intranet for the last major company I worked for. I created page templates that have valid markup and used conditional comments to target stylesheets for different versions of IE. The site was launched 2 years ago; it looks the same in Firefox 2 & 3, Safari 2 & 3, and IE 6, 7, & 8! No markup or style changes were necessary. This means that when the organization finally updates to IE 7, the web developer team will not have to do anything. Big win in reduced maintenance costs.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-16T10:38:46.530

我怀疑任何故障恢复或其他无效内容处理的成本将仅因网络延迟和其他成本而变得微不足道。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T10:47:27.257

> 然后我想知道在渲染未验证的网页时是否涉及计算开销？

当然可以，但它几乎是微不足道的。与网络下载时间造成的更大延迟相比，解析速度通常不会产生明显的影响。

当您错误地关闭评论时，加载时间可能会有所不同。评论问题的修复可以延迟到页面末尾，因此不会发生渐进式渲染，并且在整个页面下载之前不会渲染任何内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T10:37:19.917

我不这么认为。我认为它几乎相同，对于有效页面（如`&amp;`URL 中的内容）可能更多。特别是因为*某些*浏览器（嗯，IE）实际上是为无效页面设计的。不过，并不是说我喜欢无效的 HTML。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T10:51:47.933

I'm just speculating here, because I have no reference or hard data to back this up, but I think that the rendering mode that the browser chooses can have quite some impact. Most browsers have two or three rending modes, one for standard-complient pages (which is *usually* triggered when you serve the browser a valid html document, but not always), and quirks mode, which simply tries to make the best of whatever you throw at it. I can imagine that the performance of standards-complient mode is a lot better than that of quirks mode, but again: just speculating here. If anyone can back this up with evidence or a good reference, feel free to comment or post a better answer!

# c# - 调用服务器上的函数并由客户端返回结果

> ID：755556
> 
> 赞同：0
> 
> 时间：2009-04-16T10:38:08.387
> 
> 标签：c#, sql-server, web-services

我们有一个 winform 应用程序，它需要显示在服务器上存在的数据库上计算的一些结果。

在当前的解决方案中，我们有一个 VPN 连接将我们连接到服务器数据库，我们使用普通 SQLConnection 从服务器数据库查询数据。我们获取数据，然后在客户端进行计算 对于带宽利用率，我们希望在服务器端进行计算，并将最终结果发送给用户。

所以客户端只是执行

```
double[] getResults(tableName t, ColumnName c, Key k)
{ //execute at the server
return results;
} 
```

实现这一目标的最简单方法是什么？请给我详细信息

谢谢你

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T10:41:55.850

好吧，最少的“移动部分”是在数据库服务器上用 TSQL 进行处理，但这可能不是一个好主意（取决于场景）。

假设您想在 C# 中进行处理，您可能应该在 IIS 等 Web 服务器中托管 WCF 或 asmx (WSE) 服务 - 并在客户端应用程序和服务之间添加服务引用。该服务对数据库进行调用和处理，并返回`double[]`.

然而，这是相当多的基础设施......

您还可以在 Windows 服务（甚至控制台 exe）中托管 WCF，这可能会使生活更轻松（没有 IIS）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T12:07:15.473

这取决于这涉及哪种计算。如果您使用 SQL2005 及更高版本，您可以使用 T-SQL 解决它，或者您可以在 CLR-FUNCTION 中使用 C#。

# java - 如何解除对 Java 启动进程的阻止？

> ID：755557
> 
> 赞同：0
> 
> 时间：2009-04-16T10:38:16.467
> 
> 标签：java, process

从 cmd 行执行某些命令（比如说“x”）时，我收到以下消息：“....按任意键继续...”。所以它等待用户输入解除阻塞。

但是当我从java执行相同的命令（'x'）时：

```
Process p = Runtime.getRuntime().exec(cmd, null, cmdDir);
// here it blocks and cannot use outputstream to write somnething
p.getOutputStream().write(..); 
```

代码块...

我试图在进程的输出流中写入一些东西，但是我怎么能做到这一点，因为代码永远不会到达那一行？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T10:43:29.187

我认为（尽管不能确定）您说的是 Windows 而不是 Unix？

如果是这样，命令行进程可能实际上并没有等待按键（或输入），`stdin`而是执行与旧 DOS`kbhit()`功能等效的操作。

AFAIK 没有办法让该功能相信键盘已被按下而没有实际按下键。

为了测试这个理论，创建一个包含一些空行的文本文件“input.txt”，然后运行：

```
foo.exe < input.txt 
```

这将显示您的程序是在等待`stdin`还是在等待其他东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T11:01:54.413

您应该同时读取子流程的输出和错误流。这些流的缓冲区大小是有限的。如果其中一个缓冲区已满，则子进程将阻塞。我认为这就是你的情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T11:12:34.233

我认为在 Java 中执行外部应用程序的推荐方法是使用 ProcessBuilder。代码看起来像

```
//Launch the program
ArrayList<String> command = new ArrayList<String>();
command.add(_program);
command.add(param1);
...
command.add(param1);

ProcessBuilder builder = new ProcessBuilder(command);
//Redirect error stream to output stream
builder.redirectErrorStream(true);

Process process = null;
BufferedReader br = null;
try{
    process = builder.start();

    InputStream is = process.getInputStream();
    br = new BufferedReader( new InputStreamReader(is));
    String line;

    while ((line = br.readLine()) != null) {
         log.add(line);
    }
}catch (IOException e){
    e.printStackTrace();
}finally{
    try{
        br.close();
    }catch (IOException e){
        e.printStackTrace();
    }
} 
```

进程对象有一个 get[Input/Output/Error]Stream 可用于与程序交互。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T10:44:22.880

该程序无法继续，因为它在等待用户输入时被阻止。

一种选择是在单独的线程中启动外部进程，或者使用共享进程 p 的线程以便能够写入其流。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T12:20:48.827

使用 PrintWriter 模拟一些输入：

```
 Process p = Runtime.getRuntime().exec(cmd, null, cmdDir);
        //consume the proces's input stream
        ........
        // deblock
        OutputStream outputStream = p.getOutputStream();
        PrintWriter pw = new PrintWriter(outputStream);
        pw.write("ok");
        pw.flush();
        int errCode = p.waitFor(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-18T12:27:02.537

我有同样的问题，我找到了解决方案。它不是最优雅的，但它确实有效。

1 - 当您执行该流程时，您会从流程中获取 inputStream 2 - 然后您进行循环接收提示中显示的消息（如果有的话） 3 - 当您看到您从“提示”中获得“按 a继续的关键”，或者其他什么，你结束进程

```
 // Creates the runtime and calls the command
        Process proc = Runtime.getRuntime().exec(Destino);

        // Get the proccess inputStream
        InputStream ips = proc.getInputStream();
        String output = "";

        int c = 0;

        // Read the output of the pro
        while ((c = ips.read()) != -1
                && !output.contains("Press any key to continue")) {
            output = output + (char)c;
        }

        // Destroy the proccess when you get the desired message
        proc.destroy(); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T11:37:39.977

[我在这个 stackoverflow question](https://stackoverflow.com/questions/609762/need-sample-java-code-to-run-a-shellscript/609783#609783)上写了一个命令行执行的答案。

你的有点棘手，因为你可能需要回复。

在您的情况下，我可能需要为输入流 gbbler 提供类似回复通道的内容：

```
 StreamGobbler outputGobbler = new StreamGobbler(
                                    proc.getInputStream(), "OUTPUT", 
                                    proc.getOutputStream()); 
```

并使其匹配模式并回复给定的输入流。

```
while ((line = br.readLine()) != null) {
    System.out.println(type + ">" + line);
    if (line.contains(PRESS_KEY_CONTINUE) {
        ostream.write("y".getBytes("US-ASCII")); 
        System.out.println("< y"); 
    }
} 
```

希望这可以帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-16T12:07:40.857

所以这是我对这个问题的解决方法，灵感来自 Alnitak 的建议：运行如下命令：

```
Process p = Runtime.getRuntime().exec(cmd + " < c:\\someTextFile.txt", null, cmdDir);
...
int errCode = p.waitFor();
... 
```

可以通过编程将“someTextFile.txt”创建到临时目录中，然后将其删除。

# design-patterns - Spring框架中使用了哪些设计模式？

> ID：755563
> 
> 赞同：91
> 
> 时间：2009-04-16T10:40:42.733
> 
> 标签：design-patterns, spring

Spring框架中使用了哪些设计模式？

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-04-16T10:51:31.210

使用了许多不同的设计模式，但有一些明显的：

*   代理 - 在[AOP](http://static.springframework.org/spring/docs/2.5.x/reference/aop.html#aop-understanding-aop-proxies)和[远程处理](http://static.springframework.org/spring/docs/2.5.x/reference/remoting.html)中大量使用。

*   单例 - 在 spring 配置文件中定义的 bean 默认是单例的。

*   模板方法 - 广泛用于处理样板重复代码（例如干净地关闭连接等）。例如[JdbcTemplate](http://static.springframework.org/spring/docs/2.5.x/reference/jdbc.html#jdbc-JdbcTemplate)、[JmsTemplate](http://static.springframework.org/spring/docs/2.5.x/reference/jms.html#jms-jmstemplate)、[JpaTemplate](http://static.springframework.org/spring/docs/2.5.x/reference/orm.html#orm-jpa-template)。

* * *

更新以下评论：对于 MVC，您可能需要阅读[MVC 参考](http://static.springframework.org/spring/docs/2.5.x/reference/mvc.html)

MVC 中使用的一些明显模式：

*   [模型视图控制器](https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller):-)。Spring MVC 的优势在于您的控制器是 POJO，而不是 servlet。这使得控制器的测试更容易。需要注意的一点是，控制器只需要返回一个逻辑视图名称，视图选择留给单独的[ViewResolver](http://static.springframework.org/spring/docs/2.5.x/reference/mvc.html#mvc-viewresolver)。这使得为​​不同的视图技术重用控制器变得更容易。

*   [前控制器](https://www.oracle.com/technetwork/java/frontcontroller-135648.html)。Spring 提供[DispatcherServlet](http://static.springsource.org/spring/docs/2.5.x/api/org/springframework/web/servlet/DispatcherServlet.html)以确保将传入的请求分派到您的控制器。

*   [View Helper](https://www.oracle.com/technetwork/java/viewhelper-139885.html) - Spring 有许多自定义 JSP 标记和速度宏，以帮助将代码与视图中的表示分离。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-16T14:14:14.250

And of course dependency injection, or IoC (inversion of control), which is central to the whole BeanFactory/ApplicationContext stuff.

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-30T19:50:09.713

DI 的东西实际上是某种策略模式。每当您想成为一些可交换的逻辑/实现时，您通常会在主机类上找到一个接口和一个适当的 setter 方法来连接该接口的自定义实现。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-17T15:09:50.943

Spring 是最佳实践 API 模式的集合，只要你的手臂，你就可以写出它们的购物清单。API 的设计方式鼓励您（但不强迫您）遵循这些模式，并且有一半的时间您在不知道自己正在这样做的情况下遵循它们。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-02-14T11:31:43.160

服务定位器模式 - ServiceLocatorFactoryBean 保存上下文中所有 bean 的信息。当客户端代码使用名称请求服务（bean）时，它只是在上下文中找到该 bean 并返回它。客户端代码不需要编写spring相关的代码来定位一个bean。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-05-01T22:11:10.853

Observer-Observable：用于ApplicationContext的事件机制

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-06-14T09:36:16.033

工厂方法模式： BeanFactory 用于创建对象的实例 Singleton ：实例类型可以是上下文的单例 Prototype ：实例类型可以是原型。建造者模式：你也可以在一个类中定义一个方法来负责创建复杂的实例。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-11-30T16:14:50.733

工厂模式还用于通过 BeanFactory 和应用程序上下文加载 bean。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-01-21T10:07:06.353

Spring 容器根据 bean 范围（单例、原型等）生成 bean 对象。所以这看起来像是实现[抽象工厂模式](http://en.wikipedia.org/wiki/Abstract_factory_pattern)。在 Spring 的内部实现中，我确信每个作用域都应该绑定到特定的工厂类。

# language-agnostic - 抽象类中的空方法

> ID：755566
> 
> 赞同：8
> 
> 时间：2009-04-16T10:42:45.443
> 
> 标签：language-agnostic, design-patterns, static-analysis

我刚刚安装了 PMD 来分析我的 Java 项目。非常好的工具，强烈推荐。无论如何，我有一些错误说：

> “抽象类中的空方法应该是抽象的”

我查看了 PMD 文档，解释说：

> 因为开发人员可能会依赖这个空的实现而不是编写适当的代码

所以我想我理解这个代码样式错误背后的原因，但考虑以下场景：我有一个名为 Entity 的抽象类。这个类有一个默认实现的布尔方法。（控制是否在删除时删除其相关实体）。只有少数派生类将此默认行为覆盖为 true。

我应该删除默认实现并强制所有派生类声明它们的行为吗？你真的认为这种模式是一种糟糕的做法吗？

**澄清：** PMD 将具有单个返回语句的方法视为空。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-16T10:45:32.300

我认为这只是一个指导方针。它告诉您，您可能想重新考虑您的设计，但如果您的设计已经非常有意义，那么没有理由服从软件而不是您的大脑。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-09-01T12:54:59.737

如果您使用的是 Java 1.8，则可以使 Entity 成为**接口**而不是抽象类，并在其中为您的方法编写**默认**实现。

```
public interface Entity {
    default boolean yourMethod() {
        //default implementation ...
    }
} 
```

您可以将其用作参考： [https ://docs.oracle.com/javase/tutorial/java/IandI/defaultmethods.html](https://docs.oracle.com/javase/tutorial/java/IandI/defaultmethods.html)

# mysql - 为什么我添加新索引时 MySQL 中索引的基数保持不变？

> ID：755569
> 
> 赞同：10
> 
> 时间：2009-04-16T10:43:45.237
> 
> 标签：mysql, indexing, full-text-search, cardinality

我已将 FULLTEXT 索引添加到我的 MySQL 数据库表之一，如下所示：

```
ALTER TABLE members ADD FULLTEXT(about,fname,lname,job_title); 
```

问题是使用*phpmyadmin*我可以看到我的新索引的基数只有**1**。这是否意味着永远不会使用索引？

我已经运行了一个分析表命令，但它似乎没有做任何事情。

```
analyze table members 
```

索引字段的各自类型是 varchar(100)、varchar(100)、text、varchar(200)，使用的引擎是 MyISAM，表大约有 30,000 行，都是唯一的。我的 MySQL 版本是 5.0.45。

难道我做错了什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-16T10:53:36.040

如果表中只有 1 行，那么索引的基数当然应该是 1。它只是计算唯一值的数量。

如果您将索引视为基于桶的查找表（如哈希），那么基数就是桶的数量。

它的工作原理如下：当您在一组列上构建索引时`(a,b,c,d)`，数据库会遍历表中的所有行，查看每行的这 4 列的有序四组。假设您的表格如下所示：

```
a  b  c  d  e   
-- -- -- -- --  
1  1  1  1  200 
1  1  1  1  300
1  2  1  1  200
1  3  1  1  200 
```

所以数据库查看的只是 4 列（a、b、c、d）：

```
a  b  c  d  
-- -- -- --
1  1  1  1 
1  2  1  1 
1  3  1  1 
```

看到只剩下 3 个唯一的行了吗？那些将成为我们的桶，但我们会回到那个。实际上，表中的每一行还有一个记录 ID 或行标识符。所以我们原来的表格是这样的：

```
(row id) a  b  c  d  e   
-------- -- -- -- -- --  
00000001 1  1  1  1  200 
00000002 1  1  1  1  300
00000003 1  2  1  1  200
00000004 1  3  1  1  200 
```

因此，当我们只查看 (a,b,c,d) 的 4 列时，我们实际上也在查看行 id：

```
(row id) a  b  c  d 
-------- -- -- -- --
00000001 1  1  1  1
00000002 1  1  1  1
00000003 1  2  1  1
00000004 1  3  1  1 
```

但是我们想通过 (a,b,c,d) 而不是 row id 进行查找，所以我们生成如下内容：

```
(a,b,c,d) (row id)
--------- --------
1,1,1,1   00000001
1,1,1,1   00000002
1,2,1,1   00000003
1,3,1,1   00000004 
```

最后，我们将具有相同 (a,b,c,d) 值的行的所有行 ID 组合在一起：

```
(a,b,c,d) (row id)
--------- ---------------------
1,1,1,1   00000001 and 00000002
1,2,1,1   00000003
1,3,1,1   00000004 
```

看到了吗？(a,b,c,d) 的值，即 (1,1,1,1) (1,2,1,1) 和 (1,3,1,1) 已成为我们查找表的键到原始表的行中。

实际上，这一切都没有真正发生，但它应该让您对如何完成索引的“幼稚”（即直接）实现有一个很好的了解。

但底线是：基数只是衡量索引中有多少唯一行。在我们的示例中，这是我们查找表中的键数，即 3。

希望有帮助！

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-16T11:30:41.397

我不能肯定地回答为什么 MySQL 不计算基数，但我可以猜到。[MySQL手册](http://dev.mysql.com/doc/refman/5.1/en/show-index.html)指出：

> 基数：对索引中唯一值数量的估计。这是通过运行 ANALYZE TABLE 或 myisamchk -a 来更新的。基数是根据存储为整数的统计信息计算的，因此即使对于小型表，该值也不一定准确。基数越高，MySQL 在进行连接时使用索引的机会就越大。

FULLTEXT 索引仅用于 MATCH ... AGAINST (...) 查询，这会强制使用索引。如果这些字段上没有 FULLTEXT 索引，则 MATCH ... AGAINST 语法不起作用。

我的猜测是没有计算基数，因为**它确实没有必要**。

请注意，即使未设置基数，也可以对索引进行搜索。

作为记录，ANALYZE TABLE foobar 语句似乎正确设置了基数。

# .net - 如何快速检查文件夹是否为空（.NET）？

> ID：755574
> 
> 赞同：160
> 
> 时间：2009-04-16T10:45:14.220
> 
> 标签：.net, io, directory

我必须检查磁盘上的目录是否为空。这意味着，它不包含任何文件夹/文件。我知道，有一个简单的方法。我们得到 FileSystemInfo 的数组并检查元素的数量是否为零。像这样的东西：

```
public static bool CheckFolderEmpty(string path)
{
    if (string.IsNullOrEmpty(path))
    {
        throw new ArgumentNullException("path");
    }

    var folder = new DirectoryInfo(path);
    if (folder.Exists)
    {
        return folder.GetFileSystemInfos().Length == 0;
    }

    throw new DirectoryNotFoundException();
} 
```

这种方法似乎还可以。但！！从性能的角度来看，这是非常非常糟糕的。**GetFileSystemInfos()**是一个非常困难的方法。实际上，它枚举文件夹的所有文件系统对象，获取它们的所有属性，创建对象，填充类型数组等。所有这些只是为了简单地检查长度。这很愚蠢，不是吗？

我刚刚分析了这样的代码并确定，大约 250 次这样的方法调用在大约 500 毫秒内执行。这非常慢，我相信，有可能做得更快。

有什么建议么？

* * *

## 回答 #1

> 赞同：317
> 
> 时间：2009-06-05T08:33:58.153

.NET 4 中有一个新特性`Directory`，`DirectoryInfo`允许它们返回一个`IEnumerable`而不是数组，并在读取所有目录内容之前开始返回结果。

*   [.NET 4 Beta 1 中 BCL 的新增功能](https://docs.microsoft.com/archive/blogs/bclteam/whats-new-in-the-bcl-in-net-4-beta-1-justin-van-patten)
*   [`Directory.EnumerateFileSystemEntries`方法重载](https://docs.microsoft.com/dotnet/api/system.io.directory.enumeratefilesystementries#overloads)

```
public bool IsDirectoryEmpty(string path)
{
    IEnumerable<string> items = Directory.EnumerateFileSystemEntries(path);
    using (IEnumerator<string> en = items.GetEnumerator())
    {
        return !en.MoveNext();
    }
} 
```

* * *

编辑：再次看到那个答案，我意识到这段代码可以变得更简单......

```
public bool IsDirectoryEmpty(string path)
{
    return !Directory.EnumerateFileSystemEntries(path).Any();
} 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-04-16T20:31:44.207

这是我最终实施的超快速解决方案。这里我使用 WinAPI 和函数*FindFirstFile*，*FindNextFile*。它允许避免枚举 Folder 中的所有项目，并**在检测到 Folder 中的第一个对象后立即停止**。这种方法比上面描述的要快 6(!!) 倍。36 毫秒内调用 250 次！

```
private static readonly IntPtr INVALID_HANDLE_VALUE = new IntPtr(-1);

[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Auto)]
private struct WIN32_FIND_DATA
{
    public uint dwFileAttributes;
    public System.Runtime.InteropServices.ComTypes.FILETIME ftCreationTime;
    public System.Runtime.InteropServices.ComTypes.FILETIME ftLastAccessTime;
    public System.Runtime.InteropServices.ComTypes.FILETIME ftLastWriteTime;
    public uint nFileSizeHigh;
    public uint nFileSizeLow;
    public uint dwReserved0;
    public uint dwReserved1;
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 260)]
    public string cFileName;
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 14)]
    public string cAlternateFileName;
}

[DllImport("kernel32.dll", CharSet=CharSet.Auto)]
private static extern IntPtr FindFirstFile(string lpFileName, out WIN32_FIND_DATA lpFindFileData);

[DllImport("kernel32.dll", CharSet=CharSet.Auto)]
private static extern bool FindNextFile(IntPtr hFindFile, out WIN32_FIND_DATA lpFindFileData);

[DllImport("kernel32.dll")]
private static extern bool FindClose(IntPtr hFindFile);

public static bool CheckDirectoryEmpty_Fast(string path)
{
    if (string.IsNullOrEmpty(path))
    {
        throw new ArgumentNullException(path);
    }

    if (Directory.Exists(path))
    {
        if (path.EndsWith(Path.DirectorySeparatorChar.ToString()))
            path += "*";
        else
            path += Path.DirectorySeparatorChar + "*";

        WIN32_FIND_DATA findData;
        var findHandle = FindFirstFile(path, out findData);

        if (findHandle != INVALID_HANDLE_VALUE)
        {
            try
            {
                bool empty = true;
                do
                {
                    if (findData.cFileName != "." && findData.cFileName != "..")
                        empty = false;
                } while (empty && FindNextFile(findHandle, out findData));

                return empty;
            }
            finally
            {
                FindClose(findHandle);
            }
        }

        throw new Exception("Failed to get directory first file",
            Marshal.GetExceptionForHR(Marshal.GetHRForLastWin32Error()));
    }
    throw new DirectoryNotFoundException();
} 
```

我希望它对将来的某些人有用。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2009-04-16T10:54:13.573

你可以尝试`Directory.Exists(path)`-`Directory.GetFiles(path)`可能更少的开销（没有对象 - 只是字符串等）。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-04-16T10:56:38.467

```
private static void test()
{
    System.Diagnostics.Stopwatch sw = new System.Diagnostics.Stopwatch();
    sw.Start();

    string [] dirs = System.IO.Directory.GetDirectories("C:\\Test\\");
    string[] files = System.IO.Directory.GetFiles("C:\\Test\\");

    if (dirs.Length == 0 && files.Length == 0)
        Console.WriteLine("Empty");
    else
        Console.WriteLine("Not Empty");

    sw.Stop();
    Console.WriteLine(sw.ElapsedMilliseconds);
} 
```

当文件夹为空以及包含子文件夹和文件（5 个文件夹，每个文件夹 5 个文件）时，此快速测试在 2 毫秒内返回

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2016-05-30T07:56:55.030

我将它用于文件夹和文件（不知道它是否最佳）

```
 if(Directory.GetFileSystemEntries(path).Length == 0) 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-06-05T08:15:26.317

如果您不介意离开纯 C# 并进行**WinApi**调用，那么您可能需要考虑**[PathIsDirectoryEmpty()](http://msdn.microsoft.com/en-us/library/bb773623.aspx)**函数。根据MSDN，功能：

> 如果 pszPath 是空目录，则返回 TRUE。如果 pszPath 不是一个目录，或者它至少包含一个“.”以外的文件，则返回 FALSE 或者 ”..”。

这似乎是一个完全符合您要求的功能，因此它可能已针对该任务进行了很好的优化（尽管我尚未对此进行测试）。

要从 C# 调用它，**[pinvoke.net](http://pinvoke.net/)**站点应该可以帮助您。（不幸的是，它还没有描述这个特定的函数，但是你应该能够找到一些具有相似参数和返回类型的函数，并将它们用作调用的基础。如果你再次查看 MSDN，它会说要导入的 DLL 是`shlwapi.dll`）

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-04-16T10:55:15.490

我不知道这个的性能统计，但是你试过使用`Directory.GetFiles()`静态方法吗？

它返回一个包含文件名（不是 FileInfos）的字符串数组，您可以使用与上述相同的方式检查数组的长度。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-12-21T19:25:09.130

我确信其他答案更快，并且您的问题询问文件夹是否包含文件或文件夹......但我认为大多数时候人们会认为如果目录不包含文件则为空。即，如果它包含空的子目录，它对我来说仍然是“空的”......这可能不适合您的使用，但可能适合其他人！

```
 public bool DirectoryIsEmpty(string path)
  {
    int fileCount = Directory.GetFiles(path).Length;
    if (fileCount > 0)
    {
        return false;
    }

    string[] dirs = Directory.GetDirectories(path);
    foreach (string dir in dirs)
    {
      if (! DirectoryIsEmpty(dir))
      {
        return false;
      }
    }

    return true;
  } 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2018-01-23T00:32:33.617

简单易行：

```
public static bool DirIsEmpty(string path) {
    int num = Directory.GetFiles(path).Length + Directory.GetDirectories(path).Length;
    return num == 0;
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-04-16T10:55:56.940

在任何情况下，您都必须通过硬盘驱动器获取这些信息，仅此一项就胜过任何对象创建和数组填充。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-04-16T10:56:44.130

我不知道有一种方法可以简洁地告诉您给定文件夹是否包含任何其他文件夹或文件，但是，使用：

```
Directory.GetFiles(path);
&
Directory.GetDirectories(path); 
```

应该有助于提高性能，因为这两种方法都只会返回带有文件/目录名称的字符串数组，而不是整个 FileSystemInfo 对象。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-04-16T11:29:38.590

谢谢大家的回复。我尝试使用**Directory.GetFiles()**和**Directory.GetDirectories()**方法。好消息！性能提高了~两倍！229 次呼叫在 221 毫秒内。但我也希望，可以避免枚举文件夹中的所有项目。同意，仍然在执行不必要的工作。你不这么认为吗？

经过所有的调查，我得出一个结论，在纯 .NET 下进一步优化是不可能的。我将使用 WinAPI 的**FindFirstFile**函数。希望它会有所帮助。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-03-21T07:10:29.133

有时您可能想验证子目录中是否存在任何文件并忽略那些空的子目录；在这种情况下，您可以使用以下方法：

```
public bool isDirectoryContainFiles(string path) {
    if (!Directory.Exists(path)) return false;
    return Directory.EnumerateFiles(path, "*", SearchOption.AllDirectories).Any();
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-10-15T15:16:20.350

基于**Brad Parks**代码：

```
 public static bool DirectoryIsEmpty(string path)
    {
        if (System.IO.Directory.GetFiles(path).Length > 0) return false;

        foreach (string dir in System.IO.Directory.GetDirectories(path))
            if (!DirectoryIsEmpty(dir)) return false;

        return true;
    } 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-11-26T16:45:00.203

由于无论如何您都将使用 DirectoryInfo 对象，因此我将使用扩展名

```
public static bool IsEmpty(this DirectoryInfo directoryInfo)
{
    return directoryInfo.GetFileSystemInfos().Count() == 0;
} 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2009-04-16T11:33:11.563

我的代码很棒，它只用了**00:00:00.0007143** 不到毫秒，文件夹中有 34个文件

```
 System.Diagnostics.Stopwatch sw = new System.Diagnostics.Stopwatch();
    sw.Start();

     bool IsEmptyDirectory = (Directory.GetFiles("d:\\pdf").Length == 0);

     sw.Stop();
     Console.WriteLine(sw.Elapsed); 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2017-06-06T08:56:45.603

这里有一些可以帮助你做到这一点的东西。我设法在两次迭代中做到了。

```
 private static IEnumerable<string> GetAllNonEmptyDirectories(string path)
   {
     var directories =
        Directory.EnumerateDirectories(path, "*.*", SearchOption.AllDirectories)
        .ToList();

     var directoryList = 
     (from directory in directories
     let isEmpty = Directory.GetFiles(directory, "*.*", SearchOption.AllDirectories).Length == 0
     where !isEmpty select directory)
     .ToList();

     return directoryList.ToList();
   } 
```

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2012-09-06T18:17:22.027

用这个。这很简单。

```
Public Function IsDirectoryEmpty(ByVal strDirectoryPath As String) As Boolean
        Dim s() As String = _
            Directory.GetFiles(strDirectoryPath)
        If s.Length = 0 Then
            Return True
        Else
            Return False
        End If
    End Function 
```

# c++ - 有没有办法在“类”类型实体中对一组肥皂方法进行逻辑分组？

> ID：755575
> 
> 赞同：1
> 
> 时间：2009-04-16T10:45:26.107
> 
> 标签：c++, web-services, soap, air

对于我们基于 C++ 的大型项目，我们现在有一种方法可以自动生成代码，以将我们的代码公开为 SOAP 方法。这非常有效，我们计划开始使用基于我们公开的 API 的 Adob​​e AIR / Flex 实现基于 RIA 的应用程序。

我的问题是关于组织 SOAP 网络服务。我的代码公开了在我们的 C++ 代码中属于类的各个方法调用。到目前为止，我已经通过在它们前面加上它们在 C++ 中来自的类的名称来命名公开的方法。然而，理想情况下，有一种方法可以在 SOAP 服务中对方法进行逻辑分组，这样我就不必执行此步骤，并且一旦绑定到特定组（AKA 类），就可以请求服务SOAP 服务使用目标语言的 WSDL 文件。

我真的希望能够在我们的客户端应用程序中重现位于服务器端 SOAP 层后面的类结构。现在，我可以看到我可以通过使用方法名称来确定它们属于哪个类来做到这一点，但如果我能以更简洁的方式将它们分开，我会更喜欢它。

期待听到您的 SOAP 专家对此事的了解。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T18:47:51.240

我花了一个下午的时间研究这个，似乎我有两个选择，我已经模拟了这两个选项，并且这两个选项都有效：我只是不确定现在哪个是最好的！

*   根据它们来自的类在逻辑上分组的不同“服务”中的方法分开。可以在同一个 WSDL 文件中包含多个 SOAP“服务”，因此客户端仍然可以通过仅访问一个 URL 来发现它们。
*   将这些方法分离到同一个 SOAP 服务上的不同“端口”中。

我对使用哪个感到困惑，因为根据规范，端口是“一个或多个端点支持的抽象操作集”，而服务是“相关端点的集合”。这表明将操作组合在一起的正确方法是使用端口。

# mobile-phones - 使用手机编码

> ID：755576
> 
> 赞同：6
> 
> 时间：2009-04-16T10:45:29.647
> 
> 标签：mobile-phones

我想知道这个世界上是否有任何手机可以让我们编译或解释我们输入的任何代码？

假设我想编写一个像[http://projecteuler.net](http://projecteuler.net)这样的简单程序，但我在附近找不到任何计算机。我真的很想在乘坐公共交通工具回家或等公共汽车时使用我的手机进行编码。

键盘不会成为问题，因为 QWERTY 足以输入代码。语言可以是 pascal、php 或其他轻量级语言。

IDE 不必很复杂，文本编辑器就可以了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T11:00:29.487

有许多可用于移动设备的 Python 解释器。初学者请查看[适用于移动设备的 Python 。](http://www.awaretek.com/pymo.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T10:51:52.737

我建议你买一个轻便的上网本随身携带。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T11:01:29.127

我认为您应该查看[python 的 s60](http://opensource.nokia.com/projects/pythonfors60/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T11:44:29.117

我通常使用MidpSSH（手机的JAVA SSH客户端）并通过GPRS连接到我家的盒子。这样您就可以访问服务器拥有的所有内容。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-04-02T10:48:50.200

[http://codepad.org](http://codepad.org)即使在任何移动浏览器上也能很好地工作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-07-20T18:33:59.473

您可以使用[MacinCloud](http://www.macincloud.com/)。您的移动设备可以变成 Mac，因此您将能够在手机上运行开发程序，例如 python 或 Xcode。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T10:48:07.147

I once saw a HTML editor for Symbian S60 devices And also I used putty tool for telnet on Symbian S60

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-16T10:55:05.087

如果您使用其中一个 OpenMoko，您可能拥有一个成熟的 linux 供您使用，并且您可以像在资源有限的桌面上一样做任何事情。

不知道是否出售任何带有可用键盘的产品。

Addit：这让我想起了我的 zaurus 时代，那时我有一个完整的 MySQL 服务器、webserver 和 ssh 在上面运行。

与有限的 PocketWindowsCE 东西相比，那东西踢了一些严重的屁股。不幸的是，它在 PIM 功能方面受到了严重打击，但极客因素非常值得:)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-16T11:02:13.197

我只是通过电子邮件给自己发短信，然后再编译。:-)

# asp.net-mvc - ASP.NET MVC, Manipulating URL Structure

> ID：755579
> 
> 赞同：2
> 
> 时间：2009-04-16T10:47:07.773
> 
> 标签：asp.net-mvc, url-rewriting, friendly-url

How do I create a custom route handler in ASP.NET MVC?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T14:12:22.787

ASP.NET MVC makes it easy to create a custom route handler in the Global.asax.cs:

```
 routes.MapRoute(
        "Default",
        "{controller}.aspx/{action}/{id}",
        new { action = "Index", id = "" }
      ).RouteHandler = new SubDomainMvcRouteHandler(); 
```

This will result in all requests being handled by the custom RouteHandler specified. For this particular handler:

```
 public class SubDomainMvcRouteHandler : MvcRouteHandler
    {
        protected override IHttpHandler GetHttpHandler(System.Web.Routing.RequestContext requestContext)
        {
            return new SubDomainMvcHandler(requestContext);
        }
    } 
```

You can then do whatever you want, in this case the SubDomainMvcHandler grabs the subdomain from the URL and passes it through to the controller as a property:

```
 public class SubDomainMvcHandler : MvcHandler
    {
        public SubDomainMvcHandler(RequestContext requestContext) : base(requestContext)
        {
        }

        protected override void ProcessRequest(HttpContextBase httpContext)
        {
            // Identify the subdomain and add it to the route data as the account name
            string[] hostNameParts = httpContext.Request.Url.Host.Split('.');

            if (hostNameParts.Length == 3 && hostNameParts[0] != "www")
            {
                RequestContext.RouteData.Values.Add("accountName", hostNameParts[0]);
            }

            base.ProcessRequest(httpContext);
        }
    } 
```

# .net - 在 .NET 云中运行分布式计算的框架

> ID：755595
> 
> 赞同：1
> 
> 时间：2009-04-16T10:52:50.800
> 
> 标签：.net, azure, distributed, hadoop, cloud

我正在考虑开发一个**框架来简化在****Windows Azure**的 .NET 云环境中运行的分布式计算。

Azure 目前（很可能在发布时）完全不适合在云中简单地运行分布式查询（[详细信息](http://abdullin.com/journal/2009/4/11/cloud-computing-could-windows-azure-catch-up-with-amazon.html)）。对我来说很*简单，比如*[DryadLINQ](http://research.microsoft.com/en-us/projects/DryadLINQ/)，您可以在其中编写查询：

```
var results = from c in collection
  where IsLegal(c.Key)
  select new 
  { 
    Key = Hash(c.Key), 
    Result = RunModel(c.Value); 
  }; 
```

并让它在集群中的多台机器上远程执行。无需担心部署、存储或配置。

您可以建议查看哪些资源、论文或开源项目以获取有关该主题的更多信息（尤其是调度和 DAG 优化）？

*到目前为止，我一直在研究 Hadoop（由 Amazon Elastic Map Reduce 使用）和 DryadLINQ。显然，这包括谷歌搜索。*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T11:13:31.717

[Google Research](http://research.google.com/pubs/papers.html)上有很多有趣的论文。

如果您还没有阅读[MapReduce 论文，它可能是一个不错的起点。](http://labs.google.com/papers/mapreduce-osdi04.pdf)

# sql-server - varchar(N) 中的 N 指的是什么

> ID：755598
> 
> 赞同：5
> 
> 时间：2009-04-16T10:53:00.147
> 
> 标签：sql-server, database

varchar(N) 中的 N 在描述数据库中的字段时指的是什么。是字符数还是字节数。此外，一个使用 UTF-8，一个字符可能使用多个字节。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T10:54:11.250

这是最大字符数。

`nvarchar(1000)`= 最多 1000 个 Unicode 字符。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T10:57:29.103

`varchar`不能容纳 Unicode 字符，因此`n`in`varchar(n)`表示字符数和字节数。如果`nvarchar(n)`是Unicode 字符数，则存储大小为字节`n`的两倍。`n`

如果您查询`information_schema.columns`，除其他外，将有两列特别感兴趣：`CHARACTER_MAXIMUM_LENGTH`和`CHARACTER_OCTET_LENGTH`。前者保存字符数，后者包含字节数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T10:54:17.240

1.  nr 个字符

# sql - 如何在 '.' 之前提取 0

> ID：755603
> 
> 赞同：0
> 
> 时间：2009-04-16T10:54:43.120
> 
> 标签：sql, database

```
select 00.0004 ||' ' || 'USD/MT' from dual 
```

这给出了 o/p 为

```
.0004 USD/MT 
```

我还想要小数点前的 0，这样我就可以得到 0.0004 USD/MT 的结果

谁能帮我吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T11:09:01.760

由于连接运算符，您的`00.0004`变量被视为浮点数（或双精度数）并使用默认转换格式自动转换为字符串。

如果变量确实是一个字符串，请将其括在引号中。

如果它实际上是从数据库列中提取的实际值，请使用适当的函数：

```
 TO_CHAR(field, '0.9999') 
```

在将其与其他字段连接之前，将其转换为按要求格式化的字符串。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T11:10:14.720

如果它确实是 Oracle - 然后将“select 00.0004”替换为：

选择 to_char(00.0004,'0.9999')

本示例中使用的 Oracle 中的 to_char 函数将一个值作为第一个参数，将一个格式字符串作为第二个参数。0 告诉系统即使值为零也保留此数字占位符。

# c# - 什么是用于 WaitHandle.WaitOne 方法的 exitContext

> ID：755608
> 
> 赞同：33
> 
> 时间：2009-04-16T10:55:54.227
> 
> 标签：c#, multithreading

例子

```
System.Threading.AutoResetEvent e = new System.Threading.AutoResetEvent(false);
bool b = e.WaitOne(1000, false); 
```

我曾经做过很多多线程开发，并且一直想知道该方法的用途是什么。WaitOne 上的第二个布尔参数称为 exitContext。MS Help 声明“true 表示在等待之前退出上下文的同步域（如果在同步上下文中），然后重新获取它；否则为 false。”

有人知道这意味着什么吗？这是我应该担心的事情吗？

亲切的问候诺埃尔

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-16T11:02:19.843

我不能要求信用（因此是 wiki），但这里有一个很好的[答案](http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/ea5aea17-555c-4549-8d32-bbab14b35a77)。

# php - CakePHP 中保存数据的最佳实践，在组件中使用模型

> ID：755610
> 
> 赞同：12
> 
> 时间：2009-04-16T10:56:02.180
> 
> 标签：php, cakephp

我正在编写一个 Cake 组件，我用它来保存数据而不是在控制器中这样做似乎是有道理的。在手册中，它说不鼓励在组件中使用模型，但另一种方法意味着我将在控制器中重复代码。

该组件基本上分析来自各种来源的数据负载，然后将为各种模型插入数据。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-16T14:00:45.687

如果组件*分析来自各种来源的大量数据*，它可能会被写成一种行为。

如果没有，并且您别无选择，只能在组件中使用模型，请务必正确执行：

```
$this->ModelName = ClassRegistry::init('ModelName'); 
```

我个人认为这没有问题，因为核心组件（例如 Acl 组件）就是这样做的。只要您的组件处理*应用程序逻辑*并且模型处理*数据*，您就可以了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T12:25:41.263

在我看来，DRY 是关键路径。为此，我看到了两种选择：

1.  不要将数据保存在组件中，而是以可以从控制器保存的原始形式将其返回给控制器。
2.  继续将模型导入组件并执行您需要执行的操作。不鼓励这样做，但它们确实使它相当容易。

如果它归结为一个艰难的选择，我宁愿保持我的应用程序干燥，而不是保持严格的 MVC 纪律。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-29T23:21:23.643

有人可能会争辩说，如果您想编写在组件中生成的数据并且能够将组件打包以进行分发，那么在组件中加载模型是有意义的（特别是如果模型是组件的一部分）。

例如，我有一个 authorize.net AIM（信用卡授权）组件。

从我的控制器中，我调用组件充电功能。Authorize.net 向我发送响应（在组件内），根据 DRY，我希望将数据保存在组件内，这样我就不必从调用收费函数的任何地方重复保存数据。

偏离常规的另一个好处是我可以在组件中使用模型，而不必在应用程序中使用模型。

你怎么看？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-02T02:23:42.617

使用我熟悉的 Cake 版本（1.3、2.0），您可以从另一个控制器请求Action。这显然也是不好的做法，但它们提供该功能的原因很明显。我在某些情况下使用过它，但是在尝试来回传递数据时我得到了粗略的结果。除了简单的功能外，我也会避免使用这种方法。

# java - 如何使用 Java 在文件系统中“走动”

> ID：755613
> 
> 赞同：4
> 
> 时间：2009-04-16T10:56:58.997
> 
> 标签：java, linux, filesystems

我想从java中搜索文件夹/目录，然后进入java中的那些文件夹/目录。我猜它被称为系统实用程序？那里有任何教程或有关该主题的书籍吗？

谢谢 ;）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-16T11:01:55.427

我使用此代码获取文件夹中的所有 ZIP 文件。调用这个递归地检查文件对象是否是一个子目录。

```
public List<String> getFiles(String folder) {

List<String> list = new ArrayList<String>();
        File dir = new File(folder);
        if(dir.isDirectory()) {
            FileFilter filter = new FileFilter() {

                public boolean accept(File file) {
                    boolean flag = false;
                    if(file.isFile() && !file.isDirectory()) {
                        String filename = file.getName();
                        if(!filename.endsWith(".zip")) {
                            return true;
                        }
                        return false;   
                }

            };
            File[] fileNames = dir.listFiles(filter);
            for (File file : fileNames) {
                list.add(file.getName());
            }
            return list; 
```

}

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T11:03:40.463

您可以使用 Apache Commons FileUtils（参见：[http](http://commons.apache.org/io/api-release/org/apache/commons/io/FileUtils.html) ://commons.apache.org/io/api-release/org/apache/commons/io/FileUtils.html ），特别是那里的 listFiles 方法，它可以递归地执行此操作，并且使用过滤器（这样它可以节省您自己编写递归并回答您提到的搜索）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T11:02:11.917

如果要导航文件系统，请查看[File](http://java.sun.com/javase/6/docs/api/java/io/File.html)和 list() 方法。您很可能需要一些递归方法来向下浏览层次结构。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T11:05:28.663

我推荐[Apache Commons IO 实用程序。](http://commons.apache.org/io/description.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T11:02:28.890

我不知道有关该特定主题的任何教程或书籍，但这样做的方法是使用该[`java.io.File`](http://java.sun.com/javase/6/docs/api/java/io/File.html)课程。例如，您可以使用[`list()`](http://java.sun.com/javase/6/docs/api/java/io/File.html#list())获取目录内容的列表。然后只需使用`isDirectory()`和递归搜索整个文件树即可。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-16T13:48:57.103

我使用[了 Apache Commons VFS](http://commons.apache.org/vfs/)。

很高兴将它用于读取目录的内容，如下所示：

```
FileSystemManager fsManager = VFS.getManager();
FileObject path = fsManager.resolveFile( "file:///tmp" );

FileObject[] children = path.getChildren();
System.out.println( "Children of " + path.getName().getURI() );
for ( int i = 0; i < children.length; i++ )
{
    System.out.println( children[ i ].getName().getBaseName() );
} 
```

[您可以使用getType()](http://commons.apache.org/vfs/apidocs/org/apache/commons/vfs/FileObject.html#getType())检查 children 是文件、文件夹还是不同的东西。

相同的代码适用于读取 ZIP 或 JAR 文件、FTP、SFTP ......只需更改 resolveFile 的 URL，[如您在此处所见](http://commons.apache.org/vfs/filesystems.html)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T11:01:15.867

您可以使用 java.io.File 类进行搜索。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-16T11:07:17.583

这是另一个例子：

```
 for (File file : File.listRoots()[0].listFiles()) {
        System.out.println(file);
    } 
```

同样，只打印目录：

```
 FileFilter isDirectory = new FileFilter() {

        public boolean accept(File pathname) {
            return pathname.isDirectory();
        }
    };

    for (File file : File.listRoots()[0].listFiles(isDirectory)) {
        System.out.println(file);
    } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-16T11:48:09.047

很好的例子： http: [//www.leepoint.net/notes-java/io/10file/20recursivelist.html](http://www.leepoint.net/notes-java/io/10file/20recursivelist.html)

顺便提一句。我建议阅读全文。[http://www.leepoint.net/notes-java/](http://www.leepoint.net/notes-java/)

# tomcat - 使用 Tomcat 和 Active Directory 进行静默身份验证

> ID：755618
> 
> 赞同：2
> 
> 时间：2009-04-16T11:00:03.747
> 
> 标签：tomcat, active-directory

> **可能重复：**
> [检测使用 Java Web 应用程序登录计算机的用户](https://stackoverflow.com/questions/726249/detect-user-logged-on-a-computer-using-java-web-app)

我需要使用 tomcat 和 J2EE Web App 来做到这一点。我不希望弹出窗口询问用户凭据。

我必须使用登录 Windows 的用户在我的网络应用程序上对他进行身份验证。

我该怎么做？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T22:01:26.760

我不相信 Tomcat 本身就支持集成身份验证，但它确实支持自定义身份验证模块。试试这些网址：

[http://appliedcrypto.com/files/tomcat_spnego.pdf](http://appliedcrypto.com/files/tomcat_spnego.pdf)

[http://jcifs.samba.org/src/docs/ntlmhttpauth.html](http://jcifs.samba.org/src/docs/ntlmhttpauth.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-19T04:23:51.760

Tomcat 不支持 NTLM 身份验证，但有其他 Java 安全库支持，例如 Spring Security。使用 SS，我们有 Tomcat 和 JBoss 应用程序，它们在 IE 和 FF 浏览器中对 MS Active Directory 进行静默身份验证。

这是一个可能有用的 URL：http: [//blog.mediasoft.be/ntlm-with-spring-security-20/](http://blog.mediasoft.be/ntlm-with-spring-security-20/)

# c# - OLEDB，在没有前导撇号的情况下编写 Excel 单元格

> ID：755621
> 
> 赞同：6
> 
> 时间：2009-04-16T11:00:36.680
> 
> 标签：c#, .net, excel, oledb, apostrophe

我正在使用 OLEDB (C#) 写入 Excel 文件。我需要的只是 RAW 数据格式。

我注意到所有单元格（标题和值）都以撇号 (') 为前缀

这是一种避免在所有文本单元格中添加它们的方法吗？

**这是我的连接字符串：**

```
string connectionString = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" +  
 filePath + ";Extended Properties='Excel 8.0;HDR=Yes'"; 
```

**我试过像这样使用 IMEX=1 ：**

```
string connectionString = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" +  
   filePath + ";Extended Properties=\"Excel 8.0;HDR=Yes;IMEX=1\""; 
```

但在那之后我收到以下错误：

*Microsoft Jet 数据库引擎找不到对象“C:\Temp\New Folder\MF_2009_04_19_2008-11-182009_DMBHCSAM1118.xls”。
确保对象存在并且正确拼写其名称和路径名。*

**最后我试过像这样使用 IMEX=0 ：**

```
string connectionString = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" +  
   filePath + ";Extended Properties=\"Excel 8.0;HDR=Yes;IMEX=0\""; 
```

这次没有提出任何例外。

***不幸的是，撇号仍然存在问题（所以我的每个值看起来都是：'123，'abc 等......）***

任何的想法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T15:35:31.153

[http://support.microsoft.com/kb/257819](http://support.microsoft.com/kb/257819)声明通过 ADO 将文本插入 Excel 时这种行为可能是不可避免的：

> **使用 ADO 编辑 Excel 数据的注意事项**：当您使用 ADO 将文本数据插入 Excel 时，文本值前面有一个单引号。这可能会导致以后在处理新数据时出现问题。

数据是显式文本，是否可能被强制转换为数字格式？（抓着稻草……）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T15:25:24.563

你可以只使用 Excel DSN 吗？它似乎无处不在。我不知道 .NET，所以对此持保留态度，但这是我直接从股票表中获取 OLEDB 查询的连接字符串：

```
"Provider=MSDASQL.1;Persist Security Info=True;Extended Properties
=""DSN=Excel Files;DBQ=" & filePath & "\" & fileName &
";DriverId=1046;MaxBufferSize=2048;PageTimeout=5;""" 
```

我使用了这个基本的 INSERT 语句：

```
INSERT INTO rngOutput VALUES (1, 'ABC', '$1.00', 1300) 
```

当我这样做时，我的数据范围内没有任何撇号。我也在使用 Excel 2007，我看到您使用 Excel 8.0 作为驱动程序？

希望这会促使您找到解决方案！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-17T08:24:53.603

为模板文件中附加撇号的列插入一些虚拟值。例如，对于 Name 列输入类似这样的 dummyname，age 列输入 99。不要在模板中插入新行，只需更新行（更新.....其中 Name = 'dummyname' 和 age =99）。

这对我有用..

希望它也对你有用！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-19T01:44:32.673

从连接字符串中删除 IMEX=1。

[http://www.connectionstrings.com/excel](http://www.connectionstrings.com/excel)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T08:03:54.827

我知道在将数据输入 Excel 时，用撇号作为前缀是一种将其放入文本字​​段的简单方法。您确定数据实际上不包含撇号吗？如果它在输入时添加到数据中，您唯一的选择是在导入时捕获它们并在一些自定义代码中处理它们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T21:34:46.330

检查电阻 Hkey_Local_Machine/Software/Microsoft/Jet/4.0/Engines/Excel/TypeGuessRows

这决定了在决定列的格式之前应该扫描多少行。默认值为 8，0 将强制 ADO 在选择适当的数据类型之前扫描所有列值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-22T10:32:08.247

它可能不符合您的要求，特别是如果您需要在 Excel 工作表中设置格式，但您是否考虑将数据写入 CSV 文件并使用 .XLS 扩展名保存？

您可以尝试的另一件事是在尝试加载数据之前在 Excel 工作表中明确设置目标单元格的格式数据类型以键入“文本”（如通过 Excel 中的格式 > 单元格）。默认情况下，单元格将是“常规”类型，驱动程序可能会添加撇号以强制您的数据以文本显示。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-07-22T20:03:15.460

尝试以下 hack 来解决问题。按照说明修改模板

1.  在标题行正下方的第一个数据行中。以所需格式格式化列。
2.  输入一些虚拟值，例如字符空格，数字值 0 等。
3.  隐藏具有虚拟值的第一个数据行并保存模板

现在使用 ADO.net 运行插入脚本

——文卡特·科拉

# asp.net - ASP.NET 登录页面

> ID：755637
> 
> 赞同：3
> 
> 时间：2009-04-16T11:04:29.587
> 
> 标签：asp.net

我想在我的网站上为注册用户添加登录信息。我该如何进行呢？是通过使用会话吗？注销发生后 Session 变量会发生什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T11:24:47.057

您的问题非常广泛，您可以通过多种不同的方式来实现实际上是 ASP.NET 网站的“会员”系统。

我建议您先阅读 MSDN 上的“[会员简介](http://msdn.microsoft.com/en-us/library/yh26yfzy.aspx)”文章。本文将概述 ASP.NET 成员资格如何以最“标准”的方式工作。

它还提到了使用各种 ASP.NET 成员“控件”（例如[Login](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.login.aspx)、[LoginView](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.loginview.aspx)、[LoginStatus](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.loginstatus.aspx)和[PasswordRecovery](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.aspx)）。

将这些控件与内置的 ASP.NET 成员资格提供程序一起使用（例如，ASP.NET 提供了一个[SQL 成员资格提供程序](http://msdn.microsoft.com/en-us/library/ms998317.aspx)来针对 SQL Server 作为用户帐户和凭据的数据存储）将允许您实现完整的成员资格和几乎没有代码的身份验证系统（即所有功能都由内置的“成员”控件和声明性标记提供）。

最后，关于这个主题的一系列非常好的文章是：

[检查 ASP.NET 2.0 的成员资格、角色和配置文件](http://www.4guysfromrolla.com/articles/120705-1.aspx)

来自 4guysfromrolla 网站。它从成员资格主题的最开始开始，一直到接触自定义成员资格提供程序的实现和用于管理用户凭据的管理界面以完善整个主题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T11:15:30.480

我会看一下相关的问题，例如

[登录会员.NET](https://stackoverflow.com/questions/592364/login-membership-net)

这个主题已经在 SO 上涵盖了很多。

会话状态和登录有点正交。无论您是否登录，您都有一个会话。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T11:12:25.090

您应该使用提供的`Login`控件和`Membership`系统。

关于 Session vars，不会发生什么特别的事情。默认情况下，ASP.NET 表单身份验证不使用 SessionState。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T11:15:55.643

我建议将表单身份验证与可能使用 IIdentity 和 IPrincipal 的自定义后端一起使用。有很多可用的信息如何做到这一点，但我认为这个链接是一个很好的起点[http://msdn.microsoft.com/en-us/library/aa480476.aspx](http://msdn.microsoft.com/en-us/library/aa480476.aspx)

# c - C中较大的整数到较小的无符号类型转换

> ID：755639
> 
> 赞同：5
> 
> 时间：2009-04-16T11:04:45.110
> 
> 标签：c

我正在通过k＆r。我在理解第 197 页（第 A6 节）上的以下几行时遇到问题

> 整数转换：通过找到与该整数一致的最小非负值，将任何整数转换为给定的无符号类型，比无符号类型中可以表示的最大值大一模。

任何机构都可以详细解释一下。谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T11:06:11.690

这意味着只有低值位将被计数，高位位将被丢弃。

例如：

```
01111111 11111111 11110000 00001111 
```

当转换为 16 位`unsigned short`时将是：

```
11110000 00001111 
```

这在数学上有效地表示为：

```
target_value = value % (target_type_max+1)           ( % = modulus operator ) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T11:17:16.187

> 通过找到与该整数一致的最小非负值，将任何整数转换为给定的无符号类型，该整数比无符号类型中可以表示的最大值大一模。

让我们一点一点地从后面看：

> 宽度为 n 位的无符号类型可以表示的最大值是多少？

```
2^(n) - 1. 
```

> 比这个值多一个是什么？

```
2^n. 
```

> 转换是如何发生的？

```
unsigned_val = signed_val % 2^n 
```

现在，为什么部分：标准不要求使用什么位表示。因此行话。在二进制补码表示中——这是迄今为止最常用的——这种转换不会改变位模式（当然，除非有截断）。

有关详细信息，请参阅标准的积分转换。

# vb.net - VB.NET Me.Close() 不起作用，表单没有关闭？

> ID：755643
> 
> 赞同：1
> 
> 时间：2009-04-16T11:06:00.037
> 
> 标签：vb.net

该表单是一个关于我们的表单，因此上面没有任何内容，只有一个文本框和一个确定按钮。

```
Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
  Me.Close()
End Sub 
```

这是我打开表单的方式：

```
Private Sub AboutAppStripMenuItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles AboutAppStripMenuItem.Click
    Dim formAbout As New FormAbout()
    formAbout.Show()
End Sub 
```

为什么按钮不会关闭表单？我很困惑，我尝试了另一个按钮以防万一结果相同。

更新：我在 Me.Close() 上设置了一个断点，当我单击按钮时它没有到达它，我创建了一个新按钮并且发生了同样的事情。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T11:17:59.337

我打赌 button1_click 事件的事件处理程序已被无意中删除。

尝试在设计时双击该按钮，看看它是否将您拉回到同一段代码——或一个新的事件处理程序定义。

如果它是一个新的事件处理程序定义 - 将您的代码复制到那里并删除第一个。

还有其他方法可以在设计器的代码隐藏中手动添加事件处理程序 - 但也许这是为了以后的进展。

在 VS 中单击解决方案资源管理器中的“显示所有文件”按钮。获取我们在 .Designer.vb 中的代码并将其粘贴到此处，我们将明确为您确定。

这是我的：

```
 Global.Microsoft.VisualBasic.CompilerServices.DesignerGenerated()> _
Partial Class Form1
    Inherits System.Windows.Forms.Form

    'Form overrides dispose to clean up the component list.
     _
    Protected Overrides Sub Dispose(ByVal disposing As Boolean)
        Try
            If disposing AndAlso components IsNot Nothing Then
                components.Dispose()
            End If
        Finally
            MyBase.Dispose(disposing)
        End Try
    End Sub

    'Required by the Windows Form Designer
    Private components As System.ComponentModel.IContainer

    'NOTE: The following procedure is required by the Windows Form Designer
    'It can be modified using the Windows Form Designer.  
    'Do not modify it using the code editor.
     _
    Private Sub InitializeComponent()
        Me.Button1 = New System.Windows.Forms.Button
        Me.SuspendLayout()
        '
        'Button1
        '
        Me.Button1.Location = New System.Drawing.Point(131, 91)
        Me.Button1.Name = "Button1"
        Me.Button1.Size = New System.Drawing.Size(133, 50)
        Me.Button1.TabIndex = 0
        Me.Button1.Text = "Button1"
        Me.Button1.UseVisualStyleBackColor = True
        '
        'Form1
        '
        Me.AutoScaleDimensions = New System.Drawing.SizeF(6.0!, 13.0!)
        Me.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font
        Me.ClientSize = New System.Drawing.Size(292, 266)
        Me.Controls.Add(Me.Button1)
        Me.Name = "Form1"
        Me.Text = "Form1"
        Me.ResumeLayout(False)

    End Sub
    Friend WithEvents Button1 As System.Windows.Forms.Button

End Class 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T13:50:47.520

我测试了以下

```
Public Class Form1
Private Sub Button1_Click(ByVal sender As System.Object, _
                          ByVal e As System.EventArgs) _
                          Handles Button1.Click
    Dim f As New Form2
    f.Show()
End Sub
End Class

Public Class Form2
Private Sub Button1_Click(ByVal sender As System.Object, _
                          ByVal e As System.EventArgs) _
                          Handles Button1.Click
    Me.Close()
End Sub
End Class 
```

并且没有问题。正如建议的那样，重新创建您的按钮和代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-08-17T19:44:01.753

简单的。

1.  从解决方案资源管理器中选择项目属性。
2.  选择安全选项卡以取消选中“启用 ClickOnce...”或选择“这是一个完全信任的应用程序”。
3.  保存属性设置。

解决了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T11:14:19.110

来自 MSDN：

> 显示控件相当于将 Visible 属性设置为 true。调用 Show 方法后，Visible 属性返回 true 值，直到调用 Hide 方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T11:23:57.667

当formabout打开时

单击视觉工作室中的暂停（全部中断）按钮

在Visual Studio中单击进入调试

点击formabout中的关闭按钮

您将看到执行了哪些代码（如果有）

*** 编辑 ***

另一个问题

formabout.enabled 属性是真的吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-03-16T16:04:24.057

动态添加您的按钮可能会解决问题。将以下代码放置在 about Form 的 load 事件中。

```
Public Sub FormAbout_Load(ByVal sender as object,ByVal e as System.EventArgs)Handles Me.Load

Dim btn as new Button()
AddHandler btn.Click ,AddressOf _ClickToClose 

End Sub 

Private Sub _ClickToClose(ByVal sender as object,ByVal e as System.EventArgs)
  Me.Close()
End Sub 
```

# asp.net - ASP.NET MVC 1.0 AfterBuilding 视图在 TFS 构建上失败

> ID：755645
> 
> 赞同：62
> 
> 时间：2009-04-16T11:07:00.703
> 
> 标签：asp.net, asp.net-mvc, tfsbuild

我已从 ASP.NET MVC Beta 升级到 1.0，并对 MVC 项目进行了以下更改（如 RC 发行说明中所述）：

```
<Project ...>
  ...
  <MvcBuildViews>true</MvcBuildViews>
  ...
  <Target Name="AfterBuild" Condition="'$(MvcBuildViews)'=='true'">
    <AspNetCompiler VirtualPath="temp" PhysicalPath="$(ProjectDir)\..\$(ProjectName)" />
  </Target>
  ...
</Project> 
```

虽然构建在我们的本地开发盒上运行良好，但它在 TFS 2008 构建下失败，并显示“无法加载类型 'xxx.MvcApplication'”，请参见下面的构建日志：

```
...
using "AspNetCompiler" task from assembly "Microsoft.Build.Tasks.v3.5, Version=3.5.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a".
Task "AspNetCompiler"

  Command:
  C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\aspnet_compiler.exe -v temp -p D:\Builds\xxx\Continuous\TeamBuild\Sources\UI\xxx.UI.Dashboard\\..\xxx.UI.Dashboard 
  The "AspNetCompiler" task is using "aspnet_compiler.exe" from "C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\aspnet_compiler.exe".
  Utility to precompile an ASP.NET application
  Copyright (C) Microsoft Corporation. All rights reserved.

/temp/global.asax(1): error ASPPARSE: Could not load type 'xxx.UI.Dashboard.MvcApplication'.
  The command exited with code 1.

Done executing task "AspNetCompiler" -- FAILED.
... 
```

MVC 1.0 安装在 TFS 上，解决方案在同一 TFS 服务器上的 Visual Studio 实例中构建时编译。

如何解决此 TFS 构建问题？

* * *

## 回答 #1

> 赞同：181
> 
> 时间：2010-04-19T20:53:36.557

实际上，这个问题有更好的解决方案。我已经使用 VS/TFS 2010 对其进行了测试，但它也应该适用于 VS/TFS 2008。

```
<Target Name="AfterBuild" Condition="'$(MvcBuildViews)'=='true'">
  <AspNetCompiler VirtualPath="temp" PhysicalPath="$(WebProjectOutputDir)" />
</Target> 
```

我将与 MVC 团队合作更新他们的项目模板以使用这种方法以及自定义目标（而不是覆盖 AfterBuild）。

我发表了一篇关于如何[在 TFS Build 2010 中为 ASP.NET MVC 项目打开编译时视图检查](http://blogs.msdn.com/jimlamb/archive/2010/04/20/turn-on-compile-time-view-checking-for-asp-net-mvc-projects-in-tfs-build-2010.aspx)的博客文章。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-07-08T14:24:50.383

问题源于这样一个事实，即在 ASP.NET MVC 项目的 AfterBuild 目标中使用的 AspNetCompiler MSBuild 任务期望引用 Web 项目的 bin 文件夹中的 dll。

在桌面构建中，bin 文件夹是您在源代码树下所期望的位置。

但是，TFS Teambuild 会将源代码的输出编译到构建服务器上的不同目录。当 AspNetCompiler 任务启动时，它找不到 bin 目录来引用所需的 DLL，并且您会收到异常。

解决方法是将MVC项目的AfterBuild目标修改为如下：

```
 <Target Name="AfterBuild" Condition="'$(MvcBuildViews)'=='true'">
    <AspNetCompiler Condition="'$(IsDesktopBuild)' != 'false'" VirtualPath="temp" PhysicalPath="$(ProjectDir)\..\$(ProjectName)" />
    <AspNetCompiler Condition="'$(IsDesktopBuild)' == 'false'" VirtualPath="temp" PhysicalPath="$(PublishDir)\_PublishedWebsites\$(ProjectName)" />
  </Target> 
```

此更改使您能够在桌面和 TFS 构建服务器上编译视图。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-11-27T17:07:21.600

当我构建我们的 web .csproj 时，Jim Lamb 的解决方案对我们不起作用

```
/p:UseWPP_CopyWebApplication=true;PipelineDependsOnBuild=False 
```

因为目标正在执行`AfterBuild`并且应用程序还没有被复制到`WebProjectOutputDir`。（顺便说一句，我将这些属性传递给 web 项目构建，因为我希望构建创建一个 OutDir 文件夹，其中只有我的二进制文件和适合压缩的 cshtml 文件，即不是就地构建）

为了解决这个问题并尊重他最初目标的意图，我做了以下事情：

```
<PropertyGroup>
    <OnAfter_WPPCopyWebApplication>
        MvcBuildViews;
    </OnAfter_WPPCopyWebApplication>
</PropertyGroup>

<Target Name="MvcBuildViews" Condition="'$(MvcBuildViews)'=='true'">
    <AspNetCompiler VirtualPath="temp" PhysicalPath="$(WebProjectOutputDir)" />
</Target> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T16:14:29.813

我假设您的意思是您更改了 .csproj 文件中的以下设置：

```
<MvcBuildViews>true</MvcBuildViews> 
```

不应触及您在问题中发布的设置。如果它可以在您的本地机器上运行，那么显然您可以预先构建一个 ASP.NET MVC 应用程序。

我认为您需要跟踪 TFS 构建环境和本地 VS 机器之间的不同之处。也许它正在使用不同版本的 MsBuild 或其他东西。

尝试使用详细输出执行两个构建并比较两者以查看有什么不同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-28T19:15:33.933

我们仍在对此进行测试，但您似乎可以将标签集中的 false/true 移动到您的 DEBUG 构建版本的属性组中，您仍然可以将其设置为 true 并且 MSBuild 将编译（假设 MSBuild TfsBuild.proj文件设置为使用除调试配置以外的其他内容）。您将需要使用记事本编辑 csproj 文件来完成此操作。

```
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="3.5">
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <MvcBuildViews>true</MvcBuildViews>
    .... 
```

您需要将 MVCBuildViews 标记从上面的默认属性组移动到调试配置属性组（下面）。同样，当我们获得 TFS / MSBuild 设置时，我将尝试将我们添加到 TFS 中的 TFSBuild.proj 文件中的步骤发布。

```
 <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <MvcBuildViews>true</MvcBuildViews>
    <DebugSymbols>true</DebugSymbols>
    .... 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-04T04:28:03.593

这个问题似乎与这里讨论的问题相似：http: [//blogs.msdn.com/aaronhallberg/archive/2007/07/02/team-build-and-web-deployment-projects.aspx](http://blogs.msdn.com/aaronhallberg/archive/2007/07/02/team-build-and-web-deployment-projects.aspx) 似乎调用了 aspnet_compiler .exe 无法找到二进制文件，因为它们不在构建机器上 MVC 项目的 bin 文件夹中。我还没有想出解决办法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-06T08:12:26.267

接受的答案对我不起作用。$(PublishDir) 参数未指向正确的位置。相反，我不得不使用：

```
 <Target Name="AfterBuild" Condition="'$(MvcBuildViews)'=='true'">
    <AspNetCompiler Condition="'$(IsDesktopBuild)' != 'false'" VirtualPath="temp" PhysicalPath="$(ProjectDir)\..\$(ProjectName)" />
    <AspNetCompiler Condition="'$(IsDesktopBuild)' == 'false'" VirtualPath="temp" PhysicalPath="$(OutDir)\_PublishedWebsites\$(ProjectName)" />
  </Target> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-02-16T20:19:13.537

我的源代码管理中有一些旧文件夹在解决方案中不可见。

* * *

## 回答 #9

> 赞同：-6
> 
> 时间：2009-04-16T17:34:52.383

您不能预先构建 ASP.NET MVC 应用程序。

# c# - PropertyInfo 实例上的 SetValue 错误“对象与目标类型不匹配”c#

> ID：755646
> 
> 赞同：19
> 
> 时间：2009-04-16T11:07:08.537
> 
> 标签：c#, reflection, setvalue

在以前的项目中，一直在使用带有此代码的 Copy 方法（以处理具有相同命名属性但不从公共基类派生或实现公共接口的对象）。

新的工作地点，新的代码库——现在它在 SetValue 上失败了，即使在非常简单的例子中也出现了“对象与目标类型不匹配”......而且它上周工作......

```
 public static void Copy(object fromObj, object toObj)
    {   
        Type fromObjectType = fromObj.GetType();
        Type toObjectType = toObj.GetType();

        foreach (System.Reflection.PropertyInfo fromProperty in 
            fromObjectType.GetProperties())
        {
            if (fromProperty.CanRead)
            {
                string propertyName = fromProperty.Name;
                Type propertyType = fromProperty.PropertyType;

                System.Reflection.PropertyInfo toProperty = 
                    toObjectType.GetProperty(propertyName);

                Type toPropertyType = toProperty.PropertyType;

                if (toProperty != null && toProperty.CanWrite)
                {
                    object fromValue = fromProperty.GetValue(fromObj,null);
                    toProperty.SetValue(toProperty,fromValue,null);
                }
            }
        }
    }

    private class test
    {
        private int val;
        private string desc;

        public int Val { get { return val; } set { val = value; } }

        public string Desc { get { return desc; } set { desc = value; } }

    }

    private void TestIt()
    {
        test testo = new test();
        testo.Val = 2;
        testo.Desc = "TWO";

        test g = new test();

        Copy(testo,g);

    } 
```

希望有人能指出我在哪里愚蠢？？？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-16T11:11:04.297

尝试：

```
toProperty.SetValue(toObj,fromValue,null); 
```

您正在尝试将属性 ( `toProperty`) 作为目标对象传递，而不是`toObj`. 对于信息，如果你做了很多这样的事情，也许可以考虑[HyperDescriptor](https://www.nuget.org/packages/HyperDescriptor/)，它可以大大降低反射成本。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-16T11:13:17.693

应该

```
toProperty.SetValue(toObj,fromValue,null); 
```

# javascript - 用 JavaScript 编写 Facebook 应用程序

> ID：755657
> 
> 赞同：6
> 
> 时间：2009-04-16T11:11:17.120
> 
> 标签：javascript, facebook

作为一个爱好，我用 JavaScript 编写了一个游戏，并且很想将它发布到 Facebook，你能用纯 HTML 和 JavaScript 编写一个 Facebook 应用程序吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-16T11:28:18.890

是的。绝对地。事实上，开发 Facebook 应用程序的选项之一是指向您的网站的嵌入式框架，它可以是您想要的任何内容，包括直接的 HTML Web 服务。

有两个官方认可的用于访问 Facebook 信息的库，其中一个是基于 Javascript 的。

你可以在 Facebook 上用 Javascript/HTML 做很多事情。在您自己的站点之外使用服务有很多可能性（想想 Flckr、Google Ajax API 等......）

Facebook 应用程序的开发非常简单。

该文档确实位于：http: [//developers.facebook.com/](http://developers.facebook.com/)

我还要指出，关于 Facebook 的流量，事情可能会迅速增长。有学生[创建应用程序的故事，这些应用程序迅速扩展到数百万用户](http://www.smsmallbiz.com/technology/Stanfords_Facebook_Apps_Class_Proves_a_Quick_Hit.html)。我并不是说您可能就是这种情况，但它可以是一个有效且高度病毒化的分发平台。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T11:15:08.907

是的，尽管您的应用可能无法在 Facebook 上做很多事情。查看[http://developers.facebook.com](http://developers.facebook.com/)获取文档。

# c# - LINQtoSQL 生成的 SQL 中的外连接过多

> ID：755661
> 
> 赞同：1
> 
> 时间：2009-04-16T11:13:09.537
> 
> 标签：c#, linq, linq-to-sql, tsql, outer-join

我有一个关于 LINQ2SQL 查询生成的 SQL 语句的问题。我有两个数据库表（`VisibleForDepartmentId`是外键）：

```
AssignableObject                 Department
----------------------           ------------
AssignableObjectId        ┌────> DepartmentId
AssignableObjectType      │
VisibleForDepartmentId ───┘ 
```

以及以下映射信息（注意`AssignableObject`是抽象的）：

```
<Database Name="SO_755661" Class="DataClassesDataContext">
  <Table Name="dbo.AssignableObject" Member="AssignableObjects">
    <Type Name="AssignableObject" Modifier="Abstract">
      <Column Name="AssignableObjectId" Type="System.Int32"
              DbType="Int NOT NULL IDENTITY" IsPrimaryKey="true"
              IsDbGenerated="true" CanBeNull="false" />
      <Column Name="AssignableObjectType" Type="System.String"
              DbType="VarChar(50) NOT NULL" CanBeNull="false"
              AccessModifier="Private" IsDiscriminator="true"/>
      <Column Name="VisibleForDepartmentId" Type="System.Int32"
              DbType="Int" CanBeNull="true" />
      <Association Name="Department_AssignableObject" Member="VisibleForDepartment"
                   ThisKey="VisibleForDepartmentId" OtherKey="DepartmentId"
                   Type="Department" IsForeignKey="true" />
      <Type Name="Asset" InheritanceCode="Asset" IsInheritanceDefault="true" />
      <Type Name="Role" InheritanceCode="Role" />
    </Type>
  </Table>
  <Table Name="dbo.Department" Member="Departments">
    <Type Name="Department">
      <Column Name="DepartmentId" Type="System.Int32"
              DbType="Int NOT NULL IDENTITY" IsPrimaryKey="true"
              IsDbGenerated="true" CanBeNull="false" />
      <Column Name="Name" Type="System.String" DbType="VarChar(50) NOT NULL"
              CanBeNull="false" />
      <Association Name="Department_AssignableObject" Member="AssignableObjects"
                   ThisKey="DepartmentId" OtherKey="VisibleForDepartmentId"
                   Type="AssignableObject" />
    </Type>
  </Table>
</Database> 
```

以及以下代码：

```
var loadOptions = new DataLoadOptions();
loadOptions.LoadWith<Asset>(a => a.VisibleForDepartment);
dataContext.LoadOptions = loadOptions;
var assets = from a in dataContext.Assets
             select a; 
```

这会产生一个带有两个相同左外连接的 SQL 查询：

```
SELECT t0.AssignableObjectType, t0.AssignableObjectId, t0.VisibleForDepartmentId,
       t2.test, t2.DepartmentId, t2.Name, t4.test AS test2,
       t4.DepartmentId AS DepartmentId2, t4.Name AS Name2
FROM dbo.AssignableObject AS t0
LEFT OUTER JOIN (
    SELECT 1 AS test, t1.DepartmentId, t1.Name
    FROM dbo.Department AS t1
    ) AS t2 ON t2.DepartmentId = t0.VisibleForDepartmentId
LEFT OUTER JOIN (
    SELECT 1 AS test, t3.DepartmentId, t3.Name
    FROM dbo.Department AS t3
    ) AS t4 ON t4.DepartmentId = t0.VisibleForDepartmentId 
```

为什么有两个外连接，一个就足够了？

亲切的问候，

罗纳德

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T06:59:41.160

我发现了导致这些重复外连接的原因。它们发生在持久类被两个或多个子类继承时。对于每个子类，如果您使用`LoadWith`.

在我的示例中，`AssignableObject`有两个子类：`Asset`和`Role`. 这导致与`Department`表的两个外部连接。如果我添加另一个子类，则会添加第三个外连接。

我不确定 SQL Server 是否足够聪明，可以意识到外部连接是重复的。我已经在 Microsoft Connect 上[发布了这个。](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=434254)

**编辑**：显然我的问题是[另一个问题](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=361683)的重复，它不会在下一个版本的 LINQ2SQL 中修复。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T11:24:30.023

您是否不小心在相同 2 个表的相同 2 列之间在数据库上定义了 2 个外键关系？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T18:00:15.980

您可以尝试在查询本身中进行左外连接。我不确定生成了什么 SQL，因为我这里没有您的数据库。

```
var assets = from a in dataContext.Assets
             join d in dataContext.Departments on 
                  a.VisibleForDepartmentId equals d.DepartmentId
                  into temp
             from t in temp.DefaultIfEmpty()
             select a; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T06:34:40.113

我在 LINQPad 中使用其默认数据库创建了一个类似的查询

```
var loadOptions = new DataLoadOptions();
loadOptions.LoadWith<Products>(a => a.Category);
LoadOptions = loadOptions;

var products = from a in Products
               select a;

products.Dump(); 
```

并得到

```
SELECT [t0].[ProductID], [t0].[ProductName], [t0].[CategoryID], [t2].[test], [t2].[CategoryID] AS [CategoryID2], [t2].[CategoryName]
FROM [Products] AS [t0]
LEFT OUTER JOIN (
    SELECT 1 AS [test], [t1].[CategoryID], [t1].[CategoryName]
    FROM [Categories] AS [t1]
    ) AS [t2] ON [t2].[CategoryID] = [t0].[CategoryID] 
```

正如预期的那样，只使用了一个 OUTER JOIN。

# c - 当我们将它写入文件时，为什么我们必须将所有内容都转换为 char*？

> ID：755665
> 
> 赞同：2
> 
> 时间：2009-04-16T11:13:32.920
> 
> 标签：c

出于好奇，当我们将某些内容写入（二进制）文件时，为什么要将其转换为 char*？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-16T11:15:51.603

因为写入的典型 I/O 函数需要一个指向`char`. 这是因为有人认为这是谈论存储在二进制文件中的数据的最具代表性的方式；它只是一堆机器最小的可寻址词，按顺序排列。它的 C 类型名称是`char`.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-16T11:18:21.940

`char*`仅表示指向字节序列开头的指针，这正是人们期望二进制文件包含的内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T11:32:23.593

Unwind 和 vezult 已经回答了您的问题，我假设您知道指针是什么。但是以防万一您将 *converting something to a char** 视为实际上以某种方式更改内存中数据的操作（例如，如果有很多数据，可能需要更多时间），请注意这*不是*获取指针的行为。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T11:48:07.203

你在说`fread()`和`fwrite()`吗？他们读取或写入的数据以`void*`（或`const void*`）形式传递，因此您不必进行转换。

但是在 C++ 中，当您使用 时，[`istream::read()`](http://cplusplus.com/reference/iostream/istream/read/)指向接收缓冲区的指针必须作为 a 传递`char*`，因此没有隐式转换。

# ruby - 如何在 Ruby 中将 DateTime.now 转换为 UTC？

> ID：755669
> 
> 赞同：105
> 
> 时间：2009-04-16T11:15:12.977
> 
> 标签：ruby

如果我有`d = DateTime.now`，如何将 'd' 转换为 UTC（带有适当的日期）？

* * *

## 回答 #1

> 赞同：176
> 
> 时间：2009-05-15T00:14:59.887

```
DateTime.now.new_offset(0) 
```

将在标准 Ruby 中工作（即没有 ActiveSupport）。

* * *

## 回答 #2

> 赞同：167
> 
> 时间：2009-04-16T11:17:49.727

~~`d = DateTime.now.utc`~~

哎呀！

这似乎在 Rails 中有效，但在普通 Ruby 中无效（当然这就是问题所在）

```
d = Time.now.utc 
```

但是确实有效。

你有什么理由需要使用`DateTime`而不是`Time`？`Time`应该包括你需要的一切：

```
irb(main):016:0> Time.now
=> Thu Apr 16 12:40:44 +0100 2009 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-08-03T20:02:28.843

不幸的是，DateTime 类没有 Time 类中可用的便捷方法来执行此操作。您可以像这样将任何 DateTime 对象转换为 UTC：

```
d = DateTime.now
d.new_offset(Rational(0, 24)) 
```

您可以使用以下命令从 UTC 切换回本地时间：

```
d.new_offset(DateTime.now.offset) 
```

其中`d`是 UTC 时间的 DateTime 对象。如果您希望这些作为方便的方法，那么您可以像这样创建它们：

```
class DateTime
  def localtime
    new_offset(DateTime.now.offset)
  end

  def utc
    new_offset(Rational(0, 24))
  end
end 
```

您可以在以下 irb 会话中看到这一点：

```
d = DateTime.now.new_offset(Rational(-4, 24))
 => #<DateTime: 106105391484260677/43200000000,-1/6,2299161> 
1.8.7 :185 > d.to_s
 => "2012-08-03T15:42:48-04:00" 
1.8.7 :186 > d.localtime.to_s
 => "2012-08-03T12:42:48-07:00" 
1.8.7 :187 > d.utc.to_s
 => "2012-08-03T19:42:48+00:00" 
```

正如您在上面看到的，初始 DateTime 对象的偏移量为 -04:00（东部时间）。我在太平洋时间，偏移量为 -07:00。`localtime`如前所述调用正确地将 DateTime 对象转换为本地时间。调用`utc`对象会正确地将其转换为 UTC 偏移量。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2016-11-11T02:02:00.257

试试这个，在 Ruby 中工作：</p>

```
DateTime.now.to_time.utc 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-11-30T19:40:09.970

如果您希望`Time.now`和`DateTime.now`以 UTC 时间响应，您可以设置 ENV。

```
require 'date'
Time.now #=> 2015-11-30 11:37:14 -0800
DateTime.now.to_s #=> "2015-11-30T11:37:25-08:00"
ENV['TZ'] = 'UTC'
Time.now #=> 2015-11-30 19:37:38 +0000
DateTime.now.to_s #=> "2015-11-30T19:37:36+00:00" 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-16T11:29:04.053

在 irb 中：

```
>>d = DateTime.now
=> #<DateTime: 11783702280454271/4800000000,5/12,2299161>
>> "#{d.hour.to_i - d.zone.to_i}:#{d.min}:#{d.sec}"
=> "11:16:41" 
```

将时间转换为UTC。但是，如果只是时间发布，您可以使用：

```
Time.now.utc 
```

并立即得到它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-10-06T14:55:19.267

DateTime 的字符串表示可以由 Time 类解析。

```
> Time.parse(DateTime.now.to_s).utc
=> 2015-10-06 14:53:51 UTC 
```

# winforms - 你如何使 Winform 轨迹栏（滑块）在触摸屏显示器上表现得更合理

> ID：755671
> 
> 赞同：1
> 
> 时间：2009-04-16T11:15:48.733
> 
> 标签：winforms, slider, touchscreen, trackbar

修改 Winforms 轨迹栏的最简单方法是什么，以便当用户单击它时，轨迹栏会跳转到鼠标的位置？

默认情况下，轨迹栏移动到其当前位置和鼠标单击位置之间的中间位置。

**更新：**我正在尝试这样做，以便可以在触摸屏上使用轨迹栏。使用触摸屏拖动非常困难，因此要求轨迹栏直接跳转到用户点击的位置。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T11:40:03.340

我从来没有做过，但我会先看看鼠标点击的位置。然后我可以计算出点击位置在轨迹栏的当前范围内有多远，并将跟踪器的位置设置为该点。

我将首先研究覆盖控件并操作与鼠标相关的事件函数（`OnMouseDown()`例如）。请注意，在某些情况下，调用覆盖函数的基类实现可能很重要，请务必根据具体情况进行考虑。（我刚刚遇到了这个问题，所以我觉得很新鲜。）

请注意，如果您有*非常*令人信服的理由，您应该只以这种方式更改标准控件的行为。它们是标准的，因为它们在数百/数千个程序中以可预测的方式运行。仅仅为你的程序做一些不同的行为可能会违反[租约原则](http://en.wikipedia.org/wiki/Principle_of_least_astonishment)。我能想到的唯一一个希望按照您描述的方式运行的轨迹栏是用于某种媒体播放器。

**编辑：** 根据您的评论，是的，我认为您有一个令人信服的理由。:)

# sql-server - 当您将系统数据库还原到具有不同名称的 SQL Server 时会发生什么？

> ID：755675
> 
> 赞同：2
> 
> 时间：2009-04-16T11:16:58.230
> 
> 标签：sql-server, sql-server-2005, disaster-recovery

我目前正在研究灾难恢复计划和恢复 master/msdb/model 的备份。

理论上，如果我将 master、msdb、model 和用户数据库恢复到全新的服务器安装（使用相同的服务包等），那么我将拥有原始服务器的精确副本，包括所有维护计划和作业以及所有内容。

但是，如果新的服务器名称与原来的不同，会发生什么？它只是应付，还是在这种情况下需要一些额外的步骤？

（MSDN 文档在这些方面有点简短）

我在 SQL 2005 上。

编辑：下面有几个答案很有帮助，但据我所知，他们都没有清楚地回答这个问题。我的问题是：在恢复 master、msdb 等之后（假设我没有使用任何 SQL 加密的东西）如果新服务器和 SQL 实例的名称与原来的名称不同，一切都会正常吗？还是我*必须*保持相同的名字？已接受的答案勾号仍有待获取！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T11:28:24.133

正确，一切都应该相同并准备就绪。

此处描述了服务器名称更改：[如何：重命名承载 SQL Server 2005 独立实例的计算机](http://msdn.microsoft.com/en-us/library/ms143799(SQL.90).aspx)

编辑，根据评论：

当您恢复到 BCP 服务器时，您实际上是在更改承载 SQL Server 实例的服务器名称。你做了一`sp_dropserver/sp_addserver`点点来让所有东西都对齐（基本上，你修复了@SERVERNAME）

再次编辑：

为了回答您的问题，SQL Server 将运行。除了依赖与物理服务器名称匹配的@@SERVERNAME 的任何代码。

@@SERVERNAME 从主数据库中获取信息。如果您恢复 master，则实例认为它具有旧名称。所以这是一个有效的重命名。

但是，任何客户端都不关心：它们使用 DNS/物理服务器名称来查找服务器。

[@@SERVERNAME](http://msdn.microsoft.com/en-us/library/aa933172(SQL.80).aspx)下有关此的更多信息与 SERVERPROPERTY 不同，后者将获取物理服务器名称。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T11:50:51.817

如果您的数据库使用 SQL 加密功能或链接服务器（他们的凭据在内部加密），那么您必须确保计算机 SID 或 AD 域保持不变，或者您需要备份“服务主密钥”（SMK）。

我们曾经遇到过这样的问题（当然是在灾难之后:)）。虽然我们没有使用加密数据，但我们无法链接到远程服务器；唯一的可能性是丢弃旧的加密 SMK 并生成新的。如果我们在该服务器上加密了数据，那么它们就会丢失。

MSDN：[BACKUP SERVICE MASTER KEY（Transact-SQL）](http://msdn.microsoft.com/en-us/library/ms190337.aspx)（及其他相关文章）

# .net - GC.COllect() 似乎在调试模式下不起作用

> ID：755680
> 
> 赞同：3
> 
> 时间：2009-04-16T11:18:39.007
> 
> 标签：.net, garbage-collection

我正在运行下面的代码，当它在发布模式下运行时结果完全不同。在 Debug 模式下，它从不收集 A 类的对象，而在 Reaelse 模式下，它立即收集 A 类的对象。

有人可以解释为什么。

```
using System; 
using System.Collections.Generic; 
using System.Linq; 
using System.Text;

namespace ConsoleApplication2 {
    class Program
    {
        static void Main(string[] args)
        {
            A obj = new A();

            B bobj = obj.objB;

            GC.Collect();
            GC.WaitForPendingFinalizers();

            while (bobj.isLive)
            { 
                Console.WriteLine("Is Alive!!");
            }

            Console.WriteLine("Is Dead!!");

            Console.ReadLine();
        }
    }

    class A:IDisposable

    {
        public B objB = new B();

        public A()
        { }

        ~A()
        {
            objB.Dispose();   
        }

        #region IDisposable Members

        public void  Dispose()
        {
            GC.SuppressFinalize(this);
        }

        #endregion

    }
    class B:IDisposable
    {
        public bool isLive = true;

        #region IDisposable Members

        public void  Dispose()
        {
            this.isLive = false;
            GC.SuppressFinalize(this);
        }

        #endregion
    } } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T11:23:11.430

在调试模式下，编译器不会优化局部变量。因此，对 A 的引用仍然存在。在Release模式下，编译器优化了使用，使得引用被丢弃，对象可以被收集。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T11:36:38.043

垃圾收集器在调试模式和释放模式下以不同方式处理变量使用。

在发布模式下，变量的使用仅在实际使用的地方。在最后一次使用该变量后，该对象已准备好进行垃圾回收。

在调试模式下，变量的使用扩展到它的范围。这样做的原因是调试器中的监视窗口可以在整个范围内显示变量的值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-08-01T10:28:48.650

我刚刚在测试中发现了这种行为。插入

```
obj = null; 
```

就在 GC.Collect() 应该有帮助之前。我认为这是一种“模拟”优化。

# c# - “静态只读”与“常量”

> ID：755685
> 
> 赞同：1502
> 
> 时间：2009-04-16T11:21:43.290
> 
> 标签：c#, constants

我已经阅读了有关`const`和`static readonly`领域的信息。我们有一些只包含常量值的类。它们用于我们系统中的各种事物。所以我想知道我的观察是否正确：

这些常量值是否应该始终`static readonly`适用于所有公开的东西？并且仅`const`用于内部/受保护/私有值？

你有什么建议吗？我是否应该甚至不使用`static readonly`字段，而是使用属性？

* * *

## 回答 #1

> 赞同：1020
> 
> 时间：2009-04-16T11:24:31.957

`public static readonly`字段有点不寻常；`public static`属性（只有 a `get`）会更常见（可能由`private static readonly`字段支持）。

`const`值直接烧入调用站点；这是双刃剑：

*   如果值是在运行时获取的，可能是从配置中获取的，它是无用的
*   如果更改 const 的值，则需要重建所有客户端
*   但它可以更快，因为它避免了方法调用......
*   ...无论如何有时可能已被 JIT 内联

如果值**永远不会**改变，那么 const 就可以了 -`Zero`等等使合理的 consts ;p 除此之外，`static`属性更常见。

* * *

## 回答 #2

> 赞同：258
> 
> 时间：2009-04-16T12:57:48.550

`static readonly`如果*消费者*在不同的程序集中，我会使用。将 the`const`和*Consumer*放在两个不同的组件中是一个很好的方式来[让自己在脚下开枪](http://www.stum.de/2009/01/14/const-strings-a-very-convenient-way-to-shoot-yourself-in-the-foot/)。

* * *

## 回答 #3

> 赞同：212
> 
> 时间：2009-04-16T11:36:28.183

## 还有一些相关的事情需要注意：

**const int a**

*   必须初始化。
*   初始化必须在*编译时进行*。

**只读 int a**

*   可以使用默认值，无需初始化。
*   初始化可以在*运行时*完成（编辑：仅在构造函数中）。

* * *

## 回答 #4

> 赞同：198
> 
> 时间：2013-09-11T14:52:21.437

这只是对其他答案的补充。我不会重复它们（现在是四年后）。

在某些情况下，a`const`和非常量具有不同的语义。例如：

```
const int y = 42;

static void Main()
{
  short x = 42;
  Console.WriteLine(x.Equals(y));
} 
```

打印出来`True`，而：

```
static readonly int y = 42;

static void Main()
{
  short x = 42;
  Console.WriteLine(x.Equals(y));
} 
```

写道`False`。

原因是该方法[`x.Equals`](http://msdn.microsoft.com/en-us/library/system.int16.equals.aspx)有两个重载，一个接受`short`( `System.Int16`)，另一个接受`object`( `System.Object`)。现在的问题是一个或两个是否适用于我的`y`论点。

当`y`是一个编译时常量（字面量）时，*如果**是*一个`const`常量，并且 C# 编译器验证它的值在 a (这是）。请参阅C# 语言规范中的[隐式常量表达式转换](https://msdn.microsoft.com/en-us/library/aa691286.aspx)。因此，必须考虑这两个重载。重载是首选（any是 an ，但不是所有are ）。So被转换为，并且使用了重载。然后比较两个相同的值，得到. *`int` *`short``int``short``42``Equals(short)``short``object``object``short``y``short``Equals``short``true`**

 **当`y`不是常数时，不存在从to的*隐式*转换。那是因为通常 a可能太大而无法放入. （确实存在*显式*转换，但我没有说，所以这无关紧要。）我们看到只有一个重载适用，即那个。所以是盒装的。然后将 a与 a进行比较，并且由于运行时类型甚至不同意，这将产生。`int``short``int``short`*`Equals((short)y)``Equals(object)``y``object``Equals``System.Int16``System.Int32``false`*

 *我们得出结论，在某些（罕见的）情况下，将`const`类型成员更改为`static readonly`字段（或其他方式，如果可能的话）可以改变程序的行为。

* * *

## 回答 #5

> 赞同：93
> 
> 时间：2009-04-16T11:28:51.323

需要注意的一件事是*const*仅限于原始/值类型（字符串除外）。

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2016-01-12T17:14:02.743

**静态只读**：

该值可以`static`在运行时通过构造函数进行更改。但不是通过成员函数。

**常数**：

默认情况下`static`。无法从任何地方（构造函数、函数、运行时等）更改值。

**只读**：

该值可以在运行时通过构造函数进行更改。但不是通过成员函数。

您可以查看我的存储库：[C# 属性类型](https://github.com/yeasin90/advanced-csharp/blob/master/CSharpAdvanced/VariableTypes.cs)。

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2012-11-14T18:58:37.620

`readonly`关键字与关键字不同`const`。`const`字段只能在字段声明时进行初始化。可以`readonly`在声明或构造函数中初始化字段。因此，`readonly`根据使用的构造函数，字段可以具有不同的值。此外，虽然`const`字段是编译时常量，但该`readonly`字段可用于运行时常量

[此处简短而清晰的 MSDN 参考](http://msdn.microsoft.com/en-us/library/acdd6hb7%28v=vs.100%29.aspx)

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2013-09-28T08:19:32.103

`const`和`readonly`相似，但并不完全相同。

`const`字段是编译时常量，这意味着可以在编译时计算该值。`readonly`字段允许在构造类型期间必须运行某些代码的其他场景。构建后，`readonly`字段不能更改。

例如，`const`成员可用于定义成员，例如：

```
struct Test
{
    public const double Pi = 3.14;
    public const int Zero = 0;
} 
```

因为像 3.14 和 0 这样的值是编译时常量。但是，请考虑您定义类型并希望提供一些预制实例的情况。例如，您可能想要定义一个 Color 类并为黑色、白色等常见颜色提供“常量”。使用 const 成员是不可能的，因为右侧不是编译时常量。可以使用常规静态成员执行此操作：

```
public class Color
{
    public static Color Black = new Color(0, 0, 0);
    public static Color White = new Color(255, 255, 255);
    public static Color Red   = new Color(255, 0, 0);
    public static Color Green = new Color(0, 255, 0);
    public static Color Blue  = new Color(0, 0, 255);
    private byte red, green, blue;

    public Color(byte r, byte g, byte b) => (red, green, blue) = (r, g, b);
} 
```

但是，没有什么可以阻止 Color 的客户使用它，也许是通过交换 Black 和 White 值。不用说，这会引起 Color 类的其他客户的恐慌。“只读”功能解决了这种情况。

通过在声明中简单地引入`readonly`关键字，我们保留了灵活的初始化，同时防止客户端代码乱七八糟。

```
public class Color
{
    public static readonly Color Black = new Color(0, 0, 0);
    public static readonly Color White = new Color(255, 255, 255);
    public static readonly Color Red   = new Color(255, 0, 0);
    public static readonly Color Green = new Color(0, 255, 0);
    public static readonly Color Blue  = new Color(0, 0, 255);
    private byte red, green, blue;

    public Color(byte r, byte g, byte b) => (red, green, blue) = (r, g, b);
} 
```

有趣的是，const 成员始终是静态的，而 readonly 成员可以是静态的，也可以不是静态的，就像常规字段一样。

可以为这两个目的使用单个关键字，但这会导致版本控制问题或性能问题。假设我们为此使用了一个关键字（const）并且开发人员写道：

```
public class A
{
    public static const C = 0;
} 
```

另一个开发人员编写了依赖于 A 的代码：

```
public class B
{
    static void Main() => Console.WriteLine(A.C);
} 
```

现在，生成的代码可以依赖于 AC 是编译时常量这一事实吗？即，AC 的使用可以简单地用值 0 代替吗？如果你对此说“是”，那么这意味着 A 的开发者不能改变 AC 的初始化方式——这在未经许可的情况下束缚了 A 的开发者的手。

如果你对这个问题说“不”，那么就会错过一个重要的优化。也许 A 的作者肯定 AC 将永远为零。const 和 readonly 的使用允许 A 的开发人员指定意图。这有助于更好的版本控制行为和更好的性能。

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2009-04-16T12:48:41.787

我的偏好是尽可能使用**const**，如前面的答案所述，它仅限于文字表达式或不需要评估的东西。

如果我遇到了这个限制，那么我会退回到**static readonly**，但要注意一点。[正如 Marc在这里](https://stackoverflow.com/questions/755685/c-static-readonly-vs-const/755693#755693)提到的那样，我通常会使用带有 getter 的公共静态属性和支持**私有静态只读**字段。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2018-09-27T15:25:06.357

**Const**：常量变量值必须与声明一起定义，之后它不会改变。**const 是隐式静态的，因此无需创建类实例，我们就可以访问它们。**这在编译时有一个值。

**ReadOnly**：我们可以在声明时定义只读变量值，也可以在运行时使用构造函数。没有类实例，只读变量无法访问。

**静态只读**：我们可以在声明时以及仅通过静态构造函数定义静态只读变量值，但不能使用任何其他构造函数。我们也可以在不创建类实例（作为静态变量）的情况下访问这些变量。

如果我们必须在不同的程序集中使用变量，静态只读将是更好的选择。请查看以下博客文章中的完整详细信息：

*[Const Strings – 一种非常方便的射击自己的方式](https://www.stum.de/2009/01/14/const-strings-a-very-convenient-way-to-shoot-yourself-in-the-foot/)*

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2013-09-09T07:16:45.137

> **Const：** Const 只不过是“常量”，它是一个变量，其值是常量，但在编译时。并且必须为其分配一个值。默认情况下 const 是静态的，我们不能在整个程序中更改 const 变量的值。
> 
> **静态只读：**静态只读类型变量的值可以在运行时赋值或在编译时赋值并在运行时更改。但是这个变量的值只能在静态构造函数中改变。并且无法进一步更改。它只能在运行时更改一次

参考：[c-sharpcorner](http://c-sharpcorner.com/UploadFile/c210df/difference-between-const-readonly-and-static-readonly-in-C-Sharp/)

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2015-04-07T13:44:22.437

当向其他程序集公开可能在更高版本中更改的值时，静态只读字段是有利的。

例如，假设程序集`X`公开了一个常量，如下所示：

```
public const decimal ProgramVersion = 2.3; 
```

如果程序集`Y`引用`X`并使用此常量，则值 2.3 将`Y`在编译时烘焙到程序集中。这意味着如果`X`稍后重新编译并将常量设置为 2.4，在重新编译`Y`之前仍将使用旧值 2.3 `Y`。静态只读字段避免了这个问题。

另一种看待这一点的方式是，任何可能在未来发生变化的值在定义上都不是恒定的，因此不应表示为一个。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2014-12-15T13:06:45.963

C#.Net 中的 const 和 static 只读字段之间存在细微差别

const 必须在编译时用值初始化。

const 默认是静态的，需要用常量值初始化，以后不能修改。它不能用于所有数据类型。对于前日期时间。它不能与 DateTime 数据类型一起使用。

```
public const DateTime dt = DateTime.Today;  //throws compilation error
public const string Name = string.Empty;    //throws compilation error
public static readonly string Name = string.Empty; //No error, legal 
```

readonly 可以声明为静态的，但不是必需的。声明时无需初始化。可以使用构造函数一次分配或更改其值。所以有可能改变一次只读字段的值（没关系，如果它是静态的），这对于 const 是不可能的。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2013-12-11T11:28:25.867

常量：

1.  应在声明时给出值
2.  编译时间常数

只读：

1.  可以在声明时或在运行时使用构造函数给出值。值可能因使用的构造函数而异。
2.  运行时间常数

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-11-18T15:27:22.290

const（在编译时确定）可以用于只读静态不能使用的情况，例如 switch 语句或属性构造函数。这是因为只读字段仅在运行时解析，并且某些代码构造需要编译时保证。可以在构造函数中计算只读静态，这通常是必不可少且有用的东西。区别是功能性的，我认为它们的用法也应该如此。

在内存分配方面，至少对于字符串（作为引用类型）而言，似乎没有区别，因为两者都是实习生并且将引用一个实习生实例。

就个人而言，我的默认值是只读静态的，因为它对我来说更具语义和逻辑意义，特别是因为在编译时不需要大多数值。而且，顺便说一下，公共只读静态数据并不罕见或不常见，正如标记的答案所述：例如，`System.String.Empty`是一。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-01-21T06:45:57.757

*声明const*和*static readonly*的另一个区别在于内存分配。

静态字段属于对象的类型，而不属于该**类型的实例。**结果，一旦第一次引用该类，静态字段将在内存中“存在”剩余时间，并且该静态字段的同一实例将被该类型的所有实例引用。

另一方面，一个*const*字段“属于该类型的一个实例。

如果释放内存对您来说更重要，请更喜欢使用*const*。如果速度快，则使用*static readonly*。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2021-03-12T10:24:57.710

如果`const`您可以提供编译时常量，请使用：

```
private const int Total = 5; 
```

`static readonly`如果您需要在运行时评估您的值，请使用：

```
private static readonly int GripKey = Animator.StringToHash("Grip"); 
```

这将产生编译错误，因为在编译时无法获取该值。

```
private const int GripKey = Animator.StringToHash("Grip"); 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-11-21T22:42:42.157

常量就像名字所暗示的那样，不会改变的字段，通常在编译时在代码中静态定义。

只读变量是可以在特定条件下更改的字段。

它们可以在你第一次像常量一样声明它们时被初始化，但通常它们是在构造函数内的对象构造期间初始化的。

在上述条件下，它们在初始化发生后无法更改。

对我来说，静态只读听起来像是一个糟糕的选择，因为如果它是静态的并且永远不会改变，那么只需使用它 public const。如果它可以更改，那么它不是一个常量，然后，根据您的需要，您可以使用只读变量或仅使用常规变量。

另外，另一个重要的区别是常量属于类，而只读变量属于实例！

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2020-08-26T07:24:03.173

有一个重要的问题，在上述答案中没有提到，应该驱使你更喜欢“const”，特别是对于“int”、“string”等基本类型。

**常量可以作为属性参数**，静态只读字段不行！

[Azure 函数 HttpTrigger，不在属性中使用 HttpMethods 类](https://stackoverflow.com/questions/63574874/azure-functions-httptrigger-not-using-httpmethods-class-in-attribute/63579305#63579305)

如果只有微软为 Http 的 GET、POST、DELETE 等使用常量。

可以写

```
[HttpTrigger(AuthorizationLeve.Anonymous,  HttpMethods.Get)] // COMPILE ERROR: static readonly, 
```

但相反，我不得不求助于

```
[HttpTrigger(AuthorizationLeve.Anonymous,  "GET")] // STRING 
```

或者使用我自己的常量：

```
public class HttpConstants
{
    public const string Get = "GET";
}

[HttpTrigger(AuthorizationLeve.Anonymous,  HttpConstants.Get)] // Compile FINE! 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2022-01-20T14:17:07.090

> 常量

1.  只能应用于字段。值应该在代码编译时。
2.  适合在编译代码之前在代码中删除魔术“字符串”、“int/double”、（原始类型）等。
3.  编译后，该值将放置在使用常量的所有编译代码中。所以如果你有一个巨大的字符串在很多地方使用，那么在使它成为 const 之前要小心。考虑使用静态只读。

> 静态只读

1.  静态只读适用于字段/道具，静态可用于方法。（附注）当静态应用于方法时，编译后的代码不会将“this”参数传递给方法，因此您无法访问对象的实例数据。
2.  适用于编译代码后可能更改的值。像从配置中初始化的值，在应用程序启动期间等。
3.  编译代码后，在 IL 代码中使用 ref to value 可能比使用 const 慢，但编译后的代码很小

在重构期间，所有 const 都可以安全地转换为静态只读，但反之亦然，正如我们在上面看到的，当转换的代码可能会中断，因为可以在构造函数中初始化一些静态只读变量。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2022-02-24T00:03:22.153

上面提到了我不相信的另一个区别：

`const`并且`static readonly`值不会在 Visual Studio IDE 中应用[CodeLens 。](https://docs.microsoft.com/en-us/visualstudio/ide/find-code-changes-and-other-history-with-codelens?view=vs-2022)

`static`仅获取属性 DO 将 CodeLens 应用于它们。

[![代码镜头示例](https://i.stack.imgur.com/9fVpP.png)](https://i.stack.imgur.com/9fVpP.png)

我认为添加 CodeLens 非常有价值。

注意：当前使用 Visual Studio 2022。

# css - IE6 中 3 像素的额外空间

> ID：755689
> 
> 赞同：3
> 
> 时间：2009-04-16T11:23:18.357
> 
> 标签：css, internet-explorer-6, cross-browser

有人可以弄清楚这里发生了什么，我该如何解决？我正在IE6、IE7、FF 和 Chrome 中测试[这个页面，它适用于除 IE6 之外的所有内容。](http://www.bookcraft.co.uk/index.php)在那里，鸡图片的边缘和它所在的 div 之间有一个小间隙。

我**讨厌**IE6。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T11:26:28.800

这可能是在 IE6 中显示的“三像素慢跑”错误，但在 IE 的更高版本中没有。例如，参见[http://www.positioniseverything.net/explorer/threepxtest.html 。](http://www.positioniseverything.net/explorer/threepxtest.html)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-16T12:58:17.067

## 使用 CSS 重置会有所帮助！

浏览器之间的许多不一致可以通过使用 CSS 重置来规避

我使用[Meyer Reset 方法](http://meyerweb.com/eric/thoughts/2007/05/01/reset-reloaded/?reset)。

但是，另一种选择是[Yahoo YUI 方法](http://developer.yahoo.com/yui/reset/)。

# python - 删除 *.pyc

> ID：755694
> 
> 赞同：1
> 
> 时间：2009-04-16T11:24:38.323
> 
> 标签：python, caching

我有三个模块：

**`one.py`：**

```
def abc():
    print "Heeeeeeeeeeeiiiiiioooooooooo" 
```

**`two.py`：**

```
import one

def defg():
    one.abc() 
```

**`three.py`：**

```
import os
from time import sleep

import two
two.defg()

sleep(20)

directory = os.listdir('.')

for filename in directory:
    if filename[-3:] == 'pyc':
        print '- ' + filename
        os.remove(filename) 
```

我有三个疑问。**请帮助我**。

当我`three.py`第一次运行`one.pyc`并将`two.pyc`被创建时。我可以看到它，因为我延迟了 20 秒。执行语句后`os.remove(filename)`，它们被删除。直到这里还好。

再次没有关闭 IDLE 以及我运行的脚本`three.py`。这次没有`.pyc`创建文件。**为什么会这样**？

如果我关闭 IDLE 以及脚本，`.pyc`将像以前一样创建。

**为什么编译后的代码没有再次创建和 agin ？**

此外，如果我在`one.py`不关闭 shell 的情况下运行，则不会显示它。**我也需要一个解决方案。**

第三个疑问是**，如果编译的代码本身第一次被删除，那么第二次运行如何给出相同的结果`.pyc`？**

希望有解决办法...

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-16T11:37:58.040

.pyc 不会再次创建，因为在代码中引用了您导入的模块。重新运行时，将使用此引用。

这就是 .pyc 没有再次生成的原因，也是您所做的额外更改没有运行的原因。

您可以删除所有引用并调用垃圾收集，或使用模块上的内置 reload() 函数。例如：

```
reload(three) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-01-16T06:56:36.490

> 编辑 ~/.bashrc 并将这个 shell 函数添加到其中
> 
> > $ 光盘; pyclean

```
pyclean () {
        find . -type f -name "*.py[co]" -delete
        find . -type d -name "__pycache__" -delete
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T11:37:55.857

我认为 IDLE 在它自己的 Python 进程中缓存字节码，所以它不需要在每次运行文件时重新生成它。

# java - MYSQL & Java 小程序

> ID：755696
> 
> 赞同：0
> 
> 时间：2009-04-16T11:24:56.590
> 
> 标签：java, jdbc, applet

我目前正在将 Java 桌面应用程序更改为 Java 小程序。一切正常，但只要小程序尝试进​​行 mysql 数据库调用，它就无法正常工作。桌面应用程序中的代码很好，但是一旦从应用程序调用它就不起作用。

是否需要对代码进行任何更改，因为它是从 applet 而不是使用 JDBC 的桌面应用程序调用的？

谢谢

〜凯尔G

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T11:35:58.170

我怀疑您可能正在尝试与服务于您的小程序的服务器以外的服务器通信？有关小程序安全限制，请参阅[此内容。](http://journals.ecs.soton.ac.uk/java/tutorial/applet/security/security.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T11:56:04.877

小程序中的 JDBC 无法连接到其他服务器端口：安全限制，例如无法读取桌面上的文件

# javascript - javascript getElementByName可以访问隐藏元素吗？

> ID：755699
> 
> 赞同：5
> 
> 时间：2009-04-16T11:25:36.493
> 
> 标签：javascript, asp.net-mvc

我有隐藏字段

```
<%= Html.Hidden("ID", 1) %> 
```

在javascript中我想要该字段的值

```
var ID = document.getElementsByName("ID").value; 
```

我无法访问它！

还有其他方法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T11:31:25.403

尝试这个 ：

```
<input type="hidden" id="ID" /> 
```

让 javascript 访问它：

```
var ID = document.getElementById("ID").value; 
```

使用 JQuery 的其他方式：

```
var ID = $('#ID').val(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T11:30:03.783

不确定上下文，但您不应该使用[getElementById](http://www.w3schools.com/jsref/met_doc_getelementbyid.asp)吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T11:31:24.390

也许你想做的是：

```
var id = document.getElementById('id').value; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T11:31:54.280

我这样做：

```
<% Html.Hidden("ID", 1, new { id = "MyHidden"}) %>

document.getElementById("MyHidden").value 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T11:48:44.007

1.  `getElementsByName(name)`返回具有给定名称属性的元素数组。
2.  `getElementById(id)`返回具有给定 id 属性的元素。
3.  没有 getElementsById - 因为不允许有两个具有相同 id 的元素。
4.  getElementsByID、getElementByID 也不是——这些不是现有的 javascript 函数。骆驼化是必需的！

回答问题：

如果它是隐藏的客户端，您可以获得隐藏元素的 id。（您可以在生成的源代码中看到它。）

```
document.getElementById('ID').value; 
```

或者类似的东西。

# database-design - 链接两个表

> ID：755701
> 
> 赞同：1
> 
> 时间：2009-04-16T11:28:03.290
> 
> 标签：database-design

我有两个表：带有 jobid、jobdescription 等的**作业**和带有 userid、jobid、name 等的用户**。**

将两个 jobid 链接到表**user**中的相同用户 ID 的最佳做法是什么？

我可以使用存储同一用户的作业条目的中间表来做到这一点，但我认为这是一个更优雅的解决方案。

谢谢你。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T11:31:45.717

三张表 - 用户、作业、UserJobs

用户表包含与用户有关的信息

作业表描述了各个作业

UserJobs 表使用 UserID/JobID 的组合 PK/FK 充当多对多关系之间的桥梁。

**例子**

```
Users
UserID Name
---------------------------------
1      Doogie Howser
2      Steve Urkel
3      Forest Gump

Jobs
JobID JobDescription
---------------------------------
1     TV Character
2     Movie Character
3     Nerd

UserJobs
UserID JobID
---------------------------------
1      1
1      3
2      1
2      3
3      2 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T11:44:58.680

这称为[多对多](http://en.wikipedia.org/wiki/Many-to-many_(data_model))关系，在 RDBMS 中实现这一点的方法是拥有一个[联结表](http://en.wikipedia.org/wiki/Junction_table)。

您将有 3 张桌子：

*   **job** — **jobid** (PK)、jobdescription 等
*   **user——**用户****ID**（PK）、姓名等（注意，这里没有*jobid*）**
***   **userjob** — **userid**，**jobid**（两者的 PK 组合）**

 *** * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T11:39:28.083

我看到TheTXI已经给了你一个很好的答案，在他所说的基础上添加更多内容：你所拥有的是Users <=> Jobs之间的多对多映射。每当您遇到这种情况时，您都必须使用映射用户和作业的映射表。大多数情况下，会创建一个名为 UserJobs 的表，其中包含一个包含 jobid 和 userid 的复合键。希望有帮助。

# php - 从版本控制 mysql 模式开始，不要矫枉过正。好的解决方案？

> ID：755704
> 
> 赞同：7
> 
> 时间：2009-04-16T11:28:44.707
> 
> 标签：php, mysql, svn, version-control, database-versioning

我已经到了意识到我必须开始对我的数据库模式和更改进行版本控制的地步。因此，我阅读了关于该主题的现有帖子，但我不确定如何继续。

我基本上是一家单人公司，不久前我什至没有对我的代码使用版本控制。我在 Windows 环境中，使用 Aptana (IDE) 和 SVN (with Tortoise)。我从事 PHP/mysql 项目。

什么是对我的数据库模式进行版本控制的有效且足够（没有矫枉过正）的方法？

在某些项目中，我确实有一两个自由职业者，但我预计不会发生很多分支和合并。所以基本上我想跟踪我的代码修订的并发模式。

[编辑]**临时解决方案**：目前我决定只要我要提交一个标签（稳定版本），我就只做一个模式转储加上一个带有必要的初始数据的转储。在现阶段，这对我来说似乎已经足够了。[/edit]

[edit2]plus 我现在还使用了第三个名为 increments.sql 的文件，我将所有更改与日期等放在其中，以便在一个文件中轻松跟踪更改历史记录。我不时将更改集成到其他两个文件中并清空 increments.sql[/edit]

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T11:32:11.207

小公司的简单方法：将您的数据库转储到 SQL 并将其添加到您的存储库中。然后每次更改某些内容时，将更改添加到转储文件中。

然后，您可以使用 diff 来查看版本之间的更改，更不用说注释解释您的更改了。这也将使您几乎不受 MySQL 升级的影响。

我看到的一个缺点是您必须记住手动将 SQL 添加到转储文件中。你可以训练自己永远记住，但如果你和别人一起工作要小心。错过更新以后可能会很痛苦。

这可以通过在提交颠覆时创建一些精心制作的脚本来为你做这件事来缓解，但这对于一个人的表演来说有点多。

**编辑：**在这个答案之后的一年里，我不得不为一个小团队实施 MySQL 版本控制方案。手动添加每个更改被视为一个繁琐的解决方案，就像评论中提到的那样，所以我们转储数据库并将该文件添加到版本控制中。

我们发现测试数据最终进入了转储，并且很难弄清楚发生了什么变化。这可以通过仅转储模式来解决，但这对于我们的项目来说是不可能的，因为我们的应用程序依赖于数据库中的某些数据才能运行。最终我们回到手动添加更改到数据库转储。

这不仅是最简单的解决方案，而且还解决了某些 MySQL 版本在导出/导入方面的某些问题。通常我们必须转储开发数据库，​​删除任何测试数据、日志条目等，在适用的情况下删除/更改某些名称，然后才能创建生产数据库。通过手动添加更改，我们可以准确地控制最终在生产中的结果，一次一点点，以便最终一切准备就绪，并且尽可能轻松地迁移到生产环境。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T12:36:45.263

The main ideea is to have a folder with this structure in your project base path

```
/__DB
—-/changesets
——–/1123
—-/data
—-/tables 
```

Now who the whole thing works is that you have 3 folders: **Tables** Holds the table create query. I recommend using the naming “table_name.sql”.

**Data** Holds the table insert data query. I recommend using the same naming “table_name.sql”. Note: Not all tables need a data file, you would only add the ones that need this initial data on project install.

**Changesets** This is the main folder you will work with. This holds the change sets made to the initial structure. This holds actually folders with changesets. For example i added a folder 1123 wich will contain the modifications made in revision 1123 ( the number is from your code source control ) and may contain one or more sql files.

I like to add them grouped into tables with the naming xx_tablename.sql - the xx is a number that tells the order they need to be runned, since sometimes you need the modification runned in a certain order.

**Note:** When you modify a table, you also add those modifications to table and data files … since those are the file s that will be used to do a fresh install.

This is the main ideea.

for more details you could check this [blog post](http://www.gsdesign.ro/blog/mysql-database-versioning-strategy/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T11:34:18.750

这样做生成的版本控制文件怎么样：

```
mysqldump --no-data database > database.sql 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T11:40:59.220

在我工作的地方，我们为每个新版本的应用程序都有一个安装脚本，其中包含我们需要运行以进行升级的 sql。这对于 6 个开发人员来说已经足够好了，并且有一些维护版本的分支。我们正在考虑迁移到 Auto Patch [http://autopatch.sourceforge.net/](http://autopatch.sourceforge.net/)，它负责确定将哪些补丁应用于您正在升级的任何数据库。看起来可能有一些小的并发症处理分支与自动补丁，但听起来这对你来说不是问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T12:15:37.683

我猜，像这样的批处理文件应该可以完成这项工作（没有尝试过）......

> `mysqldump --no-data -ufoo -pbar dbname > path/to/app/schema.sql
> svn commit path/to/app/schema.sql`

只需在更改架构后运行批处理文件，或者让 cron/调度程序执行它（但我不知道......我认为，如果只是时间戳更改，即使内容相同，提交也可以工作。不要知道这是否会是一个问题。）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-07-07T21:27:11.627

几个月前，我搜索了 MySQL 模式版本控制工具。我发现了很多有用的工具，比如 Doctrine 迁移、RoR 迁移、一些用 Java 和 Python 编写的工具。

但是没有一个能满足我的要求。

我的要求：

1.  无要求，不包括 PHP 和 MySQL
2.  没有模式配置文件，如 Doctrine 中的 schema.yml
3.  能够从连接中读取当前模式并创建新的迁移脚本，而不是在其他应用程序安装中表示相同的模式。

我开始写我的迁移工具，今天我有测试版。

如果您对此主题感兴趣，请尝试一下。请向我发送未来的请求和错误报告。

源代码：bitbucket.org/idler/mmp/src 英文概述：bitbucket.org/idler/mmp/wiki/Home 俄文概述：antonoff.info/development/mysql-migration-with-php-project

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-18T11:54:27.083

在我们公司，我们是这样做的：

我们将所有表/数据库对象放在它们自己的文件中，例如`tbl_Foo.sql`. 这些文件包含几个用分隔的“部分”

```
-- part: create 
```

其中`create`只是给定部分的描述性标识，文件如下所示：

```
-- part: create
IF not exists ...
CREATE TABLE tbl_Foo ...
-- part: addtimestamp
IF not exists ...
BEGIN
   ALTER TABLE ...
END 
```

然后我们有一个 xml 文件，它引用我们在将数据库更新到新模式时要执行的每个部分。它看起来很像这样：

```
<playlist>
   <classes>
     <class name="table" desc="Table creation" />
     <class name="schema" desc="Table optimization" />
   </classes>
   <dbschema>
      <steps db="a_database">
         <step file="tbl_Foo.sql" part="create" class="table" />
         <step file="tbl_Bar.sql" part="create" class="table" />
      </steps>
      <steps db="a_database">
         <step file="tbl_Foo.sql" part="addtimestamp" class="schema" />
      </steps>
   </dbschema>          
</playlist> 
```

`<classes/>`对于 GUI 和`<dbschema/>`with的部分`<steps/>`是对更改进行分区。: `<step/>`s 是按顺序执行的。我们还有其他一些实体，喜欢`sqlclr`做不同的事情，比如部署二进制文件，但仅此而已。

当然，我们有一个组件来获取该播放列表文件和一个资源/文件系统对象，该对象交叉引用播放列表并取出想要的部分，然后在数据库上以管理员身份运行它们。

由于 .sql 中的“部分”是这样编写的，因此它们可以在任何版本的 DB 上执行，我们可以在每个以前/旧版本的 DB 上运行所有部分并将其修改为最新版本。当然，在某些情况下，SQL Server 会“提前”解析列名，我们必须稍后将部分修改为`exec_sql`s，但这种情况并不经常发生。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-07-07T21:31:00.387

我们的解决方案是 MySQL Workbench。我们定期将现有数据库逆向工程为具有适当版本号的模型。然后可以根据需要轻松执行版本之间的差异。另外，我们得到了很好的 EER 图等。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-04-15T22:01:34.287

看看[SchemaSync](http://www.schemasync.org)。随着时间的推移，它将生成迁移和版本化数据库架构所需的补丁和恢复脚本（.sql 文件）。它是一个独立于语言和框架的 MySQL 命令行实用程序。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-03-13T01:43:51.930

我认为这个问题值得一个现代的答案，所以我要自己给出。当我在 2009 年写下这个问题时，我不认为[Phinx](https://phinx.org/)已经存在，而且 Laravel 绝对没有。

今天，这个问题的答案非常明确：编写增量数据库迁移脚本，每个脚本都有一个`up`和一个`down`方法，并在安装或更新应用程序时运行所有这些脚本或它们的增量。并且显然将迁移脚本添加到您的 VCS。

如开头所述，当今 PHP 世界中有很多出色的工具可以帮助您轻松管理迁移。Laravel 内置了数据库迁移，包括相应的 shell 命令。其他人都有一个与 Phinx 类似的强大的与框架无关的解决方案。

Artisan 迁移 (Laravel) 和 Phinx 的工作方式相同。对于数据库中的每一次更改，创建一个新的迁移，使用普通 SQL 或内置查询构建器来编写 up 和 down 方法并运行`artisan migrate`resp。`phinx migrate`在控制台中。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-08-03T12:24:55.957

我做了一些类似于 Manos 的事情，除了我有一个定期更新的“主”文件 (master.sql)（每 2 个月一次）。然后，对于每次更改，我都会使用更改构建一个名为 .sql 文件的版本。这样，我可以从 master.sql 开始并添加每个名为 .sql 文件的版本，直到我升级到当前版本，并且我可以使用名为 .sql 文件的版本更新客户端以使事情变得更简单。

# java - 这个说法在java中正确吗？

> ID：755715
> 
> 赞同：3
> 
> 时间：2009-04-16T11:32:01.563
> 
> 标签：java, datagram

我想使用数据报套接字在两台计算机之间进行数据传输。我以这种方式使用以下行：

```
host=InetAddress.getByAddress("mypc",new byte[]{192,168,1,110}); 
```

但是当我使用上述语句时，我得到了这个错误：“可能失去精度”

所以我以这种方式将 int 转换为字节：

```
InetAddress.getByAddress("mypc",new byte[]{(byte)192,(byte)168,(byte)1,(byte)110}); 
```

上面的声明现在有效吗？？？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-16T11:41:37.673

如果您已经将它放在字符串中，只需使用`getByName()`：

```
InetAddress host = InetAddress.getByName("192.168.1.110"); 
```

使用字节是杂乱无章的，并且可能很危险（由于 Java 中使用了带符号的字节）。`String`如果可以，请坚持使用s。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T12:24:57.677

将正整数文字转换为值没有问题`byte`，即使它们溢出。

该`InetAddress.getByAddress()`函数完美地处理了超过 127 的值将被转换为负数的事实。

唯一需要注意的是将带符号的字节转换回整数，如果您随后想要显示它们。这工作正常：

```
byte b = (byte)192;
System.out.println(b); // outputs "-64"

int i = (b & 0xff);
System.out.println(i); // outputs "192" 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T11:40:43.057

java字节是有符号的（愚蠢的，我知道）所以不可能大于127。

请参阅 alnitaks 的回复以获得更完整（以及以后:) 的答案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T11:39:36.103

它可能不会，因为一个字节的最大值是 127 和超过它会翻转到负 -64 192，-88 168 等等......

# database - 应对数据库身份/自动编号最大化的策略

> ID：755719
> 
> 赞同：2
> 
> 时间：2009-04-16T11:32:26.960
> 
> 标签：database, database-design, types, identity, future-proof

自动编号字段（例如 SQL Server 中的“身份”）是为数据库表提供唯一键的常用方法。然而，鉴于它们很常见，*在未来的某个时候*，我们将处理它们将开始达到最大值的问题。

有谁知道或有推荐的策略来避免这种情况？我希望许多答案会建议切换到 guid，但考虑到这将需要大量的开发（尤其是在许多系统集成并共享价值的情况下），还有其他方法吗？我们是否正朝着新的硬件/操作系统/数据库将简单地允许整数值越来越大的方向前进？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-16T11:34:19.610

如果您真的希望您的 ID 用完，请使用`bigint`. 对于大多数实际用途，它永远不会用完，如果用完了，您可能应该使用`uniqueidentifier`.

如果您每秒有**30 亿**`bigint`次（这意味着 3.0GHz 处理器上的一个事务/周期）事务，则需要大约一个世纪才能用完（即使您推迟了一点）。

也就是说，曾经，“ *[640K 应该对任何人都足够了](http://en.wikiquote.org/wiki/Bill_Gates#Misattributed)。* ”:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T11:39:54.667

请参阅以下相关问题：

*   [重置主键（int 作为身份）](https://stackoverflow.com/questions/572446/reset-primary-key-int-as-identity)
*   [bigint 对于事件日志表是否足够大？](https://stackoverflow.com/questions/277608/is-bigint-large-enough-for-an-event-log-table)

接受/最高投票的答案几乎涵盖了它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T11:36:14.940

是否有可能循环浏览已从数据库中删除的号码？还是大多数记录还活着？只是一个想法。

我的另一个想法是 Mehrdad 建议改用 bigint

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T11:42:03.350

标识列通常设置为从 1 开始并以 +1 递增。负值与正值一样有效，因此可用标识​​符池加倍。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T11:47:08.017

如果您可能会获得如此大的数据量，以至于您的 ID 达到最大值，您可能还希望支持复制，以便您可以拥有多个以某种方式同步的数据库实例。

对于这种情况，以及您希望避免使用“可猜测的”ID（Web 应用程序等）的情况，我建议使用 Guid（唯一标识符），默认使用新的 Guid 作为标识列的替代品。

由于 Guid 是唯一的，它们允许数据正确同步，即使记录是同时添加到系统中的。

# wpf - WPF Window MinWidth 取决于工具栏的大小

> ID：755721
> 
> 赞同：1
> 
> 时间：2009-04-16T11:33:23.747
> 
> 标签：wpf, binding, window, width, stackpanel

在问这个问题之前，我已经查看了所有相关的问题，但没有发现任何相关的问题。

在我的应用程序中，我有工具箱样式栏，它基本上是带有一堆按钮的堆栈面板。用户可以更改工具栏中显示的按钮。

窗口宽度可以改变，但不能小于工具栏的宽度。

起初我希望将属性绑定`MinWidth`到`StackPanel` `Width`属性并创建转换器，将几个像素添加`Width`到`StackPanel`. 问题是我的转换器没有得到宽度`StackPanel`，只有 NaN 作为值:(

不幸的是，`StackPanel`宽度设置为`Auto`，我无法更改。

有什么办法可以让我的 Window可靠`MinWidth`吗？`Width``StackPanel`

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T12:45:22.933

使用`ActualWidth`，不使用`Width`。

宽度是请求的宽度，或“自动”`ActualWidth`的 NaN，是计算所有布局后的实际宽度。

# visual-studio - 如何在 NAnt 中设置工作目录？

> ID：755722
> 
> 赞同：6
> 
> 时间：2009-04-16T11:34:01.513
> 
> 标签：visual-studio, build-process, build, build-automation, nant

我刚刚开始使用 NAnt。我正在学习教程，只是试图设置一个目标来清理我的构建解决方案。我的 Visual Studio 解决方案结构如下：

*   解决方案文件夹
    *   项目文件夹
    *   项目文件夹
    *   工具文件夹
        *   NAnt 文件夹

NAnt .exe 文件位于 Tools/NAnt 文件夹中。我的 .build 文件也在那里。这是我的 .build 文件：

```
<?xml version="1.0" encoding="utf-8" ?>
<project name="NAntTest" default="build" xmlns="http://nant.sf.net/release/0.86-beta1/nant.xsd">
  <property name="solution.file.name" value="NAntTest.sln" />
  <property name="project.config" value="debug" />

  <target name="build" depends="clean.source" />

  <target name="clean.source">
    <exec program="${framework::get-framework-directory(framework::get-target-framework())}\msbuild.exe"
          commandline="${solution.file.name} /t:Clean /p:Configuration=${project.config} /v:q" 
          workingdir="."/>
  </target>

</project> 
```

这就是我所遵循的示例的格式。如果我尝试运行此构建，则会收到一条错误消息，指出项目文件不存在。在 clean.source 目标中，如果我将 workingdir 属性替换为指向我的基本解决方案文件夹的硬编码路径，则脚本会编译并正确运行。显然，如果我需要将项目移动到任何地方，这对于可移植性来说并不理想。

如何让 NAnt 查看基本工作目录？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-16T11:51:29.037

我的建议是始终将构建文件放在解决方案级别。然后构建文件中的所有相对路径将等于解决方案的相对路径。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-03-18T08:01:30.340

没有内置函数可以更改当前目录，但您可以在脚本块中创建一个：

```
 <target name="foo">
    <echo message="Current directory set to ${directory::set-current-directory('C:')}"/>
    <echo message="Current directory is now ${directory::get-current-directory()}"/>
  </target>

  <script language="C#" prefix="directory">
    <code><![CDATA[
    [Function("set-current-directory")]
    public static string SetCurrentDirectory(string path)
    {
      System.IO.Directory.SetCurrentDirectory(path);
      return path;
    }
    ]]></code>
  </script> 
```

当然，您应该避免依赖脚本或代码中的当前目录。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T11:48:41.150

您可以尝试设置项目节点的 basedir 属性。这可能会解决您的问题。

```
<project name="NAntTest" default="build" basedir="C:\Code\MyProject" xmlns="http://nant.sf.net/release/0.86-beta1/nant.xsd"> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T11:56:17.013

如果您设置 nant [exec 任务](http://nant.sourceforge.net/release/latest/help/tasks/exec.html)的详细属性，那么它将吐出它生成的确切命令行。不确定关于执行 msbuild 的具体问题是什么 - 我一直在使用[nantcontrib msbuild 任务](http://nantcontrib.sourceforge.net/release/0.85-rc4/help/tasks/msbuild.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-01-26T21:44:13.137

现在`workingdir`您可以在`exec`元素上定义一个属性。

根据[文档](http://nant.sourceforge.net/release/latest/help/tasks/exec.html)，`workingdir`指的是“命令将在其中执行的目录。”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-10-26T09:28:13.983

作为任务而不是函数：

```
<?xml version="1.0"?>
<project name="test" default="build">
    <script language="C#" prefix="path" >
        <code>
            <![CDATA[
            [TaskName("set-current-directory")]
            public class SetCurrentDirectory : Task {
                private string _path;

                [TaskAttribute("path", Required=true)]
                public string Path {
                    get { return _path; }
                    set { _path = value; }
                }

                protected override void ExecuteTask() {
                    System.IO.Directory.SetCurrentDirectory(_path);;
                }
            }
            ]]>
        </code>
    </script>

    <target name="build">
        <set-current-directory path="c:\Program Files" />
        <echo message="${directory::get-current-directory()}" />
     </target>
</project> 
```

输出：

```
$ nant

build:

     [echo] c:\Program Files 
```

# c# - 包含具有向后兼容性的泛型的类的序列化

> ID：755723
> 
> 赞同：2
> 
> 时间：2009-04-16T11:34:08.907
> 
> 标签：c#, serialization, backwards-compatibility

我试图找出在我的程序中处理序列化的最佳方法。

我想序列化私有字段（所以 XML 序列化器不是选项） 我想序列化像 Bindinglist 这样的泛型类型（SoapSerializer 不是选项） 我还想为能够从我的程序的以前版本反序列化对象提供某种程度的支持。

所以我认为我剩下的就是 BinarySerializer，并实现 ISerializable 接口以应对前向兼容性。

它是否正确？

注意：我必须说我找到了这个项目。但是该项目似乎已经死了，我无法让它工作（文件丢失错误） [http://sourceforge.net/project/showfiles.php?group_id=196509](http://sourceforge.net/project/showfiles.php?group_id=196509)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T11:35:58.217

有了`BinaryFormatter`，可以用[`[OptionalField]`](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.optionalfieldattribute.aspx)，不过这个还是[很脆](http://marcgravell.blogspot.com/2009/03/obfuscation-serialization-and.html)的。

[protobuf-net](http://code.google.com/p/protobuf-net/)怎么样？做到了这一切，并且没有与 BinaryFormatter 相关的版本控制问题。由于它是基于谷歌的“protocol buffers”格式，所以它被**设计**成版本兼容和可扩展的（披露：我是作者，所以我可能有偏见）。

或者，`DataContractSerializer`支持字段序列化；只需`[DataMember]`针对您的字段而不是属性进行设置（需要 .NET 3.0）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T12:18:07.803

是的，您需要实现 ISerializable。

关键点如下

*   实现 GetObjectData(SerializationInfo info, StreamingContext context)。在这里，您需要将密钥对添加到 info 对象中。
*   实现序列化构造函数 MyClass(SerializationInfo info, StreamingContext context)。在这里，您需要从 info 对象中获取值。

# c++ - 错误 C2664：在 C++ 中？

> ID：755726
> 
> 赞同：1
> 
> 时间：2009-04-16T11:34:22.387
> 
> 标签：c++, visual-c++

```
for (int v = 0; v <= WordChosen.length();v++)
{
    if(Letter == WordChosen[v])
    {
        WordChosenDuplicate.replace(v,1,Letter);
    }
} 
```

我收到这个错误

> “错误 4 错误 C2664：'std::basic_string<_Elem,_Traits,_Ax> &std::basic_string<_Elem,_Traits,_Ax>::replace(__w64 unsigned int,__w64 unsigned int,const std::basic_string<_Elem,_Traits ,_Ax> &)' : 无法将参数 3 从 'char' 转换为 'const std::basic_string<_Elem,_Traits,_Ax> &' c:\documents and settings\main\my documents\uni\2nd year\tp2\刽子手\刽子手\hangman.cpp 147 "

放入此行后，我才得到错误

```
WordChosenDuplicate.replace(v,1,Letter); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T11:40:08.863

函数的`std::string::replace()`参数不正确，或者您需要调用不同的重载`replace`. 就像是：

```
 WordChosenDuplicate.replace(v, // substring begining at index v
                             1, // of length 1
                             1, // replace by 1 copy of
                             Letter); // character Letter 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T11:41:39.060

或者

```
WordChosenDuplicate.replace(v,1,std::string(Letter, 1)); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T11:36:38.073

你想达到什么目标？您尝试调用的版本`replace`不存在 - 正如编译器告诉您的那样。您指的是[这些版本](http://www.cppreference.com/wiki/string/replace)中的哪一个？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T11:41:13.977

WordChosenDuplicate 似乎是一个 std::string，在这种情况下，replace() 方法中的第三个参数应该是另一个 std::string 或 c 样式的 const char*。您正在尝试传递单个字符（“字母”）。错误是说没有将 char 作为第三个参数的 replace() 版本。

# c# - 有什么方法可以阻止应用程序在系统线程池中仍然工作而关闭

> ID：755735
> 
> 赞同：1
> 
> 时间：2009-04-16T11:36:56.390
> 
> 标签：c#, multithreading

今天的最后一个问题 :) 感谢您对之前问题的意见。顺便说一句：已经在论坛上搜索过这个问题，但没有什么能完全回答这个问题。

我们使用一些 3rd 方库，它们将工作弹出到 Threadpool 中，并且我们不想在有未完成的活动时关闭。

关闭应用程序时，即使 System.Threading.ThreadPool 中有未完成的工作，应用程序也会关闭，因为这些线程是后台线程。

除了进行某种形式的引用计数（并强制每个排队到池中的项目使用这种我们无法控制的机制）之外，还有一些方法可以在有待完成的工作时阻止应用程序关闭。

我已经研究过使用 GetAvailableThreads() 与 GetMaxThreads()，但它们可能是相同的，因为我们可能在线程被释放但未分配排队工作项时捕获了线程池。

所有帮助表示赞赏？

亲切的问候诺埃尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T13:00:41.320

因为我是真正的程序员（那是 C，男孩 ;-) 我没有使用过 ThreadPool。

但是，我想到了一个建议 - 在您向线程池发出的每个任务上增加一个信号量，并且在完成时释放该信号量。

当您的应用程序退出时，请等待信号量。

有什么用？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T11:44:03.127

除非您可以在第 3 方代码中获得某种回调（可能是完成事件），否则您将很难知道他们何时停止使用`ThreadPool`. 对不起。此类代码通常应位于非后台线程上。我意识到您无法控制这一点-我也不确定是否有简单的方法可以摆脱困境。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T12:55:12.660

I think Marc Gravell is right. Though if you could get access to the threads being used in the thread pool somehow then you could change the Thread.IsBackground property to false to achieve what you want. But I am not sure how you would obtain a reference to a managed thread within the thread pool.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T08:40:56.680

感谢您的回复。我在线程池之外找到了一种解决方法，使用 AOP 和[Castle Windsors](http://www.castleproject.org/container/index.html)动态代理在类周围注入引用计数。对我来说幸运的是，该类公开了一个干净的接口，我可以将其包装起来，而且它很有效。

# c - 字符常量：\000 \xhh

> ID：755741
> 
> 赞同：11
> 
> 时间：2009-04-16T11:38:01.067
> 
> 标签：c

谁能解释字符常量 \000 和 \xhh 的用法，即字符常量中的八进制数和十六进制数？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T11:42:57.310

在 C 中，字符串以值为零 (0) 的字符终止。这可以这样写：

```
char zero = 0; 
```

但这在字符串中不起作用。字符串文字中使用了一种特殊的语法，其中反斜杠用作转义序列介绍，后面跟着各种东西。

一个这样的序列是“反斜杠零”，它仅仅意味着一个值为零的字符。因此，您可以编写如下内容：

```
char hard[] = "this\0has embedded\0zero\0characters"; 
```

另一个序列使用反斜杠后跟字母`'x'`和一个或两个十六进制数字来表示具有指定代码的字符。例如，使用这种语法，您可以编写零字节`'\x0'`。

**编辑**：重新阅读问题，也支持以八为基数的常量，即八进制。它们使用反斜杠后跟数字零，就像八进制文字整数常量一样。`'\00'`因此是 的同义词`'\0'`。

当您需要构造一个包含非打印字符或特殊控制字符的字符串时，这有时很有用。

还有一组单字符“命名”特殊字符，例如`'\n'`换行符、`'\t'`TAB 等。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T11:44:02.363

这些将用于在编辑器中编写其他不可打印的字符。对于标准字符，这将是各种控制字符，对于 wchar，它可能是编辑器字体中未表示的字符。

例如，这在 Visual Studio 2005 中编译：

```
 const wchar_t bom = L'\xfffe';     /* Unicode byte-order marker */
    const wchar_t hamza = L'\x0621';   /* Arabic Letter Hamza */
    const char start_of_text = '\002'; /* Start-of-text */
    const char end_of_text = '\003';   /* End-of-text */ 
```

编辑：使用八进制字符文字有一个有趣的警告。八进制数的长度显然不能超过三位，这人为地限制了我们可以输入的字符。

例如：

```
 /* Letter schwa; capital unicode code point 0x018f (octal 0617)
         *               small unicode code point   0x0259 (octal 1131) 
         */
    const wchar_t Schwa2 = L'\x18f';    /* capital letter Schwa, correct */
    const wchar_t Schwa1 = L'\617';     /* capital letter Schwa, correct */
    const wchar_t schwa1 = L'\x259';    /* small letter schwa, correct */
    const wchar_t schwa2 = L'\1131';    /* letter K (octal 113), incorrect */ 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T11:41:52.023

八进制以 8 为基数（使用数字 0-7），因此每个数字为 3 位：

\0354 = 11 101 100

十六进制以 16 为底（使用数字 0-9，AF），每个数字为 4 位：

\x23 = 0010 0011

在 C 字符串（char 数组/指针）中，它们通常用于对不易表示的字节进行编码。

所以，如果你想要一个使用 STX 和 ETX 等 ASCII 代码的字符串，你可以这样做：

```
char *msg = "\x02Here's my message\x03"; 
```

# iphone - 如何阻止网页从 iPhone 缩放？

> ID：755748
> 
> 赞同：5
> 
> 时间：2009-04-16T11:40:04.477
> 
> 标签：iphone

一些移动网站（例如[BBC 移动网站](http://www.bbc.co.uk/mobile)）阻止您在 iPhone 上放大主页 - 这是如何实现的。是否有必须包含在 HTMl 代码或其他内容中的指令？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-16T11:49:15.407

您只需要使用元标记告诉 iPhone 不要让用户缩放：

```
<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/> 
```

这仍然应该让您的网页旋转，但不能缩放。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T11:44:53.920

这是因为网站的宽度设置为 iPhone 显示器的原始分辨率。移动版 Safari 在任何网站上都不会真正缩放到 100% 以上，在标准尺寸的网站上（例如（1000 像素宽）），它一开始就被缩小了，您可以在双击或使用捏合手势时指定缩放级别。

要达到相同的效果，请在您的网站上使用最大宽度来匹配 iPhone 的分辨率，即 320 像素。

在 CSS 中，这将像这样完成：

```
div#wrapper
{
  width: 320px;
} 
```

# asp.net - 必填字段验证器

> ID：755760
> 
> 赞同：1
> 
> 时间：2009-04-16T11:42:45.690
> 
> 标签：asp.net

如何为下拉列表使用必填字段验证器？

我的下拉列表有

-天-

项目1

项目2

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-16T11:47:08.657

使用 InitialValue 属性作为您不想被选中的默认项：

```
<asp:DropDownList ID="ddlItems" runat="server">
    <asp:ListItem Text="-Day-" Value="-Day-"></asp:ListItem>
    <asp:ListItem Text="Item 1" Value="Item 1"></asp:ListItem>
    <asp:ListItem Text="Item 2" Value="Item 2"></asp:ListItem>
</asp:DropDownList>

<asp:RequiredFieldValidator runat="server" ID="RequiredFieldValidator1" 
    ErrorMessage="Validation Message !" ControlToValidate="ddlItems" 
    InitialValue="-Day-"></asp:RequiredFieldValidator> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T12:23:00.663

您可以像这样使用 CompareValidator：

```
<asp:DropDownList ID="ddlItems" runat="server">
    <asp:ListItem Text="-Day-" Value="-1"></asp:ListItem>
    <asp:ListItem Text="Item 1" Value="Item 1"></asp:ListItem>
    <asp:ListItem Text="Item 2" Value="Item 2"></asp:ListItem>
</asp:DropDownList>

<asp:CompareValidator runat="server" ID="CompareFieldValidator1" 
    ErrorMessage="Validation Message !" ControlToValidate="ddlItems" 
    ValueToCompare="-1" Operator="NotEqual"></asp:CompareValidator> 
```

-Edoode

# ruby-on-rails - ActiveRecord 无法更新 HABTM 关系

> ID：755774
> 
> 赞同：2
> 
> 时间：2009-04-16T11:47:45.863
> 
> 标签：ruby-on-rails, activerecord, has-and-belongs-to-many

我正在使用一个简单的模型进行用户授权，其中包含两个 ActiveRecords `User`，`Role` `User`并且`Role`彼此之间具有 HABTM 关系。

我尝试创建一个用户界面，通过简单的复选框为用户分配角色——就像在[Railscasts Episode #17](http://railscasts.com/episodes/17-habtm-checkboxes)中一样。

我的问题是既不`User#new`也不`User#update_attributes`使用我的表单提交的参数来更新`User`对象与其角色之间的关系。`params[:user][:role_ids]`包含正确的值。但是在or`@user.roles`之后调用会返回一个空数组。`User.new(params[:user])``@user.update_attributes(params[:user])`

`@user.roles`使用or手动分配角色`@user.role_ids`，但不是 or 中的“魔法*”*。`User#new``User#update_attributes`

有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-16T12:02:37.717

您的用户模型中有 attr_accessible 或 attr_protected 调用的可能性很高，从而使 role_ids 免受大规模分配。

如果您真的想通过批量分配运算符更新角色，只需添加

```
attr_accessible :role_ids 
```

到你的模型。但是，我建议您先阅读[http://railspikes.com/2008/9/22/is-your-rails-application-safe-from-mass-assignment](http://railspikes.com/2008/9/22/is-your-rails-application-safe-from-mass-assignment)，以了解批量分配的所有潜在问题。

# python - 用于伪 cronjobs 的 Google App Engine？

> ID：755777
> 
> 赞同：4
> 
> 时间：2009-04-16T11:48:33.710
> 
> 标签：python, google-app-engine, cron

我寻找一种创建伪 cronjobs 的可能性，因为我不能在 UNIX 上使用真正的作业。

由于 Python 脚本可以无限期运行，我认为 Python 将是一个很好的解决方案。

在 Google App Engine 上，您可以设置 Python 脚本，而且它是免费的。所以我应该使用 App Engine。

App Engine 允许 160,000 次外部 URL 访问（对吗？），因此您应该有 160000/31/24/60 = 每分钟 3,6 次访问。

所以我的脚本是：

```
import time
import urllib
while time.clock() < 86400:
    # execute pseudo-cronjob file and then wait 60 seconds
    content = urllib.urlopen('http://www.example.org/cronjob_file.php').read()
    time.sleep(60) 
```

不幸的是，我无法测试脚本，所以我的问题是：1）你认为这会起作用吗？2) 是否允许（Google TOS）将服务用于此类活动？3) 我计算的每分钟 URL 访问次数是否正确？

提前致谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T12:48:53.550

也许我误解了你，但是 cron 配置文件会让你这样做（没有 Python）。您可以在 cron.yaml 文件中添加类似的内容：

```
cron:
- description: job that runs every minute
  url: /cronjobs/job1
  schedule: every minute 
```

有关调度的更多信息，请参阅[Google 的文档](http://code.google.com/appengine/docs/python/config/cron.html#About_cron_yaml)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T20:28:05.913

谷歌对任务的运行时间有一些限制。

在 SDK 中进行的 URLFetch 调用现在有 5 秒超时，[这里](http://googleappengine.blogspot.com/2008/11/sdk-116-released.html)

它们允许您在任何一天安排多达 20 个 cron 任务。 [这里](http://code.google.com/appengine/docs/python/config/cron.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T11:52:31.470

重复，请参阅[google appengine 上的 cron 作业](https://stackoverflow.com/questions/145651/cron-jobs-on-google-appengine)

GAE 现在正式支持 Cron 作业： [http ://code.google.com/appengine/docs/python/config/cron.html](http://code.google.com/appengine/docs/python/config/cron.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T20:47:24.230

您可能想澄清您想要以哪种方式进行操作

您想使用 appengine 来运行作业吗？即，该工作在谷歌的服务器上运行？

或者

你想在你的服务器上使用你的 OWN 代码，并使用谷歌应用引擎来触发它吗？

如果是前者：谷歌现在做 cron。使用它:)

如果是后者：您可以使用 google 的 cron 来触发您自己的，即使它是间接的（即 google-cron 调用 google-app-engine 来调用 your-app）。

如果可以，请启动一个线程来完成这项工作，以便您的页面立即返回。不要忘记：如果你调用[http://whatever/mypage.php](http://whatever/mypage.php)，并且你的浏览器死掉了（或者在这种情况下，谷歌会因为运行时间过长而终止你的进程），php 脚本通常仍然会运行到最后——输出只是去没有在哪里。

如果做不到这一点，请尝试启动一个线程（不确定您是否可以在 PHP 中做到这一点 - 我是 PHP 的 C# 新手）

如果一切都失败了：获得更好的虚拟主机！我每月为 dreamhost.com 支付 6 美元左右，我可以在他们的服务器上运行 cron 作业 - 它包括在内。他们做 PHP、Rails 等。您甚至可以 ping 我以获得折扣代码 :) （查看网站的个人资料等）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-06-12T16:00:21.640

按照 Nic Wise 所说的去做，或者使用 www.guardiano.pm 之类的服务外包 cronjob，这样您就可以真正调用 www.yoursite.com/myjob.php，并且每次调用该 url 时都会执行您想要的操作。

Ps 是免费的 Pss 是我的宠物项目，处于测试阶段

# php - 使用 PHP 将 jpg 图像转换为 gif、png 和 bmp 格式

> ID：755781
> 
> 赞同：20
> 
> 时间：2009-04-16T11:48:48.390
> 
> 标签：php, image-processing

如何使用 PHP 将单个 jpg 图像转换为 3 种不同的图像格式 gif 、 png 和 bmp？

请帮忙

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-04-16T12:09:39.587

您首先使用[imagecreatefromjpeg()](http://www.php.net/manual/en/function.imagecreatefromjpeg.php)从文件中创建一个图像对象。然后将该对象转储为不同的格式（例如使用[imagegif()](http://www.php.net/manual/en/function.imagegif.php)）：

```
$imageObject = imagecreatefromjpeg($imageFile);
imagegif($imageObject, $imageFile . '.gif');
imagepng($imageObject, $imageFile . '.png');
imagewbmp($imageObject, $imageFile . '.bmp'); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-16T11:50:39.600

使用 libGD — [http://www.php.net/manual/en/book.image.php](http://www.php.net/manual/en/book.image.php)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-07-19T04:31:58.960

我在 Github 上建立了一个新的开源项目，它允许在 PHP 中读取和保存 BMP 文件（实际的 BMP 文件，而不是 wbmp）和其他文件格式。它很好用而且很容易使用。

该项目称为[PHP Image Magician](http://phpimagemagician.jarrodoberto.com)。

# c++ - 链接器生成的 .map 文件有什么用？

> ID：755783
> 
> 赞同：47
> 
> 时间：2009-04-16T11:49:26.110
> 
> 标签：c++, visual-c++, linker

当使用 /MAP 参数或“生成映射文件”项目设置时，VC++ 链接器生成的 .map 文件有什么用？我什么时候需要它们，我如何从中受益？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-04-16T12:22:51.740

一篇关于如何使用地图文件查找崩溃的好文章。

[http://www.codeproject.com/KB/debug/mapfile.aspx](http://www.codeproject.com/KB/debug/mapfile.aspx)

手动完成所有这些是非常无趣的。

我不知道有任何工具可以读取地图文件并帮助找到崩溃位置。如果有人知道，请更新我们。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-16T13:04:18.333

对于嵌入式系统，地图文件更有用。（尽管您不会为此使用 Visual C++；）

诸如了解程序/数据内存即将耗尽以及特定变量所在的位置之类的事情很重要。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-11-16T14:22:44.860

**在分析和故障转储时， **WinDBG**使用`.map`和`.pdb`文件来帮助调试崩溃。`.hdmp``.mdmp`**

 **基本上，它们将内存地址偏移映射到`.exe`（和/或加载`.dll`的）内的函数和变量。如果您需要弄清楚客户为什么不高兴，这通常非常有用。当他们证明这不是你的错时更有用。

调试“事后”崩溃最有用的方法是使用*WinDbg*（Windows 平台）。打开它，然后打开故障转储。然后将源路径设置为指向代码（如果有的话），将符号路径设置为指向您的 .map 和 .pdb 以及指向 .exe 的图像路径，然后在命令行中键入“ **!analysis -v** ” . 现在，您有了*完整的堆栈跟踪，其中包含代码行*和所有内容。当然，您需要为您正在调试的 exe 和 DLL 版本提供正确版本的源代码。

如果路径中有 MS 符号服务器，并且整页堆已打开或`adplus`正在运行，那就更好了。特别是使用 ADPlus，您可能还会捕获变量值。

我最喜欢的一些 WinDbg 资源：
第一站 :: [http://www.microsoft.com/whdc/devtools/debugging/debugstart.mspx](http://www.microsoft.com/whdc/devtools/debugging/debugstart.mspx)
强制加载符号 :: [http://www.osronline.com/ShowThread.cfm?链接=182377](http://www.osronline.com/ShowThread.cfm?link=182377)
有用的网站 :: [http://www.dumpanalysis.org/blog/index.php/category/windbg-tips-and-tricks/page/7/](http://www.dumpanalysis.org/blog/index.php/category/windbg-tips-and-tricks/page/7/)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-16T11:50:48.447

您很少需要它们，但它们可以方便地调试一些问题，因为它们提供了有关函数和数据位置的信息。

例如：

*   所有段的详细信息（代码、数据和其他）。
*   将行号链接到代码

您可以将映射文件用于调试工具。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-01-16T14:09:48.687

当您需要跟踪编译单元和库之间的依赖关系时，链接器映射在大型项目中非常有用。通常，链接器会报告导致问题的符号，而且通常简单地搜索此符号名称不会返回任何结果（或者会返回大量误报，例如`read`）。

如果没有链接器映射，您唯一的选择是分析所有可用的源文件（如果使用宏，则在预处理通过后，通常是这种情况）并希望您找到相关的位置。

链接器映射通常有一个名为“按文件/符号引用”的部分，它告诉您项目的另一个目标文件需要哪个目标文件，以及确切引用了哪个符号。

我曾经在一个项目上工作，该项目必须移植到没有语言环境支持的系统上。链接器报告“未定义的引用`_localeconv_r`”错误，通过搜索源来追踪这将是一种痛苦。幸运的是，生成的 GCC 链接器映射文件通过`-Map=output.map`一次搜索即可显示所有有问题的函数。

# c# - c# Ajax 延迟加载

> ID：755787
> 
> 赞同：1
> 
> 时间：2009-04-16T11:51:04.263
> 
> 标签：c#, ajax, lazy-loading

我需要在一个 aspx 页面上填充 4 个 GridView，但我只在页面加载时将一个数据表绑定到其中一个。我需要在页面加载后填充其他 3 个。

有谁知道使用 ajax 的最佳方法？

目前我在一个按钮上使用 javascript 来 __doPostBack，它 pupulates 3 GridViews 但不幸的是，即使使用更新面板，这也会强制加载整个页面。我需要加载页面，然后在返回数据表时填充 GridView。

任何建议将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T12:44:57.583

The way you are doing it should work ok, although using jquery to populate a div via the $("#targetDiv").load("contentUrl"); function may be a cleaner way to do it. Anyway, in order to get your current implementation working, there could be a few things you want to look at:

1.  I assume EnablePartialRendering is true on your ScriptManager (always worth checking!).
2.  Make sure the eventTarget for the __dopostback call is set up as an async trigger for your update panels or that it is inside the UpdatePanel if you are only using one UpdatePanel. ([See here for details](http://encosia.com/2007/07/13/easily-refresh-an-updatepanel-using-javascript/))
3.  Try returning false from the javascript code that executes in the onclick event handler if you have attached this to a button, to make sure the form is not being submitted normally by your browser when you click the button.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T12:29:59.630

如果我正确理解了这个问题，您希望在页面进入浏览器后加载数据。如果是这种情况，那么您可以在页面加载到客户端时使用 JavaScript 触发事件。

我使用的一种方法是在页面上放置一个隐藏的（使用 CSS，而不是任何属性）按钮并使用 javascript“单击”它。按钮单击事件的事件需要在页面的代码中连接。此外，该按钮必须位于更新面板中，该面板要么包含您要绑定的网格，要么具有适当的触发器以使它们重新加载。

当此代码被触发时，您可能会查看 JQuery 以进行管理。$(document).ready(function(){ /* 你的代码在这里... */ }); 方法将在整个 DOM 可用后触发，这比等待整个页面加载（图像等）要快。

# c - 在 C 中将变量保持为库范围的全局变量

> ID：755788
> 
> 赞同：2
> 
> 时间：2009-04-16T11:51:19.693
> 
> 标签：c, scope

有没有办法让全局变量只在库内部可见，而无法从 C 中访问该库的程序访问？

保护变量并不是至关重要的，但如果程序无法导入它，我宁愿这样做，因为这与他们无关。

我不关心涉及宏的解决方案。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-16T11:52:48.597

如果您使用 g++，则可以使用链接器工具来使用属性。

```
__attribute__((visibility("hidden"))) int whatever; 
```

您还可以将所有内容标记为隐藏并使用此标志明确标记可见的内容：-fvisibility=hidden

然后用以下标记可见变量：

```
__attribute__((visibility("default"))) int whatever; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-16T11:54:52.117

```
static int somelocalvar = 0; 
```

这使得 somelocalvar 仅在声明它的源文件中可见（[参考和示例](http://www.lix.polytechnique.fr/~liberti/public/computing/prog/c/C/SYNTAX/storage_class.html#static)）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-16T13:02:06.933

在库实现中，像这样声明你的变量：

```
struct my_lib_variables
{
  int var1;
  char var2;
}; 
```

现在在最终用户的标题中，像这样声明它：

```
struct my_lib_variables; 
```

它将结构声明为*不完整类型*。将使用标头的人将能够创建指向结构的指针，但仅此而已。目标是他们必须写这样的东西：

```
#include "my_lib.h"

struct my_lib_variables* p = my_lib_init();
my_lib_do_something(p);
my_lib_destroy(p); 
```

库代码能够修改变量，但库不能直接这样做。

* * *

或者您可以使用全局变量，但将`extern`声明放在最终用户不会使用的标题中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T12:03:36.420

您可以使用另一个头文件将功能导出到外部模块而不是内部功能，因此您不必声明不必从模块外部访问的全局变量。

编辑：如果您多次声明内容，则只有链接器问题。没有必要将所有全局数据保存在一个头文件中，事实上，为了可维护性和不同的责任区域，将其分成几个较小的部分可能是明智的。将外部数据和内部数据拆分为头文件就是这样的原因之一，这应该不是问题，因为可以在同一个源文件中包含多个头文件。并且不要忘记头文件中的守卫，这样可以避免链接中的冲突。

```
#ifndef XXX_HEADER_FILE
#define XXX_HEADER_FILE
code
#endif 
```

# html - IFrame (HTML) 是否已过时？

> ID：755795
> 
> 赞同：95
> 
> 时间：2009-04-16T11:53:12.607
> 
> 标签：html, iframe, obsolete

收到关于此的矛盾信息，希望他们不是。我无法想象对它的支持会停止，因为有大量网站使用它们。

一些额外的问题：

1.  他们为什么要逐步淘汰这个标签？
2.  有什么替代方案吗？

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-04-16T12:03:13.690

对 HTML 5 的支持`<iframe>`仍然存在，所以我认为这在不久的将来不会改变。

要回答您的其他问题：

1.  `<iframe>`s（通常作为框架）大多数时候对用户不友好：
    *   它们不允许通过 URL 轻松访问框架中的内容（至少不会丢失框架外的内容）。
    *   大多数*“技术恐惧症”*用户都对框架感到恼火。
    *   据我所知，它们为浏览器渲染的速度较慢
2.  替代方案包括动态页面生成（SSI、PHP、Rails 等）和使用 JavaScript/AJAX 更改内容，例如`<div>`

需要明确的是：我说`<iframe>`的是界面元素。不是用于加载其他内容的隐藏元素，例如 Google Mail。

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2009-04-16T15:11:24.360

在我**看来**，W3C 从 Strict HTML 和 XHTML doctypes 中转储 iframe 是抢先一步。从理论上讲，您可以使用该`<object>`元素将外来对象添加到您的文档中，但是浏览器的差异和限制使得这对许多开发人员来说是不可能的。随着更加实用的 HTML 5（仍是草案），iframe 又回来了，甚至有两个新属性：`seamless`和有趣的`sandbox`.

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-04-16T11:57:32.237

IFrame 并没有过时，但使用它们的原因很少见。

*   使用 IFrame 提供您自己的内容会在访问该区域的内容周围创建一堵“墙”。
*   **[对于像谷歌这样的爬虫，目前还不清楚 iframe 中的内容是否会像内容只是页面的一部分一样高。](http://groups.google.com/group/Google_Webmaster_Help-Indexing/browse_thread/thread/81b2f0e1dd49664a)**对许多人来说，这足以成为不使用它的理由。
*   它使 jQuery、原型等工具无法访问 IFrame 的 DOM。

使用 iframe 的原因：

*   它非常适合将其他人的东西与其他域隔离开来，但它不能顺利集成。（样式表、javascript 等...）
*   与使用嵌入标签相比，有时通过 iframe 可以更轻松地集成多媒体。
*   真的，非常专业的案例，比如 gmail 的案例，他们将其用于声音和历史管理。

我还要回答说没有必要删除 iframe，它是一个需要的标签，并且会存在一段时间。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2009-04-16T12:09:51.473

对于页面布局，iframe**已过时。**永远不要使用它们来代替良好的 CSS 布局，即使是基于表格的布局也更好。

使用 iframe 的充分理由是：

*   **ads**：例如 adwords 使用这种技术，它有利于封装 - ad css 不会破坏您的页面。
*   **hidden iframe**：它可以用于数百个可用的东西，如跟踪、ajax-alternative 等。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2011-03-28T16:38:53.047

我已经看到很多论坛建议使用 Object 标记作为 IFrame 的替代品，这可能在大多数情况下都有效。

例如，我有一个在 IFrame 中显示的 PDF（因为除了 PDF 之外，我们还需要在页面上显示其他内容）并且能够使用 Object.

什么是：

```
<iframe id="confirmed_pdf" class="current_pdf" src="/prescriptions/show_pdf?id=123" height="570" width="480"></iframe> 
```

成为：

```
<object id="confirmed_pdf" class="current_pdf" data="/prescriptions/show_pdf?id=123" type="application/pdf" height="570" width="480">
  <p>[Show this message if displaying the PDF did not work]</p>
</object> 
```

但是 Object 不是一个合适的替代品来满足只能打印页面的 PDF 部分的要求。

IFrame 就像它自己在页面中的窗口（基本上是窗口中的窗口），一旦获得窗口对象，就可以在其上调用 .print() ，例如：

```
jQuery("#confirmed_pdf").contentWindow.print(); 
```

IFrame 具有 contentWindow 属性，这使得仅打印该部分成为可能。Object 没有 contentWindow 属性，因此无法仅打印页面的部分。

因此，似乎如果您只是使用 IFrame 来显示某些内容，则可以使用其他标签（例如 Object）来代替。但是如果您需要以某种方式与 IFrame 的内容进行交互，那么 IFrame 可能是必需的。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-04-16T12:51:54.213

**IFrames** are not dead, but **Frameset/Frames** are dying.

In the last 2 releases of **IE** (IE7/IE8) zooming in Frames (not IFrames) has created disastrous results.

By all means use IFrames, but IMHO stay clear of Framesets/Frames.

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-04-16T12:00:20.077

IFrame 经常与 AJAX 一起使用。例如，我相信 GMail 使用了九个隐藏的 IFrame。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-04-16T12:23:51.597

在我以前的公司，我们提供了一个托管应用程序，客户可以将其集成到他们自己的网站中。有时，他们会使用 IFrame 来执行此操作，将我们托管的页面安装到他们现有的设计中。有时这甚至可以无缝完成（即 IFrame 没有边框或滚动条，它看起来就像页面的一部分）。我认为这是对标签的一个很好的使用。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-04-16T12:29:29.523

它们在某些情况下可能非常有用，但这些是有限的。特别是跨多个站点嵌入通用功能。

例如，我有一个客户，他经营着许多苏格兰商品电子商务网站。作为其中的一部分，我们开发了几个简单的应用程序，可以根据您的姓氏或您选择的格子呢（如果您愿意，可以傻笑，但格子呢每年对我们的经济价值 7 亿美元）来定位可能的氏族名称。这背后的数据库非常大（核心名称和格子表中有近一万行）并且相当定期更新。

因此，我们将应用程序设置为在一个网站上运行，然后使用 iframe 将它们嵌入到我们的其他网站中，从而实现简单的 javascript 参数传递，因此我们可以将格子呢或部落的选择与嵌入网站上的功能集成在一起。iframe 设置为无边框，因此对最终用户来说完全无缝。

当然还有其他方法可以做到这一点，但是 iframe 的使用既简单又健壮。而且它肯定不会过时。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2010-11-30T19:23:24.643

用于课程的马... <iframe> 就像其他任何东西...出于正确的目的，它们是正确的工具；出于错误的目的，它们是丑陋的黑客，或者更糟。

在 Ajax 中，<div> 通常是更合适的容器。在某些地方，由 <iframe>s 支持的将外部内容作为您自己网站的一部分的行为是不合适的。

前几天，我的团队使用 <iframe> 作为让用户访问其 HTML 电子邮件历史记录的理想方式 - 电子邮件是完整的 <html> 页面，我们希望将其轻松插入到我们的 Web 模板中。<iframe> 非常适合呈现该数据]'。

另一方面，<iframe> 几乎总是应该在任何用户提交的输出回网站的内容中被删除或禁用，因为在这种情况下，它们是一个主要的安全问题。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-05-16T05:58:48.910

The google gadget specification currently relies on iframes: [http://code.google.com/apis/gadgets/docs/spec.html](http://code.google.com/apis/gadgets/docs/spec.html)

Currently they are the only simple way to provide isolation for javascript apps that are pulled from multiple domains/providers.

Also many of the widgets that people embed on their websites from third-parties use iframes.

While they do have their drawbacks, iframes provide a pragmatic solution to common problems on the web. I'd have to guess that they will be around for some time to come.

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-02-02T15:36:00.827

合规性和安全性问题也可能促使您使用 iframe；购物车是流行的基于 IFrame 的实现，当您希望在视觉上将购物车合并为某些网页的一部分而不对事物的支付处理方面承担全部责任时。

我们通常会提供一个 iframe 来整合我们的电子商务产品和客户，例如它的交钥匙方式。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-09-17T04:32:58.067

我在一家公司工作，该公司将框架用于下拉菜单、列表、内容块等所有内容，以涵盖 .net Web 表单的复杂性。该应用程序非常慢，只能在 IE 上运行。不要这样做。

# .net - 如何创建 LINQ to SQL 事务？

> ID：755796
> 
> 赞同：69
> 
> 时间：2009-04-16T11:54:49.810
> 
> 标签：.net, linq-to-sql, transactions

我有一段涉及多次插入的代码，但需要在完成插入其他表之前执行 submitchanges 方法，以便获取 Id。我一直在网上搜索，找不到如何在 linq to sql 中创建事务。我已经在我希望交易发生的代码中添加了注释。

```
 var created = false;
    try
    {
        var newCharacter = new Character();
        newCharacter.characterName = chracterName;
        newCharacter.characterLevel = 1;
        newCharacter.characterExperience = 0;
        newCharacter.userUsername = userUsername;
        newCharacter.characterClassID = ccslst[0].characterClassID;
        //Open transaction

            ydc.Characters.InsertOnSubmit(newCharacter);
            ydc.SubmitChanges();

            foreach (var ccs in ccslst)
            {
                var cs = new CharacterStat();
                cs.statId = ccs.statID;                        
                cs.statValue = ccs.statValue;
                cs.characterID = newCharacter.characterID;
                ydc.CharacterStats.InsertOnSubmit(cs);
            }                    

            var ccblst = ydc.ClassBodies.Where(cb => cb.characterClassID == newCharacter.characterClassID);
            foreach (var ccb in ccblst)
            {
                var charBody = new CharacterBody();
                charBody.bodyId = ccb.bodyId;
                charBody.bodyPartId = ccb.bodyPartId;
                charBody.characterID = newCharacter.characterID;
                ydc.CharacterBodies.InsertOnSubmit(charBody);
            }
            ydc.SubmitChanges();      
            created = true;
        //Commit transaction
        }
        catch (Exception ex)
        {
            created = false;
            //transaction Rollback;                    
        }
        return created; 
```

编辑：忘了提 ydc 是我的数据上下文

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-04-16T11:56:40.943

将整个东西包裹在一个`TransactionScope`. `transaction.Complete()`在你想提交的地方打电话。如果代码在没有被调用的情况下退出块`Complete()`，事务将被回滚。但是，在查看@s_ruchit 的答案并重新检查您的代码后，您可能会重写它以不需要`TransactionScope`. 第一个示例`TransactionScope`按原样使用您的代码。第二个例子做了一些小的改动，但达到了相同的目的。

`TransactionScope`当您从数据库中读取一个值并使用它为要添加的对象设置一个新值时，您需要使用它。在这种情况下，LINQ 事务不会覆盖第一次读取，只是稍后提交新值。由于您使用读取的值来计算写入的新值，因此您需要将读取包装在同一个事务中，以确保另一个读取器不会计算相同的值并避免您的更改。在您的情况下，您只是在进行写入，因此标准 LINQ 事务应该可以工作。

示例 1：

```
var created = false;

using (var transaction = new TransactionScope())
{
    try
    {
        var newCharacter = new Character();
        newCharacter.characterName = chracterName;
        newCharacter.characterLevel = 1;
        newCharacter.characterExperience = 0;
        newCharacter.userUsername = userUsername;
        newCharacter.characterClassID = ccslst[0].characterClassID;

        ydc.Characters.InsertOnSubmit(newCharacter);
        ydc.SubmitChanges();

        foreach (var ccs in ccslst)
        {
            var cs = new CharacterStat();
            cs.statId = ccs.statID;                        
            cs.statValue = ccs.statValue;
            cs.characterID = newCharacter.characterID;
            ydc.CharacterStats.InsertOnSubmit(cs);
        }                    

        var ccblst = ydc.ClassBodies.Where(cb => cb.characterClassID == newCharacter.characterClassID);
        foreach (var ccb in ccblst)
        {
            var charBody = new CharacterBody();
            charBody.bodyId = ccb.bodyId;
            charBody.bodyPartId = ccb.bodyPartId;
            charBody.characterID = newCharacter.characterID;
            ydc.CharacterBodies.InsertOnSubmit(charBody);
        }
        ydc.SubmitChanges();      
        created = true;

        transaction.Complete();
    }
    catch (Exception ex)
    {
        created = false;
    }
}
return created; 
```

示例 2：

```
 try
    {
        var newCharacter = new Character();
        newCharacter.characterName = chracterName;
        newCharacter.characterLevel = 1;
        newCharacter.characterExperience = 0;
        newCharacter.userUsername = userUsername;
        newCharacter.characterClassID = ccslst[0].characterClassID;

        ydc.Characters.InsertOnSubmit(newCharacter);

        foreach (var ccs in ccslst)
        {
            var cs = new CharacterStat();
            cs.statId = ccs.statID;                        
            cs.statValue = ccs.statValue;
            newCharacter.CharacterStats.Add(cs);
        }                    

        var ccblst = ydc.ClassBodies.Where(cb => cb.characterClassID == newCharacter.characterClassID);
        foreach (var ccb in ccblst)
        {
            var charBody = new CharacterBody();
            charBody.bodyId = ccb.bodyId;
            charBody.bodyPartId = ccb.bodyPartId;
            newCharacter.CharacterBodies.Add(charBody);
        }
        ydc.SubmitChanges();      
        created = true;
    }
    catch (Exception ex)
    {
        created = false;
    } 
```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-04-16T12:04:48.023

在使用 LINQ to SQL 时，您不需要执行显式事务实现。默认情况下，所有数据库操作都包含在事务中。

前任：

```
AppDataContext db = new AppDataContext();

<In memory operation 1 on db>
<In memory operation 2 on db>
<In memory operation 3 on db>
<In memory operation 4 on db>

db.SubmitChanges(); 
```

db DataContext 初始化和 db.SubmitChanges() 之间的所有操作都由 .Net 围绕数据库事务进行包装，以确保您的数据库保持一致并在表之间保持属性完整性。

[在这里阅读](http://weblogs.asp.net/scottgu/archive/2007/07/11/linq-to-sql-part-4-updating-our-database.aspx)[Scott Guthrie](http://weblogs.asp.net/scottgu) 的文章：- [http://weblogs.asp.net/scottgu/archive/2007/07/11/linq-to-sql-part-4-updating-our-database.aspx](http://weblogs.asp.net/scottgu/archive/2007/07/11/linq-to-sql-part-4-updating-our-database.aspx)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2021-09-25T15:09:29.930

EF6 提供了`Database.BeginTransaction()`一种更简单的方法，让用户在现有 DbContext 中自己启动和完成事务 - 允许在同一个事务中组合多个操作，因此可以全部提交或全部回滚。它还允许用户更轻松地指定事务的隔离级别。`DbContextTransaction.Commit()`方法对底层存储事务执行提交，而`DbContextTransaction.Rollback()`方法对底层存储事务执行回滚。

```
var created = false;
using (var ydc = new CustomContext())
{
    using (var dbContextTransaction = ydc.Database.BeginTransaction())
    {
        try
        {
            var newCharacter = new Character();
            newCharacter.characterName = chracterName;
            newCharacter.characterLevel = 1;
            newCharacter.characterExperience = 0;
            newCharacter.userUsername = userUsername;
            newCharacter.characterClassID = ccslst[0].characterClassID;
            //Open transaction

            ydc.Characters.InsertOnSubmit(newCharacter);
            ydc.SubmitChanges();

            foreach (var ccs in ccslst)
            {
                var cs = new CharacterStat();
                cs.statId = ccs.statID;
                cs.statValue = ccs.statValue;
                cs.characterID = newCharacter.characterID;
                ydc.CharacterStats.InsertOnSubmit(cs);
            }

            var ccblst = ydc.ClassBodies.Where(cb => cb.characterClassID == newCharacter.characterClassID);
            foreach (var ccb in ccblst)
            {
                var charBody = new CharacterBody();
                charBody.bodyId = ccb.bodyId;
                charBody.bodyPartId = ccb.bodyPartId;
                charBody.characterID = newCharacter.characterID;
                ydc.CharacterBodies.InsertOnSubmit(charBody);
            }
            ydc.SubmitChanges();
            created = true;
            // Commit transaction
            dbContextTransaction.Commit();
        }
        catch (Exception ex)
        {
            created = false;
            // Rollback transaction
            dbContextTransaction.Rollback();
        }
    }
}
return created; 
```

# subsonic - 表名限制

> ID：755800
> 
> 赞同：0
> 
> 时间：2009-04-16T11:55:56.267
> 
> 标签：subsonic

使用 SubSonic 时，表格名称是否有任何限制，或者某些名称存在问题？我有一个名为“活动”的表，而 SubSonic 似乎无法识别它。当它被称为“活动”时，它运行良好。

基本上，我想使用单数表名作为约定（以及[SubSonic 约定](http://subsonicproject.com/setup/subsonic-conventions/)博客文章中详述的其他约定）并将 fixPluralClassNames="false" 添加到 web.config（因为我有一个名为“Focus”的表， SubSonic 一直将其命名为“Focu”）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T15:41:03.483

通常，C# 中的保留字不允许作为表名。我不确定为什么 Activity 会是一个问题。未生成表时首先要检查的是该表是否具有主键。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T15:43:08.953

我遇到的一个常见问题是，如果我的表格以特殊字符或数字开头，它将不起作用。改变它在我的最后。除此之外，我没有遇到任何其他问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T17:26:36.910

清除 Temporary ASP.NET Files 文件夹中的文件（关闭 Visual Studio 后）或更改 .abp 文件似乎是对此的有效修复。

# rss - 如何设置 RSS 文件的权限？

> ID：755805
> 
> 赞同：2
> 
> 时间：2009-04-16T11:57:07.510
> 
> 标签：rss

我想创建一个内部 RSS 源（我在澳大利亚的 3 Mobile 工作），以便在 INQ1 手机或任何其他 RSS 阅读器上消费。然而，在手机内置的 RSS 阅读器上对其进行测试后，我意识到如果没有密码保护提要的能力，或者以其他方式限制对提要的访问，我几乎没有机会进一步发展这个想法。

我想到的一件事是定期更改提要的 Uri，这样离开公司的经理就无法继续订阅和查看敏感信息，但让用户这样做的想法会让它更难卖，而且非常不雅。

有谁知道如何做到这一点，以便在下载提要之前，读者必须对用户进行身份验证？它是提要中元数据的一部分，还是您将在阅读器软件中设置的内容？

**更新：**我应该解释说我已经在父文件夹上放置了文件夹级权限，当在浏览器中查看提要时，这会显示正常的身份验证对话框，但这只会导致更新失败，没有任何解释或警告手机的 RSS 阅读器，并且与丢失的文件无法区分，当我下次尝试刷新提要时。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-18T00:38:33.590

如果手机中的阅读器不支持 HTTP Basic 或 Digest，最好的办法是为每个消费者创建一个唯一的 url 到 feed。让客户登录并生成一个链接，其中包含该用户唯一的某个令牌。如果用户离开，您可以拒绝该令牌，关闭访问。

如果你走这条路，你可能想要调查在你的提要中包含[提要访问控制](http://www.bloglines.com/about/specs/fac-1.0)位。它并不完美，但它受到更大的聚合器的尊重，因此如果您的一个客户决定使用 Reader 或 Bloglines 订阅提要，则搜索结果中不应显示内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T12:21:10.370

通过网络服务器进行身份验证可能是最好的解决方案，但是要解决阅读器不支持它的问题（已提到 Google，我对 Safari 有疑问），您可以实现一个简单的值键来附加到 URL。

```
I.E.

http://www.mydomain/rss.php?key=value 
```

然后，您的系统可以“验证”键值并输出 RSS，无效的 kv 可以作为单项 RSS 获得标准的“无效验证”消息或返回 40x 错误。

它不是很安全，因为您可以在 URL 中看到 kv，但这是一种权衡。未经身份验证的 HTTPS 会稍微安全一些。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T12:01:00.480

我相信您会设置提要本身的权限，强制进行身份验证，就像 Twitter 提要一样。问题在于许多阅读器（包括 Google 阅读器）还不支持经过身份验证的提要。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T12:01:53.083

这个想法是通过安全通道进行身份验证。这些帖子很好地解释了它：

*   [RSS 安全](http://www.rassoc.com/gregr/weblog/2005/09/08/rss-security/)

*   [私人 RSS 源](http://labs.silverorange.com/archive/2003/july/privaterss)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T12:05:48.567

假设您的 RSS 提要通过 HTTP，那么基本的 HTTP 身份验证可能会成功。这可以在 Web 服务器级别（例如在 IIS 中）或通过您用来生成提要的任何框架（例如在 ASP.NET 中）完成。

身份验证方案（基本用户名/密码、NTLM、Kerberos 等）由您决定。如果您使用 WCF 生成提要，那么您可以稍后做出这些决定，并在需要时通过配置应用。

您是否只是希望对提要的消费者进行身份验证，或者还对其进行加密以防止信息被“中间人”读取。如果您需要加密，那么 SSL 可能是最容易实现的。

您应该避免通过更改名称来简单地“隐藏”RSS 提要。

**更新：** 您的问题（随着它的更新）听起来您实际上遇到了设备上的 RSS 客户端的问题。您需要确定手机 RSS 客户端是否了解如何处理基本/摘要身份验证等。

假设它没有，HTTP 请求中是否有任何内容可以让您将设备与用户关联？是否有一个 HTTP 标头可以为您提供唯一的设备 ID？如果是这样，您也许可以对这些数据执行查找以执行您自己的弱身份验证，但您应该记住，这种身份验证很**容易**被欺骗。

设备是否具有可用于相互 SSL 的客户端证书？如果是这样，那将是理想的。

# email - 使用 JavaMail 发送的电子邮件中的希伯来语字符显示为问号

> ID：755810
> 
> 赞同：0
> 
> 时间：2009-04-16T11:58:23.530
> 
> 标签：email, internationalization, jakarta-mail, hebrew

可以做什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T12:01:31.510

您是否正确设置了字符编码？

尝试这个：

```
mimemessage.setText(s6,"utf-8"); 
```

你可能需要 utf-16，不记得我头顶上的 char set hebrew 是什么。

试试这里[http://www.i18nguy.com/unicode/codepages.html](http://www.i18nguy.com/unicode/codepages.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-10-15T15:40:25.517

晚了 3 年，但如果有人打这个，我找到了答案：

```
 MimeMessage message = new MimeMessage(mailSession);
        Multipart multipart = new MimeMultipart("alternative");

        BodyPart htmlPart = new MimeBodyPart();
        htmlPart.setContent(new String(messageHtml.getBytes("UTF8"),"ISO-8859-1"), "text/html");
        multipart.addBodyPart(htmlPart);

        message.setContent(multipart);
        message.setFrom(new InternetAddress(from));
        message.setSubject(subject, "UTF-8"); 
```

诀窍是将我的 html 从 UTF-8 转换（它来自我的 message_iw.properties 的方式），然后将其转换为 ISO 格式，因此无需设置任何标题。

# delphi - 如何将任意数据作为文件复制到剪贴板？

> ID：755811
> 
> 赞同：10
> 
> 时间：2009-04-16T11:58:27.633
> 
> 标签：delphi, clipboard

我们开发了一个数据库应用程序。用户要求一项新功能：将 blob 复制到剪贴板，以便 Windows 资源管理器可以将它们粘贴为新文件。一种解决方案是将 blob 保存到临时文件夹中，并将这些临时文件添加到剪贴板。

但我正在寻找更好的解决方案。是否可以在 Windows 资源管理器中挂钩粘贴操作并自己将 blob 保存到目标路径？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-16T14:12:05.940

I've never tried it but I think it is indeed possible. Please take a look at the MSDN Documentation for [Shell Clipboard Formats](http://msdn.microsoft.com/en-us/library/bb776902.aspx). `CFSTR_FILECONTENTS` and `CFSTR_FILEDESCRIPTOR` are the formats you are likely supposed to handle.

Additionally, I found an article at Code Project which provides a demo program: [How to drag a virtual file from your app into Windows Explorer](http://www.codeproject.com/KB/tips/ExplorerDelayDrop.aspx).

*Update:* An example written in .NET:

*   [Creating something from nothing](http://blogs.msdn.com/delay/archive/2009/10/26/creating-something-from-nothing-developer-friendly-virtual-file-implementation-for-net.aspx)
*   [Creating something from nothing, asynchronously](http://blogs.msdn.com/delay/archive/2009/11/04/creating-something-from-nothing-asynchronously-developer-friendly-virtual-file-implementation-for-net-improved.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-16T16:43:35.720

来自 MSDN 文章[处理 Shell 数据传输场景](http://msdn.microsoft.com/en-us/library/bb776904.aspx)

> *   现有文件应以 CF_HDROP 格式提供。
> *   提供 CFSTR_FILECONTENTS/CFSTR_FILEDESCRIPTOR 格式的类文件数据。这种方法允许目标从数据对象创建文件，而无需了解任何有关底层数据存储的信息。您通常应该将数据呈现为 IStream 接口。这种数据传输机制比全局内存对象更灵活，并且使用更少的内存。

从 MSDN 阅读的另外两篇好文章是：

*   [外壳数据对象](http://msdn.microsoft.com/en-us/library/bb776903.aspx)
*   [Shell 剪贴板格式](http://msdn.microsoft.com/en-us/library/bb776902.aspx)

当我第一次开始使用剪贴板传输文件时，我打印了所有三篇文章并阅读了几遍。

处理接口可能非常复杂。我找到了两个很好的库来帮助解决这个问题。

Delphi的[拖放组件套件](http://melander.dk/delphi/dragdrop/)。如果您在主页上向下滚动，您会看到一些常见问题解答很好阅读。下载中还有很多示例应用程序。我认为 AsyncSource 演示应该对您正在寻找的内容有所帮助。该套件是带有源代码的免费软件。代码似乎注释得很好。

我目前正在使用 Quasidata 的[Transfer@Once](http://www.quasidata.com/transferatonce.html)组件。它不是免费的，但非常便宜。我最初使用 Transfer@Once 是因为当时它比拖放组件套件得到更好的支持。然而，这种情况已经发生了逆转。Transfer@Once 还不支持 Delphi 2009。当我开始移动我的应用程序时，我可能会切换组件。购买时包含 Transfer@Once 代码。就个人而言，我发现拖放代码更容易阅读和遵循。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-16T14:00:44.890

我会说资源管理器自己复制到目标文件，所以没有办法直接写入目标文件。这是有道理的，因为源文件的名称只能来自将数据复制到剪贴板的应用程序，而不必是资源管理器。OTOH目标文件的名称实际上可能不同，因为相同名称的文件可能已经存在于目标文件夹中，并且只有资源管理器才能为目标文件创建修改后的名称（例如通过添加“副本”或添加“（ 2)" 到基本文件名)。

您需要为 Windows 资源管理器提供剪贴板格式，以便它可以粘贴文件。[标准剪贴板格式](http://msdn.microsoft.com/en-us/library/ms649013(VS.85).aspx#_win32_Standard_Clipboard_Formats)的文档表明*CF_HDROP*是正确的。使用这种剪贴板格式，您将提供源文件名列表，但这些文件当然需要存在，因此您*需要*将它们保存到光盘中。

不过，您可以尝试使该过程尽可能轻量级。通常，当用户将数据复制到剪贴板时，它会立即放在那里，无论它是否用于粘贴操作。对于您的应用程序，这意味着您每次都需要创建文件并将文件名列表放入剪贴板。但是，Windows 确实支持一种称为[延迟渲染](http://msdn.microsoft.com/en-us/library/ms649014(VS.85).aspx#_win32_Delayed_Rendering)的模式，该模式正好用于这种情况。基本上，您只将一个空的数据存根放到剪贴板上，并且只有当另一个应用程序尝试访问数据时，才会从您的应用程序请求它。因此，您可以通过一种方式实现这一点，即只有当用户尝试将文件粘贴到资源管理器中时，您才会将它们保存到光盘并返回文件名列表。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T12:43:28.023

It's been a while since I toyed with copy/paste, but I'm pretty sure you can do what you're suggesting (insert the blob as a new file into the clipboard).

I seem to remember that depending on how you add to the clipboard you can specify what sort of data you're copying. I think if you get that data type right, you'll be able to paste as though you'd copied from windows explorer.

I'll try and dig out some more details this evening if I have a chance (I don't have all my bookmarks here at work)...

**[Edit]** Have a look at [the wxWidgets documentation on drag and drop](http://docs.wxwidgets.org/stable/wx_wxdndoverview.html). That was what I'd been working with and it gives some hints about data types.

What are you writing in? Delphi?

**[Edit2]** I think this may actually be a limitation of Windows(?). It might just be the wxWidgets documentation, but there's [a suggestion that you only copy filenames rather than the files themselves](http://docs.wxwidgets.org/stable/wx_wxdataformat.html#wxdataformat). If that's the case, you're going to have to ue your original suggestion of creating a temp file first :-(

# vba - 在 Excel VBA 中创建自定义工作表函数

> ID：755812
> 
> 赞同：13
> 
> 时间：2009-04-16T11:59:03.573
> 
> 标签：vba, excel, user-defined-functions

我对能够使用 VBA 函数在 Excel 中计算值有一个微弱的记忆，就像这样（作为单元格公式）：

```
=MyCustomFunction(A3) 
```

这可以做到吗？

编辑：

这是我的 VBA 函数签名：

```
Public Function MyCustomFunction(str As String) As String 
```

该功能位于`ThisWorkbook`模块中。如果我尝试在上面显示的工作表中使用它，我会收到`#NAME?`错误消息。

* * *

解决方案（谢谢，codeape）：该功能在定义`ThisWorkbook`模块时无法访问。它必须位于“正确”的模块中，该模块已手动添加到工作簿中。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-16T12:00:35.927

是的，它可以。您只需在模块中定义一个 VBA 函数。请参阅[http://www.vertex42.com/ExcelArticles/user-defined-functions.html](http://www.vertex42.com/ExcelArticles/user-defined-functions.html)以获得很好的示例介绍。

这是一个简单的例子：

*   创建新工作簿
*   切换到 VBA 视图 (Alt-F11)
*   插入模块：插入 | 模块
*   模块内容：

```
选项显式

函数 MyCustomFunction(输入)
    MyCustomFunction = 42 + 输入
结束功能

```

*   切换回工作表 (Alt-F11)，然后输入一些值：

```
A1：2
A2: =MyCustomFunction(A1)

```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-03-23T14:51:10.520

单词输入需要替换，因为它是一个基本关键字。尝试 num 代替。您还可以通过指定类型（例如变体）更进一步。

```
Function MyCustomFunction(num As Variant)
    MyCustomFunction = 42 + num
End Function 
```

# asp.net-mvc - 在哪里放置审计或日志记录？

> ID：755819
> 
> 赞同：4
> 
> 时间：2009-04-16T12:01:41.650
> 
> 标签：asp.net-mvc, nhibernate, logging

我目前正在使用 NHibernate 开发一个 ASP.NET MVC 项目，我需要跟踪某些实体的更改，以便能够对数据进行一些报告和查询。出于这个原因，我想将数据放在一个表中，但我试图决定在哪里“挂钩”审计代码。

在 NHibernate 层上：

*   PRO：强大的事件系统来跟踪任何变化
*   PRO：应用程序中的任何内容都不能在没有通知的情况下进行更改（除非有人使用原始 SQL...）
*   CON：因为我有一个通用存储库......所以我必须过滤掉有用的实体（我不需要跟踪所有内容）。
*   CON：我无法轻松访问控制器和操作，因此我只能跟踪基本操作（更新、删除......）。我至少可以获取 HttpContext 以获取一些信息。

在控制器级别的动作过滤器上：

*   PRO：有关请求和 Web 应用程序状态的完整信息。通过这种方式，我可以区分“编辑”和“状态更改”，并且在审计信息中更具描述性。
*   CON：有人可能会忘记过滤器，并且可以在不通知的情况下采取重要行动，这是一个很大的缺点。

有什么线索吗？

**更新**：了解如何[使用 NHibernate 事件创建审核日志](http://nhforge.org/wikis/howtonh/creating-an-audit-log-using-nhibernate-events.aspx)。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T12:13:12.433

我认为在存储库级别这样做更合适。主要是因为您将来可能决定添加一些不通过 MVC 访问您的存储库的方法（例如，数据的 WCF 接口）。

所以问题就变成了，你如何解决你列出的关于在 NHibernate 层上做这件事的缺点？

过滤掉有用的实体很简单。我可能会通过实体类型上的自定义属性来做到这一点。您可以标记要跟踪的实体，也可以标记不跟踪的实体；哪个更容易。

弄清楚控制器的真正意图更难。我会争论你可以“获取 HttpContext”；我认为在存储库中执行此操作不是一个好主意，因为关注点分离。存储库不应依赖于网络。一种方法是在存储库上为您希望以不同方式跟踪的操作创建自定义方法；如果这些编辑的其他方面表现不同，例如不同的安全性，这将特别有吸引力。另一种方法是通过比较对象的新旧版本来检查更改并得出更改的实际性质。第三种方法是不尝试推断更改的性质，而只是将前后版本存储在日志中，以便阅读日志的人自己弄清楚。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T12:23:57.557

我用 NHibernate 做到这一点。需要审计的对象实现 IAudtable 接口，我使用拦截器通过拦截 OnFlushDirty、OnDelete 和 OnSave 对实现 IAuditable 的任何对象进行审计。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T12:09:28.637

我宁愿把它放在数据层（在你的情况下是 NHibernate）层。将它放在控制器中并要求其他人（或将来您自己）相应地实现控制器与面向对象的设计原则相冲突。

# c# - 将 IQueryable<> 类型对象转换为 List 类型？

> ID：755826
> 
> 赞同：58
> 
> 时间：2009-04-16T12:03:36.887
> 
> 标签：c#, list, iqueryable

我有`IQueryable<>`对象。

`List<>`我想用选定的列将其转换为`new { ID = s.ID, Name = s.Name }`.

已编辑

马克你是绝对正确的！

但我只能访问`FindByAll()`Method （因为我的架构）。

它给了我整个对象`IQueryable<>`

而且我有严格的要求（为选择标签创建 json 对象）只有`list<>`两个字段的类型。

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-04-16T12:05:19.097

然后只是`Select`：

```
var list = source.Select(s=>new { ID = s.ID, Name = s.Name }).ToList(); 
```

（编辑）实际上-在这种情况下可以推断出名称，因此您可以使用：

```
var list = source.Select(s=>new { s.ID, s.Name }).ToList(); 
```

这节省了一些电子......

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2009-04-16T12:19:32.497

添加以下内容：

```
using System.Linq 
```

...并调用`ToList()`.`IQueryable<>`

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2013-05-23T14:35:47.200

List 类的构造函数可以为您转换 IQueryable：

```
public static List<TResult> ToList<TResult>(this IQueryable source)
{
    return new List<TResult>(source);
} 
```

或者你可以在没有扩展方法的情况下转换它，当然：

```
var list = new List<T>(queryable); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-16T12:12:30.093

System.Linq 在 IQueryable<> 和 IEnumerable<> 上有 ToList()。但是，它将导致数据完全通过以将其放入列表中。当你这样做时，你会失去你的延迟调用。如果它是数据的消费者，这没什么大不了的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-09-09T08:10:33.500

这里有几个扩展方法，我已经组合在一起将 IQueryables 和 IEnumerables 从一种类型转换为另一种类型（即 DTO）。它主要用于将较大的类型（即数据库中具有不需要字段的行的类型）转换为较小的类型。

这种方法的积极方面是：

*   它几乎不需要使用任何代码 - 只需调用 .Transform `<DtoType>`()即可
*   它就像 .Select(s=>new{...}) 一样工作，即当与 IQueryable 一起使用时，它会生成最佳 SQL 代码，不包括 DtoType 没有的 Type1 字段。

LinqHelper.cs：

```
public static IQueryable<TResult> Transform<TResult>(this IQueryable source)
{
    var resultType = typeof(TResult);
    var resultProperties = resultType.GetProperties().Where(p => p.CanWrite);

    ParameterExpression s = Expression.Parameter(source.ElementType, "s");

    var memberBindings =
        resultProperties.Select(p =>
            Expression.Bind(typeof(TResult).GetMember(p.Name)[0], Expression.Property(s, p.Name))).OfType<MemberBinding>();

    Expression memberInit = Expression.MemberInit(
        Expression.New(typeof(TResult)),
        memberBindings
        );

    var memberInitLambda = Expression.Lambda(memberInit, s);

    var typeArgs = new[]
        {
            source.ElementType, 
            memberInit.Type
        };

    var mc = Expression.Call(typeof(Queryable), "Select", typeArgs, source.Expression, memberInitLambda);

    var query = source.Provider.CreateQuery<TResult>(mc);

    return query;
}

public static IEnumerable<TResult> Transform<TResult>(this IEnumerable source)
{
    return source.AsQueryable().Transform<TResult>();
} 
```

# sql - sql函数返回给定查询字符串的名称和值表

> ID：755827
> 
> 赞同：1
> 
> 时间：2009-04-16T12:03:42.533
> 
> 标签：sql, sql-server, function, user-defined-functions

任何人都有一个 t-sql 函数，它从 url 获取查询字符串并返回名称/值对表？

例如，我的数据库中存储了这样的值：

```
foo=bar&baz=qux&x=y 
```

我想生成一个 2 列（键和 val）表（在本例中为 3 行），如下所示：

```
name  | value
-------------
foo   | bar
baz   | qux
x     | y 
```

更新：我在 t-sql 函数中需要这个是有原因的；我不能在应用程序代码中做到这一点。也许我可以在函数中使用 CLR 代码，但我不想这样做。

更新：“查询字符串”是指“？”之后的网址部分。我并不是说查询的一部分会在 url 中。查询字符串仅用作数据。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-26T16:13:53.090

```
create function dbo.fn_splitQuerystring(@querystring nvarchar(4000))
returns table 
as
/*
 * Splits a querystring-formatted string into a table of name-value pairs
 * Example Usage:
        select * from dbo.fn_splitQueryString('foo=bar&baz=qux&x=y&y&abc=')
 */
return ( 
    select  'name' = SUBSTRING(s,1,case when charindex('=',s)=0 then LEN(s) else charindex('=',s)-1 end) 
        ,   'value' = case when charindex('=',s)=0 then '' else SUBSTRING(s,charindex('=',s)+1,4000) end    
    from dbo.fn_split('&',@querystring)
)
go 
```

它利用[了这个](https://stackoverflow.com/questions/314824/)通用的拆分功能：

```
create function dbo.fn_split(@sep nchar(1), @s nvarchar(4000))
returns table
/*
 * From https://stackoverflow.com/questions/314824/
 * Splits a string into a table of values, with single-char delimiter.
 * Example Usage:
        select * from dbo.fn_split(',', '1,2,5,2,,dggsfdsg,456,df,1,2,5,2,,dggsfdsg,456,df,1,2,5,2,,')
 */
AS
RETURN (
    WITH Pieces(pn, start, stop) AS (
      SELECT 1, 1, CHARINDEX(@sep, @s)
      UNION ALL
      SELECT pn + 1, stop + 1, CHARINDEX(@sep, @s, stop + 1)
      FROM Pieces
      WHERE stop > 0
    )
    SELECT pn,
      SUBSTRING(@s, start, CASE WHEN stop > 0 THEN stop-start ELSE 4000 END) AS s
    FROM Pieces
  )
go 
```

最终让你做这样的事情：

```
select name, value
from dbo.fn_splitQuerystring('foo=bar&baz=something&x=y&y&abc=&=whatever') 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T12:10:58.710

我确信 TSQL 可能会被强制为您跳过这个环节，但为什么不在您的应用程序代码中解析它最可能属于的查询字符串呢？

然后，您可以查看[此答案](https://stackoverflow.com/questions/574868/c-asp-net-querystring-parser)，了解其他人将查询字符串解析为名称/值对的方法。

还是[这个答案](https://stackoverflow.com/questions/506636/whats-the-quickest-way-to-dedupe-a-querystring-in-c-asp-net)。

或者[这个](https://stackoverflow.com/questions/562943/looping-through-a-request-querystring-in-vb-net)。

或者[这个](http://www.google.co.uk/search?q=querystring+name+value+parse)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T12:11:38.223

*出于安全原因，请不要*直接在 URL 中对查询字符串进行编码：任何人都可以轻松替换任何旧查询来访问他们不应该拥有的信息——或者更糟的是，“ `DROP DATABASE;`”。检查可疑的“关键字”或引用字符之类的东西*不是解决方案*——有创意的黑客会绕过这些措施，你会惹恼所有姓氏为“O'Reilly”的人。

例外情况：仅限内部服务器或公共`https`URL。但即便如此，您也没有理由不能在客户端构建 SQL 查询并从那里提交。

# asp.net - 在 asp.net 网站上为工作流捕获 webform 事件

> ID：755830
> 
> 赞同：0
> 
> 时间：2009-04-16T12:04:44.933
> 
> 标签：asp.net, events, workflow-foundation

基本想法是我有一个网站和一个工作流程。我需要在我的工作流程中捕获来自 aspx 页面的按钮点击。

我有一个包含 worflow 项目和网站项目的解决方案，并且 web.config 和 global.asax 已设置为与 WF 一起使用。还设置了持久性服务。

我创建了一个 StateMachine 工作流程。有几个状态（StateActivity）包含 EventDrivenActivity 实例，其中有 HandleExternalEventActivity 实例。为了正确设置后者以便应用程序可以编译，我创建了一个用 ExternalDataExchange 属性修饰的接口，并公开了必要的事件。然后我创建了一个实现这个接口的类。

这就是我所得到的。现在我需要将类连接到我的 aspx 页面；页面上的事件需要触发类中的事件。

我的代码看起来像这样：

```
<ExternalDataExchange()> _
Public Interface ICatWorkflow
            Property RequestId() As Guid
            ...
            Sub requestInfoEmail()
        ...
        Event onReception(ByVal sender As Object, ByVal e As ExternalDataEventArgs) 
End Interface

Class MyObject
   Implements ICatWorkflow
        Public Property RequestId() As Guid Implements ICatWorkflow.RequestId
            ...
        End Property
        Public Sub requestInfoEmail() Implements ICatWorkflow.onReception
            ...
        End Sub
        Event onReception(ByVal sender As Object, ByVal e As ExternalDataEventArgs)
end class 
```

在我的 form.aspx 上，有一个按钮，而在 form.aspx.vb 页面上，有一个相应的事件处理程序：

```
Protected Sub btnReception_Click(ByVal sender As Object, ByVal e As System.EventArgs)             
      Handles btnReception.Click
        ...
End Sub 
```

然后去哪儿？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T16:54:55.520

我假设您正在为每个用户会话运行一个工作流。如果是这样，您需要将工作流 instanceiId 存储在您可以访问的地方。所以要么把它放在 cookie 中，要么放在 Session 对象中。我更喜欢 cookie，因为即使会话超时或 AppDomain 被 IIS 回收，它也能正常工作。

接下来，您需要获取对 ExternalDataExchange 服务的引用。如果您有对工作流运行时的引用，这很容易。您只需要 workflowRuntime.GetService()。接下来，您使用该服务引发将消息发送到您的工作流的事件。

# c++ - 如何将元素添加到 C++ 数组？

> ID：755835
> 
> 赞同：89
> 
> 时间：2009-04-16T12:05:43.760
> 
> 标签：c++, arrays

我想将一个 int 添加到一个数组中，但问题是我现在不知道索引是什么。

```
int[] arr = new int[15];
arr[0] = 1;
arr[1] = 2;
arr[2] = 3;
arr[3] = 4;
arr[4] = 5; 
```

该代码有效，因为我知道我分配给什么索引，但如果我不知道索引怎么办......

在 PHP 中，我可以这样做`arr[]=22;`，它会自动将 22 添加到数组的下一个空索引。但是在 C++ 中我不能这样做，它给了我一个编译器错误。你们有什么建议？

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2009-04-16T12:09:54.860

没有办法用纯数组做你在 C++ 中所说的。对此的 C++ 解决方案是使用为您提供[`std::vector`](http://en.cppreference.com/w/cpp/container/vector).

您可以通过`vector`这种方式使用 a：

```
#include <vector>

std::vector< int > arr;

arr.push_back(1);
arr.push_back(2);
arr.push_back(3); 
```

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2009-04-16T12:07:01.857

C++ 中的数组不能在运行时改变大小。为此，您应该`vector<int>`改用。

```
vector<int> arr;
arr.push_back(1);
arr.push_back(2);

// arr.size() will be the number of elements in the vector at the moment. 
```

如评论中所述，在标头和命名空间`vector`中定义。要使用它，您应该：`vector``std`

`#include <vector>`

并且，`std::vector`在您的代码中使用或添加

```
using std::vector; 
```

或者

```
using namespace std; 
```

行后`#include <vector>`。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2015-12-28T23:40:42.090

您不必使用向量。如果你想坚持使用普通数组，你可以这样做：

```
int arr[] = new int[15];
unsigned int arr_length = 0; 
```

现在，如果你想在数组的末尾添加一个元素，你可以这样做：

```
if (arr_length < 15) {
  arr[arr_length++] = <number>;
} else {
  // Handle a full array.
} 
```

它不像 PHP 等价物那样简短而优美，但它完成了您尝试做的事情。为了让您以后可以轻松更改数组的大小，您可以使用#define。

```
#define ARRAY_MAX 15

int arr[] = new int[ARRAY_MAX];
unsigned int arr_length = 0;

if (arr_length < ARRAY_MAX) {
  arr[arr_length++] = <number>;
} else {
  // Handle a full array.
} 
```

这使得将来管理阵列变得更加容易。通过将 15 更改为 100，数组大小将在整个程序中正确更改。请注意，您必须将数组设置为最大预期大小，因为一旦编译程序就无法更改它。例如，如果您有一个大小为 100 的数组，则永远不能插入 101 个元素。

如果您将使用数组末尾的元素，您可以这样做：

```
if (arr_length > 0) {
  int value = arr[arr_length--];
} else {
  // Handle empty array.
} 
```

如果您希望能够从一开始就删除元素（即 FIFO），则解决方案会变得更加复杂。您还需要一个开始和结束索引。

```
#define ARRAY_MAX 15

int arr[] = new int[ARRAY_MAX];
unsigned int arr_length = 0;
unsigned int arr_start = 0;
unsigned int arr_end = 0;

// Insert number at end.
if (arr_length < ARRAY_MAX) {
  arr[arr_end] = <number>;
  arr_end = (arr_end + 1) % ARRAY_MAX;
  arr_length ++;
} else {
  // Handle a full array.
}

// Read number from beginning.
if (arr_length > 0) {
  int value = arr[arr_start];
  arr_start = (arr_start + 1) % ARRAY_MAX;
  arr_length --;
} else {
  // Handle an empty array.
}

// Read number from end.
if (arr_length > 0) {
  int value = arr[arr_end];
  arr_end = (arr_end + ARRAY_MAX - 1) % ARRAY_MAX;
  arr_length --;
} else {
  // Handle an empty array.
} 
```

在这里，我们使用模运算符 (%) 来使索引换行。例如，(99 + 1) % 100 为 0（环绕增量）。并且 (99 + 99) % 100 是 98 （环绕减量）。这使您可以避免 if 语句并使代码更高效。

随着代码变得越来越复杂，您还可以快速看到#define 的帮助。不幸的是，即使使用此解决方案，您也永远无法在数组中插入超过 100 个项目（或您设置的任何最大值）。即使数组中只存储了一项，您也使用了 100 字节的内存。

这是其他人推荐载体的主要原因。一个向量在幕后进行管理，并随着结构的扩展分配新的内存。在数据大小已知的情况下，它仍然不如数组有效，但对于大多数用途而言，性能差异并不重要。每种方法都有取舍，最好两者都知道。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-04-16T12:09:17.700

使用向量：

```
#include <vector>

void foo() {
    std::vector <int> v;
    v.push_back( 1 );       // equivalent to v[0] = 1
} 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-04-16T12:12:02.700

```
int arr[] = new int[15]; 
```

该变量`arr`保存一个内存地址。在内存地址处，一行有 15 个连续的整数。它们可以用索引 0 到 14 （含）引用。

> 在 php 中我可以这样做 arr[]=22; 这将自动将 22 添加到数组的下一个空索引。

处理数组时没有“下一个”的概念。
我认为您缺少的一件重要的事情是，一旦创建了数组，数组的所有元素就已经存在。它们未初始化，但它们都已经存在。因此，您不会在进行时“填充”数组的元素，它们已经被填充了，只是使用了未初始化的值。无法测试数组中未初始化的元素。

听起来您想使用数据结构，例如[队列](http://www.sgi.com/tech/stl/queue.html)或[堆栈](http://www.sgi.com/tech/stl/stack.html)或[向量](http://www.sgi.com/tech/stl/Vector.html)。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-04-16T12:12:20.580

我完全同意`vector`实现动态数组的方式。但是，请记住，STL 为您提供了许多满足不同运行时要求的容器。您应该谨慎选择一个。例如：为了在后面快速插入，您可以在 a`vector`和 a之间进行选择`deque`。

而且我几乎忘记了，强大的力量伴随着巨大的责任:-) 由于`vector`s 的大小灵活，它们经常自动重新分配以调整添加元素。所以要小心迭代器失效（是的，它也适用于指针）。但是，只要您`operator[]`用于访问各个元素，您就是安全的。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-16T12:14:23.757

我可能在这里错过了您的问题的重点，如果是这样，我深表歉意。但是，如果您不打算删除任何项目而只是添加它们，为什么不简单地将变量分配给下一个空槽呢？每次向数组添加新值时，只需将值递增以指向下一个值。

在 C++ 中，更好的解决方案是使用标准库 type `std::list< type >`，它还允许数组动态增长，例如：

```
#include <list>

std::list<int> arr; 

for (int i = 0; i < 10; i++) 
{
    // add new value from 0 to 9 to next slot
    arr.push_back(i); 
}

// add arbitrary value to the next free slot
arr.push_back(22); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2019-06-28T05:24:18.693

您可以使用变量来计算数组中的位置，因此无论何时添加新元素，您都可以将其放在正确的位置。例如：

```
int a = 0;
int arr[5] = { };
arr[a] = 6;
a++; 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-04-16T16:10:28.823

首先将所有数组元素初始化为null，然后查找null以找到空槽

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-16T12:20:48.937

如果您使用 C++ 编写——最好使用标准库中的数据结构，例如向量。

C 风格的数组非常容易出错，应尽可能避免使用。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2019-07-11T14:01:34.117

由于我收到了很多负面反馈，我意识到我的解决方案是错误的，所以我改变了它。

```
int arr[20] = {1,2,3,4,5};
int index = 5;

void push(int n){
    arr[index] = n;
    index++;
}

push(6) 
```

新数组将包含从 1 到 6 的值，您也可以像这样创建删除函数。

# crash-dumps - 当我的应用程序锁定在客户的机器上时，崩溃报告看门狗

> ID：755847
> 
> 赞同：4
> 
> 时间：2009-04-16T12:10:31.440
> 
> 标签：crash-dumps, crash-reports, watchdog

我正在使用一个有些不可靠的（Qt/windows）应用程序，部分是由第三方为我们编写的（只是想把责任推到那里）。他们的最新版本更稳定。有点。我们收到的崩溃报告越来越少，但我们收到很多关于它只是挂起并且永远不会回来的报告。情况是多种多样的，由于我们收集到的信息很少，我们无法重现问题。

所以理想情况下，我想创建某种看门狗，它会注意到应用程序已锁定，并提供向我们发送崩溃报告。好主意，但有问题：

*   看门狗如何知道进程已挂起？大概我们检测应用程序以定期向看门狗说“一切正常”，但我们将其放在哪里，以保证它足够频繁地发生，但不太可能位于应用程序最终运行时的代码路径上锁定。

*   当崩溃发生时，看门狗应该报告什么信息？Windows 有一个不错的调试 api，所以我相信所有有趣的数据都可以访问，但我不确定什么对追踪问题有用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T12:39:16.007

You want a combination of a minidump (use DrWatson to create these if you don't want to add your own mini-dump generation code) and userdump to trigger a minidump creation on a hang.

The thing about automatically detecting a hang is that its difficult to decide when somethings hung and when its just slow or blocked by IO wait. I personally prefer to allow the user to crash the app deliberately when they think its hung. Apart from being a lot easier (my apps don't tend to hang often, if at all :) ), it also helps them to "be part of the solution". They like that.

Firstly, check out the classic [bugslayer article](http://msdn.microsoft.com/en-gb/magazine/cc301459.aspx) concerning crashdumps and symbols, which also has some excellent information regarding what's going on with these things.

Second, get [userdump](http://www.microsoft.com/downloads/details.aspx?FamilyID=E089CA41-6A87-40C8-BF69-28AC08570B7E&displaylang=en) which allows you to create the dumps, and [instructions](http://support.microsoft.com/kb/241215) for setting it up to generate dumps

When you have the dump, open it in WinDBG, and you will be able to inspect the entire program state - including threads and callstacks, registers, memory and parameters to functions. I think you'll be particularly interested in using the "[~*kp](http://www.windbg.info/doc/1-common-cmds.html#12_thread)" command in Windbg to get the callstack of every thread, and the "!locks" command to show all locking objects. I think you'll find that the hang will be due to a deadlock of synchronisation objects, which will be difficult to track down as all threads tend to wait on a WaitForSingleObject call, but look further down the callstacks to see the application threads (rather than 'framework' threads like background notifications and network routines). Once you've narrowed them down, you can see what calls were being made, possibly add some logging instrumentation to the app to try and give you more information ready for the next time it fails.

Good luck.

Ps. Quick google reminded me of this: [Debugging deadlocks](http://www.debuginfo.com/articles/easywindbg.html#debugdeadlocks). (CDB is the command line equivalent of windbg)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T12:40:03.787

You can use [ADPlus](http://support.microsoft.com/kb/286350) from Microsoft's Debugging Tools for Windows to identify the hangs. It will attach to your process and create a dump (mini or full) when the process hangs or crashes.

WinDbg is portable, and does not have to be installed (you do have to configure the symbols, though). You can create a special installation that will launch your app using a batch, which will also run ADPlus after your app starts (ADPlus is a commandline tool, so you should be able to find a way to incorporate it somehow).

BTW, if you do find a way to recognize the hang internally and are able to crash the process, you can register with [Windows Error Reporting](http://www.microsoft.com/whdc/winlogo/maintain/StartWER.mspx) so that the crash dump will be sent to you (should the user allow it).

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T12:56:02.423

Don't bother with a watchdog. Subscribe to Microsoft's Windows Error Reproting (winqual.microsoft.com). They'll collect the stacktraces for you. In fact, it's quite likely they're already doing so today; they don't share them until you sign up.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T12:26:28.003

我认为单独的应用程序进行监视可能会产生比它解决的问题更多的问题。我建议相反，您首先创建处理程序以在应用程序崩溃时生成小型转储，然后向应用程序添加一个看门狗线程，如果应用程序脱轨，它将故意崩溃。看门狗线程（相对于不同的应用程序）的优势在于，看门狗应该更容易确定应用程序已经偏离轨道。

拥有 MiniDumps 后，您可以四处寻找应用程序死亡时的状态。这应该为您提供足够的线索来找出问题所在，或者至少为下一步寻找方向。

CodeProject 上有一些关于[MiniDumps](http://www.codeproject.com/KB/debug/postmortemdebug_standalone1.aspx)的内容，这可能是一个有用的示例。MSDN 也有关于它们的更多信息。

# sql-server - 将 SQL Server 数据库而不是整个服务器上的日期格式更改为 dd/mm/yyyy

> ID：755849
> 
> 赞同：6
> 
> 时间：2009-04-16T12:11:36.087
> 
> 标签：sql-server, datetime, date, format

任何人都可以帮忙，我们安装了一个 sql server 2005 数据库（实际上它是一个连接到 sql server 2005 服务器的 sql server 2000），默认服务器语言语言 USA 具有像 mm/dd/yy 这样的日期格式，我们真的需要保留它方式，但目前刚刚将一个新数据库上传到服务器，这需要具有 dd/mm/yyyy 的日期格式。

我可以只在数据库而不是整个服务器上强制更改吗？如果我在整个服务器上强制更改，它将使我所有其他应用程序失败

例如，目前我们有这个失败的 sql 语句..

选择 * 从会话 WHERE ultimo_acceso < '16/04/2009 13:36:17'

但当然我们可以添加这个现在可以使用

SELECT * FROM 会话 WHERE ultimo_acceso < Convert(datetime, '16/04/2009 13:36:17', 103)

但问题是应用程序中有大量的sql语句。事实是应用程序相当老旧，我们真的不想对源代码进行任何更改..

因此，因此，如果我们可以仅在数据库/特定数据库的表上强制进行更改，那么这就足够了

任何帮助都非常感谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-16T12:29:55.607

您可以通过在 SQL Management Studio > 安全 > 登录 > {用户属性} > 默认语言中为该用户选择*默认语言来更改每个***用户**的默认日期格式。

 *您可以通过以下方式查看每种语言的日期格式

```
EXEC sp_helplanguage 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T12:13:20.967

```
SET dateformat dmy;
SELECT * FROM sesiones WHERE ultimo_acceso < '16/04/2009 13:36:17'; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-16T13:01:45.313

我想你很困惑。sql server 中的日期时间根本不存储为字符串。它们存储为 8 字节二进制值，并且仅在您向用户显示它们时才转换为字符串。您正在使用 Datetime 列来保存您的日期，对吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T13:04:20.377

在 SQL Server 中处理日期时间字符串时，我总是使用 ISO-8601 日期格式

```
YYYY-MM-DDTHH:MM:SS 
```

无论您使用哪种语言或区域设置，它都应该有效。

试试你的选择：

```
SELECT * FROM sesiones WHERE ultimo_acceso < '2009-04-16T13:36:17' 
```

马克

# email - 后缀：将每封电子邮件的副本发送到给定的电子邮件地址

> ID：755853
> 
> 赞同：8
> 
> 时间：2009-04-16T12:12:23.637
> 
> 标签：email, smtp, postfix-mta

我有一个 postfix 电子邮件服务器，并且有一个我想调试的问题。如何将其配置为将每封电子邮件的副本发送到我的电子邮件（除了将电子邮件传递给其预期收件人）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2015-11-24T14:11:22.627

只需添加`always_bcc=youremail@gmail.com`/etc/postfix/main.cf 并重新启动 postfix 服务器。我在底部添加了这一行。

它似乎真的起作用了。更多关于 always_bcc[这里](http://www.postfix.org/postconf.5.html)

请不要忘记先备份此文件。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-11-28T17:57:17.017

我最近得到了这个工作，所以虽然我会分享：

使用 postfix 和 cyrus imap 将所有外发邮件发送到 Sent 文件夹。

概括

使后缀将所有外发电子邮件的密件抄送副本发送到特殊的“已发送”邮件帐户。在此特殊帐户上使用 sieve 将所有电子邮件重定向到与该帐户关联的已发送文件夹。

1.  创建用于发送的电子邮件用户帐户

    最简单的方法是为 sent 创建一个新的 unix 帐户，将 shell 设置为 /bin/false 以防止任何人登录：

    ```
    host$ sudo useradd sent
    host$ sudo chsh -s /bin/false sent 
    ```

2.  为发送的用户设置 imap

    使用 cyradm 我们创建了一个新邮箱（即用户），并赋予该用户对我们所有 imap“已发送”文件夹的附加访问权限：

    ```
    host$ $ cyradm -user cyrus localhost
    Password: <enter you cyrus user admin password here>
    localhost> createmailbox user.sent
    localhost> setaclmailbox user.%.Sent sent append
    Setting ACL on user.userx.Sent...OK.
    Setting ACL on user.usery.Sent...OK.
    . . .
    Setting ACL on user.userz.Sent...OK.
    localhost> exit 
    ```

3.  为发送的账户创建一个筛子脚本

    此脚本会将所有传入的电子邮件重定向到已发送的帐户，以及发件人收件箱中的已发送文件夹。

    我的脚本名为 send.sieve，看起来像这样：

    ```
     # Sieve script for sent.  If outgoing email is bcc'ed to this account,
     # this sieve script will redirect it to the sender's Sent folder
     require ["fileinto"];

     if address :is :localpart "From" "userx" {
       fileinto "user.userx.Sent";
     }
     elsif address :is :localpart "From" "usery" {
       fileinto "user.usery.Sent";
     }
     elsif address :is :localpart "From" "userz" {
       fileinto "user.userz.Sent";
    } 
    ```

    您需要为每个用户输入一个条目（上面示例中的 userx、usery、userz）。我一直无法找到更好的方法来做到这一点。欢迎向 marc@bloodnok.com 提出建议

    像这样安装筛子脚本：

    ```
    host$ sieveshell localhost -user=sent -a=cyrus
    Password: <enter you cyrus user admin password here>
    > put sent.sieve
    > activate sent.sieve
    > quit 
    ```

4.  为后缀设置密件抄送映射

    在 postfix 目录（debian 上的 /etc/postfix）中创建一个名为 bcc_map 的文件，如下所示：

    ```
    # copy all locally sent mail to the sent account
    @yourdomain.com       sent@yourdomain.com 
    ```

    使用以下命令将其编译为后缀哈希文件：

    ```
    host$ sudo postmap bcc_map 
    ```

    将以下行添加到后缀 main.cf 配置文件中：

    ```
    sender_bcc_maps = hash:/etc/postfix/bcc_map 
    ```

    并使 postfix 重新加载其配置：

    host$ sudo /etc/init.d/postfix 重新加载

5.  测试和调试

    发送一些电子邮件并检查它是否已复制到您的已发送文件夹中。

    如果出现问题，您应该检查 cyrus 和 postfix 日志（都登录到`/var/log/syslog`我的 debian 主机上）。错别字和不正确的访问权限通常会导致一些线索被发送到日志中。

# python - Django 模型中字段的默认值

> ID：755857
> 
> 赞同：114
> 
> 时间：2009-04-16T12:13:34.727
> 
> 标签：python, django, django-models, django-admin

假设我有一个模型：

```
class SomeModel(models.Model):
    id = models.AutoField(primary_key=True)
    a = models.CharField(max_length=10)
    b = models.CharField(max_length=7) 
```

目前我正在使用默认管理员来创建/编辑这种类型的对象。如何**`b`**从管理员中删除该字段，以便*无法*使用值创建每个对象，而是接收默认值`0000000`？

* * *

## 回答 #1

> 赞同：178
> 
> 时间：2009-04-16T12:16:41.300

设置`editable`为`False`默认`default`值。

[http://docs.djangoproject.com/en/stable/ref/models/fields/#editable](http://docs.djangoproject.com/en/stable/ref/models/fields/#editable)

```
b = models.CharField(max_length=7, default='0000000', editable=False) 
```

此外，您的`id`字段是不必要的。Django 会自动添加它。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2011-11-01T15:53:42.267

您还可以在默认字段中使用可调用对象，例如：

```
b = models.CharField(max_length=7, default=foo) 
```

然后定义可调用对象：

```
def foo():
    return 'bar' 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-04-16T12:20:38.157

您可以像这样设置默认值：

```
b = models.CharField(max_length=7,default="foobar") 
```

然后您可以使用模型的 Admin 类隐藏该字段，如下所示：

```
class SomeModelAdmin(admin.ModelAdmin):
    exclude = ("b") 
```

# xml - 独特的粒子违规

> ID：755861
> 
> 赞同：2
> 
> 时间：2009-04-16T12:16:16.857
> 
> 标签：xml, schema, xsd

我已经关注这个问题太久了。我怀疑我错过了一些明显的东西，因为我对它过于熟悉了。

我有一个遭受独特粒子违规错误的模式。我明白为什么，但我花了太长时间摆弄它，无法退后一步解决问题。

我如何表达这个模式，以便它可以验证我需要建模的内容？

内容模型看起来像：

```
<document>
    <extract>...</extract>
    <structure>...</structure>
    <structure>...</structure>
</document> 
```

或者

```
<document>
    <structure>...</structure>
    <structure>...</structure>
</document> 
```

或者

```
<document>
    <extract>...</extract>
    <extract>...</extract>
</document> 
```

也就是说，**文档**元素可以包含一个或多个**提取**元素或一个或多个**结构**元素，或者它可以包含单个**提取**元素，后跟一个或多个**结构**元素。

我有一个（不正确的）架构，如下所示：

```
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">

    <xs:element name="document" type="Document"/>
    <xs:complexType name="Document">
        <xs:choice>
            <xs:sequence>
                <xs:element ref="extract" minOccurs="0"/>
                <xs:element ref="structure" minOccurs="1" maxOccurs="unbounded"/>
            </xs:sequence>
            <xs:element maxOccurs="unbounded" ref='extract'/>
        </xs:choice>
    </xs:complexType>

    <xs:element name="extract" type="xs:string"/>
    <xs:element name="structure" type="xs:string"/>

</xs:schema> 
```

（这是一个更复杂的模式的精简版）。

干杯

网卡

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T12:47:08.123

所以你需要一个 DTD 风格的内容模型：

```
extract+|structure+|extract,structure+ 
```

这里的问题是 an 的存在`extract`并不能确定正在采用哪个分支。但是我们可以像这样重写内容模型：

```
extract,(structure+|extract*)|structure+ 
```

如果您“扩展”内部选择，就好像这是代数一样，您可以看到这是相同的：

```
extract,structure+|extract,extract*|structure+
extract,structure+|extract+|structure+     [[ extract,extract* === extract+ ]] 
```

这个内容模型可以被翻译回 XSD：

```
<xs:complexType name="Document">
 <xs:choice>
  <xs:sequence>
   <xs:element ref="extract"/>
   <xs:choice>
    <xs:element ref="structure" maxOccurs="unbounded"/>
    <xs:element ref="extract" minOccurs="0" maxOccurs="unbounded"/>
   </xs:choice>
  </xs:sequence>
  <xs:element ref="structure" maxOccurs="unbounded"/>
 </xs:choice>
</xs:complexType> 
```

# networking - 在我的代理服务器中支持持久的 HTTP 连接

> ID：755867
> 
> 赞同：0
> 
> 时间：2009-04-16T12:18:44.917
> 
> 标签：networking, sockets, proxy

我正在用 C++ 实现一个 HTTP 缓存代理服务器。我已经完成了大部分工作，但我被困在了一个点上。
我正在做的是使用套接字创建每个线程来处理每次来自浏览器的请求。我解析请求，检查它在缓存中的可用性，如果没有找到，则将其转发到结束 www 服务器。在这两种情况下，我都会在连接的套接字上写入收到的响应。现在的问题是，除非我关闭套接字，否则浏览器不会假定传输已完成并无限期地等待。
这样我就不能将一个套接字用于多个连接，换句话说，我不能支持持久连接。
任何帮助将不胜感激..

谢谢，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T12:33:28.750

您将哪些标头发送回客户端？

你应该包括：

```
Content-Length: ...
Keep-Alive: timeout=..., max=...
Connection: Keep-Alive 
```

特别是，Content-Length 标头对于持久连接至关重要，以便客户端知道要读取多少数据。请参阅[RFC 2616 的第 8.1.2.1 节](https://www.rfc-editor.org/rfc/rfc2616#page-44)。

或者，如果您想告诉客户端断开连接，请发送：

```
Connection: close 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T12:36:35.433

> 现在的问题是，除非我关闭套接字，否则浏览器不会假定传输已完成并无限期地等待。

对。HTTP 1.1 默认使用 Keep-Alive。

> 这样我就不能将一个套接字用于多个连接，换句话说，我不能支持持久连接。

我不确定我是否理解您，因为您拥有的持久连接是持久连接。

# winforms - Windows 窗体中的用户控件 - 任何类似于 ASP.NET 用户控件的东西？

> ID：755869
> 
> 赞同：3
> 
> 时间：2009-04-16T12:19:41.810
> 
> 标签：winforms, user-controls

在 ASP.NET 中，您有一个叫做“用户控件”的东西，它允许您设计一个可以在网站中重用的自定义控件。

我现在开始在 .NET 2.0 中开发 Windows 应用程序，但（令人惊讶的是）我找不到类似的功能。

我想做的是： - 在设计器中创建一个新的用户控件；- 在其上拖放一些控件（例如按钮、文本框）；- 保存，并能够通过将其拖放到各种对话框中来重新使用此用户控件。

任何建议将不胜感激。

谢谢你，贾马尔科·希萨尼

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T12:23:04.500

[用户控制](http://msdn.microsoft.com/en-us/library/system.windows.forms.usercontrol.aspx)

在 WinForms 应用程序中创建、添加和使用用户控件的分步指南：http: [//www.devcity.net/Articles/87/ssteps_customcontrol.aspx](http://www.devcity.net/Articles/87/ssteps_customcontrol.aspx)

主要步骤是：

*   创建库项目
*   添加或自定义默认 UserControl
*   构建项目
*   添加一个新的 windows 应用程序项目
*   在设计器中打开窗体：您的新控件出现。

# iphone - 释放 NSData 导致异常

> ID：755871
> 
> 赞同：4
> 
> 时间：2009-04-16T12:20:35.927
> 
> 标签：iphone, objective-c, cocoa, cocoa-touch, memory

有人可以解释为什么下面的代码会导致我的应用程序爆炸吗？

```
NSData *myImage = UIImagePNGRepresentation(imageView.image);
  :
[myImage release]; 
```

如果我注释掉“发布”行，应用程序就会运行......但是几次调用包含此代码的函数，我就会崩溃——我猜是内存泄漏引起的。

即使我将函数中的所有其他内容都注释掉并只留下这两行，当发布执行时，应用程序也会崩溃。

我敢肯定这一定是一个新手“你不知道如何正确清理你的烂摊子”之类的东西;-)

干杯，

杰米。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T12:32:42.603

查看内存管理，你应该可以在这里找到几个线程，或者你可以看看[这个页面](http://www.cocoadev.com/index.pl?MemoryManagement)。我不会在这里讨论所有规则，但基本问题是 myImage 是自动释放的，而不是保留的——当你手动调用释放时，它没有与保留配对，所以当自动释放尝试删除（现在无效的）对象时在运行循环结束时，您的应用程序将崩溃。删除版本将解决问题，但要花一些时间了解保留/发布规则，这是要了解的最重要的事情之一。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T12:33:35.910

你确定你应该调用吗`release`——MacOS API 的一般规则是，转移所有权的方法具有`Copy`或`Create`以它们的名字命名。我怀疑您得到的是对底层图像表示的引用，而不是副本，在这种情况下，您正在释放由其他东西拥有的对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-01T10:23:07.963

你不应该释放这个对象！Apple 说：“返回值一个包含 PNG 数据的自动发布的数据对象，如果生成数据时出现问题，则返回 nil。***”*** （参见[UIImagePNGRepresentation 参考](http://developer.apple.com/library/ios/documentation/uikit/reference/UIKitFunctionReference/Reference/reference.html#//apple_ref/c/func/UIImagePNGRepresentation)）

# silverlight-2.0 - 自定义控件中的 TemplateBindings

> ID：755877
> 
> 赞同：4
> 
> 时间：2009-04-16T12:21:34.660
> 
> 标签：silverlight-2.0, templatebinding

我只是在silverlight 中处理自定义控件，而在我的一生中，我无法让TemplateBindings 工作。有人可以给这个简化版本一次，看看我是否遗漏了什么。

所以我在 generic.xaml 中的 ControlTemplate 看起来像

```
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:NumericStepperControl;assembly=NumericStepperControl">
    <Style TargetType="local:NumericStepper">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:NumericStepper">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" BorderBrush="Black" BorderThickness="2"  Width="50" Height="30">
                            <TextBlock Width="50" Height="30" Text="{TemplateBinding Value}" />
                        </Border>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>        
        </Setter>
    </Style>
</ResourceDictionary> 
```

我的控制类看起来像：

```
namespace NumericStepperControl
{
    public class NumericStepper : Control
    {
        public static readonly DependencyProperty ValueProperty = DependencyProperty.Register("Value", typeof(int), typeof(NumericStepper), new PropertyMetadata(20));

        public NumericStepper()
            : base()
        {
            DefaultStyleKey = typeof( NumericStepper );
        }

        public int Value
        {
            get
            {
                return (int)GetValue(ValueProperty);
            }
            set
            {
                SetValue(ValueProperty, value);
            }
        }
    }
} 
```

我期待当它运行时 TextBlock 将显示数字 20。关于为什么这不起作用的任何想法？

另一方面，我有一个单独的项目，其中包含对 NumericStepperControl 程序集的引用，并且当它运行时，控件似乎构建正确。

**编辑...经过更多调查后，我发现如果我将 Value 属性的类型更改为可以正常工作的字符串。为什么文本块不只是在传递给它的任何内容上调用 toString ？有没有办法解决这个问题，因为我可以看到它发生了很多？**

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-17T10:10:33.550

经过一番挖掘，事实证明 TextBlock 实际上不会在传入的任何内容上调用 ToString。要解决此问题，您必须使用 Converter 为您调用 ToString。

问题是，TemplateBinding 不支持转换器。您必须将 TemplateBinding 添加到 DataContext，然后在 Text 属性中使用普通的 Binding 以及转换器。

所以 TextBlock 标记变为

```
 <TextBlock Width="50" Height="30" DataContext="{TemplateBinding Value}"  Text="{Binding Converter={StaticResource NumberTypeToStringConverter}}" /> 
```

我的自定义转换器：

```
public class NumberTypeToStringConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
        {
            if (value == null)
            {
                throw new NullReferenceException();
            } 

            return value.ToString(); 
        }

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
        {
            MethodInfo methodInfo = targetType.GetMethod("Parse");

            if (methodInfo == null)
            {
                throw new MissingMethodException("The targetType to convert back to a Number must implement a Parse method");
            }

            return methodInfo.Invoke(null, new object[] { value });
        }
    } 
```

这似乎是一种解决方法，我很想知道它是否有任何不利影响。另外，如果有人正在阅读本文并且我的转换器有任何问题，请告诉我。

干杯

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-14T20:45:59.490

有不同的方法可以解决这个问题。 [找到 Marek Latuskiewicz 的描述](http://blogs.msdn.com/marlat/archive/2009/05/13/silverlight-3-template-binding-vs-relative-binding.aspx)。

# performance - 关于 GC 与显式内存管理性能的任何硬数据？

> ID：755878
> 
> 赞同：33
> 
> 时间：2009-04-16T12:22:33.160
> 
> 标签：performance, memory-management, garbage-collection

我最近阅读了 Dan Grossman 的优秀文章“[事务性内存/垃圾收集类比](http://www.cs.washington.edu/homes/djg/papers/analogy_oopsla07.pdf)”。有一句话真的引起了我的注意：

> 理论上，垃圾收集可以通过增加空间局部性（由于对象重定位）来提高性能，但实际上我们为软件工程的好处付出了适度的性能成本。

在那之前，我的感觉一直很模糊。你一遍又一遍地看到 GC*可以*更有效的说法，所以我总是把这个想法放在脑海里。然而，读完这篇文章后，我开始产生严重的怀疑。

作为衡量 GC 语言影响的实验，有人拿一些 Java 程序，跟踪执行，然后用显式内存管理代替垃圾收集。根据[这篇](http://lambda-the-ultimate.org/node/2552)对[Lambda the Ultimate](http://lambda-the-ultimate.org)文章的评论，他们发现 GC 总是比较慢。虚拟内存问题使 GC 看起来更糟，因为此时收集器经常接触的内存页面比程序本身多得多，因此会导致大量交换。

这对我来说都是实验性的。与显式内存管理相比，是否有人，特别是在 C++ 的上下文中，对 GC 性能进行了全面的基准测试？

特别有趣的是比较各种大型开源项目，例如，在使用或不使用 GC 的情况下如何执行。有没有人听说过这样的结果？

编辑：**请关注性能问题**，而不是为什么 GC 存在或为什么它是有益的。

干杯，

卡尔

PS。如果您已经拔出火焰喷射器：我并不是要取消 GC 的资格，我只是想获得性能问题的明确答案。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-19T02:31:21.063

这变成了另一场充满“我的直觉”的火焰战。一些改变的硬数据（论文包含细节、基准、图表等）：

[http://www.cs.umass.edu/~emery/pubs/04-17.pdf](http://www.cs.umass.edu/~emery/pubs/04-17.pdf)说：

“结论。关于垃圾收集的性能影响的争议早已掩盖了它提供的软件工程优势。本文介绍了一种基于跟踪和模拟的 oracle 内存管理器。使用该框架，我们使用垃圾收集和执行一系列未更改的 Java 基准测试。显式内存管理。对比运行时、空间消耗和虚拟内存占用情况，我们发现当空间充足时，垃圾收集的运行时性能可以与显式内存管理相媲美，甚至可以超过 4%。复制垃圾收集需要的物理内存是 Lea 或 Kingsley 分配器的六倍，才能提供相当的性能。”

当你有足够的内存时，复制 GC 变得比显式更快`free()`- [http://www.cs.ucsb.edu/~grze/papers/gc/appel87garbage.pdf](http://www.cs.ucsb.edu/~grze/papers/gc/appel87garbage.pdf)

这还取决于您使用什么语言——Java 将不得不对每个集合进行大量重写（堆栈、对象、生成），并且编写一个不必在 JVM 中停止世界的多线程 GC 将是一项了不起的成就。另一方面，在 Haskell 中你几乎可以免费获得，GC 时间很少 > 5%，而分配时间几乎为 0。这真的取决于你在做什么以及在什么环境中。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-16T12:48:09.963

在垃圾收集的内存模型中，内存分配的成本通常要低得多，因为垃圾收集器通常会预先分配此内存，因此仅显式使用 new 或 malloc 时。但是，显式内存模型也可以这样做（使用内存池或内存区域）；使内存分配的成本相当于一个指针加法。

正如[Raymond Chen](http://blogs.msdn.com/oldnewthing/archive/2005/05/10/415991.aspx)和[Rico Mariani](http://blogs.msdn.com/ricom/archive/2005/05/10/416151.aspx)所指出的，托管语言在一般情况下往往胜过非托管语言。但是，在推动它之后，非托管语言可以并且最终会击败 GC/Jitted 语言。

[同样的事情在计算机语言大战](http://shootout.alioth.debian.org/u32q/benchmark.php?test=all&lang=all#faster)中也很明显，因为尽管 C++ 在大多数情况下往往排名高于 Java，但您经常会看到 C++ 实现跨越各种环（例如对象池）以实现最佳性能。然而，垃圾收集语言往往更容易遵循和更直接的实现，因为 GC 更擅长分配（小块）内存。

然而，性能并不是 GC 与非 GC 的最大区别。可以说，非 GC（和引用计数）语言的确定性终结（或 RIIA）是显式内存管理的最大论据，因为这通常用于内存管理以外的目的（例如释放锁、关闭文件或窗口句柄）等等）。'最近'然而，C# 引入了 using / IDisposable 构造来做到这一点。

垃圾收集的另一个问题是他们使用的系统往往相当复杂，以防止内存泄漏。但是，一旦确实存在内存泄漏，这也使得调试和追踪变得更加困难（是的，即使是垃圾收集的语言也可能存在内存泄漏）。

另一方面，垃圾收集语言可以在最佳时间（或近似时间）做最优化的事情，而无需让开发人员承担该任务的负担。这意味着为 GC 语言开发可能更自然，因此您可以更多地关注*真正的*问题。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-16T14:04:56.423

这是我喜欢运行的一个实验：

1.  启动在垃圾收集环境（如 .NET 或 Java）中编写的程序。
2.  启动在非垃圾收集环境（如 C 或 C++）中编写的类似程序。
3.  使用这些程序，看看哪一个响应更快。

提高客观性：让你的祖母做第 3 步。

引用最佳 GC 实现的理论性能很好，但事实是，在现实世界中，用垃圾收集语言编写的程序的性能不如原生应用程序。这就是为什么将性能直接转化为用户体验的大型项目仍然使用 C++ 编程的原因。典型的例子是游戏编程。

另一个可能违反直觉的例子是 Eclipse IDE。虽然它可能是用 Java 编写的，**但必须重写整个图形子系统**才能产生可​​接受的性能。解决方案：围绕原生 (C/C++) 组件 ( [SWT](http://en.wikipedia.org/wiki/Standard_Widget_Toolkit) ) 制作 GUI 元素轻量级包装器。

我了解垃圾收集环境的吸引力。内存管理很难做到正确。还有很多工作。底线是：知道你的程序应该如何表现，让你（程序员）比[试图猜测的机器更有](http://en.wikipedia.org/wiki/Halting_problem)优势。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-27T04:16:27.113

Berger 的论文被大量引用，但它正在将真正的垃圾收集器与纯理论的离线优化算法进行比较。因此，虽然它可能会告诉您一些有关理论限制的信息，**但它很少说明*真正的*垃圾收集器与*实际*实现的性能`malloc`和`free`**. `malloc`我更喜欢的一项研究采用了真实的程序，并`free`与 Hans Boehm 的保守垃圾收集器进行了显式比较：

> Ben Zorn[保守垃圾收集的测量成本](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.14.1816)

这项研究并不完美，Zorn 小心地指出，如果程序知道他们正在使用垃圾收集器，一些程序可能会变得更快。但硬数据是这样的： - 在最初编写使用`malloc`and的实际程序中`free`，垃圾收集版本以大致相同的速度运行，但需要两倍的内存。Zorn 相当有说服力地辩称，如果你知道你有 GC，你可以让事情变得更快，但很难消除内存损失。

我从这项仔细的实验​​研究中学到的东西比从 Berger 对无法实现的理想化内存管理器的研究中学到的更多。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T14:20:40.333

这里给出了很多不同的论点。我想首先明确一点，你不能真正进行 1:1 的比较。每个都有其优点和缺点，任何代码片段都将更适合一个或另一个系统。这就是说，相反，你必须知道你是否有 GC 才能编写高效的代码。

我的论点是**你必须相应地了解你的环境和代码**。这将使您的代码高效。从一种范式转移到另一种范式并编码相同的风格将使您的代码效率低于 GC 真正帮助/带走的内容。

案子：

一个程序为短期对象分配了数千个堆内存。也就是说，它多次分配和解除分配，对象大小不同。

在非 GC 环境中，对于每个分配，您最终都会调用 malloc，这需要在空闲内存片段列表中找到最合适的一个（根据特定的 malloc 实现）。使用内存，然后使用 free [或 C++ 中的 new/delete ...] 释放它。内存管理的成本是定位碎片的成本。

在 GC 环境中，使用 java 或 .net 等可移动 GC，每次 GC 运行后，所有可用内存都是连续的。为对象获取内存的成本很便宜，非常便宜（Java VM 中的 CPU 指令小于 10 个）。在每次 GC 运行时，只有活着的对象被定位并移动到适当内存区域的开头（通常它与原始区域不同）。内存管理的成本主要是移动所有可达（活动）对象的成本。现在，前提是大多数对象都是短暂的，因此最终成本可能会小于非 GC 系统的成本。在单次 GC 运行中分配和释放（忘记）一百万个对象无需额外成本。

结论：在 GC 语言中，您可以在堆上创建所有本地对象。它们很便宜。另一方面，在非 GC 系统中，大量分配、解除分配和新分配是昂贵的。内存是碎片化的，malloc 的成本增加了……在非 GC 系统中，您应该尽可能多地使用堆栈，而不是必要时使用堆。

这还有另一个含义。习惯了两种存储系统中的一种的人会倾向于在另一种中编写效率低下的程序。他们习惯了一些在其他系统上可能不好的习语。

一个明显的例子是一个非托管程序员用于分配对象并重用（根据需要用新元素重置其内部指针）习惯于这种思维方式：分配昂贵，重用便宜。现在，如果将完全相同的代码移至分代 GC 环境（Java、.net - 两者都是 move-generational-GC），您会得到一个有趣的效果。在 Java 分代 GC 中，系统将仅对年轻代执行次要收集，仅在完整收集中处理旧代。但是年轻代中的对象可以被老一代中的对象引用，因此必须执行额外的工作来跟踪这种从旧到年轻的引用。特别是在[Java 1.4.1 垃圾收集器](http://www.ibm.com/developerworks/java/library/j-jtp11253/)中，系统会标记*内存卡*（页面的子部分）旧对象所在的位置，然后它包括所有标记的卡片，以便在次要收集期间进行处理，有效地增加了 GC 必须执行的工作量并可能影响性能。

该对象在 1、2、3... GC 运行期间处于活动状态，并且它被移动了很多次，最后被移动到老年代，在每次 GC 运行时它不会被移动，但可以站在那里......但是很可惜，程序员强迫对象变得更年轻。它再次被移动，每次 GC 运行到它再次变旧时，它都会再次移动。

为了进行合理的比较，您需要让了解环境的程序员编写*不同*的代码，以使用相同的算法和不同的内存管理思维来解决相同的问题。然后比较两者的结果。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-19T02:54:19.340

GC 总是比极端的选择慢：完美的、非确定性的内存管理。

问题是：

*   差异是否足够大到可以吹毛求疵？
*   一种技术的缺点是否足以让我们认真考虑另一种技术？

托管子系统在其他领域胜过非托管子系统：

一般来说，程序在多任务操作系统上的运行总是比在单任务操作系统上运行的慢——或者在没有操作系统的计算机上运行。

一般来说，程序在有虚拟内存的系统上总是比在没有虚拟内存的系统上运行得慢。

除非在极端情况下，我们是否认真考虑没有虚拟机和操作系统的计算机系统？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-10-09T20:14:59.713

在讨论了另一个答案之后，一个缺点是 GC 可以改变渐近复杂度。[索鲁的评论](https://stackoverflow.com/questions/755878/any-hard-data-on-gc-vs-explicit-memory-management-performance/1128536#1128536)含蓄地说明了这一点，没有例子，一条评论不足以解释它。感谢 Jon Harrop 提出的示例以及对此答案的有用评论。然而，正如我在最后解释的那样，一个好的 GC 仍然应该分摊成本（给定足够的内存，一如既往）。

> 使用 GC 系统，当你的 O(N) 代码以一种病态的方式破坏 GC 使其成为 O(heap size) 时，可能更难找出问题所在。

首先，当工作集的大小接近最大堆大小时，通常会发生这种情况。GC 被太频繁地调用，因此一切都变慢了。为 Eclipse 安装 Scala 插件，你会感觉到它。

但是，通常，如果您的算法只是产生大量可快速检测到的垃圾，那么拥有足够的内存空间和分代 GC 会阻止它：它不会存活足够长的时间以离开托儿所。

这是一个例外的例子：让我们使用“map f list”，并假设 f 的每个应用程序确实消耗实时内存，方法是将对返回值的引用保存在哈希表中。这里的渐近复杂度应该仍然是 O(1)。

分代 GC 将无法通过收集 Nursery 来释放内存，因此会定期调用主要收集（O（堆内容））。因此，我们得到运行时间至少与（堆内容大小）* n *（每次调用 f 消耗的空间）/（托儿所大小）成正比。

GC 实际上会将nursery 的大小增加到指定的最大值，然后在n 足够大时再次发生上述情况。但是，如果指定的最大值是 Big-Theta（最大堆大小），因此是 Omega（堆内容大小），主要收集变得不频繁，次要收集的成本与产生的数据成正比（因此与产生所需的运行时间成正比）他们）。这类似于您需要复制容器以调整其大小：通过将其增长到足够大，您可以摊销复制（或 GC）的成本，并使其与导致复制所需的成本相当。

整个答案没有考虑暂停时间的问题 - 收集变得不频繁但很长。它隐含地假设堆栈扫描时间是恒定的 - 但它确实应该是，除非您的算法是非尾递归的，因此无论如何都会在此处考虑的大输入上存在问题。

最后，它与增量垃圾收集器无关。它们从根本上解决了问题，但它们主要用于实时 GC，因为它们增加了内存读取的开销。Azul System 使用 Pauseless GC 在他们自己的自定义硬件上解决了这个问题，这要归功于硬件支持以优化此开销。他们最近还声称已经解决了 x86 的问题，请参阅[此“新闻稿”](http://www.azulsystems.com/blog/gil-tene/2010-06-26-same-great-taste-now-convenient-new-package)和[本文](http://www.managedruntime.org/sites/www.managedruntime.org/files/downloads/AzulVmemMetricsMRI.pdf)。但它肯定正在开发中，如果不更改操作系统就无法运行。完成后，如果性能如他们所建议的那样，也许对于我们普通凡人来说问题也将得到解决。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-11-15T16:03:01.000

> 作为衡量 GC 语言影响的实验，有人拿一些 Java 程序，跟踪执行，然后用显式内存管理代替垃圾收集。根据这篇对 Lambda the Ultimate 文章的评论，他们发现 GC 总是比较慢。

嗯，不。他们测量了少数在非生产研究 VM (Jikes) 上运行的面向对象的 Java 程序，这些程序使用非常不寻常的 GC 算法，所有这些都已经过时了几十年。然后，他们针对给定的输入分析每个程序，并计算出每个`free`可能被插入的最早点（即，导致程序通常不再正确，因为在其他输入上它可能过早释放）。

我对此没有任何问题：他们的结果有点有趣，但并不让我感到惊讶（Java 是一种非常糟糕的语言，与 Hotspot 或 .NET 等现代生产 VM 相比，它们使用的 GC 算法只是玩具） . 然而，他们假装这些结果一概而论，这绝对是荒谬的。没有理由相信他们的玩具 GC 代表生产 GC，或者 OOP 代表所有程序，或者他们的“神谕”内存管理代表手动内存管理。

> 虚拟内存问题使 GC 看起来更糟，因为此时收集器经常接触的内存页面比程序本身多得多，因此会导致大量交换。

是的。不要那样做。

> 这对我来说都是实验性的。与显式内存管理相比，是否有人，特别是在 C++ 的上下文中，对 GC 性能进行了全面的基准测试？

C++ 无法表达高效的 GC 算法（例如，无法遍历该堆栈或更改调用约定），因此它永远不会在这方面具有竞争力。如果您必须使用 C++，请忘记 GC。如果你想要一个像样的 GC，就别想 C++了。

> 特别有趣的是比较各种大型开源项目，例如，在使用或不使用 GC 的情况下如何执行。有没有人听说过这样的结果？

这不可能以有用的方式实现，因为 GC 的存在与否是一个基本的设计决策，其他一切都是建立在此之上的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-16T12:49:05.250

从理论上讲，一个配置良好的程序可以通知智能 GC 子系统，以实现上述手动内存管理的加速。如果没有很长的运行时间，这些加速可能是不可见的，以摊销 GC 的固定启动成本。

在实践中，您可能不会通过当前的 GC 实现来实现这些加速。此外，您不会得到明确的答案，因为这两种情况总是会出现病态的糟糕情况。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-14T22:56:53.250

一个务实的问题是，使用显式 MM 通常更容易分析、识别瓶颈并解决它。

使用 GC 系统，当你的 O(N) 代码以一种病态的方式破坏 GC 使其成为 O(heap size) 时，可能更难找出问题所在。有时甚至像修复内存损坏一样困难。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-09-10T11:39:16.850

gc 和任何 malloc 实现之间的根本区别在于 gc 跟踪*分配*的对象，而 malloc 基本上跟踪*de*分配的对象（通过“空闲列表”等，需要收集已释放的内存块以在随后的 malloc 上快速返回它们）——一些 malloc 实现甚至不可能（在它们的内部）通过设计枚举所有分配的块。因此，任何可能的 gc 实现（无论它有多好）总是具有 O(somefunc(N)) 的复杂度，其中 N 是已分配对象的计数，而大多数 malloc 实现的复杂度为 O(1)。因此，当（同时站立的）分配对象的数量越来越多时，任何 gc 的性能下降都是不可避免的（但当然可以用性能换取额外的内存消耗）。[毕竟很明显，与分配的块/对象相比，空闲内存块的维护开销总是为零。~~collects~~维护*垃圾*:)，而 malloc 维护*非垃圾*(:.

PS 我所说的 malloc 不仅指特定的所谓 C 函数，还指任何显式的内存分配例程。另外，我想指出，没有内置 gc 的编程语言提供了许多方法来包装显式 malloc/free（new/delete）调用（例如，C++ 中的 std::shared_ptr 或 Obj-C 中的 ARC）这使得程序代码看起来类似于 gc 支持的语言，但从性能的角度来看，它更接近（几乎等同于）显式内存分配。（我知道即使是简单的引用计数也可以被视为垃圾收集的一种形式，但是在 gc 的这篇文章中，我的意思是任何更多功能丰富的实现（至少自动检测引用周期），这需要跟踪所有分配的对象，所以我不认为像 std::shared_ptr 这样的包装器作为 gc （至少在这篇文章中）。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-04-16T12:43:24.263

事实上，开发人员是人类并且错过了首先导致需要垃圾收集器的东西。话虽如此，让我说垃圾收集总是比**完美的**显式内存管理慢。**考虑到垃圾收集器**会清理开发人员容易忘记的东西，垃圾收集通常比不完善的显式内存管理更快。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2009-04-16T13:20:57.717

理论上，GC在某些情况下*可能*会更快，但我从未见过，我怀疑我永远不会。此外，带有 GC 的 C++（例如 Boehm GC）可能总是会更慢，因为它是保守的。由于 C++ 中的所有指针都在摆弄，GC 不得不假装*一切*都是指针。使用像 Java 这样的语言，它可以准确地知道什么是指针，什么不是指针，因此它可能具有更快的潜力。

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2009-04-19T01:48:14.707

正如@dribeas 指出的那样，（Hertz&Berger）论文中的实验最大的“困惑”是代码总是在一些关于什么是便宜什么是昂贵的“隐含假设”下编写。除了这种混乱之外，实验方法（离线运行 Java 程序，创建对象生命周期的预言，返回“理想”的分配/释放调用）实际上非常出色和富有启发性。（我个人的看法是，confound 不会对他们的结果造成太大影响。）

就个人而言，我的直觉是，使用 GC 运行时意味着接受对您的应用程序的三倍性能影响（GC 将慢 3 倍）。但是程序的真实环境充满了混乱，如果您可以在许多应用程序领域的大量程序上执行“理想”实验，您可能会发现大量数据散点图，GC 有时会获胜，而手动通常会获胜. （而且情况在不断变化——当多核（以及为多核设计的软件）成为主流时，结果会改变吗？）

另见我的回答

[是否有统计研究表明 Python “更有生产力”？](https://stackoverflow.com/questions/354124/are-there-statistical-studies-that-indicates-that-python-is-more-productive/354249#354249)

它的论点是“由于太多的混淆，所有关于软件工程的证据都是轶事”。

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2009-04-19T02:26:05.273

旁注：另一个有趣的实验，我还没有看到人们尝试过，是与泄漏进行比较。调用 alloc 并且永远不会释放。这是一个有趣的选择。

除了长时间运行的服务器应用程序，实际上你永远不会耗尽内存，操作系统将开始使用磁盘作为虚拟内存（机器实际上有无限的内存，达到虚拟地址空间的限制，我认为这是巨大的现在使用 64 位机器）。这凸显了 GC 只不过是一种改善局部性的设备。当您拥有无限内存时，泄漏/死对象不会“受伤”，除非内存是分层的，并且您希望将“活”对象保持在附近且快速，而将“死”对象保持在远处/慢内存上。如果每个对象都分配在不同的页面上，那么 OS 虚拟内存系统将有效地成为 GC。

* * *

## 回答 #16

> 赞同：-4
> 
> 时间：2009-04-19T02:18:00.940

也可以看看

[http://prog21.dadgum.com/40.html](http://prog21.dadgum.com/40.html)

其中讨论了“足够聪明”的编译器。CS/软件领域充满了想法/技术，*理论上**这些*想法/技术比现状更有效。但都是蛇油。

 *GC 今天很贵，而且可能一直很贵。

# ide - windows上用于ironpython的IDE

> ID：755883
> 
> 赞同：34
> 
> 时间：2009-04-16T12:23:15.170
> 
> 标签：ide, ironpython

我目前正在学习 Ironpython 并且很喜欢，但我希望继续使用 notepad++ 和 cmd.exe，并尝试使用更多汁的东西。

我最近了解到 Iron python Studio 不支持 Iron python 2，所以这让我的选择更加困难。

他们是否有任何适用于 windows 的 IDE 可以很好地进行铁 python 2 开发？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-16T12:28:26.593

[SharpDevelop](http://www.icsharpcode.net/OpenSource/SD/)与[IronPython 2.0 Beta 集成](http://community.sharpdevelop.net/blogs/mattward/archive/2008/08/20/IronPython2BetaIntegration.aspx)值得一看——尤其是考虑到它是免费的。

另外，看看这个[Iron Python 2 - 你使用什么 IDE？](http://www.resolversystems.com/forums/viewtopic.php?f=1&t=179)讨论。似乎证实了您的信念，即“IronPython Studio 不支持 IronPython 2”。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-16T22:32:03.993

注意：我最近写了一篇关于在 IronPython 中使用几个主要 IDE 的评论：[http](http://www.voidspace.org.uk/ironpython/tools-and-ides.shtml) : //www.voidspace.org.uk/ironpython/tools-and-ides.shtml（包括 SharpDevelop、Eclipse 和 PyDev、Wing、Visual Studio 和 IronPython工作室）

* * *

我不是 IronPython Studio 的忠实粉丝，在我看来它并不是真正的生产质量。设计人员以 IronPython 1 为目标，生成的代码需要更改才能使用 IronPython 自行运行。不得不修改生成的代码从来都不是好事！

我使用带有 Visual Studio 的设计器来生成 C#，然后在 IronPython 中进行子类化以实际实现功能。

对于使用 IronPython，任何“普通”的 Python IDE 都可以。我喜欢 Wing，因为自动完成功能是我在 Python 编辑器中见过的最好的。您还可以教它为 .NET 库自动完成（通过生成 PI 文件）。

对于使用 Wing（Wing 个人版是免费的 - 但专业版更好），不要将项目设置中的解释器设置为 ipy.exe，因为您会丢失 Wing 内部的交互式 shell，这对于尝试非常有用。

这意味着您需要外部工具来运行测试、启动应用程序，但是使用 Wing 脚本 API 或操作系统工具将这些工具集成到 Wing 中很容易。

Komodo、SPE、Vim、Emacs 都是与 Python 集成的编辑器/IDE，并且都可以很好地工作——你喜欢哪种取决于你的品味和工作流程。

您对 IDE 有其他要求吗？

对于一般 IronPython 开发，我使用 MSBuild 来提供构建自动化，使用 Wix 来构建安装程序，Pyc（IronPython 编译器示例）来编译成二进制程序集，以及用于项目的自定义可执行文件，它是用 C# 编写的 IronPython 托管 API 的非常薄的包装器。编辑器/IDE 只是使用的工具之一——通用 Python IDE 应该可以很好地为您服务。

[1]：注意：我最近写了一篇关于在 IronPython 上使用几个主要 IDE 的评论[http://www.voidspace.org.uk/ironpython/tools-and-ides.shtml](http://www.voidspace.org.uk/ironpython/tools-and-ides.shtml)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-16T12:28:49.540

你可以试试[ironpythonstudio](http://ironpythonstudio.codeplex.com/) Visual Studio shell。它似乎有点旧，可能需要重新构建才能与当前的 IronPython 版本一起使用。

*边注：*

在[SO Podcast #50](https://blog.stackoverflow.com/2009/04/podcast-50/)（2009 年 4 月 22 日）上，[Steve Yegge](http://steve-yegge.blogspot.com/)提到了一个涉及 JavaScript IDE 的内部 Google 项目，并提到 Google 中的“Python 人群”很感兴趣。在遥远的未来，我们可能会看到一些来自 Google 的 (Iron)Python-capable IDE。

从[成绩单](https://stackoverflow.fogbugz.com/default.asp?W29043)，在标记 [21:37] 之后：

> Yegge：代码导航。所以，我认为我们采用的 JavaScript 方法是我们将如何进行静态分析的模型，当我说“我们”时，我指的是行业——我们希望如何对语言进行静态分析比如 Perl 和 Python 和 Ruby 等等。事实上，这里的 Python 人群，当他们[看到]我在内部所做的事情时，他们就像“哦，我们希望 Python 在很大程度上做到这一点。” 所以...

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-06-04T22:13:46.730

The [Python Tools for Visual Studio](http://pytools.codeplex.com/) are a great choice, and they even support regular Python, Jython, and PyPy as well.

They have support for refactoring, debugging, code completion, and all sorts of other expected VS features. There's even a bunch of features for HPC development as well, as the tools are developed by Microsoft's Technical Computing Group.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-10-31T00:03:19.570

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-21T15:22:51.440

检查“DIE”（用于 Davy 的 Ironpython 编辑器）。这是一个开源项目。一个整洁的 IronPython 代码编辑器，具有一些基本的 IDE 功能： [http ://code.google.com/p/davysironpythoneditor/](http://code.google.com/p/davysironpythoneditor/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-23T20:47:22.240

我用emacs。不完全是！

如果您已经使用 emacs 并且想从 python 模式使用 IronPython，我在[另一个 stackoverflow 问题](https://stackoverflow.com/questions/639772/ironpython-emacs/644394#644394)中描述了该过程。我使用 emacs+IronPython 开发 Office 自动化和各种其他 .NET 实用程序脚本。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-19T21:32:42.280

Apparently Jetbrains' [PyCharm](http://www.jetbrains.com/pycharm/) will [support IronPython](http://www.jetbrains.net/devnet/thread/286844).... have not tried it yet myself but Jetbrains make good stuff.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-06-20T02:26:50.377

The implementation of the sys module was improved so that you can now utilize CPython’s pdb module in basic scenarios to debug IronPython sessions provided you pass the –X:Frames or –X:FullFrames options to ipy.exe

# jquery - 如何让 jQuery 在返回之前等待 Ajax 调用完成？

> ID：755885
> 
> 赞同：272
> 
> 时间：2009-04-16T12:23:17.400
> 
> 标签：jquery, ajax

我有一个需要登录的服务器端功能。如果用户已登录，该函数将在成功时返回 1。如果没有，该函数将返回登录页面。

我想使用 Ajax 和 jQuery 调用该函数。我所做的是使用普通链接提交请求，并在其上应用点击功能。如果用户未登录或函数失败，我希望 Ajax 调用返回 true，以便触发 href。

但是，当我使用以下代码时，函数会在 Ajax 调用完成之前退出。

如何优雅地将用户重定向到登录页面？

```
$(".my_link").click(
    function(){
    $.ajax({
        url: $(this).attr('href'),
        type: 'GET',
        cache: false,
        timeout: 30000,
        error: function(){
            return true;
        },
        success: function(msg){ 
            if (parseFloat(msg)){
                return false;
            } else {
                return true;
            }
        }
    });
}); 
```

* * *

## 回答 #1

> 赞同：396
> 
> 时间：2009-04-16T12:31:26.070

如果您不希望`$.ajax()`函数立即返回，请将`async`选项设置为`false`：

```
$(".my_link").click(
    function(){
    $.ajax({
        url: $(this).attr('href'),
        type: 'GET',
        async: false,
        cache: false,
        timeout: 30000,
        fail: function(){
            return true;
        },
        done: function(msg){ 
            if (parseFloat(msg)){
                return false;
            } else {
                return true;
            }
        }
    });
}); 
```

但是，我会注意到这与 AJAX 的观点背道而驰。此外，您应该在`fail`and`done`函数中处理响应。只有在从服务器收到响应时才会调用这些函数。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2012-05-15T08:04:13.087

我没有使用`$.ajax`and`$.post`函数`$.get`，所以如果我需要等待响应，我使用这个：

```
$.ajaxSetup({async: false});
$.get("..."); 
```

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2009-04-16T12:33:09.607

底层 XMLHttpRequest 对象（由 jQuery 用来发出请求）支持异步属性。将其设置为**false**。像

```
async: false 
```

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2015-02-06T03:23:42.757

与其将 async 设置为 false（这通常是糟糕的设计），不如考虑在操作挂起时阻止 UI。

这可以通过 jQuery Promise 很好地实现，如下所示：

```
// same as $.ajax but settings can have a maskUI property
// if settings.maskUI==true, the UI will be blocked while ajax in progress
// if settings.maskUI is other than true, it's value will be used as the color value while bloking (i.e settings.maskUI='rgba(176,176,176,0.7)'
// in addition an hourglass is displayed while ajax in progress
function ajaxMaskUI(settings) {
    function maskPageOn(color) { // color can be ie. 'rgba(176,176,176,0.7)' or 'transparent'
        var div = $('#maskPageDiv');
        if (div.length === 0) {
            $(document.body).append('<div id="maskPageDiv" style="position:fixed;width:100%;height:100%;left:0;top:0;display:none"></div>'); // create it
            div = $('#maskPageDiv');
        }
        if (div.length !== 0) {
            div[0].style.zIndex = 2147483647;
            div[0].style.backgroundColor=color;
            div[0].style.display = 'inline';
        }
    }
    function maskPageOff() {
        var div = $('#maskPageDiv');
        if (div.length !== 0) {
            div[0].style.display = 'none';
            div[0].style.zIndex = 'auto';
        }
    }
    function hourglassOn() {
        if ($('style:contains("html.hourGlass")').length < 1) $('<style>').text('html.hourGlass, html.hourGlass * { cursor: wait !important; }').appendTo('head');
        $('html').addClass('hourGlass');
    }
    function hourglassOff() {
        $('html').removeClass('hourGlass');
    }

    if (settings.maskUI===true) settings.maskUI='transparent';

    if (!!settings.maskUI) {
        maskPageOn(settings.maskUI);
        hourglassOn();
    }

    var dfd = new $.Deferred();
    $.ajax(settings)
        .fail(function(jqXHR, textStatus, errorThrown) {
            if (!!settings.maskUI) {
                maskPageOff();
                hourglassOff();
            }
            dfd.reject(jqXHR, textStatus, errorThrown);
        }).done(function(data, textStatus, jqXHR) {
            if (!!settings.maskUI) {
                maskPageOff();
                hourglassOff();
            }
            dfd.resolve(data, textStatus, jqXHR);
        });

    return dfd.promise();
} 
```

有了这个你现在可以做：

```
ajaxMaskUI({
    url: url,
    maskUI: true // or try for example 'rgba(176,176,176,0.7)'
}).fail(function (jqXHR, textStatus, errorThrown) {
    console.log('error ' + textStatus);
}).done(function (data, textStatus, jqXHR) {
    console.log('success ' + JSON.stringify(data));
}); 
```

并且 UI 将阻塞，直到 ajax 命令返回

见[jsfiddle](http://jsfiddle.net/b69ubLa0/21/)

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2011-10-27T01:49:12.067

我认为如果您编写`success`函数以加载适当的页面而不是返回`true`或返回，事情会更容易`false`。

例如，`true`您可以执行以下操作，而不是返回：

```
window.location="appropriate page"; 
```

这样，当调用成功函数时，页面就会被重定向。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2020-01-25T18:49:42.993

在现代 JS 中，您可以简单地使用`async`/ `await`，例如：

```
 async function upload() {
    return new Promise((resolve, reject) => {
        $.ajax({
            url: $(this).attr('href'),
            type: 'GET',
            timeout: 30000,
            success: (response) => {
                resolve(response);
            },
            error: (response) => {
                reject(response);
            }
        })
    })
} 
```

`async`然后在如下函数中调用它：

```
let response = await upload(); 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2020-05-04T16:01:29.960

因为我没有看到这里提到它，所以我想我还要指出 jQuery [when](https://api.jquery.com/jQuery.when/)语句对于这个目的非常有用。

他们的示例如下所示：

```
$.when( $.ajax( "test.aspx" ) ).then(function( data, textStatus, jqXHR ) {
  alert( jqXHR.status ); // Alerts 200
}); 
```

在“when”部分完成之前，“then”部分不会执行。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2020-07-10T20:26:25.033

由于不推荐使用异步 ajax，请尝试使用带有 Promise 的嵌套异步函数。可能存在语法错误。

```
 async function fetch_my_data(_url, _dat) {

   async function promised_fetch(_url, _dat) {

      return new Promise((resolve, reject) => {
         $.ajax({
            url:  _url,
            data: _dat,
            type: 'POST',
            success: (response) => {
               resolve(JSON.parse(response));
            },
            error: (response) => {
               reject(response);
            }
         });
      });
   }

   var _data = await promised_fetch(_url, _dat);

   return _data;
}

var _my_data = fetch_my_data('server.php', 'get_my_data=1'); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-06-15T13:23:16.733

它应该等到获取请求完成。之后，我将从调用函数的地方返回获取请求正文。

```
function foo() {
    var jqXHR = $.ajax({
        url: url,
        type: 'GET',
        async: false,
    });
    return JSON.parse(jqXHR.responseText);  
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-11-05T11:24:47.690

最初的问题是在 12 年前的今天提出的，是“我如何让 jQuery 等待 Ajax 调用在它返回之前完成？” 从那时起，jQuery 已经走过了漫长的道路。

上面提到了一些解决方案，但我无法让它们中的任何一个与最新版本的 jQuery 一起工作： $.when().then.() 似乎不是同步的，除非它使用 'async: false'不再支持，因此在较新版本的 jQuery 中不起作用。

但是承诺是内置在 jQuery ajax 调用中的，因此使 ajax 调用同步应该不难。

我使用命名空间的 js 函数，所以下面的例子就是这种格式。该示例用于自定义表单验证，它调用服务器来验证用户输入是否不会尝试复制现有项目。

除非使用 Babel，否则此代码可能无法在 IE 或 Legacy Edge 中运行，但我倾向于阻止这些浏览器，因为 Microsoft 不再支持它们。

```
///Namespace validate
check: async function(settings){
    let IsValid = false;
    let Message = ''
    let data = await validate.serverCheck('function', value);
    IsValid = data.OK;
    Message = data.Message;
}

serverCheck: async function (fn, value) {
    var request = {
        validateValue: $.sanitize(value)
    };

    let result;

    try {
            result = await $.ajax({
                dataType: "json",
                type: "post",
                url: "/api/validate/" + fn + "/",
                data: request
        });

        return result;
    } catch (x) {}
} 
```

你有它

# c++ - 初始化涉及向量数据类型的变量

> ID：755892
> 
> 赞同：0
> 
> 时间：2009-04-16T12:25:06.163
> 
> 标签：c++

我有以下数据类型和变量：

```
typedef Seq< vector<int> > MxInt2d;
typedef std::vector<int>  edge_t;
typedef std::vector< edge_t> edge2d_t;

std::vector< edge2d_t > myEdgesIntersect; 
```

我试图像这样初始化 myEdgesIntersect：

```
edge2d_t edge2d(2);

 //creating the vector of edges of intersections whenever an intersection is detected
for (int i=0;i<1;i++){
    edge2d[0][0]=sweepEvents[i][0];
    edge2d[0][1]=sweepEvents[i][1];
    edge2d[1][0]=sweepEvents[i+1][0];
    edge2d[1][1]=sweepEvents[i+1][1];
    std::cout<<edge2d[0][0]<<" "<<edge2d[0][1]<<endl;
    std::cout<<edge2d[1][0]<<" "<<edge2d[1][1]<<endl;
    myEdgesIntersect.push_back(edge2d);
    std::cout<<myEdgesIntersect[i][0][0]<<" "<<myEdgesIntersect[i][0][1]
            <<"    "<<myEdgesIntersect[i][1][0]<<" "<<myEdgesIntersect[i][1][1]<<endl;
} 
```

但是当我尝试显示变量 myEdgesIntersect 时使用此语法，它没有使用 edge2d[..][..] 的给定值初始化（在显示期间可以）。我试图在 push_back 之前显示变量 myEdgesIntersect 并且出现总线错误，所以我认为问题在于该变量未初始化。我试图像这样初始化它：

```
 edge2d_t edge2d;
 edge2d[0][0]=0;
 edge2d[0][0]=0;
 edge2d[0][0]=0;
 edge2d[0][0]=0;
 edge2d[0][0]=0;
 myEdgesIntersect.push_back(edge2d); 
```

但我得到了同样的错误，实际上与循环中的错误相同。显然我不知道如何初始化我真正需要的这个相当复杂的变量。如果您有任何建议，我将非常高兴。

在此先感谢，马达琳娜

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T12:35:05.390

Try:

```
edge2d_t ev(10, edge_t(10, 0)); 
```

(change the size from 10 to something that fits you.)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T12:40:26.300

In addition to what John said, I suspect your 'for' loop may have an off-by-one error:

```
for (int i=0;i<1;i++){ // i will only be 0 
```

perhaps you want

```
 for (int i=0;i<=1;i++){ // i will iterate 0,1 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T12:33:11.853

edge2d_t 是向量的向量。在您的第一个代码块中，您在实例化 edge2d 变量时设置外部向量的大小，而不是内部向量，因此它们的大小均为 0。

尝试这个：

```
edge2d_t edge2d(2);
edge2d[0].resize(2);
edge2d[1].resize(2);

 //creating the vector of edges of intersections whenever an intersection is detected
for (int i=0;i<1;i++){
        edge2d[0][0]=sweepEvents[i][0];
        edge2d[0][1]=sweepEvents[i][1];
        edge2d[1][0]=sweepEvents[i+1][0];
        edge2d[1][1]=sweepEvents[i+1][1];
        std::cout<<edge2d[0][0]<<" "<<edge2d[0][1]<<endl;
        std::cout<<edge2d[1][0]<<" "<<edge2d[1][1]<<endl;
        myEdgesIntersect.push_back(edge2d);
        std::cout<<myEdgesIntersect[i][0][0]<<" "<<myEdgesIntersect[i][0][1]
            <<"    "<<myEdgesIntersect[i][1][0]<<" "<<myEdgesIntersect[i][1][1]<<endl;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T12:30:11.863

如果您的数组大小在编译时确实是固定的，那么您最好查看 2D 数组，而不是包含 2 2 elemnet 向量的 2 元素向量。

# java - `监控java中每个线程的cpu使用情况？

> ID：755899
> 
> 赞同：34
> 
> 时间：2009-04-16T12:27:40.650
> 
> 标签：java, multithreading, cpu-usage

我想问一下是否有一些简单的方法来`cpu usage`确定`java`. 谢谢

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-16T12:40:13.897

I believe the [JConsole](http://blogs.oracle.com/lmalventosa/entry/per_thread_cpu_usage_jconsole) ([archived link](https://web.archive.org/web/20131215001011/https://blogs.oracle.com/lmalventosa/entry/per_thread_cpu_usage_jconsole)) does provide this kind of information through a plugin

![JConsole Thread CPU usage, after blogs.oracle.com/lmalventosa/resource/thread_cpu_usage.jpg](https://i.stack.imgur.com/IUvk6.jpg)

It uses [ThreadMXBean](http://kickjava.com/src/java/lang/management/ThreadMXBean.java.htm) getThreadCpuTime() function.

Something along the line of:

```
 long upTime = runtimeProxy.getUptime();
        List<Long> threadCpuTime = new ArrayList<Long>();
        for (int i = 0; i < threadIds.size(); i++) {
            long threadId = threadIds.get(i);
            if (threadId != -1) {
                threadCpuTime.add(threadProxy.getThreadCpuTime(threadId));
            } else {
                threadCpuTime.add(0L);
            }
        }
        int nCPUs = osProxy.getAvailableProcessors();
        List<Float> cpuUsageList = new ArrayList<Float>();
        if (prevUpTime > 0L && upTime > prevUpTime) {
            // elapsedTime is in ms
            long elapsedTime = upTime - prevUpTime;
            for (int i = 0; i < threadIds.size(); i++) {
                // elapsedCpu is in ns
                long elapsedCpu = threadCpuTime.get(i) - prevThreadCpuTime.get(i);
                // cpuUsage could go higher than 100% because elapsedTime
                // and elapsedCpu are not fetched simultaneously. Limit to
                // 99% to avoid Chart showing a scale from 0% to 200%.
                float cpuUsage = Math.min(99F, elapsedCpu / (elapsedTime * 1000000F * nCPUs));
                cpuUsageList.add(cpuUsage);
            }
        } 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-16T12:41:05.550

by using [java.lang.management.ThreadMXBean](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/management/ThreadMXBean.html). How to obtain a ThreadMXBean:

```
 ThreadMXBean tmxb = ManagementFactory.getThreadMXBean(); 
```

then you can query how much a specific thread is consuming by using:

```
 long cpuTime = tmxb.getThreadCpuTime(aThreadID); 
```

Hope it helps.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2015-02-09T11:43:42.153

> 选项_1：代码级别

在您的业务逻辑代码中；在开始调用 start() API 和 finally 块调用 stop() 中。这样您将获得 CPU 时间来通过当前正在运行的线程执行您的逻辑。然后记录它。[参考](http://nadeausoftware.com/articles/2008/03/java_tip_how_get_cpu_and_user_time_benchmarking)。

```
class CPUTimer 
{
    private long _startTime = 0l;

    public void start ()
    {
        _startTime = getCpuTimeInMillis();
    }

    public long stop ()
    {
        long result = (getCpuTimeInMillis() - _startTime);
        _startTime = 0l;
        return result;
    }

    public boolean isRunning ()
    {
        return _startTime != 0l;
    }

    /** thread CPU time in milliseconds. */
    private long getCpuTimeInMillis ()
    {
        ThreadMXBean bean = ManagementFactory.getThreadMXBean();
        return bean.isCurrentThreadCpuTimeSupported() ? bean.getCurrentThreadCpuTime()/1000000: 0L;
    }
} 
```

> Option_2：使用插件的监视器级别（不支持 jvisualvm 的 AIX IBM 机器）

如果您认为现在添加代码是延迟，那么您可以选择支持插件的 JConsole。我关注[了这篇](http://arnhem.luminis.eu/top-threads-plugin-for-jconsole/)文章。从那篇文章下载 topthreads jar 并运行`./jconsole -pluginpath topthreads-1.1.jar`

> Option_3: 使用 TOP (shift H) + JSTACK (支持'Shif+H' 的Unix机器) 监控级别

按照[本](http://code.nomad-labs.com/2010/11/18/identifying-which-java-thread-is-consuming-most-cpu/)教程进行操作，其中 top 命令将提供查找顶级 CPU 线程 (nid) 的选项。检查 jstack 输出文件中的 nid。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-01-25T21:28:29.417

试试“TopThreads”JConsole 插件。见[http://lsd.luminis.nl/top-threads-plugin-for-jconsole/](http://lsd.luminis.nl/top-threads-plugin-for-jconsole/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T12:39:05.927

Though this is platform dependent, I believe what you're looking for is the ThreadMXBean: [http://java.sun.com/j2se/1.5.0/docs/api/java/lang/management/ThreadMXBean.html](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/management/ThreadMXBean.html) . You can use the getThreadUserTime method, for example, to get what you need. To check if your platform supports CPU measurement, you can call isThreadCpuTimeSupported() .

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-16T12:49:13.563

Indeed the object ThreadMXBean provides the functionality you need (however it might not be implemented on all virtual machines).

In JDK 1.5 there was a demo program doing exactly what you need. It was in the folder demo/management and it was called JTop.java

Unfortnately, it's not there in Java6\. Maybe you can find at with google or download JDK5.

# wpf - 对从 XAML 中的 MarkupExtension 返回的值应用函数

> ID：755904
> 
> 赞同：0
> 
> 时间：2009-04-16T12:29:19.803
> 
> 标签：wpf, xaml

有没有办法对从 MarkupExtenstion 返回的值应用函数，例如

XAML 中的 {Binding ... } 或 {StaticResource ...}？

使用示例：使button1的字体大小比button2的字体大小大两倍？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T12:43:20.067

不，您必须制作一个自定义[标记扩展](http://msdn.microsoft.com/en-us/library/ms747254.aspx)来执行此操作。

[这是一个通过标记扩展评估 Python/Ruby 脚本的示例。](http://www.thinkbottomup.com.au/site/blog/Embedding_DLR_Scripts_in_XAML_Part_2)

# ms-word - 修改 Word 2007 引文的占位符样式。

> ID：755912
> 
> 赞同：1
> 
> 时间：2009-04-16T12:31:20.113
> 
> 标签：ms-word, bibliography

我读到定义的样式位于 C:\Program Files\Microsoft Office\Office12\Bibliography\Style

我使用 ISO 690，当我在文档中插入引文字段占位符作为参考时，它使用以下格式 (source_number)。

但我需要将其更改为 [source_number]，将 () 括号替换为 []。

有经验的人能否指出我应该更改代码的哪一部分来调整它？

非常感谢你。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-02T15:00:08.537

您可以使用[http://bibword.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=14646上的那个](http://bibword.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=14646)

但是如果你想自己做，你必须在 XSLT 中查找

*   /b:引文/b:FirstAuthor
*   /b:引文/b:LastAuthor

被使用。第一个表示这是系列中的第一个引用，而第二个表示这是最后一个引用。

伊夫

# sql - 获取每个 ID 的最大值的简单查询

> ID：755918
> 
> 赞同：19
> 
> 时间：2009-04-16T12:32:46.740
> 
> 标签：sql, sql-server, max, greatest-n-per-group

好的，我有一张这样的桌子：

```
ID     Signal    Station    OwnerID
111     -120      Home       1
111     -130      Car        1
111     -135      Work       2
222     -98       Home       2
222     -95       Work       1
222     -103      Work       2 
```

这一切都在同一天。我只需要查询返回每个 ID 的最大信号：

```
ID    Signal    Station    OwnerID
111   -120      Home        1
222   -95       Work        1 
```

我尝试使用 MAX() 并且聚合弄乱了每个记录的 Station 和 OwnerID 都不同。我需要加入吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-16T12:37:09.770

像这样的东西？将您的表与自身连接起来，并排除找到更高信号的行。

```
select cur.id, cur.signal, cur.station, cur.ownerid
from yourtable cur
where not exists (
    select * 
    from yourtable high 
    where high.id = cur.id 
    and high.signal > cur.signal
) 
```

这将为每个最高信号列出一行，因此每个 id 可能有多行。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-16T16:15:20.313

您正在执行分组最大/最小操作。这是一个常见的陷阱：感觉应该很容易做到，但在 SQL 中却很糟糕。

有许多方法（标准 ANSI 和特定于供应商的方法）来解决这个问题，其中大多数在许多情况下都不是最佳的。当多行共享相同的最大值/最小值时，有些会为您提供多行；有些不会。有些在组数较少的桌子上效果很好；对于每组较小行的大量组，其他组更有效。

[以下是](http://kristiannielsen.livejournal.com/6745.html)一些常见的讨论（偏向 MySQL 但普遍适用）。就个人而言，如果我知道没有多个最大值（或不关心获得它们），我通常倾向于使用 null-left-self-join 方法，我将发布它，因为其他人还没有：

```
SELECT reading.ID, reading.Signal, reading.Station, reading.OwnerID
FROM readings AS reading
LEFT JOIN readings AS highersignal
    ON highersignal.ID=reading.ID AND highersignal.Signal>reading.Signal
WHERE highersignal.ID IS NULL; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-16T12:55:36.700

在经典 SQL-92（不使用 Quassnoi 使用的 OLAP 操作）中，您可以使用：

```
SELECT g.ID, g.MaxSignal, t.Station, t.OwnerID
  FROM (SELECT id, MAX(Signal) AS MaxSignal
          FROM t
          GROUP BY id) AS g
       JOIN t ON g.id = t.id AND g.MaxSignal = t.Signal; 
```

（未经检查的语法；假设您的表是“t”。）

FROM 子句中的子查询标识每个 id 的最大信号值；连接将其与主表中的相应数据行相结合。

注意：如果某个特定 ID 的多个条目都具有相同的信号强度并且该强度是 MAX()，那么您将获得该 ID 的多个输出行。

* * *

针对在 Solaris 10 上运行的 IBM Informix Dynamic Server 11.50.FC3 进行测试：

```
+ CREATE TEMP TABLE signal_info
(
    id      INTEGER NOT NULL,
    signal  INTEGER NOT NULL,
    station CHAR(5) NOT NULL,
    ownerid INTEGER NOT NULL
);
+ INSERT INTO signal_info VALUES(111, -120, 'Home', 1);
+ INSERT INTO signal_info VALUES(111, -130, 'Car' , 1);
+ INSERT INTO signal_info VALUES(111, -135, 'Work', 2);
+ INSERT INTO signal_info VALUES(222, -98 , 'Home', 2);
+ INSERT INTO signal_info VALUES(222, -95 , 'Work', 1);
+ INSERT INTO signal_info VALUES(222, -103, 'Work', 2);
+ SELECT g.ID, g.MaxSignal, t.Station, t.OwnerID
  FROM (SELECT id, MAX(Signal) AS MaxSignal
            FROM signal_info
            GROUP BY id) AS g
      JOIN signal_info AS t  ON g.id = t.id AND g.MaxSignal = t.Signal;

111     -120    Home    1
222     -95     Work    1 
```

我为此测试命名了表 Signal_Info - 但它似乎产生了正确的答案。这仅表明至少有一个 DBMS 支持该表示法。但是，我有点惊讶 MS SQL Server 没有 - 您使用的是哪个版本？

* * *

*在没有表名的情况下提交 SQL 问题的频率总是让我感到惊讶。*

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T12:43:07.290

```
WITH q AS
         (
         SELECT  c.*, ROW_NUMBER() OVER (PARTITION BY id ORDER BY signal DESC) rn
         FROM    mytable
         )
SELECT   *
FROM     q
WHERE    rn = 1 
```

即使`MAX(signal)`给定的 有重复，这也会返回一行`ID`。

启用索引`(id, signal)`将大大改善此查询。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-09-04T03:15:17.343

```
 with tab(id, sig, sta, oid) as
(
select 111 as id, -120 as signal, 'Home' as station, 1 as ownerId union all
select 111, -130, 'Car',  1 union all
select 111, -135, 'Work', 2 union all
select 222, -98, 'Home',  2 union all
select 222, -95, 'Work',  1 union all
select 222, -103, 'Work', 2
) ,
tabG(id, maxS) as
(
   select id, max(sig) as sig from tab group by id
)
select g.*, p.* from tabG g
cross apply ( select  top(1) * from tab t where t.id=g.id order by t.sig desc ) p 

```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-10-28T11:28:25.743

我们可以使用自加入

```
SELECT  T1.ID,T1.Signal,T2.Station,T2.OwnerID
FROM (select ID,max(Signal) as Signal from mytable group by ID) T1
LEFT JOIN mytable T2
ON T1.ID=T2.ID and T1.Signal=T2.Signal; 
```

或者您也可以使用以下查询

```
SELECT t0.ID,t0.Signal,t0.Station,t0.OwnerID 
FROM mytable t0 
LEFT JOIN mytable t1 ON t0.ID=t1.ID AND t1.Signal>t0.Signal 
WHERE t1.ID IS NULL; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T12:52:09.780

```
select a.id, b.signal, a.station, a.owner from 
mytable a
join 
(SELECT ID, MAX(Signal) as Signal FROM mytable GROUP BY ID) b
on a.id = b.id AND a.Signal = b.Signal 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-09-04T04:15:59.697

```
从状态表中选择 *
WHERE 信号输入 (
    选择 A.maxSignal FROM
    (
        选择 ID，MAX（信号）作为 maxSignal
        从状态表
        按 ID 分组
    ） 作为一个
);

```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-05-30T11:25:28.250

select id, max_signal, owner, ownerId FROM ( select * , rank() over(partition by id order by signal desc) as max_signal from table ) where max_signal = 1;

# c# - C# 中的内存使用情况

> ID：755919
> 
> 赞同：18
> 
> 时间：2009-04-16T12:32:58.767
> 
> 标签：c#, .net, multithreading, memory

我有一个在 C# 中使用线程的程序。有没有办法以编程方式了解应用程序的内存使用情况？我想将线程的产生限制为 10 兆字节的内存，我该怎么做？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-16T12:42:56.637

如果您想要整个运行进程的内存而不是基于每个线程，那么如何：

```
// get the current process
Process currentProcess = System.Diagnostics.Process.GetCurrentProcess();

// get the physical mem usage
long totalBytesOfMemoryUsed = currentProcess.WorkingSet64; 
```

除了`WorkingSet64`查看以下链接中的“内存相关”属性之外，还有许多其他进程内存属性，以获取最适合的属性

[http://msdn.microsoft.com/en-us/library/system.diagnostics.process_properties.aspx](http://msdn.microsoft.com/en-us/library/system.diagnostics.process_properties.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T12:47:55.970

While I agree with the comments you've already received on your question, the use of `System.Environment.WorkingSet` might perhaps be an actual answer to it if you really decide to take this course of action?

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T12:42:57.963

我和威尔和史蒂夫在一起，除非你真的必须这样做，否则不要这样做。. . 那说。. .

如果你真的需要这样做，你可以使用他们那里的 .Net [Hosting API ，这样 SQL Server 之类的应用程序就可以在应用程序中托管 .net 框架。](http://msdn.microsoft.com/en-us/magazine/cc163567.aspx#S2)

它使您可以控制内存管理等那一周:)

希望这可以帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T12:45:02.933

您不测量内存使用中的线程数。相反，考虑“处理器”（SMP / 多核 / 超线程）的数量来决定应该并行运行多少线程。或者使用**ThreadPool**，它会自动调整大小以实现良好的线程与 CPU 比率。

# actionscript-3 - flex air datagrid setfocus cell by cell

> ID：755923
> 
> 赞同：0
> 
> 时间：2009-04-16T12:33:32.603
> 
> 标签：actionscript-3, flex3, air

I have a datagrid with custom itemRenderer. Now I need to setfocus int the grid cell by cell. For that I Googled & got a way i.e

```
var findrowindex:int = 0;

//nextButton Click Handler
var focusedCell: Object = new Object();
focusedCell. columnIndex = 3;
focusedCell. rowIndex = findrowindex;
dg.editedItemPosition = focusedCell; 
dg.validateNow( );
findrowindex++; 
```

Using this I am able to get focus in a cell but the focus is not moving from one cell to another. Pls suggest me where I am going wrong or suggest me any ther way to achieve this.

Thanks.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-09-08T19:41:56.873

如果为要编辑的列设置 editable=true。您可以通过 Tab 键移动焦点。使用 itemEditor 而不是 itemRenderer。如果您想要在焦点进入和焦点离开时保持相同的外观和感觉。使用 itemRenderer 和 itemEditor 的组合问候，Arivu

# ruby - 红宝石声音播放

> ID：755934
> 
> 赞同：7
> 
> 时间：2009-04-16T12:38:30.423
> 
> 标签：ruby, audio

这是 2009 年，早在 2001 年左右，曾经没有很好的 ruby​​ 声音播放绑定。

有变化吗？我正在寻找一些东西来控制原始声音或 mp3、ogg 和 flac 的播放。我的谷歌搜索已经干涸。

编辑：Linux、OSX 和可能的 Windows。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T12:42:53.767

你没有提到平台。[这个页面](http://rubyonwindows.blogspot.com/2007/05/adding-sound-to-your-ruby-apps.html)描述了win32-sound 库，它似乎至少支持WAV 播放。

对于更加平台中立的方式，[Ruby/SDL为广受欢迎的](http://www.kmc.gr.jp/~ohai/rubysdl.en.html)[SDL](http://www.libsdl.org/)库提供绑定。

# mysql - 向 mySQL db 发出命令的批处理脚本？

> ID：755939
> 
> 赞同：2
> 
> 时间：2009-04-16T12:40:09.437
> 
> 标签：mysql, command-line, scripting, batch-file

我正在尝试创建一个将连接到 mySQL 数据库并发出删除命令的批处理脚本：

```
@echo off
echo Resetting all assessments...
mysql -hlocalhost -urdfdev -p%1 rdf_feedback
delete from competency_question_answer; 
```

我将运行这个脚本，提供密码作为命令行参数，但这个脚本所做的只是连接到数据库，并显示`mysql>`提示。从 mysql 退出后，其余的批处理命令开始执行（并且失败，不足为奇）。

如何将 SQL 命令从批处理脚本传递到 mysql 控制台？这甚至可能吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T12:44:16.897

您需要使用命令行工具。我不知道 MySQL 是否存在，但 SQL 有 SQLCMD，Oracle 有 OSQL。

你也可以做这样的事情。

```
mysql -uuser -ppass < foo.sql 
```

其中 foo.sql 是您要执行的命令。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-16T12:46:12.183

您可能需要多次连接：

```
@echo off
echo Resetting all assessments...
mysql -hlocalhost -urdfdev -p%1 rdf_feedback -e delete from competency_question_answer; 
```

或者，您应该能够将所有命令放在单独的文件中，例如`input.sql`并使用：

```
mysql -hlocalhost -urdfdev -p%1 rdf_feedback <input.sql 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T12:42:35.077

`echo "delete from competency_question_answer;" | mysql -hlocalhost -ur...`等等

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-11T10:51:40.413

将多组命令放入 .sql 批处理文件效果最好，您可以在 .bat 文件中执行多个命令。

# xhtml - 可以在 textarea 字段中添加换行符同时保持 XHTML 1.0 有效吗？

> ID：755944
> 
> 赞同：3
> 
> 时间：2009-04-16T12:42:05.610
> 
> 标签：xhtml, w3c-validation, line-breaks

**编辑：**重新阅读我的帖子后，我想我有点不清楚问题是什么。让我尝试重新措辞：

用户可以使用表单中的 textarea 字段在我的网站上发表评论。应该可以在注释中使用`<br />`. 然后评论作为字符串存储在 mysql-database 中（转义以使其安全），然后从数据库中检索并显示在站点上。显示注释时无法识别常规换行符。

用户可以编辑他们的评论，在这种情况下，原始评论会显示在要修改的文本区域字段中（见下图）。问题是，如果存在任何`<br />`代码，则代码与 XHTML 1.0 一样无效（请参阅下面的错误消息）。

我可以使用任何其他类型的换行符使代码有效吗？如评论中所述，与 xml:space="preserve" 结合使用的常规换行符不起作用（换行符显示在 textarea 字段中，但当评论在网站上显示为普通文本时则不显示）。

* * *

**原始问题：**

我有一个 Web 表单，其中包含一个用于留下评论的 textarea 字段，我希望它能够使用`<br />`. 下面是一个简单的例子：

[![屏幕转储](https://i.stack.imgur.com/ymdjW.png)](https://i.stack.imgur.com/ymdjW.png)
[（来源：[shipit.se](http://www.shipit.se/dump/textarea-dump.png)）]

它按预期工作，但是当使用 W3C 验证服务时，它不会验证为 XHTML 1.0 过渡。这是我得到的错误：

> 1.  错误第 90 行，第 1587 列：文档类型在此处不允许元素“br”
> 
> `…ription" rows="0" cols="0">Test<br />line break</textarea></dd><dt class="cha`
> 
> 上面提到的元素是在不允许的上下文中找到的。这可能意味着您有错误的嵌套元素——例如“body”部分中的“style”元素而不是“head”内部——或者两个重叠的元素（这是不允许的）。
> 
> 此错误的一个常见原因是在 HTML 文档中使用了 XHTML 语法。由于 HTML 的隐式关闭元素规则，此错误可能会产生级联效果。例如，在 HTML 文档的“head”部分中为“meta”和“link”使用 XHTML 的“self-closure”标签可能会导致解析器推断“head”部分的结尾和“body”部分的开头" 部分（其中不允许使用“链接”和“元”；因此报告了错误）。

有没有办法让换行符成为有效代码，或者我是否需要找到一种解决方法（例如，在 textarea 字段中使用特定标签进行换行符，然后在`<br />`稍后显示评论时将其替换）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T12:53:53.490

您是否尝试过添加`xml:space="preserve"`属性并仅使用普通的换行符？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T12:54:47.653

为什么不使用常规换行符？那些工作得很好。

如果要`<br />`出现，则需要对这些实体进行编码：

```
&lt;br /&gt; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T13:59:19.590

从[DTD](http://www.w3.org/TR/xhtml1/dtds.html#dtdentry_xhtml1-strict.dtd_textarea)：

> `<!ELEMENT TEXTAREA - - (#PCDATA) -- multi-line text field -->`

在您页面的 XHTML 代码中，a`<textarea>`只能包含文本 ( `#PCDATA`)，并且您不能在`<textarea>`.

你的问题似乎显示了两种不同的东西。图像显示“ `<br />`”写入`<textarea>`，而来自 W3C 验证器的消息是指在`<br />`元素内写入页面 XHTML 的`<textarea>`元素。

在第一种情况下，`Test<br />line break`在文本区域向用户显示“”是通过使用适当的实体来完成的，正如[altCognito](https://stackoverflow.com/questions/755944/possible-to-add-line-breaks-in-a-textarea-field-while-keeping-it-xhtml-1-0-valid/755996#755996)所写：

```
<textarea>Test&lt;br /&gt;line break</textarea> 
```

用户输入的任何内容，然后在`<textarea>`新页面的 a 中重新显示，都应该进行编码（即，将实体用于`&`、`"`、`'`、`<`和`>`）。

如果要显示用户的条目：

> 测试`<br />`换行符

...作为...

> 测试
> 换行符

...在另一个文本区域中，您将需要解析输入到原始文本中的内容，`<textarea>`并将用户输入`<br />`的 s 替换为正常的换行符。[见卢塞罗的回答](https://stackoverflow.com/questions/755944/possible-to-add-line-breaks-in-a-textarea-field-while-keeping-it-xhtml-1-0-valid/755992#755992)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-03-04T21:32:36.763

我只是这样做并且有效。

```
<textarea name="contenidoMensaje" id="contenidoMensaje" cols="80" rows="10">
-----Mensaje Original-----
{blank space}
<?php echo str_replace("<br />", "\n", $contenidoMensaje); ?>
</textarea> 
```

# mfc - where to get SAPI?

> ID：755974
> 
> 赞同：2
> 
> 时间：2009-04-16T12:48:35.437
> 
> 标签：mfc, speech-recognition, sapi, speech

i want to create an application that is speech-enabled but whenever i get to MS website to download SAPI, i get an error.

I want to know where I can get SAPI.

and I also would like to know if a SAPI 5.3 application can work on Windows 2000, Windows XP and Windows Vista (if coded with C++/MFC).

also, what is the best way to use SAPI ? with C# .NET or C++/MFC ?

Thanks.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T13:03:24.950

[Microsoft Speech SDK](http://en.wikipedia.org/wiki/Speech_Application_Programming_Interface)可在[此处](http://www.microsoft.com/downloads/details.aspx?FamilyID=5e86ec97-40a7-453f-b0ee-6583171b4530&displaylang=en)下载。

选择 C# 还是 C++ 取决于您自己的喜好。使用 .NET 时，您会在 .NET 中找到与语音识别和合成相关的所有内容`System.Speech`。将此程序集的引用添加到您的项目中，您将能够直接使用语音 API。以下是演示文本到语音功能的简单示例程序：

```
using System.Speech.Synthesis;

class Program
{
    static void Main(string[] args)
    {
        SpeechSynthesizer synth = new SpeechSynthesizer();
        synth.Rate = -1;
        synth.Volume = 100;

        synth.SelectVoice("Microsoft Sam");

        synth.Speak("Hello World");
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T19:38:27.693

我认为您不能只从微软网站下载 Speech SDK 5.3。[您可以从http://www.microsoft.com/downloads/details.aspx?FamilyId=F26B1AA4-741A-433A-9BE5-FA919850BDBF&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=F26B1AA4-741A-433A-9BE5-FA919850BDBF&displaylang=en)下载包含 SAPI 5.3的 windows 平台 SDK 。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T13:03:12.157

好吧，你从 MS 那里得到了 SAPI。如果他们的服务有问题，那么您在下载时遇到了问题！

我将 SAPI 与 C 一起使用，所以我无法评论 C#/C++。

也是几年前的事了，所以我不知道我使用的是哪个版本 - 但它在 w2k、FWIW 上运行良好。

# delphi - Delphi字符串是不可变的吗？

> ID：755980
> 
> 赞同：6
> 
> 时间：2009-04-16T12:49:59.677
> 
> 标签：delphi, string, memory, immutability

据我所知，字符串在 Delphi 中是不可变的。我有点理解这意味着如果你这样做：

```
string1 := 'Hello';
string1 := string1 + " World"; 
```

第一个字符串被销毁，您将获得对新字符串“Hello World”的引用。

但是，如果您在代码周围的不同位置有相同的字符串，会发生什么？

我分配了一个字符串哈希来标识多个变量，例如，“更改”由该更改的属性的哈希值标识。这样我就很容易检查“更改”是否相等。

现在，每个散列都是单独计算的（并非所有属性都被考虑在内，因此即使实例在某些值上不同，它们也可以相等）。

问题是，Delphi 如何处理这些字符串？如果我计算将散列分隔为相同的 10 字节长度字符串，我会得到什么？两个 10 字节的内存块还是对同一个内存块的两个引用？

**澄清：**更改由从数据库读取的一些属性组成，并由单个线程生成。TChange 类有一个 GetHash 方法，该方法根据字符串中的某些值（但不是全部）计算哈希值。现在，其他线程收到更改并且必须将其与先前处理的更改进行比较，以便它们不会处理相同的（逻辑）更改。因此散列，并且由于它们具有单独的实例，因此计算了两个不同的字符串。我正在尝试确定从字符串更改为 128 位哈希之类的东西是否是一个真正的改进，否则只会浪费我的时间。

编辑：Delphi 的版本是 Delphi 7.0

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-16T13:25:02.777

Delphi 字符串是在写入时复制的。如果您修改一个字符串（不使用指针技巧或类似技术来欺骗编译器），则不会影响对同一字符串的其他引用。

Delphi 字符串没有被保留。如果您从两个单独的代码部分创建相同的字符串，它们将不会共享相同的后备存储 - 相同的数据将被存储两次。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T12:55:58.367

Delphi 字符串不是不可变的（尝试：string1[2] := 'a'），但它们是引用计数和写时复制的。

哈希的后果尚不清楚，您必须详细说明它们的存储方式等。

但是哈希应该只依赖于字符串的内容，而不是它的存储方式。这使整个问题变得无声。除非你能解释得更好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T16:34:08.253

正如其他人所说，Delphi 字符串通常*不是*不可变的。这里有一些关于 Delphi 中字符串的参考资料。

[http://blog.marcocantu.com/blog/delphi_super_duper_strings.html](http://blog.marcocantu.com/blog/delphi_super_duper_strings.html)

[http://conferences.codegear.com/he/article/32120](http://conferences.codegear.com/he/article/32120)

[http://www.codexterity.com/delphistrings.htm](http://www.codexterity.com/delphistrings.htm)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T12:52:05.133

Delphi 版本可能很重要。旧的 Delphi BCL 将字符串处理为写时复制，这基本上意味着当字符串中的某些内容发生更改时会创建一个新实例。所以是的，它们或多或少是不可变的。

# php - 无法使用 jQuery.post 检索数据

> ID：755985
> 
> 赞同：0
> 
> 时间：2009-04-16T12:52:08.127
> 
> 标签：php, javascript, jquery

我正在尝试使用[jQuery.post()](http://docs.jquery.com/Ajax/jQuery.post)函数来检索一些数据。但我没有输出。

我有一个显示表格的 HTML。单击此表应触发 jQuery.post 事件。

我的脚本文件如下所示：

```
jQuery(document).ready(function() { 

  jQuery('#storeListTable tr').click(function() { 
    var storeID = this.cells[0].innerHTML; //This gets me the rowID for the DB call.

    jQuery.post("../functions.php", { storeID: "storeID" }, 
      function(data){ 
         alert(data.name); // To test if I get any output 
      }, "json"); 
    }); 
}); 
```

我的 PHP 文件如下所示：

```
<?php 
  inlcude_once('dal.php'); 

  //Get store data, and ouput it as JSON. 
  function getStoreInformation($storeID) 
  {
    $storeID = "9";//$_GET["storeID"]; 
    $sl = new storeLocator(); 
    $result = $sl->getStoreData($storeID); 

    while ($row = mysql_fetch_assoc($result)) { 
    { 
        $arr[] = $row; 
    } 
    $storeData = json_encode($arr); 
    echo $storeData;  //Output JSON data 
  } 
?> 
```

我已经测试了 PHP 文件，它以 JSON 格式输出数据。我现在唯一的问题是将此数据返回到我的 javascript。

1.  由于javascript位于/js/文件夹中，使用'../'调用php文件是否正确？
2.  我认为我没有正确传递 storeID 参数。什么是正确的方法？
3.  如何调用 getStoreInformation($storeID) 函数并传递参数？jQuery.com 上的 jQuery 示例有以下行： $.post("test.php", { func: "getNameAndTime" } getNameAndTime 是 test.php 中函数的名称吗？

* * *

我又进了一步。我已将代码从函数（）内部移到外部。因此，现在执行文件时会运行 php 代码。

我的 js 脚本现在看起来像这样：

```
 jQuery('#storeListTable tr').click(function() {
    var storeID = this.cells[0].innerHTML;

    jQuery.post("get_storeData.php", { sID: storeID },
      function(data){
         alert(data);
      }, "text");
    }); 
```

这会产生一个警报窗口，它将存储数据作为 JSON 格式的字符串输出。（因为我已将“json”更改为“text”）。

JSON 字符串如下所示：

```
[{"id":"9","name":"Brandstad Byporten","street1":"Jernbanetorget","street2":null,"zipcode":"0154","city":"Oslo","phone":"23362011","fax":"22178889","www":"http:\/\/www.brandstad.no","email":"bs.byporten@brandstad.no","opening_hours":"Man-Fre 10-21, L","active":"pending"}] 
```

现在，我真正想要的是从 JSON 中输出数据。所以我会将“text”更改为“json”，将“alert(data)”更改为“alert(data.name)”。所以现在我的 js 脚本将如下所示：

```
 jQuery('#storeListTable tr').click(function() {
    var storeID = this.cells[0].innerHTML;

    jQuery.post("get_storeData.php", { sID: storeID },
      function(data){
         alert(data.name);
      }, "json");
    }); 
```

不幸的是，我得到的唯一输出是“未定义”。如果我改变“alert(data.name);” 到“alert(data);”，输出是“[object Object]”。

1.  那么如何输出商店的名称呢？

2.  在 PHP 文件中，我尝试设置 $storeID = $_GET["sID"]; 但我不知道价值。如何获取在 jQuery.post 中作为参数传递的值？（目前我已经硬编码了 storeID，用于测试）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T12:53:55.953

丢失“storeID”周围的引号：

错误的：

`jQuery.post("../functions.php", { storeID: "storeID" }`

对：

`jQuery.post("../functions.php", { storeID: storeID }`

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-16T13:04:24.540

巴特克莱斯是正确的。就像现在一样，您实际上是在传递字符串“storeID”作为商店 ID。

但是，还有一些注意事项：

*   您将设置它可能看起来很奇怪`storeID: storeID`- 为什么只评估第二个？当我刚开始时，每次我没有发送“1：1”或其他东西时，我都必须三重检查。但是，当您使用这样的对象表示法时，不会评估键，因此只有第二个将是实际的变量值。
*   不，您将 PHP 文件称为`../`考虑 JS 文件的位置是不正确的。您必须根据加载了此 javascript 的任何页面调用它。因此，如果页面实际上与您正在调用的 PHP 文件位于同一目录中，您可能需要修复它以指向正确的位置。
*   有点与前面的观点有关，您*真的*很想掌握[Firebug](http://getfirebug.com/)。这将允许您在发送 AJAX 请求时查看它们是否成功发送、发送给它们的数据以及发送回的数据。简而言之，它是调试 Javascript/AJAX 应用程序的首选共识工具，如果您不想再浪费 6 天时间调试一个愚蠢的错误，您应该拥有它、使用它并珍惜它。:)

**编辑**就您的回复而言，如果您分解返回的内容：

```
[
  {
    "id":"9",
    "name":"Brandstad Byporten",
    "street1":"Jernbanetorget",
    "street2":null,
    "zipcode":"0154",
    "city":"Oslo",
    "phone":"23362011",
    "fax":"22178889",
    "www":"http:\\/www.brandstad.no",
    "email":"bs.byporten@brandstad.no",
    "opening_hours":"Man-Fre 10-21, L",
    "active":"pending"
  }
] 
```

这实际上是一个包含单个对象（花括号）的数组（方括号）。

因此，当您尝试执行以下操作时：

```
alert(data.name); 
```

这是不正确的，因为对象作为数组的第一个元素存在。

```
alert(data[0].name); 
```

应该按您的预期工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T14:15:50.580

您的 JSON 作为 javascript 数组返回...其中 [] 包含花括号 [{}]

所以这会起作用。

```
wrong:  alert(data.name);
right:  alert(data[0].name); 
```

希望有帮助。D

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T14:59:15.233

好的，感谢达里尔，我找到了答案。

所以这里是任何想知道这个的人的功能代码：

**文件**

```
jQuery(document).ready(function() {

  jQuery('#storeListTable tr').click(function() {

    jQuery.post("get_storeData.php", { storeID: this.cells[0].innerHTML },     // this.cells[0].innerHTML is the content ofthe first cell in selected table row
      function(data){
         alert(data[0].name);
      }, "json");
    });

}); 
```

**get_storeData.php**

```
<?php
  include_once('dal.php');

  $storeID = $_POST['storeID'];   //Get storeID from jQuery.post parameter

  $sl = new storeLocator();
  $result = $sl->getStoreData($storeID);  //returns dataset from MySQL (SELECT * from MyTale)

  while ($row = mysql_fetch_array($result))
  {
    $data[] = array( 
    "id"=>($row['id']) ,
    "name"=>($row['name']));
  }  

  $storeData = json_encode($data);

  echo $storeData;
?> 
```

感谢您的所有帮助！

# asp.net - Ado.net 数据服务

> ID：755988
> 
> 赞同：0
> 
> 时间：2009-04-16T12:52:52.540
> 
> 标签：asp.net, ado.net

什么是 Ado.net 数据服务。我在哪里可以下载最新版本以及如何在我的 asp.net ajax 应用程序中使用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T13:10:10.283

ADO.NET 数据服务是“模式和库的组合，可以创建和使用 Web 数据服务”（来自[MS 网站](http://msdn.microsoft.com/en-gb/library/cc956153.aspx)）

基本上，它是一个使用 JSon 或 AtomPub 简化通过类似 REST 的 URL 访问和更新数据的框架。

它与 .NET 3.5 sp1 一起安装（在 GAC 中查找 System.Data.Services 命名空间）

# asp.net - 没有 javascript 的 ASP.NET 网络表单

> ID：755991
> 
> 赞同：4
> 
> 时间：2009-04-16T12:53:45.003
> 
> 标签：asp.net, javascript

由于安全要求，所有将运行我们需要创建的 Web 应用程序的浏览器都必须禁用所有客户端脚本。所以这意味着没有Javascript。不幸的是，Web Forms 相当多地使用了 Javascript。登录控件可以在没有 Javascript 的情况下工作，但按钮不能（它调用 Javascript 函数 __doPostback()）。因此，要使其工作，我们需要手动编写所有表单（ASP Classic 或 PHP 方法）。但我想知道是否有一个可用于 ASP.NET 的框架，它提供具有所有功能的普通 ASP.NET 控件（树视图、网格视图等），但它不使用 Javascript，也不需要程序员编写大量逻辑？

**更新：** 为了澄清，我知道 ASP.NET MVC 是一个会有所帮助的选项，但它不会给我一个很好的 GridView。所以我想知道标准 ASP.NET 控件是否有 100% 功能性、100% 无 JavaScript 替代品。

谢谢。

**Update2：** 已经有一段时间了，我从来没有找到我正在寻找的确切答案。可能是因为我想要的东西不存在。所以我会选择 ASP.NET MVC，这是下一个最好的东西。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T12:56:33.093

[ASP.Net MVC](http://www.asp.net/mvc/)可能是您最接近的。您可以使用它来构建一个没有 javascript 的站点。它与 Web 表单非常不同

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-16T12:58:03.260

许多库存控制将是有问题的。他们只是过于依赖 Javascript。不过，您确实有一些选择：

*   ASP.Net MVC 应该让您对 html 有更多的控制权
*   您可以构建自己的替代 WebForms 控件库，该库不依赖于 javascript 来提供替代控件。

# c - Adaptation problem with the Blowfish Encryption in C

> ID：755994
> 
> 赞同：1
> 
> 时间：2009-04-16T12:54:24.970
> 
> 标签：c, encryption, blowfish

I'm writing a program that implements the Boneh-Franklin Identity Based Encryption. For the actual encryption methods, I use Blowfish which I got from ([https://voltar.org/](https://voltar.org/)). I'm trying to adapt the blowfish encryption/decryption code to my program. The difference in my program is that I read the message from the standard input, encrypt it and print the encryption, then decrypt it and print the decryption (which should be the original message). Currently, I read the input message up to a "?" character and then try to follow the code from the site. However, the decryption is printed as unreadable characters. I tried to solve this problem but I got stuck. Can you please help me?

```
//initializations

BF_KEY s_key;       //shared key of the blowfish encryption
char plain[1000000];    //the plaintext of the message
char cipher[1000000];   //the ciphertext of the message  
char byte;          //to hold the byte of the msg
char *token;        //points to tokens of the msg
char IV[8]="MY*IV000";  //the initialization vector
int offset = 0;     //the offset of encryption
int b_count = 0;        //number of bytes in d_buf
char block[8];      //blocks of encryption
char msg[1000000];      //the input msg from the user
int j;          //used to read input in a loop with getchar
int i;          //for-loop value
int len;            //used to calculate lengths different variables
int f;          //flag for the setup stage
int q;    //used to read input in a loop with getchar
q=0;    //reset the index reader
char in;    //to read characters
printf("Please enter the message you wish to send:\n"); 
```

************ This is my code to read the input message: ***************

```
//this loop reads the input from the user since C does not 
//provide a safe function to read strings with white spaces

while (in != '?'){   
in=getchar();
if(in != '?')    //dont include the delim character in the string
         msg[q++]=in;
}
msg[q]='\0';    //truncate the string by the null character 
```

************ Then I used the code (cited and referenced) for encryption ***************

Of course I modified it as message read from stdin not program args

```
for(i=0; i<strlen(msg); i++)    //copy the input message to plain
    plain[i] = msg[i];

//set up the shared key of the BF encryption

BF_set_key(&s_key, strlen(ekey_buf), ekey_buf);    

while(1){
    for(i=0; i<8; i++)    //reinitiate the block of 8 characters each time

        block[i] = 0;
    strncpy(block, plain+offset, 8);
    BF_cbc_encrypt(plain+offset, cipher, 8, &s_key, IV, BF_ENCRYPT);   
    for(i=0; i<strlen(cipher); i++){
    printf("%02x", (unsigned char) cipher[i]);
}
if( strlen(plain+offset)>8 ){    //if there is still more characters
     offset += 8;         //process the next block of 8 characters
} else
       break;       
}
//the cipher is correctly printed 
```

************ Then I used the code (cited and referenced) for decryption ***************

Here, I excluded the part where it tokenized the cipher and created the plain char array for decryption, I simply passed the cipher array to be decrypted (as it is output from the encryption function), and stored in the plain char array with length = strlen(cipher)

```
//set up the shared key of the BF encryption

BF_set_key(&s_key, strlen(dkey_buf), dkey_buf);        
BF_cbc_encrypt(cipher, plain, strlen(cipher), &s_key, IV, BF_DECRYPT);  

printf("plain after decryption: %s\n", plain);
//HERE IS THE PROBLEM: I get unreadable characters as output of this line 
```

Any help is appreciated. Sorry for the inconvenience and many thanks in advance.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T12:56:38.180

检查您的编码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T12:59:59.170

您需要空终止，`plain`即`plain[ strlen(dkey_buf) ] = 0`需要类似的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T13:37:59.030

我有预感这是一个肮脏的静脉注射，但这只是一个猜测。

```
for(i=0; i<8; i++) ivec[i] = 'i';
BF_cbc_encrypt(inputz, outputz, strlen(inputz), &key, ivec, BF_ENCRYPT);

// won't decrypt right:
BF_cbc_encrypt(inputz, outputz, strlen(inputz), &key, ivec, BF_DECRYPT);
// without resetting the ivec to all 'i's, the decryption will fail.

// This would work though:

for(i=0; i<8; i++) ivec[i] = 'i';
BF_cbc_encrypt(inputz, outputz, strlen(inputz), &key, ivec, BF_ENCRYPT);

for(i=0; i<8; i++) ivec[i] = 'i';
BF_cbc_encrypt(inputz, outputz, strlen(inputz), &key, ivec, BF_DECRYPT); 
```

我的猜测只有在第一个块之后的每个块都正确解密时才是正确的。

strlen(inputz) 的另一个大问题是，如果 strlen() 不完全落在 8 字节边界上，您的解密最终将失败。[作为github 上](http://gist.github.com/96410)的要点，我已经相当彻底地解决了这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T13:40:00.910

使用/分发利用 IBE 算法的程序没有专利限制吗？**************