# StackOverflow 问答 000280000-000280999

# .net - 如何使用 .NET 检索在数码相机上拍摄的照片的属性？

> ID：280003
> 
> 赞同：5
> 
> 时间：2008-11-11T04:29:20.443
> 
> 标签：.net, vb.net, metadata, exif, photos

最好在 VB.Net 中，但 C# 很好，我怎样才能访问我的数码相机添加到文件中的额外属性，例如`Date Picture Taken`，`Shutter Speed`或`Camera Model`？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2015-07-09T22:56:30.760

我维护了一个库，它为从各种文件格式中提取图像元数据提供全面的支持。

[https://github.com/drewnoakes/metadata-extractor-dotnet](https://github.com/drewnoakes/metadata-extractor-dotnet)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T04:34:49.073

当我构建类似的东西时，我经常使用这篇[文章](http://www.codeproject.com/KB/graphics/exifextractor.aspx)。但基本上您正在寻找图像中嵌入的 EXIF 数据。

如果您不想从头开始编写它，有许多很棒的库可以为您提取它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T05:31:09.023

下面的[文章](http://www.vsj.co.uk/dotnet/display.asp?id=649)应该会有所帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T05:45:43.050

您可能想使用命名空间[`BitmapMetadata`](http://msdn.microsoft.com/en-us/library/system.windows.media.imaging.bitmapmetadata.aspx)中的类[`System.Windows.Media.Imaging`](http://msdn.microsoft.com/en-us/library/system.windows.media.imaging.aspx)。

有一个[`BitmapMetadata`可以从 MSDN 下载的示例](http://msdn.microsoft.com/en-us/library/ms771454.aspx)。

# php - 使用PHP时如何获取FTP错误

> ID：280014
> 
> 赞同：24
> 
> 时间：2008-11-11T04:35:07.250
> 
> 标签：php, error-handling, ftp

我有一个脚本，它登录到远程服务器并尝试使用 PHP 重命名文件。

该代码目前看起来类似于 php.net 网站上的这个示例：

```
if (ftp_rename($conn_id, $old_file, $new_file)) {
 echo "successfully renamed $old_file to $new_file\n";
} else {
 echo "There was a problem while renaming $old_file to $new_file\n";
} 
```

但是......错误是什么？权限，没有那个目录，磁盘满了？

如何让 PHP 返回 FTP 错误？像这样的东西：

```
echo "There was a problem while renaming $old_file to $new_file: 
the server says $error_message\n"; 
```

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2012-01-13T08:44:11.007

如果返回值为 false，您可以使用 error_get_last()。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2012-10-16T08:29:10.767

我正在做类似的事情：

```
$trackErrors = ini_get('track_errors');
ini_set('track_errors', 1);
if (!@ftp_put($my_ftp_conn_id, $tmpRemoteFileName, $localFileName, FTP_BINARY)) {
   // error message is now in $php_errormsg
   $msg = $php_errormsg;
   ini_set('track_errors', $trackErrors);
   throw new Exception($msg);
}
ini_set('track_errors', $trackErrors); 
```

编辑：

注意 $php_errormsg 自 PHP 7 起已弃用。

请改用 error_get_last()。

查看@Sascha Schmidt 的回答

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-11-11T04:39:47.787

在这里查看 FTP API：

[http://us.php.net/manual/en/function.ftp-rename.php](http://us.php.net/manual/en/function.ftp-rename.php)

除了真假之外，似乎没有任何方法可以得到任何东西。

但是，您可以使用 ftp_raw 发送原始 RENAME 命令，然后解析返回的消息。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2019-06-21T21:30:06.843

根据@Sascha Schmidt 的回答，您可以执行以下操作：

```
if (ftp_rename($conn_id, $old_file, $new_file)) {
 echo "successfully renamed $old_file to $new_file\n";
} else {
 echo "There was a problem while renaming $old_file to $new_file\n";
 print_r( error_get_last() ); // ADDED THIS LINE
} 
```

print_r will display the contents of the error_get_last() array so you can pinpoint the error.

# reporting-services - 表格行内的表格

> ID：280016
> 
> 赞同：1
> 
> 时间：2008-11-11T04:37:24.920
> 
> 标签：reporting-services

我想在表格行中放置一张表格。但是当我尝试进行预览时，它不起作用。谁可以帮我这个事？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T05:09:43.107

我猜你想要一个子报告。您需要在子报表上有一个参数，该参数与显示报表的行中的值相关联。将子报表放在设计器中的行中（您需要为子报表添加详细信息行，我认为），您应该能够右键单击子报表，告诉它使用什么报表定义以及如何将数据行链接到子报表。

# iphone - UIViewController vs. UIView - 哪一个应该创建子视图？

> ID：280017
> 
> 赞同：7
> 
> 时间：2008-11-11T04:37:41.127
> 
> 标签：iphone, cocoa-touch

我试图围绕 UIViews 和 UIViewControllers 的角色。如果我以编程方式创建和插入子视图，通常是从视图还是控制器执行此操作？

我真的只是想知道是否有一个约定/模式。在我的示例应用程序中，我在运行时加载了 50 张图像，将它们作为子视图添加到主视图中，然后让用户在屏幕上拖动它们。我目前正在视图的 initWithCoder 中进行所有初始化：

```
- (id)initWithCoder:(NSCoder*)coder 
{
    if (self = [super initWithCoder:coder]) {
      // load UIImageViews and add them to the subview
    }

    return self;
} 
```

该视图还实现了 touchesBegan/touchesMoved 以允许拖动。当我尝试在 initWithCoder 中访问 [self frame].size 时，我的问题出现了，它似乎还没有被初始化。这让我觉得我可能将图像加载到错误的位置......

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T04:55:14.447

这取决于你在做什么。如果视图代表“打包”的东西，那么您可以从视图本身创建子视图。如果您只是将视图聚合在一起，那么您应该从视图控制器中进行。

想想传统的封装。您的子视图在概念上是其父视图的“一部分”，还是仅存在于绘图层次结构中？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T15:41:45.327

假设您正在创建一个包含一些控件的视图，例如编辑具有多个字段或其他内容的记录。由于您将在视图控制器中使用这些文本字段及其数据，因此它们在概念上“属于”视图控制器，并且父视图的存在仅用于分组和布局目的。这可能是更常见的情况。

例如，如果您正在创建一个视图子类来表现得像一个新控件，那么我会说您应该完全在视图类中创建和管理视图。我想这种情况在实践中发生的频率会降低。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T18:39:49.867

听起来您可能将它们添加到错误的位置。如果您将添加的子视图移到 ViewController 中，那么您可以在 viewDidLoad 上执行此工作，并且您可以保证主视图已经初始化并准备好访问。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-26T10:34:12.707

虚拟解释是这样的：

每当您计划将视图显示为模式 (presentModalViewController) 或在 UINavigationController (pushViewController) 内部时，子类 UIViewController

子类 UIView 只要它是主视图中的一个小组件...例如，您希望执行自定义按钮或...

更具体地说，在您的示例中......如果您正在初始化 UIViewControllers，您可以设置视图的属性，例如。仅在您的视图添加到超级视图后才像帧大小。只有在那个时候 UIViewController 加载并初始化它的视图。

我认为在您的情况下，您应该使用 UIViews ...您可以在分配和初始化它们后立即设置帧大小。

# c# - 手机ocr示例代码

> ID：280021
> 
> 赞同：2
> 
> 时间：2008-11-11T04:39:29.877
> 
> 标签：c#, .net, mobile, ocr

我想知道你是否可以给我手机 OCR 中的示例（或片段）代码，因为我需要知道如何开始我的项目。我知道如何编写代码以便在台式电脑上使用，但我的伙伴告诉我，手机有不同的平台。我们计划在这个上使用 .net 移动设备..希望你能帮助我..:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T05:39:47.383

It looks like there isn't much for C#/.NET, according to [this question](https://stackoverflow.com/questions/9745/open-source-windows-mobile-ocr-library). If you have written OCR code yourself using C#, it might work as is on the Compact Framework, or it might be made workable with minor modifications. The Compact Framework is a subset of the full .NET framework, so usually code written specifically for CF will run in regular Windows, but code written for Windows may or may not run in CF, depending upon what functionality has been utilized.

Your partner is sort of right, but there are lots of different platforms for mobile device development, and .NET is definitely one of them (and a good one at that).

# ruby - 使用 Shoes 的 download() 进行基本的 HTTP 身份验证

> ID：280024
> 
> 赞同：3
> 
> 时间：2008-11-11T04:41:03.353
> 
> 标签：ruby, shoes

我正在尝试使用 Shoes 的 download() 方法在 HTTP 标头中传递用户名和密码来验证 HTTP 请求（与 Rails 应用程序通信）。

当谈到这些东西时，我有点新手。

我不太明白我是否应该能够自动使用以下语法（用户名：pwd@），或者是否应该在 HTTP 标头中手动创建用户名和密码（我想我也可以使用 :headers 的下载方法）。

```
download "http://username:pwd@127.0.0.1:3000/authenticate", :method => "POST" do |result| 
     # process result.response.body here
end 
```

任何帮助，将不胜感激

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T05:39:01.143

Can I answer my own question?

This seems to do the trick:

```
 require 'base64' 
```

< ... snip ... >

```
 # create the headers
          headers = {}
          headers['Authorization'] = 'Basic ' + encode64("#{@login.text()}:#{@pword.text()}").chop

          # run the download
          download "#{$SITE_URL}/do_something", :method => "GET", :headers => headers do |result|
            @status.text = "The result is #{result.response.body}" 
          end 
```

# c++ - C++ 头文件，代码分离

> ID：280033
> 
> 赞同：30
> 
> 时间：2008-11-11T04:46:02.360
> 
> 标签：c++, header, code-separation

我是 C++ 新手，我有一些关于代码分离的一般性问题。我目前在一个文件中构建了一个小型应用程序。我现在要做的是将其转换为单独的文件，以便它们包含类似的代码或诸如此类的东西。我现在真正的问题是，我怎么知道如何分开事物？代码应该分开的不可见边距是多少？

另外，头文件有什么用？是否转发声明方法和类，以便我可以在编译期间将它们包含在链接器中之前在我的代码中使用它们？

任何对方法或最佳实践的见解都会很棒，谢谢！

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-11T04:56:38.890

头文件应包含类和函数声明。

源文件包含类和函数定义。

每个头文件有一个声明，每个源文件有一个定义是标准做法（即阅读更容易），尽管对于小型（阅读更简单的帮助程序）对象，您有时会将它们与相关的更重要的对象组合在一起。

### 示例：班级菜单

```
Menu.h:     Contains the Menu declaration.
Menu.cpp:   Contains the Menu definition. 
```

头文件包含声明的原因是您可以从多个源文件中包含它们，因此每个源文件对每个类和函数都有完全相同的定义。

这样考虑：
如果您没有头文件，那么您需要在每个源文件中都有类和/或函数声明（没有）定义，这意味着每个文件中都有相同声明的副本。因此，如果您修改一个类，您需要在每个文件中进行相同的修改。通过使用头文件，您可以将声明放在一个位置，因此只需修改一个对象。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-11-11T05:27:04.663

First, you should not put anything into headers that is not needed to be visible by any other file, other than the one that needs it. Then, let's define something we need below.

> ### Translation Unit
> 
> A Translation Unit is the current code being compiled, and all the code included by it, directly or indirectly. One Translation unit translates to one .o / .obj file.
> 
> ### Program
> 
> That's all your .o / .obj files linked together into one binary file that can be executed to form a process.

What are the main points of having different translation units?

1.  Reduce dependencies, so that if you change one method of one class, you don't have to recompile all the code of your program, but only the affected translation unit. An
2.  Reduce possible name clashes by having translation unit local names, that are not visible by other translation unit when linking them together.

Now, how can you split your code into different translation units? The answer is there is no "so you do it!", but you have to consider it on a case-by-case basis. It's often clear, since you have different classes, which can and should be put in different translation units:

**`foo.hpp:`**

```
/* Only declaration of class foo we define below. Note that a declaration
 * is not a definition. But a definition is always also a declaration */
class foo;

/* definition of a class foo. the same class definition can appear 
   in multiple translation units provided that each definition is the same  
   basicially, but only once per translation unit. This too is called the  
   "One Definition Rule" (ODR). */
class foo {
    /* declaration of a member function doit */
    void doit();

    /* definition of an data-member age */
    int age;
}; 
```

Declare some free functions and objects:

```
/* if you have translation unit non-local (with so-called extern linkage)  
   names, you declare them here, so other translation units can include  
   your file "foo.hpp" and use them. */
void getTheAnswer();

/* to avoid that the following is a definition of a object, you put "extern"  
   in front of it. */
extern int answerCheat; 
```

**`foo.cpp:`**

```
/* include the header of it */
#include "foo.hpp"

/* definition of the member function doit */
void foo::doit() {
    /* ... */
}

/* definition of a translation unit local name. preferred way in c++. */
namespace {
    void help() {
        /* ... */
    }
}

void getTheAnswer() {
    /* let's call our helper function */
    help();
    /* ... */
}

/* define answerCheat. non-const objects are translation unit nonlocal  
   by default */
int answerCheat = 42; 
```

**`bar.hpp:`**

```
/* so, this is the same as above, just with other classes/files... */
class bar {
public:
    bar(); /* constructor */
}; 
```

**`bar.cpp:`**

```
/* we need the foo.hpp file, which declares getTheAnswer() */
#include "foo.hpp"
#include "bar.hpp"

bar::bar() {
    /* make use of getTheAnswer() */
    getTheAnswer();
} 
```

Please note that names within an anonymous namespace (as above) do not clash since they appear to be translation unit local. in reality they are not, they just have unique names so that they do not clash. if you really want (there is little reason to) translation unit local names (for example because of compatibility with c so C code can call your function) you can do it like this:

```
static void help() { 
    /* .... */
} 
```

The ODR also says that you cannot have more than one definition of any object or non-inline function in one program (classes are types, not objects, so it doesn't apply to them). So you have to watch out not to put non-inline functions into headers, or not putting objects like "int foo;" in headers. That will cause linker errors then when the linker tries to link the translation units including those headers together.

I hope i could help you a bit. Now that was a long answer, there are indeed errors somewhere. I know that a translation unit strictly is defined another way (output of the pre-processor). But i think it would not add big value to include that into the above, and it would confuse the matter. Please feel free to slap me if you find real bugs :)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T05:01:00.973

决定如何将代码分成不同的类/函数是编程的主要任务之一。关于如何做到这一点有许多不同的指导方针，我建议您阅读一些关于 C++ 和面向对象设计的教程来帮助您入门。

一些基本的指导方针将是

*   把一起使用的东西放在一起
*   为域对象创建类（例如文件、集合等）

头文件允许您声明一个类或函数，然后在几个不同的源文件中使用它。例如，如果您在头文件中声明一个类

```
// A.h
class A
{
public:
    int fn();
}; 
```

然后，您可以在多个源文件中使用此类：

```
// A.cpp
#include "A.h"
int A::fn() {/* implementation of fn */}

//B.cpp
#include "A.h"
void OtherFunction() {
    A a;
    a.fn();
} 
```

因此，头文件使您能够将声明与实现分开。如果您要将所有内容（声明和实现）放在源文件（例如 A.cpp）中，则尝试将其包含在第二个文件中，例如

```
// B.cpp
#include  "A.cpp" //DON'T do this! 
```

然后你可以编译 B.cpp 但是当你尝试链接你的程序时，链接器会抱怨你有多个定义的对象 - 这是因为你有多个 A 的实现副本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T16:27:38.730

建议： 1\. 现在为您的应用准备好设计。2\. 根据设计，创建相互交互的必要对象。3.重构或完全改变现有代码以适应新创建的设计。

头文件为可能使用其功能的其他类提供接口。

# windows - 什么是“云操作系统”？

> ID：280037
> 
> 赞同：9
> 
> 时间：2008-11-11T04:49:21.883
> 
> 标签：windows, cloud, azure

随着 Microsoft Azure 和 Windows 7，这个词变得越来越“热门”。有
什么好处 + 桌面计算的现状现在如何变化？机器是否不再需要安装操作系统（或典型操作系统的高度精简版本）......与“云”交互需要什么？

**更新**：今天收到了我在 SO 上的第一个 RTFM。
**详细说明..我很想知道今天典型桌面操作系统提供的服务的“新方式”有多么不同**（阅读 Win XP/Vista、linux 风格嘉豪等）......不是云的好处计算。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-11T05:13:25.673

两个流行语。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-11T05:45:42.550

Basically its Microsoft's form of competition against Google's recent web-apps boom. So if you want to know what it's all about just open up google docs and gmail, and there you go :)

Now on a personal note, I'm glad Microsoft and Apple(Mobile Me) are trying to fight back against Google. We need the competition, so us the users can choose and get better apps.

Also I'm really not a fan of any corporation, so I'm not all that excited about Google killing off everyone else any more than Microsoft doing the same to others.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-17T16:22:09.263

当微软说 Azure 是一个云操作系统时，他们的意思是它为针对“云”抽象的开发人员提供了相同的服务，类似于桌面操作系统为针对桌面的开发人员提供的服务。

Amitabh Srivistava 在第 9 频道进行了精彩的采访，解释了这一点。基本上，如果您想为桌面用户编写记事本应用程序，您不必担心编写解释键盘击键或设置与打印机通信的代码。这是由于桌面操作系统。同样，Azure 通过抽象负载平衡、身份验证和授权、故障转移以及在为云开发时通常必须解决的许多问题，让开发人员可以更好地专注于他们的云应用程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T05:12:57.343

老派网络图总是将互联网显示为云。微软的方法仍然是客户端-服务器模型，尽管理论上真正的“云”操作系统将是一个松散的组件互连和协同工作的 SOA 架构，而无需真正了解彼此。示例：为电子邮件、文档创作、文件存储等创建服务——这些服务都可以通过不需要了解最终产品的不同服务相互连接。

如此不同的思考方式：“系统”存在于网络中——不是一个单一的位置。

收益：透明度、冗余（不仅是每项服务，而且在供应商退出时更换部件）和可用性（只要您也连接到网络）。

损失：据我所知，供应商锁定、供应商退出、互操作性噩梦——这种模型没有真正的标准。

微软并没有创造“云”计算术语。有关更具体的定义和词源，请参阅[维基百科条目。](http://en.wikipedia.org/wiki/Cloud_computing)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T05:16:52.720

最近关于 SO 的 RTFM 问题是什么？除非我遗漏了一些更深层次的含义，否则您的问题是显而易见的。

[http://en.wikipedia.org/wiki/Cloud_computing](http://en.wikipedia.org/wiki/Cloud_computing)

> 云计算是基于互联网（“云”）开发和使用计算机技术（“计算”）。云是互联网的隐喻（基于它在计算机网络图中的描述），是它所隐藏的复杂基础设施的抽象。 [1] 它是一种计算方式，其中与 IT 相关的功能以“服务”的形式提供，[2] 允许用户从 Internet（“在云中”）[3] 访问技术支持的服务，而无需了解、专业知识，或控制支持它们的技术基础设施。 [4] 根据 IEEE Internet Computing 2008 年发表的一篇论文，“云计算是一种范式，其中信息永久存储在 Internet 上的服务器中，并临时缓存在包括台式机在内的客户端上，

[http://en.wikipedia.org/wiki/Azure_Services_Platform](http://en.wikipedia.org/wiki/Azure_Services_Platform)

> 微软的 Azure 服务平台是一个云平台（云计算平台即服务）产品，“提供广泛的互联网服务，可以从本地环境或互联网消费”[1]。重要的是，这是微软在最近推出微软在线服务产品之后进入云计算的第一步。... 微软的想法和推动直接在 Google 的 Google Docs 提供的软件即服务模型中竞争的想法和推动越来越被他们和其他人视为应用程序开发的重要下一步。在这个想法中，不必在用户的计算机上安装和管理软件。它还允许从 Web 访问文件和文件夹。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T20:41:30.463

就像许多新术语一样，答案可能不止一个。它通常可以定义为一个计算平台，开发人员不必担心资源管理、可扩展性或硬件故障，因为云基础设施可以处理它。这是我工作的公司的一些信息的链接：

[http://www.appistry.com/resource-library/index.html](http://www.appistry.com/resource-library/index.html)

这里链接了一些很好的白皮书，可能对您有所帮助。

-布雷特

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T18:08:49.930

云是时间共享。我们这些老前辈还记得那些日子。您要么编写自己的应用程序并在他们的（时间共享/云提供商）系统上运行它，要么使用他们提供的软件。通常是文字处理器和会计应用程序。

Google Apps 是云。而且由于您获得了高清空间，您已经可以在他们的系统上运行您自己的应用程序。

时间共享在 70 年代和 80 年代风靡一时。因为维护自己的系统并不便宜。当时，任何公司运行的最小系统都是中档系统（如霍尼韦尔、AS400、Dec 等）。随着个人电脑的流行，它失宠了。我记得当 Lotus 1-2-3 出来时，每个人都预测它会破坏分时共享的剩余部分。它（连同 dBase 和其他应用程序）做到了。

有趣的是我们如何重新邀请一切。

PS：忘记了关于分时的一件事。由于网络不存在，您必须安排时间。所以你的员工会去供应商数据中心工作。这就像租用空间和系统。Time Share 和 Cloud 的运作方式不同，但功能相同。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-11T05:05:55.673

到目前为止，它看起来像是将软件和您的数据托管在 msft 的数据中心的想法。SOA 似乎与云提供的内容有关。

无需本地软件（办公室将通过互联网运行，您的文档将保存在那里。因此，您可以在任何地方访问它）。我认为，目标可能是大公司——从而在订阅的基础上为他们提供服务（软件+硬件（数据存储+处理能力））。

专家可以阐明这如何有用吗？
人们愿意把所有东西都放在云端吗？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-01-23T05:10:56.027

云操作系统主要管理虚拟化环境中一个或多个虚拟机的操作。

Microsoft Windows Azure 和 Google Chrome OS 是当前云操作系统的示例。

Azure App Service 是常见且最常用的服务之一。虽然可以立即将应用程序、作业等部署到应用程序服务，但让决策者感到困惑的一个共同因素是市场空间中可用的层级（计划选项）的广泛性。要了解更多详情，请访问：[https ://www.impigertech.com/blog/azure-app-service/](https://www.impigertech.com/blog/azure-app-service/)

# apache-flex - Adobe Air 应用程序中的圆角半径

> ID：280040
> 
> 赞同：0
> 
> 时间：2008-11-11T04:51:08.747
> 
> 标签：apache-flex, air

我们如何在 Air 应用程序中的 vbox 控件上制作圆角？

我隐藏了标题并将透明设置为 true，但是它没有显示应用程序中 VBox 上的圆角。我正在向用户展示这个 VBox。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T10:14:43.100

您可以通过实现自定义边框来做到这一点：

```
package your.package
{

  import flash.display.*;
  import flash.geom.*;
  import flash.utils.*;

  import mx.skins.halo.HaloBorder;
  import mx.utils.GraphicsUtil;

  public class RoundedBorder extends HaloBorder 
  {

    private var topCornerRadius:Number;
    private var bottomCornerRadius:Number;
    private var setup:Boolean;

    /**
     * Get the CSS style attributes from the element to which to apply this
     * gradient. 
     */
    private function readElementCssStyles():void
    {
      topCornerRadius = getStyle("cornerRadius") as Number;
      if (!topCornerRadius)
      { 
        topCornerRadius = 0;
      }    

      bottomCornerRadius = getStyle("bottomCornerRadius") as Number;
      if (!bottomCornerRadius) 
      {
        bottomCornerRadius = topCornerRadius;
      }  
    }

    /**
     * Paint the gradient background.
     *  
     * @param unscaledWidth
     * @param unscaledHeight
     * 
     */
    override protected function updateDisplayList(unscaledWidth:Number, unscaledHeight:Number):void
    {
      super.updateDisplayList(unscaledWidth, unscaledHeight);   
      var rectWidth:Number 
          = unscaledWidth - this.borderMetrics.left - this.borderMetrics.right;
      var rectHeight:Number 
          = unscaledHeight - this.borderMetrics.top - this.borderMetrics.bottom; 

      readElementCssStyles();

      var topRadius:Number = Math.max(topCornerRadius-2, 0);
      var bottomRadius:Number = Math.max(bottomCornerRadius-2, 0);

      GraphicsUtil.drawRoundRectComplex(this.graphics, 
                                        this.borderMetrics.left, 
                                        this.borderMetrics.top, 
                                        rectWidth, 
                                        rectHeight, 
                                        topRadius, 
                                        topRadius, 
                                        bottomRadius, 
                                        bottomRadius);
    }

  }
} 
```

然后在您的 MXML 应用程序中，您必须为您的 VBox 定义一个 CSS 类，如下所示：

```
 <mx:Style>
    .roundedBorder
    {
      border-style:solid;
      border-thickness: 1;
      border-skin: ClassReference("your.package.RoundedBorder");
      corner-radius: 5;
    }   
  </mx:Style> 
```

我已经从一个更复杂的类中删除了这段代码。希望我没有忘记任何东西，并且它会像发布的那样工作。

# vb6 - VB6 图片框鼠标悬停

> ID：280041
> 
> 赞同：0
> 
> 时间：2008-11-11T04:51:27.777
> 
> 标签：vb6, user-interface, events, coding-style, mouse

我在我的用户控件上使用 VB6 PictureBox。我设置了 PictureBox 的图片，我将 BorderStyle 设置为 0，并将 BackColor 设置为用户控件的 BackColor。这个想法是我想要一个“浮动”图标。但是，我希望当鼠标悬停在该图标上时该图标显示为可点击。

两个问题：

1.  我使用哪些事件？MouseMove 似乎是最接近“MouseOver”事件的。有没有更清洁的替代品？

2.  我应该如何改变风格？我已经尝试了一些东西，但它们看起来都不对。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T05:01:42.890

1.  MouseMove 是 VB6 中的正确事件。您必须做一些工作来手动检测鼠标何时干净地离开客户区。（我在这个世界上的实验，很多年前，总是发现实现这种行为很棘手。）

2.  为了改变风格，我建议使用 GDI 来：（a）将图像向上和向左移动一个像素；(b) 在 ButtonHighlightColor 中沿顶部和左侧边缘绘制一条像素线；(c) 在 ButtonShadowColor 中沿底部和右侧边缘绘制一条像素线。这比听起来更棘手，特别是在 VB6 中，所以最终我建议......

那你看看[vbAccelerator 的工具栏控件](http://vbaccelerator.com/home/VB/Code/Controls/Toolbar/index.asp)。它们是免费的，它们可能会带您到达您想去的大部分地方。（是的，它们是“经典”VB——也就是 VB6。）

# nunit - 带有 NCover 插件的 NCover Nunit CruiseControl.NET 任务

> ID：280044
> 
> 赞同：3
> 
> 时间：2008-11-11T04:52:19.337
> 
> 标签：nunit, cruisecontrol.net, ncover

有人可以为我提供一个 nunit dll 的 ncover 任务样本吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T04:59:36.387

[http://madcoderspeak.blogspot.com/2006/01/code-coverage-with-ncover-from-nunit.html](http://madcoderspeak.blogspot.com/2006/01/code-coverage-with-ncover-from-nunit.html) [http://madcoderspeak.blogspot.com/2006/06/integrating-ncover-code-coverage-with .html](http://madcoderspeak.blogspot.com/2006/06/integrating-ncover-code-coverage-with.html)

也许有点过时了.. 但是 HTH

# javascript - 如何创建 JavaScript 回调以了解图像何时加载？

> ID：280049
> 
> 赞同：166
> 
> 时间：2008-11-11T04:57:58.670
> 
> 标签：javascript, image, callback, loading

我想知道图像何时完成加载。有没有办法通过回调来做到这一点？

如果没有，有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：187
> 
> 时间：2014-06-13T08:48:11.587

**`.complete`+ 回调**

这是一种符合标准的方法，没有额外的依赖项，并且无需等待：

```
var img = document.querySelector('img')

function loaded() {
  alert('loaded')
}

if (img.complete) {
  loaded()
} else {
  img.addEventListener('load', loaded)
  img.addEventListener('error', function() {
      alert('error')
  })
} 
```

来源：[http ://www.html5rocks.com/en/tutorials/es6/promises/](http://www.html5rocks.com/en/tutorials/es6/promises/)

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2008-11-11T05:19:46.893

**Image.onload()**通常会起作用。

要使用它，您需要确保在设置 src 属性之前绑定事件处理程序。

**相关链接：**

*   [**Mozilla on Image.onload()**](https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onload)

**示例用法：**

```
 window.onload = function () {

        var logo = document.getElementById('sologo');

        logo.onload = function () {
            alert ("The image has loaded!");		
        };

        setTimeout(function(){
            logo.src = 'https://edmullen.net/test/rc.jpg';         
        }, 5000);
    };
```

```
 <html>
    <head>
    <title>Image onload()</title>
    </head>
    <body>

    <img src="#" alt="This image is going to load" id="sologo"/>

    <script type="text/javascript">

    </script>
    </body>
    </html>
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-11-11T06:12:33.120

You can use the .complete property of the Javascript image class.

I have an application where I store a number of Image objects in an array, that will be dynamically added to the screen, and as they're loading I write updates to another div on the page. Here's a code snippet:

```
var gAllImages = [];

function makeThumbDivs(thumbnailsBegin, thumbnailsEnd)
{
    gAllImages = [];

    for (var i = thumbnailsBegin; i < thumbnailsEnd; i++) 
    {
        var theImage = new Image();
        theImage.src = "thumbs/" + getFilename(globals.gAllPageGUIDs[i]);
        gAllImages.push(theImage);

        setTimeout('checkForAllImagesLoaded()', 5);
        window.status="Creating thumbnail "+(i+1)+" of " + thumbnailsEnd;

        // make a new div containing that image
        makeASingleThumbDiv(globals.gAllPageGUIDs[i]);
    }
}

function checkForAllImagesLoaded()
{
    for (var i = 0; i < gAllImages.length; i++) {
        if (!gAllImages[i].complete) {
            var percentage = i * 100.0 / (gAllImages.length);
            percentage = percentage.toFixed(0).toString() + ' %';

            userMessagesController.setMessage("loading... " + percentage);
            setTimeout('checkForAllImagesLoaded()', 20);
            return;
        }
    }

    userMessagesController.setMessage(globals.defaultTitle);
} 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2018-01-11T13:38:20.510

jquery 的生命太短暂了。

```
function waitForImageToLoad(imageElement){
  return new Promise(resolve=>{imageElement.onload = resolve})
}

var myImage = document.getElementById('myImage');
var newImageSrc = "https://pmchollywoodlife.files.wordpress.com/2011/12/justin-bieber-bio-photo1.jpg?w=620"

myImage.src = newImageSrc;
waitForImageToLoad(myImage).then(()=>{
  // Image have loaded.
  console.log('Loaded lol')
});
```

```
<img id="myImage" src="">
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2011-02-06T12:05:55.990

您可以在 jQuery 中使用 load() 事件，但如果图像是从浏览器缓存中加载的，它不会总是触发。这个插件[https://github.com/peol/jquery.imgloaded/raw/master/ahpi.imgload.js](https://github.com/peol/jquery.imgloaded/raw/master/ahpi.imgload.js)可以用来解决这个问题。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-03-22T08:43:14.277

这是 jQuery 等价物：

```
var $img = $('img');

if ($img.length > 0 && !$img.get(0).complete) {
   $img.on('load', triggerAction);
}

function triggerAction() {
   alert('img has been loaded');
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2020-06-04T00:42:19.407

不适合 2008 年问这个问题，但这些天这对我来说效果很好：

```
async function newImageSrc(src) {
  // Get a reference to the image in whatever way suits.
  let image = document.getElementById('image-id');

  // Update the source.
  img.src = src;

  // Wait for it to load.
  await new Promise((resolve) => { image.onload = resolve; });

  // Done!
  console.log('image loaded! do something...');
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2020-04-01T12:39:53.223

如果目标是在浏览器渲染图像后设置 img 样式，您应该：

```
const img = new Image();
img.src = 'path/to/img.jpg';

img.decode().then(() => {
/* set styles */
/* add img to DOM */ 
}); 
```

因为浏览器首先`loads the compressed version of image`，然后`decodes it`，最后`paints`它。因为在浏览器具有img 标签`paint`后，您应该运行您的逻辑没有任何事件。`decoded`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-10-24T16:43:41.190

这些函数将解决问题，您需要实现该`DrawThumbnails`函数并有一个全局变量来存储图像。我喜欢让它与具有`ThumbnailImageArray`作为成员变量的类对象一起工作，但我很挣扎！

称为`addThumbnailImages(10);`

```
var ThumbnailImageArray = [];

function addThumbnailImages(MaxNumberOfImages)
{
    var imgs = [];

    for (var i=1; i<MaxNumberOfImages; i++)
    {
        imgs.push(i+".jpeg");
    }

    preloadimages(imgs).done(function (images){
            var c=0;

            for(var i=0; i<images.length; i++)
            {
                if(images[i].width >0) 
                {
                    if(c != i)
                        images[c] = images[i];
                    c++;
                }
            }

            images.length = c;

            DrawThumbnails();
        });
}

function preloadimages(arr)
{
    var loadedimages=0
    var postaction=function(){}
    var arr=(typeof arr!="object")? [arr] : arr

    function imageloadpost()
    {
        loadedimages++;
        if (loadedimages==arr.length)
        {
            postaction(ThumbnailImageArray); //call postaction and pass in newimages array as parameter
        }
    };

    for (var i=0; i<arr.length; i++)
    {
        ThumbnailImageArray[i]=new Image();
        ThumbnailImageArray[i].src=arr[i];
        ThumbnailImageArray[i].onload=function(){ imageloadpost();};
        ThumbnailImageArray[i].onerror=function(){ imageloadpost();};
    }
    //return blank object with done() method    
    //remember user defined callback functions to be called when images load
    return  { done:function(f){ postaction=f || postaction } };
} 
```

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2018-05-28T15:30:52.570

如果你使用 React.js，你可以这样做：

```
render() { 
```

// ...

```
<img 
onLoad={() => this.onImgLoad({ item })}
onError={() => this.onImgLoad({ item })}

src={item.src} key={item.key}
ref={item.key} /> 
```

// ... }

在哪里：

*   - onLoad (...) 现在将调用如下内容： { src: " [https://......png](https://......png) ", key:"1" } 你可以使用它作为 "key" 来了解哪些图像正确加载，哪个不正确。*   - onError(...) 它是相同的，但对于错误。*   - 对象 "item" 类似于 { key:"..", src:".."} 您可以用来存储图像的 URL 和键，以便在图像列表中使用。

# ios - iPhone - 内存泄漏 - NSData dataWithContentsOfUrl & UIWebView

> ID：280053
> 
> 赞同：5
> 
> 时间：2008-11-11T05:00:22.533
> 
> 标签：ios, objective-c, iphone, cocoa-touch, memory-leaks

请帮忙！已经盯着这个看了12个小时；并在网上查看并找不到解决方案。

在我的应用程序中，我在单独的页面/控制器中使用了 2 个 UIView 控件：

*   UIImageView（通过 NSData dataWithContentsOfUrl 检索数据）
*   UIWebView

只是为了隔离我的代码并使其更易于解释，我创建了一个基于视图的新项目，名为“MyTestApplication”

1 - 我在委托函数中添加了一个简单的 NSData dataWithContentsOfUrl。

```
NSData *imageData = [NSData dataWithContentsOfURL:
  [NSURL URLWithString:@"http://www.google.com/intl/en_ALL/images/logo.gif"]]; 
```

（这里没有发布，因为它都是使用便利功能）

[替代文字 http://img.skitch.com/20081110-j5tn5n7ixph95ys4rpchibaw5p.preview.jpg](http://img.skitch.com/20081110-j5tn5n7ixph95ys4rpchibaw5p.preview.jpg)

[看图](http://img.skitch.com/20081110-j5tn5n7ixph95ys4rpchibaw5p.jpg)

2 - 运行它以验证没有泄漏（如预期的那样）

[替代文字 http://img.skitch.com/20081110-fy2qrkgy47hm4fe2f1aakd4muw.preview.jpg](http://img.skitch.com/20081110-fy2qrkgy47hm4fe2f1aakd4muw.preview.jpg)

[看图](http://img.skitch.com/20081110-fy2qrkgy47hm4fe2f1aakd4muw.jpg)

3 - 打开 ViewController.xib 并从库中添加一个 UIWebView （无需连接它）

[替代文字 http://img.skitch.com/20081110-d63c3yh1a1kqiciy73q8uyd68j.preview.jpg](http://img.skitch.com/20081110-d63c3yh1a1kqiciy73q8uyd68j.preview.jpg)

[看图](http://img.skitch.com/20081110-d63c3yh1a1kqiciy73q8uyd68j.jpg)

4 - 运行它以验证是否有泄漏！（为什么？？？）

[替代文字 http://img.skitch.com/20081110-qtxcfwntbcc3csabda3r6nfjg6.preview.jpg](http://img.skitch.com/20081110-qtxcfwntbcc3csabda3r6nfjg6.preview.jpg)

[看图](http://img.skitch.com/20081110-qtxcfwntbcc3csabda3r6nfjg6.jpg)

我究竟做错了什么？请帮忙！

如果我使用 UIWebView，为什么 NSData 会导致内存泄漏？我只是不明白。谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-09-18T05:07:46.957

我也遇到`dataWithContentsOfURL:`了 iPhone 模拟器中 NSData 的泄漏问题。我发现当我使用其他便捷方法 ( `dataWithContentsOfURL:options:error:`) 时，我不会出现内存泄漏。

我的代码看起来像这样：

```
NSURL *url = [NSURL URLWithString:urlString];
NSError *error = nil;
NSData *data = [NSData dataWithContentsOfURL:url
                                     options:0
                                       error:&error]; 
```

[链接到文档](http://developer.apple.com/mac/library/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/Reference/Reference.html#//apple_ref/occ/clm/NSData/dataWithContentsOfURL:options:error:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T05:06:16.220

我认为这是正在发生的事情：

加载 ViewController.xib 时，会分配并初始化 UIWebView 的实例。由于您没有将其连接到任何地方，因此它不会被释放。我认为您需要将其连接起来并在支持视图控制器的 dealloc 函数中释放它。我记得必须手动释放我在 xib 文件中创建的每个对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T15:18:19.447

Are you running Leaks on the Simulator? If so, caveat coder. The Simulator will leak memory where the iPhone hardware won't. No simulator is ever a perfect match for the exact behavior of your code on the device.

I would test on the device as well. I just did the same thing on a similar issue with UITableViewController which was leaking in the Sim but not on the phone.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-05-25T12:02:29.817

`[NSData dataWithContentsOfURL:url options:0 error:&error]`在iOS8上没有帮助我。

但以下工作正常：

```
NSURLRequest* request = [NSURLRequest requestWithURL:imageURL];
NSData* imageData = [NSURLConnection sendSynchronousRequest:request returningResponse:nil error:nil];
[[NSURLCache sharedURLCache] removeCachedResponseForRequest:request]; 
```

生产代码还需要响应和错误参数。

# c# - ADO.NET + 大量 INSERTs + Excel + C# = “A bad time”吗？

> ID：280058
> 
> 赞同：1
> 
> 时间：2008-11-11T05:01:46.273
> 
> 标签：c#, excel, ado.net, memory-management, memory-leaks

基本上我需要将一堆数据插入到 Excel 文件中。创建 OleDB 连接似乎是最快的方法，但我发现遇到了内存问题。当我执行 INSERT 查询时，进程使用的内存似乎在不断增长。我已将它们缩小到仅在输出到 Excel 文件时发生（内存保持稳定而没有输出到 Excel）。我关闭并重新打开每个工作表之间的连接，但这似乎对内存使用没有影响（Dispose() 也是如此）。数据写入成功，因为我可以使用相对较小的数据集进行验证。如果有人有见识，将不胜感激。

*在构造函数中调用*initializeADOConn()**

 **initADOConnInsertComm()*创建插入参数化插入查询

*每当写入新记录时都会调用*writeRecord() 。*根据需要创建新工作表。*

 *```
public bool initializeADOConn()
        {
            /* Set up the connection string and connect.*/
            string connectionString = @"Provider=Microsoft.Jet.OLEDB.4.0;" +
                "Data Source=" + this.destination + ";Extended Properties=\"Excel 8.0;HDR=YES;\"";
            //DbProviderFactory factory =
                //DbProviderFactories.GetFactory("System.Data.OleDb");
            conn = new OleDbConnection(connectionString);
            conn.ConnectionString = connectionString;
            conn.Open();

            /* Intialize the insert command. */
            initADOConnInsertComm();
            return true;
        }
    public override bool writeRecord(FileListerFileInfo file)
            {
                /* If all available sheets are full, make a new one. */
                if (numWritten % EXCEL_MAX_ROWS == 0)
                {
                    conn.Close();
                    conn.Open();
                    createNextSheet();
                }
                /* Count this record as written. */
                numWritten++;
                /* Get all of the properties of the FileListerFileInfo record and add
                 * them to the parameters of the insert query. */
                PropertyInfo[] properties = typeof(FileListerFileInfo).GetProperties();
                for (int i = 0; i < insertComm.Parameters.Count; i++)
                    insertComm.Parameters[i].Value = properties[i].GetValue(file, null);
                /* Add the record. */
                insertComm.ExecuteNonQuery();

                return true;
            } 
```

编辑：

不，我根本不使用 Excel。我故意避免使用 Interop.Excel，因为它的性能很差（至少从我对它的涉猎来看）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T06:07:26.127

答案是**肯定**的，你描述的公式*确实*等于一个糟糕的时间。

如果您有一个方便的数据库（SQL Server 或 Access 很适合），您可以在数据库表中执行所有插入操作，然后将表一次全部导出到 Excel 电子表格中。

一般来说，数据库擅长处理大量插入，而电子表格则不然。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T08:39:59.033

这里有几个想法：

目标工作簿是否打开？有一个错误（[当您使用 ActiveX 数据对象查询打开的 Excel 工作表时会发生内存泄漏](http://support.microsoft.com/kb/319998/en-us)），IIRC 实际上位于 Jet（您正在使用的）的 OLE DB 提供程序中，尽管在上面的文章中没有确认这一点。

无论如何，批量插入似乎是要走的路。

您可以使用相同的 Jet OLE DB 提供程序来执行此操作：您所需要的只是一个单行表。你甚至可以即时制造一个。要创建新的 Excel 工作簿，`CREATE TABLE`请使用连接字符串中不存在的 xls 文件执行 DDL，提供程序将为您创建工作簿，并使用工作表来表示表格。您已连接到 Excel 工作簿，因此您可以执行以下操作：

```
CREATE TABLE [EXCEL 8.0;DATABASE=C:\MyFabricatedWorkbook;HDR=YES].OneRowTable 
(
   x FLOAT
); 
```

（更好的 IMO 将是制作一个 Jet 数据库，即 .mdb 文件）。

用于`INSERT`创建虚拟行：

```
INSERT INTO [EXCEL 8.0;DATABASE=C:\MyFabricatedWorkbook;HDR=YES].OneRowTable (x) 
   VALUES (0); 
```

然后，仍然使用与目标工作簿的连接，您可以使用类似于以下内容的内容`INSERT`一次性创建您的值的派生表 (DT1)：

```
INSERT INTO MyExcelTable (key_col, data_col)
SELECT DT1.key_col, DT1.data_col
FROM (
   SELECT 22 AS key_col, 'abc' AS data_col
   FROM [EXCEL 8.0;DATABASE=C:\MyFabricatedWorkbook;HDR=YES].OneRowTable
   UNION ALL
   SELECT 55 AS key_col, 'xyz' AS data_col
   FROM [EXCEL 8.0;DATABASE=C:\MyFabricatedWorkbook;HDR=YES].OneRowTable
   UNION ALL
   SELECT 99 AS key_col, 'efg' AS data_col
   FROM [EXCEL 8.0;DATABASE=C:\MyFabricatedWorkbook;HDR=YES].OneRowTable
) AS DT1; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T05:16:05.513

除了一次写入一条记录，您能找到一种插入批量容量的方法吗？我尽量不使用疯狂的 DataSet 东西，但是有没有办法让你的所有插入首先发生在本地，然后让它们一举上去？此过程是否在后台打开 Excel？这些过程之后会死吗？

# c++ - GCC：程序不适用于编译选项 -O3

> ID：280069
> 
> 赞同：10
> 
> 时间：2008-11-11T05:09:42.700
> 
> 标签：c++, gcc, compilation

我正在编写一个 C++ 程序，当我使用优化（选项 -O1、-O2、-O3 等）编译它时它不起作用（我得到一个分段错误），但是当我编译它时它工作得很好优化。

错误是否存在于我的代码中？还是我应该假设这是 GCC 中的错误？

我的 GCC 版本是 3.4.6。

此类问题是否有任何已知的解决方法？

我的程序的优化版本和未优化版本之间的速度差异很大，所以我真的需要使用优化。

* * *

这是我原来的函子。一个在没有优化级别的情况下工作正常，并且在任何级别的优化下都会引发分段错误：

```
struct distanceToPointSort{
    indexedDocument* point ;
    distanceToPointSort(indexedDocument* p): point(p) {}
    bool operator() (indexedDocument* p1,indexedDocument* p2){
        return distance(point,p1) < distance(point,p2) ;
    }
} ; 
```

这个可以完美地与任何级别的优化一起工作：

```
struct distanceToPointSort{
    indexedDocument* point ;
    distanceToPointSort(indexedDocument* p): point(p) {}
    bool operator() (indexedDocument* p1,indexedDocument* p2){

        float d1=distance(point,p1) ;
        float d2=distance(point,p2) ;

        std::cout << "" ;  //without this line, I get a segmentation fault anyways

        return d1 < d2 ;
    }
} ; 
```

不幸的是，这个问题很难重现，因为它发生在一些特定的值上。在对一千多个向量中的一个进行排序时，我得到了分段错误，因此它实际上取决于每个向量具有的值的特定组合。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-11T05:17:12.233

我会假设你的代码首先是错误的。
虽然很难说。

您的代码编译时是否出现 0 个警告？

```
 g++ -Wall -Wextra -pedantic -ansi 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-12T13:35:09.013

既然您发布了代码片段并找到了可行的解决方法（@Windows 程序员的回答），我可以说您正在寻找的可能是`-ffloat-store`.

> -float-存储
> 
> 不要将浮点变量存储在寄存器中，并禁止其他可能改变浮点值是从寄存器还是内存中获取的选项。
> 
> 此选项可防止在诸如 68000 之类的机器上出现不希望出现的过高精度，其中浮动寄存器（68881 的）保持比双精度应有的精度更高。对于 x86 架构也是如此。对于大多数程序来说，超额精度只会带来好处，但少数程序依赖于 IEEE 浮点的精确定义。在修改它们以将所有相关的中间计算存储到变量中之后，对此类程序使用 -ffloat-store。

来源： http: [//gcc.gnu.org/onlinedocs/gcc-3.4.6/gcc/Optimize-Options.html](http://gcc.gnu.org/onlinedocs/gcc-3.4.6/gcc/Optimize-Options.html)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-11T07:14:53.027

这是一些*似乎*有效的代码，直到您点击 -O3 ...

```
#include <stdio.h>

int main()
{
    int i = 0, j = 1, k = 2;
    printf("%d %d %d\n", *(&j-1), *(&j), *(&j+1));
    return 0;
} 
```

没有优化，我得到“2 1 0”；通过优化我得到“40 1 2293680”。为什么？因为 i 和 k 被优化了！

但是我正在获取 j 的地址并离开分配给 j 的内存区域。这是标准不允许的。您的问题很可能是由与标准的类似偏差引起的。

我发现[valgrind](http://valgrind.org/)在这些时候通常很有帮助。

编辑：一些评论者认为该标准允许任意指针算术。*它不是。*请记住，某些架构具有有趣的寻址方案，对齐可能很重要，如果溢出某些寄存器，您可能会遇到问题！

[draft] 标准中关于向/从指针添加/减去整数（强调添加）的内容：

“如果指针操作数和结果都指向同一个数组对象的元素，或者超过数组对象的最后一个元素，则*评估*不应产生溢出；*否则，行为未定义。* ”

看到 &j 甚至不指向数组对象， &j-1 和 &j+1 几乎不能指向同一个数组对象的一部分。因此，简单地评估 &j+1 （更不用说取消引用它）是未定义的行为。

在 x86 上，我们可以确信向指针添加 1 是相当安全的，并且只会将我们带到下一个内存位置。在上面的代码中，当我们对内存包含的内容做出假设时，就会出现问题，标准当然不会接近。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-11T05:16:42.860

错误在您的代码中。根据 C 标准，您可能正在做一些调用未定义行为的事情，而这种行为恰好可以在没有优化的情况下工作，但是当 GCC 为执行其优化做出某些假设时，当这些假设不正确时，代码就会中断。确保使用该`-Wall`选项进行编译，这`-Wextra`也可能是一个好主意，并查看您是否收到任何警告。您也可以尝试`-ansi`or `-pedantic`，但这些可能会导致误报。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-11T23:30:11.903

作为一个实验，试着看看这是否会迫使编译器一致地四舍五入。

```
volatile float d1=distance(point,p1) ;
volatile float d2=distance(point,p2) ;
return d1 < d2 ; 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-11T05:16:33.750

您可能会遇到混叠问题（或者可能是其他一百万个问题）。查找 -fstrict-aliasing 选项。

如果没有更多信息，这种问题是不可能正确回答的。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-11T07:05:13.297

这很少是编译器的错误，但编译器确实存在错误，并且它们通常在不同的优化级别上表现出来（例如，如果在优化过程中存在错误）。

通常在报告编程问题时：**提供一个最小的代码示例来演示问题**，这样人们就可以将代码保存到文件中，编译并运行它。尽可能**简单**地重现您的问题。

此外，尝试不同版本的 GCC（编译自己的 GCC 非常容易，尤其是在 Linux 上）。如果可能，请尝试使用其他编译器。英特尔 C 有一个或多或少兼容 GCC 的编译器（我认为，非商业用途免费）。这将有助于查明问题。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-11T05:21:46.577

它几乎（***几乎***）从来不是编译器。

首先，确保您使用 -Wall 进行无警告编译。

如果这没有给你一个“灵光乍现”的时刻，请将调试器附加到崩溃的可执行文件的优化程度最低的版本，并查看它在做什么以及它去了哪里。

5 会让你得到 10，你已经解决了这个问题。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-11T05:27:40.793

几天前遇到了同样的问题，就我而言，它是别名。与其他编译器相比，GCC 的做法有所不同，但并没有错。GCC 已成为某些人可能称之为 C++ 标准的规则律师，并且它们的实现是正确的，但你也必须在 C++ 中真正正确，否则它会过度优化某些东西，这很痛苦。但是你得到了速度，所以不能抱怨。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-11T06:36:28.893

在阅读了一些评论后，我希望在这里得到一些反对意见，但在控制台游戏编程世界中，更高的优化级别有时会在奇怪的边缘情况下生成不正确的代码，这是相当普遍的知识。不过，很可能可以通过对代码进行细微的更改来修复边缘情况。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-11T23:07:30.420

好吧...这是我遇到过的最奇怪的问题之一。
我认为我没有足够的证据来说明这是一个 GCC 错误，但老实说......它看起来真的很像。

这是我原来的函子。一个在没有优化级别的情况下工作正常，并且在任何级别的优化下都会引发分段错误：

```
struct distanceToPointSort{
    indexedDocument* point ;
    distanceToPointSort(indexedDocument* p): point(p) {}
    bool operator() (indexedDocument* p1,indexedDocument* p2){
        return distance(point,p1) < distance(point,p2) ;
    }
} ; 
```

这个可以完美地与任何级别的优化一起工作：

```
struct distanceToPointSort{
    indexedDocument* point ;
    distanceToPointSort(indexedDocument* p): point(p) {}
    bool operator() (indexedDocument* p1,indexedDocument* p2){

        float d1=distance(point,p1) ;
        float d2=distance(point,p2) ;

        std::cout << "" ;  //without this line, I get a segmentation fault anyways

        return d1 < d2 ;
    }
} ; 
```

不幸的是，这个问题很难重现，因为它发生在一些特定的值上。在对一千多个向量中的一个进行排序时，我得到了分段错误，因此它实际上取决于每个向量具有的值的特定组合。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-11T05:45:46.297

哇，没想到答案这么快，这么多……

使用 std::sort() 对指针的 std::vector 进行排序时发生错误

我提供了严格弱序函子。

但是我知道我提供的函子是正确的，因为我已经使用了很多并且它工作正常。

另外，错误不能是向量中的一些无效指针，因为错误发生在我对向量进行排序时。如果我在不先应用 std::sort 的情况下遍历向量，则程序可以正常工作。

我只是使用 GDB 试图找出发生了什么。当 std::sort 调用我的仿函数时发生错误。显然 std::sort 正在将无效指针传递给我的仿函数。（当然，这仅发生在优化版本中，任何级别的优化 -O、-O2、-O3）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-11T07:28:31.453

正如其他人指出的那样，可能是严格的混叠。将其关闭 o3 并重试。我的猜测是你在你的仿函数中做了一些指针技巧（作为int比较的快速浮点数？低2位的对象类型？）在内联模板函数中失败。警告无助于捕捉这种情况。“如果编译器可以检测到所有严格的别名问题，它也可以避免它们”只是更改不相关的代码行可能会使问题出现或消失，因为它会更改寄存器分配。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-11T13:41:20.173

正如更新后的问题将显示的那样；），问题存在于`std::vector<T*>`. 向量的一个常见错误是reserve()ing 应该是resize()d。结果，您将在数组边界之外编写。优化器可能会丢弃这些写入。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-12T04:10:07.110

将代码发布在远处！它可能会做一些指针魔术，请参阅我以前的帖子。进行中间分配只是通过更改寄存器分配来隐藏代码中的错误。更能说明这一点的是输出改变了事情！

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-09-15T09:00:39.893

真正的答案隐藏在这个线程的所有评论中。首先：这不是编译器中的错误。

问题与浮点精度有关。`distanceToPointSort`应该是一个函数，对于参数 (a,b) 和 (b,a) 都不应返回 true，但这正是编译器决定对某些数据路径使用更高精度时可能发生的情况。该问题尤其可能出现在但不限于没有`-mfpmath=sse`. 如果比较器以这种方式运行，则`sort`函数可能会变得混乱，分段错误也就不足为奇了。

我认为`-ffloat-store`这里的最佳解决方案（CesarB 已经建议）。

# c# - 帮助持续进行 Java 到 C# 转换的工具

> ID：280072
> 
> 赞同：2
> 
> 时间：2008-11-11T05:11:11.747
> 
> 标签：c#, java

如今，许多项目已经开始使用 Java 编写。其中一些最终转换为 C# 以合并到 .NET 中。想到的例子是 log4net、nhibernate 和 db4o。

包括锐化（这是 db4o 的工具），您是否见过和/或使用过任何使持续转换变得易于管理的工具。我什至可以说，任何需要从原始产品发布推迟 2 个月以上的东西对于持续转换来说并不是那么有用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T16:24:56.723

使用[IKvm](http://www.ikvm.net/)

IKVM.NET 是用于 Mono 和 Microsoft .NET Framework 的 Java 实现。它包括以下组件：

```
* A Java Virtual Machine implemented in .NET
* A .NET implementation of the Java class libraries
* Tools that enable Java and .NET interoperability 
```

# database - Django中的原子操作？

> ID：280075
> 
> 赞同：25
> 
> 时间：2008-11-11T05:14:10.103
> 
> 标签：database, django, concurrency, locking, race-condition

我正在尝试为计数器实现（我认为是）一个非常简单的数据模型：

```
class VisitorDayTypeCounter(models.Model):
    visitType = models.CharField(max_length=60)
    visitDate = models.DateField('Visit Date')
    counter = models.IntegerField() 
```

当有人通过时，它会查找与 visitType 和 visitDate 匹配的行；如果该行不存在，它将使用 counter=0 创建。

然后我们增加计数器并保存。

我担心的是，这个过程完全是一场竞赛。两个请求可以同时检查实体是否存在，并且它们都可以创建它。在读取计数器和保存结果之间，可能会出现另一个请求并增加它（导致计数丢失）。

到目前为止，我还没有真正找到解决这个问题的好方法，无论是在 Django 文档中还是在教程中（事实上，看起来教程的投票部分有一个竞争条件）。

我如何安全地做到这一点？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-12-23T22:35:42.773

从 Django 1.1 开始，您可以使用 ORM 的 F() 表达式。

```
from django.db.models import F
product = Product.objects.get(name='Venezuelan Beaver Cheese')
product.number_sold = F('number_sold') + 1
product.save() 
```

有关更多详细信息，请参阅文档：

[https://docs.djangoproject.com/en/1.8/ref/models/instances/#updating-attributes-based-on-existing-fields](https://docs.djangoproject.com/en/1.8/ref/models/instances/#updating-attributes-based-on-existing-fields)

[https://docs.djangoproject.com/en/1.8/ref/models/expressions/#django.db.models.F](https://docs.djangoproject.com/en/1.8/ref/models/expressions/#django.db.models.F)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-11T14:51:14.103

如果您真的希望计数器准确，您可以使用事务，但所需的并发量确实会在任何重大负载下拖累您的应用程序和数据库。相反，请考虑采用更多消息传递样式的方法，并将计数记录转储到您想要增加计数器的每次访问的表中。然后，当您想要访问总数时，请在访问表上进行计数。您还可以有一个每天运行任意次数的后台进程来汇总访问次数，然后将其存储在父表中。为了节省空间，它还会从它汇总的子访问表中删除所有记录。如果您没有多个代理争夺相同的资源（柜台），您将大大减少并发成本。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-16T05:52:42.177

您可以使用来自[http://code.djangoproject.com/ticket/2705](http://code.djangoproject.com/ticket/2705)的补丁来支持数据库级锁定。

使用补丁，此代码将是原子的：

```
visitors = VisitorDayTypeCounter.objects.get(day=curday).for_update()
visitors.counter += 1
visitors.save() 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-11T05:56:39.907

两个建议：

将 unique_together 添加到您的模型中，并将创建包装在异常处理程序中以捕获重复项：

```
class VisitorDayTypeCounter(models.Model):
    visitType = models.CharField(max_length=60)
    visitDate = models.DateField('Visit Date')
    counter = models.IntegerField()
    class Meta:
        unique_together = (('visitType', 'visitDate')) 
```

在此之后，您可能会在计数器更新时遇到较小的竞争条件。如果您有足够的流量来担心这一点，我建议您研究事务以进行更细粒度的数据库控制。我不认为 ORM 直接支持锁定/同步。交易文件可[在此处](http://docs.djangoproject.com/en/dev/topics/db/transactions/)获得。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T06:21:04.600

为什么不使用数据库作为并发层？将表的主键或唯一约束添加到 visitType 和 visitDate。如果我没记错的话，django 在他们的数据库模型类中并不完全支持这一点，或者至少我没有看到一个例子。

将约束/键添加到表后，您所要做的就是：

1.  检查该行是否存在。如果是，请获取它。
2.  插入行。如果没有错误，你很好，可以继续前进。
3.  如果出现错误（即竞争条件），则重新获取该行。如果没有行，那么这是一个真正的错误。否则，你很好。

这样做很讨厌，但它似乎足够快并且可以涵盖大多数情况。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-12T02:58:40.237

这有点骇人听闻。原始 SQL 将使您的代码的可移植性降低，但它会摆脱计数器增量的竞争条件。理论上，这应该在您进行查询时增加计数器。我没有对此进行测试，因此您应该确保该列表正确插入到查询中。

```
class VisitorDayTypeCounterManager(models.Manager):
    def get_query_set(self):
        qs = super(VisitorDayTypeCounterManager, self).get_query_set()

        from django.db import connection
        cursor = connection.cursor()

        pk_list = qs.values_list('id', flat=True)
        cursor.execute('UPDATE table_name SET counter = counter + 1 WHERE id IN %s', [pk_list])

        return qs

class VisitorDayTypeCounter(models.Model):
    ...

    objects = VisitorDayTypeCounterManager() 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T10:52:10.513

您应该使用数据库事务来避免这种竞争条件。事务允许您在“全有或全无”基础上执行创建、读取、递增和保存计数器的整个操作。如果出现任何问题，它将回滚整个事情，您可以重试。

查看 Django[文档。](http://docs.djangoproject.com/en/dev/topics/db/transactions/?from=olddocs)有一个事务中间件，或者您可以在视图或方法周围使用装饰器来创建事务。

# sql - where 子句中参数的顺序是否会影响表是否使用索引？

> ID：280086
> 
> 赞同：5
> 
> 时间：2008-11-11T05:19:24.320
> 
> 标签：sql, rdbms

所以我想知道这个问题是否有明确的答案。
此外，索引是集群还是非集群是否重要。它在所有 RDBMS 实现中都是一样的，还是确切的行为是专有的？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T05:22:51.363

SQL is a declarative language, not a procedural one. Each SQL implementation is going to have its own quirks about implementation details like which indexes get used, how the optimizer decides which indexes to use, what the SQL programmer can do to affect the choice, and so on.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T05:24:44.950

Use of indexes is not a part of the SQL standard, but rather an implementation detail of the particular DBMS.

Ideally, it shouldn't affect it, since it doesn't affect the actual rows that are returned.

But I've seen queries on an unnamed DBMS that does change index use based on the SQL query order.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T05:26:55.350

The ordering of the where clause shouldn't affect the query plan or the indices used in any respectable database although I have seen at least one (non-respectable) database where this wasn't the case.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T10:35:15.370

曾经（很久以前，即直到大约 1995 年）Oracle 曾经只有一个“基于规则的优化器”，因此 WHERE 子句中谓词的顺序和 FROM 中的表顺序肯定是这种情况子句（当时没有 JOIN 语法），影响了查询计划：记录就是这种情况。然而，基于成本的优化器（Oracle 从那时起就有）试图检查所有可能的计划（或者至少，在一些合理的参数范围内尽可能多地）并选择最有效的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-22T00:31:52.003

这很难回答，因为我认为没有人真正知道，包括 DBMS 工程师！大声笑，这是讽刺，但我真正的意思是它本质上是不确定的。我可能是错的，但它确实归结为数据库引擎实现，因为据我所知，ANSI SQL 标准或任何其他标准都没有规范索引语义的概念。但是，我确实知道，对任何索引字段的第一个引用都很重要，因为它标志着查询引擎的决策树的顶部。从那里开始，根据索引的数量和类型，查询引擎可能会选择使用它找到的第一个和最匹配的索引，或者它可能决定“优化”而不是使用另一个索引。我认为，这就是使其具有不确定性的部分。

# vbscript - 如何防止 ASP/VBScript 中的注入？

> ID：280101
> 
> 赞同：1
> 
> 时间：2008-11-11T05:28:24.647
> 
> 标签：vbscript, asp-classic, code-injection, input-filtering

ASP（VBScript）中输入处理的最佳方式（或至少是最常见的方式）是什么？我主要关心的是 HTML/JavaScript 注入和 SQL 注入。是否有一些等效于 PHP`htmlspecialchars`或`addslashes`等的？还是我必须使用字符串替换函数之类的手动操作？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T07:41:17.623

底线是这个：

1.  在将用户输入写入页面之前，始终对用户输入进行 HTML 编码。`Server.HTMLEncode()`为你做。
2.  始终使用参数化查询与数据库交互。`ÀDODB.Command`和`ADODB.CommandParameter`对象在这里是正确的选择。
3.  始终在呈现页面的 IIS 服务器上使用 URLScan 实用程序和 IIS 锁定，除非它们是版本 6 及更高版本，不再需要这些工具。

如果你一味地坚持第 1 点和第 2 点*，*我想不出有多少会出错。

大多数漏洞来自未正确编码用户输入或从中构建 SQL 字符串。如果您出于某种原因遇到了 HTML 编码的用户输入阻碍了您的工作，那么您已经在您的应用程序中发现了一个设计缺陷。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T10:40:31.927

我将在 Tomalaks 列表中添加另一点。

避免在 SQL 代码中使用字段值的串联。也就是说，在某些情况下，存储过程可能会在字符串中构建一些 SQL 以随后执行。这很好，除非文本字段值用作其构造的一部分。

命令参数可以保护设计用于输入值的 SQL 代码不被劫持以执行不需要的 SQL，但它允许这些不需要的 SQL 成为数据库中的数据。这是一级脆弱性。如果该字段的值随后用于存储过程中的某些 SQL 字符串连接，则存在二级注入漏洞。

另一个考虑是这只是最低限度的保护。它所做的只是使攻击尝试变得无害。然而，在许多情况下，最好添加一个系统来防止此类数据输入和/或改变管理员以进行潜在的注入攻击。

This is where input validation becomes important. I don't know of any tools that do this for you but a few simple Regular Expressions might help. For example, "<\w+" would detect the attempt to include a HTML tag in the field.

# java - JEditorPane inside JScrollPane not resizing as needed

> ID：280106
> 
> 赞同：5
> 
> 时间：2008-11-11T05:35:20.233
> 
> 标签：java, swing, jscrollpane, resize, jeditorpane

I am implementing a Comment box facility in my application which user can resize using mouse. This comment box contains a scrollpane which instead contains a `JEditorPane` in which user can insert comment. I have added the editor pane inside a scroll pane for the following reason:

[auto scolling of jeditorpane](https://stackoverflow.com/questions/271881/auto-scolling-of-jeditorpane)

When the user resizes the comment box, I am setting the desired size for `JScrollPane` and the `JEditorPane`. When the user is increasing the size of the comment box, the size of these components are increasing as desired but when the size of the comment box is decreased, the size of the `JEditorPane` does not decrease even after setting the size. This leads to the scrollbars inside the scrollpane.

I tried using `setPreferrredSize`, `setSize`, `setMaximumSize` for `JEditorPane`. Still the size of the editor pane is not reducing. I tried calling `revalidate()` or `updateUI()` after the setting of size but no use.

I am using Java 1.4.2\.

Please provide me some insight....

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-10-25T12:59:19.840

我意识到这早已得到回答，但为了将来参考，您需要做的就是覆盖`getScrollableTracksViewportWidth()`始终返回 true，例如。

```
JEditorPane pane = new JEditorPane() {
    public boolean getScrollableTracksViewportWidth() {
        return true;
    }
};
panel.add(new JScrollPane(pane)); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-10-06T11:57:19.630

实际上这是可能的，luiscubal。这里是如何，

向 JScrollPane 添加一个用于调整大小事件的 ComponentListener

```
public static void main(String...args) {
    //our test frame
    JFrame frame = new JFrame("JEditorPane inside JScrollPane resizing");
    frame.setLayout(new BorderLayout());

    //our editing pane
    final JEditorPane editor = new JEditorPane();

    //our simple scroll pane
    final JScrollPane scroller = new JScrollPane(editor);

    //NOTE: this is the magic that is kind of a workaround
            // you can also implement your own type of JScrollPane
            // using the JScrollBar and a JViewport which is the 
            // preferred method of doing something like this the 
            // other option is to create a JEditorPane subclass that
            // implements the Scrollable interface.
    scroller.addComponentListener(new ComponentAdapter() {
        @Override
        public void componentResized(ComponentEvent e) {
            editor.setSize(new Dimension(
                               scroller.getWidth()-20, 
                               scroller.getHeight()-20));
        }
    });

    //just use up the entire frame area.
    frame.add(scroller, BorderLayout.CENTER);

    //quick and dirty close event handler
    frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    frame.setSize(320, 240); //something not too big
    frame.setLocationRelativeTo(null); //centers window on screen
    frame.setVisible(true); // normally done in a SwingUtilities.invokeLater
} 
```

看起来很可能。不要这么快宣布 Java 中的事情是不可能的。swing api 非常灵活，可以为您完成很多工作。但是，如果您以不适合使用的方式使用 JComponents，您最终会遇到问题并且有两种选择。

1.  subclass subclass subclass 基本上是创建你自己的组件。
2.  找到解决方法，如上述解决方案。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-11T18:32:03.753

减小 JScrollPane 中的 JEditorPane 的大小然后再减小它是不可能的。您可能想改用 JTextArea。

# java - Java中的术语“规范形式”或“规范表示”是什么意思？

> ID：280107
> 
> 赞同：104
> 
> 时间：2008-11-11T05:36:11.430
> 
> 标签：java

我经常听到有人使用这个词，但我从来没有真正理解过它。

这是什么意思，任何人都可以举一些例子/指向一些链接吗？

编辑：感谢大家的回复。你能否告诉我规范表示如何在 equals() 性能中发挥作用，如 Effective Java 中所述？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-12-12T03:46:04.770

我相信规范有两种相关用途：形式和实例。

**规范形式**意味着可以以多种方式描述或表示特定类型资源的值，并且选择其中一种方式作为首选规范形式。（这种形式是*规范化*的，就像圣经中的书籍一样，而其他形式则不是。）规范形式的一个典型例子是分层文件系统中的路径，其中可以通过多种方式引用单个文件：

```
myFile.txt                                   # in current working dir
../conf/myFile.txt                           # relative to the CWD
/apps/tomcat/conf/myFile.txt                 # absolute path using symbolic links
/u1/local/apps/tomcat-5.5.1/conf/myFile.txt  # absolute path with no symlinks 
```

该文件的规范表示的经典定义将是最后一个路径。使用本地或相对路径，您无法在没有上下文信息的情况下全局识别资源。使用绝对路径，您可以识别资源，但无法判断两条路径是否指向同一个实体。通过将两个或多个路径转换为它们的规范形式，您可以执行上述所有操作，并确定两个资源是否相同，如果这对您的应用程序很重要（解决*别名问题*）。

请注意，资源的规范形式并不是该特定形式本身的质量；给定类型（例如文件路径）可能有多种可能的规范形式（例如，按字典顺序首先是所有可能的绝对路径）。一种形式只是出于特定的应用原因而被选为规范形式，或者可能是任意的，以便每个人都说相同的语言。

强制对象进入它们的**规范实例**是相同的基本思想，但它不是确定资源的一个“最佳”表示，而是任意选择具有相同“内容”的一类实例的一个实例作为规范引用，然后转换所有引用到等效对象以使用一个规范实例。

这可以用作优化时间和空间的技术。如果应用程序中有多个等效对象的实例，那么通过强制将它们全部解析为特定值的单个规范实例，您可以消除每个值中的所有值，节省空间和时间，因为您现在可以比较那些具有引用标识（==）而不是对象等价（`equals()`方法）的值。

使用规范实例优化性能的一个经典示例是折叠具有相同内容的字符串。保证调用`String.intern()`具有相同字符序列的两个字符串会为该文本返回相同的规范字符串对象。如果您通过该规范化程序传递所有字符串，您知道等效字符串实际上是相同的对象引用，即别名

Java 5.0+ 中的枚举类型强制特定枚举值的所有实例在 VM 中使用相同的规范实例，即使该值已被序列化和反序列化。这就是为什么如果是枚举类型，您可以`if (day == Days.SUNDAY)`在 java 中不受惩罚地使用。`Days`为您自己的课程这样做当然是可能的，但要小心。阅读Josh Bloch 的*Effective Java ，了解详细信息和建议。*

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2008-11-11T05:51:49.450

维基百科指向术语[规范化](http://en.wikipedia.org/wiki/Canonicalization)。

> 将具有多个可能表示的数据转换为“标准”规范表示的过程。这可以用来比较不同表示的等价性，计算不同数据结构的数量，通过消除重复计算来提高各种算法的效率，或者可以施加有意义的排序顺序。

**Unicode**示例对我来说最有意义：

> Unicode 标准中的可变长度编码，特别是 UTF-8，对于最常见的字符有不止一种可能的编码。这使得字符串验证更加复杂，因为必须考虑每个字符串字符的每一种可能的编码。不考虑所有字符编码的软件实现存在接受在应用程序设计中被认为无效的字符串的风险，这可能会导致错误或允许攻击。解决方案是允许对每个字符进行单一编码。然后，规范化是将每个字符串字符转换为其单一允许编码的过程。另一种方法是让软件确定一个字符串是否被规范化，如果不是，则拒绝它。在这种情况下，在客户端/服务器上下文中，规范化将是客户端的责任。

总之，一种标准的数据表示形式。然后，您可以从此表格转换为您可能需要的任何表示形式。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2012-09-12T12:33:16.223

理解“规范形式/表示”的一个很好的例子是查看“布尔”的 XML 模式数据类型定义：

*   boolean 的“词汇表示”可以是以下之一：`{true, false, 1, 0}`而
*   “规范表示”只能是以下之一`{true, false}`

这实质上意味着

*   `"true"`并`"1"`映射到规范的 repr。`"true"`和
*   `"false"`并`"0"`映射到规范的代表。`"false"`

请参阅[w3 XML 模式数据类型定义的布尔值](http://www.w3.org/TR/xmlschema-2/#boolean)

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2008-11-11T05:48:42.700

“规范”一词只是“标准”或“通常”的同义词。它没有任何 Java 特定的含义。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2010-07-29T08:13:40.663

在不失一般性的情况下简化为最简单和最重要的形式

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-08-02T11:18:15.673

记住它的一个简单方法是神学界使用“规范”的方式，规范真理是真正的真理，所以如果两个人找到它，他们就发现了相同的真理。与规范实例相同。如果您认为您找到了其中的两个（即`a.equals(b)`），那么您实际上只有一个（即`a == b`）。因此，在规范对象的情况下，平等意味着同一性。

现在进行比较。您现在可以选择使用`a==b` **or** `a.equals(b)`，因为它们在规范实例的情况下会产生相同的答案，但 a==b 是参考的比较（JVM 可以非常快速地比较两个数字，因为它们只是比较的两个 32 位模式这`a.equals(b)`是一个方法调用，涉及更多开销。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-06-15T09:11:09.363

另一个很好的例子可能是：你有一个类支持使用笛卡尔坐标 (x, y, z)、球坐标 (r, theta, phi) 和柱坐标 (r, phi, z)。为了建立相等性（equals 方法），您可能希望将所有表示转换为您选择的一种“规范”表示，例如球坐标。（或者也许您通常希望这样做 - 即使用一种内部表示。）我不是专家，但我确实想到了这可能是一个很好的具体例子。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-02-17T20:22:14.537

规范形式意味着元素的自然唯一表示

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-09-14T03:43:55.303

规范表示意味着以不同的风格查看角色，例如，如果我写一个字母 A，则表示另一个人可能会以不同的风格写字母 A:)

这是根据光学字符识别领域

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-10-19T19:14:22.967

OP 关于*规范形式*的问题以及它如何提高`equals`方法的性能都可以通过扩展 Effective Java 中提供的示例来回答。

考虑以下类：

```
public final class CaseInsensitiveString {

  private final String s;

  public CaseInsensitiveString(String s) {
    this.s = Objects.requireNonNull(s);
  }

  @Override 
  public boolean equals(Object o) {
    return o instanceof CaseInsensitiveString && ((CaseInsensitiveString) o).s.equalsIgnoreCase(s);
  }
} 
```

此示例中的方法`equals`通过使用`String`'`equalsIgnoreCase`方法增加了成本。如文中所述

> 您可能希望存储该字段的规范形式，以便 equals 方法可以对规范形式进行廉价的精确比较，而不是成本更高的非标准比较。

Joshua Bloch 说*规范形式*时是什么意思？好吧，我认为多纳尔的简洁[回答](https://stackoverflow.com/a/280119/2860319)非常恰当。我们可以以*标准*方式存储示例中的基础`String`字段，也许是. 现在，您可以引用 的这种*规范形式*，它的大写变体，并在您的和方法中执行廉价的评估。`CaseInsensitiveString`*`String`*`CaseInsensitiveString``equals``hashcode`**

 *** * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-11-12T18:35:33.377

RDBMS 中的规范数据，图形数据；
将其视为 RDBMS 中数据的“规范化”或“规范形式”。相同的数据存在于不同的表中，用唯一的标识符表示并映射到不同的表中。
或者
考虑图形数据库中以许多三元组表示的单一形式的数据。

它的主要好处是使 Dml（数据操作）更高效，因为您只能更新（插入/更新）一个值而不是多个值。

# javascript - Dynamically growing an array of text inputs (HTML/JavaScript)

> ID：280109
> 
> 赞同：2
> 
> 时间：2008-11-11T05:38:27.697
> 
> 标签：javascript, jquery, ajax, user-interface

I'm creating a data entry app for some in-house stuff.

My team needs to enter info about "items" which can have many "categories" and vice versa.

I need a quick way to let them enter an arbitrary amount of categories.

Here's my idea:

On the item entry page, I'll have it so that initially there's one text input for "categories" and if it's tabbed out of while it's empty, the input field is deleted (unless it's the only one) and focus skips to the next field. If it's *not* empty when it's tabbed out of **and** if it's the last input field in the array, then an additional "category" text input will be added and focused.

This way people can enter an arbitrary amount of categories really quickly, without taking their hands off the keyboard, just by typing and hitting tab. Then hitting tab twice to denote the end of the list.

First of all, what do you think of this interface? Is there a better way to do it?

Second of all, is there a jQuery (or something) plugin to do this? I've searched but can't find one. I searched scriptaculous/prototype and mootools too, with no luck.

I would obviously rather use something tried and tested than roll my own.

Any and all advice appreciated

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T05:52:01.557

it's actually not too difficult to implement that, even with vanilla JS (ie: no jQuery, prototype, etc), but *everything* is easier with jQuery, so I'll have a go at it using that:

Assuming a structure like this:

```
<form id="myForm">
    <div class="inputRow">
        <input type="text" name="myInput[]" />
    </div>
    <div class="inputRow">
        <input type="text" name="myInput[]" />
    </div>
    ...
</form> 
```

Here's the JS

```
$('#myForm :text').blur(onBlurHandler);

function onBlurHandler() {
    $row = $(this).parent();
    if ($row
        .nextAll(":has(:text)")     // all following divs with a text element
        .length == 0                // but there aren't any, we're on the last one
    ) {
        if ($.trim($row.find(":text").val())) { // the text box isn't empty
            $copy = $row.clone(true);
            $copy
                .find(":text")  // get the new text box,
                .val('')        // remove any text in it
                .blur(onBlurHandler) // and add the event handler (is this necessary?)
            ;
            $copy.insertAfter($row);
        } else if ($row.prev(':has(:text)').length) {   // the text box is empty, and this one isn't the first row
            $row.remove();  // get rid of the row.
        }
    }
} 
```

* * *

**Response to comments:**

> thanks for the answer! i've tried it but it doesn't seem to work as intended. i'm on mac firefox. if i tab off the last field, it adds the new one but focuses the address bar. i tried adding: `$copy.find(":text").focus();` after the insertAfter line, but it doesn't change anything. any ideas?
> 
> also if i shift-tab the blurhandler doesn't know i'm going in the opposite direction. is there any way around that?

Hmm, I hadn't thought about that. What you could try doing is to put an element after all your text fields which can take focus (like a textbox which is rendered off-screen, eg: `margin-left: -10000px`). Add an onfocus handler onto that to see if the last row is empty, and if it is, then it would have been added just then by the onBlurHandler function, so pass the focus back to the last row. If the last row isn't empty, then pass the focus onto the next element (your submit button, probably). If there are issues with the last row not existing in the DOM yet, then put the above into a timeout.

(If this actually works) this should let your users tab backwards and forwards without hassle.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T11:49:14.127

首先，我将尝试解决有关 nickf 解决方案的评论问题。

将焦点设置在新创建的输入`$copy.find(":text").focus();`上将不起作用。jQuery 的 focus 方法只触发事件，不调用底层的 focus 方法。

您可以设置焦点`setTimeout(function(){$copy.find(":text").get(0).focus()}, 10);`但是：

*   在 Firefox 中需要 setTimeout，否则闪烁的光标会发生奇怪的事情。

*   IE7 在切换时需要另一个输入来聚焦。如果焦点转到地址栏，我还没有找到将焦点设置在输入上的方法。我想这不会有问题，因为您至少需要一个提交按钮。

为了控制 shift-tab 我一直在尝试跟踪焦点元素，以便在焦点元素是先前输入时跳过 blurHandler，但生成的代码真的很难看，所以我会发布这个并寻找更好的解决方案.

最后，您问我们对此 UI 的看法，我认为以逗号分隔的类别列表更易于编写和填写。:-)

# c# - C# 和数据隐藏

> ID：280114
> 
> 赞同：1
> 
> 时间：2008-11-11T05:42:00.873
> 
> 标签：c#, .net

一般来说，我是 C# 和 .Net 的新手，所以这可能是一个幼稚的问题。但无论如何，请考虑以下 C# 代码：

```
class A {
    public int Data {get; set;}
}

class B {
    public A Aval {get; set;}
} 
```

上面的 B.Aval 属性返回对其内部 A 对象的引用。作为一名前 C++ 程序员，我发现这很危险，因为公开对成员对象类 B 的引用违反了数据隐藏原则。尽管如此，这似乎是 C# 世界中的正常做法。

我的问题是，如果有的话，为什么这种设计是通常的方法，而不是返回内部成员的副本，这在很多方面会更安全（包括线程安全的情况）？

我知道，即使在 C++ 中，有时好的设计也要求您直接公开类成员（想到一个带有**Engine**和**Stereo对象的****Car**类），但这似乎不是 C# 中的规范。

 ***** * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T06:26:43.577

你是绝对正确的——你应该只从对象不可变的属性中返回对象，或者你很高兴调用者可以尽可能地修改它。一个典型的例子是返回集合——通常返回一个集合的只读包装器比直接返回“真实”集合要好得多。

另一方面，实用主义有时要求仅将其记录为“请不要更改返回的对象” - 特别是当它是仅在公司内部使用的 API 时。

希望在 C# 和 .NET 的未来版本中能够对不变性提供更多支持，这将使这更容易处理 - 但在许多情况下它可能仍然是一个棘手的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T06:10:17.930

这不是封装——它是通过对象组合或聚合的抽象行为，具体取决于内部对象生命周期的创建/管理方式。

在组合模式中，访问组合状态是完全可以接受的，例如在 B 的实例中访问 A 的实例。

> [http://en.wikipedia.org/wiki/Object_composition](http://en.wikipedia.org/wiki/Object_composition)

正如您所指出的，封装的语义*非常不同*- 完全隐藏 A 的内部实现，例如通过从 A 继承 B。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T06:12:16.007

这可能与得[墨忒耳定律有关](http://en.wikipedia.org/wiki/Law_of_Demeter)……您是在谈论没有额外逻辑的 getter 和 setter（因此有效地直接暴露成员），还是任何 get-set 对？无论如何，如果外部对象状态的这一部分不参与外部对象的有意义的不变量，我认为这样做不一定是不合理的。

# wpf - 如何使用代码在 WPF 中创建菜单分隔栏

> ID：280115
> 
> 赞同：33
> 
> 时间：2008-11-11T05:42:12.213
> 
> 标签：wpf, vb.net, menu

我正在使用 vb.net 以编程方式在 WPF 中创建菜单。有人可以告诉我如何在代码中将分隔栏添加到菜单中吗？请不要xaml。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-11-11T06:52:23.027

WPF 有一个[分隔符](http://msdn.microsoft.com/en-us/library/system.windows.controls.separator.aspx)控件用于此目的，当菜单项出现在工具栏上时它也会分隔您的菜单项。来自 MSDN 文档：

> Separator 控件在控件中的项目（例如 ListBox、Menu 和 ToolBar）之间绘制一条水平线或垂直线。分隔符控件不会对任何键盘、鼠标、鼠标滚轮或平板电脑输入做出反应，并且无法启用或选择。

在代码中：

```
using System.Windows.Controls;

//

Menu myMenu = new Menu();
myMenu.Items.Add(new Separator()); 
```

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2012-12-01T09:25:08.130

在xml中：

```
<Menu>
   <MenuItem Header="Menu Item 1" />
   <Separator />
   <MenuItem Header="Menu Item 1" />
<Menu> 
```

# asp.net - Dynamic Slidedown effect using jQuery reading data from a table

> ID：280124
> 
> 赞同：0
> 
> 时间：2008-11-11T05:56:35.837
> 
> 标签：asp.net, jquery

I want to list some records from the table in a ASP.NET page. For each record, I want to display some data and at the same time, provide a button for them to click. I want to show a “CLICK TO VIEW BUTTON” If they click on the button, I want to have a box slide down (using jQuery) to display the other details for the record. An example of what I am looking for can be found here.

[Sample of drop down](https://www.starwoodhotels.com/preferredguest/search/results/standard.html?localeCode=en_US&iATANumber=&city=los+angeles&stateCode=CA&countryCode=US&numberOfRooms=1&numberOfAdults=1&arrivalDate=12%2F30%2F2008&departureDate=12%2F31%2F2008)

I would prefer to have one function to handle the details. I would like the box to appear right underneath each record and not at the bottom of the page. Is there a way to do this using jQuery? I was looking at the wrap, append but was not sure on how to go about implementing this.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T14:23:07.170

将框放在您的 ASP 标记中，但将其隐藏：

```
<a href="javascript:showDetails(123);">Show details</a>
<div id="details123" style="display: none"></div> 
```

现在实现一个函数来显示/加载：

```
function showDetails(recordId) {
    var detailsDiv = $("#details" + recordId);
    // load stuff -- replace this with whatever is 
    // appropriate for your app
    $.getJSON("/myapp/someJSONfunction?recordId=" + recordId,
        null,
        // this will be run if successful
        function(data) {
            if (data.value) {
                detailsDiv.text(data.value).slideDown();
            }
        }
    });
} 
```

# c# - 如何摆脱try catch？

> ID：280127
> 
> 赞同：11
> 
> 时间：2008-11-11T06:01:54.157
> 
> 标签：c#, error-handling

我对周围的代码感到厌烦，像这样尝试捕获..

```
try
{
    //some boring stuff
}
catch(Exception ex)
{
    //something even more boring stuff
} 
```

我想要类似的东西

```
SurroundWithTryCatch(MyMethod) 
```

我知道我可以通过创建一个具有函数确切签名的委托来完成此行为，但是为我的应用程序中的所有方法创建一个委托，这不是一个选项。

我也可以通过注入 IL 代码来做到这一点，但这在性能方面很昂贵，因为它会在我的周围创建一个包装程序集。

还有其他有效的想法吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-11T06:35:57.973

首先，听起来您可能过于频繁地使用 try/catch - 特别是如果您正在使用`Exception`. try/catch 块应该是比较少见的；除非您真的可以“处理”异常，否则您应该让它冒泡到堆栈的下一层。

现在，假设您确实*想要*所有这些 try/catch 块，为什么不能选择创建委托？使用匿名方法和 lambda 表达式，以及`System`命名空间中的 Func/Action 委托，基本上几乎没有什么工作要做。你写：

```
public void SurroundWithTryCatch(Action action)
{
    try
    {
        action();
    }
    catch(Exception ex)
    {
        //something even more boring stuff
    }    
} 
```

然后你`SurroundWithTryCatch(MyMethod)`会正常工作，如果它不需要参数的话。

或者，如果您不想调用*其他*方法，只需编写：

```
public void MyMethod()
{
    SurroundWithTryCatch(() => 
    {
        // Logic here
    });
} 
```

如果您需要从该方法返回，您可以执行以下操作：

```
public int MyMethod()
{
    return SurroundWithTryCatch(() => 
    {
        // Logic here
        return 5;
    });
} 
```

`SurroundWithTryCatch`像这样的通用重载：

```
public T SurroundWithTryCatch<T>(Func<T> func)
{    
    try
    {
        return func();
    }
    catch(Exception ex)
    {
        //something even more boring stuff
    }    
} 
```

其中大部分在 C# 2 中也可以，但类型推断对您的帮助不大，您必须使用匿名方法而不是 lambda 表达式。

回到开始：尽量少用 try/catch。（try/finally 应该更频繁，尽管通常写成 using 语句。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T08:03:23.973

面向方面的编程也可以帮助您，但这可能需要您将库添加到项目中，[postsharp](http://www.postsharp.org)在这种情况下会帮助您。请参阅此链接[http://doc.postsharp.org/1.0/index.html#http://doc.postsharp.org/1.0/UserGuide/Laos/AspectKinds/OnExceptionAspect.html#idHelpTOCNode650988000](http://doc.postsharp.org/1.0/index.html#http://doc.postsharp.org/1.0/UserGuide/Laos/AspectKinds/OnExceptionAspect.html#idHelpTOCNode650988000)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T06:09:30.897

您可以尝试改用一些空值验证。我可以举一个 LINQ to SQL 的例子：

```
var user = db.Users.SingleOrDefault(u => u.Username == 3);

if (user == null)
    throw new ArgumentNullException("User", "User cannot be null.");

// "else" continue your code... 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T06:10:33.373

也许您通过不同的语法将异常处理视为错误代码？所以不要尝试/抓住。让异常向上传播。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-11T07:41:09.823

对我来说，我看起来你在要求面向方面的编程。我认为你应该看看 PostSharp。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T06:34:44.963

我不确定 C#，但在 Java 领域，您可以定义所有方法并与之交互，然后将其隐藏在代理对象下。您可以通过定义以下内容来逃避编写更多代码：

```
ExceptionCatcher.catchAll(new Runnable() {
  public void run() {
     //run delegate here
     MyMethod();
  }
}); 
```

而 catchAll() 只会调用 runnable 并在其周围包裹一个 try-catch 块。

但是，我认为您真正想要的是一种具有良好[闭包支持](http://en.wikipedia.org/wiki/Closure_(computer_science))的语言。使用闭包，做你想做的事非常容易。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T09:40:46.383

如果您使用的是 Java，就会遇到 RuntimeExceptions，这些异常意味着出现了无法恢复的问题。查一下。从这里开始：http: [//java.sun.com/docs/books/tutorial/essential/exceptions/runtime.html](http://java.sun.com/docs/books/tutorial/essential/exceptions/runtime.html)

例如，当出现问题时，Spring 的数据访问位会抛出各种 RuntimeExceptions。处理它们是可选的。

# .net - 从 .Net 使用 MySql - 许可问题

> ID：280135
> 
> 赞同：7
> 
> 时间：2008-11-11T06:10:57.117
> 
> 标签：.net, asp.net, mysql

我正在做一个项目并试图确定要使用的平台。现在，我的第一选择是使用带有 MySql 数据库的 ASP.Net MVC。我对此的担忧是 MySql 驱动程序具有 GPL 许可证。我正在为一家公司创建它，因此它不能是一个开源项目。以下是我的问题：

1.  如果我使用具有 GPL 许可证的 MySql 驱动程序，我是否必须将整个应用程序开源？
2.  有人知道任何其他具有较少限制许可证的 MySql 驱动程序吗？
3.  PostgreSql 有一个 LGPL 许可证，我认为应该没问题，但我找不到任何具有 ASP.Net 和 PostgreSql 的托管站点。有人知道提供两者的便宜托管计划（最好是 10-20 美元/月）吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T15:43:38.973

使用 MySQL 库将 GPL 您的代码库。

如果您正在为多个客户编写代码，您将有义务将源代码发布给您的系统给这些客户。根据 GPL，您没有义务向公众开放源代码，您根本无法阻止其他人这样做。

让我重复一遍，因为人们对这一点非常不清楚。GPL 要求您作为分发软件的实体，仅向您实际向其发布软件二进制文件的实体发布源代码。如果您与我有关系，并且我得到了您的软件的副本（理想情况下我已经为此补偿了您），然后弗兰克出现要求该软件，您没有义务提供（或出售，或任何东西）软件给弗兰克。这不是什么“袋子里的猫”。

弗兰克可以来找我，我可以把它给（出售、交易）给他，你不能阻止我这样做，但你没有承诺自己分发软件，也不支持弗兰克。由于我很可能从事轮胎业务，分发软件真的不是我的包，所以我不太可能将代码发布在一些公共档案上。

如果项目是针对单个客户的，他们很可能有权获得源代码，因此在这种情况下，GPL 可能不是问题。

只要您对代码拥有版权，您就可以随时更改许可证以供将来发布。因此，如果您选择以后不再使用 MySQL，您可以“取消 GPL”下一个版本并使用其他许可证，但是您不能“取消 GPL”任何已发布的软件。

对于定制的垂直软件，GPL 确实不是问题，因为大多数公司根本不从事软件分发业务，作为供应商，您没有义务实际支持任何人，除了您的实际客户，而不是他们可能拥有的任何人也给出了源代码。主要关注的是商业秘密等。

当然，大众市场软件是一个不同的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T06:36:46.490

您是否需要使用 MySQL 或 PostgreSQL 的技术/政治原因？我问的原因是在您的目标价格范围内有提供 SQL Server 数据库访问的 ASP.NET 主机。[Server Intellect](http://www.serverintellect.com)有一个 15 美元/月的计划，其中包括 250MB 的 SQL 数据库空间（注意：虽然我使用 Server Intellect 作为托管服务提供商，但我与他们没有其他关系，并且不会从您选择使用它们中获得任何好处） .

我阅读了[MySQL .NET 连接器](http://dev.mysql.com/downloads/connector/net/1.0.html)页面上的[GPL (2.0) 链接](http://www.gnu.org/licenses/old-licenses/gpl-2.0.html)，我并不完全清楚在 Web 应用程序中按原样（未修改）使用它会产生什么影响。第 2 节似乎仅在您修改驱动程序时适用……第 3 节似乎说您可以按原样使用（“分发或发布”）二进制文件，前提是您也使其（和源代码）可用。

如果你必须走 MySQL 路线，你最好咨询 GPL 专家/律师。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T06:17:13.907

我不是律师，但 MySQL 起初是一个数据库引擎。所以你不需要发布你的项目开源，因为你把数据放在上面。

如果您要更新驱动程序以满足您的需要，那么您需要将该修改置于 GPL 许可下。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T16:20:54.983

据我了解，如果您不更改、修改或更改 GPL 的库，并且您只是将它们用于它们的本来面目，那么您的代码库的其余部分将不属于 GPL。现在，如果您确实分发了应用程序，您将必须提供对库许可证的访问权限以及对您使用的库的源代码的访问权限。但其他一切都是您的，可以根据需要进行许可。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T06:21:34.570

您不能将 MySQL GPL 客户端库用于商业产品，它只能用于开源项目。[MySQL 在商业许可下以合理的费用提供相同的客户端库，您可以将其用于您的目的，您可以在此处](http://www.mysql.com/about/legal/licensing/oem/)找到有关商业许可的更多信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T15:29:18.207

@Jeff-Donnici：我绝对不排除使用 SQL Server。我倾向于 MySql 的两个原因是 1）如果它对于共享托管服务提供商来说太大了，那将是一个便宜得多的选择；2）我需要能够创建多个数据库，并且从我的看过共享主机提供商，SQL Server 仅限于 1 或 2 个数据库，而它们允许相当多的 MySql 数据库。

# c++ - 使用 C 或 C++ 制作自定义运行对话框？

> ID：280143
> 
> 赞同：1
> 
> 时间：2008-11-11T06:13:04.023
> 
> 标签：c++, c

好吧，我想在我的程序中创建一个自定义运行对话框，以便用户可以测试命令而无需自己打开它。唯一的问题是，msdn 对此没有提供任何报道。如果我无法制作自己的自定义运行对话框并将数据发送到 shell32.dll（存储运行对话框的位置），我将选择可以从按钮打开运行对话框的代码。到目前为止，我找到的唯一信息是如何使用 VBScript 打开它，我想知道如何直接在 C/C++ 中访问 shell 对象。

如果有帮助，这是 VBScript（如果您想查看，请另存为 .vbs）

```
<script language="VBScript">
    function fnShellFileRunVB()
        dim objShell

        set objShell = CreateObject("Shell.Application")
        objShell.FileRun

        set objShell = nothing
    end function
 </script> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T09:39:27.463

VBScript 的 CreateObject() 函数只是创建一个 COM 对象的实例。你可以在 C++ 中做同样的事情，你只需要先阅读[关于如何使用 C++ 访问 COM 对象的教程](http://progtutorials.tripod.com/COM.htm)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T22:55:57.667

创建一个简单的运行对话框不是什么大问题（用户界面）。用户输入的数据可以通过[ShellExecute](http://msdn.microsoft.com/en-us/library/bb762153(VS.85).aspx)运行。如果你想调用运行对话框，那么你应该使用 COM。

# ruby-on-rails - Linux 上新 Rails 部署的最佳实践？

> ID：280155
> 
> 赞同：31
> 
> 时间：2008-11-11T06:24:15.063
> 
> 标签：ruby-on-rails, ruby, linux, deployment, release-management

我用过直接的 Mongrel，我用过 Apache 后面的 Mongrel 集群，我看过 Thin，我对Passenger 很感兴趣。我也看过 Nginx。我看过 MRI、Ruby Enterprise Edition、Rubinius 和 JRuby。有很多选择，每个都声称是新的圣杯。

对于全新的、完全最新的部署，最好的选择是什么？唯一的假设是：

*   该应用程序基于 Rails 2.2。（我知道 2.2 还没有完全发布，但是这个部署也没有。）
*   服务器是基于 Linux 的。可能是 Ubuntu Hardy，但实际上，在这种情况下效果最好。
*   Rails 需要功能齐全，并且可能与 MySQL 数据库通信。
*   其他一切都可以商量。

考虑到这些特别广泛的限制，在并发性和低开销方面，哪种软件组合将产生最佳结果？

我倾向于使用“worker”mpm 和Passenger + Ruby Enterprise Edition 的Apache，仅仅是因为它提供了即时的稳定性以及设置和维护的简单性。

我可能会因为另一种选择而变得特别好？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-11T13:16:46.867

两周前我从 Mongrel Cluster 切换到了 Passenger（Debian Linux 服务器）。我一秒钟都没有回头。乘客可能是启动和运行新服务器的最简单方法。性能和可靠性也很合理。

就个人而言，我喜欢把时间花在令人兴奋的新 Rails 项目上，而不是处理部署问题——Passenger 让我能够做到这一点。但是，如果您有某种特殊要求（不适用于大多数产品），Mongrel 或其他东西可能仍然是可取的。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-13T16:08:08.217

今天早上，DHH 在他自己的博客上谈到了这个话题：

> 但不知何故，Passenger 的信息接收速度有点慢。已经有很多大型网站正在运行它。包括 Shopify、MTV、Geni、Yammer，我们很快就会移动到第一个 Ta-da List，然后希望之后很快就会完成 37signals 套件的其余部分。
> 
> 因此，尽管仍然有理由运行您自己的手动配置部件的自定义多层设置，就像有些人因为他们的细节而回避 mod_php，但我认为我们最终确定了一个默认答案。不需要您真正考虑 Rails 应用程序的第一次部署。开箱即用的东西。即使那个盒子是共享主机！

[http://www.loudthinking.com/posts/30-myth-1-rails-is-hard-to-deploy](http://www.loudthinking.com/posts/30-myth-1-rails-is-hard-to-deploy)

Tobias Lütke 关于将 Shopify（百万请求/天）切换到乘客的主题：

> 所有这一切意味着 Shopify 在正常操作期间使用的内存总量从平均 9GB 变为平均 5GB。我们将节省的成本平均分配给更多 Shopify 进程和更多 memcached 空间，这将我们的平均响应时间从 210 毫秒提高到 130 毫秒，而过去几个月的流量增长了 30%。
> 
> 总结：目前我看不出有任何理由选择不同的部署策略。它简单、完整、快速且有据可查。

[http://blog.leetsoft.com/2008/11/15/passenger](http://blog.leetsoft.com/2008/11/15/passenger)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T14:14:06.177

在过去的 18 个月里，我们一直在使用旧的标准 nginx -> mongrel 堆栈，虽然第一次设置并非易事，但它被证明是灵活的，并且已经为我们处理了一些非常高流量的站点。尤其是 Nginx 绝对坚如磐石，速度非常快，如果你可以让你的应用程序页面缓存，你就可以处理很多请求。

卡住的杂种一直是个问题，所以当它们行为不端时，我们使用 monit 杀死它们。同样，设置起来也不是一件容易的事，但此时我们已经在许多站点上使用了相同的过程。

我们还没有和乘客玩过，所以也许它更容易更稳定，我会听从其他响应者的意见，我只能说你没有理由不能用 nginx 建立一个坚实的堆栈和杂种。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-15T22:04:54.970

我们已经从 NginX+Mongrel 切换到了Passenger。

我完全相信，Passenger 将成为 Rails 的新标准，尽管 NginX 和 Mongrel 集群得到了一些非常聪明的人的认可。乘客的最新进展确实推动了它向前发展。

我们当前的配置是这样的：

**网络服务器**

*   Ubuntu 8.04 LTS
*   Apache2 上的 Phusion 乘客
*   MRI Ruby 1.8.6 和朋友 (form apt)
*   Ruby Gems 1.3.0（从源代码安装）

**数据库服务器**

*   Centos 5
*   MySQL Cluster（我们刚刚切换到这个，但它很有希望）

在对确切的 linux 发行版进行标准化之后，我们已经能够编写 Capitrano 配方来帮助部署（配置中的细微变化是许多服务中断的根源）并以其他方式简化我们的生活。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T10:31:46.810

看看[Litespeed](http://litespeedtech.com/)。您可以获得在 1 个 cpu 上运行的免费版本，也可以付费获得多 cpu。它有点贵，但坚如磐石，可以出色地处理轨道（即使用更少的内存并且监控和设置的开销更少）。我在它上面运行了大量的应用程序，它不会错过任何一个节拍。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-11T13:34:58.610

我们还从 Mongrel 切换到 mod_passenger，发现稳定性大大提高，因为需要进行设置和维护。好的选择。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-16T19:52:59.660

还有一点金子：

Josh Peek 的[Slicehost gem](http://github.com/josh/slicehost)充满了 Capistrano 食谱，这些食谱比 Deprec 更简单、更有条理。里面也没有什么特别是特定于 Slicehost 的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-11T09:00:44.653

我在 Ubuntu Hardy 上使用 Apache2 和 Passenger 托管我的新应用程序。对于大多数情况来说，这似乎是最简单和最好的选择。为此，我刚刚加入了 Slicehost.com。他们似乎得到了很好的评价，并且拥有一流主机中最具竞争力的价格。

我还不能真正认可他们，因为我是一个新客户，但是一组指南和支持选项的范围令人印象深刻。

您没有提到的是您的应用程序的规模和受欢迎程度。该标准可能会影响决策过程。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-12T02:38:53.753

Capistrano + Deprec 用于在 Ubuntu 上实际设置我的堆栈并实际管理部署。

Nginx 代理服务器架构的 Mongrel 集群。它不是最新的、最前沿的技术，但它工作得很好，它得到了很好的记录，而且即使在小型 VPS 上工作时，它的性能也非常非常高。假设你没有破坏应用程序，你可以 Slashdot 一个 128 MB Slicehost VPS 并且它只是不断回来获取更多。

话虽如此：第一次有*很多*陷阱，直到我弄清楚 Nginx 是如何工作的。在那之后它令人惊叹——就像一个带有轻微俄罗斯口音的小 Apachelet。

# c++ - 有没有办法做一个 C++ 风格的编译时断言来确定机器的字节顺序？

> ID：280162
> 
> 赞同：32
> 
> 时间：2008-11-11T06:29:58.920
> 
> 标签：c++, templates, metaprogramming, endianness

我有一些模板化的低级序列化代码，我显然需要在编译时知道系统的字节序（因为模板专门基于系统的字节序）。

现在我有一个带有一些平台定义的标题，但我宁愿通过一些模板化测试（如 static_assert 或 boost_if）做出关于字节顺序的断言。原因是我的代码需要在各种机器、许多专业供应商的机器上编译和运行，并且可能在 2008 年不存在的设备上运行，所以我真的无法猜测到那个标题年份可能需要什么在路上。由于代码库的预期寿命约为 10 年。所以我不能永远遵循代码。

希望这能说明我的情况。

那么有没有人知道可以确定字节顺序的编译时测试，而不依赖于供应商特定的定义？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-11T10:28:54.023

如果您使用的是 autoconf，则可以使用`AC_C_BIGENDIAN`宏，它可以保证正常工作（`WORDS_BIGENDIAN`默认设置定义）

或者，您可以尝试以下类似的方法（取自 autoconf）以获得可能会被优化的测试（至少，GCC 删除了另一个分支）

```
int is_big_endian()
{
    union {
        long int l;
        char c[sizeof (long int)];
    } u;

    u.l = 1;

    if (u.c[sizeof(long int)-1] == 1)
    {
        return 1;
    }
    else
        return 0;
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-11T06:38:55.843

在编译时没有可移植的方法来执行此操作，最好的选择可能是使用[Boost](http://www.boost.org/) [endian 宏](http://www.boost.org/doc/libs/1_36_0/boost/detail/endian.hpp)或模拟它们使用的方法。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-11T06:33:23.640

嗯，这是一个有趣的问题。我敢打赌，这是不可能的。我认为您必须继续使用宏，并使用`BOOST_STATIC_ASSERT(!BIG_ENDIAN);`, 或`static_assert`c++0x。我认为这是因为如果您的执行环境，endian'nes 是一个属性。但是，在编译时会考虑 static_assert。

我建议您查看新的*GNU gold* ELF 链接器的代码。它的作者 Ian Lance Taylor 使用模板在编译时选择正确的字节序，以确保在运行时获得最佳性能。他明确地实例化了所有可能的字节序，因此他仍然有模板定义和声明的单独编译（不是头文件中的所有模板）。他的代码很棒。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2019-01-14T03:37:25.723

该答案基于以下规格（为了清楚起见）：

> 语言：C++ v17，64 位
> 编译器：g++ v8（GNU 编译器集合[https://www.gnu.org/software/gcc/](https://www.gnu.org/software/gcc/)）和 MingW 8.1.0 工具链（[https://sourceforge.net/projects/mingw -w64/files/](https://sourceforge.net/projects/mingw-w64/files/) )
> 操作系统：Linux Mint & Windows

以下两行代码可用于成功检测处理器的字节顺序：

```
const uint8_t IsLittleEndian = char (0x0001); 
```

或者

```
#define IsLittleEndian char (0x0001) 
```

这两个神奇的语句宝石利用了处理器在内存中存储 16 位值的方式。

在“Little Endian”处理器上，如 Intel 和 AMD 芯片组，16 位值以某种`[low order/least significant byte][high order/most significant byte]`方式存储（括号表示内存中的一个字节）。

在“Big Endian”处理器上，如 PowerPC、Sun Sparc 和 IBM S/390 芯片组，16 位值以一种`[high order/most significant byte][low order/least significant byte]`方式存储。

例如，当我们将 16 位（两个字节）值存储`0x1234`到 C++ `uint16_t`（在 C++ v11 中定义的类型，以及后来的[https://en.cppreference.com/w/cpp/types/integer](https://en.cppreference.com/w/cpp/types/integer)）中时“Little Endian”处理器上的变量，然后查看存储该值的内存块，您将找到字节序列，`[34][12]`.

在“Big Endian 处理器”上，该`0x1234`值存储为`[12][34]`.

这是一个小演示，可帮助演示各种大小的 C++ 整数变量如何存储在大小端处理器的内存中：

```
#define __STDC_FORMAT_MACROS // Required for the MingW toolchain
#include <iostream>
#include <inttypes.h>

const uint8_t IsLittleEndian = char (0x0001);
//#define IsLittleEndian char (0x0001)

std::string CurrentEndianMsg;
std::string OppositeEndianMsg;

template <typename IntegerType>
void PrintIntegerDetails(IntegerType IntegerValue)
{
    uint16_t SizeOfIntegerValue = sizeof(IntegerValue);
    int8_t i;

    std::cout << "Integer size (in bytes): " << SizeOfIntegerValue << "\n";
    std::cout << "Integer value (Decimal): " << IntegerValue << "\n";
    std::cout << "Integer value (Hexidecimal): ";

    switch (SizeOfIntegerValue)
    {
        case 2: printf("0x%04X\n", (unsigned int) IntegerValue);
                break;
        case 4: printf("0x%08X\n", (unsigned int) IntegerValue);
                break;
        case 8: printf("0x%016" PRIX64 "\n", (uint64_t) IntegerValue);
                break;
    }

    std::cout << "Integer stored in memory in byte order:\n";
    std::cout << "        " << CurrentEndianMsg << " processor [current]: ";

    for(i = 0; i < SizeOfIntegerValue; i++)https://stackoverflow.com/qhttps://stackoverflow.com/questions/280162/is-there-a-way-to-do-a-c-style-compile-time-assertion-to-determine-machines-e/54175491#54175491uestions/280162/is-there-a-way-to-do-a-c-style-compile-time-assertion-to-determine-machines-e/54175491#54175491
    {
        printf("%02X ", (((unsigned char*) &IntegerValue)[i]));
    }

    std::cout << "\n        " << OppositeEndianMsg << " processor  [simulated]: ";

    for(i = SizeOfIntegerValue - 1; i >= 0; i--)
    {
        printf("%02X ", (((unsigned char*) &IntegerValue)[i]));
    }

    std::cout << "\n\n";
}

int main()
{
    uint16_t ValueUInt16a = 0x0001;
    uint16_t ValueUInt16b = 0x1234;
    uint32_t ValueUInt32a = 0x00000001;
    uint32_t ValueUInt32b = 0x12345678;
    uint64_t ValueUInt64a = 0x0000000000000001;
    uint64_t ValueUInt64b = 0x123456789ABCDEF0;

    std::cout << "Current processor endianness: ";

    switch (IsLittleEndian) {
        case 0: CurrentEndianMsg = "Big Endian";
                OppositeEndianMsg = "Little Endian";
                break;
        case 1: CurrentEndianMsg = "Little Endian";
                OppositeEndianMsg = "Big Endian";
                break;
    }

    std::cout << CurrentEndianMsg << "\n\n";

    PrintIntegerDetails(ValueUInt16a);
    PrintIntegerDetails(ValueUInt16b);
    PrintIntegerDetails(ValueUInt32a);
    PrintIntegerDetails(ValueUInt32b);
    PrintIntegerDetails(ValueUInt64a);
    PrintIntegerDetails(ValueUInt64b);

    return 0;
} 
```

这是我机器上演示的输出：

```
Current processor endianness: Little Endian

Integer size (in bytes): 2
Integer value (Decinal): 1
Integer value (Hexidecimal): 0x0001
Integer stored in memory in byte order:
        Little Endian processor [current]: 01 00
        Big Endian processor  [simulated]: 00 01

Integer size (in bytes): 2
Integer value (Decinal): 4660
Integer value (Hexidecimal): 0x1234
Integer stored in memory in byte order:
        Little Endian processor [current]: 34 12
        Big Endian processor  [simulated]: 12 34

Integer size (in bytes): 4
Integer value (Decinal): 1
Integer value (Hexidecimal): 0x00000001
Integer stored in memory in byte order:
        Little Endian processor [current]: 01 00 00 00
        Big Endian processor  [simulated]: 00 00 00 01

Integer size (in bytes): 4
Integer value (Decinal): 305419896
Integer value (Hexidecimal): 0x12345678
Integer stored in memory in byte order:
        Little Endian processor [current]: 78 56 34 12
        Big Endian processor  [simulated]: 12 34 56 78

Integer size (in bytes): 8
Integer value (Decinal): 1
Integer value (Hexidecimal): 0x0000000000000001
Integer stored in memory in byte order:
        Little Endian processor [current]: 01 00 00 00 00 00 00 00
        Big Endian processor  [simulated]: 00 00 00 00 00 00 00 01

Integer size (in bytes): 8
Integer value (Decinal): 13117684467463790320
Integer value (Hexidecimal): 0x123456789ABCDEF0While the process
Integer stored in memory in byte order:
        Little Endian processor [current]: F0 DE BC 9A 78 56 34 12
        Big Endian processor  [simulated]: 12 34 56 78 9A BC DE F0 
```

我在 Linux Mint 中使用 GNU C++ 工具链编写了这个演示，并且没有办法在其他风格的 C++ 中进行测试，例如 Visual Studio 或 MingW 工具链，所以我不知道在它们中编译需要什么，也不知道我现在可以访问 Windows。

但是，我的一个朋友用 MingW，64 位 (x86_64-8.1.0-release-win32-seh-rt_v6-rev0) 测试了代码，它有错误。经过一番研究，我发现我需要`#define __STDC_FORMAT_MACROS`在代码顶部添加一行，以便使用 MingW 进行编译。

现在我们可以直观地看到 16 位值是如何存储在内存中的，让我们看看如何利用它来确定处理器的字节序。

为了在可视化 16 位值在内存中的存储方式方面提供一些额外帮助，让我们看一下下面的图表：

```
16-Bit Value (Hex):  0x1234

Memory Offset:       [00] [01]
                     ---------
Memory Byte Values:  [34] [12]  <Little Endian>
                     [12] [34]  <Big Endian>

================================================

16-Bit Value (Hex):  0x0001

Memory Offset:       [00] [01]
                     ---------
Memory Byte Values:  [01] [00]  <Little Endian>
                     [00] [01]  <Big Endian> 
```

当我们使用片段将 16 位值`0x0001`转换为 char（8 位）时`char (0x0001)`，编译器使用 16 位值的第一个内存偏移量作为新值。这是另一个图表，显示了“Little Endian”和“Big Endian”处理器上发生的情况：

```
Original 16-Bit Value: 0x0001

Stored in memory as: [01][00]  <-- Little Endian
                     [00][01]  <-- Big Endian

Truncate to char:    [01][xx]  <-- Little Endian
                     [01]      Final Result
                     [00][xx]  <-- Big Endian
                     [00]      Final Result 
```

如您所见，我们可以轻松确定处理器的字节顺序。

* * *

**更新：**

我无法在“Big Endian”处理器上测试上面的演示，所以我将代码基于我在网上找到的信息。感谢 MM 指出对我来说显而易见的事情。

我已经更新了演示代码（如下所示）以正确测试字节顺序或处理器。

```
#define __STDC_FORMAT_MACROS // Required for the MingW toolchain
#include <iostream>
#include <inttypes.h>

std::string CurrentEndianMsg;
std::string OppositeEndianMsg;

template <typename IntegerType>
void PrintIntegerDetails(IntegerType IntegerValue)
{
    uint16_t SizeOfIntegerValue = sizeof(IntegerValue);
    int8_t i;

    std::cout << "Integer size (in bytes): " << SizeOfIntegerValue << "\n";
    std::cout << "Integer value (Decimal): " << IntegerValue << "\n";
    std::cout << "Integer value (Hexidecimal): ";

    switch (SizeOfIntegerValue)
    {
        case 2: printf("0x%04X\n", (unsigned int) IntegerValue);
                break;
        case 4: printf("0x%08X\n", (unsigned int) IntegerValue);
                break;
        case 8: printf("0x%016" PRIX64 "\n", (uint64_t) IntegerValue);
                break;
    }

    std::cout << "Integer stored in memory in byte order:\n";
    std::cout << "        " << CurrentEndianMsg << " processor [current]: ";

    for(i = 0; i < SizeOfIntegerValue; i++)
    {
        printf("%02X ", (((unsigned char*) &IntegerValue)[i]));
    }

    std::cout << "\n        " << OppositeEndianMsg << " processor  [simulated]: ";

    for(i = SizeOfIntegerValue - 1; i >= 0; i--)
    {
        printf("%02X ", (((unsigned char*) &IntegerValue)[i]));
    }

    std::cout << "\n\n";
}

int main()
{
    uint16_t ValueUInt16a = 0x0001;
    uint16_t ValueUInt16b = 0x1234;
    uint32_t ValueUInt32a = 0x00000001;
    uint32_t ValueUInt32b = 0x12345678;
    uint64_t ValueUInt64a = 0x0000000000000001;
    uint64_t ValueUInt64b = 0x123456789ABCDEF0;

    uint16_t EndianTestValue = 0x0001;
    uint8_t IsLittleEndian = ((unsigned char*) &EndianTestValue)[0];

    std::cout << "Current processor endianness: ";

    switch (IsLittleEndian) {
        case 0: CurrentEndianMsg = "Big Endian";
                OppositeEndianMsg = "Little Endian";
                break;
        case 1: CurrentEndianMsg = "Little Endian";
                OppositeEndianMsg = "Big Endian";
                break;
    }

    std::cout << CurrentEndianMsg << "\n\n";

    PrintIntegerDetails(ValueUInt16a);
    PrintIntegerDetails(ValueUInt16b);
    PrintIntegerDetails(ValueUInt32a);
    PrintIntegerDetails(ValueUInt32b);
    PrintIntegerDetails(ValueUInt64a);
    PrintIntegerDetails(ValueUInt64b);

    return 0;
} 
```

这个更新的演示创建了一个 16 位值`0x0001`，然后读取变量存储器中的第一个字节。如上面显示的输出所示，在“Little Endian”处理器上，该值将是 0x01。在“Big Endian”处理器上，该值为 0x00。

# windows-mobile - 在 windows mobile 上读取 INI 文件的 C++ 类

> ID：280166
> 
> 赞同：1
> 
> 时间：2008-11-11T06:35:35.180
> 
> 标签：windows-mobile, ini

有谁知道一个好的 C++ 类可以在 Windows Mobile 上读取（也可能写入）INI 文件？理想情况下，该课程应在 Windows mobile 2003、5 和 6 上工作，并且是公共领域，但其他替代方案可能会很有趣。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T06:47:24.500

请参阅此问题[如何从 INI 文件中读取配置文件条目](https://stackoverflow.com/questions/146795/how-to-read-config-file-entries-from-an-ini-file)，以及此后续[帮助改进此 INI 解析代码](https://stackoverflow.com/questions/146943/help-improve-this-ini-parsing-code)，其中我想出了如何自己进行解析。我不能说我想出的是全部和全部，但这可能是一个好的开始。

另外，这篇文章中提到[了跨平台 INI 配置文件](http://www.codeproject.com/KB/files/SimpleIni.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T03:00:14.853

尝试 CodeProject中提到的SimpleIni [http://code.jellycan.com/simpleini/ 。](http://code.jellycan.com/simpleini/)

它是 C++，单头文件，具有 MIT 许可证的模板库（即商业用途是可以的）。将其包含到您的源文件中并使用它。它是跨平台的，支持 UTF-8 和传统编码文件，并且可以读写 INI 文件，主要保留注释和结构等。最容易签出页面。

它已经存在了一段时间，并且似乎被相当多的人使用。我写了它并继续支持它。

# c# - 基于匿名类型创建泛型类实例

> ID：280172
> 
> 赞同：13
> 
> 时间：2008-11-11T06:38:24.910
> 
> 标签：c#, .net, anonymous-types

我有一个类`ReportingComponent<T>`，它有构造函数：

```
public ReportingComponent(IQueryable<T> query) {} 
```

我有针对 Northwind 数据库的 Linq 查询，

```
var query = context.Order_Details.Select(a => new 
{ 
    a.OrderID, 
    a.Product.ProductName,
    a.Order.OrderDate
}); 
```

Query 的类型为`IQueryable<a'>`，其中 a' 是匿名类型。

我想将查询传递给 ReportingComponent 以创建一个新实例。

做这个的最好方式是什么？

亲切的问候。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-11T07:27:22.410

编写一个泛型方法并使用类型推断。如果您创建一个与泛型同名的静态非泛型类，我经常发现这很有效：

```
public static class ReportingComponent
{
  public static ReportingComponent<T> CreateInstance<T> (IQueryable<T> query)
  {
    return new ReportingComponent<T>(query);
  }
} 
```

然后在您的其他代码中，您可以调用：

```
var report = ReportingComponent.CreateInstance(query); 
```

编辑：我们需要非泛型类型的原因是类型推断只发生在泛型*方法*上——即引入新类型参数的方法。我们不能把它放在泛型类型中，因为我们仍然必须能够指定泛型类型才能调用该方法，这违背了整个观点:)

我有一篇[博文](http://codeblog.jonskeet.uk/2008/08/06/making-the-most-of-generic-type-inference/)，其中包含更多细节。

# c - C Inline Functions and Memory Use

> ID：280173
> 
> 赞同：6
> 
> 时间：2008-11-11T06:38:42.320
> 
> 标签：c, inline-method

If I use inline functions, does the memory usage increase?

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-11T18:50:39.020

内联函数会影响两种内存使用情况：

**代码大小**——一般来说，内联代码会增加加载程序所使用的内存量。这是因为生成代码的多个副本会散布在您的程序周围。但是，这并不总是正确的——如果您的内联函数只使用一次，则几乎没有变化，如果内联函数非常小，您可以通过消除函数调用开销来净减少代码大小。此外，优化器可能会减小函数的大小，该优化器能够删除未在特定内联调用中使用的代码。

**堆栈使用**——如果你的内联函数有很多局部变量，那么你可能会使用更多的堆栈空间。在 C 语言中，编译器通常在函数进入时为函数分配堆栈空间。这必须足够大以容纳所有未存储在寄存器中的局部变量。如果您离线调用一个函数，则该函数的堆栈将一直使用，直到它返回，当它再次被释放时。如果您内联该函数，那么该堆栈空间将在 uber 函数的整个生命周期中一直使用。

内联不会影响堆使用，因为内联代码会发生与非内联版本相同的分配和释放。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-11T06:51:29.190

还有一点你需要考虑：

使用内联函数，编译器能够看到调用者的变量将在哪里用作被调用者的变量。编译器可以根据该知识优化出（通常这实际上是许多可以省略的汇编程序行。注意所谓的“别名问题”）冗余代码。所以你的“代码膨胀”通常不是那么大，特别是如果你有更小的函数，它甚至可以减少上面吉姆所说的膨胀。

有人提出了一个很好的观点：最好让编译器决定它是否内联有问题的函数，因为它比你更了解它生成的代码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T07:14:47.100

在一般情况下，这确实是无法回答的。

首先，您通常无法控制内联。即使您将函数标记为内联，它实际上仍然取决于编译器，它实际上会执行内联（这只是一个提示）。

编译器会尽最大努力优化代码；使用内联只是这样做的一种工具。因此内联短函数将使代码更小（因为您不需要为调用设置参数或检索返回值。但即使使用长函数，答案也不是绝对的。

如果编译器决定内联一个长函数，那么您会认为代码会变得更长。但通常情况并非如此；因为这为编译器提供了额外的机会来应用其他可能使代码更小的优化技术。如果编译器分析发现生成的代码膨胀对代码有害，则不会进行内联。

基本上，编译器会进行分析并决定最佳行动方案。

结论。别担心。编译器比你聪明，并且会做正确的事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T06:39:27.887

取决于功能。简单的单行代码可以减少内存，因为不需要设置和清理调用堆栈，也不需要进行函数调用。如果函数大于调用函数所需的开销，那么它当然会使代码膨胀。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T06:40:38.197

内联函数肯定会增加最终可执行文件（或二进制文件）的大小，因为无论您在哪里调用它们，它们都会被“复制粘贴”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T07:15:05.117

有时会发生函数分散在程序中的情况。在这种情况下，函数调用会导致程序跳转到函数的地址并在函数调用终止时返回。这会占用一些宝贵的时间。

使用内联函数可以解决上述问题。这会导致编译器直接从源代码调用代码。没有为内联函数代码创建新的内存指令集。

虽然 c++ 中的内联声明是自由的，并且在声明中定义函数时自动发生，但在 c 中它受到以下规则的限制::

1.  在 C 中，任何具有内部链接的函数都可以声明为内联，但具有外部链接的函数对内联有限制。

2.  如果在函数声明中使用了 inline 关键字，那么函数定义应该出现在同一个翻译单元中。

内联数据类型函数名称（参数）

此代码的运行速度比非内联函数快 30%，其余代码取决于处理器速度。

现在是战略部分。您可以随意使用内联函数，但请记住，内联函数的执行时间要少得多，但它们在运行时会占用很高的内存。此外，如果内联声明的代码与代码大小相比异常大，编译器始终可以选择忽略您的内联声明。

内联声明虽然破坏了求值顺序，但并不使函数内部化。该功能仍然是外部的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T06:49:10.147

在一般情况下，您的程序会变得更大（但我相信也有例外）。运行时内存消耗可能会下降，但不会下降太多。

你问来干什么？通常，你让编译器决定一个函数是否应该被内联；考虑到函数的大小和复杂性，它通常可以做出更好的调用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-11T06:57:35.697

函数调用需要多个处理器指令。

您通常需要为函数的每个参数提供一条 PUSH 指令，一条调用该函数的 CALL 指令，并且通常需要另一条在函数调用后清理堆栈的指令。

此外，函数可能会修改处理器的寄存器，因此调用函数可能需要更多指令来保留寄存器或重新加载否则仍会在寄存器中的值。

所以如果你调用的函数只有几条指令，内联它可以节省内存*并*运行得更快。

也就是说，内联适用于您的分析器告诉您应该这样做的时候。

# language-agnostic - What is the relationship between quality and user-friendliness of software?

> ID：280176
> 
> 赞同：0
> 
> 时间：2008-11-11T06:39:13.863
> 
> 标签：language-agnostic

Is user-friendliness an important aspect of the quality of software? For example most of the Microsoft products are quite user friendly, but does that necessarily imply that their quality is superior too.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T06:44:55.067

质量是对产品场景中需求完整性或功能完整性的度量。

用户友好性是功能之一，对吧？所以是的，这是质量的一部分。因此，可以说 MS Excel 的用户友好性质量很好，但它的内存管理质量不是很好，因为它变得更慢并且有时在有 100K 行时会卡住。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T08:22:24.107

用户友好性绝对是一个质量因素（ISO 9126 同意我的观点；-)。但是从 MS 示例中，我猜您的“质量”更多地是指质量因素“功能”。实际上它们没有任何关系，我知道任何组合的例子：

1.  实用性好，功能好
2.  可用性差，功能差
3.  可用性差，功能好
4.  可用性好，功能差

通常，用户倾向于将案例 4 (2) 视为 1(3)，因为如果用户经常将可用性视为功能性的话。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T06:48:03.797

没有关系。易于使用的产品并不意味着它是高质量的。

“质量”可以定义为您想要的任何含义。质量是否意味着易于使用？还是缺少错误？还是表现不错？

易用性因用户而异 - Office 功能区好用吗？取决于你问谁和他们的经验。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T06:45:23.740

用户友好性绝对是软件质量的一个重要方面，但它往往比保持稳定性（即没有软件错误）更难以捉摸。一个程序可以有一个丑陋且无法使用的用户界面，但它是完全稳定的。这样的程序在质量等级上的评分很高，IMO。

# vba - 将参数传递给 VBA 宏

> ID：280189
> 
> 赞同：2
> 
> 时间：2008-11-11T06:47:44.907
> 
> 标签：vba, parameters, visio

当我双击 Visio 形状时，我正在尝试运行宏。

我想将 shape 对象传递给 VBA 宏，以便我可以根据 Shape 对象的 id 在宏中执行某些操作。

是否可以将参数传递给 VBA 宏。如果是，请告诉我怎么做？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T07:08:03.167

当您单击一个对象时，会`Selection`发生变化。您可以在宏中使用 Selection 对象来引用当前选定的对象。

我不确定是否可以通过双击运行宏，但我的 VBA 体验并非来自 Visio。随着谷歌搜索的出现，这似乎是可能的。如果你把它作为一个按钮放在命令栏上，即使在上下文菜单中也需要更多的努力，无论如何你都将被限制为一个没有参数的 Sub 过程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T15:34:40.600

您可以将宏作为 EventDblClick 事件放在要观看的形状上。为此，您将使用 CallThis 函数 ( [http://msdn.microsoft.com/en-us/library/aa212649(office.11](http://msdn.microsoft.com/en-us/library/aa212649(office.11).aspx) ​​).aspx ) 在每次双击形状时调用您的宏。

但是，这需要您修改要查看的每个形状的 shapesheet。如果您为要观看的形状提供母版，这应该没什么大不了的，但否则您必须编写代码将事件添加到您想要观看的每个形状中（尽管您可以在添加形状时使用文档上的 Document_ShapeAdded 事件将您的事件添加到 shapesheet）

# c++ - 在 Windows 上与 USB HID 设备进行通信的最佳 USB 库是什么？

> ID：280199
> 
> 赞同：20
> 
> 时间：2008-11-11T07:00:45.880
> 
> 标签：c++, windows, usb, hid

图书馆应该；

*   易于使用，几行客户端代码就能完成很多工作
*   尽可能独立于平台。（以防将来移植到其他平台）
*   有 C++ 绑定。
*   成熟稳重

我还想通过回调收到大多数 HID 事件的通知。

我考虑了以下替代方案：

*   libhid -（不幸的是？）这是 GPL，不能在我的应用程序中使用。
*   WDK - 对我来说似乎有点低级。我不需要那种控制。
*   atusbhid - 这具有适当的抽象级别，但它与 Windows 消息传递循环紧密相关

还有其他选择吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-08-11T02:12:37.840

看看[hidapi](https://github.com/signal11/hidapi)：它是 C，它回答了 C++ 绑定问题（有效:)），是跨平台的，并且具有非常宽松的许可证。

它似乎没有回调，但是......

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-11T22:15:33.240

如果 libhid 对您有用，那么也许要做的事情是编写一个应用程序（您将使用 GPL），它使用 libhid 与设备通信，然后通过 TCP 连接提供您需要的任何内容。您的真实应用程序将通过 TCP 连接以执行其需要的操作。这显然会对性能造成巨大影响。

此应用程序实际上是 libhid 和您的应用程序之间的“垫片”。在这种情况下，垫片将出于法律而非技术原因而存在。

我不是说这是一个好主意，只是说这是一个主意。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-14T10:31:13.823

考虑自己滚动。您将完全控制界面、平台独立性级别等。即使项目是 GPL，您也可以将其用作您自己的秘诀，并作为测试平台来发现您自己的问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-14T09:37:21.937

Trace 系统的 HIDmaker 软件套件是一个选项。

优点：

*   易于使用（非常适合学习如何为 USB HID 编程）
*   以各种项目格式（Visual Studio 和[Borland](https://en.wikipedia.org/wiki/Borland)）生成工作应用程序源代码
*   为主机和设备生成稳定的示例代码（根据我的经验是稳定的）
*   高性能（如果 HID 甚至可以说首先具有高性能）

缺点：

*   仅适用于 Microsoft Windows
*   我认为使用自己的 USB 库（[ActiveX](https://en.wikipedia.org/wiki/ActiveX)）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T19:27:28.647

看看这段代码：

*[从 C# 读取和使用 FM 收音机（或任何其他 USB HID 设备）](http://geekswithblogs.net/tamir/archive/2008/12/30/read-and-use-fm-radio-or-any-other-usb-hid.aspx)*

它为您提供了一些简单的类来与 HID 设备通信。它归结为获取设备的别名（类似于 \?\HID#Vid_nnnn&Pid_nnn#...）并使用 CreateFile 打开它。您可以在 下获取设备的别名`HKML\SYSTEM\CCS\Control\DeviceClasses\{4d1e55...}\`。

Vid 和 Pid 是设备的供应商 ID 和产品 ID（检查[Device Manager](https://en.wikipedia.org/wiki/Device_Manager)）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-18T12:09:17.620

有几个适用于 Windows 的 USB HID 主机驱动程序。一个易于使用的动态链接库来自[http://embedded24.net](http://embedded24.net)。

还包括几个适用于 Visual Studio 2010（C++、C# 和 Visual Basic）的示例应用程序。

# graphics - 3D 激光扫描仪捕捉法线？

> ID：280200
> 
> 赞同：4
> 
> 时间：2008-11-11T07:01:09.607
> 
> 标签：graphics, 3d, visualization

我工作的实验室大学正在购买用于扫描 3D 物体的激光扫描仪。从一开始，我们就一直在努力寻找一种能够从实际扫描表面捕获真实 RAW 法线的扫描仪。似乎大多数扫描仪只捕获点，然后软件进行插值以找到近似表面的法线。

有人知道是否真的有捕捉原始法线之类的东西吗？是否有扫描仪可以做到这一点，而不是从点数据中插入法线？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T07:15:46.770

不大可能。激光扫描是使用范围完成的。你想要的是结合两种完全不同的技术。可以使用控制良好的照明等以更高的精度评估法线，但需要一种非常不同的设置。还要考虑采样问题：比您的位置数据分辨率更高的法线有什么用？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-09T09:46:16.090

这是一篇使用结构光从梯度重建法线的示例文章。 [二维边缘渐变的形状](http://www.springerlink.com/content/l4233403325r6538/fulltext.pdf)

我没有找到我正在寻找的确切文章，但这似乎是基于相同的原则。在对象上变形后，您可以根据条纹的角度和宽度重建法线。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-14T21:27:18.447

如果您已经知道构成 3D 对象的材料的[双向反射率分布函数](http://en.wikipedia.org/wiki/Bidirectional_reflectance_distribution_function)，则可以使用[角度反射计](http://en.wikipedia.org/wiki/Gonioreflectometer)来比较某个点的测量 BRDF。然后，您可以通过将假设的 BRDF 与实际测量值进行比较来单独优化该点的计算法线。

诚然，这将是一项计算量相当大的任务。但是，如果您很少经历这个过程，它可能是可行的。

有关更多信息，我建议您与Radiance 的[Greg](http://radsite.lbl.gov/radiance/) [Ward (Larson)](http://www.anyhere.com/gward/)或NVIDIA 的[Peter Shirley](http://psgraphics.blogspot.com)交谈。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T21:48:36.093

您可以使用结构光 + 相机设置。
法线将来自投影线与图像上的位置之间的角度。正如其他海报所指出的那样——你不能从点激光扫描仪上做到这一点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-17T04:20:16.280

捕获原始法线几乎总是使用**光度立体**。这几乎总是需要对底层反射率进行一些假设，但即使法线有些不准确，当将它们与另一个数据源结合时，您通常也可以做得很好：

将点云（例如来自激光扫描）与表面法线相结合的非常好的代码：[http ://www.cs.princeton.edu/gfx/pubs/Nehab_2005_ECP/](http://www.cs.princeton.edu/gfx/pubs/Nehab_2005_ECP/)

# asp.net - Web用户控件中的外部JS文件？

> ID：280201
> 
> 赞同：1
> 
> 时间：2008-11-11T07:01:38.140
> 
> 标签：asp.net, javascript, webusercontrol

在 html 页面中，我们使用 head 标签来添加对外部 .js 文件的引用 .. 我们还可以在 body 中包含 script 标签 .. 但是我们如何在 Web 用户控件中包含我们的外部 .js 文件？

经过一番谷歌搜索，我得到了这个。它有效，但这是唯一的方法吗？

```
ScriptManager.RegisterStartupScript(this.Page, Page.GetType(), "MyUniquekey", @"<script src=""myJsFile.js"" type=""text/javascript""></script>", false); 
```

——祖海布

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T08:29:55.543

你也可以使用

```
Page.ClientScript.RegisterClientScriptInclude("key", "path/to/script.js"); 
```

这就是我一直这样做的方式

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T09:48:15.277

> 是的，这也有效.. 但是为什么所有脚本都被倾倒在身体而不是头脑中？

[这里](http://www.codeproject.com/KB/aspnet/scriptregister.aspx)有一个潜在的解决方法

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-19T14:06:40.557

这有点不正确..关于在正文中需要 Javascript。

Javascript 函数将位于未执行的头部，并且完全不受元素仍要加载的事实的影响。

通常在页面末尾有一个调用来开始执行顶部的脚本。（其他方法可用）

The only reason that script gets dumped in the body, is because MS doesn't seem to give 2 hoots about JavaScript. Shame, because forcing us all to use .NET proper, just makes the world full of sluggish pages that needlessly run back and forth to servers for the tiniest requirmenet.

# python - 来自 jython 中已解析电子邮件对象的电子邮件正文

> ID：280207
> 
> 赞同：4
> 
> 时间：2008-11-11T07:07:09.627
> 
> 标签：python, email, jython, parsing

我有一个对象。

```
 fp = open(self.currentEmailPath, "rb")
    p = email.Parser.Parser()
    self._currentEmailParsedInstance= p.parse(fp)
    fp.close() 
```

self.currentEmailParsedInstance，从这个对象我想得到一封电子邮件的正文，只有文本没有 HTML....

我该怎么做？

* * *

像这样的东西？

```
 newmsg=self._currentEmailParsedInstance.get_payload()
        body=newmsg[0].get_content....? 
```

然后从正文中剥离 html。那是什么......返回实际文本的方法......也许我误解了你

```
 msg=self._currentEmailParsedInstance.get_payload()
        print type(msg) 
```

输出=输入“列表”

* * *

电子邮件

返回路径：
接收：来自 xx.xx.net（示例），由 mxx3.xx.net (xxx)
id 485EF65F08EDX5E12 for xxx@xx.com；2008 年 10 月 23 日星期四 06:07:51 +0200
收到：来自 xxxxx2 (ccc) by example.net (ccc)（身份验证为 xxxx.xxx@example.com）id 48798D4001146189 for example.example@example-example.com；2008 年 10 月 23 日星期四 06:07:51 +0200
发件人：“示例”
收件人：
主题：FW：示例 日期：2008 年 10 月 23 日星期四 12:07:45 +0800
组织：示例 邮件 ID：<001601c934c4$xxxx30$ a9ff460a@xxx>
MIME 版本：1.0
内容类型：多部分/混合；
boundary="----=_NextPart_000_0017_01C93507.F6F64E30"
X-Mailer：Microsoft Office Outlook 11
X-MimeOLE：由 Microsoft MimeOLE V6.00.2900.3138 生产
线程索引：Ack0wLaumqgZo1oXSBuIpUCEg/wfOAABAFEA

这是 MIME 格式的多部分消息。

------=_NextPart_000_0017_01C93507.F6F64E30
内容类型：多部分/替代；
边界="----=_NextPart_001_0018_01C93507.F6F64E30"

------=_NextPart_001_0018_01C93507.F6F64E30
内容类型：文本/纯文本；
charset="us-ascii"
内容传输编码：7bit

发件人：example.example[mailto:example@example.com]
发送时间：2008 年 10 月 23 日星期四上午 11:37
收件人：xxxx@example.com
主题：S/I 例如（提单号：
4357-0120 -810.044)

请找到附加的example.doc），

谢谢。

B.rgds,

xxxxxx

------=_NextPart_001_0018_01C93507.F6F64E30
内容类型：文本/html；
charset="us-ascii"
内容传输编码：quoted-printable

xmlns:o=3D"urn:schemas-microsoft-com:office:office" =
xmlns:w=3D"urn:schemas-microsoft-com:office:word" =
xmlns:st1=3D"urn:schemas-microsoft- com:office:smarttags" =
xmlns=3D" [http://www.w3.org/TR/REC-html40](http://www.w3.org/TR/REC-html40) ">

HTML STUFF 直到

------=_NextPart_001_0018_01C93507.F6F64E30--

------=_NextPart_000_0017_01C93507.F6F64E30
内容类型：应用程序/msword；
name="xxxx.doc"
内容传输编码：base64
内容处置：附件；
文件名="xxxx.doc"

0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAYgAAAAEAAAD+////AAAAAF8AAAD///////////////////////////////////// //// ////////////////////////////////////// //////////////////////////////////////////////////////// ///////////////////////////////////////// ////// //////////////////////////////////// ///////////////////////////////////////// ///////////////////////////////////////// ////////////////////////////////////////// ///////////////////////////////////////// ///////////////////////////////////////// ////////////////////////////////////////// ///////////////////////////////////小号pcEAI2AJBAAA + FK / AAAAAAAAEAAAAAAABgAAnEIAAA4AYmpiaqEVoRUAAAAAAAAAAAAAAAAAAAAA AAAECBYAMlAAAMN / AADDfwAAQQ4AAAAAAAAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD // w8AAAAA AAAAAAD // w8AAAAAAAAAAAD // w8AAAAAAAAAAAAAAAAAAAAAAKQAAAAAAEYEAAAAAAAARgQAAEYE AAAAAAAARgQAAAAAAABGBAAAAAAAAEYEAAAAAAAARgQAABQAAAAAAAAAAAAAAFoEAAAAAAAA4hsA AAAAAADiGwAAAAAAAOIbAAA4AAAAGhwAAHwAAACWHAAARAAAAFoEAAAAAAAABzcAAEgBAADmHAAA FgAAAPwcAAAAAAAA / BwAAAAAAAD8HAAAAAAAAPwcAAAAAAAA / BwAAAAAAAD8HAAAAAAAAPwcAAAA AAAAMjYAAAIAAAA0NgAAAAAAADQ2AAAAAAAANDYAAAAAAAA0NgAAAAAAADQ2AAAAAAAANDYAACQA AABPOAAAaAIAALc6AACOAAAAWDYAAGkAAAAAAAAAAAAAAAAAAAAAAAAARgQAAAAAAABHLAAAAAAA AAAAAAAAAAAAAAAAAAAAAAD8HAAAAAAAAPwcAAAAAAAARywAAAAAAABHLAAAAAAAAFg2AAAAAAAAAAAAAAA0NgAAAAAAADQ2AAAAAAAANDYAACQA AABPOAAAaAAAAALc6AACAAAAAWDYAAGkAAAAAAAAAAAAAAAAAAAAAAAAAAAARgQAAAAAAABHLAAAAAAA AAAAAAAAAAAAAAAAAAAAD8HAAAAAAAAPwcAAAAAAAArywAAAAAAABHLAAAAAAAAFg2AAAAAAAAAAAAAA0NgAAAAAAADQ2AAAAAAAANDYAACQA AABPOAAAaAAAAALc6AACAAAAAWDYAAGkAAAAAAAAAAAAAAAAAAAAAAAAAAAARgQAAAAAAABHLAAAAAAA AAAAAAAAAAAAAAAAAAAAD8HAAAAAAAAPwcAAAAAAAArywAAAAAAABHLAAAAAAAAFg2AAAAAAA

------=_NextPart_000_0017_01C93507.F6F64E30--

* * *

我只想得到：

发件人：xxxx.xxxx [mailto:xxxx@example.com]
发送时间：2008 年 10 月 23 日星期四上午 11:37
收件人：xxxx@example.com
主题：xxxx 的 S/I（提单编号：
4357-0120 -810.044)

请查找附件 xxxx.doc),

谢谢。

B.rgds,

xxxxxx

* * *

不确定邮件是否格式错误！似乎如果你得到一个 html 页面，你必须这样做：

```
 parts=self._currentEmailParsedInstance.get_payload()
        print parts[0].get_content_type()
        ..._multipart/alternative_
        textParts=parts[0].get_payload()
        print textParts[0].get_content_type()
        ..._text/plain_
        body=textParts[0].get_payload()
        print body
        ...get the text without a problem!! 
```

非常感谢文科。

所以它有点像处理xml，本质上是递归的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T07:27:54.153

这将为您提供消息的内容

```
self.currentEmailParsedInstance.get_payload() 
```

至于仅文本部分，您必须自己剥离 HTML，例如使用 BeautifulSoup。

查看[此链接](http://www.python.org/doc/2.2.3/lib/module-email.Message.html)以获取有关 Parser 返回的 Message 类的更多信息。如果您的意思是获取包含自身 HTML 和纯文本版本的消息的文本部分，您可以指定 get_payload() 的索引来获取您想要的部分。

我尝试使用不同的 MIME 电子邮件，因为您粘贴的内容似乎格式不正确，希望在您编辑时它格式不正确。

```
>>> parser = email.parser.Parser()
>>> message = parser.parse(open('/home/vinko/jlm.txt','r'))
>>> message.is_multipart()
True
>>> parts = message.get_payload()
>>> len(parts)
2
>>> parts[0].get_content_type()
'text/plain'
>>> parts[1].get_content_type()
'message/rfc822'
>>> parts[0].get_payload()
'Message Text' 
```

部分将包含多部分消息的所有部分，例如，您可以检查它们的内容类型并仅获取文本/纯文本。

祝你好运。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T10:42:45.243

结束了这个

```
 parser = email.parser.Parser()
        self._email = parser.parse(open('/home/vinko/jlm.txt','r'))
        parts=self._email.get_payload()
        check=parts[0].get_content_type()
        if check == "text/plain":
            return parts[0].get_payload()
        elif check == "multipart/alternative":
            part=parts[0].get_payload()
            if part[0].get_content_type() == "text/plain":
                return part[0].get_payload()
            else:
                return "cannot obtain the body of the email"
        else:
            return "cannot obtain the body of the email" 
```

# c++ - 使用boost库在vc6中创建多线程应用程序？

> ID：280209
> 
> 赞同：2
> 
> 时间：2008-11-11T07:08:26.253
> 
> 标签：c++, visual-c++-6, boost-thread

是否可以使用 boost 库在 VC6 中创建多线程应用程序？如果可能的话，有哪些相关的教程。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T07:27:16.137

是的，我已经成功地做到了，但是使用 Boost v1.30.0。因此，如果您在使用最新版本的 Boost 库时遇到问题，您可能需要回溯一到五年。我记得我开始收到各种内部编译器错误，*等等。*，在尝试升级 Boost 时——所以我没有，而是继续使用 v1.30.0，直到我也能够升级 Visual C++。即使是旧版本的 Boost 也非常稳定和有用，只是功能较少。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T07:12:18.617

[http://www.boost.org/doc/libs/1_37_0/doc/html/thread.html](http://www.boost.org/doc/libs/1_37_0/doc/html/thread.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T07:18:20.850

“增强线程示例”的快速 google 出现了很多不错的结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T10:05:24.507

Boost.Thread 库提供了广告创建和操作工具。阅读 boost 文档（链接在 litb 的回答中提供）。它还提供同步对象（互斥体）。Boost 是跨平台的，并且与 VS6 兼容。

至于其余的 boost 库——它们通常是线程安全的，但请阅读每个特定库的详细文档。

# html - 从 .res 文件加载 HTML

> ID：280211
> 
> 赞同：0
> 
> 时间：2008-11-11T07:08:49.793
> 
> 标签：html, vb6, resources

使用 VS2005/2008 作为资源编辑器，“添加资源”对话框中的选项之一是 HTML：它似乎允许我将 HTML 文件嵌入到资源 (res) 文件中。有谁知道如何从 VB6 代码中获取 HTML（作为字符串）？LoadResData[似乎](http://msdn.microsoft.com/en-us/library/aa244129(VS.60).aspx)接近我正在寻找的内容，但问题是格式表中没有定义 HTML 格式（在该文档链接中）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T07:39:02.447

在 Win32 C 标头中，定义了一个名为 RT_HTML 的资源格式常量，它的值为 23。应该可以加载 HTML 资源类型。[此外，您可以通过使用Resource Hacker](http://angusj.com/resourcehacker/)查看构建的 exe 文件来验证资源类型编号。它列出了文件中嵌入的资源格式类型和资源 ID。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T07:45:24.230

这是一个很好的 c++ 教程[http://www.rohitab.com/discuss/index.php?showtopic=15281](http://www.rohitab.com/discuss/index.php?showtopic=15281) 您可以调整代码（通常函数名称与 win32 例程相同，在 msdn.microsoft.com 上搜索文档）或在网站上搜索 VB 示例

# apache-flex - 从哪里开始学习 Flex 和 Flash

> ID：280216
> 
> 赞同：3
> 
> 时间：2008-11-11T07:13:22.453
> 
> 标签：apache-flex, flash, actionscript, mxml

我想开始开发[Flash](http://en.wikipedia.org/wiki/Adobe_Flash)和[Flex](http://en.wikipedia.org/wiki/Adobe_Flex)应用程序，这样我就可以将脑海中浮现的所有概念付诸实践。问题是我从来没有做过任何编程，也没有处理过代码……从来没有。我曾在平面设计行业工作过，Flash 中的许多故事板功能对我来说都很直观。此外，我通过 Adob​​e 网站浏览了一些关于 Flex 的教程，虽然我掌握了这些概念并且可以完成作业，但我并没有完全理解这门语言（虽然只有一周）。

我的问题是：我是否应该继续学习 Flex 教程并按照自己的方式学习[MXML](http://en.wikipedia.org/wiki/MXML)和[ActionScript](http://en.wikipedia.org/wiki/ActionScript)？还是我应该先学习不同的基础语言？我在我的生活中学习了几种语言（西班牙语、法语、意大利语），并且在我加入这些语言之前，我并没有真正理解这种语言，去了这个国家，只是挣扎着通过它。MXML 和 ActionScript 是否一样？我应该努力克服它吗？还是我首先需要一个基地？如果我需要一个基地，你有什么建议？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T07:58:05.543

这取决于你想去哪里。

如果您的目标是制作类似于“应用程序”的内容——即按钮、下拉菜单、选项卡和手风琴框架等，那么您可能应该继续学习 Flex 教程。Flex 是一个框架，请记住 - 如果您想做的事情与它保持一致，它将为您省去更多坚韧不拔的细节。

如果你想制作更具表现力的内容——游戏、独特的菜单、高度互动的体验等，那么学习 Flex 可能会是一个偏题。您最好关注 ActionScript 本身。

由于您是从零开始，您还应该考虑计划走多远。如果您希望最终能够处理复杂的、大量脚本驱动的内容，那么您最好学习 ActionScript 3 并假装 AS2 不存在。但是，如果您需要学习“足够”的脚本来完成工作，但您不打算嫁给它，那么您可能更愿意做相反的事情。AS2 更加临时，而且不那么严格。正如他们所说，它有更多的whippituppitude。但对于复杂的工作，AS3 要好得多。

至于学习其他语言，我想说的不多。AS2 与 JavaScript 非常相似，AS3 与 Java 非常相似，但是如果您将脚本与创作工具一起学习，您将更好地理解如何制作好的 Flash 内容，并且您将更能深入了解 Flash 的内部结构以及随之而来的可能性和限制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T07:44:38.537

如果您想学习类似于 ActionScript 的东西，JavaScript 是一门很好的语言，但如果您真的对使用 Flex 和 Flash 感兴趣，那么您不妨深入研究一下。

随着您获得更多经验，您会发现您还能够阅读其他语言的代码，并从最流行语言的核心概念示例中学习。就像口语一样，规则非常一致，语法和词汇只是变化。

我一直发现通过一种语言工作并在遇到具体问题时进行研究可以使过程更快，而且我倾向于更好地记住我努力过的事情。

# python - Python - 对嵌套列表的列表进行排序

> ID：280222
> 
> 赞同：13
> 
> 时间：2008-11-11T07:15:56.113
> 
> 标签：python, list, sorting, nested-lists

我有一个由嵌套列表组成的输入，如下所示：

```
l = [[[[[39]]]], [1, 2, 3], [4, [5, 3], 1], [[[[8, 9], 10], 11], 12]] 
```

我想根据嵌套列表中所有数字的总和对这个列表进行排序......所以，我想要排序的值 l 看起来像这样：

```
[39, 6, 13, 50] 
```

然后我想根据这些进行排序。所以输出应该是：

```
[[1, 2, 3], [4, [5, 3], 1], [[[[39]]]], [[[[8, 9], 10], 11], 12]] 
```

这样做的好pythonic方式是什么？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-11T13:26:37.940

使用最近添加的python语法对迄今为止提供的答案进行了轻微的简化和概括：

```
>>> l = [[[[[39]]]], [1, 2, 3], [4, [5, 3], 1], [[[[8, 9], 10], 11], 12]]
>>> def asum(t): return sum(map(asum, t)) if hasattr(t, '__iter__') else t
...
>>> sorted(l, key=asum)
[[1, 2, 3], [4, [5, 3], 1], [[[[39]]]], [[[[8, 9], 10], 11], 12]] 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-11T07:19:20.130

一个小的递归函数就可以做到：

```
def asum(a):
    if isinstance(a, list):
        return sum(asum(x) for x in a)
    else:
        return a

l = [[[[[39]]]], [1, 2, 3], [4, [5, 3], 1], [[[[8, 9], 10], 11], 12]]
l.sort(key=asum)
print l 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-11T07:18:02.817

```
l.sort(key=sum_nested) 
```

在哪里`sum_nested()`：

```
def sum_nested(astruct):
    try: return sum(map(sum_nested, astruct))
    except TypeError:
        return astruct

assert sum_nested([[([8, 9], 10), 11], 12]) == 50 
```

# asp.net - 我想使用 Javascript 将项目添加到 ASP.Net 组合框

> ID：280229
> 
> 赞同：1
> 
> 时间：2008-11-11T07:21:58.567
> 
> 标签：asp.net, javascript

我想使用 Javascript 将项目添加到 ASP.Net 组合框。我可以检索 ID（无母版页）。如何从 Javascript 向组合框添加值？我现在的代码看起来像这样。

```
 //Fill the years (counting 100 from the first)
    function fillvarYear() {
        var dt = $('#txtBDate').val();
        dt = dt.toString().substring(6);

        var ye = parseInt(dt);

        //Loop and add the next 100 years from the birth year to the combo
        for (var j = 1; j <= 100; j++) {
            ye += 1; //Add one year to the year count

            var opt = document.createElement("OPTION");
            opt.text = ye;
            opt.value = ye;
            document.form1.ddlYear.add(opt);
        }
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T08:25:12.480

永远记住，ASP.NET 控件并不是什么“花哨”的东西——它们总是最终会成为标准的 HTML 元素。

试试看看[这个网站](http://www.mredkj.com/tutorials/tutorial005.html)。它有一个非常好的演示和概述。但是请注意，您正在**更改客户端的数据 - 这意味着您需要对每个请求都执行此操作，因为 ViewState 不会更新。**

TBH，你可能最好只使用 HTML 控件而不是 ASP ComboBox..

我能问一下您为什么要通过 Javascript 更改项目吗？（出于好奇）:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T10:23:37.827

要查看回发的值：

```
string selectedValue = Request.Params[combobox.UniqueId] 
```

请记住，使用 javascript 更改组合框中的值将导致引发事件验证异常，这通常是一个坏主意，因为您必须明确禁用事件验证。

我建议将组合框放在更新面板中，这样您就可以在服务器上读取 txtBirthDate 并生成适当的数据。然后，您也不必手动保留状态。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T07:28:48.647

我找到了一个可能的解决方案。我不知道为什么早期的代码对我不起作用，但是下面的行

document.form1.ddlYear.appendChild(new Option(ye, ye));

# asp.net-mvc - 带有实体框架的 ASP.NET MVC

> ID：280239
> 
> 赞同：6
> 
> 时间：2008-11-11T07:28:12.143
> 
> 标签：asp.net-mvc, entity-framework

我认为在 Application_BeginRequest 中设置实体对象上下文，将其存储在 Request.items 中，在整个请求中使用它并在 Application_EndRequest 中处理它是明智的。这样上下文总是可用的，我可以在我的视图中导航实体框架对象图，延迟加载我还没有急切获取的内容。

我认为这会让它像在[Ruby on Rails 上](http://en.wikipedia.org/wiki/Ruby_on_Rails)开发一样。

也许我应该因为说出这种异端邪说而被枪杀，但这太疯狂了，它可能会起作用:)

我无法让 Application_BeginRequest 和 ..EndRequest 在[ASP.NET MVC](http://en.wikipedia.org/wiki/ASP.NET_MVC_Framework)上触发。他们不是被解雇了吗？我需要做什么特别的技巧吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T07:38:32.403

EF 中的对象上下文，就像 L2S 中的数据上下文一样，被设计为“工作单元”，它们不是线程安全的，并且它们的设计目的不是为了长期存在。

在 MVC 中，最好的策略是在控制器的构造函数中创建一个（隐式或显式，无关紧要），然后在 Dispose 方法中释放它。当然，EF 不做延迟加载，所以你必须找到自己的懒惰方式。:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-30T19:50:27.227

ASP.NET MVC 的 1.0 版本让我可以在 beginrequest 和 endrequest 上连接事件处理程序，新建一个 SessionScope 并将其存储在 beginrequest 的 HttpContext.Items 中（我切换到 Castle ActiveRecord），在 endrequest 中我从 HttpContext 中选择 sessionscope .Items 并处理它。这可以在整个请求生命周期中实现延迟加载。（甚至可以在视图中导航对象图。）

# python - Python 链表

> ID：280243
> 
> 赞同：186
> 
> 时间：2008-11-11T07:31:21.213
> 
> 标签：python, linked-list

在 python 中使用链表最简单的方法是什么？在方案中，链表由 简单定义`'(1 2 3 4 5)`。Python 的列表`[1, 2, 3, 4, 5]`和元组`(1, 2, 3, 4, 5)`实际上不是链表，链表有一些很好的属性，例如常量时间连接，并且能够引用它们的不同部分。使它们不可变，它们真的很容易使用！

* * *

## 回答 #1

> 赞同：160
> 
> 时间：2008-11-11T21:45:30.850

对于某些需要，[双端队列](https://docs.python.org/library/collections.html#collections.deque)也可能有用。您可以以 O(1) 的成本在双端队列的两端添加和删除项目。

```
from collections import deque
d = deque([1,2,3,4])

print d
for x in d:
    print x
print d.pop(), d 
```

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2008-11-11T07:54:49.060

我前几天写的

```
#! /usr/bin/env python

class Node(object):
    def __init__(self):
        self.data = None # contains the data
        self.next = None # contains the reference to the next node

class LinkedList:
    def __init__(self):
        self.cur_node = None

    def add_node(self, data):
        new_node = Node() # create a new node
        new_node.data = data
        new_node.next = self.cur_node # link the new node to the 'previous' node.
        self.cur_node = new_node #  set the current node to the new one.

    def list_print(self):
        node = self.cur_node # cant point to ll!
        while node:
            print node.data
            node = node.next

ll = LinkedList()
ll.add_node(1)
ll.add_node(2)
ll.add_node(3)

ll.list_print() 
```

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2008-11-12T11:10:15.687

以下是一些基于[Martin v. Löwis 表示的](https://stackoverflow.com/questions/280243/python-linked-list#280284)列表函数：

```
cons   = lambda el, lst: (el, lst)
mklist = lambda *args: reduce(lambda lst, el: cons(el, lst), reversed(args), None)
car = lambda lst: lst[0] if lst else lst
cdr = lambda lst: lst[1] if lst else lst
nth = lambda n, lst: nth(n-1, cdr(lst)) if n > 0 else car(lst)
length  = lambda lst, count=0: length(cdr(lst), count+1) if lst else count
begin   = lambda *args: args[-1]
display = lambda lst: begin(w("%s " % car(lst)), display(cdr(lst))) if lst else w("nil\n") 
```

在哪里`w = sys.stdout.write`

虽然双链表在 Raymond Hettinger 的[有序集合配方](http://code.activestate.com/recipes/576694-orderedset/)中使用得很有名，但单链表在 Python 中没有实际价值。

除了教育之外，我*从未*在 Python 中使用单链表来解决任何问题。

Thomas Watnedal[提出](https://stackoverflow.com/questions/280243/python-linked-list#280280)了一个很好的教育资源[How to Think Like a Computer Scientist，第 17 章：链接列表](http://greenteapress.com/thinkpython/html/chap17.html)：

链表是：

*   空列表，由 None 表示，或
*   一个包含货物对象和对链表的引用的节点。

    ```
    class Node: 
      def __init__(self, cargo=None, next=None): 
        self.car = cargo 
        self.cdr = next    
      def __str__(self): 
        return str(self.car)

    def display(lst):
      if lst:
        w("%s " % lst)
        display(lst.cdr)
      else:
        w("nil\n") 
    ```

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2010-08-21T16:04:51.867

接受的答案相当复杂。这是一个更标准的设计：

```
L = LinkedList()
L.insert(1)
L.insert(1)
L.insert(2)
L.insert(4)
print L
L.clear()
print L 
```

它是一个简单的`LinkedList`类，基于直接的 C++ 设计和[第 17 章：链表](http://greenteapress.com/thinkpython/html/chap17.html)，由[Thomas Watnedal](https://stackoverflow.com/questions/280243/python-linked-list/280280#280280)推荐。

```
class Node:
    def __init__(self, value = None, next = None):
        self.value = value
        self.next = next

    def __str__(self):
        return 'Node ['+str(self.value)+']'

class LinkedList:
    def __init__(self):
        self.first = None
        self.last = None

    def insert(self, x):
        if self.first == None:
            self.first = Node(x, None)
            self.last = self.first
        elif self.last == self.first:
            self.last = Node(x, None)
            self.first.next = self.last
        else:
            current = Node(x, None)
            self.last.next = current
            self.last = current

    def __str__(self):
        if self.first != None:
            current = self.first
            out = 'LinkedList [\n' +str(current.value) +'\n'
            while current.next != None:
                current = current.next
                out += str(current.value) + '\n'
            return out + ']'
        return 'LinkedList []'

    def clear(self):
        self.__init__() 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2008-11-11T07:54:20.887

不可变列表最好通过二元组表示，None 表示 NIL。要允许简单地制定此类列表，您可以使用此功能：

```
def mklist(*args):
    result = None
    for element in reversed(args):
        result = (element, result)
    return result 
```

要使用这样的列表，我宁愿提供 LISP 函数的整个集合（即 first、second、nth 等），而不是引入方法。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-11-11T15:59:46.617

这是一个稍微复杂的链表类版本，具有与 python 的序列类型类似的接口（即支持索引、切片、与任意序列的连接等）。它应该有 O(1) 前置，除非需要并且可以与元组互换使用，否则不会复制数据。

它不会像 lisp cons 单元那样节省空间或时间，因为 python 类显然更重量级（你可以用 " `__slots__ = '_head','_tail'`" 稍微改进一下以减少内存使用）。然而，它将具有所需的大 O 性能特征。

使用示例：

```
>>> l = LinkedList([1,2,3,4])
>>> l
LinkedList([1, 2, 3, 4])
>>> l.head, l.tail
(1, LinkedList([2, 3, 4]))

# Prepending is O(1) and can be done with:
LinkedList.cons(0, l)
LinkedList([0, 1, 2, 3, 4])
# Or prepending arbitrary sequences (Still no copy of l performed):
[-1,0] + l
LinkedList([-1, 0, 1, 2, 3, 4])

# Normal list indexing and slice operations can be performed.
# Again, no copy is made unless needed.
>>> l[1], l[-1], l[2:]
(2, 4, LinkedList([3, 4]))
>>> assert l[2:] is l.next.next

# For cases where the slice stops before the end, or uses a
# non-contiguous range, we do need to create a copy.  However
# this should be transparent to the user.
>>> LinkedList(range(100))[-10::2]
LinkedList([90, 92, 94, 96, 98]) 
```

执行：

```
import itertools

class LinkedList(object):
    """Immutable linked list class."""

    def __new__(cls, l=[]):
        if isinstance(l, LinkedList): return l # Immutable, so no copy needed.
        i = iter(l)
        try:
            head = i.next()
        except StopIteration:
            return cls.EmptyList   # Return empty list singleton.

        tail = LinkedList(i)

        obj = super(LinkedList, cls).__new__(cls)
        obj._head = head
        obj._tail = tail
        return obj

    @classmethod
    def cons(cls, head, tail):
        ll =  cls([head])
        if not isinstance(tail, cls):
            tail = cls(tail)
        ll._tail = tail
        return ll

    # head and tail are not modifiable
    @property  
    def head(self): return self._head

    @property
    def tail(self): return self._tail

    def __nonzero__(self): return True

    def __len__(self):
        return sum(1 for _ in self)

    def __add__(self, other):
        other = LinkedList(other)

        if not self: return other   # () + l = l
        start=l = LinkedList(iter(self))  # Create copy, as we'll mutate

        while l:
            if not l._tail: # Last element?
                l._tail = other
                break
            l = l._tail
        return start

    def __radd__(self, other):
        return LinkedList(other) + self

    def __iter__(self):
        x=self
        while x:
            yield x.head
            x=x.tail

    def __getitem__(self, idx):
        """Get item at specified index"""
        if isinstance(idx, slice):
            # Special case: Avoid constructing a new list, or performing O(n) length 
            # calculation for slices like l[3:].  Since we're immutable, just return
            # the appropriate node. This becomes O(start) rather than O(n).
            # We can't do this for  more complicated slices however (eg [l:4]
            start = idx.start or 0
            if (start >= 0) and (idx.stop is None) and (idx.step is None or idx.step == 1):
                no_copy_needed=True
            else:
                length = len(self)  # Need to calc length.
                start, stop, step = idx.indices(length)
                no_copy_needed = (stop == length) and (step == 1)

            if no_copy_needed:
                l = self
                for i in range(start): 
                    if not l: break # End of list.
                    l=l.tail
                return l
            else:
                # We need to construct a new list.
                if step < 1:  # Need to instantiate list to deal with -ve step
                    return LinkedList(list(self)[start:stop:step])
                else:
                    return LinkedList(itertools.islice(iter(self), start, stop, step))
        else:       
            # Non-slice index.
            if idx < 0: idx = len(self)+idx
            if not self: raise IndexError("list index out of range")
            if idx == 0: return self.head
            return self.tail[idx-1]

    def __mul__(self, n):
        if n <= 0: return Nil
        l=self
        for i in range(n-1): l += self
        return l
    def __rmul__(self, n): return self * n

    # Ideally we should compute the has ourselves rather than construct
    # a temporary tuple as below.  I haven't impemented this here
    def __hash__(self): return hash(tuple(self))

    def __eq__(self, other): return self._cmp(other) == 0
    def __ne__(self, other): return not self == other
    def __lt__(self, other): return self._cmp(other) < 0
    def __gt__(self, other): return self._cmp(other) > 0
    def __le__(self, other): return self._cmp(other) <= 0
    def __ge__(self, other): return self._cmp(other) >= 0

    def _cmp(self, other):
        """Acts as cmp(): -1 for self<other, 0 for equal, 1 for greater"""
        if not isinstance(other, LinkedList):
            return cmp(LinkedList,type(other))  # Arbitrary ordering.

        A, B = iter(self), iter(other)
        for a,b in itertools.izip(A,B):
           if a<b: return -1
           elif a > b: return 1

        try:
            A.next()
            return 1  # a has more items.
        except StopIteration: pass

        try:
            B.next()
            return -1  # b has more items.
        except StopIteration: pass

        return 0  # Lists are equal

    def __repr__(self):
        return "LinkedList([%s])" % ', '.join(map(repr,self))

class EmptyList(LinkedList):
    """A singleton representing an empty list."""
    def __new__(cls):
        return object.__new__(cls)

    def __iter__(self): return iter([])
    def __nonzero__(self): return False

    @property
    def head(self): raise IndexError("End of list")

    @property
    def tail(self): raise IndexError("End of list")

# Create EmptyList singleton
LinkedList.EmptyList = EmptyList()
del EmptyList 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2017-03-24T06:44:28.517

# llist — Python 的链表数据类型

llist 模块实现链表数据结构。它支持双向链表，即`dllist`单链数据结构`sllist`。

## dlllist 对象

该对象表示一个双向链表数据结构。

### `first`

列表中的第一个`dllistnode`对象。`None`如果列表为空。

### `last`

列表中的最后一个`dllistnode`对象。如果列表为空，则无。

dllist 对象还支持以下方法：

### `append(x)`

添加`x`到列表的右侧并返回插入的`dllistnode`。

### `appendleft(x)`

添加`x`到列表的左侧并返回插入的`dllistnode`。

### `appendright(x)`

添加`x`到列表的右侧并返回插入的`dllistnode`。

### `clear()`

从列表中删除所有节点。

### `extend(iterable)`

将元素从`iterable`列表的右侧追加。

### `extendleft(iterable)`

将元素从`iterable`列表的左侧追加。

### `extendright(iterable)`

将元素从`iterable`列表的右侧追加。

### `insert(x[, before])`

如果未指定，则添加`x`到列表的右侧，或者插入到 的左侧。返回插入。`before``x``dllistnode before``dllistnode`

### `nodeat(index)`

在 处返回节点（类型为`dllistnode`）`index`。

### `pop()`

从列表的右侧移除并返回一个元素的值。

### `popleft()`

从列表的左侧移除并返回元素的值。

### `popright()`

从列表的右侧移除并返回一个元素的值

### `remove(node)`

从列表中删除`node`并返回存储在其中的元素。

## `dllistnode`对象

### 班级`llist.dllistnode([value])`

返回一个新的双向链表节点，用 . 初始化（可选）`value`。

### `dllistnode`对象提供以下属性：

### `next`

列表中的下一个节点。该属性是只读的。

### `prev`

列表中的上一个节点。该属性是只读的。

### `value`

存储在此节点中的值。 [从这个参考编译](https://pythonhosted.org/llist/)

# 列表

类`llist.sllist([iterable])` 返回一个新的单链表，它使用来自 的元素进行初始化`iterable`。如果未指定 iterable，则 new`sllist`为空。

为此`sllist`对象定义了一组类似的属性和操作。[有关详细信息，请参阅此参考。](https://pythonhosted.org/llist/#llist.sllist)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2017-02-01T10:17:18.797

```
class Node(object):
    def __init__(self, data=None, next=None):
        self.data = data
        self.next = next

    def setData(self, data):
        self.data = data
        return self.data

    def setNext(self, next):
        self.next = next

    def getNext(self):
        return self.next

    def hasNext(self):
        return self.next != None

class singleLinkList(object):

    def __init__(self):
        self.head = None

    def isEmpty(self):
        return self.head == None

    def insertAtBeginning(self, data):
        newNode = Node()
        newNode.setData(data)

        if self.listLength() == 0:
            self.head = newNode
        else:
            newNode.setNext(self.head)
            self.head = newNode

    def insertAtEnd(self, data):
        newNode = Node()
        newNode.setData(data)

        current = self.head

        while current.getNext() != None:
            current = current.getNext()

        current.setNext(newNode)

    def listLength(self):
        current = self.head
        count = 0

        while current != None:
            count += 1
            current = current.getNext()
        return count

    def print_llist(self):
        current = self.head
        print("List Start.")
        while current != None:
            print(current.getData())
            current = current.getNext()

        print("List End.")

if __name__ == '__main__':
    ll = singleLinkList()
    ll.insertAtBeginning(55)
    ll.insertAtEnd(56)
    ll.print_llist()
    print(ll.listLength()) 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-07-12T01:37:41.017

我将此附加功能基于[Nick Stinemates](https://stackoverflow.com/users/4960/nick-stinemates)

```
def add_node_at_end(self, data):
    new_node = Node()
    node = self.curr_node
    while node:
        if node.next == None:
            node.next = new_node
            new_node.next = None
            new_node.data = data
        node = node.next 
```

他在开头添加新节点的方法，而我已经看到了很多通常在末尾添加新节点的实现，但无论如何，这样做很有趣。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-03-03T05:03:45.403

以下是我想出的。它类似于[Riccardo C.'s](https://stackoverflow.com/a/280286/176611)，在这个线程中，除了它按顺序而不是反向打印数字。我还将 LinkedList 对象设为 Python 迭代器，以便像打印普通 Python 列表一样打印列表。

```
class Node:

    def __init__(self, data=None):
        self.data = data
        self.next = None

    def __str__(self):
        return str(self.data)

class LinkedList:

    def __init__(self):
        self.head = None
        self.curr = None
        self.tail = None

    def __iter__(self):
        return self

    def next(self):
        if self.head and not self.curr:
            self.curr = self.head
            return self.curr
        elif self.curr.next:
            self.curr = self.curr.next
            return self.curr
        else:
            raise StopIteration

    def append(self, data):
        n = Node(data)
        if not self.head:
            self.head = n
            self.tail = n
        else:
            self.tail.next = n
            self.tail = self.tail.next

# Add 5 nodes
ll = LinkedList()
for i in range(1, 6):
    ll.append(i)

# print out the list
for n in ll:
    print n

"""
Example output:
$ python linked_list.py
1
2
3
4
5
""" 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-09-25T15:11:25.647

我只是[把它](https://github.com/tlevine/cons.py/blob/master/cons.py)当作一个有趣的玩具。只要你不接触下划线前缀的方法，它就应该是不可变的，并且它实现了一堆 Python 魔法，比如索引和`len`.

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2017-08-09T18:58:11.297

这是我的解决方案：

**执行**

```
class Node:
  def __init__(self, initdata):
    self.data = initdata
    self.next = None

  def get_data(self):
    return self.data

  def set_data(self, data):
    self.data = data

  def get_next(self):
    return self.next

  def set_next(self, node):
    self.next = node

# ------------------------ Link List class ------------------------------- #
class LinkList:

  def __init__(self):
    self.head = None

  def is_empty(self):
    return self.head == None

  def traversal(self, data=None):
    node = self.head
    index = 0
    found = False
    while node is not None and not found:
      if node.get_data() == data:
        found = True
      else:
        node = node.get_next()
        index += 1
    return (node, index)

  def size(self):
    _, count = self.traversal(None)
    return count

  def search(self, data):
    node, _ = self.traversal(data)
    return node

  def add(self, data):
    node = Node(data)
    node.set_next(self.head)
    self.head = node

  def remove(self, data):
    previous_node = None
    current_node = self.head
    found = False
    while current_node is not None and not found:
      if current_node.get_data() == data:
        found = True
        if previous_node:
          previous_node.set_next(current_node.get_next())
        else:
          self.head = current_node
      else:
        previous_node = current_node
        current_node = current_node.get_next()
    return found 
```

**用法**

```
link_list = LinkList()
link_list.add(10)
link_list.add(20)
link_list.add(30)
link_list.add(40)
link_list.add(50)
link_list.size()
link_list.search(30)
link_list.remove(20) 
```

**最初的实施思路**

> [http://interactivepython.org/runestone/static/pythonds/BasicDS/ImplementinganUnorderedListLinkedLists.html](http://interactivepython.org/runestone/static/pythonds/BasicDS/ImplementinganUnorderedListLinkedLists.html)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-11T10:46:43.833

使用不可变链表时，请考虑直接使用 Python 的元组。

```
ls = (1, 2, 3, 4, 5)

def first(ls): return ls[0]
def rest(ls): return ls[1:] 
```

它真的很容易，你可以保留额外的功能，如 len(ls)、x in ls 等。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-06-21T14:32:51.407

```
class LL(object):
    def __init__(self,val):
        self.val = val
        self.next = None

    def pushNodeEnd(self,top,val):
        if top is None:
            top.val=val
            top.next=None
        else:
            tmp=top
            while (tmp.next != None):
                tmp=tmp.next        
            newNode=LL(val)
            newNode.next=None
            tmp.next=newNode

    def pushNodeFront(self,top,val):
        if top is None:
            top.val=val
            top.next=None
        else:
            newNode=LL(val)
            newNode.next=top
            top=newNode

    def popNodeFront(self,top):
        if top is None:
            return
        else:
            sav=top
            top=top.next
        return sav

    def popNodeEnd(self,top):
        if top is None:
            return
        else:
            tmp=top
            while (tmp.next != None):
                prev=tmp
                tmp=tmp.next
            prev.next=None
        return tmp

top=LL(10)
top.pushNodeEnd(top, 20)
top.pushNodeEnd(top, 30)
pop=top.popNodeEnd(top)
print (pop.val) 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-07-28T01:48:23.687

[我在https://pypi.python.org/pypi/linked_list_mod/](https://pypi.python.org/pypi/linked_list_mod/)放置了一个 Python 2.x 和 3.x 单链表类

它使用 CPython 2.7、CPython 3.4、Pypy 2.3.1、Pypy3 2.3.1 和 Jython 2.7b2 进行了测试，并带有一个很好的自动化测试套件。

它还包括 LIFO 和 FIFO 类。

它们不是一成不变的。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-10-16T16:30:52.460

```
class LinkedStack:
'''LIFO Stack implementation using a singly linked list for storage.'''

_ToList = []

#---------- nested _Node class -----------------------------
class _Node:
    '''Lightweight, nonpublic class for storing a singly linked node.'''
    __slots__ = '_element', '_next'     #streamline memory usage

    def __init__(self, element, next):
        self._element = element
        self._next = next

#--------------- stack methods ---------------------------------
def __init__(self):
    '''Create an empty stack.'''
    self._head = None
    self._size = 0

def __len__(self):
    '''Return the number of elements in the stack.'''
    return self._size

def IsEmpty(self):
    '''Return True if the stack is empty'''
    return  self._size == 0

def Push(self,e):
    '''Add element e to the top of the Stack.'''
    self._head = self._Node(e, self._head)      #create and link a new node
    self._size +=1
    self._ToList.append(e)

def Top(self):
    '''Return (but do not remove) the element at the top of the stack.
       Raise exception if the stack is empty
    '''

    if self.IsEmpty():
        raise Exception('Stack is empty')
    return  self._head._element             #top of stack is at head of list

def Pop(self):
    '''Remove and return the element from the top of the stack (i.e. LIFO).
       Raise exception if the stack is empty
    '''
    if self.IsEmpty():
        raise Exception('Stack is empty')
    answer = self._head._element
    self._head = self._head._next       #bypass the former top node
    self._size -=1
    self._ToList.remove(answer)
    return answer

def Count(self):
    '''Return how many nodes the stack has'''
    return self.__len__()

def Clear(self):
    '''Delete all nodes'''
    for i in range(self.Count()):
        self.Pop()

def ToList(self):
    return self._ToList 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-11-30T13:00:26.607

**链表类**

```
class LinkedStack:
# Nested Node Class
class Node:
    def __init__(self, element, next):
        self.__element = element
        self.__next = next

    def get_next(self):
        return self.__next

    def get_element(self):
        return self.__element

def __init__(self):
    self.head = None
    self.size = 0
    self.data = []

def __len__(self):
    return self.size

def __str__(self):
    return str(self.data)

def is_empty(self):
    return self.size == 0

def push(self, e):
    newest = self.Node(e, self.head)
    self.head = newest
    self.size += 1
    self.data.append(newest)

def top(self):
    if self.is_empty():
        raise Empty('Stack is empty')
    return self.head.__element

def pop(self):
    if self.is_empty():
        raise Empty('Stack is empty')
    answer = self.head.element
    self.head = self.head.next
    self.size -= 1
    return answer 
```

**用法**

```
from LinkedStack import LinkedStack

x = LinkedStack()

x.push(10)
x.push(25)
x.push(55)

for i in range(x.size - 1, -1, -1):

    print '|', x.data[i].get_element(), '|' ,
    #next object

    if x.data[i].get_next() == None:
        print '--> None'
    else:
        print  x.data[i].get_next().get_element(), '-|---->  ', 
```

**输出**

```
| 55 | 25 -|---->   | 25 | 10 -|---->   | 10 | --> None 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-03-16T02:31:26.950

这是我的简单实现：

```
class Node:
    def __init__(self):
        self.data = None
        self.next = None
    def __str__(self):
        return "Data %s: Next -> %s"%(self.data, self.next)

class LinkedList:
    def __init__(self):
        self.head = Node()
        self.curNode = self.head
    def insertNode(self, data):
        node = Node()
        node.data = data
        node.next = None
        if self.head.data == None:
            self.head = node
            self.curNode = node
        else:
            self.curNode.next = node
            self.curNode = node
    def printList(self):
        print self.head

l = LinkedList()
l.insertNode(1)
l.insertNode(2)
l.insertNode(34) 
```

输出：

```
Data 1: Next -> Data 2: Next -> Data 34: Next -> Data 4: Next -> None 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2011-12-03T11:20:54.800

我认为下面的实现非常优雅地满足了要求。

```
'''singly linked lists, by Yingjie Lan, December 1st, 2011'''

class linkst:
    '''Singly linked list, with pythonic features.
The list has pointers to both the first and the last node.'''
    __slots__ = ['data', 'next'] #memory efficient
    def __init__(self, iterable=(), data=None, next=None):
        '''Provide an iterable to make a singly linked list.
Set iterable to None to make a data node for internal use.'''
        if iterable is not None: 
            self.data, self.next = self, None
            self.extend(iterable)
        else: #a common node
            self.data, self.next = data, next

    def empty(self):
        '''test if the list is empty'''
        return self.next is None

    def append(self, data):
        '''append to the end of list.'''
        last = self.data
        self.data = last.next = linkst(None, data)
        #self.data = last.next

    def insert(self, data, index=0):
        '''insert data before index.
Raise IndexError if index is out of range'''
        curr, cat = self, 0
        while cat < index and curr:
            curr, cat = curr.next, cat+1
        if index<0 or not curr:
            raise IndexError(index)
        new = linkst(None, data, curr.next)
        if curr.next is None: self.data = new
        curr.next = new

    def reverse(self):
        '''reverse the order of list in place'''
        current, prev = self.next, None
        while current: #what if list is empty?
            next = current.next
            current.next = prev
            prev, current = current, next
        if self.next: self.data = self.next
        self.next = prev

    def delete(self, index=0):
        '''remvoe the item at index from the list'''
        curr, cat = self, 0
        while cat < index and curr.next:
            curr, cat = curr.next, cat+1
        if index<0 or not curr.next:
            raise IndexError(index)
        curr.next = curr.next.next
        if curr.next is None: #tail
            self.data = curr #current == self?

    def remove(self, data):
        '''remove first occurrence of data.
Raises ValueError if the data is not present.'''
        current = self
        while current.next: #node to be examined
            if data == current.next.data: break
            current = current.next #move on
        else: raise ValueError(data)
        current.next = current.next.next
        if current.next is None: #tail
            self.data = current #current == self?

    def __contains__(self, data):
        '''membership test using keyword 'in'.'''
        current = self.next
        while current:
            if data == current.data:
                return True
            current = current.next
        return False

    def __iter__(self):
        '''iterate through list by for-statements.
return an iterator that must define the __next__ method.'''
        itr = linkst()
        itr.next = self.next
        return itr #invariance: itr.data == itr

    def __next__(self):
        '''the for-statement depends on this method
to provide items one by one in the list.
return the next data, and move on.'''
        #the invariance is checked so that a linked list
        #will not be mistakenly iterated over
        if self.data is not self or self.next is None:
            raise StopIteration()
        next = self.next
        self.next = next.next
        return next.data

    def __repr__(self):
        '''string representation of the list'''
        return 'linkst(%r)'%list(self)

    def __str__(self):
        '''converting the list to a string'''
        return '->'.join(str(i) for i in self)

    #note: this is NOT the class lab! see file linked.py.
    def extend(self, iterable):
        '''takes an iterable, and append all items in the iterable
to the end of the list self.'''
        last = self.data
        for i in iterable:
            last.next = linkst(None, i)
            last = last.next
        self.data = last

    def index(self, data):
        '''TODO: return first index of data in the list self.
    Raises ValueError if the value is not present.'''
        #must not convert self to a tuple or any other containers
        current, idx = self.next, 0
        while current:
            if current.data == data: return idx
            current, idx = current.next, idx+1
        raise ValueError(data) 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2013-07-25T05:49:11.463

```
class LinkedList:
    def __init__(self, value):
        self.value = value
        self.next = None

    def insert(self, node):
        if not self.next:
            self.next = node
        else:
            self.next.insert(node)

    def __str__(self):
        if self.next:
            return '%s -> %s' % (self.value, str(self.next))
        else:
            return ' %s ' % self.value

if __name__ == "__main__":
    items = ['a', 'b', 'c', 'd', 'e']    
    ll = None
    for item in items:
        if ll:
            next_ll = LinkedList(item)
            ll.insert(next_ll)
        else:
            ll = LinkedList(item)
    print('[ %s ]' % ll) 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2013-12-18T12:21:55.717

首先，我假设你想要链表。在实践中，您可以使用`collections.deque`，其当前的 CPython 实现是块的双向链表（每个块包含 62 个货物对象的数组）。它包含链表的功能。您还可以搜索`llist`在 pypi 上调用的 C 扩展。如果您想要一个纯 Python 且易于理解的链表 ADT 实现，您可以查看我的以下最小实现。

```
class Node (object):
    """ Node for a linked list. """
    def __init__ (self, value, next=None):
        self.value = value
        self.next = next

class LinkedList (object):
    """ Linked list ADT implementation using class. 
        A linked list is a wrapper of a head pointer
        that references either None, or a node that contains 
        a reference to a linked list.
    """
    def __init__ (self, iterable=()):
        self.head = None
        for x in iterable:
            self.head = Node(x, self.head)

    def __iter__ (self):
        p = self.head
        while p is not None:
            yield p.value
            p = p.next

    def prepend (self, x):  # 'appendleft'
        self.head = Node(x, self.head)

    def reverse (self):
        """ In-place reversal. """
        p = self.head
        self.head = None
        while p is not None:
            p0, p = p, p.next
            p0.next = self.head
            self.head = p0

if __name__ == '__main__':
    ll = LinkedList([6,5,4])
    ll.prepend(3); ll.prepend(2)
    print list(ll)
    ll.reverse()
    print list(ll) 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2017-06-10T05:17:10.977

***双向*链表示例**（另存为linkedlist.py）：

```
class node:
    def __init__(self, before=None, cargo=None, next=None): 
        self._previous = before
        self._cargo = cargo 
        self._next  = next 

    def __str__(self):
        return str(self._cargo) or None 

class linkedList:
    def __init__(self): 
        self._head = None 
        self._length = 0

    def add(self, cargo):
        n = node(None, cargo, self._head)
        if self._head:
            self._head._previous = n
        self._head = n
        self._length += 1

    def search(self,cargo):
        node = self._head
        while (node and node._cargo != cargo):
            node = node._next
        return node

    def delete(self,cargo):
        node = self.search(cargo)
        if node:
            prev = node._previous
            nx = node._next
            if prev:
                prev._next = node._next
            else:
                self._head = nx
                nx._previous = None
            if nx:
                nx._previous = prev 
            else:
                prev._next = None
        self._length -= 1

    def __str__(self):
        print 'Size of linked list: ',self._length
        node = self._head
        while node:
            print node
            node = node._next 
```

**测试**（另存为test.py）：

```
from linkedlist import node, linkedList

def test():

    print 'Testing Linked List'

    l = linkedList()

    l.add(10)
    l.add(20)
    l.add(30)
    l.add(40)
    l.add(50)
    l.add(60)

    print 'Linked List after insert nodes:'
    l.__str__()

    print 'Search some value, 30:'
    node = l.search(30)
    print node

    print 'Delete some value, 30:'
    node = l.delete(30)
    l.__str__()

    print 'Delete first element, 60:'
    node = l.delete(60)
    l.__str__()

    print 'Delete last element, 10:'
    node = l.delete(10)
    l.__str__()

if __name__ == "__main__":
    test() 
```

**输出**：

```
Testing Linked List
Linked List after insert nodes:
Size of linked list:  6
60
50
40
30
20
10
Search some value, 30:
30
Delete some value, 30:
Size of linked list:  5
60
50
40
20
10
Delete first element, 60:
Size of linked list:  4
50
40
20
10
Delete last element, 10:
Size of linked list:  3
50
40
20 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2019-09-02T03:42:58.940

我还根据一些教程编写了一个单链表，它有两个基本的节点和链表类，以及一些用于插入、删除、反转、排序等的附加方法。

这不是最好的或最简单的，但工作正常。

```
"""

Single Linked List (SLL):
A simple object-oriented implementation of Single Linked List (SLL) 
with some associated methods, such as create list, count nodes, delete nodes, and such. 

"""

class Node:
    """
    Instantiates a node
    """
    def __init__(self, value):
        """
        Node class constructor which sets the value and link of the node

        """
        self.info = value
        self.link = None

class SingleLinkedList:
    """
    Instantiates the SLL class
    """
    def __init__(self):
        """
        SLL class constructor which sets the value and link of the node

        """
        self.start = None

    def create_single_linked_list(self):
        """
        Reads values from stdin and appends them to this list and creates a SLL with integer nodes

        """
        try:
            number_of_nodes = int(input("   Enter a positive integer between 1-50 for the number of nodes you wish to have in the list: "))
            if number_of_nodes <= 0 or number_of_nodes > 51:
                print(" The number of nodes though must be an integer between 1 to 50!")
                self.create_single_linked_list()

        except Exception as e:
            print(" Error: ", e)
            self.create_single_linked_list()

        try:
            for _ in range(number_of_nodes):
                try:
                    data = int(input("   Enter an integer for the node to be inserted: "))
                    self.insert_node_at_end(data)
                except Exception as e:
                    print(" Error: ", e)
        except Exception as e:
            print(" Error: ", e)

    def count_sll_nodes(self):
        """
        Counts the nodes of the linked list

        """
        try:
            p = self.start
            n = 0
            while p is not None:
                n += 1
                p = p.link

            if n >= 1:
                print(f" The number of nodes in the linked list is {n}")
            else:
                print(f" The SLL does not have a node!")
        except Exception as e: 
            print(" Error: ", e)

    def search_sll_nodes(self, x):
        """
        Searches the x integer in the linked list
        """
        try:
            position =  1
            p = self.start
            while p is not None:
                if p.info == x:
                    print(f" YAAAY! We found {x} at position {position}")
                    return True

                #Increment the position
                position += 1 
                #Assign the next node to the current node
                p = p.link
            else:
                print(f" Sorry! We couldn't find {x} at any position. Maybe, you might want to use option 9 and try again later!")
                return False
        except Exception as e:
            print(" Error: ", e)

    def display_sll(self):
        """
        Displays the list
        """
        try:
            if self.start is None:
                print(" Single linked list is empty!")
                return

            display_sll = " Single linked list nodes are: "
            p = self.start
            while p is not None:
                display_sll += str(p.info) + "\t"
                p = p.link

            print(display_sll)

        except Exception as e:
            print(" Error: ", e) 

    def insert_node_in_beginning(self, data):
        """
        Inserts an integer in the beginning of the linked list

        """
        try:
            temp = Node(data)
            temp.link = self.start
            self.start = temp
        except Exception as e:
            print(" Error: ", e)

    def insert_node_at_end(self, data):
        """
        Inserts an integer at the end of the linked list

        """
        try:            
            temp = Node(data)
            if self.start is None:
                self.start = temp
                return

            p = self.start  
            while p.link is not None:
                p = p.link
            p.link = temp
        except Exception as e:
            print(" Error: ", e)

    def insert_node_after_another(self, data, x):
        """
        Inserts an integer after the x node

        """
        try:
            p = self.start

            while p is not None:
                if p.info == x:
                    break
                p = p.link

            if p is None:
                print(f" Sorry! {x} is not in the list.")
            else:
                temp = Node(data)
                temp.link = p.link
                p.link = temp
        except Exception as e: 
            print(" Error: ", e)

    def insert_node_before_another(self, data, x):
        """
        Inserts an integer before the x node

        """

        try:

            # If list is empty
            if self.start is None:
                print(" Sorry! The list is empty.")
                return 
            # If x is the first node, and new node should be inserted before the first node
            if x == self.start.info:
                temp = Node(data)
                temp.link = p.link
                p.link = temp

            # Finding the reference to the prior node containing x
            p = self.start
            while p.link is not None:
                if p.link.info == x:
                    break
                p = p.link

            if p.link is not None:
                print(f" Sorry! {x} is not in the list.")
            else:
                temp = Node(data)
                temp.link = p.link
                p.link = temp           

        except Exception as e:
            print(" Error: ", e)

    def insert_node_at_position(self, data, k):
        """
        Inserts an integer in k position of the linked list

        """
        try:
            # if we wish to insert at the first node
            if k == 1:
                temp = Node(data)
                temp.link = self.start
                self.start = temp
                return

            p = self.start
            i = 1

            while i < k-1 and p is not None:
                p = p.link
                i += 1

            if p is None:
                print(f" The max position is {i}") 
            else:    
                temp = Node(data)
                temp.link = self.start
                self.start = temp

        except Exception as e:
            print(" Error: ", e)

    def delete_a_node(self, x):
        """
        Deletes a node of a linked list

        """
        try:
            # If list is empty
            if self.start is None:
                print(" Sorry! The list is empty.")
                return

            # If there is only one node
            if self.start.info == x:
                self.start = self.start.link

            # If more than one node exists
            p = self.start
            while p.link is not None:
                if p.link.info == x:
                    break   
                p = p.link

            if p.link is None:
                print(f" Sorry! {x} is not in the list.")
            else:
                p.link = p.link.link

        except Exception as e:
            print(" Error: ", e)

    def delete_sll_first_node(self):
        """
        Deletes the first node of a linked list

        """
        try:
            if self.start is None:
                return
            self.start = self.start.link

        except Exception as e:
            print(" Error: ", e)

    def delete_sll_last_node(self):
        """
        Deletes the last node of a linked list

        """
        try:

            # If the list is empty
            if self.start is None:
                return

            # If there is only one node
            if self.start.link is None:
                self.start = None
                return

            # If there is more than one node    
            p = self.start

            # Increment until we find the node prior to the last node 
            while p.link.link is not None:
                p = p.link

            p.link = None   

        except Exception as e:
            print(" Error: ", e)

    def reverse_sll(self):
        """
        Reverses the linked list

        """

        try:

            prev = None
            p = self.start
            while p is not None:
                next = p.link
                p.link = prev
                prev = p
                p = next
            self.start = prev

        except Exception as e:
            print(" Error: ", e)

    def bubble_sort_sll_nodes_data(self):
        """
        Bubble sorts the linked list on integer values

        """

        try:

            # If the list is empty or there is only one node
            if self.start is None or self.start.link is None:
                print(" The list has no or only one node and sorting is not required.")
            end = None

            while end != self.start.link:
                p = self.start
                while p.link != end:
                    q = p.link
                    if p.info > q.info:
                        p.info, q.info = q.info, p.info
                    p = p.link
                end = p

        except Exception as e:
            print(" Error: ", e)

    def bubble_sort_sll(self):
        """
        Bubble sorts the linked list

        """

        try:

            # If the list is empty or there is only one node
            if self.start is None or self.start.link is None:
                print(" The list has no or only one node and sorting is not required.")
            end = None

            while end != self.start.link:
                r = p = self.start
                while p.link != end:
                    q = p.link
                    if p.info > q.info:
                        p.link = q.link
                        q.link = p
                    if  p != self.start:
                        r.link = q.link
                    else:
                        self.start = q
                    p, q = q, p
                    r = p
                    p = p.link
                end = p

        except Exception as e:
            print(" Error: ", e)

    def sll_has_cycle(self):
        """
        Tests the list for cycles using Tortoise and Hare Algorithm (Floyd's cycle detection algorithm)
        """

        try:

            if self.find_sll_cycle() is None:
                return False
            else:
                return True

        except Exception as e:
            print(" Error: ", e)

    def find_sll_cycle(self):
        """
        Finds cycles in the list, if any
        """

        try:

            # If there is one node or none, there is no cycle
            if self.start is None or self.start.link is None:
                return None

            # Otherwise, 
            slowR = self.start
            fastR = self.start

            while slowR is not None and fastR is not None:
                slowR = slowR.link
                fastR = fastR.link.link
                if slowR == fastR: 
                    return slowR

            return None

        except Exception as e:
            print(" Error: ", e)

    def remove_cycle_from_sll(self):
        """
        Removes the cycles
        """

        try:

            c = self.find_sll_cycle()

            # If there is no cycle
            if c is None:
                return

            print(f" There is a cycle at node: ", c.info)

            p = c
            q = c
            len_cycles = 0
            while True:
                len_cycles += 1
                q = q.link

                if p == q:
                    break

            print(f" The cycle length is {len_cycles}")

            len_rem_list = 0
            p = self.start

            while p != q:
                len_rem_list += 1
                p = p.link
                q = q.link

            print(f" The number of nodes not included in the cycle is {len_rem_list}")

            length_list = len_rem_list + len_cycles

            print(f" The SLL length is {length_list}")

            # This for loop goes to the end of the SLL, and set the last node to None and the cycle is removed. 
            p = self.start
            for _ in range(length_list-1):
                p = p.link
            p.link = None

        except Exception as e:
            print(" Error: ", e)

    def insert_cycle_in_sll(self, x):
        """
        Inserts a cycle at a node that contains x

        """

        try:

            if self.start is None:
                return False

            p = self.start
            px = None
            prev = None

            while p is not None:
                if p.info == x:
                    px = p
                prev = p
                p = p.link

            if px is not None:
                prev.link = px
            else:
                print(f" Sorry! {x} is not in the list.")

        except Exception as e:
            print(" Error: ", e)

    def merge_using_new_list(self, list2):
        """
        Merges two already sorted SLLs by creating new lists
        """
        merge_list = SingleLinkedList()
        merge_list.start = self._merge_using_new_list(self.start, list2.start)
        return merge_list

    def _merge_using_new_list(self, p1, p2):
        """
        Private method of merge_using_new_list
        """
        if p1.info <= p2.info:
            Start_merge = Node(p1.info)
            p1 = p1.link
        else:
            Start_merge = Node(p2.info)
            p2 = p2.link            
        pM = Start_merge

        while p1 is not None and p2 is not None:
            if p1.info <= p2.info:
                pM.link = Node(p1.info)
                p1 = p1.link
            else:
                pM.link = Node(p2.info)
                p2 = p2.link
            pM = pM.link

        #If the second list is finished, yet the first list has some nodes
        while p1 is not None:
            pM.link = Node(p1.info)
            p1 = p1.link
            pM = pM.link

        #If the second list is finished, yet the first list has some nodes
        while p2 is not None:
            pM.link = Node(p2.info)
            p2 = p2.link
            pM = pM.link

        return Start_merge

    def merge_inplace(self, list2):
        """
        Merges two already sorted SLLs in place in O(1) of space
        """
        merge_list = SingleLinkedList()
        merge_list.start = self._merge_inplace(self.start, list2.start)
        return merge_list

    def _merge_inplace(self, p1, p2):
        """
        Merges two already sorted SLLs in place in O(1) of space
        """
        if p1.info <= p2.info:
            Start_merge = p1
            p1 = p1.link
        else:
            Start_merge = p2
            p2 = p2.link
        pM = Start_merge

        while p1 is not None and p2 is not None:
            if p1.info <= p2.info:
                pM.link = p1
                pM = pM.link
                p1 = p1.link
            else:
                pM.link = p2
                pM = pM.link
                p2 = p2.link

        if p1 is None:
            pM.link = p2
        else:
            pM.link = p1

        return Start_merge

    def merge_sort_sll(self):
        """
        Sorts the linked list using merge sort algorithm
        """
        self.start = self._merge_sort_recursive(self.start)

    def _merge_sort_recursive(self, list_start):
        """
        Recursively calls the merge sort algorithm for two divided lists
        """

        # If the list is empty or has only one node
        if list_start is None or list_start.link is None:
            return list_start

        # If the list has two nodes or more
        start_one = list_start
        start_two = self._divide_list(self_start)
        start_one = self._merge_sort_recursive(start_one)
        start_two = self._merge_sort_recursive(start_two)
        start_merge = self._merge_inplace(start_one, start_two)

        return start_merge

    def _divide_list(self, p):
        """
        Divides the linked list into two almost equally sized lists
        """

        # Refers to the third nodes of the list
        q = p.link.link

        while q is not None and p is not None:
            # Increments p one node at the time
            p = p.link
            # Increments q two nodes at the time
            q = q.link.link

        start_two = p.link
        p.link = None

        return start_two

    def concat_second_list_to_sll(self, list2):
        """
        Concatenates another SLL to an existing SLL
        """

        # If the second SLL has no node
        if list2.start is None:
            return

        # If the original SLL has no node
        if self.start is None:
            self.start = list2.start
            return

        # Otherwise traverse the original SLL
        p = self.start
        while p.link is not None:
            p = p.link

        # Link the last node to the first node of the second SLL
        p.link = list2.start

    def test_merge_using_new_list_and_inplace(self):
        """

        """

        LIST_ONE = SingleLinkedList()
        LIST_TWO = SingleLinkedList()

        LIST_ONE.create_single_linked_list()
        LIST_TWO.create_single_linked_list()

        print("1️⃣  The unsorted first list is: ")
        LIST_ONE.display_sll()

        print("2️⃣  The unsorted second list is: ")
        LIST_TWO.display_sll()

        LIST_ONE.bubble_sort_sll_nodes_data()
        LIST_TWO.bubble_sort_sll_nodes_data()

        print("1️⃣  The sorted first list is: ")
        LIST_ONE.display_sll()

        print("2️⃣  The sorted second list is: ")
        LIST_TWO.display_sll()

        LIST_THREE = LIST_ONE.merge_using_new_list(LIST_TWO)

        print("The merged list by creating a new list is: ")
        LIST_THREE.display_sll()

        LIST_FOUR = LIST_ONE.merge_inplace(LIST_TWO)

        print("The in-place merged list is: ")
        LIST_FOUR.display_sll()     

    def test_all_methods(self):
        """
        Tests all methods of the SLL class
        """

        OPTIONS_HELP = """

    Select a method from 1-19:                                                          

        ℹ️   (1)      Create a single liked list (SLL).
        ℹ️   (2)      Display the SLL.                            
        ℹ️   (3)      Count the nodes of SLL. 
        ℹ️   (4)      Search the SLL.
        ℹ️   (5)      Insert a node at the beginning of the SLL.
        ℹ️   (6)      Insert a node at the end of the SLL.
        ℹ️   (7)      Insert a node after a specified node of the SLL.
        ℹ️   (8)      Insert a node before a specified node of the SLL.
        ℹ️   (9)      Delete the first node of SLL.
        ℹ️   (10)     Delete the last node of the SLL.
        ℹ️   (11)     Delete a node you wish to remove.                           
        ℹ️   (12)     Reverse the SLL.
        ℹ️   (13)     Bubble sort the SLL by only exchanging the integer values.  
        ℹ️   (14)     Bubble sort the SLL by exchanging links.                    
        ℹ️   (15)     Merge sort the SLL.
        ℹ️   (16)     Insert a cycle in the SLL.
        ℹ️   (17)     Detect if the SLL has a cycle.
        ℹ️   (18)     Remove cycle in the SLL.
        ℹ️   (19)     Test merging two bubble-sorted SLLs.
        ℹ️   (20)     Concatenate a second list to the SLL. 
        ℹ️   (21)     Exit.

        """

        self.create_single_linked_list()

        while True:

            print(OPTIONS_HELP)

            UI_OPTION = int(input("   Enter an integer for the method you wish to run using the above help: "))

            if UI_OPTION == 1:
                data = int(input("   Enter an integer to be inserted at the end of the list: "))
                x = int(input("   Enter an integer to be inserted after that: "))
                self.insert_node_after_another(data, x)
            elif UI_OPTION == 2:
                self.display_sll()
            elif UI_OPTION == 3:
                self.count_sll_nodes()
            elif UI_OPTION == 4:
                data = int(input("   Enter an integer to be searched: "))
                self.search_sll_nodes(data)
            elif UI_OPTION == 5:
                data = int(input("   Enter an integer to be inserted at the beginning: "))
                self.insert_node_in_beginning(data)
            elif UI_OPTION == 6:
                data = int(input("   Enter an integer to be inserted at the end: "))
                self.insert_node_at_end(data)
            elif UI_OPTION == 7:
                data = int(input("   Enter an integer to be inserted: "))
                x = int(input("   Enter an integer to be inserted before that: "))
                self.insert_node_before_another(data, x)
            elif UI_OPTION == 8:
                data = int(input("   Enter an integer for the node to be inserted: "))
                k = int(input("   Enter an integer for the position at which you wish to insert the node: "))
                self.insert_node_before_another(data, k)
            elif UI_OPTION == 9:
                self.delete_sll_first_node()
            elif UI_OPTION == 10:
                self.delete_sll_last_node()
            elif UI_OPTION == 11:
                data = int(input("   Enter an integer for the node you wish to remove: "))
                self.delete_a_node(data)
            elif UI_OPTION == 12:
                self.reverse_sll()
            elif UI_OPTION == 13:
                self.bubble_sort_sll_nodes_data()
            elif UI_OPTION == 14:
                self.bubble_sort_sll()
            elif UI_OPTION == 15:
                self.merge_sort_sll()
            elif UI_OPTION == 16:
                data = int(input("   Enter an integer at which a cycle has to be formed: "))
                self.insert_cycle_in_sll(data)
            elif UI_OPTION == 17:
                if self.sll_has_cycle():
                    print(" The linked list has a cycle. ")
                else:
                    print(" YAAAY! The linked list does not have a cycle. ")
            elif UI_OPTION == 18:
                self.remove_cycle_from_sll()
            elif UI_OPTION == 19:
                self.test_merge_using_new_list_and_inplace()
            elif UI_OPTION == 20:
                list2 = self.create_single_linked_list()
                self.concat_second_list_to_sll(list2)
            elif UI_OPTION == 21:
                break
            else:
                print(" Option must be an integer, between 1 to 21.")

            print()     

if __name__ == '__main__':
    # Instantiates a new SLL object
    SLL_OBJECT = SingleLinkedList()
    SLL_OBJECT.test_all_methods() 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-11-03T06:18:07.743

扩展[Nick Stinemates 的](https://stackoverflow.com/a/280286)答案

```
class Node(object):
    def __init__(self):
        self.data = None
        self.next = None

class LinkedList:
    def __init__(self):
        self.head = None

    def prepend_node(self, data):
        new_node = Node()
        new_node.data = data
        new_node.next = self.head
        self.head = new_node

    def append_node(self, data):
        new_node = Node()
        new_node.data = data
        current = self.head
        while current.next:
            current = current.next
        current.next = new_node

    def reverse(self):
        """ In-place reversal, modifies exiting list"""
        previous = None
        current_node = self.head

        while current_node:
            temp =  current_node.next
            current_node.next = previous
            previous = current_node
            current_node = temp
        self.head = previous

    def search(self, data):
        current_node = self.head
        try:
            while current_node.data != data:
                current_node = current_node.next
            return True
        except:
            return False

    def display(self):
        if self.head is None:
            print("Linked list is empty")
        else:
            current_node = self.head
            while current_node:
                print(current_node.data)
                current_node = current_node.next

    def list_length(self):
        list_length = 0
        current_node = self.head
        while current_node:
            list_length += 1
            current_node = current_node.next
        return list_length

def main():
    linked_list = LinkedList()

    linked_list.prepend_node(1)
    linked_list.prepend_node(2)
    linked_list.prepend_node(3)
    linked_list.append_node(24)
    linked_list.append_node(25)
    linked_list.display()
    linked_list.reverse()
    linked_list.display()
    print(linked_list.search(1))
    linked_list.reverse()
    linked_list.display()
    print("Lenght of singly linked list is: " + str(linked_list.list_length()))

if __name__ == "__main__":
    main() 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2014-09-28T18:20:00.203

我的 2 美分

```
class Node:
    def __init__(self, value=None, next=None):
        self.value = value
        self.next = next

    def __str__(self):
        return str(self.value)

class LinkedList:
    def __init__(self):
        self.first = None
        self.last = None

    def add(self, x):
        current = Node(x, None)
        try:
            self.last.next = current
        except AttributeError:
            self.first = current
            self.last = current
        else:
            self.last = current

    def print_list(self):
        node = self.first
        while node:
            print node.value
            node = node.next

ll = LinkedList()
ll.add("1st")
ll.add("2nd")
ll.add("3rd")
ll.add("4th")
ll.add("5th")

ll.print_list()

# Result: 
# 1st
# 2nd
# 3rd
# 4th
# 5th 
```

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2014-10-30T16:45:52.830

```
enter code here
enter code here

class node:
    def __init__(self):
        self.data = None
        self.next = None
class linked_list:
    def __init__(self):
        self.cur_node = None
        self.head = None
    def add_node(self,data):
        new_node = node()
        if self.head == None:
            self.head = new_node
            self.cur_node = new_node
        new_node.data = data
        new_node.next = None
        self.cur_node.next = new_node
        self.cur_node = new_node
    def list_print(self):
        node = self.head
        while node:
            print (node.data)
            node = node.next
    def delete(self):
        node = self.head
        next_node = node.next
        del(node)
        self.head = next_node
a = linked_list()
a.add_node(1)
a.add_node(2)
a.add_node(3)
a.add_node(4)
a.delete()
a.list_print() 
```

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2017-10-15T14:06:44.880

我的双链表对于菜鸟来说可能是可以理解的。如果您熟悉 C 语言中的 DS，那么它的可读性很强。

```
# LinkedList..

class node:
    def __init__(self):           ##Cluster of Nodes' properties 
        self.data=None
        self.next=None
        self.prev=None

class linkedList():
    def __init__(self):
        self.t = node()                    // for future use
        self.cur_node = node()             // current node
        self.start=node()

    def add(self,data):                          // appending the LL

        self.new_node = node()
        self.new_node.data=data
        if self.cur_node.data is None:          
            self.start=self.new_node               //For the 1st node only

        self.cur_node.next=self.new_node
        self.new_node.prev=self.cur_node
        self.cur_node=self.new_node

    def backward_display(self):                  //Displays LL backwards
        self.t=self.cur_node
        while self.t.data is not None:
            print(self.t.data)
            self.t=self.t.prev

    def forward_display(self):                   //Displays LL Forward
        self.t=self.start
        while self.t.data is not None:
            print(self.t.data)
            self.t=self.t.next
            if self.t.next is None:
                print(self.t.data)
                break

    def main(self):                          //This is kind of the main 
                                               function in C
        ch=0
        while ch is not 4:                    //Switch-case in C 
            ch=int(input("Enter your choice:"))
            if ch is 1:
                data=int(input("Enter data to be added:"))
                ll.add(data)
                ll.main()
            elif ch is 2:
                ll.forward_display()
                ll.main()
            elif ch is 3:
                ll.backward_display()
                ll.main()
            else:
                print("Program ends!!")
                return

ll=linkedList()
ll.main() 
```

尽管可以在此代码中添加更多简化，但我认为原始实现会更容易获得。

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2021-07-05T22:03:44.520

Python 中链表的当前实现需要创建一个名为 Node 的单独类，以便可以使用主链表类连接它们。在提供的实现中，链接列表的创建没有为节点定义单独的类。使用建议的实现，链接列表更容易理解，并且可以使用打印功能简单地可视化。

```
class Linkedlist:
     def __init__(self):
         self.outer = None

     def add_outermost(self, dt):
         self.outer = [dt, self.outer]

     def add_innermost(self, dt):
         p = self.outer
         if not p:
             self.outer = [dt, None]
             return
         while p[1]:
             p = p[1]
         p[1] = [dt, None]

     def visualize(self):
         p = self.outer
         l = 'Linkedlist: '
         while p:
             l += (str(p[0])+'->')
             p = p[1]
         print(l + 'None')

 ll = Linkedlist()
 ll.add_innermost(8)
 ll.add_outermost(3)
 ll.add_outermost(5)
 ll.add_outermost(2)
 ll.add_innermost(7)
 print(ll.outer)
 ll.visualize() 
```

* * *

## 回答 #29

> 赞同：-4
> 
> 时间：2014-10-31T09:47:20.570

如果您只想创建一个简单的喜欢列表，请参考此代码

l=[1,[2,[3,[4,[5,[6,[7,[8,[9,[10]]]]]]]]]]

对于这个鳕鱼的可视化执行访问[http://www.pythontutor.com/visualize.html#mode=edit](http://www.pythontutor.com/visualize.html#mode=edit)

# delphi - 菜单加速键未显示 (Delphi 2009)

> ID：280247
> 
> 赞同：8
> 
> 时间：2008-11-11T07:34:59.117
> 
> 标签：delphi, menu, delphi-2009, acceleratorkey

我已经尽力了，无法弄清楚这里发生了什么。它在 Delphi 4 中运行良好。升级到 Delphi 2009 后，我不知道这是它应该工作的方式，还是有问题：

这是我的程序菜单在 Delphi 2009 下的设计模式下的样子：

[![在此处输入图像描述](https://i.stack.imgur.com/lg57M.gif)](https://i.stack.imgur.com/lg57M.gif)

请注意，主菜单和文件子菜单中的每个单词都有一个字母下划线。它应该是这样的。这个带下划线的字母称为加速键，是 Windows 应用程序中的标准，因此您可以使用 Alt 键和该字母快速选择菜单项，然后使用键盘而不是鼠标选择子菜单项。

您可以通过使用“&”字符作为项目标题的一部分来获取它们，例如：Save &As...

当我运行我的应用程序并使用鼠标打开文件菜单时，它看起来像这样：

[![在此处输入图像描述](https://i.stack.imgur.com/zpw14.gif)](https://i.stack.imgur.com/zpw14.gif)

字符在主菜单中带有下划线，但在“文件”菜单中没有下划线。

相反，如果我使用 Alt-F 键打开文件子菜单，那么它看起来是正确的，如下所示：

[![在此处输入图像描述](https://i.stack.imgur.com/Hxwn0.gif)](https://i.stack.imgur.com/Hxwn0.gif)

并且所有加速键字母都有适当的下划线。

我玩过 AutoHotKeys 选项，但这不是问题。

以前有人遇到过这个问题吗？第二张图片中的示例是我不知道的正确行为吗？或者是否有一些我可能遗漏的选项或编码错误？

* * *

2009 年 11 月（一年后）：mghie 似乎已经找到了问题的根源并找出了问题所在。请参阅下面他接受的答案。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T07:57:44.860

有一个标准的 Windows 设置（在显示属性下）通常隐藏这些加速器，除非按住 Alt 键。这可以解释为什么使用 Alt+F10 打开菜单会为您显示它们。也许这就是原因？

[编辑]：不，不是。我刚刚尝试过，一个带有菜单项的简单 TForm 显示了加速器，但是只要我添加一个 TImageList 并设置单个菜单项的 ImageIndex，或者简单地将 OwnerDraw 设置为 true，那么加速器下划线就会消失。我想这确实是 VCL 中的一个错误。

顺便说一句，这是在 Windows XP 上。

**解决方法：**

我已经在 Windows XP 64 上使用 Delphi 2009 对此进行了调试，缺少加速器的根本原因似乎是 Windows 发送`WM_DRAWITEM`带有`ODS_NOACCEL`标志集的消息，如果系统设置为始终显示加速器，则不应该这样做。所以你可以说这不是 VCL 错误，而是 VCL 无法解决的 Windows 问题。

但是，您可以在自己的代码中解决它，您只需在将消息传递给 VCL 之前重置标志。覆盖窗口过程

```
protected
  procedure WndProc(var Message: TMessage); override; 
```

像这样：

```
procedure TYourForm.WndProc(var Message: TMessage);
const
  ODS_NOACCEL = $100;
var
  pDIS: PDrawItemStruct;
  ShowAccel: BOOL;
begin
  if (Message.Msg = WM_DRAWITEM) then begin
    pDIS := PDrawItemStruct(Message.LParam);
    if (pDIS^.CtlType = ODT_MENU)
      and SystemParametersInfo(SPI_GETKEYBOARDCUES, 0, @ShowAccel, 0)
    then begin
      if ShowAccel then
        pDIS^.itemState := pDIS^.itemState and not ODS_NOACCEL;
    end;
  end;
  inherited;
end; 
```

这只是演示代码，您不应该在`SystemParametersInfo()`每次`WM_DRAWITEM`收到消息时调用，而是在程序启动时调用一次，然后每次您的程序收到`WM_SETTINGCHANGE`消息时调用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-11T08:00:00.690

这是 Windows 2000 引入的“功能”：

旧事物：[为什么 Windows 默认隐藏键盘加速器和焦点矩形？](http://blogs.msdn.com/oldnewthing/archive/2006/10/05/792913.aspx)

Delphi 4 似乎不支持此 Windows 功能。

要让 2000 和 XP 菜单显示加速键，请右键单击桌面上的空白处，选择属性，单击外观选项卡，然后在效果下，取消选中*隐藏键盘导航的下划线字母，直到我按下 Alt 键*。单击确定两次。

不知道如何在 Vista 中做到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T07:50:03.300

我认为这不是 Delphi 生成的错误，因为您在 Vista 上使用记事本具有相同的行为。顺便说一句，在德尔福本身……
我必须承认，在你的问题之前我没有注意。感谢您指出。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-17T02:01:12.907

正如 Jim McKeeth 上面（正确地）指出的那样，这是“设计使然”的行为。如果菜单是通过键盘操作触发的，则应显示加速器，但如果由鼠标触发，则故意不显示加速器。

我将 XP 配置为始终显示加速器，但更改该选项的快速测试确认菜单也不应显示下划线（Visual Studio 响应如我预期，使用鼠标时没有下划线）。但是，Microsoft Office 会忽略此设置并始终显示下划线。所以它看起来像是在 Delphi 中如何绘制菜单的一个错误（我自己对 Delphi 没有任何经验）。

我也找到了 Vista 的选项：http: [//www.vistax64.com/vista-general/42125-always-show-menu-underline-keyboard-accelerators.html](http://www.vistax64.com/vista-general/42125-always-show-menu-underline-keyboard-accelerators.html)

> 您可以在新的“轻松访问中心”中启用此功能（转到“控制面板”，单击“轻松访问”，然后单击“轻松访问中心”）。在“轻松访问中心”中，单击使键盘更易于使用，然后在最底部选中下划线键盘快捷键和访问键复选框。

在做进一步研究时，我在 Delphi 论坛上发现了这个相关的错误：http: //qc.codegear.com/wc/qcmain.aspx?d= [37403](http://qc.codegear.com/wc/qcmain.aspx?d=37403)

在您的情况下，子窗口（绘制的菜单）看起来没有或没有处理来自其父窗口的 WM_UIUPDATESTATE 消息，这就是导致使用加速器重绘的原因。

# naming-conventions - 何时将网站视为“静态”或“动态”

> ID：280249
> 
> 赞同：3
> 
> 时间：2008-11-11T07:35:57.010
> 
> 标签：naming-conventions

我创建了一个站点，它解析 XML 文件并在适当的页面上显示其内容。我的网站是动态网页还是静态网页？

动态网页和静态网页有何不同？

我觉得它是动态的，因为我从 xml 文件中解析内容；最初我的主页中没有任何内容..

对此你怎么看，请解释一下。。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T07:49:50.443

我会将您的页面描述为动态的。“静态”通常意味着位于 Web 服务器上的文件按原样交付给用户；因为您是从数据文件中组装页面，所以即使您没有构建任何动态变化的数据，我也会称它们为动态的。

我不认为这是一个硬性和快速的定义。如果有人觉得页面是静态的，因为它是由静态页面组装而成的，那是另一种看待它的方式。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T08:25:17.470

这实际上是一个有趣的问题..

我会说它是一个动态网站，因为内容是以编程方式生成的。但如果 XML 文件不更改，它的“静态”并不比通过 Apache 提供的直接 HTML 文件少。

假设您有一个常规 HTML 文件的站点 - 它会被视为静态网页；但是，如果您获取这些 HTML 文件，将它们存储在数据库中，并拥有一个允许的简单页面`/view.php?page=index`- 这是否使它成为一个动态站点？

我会说不，它只是一个通过数据库或 XML 文件（而不是文件系统）提供的静态站点。

基本上：如果内容发生更改而您没有手动编辑这些 XML 文件，我会说它是一个动态站点。如果它确实发生了变化，那么我会说它是一个静态站点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T08:28:49.710

[KISS](http://en.wikipedia.org/wiki/KISS_principle) -*动态页面改变**而不改变页面本身**。*

您的页面是动态的，因为一旦部署，内容就可以在不更改页面 HTML 的情况下进行更改。

任何固定且始终呈现相同内容的内容都被视为静态内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T07:49:18.107

静态网页将是交付的纯 HTML 内容。如果您在服务器端处理任何类型的 XML 文件并相应地生成内容，则这是一个动态页面。静态页面在实际编辑和修改页面时更改内容。

如果您搜索过 Google 上的第一个结果，它会解释它。[http://websiteowner.info/articles/pages/pagetypes.asp](http://websiteowner.info/articles/pages/pagetypes.asp)

此外，说静态网站不定期更新是不正确的。甚至在我们开始用 Perl 和 PHP 编写东西之前，Web 和 HTML 就已经存在。有/曾经有流量很大并且正在手动修改的站点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T07:50:11.630

区分静态和动态的简单方法：

静态：直接的 HTML 文件

动态：通过服务器端代码和数据存储（XML、数据库等）生成 HTML

# symbian - 如何在 UIQ 中阅读短信/彩信

> ID：280254
> 
> 赞同：2
> 
> 时间：2008-11-11T07:38:05.350
> 
> 标签：symbian, uiq3, uiq

如何在 UIQ 中阅读短信/彩信？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T12:54:57.957

我将假设您需要有关如何编写一些 C++ 源代码的信息，这些源代码将允许应用程序接收 SMS/MMS 并读取它接收到的消息的内容。

* * *

在 Symbian OS 上，消息存储可以存储 SMS、MMS、EMAIL...

消息存储的 API 是通用的。

为了在消息存储中写入和读取数据，您需要熟悉以下类：TMsvId、CMsvSession、CClientMtmRegistry、TMsvEntry 和 CMsvEntry。

* * *

我显然有偏见，但我建议阅读[http://www.quickrecipesonsymbianos.com](http://www.quickrecipesonsymbianos.com)的消息传递章节，以便了解消息传递商店的工作原理以及轻松使用它的示例代码。

* * *

另一方面，接收消息更为复杂。

* * *

使用通用网络 API 侦听和接收 SMS。那就是 RSocketServ 和 RSocket。大多数情况下，您需要在套接字上使用正确的 IOCTL 参数。

您可以指定特定端口，以便仅接收针对您的应用程序的 SMS。尝试接收所有 SMS 可能是一个问题，因为本机消息查看器引擎和嵌入式 Java 虚拟机 PushRegistry 模块都可能已经在监听所有 SMS。

您可以在 SDK 的以下头文件中找到有用的类和常量：gsmuset.h smsuaddr.h smsustrm.h gsmubuf.h gsmumsg.h。

TSmsAddr、KSMSDatagramProtocol、KSMSAddrFamily、TSmsUserDataSettings、CSmsBufferBase、CSmsPDU、RSmsSocketReadStream、RSmsSocketWriteStream 和 CSmsMessage 是特别感兴趣的。异步接收 SMS 实际上是使用 RSocket.Ioctl() 完成的。

有特定于 SMS 的错误代码，其名称以“KSmsErr”开头

* * *

在 UIQ 上接收彩信是通过 UQI 特定的 API 完成的。您在 Series60 手机上找不到的一款。这就是为什么您在文献中找不到太多关于 Symbian 通用 MMS API 的讨论的原因。当您有更详细的问题时，最好直接访问 UIQ 或索尼爱立信开发社区。

您的应用程序不必使用 RSocket 来接收彩信。

再次小心，嵌入式 Java 虚拟机 PushRegistry 模块和本机消息查看器应用程序引擎可能已经在侦听所有传入的 MMS 消息。

有趣的头文件是 mmsclient.h、MmsSettingsStore.h、mmsentry.h、MmsApiExtensions.h

特别感兴趣的是 CMmsClientMtm、MmsApiExtensions、MMsvSessionObserver 和 MMMSMessageHandler。

* * *

祝你好运。

# internationalization - i18n - 国际化的最佳实践 - XLIFF, gettext, INI, ...？

> ID：280260
> 
> 赞同：31
> 
> 时间：2008-11-11T07:41:25.047
> 
> 标签：internationalization, translation

编辑：**我真的很想看到一些关于格式、优缺点的一般性讨论！**

EDIT2：'赏金并没有真正帮助创建所需的讨论，有一些有趣的答案，但仍然缺少对该主题的全面报道。六个人将该问题标记为最喜欢的问题，这表明我对此讨论很感兴趣。

在决定**国际化**时，IMO 最困难的部分是存储格式的选择。

例如，Zend PHP 框架提供了以下适配器，几乎涵盖了我的所有选项：

*   数组：不，难以维护
*   **CSV：不知道，编码可能有问题**
*   **Gettext : 经常使用，poEdit 适用于所有可用但复杂的平台**
*   **INI : 不知道，编码可能有问题**
*   TBX：不知道
*   TMX：太大了？没有免费的编辑器。
*   QT：不是很普遍，没有免费工具
*   **XLIFF：即将到来的标准？但没有可用的免费工具。**
*   XMLTM：不，不是我需要的

基本上我坚持使用 4 个“大胆”的选择。我想使用 INI 文件，但我正在阅读有关编码问题的信息……如果我使用严格的 UTF-8（文件、连接、数据库等），这真的有问题吗？

我在 Windows 上，我试图弄清楚 poEdit 的功能，但没有管理。网络上也没有教程，**gettext**仍然是一种选择还是濒临灭绝的物种？

**XLIFF**怎么样，有人用过吗？关于使用什么工具的任何提示？

任何关于**Eclipse**集成这些技术的想法？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-11T07:58:21.270

POEdit 并不难掌握。只需创建一个新的 .po 文件，然后告诉它从源文件中导入字符串。该程序会扫描您的 PHP 文件以查找任何匹配的函数调用`_("Text"), gettext("Text")`等。您甚至可以指定自己的函数来查找。

然后在相应的框中输入翻译。当您保存 .po 文件时，会自动生成一个 .mo 文件。这只是 gettext 可以轻松解析的翻译的二进制版本。

在您的 PHP 脚本中调用以`bindtextdomain()`告诉它您的 .mo 文件所在的位置。现在任何传递给`gettext`（或下划线函数）的字符串都将被翻译。

它使您的翻译文件保持最新变得非常容易。POEdit 还具有一些简洁的功能，例如允许注释、显示更改和删除的字符串以及允许模糊匹配，这意味着您不必重新翻译稍微修改过的字符串。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-27T22:22:19.443

总有[翻译工具包](http://toolkit.translatehouse.org/)允许在我认为**所有**提到的格式和首选 gettext (po) 和 XLIFF 之间进行翻译。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T07:48:33.083

如果你愿意，你可以使用 INI，只是 INI 没有办法告诉任何人它是 UTF8 格式，所以如果有人用编辑器打开你的 INI，它可能会损坏你的文件。

所以这个想法是，如果您可以信任用户使用 UTF8 编码对其进行编辑。

您可以在文件开头添加 BOM，一些编辑器知道这一点。

你要它存储什么？用户生成的内容或您的应用程序资源？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-17T00:10:12.687

我在 l18n 端使用了其中两种格式：TMX 和 XLIFF。它们非常相似。TMX 现在更受欢迎，但 XLIFF 正在迅速获得支持。我上次查看时至少有一个免费的 XLIFF 编辑器：[Transolution](http://transolution.python-hosting.com/)，但现在还没有开发。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-28T18:15:08.413

我使用自定义设计自己进行数据存储 - 所有显示的文本都存储在数据库中。

我有两张桌子。第一个表有一个标识值、一个 32 个字符的 varchar 字段（在该字段上索引）和一个 200 个字符的短语英文描述。

我的第二个表具有来自第一个表的标识值、语言代码（EN_UK、EN_US 等）和文本的 NVARCHAR 列。

我对文本使用 nvarchar，因为它支持我尚未使用的其他字符集。

第一个表中的 32 个字符 varchar 存储类似“pleaselogin”的内容，而第二个表实际上存储了完整的“请在下面输入您的登录名和密码”。

我创建了一个巨大的动态值列表，我在运行时替换了这些值。例如，“您有 {[dynamic:passworddaysremain]} 天的时间来更改您的密码。” - 这让我可以处理不同语言的词序。

到目前为止，我只需要处理阿拉伯数字，但必须为第一个需要非阿拉伯数字的用户解决一些问题。

实际上，我每隔 2 小时将这些信息从数据库中提取一次，并将其缓存到磁盘中的每个 XML 语言的文件中。广泛使用 CDATA。

有许多可用选项，为了提高性能，您可以为每种语言使用 html 模板 - 我的方法效果很好，但在运行时确实使用 XML DOM 来创建页面。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T18:59:25.000

一种相当简单的方法是只使用资源文件和资源脚本。像 MSVC 这样的程序在编辑它们时没有问题。它们对其他系统（以及文本编辑器）也相当友好。您可以为每种语言创建单独的字符串表（和位图表），并用它所在的语言标记每个这样的表。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T19:15:20.040

这些选择对我来说都不是很开胃。

如果您要发送文件以进行多种语言的翻译，那么您希望能够相信编码是正确的，特别是如果您的团队中没有人会说这些语言。有时很难发现外语的编码问题，如果让操作系统“猜测”，很容易无意中破坏文件编码。

您确实需要一种声明其编码的格式。否则，翻译人员或其翻译工具可能会选择 UTF-8 以外的内容。对我来说，任何一种简单的 XML 格式都是最好的，但看起来您需要在 Zend 中自行开发。XLIFF 和 TMX 肯定是矫枉过正。

像 Java 的 XML 资源这样的格式将是理想的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-01T18:59:52.760

这可能与迄今为止发布的内容略有不同，并且可能不是您正在寻找的内容，但我想我会添加它，如果没有别的，只是一种不同的方法。我采用了面向对象的方法。我所做的是创建一个系统，通过将语言文件存储在字符串=>翻译对的数组中，将它们封装到一个类中。访问翻译是通过一个名为 translate 的方法来访问的，该方法将键字符串作为参数。扩展类继承父类的语言数组，可以添加或覆盖它。因为类是可扩展的，所以您可以更改基类并让更改通过子类传播，从而比数组本身更易于维护。另外，你只调用你需要的类。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-01T22:26:57.337

我们只是将字符串存储在数据库中，并在应用程序中内置了一个翻译模式来处理实际添加不同语言的字符串。

在应用程序中，我们使用各种技巧来创建文本 ID，例如

```
£("btn_save")
£(Order.class,"amt") 
```

当系统启动或手动触发重新加载时，从数据库加载翻译。£ 方法负责根据用户会话中指定的语言查找翻译后的字符串。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-03T19:58:48.093

[您可以在http://www.myl10n.net](http://www.myl10n.net)上查看我的名为 iL10Nz 的 l10n 工具

您可以上传 po/pot 文件、xliff、ini 文件、翻译、下载。

您也可以在 youtube 上观看此视频 [http://www.youtube.com/watch?v=LJLmxMFxaxA](http://www.youtube.com/watch?v=LJLmxMFxaxA)

谢谢奥利维尔

# c# - LINQ to Entities 是否重用对象的实例？

> ID：280270
> 
> 赞同：1
> 
> 时间：2008-11-11T07:49:05.453
> 
> 标签：c#, linq, entities

使用 LINQ to Entities 听起来是一种很好的方式来查询数据库并获取我可以修改的实际 CLR 对象、数据绑定等等。但是，如果我第二次执行相同的查询，我会返回对相同 CLR 对象或全新集合的引用吗？

我不希望多个查询生成越来越多的相同实际数据的副本。这里的问题是我可以更改一个实体的内容并将其保存回数据库，但该实体的另一个实例仍然存在于其他地方并保存旧数据。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T07:59:53.577

在同一个 DataContext 中，我的理解是您将始终获得相同的对象 - 对于返回完整对象而不是投影的查询。

然而，不同的 DataContexts 将获取不同的对象 - 因此存在在那里看到陈旧数据的风险，是的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T08:13:22.067

在同一个 DataContext 中，如果查询它，您将获得相同的对象（DataContext 为此维护内部缓存）。

请注意，您处理的对象很可能是可变的，因此您可以得到另一个问题（并发访问），而不是一个问题（数据重复）。

根据业务案例，让具有陈旧数据的第二个事务在提交时失败可能是可以的。

另外，想象一个好的旧 IDataReader/DataSet 场景。两个查询将返回两个不同的读取器，它们将填充不同的数据集。所以数据重复问题不是特定于 ORM 的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T08:27:21.227

[哎呀；请注意，此回复适用于 Linq-to-SQL，而不是实体框架。]

我把它留在这里（而不是删除），因为它部分是关于主题的，并且可能有用。

* * *

除了其他回复，请注意，数据上下文还能够避免简单地“按主键”查询进行往返 - 它会首先检查缓存。

不幸的是，它在 3.5 中*[完全](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=340036)*损坏，在 3.5SP1 中仍然是[半损坏](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=362313)，但它适用于*某些*查询。如果您要获取单个对象，这可以节省大量时间。

所以基本上，你需要使用 IIRC：

```
// uses object identity cache (IIRC)
var obj = ctx.Single(x=>x.Id == id); 
```

但不是：

```
// causes round-trip (IIRC)
var obj = ctx.Where(x=>x.Id == id).Single(); 
```

# .net - 以编程方式创建 DNS 记录

> ID：280277
> 
> 赞同：1
> 
> 时间：2008-11-11T07:50:12.330
> 
> 标签：.net, dns

情况是，我有一个网站，用户可以在其中获得一个子域。例如：client.mydomain.com。如果客户未能满足某些条件（例如付款默认），我希望上述网站指向不同的网站。我们想要做的方式是通过适当的重定向创建一个 dns 记录。

我使用win 2003 服务器，并在.Net 中编程。关于如何以编程方式执行此操作的任何输入？

我确实控制了网站，但是原因是有很多用户（以及子域），而且（client.mydomain.come）也没有物理网站，就像用户拥有博客的 wordpress/blogger。 wordpress.com（我假设他们不会为每个用户创建一个新网站）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T07:58:59.630

那么，使用 .Net 和 Windows 2003 服务器，您可以使用 WMI 脚本来执行此操作。您可以在此处找到有关[DNS WMI 类的更多信息](http://msdn.microsoft.com/en-us/library/ms682123(VS.85).aspx)

**然而**

我强烈建议您不要将 Windows 服务器用作公共 DNS 服务器 - 出于安全和性能原因，您最好使用运行 BIND 的 linux 服务器。此外，使用 BIND-dlz（BIND 的附加组件），您可以使 BIND 使用几乎任何 SQL 数据库作为 DNS 记录的数据源。从 BIND 9.4 开始，BIND-dlz 包含在核心 BIND 发行版中。更多信息可以在[http://bind-dlz.sourceforge.net找到](http://bind-dlz.sourceforge.net)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T08:02:50.573

是否可以将 *.domain.com 映射到您的服务器 IP，然后从您的应用程序配置主机绑定？这样，您将为所有用户使用相同的应用程序。否则，您始终可以自己检查主机并重定向、切换 webroot 等或任何您想要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T08:06:40.940

如果您控制网站，我认为最好设置重定向而不是更改 DNS 记录。重定向可以像为您自己的一个重命名当前文档索引（例如，index.htm）一样简单，这将执行到目标的元重定向。

DNS 更改的传播速度很慢，因此即使 TTL 很小，禁用和启用也会有延迟。另一个变化是更容易和直接的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-11-05T11:33:55.680

为您的 DNS 使用 Amazon AWS Route 53 之类的服务，然后您可以以编程方式使用他们的 API 添加/删除/更改 DNS 记录。

# javascript - 实用的 FlapJax

> ID：280283
> 
> 赞同：1
> 
> 时间：2008-11-11T07:54:19.530
> 
> 标签：javascript

有没有人使用或看过一个使用[FlapJax](http://www.flapjax-lang.org/)来运行的网站，而不仅仅是一个演示？我很好奇他们是如何运作的/他们写作有多难。

每个答案列出一个例子。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T22:57:35.023

我将忽略每个回答请求的一个应用程序：

[http://continue2.cs.brown.edu/](http://continue2.cs.brown.edu/)

[http://resumedemo.cs.brown.edu/](http://resumedemo.cs.brown.edu/)

请记住，这些是由 Flapjax 的开发人员制作的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T17:13:03.630

我一直将它用于我雇主的内部页面，这在很大程度上是一个非常精美的时钟。直接使用库（跳过他们计划弃用的编译器）效果很好。当您有大量不同的组件来来去去且必须同步时，事件流非常方便。
所以，抱歉，不能给你看任何东西，但我很满意。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-08T11:58:28.810

我只是可以回答这个问题，并认为人们可能对我们正在开发的网站感兴趣。它目前仍处于测试阶段，但它在很大程度上依赖于 FlapJax javascript 库。网站[在这里](https://my.ihome.eu)。请记住，并非所有代码都是 FlapJax 并且那里有很多 javascript，因此可能需要一些搜索才能找到好的部分。

可以在[此处](http://www.ihome.eu/)找到有关该站点及其用途的更多信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-11-12T00:09:29.567

我已经在各种网站和 Web 应用程序中成功使用了 Flapjax。在工作中，我目前正在为完全基于 flapjax 的托管交换机创建一个接口。

您应该考虑的关键事项是：

*   Flapjax 是一个 FRP 库，（功能响应式编程）
*   FRP 在规模上效果最好。
*   这都是关于状态和事件的管理。
*   仅当整个系统为 FRP 时才有效

这些小例子并没有做到系统公正。

我的基于 NodeJS 的 Flapjax frp 框架在 GitHub 上，虽然它还没有完全准备好。[http://github.com/Zysen/Aurora](http://github.com/Zysen/Aurora)

这是我对 FRP 的描述，您可能会发现它很有帮助 [https://github.com/Zysen/Aurora/wiki](https://github.com/Zysen/Aurora/wiki)

# html - 表单 - 下拉列表

> ID：280295
> 
> 赞同：0
> 
> 时间：2008-11-11T08:02:08.343
> 
> 标签：html, forms, drop-down-menu

如何设计一个可以使用复选框进行多项选择的下拉列表。我们可以使用 html/css 还是需要 javascript？为了视觉清晰，您可以查看我附上的图像。
[图片链接](http://shivanand.in/tmp/dropdown.gif)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T08:42:34.580

您可以在屏幕截图中查看该站点的 HTML 源代码。那里是用Javascript完成的。我怀疑这对于纯 HTML 是可能的，我无法想象用 CSS 来做到这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T09:26:04.540

这对于纯 XHTML 和/或仅标签是不可能的。在您截取屏幕截图的站点中打开所有复选框的窗格实际上是一个具有绝对位置并包含复选框列表的窗格。因此，您需要编写自己的 xhtml 结构来实现这一点。并且需要添加一些 javascript 以使其全部工作和交互。

# programming-languages - 什么是关系参数？

> ID：280298
> 
> 赞同：7
> 
> 时间：2008-11-11T08:03:36.110
> 
> 标签：programming-languages

一个听起来很复杂的术语，简单的谷歌搜索没有很好的解释……还有更多的学术导向的人可以解释这个吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-03-20T14:28:08.123

两个答案大部分都是正确的。我会说参数性是多态性的一个可能属性。如果多态项在所有实例化下表现相同，则多态性是参数化的。“行为相同”是一个模糊的、直观的术语。John Reynolds 引入了关系参数化作为对此的数学形式化。它指出多态术语保留所有关系，这直观地迫使它表现相同：

考虑 f: 一个列表 -> 一个列表。如果我们有关系 a~1, b~2, c~3, ...，那么我们可以将它提升到列表并具有例如 [a, d, b, c] ~ [1, 4, 2, 3]

现在，如果 f([a, d, b, c]) = [c, b, d, a] 并且 f 保留关系，则 f([1, 4, 2, 3]) = [3, 2, 4 , 1]。换句话说，如果 f 反转字符串列表，它也会反转数字列表。

所以关系参数多态函数不能“检查类型参数”，因为它们不能根据类型改变它们的行为。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T07:55:37.530

关系参数性似乎是对类型进行抽象的函数（如 Java 中的泛型）可以具有的属性。如果它具有此属性，则意味着它永远不会检查其类型参数或解构它/以某种特殊方式使用它。例如，这里的函数“id or inc”不是关系参数：

```
public class Hey<T>
{
    public T idOrInc(T var)
    {
        if (var instanceof Integer)
            return (T)(new Integer(((Integer)var).intValue()+1));
        return var;
    }
    public static void main(String[] args) {
        Hey<Integer> h = new Hey<Integer>();
        System.out.println(h.idOrInc(new Integer(10)));
        Hey<Double> h2 = new Hey<Double>();
        System.out.println(h2.idOrInc(new Double(10)));
    }
} 
```

输出是：

```
$ java Hey
11
10.0 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T08:59:50.367

好的，只是在这里冒险一个完整的猜测，基于此

[http://ieeexplore.ieee.org/xpl/freeabs_all.jsp?arnumber=4276578](http://ieeexplore.ieee.org/xpl/freeabs_all.jsp?arnumber=4276578)

我会说这是参数多态性（泛型）的数学表示。

# .net - ADO.NET 实体框架中的持久性无知是否意味着我认为的意思？

> ID：280308
> 
> 赞同：3
> 
> 时间：2008-11-11T08:11:12.243
> 
> 标签：.net, database, entity-framework, orm

如果框架与持久性无关，我的单元测试能否在我的实体模型下构建持久性存储的文件系统版本？

我肯定会在 GUI 中使用实体框架的模型优先功能，因为我的开发人员很容易进行架构更改并保持 DAL 层同步。

有没有人尝试过使用模型优先方法并添加持久性无知？

我认为这将是我理想的模特世界。我使用 LINQ2SQL atm，换出数据存储有点棘手，但有一个自动丰富的数据层，它不会隐藏在一组业务线 IDataContext 接口后面。

如果我能看到这个工作的一些场景，我想在未来投入更多时间来尝试这个。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-19T09:19:25.180

[只是一个更新，从支持Persistence Ignorance](http://aleembawany.com/2009/04/06/persistence-ignorance-in-adonet-entity-framework/)的 Entity Framework 4.0 开始，这已经发生了变化。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T08:19:41.430

实体框架没有*真正*的持久性无知。这是最大的批评之一（即强制基类、大量 EF 关系等）。LINQ-to-SQL*可以*有持久性无知，但实际上人们倾向于使用延迟加载和属性化的方法，这意味着它仍然没有持久性无知。

与持久性*无关*- 它（EF）仍然需要提供者。当然，如果您想编写一个与文件系统对话的 EF 提供程序，请继续！不过，这将是*很多*工作。使用 SQL Express 数据库（平面文件）等会更容易。

# c# - 在 XDocument 中合并 XML 文件

> ID：280313
> 
> 赞同：16
> 
> 时间：2008-11-11T08:14:55.870
> 
> 标签：c#, xml, linq-to-xml

我正在尝试将多个 XML 文件合并到一个 XDocument 对象中。

XDocument 对象中不存在合并。我想念这个。

有没有人已经为 XDocument 实现了 Merge 扩展方法，或者类似的东西？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-11T10:20:14.917

我自己尝试了一下：

```
var MyDoc = XDocument.Load("File1.xml");
MyDoc.Root.Add(XDocument.Load("File2.xml").Root.Elements()); 
```

我不知道它是好是坏，但它对我来说很好:-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T08:56:49.093

务实，`XDocument`vs`XmLDocument`不是全有或全无（除非你在 Silverlight 上） - 所以如果`XmlDoucument`做了你需要的东西，而`XDocument`不是，那么也许使用`XmlDocument`(with `ImportNode`etc)。

也就是说，即使使用`XDocument`，您也可以使用`XNode.ReadFrom`来导入每个，然后将其简单地导入`.Add`主集合。

当然，如果文件很大，`XmlReader/XmlWriter`可能会更有效......但更复杂。幸运的是，`XmlWriter`有一个`WriteNode`接受 的方法`XmlReader`，因此您可以导航到 中的第一个孩子，`XmlReader`然后将其快速发送到输出文件。就像是：

```
 static void AppendChildren(this XmlWriter writer, string path)
    {
        using (XmlReader reader = XmlReader.Create(path))
        {
            reader.MoveToContent();
            int targetDepth = reader.Depth + 1;
            if(reader.Read()) {
                while (reader.Depth == targetDepth)
                {
                    writer.WriteNode(reader, true);
                }                
            }
        }
    } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-01-12T17:39:16.730

将目录中的所有 xml 文件合并到一个 XDocument

```
public static XDocument MergeDir(string xmlDir)
{
    XDocument xdoc = XDocument.Parse("<root></root>");
    System.IO.DirectoryInfo directory = new DirectoryInfo(xmlDir);
    if (directory.Exists)
    {
        foreach (System.IO.FileInfo file in directory.GetFiles())
        {
            if (file.Extension == ".xml")
            {
                xdoc.Root.Add(XDocument.Load(file.FullName).Root.Elements());
            }
        }
    }

    return xdoc;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T08:20:10.180

作为一种解决方法，您可以使用 XSL 文件来合并 XML 文件，然后将其转换为 XDocument 对象。

# python - 什么时候需要“自我”？

> ID：280324
> 
> 赞同：13
> 
> 时间：2008-11-11T08:24:00.780
> 
> 标签：python, wxpython

我只使用了一小段时间类，当我编写一个方法时，我让所有变量都引用 self，例如 self.foo。

但是，我正在浏览*wxPython in Action*书籍，并注意到“self”并非一直都在使用。例如：

```
 import wx
 class TextFrame(wx.Frame):
    def __init__(self):
        wx.Frame.__init__(self, None, -1, 'Text Entry Example',
            size=(300, 100))
        panel = wx.Panel(self, -1)
        basicLabel = wx.StaticText(panel, -1, "Basic Control:")
        basicText = wx.TextCtrl(panel, -1, "I've entered some text!",
            size=(175, -1))
        basicText.SetInsertionPoint(0)
        pwdLabel = wx.StaticText(panel, -1, "Password:")
        pwdText = wx.TextCtrl(panel, -1, "password", size=(175, -1),
            style=wx.TE_PASSWORD)
        sizer = wx.FlexGridSizer(cols=2, hgap=6, vgap=6)
        sizer.AddMany([basicLabel, basicText, pwdLabel, pwdText])
        panel.SetSizer(sizer) 
```

下面的确实使用“自我”。

```
import wx
class ButtonFrame(wx.Frame):
    def __init__(self):
        wx.Frame.__init__(self, None, -1, 'Button Example',
            size=(300, 100))
        panel = wx.Panel(self, -1)
        self.button = wx.Button(panel, -1, "Hello", pos=(50, 20))
        self.Bind(wx.EVT_BUTTON, self.OnClick, self.button)
        self.button.SetDefault()
    def OnClick(self, event):
        self.button.SetLabel("Clicked") 
```

如果我没记错的话，“self”是对类的特定实例的引用，那么什么时候不需要呢？有一般的经验法则吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-11T10:42:20.440

您用于`self.attribute`引用当前实例的属性。

你`wx.Frame.__init__()`用来引用父类的方法。

`self`如果您只引用您所在的方法（函数）的本地名称（变量），则不要使用。

这些不是“经验法则”，因为没有例外。

* * *

在这个特定示例中，您可能会感到困惑的是，面板似乎只是构造函数中的一个本地名称，因此一旦您的构造函数返回，面板看起来就会消失。

但是，如果您查看文档`wx.Panel`，您会看到*它的*构造函数将面板附加到父窗口，因此即使在构造函数返回后它也会继续存在。

魔法 ：）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T08:26:41.633

在这些情况下，如果您不使用，`self`那么您将只创建该名称的局部变量。在第一个示例中，`panel`它被创建为局部变量，然后在函数中稍后被引用，但它在该函数之外不可用。传递`self`给 wx.Panel 构造函数的行为以某种方式将它与当前对象相关联，因此它不会在函数返回时消失。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T08:27:44.610

**引用实例本身时总是**需要self ，除非调用基类构造函数 (wx.Frame.__init__)。您在示例中看到的所有其他变量（panel、basicLabel、basicText，...）只是局部变量 - 与当前对象完全无关。当方法返回时，这些名称将消失 - 放入 self.foo 的所有内容都将在方法结束后继续存在，并在下一个方法中可用（例如 self.button）。

# .net - 64位平台编程

> ID：280327
> 
> 赞同：2
> 
> 时间：2008-11-11T08:24:43.680
> 
> 标签：.net, 64-bit

在使用 .Net 应用程序（假设是 Asp.Net 应用程序）时，与在 32 位平台上工作相比，在 64 位平台上工作时做事的方式有什么不同。

我想的很少，因为您正在研究框架，而框架正在为您处理大部分事情，对吗？

但是，请发表您的意见。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T08:51:27.450

如果您使用 p/invoke，那么您需要确保您有 64 位版本的 DLL 可用。如果您调用 MS 提供的 DLL，例如 kernel32，这不是问题，因为它们在 32 位和 64 位平台上具有相同的名称（我知道这很奇怪），因此您的 64 位应用程序将隐式链接到正确的版本。但是，如果您使用 3rd 方 DLL 并且您的 64 位应用程序尝试链接到 32 位 DLL，您将获得运行时异常。

这也意味着如果您使用的是进程内 COM 对象，您将遇到问题。当您跨越进程边界时，64 位应用程序可以调用 32 位的进程外 COM 对象（反之亦然），COM 将为您处理编组。

除此之外，该框架会为您处理大多数事情。您永远不必担心指针大小，并且 clr 类型具有明确的大小（int 始终为 32 位，long 始终为 64 位）。在纯粹的 .NET 世界中，几乎没有什么可担心的。当您开始在沙盒之外移动时，您必须更加小心。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T08:35:49.057

在两种情况下考虑 64 位可能会很有趣：

1.  您需要考虑具有超过 2^31 个元素的容器。标准数组 .Length 属性返回 Int32，因此无法表示大型数组 - 无论如何您都无法在 32 位 VM 中创建。在 64 位 VM 中，您应该改用 LongLength（除非您知道您的元素少于 2^31 个）。不幸的是，许多标准集合类似乎根本不支持大量元素。
2.  您可以使用对性能关注较少的 long 类型：在 64 位版本中，long 适合寄存器，而在 32 位版本中，JIT 代码将需要多个机器指令来执行单个 long 操作。

# wpf - Horizo ntalAlignment=Stretch、MaxWidth 和 Left 同时对齐？

> ID：280331
> 
> 赞同：102
> 
> 时间：2008-11-11T08:26:34.037
> 
> 标签：wpf, xaml, alignment, stretch

这似乎应该很容易，但我很难过。在 WPF 中，我想要一个 TextBox 可以延伸到其父级的宽度，但只能延伸到最大宽度。问题是我希望它在其父级中保持合理。要使其拉伸，您必须使用 Horizo​​ntalAlignment="Stretch"，但结果会居中。我已经尝试过 Horizo​​ntalContentAlignment，但它似乎没有做任何事情。

如何让这个蓝色文本框随着窗口的大小而增长，最大宽度为 200 像素，并且左对齐？

```
<Page
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <StackPanel>  
    <TextBox Background="Azure" Text="Hello" HorizontalAlignment="Stretch" MaxWidth="200" />
  </StackPanel>
</Page> 
```

有什么诀窍？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2008-11-11T09:25:52.043

您可以设置`HorizontalAlignment`为 Left，设置您的`MaxWidth`然后绑定`Width`到`ActualWidth`父元素的：

```
<Page
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <StackPanel Name="Container">   
    <TextBox Background="Azure" 
    Width="{Binding ElementName=Container,Path=ActualWidth}"
    Text="Hello" HorizontalAlignment="Left" MaxWidth="200" />
  </StackPanel>
</Page> 
```

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2008-11-11T09:13:42.867

```
<Grid>
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" MaxWidth="200"/>
    </Grid.ColumnDefinitions>

    <TextBox Background="Azure" Text="Hello" />
</Grid> 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-11T11:26:27.887

给出的两个答案都适用于我所说的问题 - 谢谢！

不过，在我的实际应用程序中，我试图将一个面板限制在 ScrollViewer 内，而 Kent 的方法由于某种原因并没有很好地处理这个问题，我没有费心去追查。基本上，这些控件可以扩展到 MaxWidth 设置之外并破坏了我的意图。

Nir 的技术运行良好，并且 ScrollViewer 没有问题，但需要注意一件小事。您要确保将 TextBox 上的左右边距设置为 0，否则它们会妨碍您。我还将绑定更改为使用 ViewportWidth 而不是 ActualWidth 以避免出现垂直滚动条时出现问题。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-08-26T08:25:00.590

您可以将其用于 DataTemplate 的宽度：

```
Width="{Binding ActualWidth,RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ScrollContentPresenter}}}" 
```

确保您的 DataTemplate 根有 Margin="0" （您可以使用某些面板作为根并将 Margin 设置为该根的子级）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-06-19T12:44:53.103

也许我仍然可以帮助遇到这个问题的人，因为这是一个非常古老的问题。

我也需要这个，并写了一个行为来解决这个问题。所以这是行为：

```
public class StretchMaxWidthBehavior : Behavior<FrameworkElement>
{        
    protected override void OnAttached()
    {
        base.OnAttached();
        ((FrameworkElement)this.AssociatedObject.Parent).SizeChanged += this.OnSizeChanged;
    }

    protected override void OnDetaching()
    {
        base.OnDetaching();
        ((FrameworkElement)this.AssociatedObject.Parent).SizeChanged -= this.OnSizeChanged;
    }

    private void OnSizeChanged(object sender, SizeChangedEventArgs e)
    {
        this.SetAlignments();
    }

    private void SetAlignments()
    {
        var slot = LayoutInformation.GetLayoutSlot(this.AssociatedObject);
        var newWidth = slot.Width;
        var newHeight = slot.Height;

        if (!double.IsInfinity(this.AssociatedObject.MaxWidth))
        {
            if (this.AssociatedObject.MaxWidth < newWidth)
            {
                this.AssociatedObject.HorizontalAlignment = HorizontalAlignment.Left;
                this.AssociatedObject.Width = this.AssociatedObject.MaxWidth;
            }
            else
            {
                this.AssociatedObject.HorizontalAlignment = HorizontalAlignment.Stretch;
                this.AssociatedObject.Width = double.NaN;
            }
        }

        if (!double.IsInfinity(this.AssociatedObject.MaxHeight))
        {
            if (this.AssociatedObject.MaxHeight < newHeight)
            {
                this.AssociatedObject.VerticalAlignment = VerticalAlignment.Top;
                this.AssociatedObject.Height = this.AssociatedObject.MaxHeight;
            }
            else
            {
                this.AssociatedObject.VerticalAlignment = VerticalAlignment.Stretch;
                this.AssociatedObject.Height = double.NaN;
            }
        }
    }
} 
```

然后你可以像这样使用它：

```
<Grid>
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition />
    </Grid.ColumnDefinitions>

    <TextBlock Grid.Column="0" Text="Label" />
    <TextBox Grid.Column="1" MaxWidth="600">
          <i:Interaction.Behaviors>                       
               <cbh:StretchMaxWidthBehavior/>
          </i:Interaction.Behaviors>
    </TextBox>
</Grid> 
```

最后忘记使用`System.Windows.Interactivity`命名空间来使用行为。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-10-31T10:34:50.117

功能类似于接受的答案，但不需要指定父元素：

```
<TextBox
    Width="{Binding ActualWidth, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type FrameworkElement}}}"
    MaxWidth="500"
    HorizontalAlignment="Left" /> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-09-03T19:47:19.347

我会用`SharedSizeGroup`

```
<Grid>
    <Grid.ColumnDefinition>
        <ColumnDefinition SharedSizeGroup="col1"></ColumnDefinition>  
        <ColumnDefinition SharedSizeGroup="col2"></ColumnDefinition>
    </Grid.ColumnDefinition>
    <TextBox Background="Azure" Text="Hello" Grid.Column="1" MaxWidth="200" />
</Grid> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-06-15T15:56:42.110

就我而言，我必须将文本框放入堆栈面板中才能在左侧拉伸文本框。感谢之前的帖子。仅举一个例子，我确实设置了背景颜色，以查看窗口大小发生变化时会发生什么。

```
<StackPanel Name="JustContainer" VerticalAlignment="Center" HorizontalAlignment="Stretch" Background="BlueViolet" >
    <TextBox 
       Name="Input" Text="Hello World" 
       MaxWidth="300"
       HorizontalAlignment="Right"
       Width="{Binding ActualWidth, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type FrameworkElement}}}">
    </TextBox>
</StackPanel> 
```

# asp.net - UpdatePanel 似乎在处理像 AsynPostBack 这样的海量数据。jSonSerializer maxLength 没有帮助

> ID：280339
> 
> 赞同：0
> 
> 时间：2008-11-11T08:29:59.100
> 
> 标签：asp.net, json, updatepanel, componentart, jsonserializer

我有一个 ASP.NET 3.5 应用程序并尝试更新具有嵌套自定义控件的更新面板。在该自定义控件中是一个 ComponentArt Gird，在此更新中，它被几乎 13MB 的数据填充（是的，我可以将其分块......）。

我在更新面板中有一个隐藏按钮，当我需要更新面板和网格时，我从客户端由 JS 触发。

当我在 asyncPostback 期间使用 Updatepanelxyz.Update() 调用 Update 方法时，我稍后会在该过程中得到 asyncPostBackError 说，JSonSerializer 无法处理这么多的数据。我应该增加指定的值。

确实。明白了。但是当我在 web.config 中更改这个值时，它只能工作到大约 8MB，但不会更多。在这种情况下，JSonSerializer 是否有限制。我已经将该值设置为 Int32 的最大值，这是默认值的 1000 倍，对于 4MB 的序列化数据来说已经足够了。

有什么建议么？有什么方法可以强制序列化程序实现这一点？有什么方法可以使用另一个序列化器？

干杯，史蒂夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-12T06:06:46.750

伙计，1 mb 的数据太多了 - 为什么你需要 13？

我真的认为你需要重构你的用户界面。我不在乎你的网络有多快，那只是疯狂的东西！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T19:23:47.917

我完全同意 UI 和 DataAccess 层需要重构，但在短期内，我只是在寻找一种简单快捷的解决方案来帮助我的客户，直到软件的下一次更新出来。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-27T02:55:48.720

最好的办法是更改 web.config 部分中的 ScriptingJsonSerializationSection.MaxJsonLength 属性。

它默认为 102400 个字符，而 JsonSerializer 类的限制为 2097152 个字符。

看：

[JsonSerializer 类 maxJsonLength 属性](http://msdn.microsoft.com/en-us/library/system.web.script.serialization.javascriptserializer.maxjsonlength%28v=VS.90%29.aspx)

和

[JsonSerialization 配置节最大长度属性](http://msdn.microsoft.com/en-us/library/system.web.configuration.scriptingjsonserializationsection.maxjsonlength%28v=VS.90%29.aspx)

正如我上面提到的，不幸的是，更改配置部分属性是唯一的方法。

# c++ - 如何使用 PostThreadMessage 从 C++ 关闭 Internet Explorer

> ID：280345
> 
> 赞同：1
> 
> 时间：2008-11-11T08:36:50.567
> 
> 标签：c++, windows, multithreading, messaging

我试图开始`iexplore.exe`让它运行 5 秒钟，然后再次关闭它。

`iexplore`打开就好了，但是当我调用 PostThreadMessage 时它不会关闭。谁能看到我做错了什么？这是我的代码：

```
CString IEPath = "C:\\Program Files\\Internet Explorer\\IEXPLORE.EXE";//GetIEPath();
//IEPath += ' ' + url;
std::string strCommand((LPCTSTR)IEPath);
PROCESS_INFORMATION    procinfo;
STARTUPINFO    startupinfo;    
GetStartupInfo(&startupinfo);

CreateProcess(
        NULL,       
        (char *)strCommand.c_str(),// name of executable module
        NULL,           // lpProcessAttributes
        NULL,           // lpThreadAttributes
        false,          // handle inheritance option
        CREATE_SHARED_WOW_VDM,              // creation flags
        NULL,           // new environment block
        NULL,           // current directory name
        &startupinfo,    // startup information
        &procinfo        // process information
        );

Sleep(5000);
    ::PostThreadMessage(procinfo.dwThreadId, WM_QUIT, 0, 0); //<---Dosent Close internet explorer! 
```

任何人都知道我做错了什么？还是有更好的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T08:46:50.453

如果您可以枚举桌面上的窗口并将 WM_CLOSE 发送到 IE 窗口，它可能会起作用..您可以使用 spy 程序获取 IE 窗口的窗口类

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T08:50:42.083

PostThreadMessage 调用的返回值是多少？这可能会提供线索。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T08:56:20.437

对我来说，这很完美：

```
TerminateProcess(procinfo.hProcess, 0); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T09:48:41.110

尝试将 WM_CLOSE 发送到主（顶层）窗口。这相当于正常的 Alt-F4 退出。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T08:58:30.710

我没有具体的答案，为什么 PostThreadMessage 不起作用。但是，也许如果您详细说明为什么要这样做，是否有更好的解决方案？

例如，如果您只想显示一个网页 5 秒钟，您可以创建并显示您自己的带有嵌入式 Internet Explorer ActiveX 控件的窗口。您还可以添加接收器来检测网页何时加载到 ActiveX 控件中，以便仅在网页加载和显示后启动 5 秒计数器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T12:36:15.843

我最终对窗口进行了枚举（正如你们中提到的我应该做的那样），我受到了[http://simplesamples.info/Windows/EnumWindows.php](http://simplesamples.info/Windows/EnumWindows.php)的启发。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T15:10:46.530

不要使用 PostThreadMessage()，它将消息发送到目标进程中的特定线程，而不是进程的 Windows 消息泵。请改用 PostMessage() 或 SendMessage()，它们将消息放置在目标进程的 Windows 消息泵中——这正是您想要的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-15T10:50:58.310

不，永远不要使用 SendMessage() （基本的 win32 规则）不要使用 EnmWindows() （可怕）

# c++ - 如何将 Unicode 字符串转换为 utf-8 或 utf-16 字符串？

> ID：280347
> 
> 赞同：6
> 
> 时间：2008-11-11T08:38:52.967
> 
> 标签：c++, unicode, utf-8, character-encoding, utf-16

如何将 Unicode 字符串转换为 utf-8 或 utf-16 字符串？我的 VS2005 项目使用 Unicode 字符集，而 cpp 中的 sqlite 提供

```
int sqlite3_open(
  const char *filename,   /* Database filename (UTF-8) */
  sqlite3 **ppDb          /* OUT: SQLite db handle */
);
int sqlite3_open16(
  const void *filename,   /* Database filename (UTF-16) */
  sqlite3 **ppDb          /* OUT: SQLite db handle */
); 
```

用于打开文件夹。如何将字符串、CString 或 wstring 转换为 UTF-8 或 UTF-16 字符集？

非常感谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T08:44:01.070

使用[WideCharToMultiByte](http://msdn.microsoft.com/en-us/library/ms776420(VS.85).aspx)函数。指定参数`CP_UTF8`。`CodePage`

```
CHAR buf[256]; // or whatever
WideCharToMultiByte(
  CP_UTF8, 
  0, 
  StringToConvert, // the string you have
  -1, // length of the string - set -1 to indicate it is null terminated
  buf, // output
  __countof(buf), // size of the buffer in bytes - if you leave it zero the return value is the length required for the output buffer
  NULL,    
  NULL
); 
```

此外，Windows 中 unicode 应用程序的默认编码是 UTF-16LE，因此您可能不需要执行任何翻译，只需使用第二个版本即可`sqlite3_open16`。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-11T09:38:31.537

简短的回答：

如果您使用 Unicode 字符串（例如 CString 或 wstring），则无需转换。使用 sqlite3_open16()。您必须确保将 WCHAR 指针（转换为`void *`. 似乎很蹩脚！即使这个库是跨平台的，我猜他们也可以定义一个取决于平台并且比 a 不友好的宽 char 类型`void *`） API。例如对于 CString：`(void*)(LPCWSTR)strFilename`

更长的答案：

您没有要转换为 UTF8 或 UTF16 的 Unicode 字符串。您的程序中有一个使用给定编码表示的 Unicode 字符串：Unicode 本身不是二进制表示。编码说明了 Unicode 代码点（数值）在内存中的表示方式（数字的二进制布局）。UTF8 和 UTF16 是使用最广泛的编码。他们是非常不同的。

当 VS 项目说“Unicode 字符集”时，它实际上意味着“字符被编码为 UTF16”。因此，您可以直接使用 sqlite3_open16()。无需转换。字符存储在 WCHAR 类型（而不是`char`）中，它占用 16 位（标准 C 类型的后备`wchar_t`，在 Win32 上占用 16 位。在其他平台上可能不同。感谢您的更正，Checkers）。

您可能还需要注意一个细节：UTF16 有 2 种风格：Big Endian 和 Little Endian。这就是这 16 位的字节顺序。您为 UTF16 提供的函数原型没有说明使用哪种排序。但是假设 sqlite 使用与 Windows 相同的字节序（Little Endian IIRC。我知道顺序但总是对名称有问题:-)），那么你就很安全了。

编辑：回答跳棋评论：

UTF16 使用 16 位*代码单元*。在 Win32 下（并且*仅*在 Win32 上），`wchar_t`用于此类存储单元。诀窍是一些 Unicode 字符需要 2 个这样的 16 位代码单元的序列。它们被称为代理对。

与 UTF8 使用 1 到 4 字节序列表示 1 个字符的方式相同。然而 UTF8 与该`char`类型一起使用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T08:46:58.253

所有 C++ 字符串类型都是字符集中性的。他们只是确定一个字符宽度，而不做进一步的假设。wstring 在 Windows 中使用 16 位字符，大致对应于 utf-16，但它仍然取决于您在线程中存储的内容。wstring 不会以任何方式强制您放入其中的数据必须是有效的 utf16。Windows 在定义 UNICODE 时使用 utf16，因此您的字符串很可能已经是 utf16，您无需执行任何操作。

其他一些人建议使用 WideCharToMultiByte 函数，这是将 utf16 转换为 utf8 的方法之一。但是由于 sqlite 可以处理 utf16，所以这不是必需的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T08:44:55.263

utf-8 和 utf-16 都是“unicode”字符编码。您可能谈论的是 utf-32，它是一种固定大小的字符编码。也许正在寻找

`"Convert utf-32 into utf-8 or utf-16"`

为您提供有关此的一些结果或其他论文。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-08-22T21:56:14.540

最简单的方法是使用 CStringA。CString 类是 CStringA（ASCII 版本）或 CStringW（宽字符版本）的 typedef。这两个类都有构造函数来转换字符串类型。我通常使用：

```
sqlite3_open(CStringA(L"MyWideCharFileName"), ...); 
```

# c# - .NET CF 应用程序和内存不足异常

> ID：280351
> 
> 赞同：1
> 
> 时间：2008-11-11T08:41:35.393
> 
> 标签：c#, .net, memory-management

我正在开发一个 .NET CF 3.5 网络游戏。我的问题是应用程序首先加载所有资源。然而，在随后的启动中，该应用程序在加载资源（尤其是声音或大图像）时给了我内存异常。

请指导我

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T20:32:31.693

我假设您没有尝试一次启动多个游戏实例。这听起来像是游戏关闭后内存没有返回到操作系统。确定是否有泄漏的一种简单方法是：

1.  重启设备
2.  检查内存使用情况
3.  开始你的游戏，玩几分钟
4.  关闭游戏
5.  等待几分钟，然后再次检查内存使用情况

如果您可以在内存不足之前进行几次启动，那么您就会有少量泄漏。如果您在重新启动设备之前只能启动一次，那么您就有了一个大的。垃圾收集只会到此为止。如果您正在对非托管代码进行任何调用（Win32 或 PInvoke 调用实例化非托管对象），那么您需要确保在游戏关闭时释放这些资源。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T08:58:44.703

加载所有资源后，您的应用程序占用了多少内存？在默认设置下，我收到这个错误来自 cca 1.3 GB 的私有字节（检查任务管理器和进程内存分配）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T20:48:03.703

Microsoft 为我们提供了 CLR Profiler，这是一种用于分析托管应用程序行为的工具，您可以[在此处](http://www.microsoft.com/downloads/details.aspx?FamilyId=A362781C-3870-43BE-8926-862B40AA0CD0&displaylang=en)下载。它是 .NET 2.0 的 CLR Profiler，但它可以与 .NET 3.5 一起使用，因为 CLR 尚未更改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-26T15:48:07.367

部分问题可能是 .NET CF 不能很好地处理 Windows CE 的内存模型。（即使有那么多可用的内存分配失败，也会出现 OutOfMemory 异常；我不知道事情开始中断的神奇数字......）

以下是一些细节： [.Net Compact Framework 高级内存管理](http://blogs.msdn.com/mikezintel/archive/2004/12/08/278153.aspx)

解决它的最简单方法是将内容复制到 ram 磁盘（例如 \temp）；计划 B 是使用链接 Marshal.AllocHGlobal 或 P/Invoke VirtualAlloc（可怕！）以及 GCHandle.Pin

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-12-14T00:03:28.187

根据使用 .NET CF 进行编程的经验，您会受到内存限制，并且垃圾收集与普通桌面/PC 环境中的预期不同。

在我的应用程序中，通过始终在对象超出范围之前调用 Close() 和 Dispose() 方法解决了我遇到的内存不足异常的问题。

如果您仍然有问题，另一种尝试方法是连接到应用程序关闭事件处理程序并调用 GC.Collect()。这将强制垃圾收集器立即收集所有未使用或已处置的对象。

# php - php报价带

> ID：280356
> 
> 赞同：2
> 
> 时间：2008-11-11T08:42:49.807
> 
> 标签：php, quotes, strip

在我的网页中，我希望网站向用户致意，但用户名被“单引号”包围。由于这不是为了防止 MySQL 注入，我只想在显示页面上删除我名字周围的引号。

例如：欢迎“用户”！我正在尝试找到一种方法，可以将用户周围的引号剥离并将其显示在下面的示例中。

例如：欢迎用户！

我能想到的唯一相关的代码行是：

$login = $_SESSION['登录'];

有谁知道如何去掉单行引号？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-11T08:49:10.060

如果您确定 的第一个和最后一个字符`$login`始终是 a `'`，您可以使用它[`substr()`](http://de3.php.net/manual/en/function.substr.php)来执行类似的操作

```
$login = substr($_SESSION['login'], 1, -1); // example 1 
```

`'`您可以从字符串中删除所有内容[`str_replace()`](http://de3.php.net/manual/en/function.str-replace.php)

```
$login = str_replace("'", '', $_SESSION['login']); // example 2 
```

或者你也可以使用[`trim()`](http://de3.php.net/manual/en/function.trim.php)函数，其实和例子1一样：

```
$login = trim($_SESSION['login'], "'"); // example 3 
```

我个人最喜欢的是示例 3，因为它可以轻松扩展以去除两种引用类型：

```
$login = trim($_SESSION['login'], "'\""); // example 4 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T08:48:50.670

我认为最简单的方法是使用 trim() 函数。它通常会修剪空白字符，但您可以将包含要删除的字符的字符串传递给它：

```
echo 'Welcome ' . trim($login, "'"); 
```

见[http://php.net/trim](http://php.net/trim)

# blogs - *免费*截屏应用程序和实用程序

> ID：280362
> 
> 赞同：2
> 
> 时间：2008-11-11T08:45:17.883
> 
> 标签：blogs, utilities

我知道以前在这里讨论过关于截屏工具/应用程序，但是我想我会更具体地说明我所追求的，希望它可以帮助我和其他人:)

我正在考虑在[我的博客](http://cantgrokwontgrok.blogspot.com/)上试用一些截屏视频。这有很多原因（希望对读者更有帮助，改善我的口才等）

那么，**您知道有什么好的免费截屏工具和实用程序可以开始吗？**我对目前收费的应用程序不感兴趣，因为我不想在我对媒体更加熟悉之前掏出钱！

此外，如果您自己发布了截屏视频，请随时**与您的答案**分享链接，很高兴看到制作的质量等（并为您的博客/网站带来流量）；）

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-11T09:39:11.020

我经常看到这个问题（在其他网站上）并且我对这个主题有些兴趣，所以我编制了一个小列表（只是通过查看这个问题的相关侧边栏添加了最后两个......）：

*   免费屏幕录像机 - [http://www.nbxsoft.com/screen-recorder.php（Windows，AVI](http://www.nbxsoft.com/screen-recorder.php)输出）
*   CamIt - [http://camit.sourceforge.net/（Windows、OSS](http://camit.sourceforge.net/)、命令行、WMV 输出）
*   CamStudio - [http://camstudio.org/（Windows、OSS、AVI/Flash](http://camstudio.org/)输出）
*   Wink - [http://www.debugmode.com/wink/（Windows/Linux，Flash](http://www.debugmode.com/wink/)输出）
*   Jing - [http://www.jingproject.com/](http://www.jingproject.com/) (Mac/Windows, Flash 输出)
*   Taksi - [http://taksi.sourceforge.net/（Windows](http://taksi.sourceforge.net/)、游戏/3D、OSS、AVI 输出（任何编解码器））
*   Fraps - [http://www.fraps.com/](http://www.fraps.com/)（Windows，实时视频捕获，付费软件（免费限制版？），WMV 输出）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T08:50:32.100

仅适用于 Windows 和 Linux (x86)，但试试[Wink](http://www.debugmode.com/wink/ "眨眼")。它直接导出到闪存，因此应该很容易与您的网站集成。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T09:42:34.820

静很不错，只要你只录制短片。好在它可以直接将录音或屏幕截图上传到screencast.com（如果你是jing用户，你可以在那里获得一些空闲空间）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T08:36:29.787

好的，作为后续，我有机会使用一些建议的工具。

*   [眨眼](http://www.debugmode.com/wink/)看起来不错，但只是没有切芥末。我认为它“记录”的方式非常低效，由于帧产生的间隙，放在顶部的音频也很差。
*   [CamStudio](http://camstudio.org/)的外观和效果都非常好！AVI 输出质量很好（音频和视频），运行时我没有遇到任何延迟。**但是**- 闪存转换似乎对我根本不起作用？我最终得到一个白色或小闪存文件？（阅读“无用”）**有什么建议吗？**

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T08:44:25.033

还有一些我尝试过的东西（**我可能会坚持使用**TBH ）：

使用[CamStudio](http://camstudio.org/)以 AVI 格式录制截屏视频，我的输出质量非常好，但非常**大**。我需要以足够的质量将内容重新编码以上传到网络并真正可读。

因此，我开始寻找 H.264 编码器并遇到了[这个很棒的指南](http://www.dvd-guides.com/content/view/143/59/)。这使我想到以下内容：

*   [x264](http://x264.nl/) - 一个很棒的 H.264 编码器（命令行）。
*   [SUPER](http://www.erightsoft.com/SUPER.html) - 一个**很棒**的免费编码器套件。几乎什么都做！

最后的结果呢？[我的第一次截屏！](http://cantgrokwontgrok.blogspot.com/2008/11/screencast-adding-components-to-aspnet.html)（我上传到[blip.tv](http://blip.tv/)）。

希望这可以帮助！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-08T21:41:20.037

还有[Capture Fox](https://addons.mozilla.org/en-US/firefox/addon/8090/)，它是一个 Firefox 插件。

# java - 使用弹簧方法替换的真实商业案例？

> ID：280363
> 
> 赞同：0
> 
> 时间：2008-11-11T08:46:42.577
> 
> 标签：java, spring

Spring IoC 容器为您提供了替换 bean 方法[的选项](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-arbitrary-method-replacement)。有人可以提供使用此功能解决现实生活问题的真实生活示例吗？

我可以看到这用于调整旧的遗留代码（无源代码）以与您的应用程序一起使用。但我想我会考虑直接使用遗留代码而不是 Spring 方法替换方法编写一个适配器类。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T10:09:58.320

正如文档所说，它不是“普遍有用的”功能。

A case where it may be useful though is to alter the functionality of a third party method (you don't necessarily have the source) of a final class - i.e. one whose functionality can't be modified or extended through inheritance.

I guess it would still amount to something of a hack though :)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T09:32:01.970

现在使用 spring IoC 我可以将我的 Lucene 分析器更改为我想要的任何内容，只需更改配置文件即可。

```
<bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
                <property name="locations">
                        <list>
                                <value>file.properties</value>
                        </list>
                </property>
</bean> 

<bean id="DocumentAnalyzer" class="${lucene.document_analyzer}">
</bean>

<bean id="QueryAnalyzer" class="${lucene.query_analyzer}">
</bean> 

<bean id="IndexSearcher" class="org.apache.lucene.search.IndexSearcher" scope="prototype">
  <constructor-arg>
    <value>${lucene.repository_path}</value>   
  </constructor-arg>

</bean> 
```

然后在代码中：

```
Analyzer analyzer  = (Analyzer) BeanLoader.getFactory().getBean("DocumentAnalyzer"); 
```

# dns - 如果不在域中，有什么方法可以访问 MSMQ 公共队列？

> ID：280367
> 
> 赞同：3
> 
> 时间：2008-11-11T08:49:01.840
> 
> 标签：dns, msmq

该解决方案迫切需要 MSMQ 解决方案，但不幸的是，发布服务不在域中。无论如何，是否可以从 DMZ 中的机器发布到域上的公共队列？

我可以使用网络服务发布，但这是一个额外的组件需要维护。数据库表是替代解决方案，但同样不是理想的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T00:57:15.423

有。通过使用“[格式名称](http://msdn.microsoft.com/en-us/library/ms700996(VS.85).aspx)”。您仍然会遇到[防火墙](http://support.microsoft.com/kb/183293)和身份验证问题，这不是微不足道的。

一个很好的资源是[来自管道工的伙伴的 MSMQ](http://blogs.msdn.com/johnbreakwell/)

# java - Struts - 从 JAR 文件加载结果模板（如 JSP）

> ID：280374
> 
> 赞同：4
> 
> 时间：2008-11-11T08:53:31.533
> 
> 标签：java, jsp, templates, jar, struts

当我想从不同的 JAR 文件加载模板（JSP、ZUL 等）时，如何在 struts 框架中定义它？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T06:39:50.817

据我了解，只要您的所有 JAR 都可以从 struts jar 访问（通常如果它们在 WEB-IN/lib 中）和在 web.xml 中设置的属性（非 JSP 可能需要），就应该没有额外的配置模板）。

# windows - 在高级安装程序中增加版本号

> ID：280378
> 
> 赞同：7
> 
> 时间：2008-11-11T08:56:46.317
> 
> 标签：windows, installation, windows-installer, advanced-installer

我阅读了一些关于我的高级安装程序 6.5.1 的帮助，除了手动之外找不到更改版本字符串的方法。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-01-16T03:13:59.937

这是我们的推送脚本之一的片段。Rob，也许你会发现这个也很有用——高级安装程序提供了基于现有编译的 EXE 设置安装包的 ProductVersion 的能力。我们在 TFS 中使用自定义构建任务来增加我们的构建号并设置我们的 AssemblyInfo.cs 文件，然后使用生成的主应用程序 EXE，我们可以这样做：

```
:COMPILE_AIP

SET AIP_DIR="C:\Program Files\Caphyon\Advanced Installer 7.1.3"

ECHO Advanced Installer Directiry: %AIP_DIR%

ECHO.
ECHO //////////////////////////
ECHO //Compiling AIP Files...//
ECHO //////////////////////////
ECHO.

ECHO Setting version on all installers...
ECHO Setting version on all installers... >> %DESTINATION_APP_DIR%_push_script_output.txt
%AIP_DIR%\advancedinstaller /edit "<pathtoaipfile>\installproject.aip" /SetVersion -fromfile <path to exe defining app version>
    IF NOT ERRORLEVEL 0 GOTO ERROR_HANDLER 
```

希望这可以帮助-

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-09-09T11:16:44.037

您可以使用[/SetVersion](http://www.advancedinstaller.com/user-guide/set-version.html)开关从命令行设置产品版本。在自动构建中很有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T09:47:31.767

创建 MSI 的文件通常是 XML 格式，我们创建了一个小工具，作为构建过程的一部分运行，它可以手动更改内部版本号，尝试在记事本中打开高级安装程序文件并查找“ProductVersion “ 细绳。

干杯，罗布。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-10-04T06:55:36.417

*从 Advanced Installer v9.8 开始，从文件中检索产品版本*要容易得多：右键单击编辑框，然后在[产品详细信息](http://www.advancedinstaller.com/user-guide/product-details-tab.html)选项卡上选择“从文件设置版本...”菜单项。这将使软件包的产品版本与所选文件的版本保持同步，例如您的主应用程序可执行文件。

干杯

# com - 什么可能导致 Vb6 运行时错误 430

> ID：280383
> 
> 赞同：11
> 
> 时间：2008-11-11T08:58:48.323
> 
> 标签：com, vb6

我有一个用 vb6 编写的 COM dll。当我尝试从此 dll 创建类模块的新对象时，我收到运行计时器错误 430：类不支持自动化或不支持预期的接口。有趣的是，这只发生在 IDE 外部，当我从 IDE 内部调试时，没有抛出错误，并且成功创建了类的新对象。可能是什么原因？

一般来说，我偶尔会在 COM dll 中遇到这类错误。调试 COM 问题的最佳方法是什么？我如何知道程序运行时正在使用的 dll 的路径？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-11T13:13:36.423

如果这个项目完全是在 VB6 中。造成这种情况的可能原因是 EXE 在其目录中有 DLL 二进制文件的副本。当您触发它时，它会使用该副本而不是编译后的副本。当您添加 EXE 与旧 DLL 不兼容的方法或类时。如果您进行了错误修复或仅使用内部代码，则 EXE 将运行，但它使用旧的 DLL。

将您的 DLL 设置为二进制兼容性。确保您有一个兼容目录。将最后一个版本的 DLL 放在那里。将二进制兼容性指向该 DLL。确保您的 EXE 编译到它的项目目录。从它的项目目录运行 EXE。这样，它将使用您编译的 DLL。您需要编写一个实用程序，以便您可以分别编译每个项目。使用 Virtual PC 或另一台计算机测试您的设置。

所有这些步骤将有助于避免 DLL Hell。我自己的项目有两个 6 层的 ActiveX 项目。当我采用上述方法时，我的 DLL Hell 问题几乎消失了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T19:18:59.133

兼容地阅读二进制与项目。

如果您有共享 dll，则必须小心并兼容使用二进制文件。这样，VB6 将在构建之间保持相同的 COM 签名/接口。您必须拥有一份已发布的 DLL 副本以供 VB6 进行比较——我通常有一个单独的文件夹用于存放已发布的二进制文件。二进制兼容性的限制是您不能删除公共属性或方法，也不能更改它们的签名。您可以添加新的属性和方法。

如果您必须进行重大更改（例如删除旧的公共方法），请使用项目兼容性 - 但是如果您这样做，您将必须重新编译使用共享 DLL 的所有其他应用程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T11:35:50.957

这几乎可以肯定是一个版本控制问题，有时被称为“DLL 地狱”。

背景是 .NET 世界被明确设计为让接口在保持相同名称的同时不断发展。但是在 COM 世界中，接口被认为是不可变的。

当您在 IDE 中工作时，Visual Studio 会在您每次运行解决方案时为 COM dll 创建一个新的 COM 互操作包装器。但是，除非您每次都发布和替换整个解决方案，包括全新的 COM 互操作包装器，否则您将遇到版本控制问题，即 .NET 代码需要一个 COM 接口，但看到的却是不同的。

**编辑**：出于某种原因，我假设您正在尝试使用 .NET 组件中的 COM 组件。如果整个解决方案实际上是 VB6，那么康利先生的解决方案是推荐的方法。[这是一个讨论问题的好链接](http://www.visibleprogress.com/vb_binary_compatibility.htm)。

# php - PHP 引用参数和默认 null

> ID：280385
> 
> 赞同：14
> 
> 时间：2008-11-11T09:00:36.743
> 
> 标签：php, null, pass-by-reference

假设我们有一个方法签名，例如

```
public static function explodeDn($dn, array &$keys = null, array &$vals = null,
    $caseFold = self::ATTR_CASEFOLD_NONE) 
```

我们可以通过省略后面的所有参数来轻松调用该方法`$dn`：

```
$dn=Zend_Ldap_Dn::explodeDn('CN=Alice Baker,CN=Users,DC=example,DC=com'); 
```

我们也可以使用 3 个参数调用该方法：

```
$dn=Zend_Ldap_Dn::explodeDn('CN=Alice Baker,CN=Users,DC=example,DC=com', $k, $v); 
```

并带有4个参数：

```
$dn=Zend_Ldap_Dn::explodeDn('CN=Alice Baker,CN=Users,DC=example,DC=com', $k, $v, 
    Zend_Ldap_Dn::ATTR_CASEFOLD_UPPER); 
```

但是为什么不能调用带有以下参数组合的方法，例如：

```
$dn=Zend_Ldap_Dn::explodeDn('CN=Alice Baker,CN=Users,DC=example,DC=com', $k, null, 
    Zend_Ldap_Dn::ATTR_CASEFOLD_UPPER);
$dn=Zend_Ldap_Dn::explodeDn('CN=Alice Baker,CN=Users,DC=example,DC=com', null, $v); 
```

`null`传递给方法和依赖默认值有什么区别？该约束是否写在手册中？可以绕过吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-11T09:07:22.393

这是因为您不能引用 null。

您可以引用包含 null 的变量 - 这正是默认值的作用。或者您可以将 null 作为文字值传递 - 但由于您需要一个 out 参数，因此这里不可能。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-03-15T09:27:35.903

如果要显式传递 NULL，则必须为 by-ref 参数创建一个虚拟变量，但不必在单独的行上创建该变量。您可以直接使用像 $dummy=NULL 这样的赋值表达式作为函数参数：

```
function foo (&$ref = NULL) {

    if (is_null($ref)) $ref="bar";
    echo "$ref\n";        
}

foo($dummy = NULL); //this works! 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-11-20T15:22:51.563

我自己才发现这一点，我很震惊o_O！

这是[PHP 文档](http://www.php.net/manual/en/functions.arguments.php#functions.arguments.default)所说的：

```
function makecoffee($type = "cappuccino")
{
    return "Making a cup of $type.\n";
}
echo makecoffee(); // returns "Making a cup of cappuccino."
echo makecoffee(null); // returns "Making a cup of ."
echo makecoffee("espresso"); // returns "Making a cup of espresso." 
```

我本来希望`makecoffee(null)`返回“制作一杯卡布奇诺”。我使用的一种解决方法是检查函数内部是否参数为空：

```
function makecoffee($type = null)
{
    if (is_null($type)){ 
       $type = "capuccino";
    }
    return "Making a cup of $type.\n";
} 
```

现在`makecoffee(null)`返回“制作一杯卡布奇诺”。

（我意识到这实际上并不能解决与 Zend 相关的问题，但它可能对某些人有用......）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-09-03T02:06:17.837

@托马拉克

实际上，默认值会创建一个不涉及任何引用的变量。当您通过某些东西时，这是您根本无法启动的。

我发现可以说明原因的是以下示例（我没有测试）：

```
function foo (&$ref = NULL) {
  $args = func_get_args();
  echo var_export($ref, TRUE).' - '.var_export($args, TRUE);
}
$bar = NULL;
foo();     // NULL - array()
foo($bar); // NULL - array(0 => NULL) 
```

在我看来，PHP 应该提供一种不传递某些参数的方法，例如 with
`foo($p1, , , $p4);`或类似的语法，而不是传递 NULL。
但它没有，所以你必须使用虚拟变量。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T09:15:34.373

只是为了确认[Tomalak](https://stackoverflow.com/users/18771/tomalak)[在这里](https://stackoverflow.com/questions/280385/php-by-reference-parameters-and-default-null#280397)所说的：

以下作品：

```
$k=array();
$v=null;
$dn=Zend_Ldap_Dn::explodeDn('CN=Alice Baker,CN=Users,DC=example,DC=com', $k, $v, 
    Zend_Ldap_Dn::ATTR_CASEFOLD_UPPER); 
```

不好 - 但解释清楚易懂。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-01-27T20:58:02.560

[正如@aschmecher 在对@Szczepan的答案](https://stackoverflow.com/a/9716982/2407870)的评论中指出的那样 ，这样做会`func($var = null)`产生严格的标准通知。

**一种解决方案**

这是一种不会产生任何此类警告的方法：

```
<?php
error_reporting(E_ALL | E_STRICT);

function doIt(&$x = null) {
    if($x !== null) echo "x not null: $x\n";
    $x = 2;
}

function &dummyRef() {
    $dummyRef = null;
    return $dummyRef;
}

doIt(dummyRef());

doIt(dummyRef()); 
```

**解释**

代替传入变量，我们传入返回引用的函数的结果。第二个调用`doIt(dummy())`是验证引用`$dummy`值在调用之间是否保持不变。这与显式创建变量形成对比，需要记住清除任何累积值：

```
$dummyRef = null;
doIt($dummyRef);
doIt($dummyRef); // second call would print 'x not null: 2' 
```

**应用**

因此，在 OP 的示例中，它将是：

```
$dn = Zend_Ldap_Dn::explodeDn(
    'CN=Alice Baker,CN=Users,DC=example,DC=com',
    $k,
    dummyRef(),
    Zend_Ldap_Dn::ATTR_CASEFOLD_UPPER
); 
```

**其他注意事项**

我可能担心的一件事是这种方法是否会造成内存泄漏。以下测试表明它没有：

```
<?php
function doItObj(&$x = null) {
    if(gettype($x) !== "object") echo "x not null: $x\n";
    $x = 2;
}

function &dummyObjRef() {
    $dummyObjRef = new StdClass();
    return $dummyObjRef;
}

echo "memory before: " . memory_get_usage(true) .  "\n";

for($i = 0; $i < 1000000; $i++) {
    doItObj(dummyObjRef());
}

echo "memory after: " . memory_get_usage(true) . "\n";

echo "\n$i\n"; 
```

在我的系统上（使用 PHP 5.6.4），对 memory_get_usage 的两个调用都显示为 ~ 262 KB。

# javascript - 如何在 JavaScript 中找出调用者函数？

> ID：280389
> 
> 赞同：970
> 
> 时间：2008-11-11T09:04:39.123
> 
> 标签：javascript, callstack

```
function main()
{
   Hello();
}

function Hello()
{
  // How do you find out the caller function is 'main'?
} 
```

有没有办法找出调用堆栈？

* * *

## 回答 #1

> 赞同：1055
> 
> 时间：2008-11-11T09:07:16.327

**请注意，此解决方案已弃用，根据 MDN 文档不应再使用**

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/caller](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/caller)

* * *

```
function Hello()
{
    alert("caller is " + Hello.caller);
} 
```

请注意，此功能是**非标准的**，来自[`Function.caller`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/caller)：

> **非标准**
> 此功能是非标准的，不在标准轨道上。不要在面向 Web 的生产站点上使用它：它不适用于每个用户。实现之间也可能存在很大的不兼容性，并且行为可能会在未来发生变化。

* * *

以下是 2008 年的旧答案，现代 Javascript 不再支持该答案：

```
function Hello()
{
    alert("caller is " + arguments.callee.caller.toString());
} 
```

* * *

## 回答 #2

> 赞同：160
> 
> 时间：2010-09-24T16:38:24.757

## 堆栈跟踪

您可以使用浏览器特定代码找到整个堆栈跟踪。好在[有人已经做到了](http://eriwen.com/javascript/stacktrace-update/)；这是[GitHub 上的项目代码](http://github.com/eriwen/javascript-stacktrace)。

但并非所有消息都是好消息：

1.  获取堆栈跟踪真的很慢，所以要小心（阅读[更多](http://webreflection.blogspot.com/2009/06/es5-arguments-and-callee-i-was-wrong.html)信息）。

2.  您需要定义函数名称以使堆栈跟踪清晰易读。因为如果你有这样的代码：

    ```
    var Klass = function kls() {
       this.Hello = function() { alert(printStackTrace().join('\n\n')); };
    }
    new Klass().Hello(); 
    ```

    谷歌浏览器会发出警报`... kls.Hello ( ...`，但大多数浏览器会期望在关键字之后有一个函数名称`function`，并将其视为匿名函数。`Klass`如果您不为函数命名，甚至 Chrome 都无法使用该名称`kls`。

    顺便说一句，您可以将选项传递给函数 printStackTrace，`{guess: true}`但这样做并没有发现任何真正的改进。

3.  并非所有浏览器都能为您提供相同的信息。即参数、代码列等。

* * *

## 调用函数名称

顺便说一句，如果您只想要调用函数的名称（在大多数浏览器中，但不是 IE），您可以使用：

```
arguments.callee.caller.name 
```

但请注意，此名称将是`function`关键字之后的名称。如果不获取整个函数的代码，我没有办法（即使在 Google Chrome 上）获得更多。

* * *

## 调用函数代码

并总结其余的最佳答案（Pablo Cabrera、nourdine 和 Greg Hewgill）。**您可以使用的唯一跨浏览器且真正安全的方法是：**

```
arguments.callee.caller.toString(); 
```

这将显示调用者函数的**代码**。遗憾的是，这对我来说还不够，这就是为什么我为您提供有关 StackTrace 和调用函数名称的提示（尽管它们不是跨浏览器）。

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2015-02-03T00:28:59.773

我知道您提到“在 Javascript 中”，但如果目的是调试，我认为使用浏览器的开发人员工具会更容易。这就是它在 Chrome 中的外观： ![在此处输入图像描述](https://i.stack.imgur.com/aBtUp.png) 只需将调试器放到您想要调查堆栈的位置。

* * *

## 回答 #4

> 赞同：67
> 
> 时间：2015-05-07T14:15:15.223

我通常`(new Error()).stack`在 Chrome 中使用。好消息是这还为您提供了调用者调用该函数的行号。缺点是它将堆栈的长度限制为 10，这就是我首先来到这个页面的原因。

（我使用它在执行期间收集低级构造函数中的调用堆栈，以便稍后查看和调试，因此设置断点没有用，因为它会被命中数千次）

* * *

## 回答 #5

> 赞同：53
> 
> 时间：2010-10-28T22:33:07.903

您可以获得完整的堆栈跟踪：

```
arguments.callee.caller
arguments.callee.caller.caller
arguments.callee.caller.caller.caller 
```

直到来电者是`null`.

注意：它会导致递归函数无限循环。

* * *

## 回答 #6

> 赞同：51
> 
> 时间：2009-04-06T13:47:43.603

回顾一下（并使其更清晰）......

这段代码：

```
function Hello() {
    alert("caller is " + arguments.callee.caller.toString());
} 
```

相当于：

```
function Hello() {
    alert("caller is " + Hello.caller.toString());
} 
```

显然第一位更便于移植，因为您可以更改函数的名称，例如从“Hello”到“Ciao”​​，仍然可以让整个事情正常工作。

在后者中，如果您决定重构被调用函数的名称（Hello），您将不得不更改它的所有出现:(

* * *

## 回答 #7

> 赞同：49
> 
> 时间：2016-01-18T10:58:13.617

如果您不打算在 IE < 11 中运行它，那么[console.trace()](https://developer.mozilla.org/en-US/docs/Web/API/Console/trace)将适合。

```
function main() {
    Hello();
}

function Hello() {
    console.trace()
}

main()
// Hello @ VM261:9
// main @ VM261:4 
```

* * *

## 回答 #8

> 赞同：28
> 
> 时间：2017-11-16T22:40:47.353

我会这样做：

```
function Hello() {
  console.trace();
} 
```

* * *

## 回答 #9

> 赞同：28
> 
> 时间：2019-07-14T01:09:25.160

在 ES6 和 Strict 模式下，使用以下方式获取 Caller 函数

```
console.log((new Error()).stack.split("\n")[2].trim().split(" ")[1]) 
```

请注意，如果没有调用者或没有先前的堆栈，上述行将引发异常。相应地使用。

要获取被调用者（当前函数名），请使用：

```
console.log((new Error()).stack.split("\n")[1].trim().split(" ")[1]) 
```

* * *

## 回答 #10

> 赞同：23
> 
> 时间：2015-06-06T21:01:16.960

您可以使用 Function.Caller 来获取调用函数。使用 argument.caller 的旧方法被认为是过时的。

下面的代码说明了它的用法：

```
function Hello() { return Hello.caller;}

Hello2 = function NamedFunc() { return NamedFunc.caller; };

function main()
{
   Hello();  //both return main()
   Hello2();
} 
```

关于过时的 argument.caller 的说明： [https ://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/arguments/caller](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/arguments/caller)

注意 Function.caller 是非标准的：[https ://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/caller](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/caller)

* * *

## 回答 #11

> 赞同：21
> 
> 时间：2014-03-04T07:14:20.333

看起来这是一个非常解决的问题，但我最近发现[在“严格模式”下不允许被调用者，](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope/arguments/callee)所以为了我自己的使用，我编写了一个类，该类将从调用它的位置获取路径。它[是一个小助手库的一部分，](https://github.com/QueueHammer/codecraftsman.js/blob/master/codecraftsman.js)如果您想独立使用代码，请更改用于返回调用者堆栈跟踪的偏移量（使用 1 而不是 2）

```
function ScriptPath() {
  var scriptPath = '';
  try {
    //Throw an error to generate a stack trace
    throw new Error();
  }
  catch(e) {
    //Split the stack trace into each line
    var stackLines = e.stack.split('\n');
    var callerIndex = 0;
    //Now walk though each line until we find a path reference
    for(var i in stackLines){
      if(!stackLines[i].match(/http[s]?:\/\//)) continue;
      //We skipped all the lines with out an http so we now have a script reference
      //This one is the class constructor, the next is the getScriptPath() call
      //The one after that is the user code requesting the path info (so offset by 2)
      callerIndex = Number(i) + 2;
      break;
    }
    //Now parse the string for each section we want to return
    pathParts = stackLines[callerIndex].match(/((http[s]?:\/\/.+\/)([^\/]+\.js)):/);
  }

  this.fullPath = function() {
    return pathParts[1];
  };

  this.path = function() {
    return pathParts[2];
  };

  this.file = function() {
    return pathParts[3];
  };

  this.fileNoExt = function() {
    var parts = this.file().split('.');
    parts.length = parts.length != 1 ? parts.length - 1 : 1;
    return parts.join('.');
  };
} 
```

* * *

## 回答 #12

> 赞同：20
> 
> 时间：2008-11-11T10:56:21.177

```
function Hello() {
    alert(Hello.caller);
} 
```

* * *

## 回答 #13

> 赞同：18
> 
> 时间：2008-11-11T09:50:39.297

`*arguments.callee.caller`由于`arguments.caller`已**弃用**，因此使用起来更安全...

* * *

## 回答 #14

> 赞同：18
> 
> 时间：2017-07-13T05:36:43.987

[heystewart 的回答](https://stackoverflow.com/a/30103737/881441)和[JiarongWu 的回答](https://stackoverflow.com/a/43674446/881441)都提到该`Error`对象可以访问`stack`.

这是一个例子：

```
function main() {
  Hello();
}

function Hello() {
  var stack = new Error().stack;
  // N.B. stack === "Error\n  at Hello ...\n  at main ... \n...."
  var m = stack.match(/.*?Hello.*?\n(.*?)\n/);
  if (m) {
    var caller_name = m[1];
    console.log("Caller is:", caller_name)
  }
}

main();
```

不同的浏览器以不同的字符串格式显示堆栈：

```
Safari  : Caller is: main@https://stacksnippets.net/js:14:8
Firefox : Caller is: main@https://stacksnippets.net/js:14:3
Chrome  : Caller is:     at main (https://stacksnippets.net/js:14:3)
IE Edge : Caller is:    at main (https://stacksnippets.net/js:14:3)
IE      : Caller is:    at main (https://stacksnippets.net/js:14:3) 
```

大多数浏览器会使用`var stack = (new Error()).stack`. 在 Internet Explorer 中，堆栈将是未定义的 - 您必须抛出一个真正的异常来检索堆栈。

`stack`结论：使用对象中的可以确定“main”是“Hello”的调用者 `Error`。事实上，它会在`callee`/`caller`方法不起作用的情况下起作用。它还将向您显示上下文，即源文件和行号。但是，需要努力使解决方案跨平台。

* * *

## 回答 #15

> 赞同：17
> 
> 时间：2018-02-26T10:02:40.740

# 2018 更新

[`caller`在严格模式下被禁止](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/caller)。这是使用（非标准）[`Error`堆栈](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error/Stack)的替代方法。

以下函数似乎在 Firefox 52 和 Chrome 61-71 中完成了这项工作，尽管它的实现对两个浏览器的日志记录格式做了很多假设，并且应该谨慎使用，因为它会引发异常并可能执行两个正则表达式匹配之前完成。

```
'use strict';
const fnNameMatcher = /([^(]+)@|at ([^(]+) \(/;

function fnName(str) {
  const regexResult = fnNameMatcher.exec(str);
  return regexResult[1] || regexResult[2];
}

function log(...messages) {
  const logLines = (new Error().stack).split('\n');
  const callerName = fnName(logLines[1]);

  if (callerName !== null) {
    if (callerName !== 'log') {
      console.log(callerName, 'called log with:', ...messages);
    } else {
      console.log(fnName(logLines[2]), 'called log with:', ...messages);
    }
  } else {
    console.log(...messages);
  }
}

function foo() {
  log('hi', 'there');
}

(function main() {
  foo();
}());
```

* * *

## 回答 #16

> 赞同：12
> 
> 时间：2018-03-14T09:49:23.917

只需控制台记录您的错误堆栈。然后你就可以知道你是怎么被叫到的

```
const hello = () => {
  console.log(new Error('I was called').stack)
}

const sello = () => {
  hello()
}

sello()
```

* * *

## 回答 #17

> 赞同：11
> 
> 时间：2008-11-11T10:19:20.237

尝试访问这个：

```
arguments.callee.caller.name 
```

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2012-09-07T15:32:01.747

我想在这里添加我的小提琴：

[http://jsfiddle.net/bladnman/EhUm3/](http://jsfiddle.net/bladnman/EhUm3/)

我测试了这是 chrome、safari 和 IE（10 和 8）。工作正常。只有 1 个功能很重要，所以如果你被大小提琴吓到了，请阅读下文。

注意：这个小提琴中有很多我自己的“样板”。如果您愿意，您可以删除所有这些并使用拆分。这只是我开始依赖的一组“超安全”功能。

那里还有一个“JSFiddle”模板，我用于许多小提琴来简单地快速摆弄。

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2012-03-15T03:46:28.250

如果您只想要函数名称而不是代码，并且想要一个独立于浏览器的解决方案，请使用以下内容：

```
var callerFunction = arguments.callee.caller.toString().match(/function ([^\(]+)/)[1]; 
```

请注意，如果没有调用函数，则上述将返回错误，因为数组中没有 [1] 元素。要解决此问题，请使用以下命令：

```
var callerFunction = (arguments.callee.caller.toString().match(/function ([^\(]+)/) === null) ? 'Document Object Model': arguments.callee.caller.toString().match(/function ([^\(]+)/)[1], arguments.callee.toString().match(/function ([^\(]+)/)[1]); 
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2014-04-08T17:59:18.403

只是想让你知道在**PhoneGap/Android**上`name`似乎没有工作。但`arguments.callee.caller.toString()`会成功的。

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2012-09-12T08:35:44.517

在这里，除了 之外的所有内容都被RegExp`functionname`剥离。`caller.toString()`

```
<!DOCTYPE html>
<meta charset="UTF-8">
<title>Show the callers name</title><!-- This validates as html5! -->
<script>
main();
function main() { Hello(); }
function Hello(){
  var name = Hello.caller.toString().replace(/\s\([^#]+$|^[^\s]+\s/g,'');
  name = name.replace(/\s/g,'');
  if ( typeof window[name] !== 'function' )
    alert ("sorry, the type of "+name+" is "+ typeof window[name]);
  else
    alert ("The name of the "+typeof window[name]+" that called is "+name);
}
</script> 
```

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2016-04-13T11:12:59.750

这是一个[获取完整堆栈跟踪](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/caller)的函数：

```
function stacktrace() {
var f = stacktrace;
var stack = 'Stack trace:';
while (f) {
  stack += '\n' + f.name;
  f = f.caller;
}
return stack;
} 
```

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2020-02-24T06:55:09.210

请注意，您不能在 Node.js 中使用[Function.caller ，而是使用](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/caller)[caller-id](https://www.npmjs.com/package/caller-id)包。例如：

```
var callerId = require('caller-id');

function foo() {
    bar();
}
function bar() {
    var caller = callerId.getData();
    /*
    caller = {
        typeName: 'Object',
        functionName: 'foo',
        filePath: '/path/of/this/file.js',
        lineNumber: 5,
        topLevelFlag: true,
        nativeFlag: false,
        evalFlag: false
    }
    */
} 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2013-06-22T20:33:26.763

试试下面的代码：

```
function getStackTrace(){
  var f = arguments.callee;
  var ret = [];
  var item = {};
  var iter = 0;

  while ( f = f.caller ){
      // Initialize
    item = {
      name: f.name || null,
      args: [], // Empty array = no arguments passed
      callback: f
    };

      // Function arguments
    if ( f.arguments ){
      for ( iter = 0; iter<f.arguments.length; iter++ ){
        item.args[iter] = f.arguments[iter];
      }
    } else {
      item.args = null; // null = argument listing not supported
    }

    ret.push( item );
  }
  return ret;
} 
```

在 Firefox-21 和 Chromium-25 中为我工作。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2016-03-04T15:29:18.073

解决此问题的另一种方法是简单地将调用函数的名称作为参数传递。

例如：

```
function reformatString(string, callerName) {

    if (callerName === "uid") {
        string = string.toUpperCase();
    }

    return string;
} 
```

现在，您可以像这样调用该函数：

```
function uid(){
    var myString = "apples";

    reformatString(myString, function.name);
} 
```

我的示例使用了对函数名称的硬编码检查，但您可以轻松地使用 switch 语句或其他一些逻辑来执行您想要的操作。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2016-03-28T05:34:40.950

据我所知，我们从这样的给定来源有两种方法-

1.  [arguments.caller](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/arguments/caller)

    ```
    function whoCalled()
    {
        if (arguments.caller == null)
           console.log('I was called from the global scope.');
        else
           console.log(arguments.caller + ' called me!');
    } 
    ```

2.  [函数调用者](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/caller)

    ```
    function myFunc()
    {
       if (myFunc.caller == null) {
          return 'The function was called from the top!';
       }
       else
       {
          return 'This function\'s caller was ' + myFunc.caller;
        }
    } 
    ```

认为你有你的答案:)。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2016-03-29T06:40:45.853

我试图用这个问题来解决这个问题和当前的赏金。

赏金要求在*严格*模式下获得调用者，我可以看到这样做的唯一方法是引用在严格模式*之外*声明的函数。

例如，以下内容是非标准的，但已使用之前 (29/03/2016) 和当前 (2018 年 8 月 1 日) 版本的 Chrome、Edge 和 Firefox 进行了测试。

```
function caller()
{
   return caller.caller.caller;
}

'use strict';
function main()
{
   // Original question:
   Hello();
   // Bounty question:
   (function() { console.log('Anonymous function called by ' + caller().name); })();
}

function Hello()
{
   // How do you find out the caller function is 'main'?
   console.log('Hello called by ' + caller().name);
}

main();
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2017-02-07T17:52:15.847

为什么上面的所有解决方案看起来都像火箭科学。同时，它不应该比这个片段更复杂。所有功劳归于这个人

[如何在 JavaScript 中找出调用者函数？](https://stackoverflow.com/questions/280389/how-do-you-find-out-the-caller-function-in-javascript#answer-4047670)

```
var stackTrace = function() {

    var calls = [];
    var caller = arguments.callee.caller;

    for (var k = 0; k < 10; k++) {
        if (caller) {
            calls.push(caller);
            caller = caller.caller;
        }
    }

    return calls;
};

// when I call this inside specific method I see list of references to source method, obviously, I can add toString() to each call to see only function's content
// [function(), function(data), function(res), function(l), function(a, c), x(a, b, c, d), function(c, e)] 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2017-04-28T07:27:45.343

我认为以下代码段可能会有所帮助：

```
window.fnPureLog = function(sStatement, anyVariable) {
    if (arguments.length < 1) { 
        throw new Error('Arguments sStatement and anyVariable are expected'); 
    }
    if (typeof sStatement !== 'string') { 
        throw new Error('The type of sStatement is not match, please use string');
    }
    var oCallStackTrack = new Error();
    console.log(oCallStackTrack.stack.replace('Error', 'Call Stack:'), '\n' + sStatement + ':', anyVariable);
} 
```

执行代码：

```
window.fnPureLog = function(sStatement, anyVariable) {
    if (arguments.length < 1) { 
        throw new Error('Arguments sStatement and anyVariable are expected'); 
    }
    if (typeof sStatement !== 'string') { 
        throw new Error('The type of sStatement is not match, please use string');
    }
    var oCallStackTrack = new Error();
    console.log(oCallStackTrack.stack.replace('Error', 'Call Stack:'), '\n' + sStatement + ':', anyVariable);
}

function fnBsnCallStack1() {
    fnPureLog('Stock Count', 100)
}

function fnBsnCallStack2() {
    fnBsnCallStack1()
}

fnBsnCallStack2(); 
```

日志如下所示：

```
Call Stack:
    at window.fnPureLog (<anonymous>:8:27)
    at fnBsnCallStack1 (<anonymous>:13:5)
    at fnBsnCallStack2 (<anonymous>:17:5)
    at <anonymous>:20:1 
Stock Count: 100 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2018-10-22T09:19:36.073

由于以前的答案都不像我正在寻找的那样工作（只获取最后一个函数调用者而不是作为字符串或调用堆栈的函数）我在这里为像我这样的人发布我的解决方案，并希望这对他们有用：

```
function getCallerName(func)
{
  if (!func) return "anonymous";
  let caller = func.caller;
  if (!caller) return "anonymous";
  caller = caller.toString();
  if (!caller.trim().startsWith("function")) return "anonymous";
  return caller.substring(0, caller.indexOf("(")).replace("function","");
}

//  Example of how to use "getCallerName" function

function Hello(){
console.log("ex1  =>  " + getCallerName(Hello));
}

function Main(){
Hello();

// another example
console.log("ex3  =>  " + getCallerName(Main));
}

Main();
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2020-12-06T13:34:01.883

对我来说效果很好，您可以选择要返回多少功能：

```
function getCaller(functionBack= 0) {
    const back = functionBack * 2;
    const stack = new Error().stack.split('at ');
    const stackIndex = stack[3 + back].includes('C:') ? (3 + back) : (4 + back);
    const isAsync = stack[stackIndex].includes('async');
    let result;
    if (isAsync)
      result = stack[stackIndex].split(' ')[1].split(' ')[0];
    else
      result = stack[stackIndex].split(' ')[0];
    return result;
} 
```

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2021-11-04T10:03:46.237

我可以在 2021 年使用这些并获取从调用者函数开始的堆栈：

```
1\. console.trace();
2\. console.log((new Error).stack)

// do the same as #2 just with better view
3\. console.log((new Error).stack.split("\n")) 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2015-11-03T01:22:49.130

如果您出于某种原因确实需要该功能并希望它与跨浏览器兼容并且不必担心严格的内容并且向前兼容，那么请传递此参考：

```
function main()
{
   Hello(this);
}

function Hello(caller)
{
    // caller will be the object that called Hello. boom like that... 
    // you can add an undefined check code if the function Hello 
    // will be called without parameters from somewhere else
} 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2021-10-29T12:48:00.373

```
function main()
{
   Hello();
}

function Hello()
{
  new Error().stack
} 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2022-01-29T11:33:37.683

您可以`debugger;`在函数中使用。打开无关元素并监视调用堆栈；

# sql-server - 从 SQL 2000 sp 获取我的自定义错误消息

> ID：280399
> 
> 赞同：0
> 
> 时间：2008-11-11T09:08:37.540
> 
> 标签：sql-server, .net-3.5, stored-procedures

我有一个带有以下伪代码的 sp...

```
 BEGIN TRANSACTION
            set @errorLocation='Deleting Permissions'
            DELETE [tblUsrPermissions]
            WHERE
                lngUserID = @lngUserID
            if @@error>0
            begin
                goto roll_back
            end

            COMMIT TRANSACTION
            set @errorLocation='' --clear error messages
            select @errorLocation --return success
    return
roll_back:
    IF @@TRANCOUNT > 0
        ROLLBACK TRANSACTION -- there were errors, rollback
    select @errorLocation 
```

我正在使用 .NET sqlclient sql datareader，并且在调用 ExecuteScalar 函数时出现代码异常 - 在 sp 中的删除操作期间发生错误。

我想获取我的自定义错误消息而不是异常。我能做些什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T09:26:46.630

使用 raiserror 将您的错误传递给客户端。请注意，根据错误的严重程度，您的 raiserror 消息可能永远不会被命中。因此，要获得更完整的答案，请提供您得到的原始错误以及您在哪里得到它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T12:19:38.607

如果您使用的是 SqlServer 2005 或更高版本，请将您的代码放在[TRY 块](http://msdn.microsoft.com/en-us/library/ms175976.aspx)中，然后在 catch 块中调用[RAISERROR](http://msdn.microsoft.com/en-us/library/ms178592.aspx)

# ssis - 如何构建 CSV 和 SQL 之间的数据传输？

> ID：280403
> 
> 赞同：0
> 
> 时间：2008-11-11T09:15:18.213
> 
> 标签：ssis, csv

我正在构建一系列旨在执行以下操作的 SSIS 包：

1.) 将几千行从 CSV 文件导入到一系列 SQL 2005 表中 2.) 将几千行导出到一系列 CSV 文件中

在深入研究之前，我有一些担忧：

a.) 在我导入 csv 文件之前，我首先要检查我正在导入的文件是否未打开或未被其他应用程序写入。有什么办法可以在 SSIS 中做到这一点？

b.) 因为我要通过 VPN 传输数据，所以我担心首先从 CSV 文件传输数据，然后在我的 sql 表中转换数据。这不仅仅是直接导入 - 我必须将 csv 行中的一些列转换为我的 SQL 表的有效值，并根据我的数据库中的现有数据检查它们是插入还是更新。我是否应该首先考虑将 csv 数据传输到临时表中，然后再考虑将进一步的转换写入我的主表（我认为这可能比即时尝试这两个步骤更强大。）

非常感谢您的建议！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T09:54:40.513

一个。如果您的文件正在与脚本块一起使用，您可以检查控制流。

湾。首先将您的文件复制到本地区域，然后从该位置导入它们。使用暂存数据库将文件导入 rawtable 然后转换并决定在插入这些表后将行插入 table4update 或 table4insert ，您可以使用单个 sql 语句（控制流）插入/更新目标表。不要忘记分批思考。在阅读之前截断您的临时表。

# c# - 将 Windows Mobile 6 表单置于最前面

> ID：280406
> 
> 赞同：2
> 
> 时间：2008-11-11T09:18:15.697
> 
> 标签：c#, winforms, windows-mobile

我在将 windows mobile 6 表单放在前面时遇到问题。我已经尝试过这样的事情

```
Form1 testForm = new Form1();
testForm.Show();
testForm.BringToFront();
testForm.Focus(); 
```

但它总是在包含该代码的表单后面。唯一对我有用的是

```
testForm.TopMost = true; 
```

或隐藏（）；旧表格，然后显示新表格，但我想避免隐藏另一种表格。TopMost 无论如何都不是很干净，因为它使用了多种其他形式。

另一件有效的事情是

```
testForm.ShowDialog(); 
```

但我不想显示表单模式。

把它剪短。我只想在另一个表单前面显示新表单，如果我关闭它，我想再次看到旧表单。

也许有人可以帮助我解决这个问题。谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T09:57:32.230

我没有在 WM6 中尝试过，但是你可以使用一些 pinvoke 来调用 Win32 函数：

```
[DllImport("coredll.dll")]
private static extern IntPtr FindWindow(string lpClassName, string lpWindowName);

[DllImport("coredll.dll", EntryPoint="SetForegroundWindow")]
private static extern int SetForegroundWindow(IntPtr hWnd); 
```

调用 FindWindow 获取句柄，然后调用 SetForegroundWindow。您可能会发现有用的其他功能：

ShowWindow、BringWindowToTop、SetWindowPos

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T22:23:57.267

试试这个：

在表格上放一个计时器。
设置它的滴答声短说100毫秒。
在 timer_Tick 事件中
- 禁用计时器（因此它不会再次滴答）
- 加载子表单。

此外，您可能想查看[form.owner](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.owner(VS.80).aspx)属性：
“*当一个表单由另一个表单拥有时，它会被最小化并与所有者表单一起关闭。例如，如果 Form2 由表单 Form1 拥有，如果 Form1 被关闭或最小化, Form2 也被关闭或最小化。* ***拥有的表单也永远不会显示在其所有者表单的后面***。”

# c# - 你如何找到调用者函数？

> ID：280413
> 
> 赞同：5
> 
> 时间：2008-11-11T09:23:55.963
> 
> 标签：c#, language-features, callstack

**关闭为[“如何找到调用当前方法的方法？”的完全相同的副本](https://stackoverflow.com/questions/171970/how-can-i-find-the-method-that-called-the-current-method)**

这[可以](https://stackoverflow.com/questions/280389/javascript-how-do-you-find-the-caller-function)用c#吗？

```
void main()
{
   Hello();
}

void Hello()
{
  // how do you find out the caller is function 'main'?
} 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-11T09:29:25.937

```
Console.WriteLine(new StackFrame(1).GetMethod().Name); 
```

但是，这并不可靠，尤其是优化（例如 JIT 内联）可能会与感知到的堆栈帧发生冲突。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T09:31:46.807

从[这里](http://bytes.com/forum/thread213910.html)：

```
System.Diagnostics.StackTrace st = new System.Diagnostics.StackTrace(1);
System.Diagnostics.StackFrame sf = st.GetFrame(0);
string msg = sf.GetMethod().DeclaringType.FullName + "." +
sf.GetMethod().Name;
MessageBox.Show( msg ); 
```

但也有一个评论，这不能与多线程一起工作。

# browser - 由于两个请求的响应混淆而获得下载提示

> ID：280414
> 
> 赞同：1
> 
> 时间：2008-11-11T09:24:09.803
> 
> 标签：browser, http-headers

我的页面中有 4 个 iframe，当我向下滚动网页时，它们的 src 会发生变化。我越快滚动 src 的更改越频繁。如果我滚动得足够快，我会在 FF 中收到下载提示。

下载的文件包含乱码文本，后跟 http 响应标头，然后是更多乱码文本。当我在 ethereal 上捕获它时，我看到浏览器在其中一个响应完成之前编写了请求标头，然后服务器完成了未完成响应的响应，然后是响应标头，然后是中间请求的响应。

这也发生在 IE 上，我没有得到下载提示，而是在我的一个 iframe 中得到了乱码。

错误在客户端或服务器上，我该如何解决？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-09-28T14:08:40.857

也许使用某种队列。

如果你使用 jquery，你可以试试这个插件：

[jQuery-ajaxq](http://code.google.com/p/jquery-ajaxq)

问候

# mysql - while循环中的多个mysql_real_query（）

> ID：280421
> 
> 赞同：3
> 
> 时间：2008-11-11T09:26:59.203
> 
> 标签：mysql

似乎当我在一个连续的 while 循环中有一个 mysql_real_query() 函数时，查询将被正常执行。

但是，如果多个 mysql_real_query() 在 while 循环内，则一个接一个。根据查询，有时第一个查询和第二个查询都不会正确执行。

这对我来说似乎是一个线程问题。我想知道mysql c api是否有办法处理这个问题？有谁知道如何处理这个？mysql_free_result() 不起作用，因为我什至没有存储结果。

```
//keep polling as long as stop character '-' is not read
while(szRxChar != '-')
{
    // Check if a read is outstanding
    if (HasOverlappedIoCompleted(&ovRead))
    {
        // Issue a serial port read
        if (!ReadFile(hSerial,&szRxChar,1,
                &dwBytesRead,&ovRead))
        {
            DWORD dwErr = GetLastError();
            if (dwErr!=ERROR_IO_PENDING)
                return dwErr;
        }
    }

    // Wait 5 seconds for serial input
    if (!(HasOverlappedIoCompleted(&ovRead)))
    {
        WaitForSingleObject(hReadEvent,RESET_TIME);
    }

    // Check if serial input has arrived
    if (GetOverlappedResult(hSerial,&ovRead,
            &dwBytesRead,FALSE))
    {
        // Wait for the write
        GetOverlappedResult(hSerial,&ovWrite,
            &dwBytesWritten,TRUE);

        //load tagBuffer with byte stream
        tagBuffer[i] = szRxChar;
        i++;
        tagBuffer[i] = 0; //char arrays are \0 terminated

        //run query with tagBuffer
        if( strlen(tagBuffer)==PACKET_LENGTH )
        {
            sprintf(query,"insert into scan (rfidnum) values ('");
            strcat(query, tagBuffer);
            strcat(query, "')");
            mysql_real_query(&mysql,query,(unsigned int)strlen(query));

            i=0;
        }

        mysql_real_query(&mysql,"insert into scan (rfidnum) values ('2nd query')",(unsigned int)strlen("insert into scan (rfid) values ('2nd query')"));

        mysql_free_result(res);
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T22:07:33.363

始终检查 API 调用的返回值。

[`mysql_real_query()`](http://dev.mysql.com/doc/refman/5.0/en/mysql-real-query.html)返回一个整数。如果调用有效，则该值为零，如果出现错误，则该值为非零。

检查返回值，如果它不为零，则报告它：

```
if ((err = mysql_real_query(&mysql,"insert into scan (rfidnum) values ('2nd query')",
  (unsigned int)strlen("insert into scan (rfid) values ('2nd query')"))) != 0)
{
  // report err here, get additional information from these two API calls:
  errno = mysql_errno(&mysql);
  errmsg = mysql_error(&mysql);
} 
```

**更新：** 如果你得到一个非零的结果，你需要检查`mysql_error()`找出哪个错误。既然您说如果第二个查询是 a 会出现错误`SELECT`，我猜它是`CR_COMMANDS_OUT_OF_SYNC`，这意味着 API 认为有一些结果未决（即使结果由零行组成）。在完成获取 a（或调用存储过程）的结果之前，您无法开始下一个 SQL 查询`SELECT`，即使该查询的结果为空。

以下是 MySQL 文档中的简要说明：“ [Commands out of sync](http://dev.mysql.com/doc/refman/5.0/en/commands-out-of-sync.html) ”

您需要使用[`mysql_free_result()`](http://dev.mysql.com/doc/refman/5.0/en/mysql-free-result.html)才能运行另一个查询。这意味着您需要先使用[`mysql_use_result()`](http://dev.mysql.com/doc/refman/5.0/en/mysql-use-result.html)才能释放它。

`mysql_use_result()`这是文档的摘录：

> 在调用 mysql_query() 或 mysql_real_query() 之后，必须为每个成功生成结果集的语句（SELECT、SHOW、DESCRIBE、EXPLAIN、CHECK TABLE 等）调用 mysql_store_result() 或 mysql_use_result()。完成结果集后，还必须调用 mysql_free_result()。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T09:46:16.653

好的，出于测试目的，将您的`tagBuffer`变量从第一次`mysql_real_query`调用中取出并将其替换为常量，例如您的第二次测试查询。

那时你只是重复插入两个常量字符串。这**真的**应该工作。

如果这确实有效，那么我们必须找出问题所在`tagBuffer`。它是否会收到不寻常的字符，以某种方式使 MySQL 感到困惑，但在单个查询案例中没有发现它？

# c# - 永远不会返回 HttpHandler 响应

> ID：280426
> 
> 赞同：3
> 
> 时间：2008-11-11T09:29:27.967
> 
> 标签：c#, asp.net, httphandler

我们有一个相当复杂的 httphandler 来处理图像。基本上，它以所请求的任何大小流式传输图像的任何部分。一些客户端使用这个处理程序没有任何问题。但是我们有一个位置给我们带来了问题，现在它也给我的开发环境带来了问题。

发生的情况是客户端从未收到任何请求。所以请求 1 和 2 很好，但请求 3 和 4 永远不会结束。

*   在调试时，我可以看到服务器已准备好并已完成请求。
*   然而，客户端仍在等待结果（使用 fiddler2 进行调试显示没有收到响应）

我们用来流式传输图像的代码是

```
 if (!context.Response.IsClientConnected)
        {
            imageStream.Close();
            imageStream.Dispose();
            return;
        }

        context.Response.BufferOutput = true;
        context.Response.ContentType = "image/" + imageformat;

        context.Response.AppendHeader("Content-Length", imageStream.Length.ToString());

        if (imageStream != null && imageStream.Length > 0 && context.Response.IsClientConnected)
            context.Response.BinaryWrite(imageStream.ToArray());

        if (context.Response.IsClientConnected)
            context.Response.Flush();

        imageStream.Close();
        imageStream.Dispose(); 
```

imageStream 是一个包含图像内容的 MemoryStream。

在调用 response.Flush() 之后，我们进行了更多清理并将摘要写入事件日志。

我们还在每次请求后调用 GC.Collect()，因为我们在内存中使用的对象变得非常大。我知道这不是一个好的做法，但它会给我们带来麻烦吗？

不返回请求的问题发生在 IIS 5 (Win XP) 和 IIS 6 (Win 2003) 上，我们使用 .NET framework v2。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T09:34:28.830

首先，有更好的处理流的方法，即对整个事物使用数组（即，这里`MemoryStream` *可能*没有必要）。

我会设想一个循环：

```
const int BUFFER_SIZE = 4096; // pick your poison
bute[] buffer = new byte[BUFFER_SIZE];
int bytesRead;

while((bytesRead = inStream.Read(buffer, 0, BUFFER_SIZE)) > 0)
{
    outStream.Write(buffer, 0, bytesRead);
} 
```

您还应该在禁用缓冲 ( `.Response.BufferOutput = false`) 的情况下执行此操作。

问题是，我怀疑你没有写足够的数据/关闭响应（`.Response.Close()`）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T09:34:58.970

垃圾收集不应该是问题。你为什么设置`BufferOutput`为true呢？鉴于您只想直接写入数据，我认为将其设置为 false 会更合适。

我建议您在诊断中降低一级：使用[Wireshark](http://www.wireshark.org/)准确查看网络级别发生的情况。Fiddler 非常适合 HTTP 级别，但有时您需要更多细节。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T15:45:17.957

客户端将限制它向任何一台服务器发出的同时请求的数量。此外，当从需要会话状态（默认）的资源请求时，对需要会话状态的资源的其他请求将被阻止。

使用时，`HttpWebResponse`您必须处理该对象或其`GetResponseStream`方法返回的流以完成连接。

您的代码非常混乱。您已经打开了缓冲，设置了内容长度并使用了刷新。这会导致一些奇怪的 HTTP 标头。通常，在您使用缓冲时，会将 Content-Length 标头的设置留给 ASP.NET 来处理。

当您使用刷新时，ASP.NET 假定您随后可能会发送更多数据。在这种情况下，它将使用分块传输。一旦响应完成，就会为最终块发送最后一组标头，每个块作为其自己的长度标头，内容的总长度是从这些标头中得出的。第一个块不应该*有*Content-Length 标头，但是您的代码正在添加该标头。

如果您关闭缓冲并自己将字节泵入输出流，**那么**您应该自己设置 Content-Length 标头，因为有效地关闭缓冲意味着您对发送给客户端的确切内容负责。Marc 的代码是这种泵的一个简单示例，尽管我会使用更大的缓冲区，或者在 MemoryStream 上，WriteTo 方法会更有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T11:52:55.367

我们还使用 WebRequests 来收集更多信息。那些阻止了连接。将 usings 放在 WebResponses 周围就可以了。

```
using (HttpWebResponse test_resp = (HttpWebResponse)test_req.GetResponse())
{
} 
```

我不知道那些会阻止其他请求等...

# javascript - 键盘向上和向下箭头

> ID：280428
> 
> 赞同：10
> 
> 时间：2008-11-11T09:30:08.260
> 
> 标签：javascript, html, autocomplete, keyboard, arrow-keys

我有一个自动完成搜索，通过输入几个字符，它将显示所有与输入的字符匹配的名称。我正在使用 DIV 标记在 jsp 中填充这些数据，通过使用鼠标我可以选择名称。但我想使用键盘上下箭头选择要选择的 DIV 标记中的名称。谁能帮我解决这个问题。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-17T17:56:24.087

使用`onkeydown`and`onkeyup`事件检查结果 div 中的按键事件：

```
var UP = 38;
var DOWN = 40;
var ENTER = 13;

var getKey = function(e) {
  if(window.event) { return e.keyCode; }  // IE
  else if(e.which) { return e.which; }    // Netscape/Firefox/Opera
};

var keynum = getKey(e);

if(keynum === UP) {
  //Move selection up
}

if(keynum === DOWN) {
  //Move selection down
}

if(keynum === ENTER) {
  //Act on current selection
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-25T14:18:52.120

复制并粘贴这段代码并尝试..

```
<style>
div.active{ 
        background: lightblue
}
</style>
<center>
<input type="text" id="tb">
<div id="Parent" style="position:absolute;display:block;left:428px; width:146px;top:38px; height:100px; border: 2px solid lightblue; overflow:auto;">  
<div id="childOne">1 </div>     
<div id="childOne">2 </div>     
<div id="childOne">3 </div>     
<div id="childOne">4 </div>
<div id="childOne">5 </div>
<div id="childOne">6 </div>
<div id="childOne">7 </div>
<div id="childOne">8 </div>
<div id="childOne">9 </div>
<div id="childOne">10 </div>
</div>
</center>
<script type="text/javascript">
    var scrolLength = 19;
    function autocomplete( textBoxId, containerDivId ) { 
        var ac = this;    
        this.textbox     = document.getElementById(textBoxId);    
        this.div         = document.getElementById(containerDivId);    
        this.list        = this.div.getElementsByTagName('div');    
        this.pointer     = null;    
        this.textbox.onkeydown = function( e ) {
            e = e || window.event;        
            switch( e.keyCode ) {            
            case 38: //up                
                ac.selectDiv(-1);                
            break;            
            case 40: //down                
                ac.selectDiv(1);                
            break;        }    
            }    

            this.selectDiv = function( inc ) {        
                 if(this.pointer > 1){
                     scrollDiv();
                 }
                 if(this.pointer == 0)
                    document.getElementById("Parent").scrollTop = 0;   
                if( this.pointer !== null && this.pointer+inc >= 0 && this.pointer+inc < this.list.length ) { 
                    this.list[this.pointer].className = '';            
                    this.pointer += inc;            
                    this.list[this.pointer].className = 'active';            
                    this.textbox.value = this.list[this.pointer].innerHTML; 
                }
                if( this.pointer === null ) {            

                    this.pointer = 0;            
                    scrolLength = 20;
                    this.list[this.pointer].className = 'active';            
                    this.textbox.value = this.list[this.pointer].innerHTML;        
                }    
            }
            function scrollDiv(){
                 if(window.event.keyCode == 40){
                     document.getElementById("Parent").scrollTop = scrolLength;
                     scrolLength = scrolLength + 19;  
                 }           
                 else if(window.event.keyCode == 38){

                     scrolLength = scrolLength - 19;  
                     document.getElementById("Parent").scrollTop = scrolLength;

                 }
            }
        } 
    new autocomplete( 'tb', 'Parent' );
</script> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T09:41:51.200

我假设您有一个处理输入的输入。

为您读出 event.keyCode 的输入映射 onkeyup-eventhandler，并在它是向上/向下箭头（38、40）的适当键码时执行操作，以保持对您的哪个节点（您的 div 中的项目）的引用将焦点移到。

然后当你按下回车键（keyCode 13）时调用同一个处理程序，就像你在点击时一样。

很难给出一个编码示例，因为它高度依赖于上下文，但是关于如何浏览 div 的提示是让我们使用 .nextSibling 和 .previousSibling，以及 .firstChild 和 .childNodes。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T09:46:04.780

我已经很久没有这样做了，但我想你可以使用`event.keyCode`.

如果返回的值为 38 和 40，则用户分别按下了向上和向下箭头。

然后，您必须选择当前位置上方或下方的行。如何选择行将取决于您的具体情况。

# python - 转义正则表达式字符串

> ID：280435
> 
> 赞同：297
> 
> 时间：2008-11-11T09:33:29.050
> 
> 标签：python, regex

我想使用来自用户的输入作为搜索某些文本的正则表达式模式。它有效，但是我如何处理用户在正则表达式中放入有意义的字符的情况？

例如，用户想要搜索 Word `(s)`: 正则表达式引擎会将其`(s)`作为一个组。我希望它像对待字符串一样对待它`"(s)"` 。我可以`replace`根据用户输入运行并替换`(`with`\(`和`)`with`\)`但问题是我需要对每个可能的正则表达式符号进行替换。

你知道更好的方法吗？

* * *

## 回答 #1

> 赞同：396
> 
> 时间：2008-11-11T09:37:37.387

为此使用该`re.escape()`功能：

[4.2.3`re`模块内容](http://docs.python.org/library/re.html#re.escape)

> **转义（字符串）**
> 
> 返回所有非字母数字反斜杠的字符串；如果您想匹配其中可能包含正则表达式元字符的任意文字字符串，这很有用。

一个简单的示例，搜索任何出现的提供的字符串（可选地后跟“s”），并返回匹配对象。

```
def simplistic_plural(word, text):
    word_or_plural = re.escape(word) + 's?'
    return re.match(word_or_plural, text) 
```

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2008-11-11T09:49:25.710

您可以使用[`re.escape()`](http://docs.python.org/library/re.html#re.escape)：

> re.escape(string) 返回所有非字母数字反斜杠的字符串；如果您想匹配其中可能包含正则表达式元字符的任意文字字符串，这很有用。

```
>>> import re
>>> re.escape('^a.*$')
'\\^a\\.\\*\\$' 
```

*如果您使用的 Python 版本 < 3.7，这将转义不*属于正则表达式语法的非字母数字。

*如果您使用的 Python 版本 < 3.7 但 >= 3.3，这将转义不*属于正则表达式语法的非字母数字，特别是下划线 ( )*除外*`_`。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2017-02-23T18:06:31.707

不幸的是，[`re.escape()`](https://docs.python.org/2/library/re.html#re.escape)不适合替换字符串：

```
>>> re.sub('a', re.escape('_'), 'aa')
'\\_\\_' 
```

一种解决方案是将替换放在 lambda 中：

```
>>> re.sub('a', lambda _: '_', 'aa')
'__' 
```

因为 lambda 的返回值被视为[`re.sub()`](https://docs.python.org/2/library/re.html#re.sub)文字字符串。

* * *

## 回答 #4

> 赞同：-5
> 
> 时间：2017-09-23T14:41:35.663

请试一试：

\Q 和 \E 作为锚点

放置一个 Or 条件来匹配一个完整的单词或正则表达式。

参考链接：[如何匹配包含正则表达式中特殊字符的整个单词](https://stackoverflow.com/questions/34344112/how-to-match-a-whole-word-that-includes-special-characters-in-regex)

# c# - 对于大型 C#/C++ 解决方案，什么是好的目录结构？

> ID：280439
> 
> 赞同：3
> 
> 时间：2008-11-11T09:35:56.067
> 
> 标签：c#, visual-studio, build-process

您将如何布置大型 C# 解决方案的目录结构，该解决方案可能由 20 到 30 个项目组成，主要是 C#，但也有一些 C++？您将外部依赖项放在哪里？在源代码管理中创建分支时，您是否绝对分支所有内容？您是否覆盖了构建文件所在位置的默认值？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T09:38:00.460

看看[Tree Surgeon](http://www.codeplex.com/treesurgeon) CodePlex 项目。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T09:39:18.913

我会坚持使用正常的“解决方案目录，子目录中的每个项目”方法 - 使用 C# 和 C++ 的混合不应该改变这一点。

我喜欢创建一个“lib”子目录（在解决方案目录之外）并将外部依赖项放在那里，然后从每个项目中引用该位置。这有助于使所有版本保持同步。

对所有内容进行分支，因此您始终可以检查整个分支并将其构建为一致的版本。

我通常不会覆盖构建文件所在位置的默认值——这很麻烦——但我有一个 NAnt（或其他）脚本来进行构建，然后收集相关的二进制文件进行分发。

# c# - 需要重构解决方案

> ID：280449
> 
> 赞同：0
> 
> 时间：2008-11-11T09:41:27.007
> 
> 标签：c#, asp.net, refactoring

我有一个页面，我必须根据用户选择动态加载控件。假设我有这样的事情：

```
public static readonly Dictionary<string, string> DynamicControls = new Dictionary<string, string>
        {
            { "UserCtrl1",  "~/Controls/UserCtrl1.ascx" },
            { "UserCtrl2",  "~/Controls/UserCtrl2.ascx" },
            { "UserCtrl3",  "~/Controls/UserCtrl3.ascx" },
            { "UserCtrl4",  "~/Controls/UserCtrl4.ascx"}
}; 
```

现在让我们说，在加载控件的页面上，代码是这样的：

```
protected void Page_Load(object sender, EventArgs e)
        {
            SomePanel.Controls.Add(GetControl());
        }        

        private Control GetControl()
        {
            string dynamicCtrl = CurrentItem.DynamicControl;
            string path = SomeClass.DynamicControls[dynamicCtrl];

            Control ctrl = null;            

            //TODO: find a better way to load the controls
            switch (dynamicCtrl)
            {
                case "UserCtrl1":
                    {
                        ctrl = (UserCtrl1)LoadControl(path);
                    }
                    break;
                case "UserCtrl2":
                    {
                        ctrl = (UserCtrl2)LoadControl(path);
                    }
                    break;
                case "UserCtrl3":
                    {
                        ctrl = (UserCtrl3)LoadControl(path);
                    }
                    break;
                default:
                    {
                        throw new ApplicationException("Invalid dynamic control added.");
                    }                
            }

            return ctrl;
        } 
```

该页面具有所需的已注册报表。知道如何摆脱这个丑陋的 switch 语句吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-11T09:52:03.130

您不需要从 LoadControl 转换结果。

这应该这样做：

```
private Control GetControl()
{
    string dynamicCtrl = CurrentItem.DynamicControl;
    string path = SomeClass.DynamicControls[dynamicCtrl];

    Control ctrl = LoadControl(path);    

    return ctrl;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T09:59:49.247

你可能想要这样的东西（伪代码）：

```
字典中的 foreach 键
   如果 key = dynamicControl 那么
      ctrl = (Type.GetType(key))LoadControl(dictionary.get(key))
   万一
下一个

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T09:48:38.817

你不能只在你的字典上使用 foreach 并在那里做你的测试和 LoadControl 吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T09:51:49.183

这无济于事，因为转换为正确的控制类型需要开关。

# php - fastcgi 中的持久数据库连接

> ID：280454
> 
> 赞同：3
> 
> 时间：2008-11-11T09:45:16.937
> 
> 标签：php, mysql, fastcgi

我正在将应用程序从 php 移植到 fastcgi (c)。我的主机运行 apache。

由于 fastcgi 应用程序将循环运行，因此我可以打开一个 mysql 连接，并为所有传入请求保持打开状态。这是推荐的吗？

我想我读过同样数量的意见，说连接比请求贵得多，而且它应该是持久的，另一方面，人们声称打开的连接是一种资源消耗，每次都应该关闭。

其中哪一项在我的上下文中是正确的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T12:10:06.923

我不想说出如此明显的答案，但是……您是否尝试过两种方法并进行了比较？将 connect() 更改为 pconnect() 并尝试使用这两种方法非常容易。做一些分析，尤其是在负载下，看看什么最适合你的硬件和软件组合。

在高流量站点上，有时您无法让您的数据库接受足够的连接以允许持久性工作，但一般来说，持久性连接往往更有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T17:22:23.550

这很大程度上取决于您的设置。MySql 建立连接的速度是出了名的快；你可以说它是为此而设计的。如果数据库与 Web 服务器在同一台机器上，那么它真的很快。您必须权衡这与保持连接活动所增加的复杂性。如果每个脚本都创建一个新连接，则行为不端的脚本无法关闭其他脚本。还需要考虑每个连接状态等问题。因此，根据经验，我会说**除非您已将连接确定为性能瓶颈，否则不要尝试对其进行优化。**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T16:27:50.010

我会说，如果您始终有至少 10-20 人使用您的网站，那么持久连接效果最好。没有什么是矫枉过正

# math - 如何根据可变数量的比赛计算公平的整体游戏得分？

> ID：280457
> 
> 赞同：8
> 
> 时间：2008-11-11T09:46:45.823
> 
> 标签：math, statistics

我有一个游戏，你可以在每场比赛中得分从 -40 到 +40。允许用户进行任意数量的比赛。我想计算一个总分，隐含地考虑到比赛的数量。

只计算平均值是不公平的。例如，如果彼得打了四场比赛，每场比赛得到 40 分，那么他的总分将与只打一场比赛得到 40 分的 Janne 相同。

把比赛分数加起来也不公平。Peter打了2场比赛（每场40分），总分80分。Janne打了8场比赛（每场比赛10分），总分80分。

有没有（简单）公平的方法来计算总分？我读过 Elo & Glicko 国际象棋评级系统，但两者都是基于玩家评级历史和对手评级。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T11:40:01.307

这取决于你想强调什么，但我认为这既简单又有效：

平均分+出场次数

您可以稍微加权变量（例如，如果您想产生更大的影响，则玩 2* 场比赛） - 但基本关系似乎是合理的。

在您的第一个示例中，彼得将有 44 分，而简将有 40 分 - 但如果彼得开始失分，简可以赶上。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T11:31:23.133

另一种方法是使用贝叶斯统计。将每个团队获胜的概率建模为 beta 分布，并计算一个分布中的样本大于另一个分布的样本的概率。这种方法用于测试抗癌药物。它不仅考虑了哪种药物具有更好的反应率，还考虑了哪种药物具有更多的数据。比较两名球员或两支球队是完全类似的。

这听起来可能比实际复杂得多，但是有[免费软件](http://biostatistics.mdanderson.org/softwaredownload/SingleSoftware.aspx?Software_Id=9)可以进行这些计算，而且在某些情况下，这些计算很容易用手来完成。

请参阅[随机不等式的介绍](http://www.johndcook.com/blog/2008/07/26/random-inequalities-i/)和有关[beta 分布不等式](http://www.johndcook.com/blog/2008/08/21/random-inequalities-v-beta-distributions/)的详细信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T10:04:18.177

我认为没有好的方法可以在单个数字中创建这样的分数。

我建议计算平均成功率并包括游戏数量。例如

*   彼得得分 40/2（两场比赛平均 40 分）
*   Janne 得分 10/8（8 场比赛场均 10 分）

您可以快速查看第二个数字是否更大，第一个数字更准确。

否则使用 E​​LO，但仅当每个玩家至少参加 10 场比赛时才是准确的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-11T10:43:39.393

您可以查看[Microsoft 的 TruSkill](https://www.microsoft.com/en-us/research/project/trueskill-ranking-system)，几个月前我读过它，老实说，我已经忘记了大部分细节，所以我不确定它是否超级合适，但这可能是一个很好的灵感。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-03-29T21:52:07.263

这是一个原则性的方法：

[http://www.evanmiller.org/how-not-to-sort-by-average-rating.html](http://www.evanmiller.org/how-not-to-sort-by-average-rating.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-11T16:33:22.103

我建议将游戏分数设为 95% 置信区间的下限。在你玩很多游戏的极限情况下，你的游戏分数接近你的平均分数，但总是严格低于你的平均分数。这就像使用平均分数，但适当地怀疑那些只玩了几场比赛并且可能只是幸运的人。

换句话说，这是对玩了足够多的游戏后真实平均水平的悲观估计。

如何在不存储整个分数列表的情况下计算 95% 置信区间： [在不存储所有数据点的情况下计算平均置信区间](https://stackoverflow.com/questions/282600)

或者，如果您跟踪所玩游戏的数量、该人的得分总和以及他们得分的平方和，您可以按如下方式计算标准误差：

```
SE = sqrt((ss - s^2/n) / (n-1) / n) 
```

不用担心 95% CI，你可以让游戏分数为：

```
s/n - SE 
```

请注意，当只玩了一场游戏时，上述是负无穷大。这意味着你会给只玩过一场游戏的人尽可能低的分数作为他们的游戏分数。

另一个想法是在对人进行排名时明确显示置信区间（按低端排序）。然后人们会玩更多的游戏来缩小他们的 CI 以及提高他们的平均水平。

最后，增加最近游戏的权重可能是有意义的，这样孤立的糟糕游戏的重要性会更快地衰减。这样做的方法是选择一个`d`大于 1 的折扣因子，并赋予第`i`th 游戏的权重`d^(i-1)`。（尽管那时我不再确定如何应用置信区间的想法。）

PS：我在这里扩展了这个想法： [如何根据票数/分数/样本/等计算平均值？](https://stackoverflow.com/questions/895009/how-to-calculate-mean-based/895255#895255)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-11T09:55:36.930

使公式关于游戏数非线性。

设G为比赛次数，S为所有比赛得分之和，则TotalScore = G^2 * S

玩弄它，直到找到看起来合乎逻辑的东西。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-11T10:00:43.380

您可以检查获胜次数并为连续获胜（+5、+10、+15...）提供奖励积分，因此 (-10,+10,+10,+10,-10,+10) 将给出 ( -10,+10,+15,+20,-10,+10)。您也可以在不关心运行的情况下执行此操作，这将给出 (-10,+10,+15,+20,-10,+25)。

另一种可能性是在开始时将奖金值设置为 0，如果玩家输了，则将其减少 5，如果玩家获胜，则将其增加 5。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-11T10:15:07.000

您可以将分数设置为玩家在过去 30 场比赛中最好的 10 场比赛的平均值（或其他一些数字 - 也许只有最后 10 场适合您）。

还没有玩过 10 场比赛的玩家可以取他们玩过的比赛的平均值，然后将其加权为 0，以弥补 n < 10 的平均值比 10 的平均值具有更高标准偏差的事实。不确定每个 n 的比例因子应该是多少，但如果您有一些过去的数据要查看，您可以计算出典型玩家的得分有多可变，并据此进行计算。

或者计算出每场比赛的全球平均得分是多少（可能是 0），并在计算少于 10 场比赛的球员的得分时加上该数量的 (10-n) 个假得分。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-11T10:47:15.610

另一个起点可能是关于[ELO](http://en.wikipedia.org/wiki/Elo_rating_system)国际象棋排名系统的维基百科文章

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-14T03:56:20.830

构建一个图，每个人都由一个顶点表示。图中的每条边代表两个玩家之间的一系列比赛。现在应用某种类型的页面排名算法为您提供一组顶点权重。那应该给你你的排名。

现在棘手的部分是选择 pagerank 中使用的边缘权重。对于有向边 (u,v)——从顶点 u 到顶点 v——我个人会分配一个权重，等于玩家 u 赢得玩家 v 的分数。

您可以随时将顶点添加到图表中，但请记住页面排名有利于较旧的顶点（即那些玩过更多游戏的顶点！）。无论如何供参考：

[http://dbpubs.stanford.edu:8090/pub/199​​9-66](http://dbpubs.stanford.edu:8090/pub/1999-66)

另一种想法是使用 ELO 评级，并尝试通过为每个人分配相同的分数开始引导它，然后向前传播分数。我不能说这是完全令人满意的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-11T09:57:45.553

这取决于您想要对所玩游戏的权重与分数相比有多少。您可以定义一个返回游戏权重的函数：只有一个游戏的小部分和很多游戏的 1（例如 1 - 1/(2 * #Games)）和累积分数的倍数。

# c# - 如何续订过期的 ClickOnce 证书？

> ID：280472
> 
> 赞同：33
> 
> 时间：2008-11-11T09:53:50.490
> 
> 标签：c#, visual-studio, visual-studio-2008, clickonce

我需要对一年多没有接触过的 ClickOnce 应用程序进行一些更改，因此证书已过期。

我读过使用新证书发布会使应用程序失败，因为它将使用不同的密钥进行签名。

因此我认为我需要使用相同的证书，但不知道如何更新它。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2011-02-03T16:16:33.753

如果您正在寻求快速解决方案，那么您可以“更新”您现有的证书，并给它一个更长的到期日期。

Cliff Stanford 已经清理了 Microsoft 的“解决方法”，并将其作为一个简单的命令行 exe 提供 - 可在此处获得：http: [//may.be/renewcert/](http://may.be/renewcert/) - 干得好 Cliff ！

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-02-08T06:40:32.773

这是有关证书到期的权威 MSDN 文章，其中还包括指向 RenewCert 更新的链接。[http://msdn.microsoft.com/en-us/library/ff369721.aspx](http://msdn.microsoft.com/en-us/library/ff369721.aspx)这涵盖了所有情况。

如果您的目标是 .NET 3.5，使用自动更新，并且没有 VSTO 应用程序，或者您的目标是 .NET 4，那么更改证书不会给您带来任何问题。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2019-01-10T00:23:47.983

更新：@OceanAirdrop 完成了以下所有工作并在 github 上提供了它：[https](https://github.com/OceanAirdrop/ExtendClickOnceCertificate) ://github.com/OceanAirdrop/ExtendClickOnceCertificate ，他在自述文件登录页面上有使用说明。

* * *

原始细节：

正如@Andy Blackman 所说，更新 pfx 是一种方法，但是当我尝试使用它时，renewcert 在现代 Windows 上运行时出现问题。为了修复 may.be/renewcert 依赖项，另一个人用 C# 重写了它，以便您可以在现代 Visual Studio 上使用它：

[https://nathanpjones.com/2013/01/renewing-temporary-certificate/](https://nathanpjones.com/2013/01/renewing-temporary-certificate/)

从他的网站下载源代码，编译并运行。

* * *

如果您在 Wcslen 的 CertNameToStr 中的编组中收到“system.accessviolationexception”，请进行以下更改，以免编组崩溃：

1.  在 Crypt.cs:Line 130 中，将 psz 变量更改为使用 char[] 而不是字符串：

    ```
     [DllImport("crypt32.dll", CharSet = CharSet.Auto)]
    -        internal static extern int CertNameToStr(X509Encoding dwCertEncodingType, ref CRYPT_DATA_BLOB pName, CertNameType dwStrType, ref string psz, int csz);
    +        internal static extern int CertNameToStr(X509Encoding dwCertEncodingType, ref CRYPT_DATA_BLOB pName, CertNameType dwStrType, [In, Out] char[] psz, int csz); 
    ```

2.  在 Program.cs:Line 131 中使用 char 缓冲区而不是字符串：

    ```
    -                //var buffer = new char[1024];
    -                string buffer = new string('\0', 1024);
    +                char[] buffer = new char[1024];
    +                //string buffer = new string('\0', 1024);
                     int d;
    -                if ((d = Crypt.CertNameToStr(Crypt.X509Encoding.ASN_Encodings, ref certNameBlob, Crypt.CertNameType.CERT_X500_NAME_STR, ref buffer, 1024 * sizeof(char))) != 0)
    +                if ((d = Crypt.CertNameToStr(Crypt.X509Encoding.ASN_Encodings, ref certNameBlob, Crypt.CertNameType.CERT_X500_NAME_STR, buffer, 1024 * sizeof(char))) != 0) 
    ```

3.  重建

要运行它以快速将证书更新为默认五年，请使用如下命令：

```
"[path-to-renew-cert-proj-dir\bin\Debug\]renewCert.exe" [old-cert-path\]old_cert_name.pfx [new-cert-path\]new_cert_name.pfx 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T23:01:05.430

如果我没记错的话，我遇到了同样的问题，只是创建了一个新证书。

我认为这些版本之间的自动更新中断了，但没有持久的损害。我的应用程序仅供内部使用可能会有所帮助，因此我不需要正确签名的证书。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-25T02:55:29.917

基本上，您必须构建一个应用程序来延长证书的有效期。上面的链接将带您访问该应用程序的 C++ 源代码。如果你很幸运并且只是自己签名，它可能会起作用。如果您使用 Verisign 等进行签名，您就是 SOL。您将需要卸载并重新安装每个应用程序。这就像你买了一辆新车，引擎坏了，制造商给你一本关于重建引擎的书，而不是更换或修理它。ClickOnce 不是。

# c++ - _CRT_DEBUGGER_HOOK 抛出异常

> ID：280477
> 
> 赞同：5
> 
> 时间：2008-11-11T09:57:23.790
> 
> 标签：c++, visual-studio-2008, managed-c++

我在将程序从 VS2005 转换为 VS2008 时遇到问题。当我在 VS2008 中运行程序时，应用程序启动正常，但是当开始使用应用程序时它崩溃给我这个错误：

“Microsoft Visual Studio C 运行时库检测到致命错误”

然后调试器将我指向这个函数：

```
__declspec(noinline)
void __cdecl _CRT_DEBUGGER_HOOK(int _Reserved)
{
/* assign 0 to _debugger_hook_dummy so that the function is not folded
in retail */
(_Reserved);
_debugger_hook_dummy = 0;
} 
```

编译应用程序 ase 发布工作完美......

顺便说一下，这是一个本机代码，它调用了一个封装了 .NET 代码的托管 c++ 代码。

我该如何调试这种情况？

提供

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T10:31:27.310

确保您的所有依赖项也使用 VS2008 调试进行编译。

我在 VS2008-debug 中编译程序时遇到了同样的问题，在 VS2003 中编译的一些依赖 DLL，在 VS2008-debug 中编译程序时，以及在发布时编译的一些依赖项时也遇到了同样的问题。

# windows-services - 从 Windows 服务启用/禁用 Aero

> ID：280480
> 
> 赞同：1
> 
> 时间：2008-11-11T09:59:24.740
> 
> 标签：windows-services, aero

我有一些代码可以在 Vista 中启用/禁用 Windows Aero 服务，我想在 Windows 服务中运行它。该代码在独立应用程序中工作，但是当我从服务运行它时，什么也没有发生。不会引发任何错误或异常。

我意识到在服务中运行代码与在应用程序中运行代码的范围不同，但在这种情况下，我将如何从服务中启用/禁用 Aero？这甚至可能吗？

这是我正在使用的代码：

```
public static readonly uint DWM_EC_DISABLECOMPOSITION = 0;
public static readonly uint DWM_EC_ENABLECOMPOSITION = 1;

[DllImport("dwmapi.dll", EntryPoint="DwmEnableComposition")]
protected static extern uint Win32DwmEnableComposition(uint uCompositionAction);

public static bool EnableAero() 
{
    Win32DwmEnableComposition(DWM_EC_ENABLECOMPOSITION);
} 
```

编辑：

事实证明，DwmEnableComposition 调用返回 HRESULT 0x80070018 或 ERROR_BAD_LENGTH。似乎是一个奇怪的错误，因为代码在不作为服务运行时有效。

我还尝试将整个内容更改为以下代码，但得到了相同的结果。它设置了窗口站和桌面，看起来是正确的，但是对 DwmEnableComposition 的调用会导致同样的错误。为简洁起见，我没有包含 PInvoke 声明。

```
 protected override void OnStop()
    {
        IntPtr winStation = OpenWindowStation("winsta0", true, 0x10000000 /* GENERIC_ALL */);
        if (winStation == null || winStation.ToInt32() == 0)
        {
            String err = new Win32Exception(Marshal.GetLastWin32Error()).Message;
        }

        if (!SetProcessWindowStation(winStation))
        {
            String err = new Win32Exception(Marshal.GetLastWin32Error()).Message;
        }

        uint thread = GetCurrentThreadId();

        IntPtr hdesk = OpenInputDesktop(0, false, 0x10000000 /* GENERIC_ALL */);
        if (hdesk == null || hdesk.ToInt32() == 0)
        {
            String err = new Win32Exception(Marshal.GetLastWin32Error()).Message;
        }

        if (!SetThreadDesktop(hdesk))
        {
            String err = new Win32Exception(Marshal.GetLastWin32Error()).Message;
        }

        uint result = Win32DwmEnableComposition(DWM_EC_DISABLECOMPOSITION);
        if (result != 0)
        {
            String err = new Win32Exception(Marshal.GetLastWin32Error()).Message;
        }
    } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-07-31T07:33:58.257

通过在 64 位 Vista 下运行的服务创建 WPF FlowDocuments 时，我遇到了相同的错误代码。在四处挖掘之后，我可以在[Microsoft Connect 上看到这篇文章](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=361469)，其中指出

> “...问题是由 DWM 的互操作问题引起的...”

和

> “......它将修复包括 IIS7 在内的所有服务中的 WPF 崩溃......”

这是热修复下载的直接链接；[知识库 959209](http://support.microsoft.com/kb/959209)

这解决了我们通过运行 64 位 Vista 的 CruiseControl.Net (CCNet) 运行单元测试的问题。不通过服务运行时的测试很好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T10:13:39.267

我不确定，但也许您需要将您的服务进程与当前桌面相关联，然后才能工作？

确保您的服务可以与桌面交互。然后使用[SetThreadDesktop()](http://msdn.microsoft.com/en-us/library/ms686250(VS.85).aspx)为服务线程设置桌面，将句柄传递给名为“Default”的桌面。

我没有尝试过，我不能保证它会起作用。但这可能是要尝试的东西？

祝你好运 ：）

# windows - 如何重命名 DLL 但仍允许 EXE 找到它？

> ID：280485
> 
> 赞同：26
> 
> 时间：2008-11-11T10:04:27.473
> 
> 标签：windows, dll, native

我们有一个内部生成的 DLL，并且我们有相关的存根静态 LIB。

我们还有一个 EXE，它使用静态链接到 DLL 的 LIB 文件的简单方法（即，不手动使用 LoadLibrary）使用此 DLL。

当我们部署 EXE 时，出于混淆原因（应客户要求），我们希望更改 DLL 文件名。

**我们怎样才能做到这一点，以便我们的 EXE 仍然自动找到 DLL？**

我尝试重命名 DLL 和 LIB 文件（在将它们构建为正常名称之后），然后更改 EXE 项目设置以与重命名的 LIB 链接。这在运行时失败，因为我猜 DLL 的名称被烘焙到 LIB 文件中，而不是链接器将“.lib”替换为“.dll”而简单地猜测。

一般来说，我们不想将这种混淆应用于 DLL 的所有用途，因此我们希望保持当前 DLL 项目输出文件的原样。

我希望有一种方法可以编辑 DLL 的 LIB 文件，并将 DLL 文件的硬编码名称替换为其他名称。在这种情况下，这可以完全在 EXE 项目中完成（可能作为预构建步骤）。

* * *

**更新**：我发现延迟加载不起作用，因为我的 DLL 包含导出的 C++ 类。见[这篇文章](http://www.tech-archive.net/Archive/VC/microsoft.public.vc.language/2004-09/0377.html)。

有没有其他选择？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-11T10:45:06.707

使用 LIB 工具（包含在 Visual Studio 中），您可以从 def 文件生成 lib 文件。假设您的 dll 源不包含 def 文件，您必须先创建一个。您可以使用 dumpbin 来帮助您。例如：`dumpbin /exports ws2_32.dll`

在输出中，您会看到导出的函数的名称。现在创建一个这样的 def 文件：

```
LIBRARY WS2_32
EXPORTS
    accept      @1
    bind        @2
    closesocket @3
    connect     @4 
```

@number 是 dumpbin 输出中的序号

用于`LIB /MACHINE:x86 /def:ws2_32.def`生成 lib 文件。

现在您可以轻松地修改 def 文件，并在每次重命名 dll 时生成一个新的 libfile。

您可以使用 dumpbin: 验证 libfile `dumpbin /exports ws2_32.lib`。您应该得到与原始 lib 文件相同的输出。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-11-11T14:25:49.460

这是一个不错的替代方法：**延迟加载**。

构建应用程序时，将其全部链接到原始 DLL 名称（但将原始 dll 设置为延迟加载）。

然后，您根据客户的要求部署重命名的 DLL。

您的 EXE 将尝试使用原始名称而不是重命名的版本来定位 DLL，因此会失败，但是通过延迟加载，您可以拦截此失败并自己加载重命名的版本，然后让本机 Windows 加载器解决所有问题，就好像没有任何改变一样。

阅读文章[Linker Support for Delay-Loaded DLLs](https://docs.microsoft.com/en-us/cpp/build/reference/linker-support-for-delay-loaded-dlls)并查看[Delay Hook 示例](https://docs.microsoft.com/en-us/cpp/build/reference/calling-conventions-parameters-and-return-type#sample)。

您的延迟挂钩可能如下所示：

```
FARPROC WINAPI delayHook( unsigned dliNotify, PDelayLoadInfo pdli )
{
    switch( dliNotify )
    {
        case dliNotePreLoadLibrary:
            if( strcmp( pdli->szDll, "origional.dll" ) == 0 )
                return (FARPROC)LoadLibrary( "renamed.dll" );
            break;
        default:
            return NULL;
    }

    return NULL;
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2018-02-25T00:52:16.103

我创建了一个小 Python 脚本来正确重命名本机 dll。它会生成一个新的 lib 文件，供您在 MSVC 中的项目链接中使用。

[https://github.com/cmberryau/rename_dll/blob/master/rename_dll.py](https://github.com/cmberryau/rename_dll/blob/master/rename_dll.py)。

当然，您需要使用开发人员命令提示符才能正常工作。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-12T23:55:29.840

你的顾客喝醉了吗？在全世界所有疯狂的要求中......

回到我作为梅毒疯子午夜 C++ 程序员的辉煌岁月，我曾经将我的 DLL 作为资源添加到我的 .exe 文件中。然后在启动时我会解压它们并将它们写入 exe 的目录。此时您的程序可以决定 DLL 文件名。真正去做混淆的事情——从一个随机数开始，连接一些爱德华·李尔的诗歌，然后用你最喜欢的德语双管名词异或；无论如何应该为初学者做。然后使用 LoadLibrary() 加载 DLL。

```
enum ukOverwrite {dontOverwriteAnything = 0, overwriteWhateverPresent = 1};
void unpackResource (ukOverwrite param1, int resourceID, const char* basePath,  
const char* endFilename)
{
  char* lpName = 0;
  lpName += resourceID;
  HRSRC MrResource = FindResource (0, lpName, "file");

  if (MrResource)
  {
    HGLOBAL loadedResource = LoadResource (0, MrResource);
    if (loadedResource)
    {
      void* lockedResource = LockResource (loadedResource);
      if (lockedResource)
      {
        DWORD size = SizeofResource (0, MrResource);
        if (size)
        {
          unsigned long creationDisposition = CREATE_NEW;
          if (param1 == overwriteWhateverPresent)
            creationDisposition = CREATE_ALWAYS;

          char filepath [MAX_PATH];
          strcpy (filepath, basePath);
          strcat (filepath, endFilename);
          HANDLE rabbit = CreateFile (filepath, GENERIC_WRITE, 0, 0,  
creationDisposition, 0, 0);
          if (rabbit != INVALID_HANDLE_VALUE)
          {
            DWORD numBytesWritten = 0;
            int wf = WriteFile (rabbit, lockedResource, size, &numBytesWritten,  
0);
            CloseHandle (rabbit);
          }
        }
      }
      FreeResource (loadedResource);
    }
  }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-05T12:22:05.317

1.  使用 LoadLibrary（从注册表中读取新名称）是一种选择。
2.  您可以将您的 Visual Studio 项目重命名为具有通用名称（您的客户不反对）。
3.  DLL 本身需要重命名。但是 lib 仍然带有旧名称？您是否使用 DUMPBIN /ALL *.lib > 文件进行了交叉验证。grep 获取旧的 DLL 名称。它还在吗？检查项目中的 *.def 文件。您是否将 LIBRARY 重命名为“OLDNAME”

否则，LIB 没有理由携带旧的 DLL 名称。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-11-11T10:23:57.327

您必须使用 Assembly.Load 并将混淆的程序集名称保存在 app.config 中。

或者使用插件使用的相同方法。在您的程序集中有一个类实现一个接口，您可以在某个目录中的每个程序集中从您的应用程序中搜索该接口。如果找到它。您当然不必混淆接口名称。

# regex - 如何将 mod_rewrite（QSA 选项）转换为 Nginx 等效项？

> ID：280488
> 
> 赞同：11
> 
> 时间：2008-11-11T10:07:58.357
> 
> 标签：regex, mod-rewrite, nginx

我希望将以下`mod_rewrite`规则转换为[Nginx 等效](http://wiki.codemongers.com/NginxHttpRewriteModule)规则：

```
RewriteRule ^foo/(.*)$ /bar/index.php?title=$1 [PT,L,QSA]
RewriteRule ^foo/*$ /bar/index.php [L,QSA] 
```

到目前为止，我有：

```
rewrite ^foo/(.*)$ /bar/index.php?title=$1&$query_string last;
rewrite ^foo/?$ /bar/index.php?$query_string break; 
```

问题是（我认为！）没有附加查询字符串。我还没有找到将`QSA`参数移植到 Nginx 的方法。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-04T11:12:43.297

QSA 在 NGINX 中是自动的。

如果你不想要它，添加 ? 到新位置的尽头

重写 ^/foo /bar/index.php? 最后的;

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-11T23:02:15.393

这些重写规则使脚本工作：

```
rewrite ^/foo/([^?]*)(?:\?(.*))? /bar/index.php?title=$1&$2;
rewrite ^/foo /bar/index.php; 
```

# forms - 如何在 Microsoft Sharepoint 中创建表单？

> ID：280489
> 
> 赞同：2
> 
> 时间：2008-11-11T10:08:13.130
> 
> 标签：forms, sharepoint

嗨，我想在我的网站上创建表单，该表单使用 Micrsoft Sharepoint 运行。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T10:23:52.707

在 SharePoint 中有多种创建/使用表单的方法。你可以这样做

*   实现 Web 部件
*   设计/实现一个aspx页面
*   使用 InfoPath

决定哪个选项适合您取决于您​​想要解决的问题或您想要归档的目标。也许更多细节会有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T12:30:21.220

这是一个非常广泛的问题。正如弗洛所写，有很多方法可以做到这一点，而且没有一个最佳选择。除了他列举的三种方式，我再补充一种：

*   使用调查列表类型允许用户创建简单的表单而无需定制和开发。它适用于调查，但结合邮件提醒，它适用于简单的表格。

当然，任何自定义列表都可以以这种方式使用。

# mysql - mysql递归更新

> ID：280491
> 
> 赞同：0
> 
> 时间：2008-11-11T10:09:53.953
> 
> 标签：mysql, recursive-query, sql-update

我有两个 mysql 表，一个包含有关汽车的详细信息，另一个包含所有可能的汽车型号，例如：

```
汽车：
  car_id
  模型
  [更多细节]

楷模：
  model_id
  型号名称

```

现在，我的问题是存储在“汽车”表中的模型详细信息是模型名称，而不是我想要的模型 ID

我猜我需要某种递归 UPDATE 表才能更新cars.model，但我的大脑已经停止工作，不知道该怎么做。有人对如何做到这一点有任何提示吗？

感谢任何能提供帮助的人！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T10:36:10.950

```
mysql> 创建表汽车（car_id int auto_increment 主键，模型
varchar(50), model_id int);
查询正常，0 行受影响（0.01 秒）

mysql> 创建表模型（model_id int auto_increment 主键，名称
varchar(50));
查询正常，0 行受影响（0.01 秒）

mysql> 插入模型（名称） VALUES ('Taurus'), ('Ka'), ('Mustang');
查询正常，3 行受影响（0.00 秒）
记录：3 重复：0 警告：0

mysql>插入汽车（模型）值（'Ka'），（'Mustang'），（'Taurus'），
('F150');
查询正常，4 行受影响（0.00 秒）
记录：4 重复：0 警告：0

mysql> 从汽车中选择 *；
+--------+---------+----------+
| 车牌号 | 型号 | 型号ID |
+--------+---------+----------+
| 1 | 嘉 | 空 |
| 2 | 野马 | 空 |
| 3 | 金牛座 | 空 |
| 4 | F150 | 空 |
+--------+---------+----------+
4 行一组（0.00 秒）

mysql> 从模型中选择 *；
+---------+---------+
| 型号ID | 姓名 |
+---------+---------+
| 1 | 金牛座 |
| 2 | 嘉 |
| 3 | 野马 |
+---------+---------+
3 行一组（0.00 秒）

mysql>更新汽车，模型设置cars.model_id = models.model_id
其中models.name =汽车.model;
查询正常，3 行受影响（0.06 秒）
匹配行：3 更改：3 警告：0

mysql> 从汽车中选择 *；
+--------+---------+----------+
| 车牌号 | 型号 | 型号ID |
+--------+---------+----------+
| 1 | 嘉 | 2 |
| 2 | 野马 | 3 |
| 3 | 金牛座 | 1 |
| 4 | F150 | 空 |
+--------+---------+----------+
一组 4 行（0.03 秒）

```

# sql - 如何减去而不是添加类似 sql 函数的 Sum()

> ID：280494
> 
> 赞同：3
> 
> 时间：2008-11-11T10:10:37.680
> 
> 标签：sql, sql-server-2005, aggregate-functions

我在 sql 语句中有一个 group by 子句，需要使用聚合函数来减去每个组中的所有值，而不是像 Sum() 函数那样添加。

IE

```
SELECT Sum(A) 
FROM (  
  SELECT 2 AS A
  UNION 
  SELECT 1) AS t1 
```

..so 将评估 2+1 并返回 3。

我需要一些做 2-1 的方法来返回 1。

希望这是有道理的。我能想到的唯一方法是使用 CLR 集成来制作我自己的聚合函数。

还有其他想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T10:12:56.037

您将如何确定要从中减去的项目？

一旦确定了它，它就是`SUM()`乘以`-1`然后添加到该值。

**编辑：**

如果它是第一个被减去的值，则取该值，将其加倍，然后取走所有值的总和。（将其加倍会抵消将其包含在所有值的总和中的效果。）

```
select top 1 @var = [value]
from myTable 
order by [some condition] 

select @minused = (2 * @var)  - sum([value]) 
from myTable 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T10:38:06.813

从您的问题来看，您并不清楚您想做什么。如果您希望将所有值的总和视为负数，则只需执行 SUM()，然后乘以 -1 即可返回负数结果。

在您的示例中，您似乎想要获取表中第一行的总和，减去所有其他值。因此，如果您的值是 10、15、5、20，您会想要：10 - 15 - 5 - 20。这个值与 10 - (15 + 5 + 20) 相同。您可以使用 LIMIT 获取表中的第一行。我们还需要下一阶段的主键：

```
SELECT primary_key AS pk, field FROM table LIMIT 1; 
```

我们可以通过排除上述行来获得所有其他行的总和：

```
SELECT SUM(field) FROM table WHERE primary_key != pk; 
```

然后，您可以从第一个值中减去第二个值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T14:49:56.213

阅读您的评论，我认为您想要这样的东西：

```
SELECT SUM(CASE WHEN ROWNUM=1 THEN 2*A ELSE -A END) 
FROM foo 
```

尽管要获得可靠的订购，您可能需要使用另一个选择：

```
SELECT SUM(b) 
FROM (
  SELECT CASE WHEN ROWNUM=1 THEN 2*a ELSE -a END AS b
  FROM foo
  ORDER BY ???
); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T10:13:39.983

SUM() 的工作原理是 2+1 == 1+2，而 2-1 != 1-2，因此如果 ORDER BY 存在，这样的函数会产生不同的结果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T10:15:23.270

我不确定你为什么想要这个，但我只是将返回的数据的负值相加：

```
SELECT Sum(A) 
FROM (  
  SELECT (2 * -1) AS A
  UNION 
  SELECT (1)) AS t1 
```

# c# - 为什么要使用显式接口实现来调用受保护的方法？

> ID：280495
> 
> 赞同：10
> 
> 时间：2008-11-11T10:12:03.620
> 
> 标签：c#, interface, implicit, explicit-interface

在[codeplex](http://www.codeplex.com/aspnet/SourceControl/FileView.aspx?itemId=266503&changeSetId=17272)中浏览 ASP.NET MVC 源代码时，我发现有一个类显式实现接口是很常见的。显式实现的方法/属性然后调用另一个具有相同名称的“受保护的虚拟”方法/属性。

例如，

```
public class MvcHandler : IHttpHandler, IRequiresSessionState 
{
    protected virtual bool IsReusable 
    {
        get 
        {
           return false;
        }
    }

    bool IHttpHandler.IsReusable 
    {
        get 
        {
           return IsReusable;
        }
    }
} 
```

我现在确定这种编程有什么好处。对我来说，我更喜欢只隐式实现接口 IHttpHandler。

我猜作者只是不希望**MvcHandler**有一个公共属性**IsResuable**。属性**IsReusable**只能在**MvcHandler**的实例被视为**IHttpHandler**时使用。不过，我不确定作者为什么会这样。

有人知道这种接口实现方式的更多好处吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-11T10:17:41.177

好吧，不是特定于 MVC，但是这种方法可以让您**保持核心公共 API 的清洁**。如果存在不同接口/等具有相同名称和签名但含义不同的风险，它也很有用。实际上，这种情况很少见。

它还允许您提供一个实现，您希望在子类中更改返回类型：

（`ICloneable`为简单起见选择 - 不要因为它是一个定义不明确的接口这一事实而挂断......一个更好的例子是诸如此类的东西`DbCommand`，它可以做到这一点 - 但在一个简短的例子中更难展示）

```
class Foo : ICloneable
{
    public Foo Clone() { return CloneCore(); }
    object ICloneable.Clone() { return CloneCore(); }
    protected virtual Foo CloneCore() { ... }
}

class Bar : Foo
{
    protected override Foo CloneCore() { ... }
    public new Bar Clone() { return (Bar)CloneCore(); }
} 
```

如果我们使用了公共虚拟方法，我们将无法使用`override`它*并*`new`在基类中使用，因为您不能同时这样做：

```
class A
{
    public virtual A SomeMethod() { ... }
}
class B : A
{
    public override A SomeMethod() { ... }
    //Error 1   Type 'B' already defines a member called 'SomeMethod' with the same parameter types
    public new B SomeMethod() { ... }
} 
```

使用受保护的虚拟方法，任何用法：

*   Foo.Clone()
*   Bar.Clone()
*   ICloneable.Clone()

都对具体类型使用正确的`CloneCore()`实现。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-01-06T18:55:22.880

如果一个类`IFoo.Bar`显式实现，而派生类需要`IFoo.Bar`做一些不同的事情，那么派生类将无法调用该方法的基类实现。不重新实现的派生类`IFoo.Bar`可以通过 调用基类实现`((IFoo)this).Bar()`，但是如果派生类重新实现`IFoo.Bar`（因为它必须为了改变其行为），上述调用将转到派生类 re -实现，而不是基类实现。即使`((IFoo)(BaseType)this).bar`没有帮助，因为将引用转换为接口类型将丢弃有关被转换的引用类型（与实例实例的类型相反）的任何信息。

Having an explicit interface implementation do nothing but call a protected method avoids this problem, since a derived class can change the behavior of the interface method by overriding the virtual method, while retaining the ability to call the base implementation as it sees fit. IMHO, C# should have had an explicit interface implementation produce a virtual method with a CLS-compliant name, so someone writing in C# a derivative of a class that explicitly implemented `IFoo.Bar` could say `override void IFoo.Bar`, and someone writing in some other language could say, e.g. `Overrides Sub Explicit_IFoo_Bar()`; since any derived class can re-implement `IFoo.Bar`, and since any derived class which doesn't re-implement `IFoo.Bar` can call it on itself, I don't see that there's any useful purpose to having the explicit implementation be sealed.

Incidentally, in vb.net, the normal pattern would simply be `Protected Overridable Sub IFoo_Bar() Implements IFoo.Bar`, without need for a separate virtual method.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-23T16:40:20.393

1.  当显式实现成员时，不能通过类实例访问它，而只能通过接口的实例访问。参考：[显式接口实现教程](http://msdn.microsoft.com/en-us/library/aa288461%28v=vs.71%29.aspx)
2.  根据我的经验，如果接口实现者显式实现一个接口，他会在您从接口中删除一个方法后收到编译器错误，而如果他/她隐式实现它并且该方法将保留在代码中，他将不会通知。

原因 1 的示例：

```
public interface IFoo
{
    void method1();
    void method2();
}

public class Foo : IFoo
{
    // you can't declare explicit implemented method as public
    void IFoo.method1() 
    {
    }

    public void method2()
    {
    }

    private void test()
    {
        var foo = new Foo();
        foo.method1(); //ERROR: not accessible because foo is object instance
        method1(); //ERROR: not accessible because foo is object instance
        foo.method2(); //OK
        method2(); //OK

        IFoo ifoo = new Foo();
        ifoo.method1(); //OK, because ifoo declared as interface
        ifoo.method2(); //OK
    }
} 
```

# c# - C# 中窗体的 Control 属性中的控件顺序

> ID：280497
> 
> 赞同：6
> 
> 时间：2008-11-11T10:12:59.703
> 
> 标签：c#, winforms, user-interface, controls

我在将 FlowLayoutPanels 添加到表单的**控件**属性中的顺序上有一个特殊的问题。这是我试过的，

我在 C# 窗口应用程序中从左到右以垂直条状添加了 7 个 FlowLayoutPanel。然后我再次从左到右将流布局标记为 1、2、3、... 7。现在在表单的负载处理程序中，我编写了以下代码段，

```
 foreach (FlowLayoutPanel aDaysControl in this.Controls)
    {
        MessageBox.Show(aDaysControl.Tag.ToString());
    } 
```

我希望消息以**1, 2, ... 7**的顺序出现。但我以相反的顺序得到它（7、6、...1）。有人可以帮我解决我犯的错误吗？

保留订单的原因，

> 我正在尝试制作一个日历控件，每行代表一天。如果一个月从周三开始，那么我需要在第一行（周一）和第二行（周二）添加一个空标签。所以顺序有点重要

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2011-11-16T19:49:09.033

我知道这是一个很老的问题，但是......

您可能想使用`SetChildIndex`. 例如`this.Controls.SetChildIndex(button1, 0);`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T10:20:17.363

在 yourForm.designer.cs 中查看它们添加到表单中的顺序

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T10:27:55.570

如果您查看由设计器 Form1.designer.cs 生成的代码，它将如下所示：

```
 // 
        // Form1
        // 
        this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 13F);
        this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
        this.ClientSize = new System.Drawing.Size(658, 160);
        this.Controls.Add(this.flowLayoutPanel7);
        this.Controls.Add(this.flowLayoutPanel6);
        this.Controls.Add(this.flowLayoutPanel5);
        this.Controls.Add(this.flowLayoutPanel4);
        this.Controls.Add(this.flowLayoutPanel3);
        this.Controls.Add(this.flowLayoutPanel2);
        this.Controls.Add(this.flowLayoutPanel1);
        this.Name = "Form1";
        this.Text = "Form1";
        this.ResumeLayout(false); 
```

请注意它是如何构建的，您首先添加了面板 1，然后添加了 2，依此类推，但是当代码运行时，它将先添加 7，然后添加 6。

此代码将在设计器生成的 InitializeComponent() 函数中。

为什么需要它们按特定顺序运行？

我不会依赖设计师来保持你想要的顺序..我会自己对控件进行排序：

```
 var flowpanelinOrder = from n in this.Controls.Cast<Control>()
                               where n is FlowLayoutPanel
                               orderby int.Parse(n.Tag.ToString())
                               select n;

        /* non linq
        List<Control> flowpanelinOrder = new List<Control>();
        foreach (Control c in this.Controls)
        {
            if (c is FlowLayoutPanel) flowpanelinOrder.Add(c);                
        }
        flowpanelinOrder.Sort();
         * */

        foreach (FlowLayoutPanel aDaysControl in flowpanelinOrder)
        {
            MessageBox.Show(aDaysControl.Tag.ToString());
        } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-28T21:17:02.913

如果将来其他一些设计师删除了控件，添加回来等怎么办？检查设计师总是一团糟。更好的是在枚举之前对容器控件中的控件进行排序。我使用这个扩展方法（如果你有 Linq）：

```
public static List<Control> ToControlsSorted(this Control panel)
{
    var controls = panel.Controls.OfType<Control>().ToList();
    controls.Sort((c1, c2) => c1.TabIndex.CompareTo(c2.TabIndex));
    return controls;
} 
```

你可以：

```
foreach (FlowLayoutPanel aDaysControl in this.ToControlsSorted())
{
    MessageBox.Show(aDaysControl.TabIndex.ToString());
} 
```

（以上为`TabIndex`）。从中进行排序将是微不足道的`Tag`。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T10:22:39.013

真的有问题吗？

只要 UI 操作正确（例如，在标签顺序方面），我建议您不要对它们的枚举顺序做出任何假设。

编辑：感谢您更详细地解释您的要求。我想我仍然建议不要使用它们存储在 Controls 集合中的顺序。最好将这些实现细节视为“不透明”。您有一个与每个控件关联的标签，因此您可以使用它来识别正确的控件。为了加快处理速度，您可以构建一个按序号引用控件的 7 元素数组：

```
FlowLayoutPanel[] panels = new FlowLayoutPanel[7];

foreach(FlowLayoutPanel panel in this.Controls)
{
    panels[(int)panel.Tag] = panel;
}

// Now, you can reference the panels directly by subscript:

panels[2].BackColor = Color.Aquamarine; 
```

虽然我会进行一些类型检查以使这段代码更加健壮！

# mysql - MySQL 排序规则没有像文档中宣传的那样工作

> ID：280508
> 
> 赞同：0
> 
> 时间：2008-11-11T10:18:44.573
> 
> 标签：mysql, unicode, character-encoding, collation

我试图让我的 MySQL 表在这个[MySQL 参考](http://dev.mysql.com/doc/refman/5.0/en/charset-collation-effect.html)页面的示例 2 中表现得像 utf8 表：

```
CREATE TABLE germanutf8 (c CHAR(10)) CHARACTER SET utf8 COLLATE utf8_unicode_ci;
INSERT INTO germanutf8 VALUES ('Bar'), ('Bär');
SELECT * FROM germanutf8 WHERE c = 'Bär'; 
```

根据示例，这应该产生：

```
+------+
| c    |
+------+
| Bar  |
| Bär  |
+------+ 
```

但我得到的只是简单的`"Bär"`。难道我做错了什么？我应该调整我的设置吗？

我在 Mac OS X 上的 MySQL 5.0.45 和 Red Hat 上的 5.0.51a 上试过这个。

编辑：我试过设置`SET NAMES 'utf8'`，但这仍然给出相同的结果。这样做之后，我的变量是

```
+--------------------------+---------------------------------------------------------------------+
| Variable_name            | Value                                                               |
+--------------------------+---------------------------------------------------------------------+
| character_set_client     | utf8                                                                | 
| character_set_connection | utf8                                                                | 
| character_set_database   | utf8                                                                | 
| character_set_filesystem | binary                                                              | 
| character_set_results    | utf8                                                                | 
| character_set_server     | latin1                                                              | 
| character_set_system     | utf8                                                                | 
| character_sets_dir       | /usr/local/mysql-5.0.45-osx10.4-powerpc-64bit/share/mysql/charsets/ | 
+--------------------------+---------------------------------------------------------------------+ 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T10:24:49.943

您是否在 INSERT 上收到任何警告？

你确定你的 MySQL 客户端能正确解释你输入的内容吗？例如，如果您通过 SSH 连接到服务器，并从命令行运行 mysql，那么 shell 编码和 mysql 客户端编码是否都设置为 UTF-8？

你试过跑步吗

```
SET NAMES 'utf8' 
```

在运行这些查询之前？

# orm - 有没有关于 ORM 背后原理的书籍？

> ID：280511
> 
> 赞同：2
> 
> 时间：2008-11-11T10:19:44.277
> 
> 标签：orm

有几本关于特定 ORM 产品的书，例如 Hibernate 或 Linq to SQL，但我会对有关 ORM 更一般原则、历史等的任何材料非常感兴趣。

你知道关于这个主题的任何书籍、白皮书、经过充分研究的博客文章等吗？

谢谢/埃里克

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T10:33:02.580

构成 ORM 的基本部分在 Martin Fowlers[的企业应用程序架构模式中进行了描述](http://martinfowler.com/eaaCatalog/)

阅读对象关系类别中的所有模式。

Frans Boumas 的[博客](http://weblogs.asp.net/FBouma/)有很多深入探讨 ORM 理论的帖子，您不必喜欢他的产品就能欣赏他为解释各种概念和对所有与 ORM 相关的东西发表强烈意见所付出的努力：)

无论如何，这是一个开始！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T10:32:32.113

试试 Martin Fowler 的企业应用架构模式。它不是专门针对 ORM 的，而是展示了一个好的 ORM 为您实现的所有设计模式。

# queue - 使用表排队

> ID：280515
> 
> 赞同：4
> 
> 时间：2008-11-11T10:21:47.003
> 
> 标签：queue, message-queue, queue-table

我需要使用表实现一个队列。业务需求是有一个队列，5-10 个盒子可以访问该队列以获取下一个作业/作业。每天的工作岗位不会超过 5000 个。此外，一批作业应该一次“出队”。

只是想知道我以前没有做过的问题领域和问题是什么。如果有人以前遇到过这个/做过这个，请您指出一个设计/示例实现或需要注意的问题。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T10:33:36.933

有很多通用的队列或消息服务。即使您想实现自己的系统，您也可以尝试查看其他一些系统。首先想到的是带有[Apache ActiveMQ](http://activemq.apache.org/)、[OpenJMS](http://openjms.sourceforge.net/)或[JBoss Messaging等实现的 JMS（](http://www.jboss.org/jbossmessaging/) [Java 消息服务](http://java.sun.com/products/jms/)）。然后你也有很多非开源产品。

想到的第二件事是[Amazon Simple Queue Service](http://aws.amazon.com/sqs/)。有几个产品实现了相同的接口，比如[django-queue-service](http://code.google.com/p/django-queue-service/)。

祝你好运 ！

* * *

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T10:37:29.653

问题领域：

*   并发
*   安全
*   速度
*   编码
*   独特性

当然还有这个：

*   问题域的不明确说明

快乐编码！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T12:17:11.373

这听起来不太难。只需包含一个时间戳，您可以在输入作业时对其进行排序。根据数据库，可以使用当前时间戳自动填充此字段。

在获取作业时，只需将 SELECT 和 DELETE 语句放入事务中即可。如果你觉得这不舒服，这样的事情可能会做到：

```
UPDATE tblQueue SET mark = <unique application id> WHERE mark IS NULL ORDER BY timestamp ASC LIMIT 1
SELECT * FROM tblQueue WHERE mark = <unique app id>
DELETE FROM tblQueue WHERE mark = <unique app id> 
```

通过使用此设置，您可以避免交易，如果它们吓到您。

您对批次的定义有些不清楚；如果您只是说我应该能够一次处理 10 个项目，只需将第一个查询的 LIMIT 1 子句更改为 LIMIT 10。

如果您的意思是可以对作业进行分组，您可能需要一个作业队列，并将子项放在另一个表中（那不是队列，只是一个具有指向作业项的外键的常规表）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T13:57:44.353

谢谢维加德。

但是，如果执行作业的系统失败/崩溃，您建议的方法将导致作业请求丢失。

我正在考虑一个包含以下列的队列表

*   RequestID/MessageID（主键）
*   LockedBy（正在处理请求的人）
*   LockedTime（当请求被锁定以进行处理时）
*   RequestedTime（当请求被添加到队列时）
*   CompletionTime（请求何时完成）
*   状态（待处理/处理中）
*   RequestMessage（在我的例子中是序列化的java对象）
*   请求者（将请求排队）

我可以编写一个存储过程`[GetNextItemsInQueue]`，它返回一个让我们说 10 个请求的列表，设置锁定者和锁定时间。如果 Locked Time 增加了指定的限制，则可以将记录放回 Pending 状态。

这个有问题吗？

# sql-server - 用于从源代码控制重新创建数据库的批处理脚本

> ID：280539
> 
> 赞同：4
> 
> 时间：2008-11-11T10:34:38.083
> 
> 标签：sql-server, version-control, batch-file, sqlcmd

据我了解，如果我想让我的数据库处于源代码控制之下，那么我需要检查每个更改的更改脚本，然后从某个修订版运行它们以获得正确的数据库。

我正在尝试制作一个也将被签入的批处理文件，它允许团队中的其他开发人员在本地重新构建数据库而不会带来太多麻烦。我相信 sqlcmd 是实现这一目标的方法。我将其设置为枚举 .sql 文件目录中的所有文件并为每个文件运行 sqlcmd。

我的问题是谁以前做过这件事，你对实现这一目标的最佳方法有什么建议吗？我打算这样做的方式是最好的方式还是有更好的方式？

希望这不是太模糊。

提前致谢，

马丁。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T10:38:41.837

如果您使用像 NHibernate 这样的 ORM 工具，您可以省去使用数据库更改脚本的麻烦，因为 ORM 可以从它的映射文件（受源代码控制）重新创建数据库。

这是为每个修订提供适当的数据库版本的一种非常简单的方法。

然后，我还会在执行测试时重新创建整个模式，以确保我有一个一致的状态。

我最近写了一篇博客： [http ://www.tigraine.at/2008/10/30/sourcecontrol-and-databases-when-orm-comes-in-handy/](http://www.tigraine.at/2008/10/30/sourcecontrol-and-databases-when-orm-comes-in-handy/)

我也曾经有一个项目有 Sql 更新脚本，我们只是构建了一个小帮助工具（非常基本），它打开文件夹，对所有脚本进行排序（我们将它们命名为 1 - foo.sql，2 - bar.sql ) 并按顺序对数据库执行它们。

如果开发人员有一个新脚本，他只需将其添加到末尾（34 - bla bla.sql）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T17:40:37.397

我开发了一个小实用程序，通过将表、SP、触发器和视图导出到文本文件来帮助我对其进行版本控制：[gljakal 的 Sql Exporter](http://www.gljakal.com/sqlexporter/index.php)。它有一个 GUI 模式和一个命令行模式（所以我可以在批处理文件中使用它）。

适用于 SQL 2005+。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T10:38:08.623

要注意的一件事是您需要按依赖顺序创建对象。所以你不能简单地迭代文件。

我们最终得到了一个批处理文件，该文件将按依赖顺序列出所有对象

实际上我们有 2 个批处理文件，其中一个叫做 createDBObject.bat：

```
:: Parameters Required:
:: %1 UserID
:: %2 Password
:: %3 Server
:: %4 Database
:: %5 file with scripted object
::
echo. >> CreateDBObjectsLog.txt
echo  %5 >> CreateDBObjectsLog.txt
osql -U%1 -P%2 -S%3 -i%5 -d%4 -n >> CreateDBObjectsLog.txt
echo * %5 
```

然后另一个包含所有 db 对象的列表：

```
:: Parameters Required:
:: %1 UserID
:: %2 Password
:: %3 Server
:: %4 Database
::
echo object  in %4 database on %3 server
echo Please Wait ...

if exist CreateDBObjectsLog.txt del CreateDBObjectsLog.txt

call createDBObject.bat %1, %2, %3, %4, ScriptedTable1
call createDBObject.bat %1, %2, %3, %4, ScriptedTable2
...
call createDBObject.bat %1, %2, %3, %4, ScriptedTableN

call createDBObject.bat %1, %2, %3, %4, ScriptedView1

call createDBObject.bat %1, %2, %3, %4, ScriptedSP1

etc 
```

现在我们使用[SQL Compare Pro](http://www.red-gate.com/products/SQL_Compare/index.htm)自动执行所有这些任务

您还可以查看相关问题：[RedGate 是否有“穷人的”替代方案来编写整个数据库模式的脚本？](https://stackoverflow.com/questions/169107/is-there-a-poor-mans-alternative-to-redgate-for-scripting-out-entire-database-s#188355)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T11:03:04.470

如果您的公司愿意投资一些好的工具，那么值得检查[SQL Compare Pro](http://www.red-gate.com/products/SQL_Compare/index.htm)。它非常适合自动化/简化您描述的任务。他们提供 14 天的免费完整功能试用版，因此您可以在投资之前对其进行测试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T11:05:45.137

关于 OR 映射框架能够创建模式，这是一个有趣的观点——我没有想到这一点。我实际上使用的是 LINQ To SQL，但我相信仍然可以通过 CreateDatabase() 调用重新创建架构和数据库。

有没有其他人通过 LINQ To SQL 采用这种方法进行数据库源代码控制？

# xslt - 使用 XSLT 的元数据驱动生成

> ID：280542
> 
> 赞同：1
> 
> 时间：2008-11-11T10:37:06.003
> 
> 标签：xslt, xpath, xsd, metadata, datamodel

我经常通过转换遗留系统的专有数据模型来创建 XSD 模式。这效果很好。但是，遗留系统只允许我指定参数的非常基本的属性，例如数据类型（`int`等`string`）。

我想通过一种允许我添加元数据的机制来增强 XSL 转换，以便为转换提供更多详细信息。我想到了类似 Java 属性表示法来将属性分配给 XPath。

想象以下示例：

**遗留系统数据模型**（实际上很简洁，但最适合演示目的）

```
<datamodel>
  <customer>
    <firstName type="string"/>
    <lastName type="string"/>
    <age type="int">
  <customer>
</datamodel> 
```

**元数据**

```
customer/firstName/@nillable=false
customer/lastName/@nillable=false
customer/age/@nillable=true
customer/firstName/@minOccurs=1
customer/firstName/@maxOccurs=1
customer/lastName/@minOccurs=1
customer/lastName/@maxOccurs=1 
```

**生成的 XSD 架构**

```
...
<xs:complexType name="customerType">
  <xs:sequence>
    <xs:element name="firstName" type="xs:string" nillable="false" minOccurs="1" maxOccurs="1"/>
    <xs:element name="lastName" type="xs:string" nillable="false" minOccurs="1" maxOccurs="1"/>
    <xs:element name="age" type="xs:int" nillable="true"/>
  </xs:sequence>
</xs:complexType>
... 
```

你对那个怎么想的？有没有办法将元数据包含到 XSL 样式表中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T04:38:02.373

最好的解决方案是通过添加缺失的元数据来修改遗留数据。

修改后的“数据模型”词汇表的一个实例可能是这样的：

```
<datamodel xmlns:nm="my:new.meta">
    <customer>
        <firstName type="string"
                   nm:nillable="false"
                   nm:minOccurs="1"
                   nm:maxOccurs="1"
                   />
        <lastName type="string"
                  nm:nillable="false"
                  nm:minOccurs="1"
                  nm:maxOccurs="1"
                  />
        <age type="int" nm:nillable="true"/>
    </customer>
</datamodel> 
```

将新属性放在单独的命名空间中是一种很好的方法，可以轻松地将它们与已经支持的属性区分开来。通常不建议在命名空间中使用属性，因此如果要避免这种情况，可以使用子元素（属于新命名空间）而不是属性。使新属性属于不同的命名空间可能会导致旧模式验证不拒绝它们。

如果由于某些原因无法修改遗留数据，我建议不要在 XSLT 样式表本身中包含新属性（这是完全可能的，例如将其定义为 global 的内容`<xsl:variable>`），但是将这些新属性作为单独的 XML 文件或一组一个或多个 XML 文件提供。

在 XSLT 转换期间，可以使用 XSLT document() 函数动态访问任何 XML 文件。具有新属性的 XML 文件实例可能如下所示：

```
<newProperties xmlns:nm="my:new.meta">
    <customer>
        <firstName nm:nillable="false"
                   nm:minOccurs="1"
                   nm:maxOccurs="1"
                   />
        <lastName nm:nillable="false"
                  nm:minOccurs="1"
                  nm:maxOccurs="1"
                  />
        <age nm:nillable="true"/>
    </customer>
</newProperties> 
```

希望这有帮助。

干杯，

迪米特·诺瓦切夫

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T12:12:32.987

“你对那个怎么想的？”

~~二三事~~。

1.  修复遗留元数据。它是 XML。给它添加东西。如果需要，请添加命名空间。

2.  如果不能修复遗留元数据，谁来维护第二组不是 XML 表示法的元数据？谁将进行元数据更改的双重输入？有人坚持到底的几率是多少？

3.  考虑将 XML 用于附加元数据，而不是伪 XPath。一致性将帮助那些在你弄清楚发生了什么之后来的人。

# ruby-on-rails - 从帮助规范中获取“action_name”或“控制器”

> ID：280548
> 
> 赞同：5
> 
> 时间：2008-11-11T10:38:34.783
> 
> 标签：ruby-on-rails, ruby, rspec, bdd

假设我在**application_helper.rb**中有以下代码：

```
def do_something
 if action_name == 'index'
   'do'
 else
   'dont'
 end
end 
```

如果在索引操作中调用它会做一些事情。

问：如何在**application_helper_spec.rb**中为此重写帮助规范以模拟来自“索引”操作的调用？

```
describe 'when called from "index" action' do
  it 'should do' do
    helper.do_something.should == 'do' # will always return 'dont'
  end
end

describe 'when called from "other" action' do
  it 'should do' do
    helper.do_something.should == 'dont'
  end
end 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T12:19:55.343

您可以将 action_name 方法存根为您想要的任何值：

```
describe 'when called from "index" action' do
  before
    helper.stub!(:action_name).and_return('index')
  end
  it 'should do' do
    helper.do_something.should == 'do'
  end
end

describe 'when called from "other" action' do
  before
    helper.stub!(:action_name).and_return('other')
  end
  it 'should do' do
    helper.do_something.should == 'dont'
  end
end 
```

# javascript - flash fscommands 和 javascript

> ID：280551
> 
> 赞同：3
> 
> 时间：2008-11-11T10:40:07.387
> 
> 标签：javascript, jquery, flash, internet-explorer

我尝试让[mp3 flash 播放器](http://flash-mp3-player.net/players/js/)在所有浏览器上使用我的 javascript。首先一切顺利，但很快意识到我的代码在 MSIE 上不起作用。

在尝试找出后，我在参考代码中找到了这个：

```
<!--[if IE]>
<script type="text/javascript" event="FSCommand(command,args)" for="myFlash">
eval(args);
</script>
<![endif]--> 
```

如何把它变成一个javascript或jquery子句，我可以把它塞进它所属的地方（在audio.js中）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T19:42:42.690

该语法带有带有“event”和“for”属性的 <script> 标记，是 Internet Explorer 唯一一种在 DOM 对象上设置事件处理程序的方法。在这里，它向 myFlash 对象添加了一个 FSCommand 事件处理程序。这是必需的，因为在 Flash 对象中运行的代码可能希望在浏览器中运行 JavaScript。为此，Flash 对象将调用 FSCommand 事件处理程序，将运行的 JavaScript 作为参数传递给事件。

使用此播放器，JS 侦听器对象的名称在 FlashVars 参数中传递给播放器。然后，它使用 ActionScript 中的 FSCommands 来修改该侦听器对象，并在修改其他属性时偶尔调用该侦听器上的方法。我想在将 FSCommand 处理程序添加到 Flash 播放器对象之前，IE 无法使用此方法运行 JS 代码，这就是该代码存在的原因。修改它以使用您的 Flash 对象的 ID，您应该处于良好状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-13T23:36:34.440

也许这更多是关于动态嵌入闪存。

我在使用 mp3 flash 播放器时遇到了完全相同的问题。问题是 IE 不关心带有“event”和“for”属性的特殊脚本标记，如果它是在页面加载后添加的。当页面加载时，我的 IE 不会吃 jquery 的 .html()，只有 document.write 有效。但是 document.write 在页面加载后不能真正使用，除非它是针对 iframe 或其他一些恶魔崇拜机制。

好在 IE 不区分在这个混蛋脚本标签中分配事件处理程序还是以编程方式分配事件处理程序。这意味着：

```
<script type="text/javascript" event="FSCommand(command,args)" for="myFlash">
    eval(args);
</script> 
```

在 IE 中直接翻译为：

```
function foo(command, args){
    eval(args);
}
var ie_sucks = document.getElementById('myFlash');
ie_sucks.attachEvent("FSCommand", foo); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-26T19:51:59.957

而且......最后我们得到了：

```
var ie_sucks = document.getElementById('comebacker_audio');
ie_sucks.attachEvent("FSCommand", function(command, args) {eval(args);}); 
```

如果这对您不起作用，请尝试检查您的 html 以插入对象。此处示例：http: [//kb2.adobe.com/cps/415/tn_4150.html](http://kb2.adobe.com/cps/415/tn_4150.html)

;)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-14T14:46:19.230

谢谢大家以上。我将删除几行对我来说很方便的行。

要跨浏览器重用代码，请执行以下操作：

```
<script type="text/javascript">
    function mySwf_DoFSCommand(command, args) {
        // do stuff
    }
</script>

<!--[if IE]>
<script type="text/javascript" event="FSCommand(command,args)" for="mySwf">
    mySwf_DoFSCommand(command, args);
</script>
<![endif]--> 
```

# visual-studio - 如何获取 VS 解决方案的命令行构建命令？

> ID：280559
> 
> 赞同：29
> 
> 时间：2008-11-11T10:41:37.320
> 
> 标签：visual-studio, command-line, build-process

这可能很容易，但我遇到了困难：当我在 Visual Studio 中构建解决方案时 - 如何提取当前构建命令的确切 cmd 行以便能够从 VisualStudio 控制台执行相同的构建？

在输出窗口中，我可以看到解决方案构建命令中的单个项目，但不是整个解决方案的项目。

我在VS2005上。

任何帮助，将不胜感激

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-11T16:19:20.307

导航到您的 Programs 菜单 > Microsoft Visual Studio 2005 > Visual Studio Tools > **Visual Studio 2005 Command Prompt**。

此命令提示符为命令行会话设置了所有必要的 .NET 环境变量。您可以将目录更改为您的解决方案目录（例如 c:\projects\mySolution）并运行

```
Msbuild.exe mySolution.sln 
```

您可以使用**msbuild /?查看可用的各种选项**

Msbuild 位于 C:\Windows\Microsoft.NET\Framework\v2.0.50727

在 msbuild /? 快速选项检查，您可以参考[MSBuild 命令行参考](http://msdn.microsoft.com/en-us/library/ms164311.aspx)页面以获取有关其用法的更多说明。以及[如何在解决方案中构建特定目标](http://msdn.microsoft.com/en-us/library/ms171486(VS.80).aspx)。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-11-11T10:51:08.317

除了@JohnIdol 所说的正确之外，我发现您需要设置一个数字 VS 环境变量。我面前没有批处理文件的名称，但是您可以修改或“我认为”使用它。它在某处的VS程序文件树中。另外，我记得您不想使用标准外壳，而是使用 .NET 设置外壳，用于某些路径等。稍后我会在使用 VS 的 Windows PC 时添加详细信息。

编辑：提到的批处理文件是 ProgFiles 菜单中的快捷方式。这是其属性的详细信息。

```
%comspec% /k ""C:\Program Files\Microsoft Visual Studio 8\VC\vcvarsall.bat""x86" 
```

这是我的批处理文件，使用 MSBuild 调用解决方案。

```
@echo off

:: setup VS2005 command line build environment
set VSINSTALLDIR=C:\Program Files\Microsoft Visual Studio 8
set VCINSTALLDIR=C:\Program Files\Microsoft Visual Studio 8\VC
set FrameworkDir=C:\WINDOWS\Microsoft.NET\Framework
set FrameworkVersion=v2.0.50727
set FrameworkSDKDir=C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0
set DevEnvDir=C:\Program Files\Microsoft Visual Studio 8\Common7\IDE
set PATH=C:\Program Files\Microsoft Visual Studio 8\Common7\IDE;C:\Program Files\Microsoft Visual Studio 8\VC\BIN;C:\Program Files\Microsoft Visual Studio 8\Com
mon7\Tools;C:\Program Files\Microsoft Visual Studio 8\Common7\Tools\bin;C:\Program Files\Microsoft Visual Studio 8\VC\PlatformSDK\bin;C:\Program Files\Microsoft
 Visual Studio 8\SDK\v2.0\bin;C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727;C:\Program Files\Microsoft Visual Studio 8\VC\VCPackages;%PATH%
set INCLUDE=C:\Program Files\Microsoft Visual Studio 8\VC\ATLMFC\INCLUDE;C:\Program Files\Microsoft Visual Studio 8\VC\INCLUDE;C:\Program Files\Microsoft Visual
 Studio 8\VC\PlatformSDK\include;C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\include;%INCLUDE%
set LIB=C:\Program Files\Microsoft Visual Studio 8\VC\ATLMFC\LIB;C:\Program Files\Microsoft Visual Studio 8\VC\LIB;C:\Program Files\Microsoft Visual Studio 8\VC
\PlatformSDK\lib;C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\lib;%LIB%
set LIBPATH=C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727;C:\Program Files\Microsoft Visual Studio 8\VC\ATLMFC\LIB

echo %0 %*
echo %0 %* >> %MrB-LOG%
cd
if not ""=="%~dp1" pushd %~dp1
cd
if exist %~nx1 (
        echo VS2005 build of '%~nx1'.
        echo VS2005 build of '%~nx1'. >> %MrB-LOG%
        set MrB-BUILDLOG=%MrB-BASE%\%MrB-WORK%.%MrB-NICEDATE%.%MrB-NICETIME%.build-errors.log
        msbuild.exe %~nx1 /t:Rebuild /p:Configuration=Release > %MrB-BUILDLOG%
        findstr /r /c:"[1-9][0-9]* Error(s)" %MrB-BUILDLOG%
        if not errorlevel 1 (
                echo ERROR: sending notification email for build errors in '%~nx1'.
                echo ERROR: sending notification email for build errors in '%~nx1'. >> %MrB-LOG%
                call mrb-email "Mr Build isn't happy about build errors in '%~nx1'" %MrB-BUILDLOG%
        ) else (
                findstr /r /c:"[1-9][0-9]* Warning(s)" %MrB-BUILDLOG%
                if not errorlevel 1 (
                        echo ERROR: sending notification email for build warnings in '%~nx1'.
                        echo ERROR: sending notification email for build warnings in '%~nx1'. >> %MrB-LOG%
                        call mrb-email "Mr Build isn't happy about build warnings in '%~nx1'" %MrB-BUILDLOG%
                ) else (
                        echo Successful build of '%~nx1'.
                        echo Successful build of '%~nx1'. >> %MrB-LOG%
                )
        )
) else (
        echo ERROR '%1' doesn't exist.
        echo ERROR '%1' doesn't exist. >> %MrB-LOG%
)
popd 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-10T09:53:01.877

对于 VS .NET 2003，您可以使用 devenv.exe 从命令行构建解决方案/项目。

```
devenv solutionfile.sln  /build solutionconfig 
```

例如在批处理文件中的用法：

```
call "C:\Program Files\Microsoft Visual Studio .NET 2003\Common7\Tools\vsvars32.bat"

devenv Tools.sln /build "Release" 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-11T13:46:46.060

如果您想查看 VS 提供的确切命令行（而不是解决它），那么您可以尝试将 MSBuild.exe 替换为您自己的控制台应用程序，该应用程序将所有参数打印到文件中。

您还可以写出所有提供的环境变量，以检查 VS 在后台提供了哪些环境变量。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-02-07T10:08:20.773

我只想感谢 Bejoy 的例子。我在设置预构建事件上的解决方案重建遇到了很大的问题，因为他们删除了大部分宏，这对我有很大帮助。

这是我基于 Bejoy 的解决方案（考虑到 .bat 文件位于作为解决方案一部分的 setup 根文件夹中）：

```
call "%VS100COMNTOOLS%\vsvars32.bat"

devenv "%CD%\..\soulutionfile.sln" /build "Release" 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-11T10:45:33.273

您可以从命令行启动 msbuild。msbuild 理解 .sln（解决方案）文件。您可以从命令行指定 .sln 文件和构建配置（调试、发布等）。

[http://msdn.microsoft.com/en-us/library/ms164311.aspx](http://msdn.microsoft.com/en-us/library/ms164311.aspx)
这是有关您可以使用 msbuild 做什么的文档。MSBuild.exe 与 .net 框架一起安装，而不是与 Visual Studio 一起安装。您可以在 c:\windows\microsoft.net\framework\v3.5（或 v2.0.50727）中找到它

我搜索了一下，发现您也可以使用 devenv.exe /build 使用 Visual Studio 进行命令行构建，更多信息在这里：http:
[//msdn.microsoft.com/en-us/library/xee0c8y7 (VS.80 ).aspx](http://msdn.microsoft.com/en-us/library/xee0c8y7(VS.80).aspx)

# mobile - NetBiscuits 好用吗？

> ID：280563
> 
> 赞同：0
> 
> 时间：2008-11-11T10:42:55.727
> 
> 标签：mobile, mobile-website, netbiscuits

有没有人听说过使用 NetBiscuits 构建移动网站的真实故事？

有人告诉我这是移动开发中的下一件大事（[http://www.netbiscuits.com/home](http://www.netbiscuits.com/home)），从他们的网站上看，它看起来很不错。只是想知道是否有人（除了他们）实际使用过它。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-03-18T06:33:20.287

从使用它几个月的时间开始，我可以说它们确实是最好的（如果不是最好的）之一。支持也*非常*快速和良好。

唯一让我停止使用它的是价格。特别是如果您是一家小公司并且想要使用他们的 POI 功能。

但是我还没有找到一个好的替代品。最终可能会推出我自己的版本......

编辑：相关[问题](https://stackoverflow.com/questions/5041804/any-netbiscuits-experiences-and-opinions/5348926#5348926)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-07-15T01:34:57.047

他们创建了一个完整的基于 xml (bml) 的标记语言，它模拟了具有非常陡峭的学习曲线的 html。我会认真重新考虑使用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-23T07:37:00.723

我已经看到它运行良好。它还支持 ASP.NET 控件 SDK，可用于从 Visual Studio 编写 ASP.NET 应用程序。在您的场所部署此应用程序后，您可以使用 Live Bridge 代理将此应用程序连接到 Net Biscuits 托管的 Live Bridge 服务器。在这种情况下，您的应用称为后端应用。当您确实希望在您的应用程序中具有表单功能并且希望它可以在 NetBiscuits 平台上访问时，这是一个非常有用的功能。

检查[http://kb.netbiscuits.com/tactile/edc/livebridge_help.html](http://kb.netbiscuits.com/tactile/edc/livebridge_help.html)。BiscuitML 也更容易掌握。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-12-04T05:30:57.443

不过要注意性能问题。澳大利亚的客户遇到了响应时间问题 - 可能是由于云平台位于美国/英国。

# c# - 在 C# 中每天运行一次

> ID：280566
> 
> 赞同：17
> 
> 时间：2008-11-11T10:44:54.397
> 
> 标签：c#, scheduling

有没有什么聪明的方法可以让我的 executeEveryDayMethod() 每天执行一次，而不必涉及 Windows TaskScheduler？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-11T11:04:33.500

我通过执行以下操作实现了这一点......

1.  设置一个每 20 分钟触发一次的计时器（尽管实际时间取决于您——我需要在一天中多次运行）。
2.  在每个 Tick 事件上，检查系统时间。将时间与您的方法的计划运行时间进行比较。
3.  如果当前时间小于计划时间，则在某个持久存储中检查 a 以获取该方法最后一次运行的日期时间值。
4.  如果该方法上次运行时间超过 24 小时，请运行该方法，并将此运行的日期时间存储回您的数据存储
5.  如果该方法最后一次运行是在过去 24 小时内，请忽略它。

高温高压

*edit - C# 中的代码示例 :: 注意：未经测试...

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Timers;

namespace ConsoleApplication2
{
    class Program
    {
        static void Main(string[] args)
        {
            Timer t1 = new Timer();
            t1.Interval = (1000 * 60 * 20); // 20 minutes...
            t1.Elapsed += new ElapsedEventHandler(t1_Elapsed);
            t1.AutoReset = true;
            t1.Start();

            Console.ReadLine();
        }

        static void t1_Elapsed(object sender, ElapsedEventArgs e)
        {
            DateTime scheduledRun = DateTime.Today.AddHours(3);  // runs today at 3am.
            System.IO.FileInfo lastTime = new System.IO.FileInfo(@"C:\lastRunTime.txt");
            DateTime lastRan = lastTime.LastWriteTime;
            if (DateTime.Now > scheduledRun)
            {
                TimeSpan sinceLastRun = DateTime.Now - lastRan;
                if (sinceLastRun.Hours > 23)
                {
                    doStuff();
                    // Don't forget to update the file modification date here!!!
                }
            }
        }

        static void doStuff()
        {
            Console.WriteLine("Running the method!");
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-11T12:40:39.030

看看[quartz.net](http://quartznet.sourceforge.net/)。它是.net 的调度库。

更具体的看[这里](http://quartznet.sourceforge.net/tutorial/lesson_4.html)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T10:55:01.677

如果它运行的时间不相关并且可以在每次程序启动时重置，您可以设置一个计时器，这是最简单的事情。如果这是不可接受的，它就会开始变得更加复杂，就像[这里](http://staceyw.spaces.live.com/blog/cns!f4a38e96e598161e!1041.entry)介绍的解决方案一样，它仍然不能解决持久性问题，如果你真的希望做计划任务会做的事情，你需要单独解决这个问题。我真的会再次考虑是否值得通过所有的麻烦来复制一个完美的现有功能。

这是一个[相关的问题](https://stackoverflow.com/questions/169332/is-there-a-timer-class-in-c-that-isnt-in-the-windowsforms-namespace)（示例取自那里）。

```
using System;
using System.Timers;

public class Timer1
{
    private static Timer aTimer = new System.Timers.Timer(24*60*60*1000);

    public static void Main()
    {
        aTimer.Elapsed += new ElapsedEventHandler(ExecuteEveryDayMethod);
        aTimer.Enabled = true;

        Console.WriteLine("Press the Enter key to exit the program.");
        Console.ReadLine();
    }

    // Specify what you want to happen when the Elapsed event is 
    // raised.
    private static void ExecuteEveryDayMethod(object source, ElapsedEventArgs e)
    {
        Console.WriteLine("The Elapsed event was raised at {0}", e.SignalTime);
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-06-08T22:49:21.760

public partial class Main : Form {
public Main( ) // Windows Form 被调用 Main { InitializeComponent( ); }

```
 private void Main_Load( object sender, EventArgs e )
    {
        /*
         This example uses a System.Windows.Forms Timer

         This code allows you to schedule an event at any given time in one day.
         In this example the timer will tick at 3AM.

         */
        Int32 alarm = GetAlarmInMilliseconds( 3, 0, 0 ); // Milliseconds until 3:00 am.
        timer_MessageCount.Interval = alarm; // Timer will tick at 3:00am.

        timer_MessageCount.Start( );                    
    }

    private Int32 GetAlarmInMilliseconds(Int32 eventHour, Int32 eventMinute, Int32 eventSecond )
    {
        DateTime now = DateTime.Now;
        DateTime eventTime = new DateTime( now.Year, now.Month, now.Day, eventHour, eventMinute, eventSecond );

        TimeSpan ts;

        if ( eventTime > now )
        {
            ts = eventTime - now;
        }
        else
        {
            eventTime = eventTime.AddDays( 1 );
            ts = eventTime - now;
        }

        Console.WriteLine("Next alarm in: {0}", ts );

        return ( Int32 ) ts.TotalMilliseconds;
    }        

    static void DoSomething( )
    {
        Console.WriteLine( "Run your code here." );
    }      

    private void timer_MessageCount_Tick( object sender, EventArgs e )
    {
        DoSomething( );

        Int32 alarm = GetAlarmInMilliseconds( 3, 0, 0 ); // Next alarm time = 3AM
        timer_MessageCount.Interval = alarm;            
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T10:55:45.983

如果您在某个时间范围内，您可以查询时间并运行，这样即使机器关闭，您也会调用该方法或使用 Vinko 建议的计时器。

但是更好的解决方案（类似于旧的 CRON 版本，因此它是一种经过验证的模式）是拥有一些持久性数据，我现在能想到的最便宜的解决方案是一个空白文件，检查其最后修改的属性，如果它没有t 在过去 24 小时内被修改，您触摸它并运行您的方法。通过这种方式，您可以确保在应用程序周末外出的情况下首先运行该方法。

我以前在 C# 中做过这个，但它是一年前的另一个工作，所以我没有代码，但它大约有 20 行（带有注释和所有）左右。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T11:08:02.137

如果计算机重新启动可能会出现问题，因此您可以将应用程序作为 Windows 服务运行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-10-29T03:28:08.567

要在每天晚上 7 点到 8 点之间运行一次作业，我设置了一个间隔 = 3600000 毫秒的计时器，然后只需执行以下代码进行计时器滴答。

```
private void timer1_Tick(object sender, EventArgs e)
{
    //ensure that it is running between 7-8pm daily.
    if (DateTime.Now.Hour == 19)
    { 
        RunJob(); 
    }
 } 
```

一个小时的窗口对我来说很好。时间上的额外粒度将需要更小的计时器间隔（一分钟 60000），包括 if 的分钟数。

例如

```
{
    //ensure that it is running at 7:30pm daily.
    if (DateTime.Now.Hour == 19 && DateTime.Now.Minute == 30)
    { 
        RunJob(); 
    }
 } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-07-17T20:44:37.550

如果您只想每天运行一次并且不在乎何时运行，这将起作用（将在午夜之后运行）。

声明一个`DateTime`变量：

```
DateTime _DateLastRun; 
```

在您的启动中，设置初始日期值：

```
_DateLastRun = DateTime.Now.Date; 
```

在要检查是否执行该操作的逻辑区域中：

```
if (_DateLastRun < DateTime.Now.Date) 
{
    // Perform your action
    _DateLastRun= DateTime.Now.Date;
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-06-22T11:10:14.630

你可以试试这个解决方案。

```
 public Main()
    {
        StartService();
    }

    public async Task StartService(CancellationToken token = default(CancellationToken))
    {
        while (!token.IsCancellationRequested)
        {
            ExecuteFunction();
            try
            {
                await Task.Delay(TimeSpan.FromDays(1), token);
            }
            catch (TaskCanceledException)
            {
                break;
            }
        }
    }

    public async Task ExecuteFunction()
    {
        ...
    } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-11-19T12:42:20.087

如果您正在运行 Windows 窗体应用程序，以下是您可以执行的操作。但是您需要配置一个设置，以便您可以存储触发事件的最后日期。如果您从不打算关闭应用程序，您可以将日期存储为静态值。

我使用计时器来触发事件，如下所示：

```
 private void tmrAutoBAK_Tick(object sender, EventArgs e)
        {
            if (BakDB.Properties.Settings.Default.lastFireDate != DateTime.Now.ToString("yyyy-MM-dd"))
            {
                 tmrAutoBAK.Stop(); //STOPS THE TIMER IN CASE OF EVENTUAL MESSAGEBOXES.
                 createBakup(); //EVENT
                 BakDB.Properties.Settings.Default.lastFireDate = DateTime.Now.ToString("yyyy-MM-dd"); //STORING CURRENT DATE TO SETTINGS FILE.
                 BakDB.Properties.Settings.Default.Save(); //SAVING THE SETTING FILE.
                 tmrAutoBAK.Start(); //RESTARTING TIMER
            }
        } 
```

# c - 如何控制 popen 标准输入、标准输出、标准错误重定向？

> ID：280571
> 
> 赞同：31
> 
> 时间：2008-11-11T10:46:34.253
> 
> 标签：c, unix

我对 popen() 如何在 unix 中重定向子进程的标准输入、标准输出和标准错误感到困惑。popen() 的手册页在这方面不是很清楚。通话

```
FILE *p = popen("/usr/bin/foo", "w"); 
```

派生一个子进程并执行带有参数“-c”、“/usr/bin/foo”的 shell，并将此 shell 的标准输入（即 foo 的标准输入重定向）、标准输出重定向到 p。但是 stderr 会发生什么？其背后的一般原则是什么？

我注意到，如果我在 foo 中打开一个文件（使用 fopen、socket、accept 等），并且父进程没有标准输出，它会被分配下一个可用的文件编号，即 1，依此类推。这会通过 fprintf(stderr, ...) 等调用提供意想不到的结果。

可以通过写来避免

```
FILE *p = popen("/usr/bin/foo 2>/dev/null", "w"); 
```

在父程序中，但他们有更好的方法吗？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-11-11T11:09:47.357

`popen(3)`只是一个库函数，它依赖于`fork(2)`并`pipe(2)`完成真正的工作。

但是`pipe(2)`只能创建单向管道。要发送子进程输入并捕获输出，您需要打开两个管道。

如果你也想捕获`stderr`，那是可能的，但是你需要**三个**管道和一个循环来仲裁和流`select`之间的读取。`stdout``stderr`

[这里](http://jineshkj.wordpress.com/2006/12/22/how-to-capture-stdin-stdout-and-stderr-of-child-program/)有一个两管版本的示例。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2011-04-05T12:52:19.983

简单的想法：为什么不将“2>&1”添加到命令字符串以强制 bash 将 stderr 重定向到 stdout（好吧，仍然无法写入 stdin，但至少我们将 stderr 和 stdout 放入我们的 C 程序中）。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-11T10:52:22.573

> popen() 的返回值在所有方面都是一个普通的标准 I/O 流，除了它必须用 pclose() 而不是 fclose(3) 关闭。写入这样的流会写入命令的标准输入；该命令的标准输出与调用 popen() 的进程的标准输出相同，除非它被命令本身更改。相反，从“弹出”流中读取命令的标准输出，命令的标准输入与调用 popen() 的进程的标准输入相同。

从它的联机帮助页中，它允许您读取命令标准输出或写入其标准输入。它没有说任何关于 stderr 的内容。因此，它不会被重定向。

如果您提供“w”，您会将您的内容发送到执行的 shell 的标准输入。因此，做

```
FILE * file = popen("/bin/cat", "w");
fwrite("hello", 5, file);
pclose(file); 
```

将使 shell 执行 /bin/cat，并将字符串`"hello"`作为标准输入流传递给它。如果要重定向，例如 stderr 到文件`"foo"`，请先执行此操作，然后再执行上面的代码：

```
FILE * error_file = fopen("foo", "w+");
if(error_file) {
    dup2(fileno(error_file), 2);
    fclose(error_file);
} 
```

它将打开文件，并将其文件描述符复制到 2，然后关闭原始文件描述符。

现在，如果您在父母中关闭了标准输出，那么如果孩子调用`open`它将得到 1，因为那是（如果标准输入已经打开）下一个免费文件描述符。我看到的唯一解决方案是仅使用 dup2 并将某些内容复制到父级中，例如上面的代码。请注意，如果孩子打开`stdout`，它也*不会*在`stdout`父母中打开。它在那里保持关闭。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-04-23T19:19:39.660

查看Bart Trojanowski 的[popenRWE](https://github.com/sni/mod_gearman/blob/master/common/popenRWE.c)。清洁所有 3 个管道的方法。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-04-23T03:36:24.663

如果您只想获得 STDERR，请尝试以下操作：

```
#include <stdio.h>
#include <errno.h>
#include <fcntl.h>
#include <sys/wait.h>
#include <malloc.h>
#include <unistd.h>
#include <string.h>
#include <sys/types.h>

/*
 * Pointer to array allocated at run-time.
 */
static pid_t    *childpid = NULL;

/*
 * From our open_max(), {Prog openmax}.
 */
static int      maxfd;

FILE *
mypopen(const char *cmdstring, const char *type)
{
    int     i;
    int     pfd[2];
    pid_t   pid;
    FILE    *fp;

    /* only allow "r" "e" or "w" */
    if ((type[0] != 'r' && type[0] != 'w' && type[0] != 'e') || type[1] != 0) {
        errno = EINVAL;     /* required by POSIX */
        return(NULL);
    }

    if (childpid == NULL) {     /* first time through */
        /* allocate zeroed out array for child pids */
        maxfd = 256;
        if ((childpid = calloc(maxfd, sizeof(pid_t))) == NULL)
            return(NULL);
    }

    if (pipe(pfd) < 0)
        return(NULL);   /* errno set by pipe() */

    if ((pid = fork()) < 0) {
        return(NULL);   /* errno set by fork() */
    } else if (pid == 0) {                          /* child */
        if (*type == 'e') {
            close(pfd[0]);
            if (pfd[1] != STDERR_FILENO) {
                dup2(pfd[1], STDERR_FILENO);
                close(pfd[1]);
            }
        } else if (*type == 'r') {
            close(pfd[0]);
            if (pfd[1] != STDOUT_FILENO) {
                dup2(pfd[1], STDOUT_FILENO);
                close(pfd[1]);
            }
        } else {
            close(pfd[1]);
            if (pfd[0] != STDIN_FILENO) {
                dup2(pfd[0], STDIN_FILENO);
                close(pfd[0]);
            }
        }

        /* close all descriptors in childpid[] */
        for (i = 0; i < maxfd; i++)
            if (childpid[i] > 0)
                close(i);

        execl("/bin/sh", "sh", "-c", cmdstring, (char *)0);
        _exit(127);
    }

    /* parent continues... */
    if (*type == 'e') {
        close(pfd[1]);
        if ((fp = fdopen(pfd[0], "r")) == NULL)
            return(NULL);
    } else if (*type == 'r') {
        close(pfd[1]);
        if ((fp = fdopen(pfd[0], type)) == NULL)
            return(NULL);

    } else {
        close(pfd[0]);
        if ((fp = fdopen(pfd[1], type)) == NULL)
            return(NULL);
    }

    childpid[fileno(fp)] = pid; /* remember child pid for this fd */
    return(fp);
}

int
mypclose(FILE *fp)
{
    int     fd, stat;
    pid_t   pid;

    if (childpid == NULL) {
        errno = EINVAL;
        return(-1);     /* popen() has never been called */
    }

    fd = fileno(fp);
    if ((pid = childpid[fd]) == 0) {
        errno = EINVAL;
        return(-1);     /* fp wasn't opened by popen() */
    }

    childpid[fd] = 0;
    if (fclose(fp) == EOF)
        return(-1);

    while (waitpid(pid, &stat, 0) < 0)
        if (errno != EINTR)
            return(-1); /* error other than EINTR from waitpid() */

    return(stat);   /* return child's termination status */
}

int shellcmd(char *cmd){
    FILE *fp;
    char buf[1024];
    fp = mypopen(cmd,"e");
    if (fp==NULL) return -1;

    while(fgets(buf,1024,fp)!=NULL)
    {
        printf("shellcmd:%s", buf);
    }

    pclose(fp);
    return 0;
}

int main()
{
    shellcmd("ls kangear");
} 
```

你会得到这个：

```
shellcmd:ls: cannot access kangear: No such file or directory 
```

# c# - Winforms中的窗口句柄调试

> ID：280573
> 
> 赞同：1
> 
> 时间：2008-11-11T10:46:46.593
> 
> 标签：c#, winforms, window

我有一个用户不断收到此错误。是否有一个工具可以处理窗口处理计数，我可以用它来找出他为什么不断收到这个错误。

System.ComponentModel.Win32Exception：创建窗口句柄时出错。在 System.Windows.Forms.NativeWindow.CreateHandle(CreateParams cp) 在 System.Windows.Forms.Control.CreateHandle() 在 System.Windows.Forms.Form.CreateHandle() 在 System.Windows.Forms.Control.get_Handle()在 System.Windows.Forms.Form.ShowDialog（IWin32Window 所有者）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-22T21:38:00.720

如果您正在创建的窗体覆盖 WndProc()，请注意确保它在窗口创建过程中始终调用 base.WndProc()。

我无意中在我的覆盖中省略了对 base.WndProc() 的调用，并得到了你的堆栈跟踪。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T11:04:24.890

也许这会有所帮助：

[未处理的异常 Win32Exception，创建窗口句柄时出错](http://www.aboutmydot.net/index.php/unhandled-exception-win32exceptionerror-creating-window-handle)

[CLR 调试器 (DbgCLR.exe)](http://msdn.microsoft.com/en-us/library/7zxbks7z(VS.80).aspx)

矿机调试器位于：

```
"c:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\GuiDebug\DbgCLR.exe"
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T20:04:58.090

我知道的最好的计数器是 Taskmgr.exe。查看 + 选择列并检查“用户对象”、“句柄计数”和“GDI 对象”。

通用诊断是您正在泄漏句柄并消耗了其中的 10,000 个。注意 .NET 2.0 SP1 和 .NET 3.5 的 Graphics.CopyFromScreen() 中的句柄泄漏错误，该错误已在 3.5 SP1 中修复。

# c# - 如何使用从程序集中动态加载的接口并调用其成员

> ID：280578
> 
> 赞同：3
> 
> 时间：2008-11-11T10:48:31.630
> 
> 标签：c#, reflection, interface, assemblies, pinvoke

我有一些代码来加载程序集并获取所有类型，它们实现了某个接口，就像这样（假设 asm 是一个有效且已加载的程序集）。

```
var results = from type in asm.GetTypes()
  where typeof(IServiceJob).IsAssignableFrom(type)
  select type; 
```

现在我被困住了：我需要创建这些对象的实例并调用对象的方法和属性。而且我需要将创建的对象的引用存储在一个数组中以供以后使用。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-11T10:53:31.477

哦，哇——我几天前才[在博客上写过这个。](http://www.madprops.org/blog/linq-with-reflection-part-2/)这是我返回实现给定接口的所有类型的实例的方法：

```
private static IEnumerable<T> InstancesOf<T>() where T : class
{
    var type = typeof(T);
    return from t in type.Assembly.GetExportedTypes()
           where t.IsClass
               && type.IsAssignableFrom(t)
               && t.GetConstructor(new Type[0]) != null
           select (T)Activator.CreateInstance(t);
} 
```

如果您将其重构为接受程序集参数而不是使用接口的程序集，它就会变得足够灵活以满足您的需要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T11:02:39.510

您可以使用以下方法创建类型的实例`Activator.CreateInstance`：-

```
IServiceJob x = Activator.CreateInstance(type); 
```

所以你的代码变成： -

```
IServiceJob[] results = (from type in asm.GetTypes()
  where typeof(IServiceJob).IsAssignableFrom(type)
  select (IServiceJob)Activator.CreateInstance(type)).ToArray(); 
```

（注意将 var 更改为 IServiceJob[] 以明确创建的内容）。

# c# - 如何将孩子的值传递回父表单？

> ID：280579
> 
> 赞同：49
> 
> 时间：2008-11-11T10:48:53.983
> 
> 标签：c#, .net, winforms, parent-child

如何将孩子的值传递回父表单？我有一个字符串，我想传回给父级。

我使用以下方法启动了孩子：

```
FormOptions formOptions = new FormOptions();
formOptions.ShowDialog(); 
```

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-11-11T10:52:13.213

在 上创建一个属性（或方法）`FormOptions`，例如`GetMyResult`：

```
using (FormOptions formOptions = new FormOptions())
{
    formOptions.ShowDialog();

    string result = formOptions.GetMyResult;

    // do what ever with result...
} 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-11-11T11:47:44.707

**如果您只是使用 formOptions 来选择单个值然后关闭，那么 Mitch 的建议是一个不错的选择**。如果您需要孩子在保持打开状态的同时与父母交流，我将在这里使用我的示例。

在您的父窗体中，添加子窗体将调用的公共方法，例如

```
public void NotifyMe(string s)
{
    // Do whatever you need to do with the string
} 
```

接下来，当您需要从父窗口启动子窗口时，请使用以下代码：

```
using (FormOptions formOptions = new FormOptions())
{
    // passing this in ShowDialog will set the .Owner 
    // property of the child form
    formOptions.ShowDialog(this);
} 
```

在子窗体中，使用此代码将值传递回父窗体：

```
ParentForm parent = (ParentForm)this.Owner;
parent.NotifyMe("whatever"); 
```

此示例中的代码将更好地用于类似工具箱窗口之类的东西，该窗口旨在浮动在主窗体上方。在这种情况下，您将使用 .Show() 而不是 .ShowDialog() 打开子表单（使用 .TopMost = true）。

这样的设计意味着子窗体与父窗体紧密耦合（因为子窗体必须将其所有者转换为 ParentForm 才能调用其 NotifyMe 方法）。然而，这并不是一件坏事。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-11-11T11:10:26.017

您还可以创建公共属性。

```
// Using and namespace...

public partial class FormOptions : Form
{
    private string _MyString;    //  Use this
    public string MyString {     //  in 
      get { return _MyString; }  //  .NET
    }                            //  2.0

    public string MyString { get; } // In .NET 3.0 or newer

    // The rest of the form code
} 
```

然后你可以得到它：

```
FormOptions formOptions = new FormOptions();
formOptions.ShowDialog();

string myString = formOptions.MyString; 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-11-11T12:13:13.893

您还可以在子类中创建 ShowDialog 的重载，该重载会获取一个返回结果的 out 参数。

```
public partial class FormOptions : Form
{
  public DialogResult ShowDialog(out string result)
  {
    DialogResult dialogResult = base.ShowDialog();

    result = m_Result;
    return dialogResult;
  }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-27T15:54:43.103

使用子窗体的公共属性

```
frmOptions {
     public string Result; }

frmMain {
     frmOptions.ShowDialog(); string r = frmOptions.Result; } 
```

使用事件

```
frmMain {
     frmOptions.OnResult += new ResultEventHandler(frmMain.frmOptions_Resukt);
     frmOptions.ShowDialog(); } 
```

使用主窗体的公共属性

```
frmOptions {
     public frmMain MainForm; MainForm.Result = "result"; }

frmMain {
     public string Result;
     frmOptions.MainForm = this;
     frmOptions.ShowDialog();
     string r = this.Result; } 
```

使用对象 Control.Tag；这对于所有可以包含 System.Object 的控件公共属性都是常见的。您可以将 string 或 MyClass 或 MainForm 放在那里 - 任何东西！

```
frmOptions {
     this.Tag = "result": }
frmMain {
     frmOptions.ShowDialog();
     string r = frmOptions.Tag as string; } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-05-29T10:10:25.907

好吧，我在这里遇到了同样的问题——也许有点不同。但是，我认为这就是我解决它的方法：

1.  在我的父表单中，我声明了没有实例的子表单，例如`RefDateSelect myDateFrm;`所以这对我在这个类/表单中的其他方法可用

2.  接下来，一个方法通过新实例显示孩子：

    ```
    myDateFrm = new RefDateSelect();
    myDateFrm.MdiParent = this;
    myDateFrm.Show();
    myDateFrm.Focus(); 
    ```

3.  我的第三种方法（需要孩子的结果）可以随时出现并且只需得到结果：

    ```
    PDateEnd = myDateFrm.JustGetDateEnd();
    pDateStart = myDateFrm.JustGetDateStart();` 
    ```

    注意：子方法`JustGetDateStart()`在 CHILD 中是公共的，如下所示：

    ```
    public DateTime JustGetDateStart()
    {
        return DateTime.Parse(this.dtpStart.EditValue.ToString());
    } 
    ```

我希望这有帮助。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-02-22T02:06:33.043

如果您将子窗体显示为模式对话框，则可以使用来自 DialogResult 枚举的值设置子窗体的 DialogResult 属性，这反过来隐藏模式对话框，并将控制权返回给调用窗体。此时父级可以访问子窗体的数据以获取它需要的信息。

有关更多信息，请查看此链接： http: [//msdn.microsoft.com/en-us/library/system.windows.forms.form.dialogresult (v=vs.110).aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.dialogresult(v=vs.110).aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-11-29T12:22:35.017

适用于 Picrofo EDY

这取决于，如果您使用`ShowDialog()`来显示您的表单并关闭它，您使用关闭按钮而不是`this.Close()`。表单不会被丢弃或销毁，只会被隐藏，消失后可以进行更改。为了正确关闭它，您将需要`Dispose()`or`Close()`方法。另一方面，如果您使用该`Show()`方法并关闭它，则表单将被丢弃并且无法修改。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-06-27T09:39:37.717

我有同样的问题我就这样解决了，这里是新手一步一步的指导

首先在表单类的顶部创建子表单的对象，然后将该对象用于子表单的每个操作，例如显示子表单并从中读取值。

例子

```
namespace ParentChild
{
   // Parent Form Class
    public partial class ParentForm : Form
    {
        // Forms Objects
        ChildForm child_obj = new ChildForm();

        // Show Child Forrm
        private void ShowChildForm_Click(object sender, EventArgs e)
        {
            child_obj.ShowDialog();
        }

       // Read Data from Child Form 
        private void ReadChildFormData_Click(object sender, EventArgs e)
        {
            int ChildData = child_obj.child_value;  // it will have 12345
        }

   }  // parent form class end point

   // Child Form Class
    public partial class ChildForm : Form
    {

        public int child_value = 0;   //  variable where we will store value to be read by parent form  

        // save something into child_value  variable and close child form 
        private void SaveData_Click(object sender, EventArgs e)
        {
            child_value = 12345;   // save 12345 value to variable
            this.Close();  // close child form
        }

   }  // child form class end point

}  // name space end point 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-27T14:17:09.273

我认为最简单的方法是在您的 FormOptions 类中使用 Tag 属性设置您需要传递的 Tag = 值，然后在 ShowDialog 方法将其读取为

```
myvalue x=(myvalue)formoptions.Tag; 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-11T10:55:53.580

这里有很多剥猫皮的方法，[@Mitch 的建议](https://stackoverflow.com/questions/280579/c-beginner-help-how-do-i-pass-a-value-from-a-child-back-to-the-parent-form#280586)是一个好方法。如果您希望客户端表单具有更多“控制”，您可能希望在创建时将父级实例传递给子级，然后您可以在子级上调用任何公共父级方法。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-06-13T10:57:33.320

当您使用`ShowDialog()`or`Show()`方法，然后关闭表单时，表单对象不会被完全销毁（*关闭！= 破坏*）。它会一直活着，只是它处于“关闭”状态，你仍然可以对它做事。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-01-31T07:10:34.757

最快和更灵活的方法是将父级从构造函数传递给子级，如下所示：

1.  在父窗体中声明一个属性：

    `public string MyProperty {get; set;}`

2.  以子形式从父级声明一个属性：

    `private ParentForm ParentProperty {get; set;}`

3.  像这样编写孩子的构造函数：

    ```
     public ChildForm(ParentForm parent){
          ParentProperty= parent;
      } 
    ```

4.  在子窗体中随处更改父属性的值：

    `ParentProperty.MyProperty = "New value";`

完成。父窗体中的属性`MyProperty`已更改。使用此解决方案，您可以更改子窗体中的多个属性。太好吃了，不是吗？！

# sql-server - 保存时日期日/月反转的问题

> ID：280597
> 
> 赞同：0
> 
> 时间：2008-11-11T10:56:09.943
> 
> 标签：sql-server, vb6, asp-classic

我们有一个问题只影响生产环境。

我们有一个 VB6/ASP 网站，允许手动编辑数据库表中的数据。

它看起来很像一个可编辑的数据网格。

其中一个可编辑的列是日期，当保存记录时，日期/月会被反转。

03/11/2008 变为 11/03/2008，如果您要重新保存记录，日期又是 03/11/2008。

我已经检查了 DB 值，它确实被反转了，但是测试系统上相同的相同代码并没有这样做。

所以我非常有信心我正在寻找环境变化。测试系统在本地托管了数据库和站点，在实时设置中，我们有一个单独的网站服务器和数据库服务器。你建议我从哪里开始寻找这个问题。我检查了服务器上的区域设置，它们设置为英国，操作系统日期格式正确。

这是 SQL Server 2000。给我一些想法！

谢谢 ：）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T10:59:57.813

这几乎肯定与您的机器或数据库服务器设置为美国日期格式有关。仔细检查两个系统设置。

或者，快速的[谷歌搜索](http://www.google.co.uk/search?hl=en&client=firefox-a&rls=org.mozilla%3Aen-GB%3Aofficial&hs=JUW&q=sql+server+date+format+us+uk&btnG=Search&meta=)将提供一些用于操作数据的选项，以便它可以满足您的需求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T11:15:00.733

如果在将用户提供的字符串提供给数据库*之前*将其转换为日期，则执行 ASP 页面的线程的[Session.LCID](http://msdn.microsoft.com/en-us/library/ms525071.aspx)负责解释日期的方式。

如果您将日期作为字符串提供给 SQL Server 并让转换在那里进行，那么查看[`SET DATEFORMAT`](http://msdn.microsoft.com/en-us/library/ms189491.aspx)和[`SET LANGUAGE`](http://msdn.microsoft.com/en-us/library/ms174398.aspx)语句将很有用。

所以我的想法是：要么停止使用（鼓励你的用户使用）模糊的日期格式，这个问题就会消失，或者确保处理链的所有环节都清楚地了解期望的格式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T10:57:21.453

操作系统的区域设置如何？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T11:18:59.960

以下

从 syslanguages 中选择名称、别名、日期格式，其中 langid =（从 master..sysconfigures 中选择值，其中注释 = '默认语言'）

在测试和现场返回相同的结果

us_english 英语 mdy

问题是系统无法重新部署以进行更改。我需要找出原因并解决它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T13:46:55.823

进入 regedit 并转到 Windows 注册表中的以下位置：

HKEY_USERS.DEFAULT\控制面板\国际\

检查以确保“sShortDate”字段正确。

多次存储在此位置的短日期格式与存储在 Windows 控制面板/区域选项中的短日期格式不同。区域选项中的短日期适用于您登录 Windows 的用户。Windows 服务使用的短日期格式的 HKEY_USERS 中的“sShortDate”字段。

# java - Vista 上的 Java File.canWrite() 和超级隐藏文件

> ID：280600
> 
> 赞同：1
> 
> 时间：2008-11-11T10:57:27.103
> 
> 标签：java, file, windows-vista, hidden

我有一些代码可以有效地做到这一点：

```
File file = new File("C:\\Program Files (x86)\\Something\\fred.txt");
System.out.println("file.canWrite() = " + file.canWrite()); 
```

它打印真实。现在奇怪的是，我可以毫无例外地创建文件。此外，另一个程序可以读取我创建的文件。问题是，在 Windows 资源管理器中，该文件根本不显示！

显示您可能正在考虑的隐藏文件，但不，我已打开该选项。

我还发现了有关 Vista 中的“超级隐藏文件”，所以我打开了该选项，但我仍然看不到该文件！也许我没有正确编辑我的注册表 - 我只能假设该文件是超级隐藏的 - 它还能在哪里？

现在的问题是我正在创建一个 html 文件，当我启动浏览器时，它看不到 html 文件，因为它是超级隐藏的。

如何防止 Java 创建超级隐藏文件？这是在 JRE 6 update 6 下运行的。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-11T11:02:31.990

您很可能是文件夹重定向的“受害者”。启用 UAC 后，当您未以管理员身份运行程序时，对 Program Files 的任何写入都会重定向到其他位置。

您应该在 C:\Users\<username>\AppData\Local\VirtualStore\<insert>\<expected>\<path>\<here> 中找到您的文件。

当然，正确的解决方法是首先不写入 Program Files。相反，请使用用户主目录中的某个位置（您应该写入的确切位置取决于应用程序的用途）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T11:05:04.747

我相信更新 10 可能已经改变了这种行为。我知道重新实现了很多浏览器的东西可以更好地与 vista 一起工作。虽然我不是 100% 肯定，但我建议你看看。

# wpf - 如何在 WPF 中预览 Windows Media Encoder 会话？

> ID：280604
> 
> 赞同：3
> 
> 时间：2008-11-11T11:00:00.123
> 
> 标签：wpf, directshow, windows-media-encoder

此代码适用于 Windows 窗体应用程序（它显示预览），但不适用于 WPF 应用程序。

```
WMEncoder _encoder;
WMEncDataView _preview;
_encoder = new WMEncoder();

IWMEncSourceGroupCollection SrcGrpColl = _encoder.SourceGroupCollection;
IWMEncSourceGroup2 sourceGroup = (IWMEncSourceGroup2)SrcGrpColl.Add("SG_1");
IWMEncVideoSource2 videoDevice = (IWMEncVideoSource2)sourceGroup.AddSource(WMENC_SOURCE_TYPE.WMENC_VIDEO);
videoDevice.SetInput("Default_Video_Device", "Device", "");
IWMEncAudioSource audioDevice = (IWMEncAudioSource)sourceGroup.AddSource(WMENC_SOURCE_TYPE.WMENC_AUDIO);
audioDevice.SetInput("Default_Audio_Device", "Device", "");

IWMEncProfile2 profile = new WMEncProfile2();
profile.LoadFromFile("Recording.prx");
sourceGroup.set_Profile(profile);

_encoder.PrepareToEncode(true);

_preview = new WMEncDataView();
int lpreviewStream = videoDevice.PreviewCollection.Add(_preview);

_encoder.Start();

_preview.SetViewProperties(lpreviewStream, (int)windowsFormsHost1.Handle);
_preview.StartView(lpreviewStream); 
```

我尝试使用 WindowsFormsHost 控件来获取要传递的句柄（如示例中所示），但仍然没有运气。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T12:58:15.150

我最近做了一些类似的事情，将现有的 DirectShow 视频组件与新的 WPF UI 集成。有多种方法可以做到这一点，但最简单的方法可能是从[HwndHost](http://msdn.microsoft.com/en-us/library/system.windows.interop.hwndhost.aspx)派生一个新类。然后，您只需覆盖几个方法，将窗口句柄提供给您的预览流，它应该都能正常工作。根据您的要求，您可能需要在 WndProc 中处理几个 Windows 消息，以在视频未播放时处理显示更改和重绘。

```
using System;
using System.Runtime.InteropServices;
using System.Windows;
using System.Windows.Interop;

namespace SOQuestion
{
    public class VideoHost : HwndHost
    {
        protected override HandleRef BuildWindowCore(HandleRef hwndParent)
        {
            IntPtr hwndHost = IntPtr.Zero;
            int hostHeight = (int) this.ActualHeight;
            int hostWidth = (int) this.ActualWidth;

            hwndHost = CreateWindowEx(0, "static", "",
                WS_CHILD | WS_VISIBLE,
                0, 0,
                hostHeight, hostWidth,
                hwndParent.Handle,
                (IntPtr)HOST_ID,
                IntPtr.Zero,
                0);

            return new HandleRef(this, hwndHost);
        }

        protected override void DestroyWindowCore(HandleRef hwnd)
        {
            DestroyWindow(hwnd.Handle);
        }

        protected override void OnWindowPositionChanged(Rect rcBoundingBox)
        {
            base.OnWindowPositionChanged(rcBoundingBox);

            _preview.SetViewProperties(lpreviewStream, (int)this.Handle);
        }

        protected override IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam, IntPtr lParam, ref bool handled)
        {
            // Handle a couple of windows messages if required - see MSDN for details

            return base.WndProc(hwnd, msg, wParam, lParam, ref handled);
        }

        [DllImport("user32.dll", EntryPoint = "CreateWindowEx", CharSet = CharSet.Auto)]
        internal static extern IntPtr CreateWindowEx(int dwExStyle,
        string lpszClassName,
        string lpszWindowName,
        int style,
        int x, int y,
        int width, int height,
        IntPtr hwndParent,
        IntPtr hMenu,
        IntPtr hInst,
        [MarshalAs(UnmanagedType.AsAny)] object pvParam);

        [DllImport("user32.dll", EntryPoint = "DestroyWindow", CharSet = CharSet.Auto)]
        internal static extern bool DestroyWindow(IntPtr hwnd); 

        internal const int WS_CHILD = 0x40000000;
        internal const int WS_VISIBLE = 0x10000000;
        internal const int HOST_ID = 0x00000002;
    }
} 
```

# c# - 哪个更快 - C# 不安全代码或原始 C++

> ID：280624
> 
> 赞同：24
> 
> 时间：2008-11-11T11:05:51.483
> 
> 标签：c#, c++, performance, image-processing, unsafe

我正在编写一个图像处理程序来执行视频帧的实时处理。它在 C# 中使用包装 OpenCV 库 dll（非托管 C++）的 Emgu.CV 库（C#）。现在我必须编写自己的特殊算法，并且它需要尽可能快。

哪个将是算法的更快实现？

1.  在 C# 中编写“不安全”函数

2.  将函数添加到OpenCV库并通过Emgu.CV调用

我猜 C# unsafe 速度较慢，因为它通过 JIT 编译器，但差异会很大吗？

编辑：

在 VS2008 下为 .NET 3.5 编译

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-11-11T11:36:29.037

*它需要尽可能快*

那你问错问题了。

用汇编程序对其进行编码，您支持的每个重要架构变体都有不同的版本。

使用经过优化的优秀 C++ 编译器的输出作为指导，因为它可能知道一些您不知道的技巧。但是您可能会想到一些改进，因为 C++ 不一定会将所有可能对优化有用的信息传达给编译器。例如，C++ 没有 C99 关键字限制。尽管在这种特殊情况下，许多 C++ 编译器（包括 MSVC）现在都支持它，但请尽可能使用它。

当然，如果您的意思是“我希望它快一点，但不要超出 C# 或 C++ 的范围”，那么答案就不同了 ;-)

我希望 C# 在很多情况下至少能够接近外观相似的 C++ 的性能。我当然假设该程序将运行足够长的时间，以至于 JIT 本身所花费的时间是无关紧要的，但如果您正在处理大量视频，那么这似乎很可能。但我也希望有一些事情，如果你在不安全的 C# 中做这些事情，会比 C++ 中的同等事情慢得多。我不知道它们是什么，因为我对 JIT 的所有经验都是在 Java 而不是 CLR 中。在 C++ 中可能还有一些较慢的东西，例如，如果您的算法对 C# 代码进行任何调用。

不幸的是，唯一能确定两者有多接近的方法是同时编写并测试它们，这有点忽略了编写 C++ 版本需要大量额外工作这一点。但是，您可以通过编写一些与您想要执行的处理近似的快速代码来获得一个粗略的想法，而不必全部完成或正确处理。如果您的算法要遍历所有像素并为每个像素执行一些 FP 操作，那么将粗略的基准测试组合在一起应该需要半个小时。

通常我会建议不要开始思考“这需要尽可能快”。要求应该是可以实现的，根据定义，“尽可能 X”只是可以实现的边界。需求也应该是可测试的，除非你知道理论上的最大值，否则“尽可能 X”是不可测试的。一个更友好的要求是“这需要在某某速度的 CPU 上实时处理某某分辨率的视频帧”，或者“这需要比我们主要竞争对手的产品更快”。如果 C# 版本做到了这一点，并留出一点余地来解决用户设置中的意外小问题，那么工作就完成了。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-11T11:20:09.723

它取决于算法、实现、C++ 编译器和 JIT 编译器。我猜在大多数情况下，C++ 实现会更快。但这可能会改变。

JIT 编译器可以针对您的代码运行的平台优化您的代码，而不是像 C++ 编译器那样针对您的代码可能运行的所有平台进行平均。这是较新版本的 JIT 编译器越来越擅长的事情，并且在某些情况下可能会给 JITted 代码带来优势。所以答案并不像你想象的那么清楚。例如，新的 Java 热点编译器就可以很好地做到这一点。

托管代码可能比 C++ 做得更好的其他情况是您需要分配和释放大量小对象。.net 运行时预先分配了可重用的大块内存，因此它不需要在每次需要分配内存时调用操作系统。

我不确定 unsafe C# 的运行速度是否比普通 C# 快得多。你也得试试这个。

如果您想知道什么是适合您的情况的最佳解决方案，您必须尝试两者并衡量差异。我认为不会超过

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-11T11:26:39.133

语言没有“速度”。这取决于编译器和代码。用任何语言编写低效代码都是可能的，无论源语言是什么，一个聪明的编译器都会生成接近最优的代码。

C# 和 C++ 之间唯一真正不可避免的性能因素是 C# 应用程序在启动时必须做更多的事情（加载 .NET 框架，可能还 JIT 一些代码），所以在所有条件相同的情况下，它们的启动速度会慢一些。在那之后，这取决于，并且没有根本原因为什么一种语言必须总是比另一种更快。

我也不知道为什么不安全的 C# 应该比安全更快。一般来说，安全是好的，因为它允许编译器做出一些更强大的假设，因此安全*可能*更快。但同样，这取决于您正在编译的代码、您正在使用的编译器以及其他十几个因素。

简而言之，放弃可以衡量语言性能的想法。你不能。语言从来没有“快”或“慢”之分。它没有速度。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-11T12:43:07.560

C# 通常比 C++ 慢。托管代码中有运行时检查。毕竟，这些都是使它受到管理的原因。例如，C++ 不必检查数组的边界是否已超出。

根据我的经验，使用固定内存有很大帮助。.NET 4.0 中有一个新的[System.IO.UnmanagedMemoryAccessor](http://blogs.msdn.com/bclteam/archive/2008/11/04/what-s-new-in-the-bcl-in-net-4-0-justin-van-patten.aspx)类，将来可能会有所帮助。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-11T13:45:32.037

如果您打算以标准方式实现您的算法，我认为这无关紧要。但是有些语言绑定了 api 或库，可以给你一个非标准的提升。

1.  考虑是否可以使用 GPU 处理 - nvidia 和 ati 提供 CUDA 和 CTM 框架，并且 khronos 组 (openGL) 正在进行标准化工作。一种预感还告诉我，AMD 将在他们未来的芯片中添加至少一个流处理器内核。所以我认为在那个领域有很大的希望。

2.  试着看看你是否可以利用 SSE 指令，周围有一些库——大多数是 C++ 或 C——提供方便的 api，检查英特尔的网站以获得方便的优化库，我确实记得“英特尔性能基元”和“数学内核”。

但在政治方面，请务必将您的算法纳入 OpenCV，以便其他人也可以从中受益。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-07-18T13:30:59.983

这是一场将永远持续下去的战斗。C 与 C++ 与 C# 与其他任何东西。在 C# 中，不安全的概念是解锁“危险”操作。即，指针的使用，以及能够转换为 void 指针等，就像在 C 和 C++ 中一样。非常危险，而且非常强大！但是打败了 C# 的基础。

您会发现，如今，Microsoft 在性能方面取得了长足的进步，尤其是自 .NET 发布以来，并且 .NET 的下一个版本实际上将支持内联方法，就像您可以使用 C++ 一样。这将提高非常特定情况下的性能。我讨厌它不是 ac# 功能，而是编译器选择的一个讨厌的属性——但你不能拥有它。

就个人而言，我正在使用 C# 和托管 DirectX 编写游戏（为什么不使用 XNA？？超出了本文的范围）。我在图形情况下使用了不安全的代码，这引起了对其他人所说的方向的认可。

只是因为 GDI++ 的像素访问速度非常慢，我才被迫寻找替代方案。但总的来说，c# 编译器非常好，代码比较（你可以找到文章）你会发现性能与 c++ 非常相似。这并不是说没有更好的方法来编写代码。

归根结底，我个人认为 C、C++ 和 C# 在执行时的速度大致相同。只是在一些痛苦的情况下，您希望与底层硬件密切合作或非常接近这些像素，您会发现 C/C++ 人群有明显的优势。

但是对于商业和当今的大多数事情来说，C# 是一个真正的竞争者，并且保持在“安全”环境中绝对是一个奖励。
走出去时，您可以使用不安全的代码完成大多数事情，就像我一样 - 天哪，我是否走极端了！但这值得吗？可能不是。我个人想知道我是否应该更多地考虑 C++ 中的时间关键代码，以及 C# 中的所有面向对象的安全内容。但我的表现比我想象的要好！

只要您谨慎处理所进行的互操作调用的数量，您就可以两全其美。我个人避免了这种情况，但我不知道要付出什么代价。

因此，一种我没有尝试过但很想听听冒险的方法，在实际使用 C++.NET 开发库时——对于这些特殊的图形情况，这会比 c# 的不安全更快吗？这与本机 C++ 编译代码相比如何？现在有一个问题！

唔..

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-26T04:11:46.690

如果您了解您的环境并且使用了良好的编译器（对于 Windows 上的视频处理，英特尔 C++ 编译器可能是最佳选择），C++ 将轻松击败 C#，原因如下：

*   C++ 运行时环境没有内在的运行时检查（缺点是你可以自由支配自己）。C# 运行时环境将进行一些健全性检查，至少在最初是这样。
*   C++ 编译器是为优化代码而构建的。虽然理论上可以使用 ICC（或 GCC）使用的所有优化 voodo 来实现 C# JIT 编译器，但微软的 JIT 能否可靠地做得更好是值得怀疑的。即使 JIT 编译器具有运行时统计信息，这仍然不如 ICC 或 GCC 中的配置文件引导优化。
*   C++ 环境允许您更好地控制内存模型。如果您的应用程序达到破坏数据缓存或使堆碎片化的地步，您将非常欣赏对分配的额外控制。哎呀，如果你能避免动态分配，你已经好很多了（提示：运行时间`malloc()`或任何其他动态分配器是不确定的，几乎所有非本地语言都强制使用更重的堆，因此更重的分配）。

如果你使用了一个糟糕的编译器，或者如果你不能定位一个好的芯片组，**那么所有的赌注都没有了**。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-10T00:40:21.973

老实说，你用什么语言编写它并不像你使用什么算法那么重要（无论如何，IMO）。也许通过使用本机代码，您*可能*会使您的应用程序更快，但也可能使其更慢——这取决于编译器、程序的编写方式、如果您正在使用会产生什么样的互操作成本混合环境等。如果不对其进行分析，您就不能真正说出来。（而且，就此而言，*您是否分析过您的应用程序？您真的知道它在哪里花费时间吗？*）

更好的算法完全独立于您选择的语言。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-28T20:56:56.290

我的回复有点晚，但我可以给你一些轶事经验。我们有一些矩阵乘法例程，这些例程最初是用 C# 使用指针和不安全代码编写的。这被证明是我们应用程序中的一个瓶颈，然后我们使用 pinning+P/Invoke 调用 C++ 版本的矩阵乘法例程，并获得了 2 倍的改进。这是不久前的 .NET 1.1，所以现在情况可能会更好。正如其他人指出的那样，这并不能*证明*任何事情，但这是一个有趣的练习。

我也同意 thAAAnos，如果你的算法真的必须“尽可能快”地利用 IPL，或者如果你必须考虑 GPU 实现。

* * *

## 回答 #10

> 赞同：-7
> 
> 时间：2008-11-11T11:37:41.967

在 CPU 上运行总是比在 CPU 上的 VM 上运行要快。我无法相信人们试图以其他方式争论。

例如，我们的网络服务器上有一些相当繁重的图像处理工作正在排队。最初为了让它工作，我们使用了 PHP 的 GD 函数。

他们慢得要命。我们用 C++ 重写了我们需要的功能。

# vb.net - 如何将事件从通用列表中的子对象传递给父对象？

> ID：280629
> 
> 赞同：-1
> 
> 时间：2008-11-11T11:09:49.980
> 
> 标签：vb.net, generics, event-handling

这是我的示例代码：

```
Public Class Parent
    Private _TestProperty As String
    Private WithEvents _Child As IList(Of Child)

    Public Property Test() As String
        Get
            Return _TestProperty
        End Get
        Set(ByVal value As String)
            _TestProperty = value
        End Set
    End Property

    Public Property Child() As IList(Of Child)
        Get
            Return _Child
        End Get
        Set(ByVal value As IList(Of Child))
            _Child = value
        End Set
    End Property

    Private Sub eventHandler Handles _Child
End Class

Public Class Child
    Private _TestProperty As String
    Public Event PropertyChanged As EventHandler

    Friend Sub Notify()
        RaiseEvent PropertyChanged(Me, New EventArgs())
    End Sub

    Public Property Test() As String
        Get
            Return _TestProperty
        End Get
        Set(ByVal value As String)
            _TestProperty = value
            Notify()
        End Set
    End Property
End Class 
```

我如何处理由父对象中的一个孩子引发的事件？在 _child 对象上使用 withevents 只会给我来自 List(of T) 对象的事件。

蒂亚

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T11:33:52.693

如果我是你，我会使用聚合类型列表在 Parent 中实现 IList，但在 IList.Add 上订阅 Child 事件并在 Remove 上取消订阅。像这样的东西（对不起C#语法）。

```
class Child
{
  public event EventHandler MyEvent;
}

class Parent : IList<Child>
{
  List<Child> _list;

  // IList implementation
  // ...
  public void Add(Child item)
  {
     item.MyEvent += _ParentChildEventHandler;
     _list.Add(item);  
  }

  public void Remove(Child item)
  {
    item.MyEvent -= _ParentChildEventHandker;
    _list.Remove(item);
  }

  void _ParentChildEventHandler(object sender, EventArgs e)
  {
    Child child = (Child)sender;

    // write your event handling code here
  }
} 
```

# xhtml - 当前浏览器和搜索引擎蜘蛛对 XHTML 的支持程度如何？

> ID：280632
> 
> 赞同：0
> 
> 时间：2008-11-11T11:14:31.733
> 
> 标签：xhtml, browser, web-crawler

忽略IE的情况，还有其他浏览器无法理解application/xhtml+xml内容类型吗？那么搜索引擎蜘蛛呢？

我在网上找不到任何几年前的答案，因此可能不准确。

**编辑：** 不知何故相关问题：[XHTML 严格解决了什么问题？](https://stackoverflow.com/questions/278746/what-problem-does-xhtml-strict-solve)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T11:20:39.520

如果你忽略了 80% 的市场（是的，IE），那么 XHTML 得到了很好的支持，搜索引擎对它没有任何问题（毕竟，XHTML 处理起来要简单得多）。

总的来说，XHT​​ML 支持并不是一个真正的问题。IE 不支持它，但只要它作为它理解的内容类型，无论如何都会呈现它，并且其他所有人都正确支持它。

您是否有更具体的用例？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T12:05:20.413

由于新的浏览器以稳定的速度被发明出来，“任何其他浏览器”中的“任何”没有明确的价值。

您必须 (1) 选择一些您认为想要支持的浏览器，(2) 检查那些特定的浏览器。

查看[BrowserShots](http://browsershots.org/)之类的页面，以查看您可能有兴趣支持的浏览器列表。

查看[Free HTML Validators](http://www.thefreecountry.com/webmaster/htmlvalidators.shtml)以了解 XHTML 兼容性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T17:44:01.197

Webdevout在包括 (X)HTML 在内的各种标准上都有很好的[浏览器比较。](http://www.webdevout.net/browser-support)

# javascript - 在 JavaScript 中结束

> ID：280634
> 
> 赞同：1135
> 
> 时间：2008-11-11T11:15:32.807
> 
> 标签：javascript, string, ends-with

如何检查字符串是否以 JavaScript 中的特定字符结尾？

示例：我有一个字符串

```
var str = "mystring#"; 
```

我想知道该字符串是否以`#`. 我怎样才能检查它？

1.  `endsWith()`JavaScript中有方法吗？

2.  我的一个解决方案是获取字符串的长度并获取最后一个字符并检查它。

这是最好的方法还是有其他方法？

* * *

## 回答 #1

> 赞同：1779
> 
> 时间：2010-03-30T19:40:46.977

**更新（2015 年 11 月 24 日）：**

这个答案最初是在 2010 年（六年前）发布的。所以请注意这些有见地的评论：

*   [肖娜](https://stackoverflow.com/users/570040/shauna)-

> Google 员工更新 - 看起来 ECMA6 添加了此功能。MDN 文章还展示了一个 polyfill。[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith)

*   [TJ克劳德](https://stackoverflow.com/users/157247/t-j-crowder)-

> 在现代浏览器上创建子字符串并不昂贵；发布此答案时很可能是在 2010 年。如今，简单的`this.substr(-suffix.length) === suffix`方法在 Chrome 上最快，在 IE11 上与 indexOf 相同，在 Firefox 上仅慢 4%（fergetaboutit 领域）：[jsperf.com/endswith-stackoverflow/14](http://jsperf.com/endswith-stackoverflow/14)当结果为 false 时，整体速度更快：[jsperf.com/endswith-stackoverflow-when-false](http://jsperf.com/endswith-stackoverflow-when-false) **当然，随着 ES6 添加endsWith，这一点没有实际意义。:-)**

* * *

**原始答案：**

我知道这是一个有年头的问题......但我也需要这个，我需要它来跨浏览器工作，所以......**结合每个人的答案和评论**并稍微简化一下：

```
String.prototype.endsWith = function(suffix) {
    return this.indexOf(suffix, this.length - suffix.length) !== -1;
}; 
```

*   不创建子字符串
*   使用本机`indexOf`函数以获得最快的结果
*   使用第二个参数跳过不必要的`indexOf`比较
*   在 Internet Explorer 中工作
*   没有正则表达式并发症

* * *

另外，如果你不喜欢在原生数据结构的原型中填充东西，这里有一个独立版本：

```
function endsWith(str, suffix) {
    return str.indexOf(suffix, str.length - suffix.length) !== -1;
} 
```

* * *

**编辑：**正如@hamish 在评论中指出的那样，如果您想在安全方面犯错并检查是否已经提供了实现，您可以`typeof`像这样添加一个检查：

```
if (typeof String.prototype.endsWith !== 'function') {
    String.prototype.endsWith = function(suffix) {
        return this.indexOf(suffix, this.length - suffix.length) !== -1;
    };
} 
```

* * *

## 回答 #2

> 赞同：298
> 
> 时间：2009-03-24T20:32:36.487

```
/#$/.test(str) 
```

将适用于所有浏览器，不需要猴子补丁`String`，并且不需要像`lastIndexOf`没有匹配项时那样扫描整个字符串。

如果要匹配可能包含正则表达式特殊字符的常量字符串，例如`'$'`，则可以使用以下内容：

```
function makeSuffixRegExp(suffix, caseInsensitive) {
  return new RegExp(
      String(suffix).replace(/[$%()*+.?\[\\\]{|}]/g, "\\$&") + "$",
      caseInsensitive ? "i" : "");
} 
```

然后你可以像这样使用它

```
makeSuffixRegExp("a[complicated]*suffix*").test(str) 
```

* * *

## 回答 #3

> 赞同：94
> 
> 时间：2008-11-11T11:20:53.450

1.  不幸的是没有。
2.  `if( "mystring#".substr(-1) === "#" ) {}`

* * *

## 回答 #4

> 赞同：68
> 
> 时间：2009-09-27T08:34:28.957

来吧，这是正确的`endsWith`实现：

```
String.prototype.endsWith = function (s) {
  return this.length >= s.length && this.substr(this.length - s.length) == s;
} 
```

`lastIndexOf`如果没有匹配，using只会创建不必要的 CPU 循环。

* * *

## 回答 #5

> 赞同：57
> 
> 时间：2008-11-11T11:58:11.957

这个版本避免创建子字符串，并且不使用正则表达式（这里的一些正则表达式答案会起作用；其他的已经坏了）：

```
String.prototype.endsWith = function(str)
{
    var lastIndex = this.lastIndexOf(str);
    return (lastIndex !== -1) && (lastIndex + str.length === this.length);
} 
```

如果性能对您很重要，那么值得测试是否`lastIndexOf`实际上比创建子字符串更快。（这很可能取决于您使用的 JS 引擎......）在匹配的情况下它可能会更快，并且当字符串很小时 - 但是当字符串很大时，它甚至需要回顾整个事情虽然我们并不在乎:(

对于检查单个字符，找到长度然后使用`charAt`可能是最好的方法。

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2015-06-09T07:17:39.837

没有看到方法的`slice`方法。所以我把它留在这里：

```
function endsWith(str, suffix) {
    return str.slice(-suffix.length) === suffix
} 
```

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2014-03-05T14:57:39.703

来自 developer.mozilla.org [String.prototype.endsWith()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith)

## 概括

该`endsWith()`方法确定一个字符串是否以另一个字符串的字符结尾，根据需要返回 true 或 false。

## 句法

```
str.endsWith(searchString [, position]); 
```

## 参数

*   **searchString**：要在此字符串末尾搜索的字符。

*   **position** : 在这个字符串中搜索，好像这个字符串只有这么长；默认为该字符串的实际长度，限制在该字符串长度建立的范围内。

## 描述

此方法可让您确定一个字符串是否以另一个字符串结尾。

## 例子

```
var str = "To be, or not to be, that is the question.";

alert( str.endsWith("question.") );  // true
alert( str.endsWith("to be") );      // false
alert( str.endsWith("to be", 19) );  // true 
```

## 规格

[ECMAScript 语言规范第 6 版 (ECMA-262)](http://people.mozilla.org/~jorendorff/es6-draft.html#sec-string.prototype.endswith)

## 浏览器兼容性

[![浏览器兼容性](https://i.stack.imgur.com/THZsd.jpg)](https://i.stack.imgur.com/THZsd.jpg)

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2009-03-04T15:58:04.537

```
return this.lastIndexOf(str) + str.length == this.length; 
```

在原始字符串长度比搜索字符串长度小一且未找到搜索字符串的情况下不起作用：

lastIndexOf 返回 -1，然后添加搜索字符串长度，剩下的是原始字符串的长度。

一个可能的解决方法是

```
return this.length >= str.length && this.lastIndexOf(str) + str.length == this.length 
```

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2008-11-11T11:26:44.967

```
if( ("mystring#").substr(-1,1) == '#' ) 
```

- 或者 -

```
if( ("mystring#").match(/#$/) ) 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2012-10-17T10:55:25.637

```
String.prototype.endsWith = function(str) 
{return (this.match(str+"$")==str)}

String.prototype.startsWith = function(str) 
{return (this.match("^"+str)==str)} 
```

我希望这有帮助

```
var myStr = “  Earth is a beautiful planet  ”;
var myStr2 = myStr.trim();  
//==“Earth is a beautiful planet”;

if (myStr2.startsWith(“Earth”)) // returns TRUE

if (myStr2.endsWith(“planet”)) // returns TRUE

if (myStr.startsWith(“Earth”)) 
// returns FALSE due to the leading spaces…

if (myStr.endsWith(“planet”)) 
// returns FALSE due to trailing spaces… 
```

传统方式

```
function strStartsWith(str, prefix) {
    return str.indexOf(prefix) === 0;
}

function strEndsWith(str, suffix) {
    return str.match(suffix+"$")==suffix;
} 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2013-05-02T08:01:18.780

我不了解你，但是：

```
var s = "mystring#";
s.length >= 1 && s[s.length - 1] == '#'; // will do the thing! 
```

为什么是正则表达式？为什么要搞乱原型？子字符串？来吧...

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2015-05-08T16:30:19.460

使用正则表达式的另一个快速替代方案对我来说就像一个魅力：

```
// Would be equivalent to:
// "Hello World!".endsWith("World!")
"Hello World!".match("World!$") != null 
```

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2015-03-02T10:34:41.213

如果您使用[lodash](https://lodash.com/docs#endsWith)：

```
_.endsWith('abc', 'c'); // true 
```

如果不使用 lodash，你可以从它的[源代码](https://github.com/lodash/lodash/blob/3.9.3/lodash.src.js#L10423)中借用。

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2014-04-29T10:20:02.690

我刚刚了解了这个字符串库：

[http://stringjs.com/](http://stringjs.com/)

包含 js 文件，然后`S`像这样使用变量：

```
S('hi there').endsWith('hi there') 
```

它也可以通过安装在 NodeJS 中使用：

```
npm install string 
```

然后要求它作为`S`变量：

```
var S = require('string'); 
```

如果您不喜欢这个网页，该网页还包含指向备用字符串库的链接。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2014-05-19T07:51:05.897

```
function strEndsWith(str,suffix) {
  var reguex= new RegExp(suffix+'$');

  if (str.match(reguex)!=null)
      return true;

  return false;
} 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2014-11-18T09:04:44.213

这么多小问题，就用这个正则表达式

```
var str = "mystring#";
var regex = /^.*#$/

if (regex.test(str)){
  //if it has a trailing '#'
}
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2015-04-30T06:56:04.903

这个问题已经很多年了。让我为想要使用投票最多的 chakrit 答案的用户添加一个重要更新。

'endsWith' 函数已作为 ECMAScript 6（实验技术）的一部分添加到 JavaScript

在此处参考：[https ://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith)

因此，强烈建议添加检查是否存在本机实现，如答案中所述。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2010-06-16T14:19:02.577

```
function check(str)
{
    var lastIndex = str.lastIndexOf('/');
    return (lastIndex != -1) && (lastIndex  == (str.length - 1));
} 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2011-07-18T21:46:08.550

未来证明和/或防止覆盖现有原型的一种方法是测试检查它是否已添加到字符串原型中。这是我对非正则表达式高度评价的版本的看法。

```
if (typeof String.endsWith !== 'function') {
    String.prototype.endsWith = function (suffix) {
        return this.indexOf(suffix, this.length - suffix.length) !== -1;
    };
} 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2015-02-04T20:25:20.050

@chakrit 接受的答案是自己做的可靠方法。但是，如果您正在寻找打包的解决方案，我建议您查看[underscore.string](http://epeli.github.io/underscore.string/)，正如@mlunoe 指出的那样。使用 underscore.string，代码将是：

```
function endsWithHash(str) {
  return _.str.endsWith(str, '#');
} 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2016-02-28T10:51:15.653

经过所有这些长长的答案，我发现这段代码简单易懂！

```
function end(str, target) {
  return str.substr(-target.length) == target;
} 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2011-05-02T07:41:13.567

如果您不想使用 lasIndexOf 或 substr 那么为什么不直接查看处于自然状态的字符串（即数组）

```
String.prototype.endsWith = function(suffix) {
    if (this[this.length - 1] == suffix) return true;
    return false;
} 
```

或作为独立功能

```
function strEndsWith(str,suffix) {
    if (str[str.length - 1] == suffix) return true;
    return false;
} 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2012-06-22T15:06:02.620

```
String.prototype.endWith = function (a) {
    var isExp = a.constructor.name === "RegExp",
    val = this;
    if (isExp === false) {
        a = escape(a);
        val = escape(val);
    } else
        a = a.toString().replace(/(^\/)|(\/$)/g, "");
    return eval("/" + a + "$/.test(val)");
}

// example
var str = "Hello";
alert(str.endWith("lo"));
alert(str.endWith(/l(o|a)/)); 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2018-06-20T04:37:51.077

这是实现`endsWith`：

```
String.prototype.endsWith = function (str) {
  return (this.length >= str.length) && (this.substr(this.length - str.length) === str);
} 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2018-06-20T04:43:07.137

这是 endsWith 的实现： `String.prototype.endsWith = function (str) { return this.length >= str.length && this.substr(this.length - str.length) == str; }`

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-11-11T11:54:56.503

它们都是非常有用的例子。添加`String.prototype.endsWith = function(str)`将帮助我们简单地调用该方法来检查我们的字符串是否以它结尾，那么正则表达式也会这样做。

我找到了比我更好的解决方案。谢谢大家。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2013-06-15T06:33:56.580

这建立在@charkit 接受的答案的基础上，允许字符串数组或字符串作为参数传入。

```
if (typeof String.prototype.endsWith === 'undefined') {
    String.prototype.endsWith = function(suffix) {
        if (typeof suffix === 'String') {
            return this.indexOf(suffix, this.length - suffix.length) !== -1;
        }else if(suffix instanceof Array){
            return _.find(suffix, function(value){
                console.log(value, (this.indexOf(value, this.length - value.length) !== -1));
                return this.indexOf(value, this.length - value.length) !== -1;
            }, this);
        }
    };
} 
```

这需要 underscorejs - 但可能可以调整以删除下划线依赖项。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2013-07-11T13:40:16.500

```
if(typeof String.prototype.endsWith !== "function") {
    /**
     * String.prototype.endsWith
     * Check if given string locate at the end of current string
     * @param {string} substring substring to locate in the current string.
     * @param {number=} position end the endsWith check at that position
     * @return {boolean}
     *
     * @edition ECMA-262 6th Edition, 15.5.4.23
     */
    String.prototype.endsWith = function(substring, position) {
        substring = String(substring);

        var subLen = substring.length | 0;

        if( !subLen )return true;//Empty string

        var strLen = this.length;

        if( position === void 0 )position = strLen;
        else position = position | 0;

        if( position < 1 )return false;

        var fromIndex = (strLen < position ? strLen : position) - subLen;

        return (fromIndex >= 0 || subLen === -fromIndex)
            && (
                position === 0
                // if position not at the and of the string, we can optimise search substring
                //  by checking first symbol of substring exists in search position in current string
                || this.charCodeAt(fromIndex) === substring.charCodeAt(0)//fast false
            )
            && this.indexOf(substring, fromIndex) === fromIndex
        ;
    };
} 
```

**好处：**

*   这个版本不仅仅是重用 indexOf。
*   在长弦上表现最好。这是一个速度测试[http://jsperf.com/starts-ends-with/4](http://jsperf.com/starts-ends-with/4)
*   完全兼容 ecmascript 规范。它通过了[测试](https://github.com/monolithed/ECMAScript-6/blob/master/tests/String.js)

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2014-01-05T02:03:46.693

不要使用正则表达式。即使在快速的语言中，它们也很慢。只需编写一个检查字符串结尾的函数。这个库有很好的例子：[groundjs/util.js](https://github.com/danielnuriyev/groundjs/blob/master/util.js)。向 String.prototype 添加函数时要小心。这段代码有很好的例子说明如何做到这一点：[groundjs/prototype.js](https://github.com/danielnuriyev/groundjs/blob/master/prototype.js) 一般来说，这是一个很好的语言级库：[groundjs](https://github.com/danielnuriyev/groundjs/blob/master/ground.js) 你也可以看看 lodash

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2014-10-23T09:40:10.670

对于咖啡脚本

```
String::endsWith = (suffix) ->
  -1 != @indexOf suffix, @length - suffix.length 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2016-02-17T15:30:12.373

7岁的帖子，但我无法理解前几篇帖子，因为它们很复杂。所以，我写了自己的解决方案：

```
function strEndsWith(str, endwith)
{
    var lastIndex = url.lastIndexOf(endsWith);
    var result = false;
    if (lastIndex > 0 && (lastIndex + "registerc".length) == url.length)
    {
        result = true;
    }
    return result;
} 
```

# c# - 测量 C# 代码的可测试性

> ID：280645
> 
> 赞同：7
> 
> 时间：2008-11-11T11:21:10.080
> 
> 标签：c#, unit-testing, dependency-injection

遇到堆栈溢出的链接后，我发现[Miško Hevery](http://misko.hevery.com/2008/08/17/singletons-are-pathological-liars/)的著作非常引人入胜。太好了，我看到了一种新的方法来解决我以前认为我做得很好的事情。

他主要谈论依赖注入、自动化单元测试和良好设计。

他提倡的许多良好实践都是可以通过程序检测到的。所以有一个程序可以检测它们[Google Testability Explorer](http://code.google.com/p/testability-explorer/)。

我的问题是：

*   是否有与基于 Java 的 Google 可测试性资源管理器等效的 C#？
*   如果是这样，哪个是最好的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-15T08:53:22.850

[Pex](http://research.microsoft.com/Pex/default.aspx)是一个有趣的条目。它有可能将测试提升到一个新的水平，尤其是与[Code Contracts](http://research.microsoft.com/contracts/)结合使用时。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T11:40:08.483

它提供信息的方式与 Google Testability Explorer 不同，但[NDepend](http://www.ndepend.com/)（非免费）为 .Net 程序集提供了大量代码分析。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T11:45:16.507

您也可以使用[FXCop](http://msdn.microsoft.com/en-us/library/bb429476(VS.80).aspx)。

> FxCop 是一个应用程序，它分析托管代码程序集（针对 .NET Framework 公共语言运行时的代码）并报告有关程序集的信息，例如可能的设计、本地化、性能和安全改进。许多问题涉及违反类库开发人员设计指南中规定的编程和设计规则，这是 Microsoft 使用 .NET Framework 编写健壮且易于维护的代码的指南。

希望它有所帮助，布鲁诺·菲格雷多

# c++ - 为什么我不能将 boost::function 存储在 std::list 中？

> ID：280654
> 
> 赞同：5
> 
> 时间：2008-11-11T11:29:17.240
> 
> 标签：c++, list, boost

我收到以下编译错误：

```
error: expected `;' before 'it'" 
```

这是我的代码：

```
#include <boost/function.hpp>
#include <list>

template< class T >
void example() {
    std::list< boost::function<T ()> >::iterator it;
} 
```

为什么会这样？我该如何解决？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-11T11:32:08.123

您需要放在`typename`该行的前面，因为您执行 ::iterator 的类型取决于模板参数 T。像这样：

```
template< class T >
void example() {
    typename std::list< boost::function<T ()> >::iterator it;
} 
```

考虑线

```
std::list< boost::function<T ()> >::iterator * it; 
```

这可能意味着乘法或指针。这就是为什么你需要`typename`明确你的意图。没有它，编译器就不会假定类型，因此它需要一个运算符或语法上的分号。

* * *

另请参阅新的 C++ FAQ 条目[Where to put template and typename ondependent names](https://stackoverflow.com/questions/610245/where-to-put-the-template-and-typename-on-dependent-names)。

# unix - '.' 在哪里？和'..'来自哪里？

> ID：280656
> 
> 赞同：34
> 
> 时间：2008-11-11T11:31:53.773
> 
> 标签：unix, shell, history

我们大规模重复`./foo`and背后的故事是什么`cd ..`？这两个`.`又`..`从何而来？第一次在哪里可以将它们视为导航文件系统树的一种方式？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-11-11T12:35:54.500

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-11T11:40:25.020

很抱歉我不能正确回答，但我可以推荐这些链接：

*   [Unix分时系统的演进](http://www.cs.bell-labs.com/who/dmr/hist.html)与
*   [BSD 快速文件系统简史](http://www.usenix.org/publications/login/2007-06/openpdfs/mckusick.pdf)

有关早期文件系统及其使用的一些有趣的历史记录。

除此之外，我发现最早的参考资料是 Dennis Ritchie 和 Ken Thompson 于 1974 年发表的论文“ [The UNIX Time-Sharing System](http://www.cs.berkeley.edu/~brewer/cs262/unix.pdf) ”。UNIX 的前身 Multics 也有分层文件系统和相对路径的概念，但根据“ [MULTICS 简介](http://publications.csail.mit.edu/lcs/pubs/pdf/MIT-LCS-TR-123.pdf)”，它使用了另一种表示法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T12:03:55.657

我相信它是由贝尔实验室的丹尼斯·里奇在 Unix 早期发明的。

# php - 我可以使用 php 和 gd 检测动画 gif 吗？

> ID：280658
> 
> 赞同：46
> 
> 时间：2008-11-11T11:32:33.757
> 
> 标签：php, gd

我目前在使用 GD 调整图像大小时遇到​​了一些问题。

一切正常，直到我想调整动画 gif 的大小，它在黑色背景上提供第一帧。

我试过使用`getimagesize`，但这只给了我尺寸，没有任何东西可以区分任何 gif 和动画。

动画 gif 不需要实际调整大小，只需能够跳过它们就足以满足我们的目的。

有什么线索吗？

PS。我无权访问 imagemagick。

亲切的问候，

克里斯

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-01-06T09:39:45.903

在寻找相同问题的解决方案时，我注意到 php.net 站点对 Davide 和 Kris 所指的代码进行了后续跟进，但根据作者的说法，内存密集度较低，磁盘密集度可能较低.

我将在这里复制它，因为它可能很有趣。

来源：[http ://www.php.net/manual/en/function.imagecreatefromgif.php#88005](http://www.php.net/manual/en/function.imagecreatefromgif.php#88005)

```
function is_ani($filename) {
    if(!($fh = @fopen($filename, 'rb')))
        return false;
    $count = 0;
    //an animated gif contains multiple "frames", with each frame having a
    //header made up of:
    // * a static 4-byte sequence (\x00\x21\xF9\x04)
    // * 4 variable bytes
    // * a static 2-byte sequence (\x00\x2C)

    // We read through the file til we reach the end of the file, or we've found
    // at least 2 frame headers
    while(!feof($fh) && $count < 2) {
        $chunk = fread($fh, 1024 * 100); //read 100kb at a time
        $count += preg_match_all('#\x00\x21\xF9\x04.{4}\x00[\x2C\x21]#s', $chunk, $matches);
    }

    fclose($fh);
    return $count > 1;
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-11T11:54:59.887

该函数的 PHP 手册页中有一段简短的代码片段`imagecreatefromgif()`，应该是您需要的：

[`imagecreatefromgif`ZeBadger 发表评论 #59787](https://php.net/manual/en/function.imagecreatefromgif.php#59787)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-11T12:18:36.923

这是工作功能：

```
/**
 * Thanks to ZeBadger for original example, and Davide Gualano for pointing me to it
 * Original at http://it.php.net/manual/en/function.imagecreatefromgif.php#59787
 **/
function is_animated_gif( $filename )
{
    $raw = file_get_contents( $filename );

    $offset = 0;
    $frames = 0;
    while ($frames < 2)
    {
        $where1 = strpos($raw, "\x00\x21\xF9\x04", $offset);
        if ( $where1 === false )
        {
            break;
        }
        else
        {
            $offset = $where1 + 1;
            $where2 = strpos( $raw, "\x00\x2C", $offset );
            if ( $where2 === false )
            {
                break;
            }
            else
            {
                if ( $where1 + 8 == $where2 )
                {
                    $frames ++;
                }
                $offset = $where2 + 1;
            }
        }
    }

    return $frames > 1;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-12-20T13:27:35.730

这是对当前投票最多的答案的改进，但我还没有足够的声誉发表评论。该答案的问题在于它以 100Kb 块读取文件，并且帧结束标记可能被分成 2 个块。解决方法是将前一帧的最后 20b 添加到下一帧：

```
<?php
function is_ani($filename) {
  if(!($fh = @fopen($filename, 'rb')))
    return false;
  $count = 0;
  //an animated gif contains multiple "frames", with each frame having a
  //header made up of:
  // * a static 4-byte sequence (\x00\x21\xF9\x04)
  // * 4 variable bytes
  // * a static 2-byte sequence (\x00\x2C) (some variants may use \x00\x21 ?)

  // We read through the file til we reach the end of the file, or we've found
  // at least 2 frame headers
  $chunk = false;
  while(!feof($fh) && $count < 2) {
    //add the last 20 characters from the previous string, to make sure the searched pattern is not split.
    $chunk = ($chunk ? substr($chunk, -20) : "") . fread($fh, 1024 * 100); //read 100kb at a time
    $count += preg_match_all('#\x00\x21\xF9\x04.{4}\x00(\x2C|\x21)#s', $chunk, $matches);
  }

  fclose($fh);
  return $count > 1;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-02-12T18:27:36.857

如果给定文件太大，读取整个文件`file_get_contents`可能会占用太多内存。我重构了之前给出的函数，它读取足够的字节来检查帧，并在找到至少 2 个帧后立即返回。

```
<?php
/**
 * Detects animated GIF from given file pointer resource or filename.
 *
 * @param resource|string $file File pointer resource or filename
 * @return bool
 */
function is_animated_gif($file)
{
    $fp = null;

    if (is_string($file)) {
        $fp = fopen($file, "rb");
    } else {
        $fp = $file;

        /* Make sure that we are at the beginning of the file */
        fseek($fp, 0);
    }

    if (fread($fp, 3) !== "GIF") {
        fclose($fp);

        return false;
    }

    $frames = 0;

    while (!feof($fp) && $frames < 2) {
        if (fread($fp, 1) === "\x00") {
            /* Some of the animated GIFs do not contain graphic control extension (starts with 21 f9) */
            if (fread($fp, 1) === "\x2c" || fread($fp, 2) === "\x21\xf9") {
                $frames++;
            }
        }
    }

    fclose($fp);

    return $frames > 1;
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2013-08-30T04:19:38.403

动画 GIF 必须具有以下字符串

```
"\x21\xFF\x0B\x4E\x45\x54\x53\x43\x41\x50\x45\x32\x2E\x30" 
```

我已经测试了一些动画 gif，似乎字符串位于文件的 pos 781 处（使用 file_get_contents 和 strpos 找到）

# java - 导入（合并）-导出 java db 数据库的最佳方式

> ID：280672
> 
> 赞同：2
> 
> 时间：2008-11-11T11:39:38.437
> 
> 标签：java, database, import, export

我假设两台 pc's.PC-a 和 PC-b 都安装了具有 java db 支持的相同应用程序。我想不时将数据从 PC-a 上的数据库复制到数据库到 PC-b 和反之亦然，因此两台 PC 始终拥有相同的数据。数据库层中是否已经为此实现了 API（即 1.export-backup 数据库从 PC-a 2.import-merge 数据库到 PC-b）或者我必须在 sql 层中执行此操作（手动）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-17T12:51:49.530

正如您在评论中提到要“合并”数据库一样，这听起来您需要编写自定义代码来执行此操作，因为可能存在冲突 - 两者中的相同键，但针对它的详细信息不同，例子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T12:02:44.693

我猜你正在使用[Java DB（又名 Derby）](http://developers.sun.com/javadb/) ——在这种情况下，假设你不能使用单个实例，你可以做一个[backup/restore](http://db.apache.org/derby/docs/10.3/adminguide/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T16:39:16.290

你为什么不在一台电脑上拥有数据库。并从主机 pc 获取所有其他 pc 的请求数据

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-05T19:50:19.333

简而言之：如果没有您的工作，您将无法做到这一点。SalesLogix 通过为所有内容提供站点代码来解决此问题，因此您的表格如下所示：

```
Customer: 
   SiteCode varchar,
   CustomerID varchar, 
   .... 
   primary key(siteCode, CustomerID) 
```

因此，现在您将获取数据库，并通过主键匹配每条记录。如果存在冲突，您必须向最终用户提供报告，说明哪些数据不同。

说机器1：

```
 SiteCode|CustomerID|CustName     |phone         |email 
 1 XXX     |0001      |Customer1    |555.555.1212  |darth@example.com 
```

在机器2上：

```
 SiteCode|CustomerID|CustName     |phone         |email 
 2 XXY     |0001      |customer2    |555.555.1213  |darth@nowhere.com 
 3 XXX     |0001      |customer1    |555.555.1212  |darth@nowhere.com 
```

执行决议时：

*   记录 1 和 3 冲突，因为 PK 匹配，但数据不匹配（电子邮件不同）。
*   记录 2 是唯一的，可以自由地存在于两个数据库中。

没有*任何*方法可以在没有错误或数据损坏或引用完整性问题的情况下自动执行此操作。

# php - 随机图像选择器 PHP

> ID：280680
> 
> 赞同：2
> 
> 时间：2008-11-11T11:43:18.087
> 
> 标签：php

```
$images = array();
$images[0][0] = "boxes/blue.jpg";
$images[0][1] = "blah.html";
$images[1][0] = "boxes/green.jpg";
$images[1][1] = "blah.html";
$images[2][0] = "boxes/orange.jpg";
$images[2][1] = "blah.html";
$images[3][0] = "boxes/pink.jpg";
$images[3][1] = "blah.html";
$images[4][0] = "boxes/purple.jpg";
$images[4][1] = "blah.html";
$images[5][0] = "boxes/red.jpg";
$images[5][1] = "blah.html";
$images[6][0] = "boxes/yellow.jpg";
$images[6][1] = "blah.html";

$i = 0;

*echo "<a href='" . $images[0][1] . "'><img src='" . $images[0][0] . "' /></a>";

$boxes = array();
while($i<5)
{
    $rand = rand(0,(sizeof($images)-1));
    //echo $rand;
    $slice = array_splice($images, $rand);
    $boxes[$i] = $slice;
    $i++;
}* 
```

我试图让一个随机图像选择器从 $images 数组提供的图像列表中进行选择。但是，我无法用“数组”以外的任何内容填充 $boxes 数组。谁能告诉我为什么？任何帮助深表感谢

更新

我现在使用下面的代码，只要遇到空元素就会中断。除非我错了，不应该像那样拼接修补孔吗？

```
$rand = rand(0,(sizeof($images)));
array_splice($images, $rand);
$i = 0;
while($i<5)
{
    echo "<a href='" . $images[$i][1] . "'><img src='" . $images[$i][0] . "' /></a>";
    $i++;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T11:58:33.797

这可能是一种更好的方法：

```
foreach (array_rand($images, 5) as $key) {
    $boxes[] = $images[$key];
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T12:00:17.460

稍微偏离主题，但在这种情况下（从 6 个列表中选择 5 个项目）只是选择一个元素并从原始数组中丢弃它，然后使用原始元素不是更容易吗？这也将确保您不会在结果数组中得到重复项。

我意识到您可能有超过 6 个原始项目，并且可能想要少于 5 个，但我是在专门讨论发布的示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T11:47:48.500

[array_splice()](http://it.php.net/manual/en/function.array-splice.php)返回一个数组。

你可以尝试这样的事情：

```
while($i<5)
{
        $rand = rand(0,(sizeof($images)-1));
        $boxes[$i] = $images[$rand];
        $i++;
} 
```

# .net - 领域驱动设计示例（尤其是 .NET）

> ID：280681
> 
> 赞同：12
> 
> 时间：2008-11-11T11:43:23.127
> 
> 标签：.net, design-patterns, domain-driven-design

好的，所以我已经订购[了 Applying Domain-Driven Design and Patterns: Using .Net](http://www.amazon.co.uk/Applying-Domain-Driven-Design-Patterns-Using/dp/0321268202/ref=sr_1_1?ie=UTF8&s=books&qid=1226403396&sr=1-1)，但是当我等待它到来时，我正在考虑开始在我当前的项目中应用这些技术。我现在真的很好地掌握了这些概念，但是当我尝试应用它们时，我会陷入执行并最终在各种项目中泄露我的责任。因此，我正在寻找可以指导我朝着正确方向前进的资源，**尤其是具有**我可以处理的实际代码的示例项目。我记得 Alt.Net 世界中有一个示例站点，它有一个人们可以浏览但似乎找不到的真实工作项目？有没有人有那个链接，或者他们可以分享的任何其他链接？

编辑：我从 DomainDrivenDesign.org 站点（尽管它是基于 Java 的）以及下面概述的示例中找到了这个[示例应用程序。](http://dddsample.sourceforge.net/)

如果有人知道在哪里可以找到它，我还在寻找 Alt.Net 示例应用程序吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-11T15:42:04.190

以下 CodePlex 项目似乎是您的盟友：

*   [.NET 使用 C# 进行域驱动设计：问题-设计-解决方案](http://www.codeplex.com/dddpds)
*   [领域驱动设计 (.NET) 示例应用程序](http://www.codeplex.com/domaindrivendesign)
*   [存储DDD](http://www.codeplex.com/StoreDDD)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-01-27T13:29:11.580

Mark Nijhof 做得很棒。[使用 CQRS 模式的网络示例应用程序](http://github.com/MarkNijhof/Fohjin)，它是 DDD 的热门实现。您可以在[Marks 博客上阅读所有相关信息](http://cre8ivethought.com/blog/2009/11/12/cqrs--la-greg-young)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T15:36:13.170

[领域驱动设计](http://dddcommunity.org/book/)的作者创建了一个项目[时间和金钱](http://timeandmoney.sourceforge.net/)来展示他书中描述的概念。这不仅仅是一个为本书提供一些示例代码的“玩具”项目，它旨在成为时间和金钱概念的生产就绪替代品，这些概念在核心 Java 库中实现得相当糟糕。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-08-09T19:46:37.647

我写了几篇关于在实际应用程序中实现 DDD 模式的大部分 C# 示例的文章。

*   [类并不总是名词](http://www.agileatwork.com/a-class-isnt-always-a-noun/)
*   [小型 DDD (php)](http://www.agileatwork.com/domain-driven-design-in-the-small/)
*   [c# 中的规范模式示例](http://www.agileatwork.com/this-could-have-been-a-stored-procedure/)
*   [ASP.NET MVC 中的订单处理管道](http://www.agileatwork.com/an-order-processing-pipeline-in-aspnet-mvc/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-01-27T13:06:58.507

[Habanero](http://www.habanerolabs.com/)是一个实现领域驱动设计原则的开发框架，它是一个极好的材料来源和一个致力于 .Net 领域驱动设计的开源社区。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-03-08T20:15:25.447

你可以看看我的[DDDSample.Net](http://codeplex.com/metacontainer)。它不仅演示了经典的 DDD，还演示了使用两个关系存储和使用事件溯源方法的 CQRS 方法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-01-16T16:18:44.333

我发现 Steve Sanderson 的帖子[行为驱动开发 (BDD) with SpecFlow 和 ASP.Net MVC](http://blog.stevensanderson.com/2010/03/03/behavior-driven-development-bdd-with-specflow-and-aspnet-mvc/)及其附带的示例项目（留言簿）对于从理论到实践的这一步骤非常宝贵。我必须承认，我能够在我自己的应用程序中重用他的许多代码，而无需对最初打算作为简化示例的内容进行过多修改。

他使用[WatiN](http://watin.sourceforge.net/)（一种用于自动化浏览器测试的工具）从用户的角度进行全面的验收测试。他的示例还包括一个典型的 CRUD 功能（创建/更新表单等），这是很多示例都避免的，尽管它必须是我们所有人都做的最常见的事情之一。

桑德森是那些能够将复杂的想法分解为清晰易懂的描述的人之一，并且对开发实践有非常务实的看法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-24T17:52:17.923

Eric Evans 和一家瑞典咨询公司发布了一个示例应用程序，该示例应用程序基于 Eric 在本书中使用的运输示例。它在 Java 中，但概念在项目页面上有很好的记录。

[http://dddsample.sourceforge.net/](http://dddsample.sourceforge.net/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-06-30T14:19:42.070

作为我在荷兰 .NET 社区活动中所做的演讲的一部分，我已经开始使用 CQRS 和事件源实现一个成熟的 Silverlight 4 示例。它在很大程度上依赖于最重要的开源 CQRS 计划[之一 NCQRS](http://ncqrs.org/)。[您可以在此处](http://thecqrskitchen.codeplex.com/)找到其对应的 CodePlex 站点。

# http - 上传文件的大小

> ID：280684
> 
> 赞同：13
> 
> 时间：2008-11-11T11:45:53.993
> 
> 标签：http, file, upload, http-headers, browser

将文件上传到服务器时，Web 浏览器是否会在 http 标头中发送文件大小？如果是这种情况，那么是否可以仅通过读取标题来拒绝文件而不等待整个上传过程完成？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-11T11:54:46.957

[http://www.faqs.org/rfcs/rfc1867.html](http://www.faqs.org/rfcs/rfc1867.html)

*鼓励 HTTP 客户端为整个文件输入提供内容长度，以便繁忙的服务器可以检测建议的文件数据是否太大而无法合理处理*

但是内容长度不是必需的，因此您不能依赖它。此外，攻击者可以伪造错误的内容长度。

读取文件内容是唯一可靠的方法。话虽如此，如果内容长度存在并且太大，关闭连接将是合理的做法。

此外，内容是作为多部分发送的，因此大多数现代框架首先对其进行解码。这意味着在框架完成之前您不会获得文件字节流，这可能意味着“直到整个文件被上传”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T12:22:55.993

编辑：在走得太远之前，您可能需要检查依赖于 apache 配置的其他答案：[使用 jQuery，在上传之前限制文件大小](https://stackoverflow.com/questions/307679/using-jquery-restricting-file-size-before-uploading#307861)。下面的描述仅在您确实需要更多自定义反馈时才有用。

是的，您可以在允许上传整个文件之前预先获取一些信息。

这是来自具有`enctype="multipart/form-data"`属性的表单的标题示例：

```
POST / HTTP/1.1
Host: 127.0.0.1:8000
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.3) Gecko/2008092414 Firefox/3.0.3
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.7,fr-be;q=0.3
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Content-Type: multipart/form-data; boundary=---------------------------886261531333586100294758961
Content-Length: 135361

-----------------------------886261531333586100294758961
Content-Disposition: form-data; name=""; filename="IMG_1132.jpg"
Content-Type: image/jpeg

(data starts here and ends with -----------------------------886261531333586100294758961 ) 
```

您在标头中有 Content-Length，并且在文件部分的标头中还有 Content-Type（每个文件都有自己的标头，这是多部分编码的目的）。请注意，通过猜测文件类型来设置相关的 Content-Type 是浏览器的责任；你不能保证它，但它对于早期拒绝应该是相当可靠的（但你最好在它完全可用时检查整个文件）。

现在，有一个问题。我曾经像这样过滤图像文件，不是在大小上，而是在 content-type 上；但是当您想尽快停止请求时，就会出现同样的问题：**浏览器只有在整个请求发送后才会得到您的响应，包括表单内容和上传的文件**。

如果您不想要提供的内容并停止上传，您别无选择，只能粗暴地关闭套接字。用户只会看到一条令人困惑的“对等连接重置”消息。这很糟糕，但这是设计使然。

因此，您只想在后台异步检查的情况下使用此方法（使用检查文件字段的计时器）。所以我有那个黑客：

*   我使用 jquery 告诉我文件字段是否已更改
*   选择新文件后，*禁用同一表单上的所有其他文件字段*以仅获取该文件。
*   异步发送文件（jQuery 可以为您完成，它使用隐藏框架）
*   服务器端，检查标题（内容长度，内容类型，...），一旦你得到你需要的就切断连接。
*   设置一个会话变量，告诉该文件是否正常。
*   在客户端，当文件上传到框架**时，如果连接关闭，您甚至不会得到任何反馈**。您唯一的选择是计时器。
*   在客户端，计时器轮询服务器以获取上传文件的状态。服务器端，您设置了会话变量，将其发送回浏览器。
*   客户端有状态码；将其呈现为您的表单：错误消息，绿色复选标记/红色 X 等等。重置文件字段或禁用表单，由您决定。不要忘记重新启用其他文件字段。

很乱，嗯？如果你们中的任何人有更好的选择，我会全力以赴。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T11:49:25.920

1.  我不确定，但您不应该真正信任标头中发送的任何内容，因为它可能被用户伪造。

2.  这取决于服务器的工作方式。例如，在 PHP 中，您的脚本在文件上传完成之前不会运行，因此这是不可能的。

# php - 将表格行更改为链接

> ID：280687
> 
> 赞同：2
> 
> 时间：2008-11-11T11:48:07.077
> 
> 标签：php, html

我正在尝试将表中 PHP 输出的行更改为链接。我已将 a href 标记添加到下面的示例中，但是它会导致意外的`T_VARIABLE`. 我已经尝试过没有额外的引号，但这会显示一个空白表。我不确定逻辑中的缺陷是什么。

```
while($row = mysql_fetch_row($result))
{
    echo "<tr>";

    // $row is array... foreach( .. ) puts every element
    // of $row to $cell variable
    foreach($row as $cell)
        echo "<td><a href="$cell"</a></td>";

    echo "</tr>\n";
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T11:51:20.567

您必须转义双引号：

```
foreach($row as $cell)
        echo "<td><a href=\"{$cell}\"</a></td>"; 
```

顺便说一句，我认为一个好习惯是用花括号将字符串内的变量括起来，以提高代码的可读性。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T11:52:40.127

您需要转义双引号，因为这是您的字符串分隔符。

```
 echo "<td><a href=\"$cell\">Link</a></td>"; 
```

或者使用单引号

```
 echo '<td><a href="' . $cell .'">Link</a></td>'; 
```

# .net - 替代 HttpListener？

> ID：280690
> 
> 赞同：15
> 
> 时间：2008-11-11T11:49:23.237
> 
> 标签：.net, cassini, httplistener

我正在开发一个迄今为止使用 HttpListener 来提供小型独立 http 服务器的应用程序。但是，我最近发现 HttpListener 需要以管理员身份运行，这并不总是可行的。

最好的选择是什么？我需要 http GET 和 POST，它们都不仅仅是在文件系统上读取/写入文件，它们需要运行自定义的 .Net 代码。

到目前为止，我的研究已经提出了 Cassini，但据我所知，我必须编写一个自定义版本。还有别的事吗？特别是与 HttpListener 具有相同界面但不需要管理员权限的东西会很棒！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-11-13T14:11:02.750

我发现的一种替代方法是CodePlex 上的[C# Webserver](http://www.codeplex.com/webserver)。

*“......一个灵活的 http 服务器，可以嵌入到任何 .Net 应用程序中。它采用模块化设计，使用模块添加功能。服务器还支持 REST 和所有 http 动词......”*

它有一个 HttpListener 类，我认为它类似于 System.Net.HttpListener，但我还没有使用其中任何一个，所以我不能确定。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T11:53:39.657

[另一个问题](https://stackoverflow.com/questions/169904/can-i-listen-on-a-port-using-httplistener-or-other-net-code-on-vista-without-re)涵盖了一个解决方案- 您可以授予自己以非管理员身份运行 HttpListener 的权限。

您可以从整理权限的命令文件启动应用程序，然后运行真正的应用程序。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-03-12T11:24:44.543

就像 Will Dean 在您的帖子中所说的那样，您可以运行以下 netsh 命令：

```
netsh http add urlacl url=http://+:8346/ user="NTAuthority\Authenticated Users" sddl="D:(A;;GX;;;AU)" 
```

用您的值替换“http://+:8346/”，这将允许任何经过身份验证的用户在目标端点运行网络服务器。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-09-30T18:50:57.317

关于声明：

> 我最近发现 HttpListener 需要以管理员身份运行

这并不完全正确，其他一些答案涉及其中一个原因，但还有另一个原因：

1.  其他发帖人指出：您可以向非管理员授予权限。很好，但不是很好。
2.  您可以在 localhost 上收听，甚至在端口 80 上收听，而无需成为管理员。注意：我记得只有“localhost”有效，而不是“127.0.0.1”......所以请确保将 localhost 传递给 Prefixes.Add 调用。

我们正在发布一个内部工具，允许开发人员在他们的 PC 上运行基于 HTTP 的应用程序主机，我们起初认为由于管理员（或管理员授予的权限）问题而无法使用 HttpListener，但后来我们发现localhost 无需管理员即可正常工作。这有点道理：从外部收听是“危险的”，但在本地机器上收听并不那么危险。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-02-04T11:33:54.137

对于 .NET Core 应用程序，存在一个新的（跨平台）HTTP 服务器实现：[Kestrel](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/servers/?view=aspnetcore-2.2&tabs=windows#kestrel)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T12:17:26.347

好的，所以您有一个需要允许入站 http 连接的常规桌面应用程序 - 嗯 - Windows 防火墙不是问题吗？

假设不是，它听起来几乎像一个网络服务——你能走那条路吗——通过它公开 URL 吗？尽管我的 .Net 知识还不够深入，无法知道您是否仍需要运行特定的 http 服务器来响应请求。 [Spring.Net](http://www.springframework.net/docs/1.2.0-M1/reference/html/webservices.html)可能值得一看。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-07-17T11:09:02.010

[Nowin](https://github.com/Bobris/Nowin "诺温")是一个很棒的库，可以在`Owin`不`ServerFactory`依赖于`HttpListener`. 能够`Microsoft.Owin.Host.HttpListener`顺利插入替换库

# sharepoint - 如何在 InfoPath 表单中验证用户是否存在于 SharePoint 门户中？

> ID：280692
> 
> 赞同：3
> 
> 时间：2008-11-11T11:49:31.537
> 
> 标签：sharepoint, validation, active-directory, infopath

我正在 InfoPath 中创建一个要集成到 SharePoint 2007 门户中的表单。在此表单中将有一个文本字段，用户可以在其中输入人员姓名。

如何验证此人是否存在？

有没有办法用门户的*所有*用户名填充下拉列表，而不是验证用户？（原因可能是来自 Active Directory 的用户）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T10:00:56.767

您是否尝试过查看联系人选择器（一个 ActiveX 控件）。这是一篇[MSDN 文章](http://msdn.microsoft.com/en-us/library/ms577996.aspx)，描述了如何在 InfoPath 中将其添加为控件，[这篇](http://msdn.microsoft.com/en-us/library/ms558892.aspx)文章描述了如何使其工作。

我一直在我的大多数 infopath 项目中使用它，并且它完美地工作 - 也适用于支持浏览器的表单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T12:51:30.367

我没有专门这样做，因此可能有更好的方法，但我一直在将大量数据从 SharePoint 中提取并放入 InfoPath 表单（部署到 SharePoint 表单库并通过 MOSS Enterprise 的 SharePoint 表单服务访问) 以及使用 SharePoint Web 服务的另一种方式 - 使用非常快，并且人员 Web 服务就在那里。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-13T09:25:11.697

看看这个链接，它解释了如何用 SharePoint 用户填充下拉列表

[http://blueinfopath.blogspot.com/2008/10/how-to-populate-list-with-sharepoint.html](http://blueinfopath.blogspot.com/2008/10/how-to-populate-list-with-sharepoint.html)

我要验证， - 创建一个文本框 - 添加一个按钮，将其命名为 ValidateUser - 创建到......的接收连接 - 向 ValidateUser 添加规则 - 将文本框添加到辅助数据源中的 AccountName 字段 -执行接收连接 - 使用过滤器 Name="PreferredName" 获取字段 Value 的值

这适用于 Infopath Form Services 测试它并将 UserLogin 输入到文本框中，然后单击验证按钮

弗雷德里克

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T14:00:20.903

在 ASP.NET 应用程序中执行类似操作时，我使用了 Sharepoint 搜索并[搜索了特定用户的“人员”范围](http://www.mobiusdevelopment.com/dev/Blog.asp?ArticleID=3235955046032961096)。您还可以搜索个人资料信息，以便您可以撤回具有特定职位或特定部门的每个人。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-10T02:38:19.513

使用此控件：http: [//blogs.msdn.com/infopath/archive/2007/02/28/using-the-contact-selector-control.aspx](http://blogs.msdn.com/infopath/archive/2007/02/28/using-the-contact-selector-control.aspx)

或者，如果您想构建自己的验证器，则需要查询 SharePoint 配置文件数据库。我建议直接查询 AD。网上有很多关于使用配置文件数据库的文章。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-06T00:08:36.240

我不验证一个人的存在，但我确实使用他们的登录名和 SharePoint 来确定一个人的全名。您应该能够根据您的目的修改此代码，如下所示。要使其发挥作用，您需要在 InfoPath 文档中建立一个名为**GetUsersFromSP**的数据连接。配置如下：

*   位置是 - **[http://njintranet2/_vti_bin/usergroup.asmx?WSDL](http://njintranet2/_vti_bin/usergroup.asmx?WSDL)**
*   操作是 – **GetUserColectionFromSite**（列表中的最后一个）
*   应**选中**表单打开时自动检索数据。

* * *

```
string ADName = System.Environment.UserName;
        IXMLDOMDocument3 UserQuery = (IXMLDOMDocument3)thisXDocument.GetDOM("GetUsersFromSP");
        UserQuery.setProperty("SelectionNamespaces",
            "xmlns:dfs=\"http://schemas.microsoft.com/office/infopath/2003/dataFormSolution\" " +
            "xmlns:tns=\"http://schemas.microsoft.com/sharepoint/soap/directory/\"");

        ((WebServiceAdapterObject)thisXDocument.DataAdapters["GetUsersFromSP"]).Query();

        IXMLDOMNode Users = UserQuery.selectSingleNode("//dfs:myFields/dfs:dataFields/tns:GetUserCollectionFromSiteResponse/tns:GetUserCollectionFromSiteResult/tns:GetUserCollectionFromSite/tns:Users");

        foreach (IXMLDOMNode current in Users.selectNodes("tns:User"))
        {
            string Login = current.attributes.getNamedItem("LoginName").text;

            Login = Login.ToUpper();
            if (Login.EndsWith(ADName.ToUpper()))
            {
                thisXDocument.DOM.selectSingleNode("my:root/my:config/my:User").text = current.attributes.getNamedItem("Name").text;
                break;
            }
        } 
```

# java - Java：不可变到不可变的转换

> ID：280706
> 
> 赞同：1
> 
> 时间：2008-11-11T11:55:10.247
> 
> 标签：java, static, frameworks, methods, factory

我一直在考虑为我一直在研究的框架提供语法糖的方法。我想专门处理 Immitable 对象。

### 假设我有一个不可变对象并希望创建它的修改版本。在您看来，具有单个静态工厂方法的不可实例化类会违反 OO 原则吗？

> 作为使用字符串的示例：
> 
> ```
> public final class LOWERCASE {
>   
>     private LOWERCASE() {}
>   
>     public static String string( final String STRING ) {
>    
>       return STRING.toLowerCase();
>     }
> } 
> ```
> 
> 因此，从这个例子中我可以写：
> 
> ```
> String lowercaseString = LOWERCASE.string( targetString ); 
> ```
> 
> 我觉得这很可读。

### 对这种方法有任何附带条件吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T12:11:53.723

我认为每个方法创建一个类不是一个好主意。相反，您可以创建一个仅静态的方法类，例如 StringUtils 并实现这些方法。这样你会打电话：

String lowerCaseString = StringUtils.lowercase(targetString);

这也会在您打字时为您提供智能感知帮助。否则，您的课程列表将变得太大。即使对于这个简单的示例，您也应该实现多个小写类，以便您还可以满足必须考虑 CulutureInfo 的情况。

我不认为这以任何方式违反了面向对象的原则，或者那是糟糕的设计。在其他语言中，例如 Ruby，您可以将方法直接添加到 String 类。以 ! 结尾的方法 表示修改了原始对象。所有其他方法都返回修改后的副本。Ruby on Rails 框架向 String 类添加了一些方法，关于这是否是一种好的技术存在一些争论。不过，它绝对很方便。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T12:03:33.193

通常在不可变对象上，我会有一个方法返回对象的修改版本。因此，如果您有一些不可变的集合，它可以有一个 sort() 方法，该方法返回一个已排序的新集合。但是，在您的 String 示例中，这是不可能的，因为您无法触摸 String 类。

您的方法非常易读，我认为对于这样的边缘情况，非常好。对于您自己编写的不可变对象，我将在对象本身上有方法。

[顺便说一下， Eric Lippert 关于 C#](http://blogs.msdn.com/ericlippert/archive/tags/Immutability/default.aspx)中不可变对象的系列非常好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T12:25:42.290

在我看来，这样一个工厂类的唯一意义在于该类是否提供了不同类型的不可变对象。

前任：

```
public final class Lowercase {

  private Lowercase() {}

  public static String string( final String string ) {

   return new String( string.toLowerCase() );
  }

  public static Foo foo( final Foo f ) {
     boolean isLowerCase = true;
     return new Foo(f, isLowerCase );
  }
} 
```

否则，您应该在不可变类本身中实现您的方法，例如 String 类中的 toLowerCase()。

无论哪种方式，我都不认为这违反了任何面向对象的原则。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T12:28:11.227

我同意埃里克的观点。不可变对象应始终具有返回对象修改版本的方法，而不是静态方法。JDK中也有例子：

*   String.subString(int)
*   BigDecimal.movePointLeft(int)

这样做的好处是您不需要将要修改的实例作为方法的参数传递。对于像 String 或 Integer 这样的类，我更喜欢使用包装类。然后您可以控制何时创建这样的对象（通过包装类的构造函数或类的方法之一）。如果您使用 Integer 类，则控制它要复杂得多，因为每个人都可以创建它的实例。

另一方面，您的示例被视为一些实用程序类，例如 apache commons-lang 包的[StringUtils](http://commons.apache.org/lang/api-release/org/apache/commons/lang/StringUtils.html)。看看这个，因为我认为你想创建这样的东西。（不要重新发明轮子）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T13:25:10.750

`new String()`是一种*代码**味道*-由于. 一旦一个实例有一个值，那个实例就永远不会有不同的值。*`String``String`*

 *在下面的方法中，`new String()`是多余的：

```
public static String string( final String string ) {
    return new String( string.toLowerCase() );
} 
```

`toLowerCase()`返回一个新的（不同的）`String`实例 -除了导致另一个对象创建具有返回的实例`new String()`的确切值之外，这里没有做任何有益的事情`String``toLowerCase()`

这是一个显示概念的小 Groovy 脚本（我希望 - 注意，这是脚本语言下的 Java）：

```
String a = 'CamelCase'
String b = a.toLowerCase()

println "a='${a}'"
println "b='${b}'" 
```

生产

```
a='CamelCase'
b='camelcase' 
```

请注意，它`a` *没有改变*——它是不可变的； `b`是一个新`String`值。

对于返回 a 的`BigDecimal.movePointLeft()`任何其他方法也是如此- 它们是新实例，原始实例保持不变。`BigDecimal``BigDecimal`

好的，现在回答你的问题：

在您的应用程序中拥有一组用于`Strings`执行有用目的的操作是一个好主意。对于类似的东西可能不需要使用工厂`String`，但对于需要一些努力构建的不同的不可变类可能是必需的。

在无法扩展基类的情况下，如@kgiannakakis 描述`String`的s 类就可以了。`static method`

否则，如果“不可变”类是应用程序的一部分，您可以访问类声明/定义，则返回新实例的方法，在 , 等模型中`BigDecimal`会`String`更可取。这实质上就是@Erik Hesselink、@Bruno Conde 和@reallyinsane 所说的。

# javascript - 如何在 JavaScript 中使用支持 Unicode 的正则表达式？

> ID：280712
> 
> 赞同：241
> 
> 时间：2008-11-11T12:00:33.480
> 
> 标签：javascript, regex, unicode, character-properties

应该有类似的东西`\w`可以匹配字母或标记类别中的任何代码点（不仅仅是 ASCII 代码点），并且希望有像 [[P*]] 之类的过滤器用于标点符号等。

* * *

## 回答 #1

> 赞同：216
> 
> 时间：2008-11-11T12:35:13.503

## ES 6 的情况

ECMAScript 语言规范第 6 版（通常也称为 ES2015）包括 Unicode 感知正则表达式。必须使用`u`正则表达式上的修饰符启用支持。请参阅[*ES6 中的 Unicode-aware 正则表达式，了解*](https://mathiasbynens.be/notes/es6-unicode-regex)该功能的分解和一些注意事项。

ES6 在浏览器和独立的 Javascript 运行时（如 Node.js）中都被广泛采用，因此在大多数情况下使用此功能不需要额外的努力。完整兼容性列表：[https ://kangax.github.io/compat-table/es6/](https://kangax.github.io/compat-table/es6/)

## ES 5 及更低版本（旧版浏览器）的情况

有[一个名为*regexpu*](http://mths.be/regexpu)的编译器将 ES6 Unicode 正则表达式转换为等效的 ES5。它可以用作构建过程的一部分。[在线尝试一下。](http://mothereff.in/regexpu).

即使 JavaScript 对 Unicode 字符串进行操作，它也没有实现 Unicode 感知字符类，也没有 POSIX 字符类或 Unicode 块/子范围的概念。

*   [JavaScript 正则表达式中的 Unicode 问题](https://mathiasbynens.be/notes/javascript-unicode#regex)

*   在这里检查您的期望：[Javascript RegExp Unicode Character Class tester](http://hamstersoup.com/javascript/regexp_character_class_tester.html)（*编辑：*原始页面已关闭，[Internet Archive 仍有副本](http://web.archive.org/web/20101104085449/http://hamstersoup.com/javascript/regexp_character_class_tester.html)。）

*   Flagrant Badassery 有一篇关于[JavaScript、Regex 和 Unicode](http://blog.stevenlevithan.com/archives/javascript-regex-and-unicode)的文章对这个问题有所了解。

*   在 SO 上还可以阅读[Regex 和 Unicode 。](https://stackoverflow.com/questions/14389/)可能您必须建立自己的“标点符号类”。

*   查看[正则表达式：匹配 Unicode 块范围](http://kourge.net/projects/regexp-unicode-block)构建器，它允许您构建一个 JavaScript 正则表达式，以匹配位于任意数量的指定 Unicode 块中的字符。

    我只是为“一般标点”和“补充标点”子范围做的，结果和我预期的一样简单直接：

    ```
     [\u2000-\u206F\u2E00-\u2E7F] 
    ```

*   还有[XRegExp](http://xregexp.com/) ，一个通过提供具有扩展功能的替代正则表达式引擎为 JavaScript带来[Unicode 支持的项目。](http://xregexp.com/plugins/#unicode)

*   当然，必读：[mathiasbynens.be - JavaScript 存在 Unicode 问题](https://mathiasbynens.be/notes/javascript-unicode)：

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2016-06-06T23:27:31.023

就个人而言，我宁愿不安装另一个库只是为了获得这个功能。我的回答不需要任何外部库，而且除了 JavaScript 之外，它也可以对正则表达式风格进行少量修改。

Unicode 的[网站](http://unicode.org/cldr/utility/list-unicodeset.jsp)提供了一种将 Unicode 类别转换为一组代码点的方法。由于它是*Unicode*的网站，因此其中的信息应该是准确的。

请注意，您需要排除高端字符，因为 JavaScript 只能处理小于`FFFF`(hex) 的字符。我建议选中 Abbreviate Collat​​e 和 Escape 复选框，它们在避免不可打印的字符和最小化正则表达式的大小之间取得平衡。

以下是不同 Unicode 属性的一些常见扩展：

`\p{L}`（字母）：

```
[A-Za-z\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC] 
```

`\p{Nd}`（数字小数位数）：

```
[0-9\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19] 
```

`\p{P}`（标点）：

```
[!-#%-*,-/\:;?@\[-\]_\{\}\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65] 
```

该页面还可以识别许多晦涩的字符类，例如`\p{Hira}`，它只是（日语）平假名字符：

```
[\u3041-\u3096\u309D-\u309F] 
```

最后，可以插入一个具有多个 Unicode 属性的 char 类，以获得比仅组合它们更短的正则表达式（只要检查了某些设置）。

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2012-01-19T21:28:50.570

由于也没有找到好的解决方案，我很久以前写了一个小[脚本，通过从 unicode](https://marcelogibson.com/stackoverflow/unicode_hack.js)[规范](http://unicode.org/versions/Unicode5.0.0/)（v.5.0.0）下载数据并为 BMP 中的每个 unicode 类别和子类别生成间隔（最近被[一个小](https://ideone.com/04llh4)使用自己的本机 Unicode 支持的[Java 程序）。](https://ideone.com/04llh4)

基本上它会转换`\p{...}`为一系列值，很像 Tomalak 提到的[工具](http://kourge.net/projects/regexp-unicode-block)的输出，但间隔最终可能会很大（因为它不是处理块，而是字符分散在许多不同的地方）。

例如，这样写的正则表达式：

```
var regex = unicode_hack(/\p{L}(\p{L}|\p{Nd})*/g); 
```

将被转换成这样的东西：

```
/[\u0041-\u005a\u0061-\u007a...]([...]|[\u0030-\u0039\u0660-\u0669...])*/g 
```

在实践中并没有大量使用它，但从我的测试来看它似乎工作正常，所以我在这里发布以防有人发现它有用。尽管生成的正则表达式很长（上面的示例在展开时有 3591 个字符），但性能似乎是可以接受的（请参阅 jsFiddle 的[测试](http://jsfiddle.net/mgibsonbr/Waxkc/)；感谢 @modiX 和 @Lwangaman 的改进）。

这是[源代码](http://difnet.com.br/opensource/unicode_hack.js)（原始，27.5KB；[缩小](http://difnet.com.br/opensource/unicode_hack.js)，24.9KB，也好不到哪里去……）。通过取消转义 unicode 字符*可能*会使其更小，但 OTOH 会冒编码问题的风险，所以我将原样离开。希望有了 ES6，这种事情就不再需要了。

**更新**：这看起来与 Tim Down 提到的[XRegExp Unicode 插件中](http://xregexp.com/plugins/#unicode)采用的策略相同，只是在这种情况下使用的是常规 JavaScript 正则表达式。

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2010-12-15T09:37:29.547

正如其他答案中提到的，JavaScript 正则表达式不支持 Unicode 字符类。但是，有一个库可以提供此功能：Steven Levithan 的优秀[XRegExp](http://xregexp.com/)及其[Unicode 插件](http://xregexp.com/plugins/)。

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2018-09-06T13:51:11.923

**2018 年 9 月（2019 年 2 月更新）**

似乎`/\p{L}/u`匹配字母的正则表达式（作为[unicode 类别](https://www.regular-expressions.info/unicode.html#category)）

*   适用于**Chrome** 68.0.3440.106 和**Safari** 11.1.2 (13605.3.8)
*   不适用于 Firefox 65.0 :(

这是一个[工作示例](https://jsfiddle.net/Lamik/t71kahrp/2/)

```
In below field you should be able to to type letters but not numbers<br>
<input type="text" name="field" onkeydown="return /\p{L}/u.test(event.key)" >
```

[我在这里](https://bugzilla.mozilla.org/show_bug.cgi?id=1500035)报告这个错误。

## 更新

2 年多后，根据： [1500035](https://bugzilla.mozilla.org/show_bug.cgi?id=1500035) > [1361876](https://bugzilla.mozilla.org/show_bug.cgi?id=1361876) > [1634135](https://bugzilla.mozilla.org/show_bug.cgi?id=1634135)终于修复了这个错误，并将在 Firefox v.78+ 中可用

* * *

## 回答 #6

> 赞同：31
> 
> 时间：2017-09-25T19:59:05.880

`[^\u0000-\u007F]+`对于不包括 ASCII 字符的任何字符。

例如：

```
function isNonLatinCharacters(s) {
    return /[^\u0000-\u007F]/.test(s);
}

console.log(isNonLatinCharacters("身分"));// Japanese
console.log(isNonLatinCharacters("测试"));// Chinese
console.log(isNonLatinCharacters("حمید"));// Persian
console.log(isNonLatinCharacters("테스트"));// Korean
console.log(isNonLatinCharacters("परीक्षण"));// Hindi
console.log(isNonLatinCharacters("מִבְחָן"));// Hebrew
```

这里有一些完美的参考：

[Unicode 范围正则表达式生成器](https://apps.timwhitlock.info/js/regex#)

[Unicode 正则表达式](https://www.regular-expressions.info/unicode.html)

[Unicode 10.0 字符代码表](http://www.unicode.org/charts/)

[匹配 Unicode 块范围](http://kourge.net/projects/regexp-unicode-block)

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2015-05-05T16:46:21.030

这将做到：

```
/[A-Za-z\u00C0-\u00FF ]+/.exec('hipopótamo maçã pólen ñ poção água língüa') 
```

它明确地选择一系列 unicode 字符。它适用于拉丁字符，但其他奇怪的字符可能超出此范围。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-11-26T10:33:57.840

在 JavaScript 中，\w 和 \d 是 ASCII，而 \s 是 Unicode。不要问我为什么。JavaScript 确实支持带有 Unicode 类别的 \p，您可以使用它来模拟可识别 Unicode 的 \w 和 \d。

对于 \d 使用 \p{N} （数字）

对于 \w 使用 [\p{L}\p{N}\p{Pc}\p{M}] （字母、数字、下划线、标记）

**更新：**不幸的是，我错了。JavaScript 也不正式支持 \p，尽管某些实现可能仍然支持这一点。JavaScript 正则表达式中唯一的 Unicode 支持是将特定代码点与 \uFFFF 匹配。您可以在字符类的范围内使用它们。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2015-05-08T18:24:58.213

如果你使用[Babel](https://babeljs.io/)，那么[Unicode 支持](https://github.com/babel/babel/blob/0f1f5e3565623721c96f234a869921a7568b564b/src/babel/transformation/transformers/es6/regex.unicode.js)已经可用。

我还发布了一个插件，它可以转换您的源代码，以便您可以编写正则表达式，例如`/^\p{L}+$/`. 然后这些将被转换成浏览器可以理解的东西。

这是插件的项目页面：

*[babel-plugin-utf-8-正则表达式](https://github.com/danielberndt/babel-plugin-utf-8-regex)*

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2019-11-22T18:00:13.650

我正在回答这个问题
[js regExp 中 \p{Lu} 或 \p{Ll} 的等价物是什么？](https://stackoverflow.com/questions/58995708/what-would-be-the-equivalent-for-plu-or-pll-in-regexp-for-js)
因为它被标记为当前旧问题的完全重复。

查询 Unicode 12 的[UCD 数据库](http://www.regexformat.com/scrn8/Ucustom.jpg)，\p{Lu} 生成 1,788 个代码点。

转换为 UTF-16 会产生类构造等效性。
它只是一个 4k 字符串，在任何正则表达式引擎中都很容易实现。

```
(?:[\u0041-\u005A\u00C0-\u00D6\u00D8-\u00DE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178-\u0179\u017B\u017D\u0181-\u0182\u0184\u0186-\u0187\u0189-\u018B\u018E-\u0191\u0193-\u0194\u0196-\u0198\u019C-\u019D\u019F-\u01A0\u01A2\u01A4\u01A6-\u01A7\u01A9\u01AC\u01AE-\u01AF\u01B1-\u01B3\u01B5\u01B7-\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A-\u023B\u023D-\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E-\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9-\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0-\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1C90-\u1CBA\u1CBD-\u1CBF\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E-\u213F\u2145\u2183\u2C00-\u2C2E\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D-\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AE\uA7B0-\uA7B4\uA7B6\uA7B8\uA7BA\uA7BC\uA7BE\uA7C2\uA7C4-\uA7C6\uFF21-\uFF3A]|(?:\uD801[\uDC00-\uDC27\uDCB0-\uDCD3]|\uD803[\uDC80-\uDCB2]|\uD806[\uDCA0-\uDCBF]|\uD81B[\uDE40-\uDE5F]|\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E-\uDC9F\uDCA2\uDCA5-\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD83A[\uDD00-\uDD21])) 
```

查询 Unicode 12 的 UCD 数据库，\p{Ll} 生成 2,151 个代码点。

转换为 UTF-16 会产生类构造等效性。

```
(?:[\u0061-\u007A\u00B5\u00DF-\u00F6\u00F8-\u00FF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137-\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148-\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C-\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA-\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9-\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC-\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF-\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F-\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0-\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB-\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE-\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0529\u052B\u052D\u052F\u0560-\u0588\u10D0-\u10FA\u10FD-\u10FF\u13F8-\u13FD\u1C80-\u1C88\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6-\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FC7\u1FD0-\u1FD3\u1FD6-\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6-\u1FF7\u210A\u210E-\u210F\u2113\u212F\u2134\u2139\u213C-\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5E\u2C61\u2C65-\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73-\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3-\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA699\uA69B\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793-\uA795\uA797\uA799\uA79B\uA79D\uA79F\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7AF\uA7B5\uA7B7\uA7B9\uA7BB\uA7BD\uA7BF\uA7C3\uA7FA\uAB30-\uAB5A\uAB60-\uAB67\uAB70-\uABBF\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A]|(?:\uD801[\uDC28-\uDC4F\uDCD8-\uDCFB]|\uD803[\uDCC0-\uDCF2]|\uD806[\uDCC0-\uDCDF]|\uD81B[\uDE60-\uDE7F]|\uD835[\uDC1A-\uDC33\uDC4E-\uDC54\uDC56-\uDC67\uDC82-\uDC9B\uDCB6-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDCEA-\uDD03\uDD1E-\uDD37\uDD52-\uDD6B\uDD86-\uDD9F\uDDBA-\uDDD3\uDDEE-\uDE07\uDE22-\uDE3B\uDE56-\uDE6F\uDE8A-\uDEA5\uDEC2-\uDEDA\uDEDC-\uDEE1\uDEFC-\uDF14\uDF16-\uDF1B\uDF36-\uDF4E\uDF50-\uDF55\uDF70-\uDF88\uDF8A-\uDF8F\uDFAA-\uDFC2\uDFC4-\uDFC9\uDFCB]|\uD83A[\uDD22-\uDD43])) 
```

请注意，\p{Lu} 或 \p{Pl} 的正则表达式实现实际上调用了一个
非标准函数来测试该值。

此处显示的字符类以不同的方式完成，并且是线性的、标准的
并且非常慢，当它们被塞进一个主要是一个类时。

* * *

***关于 Regex 引擎（通常）如何实现 Unicode 属性类的一些见解：***

检查属性和类块之间的这些性能特征
（如上）

```
Regex1:  LONG CLASS 
< none >
Completed iterations:   50  /  50     ( x 1 )
Matches found per iteration:   1788
Elapsed Time:    0.73 s,   727.58 ms,   727584 µs
Matches per sec:   122,872

Regex2:   \p{Lu}
Options:  < ICU - none >
Completed iterations:   50  /  50     ( x 1 )
Matches found per iteration:   1788
Elapsed Time:    0.07 s,   65.32 ms,   65323 µs
Matches per sec:   1,368,583 
```

哇有什么区别！！

让我们看看如何实现属性

指针数组 [10FFFF]，其中每个索引是一个代码点

*   Array 中的每个指针都指向一个分类结构。

    *   分类结构包含固定字段元素。
        有些是 NULL 并且不相关。
        有些包含类别分类。

        示例：常规类别
        这是一个位图元素，使用 64 位中的 17 位。
        无论此代码点支持什么，都将位设置为掩码。

        -Close_Punctuation
        -Connector_Punctuation
        -Control
        -Currency_Symbol
        -Dash_Punctuation
        -Decimal_Number
        -Enclosing_Mark
        -Final_Punctuation
        -Format
        -Initial_Punctuation
        -Letter_Number
        -Line_Separator
        -Lowercase_Letter
        -Math_Symbol
        -Modifier_Letter
        -Modifier_Symbol
        -Nonspacing_Mark -Open_Punctuation -Other_Letter -Other_Number
        -Other_Punctuation
        -Other_Symbol -Paragraph_Separator -Private_Use -Space_Separator -Spacing_Mark

        -Surrogate
        -Titlecase_Letter -未
        分配
        -Uppercase_Letter

当一个正则表达式被解析为 \p{Lu} 之类的东西时，它
被直接翻译成

*   分类结构元素偏移：一般类别
*   检查该元素的位项：Uppercase_Letter

另一个例子，当使用标点符号属性 \p{P} 解析正则表达式时，它
被翻译成

*   分类结构元素偏移：一般类别
*   检查该元素中的任何这些项目位，这些项目位被连接到掩码中：

    -Close_Punctuation
    -Connector_Punctuation
    -Dash_Punctuation
    -Final_Punctuation
    -Initial_Punctuation
    -Open_Punctuation
    -Other_Punctuation

偏移量和位或位（掩码）存储为该属性的正则表达式步骤。

使用此数组为所有 Unicode 代码点创建一次查找表。

当检查一个字符时，它就像使用 CP 作为该数组的索引并检查该位（掩码）的分类结构的特定元素一样简单。

这种结构是可扩展的和间接的，以提供更复杂的查找。这只是一个简单的例子。

* * *

将该直接查找与字符类搜索进行比较：

所有类都是从左到右搜索的项目的线性列表。
在此比较中，鉴于我们的目标字符串仅包含完整的大写 Unicode 字母，平均法则将预测该类中的一半项目必须进行范围检查才能找到匹配项。

这在性能上是一个巨大的劣势。

但是，如果查找表不存在或者不是最新的 Unicode 版本（截至目前为 12 个），
那么这将是唯一的方法。

事实上，这主要是获得完整表情符号
字符的唯一方法，因为它们的分配没有特定的属性（或推理）。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2019-06-27T16:52:00.620

您还可以使用：

```
function myFunction() {
  var str = "xq234"; 
  var allowChars = "^[a-zA-ZÀ-ÿ]+$";
  var res = str.match(allowChars);
  if(!str.match(allowChars)){
    res="true";
  }
  else {
    res="false";
  }
  document.getElementById("demo").innerHTML = res; 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2022-01-04T15:20:30.757

只需像这样添加`u`到您的正则表达式的末尾，

普通正则表达式：
`new RegExp(/.../)`
unicode 正则表达式：
`new RegExp(/.../u)`

更复杂的例子：
`new RegExp(/^(?=.*\p{Ll})(?=.*\p{Lu})(?=.*\p{N}).{8,256}$/u)`

# javascript - “for (... in ...)”循环中的元素顺序

> ID：280713
> 
> 赞同：222
> 
> 时间：2008-11-11T12:00:36.630
> 
> 标签：javascript, for-loop

Javascript 中的“for...in”循环是否按照声明的顺序遍历哈希表/元素？是否有浏览器不按顺序执行？
我希望使用的对象将被声明*一次*并且永远不会被修改。

假设我有：

```
var myObject = { A: "Hello", B: "World" }; 
```

我进一步将它们用于：

```
for (var item in myObject) alert(item + " : " + myObject[item]); 
```

在大多数体面的浏览器中，我可以期望 'A : "Hello"' 总是出现在 'B : "World"' 之前吗？

* * *

## 回答 #1

> 赞同：229
> 
> 时间：2008-11-11T13:24:20.847

[引用 John Resig 的话](http://ejohn.org/blog/javascript-in-chrome/)：

> 目前所有主流浏览器都按照定义的顺序循环对象的属性。Chrome 也这样做，除了几个案例。[...] ECMAScript 规范明确未定义此行为。在 ECMA-262 中，第 12.6.4 节：
> 
> > 枚举属性的机制......取决于实现。
> 
> 但是，规范与实现有很大不同。ECMAScript 的所有现代实现都按照定义的顺序遍历对象属性。因此，Chrome 团队认为这是一个错误，并将对其进行修复。

所有浏览器都尊重定义顺序[，除了 Chrome](https://code.google.com/p/v8/issues/detail?id=164)和 Opera，它们对每个非数字属性名称都做。在这两个浏览器中，属性被按顺序拉到第一个非数字属性之前（这与它们如何实现数组有关）。顺序也是一样的`Object.keys`。

这个例子应该清楚地说明会发生什么：

```
var obj = {
  "first":"first",
  "2":"2",
  "34":"34",
  "1":"1",
  "second":"second"
};
for (var i in obj) { console.log(i); };
// Order listed:
// "1"
// "2"
// "34"
// "first"
// "second" 
```

这方面的技术细节不如这可能随时改变的事实重要。不要指望事情保持这种状态。

简而言之：**如果顺序对您很重要，请使用数组。**

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2012-01-02T19:02:21.573

*一年后撞到这个...*

现在是**2012 年**，主要浏览器**仍然**不同：

```
function lineate(obj){
    var arr = [], i;
    for (i in obj) arr.push([i,obj[i]].join(':'));
    console.log(arr);
}
var obj = { a:1, b:2, c:3, "123":'xyz' };
/* log1 */  lineate(obj);
obj.a = 4;
/* log2 */  lineate(obj);
delete obj.a;
obj.a = 4;
/* log3 */  lineate(obj); 
```

[在当前浏览器中进行](https://rawgit.com/dvdrtrgn/460db3c214ade506fe7123500b1b4c8c/raw/36aaeb687bc34280e8f1cb5410359271c629e9b6/domlineate.html)[gist](https://gist.github.com/1551668)或测试

Safari 5、火狐 14

```
["a:1", "b:2", "c:3", "123:xyz"]
["a:4", "b:2", "c:3", "123:xyz"]
["b:2", "c:3", "123:xyz", "a:4"] 
```

Chrome 21、Opera 12、节点 0.6、Firefox 27

```
["123:xyz", "a:1", "b:2", "c:3"]
["123:xyz", "a:4", "b:2", "c:3"]
["123:xyz", "b:2", "c:3", "a:4"] 
```

IE9

```
[123:xyz,a:1,b:2,c:3] 
[123:xyz,a:4,b:2,c:3] 
[123:xyz,a:4,b:2,c:3] 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-11-11T12:14:34.357

来自[ECMAScript Language Specification](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf)，第 12.6.4 节（在`for .. in`循环中）：

> 枚举属性的机制取决于实现。枚举的顺序由对象定义。

和第 4.3.3 节（“对象”的定义）：

> 它是一个无序的属性集合，每个属性都包含一个原始值、对象或函数。存储在对象属性中的函数称为方法。

我想这意味着你不能依赖在 JavaScript 实现中以一致的顺序枚举的属性。（无论如何，依赖语言的特定实现细节都是不好的风格。）

如果你想定义你的顺序，你需要实现一些定义它的东西，比如在使用它访问对象之前排序的键数组。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-11-11T12:14:15.277

for/in 枚举的对象元素是没有设置 DontEnum 标志的属性。ECMAScript，又名 Javascript，标准明确指出“一个对象是一个无序的属性集合”（参见[http://www.mozilla.org/js/language/E262-3.pdf](http://www.mozilla.org/js/language/E262-3.pdf)第 8.6 节）。

假设所有 Javascript 实现都将按声明顺序进行枚举，这将不符合标准（即安全）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-01-04T07:44:04.447

迭代顺序在删除属性方面也很混乱，但在这种情况下仅限于 IE。

```
var obj = {};
obj.a = 'a';
obj.b = 'b';
obj.c = 'c';

// IE allows the value to be deleted...
delete obj.b;

// ...but remembers the old position if it is added back later
obj.b = 'bb';
for (var p in obj) {
    alert(obj[p]); // in IE, will be a, bb, then c;
                   // not a, c, then bb as for FF/Chrome/Opera/Safari
} 
```

[如果http://code.google.com/p/v8/issues/detail?id=164](http://code.google.com/p/v8/issues/detail?id=164)上的讨论有任何迹象，那么更改规范以修复迭代顺序的愿望似乎是开发人员非常普遍的愿望。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-08T19:49:54.513

在 IE6 中，不保证顺序。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-08-25T14:57:34.677

订单不可信。Opera 和 Chrome 都返回无序的属性列表。

```
<script type="text/javascript">
var username = {"14719":"A","648":"B","15185":"C"};

for (var i in username) {
  window.alert(i + ' => ' + username[i]);
}
</script> 
```

上面的代码显示了 Opera 中的 B、A、C 和 Chrome 中的 C、A、B。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-04-29T22:05:05.617

这本身并没有回答问题，而是为基本问题提供了解决方案。

假设您不能依赖顺序来保存，为什么不使用具有键和值作为属性的对象数组呢？

```
var myArray = [
    {
        'key'   : 'key1'
        'value' : 0
    },
    {
        'key'   : 'key2',
        'value' : 1
    } // ...
]; 
```

现在，由您来确保密钥是唯一的（假设这对您也很重要）。同样，直接寻址更改，`for (...in...)`现在将索引作为“键”返回。

```
> console.log(myArray[0].key);
key1

> for (let index in myArray) {console.log(myArray[index].value);}
0
1 
```

请参阅CodePen 上按[JDQ](https://codepen.io) ( [@JDQ](https://codepen.io/JDQ) )[顺序寻址的 (...in...)](https://codepen.io/JDQ/pen/deNqKZ/)笔。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2020-08-11T09:30:56.117

正如其他答案所述，不，不能保证订单。

如果要按顺序迭代，可以执行以下操作：

```
let keys = Object.keys(myObject);
for (let key of keys.sort()) {
  let value = myObject[key];

  // Do what you want with key and value 
} 
```

请注意，在性能方面，这不是最佳选择，但这是您想要一个漂亮的字母显示时的价格。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2022-01-31T12:21:44.777

**截至 2022 年**，

我刚刚发现（令我惊讶）Chrome 不遵守定义顺序。它宁可按字母顺序排序，但**不自然**。例如键“a12”出现在“a3”之前。所以要小心。

# servlets - 使用 scriptlet 访问 Get 参数

> ID：280714
> 
> 赞同：3
> 
> 时间：2008-11-11T12:00:46.693
> 
> 标签：servlets, jakarta-ee, scriptlet

我有一个网址，例如*search.do?offset=20*

offset 有时在 url 中，有时不在。当它不在 URL 中时，我希望它为 0。

我尝试使用 scriptlet 检索值，但未成功，如下所示：

```
<%  Integer offset = (pageContext.findAttribute("offset")==null) ? new Integer("0") : new Integer((String) pageContext.findAttribute("offset")); %> 
```

有人知道我在做什么错吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T12:19:51.647

您应该改用它。

```
<% Integer offset = request.getParameter("offset") != null && request.getParameter("offset").length() > 0 ? new Integer(request.getParameter("offset")) : new Integer(0); %> 
```

请小心，因为如果“offset”参数的整数表示不正确，则会抛出 NumberFormatException。

这是基本的 JSP。您可以使用 Struts 或其他 J2EE 框架，使这些转换对您来说更安全。

# stored-procedures - 使用存储过程参数的嵌套数据列表

> ID：280725
> 
> 赞同：1
> 
> 时间：2008-11-11T12:10:38.890
> 
> 标签：stored-procedures, parameters, nested, datalist

我正在使用一些嵌套的 datalist 控件，并且无法让我的嵌套存储过程工作的 SP 参数。

在调试中我可以看到 SqlDataSource2.SelectParameters.Add("Section",oLabel.Text.ToString()); 正在从标签中获取正确的值，但是当结果显示时，我总是得到添加的最后一个参数的结果？

我猜我需要在每次绑定嵌套数据列表时以某种方式清除参数，但是如果我添加代码来执行此操作，它会导致我没有指定参数的错误？

我的代码在下面，您会看到最终我将在彼此内部拥有 3 个嵌套的数据列表 - 或者这就是计划。

感谢您的任何建议

```
<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Default.aspx.cs" Inherits="nhscsharprepeater._Default" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<%@ Import Namespace="System.Web" %>
<%@ Import Namespace="System.Web.UI" %>
<%@ Import Namespace="System.Data" %>

<script type="text/C#" runat="server">

    protected void DataList1_ItemDataBound(object sender, DataListItemEventArgs e)
    {

        DataList oList = (DataList)e.Item.FindControl("Datalist2");
        Label oLabel = (Label)e.Item.FindControl("lblSection");

        DataList oList2 = (DataList)oList.FindControl("Datalist3");

        SqlDataSource2.SelectParameters.Clear();        
        SqlDataSource2.SelectCommand = "report_DistinctSubSections";
        SqlDataSource2.SelectParameters.Add("Section",oLabel.Text.ToString());

        oList.DataBind();

    }

</script>

<html xmlns="http://www.w3.org/1999/xhtml" >
<head runat="server">
    <title>Untitled Page</title>
</head>
<body>
    <form id="form1" runat="server">
    <div>
        <asp:SqlDataSource ID="SqlDataSource1" runat="server" ConnectionString="<%$ ConnectionStrings:productfolioConnectionString %>"
            SelectCommand="report_DistinctSection" SelectCommandType="StoredProcedure"></asp:SqlDataSource>
        <asp:SqlDataSource ID="SqlDataSource2" runat="server" ConnectionString="<%$ ConnectionStrings:productfolioConnectionString %>"
             SelectCommandType="StoredProcedure">

             <SelectParameters>
                <asp:Parameter Name="Section" Type="String" />
             </SelectParameters>

             </asp:SqlDataSource>
        <asp:SqlDataSource ID="SqlDataSource3" runat="server" ConnectionString="<%$ ConnectionStrings:productfolioConnectionString %>"
            SelectCommand="report_getReports" SelectCommandType="StoredProcedure">
            <SelectParameters>
                <asp:Parameter Name="SubSection" Type="String" />
            </SelectParameters>
        </asp:SqlDataSource>
            <asp:DataList ID="DataList1" runat="server" DataSourceID="SqlDataSource1" RepeatColumns="2" RepeatDirection="Horizontal" OnItemDataBound="DataList1_ItemDataBound">
                   <ItemTemplate>

                            <asp:Label Runat="server" text='<%# DataBinder.Eval(Container.DataItem, "Section") %>' ID="lblSection">
                            </asp:Label>

                            <br />

                            <asp:datalist id="Datalist2" runat="server" DataSourceID="SqlDataSource2">                          
                                    <ItemTemplate>

                                                <asp:Label Runat="server" text='<%# DataBinder.Eval(Container.DataItem, "SubSection") %>' ID="lblSection">
                                                </asp:Label>                                    

                                                <br />

                                                   <asp:datalist id="Datalist3" runat="server" DataSourceID="SqlDataSource3">                           
                                                            <ItemTemplate>

                                                                        <!--<asp:Label Runat="server" text='<%# DataBinder.Eval(Container.DataItem, "Report") %>' ID="lblSection">
                                                                        </asp:Label>-->                                                                 

                                                            </ItemTemplate>
                                                    </asp:datalist>                                                

                                    </ItemTemplate>
                            </asp:datalist>

                </ItemTemplate>
           </asp:DataList> 
    </div>
    </form>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T13:35:45.287

有人可能会猜测，在调用[`Clear`](http://msdn.microsoft.com/en-us/library/system.net.webrequest.timeout.aspx)之前`SqlDataSource2.SelectParameters`先调用`Add`可能会奏效。

# vba - 将数据从 Access 写入 Excel 文件

> ID：280729
> 
> 赞同：3
> 
> 时间：2008-11-11T12:12:47.857
> 
> 标签：vba, excel, ms-access

我正在尝试使用以下代码将数据写入 excel 文件

```
 Dim objexcel As Excel.Application
                     Dim wbexcel As Excel.Workbook
                     Dim wbExists As Boolean
                     Set objexcel = CreateObject("excel.Application")
                     objexcel.Visible = True
                     On Error GoTo Openwb
                     wbExists = False
                     Set wbexcel = objexcel.Documents.Open("C:\Documents and Settings\TAYYAPP\Desktop\test folder\ERROR REPORT2.xls")
                     wbExists = True
Openwb:

                     On Error GoTo 0
                     If Not wbExists Then
                     Set wbexcel = objexcel.Workbook.Add
                     End If 
```

但我得到一个

> 运行时错误对象不支持属性或方法

在行中

```
Set wbexcel = objexcel.Workbook.Add 
```

我已经引用了 Excel 对象库。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-11T12:33:14.070

您将需要更改此行：

```
 Set wbexcel = objexcel.WorkBooks.Open( _
    "C:\Documents and Settings\TAYYAPP\Desktop\test folder\ERROR REPORT2.xls") 
```

注意工作簿，而不是文档

至于这一行 Set wbexcel = objexcel.Workbook.Add，wbexcel 被定义为一个工作簿，但该行是一个动作，所以：

```
objexcel.Workbooks.Add
Set wbexcel = objexcel.ActiveWorkbook 
```

编辑：顺便说一句，DoCmd.Transferspreadsheet 可能是将一组数据（查询、表）从 Access 传输到 Excel 的最简单方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T09:29:22.427

我有这个工作正常的代码

```
Dim objexcel As Excel.Application
                     Dim wbexcel As Excel.Workbook
                     Dim wbExists As Boolean
                     Dim objSht As Excel.Worksheet
                     Dim objRange As Excel.Range

                     Set objexcel = CreateObject("excel.Application")
                     objexcel.Visible = True
                     On Error GoTo Openwb
                     wbExists = False
                     Set wbexcel = objexcel.Workbooks.Open("C:\Documents and Settings\TAYYAPP\Desktop\test folder\reports\ERROR REPORT2.xls")
                     Set objSht = wbexcel.Worksheets("Sheet1")
                     objSht.Activate
                     wbExists = True
Openwb:

                     On Error GoTo 0
                     If Not wbExists Then
                     objexcel.Workbooks.Add
                     Set wbexcel = objexcel.ActiveWorkbook
                     Set objSht = wbexcel.Worksheets("Sheet1")

                     End If 
```

但我想再添加一个检查，如果文件存在，那么我想看看它是否填充了值，如果是，那么我希望从最后填充下一组值。截至目前，它正在覆盖现有值

# c# - 如果 NDepend 查询引发警告，我如何自动失败构建

> ID：280730
> 
> 赞同：2
> 
> 时间：2008-11-11T12:13:08.680
> 
> 标签：c#, continuous-integration, cruisecontrol.net, nant, ndepend

好的，首先一些背景。我正忙于自动化我们的构建过程。我们混合运行 Vs 2005 和 VS 2008，两者都针对平台 2.0。我们使用 Nant 进行构建，使用 MSBUILD 任务进行编译，使用 Cruise Control .net 进行 CI。目前我们将所有警告视为错误，如果任何 FxCop 规则失败（我们禁用的一小部分除外），则构建失败，如果 Simian 检测到所有项目中超过 5 行的任何代码重复，则构建失败。

我编写了 NDepend CQL 查询来强制执行一些在 FxCop 中难以实现的规则。如果方法/类中的行数超出某个限制，我想使构建失败。如果方法的圈复杂度太高，我也想失败。

作为构建的一部分，我可以轻松地运行 NDepend。但如果我的 CQL 查询返回结果 > 0，我无法让构建失败

所以这是一个问题：

1.  有没有人尝试过类似的东西？
2.  是否有支持此功能的 Nant 任务？
3.  如果有一个调用 NDepend 的 Nant 任务，但没有失败，那么构建是可用的源，所以我可以添加这个功能吗？

谢谢，斯蒂芬

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T15:15:27.003

我们所做的实际上是在解析输出文件之后立即运行一个 powershell 脚本，并根据它找到的条件抛出一系列带有适当消息的错误。一旦 powershell 抛出错误，构建就会失败。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-06-01T10:09:21.817

请参阅有关 NDepend 关键规则和构建失败的文档： [http ://www.ndepend.com/Doc_CI_CriticalRule.aspx](http://www.ndepend.com/Doc_CI_CriticalRule.aspx)

# c# - 如何将任意文件的依赖项添加到 T4 模板？

> ID：280748
> 
> 赞同：8
> 
> 时间：2008-11-11T12:22:18.133
> 
> 标签：c#, .net, t4

我有一个从 xml 文件生成类的 T4 模板。

如何在 xml 文件和模板文件之间添加依赖关系，以便在修改 xml 文件时自动重新运行模板，而无需从上下文菜单中选择“运行自定义工具”？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-29T19:28:35.963

我不相信 T4 支持基于外部依赖的自动模板转换。我同意 Marc - 如果您只有一个外部文件，您可以为您的 XML 文件创建一个自定义“自定义工具”，或者简单地使用[ttxgen](http://code.msdn.microsoft.com/TTxGen)。但是，我认为这种方法无法扩展到 t4 模板依赖多个文件的情况。您可能需要创建一个 Visual Studio 包来处理它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T13:09:59.130

工具执行需要多长时间？一个懒惰的选择可能是简单地编辑 csproj 以便它*始终*在构建期间运行该工具（可能是通过[`<Exec ... />`](http://msdn.microsoft.com/en-us/library/x8zx72cd.aspx)或自定义`targets`文件） - 当然，这取决于它是否能够快速执行。

另一种方法是编写一个在 VS 中用作“自定义工具”的 shim，并使用正确的 args 简单地调用现有的 exe（或其他）。不是微不足道的，而是可行的（[见这里](http://www.codeproject.com/KB/cs/VsMultipleFileGenerator.aspx?display=Print)）——我相信这应该与变化检测相当好。它实际上在我为当前项目做的事情清单上，所以我很快就会发现......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-06-05T12:19:02.240

您可以使用[AutoTT](http://visualstudiogallery.msdn.microsoft.com/6d3611ab-958a-4adf-92cd-dda6bbd3aa81) Visual Studio 扩展。

此扩展允许配置将运行 T4 模板的触发器。

可能的触发因素之一是文件更改。在 AutoTT 页面的示例配置文件中，触发器的正则表达式匹配指定文件夹（Controllers、Content）中的所有文件，但您可以更改它以使其仅与特定文件一起运行。

[Chirpy](http://chirpy.codeplex.com/releases/view/61897)是执行此操作的另一种选择。还有[T4 Regenerator](http://visualstudiogallery.msdn.microsoft.com/201b7438-f362-4bd7-b8a6-1f65510a04e3)，它以不同的方式进行。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-11T15:38:02.917

您是否尝试过使用[<#@ xsd](http://www.olegsych.com/2008/08/t4-xsd-directive/)？

# c# - 从 C# 自定义操作中获取 SourceDir 属性

> ID：280749
> 
> 赞同：1
> 
> 时间：2008-11-11T12:22:52.563
> 
> 标签：c#, .net, installation

我有一些与我的安装程序捆绑在一起的目录，我需要从自定义操作中访问它们。我做了一些研究，发现可以使用 SourceDir 来获取当前正在执行的 dir 位置。但是我找不到任何有关如何获得此属性的示例？还是另一种获取当前目录的方法？

除了无用的 Microsoft 网站之外，任何人都可以建议或指向我吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T23:11:57.150

我假设您正在使用 vbscript 进行自定义操作。如果是这样，可以通过 Session 对象访问属性。见下文：

```
strSourceDir = Session.Property("SourceDir") 
```

请注意，SourceDir 属性仅在[安装期间的特定时间](http://msdn.microsoft.com/en-us/library/aa371857(VS.85).aspx)可用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-17T02:21:33.027

对于 C#，您会发现可以执行以下操作：

```
[CustomAction]
public static ActionResult MyCustomAction(Session session)
{
    string sourceDir = session["SourceDir"];
    string path = Path.Combine(sourceDir, "yourfilename.txt");
    ... 
```

[不幸的是，MSDN](http://msdn.microsoft.com/en-us/library/aa371681.aspx)上的文档没有明确说明这一点。

正如 w4g3n3r 在他的回答中提到的那样，SourceDir 仅在特定时间对您可用。简而言之，您需要确保在调用 ResolveSource 操作**之后**调用自定义操作，该操作只能在 CostInitialize 运行后调用。

设置 SourceDir 后，它应该可用于安装过程的其余部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-17T02:31:28.217

您在使用 InstallShield 吗？下面是一个 InstallScript CA 的示例：

```
MsiGetProperty(hMSI, "CustomActionData", strDirectory, numBuffer); 
```

...您还使用 Set Property“Type 51”自定义操作将函数的 CustomActionData 设置为值 SOURCEDIR。

# c# - “复制本地”和项目参考的最佳实践是什么？

> ID：280751
> 
> 赞同：159
> 
> 时间：2008-11-11T12:24:49.033
> 
> 标签：c#, .net, visual-studio, msbuild

我有一个大型 c# 解决方案文件（约 100 个项目），并且我正在尝试缩短构建时间。我认为“复制本地”在很多情况下对我们来说是浪费，但我想知道最佳实践。

在我们的 .sln 中，我们有依赖于程序集 B 的应用程序 A，它依赖于程序集 C。在我们的例子中，有几十个“B”和少数“C”。由于这些都包含在 .sln 中，因此我们使用的是项目引用。当前所有程序集都构建到 $(SolutionDir)/Debug（或 Release）中。

默认情况下，Visual Studio 将这些项目引用标记为“复制本地”，这会导致每个“C”被复制到 $(SolutionDir)/Debug 中，对于每个构建的“B”。这似乎很浪费。如果我只关闭“复制本地”会出现什么问题？其他拥有大型系统的人会做什么？

跟进：

许多响应建议将构建分解为较小的 .sln 文件...在上面的示例中，我将首先构建基础类“C”，然后是大部分模块“B”，然后是一些应用程序，“一种”。在这个模型中，我需要从 B 获得对 C 的非项目引用。我遇到的问题是“调试”或“发布”被纳入提示路径，我最终构建了“B”的发布版本针对“C”的调试版本。

对于那些将构建拆分为多个 .sln 文件的人，您如何处理这个问题？

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2009-03-16T09:39:39.507

在之前的项目中，我使用了一个带有项目引用的大型解决方案，并且也遇到了性能问题。解决方案是三个方面：

1.  始终将 Copy Local 属性设置为 false 并通过自定义 msbuild 步骤强制执行此操作

2.  将每个项目的输出目录设置为相同的目录（最好相对于 $(SolutionDir)

3.  框架附带的默认 cs 目标计算要复制到当前正在构建的项目的输出目录的引用集。由于这需要在“参考”关系下计算传递闭包，这可能会变得**非常**昂贵。我的解决方法是`GetCopyToOutputDirectoryItems`在一个通用目标文件（例如`Common.targets`）中重新定义目标，该文件在导入`Microsoft.CSharp.targets`. 导致每个项目文件如下所示：

    ```
    <Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
      <PropertyGroup>
        ... snip ...
      </ItemGroup>
      <Import Project="$(MSBuildBinPath)\Microsoft.CSharp.targets" />
      <Import Project="[relative path to Common.targets]" />
      <!-- To modify your build process, add your task inside one of the targets below and uncomment it. 
           Other similar extension points exist, see Microsoft.Common.targets.
      <Target Name="BeforeBuild">
      </Target>
      <Target Name="AfterBuild">
      </Target>
      -->
    </Project> 
    ```

这将我们在给定时间的构建时间从几个小时（主要是由于内存限制）减少到了几分钟。

`GetCopyToOutputDirectoryItems`可以通过将 2,438–2,450 和 2,474–2,524 行从 复制到 中来创建`C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Microsoft.Common.targets`重新定义`Common.targets`。

为了完整起见，生成的目标定义变为：

```
<!-- This is a modified version of the Microsoft.Common.targets
     version of this target it does not include transitively
     referenced projects. Since this leads to enormous memory
     consumption and is not needed since we use the single
     output directory strategy.
============================================================
                    GetCopyToOutputDirectoryItems

Get all project items that may need to be transferred to the
output directory.
============================================================ -->
<Target
    Name="GetCopyToOutputDirectoryItems"
    Outputs="@(AllItemsFullPathWithTargetPath)"
    DependsOnTargets="AssignTargetPaths;_SplitProjectReferencesByFileExistence">

    <!-- Get items from this project last so that they will be copied last. -->
    <CreateItem
        Include="@(ContentWithTargetPath->'%(FullPath)')"
        Condition="'%(ContentWithTargetPath.CopyToOutputDirectory)'=='Always' or '%(ContentWithTargetPath.CopyToOutputDirectory)'=='PreserveNewest'"
            >
        <Output TaskParameter="Include" ItemName="AllItemsFullPathWithTargetPath"/>
        <Output TaskParameter="Include" ItemName="_SourceItemsToCopyToOutputDirectoryAlways"
                Condition="'%(ContentWithTargetPath.CopyToOutputDirectory)'=='Always'"/>
        <Output TaskParameter="Include" ItemName="_SourceItemsToCopyToOutputDirectory"
                Condition="'%(ContentWithTargetPath.CopyToOutputDirectory)'=='PreserveNewest'"/>
    </CreateItem>

    <CreateItem
        Include="@(_EmbeddedResourceWithTargetPath->'%(FullPath)')"
        Condition="'%(_EmbeddedResourceWithTargetPath.CopyToOutputDirectory)'=='Always' or '%(_EmbeddedResourceWithTargetPath.CopyToOutputDirectory)'=='PreserveNewest'"
            >
        <Output TaskParameter="Include" ItemName="AllItemsFullPathWithTargetPath"/>
        <Output TaskParameter="Include" ItemName="_SourceItemsToCopyToOutputDirectoryAlways"
                Condition="'%(_EmbeddedResourceWithTargetPath.CopyToOutputDirectory)'=='Always'"/>
        <Output TaskParameter="Include" ItemName="_SourceItemsToCopyToOutputDirectory"
                Condition="'%(_EmbeddedResourceWithTargetPath.CopyToOutputDirectory)'=='PreserveNewest'"/>
    </CreateItem>

    <CreateItem
        Include="@(Compile->'%(FullPath)')"
        Condition="'%(Compile.CopyToOutputDirectory)'=='Always' or '%(Compile.CopyToOutputDirectory)'=='PreserveNewest'">
        <Output TaskParameter="Include" ItemName="_CompileItemsToCopy"/>
    </CreateItem>
    <AssignTargetPath Files="@(_CompileItemsToCopy)" RootFolder="$(MSBuildProjectDirectory)">
        <Output TaskParameter="AssignedFiles" ItemName="_CompileItemsToCopyWithTargetPath" />
    </AssignTargetPath>
    <CreateItem Include="@(_CompileItemsToCopyWithTargetPath)">
        <Output TaskParameter="Include" ItemName="AllItemsFullPathWithTargetPath"/>
        <Output TaskParameter="Include" ItemName="_SourceItemsToCopyToOutputDirectoryAlways"
                Condition="'%(_CompileItemsToCopyWithTargetPath.CopyToOutputDirectory)'=='Always'"/>
        <Output TaskParameter="Include" ItemName="_SourceItemsToCopyToOutputDirectory"
                Condition="'%(_CompileItemsToCopyWithTargetPath.CopyToOutputDirectory)'=='PreserveNewest'"/>
    </CreateItem>

    <CreateItem
        Include="@(_NoneWithTargetPath->'%(FullPath)')"
        Condition="'%(_NoneWithTargetPath.CopyToOutputDirectory)'=='Always' or '%(_NoneWithTargetPath.CopyToOutputDirectory)'=='PreserveNewest'"
            >
        <Output TaskParameter="Include" ItemName="AllItemsFullPathWithTargetPath"/>
        <Output TaskParameter="Include" ItemName="_SourceItemsToCopyToOutputDirectoryAlways"
                Condition="'%(_NoneWithTargetPath.CopyToOutputDirectory)'=='Always'"/>
        <Output TaskParameter="Include" ItemName="_SourceItemsToCopyToOutputDirectory"
                Condition="'%(_NoneWithTargetPath.CopyToOutputDirectory)'=='PreserveNewest'"/>
    </CreateItem>
</Target> 
```

有了这个解决方法，我发现在一个解决方案中拥有多达 120 个以上的项目是可行的，这主要的好处是项目的构建顺序仍然可以由 VS 确定，而不是通过拆分解决方案来手动完成.

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-03-16T09:55:54.400

我建议您阅读 Patric Smacchia 关于该主题的文章：

*   [通过 .NET 程序集和 Visual Studio 项目对代码库进行分区](http://www.simple-talk.com/dotnet/.net-framework/partitioning-your-code-base-through-.net-assemblies-and-visual-studio-projects/)-->*每个 Visual Studio 项目真的应该在自己的程序集中吗？'Copy Local=True' 的真正含义是什么？*
*   [从 NUnit 代码库中吸取的教训](http://codebetter.com/blogs/patricksmacchia/archive/2009/01/11/lessons-learned-from-the-nunit-code-base.aspx)--> *VisualStudio 项目参考 + 复制本地 true 选项是邪恶的！*)
*   [分析 CruiseControl.NET 的代码库](http://codebetter.com/patricksmacchia/2009/03/15/analyzing-the-code-base-of-cruisecontrol-net/)-->*错误使用 Copy Local Reference Assembly 选项设置为 True)*

> CC.Net VS 项目依赖于设置为 true 的复制本地引用程序集选项。[...] 这不仅显着增加了编译时间（在 NUnit 的情况下为 x3），而且还扰乱了您的工作环境。最后但同样重要的是，这样做会带来版本控制潜在问题的风险。顺便说一句，如果 NDepend 在 2 个具有相同名称但内容或版本不同的不同目录中找到 2 个程序集，它将发出警告。
> 
> 正确的做法是定义 2 个目录 $RootDir$\bin\Debug 和 $RootDir$\bin\Release，并将您的 VisualStudio 项目配置为在这些目录中发出程序集。所有项目引用都应引用 Debug 目录中的程序集。

您还可以阅读[这篇文章](http://www.theserverside.net/tt/articles/showarticle.tss?id=ControllingDependencies)来帮助您减少项目数量并缩短编译时间。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2011-06-30T02:44:37.353

我建议对几乎所有项目都使用 copy local = false ，除了依赖关系树顶部的项目。对于顶部集合中的所有引用，请复制 local = true。我看到很多人建议共享一个输出目录；我认为这是一个基于经验的可怕想法。如果您的启动项目包含对任何其他项目包含对您的引用的 dll 的引用，即使在所有内容上都复制本地 = false 并且您的构建将失败，有时也会遇到访问\共享冲突。这个问题很烦人，很难追查。我完全建议远离分片输出目录，而不是让项目位于依赖链的顶部，将所需的程序集写入相应的文件夹。如果您没有在“顶部”的项目，那么我会建议一个构建后的副本，以将所有内容放在正确的位置。另外，我会尽量记住调试的便利性。我仍然保留副本 local=true 的任何 exe 项目，因此 F5 调试体验将起作用。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-01-07T22:02:31.043

你是对的。CopyLocal 绝对会扼杀您的构建时间。如果你有一个大的源代码树，那么你应该禁用 CopyLocal。不幸的是，干净地禁用它并不容易。[我已经在How do I override CopyLocal (Private) setting for references in .NET from MSBUILD 中](https://stackoverflow.com/questions/1682096/how-do-i-override-copylocal-private-setting-for-references-in-net-from-msbuild)回答了有关禁用 CopyLocal 的确切问题。看看这个。以及[Visual Studio (2008) 中大型解决方案的最佳实践。](https://stackoverflow.com/questions/690033/best-practices-for-large-solutions-in-visual-studio-2008)

这是我看到的有关 CopyLocal 的更多信息。

CopyLocal 的实现是为了支持本地调试。当您准备应用程序以进行打包和部署时，您应该将项目构建到相同的输出文件夹，并确保您拥有所需的所有引用。

[我在文章MSBuild: Best Practices For Creating Reliable Builds, Part 2](http://msdn.microsoft.com/en-us/magazine/dd483291.aspx)中写过如何处理构建大型源代码树。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-11-11T12:45:15.810

在我看来，拥有 100 个项目的解决方案是一个大错误。您可以将解决方案拆分为有效的逻辑小单元，从而简化维护和构建。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2015-04-17T19:53:16.183

我很惊讶没有人提到使用硬链接。它不是复制文件，而是创建指向原始文件的硬链接。这可以节省磁盘空间并大大加快构建速度。这可以使用以下属性在命令行上启用：

/p:CreateHardLinksForAdditionalFilesIfPossible=true;CreateHardLinksForCopyAdditionalFilesIfPossible=true;CreateHardLinksForCopyFilesToOutputDirectoryIfPossible=true;CreateHardLinksForCopyLocalIfPossible=true;CreateHardLinksForPublishFilesIfPossible=true

您还可以将其添加到中央导入文件中，以便您的所有项目也可以获得此好处。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-03-16T07:58:40.437

如果您通过项目引用或解决方案级别的依赖项定义了依赖项结构，则可以安全地打开“复制本地”，我什至会说这是一个最佳实践，因为这将让您使用 MSBuild 3.5 并行运行您的构建（通过 /maxcpucount) 尝试复制引用的程序集时，不同的进程不会相互绊倒。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-11-11T12:39:34.400

我们的“最佳做法”是避免许多项目的解决方案。我们有一个名为“matrix”的目录，其中包含当前版本的程序集，所有引用都来自该目录。如果您更改了某个项目并且可以说“现在更改已完成”，您可以将程序集复制到“矩阵”目录中。因此，依赖于该程序集的所有项目都将具有当前（=最新）版本。

如果解决方案中的项目很少，则构建过程会快得多。

您可以使用 Visual Studio 宏或使用“菜单 -> 工具 -> 外部工具...”自动执行“将程序集复制到矩阵目录”步骤。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-06-15T22:11:06.760

您不需要更改 CopyLocal 值。您需要做的就是为解决方案中的所有项目预定义一个通用 $(OutputPath) 并将 $(UseCommonOutputDirectory) 预设为 true。看到这个：http: [//blogs.msdn.com/b/kirillosenkov/archive/2015/04/04/using-a-common-intermediate-and-output-directory-for-your-solution.aspx](http://blogs.msdn.com/b/kirillosenkov/archive/2015/04/04/using-a-common-intermediate-and-output-directory-for-your-solution.aspx)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-12-09T02:50:19.213

设置 CopyLocal=false 将减少构建时间，但在部署期间可能会导致不同的问题。

有很多情况下，当您需要将 Copy Local' 保留为 True 时，例如

*   顶级项目，
*   二级依赖，
*   反射调用的 DLL

SO 问题
“[何时应将 copy-local 设置为 true，何时不应设置？](https://stackoverflow.com/questions/602765/when-should-copy-local-be-set-to-true-and-when-should-it-not) ”、
“[错误消息“无法加载一种或多种请求的类型。检索 LoaderExceptions 属性以获取更多信息。”中描述的可能问题。](https://stackoverflow.com/questions/1091853/unable-to-load-one-or-more-of-the-requested-types-retrieve-the-loaderexceptions/6200173#6200173)"
和  [aaron-stainback](https://stackoverflow.com/users/424430/aaron-stainback)对这个问题的[回答](https://stackoverflow.com/a/6200173/52277) 。

我设置 CopyLocal=false 的经验并不成功。请参阅我的博客文章[“请勿将“复制本地”项目引用更改为 false，除非了解子序列。”](http://geekswithblogs.net/mnf/archive/2012/12/09/do-not-change-copy-local-project-references-to-false-unless.aspx)

解决问题的时间超过了设置 copyLocal=false 的好处。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-11T12:39:59.203

我倾向于构建到一个公共目录（例如 ..\bin），所以我可以创建小型测试解决方案。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-11T12:54:06.040

您可以尝试使用将复制项目之间共享的所有程序集的文件夹，然后创建 DEVPATH 环境变量并

`<developmentMode developerInstallation="true" />`

在每个开发人员工作站上的 machine.config 文件中进行设置。您唯一需要做的就是复制 DEVPATH 变量指向的文件夹中的任何新版本。

如果可能，还将您的解决方案分成几个较小的解决方案。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-11T14:16:33.160

这可能不是最佳实践，但这就是我的工作方式。

我注意到托管 C++ 将其所有二进制文件转储到 $(SolutionDir)/'DebugOrRelease' 中。所以我也把我所有的 C# 项目都放在那里了。我还关闭了解决方案中对项目的所有引用的“复制本地”。在我的小型 10 项目解决方案中，我的构建时间得到了显着改善。此解决方案混合了 C#、托管 C++、本机 C++、C# Web 服务和安装程序项目。

也许有些东西坏了，但由于这是我工作的唯一方式，我没有注意到它。

找出我正在破坏的东西会很有趣。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-11T12:48:08.737

通常，如果您希望项目使用 Bin 中的 DLL 而不是其他地方（GAC、其他项目等）的 DLL，则只需要复制本地

我倾向于同意其他人的观点，即如果可能的话，您也应该尝试打破该解决方案。

您还可以使用配置管理器在一个仅构建给定项目集的解决方案中为自己设置不同的构建配置。

如果所有 100 个项目都相互依赖，这似乎很奇怪，因此您应该能够将其拆分或使用 Configuration Manager 来帮助自己。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-12T12:32:37.300

您可以让您的项目引用指向 dll 的调试版本。与您的 msbuild 脚本相比，您可以设置`/p:Configuration=Release`，因此您将拥有应用程序和所有附属程序集的发布版本。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-03-31T13:17:40.173

如果您想在没有 GAC 的情况下使用 copy local false 来引用 DLL 的中心位置，除非您这样做。

[http://nbaked.wordpress.com/2010/03/28/gac-alternative/](http://nbaked.wordpress.com/2010/03/28/gac-alternative/)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-07-16T07:25:36.387

如果引用不包含在 GAC 中，我们必须将 Copy Local 设置为 true 以便应用程序能够工作，如果我们确定引用将预安装在 GAC 中，则可以将其设置为 false。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-11-24T13:01:13.067

好吧，我当然不知道问题是如何解决的，但是我接触了一个构建解决方案，它可以帮助自己，这样所有创建的文件都可以在**符号链接**的帮助下放在**ramdisk**上。

 ***   c:\solution 文件夹\bin -> ramdisk r:\solution 文件夹\bin\
*   c:\solution 文件夹\obj -> ramdisk r:\solution 文件夹\obj\

*   您还可以另外告诉视觉工作室它可以用于构建的临时目录。

事实上，它所做的还不止这些。但这确实触动了我对性能的理解。
3 分钟内 100% 的处理器使用和一个包含所有依赖项的大型项目。

# .net - .NET 中用于通过不可靠 (3G) 网络连接发送数据的最佳设计是什么？

> ID：280755
> 
> 赞同：10
> 
> 时间：2008-11-11T12:29:02.457
> 
> 标签：.net, mobile, networking

我正在重新设计一个我继承的应用程序，它将数码照片从笔记本电脑发送到网络服务器。这个想法是“在现场”拍摄照片并立即将它们发布在网页上（具有一些更花哨的功能）。

典型场景
1\. 使用标准 USB 将照片从相机传输到笔记本电脑。
2.照片经过各种处理。（不重要）
3\. 每张照片都使用 Web 请求以小块（每张约 64 kb）的形式发布到标准 Apache 网络服务器，然后再次合并在一起。

当前设计的问题是，当网络连接不可靠时，它经常会挂起。由于我们使用的是移动网络 (3G)，并且经常无法覆盖，因此我需要一种方法来正确处理此问题。

我的问题是是否有更好的解决方案可以在连接不时断开时不会使应用程序挂起。

（额外的问题是如何在不必带着笔记本电脑徒步旅行的情况下进行正确的单元测试。）

编辑 2008-11-24：我现在已经设法使用 NetLimiter 和 TMnetsim（免费软件）的组合为此设置了一个适当的测试环境。我尝试设置 5 kb/sec 并丢弃所有数据包的 1% - 我的应用程序仍然适用于新设计。

编辑 2008-12-11：只是为了更新我是如何做到这一点的。我创建了一个后台工作人员（如下所示），每当检测到相机时就会启动该工作人员，以将照片从相机复制到 PC。然后，当文件到达 PC 以使用异步 HTTP 传输上传时，我启动了另一个后台工作人员。把所有事情都做好肯定很痛苦，特别是因为操作应该随时“可取消”……但无论如何，现在它可以工作了。非常感谢所有帮助过我的人！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T07:21:12.473

我会避免在任何具有 UI 的线程中使用 HTTP，除非你真的想阻塞直到收到响应。您可以尝试使用后台线程中的相同逻辑，该线程将根据需要运行。只要确保有逻辑可以检测连接何时丢失（可能是超时），并会定期（但不频繁）重试，直到再次连接。

您最好的选择是创建某种后台工作进程，一旦将照片保存到设备上的保管箱目录，就会上传照片。我会说虽然创建一个基于 .NET 的后台进程并非易事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T12:31:14.963

首先找出它为什么挂起 - 请求只是在那里吗？他们超时了吗？如果降低超时设置会发生什么？

你是从 UI 线程做 POST 吗？（不要那样做：）

您也可以通过以非常短的超时时间发出心跳请求来检测连接断开。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T13:11:56.160

您可能需要使用[WebRequest.BeginGetResponse](http://msdn.microsoft.com/en-us/library/system.net.webrequest.begingetresponse.aspx)而不是 WebRequest.GetResponse，尽管似乎没有办法取消响应（也许处理 WebRequest 会有所帮助）。

此外，您可以尝试使用WebRequest的[Timeout属性](http://msdn.microsoft.com/en-us/library/system.net.webrequest.timeout.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T13:34:54.443

一种无需将笔记本电脑带入现场即可进行测试的方法：在备用机器上尝试[m0n0wall](http://m0n0.ch/wall/)，并设置其防火墙规则以压缩带宽并丢弃数据包。

或者，在您的服务器/客户端上安装[netlimiter](http://netlimiter.com/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T12:34:57.280

首先，我会将转移过程放在应用程序之外。使用允许它从上次传输中间重新开始传输的实用程序同步文件。

您可以使用某种类型的[法拉第笼](http://en.wikipedia.org/wiki/Faraday_cage)模拟通信中断。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T12:42:39.713

你看过[同步框架](http://msdn.microsoft.com/en-us/sync/bb821992.aspx)吗？

希望它有所帮助，布鲁诺·菲格雷多

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-01T00:40:05.917

我会尝试将 ASP.NET 缓存技术与 ADO.NET 同步服务一起用于数据传输。

尝试先将图像缓存为二进制或 BLOB 格式，然后将它们存储在本地 CE 数据库（或 Express）中。然后通过 WebServices 将数据同步到中央服务器数据库。

尝试创建一个集中式 Web 服务来处理您的缓存图像传输。

Web 服务将在“偶尔连接”的场景中通过同步服务接收数据。

对于单元测试，请尝试在拨号连接上使用虚拟机 (VMware) 或笔记本电脑。

# jquery - jQuery validate：如何为正则表达式验证添加规则？

> ID：280759
> 
> 赞同：250
> 
> 时间：2008-11-11T12:34:29.607
> 
> 标签：jquery, regex, jquery-validate

我正在使用**[jQuery](http://en.wikipedia.org/wiki/JQuery)验证插件**。好东西！我想迁移我现有的 ASP.NET 解决方案以使用 jQuery 而不是 ASP.NET 验证器。我缺少**正则表达式**验证器的替代品。我希望能够做这样的事情：

```
$("Textbox").rules("add", { regularExpression: "^[a-zA-Z'.\s]{1,40}$" }) 
```

如何**添加自定义规则**来实现这一点？

* * *

## 回答 #1

> 赞同：350
> 
> 时间：2009-04-02T11:38:38.307

感谢redsquare的回答，我添加了这样的方法：

```
$.validator.addMethod(
  "regex",
  function(value, element, regexp) {
    var re = new RegExp(regexp);
    return this.optional(element) || re.test(value);
  },
  "Please check your input."
); 
```

现在，您需要做的就是验证任何正则表达式：

```
$("#Textbox").rules("add", { regex: "^[a-zA-Z'.\\s]{1,40}$" }) 
```

此外，看起来有一个`additional-methods.js`包含方法“模式”的名为的文件，它可以是`RegExp`使用不带引号的方法创建的。

* * *

## 编辑

该`pattern`函数现在是执行此操作的首选方法，例如：

```
$("#Textbox").rules("add", { pattern: "^[a-zA-Z'.\\s]{1,40}$" }) 
```

*   [https://cdnjs.com/libraries/jquery-validate](https://cdnjs.com/libraries/jquery-validate)
    *   [https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.2/jquery.validate.min.js](https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.2/jquery.validate.min.js)
    *   [https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.2/additional-methods.min.js](https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.2/additional-methods.min.js)

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2008-11-11T14:01:39.243

您可以使用 addMethod()

例如

```
$.validator.addMethod('postalCode', function (value) { 
    return /^((\d{5}-\d{4})|(\d{5})|([A-Z]\d[A-Z]\s\d[A-Z]\d))$/.test(value); 
}, 'Please enter a valid US or Canadian postal code.'); 
```

好文章在这里[https://web.archive.org/web/20130609222116/http://www.randallmorey.com/blog/2008/mar/16/extending-jquery-form-validation-plugin/](https://web.archive.org/web/20130609222116/http://www.randallmorey.com/blog/2008/mar/16/extending-jquery-form-validation-plugin/)

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2009-08-01T19:54:30.513

我在将所有部分放在一起做一个 jQuery 正则表达式验证器时遇到了一些麻烦，但我让它工作了......这是一个完整的工作示例。它使用可以在*[jQuery Validation Plugin中找到的“Validation”插件](http://bassistance.de/jquery-plugins/jquery-plugin-validation/)*

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="http://YOURJQUERYPATH/js/jquery.js" type="text/javascript"></script>
    <script src="http://YOURJQUERYPATH/js/jquery.validate.js" type="text/javascript"></script>
    <script type="text/javascript">

        $().ready(function() {
            $.validator.addMethod("EMAIL", function(value, element) {
                return this.optional(element) || /^[a-zA-Z0-9._-]+@[a-zA-Z0-9-]+\.[a-zA-Z.]{2,5}$/i.test(value);
            }, "Email Address is invalid: Please enter a valid email address.");

            $.validator.addMethod("PASSWORD",function(value,element){
                return this.optional(element) || /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,16}$/i.test(value);
            },"Passwords are 8-16 characters with uppercase letters, lowercase letters and at least one number.");

            $.validator.addMethod("SUBMIT",function(value,element){
                return this.optional(element) || /[^ ]/i.test(value);
            },"You did not click the submit button.");

            // Validate signup form on keyup and submit
            $("#LOGIN").validate({
                rules: {
                    EMAIL: "required EMAIL",
                    PASSWORD: "required PASSWORD",
                    SUBMIT: "required SUBMIT",
                },
            });
        });
    </script>
</head>
<body>
    <div id="LOGIN_FORM" class="form">
        <form id="LOGIN" name="LOGIN" method="post" action="/index/secure/authentication?action=login">
            <h1>Log In</h1>
            <div id="LOGIN_EMAIL">
                <label for="EMAIL">Email Address</label>
                <input id="EMAIL" name="EMAIL" type="text" value="" tabindex="1" />
            </div>
            <div id="LOGIN_PASSWORD">
                <label for="PASSWORD">Password</label>
                <input id="PASSWORD" name="PASSWORD" type="password" value="" tabindex="2" />
            </div>
            <div id="LOGIN_SUBMIT">
                <input id="SUBMIT" name="SUBMIT" type="submit" value="Submit" tabindex="3" />
            </div>
        </form>
    </div>
</body>
</html> 
```

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2010-01-11T07:00:14.507

没有理由将正则表达式定义为字符串。

```
$.validator.addMethod(
    "regex",
    function(value, element, regexp) {
        var check = false;
        return this.optional(element) || regexp.test(value);
    },
    "Please check your input."
); 
```

和

```
telephone: { required: true, regex : /^[\d\s]+$/, minlength: 5 }, 
```

这样更好，不是吗？

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2009-05-09T16:40:21.300

稍微扩展 PeterTheNiceGuy 的答案：

```
$.validator.addMethod(
        "regex",
        function(value, element, regexp) {
            if (regexp.constructor != RegExp)
                regexp = new RegExp(regexp);
            else if (regexp.global)
                regexp.lastIndex = 0;
            return this.optional(element) || regexp.test(value);
        },
        "Please check your input."
); 
```

这将允许您将正则表达式对象传递给规则。

```
$("Textbox").rules("add", { regex: /^[a-zA-Z'.\s]{1,40}$/ }); 
```

如果在对象上设置了 -flag，`lastIndex`则需要重置属性。否则，它将从与该正则表达式的最后一次匹配的位置开始验证，即使主题字符串不同。`g``RegExp`

我的其他一些想法是使您能够使用正则表达式的数组，以及否定正则表达式的另一条规则：

```
$("password").rules("add", {
    regex: [
        /^[a-zA-Z'.\s]{8,40}$/,
        /^.*[a-z].*$/,
        /^.*[A-Z].*$/,
        /^.*[0-9].*$/
    ],
    '!regex': /password|123/
}); 
```

但是实施这些可能太多了。

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2009-05-14T12:03:37.477

如[addMethod 文档](http://docs.jquery.com/Plugins/Validation/Validator/addMethod)所述：

请注意：虽然很容易添加一个正则表达式方法来检查它的参数值，但将这些正则表达式封装在他们自己的方法中要干净得多。如果您需要大量略有不同的表达式，请尝试提取一个公共参数。正则表达式库：[http ://regexlib.com/DisplayPatterns.aspx](http://regexlib.com/DisplayPatterns.aspx)

所以是的，你必须为每个正则表达式添加一个方法。开销很小，同时它允许您为正则表达式命名（不可低估）、默认消息（方便）以及在不同地方重用它的能力，而无需一遍又一遍地复制正则表达式本身。

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2010-10-31T10:39:11.987

我让它像这样工作：

```
$.validator.addMethod(
    "regex",
    function(value, element, regexp) {
        return this.optional(element) || regexp.test(value);
    },
    "Please check your input."
);

$(function () {
    $('#uiEmailAdress').focus();
    $('#NewsletterForm').validate({
        rules: {
            uiEmailAdress:{
                required: true,
                email: true,
                minlength: 5
            },
            uiConfirmEmailAdress:{
                required: true,
                email: true,
                equalTo: '#uiEmailAdress'
            },
            DDLanguage:{
                required: true
            },
            Testveld:{
                required: true,
                regex: /^[0-9]{3}$/
            }
        },
        messages: {
            uiEmailAdress:{
                required: 'Verplicht veld',
                email: 'Ongeldig emailadres',
                minlength: 'Minimum 5 charaters vereist'
            },
            uiConfirmEmailAdress:{
                required: 'Verplicht veld',
                email: 'Ongeldig emailadres',
                equalTo: 'Veld is niet gelijk aan E-mailadres'
            },
            DDLanguage:{
                required: 'Verplicht veld'
            },
            Testveld:{
                required: 'Verplicht veld',
                regex: '_REGEX'
            }
        }
    });
}); 
```

确保正则表达式介于`/`:-)

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2017-11-07T17:03:45.393

您可以使用文件*`pattern`*中定义的*`additional-methods.js`*。注意这个additional-methods.js 文件必须*在*jQuery Validate 依赖之后包含，然后你就可以使用

```
$("#frm").validate({
    rules: {
        Textbox: {
            pattern: /^[a-zA-Z'.\s]{1,40}$/
        },
    },
    messages: {
        Textbox: {
            pattern: 'The Textbox string format is invalid'
        }
    }
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.17.0/jquery.validate.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.17.0/additional-methods.min.js"></script>
<form id="frm" method="get" action="">
    <fieldset>
        <p>
            <label for="fullname">Textbox</label>
            <input id="Textbox" name="Textbox" type="text">
        </p>
    </fieldset>
</form>
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2016-04-26T13:56:25.980

这是工作代码。

```
function validateSignup()
{   
    $.validator.addMethod(
            "regex",
            function(value, element, regexp) 
            {
                if (regexp.constructor != RegExp)
                    regexp = new RegExp(regexp);
                else if (regexp.global)
                    regexp.lastIndex = 0;
                return this.optional(element) || regexp.test(value);
            },
            "Please check your input."
    );

    $('#signupForm').validate(
    {

        onkeyup : false,
        errorClass: "req_mess",
        ignore: ":hidden",
        validClass: "signup_valid_class",
        errorClass: "signup_error_class",

        rules:
        {

            email:
            {
                required: true,
                email: true,
                regex: /^[A-Za-z0-9_]+\@[A-Za-z0-9_]+\.[A-Za-z0-9_]+/,
            },

            userId:
            {
                required: true,
                minlength: 6,
                maxlength: 15,
                regex: /^[A-Za-z0-9_]{6,15}$/,
            },

            phoneNum:
            {
                required: true,
                regex: /^[+-]{1}[0-9]{1,3}\-[0-9]{10}$/,
            },

        },
        messages: 
        {
            email: 
            {
                required: 'You must enter a email',
                regex: 'Please enter a valid email without spacial chars, ie, Example@gmail.com'
            },

            userId:
            {
                required: 'Alphanumeric, _, min:6, max:15',
                regex: "Please enter any alphaNumeric char of length between 6-15, ie, sbp_arun_2016"
            },

            phoneNum: 
            {
                required: "Please enter your phone number",
                regex: "e.g. +91-1234567890"    
            },

        },

        submitHandler: function (form)
        {
            return true;
        }
    });
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-04-02T14:34:14.137

我们主要使用 jquery 验证插件的标记符号，当正则表达式中存在标志时，发布的示例对我们不起作用，例如

```
<input type="text" name="myfield" regex="/^[0-9]{3}$/i" /> 
```

因此我们使用以下代码段

```
$.validator.addMethod(
        "regex",
        function(value, element, regstring) {
            // fast exit on empty optional
            if (this.optional(element)) {
                return true;
            }

            var regParts = regstring.match(/^\/(.*?)\/([gim]*)$/);
            if (regParts) {
                // the parsed pattern had delimiters and modifiers. handle them. 
                var regexp = new RegExp(regParts[1], regParts[2]);
            } else {
                // we got pattern string without delimiters
                var regexp = new RegExp(regstring);
            }

            return regexp.test(value);
        },
        "Please check your input."
); 
```

当然，现在可以将此代码与上述代码之一结合起来，以允许将 RegExp 对象传递到插件中，但由于我们不需要它，所以我们将这个练习留给读者 ;-)。

PS：还有一个捆绑插件，[https://github.com/jzaefferer/jquery-validation/blob/master/src/additional/pattern.js](https://github.com/jzaefferer/jquery-validation/blob/master/src/additional/pattern.js)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-06-01T08:17:22.417

这对我有用，是验证规则之一：

```
 Zip: {
                required: true,
                regex: /^\d{5}(?:[-\s]\d{4})?$/
            } 
```

希望能帮助到你

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-08-11T17:50:36.563

```
 $.validator.methods.checkEmail = function( value, element ) {
        return this.optional( element ) || /[a-z]+@[a-z]+\.[a-z]+/.test( value );
    }

    $("#myForm").validate({
        rules: {
            email: {
                required: true,
                checkEmail: true
            }
        },
        messages: {
            email: "incorrect email"
        }
    }); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-11-10T12:54:34.533

你试过这个吗？？

```
$("Textbox").rules("add", { regex: "^[a-zA-Z'.\\s]{1,40}$", messages: { regex: "The text is invalid..." } }) 
```

注意：确保通过在它们前面添加另一个“\”来转义你的正则表达式的所有“\”，否则正则表达式将无法按预期工作。

# coding-style - 文件名的定义？

> ID：280767
> 
> 赞同：7
> 
> 时间：2008-11-11T12:38:53.573
> 
> 标签：coding-style, filesystems, naming-conventions, terminology

经过多年的编程，仍然有一些简单的事情让我感到困惑。

是否有普遍认可的文件名定义？

甚至[维基百科的文章](http://en.wikipedia.org/wiki/Filename)也混淆了这两种解释。

它首先将其定义为“一种特殊的字符串，用于唯一标识存储在计算机文件系统上的文件”。这似乎很清楚，并表明文件名是完全限定的文件名，指定文件的完整路径。

然而，它接着是：

*   谈论基本名称和扩展名（所以基本名称将包含绝对路径？）
*   说DOS中文件名的长度限制为8.3
*   表示没有路径部分的文件名被假定为当前工作目录中的文件（因此文件名不能唯一标识文件）

所以，简单的问题：

*   什么是“文件名”的正确定义（包括参考）
*   我应该如何明确地命名变量：
    *   文件的路径（可以是绝对/完整或相对）
    *   可以是文件/目录/套接字的资源的路径

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-11T12:47:15.790

没有参考，只是经验的白话。当我具体时，我倾向于使用：

`path`或`filespec`（或文件规范）：标识文件系统上的文件所需的所有字符。路径可以是*绝对*路径（从*根目录*或最顶层目录开始）或*相对*路径（从当前活动目录开始）。

`filename`：标识当前目录中的文件所需的字符。

`extension`: 文件名末尾的字符，通常标识文件的*类型*。按照惯例，扩展名通常以点（“.”）开头，一个文件名可能包含多个扩展名。

`basename`：文件名直到（但不包括）开始第一个扩展名的点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T12:46:43.810

[File.getName() 方法的 Javadoc](http://java.sun.com/javase/6/docs/api/java/io/File.html#getName())

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T12:50:12.210

> file·name 也是文件名
> (fīl'nām') 发音键 n。赋予计算机文件以区别于其他文件的名称，通常包含按类型对其进行分类的扩展名。

[@字典网](http://dictionary.reference.com/browse/filename)

它指出文件名用于命名文件（就像您命名一个人一样）。并且它用于将其与其他文件区分开来。这不会告诉您它包含路径或其他文件系统强加的属性。该定义确实表明文件名*通常*具有扩展名。不过这个定义很仔细……（我觉得是好事）

所以..在你开始考虑路径等之前，你必须设置你的范围。你在一个unix世界吗？你在dos/windows世界吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T13:18:38.503

同样没有参考，但文件名规范取决于操作系统或更准确的文件系统。让我们从早期版本的 DOS（磁盘操作系统）开始。文件名是包含数字、字母、破折号和下划线的 8 个字符名称。它们后面是用于标识文件类型的三、二、一甚至零字符扩展名。一个点将名称与扩展名分开。该名称在目录中必须是唯一的。

您可以通过添加目录名称或一系列目录名称来扩展名称。斜线字符将目录名称与文件名分开。这通常被称为路径名。路径是相对于当前目录的。

最后，在 DOS 中，您可以包含驱动器名称。通常一个字母后跟一个 : 和一个斜杠（某些系统是两个斜杠）。将驱动器添加到路径使其成为绝对路径而不是相对路径。

今天，我们大多数人都使用不遵循旧的 8 字符点三字符模式的长文件名。仍然有许多文件系统保留了诸如名称之类的名称，并仅将长名称用作指向旧样式标识符的指针。

# sql - 从一个表中检索记录，只要它们不存在于另一个表中 T-SQL

> ID：280769
> 
> 赞同：2
> 
> 时间：2008-11-11T12:39:11.983
> 
> 标签：sql, sql-server

> **可能重复：**
> [NOT EXISTS vs. NOT IN vs. LEFT JOIN WHERE IS NULL 之间有什么区别？](https://stackoverflow.com/questions/2246772/whats-the-difference-between-not-exists-vs-not-in-vs-left-join-where-is-null)

我需要编写一个查询，该查询将从表 A 中检索记录，前提是表 A 中的键在表 B 中不存在。

任何帮助将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-11T12:44:18.587

```
select a.* 
from
    tableA a
    left join tableB b
        ON a.id = b.id
where
    b.id is null 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T12:42:54.957

```
SELECT *
FROM A
WHERE ID NOT IN
     (SELECT ID FROM B) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-09-23T06:55:24.160

如果键包含多列，则上述解决方案均无效。

如果表具有复合主键，则必须使用类似于下面的“NOT EXISTS”子句。

```
SELECT * 
  FROM TableA AS a 
 WHERE NOT EXISTS (
                   SELECT * 
                     FROM TableB b 
                    WHERE b.id1 = a.id1 
                          AND b.id2 = a.id2 
                          AND b.id3 = a.id3
                  ); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T12:48:41.277

使用左连接。数据库尝试使用 id 字段将数据集从 TableB 映射到 TableA。如果 TableB 中没有可用的拟合数据集，则 TableB 数据为 NULL。现在您只需检查 TableB.id 是否为 NULL。

```
SELECT TableA.* FROM TableA LEFT JOIN TableB ON TableA.id = TableB.id WHERE TableB.id IS NULL 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T12:43:16.530

假设：TableA 的 Id = Id TableB 的 Id = Id

```
select * from TableA ta where ta.Id not in (select Id from TableB) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T13:23:38.650

```
SELECT * FROM TableA
WHERE NOT Exists(SELECT * FROM TableB WHERE id=TableA.id) 
```

也有效，它几乎是自我记录......

# windows - 以编程方式抑制大容量存储设备的自动播放

> ID：280787
> 
> 赞同：4
> 
> 时间：2008-11-11T12:47:58.940
> 
> 标签：windows, autoplay

我需要禁止大容量存储设备的自动播放。这需要通过在后台运行的服务/守护程序以编程方式实现。

我知道它可以通过打开一个窗口并处理窗口发送的“queryCancelAutoPlay”消息的应用程序来完成。

这可以在没有 GUI 的情况下完成吗？我有需要禁用自动播放的设备的 guid/pid/vid。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T13:12:54.520

当然。您可以创建一个仅消息窗口。这给了你一个没有那些烦人的 WM_PAINT 消息等的 HWND。另一种方法是使用 COM，[IQueryCancelAutoplay](http://msdn.microsoft.com/en-us/library/bb761373.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T13:00:29.257

有一个注册表项控制自动运行：

```
HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer 
```

这可以设置为在特定设备类型上禁用自动运行，来自[technet](http://www.microsoft.com/technet/prodtechnol/windows2000serv/reskit/regentry/93502.mspx?mfr=true)：

```
NoDriveTypeAutoRun

Value   Meaning
0x1     Disables Autoplay on drives of unknown type.
0x4     Disables Autoplay on removable drives.
0x8     Disables Autoplay on fixed drives.
0x10    Disables Autoplay on network drives.
0x20    Disables Autoplay on CD-ROM drives.
0x40    Disables Autoplay on RAM drives.
0x80    Disables Autoplay on drives of unknown type.
0xFF    Disables Autoplay on all types of drives. 
```

# css - 如何修改 Sharepoint 网站的外观？

> ID：280789
> 
> 赞同：2
> 
> 时间：2008-11-11T12:48:17.300
> 
> 标签：css, sharepoint, look-and-feel, branding

我不知何故在工作中部署了 SharePoint。我讨厌它，即使是最简单的事情也似乎是不必要的困难。

我已经看到一些资源分散在各处，但它们似乎都无法帮助我真正控制 css。

有人可以指出我正确的方向吗？

**编辑**

*   我不害怕 CSS 本身，我只是似乎找不到合适的地方来编辑它。
*   我有 SharePoint Designer 2007

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T12:52:14.937

SharePoint 将此通用功能称为“品牌”——如果您搜索 SharePoint 品牌，您会发现很多资源。这个看起来不错：

[http://www.heathersolomon.com/blog/articles/brandsppart1.aspx](http://www.heathersolomon.com/blog/articles/brandsppart1.aspx)

# javascript - JavaScript中不区分大小写的字符串替换？

> ID：280793
> 
> 赞同：54
> 
> 时间：2008-11-11T12:49:01.713
> 
> 标签：javascript, string, replace, case-insensitive

我需要不区分大小写地突出显示 JavaScript 字符串中的给定关键字。

例如：

*   `highlight("foobar Foo bar FOO", "foo")`应该返回`"<b>foo</b>bar <b>Foo</b> bar <b>FOO</b>"`

我需要代码适用于任何关键字，因此使用硬编码的正则表达式就像`/foo/i`不是一个足够的解决方案。

最简单的方法是什么？

（这是标题中详述的更普遍问题的一个例子，但我觉得最好用一个具体的、有用的例子来解决。）

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-11-11T12:54:48.690

如果您准备搜索字符串，则*可以*使用正则表达式。例如，在 PHP 中有一个函数 preg_quote，它将字符串中的所有正则表达式字符替换为其转义版本。

这是 javascript ( [source](https://locutus.io/php/pcre/preg_quote/) ) 的这样一个函数：

```
function preg_quote (str, delimiter) {
  //  discuss at: https://locutus.io/php/preg_quote/
  // original by: booeyOH
  // improved by: Ates Goral (https://magnetiq.com)
  // improved by: Kevin van Zonneveld (https://kvz.io)
  // improved by: Brett Zamir (https://brett-zamir.me)
  // bugfixed by: Onno Marsman (https://twitter.com/onnomarsman)
  //   example 1: preg_quote("$40")
  //   returns 1: '\\$40'
  //   example 2: preg_quote("*RRRING* Hello?")
  //   returns 2: '\\*RRRING\\* Hello\\?'
  //   example 3: preg_quote("\\.+*?[^]$(){}=!<>|:")
  //   returns 3: '\\\\\\.\\+\\*\\?\\[\\^\\]\\$\\(\\)\\{\\}\\=\\!\\<\\>\\|\\:'

  return (str + '')
    .replace(new RegExp('[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\' + (delimiter || '') + '-]', 'g'), '\\$&')
} 
```

因此，您可以执行以下操作：

```
function highlight(str, search) {
    return str.replace(new RegExp("(" + preg_quote(search) + ")", 'gi'), "<b>$1</b>");
} 
```

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2008-11-11T13:06:44.033

```
function highlightWords( line, word )
{
     var regex = new RegExp( '(' + word + ')', 'gi' );
     return line.replace( regex, "<b>$1</b>" );
} 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-11T14:07:47.717

您可以使用为您执行特殊字符转义的函数来增强 RegExp 对象：

```
RegExp.escape = function(str) 
{
  var specials = /[.*+?|()\[\]{}\\$^]/g; // .*+?|()[]{}\$^
  return str.replace(specials, "\\$&");
} 
```

然后您就可以毫无顾虑地使用其他人的建议：

```
function highlightWordsNoCase(line, word)
{
  var regex = new RegExp("(" + RegExp.escape(word) + ")", "gi");
  return line.replace(regex, "<b>$1</b>");
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-11T13:15:49.757

只要关键字是真正的单词，正则表达式就可以了，您可以只使用 RegExp 构造函数而不是文字来从变量创建一个：

```
var re= new RegExp('('+word+')', 'gi');
return s.replace(re, '<b>$1</b>'); 
```

如果“关键字”可以包含标点符号，则会出现困难，因为标点符号在正则表达式中往往具有特殊含义。不幸的是，与大多数其他支持正则表达式的语言/库不同，JavaScript 中没有标准的函数来转义正则表达式的标点符号。

而且您不能完全确定哪些字符需要转义，因为并非每个浏览器的正则表达式实现都保证完全相同。（特别是，较新的浏览器可能会添加新功能。）不特殊的反斜杠转义字符不能保证仍然有效，尽管实际上它确实有效。

因此，您能做的最好的事情之一是：

*   试图捕捉当今常用浏览器中的每个特殊字符 [添加：参见塞巴斯蒂安的食谱]
*   反斜杠转义所有非字母数字。关心：\W 也将匹配非 ASCII Unicode 字符，这是您并不真正想要的。
*   只需确保在搜索之前关键字中没有非字母数字

但是，如果您使用它来突出显示 HTML 中已经包含标记的单词，那么您就有麻烦了。您的“单词”可能出现在元素名称或属性值中，在这种情况下，尝试将 < b> 包裹在它周围会导致损坏。在更复杂的情况下，甚至可能是对 XSS 安全漏洞的 HTML 注入。如果您必须处理标记，您将需要一种更复杂的方法，将 '< ... >' 标记，然后再尝试单独处理每段文本。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-09-14T20:00:26.270

像这样的东西怎么样：

```
if(typeof String.prototype.highlight !== 'function') {
  String.prototype.highlight = function(match, spanClass) {
    var pattern = new RegExp( match, "gi" );
    replacement = "<span class='" + spanClass + "'>$&</span>";

    return this.replace(pattern, replacement);
  }
} 
```

然后可以这样调用：

```
var result = "The Quick Brown Fox Jumped Over The Lazy Brown Dog".highlight("brown","text-highlight"); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-02-14T00:02:38.140

对于那些患有失调症或正则恐惧症的穷人：

```
function replacei(str, sub, f){
	let A = str.toLowerCase().split(sub.toLowerCase());
	let B = [];
	let x = 0;
	for (let i = 0; i < A.length; i++) {
		let n = A[i].length;
		B.push(str.substr(x, n));
		if (i < A.length-1)
			B.push(f(str.substr(x + n, sub.length)));
		x += n + sub.length;
	}
	return B.join('');
}

s = 'Foo and FOO (and foo) are all -- Foo.'
t = replacei(s, 'Foo', sub=>'<'+sub+'>')
console.log(t)
```

输出：

```
<Foo> and <FOO> (and <foo>) are all -- <Foo>. 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T12:59:41.317

为什么不在每次调用您的函数时创建一个新的正则表达式？您可以使用：

```
new Regex([pat], [flags]) 
```

其中 [pat] 是模式的字符串，[flags] 是标志。

# python - 计算泊松概率百分比

> ID：280797
> 
> 赞同：16
> 
> 时间：2008-11-11T12:51:43.533
> 
> 标签：python, statistics, poisson

在 Excel（或 OpenOffice Calc）中使用 POISSON 函数时，它需要两个参数：

*   一个整数
*   一个“平均”数字

并返回一个浮点数。

在 Python 中（我尝试了 RandomArray 和 NumPy），它返回一个随机泊松数数组。我真正想要的是这个事件将发生的百分比（它是一个常数，并且数组每次都有不同的数字 - 所以它是一个平均值吗？）。

例如：

```
print poisson(2.6,6) 
```

返回`[1 3 3 0 1 3]`（并且每次我运行它时，都会有所不同）。

我从 calc/excel 得到的数字是 3.19 ( `POISSON(6,2.16,0)*100`)。

我使用 python 的泊松是错误的（没有双关语！）还是我错过了什么？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-11-11T13:17:55.417

`scipy`有你想要的

```
>>> scipy.stats.distributions
<module 'scipy.stats.distributions' from '/home/coventry/lib/python2.5/site-packages/scipy/stats/distributions.pyc'>
>>> scipy.stats.distributions.poisson.pmf(6, 2.6)
array(0.031867055625524499) 
```

值得注意的是，手动计算也很[容易](http://www.scipy.org/doc/api_docs/SciPy.stats.distributions.html#poisson)。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-11T13:24:40.860

手工很容易做到，但你可以这样做。您可以在循环中执行指数和阶乘以避免溢出：

```
def poisson_probability(actual, mean):
    # naive:   math.exp(-mean) * mean**actual / factorial(actual)

    # iterative, to keep the components from getting too large or small:
    p = math.exp(-mean)
    for i in xrange(actual):
        p *= mean
        p /= i+1
    return p 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T13:12:40.667

[这个页面](http://numpy.sourceforge.net/numdoc/HTML/numdoc.htm#pgfId-305426)解释了为什么你得到一个数组，以及其中数字的含义，至少。

# php - 有没有办法将数组绑定到 mysqli 准备

> ID：280798
> 
> 赞同：1
> 
> 时间：2008-11-11T12:51:52.177
> 
> 标签：php, mysql, stored-procedures, mysqli

我正在尝试创建一个类，该类将执行具有任意数量变量的多个存储过程中的任何一个

我使用 php 和 mysqli

*   我的类枚举一个数组并根据元素的数量构造一个字符串（如果有）
*   `CALL spTestLogin(?,?)`例如给出这样的东西
*   我现在需要使用这样的东西来绑定我的数组中的输入：

    $stmt->bind_param($this->paramTypes,$this->paramValues);//paramValues 是我的数组

然后，如果可行，我可以努力获得我的结果

有任何想法吗

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T13:10:30.453

你必须做这样的事情：

```
$params=array_merge(
    array($this->paramTypes), 
    $this->paramValues
);
call_user_func_array(array($stmt, 'bind_param'), $params); 
```

假设这`$this->paramTypes`是一个格式为所需的字符串`mysqli_stmt::bind_param`- 如果不是，则必须先创建此`string`参数。

我不知道在这种情况下参数是否有效`out`。`inout`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T13:22:42.863

`mysqli_stmt::bind_param()`将采用可变数量的参数

假设`$this->paramTypes`也是一个数组，为每个变量（'i'，'d'，'s'，'b'之一）保存正确的类型字符，你可以做类似的事情

```
$params = $this->paramValues;
array_unshift($params, implode($this->paramTypes));
call_user_func_array( array( $stmt, 'bind_param' ), $params); 
```

本质上，您创建了一个通常传递给 bind_param() 的参数数组，然后使用`call_user_func_array()`

可能有更好的方法来做到这一点

**编辑**：刚刚意识到我在写这篇文章时被打败了，我现在把这个答案留在这里，以防万一

# windows - Windows 上的 Ruby 脚本

> ID：280801
> 
> 赞同：-1
> 
> 时间：2008-11-11T12:52:34.513
> 
> 标签：windows, ruby, scripting, odbc, exchange-server

> **可能重复：**
> [您更喜欢哪种 Ruby IDE？](https://stackoverflow.com/questions/16991/what-ruby-ide-do-you-prefer)

我正在Windows 2003 服务器上使用 ruby​​ 制作一个**简单的脚本。**我的问题是：

*   如何通过 ODBC 连接到数据库？我将连接到**Solaris**和**MSSQL Server**上的 Sybase 。
*   如何通过 Exchange Server 2003 发送电子邮件？

* * *

## 更新

*   用于 Ruby 脚本的最佳简单 IDE 是什么？我目前使用 SciTE（Ruby 自带）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T13:23:29.880

有一个用于[Ruby DBI 模块](http://ruby-dbi.rubyforge.org/)的 ODBC 包，或者您可以尝试使用[Ruby 的 ODBC 绑定](http://www.ch-werner.de/rubyodbc/)，它还包括一个 Win32 二进制文件。

这是一个使用 RDI 的示例（从[此处](http://www.ruby-forum.com/topic/64065)窃取）：

```
require 'DBI'

# make an ODBC connection
conn = DBI.connect('DBI:ODBC:datasource','your_username','your_password')

# returns a list of the table names from your database
conn.tables

# returns an array with the resultset from your query
rs = conn.select_all('SELECT * FROM TheTable') 
```

*（可以使用通过控制面板/管理工具提供的 ODBC 管理器来定义 ODBC 数据源。）*

对于电子邮件，我建议您简单地使用 Ruby 的[标准邮件功能](http://www.ruby-doc.org/stdlib/libdoc/net/smtp/rdoc/index.html)并通过 SMTP 连接到您的 Exchange Server。

不过，我不能向您推荐 Ruby IDE，因为我使用 VIM 进行文本编辑。:-) 其他人可能会给你一个提示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T13:28:49.713

对于 Ruby IDE，请尝试使用 NetBeans。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-12T19:43:48.613

对于简单但功能强大的[在 windows 上使用 ado 和 ruby](http://rubyonwindows.blogspot.com/2007/03/ruby-ado-and-sqlserver.html) ​​。这是一个非常好的示例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-12T22:13:04.397

请注意，Ruby 的一键式安装程序中包含的 ODBC 驱动程序似乎不支持 Unicode。（从 Unix 访问 SQL Server 数据库，在从 UnixODBC 获取它之前，我使用 FreeTDS 将 UTF-16 转换为 UTF-8。）我无法在 Windows 中进行类似的转换。

# windows - 用于获取屏幕区域更改的 API？

> ID：280808
> 
> 赞同：6
> 
> 时间：2008-11-11T12:57:29.183
> 
> 标签：windows, winapi, image-capture

我正在为 Windows 编写一种屏幕录制应用程序，并希望知道屏幕/活动窗口的何时以及哪些区域发生了变化。

是否有我可以挂钩的 Windows API 以获取屏幕更改的通知？

还是我需要手动编写这样的[东西](https://stackoverflow.com/questions/76651/)？:(

我一直认为远程桌面使用某种 API 来检测屏幕的哪些区域发生了变化，并且只发回那些图像——这正是我需要的行为。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-14T14:03:07.407

我认为 Windows 中没有 API 可以告诉您屏幕的哪些部分发生了变化。

一种可能的方法是使用UltraVNC 之类的[视频镜像驱动程序。](http://www.uvnc.com/features/driver.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-15T15:38:56.200

我想你会在这里找到一些线索[Screen Event Recorder DLL/Application](http://www.codeproject.com/KB/DLL/eventrecorder.aspx)，在这里[About Hooks](http://msdn.microsoft.com/en-us/library/ms644959(VS.85).aspx)和在这里[Writing a Macro Recorder/Player using Win32 Journal Hooks](http://www.codeproject.com/KB/applications/winmacro.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-27T12:55:00.563

看起来您将不得不做一些工作来检测屏幕变化。例如，此帖子在[tech-archive.net](http://www.tech-archive.net/Archive/Development/microsoft.public.win32.programmer.gdi/2005-02/0231.html)上。有了这个，您可以将一个参考屏幕复制到 RAM，然后再拿一个并比较两者。由你来定义什么样的改变是有意义的。它与这篇关于[桌面捕获](http://www.eggheadcafe.com/software/aspnet/30134471/desktop-capture.aspx)的文章类似。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T13:16:59.770

我认为远程桌面像命令一样流式传输 GDI。我不知道他们最初是如何捕获它们的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-01T22:25:05.017

谢谢大家的帮助。我最终编写了一个图像差分类，它似乎以惊人的速度计算出改变的矩形。[我已经在这里](https://stackoverflow.com/questions/76651/dirty-rectangles#322354)发布了它的工作原理。

目前我只是在计时器中执行此操作，但也计划在输入事件后执行此操作。

非常感谢您的链接 Boost - 我刚刚再次查看了这个线程，所以我会尽快查看它们。

# asp.net - 如何在 ASP.Net 中将 HTML 页面转换为图像格式

> ID：280817
> 
> 赞同：1
> 
> 时间：2008-11-11T13:03:24.743
> 
> 标签：asp.net

如何在 Web 应用程序中将 HTML 页面转换为图像格式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T13:59:06.393

如果您尝试能够在 ASP.NET 应用程序中动态地从网页中创建图像，您可以尝试使用[ABC PDF](http://www.websupergoo.com/abcpdf-1.htm)。我们使用他们的产品真的很幸运，而且非常合理。您可以将 html/网页保存为 PDF、JPEG 和许多其他文件格式。

# .net - 从 .Net 枚举另一个应用程序的 Windows/控件

> ID：280818
> 
> 赞同：3
> 
> 时间：2008-11-11T13:03:52.230
> 
> 标签：.net, automation

我正在开发一个小型实用程序应用程序，它需要检测另一个是否打开了它的一个 MDI 子窗口（它是一个现成的 Win32 业务应用程序，我既没有源代码也没有控制权）。从我的应用程序中，我希望能够轮询或检测特定 MDI 子窗口何时打开。

在.Net 中，很容易迭代正在运行的进程，但我还没有找到一种简单的方法来从.Net 中迭代给定Win32 进程的（子）窗口和控件。

有任何想法吗？

**更新**
感谢他们让我走上正确道路的答案。
我发现[一篇带有测试项目](http://www.vbaccelerator.com/home/NET/Code/Libraries/Windows/Enumerating_Windows/article.asp)的文章，该项目同时使用`EnumWindows`和`EnumChidWindows`其他 API 调用来获取有关控件的扩展信息。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T13:31:53.593

您必须使用本机 Win32 API。

[EnumChildWindows (user32)](http://www.pinvoke.net/default.aspx/user32/EnumChildWindows.html)

 `````
[DllImport("user32")]

[return: MarshalAs(UnmanagedType.Bool)]
public static extern bool EnumChildWindows(IntPtr window, EnumWindowProc callback, IntPtr i);

/// <summary>
/// Returns a list of child windows
/// </summary>
/// <param name="parent">Parent of the windows to return</param>
/// <returns>List of child windows</returns>
public static List<IntPtr> GetChildWindows(IntPtr parent)
{
List<IntPtr> result = new List<IntPtr>();
GCHandle listHandle = GCHandle.Alloc(result);
try
{
    EnumWindowProc childProc = new EnumWindowProc(EnumWindow);
    EnumChildWindows(parent, childProc, GCHandle.ToIntPtr(listHandle));
}
finally
{
    if (listHandle.IsAllocated)
    listHandle.Free();
}
return result;
}

/// <summary>
/// Callback method to be used when enumerating windows.
/// </summary>
/// <param name="handle">Handle of the next window</param>
/// <param name="pointer">Pointer to a GCHandle that holds a reference to the list to fill</param>
/// <returns>True to continue the enumeration, false to bail</returns>
private static bool EnumWindow(IntPtr handle, IntPtr pointer)
{
GCHandle gch = GCHandle.FromIntPtr(pointer);
List<IntPtr> list = gch.Target as List<IntPtr>;
if (list == null)
{
    throw new InvalidCastException("GCHandle Target could not be cast as List<IntPtr>");
}
list.Add(handle);
//  You can modify this to check to see if you want to cancel the operation, then return a null here
return true;
}

/// <summary>
/// Delegate for the EnumChildWindows method
/// </summary>
/// <param name="hWnd">Window handle</param>
/// <param name="parameter">Caller-defined variable; we use it for a pointer to our list</param>
/// <returns>True to continue enumerating, false to bail.</returns>
public delegate bool EnumWindowProc(IntPtr hWnd, IntPtr parameter); 
````  `* * *

## 回答 #2

> 赞同：2
> 
> 时间：2017-04-21T11:21:39.693

这是一个老帖子，但一个常见的问题。我有类似的情况，我试图控制现成软件应用程序的行为。我主要通过使用 Kixstart 成功，但遇到了使用 SETFOCUS 和 SENDKEYS 的限制，因为在某些时候，现成的软件会显示 WindowTitle 为空白的窗口。因此，我开发了一个小实用程序，它通过 ProcessName 和 WindowTitle（或缺少）来识别可见的 Windows，并发送一条消息以关闭匹配的窗口。

我见过的大多数 EnumWindows 回调函数示例都会忽略不可见或具有空白标题的窗口，而此代码会枚举所有窗口，包括不可见的窗口。

此代码是 Visual Basic 并使用格式为的配置文件

```
PRC=process name
WIN=window title 
```

希望这对某人有用

```
Imports System
Imports System.IO
Imports System.Runtime.InteropServices
Imports System.Text
Module Module1
    Dim hShellWindow As IntPtr = GetShellWindow()
    Dim dictWindows As New Dictionary(Of IntPtr, String)
    Dim dictChildWindows As New Dictionary(Of IntPtr, String)
    Dim currentProcessID As Integer = -1
    <DllImport("USER32.DLL")>
    Function GetShellWindow() As IntPtr
    End Function
    <DllImport("USER32.DLL")>
    Function GetForegroundWindow() As IntPtr
    End Function
    <DllImport("USER32.DLL")>
    Function GetWindowText(ByVal hWnd As IntPtr, ByVal lpString As StringBuilder, ByVal nMaxCount As Integer) As Integer
    End Function
    <DllImport("USER32.DLL")>
    Function GetWindowTextLength(ByVal hWnd As IntPtr) As Integer
    End Function
    <DllImport("user32.dll", SetLastError:=True)>
    Function GetWindowThreadProcessId(ByVal hWnd As IntPtr, <Out()> ByRef lpdwProcessId As UInt32) As UInt32
    End Function
    <DllImport("USER32.DLL")>
    Function IsWindowVisible(ByVal hWnd As IntPtr) As Boolean
    End Function
    Delegate Function EnumWindowsProc(ByVal hWnd As IntPtr, ByVal lParam As Integer) As Boolean
    <DllImport("USER32.DLL")>
    Function EnumWindows(ByVal enumFunc As EnumWindowsProc, ByVal lParam As Integer) As Boolean
    End Function
    <DllImport("USER32.DLL")>
    Function EnumChildWindows(ByVal hWndParent As System.IntPtr, ByVal lpEnumFunc As EnumWindowsProc, ByVal lParam As Integer) As Boolean
    End Function
    <DllImport("USER32.DLL")>
    Function PostMessage(ByVal hwnd As Integer, ByVal message As UInteger, ByVal wParam As Integer, ByVal lParam As Integer) As Boolean
    End Function
    <DllImport("USER32.DLL")>
    Function SendMessage(ByVal hWnd As IntPtr, ByVal Msg As UInteger, ByVal wParam As IntPtr, ByVal lParam As IntPtr) As IntPtr
    End Function

    Function enumWindowsInternal(ByVal hWnd As IntPtr, ByVal lParam As Integer) As Boolean
        Dim a As String = ""
        Dim length As Integer = GetWindowTextLength(hWnd)
        If (length > 0) Then
            Dim stringBuilder As New System.Text.StringBuilder(length)
            GetWindowText(hWnd, stringBuilder, (length + 1))
            a = stringBuilder.ToString
        End If
        dictWindows.Add(hWnd, a)
        EnumChildWindows(hWnd, AddressOf enumChildWindowsInternal, 0)
        Return True
    End Function
    Function enumChildWindowsInternal(ByVal hWnd As IntPtr, ByVal lParam As Integer) As Boolean
        Dim a As String = ""
        Dim length As Integer = GetWindowTextLength(hWnd)
        If (length > 0) Then
            Dim stringBuilder As New System.Text.StringBuilder(length)
            GetWindowText(hWnd, stringBuilder, (length + 1))
            a = stringBuilder.ToString
        End If
        dictChildWindows.Add(hWnd, a)
        Return True
    End Function
    Function cleanstring(ByVal a As String) As String
        Dim c As String = ""
        Dim b As String = ""
        Dim i As Integer
        Do While i < Len(a)
            i = i + 1
            c = Mid(a, i, 1)
            If Asc(c) > 31 And Asc(c) < 128 Then
                b = b & c
            End If
        Loop
        cleanstring = b
    End Function
    Sub Main()
        '
        '
        Dim a As String = ""
        Dim b As String = ""
        Dim c As String = ""
        Dim d As String = ""
        Dim f As String = "C:\FIS5\WK.txt"
        Dim a1 As String = ""
        Dim a2 As String = ""
        Dim p As Process
        Dim windows As IDictionary(Of IntPtr, String)
        Dim kvp As KeyValuePair(Of IntPtr, String)
        Dim windowPid As UInt32
        Dim hWnd As IntPtr
        Dim fhWnd As IntPtr
        Dim WM_CLOSE As UInteger = &H12
        Dim WM_SYSCOMMAND As UInteger = &H112
        Dim SC_CLOSE As UInteger = &HF060
        Dim x As Boolean = True
        Dim y As IntPtr
        Dim processes As Process() = Process.GetProcesses
        Dim params As String = File.ReadAllText("C:\FIS5\WindowKiller.txt")
        Dim words As String() = params.Split(vbCrLf)
        Dim word As String
        Dim myprocname As String = ""
        Dim mywinname As String = ""
        Dim i As Integer = 0
        Dim v1 As Integer = 0
        For Each word In words
            word = Trim(cleanstring(word)).ToUpper
            i = InStr(word, "=", CompareMethod.Text)
            ' a = a & word & " " & i.ToString & vbCrLf
            If i = 4 And 4 < Len(word) Then
                If Left(word, 4) = "PRC=" Then
                    myprocname = Mid(word, 5)
                End If
                If Left(word, 4) = "WIN=" Then
                    mywinname = Mid(word, 5)
                End If
            End If
        Next
        a = a & params & vbCrLf & "procname=" & myprocname & ", winname=" & mywinname & vbCrLf
        fhWnd = GetForegroundWindow()
        dictWindows.Clear()
        dictChildWindows.Clear()
        EnumWindows(AddressOf enumWindowsInternal, 0)
        windows = dictChildWindows
        For Each kvp In windows
            hWnd = kvp.Key
            GetWindowThreadProcessId(hWnd, windowPid)
            b = ""
            c = ""
            For Each p In processes
                If p.Id = windowPid Then
                    b = p.ProcessName
                    c = p.Id.ToString
                End If
            Next
            d = "hidden"
            If IsWindowVisible(hWnd) Then
                d = "visible"
            End If
            If hWnd = fhWnd Then
                d = d & ", foreground"
            End If
            a = a & "Child window=" & hWnd.ToString & ", processname=" & b & ", procid=" & c & ", windowname=" & kvp.Value & ", " & d & vbCrLf
        Next
        windows = dictWindows
        For Each kvp In windows
            v1 = 0
            hWnd = kvp.Key
            GetWindowThreadProcessId(hWnd, windowPid)
            b = ""
            c = ""
            For Each p In processes
                If p.Id = windowPid Then
                    b = p.ProcessName
                    c = p.Id.ToString
                End If
            Next
            d = "hidden"
            If IsWindowVisible(hWnd) Then
                d = "visible"
                v1 = 1
            End If
            If hWnd = fhWnd Then
                d = d & ", foreground"
            End If
            word = kvp.Value
            a = a & "Window=" & hWnd.ToString & ", processname=" & b & ", procid=" & c & ", windowname=" & word & ", " & d & vbCrLf
            If Trim(cleanstring(b).ToUpper) = myprocname Then
                a = a & "procname match" & vbCrLf
                If Trim(cleanstring(word)).ToUpper = mywinname And v1 <> 0 Then
                    a = a & "ATTEMPTING To CLOSE: " & b & " # " & word & " # " & c & vbCrLf
                    ' x = PostMessage(hWnd, WM_CLOSE, 0, 0)
                    'If x Then
                    'a = a & "PostMessage returned True" & vbCrLf
                    'Else
                    'a = a & "PostMessage returned False" & vbCrLf
                    'End If
                    y = SendMessage(hWnd, WM_SYSCOMMAND, SC_CLOSE, 0)
                    a = a & "SendMessage returned " & y.ToString & vbCrLf
                End If
            End If
        Next
        My.Computer.FileSystem.WriteAllText(f, a, False)
    End Sub
End Module 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T13:26:38.813

您可以使用 P/Invoke 访问 EnumWindows 和 EnumChidWindows 以遍历任何窗口的子窗口/控件。

# wcf - WCF - 我如何加密消息？

> ID：280819
> 
> 赞同：6
> 
> 时间：2008-11-11T13:04:43.680
> 
> 标签：wcf, wcf-encryption

我的 WCF 服务涉及在客户端和服务之间发送数据集（csv 格式）数据。此数据集必须加密，以免数据被截获。我正在使用 wshttpbinding 并尝试使用 web.config 中的以下设置来加密消息：

```
<wsHttpBinding>
  <binding name="wsHttp">
    <reliableSession enabled="true" /> 
    <security mode="Message">
      <message clientCredentialType="UserName" algorithmSuite="TripleDes" />
    </security>
  </binding>
</wsHttpBinding> 
```

当我尝试生成客户端代理时，我收到一个很长的错误消息框（无法完全阅读，因为它超出了屏幕底部！）。该错误消息确实提到了有关“未提供服务证书”的内容。

如何加密消息？我需要证书吗？我应该提到，这项服务将在不同域的互联网上使用，所以我不确定使用“用户名”安全性是否是最佳选择（？）

基本上我很困惑！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-11T13:38:43.547

是的，您的服务需要证书才能安全地交换您的加密密钥。您可以使用 makecert.exe 创建测试服务身份验证证书。有关详细信息，请参阅[我的博客中的此条目](http://web.archive.org/web/20070306040207/http://martinparry.com/cs/blogs/mparry_software/archive/2006/10/30/97.aspx)。

您还需要确保您的服务正在运行的帐户能够读取证书的私钥文件。如果您使用的是 Windows Vista（或更高版本），则证书 MMC 管理单元允许您控制对该私钥的权限，但对于早期版本的 Windows，这有点困难。我曾经使用 WSE3 附带的实用程序，但其他人可能会提出更直接的方法。除非您的服务以管理员身份运行，否则您很可能必须调整这些权限。

更新：像所有好事一样，我的博客结束了。感谢 makerofthings7 提醒我。生成服务认证证书所需的 makecert 命令是这样的......

```
makecert -sr LocalMachine -ss My -pe -n CN=subject-name -eku 1.3.6.1.5.5.7.3.1 -sky exchange 
```

...只需将*主题名称*替换为对您的服务有意义的任何证书名称。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T13:44:24.567

@Martin 是对的，您需要服务器上的证书。[此链接](http://msdn.microsoft.com/en-us/library/ms731058.aspx)很好地概述了基于消息的安全性的通信流程，并提供了示例代码。[此链接](http://weblogs.asp.net/cibrax/archive/2006/08/08/Creating-X509-Certificates-for-WSE-or-WCF.aspx)很好地概述了使用证书。

对于您的身份验证要求，[此链接](http://blogs.msdn.com/pedram/archive/2007/10/05/wcf-authentication-custom-username-and-password-validator.aspx)查看可用的各种选项。如果您是 WCF 新手，那么学习 WCF：Michele Bustamante 的动手指南是一本好书，涵盖了基于消息的安全性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-24T16:29:46.577

我仍在努力寻找解决这个问题的方法。我也有，但要签署一个xml。仍然要在 WinXP 中找到用户 IIS 开始 > 右键单击​​我的电脑 > 管理 > 服务和应用程序 > 服务 > IIS 管理员 > 双击并在登录选项卡中通常会显示本地系统。

编辑

好的，这就是我解决问题的方法。我有一个证书，我使用这篇[文章](http://www.digwin.com/view/howto-use-makecert-for-trusted-root-certification-authority-and-ssl-certificate-issuance) 来制作证书。如果项目是保存到 C 文件夹的 ASPWebSite，则您可能不会遇到此问题。但是，如果它作为 HTTP 项目保存到 IIS，那么您将遇到问题。

经过数周的调查后解决它的方法并不难。Microsoft 有一个叫做 Web Services Enhancements 的东西，您将下载最新的，但我使用的是第二个带有最新服务包的东西。当我安装时，我启用了一切。

证书可以在物理文件中，但它们通常在证书管理存储中，使用 WSE 2.0 中的工具 X509 证书工具来获取它。在这里通过在不同的部分中查找它来打开您的证书，直到找到它。然后打开它，在底部会有一个查看私钥，在安全选项卡中添加 LOCALHOST\ASPNET 。这应该使您的网站能够读取证书。

简而言之，当您创建公钥和私钥时，虽然您可能会看到私钥很好，但实际上它会发送到文件系统中的 Timbuktu，您需要找到它以添加 ASPNET 帐户以进行读取访问。我正在阅读比在 Vista 中这要容易得多，但我使用的是 XP。

# sql - 来自两个表的 SQL 语句

> ID：280834
> 
> 赞同：1
> 
> 时间：2008-11-11T13:14:38.480
> 
> 标签：sql, ms-access

我想知道是否可以从一个表中选择某些列，从第二个表中选择另一列，这与第一个表中的非导入列有关。我必须从访问中获取这些数据，并且不知道这是否可以通过 Access 或一般的 SQL 来实现。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T13:19:30.437

假设如下表结构：

```
CREATE TABLE tbl_1 (
    pk_1 int,
    field_1 varchar(25),
    field_2 varchar(25)
);

CREATE TABLE tbl_2 (
    pk_2 int,
    fk_1 int,
    field_3 varchar(25),
    field_4 varchar(25)
); 
```

您可以使用以下内容：

```
SELECT t1.field_1, t2.field_3
FROM tbl_1 t1
INNER JOIN tbl_2 t2 ON t1.pk_1 = t2.fk_1
WHERE t2.field_3 = "Some String" 
```

关于 Bill 的帖子，有两种方法可以在 SQL 查询中创建 JOIN：

*   隐式 - 使用查询的 WHERE 子句创建连接，在 FROM 子句中指定了多个表

*   显式 - 使用适当类型的 JOIN 子句（INNER、LEFT、RIGHT、FULL）创建连接

始终建议您使用显式 JOIN 语法，因为一旦查询变得更复杂，隐式连接就会出现问题。

例如，如果您稍后将显式连接添加到已使用隐式连接的查询，该连接与 FROM 子句中引用的多个表，则 FROM 子句中引用的第一个表对显式连接的表不可见。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T13:17:56.927

您正在寻找的是 JOIN：

[http://en.wikipedia.org/wiki/Join_(SQL)](http://en.wikipedia.org/wiki/Join_(SQL))

您需要第一个表中引用的数据集和外键的主键。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T13:20:58.200

我不是 100% 确定我理解你的问题。

以下是否属实：

您的第一个表是从其他地方导入的。您只导入一些列。您想要构建一个引用您尚未导入的列的查询。

如果这是真的，那是不可能的。就所涉及的 Access 查询引擎而言，不存在未导入的列。

为什么不直接导入它们呢？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T13:22:18.887

但是主键使查询更高效

# algorithm - Delphi 2009 之前的键/值对的最佳算法，其中键是 int64？

> ID：280838
> 
> 赞同：1
> 
> 时间：2008-11-11T13:15:51.083
> 
> 标签：algorithm, delphi, data-structures

我需要一种算法来存储键/值对，其中键是 Int64。我目前正在使用排序的 IntList（与 TStringList 相同，但存储 int64s）。这给了我 O(log n) 的搜索、插入和删除操作。由于我不需要排序的项目，这有点低效。我需要某种用于 O(1) 操作的哈希表。问题是我能找到的大多数实现都假设键是一个字符串。现在我显然可以将 Int64 键转换为字符串，但这似乎很浪费。有任何想法吗？

在将它们输入数据结构之前，我不知道项目的数量。

我还应该补充一点，我已经在 .net 中使用 Dictionary 实现了相同的组件，并且它添加的项目在 .net 版本中要快得多。一旦设置了数据结构，比较起来遍历和检索并没有那么糟糕，但是插入让我很生气。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-03-31T21:18:06.073

Delphi 2009 及更高版本添加了泛型。

因此，从 Delphi 2009 开始，您可以使用 TDICTIONARY 以与在 .NET 中类似的方式实现键/值对。

Delphi 中的 TDICTIONARY 使用哈希表并具有 O(1) 操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T13:50:42.447

您可以构建一个哈希表，其中哈希值是您添加到哈希中的 Int64 的简单模数。

任何好的散列表实现都会将散列索引的生成（通过散列键）与其余逻辑分开。

这里总结了一些实现：[Delphi 5的Hashtable implementation](https://stackoverflow.com/questions/179162/hashtable-implementation-for-delphi-5)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T14:06:41.340

您可以直接从 int64 值计算散列值，但为此您需要找到一个散列函数，该函数均匀分布不同的 int64 值，这样您几乎不会发生冲突。这当然取决于这些键的值。如果您不知道项目的数量，您很可能也不知道这些 int64 值是如何分布的，因此想出一个好的散列函数将很难甚至是不可能的。

假设您的键不是某些东西的倍数（例如地址，它将是 4、8、16 等的倍数），您可以通过使用其中几个 IntList 对象的列表来加快速度，并首先计算一个索引到这个列表数组。使用*mod*运算符和素数将是计算列表索引的一种简单方法。与往常一样，这是速度和内存消耗之间的权衡。

您也可以在 google 上搜索稀疏数组的良好实现。IIRC Julian Bucknall 的 EZDSL 库有一个。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T13:52:59.853

一些想法，不是一个完整的解决方案。

除非有明确的证据表明搜索本身就是瓶颈（不要用你的“感觉”来检测瓶颈，使用代码分析器）我会坚持使用 IntList ...如果花费在实际搜索/插入/上的时间删除不占总处理器时间的至少 20%，甚至不要打扰。

如果你仍然想要一个哈希表，那么......

不要转换为字符串。转换将从堆中分配一个新字符串，这比搜索本身要昂贵得多。使用 int64 取模一些巧妙选择的素数作为散列键。

只有当它们足够大时，哈希表才会给你 O(1)。否则，您将获得大量共享相同哈希键的记录。让它太短，你会浪费你的时间搜索（线性！）通过链表。让它太大，你会浪费内存。

请记住，哈希表需要某种形式的链表来保持所有记录共享相同的键。该链表必须通过在有效负载对象中添加“下一个”指针（这会破坏封装 - 对象不必知道它存储在哈希表中）或分配一个小的帮助对象来实现。这种分配可能比排序列表的 O(log) 成本高得多。

# asp.net-mvc - 使用 ASP.NET MVC 的嵌套应用程序

> ID：280839
> 
> 赞同：3
> 
> 时间：2008-11-11T13:15:51.533
> 
> 标签：asp.net-mvc, deployment

我目前正在开发一个 asp.net-mvc 内容管理系统。能够部署嵌套应用程序（例如 /shop 以在其中拥有单独的应用程序）将非常有用。甚至是 cms 的另一个实例。

我找到了一些关于限制 web.config 继承的信息，但我不知道这如何映射到 MVC 应用程序。我希望它本质上是相同的堆栈，它只会运行。然而，没有什么是那么容易的。

如果有人有这样做的经验，我将不胜感激。一个大型应用程序来统治它们的想法一点也不好。

矽。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T13:31:28.990

老实说，您最大的障碍将是创建路线并确保它们不会干扰系统中已有的路线。在你得到这个工作之后，剩下的就很容易了。

您需要的第一件事是将 HttpModule 插入到 web.config 下的 . 该模块将用于注册和自定义您要注册的 ViewEngine 或 Routes。执行此操作的方式与在 Global.asax 中执行的方式相同，但不是将它们放在 Application_Start 中，而是将它们放在 HttpModule 的静态构造函数中。因此它们只像 Application_Start 一样被加载一次。

通过上述操作，您将创建一个易于传输的模块，并且不需要实施者修改其 Global.asax 代码以使您的东西正常工作。

您可能想要做的第二件事是在 web.config 中创建自定义配置来设置应用程序的根路径等内容。当您在 HttpModule 中设置它时，这将被添加到路由中。您也可以使用它来存储不适合数据库的自定义信息。

最后但并非必要的是，您可能想要创建一个自定义 ViewEngine 来了解并理解您的文件夹结构。仅当您希望将视图存储在与默认视图不同的路径中时，才需要这样做，以最大程度地减少冲突。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-11T13:40:59.847

查看Phil Haack的[使用 ASP.NET MVC 的分组控制器。](http://haacked.com/archive/2008/11/04/areas-in-aspnetmvc.aspx)

希望它有所帮助，布鲁诺·菲格雷多

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T13:36:58.997

我以前（使用 /blog）曾走这条路，但发现它可行但复杂且难以维护。相反，我最终使用了子域：

*   www.example.com
*   shop.example.com
*   博客.example.com

这些更容易维护，因为您可以让它们在 IIS 中作为单独的网站工作。当然，您始终可以将 www.example.com/shop 重定向到 shop.example.com。

# html - Float Left 100% height div - gap between divs

> ID：280846
> 
> 赞同：6
> 
> 时间：2008-11-11T13:18:25.587
> 
> 标签：html, css, css-float

**Mark Up**

```
<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="test.aspx.cs" Inherits="Zuhaib.test" %>
<!-- Put IE into quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head runat="server">
    <title></title>
    <link href="css/general.css" rel="stylesheet" type="text/css" />
    <link href="css/outbound.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <form id="form1" runat="server" class="wrapper">
    <asp:ScriptManager ID="ScriptManager1" runat="server">
    </asp:ScriptManager>
    <div id="left">
    </div>
    <div id="right">
    </div>  
    </form>
</body>
</html> 
```

**CSS**

```
html, body
{
    margin:0;
    padding:0;
    border:0;
    overflow:hidden;
    width:100%;
    height:100%;
}
* html body 
{
    height:100%;
    width:100%;
}    
*{
    margin:0;
    padding:0;
}
.wrapper 
{
    position:fixed;
    top:0px;
    bottom:0px;
    left:0px;
    right:0px;
    height:100%;
    width:100%;
}
* html .wrapper 
{
    width:100%;
    height:100%;
}
#left{
    float:left;
    height:100%;
    width:100px;
    overflow:hidden;
    background-color:Blue;
}
* html #left{
    height:100%;
    width:100px;
}
#right{
    margin-left:100px;
    height:100%;
    background-color:Red;
}
* html #right{
    height:100%;
} 
```

**Result in IE && FF**
[Resutls in IE & FF http://img139.imageshack.us/img139/9871/ie3pxgapnl4.jpg](http://img139.imageshack.us/img139/9871/ie3pxgapnl4.jpg)
The result is same with both IE 6 & 7\. How can I remove the gap between the divs?

**Udate**
I have two divs each with 100% height. the left div is a fixed width floating div. Even after giving correct margin-left to the right div, there remains a gap (3px) between the two divs. Where as in firefox it renders correctly.

The reason I have used quirk mode is to able to get 100% height for the divs

Can this gap be eliminated? Or is there a better way to do two column 100% height layout with pure css?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-11T13:58:52.447

As already said, your code is full of hacks. Please remove especially the unnecessary definitions. If a browser does not support *cascading* style sheets, it will not support CSS anyway.

That being said, why not use position: absolute; for #right?

As in

```
#right{
  position: absolute;
  left: 100px;
  padding-left: -100px;
  width: 100%;
  ...
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T13:55:00.833

Remove the comment on top of the page The "Put IE into quirks mode" thing

You are using a lot of 'hacks'. By that I mean the CSS selectors that begin with * html

I'm not saying that is the cause of the problem, but it is not good practice and is error prone.

1) try using conditional comments for the browser that has the gap problem instead of using those hacks 2) try editing your question by providing information about the version of IE you're testing against (my guess is IE 6 or even lower).

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T16:27:58.817

To be honest, if you're filling up the whole body with these divs, then you're better off giving one of them a transparent background and setting the background color of the body to the desired color, masking the problem.

Especially if, in trying to solve the IE issue, you're introducing a plague of CSS hacks into what should be nice and clean code considering the simple layout you're shooting for.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-10T15:41:49.397

The actual problem is the whitespace between the closing div tag and the next opening div tag. If you put them together on the same line with no space between them, or fill in the white space with a comment, the whitespace will be gone.

```
<div id="left">
</div><div id="right">
</div> 
```

or

```
 <div id="left">
    </div><!-- IE doesn't ignore whitespace between divs
  --><div id="right">
     </div> 
```

# wcf - 开源 Web 服务/WCF 媒体流媒体

> ID：280864
> 
> 赞同：3
> 
> 时间：2008-11-11T13:26:17.817
> 
> 标签：wcf, web-services, streaming, media

有谁知道可以将媒体内容流式传输到客户端的开源 Web 服务/wcf 服务？特别是我正在寻找可以访问我的音乐收藏并将其流式传输到客户端（可以是客户端浏览器、win 移动应用程序甚至 iphone 应用程序）的东西。

我想它必须是基于 WCF 的，因为我不确定 web 服务是否能很好地流式传输。此外，Windows Media Streaming Services 也不是最好的方法，因为该服务应该在 vista/xp 机器上运行（最好）。

如果没有，有没有人知道开始创建这样的东西的最佳方法 - 我不确定我知道从哪里开始，尽管我可以看到这种服务的许多用途！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-12T15:15:05.723

Orb ( [www.orb.com](http://www.orb.com) ) 将通过网络浏览器将您的媒体流式传输到几乎任何东西。我已经在 XP 虚拟机上运行它大约一年了。当我在客户的网站上工作时，我喜欢能够将我的整个媒体收藏流式传输到我的手机上。

虽然它不是开源的，但它是免费的并且得到了相对较好的支持。最好的功能之一是该体系结构的设置使得对您的防火墙没有特殊要求——它可以正常工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T09:24:21.353

我尝试了 Orb，它非常好，除了它劫持了我的调谐器卡，因此媒体中心将不再工作。但是，我将尝试创建一个本土版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T13:30:24.360

即使它不是开源的，Windows Server 2008 也有一个流媒体角色，可以满足您的要求。当然，您需要有一台服务器才能安装它。

# vba - 获取最后一个非空工作表的最佳方法

> ID：280872
> 
> 赞同：4
> 
> 时间：2008-11-11T13:30:29.790
> 
> 标签：vba, vba, excel

我正在尝试为一个组写一个[vba](/questions/tagged/vba "显示标记为“vba”的问题")宏

*   有一个工作簿，他们每天在其中创建新的工作表，并且还有
*   *Sheet 1* , *Sheet 2*和*Sheet 3*在其长长的工作表列表的末尾。

我需要在汇总此信息的不同工作簿的新列中创建外部单元格引用。

所以我需要知道如何获取**最后一张非空表**，以便我可以获取这些数据并将其适当地放在摘要中。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T14:12:15.507

此函数从右到左遍历工作表，直到找到非空白工作表，并返回其名称

```
Function GetLastNonEmptySheetName() As String
Dim i As Long
For i = Worksheets.Count To 1 Step -1
  If Sheets(i).UsedRange.Cells.Count > 1 Then
    GetLastNonEmptySheetName = Sheets(i).Name
    Exit Function
  End If
Next i
End Function 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-11-09T07:24:04.813

上面的方法将忽略具有单个单元格条目的工作表，虽然这似乎是一个小问题，但`Find`寻找一个非空白单元格将提供更多确定性。

该方法`xlFormulas`中的参数`Find`将找到隐藏的单元格（但不是过滤的单元格），而`xlValues`不会。

```
Sub FindLastSht()
    Dim lngCnt As Long
    Dim rng1 As Range
    Dim strSht As String
    With ActiveWorkbook
        For lngCnt = .Worksheets.Count To 1 Step -1
            Set rng1 = .Sheets(lngCnt).Cells.Find("*", , xlFormulas)
            If Not rng1 Is Nothing Then
                strSht = .Sheets(lngCnt).Name
                Exit For
            End If
        Next lngCnt
        If Len(strSht) > 0 Then
            MsgBox "Last used sheet in " & .Name & " is " & strSht
        Else
            MsgBox "No data is contained in " & .Name
        End If
    End With
End Sub 
```

# database - ERD 有交换格式吗？

> ID：280874
> 
> 赞同：2
> 
> 时间：2008-11-11T13:30:46.950
> 
> 标签：database, database-design, uml, erd

有没有办法将 ERD 图从一个工具交换到另一个工具，因为 XMI 存在用于交换 UML 文档？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T13:50:17.597

我所知道的最接近这一点的是[Common Warehouse Metamodel (CWM)](http://en.wikipedia.org/wiki/Common_Warehouse_Metamodel)，它得到了一些工具供应商的支持。官方规范住[在这里](http://www.omg.org/spec/CWM/1.1/)。数据建模是其中的一个子集——它也用于映射。与委员会设计的规范一样，它是全面的、冗长的并且可能很难实施。

一种更简单的方法可以帮助您将架构导出为 SQL，将其运行到临时数据库中并使用新工具对其进行逆向工程。但是，这往往会丢失评论或任何附加文档。根据工具的不同，您也许可以拼凑一些东西来挽救它。

例如，有一次我编写了一个 Python 脚本，该脚本将解释 Visio Enterprise Architect 的 SQL 输出以生成数据字典文档的 MIF 文件。输出具有易于解析并与列定义关联的格式的表和列文档。如果您可以以编程方式将注释插入到目标工具的存储库中，则可以使用类似的技术进行迁移。

# javascript - 如何确定用户在 JavaScript 中运行的 IE 版本？

> ID：280879
> 
> 赞同：17
> 
> 时间：2008-11-11T13:32:38.863
> 
> 标签：javascript, internet-explorer, browser

在一些现有代码中，通过检查对象 Browser.Engine.trident 是否已定义并返回 true 来测试用户是否正在运行 IE。

但是如何确定用户运行的是 IE6（或更早版本）还是 IE7（或更高版本）？

JavaScript 函数内部需要测试，因此条件注释似乎不合适。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-11T15:59:03.000

从在 msdn[更有效地检测 Internet Explorer ：](http://msdn.microsoft.com/en-us/library/ms537509.aspx)

```
function getInternetExplorerVersion()
// Returns the version of Internet Explorer or a -1
// (indicating the use of another browser).
{
  var rv = -1; // Return value assumes failure.
  if (navigator.appName == 'Microsoft Internet Explorer')
  {
    var ua = navigator.userAgent;
    var re  = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
    if (re.exec(ua) != null)
      rv = parseFloat( RegExp.$1 );
  }
  return rv;
}

function checkVersion()
{
  var msg = "You're not using Internet Explorer.";
  var ver = getInternetExplorerVersion();

  if ( ver > -1 )
  {
    if ( ver >= 6.0 ) 
      msg = "You're using a recent copy of Internet Explorer."
    else
      msg = "You should upgrade your copy of Internet Explorer.";
  }
  alert( msg );
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-11T13:58:57.687

如果您真的想确定您使用的是 IE 和特定版本，那么您显然可以使用 IE 的条件标签来仅在 IE 中运行某些代码。它不是真的那么漂亮，但至少你可以确定它真的是 IE 而不是一些欺骗版本。

```
<script>
    var isIE = false;
    var version = -1;
</script>
<!--[if IE 6]>
    <script>
        isIE = true;
        version = 6
    </script>
<![endif]-->
<!--[if IE 7]>
    <script>
        isIE = true;
        version = 7
    </script>
<![endif]--> 
```

这很不言自明。在 IE6`isIE`中 is`true`和`version`is `6`，在 IE7`isIE`中 is`true`和`version`is`7`否则`isIE`为 false 并且`version`is`-1`

或者，您可以使用从 jQuery 剽窃的代码推出自己的解决方案。

```
var userAgent = navigator.userAgent.toLowerCase();
var version = (userAgent.match( /.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/ ) || [])[1],
var isIE = /msie/.test( userAgent ) && !/opera/.test( userAgent ), 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-11T13:36:27.093

如果您已经在 1.9 之前的版本中使用 jQuery，并且不需要检测 IE 11，则可以这样做：

```
if (jQuery.browser.msie == true) { 
if (jQuery.browser.version == 7.0)
  // .. do something for 7.0
else 
  // .. do something for < 7.0
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-11T13:38:31.130

Navigator 对象包含有关用户浏览器的所有信息：

例如：

var browser=navigator.appName;

var b_version=navigator.appVersion;

var version=parseFloat(b_version);

看：

[http://www.w3schools.com/js/js_browser.asp](http://www.w3schools.com/js/js_browser.asp)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-11T13:52:54.190

如果您正在检查某个功能，您应该直接检查它，例如`if (window.focus) {window.focus();}` **浏览器检测永远不够可靠。**

有关对象与浏览器检测的更多详细信息，[请查看 Quirksmode 上的这篇文章](http://www.quirksmode.org/js/support.html)。

另一方面，如果您需要的功能是浏览器类型和版本，例如用于统计目的，请使用`navigator.appName`和`navigator.appVersion`。（但请注意 - 许多不太流行的浏览器将自己伪装成 MSIE 6 或 7，因为某些网站会在“所有现代浏览器都是 IE，对吗？”（提示：不再是）的前提下阻止任何不是 IE 的东西。）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-09-30T13:38:26.503

因此 IE8 兼容性视图模式将自身报告为 IE7，即使它的行为并不总是相同。为此，我给你这个怪物：

```
 // IE8's "Compatibility mode" is anything but.  Oh well, at least it doesn't take 40 lines of code to detect and work around it.
// Oh wait:
/*
 * Author: Rob Reid
 * CreateDate: 20-Mar-09
 * Description: Little helper function to return details about IE 8 and its various compatibility settings either use as it is
 * or incorporate into a browser object. Remember browser sniffing is not the best way to detect user-settings as spoofing is
 * very common so use with caution.
*/
function IEVersion(){
    var _n=navigator,_w=window,_d=document;
    var version="NA";
    var na=_n.userAgent;
    var ieDocMode="NA";
    var ie8BrowserMode="NA";
    // Look for msie and make sure its not opera in disguise
    if(/msie/i.test(na) && (!_w.opera)){
        // also check for spoofers by checking known IE objects
        if(_w.attachEvent && _w.ActiveXObject){        
            // Get version displayed in UA although if its IE 8 running in 7 or compat mode it will appear as 7
            version = (na.match( /.+ie\s([\d.]+)/i ) || [])[1];
            // Its IE 8 pretending to be IE 7 or in compat mode        
            if(parseInt(version)==7){                
                // documentMode is only supported in IE 8 so we know if its here its really IE 8
                if(_d.documentMode){
                    version = 8; //reset? change if you need to
                    // IE in Compat mode will mention Trident in the useragent
                    if(/trident\/\d/i.test(na)){
                        ie8BrowserMode = "Compat Mode";
                    // if it doesn't then its running in IE 7 mode
                    }else{
                        ie8BrowserMode = "IE 7 Mode";
                    }
                }
            }else if(parseInt(version)==8){
                // IE 8 will always have documentMode available
                if(_d.documentMode){ ie8BrowserMode = "IE 8 Mode";}
            }
            // If we are in IE 8 (any mode) or previous versions of IE we check for the documentMode or compatMode for pre 8 versions            
            ieDocMode = (_d.documentMode) ? _d.documentMode : (_d.compatMode && _d.compatMode=="CSS1Compat") ? 7 : 5;//default to quirks mode IE5                               
        }
    }

    return {
        "UserAgent" : na,
        "Version" : version,
        "BrowserMode" : ie8BrowserMode,
        "DocMode": ieDocMode
    }            
}
var ieVersion = IEVersion();
var IsIE8 = ieVersion.Version != "NA" && ieVersion.Version >= 8; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-11T15:29:39.737

这可能会被否决，因为它没有直接回答问题，但是......您**不**应该编写特定于浏览器的代码。在为大多数被广泛接受的浏览器编码时，几乎没有什么是您不能做的。

编辑：我发现有条件注释唯一有用的是当我需要包含 ie6.css 或 ie7.css 时。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-06-13T11:47:13.707

嗯……这是我想了一会儿后想到的。只是想找到一个简单的解决方案。

```
if (navigator.appName == 'Microsoft Internet Explorer') {
        // Take navigator appversion to an array & split it 
        var appVersion = navigator.appVersion.split(';');
        // Get the part that you want from the above array  
        var verNumber = appVersion[1];

        alert(verNumber);
} 
```

它返回前：- MSIE 10.0、MSIE 9.0、MSIE 8.0

进一步扩展，如果你想检查它是“低于”还是“高于”IE版本，你可以稍微修改一下

```
if (navigator.appName == 'Microsoft Internet Explorer') {
        var appVersion = navigator.appVersion.split(';');
        var verNumber = appVersion[1];
        // Reaplce "MSIE " from the srting and parse it to integer value        
        var IEversion = parseInt(verNumber.replace('MSIE ', ''));

        if(IEversion <= 9){
            alert(verNumber);
        }
} 
```

从[w3schools](http://www.w3schools.com/js/js_window_navigator.asp)得到了基本的想法，希望这会对一些人有所帮助......：D

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-11T15:21:34.027

这是我使用的脚本，它似乎运行良好：

```
// Returns 0 if the browser is anything but IE
function getIEVersion() {
   var ua = window.navigator.userAgent;
   var ie = ua.indexOf("MSIE ");
   return ((ie > 0) ? parseInt(ua.substring(ie+5, ua.indexOf(".", ie))) : 0);
} 
```

希望对某人有所帮助...

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-11T15:59:42.453

这应该会给你比你想要的更多的细节：

```
var agent = navigator.userAgent;
var msiePattern = /.*MSIE ((\d+).\d+).*/
if( msiePattern.test( agent ) ) {
  var majorVersion = agent.replace(msiePattern,"$2");
  var fullVersion = agent.replace(msiePattern,"$1");
  var majorVersionInt = parseInt( majorVersion );
  var fullVersionFloat = parseFloat( fullVersion );
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-11T21:38:10.960

似乎还没有人说过：

> JavaScript 函数内部需要测试，因此条件注释似乎不合适。

您可以轻松地将条件注释（JScript 条件注释，而不是 HTML 注释）放入函数中：

```
function something() {
    var IE_WIN= false;
    var IE_WIN_7PLUS= false;
    /*@cc_on
    @if (@_win32)
        IE_WIN= true;
        @if (@_jscript_version>=5.7)
            IE_WIN_7PLUS = true;
        @end
    @end @*/
    ...
} 
```

更典型的做法是在全局级别进行一次测试，然后只检查存储的标志。

CC 比筛选如今用户代理字符串变得混乱的情况更可靠。navigator.userAgent 上的字符串匹配方法可能会错误识别 Opera 等欺骗浏览器。

当然，在可能的情况下，能力嗅探对于跨浏览器代码来说要好得多，但在某些情况下——通常是错误修复解决方法——你确实需要专门识别 IE，而 CC 可能是当今最好的方法。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-03-13T13:37:54.620

```
<script>
    alert("It is " + isIE());

    //return ie number as int else return false
    function isIE() {
        var myNav = navigator.userAgent.toLowerCase();
        if (myNav.indexOf('msie') != -1) //ie less than ie11 (6-10)
        {
            return parseInt(myNav.split('msie')[1]);
        }
        else 
        {
            //Is the version more than ie11? Then return false else return ie int number
            return (!!(myNav.match(/trident/) && !myNav.match(/msie/)) == false)?false : parseInt(myNav.split('rv:')[1].substring(0, 2));               
        }
    }
</script> 
```

# c# - 使用户控件显示在表单边界之外

> ID：280891
> 
> 赞同：17
> 
> 时间：2008-11-11T13:38:50.473
> 
> 标签：c#, winforms

我决定重新实现日期时间选择器，因为标准日期时间选择器不可为空。用户希望从空白字段开始并键入（而不是选择）日期。

我已经创建了一个用户控件来做到这一点，但是如果用户控件靠近表单的边缘，它将在表单边界上被切断。标准的日期时间选择器不会遇到这个问题。

这是显示问题的图片。我的用户控件在左侧，标准的 datetimepicker 在右侧：

[替代文字 http://img50.imageshack.us/img50/9104/datetimepickervu6.jpg](http://img50.imageshack.us/img50/9104/datetimepickervu6.jpg)

如您所见，标准控件将显示在表单和应用程序边界上。如何让我控制的月份选择器做同样的事情？

谢谢！

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-11-11T21:38:41.003

ToolStripDropDown 控件具有此功能，因此通过从它继承我们可以制作一个简单的 PopupWindow。

```
/// <summary>
/// A simple popup window that can host any System.Windows.Forms.Control
/// </summary>
public class PopupWindow : System.Windows.Forms.ToolStripDropDown
{
    private System.Windows.Forms.Control _content;
    private System.Windows.Forms.ToolStripControlHost _host;

    public PopupWindow(System.Windows.Forms.Control content)
    {
        //Basic setup...
        this.AutoSize = false;
        this.DoubleBuffered = true;
        this.ResizeRedraw = true;

        this._content = content;
        this._host = new System.Windows.Forms.ToolStripControlHost(content);

        //Positioning and Sizing
        this.MinimumSize = content.MinimumSize;
        this.MaximumSize = content.Size;
        this.Size = content.Size;
        content.Location = Point.Empty;

        //Add the host to the list
        this.Items.Add(this._host);
    }
} 
```

用法：

```
PopupWindow popup = new PopupWindow(MyControlToHost);
popup.Show(new Point(100,100));
...
popup.Close(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T13:45:57.370

屏幕截图看起来像一个 Windows 窗体应用程序，所以我的答案是 winforms。

我想最好的解决方案是创建一个自定义控件，它本身使用已经具有该行为的日期时间选择器。

显示一个空文本框，直到它被点击，然后显示 datetimepicker。

这将为您节省大量代码..

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T20:12:54.313

我在尝试实现自定义控件时遇到了这个问题，发现这是一个非常困难的问题。模型中没有内置功能`Windows.Forms`来支持其显示区域延伸到其容器客户区域之外的控件。

您基本上必须使用 Windows API 或在设置了 AlwaysOnTop 的表单内绘制控件。这两种方法都比它们应该的更难。我最终重新设计了我的控件，以便使用模式对话框而不是在下拉列表中显示其扩展内容。这是一个非常不令人满意的解决方案，但我花了几周时间尝试其他方法，但永远无法在所有用例中始终如一地工作（比如当应用程序失去焦点时消失）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T13:54:35.030

我不是 100% 确定，但是快速浏览一下 Reflector 上的 DateTimePicker 类会将我带到`SafeNativeMethods.SetWindowPos`内部类。

您可以`SetBoundsCore`从基础 Control 类中重写，或者像 Tigraine 所述，创建基于 DateTimePicker 的自定义控件。

希望它有所帮助，布鲁诺·菲格雷多

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T20:58:07.483

您的控件被切断的原因是因为它是您所在表单的子控件。表单上的任何控件都必须包含在表单中，因此它会被截断。

我没有在 .Net 中这样做，但在 VB6 中遇到了类似的问题。然后解决方案是将弹出窗口的父级（在您的情况下为日历）设置为桌面。这将允许它超出表单的边界。您必须做一些 P/Invoke 魔术才能找到弹出窗口的 hWnd，并使用另一个 P/Invoke 来设置父级。

# http - 我应该查看哪些嵌入式 HTTP 服务器库选项？

> ID：280892
> 
> 赞同：0
> 
> 时间：2008-11-11T13:38:54.903
> 
> 标签：http, open-source

我正在寻找一个小型代理服务器来踢球和咯咯笑。

除了 libWWW 中的选项，任何人都可以推荐任何用于 HTTP 服务器和客户端代码的开源选项吗？考虑某种类似于 libWWW 的库。

选择的语言是 C/C++，但对 Java、C#、Python 等开放。:-)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-11T13:53:10.493

如果您选择 Java 方式，请查看**Jetty**。它是功能齐全的 HTTP 服务器，非常易于嵌入且非常轻量级。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-05-03T14:03:06.850

码头确实很棒。但是，如果您想要代理服务器，请查看[RabBIT 代理。](http://khelekore.org/rabbit/)它设计精良，易于修改。例如，我们实现了一个过滤器，它将对 Java 对象的请求中的某些 XML 文本序列化，并类似地反序列化响应。

有多种选择取决于您想做什么。例如，要处理 NTLM 身份验证，您有 cNTLM (C) 或 NTLMAPS (Python) 或 jCIFS 库 (Java)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-04-06T03:37:48.067

如果您正在考虑在 C/C++ 中以异步方式制作代理服务器。以下是您可能想要查看的一些开源项目：

*   libevent 提供了一个 - 轻量级使用的好选择。但没有提供对大数据的递归..
*   [mongoose](https://code.google.com/p/mongoose/) - 不错的 API，良好的抽象，但它使用基于 select() 和 realloc() 的 i/o 缓冲区，也是用于商业用途的双重许可证。
*   libevhtp - 作为 libevent 的 http 模块的替代品而开发。
*   GNU 的 libmicrohttpd - 很好的功能集。
*   [libasyncd](http://wolkykim.github.io/libasyncd/) - 我是作者。它具有通用异步框架并带有 HTTP 处理程序。

我只能在我的答案上创建 2 个链接，但您可以通过谷歌搜索轻松找到项目主页。

# ms-access - 自动转换访问数据库

> ID：280894
> 
> 赞同：1
> 
> 时间：2008-11-11T13:41:01.297
> 
> 标签：ms-access, csv

我有一个访问数据库，并进行了查询。我需要将其自动化，以便每天晚上此查询可以运行并导出到制表符分隔的 csv 文件。无法从访问权限内将查询导出到 csv 文件。我的问题是，是否有任何工具可以选择某些表，或者对 mdb 文件执行 sql 查询，然后导出到 csv 文件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T13:44:43.020

VBScript 与 Jet 引擎配合得很好。但是，我不明白您为什么说“无法从访问权限内将查询导出到 csv 文件”。

```
 Sub TransferCSV()

    DoCmd.TransferText acExportDelim, , "PutNameOfQueryHere", "C:\PutPathAnd\FilenameHere.csv", True

 End Sub 
```

是VBA中的常用方式。

编辑：可以从命令行运行 VBScript 文件 (.vbs)。这是一些用于输出制表符分隔文件的示例 VBScript。

```
db = "C:\Docs\LTD.mdb"
TextExportFile = "C:\Docs\Exp.txt"

Set cn = CreateObject("ADODB.Connection")
Set rs = CreateObject("ADODB.Recordset")

cn.Open _
   "Provider = Microsoft.Jet.OLEDB.4.0; " & _
   "Data Source =" & db

strSQL = "SELECT * FROM tblMembers"

rs.Open strSQL, cn, 3, 3

Set fs = CreateObject("Scripting.FileSystemObject")

Set f = fs.CreateTextFile(TextExportFile, True)

a = rs.GetString

f.WriteLine a

f.Close 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-11T14:06:47.937

实际上，您可以从 Access 中将查询导出到 csv 文件。

您可以通过使用 TransferText 方法的宏来执行此操作。

宏：

```
 Name = ExportQuery
   Action = TransferText
   Transfer Type = Export Delimited
   Table Name = [name of your Access query]
   File Name = [path of output file]
   Has Field Names = [Yes or No, as desired] 
```

您可以像这样从命令行执行宏：

```
"[your MS Office path]\msaccess.exe" [your databse].mdb /excl /X ExportQuery /runtime 
```

由于您在宏中遇到 TransferText 问题，请尝试以下操作：

1) 创建一个名为“ExportQuery”的模块。在这个模块中，创建一个名为“ExportQuery”的函数：

```
Function ExportQuery()
    DoCmd.TransferText acExportDelim, , "[your query]", "[output file].csv"
End Function 
```

2) 创建一个名为 RunExportQuery 的宏：

```
Action = RunCode
Function Name = ExportQuery () 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-11T13:45:44.500

SQL Server Integration Services 能够完成您所说的转换。不要被名称所迷惑，因为您不需要 SQL Server 来自动化和运行包。

[http://msdn.microsoft.com/en-us/library/ms141026.aspx](http://msdn.microsoft.com/en-us/library/ms141026.aspx)

# .net - 没有赶上 Linq 的潮流，你不使用 linq 的原因是什么？

> ID：280896
> 
> 赞同：4
> 
> 时间：2008-11-11T13:41:48.363
> 
> 标签：.net, linq, methodology

我似乎是少数，但老实说我对 linq 不太满意，也看不到我个人发展的任何好处（不是说没有好处，只是根据我的情况提出的个人意见）。

我构建 Web 应用程序（.net、.net mvc）并且我喜欢在存储过程中包含我的部分数据层。我喜欢 sprocs 的一件事是，我可以生成整个数据库以编写脚本，然后扫描我的查询，我可能添加的**可读查询**，在高级别。

对于那些不喜欢linq的人，你的理由是什么？只是缺乏知识/学习曲线，还是有不使用它的商业案例？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T13:47:35.137

我实际上*确实*使用 Linq，但不是用于查询 SQL。我将它用作查询数据表的一种非常简单的方法，例如，查找数据表中的最大值。以前我会为此代码使用 for 循环，但 Linq 使它更整洁，更清楚我的意图。

一旦您意识到 Linq 是一种通用的 .NET 查询语言，它的功能和实用性就会变得更加清晰。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T14:11:51.547

那么，您从不在 C# 代码中对集合进行任何处理吗？在集合、过滤或分组等中查找最大值？我知道我经常这样做。LINQ 让我以一种非常易读、声明性的方式执行此操作（比 SQL、IMO 更易读——查询的顺序更符合逻辑）。

同样，使用 LINQ to XML 查询 XML，使用 LINQ to DataSet 查询数据集等。哦，别忘了使用 PLINQ 进行并行化。

喜欢 LINQ 的理由有很多 :)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T13:46:35.670

[最近这里](https://stackoverflow.com/questions/14530/linq-to-sql-vs-stored-procedures)有一个关于是否使用 LINQ 或存储过程的有用讨论，其中包括每种方法的优点和缺点。

有些人对 LINQ to SQL 的未来感到担忧。

[LINQ to SQL 是 DOA 吗？](https://stackoverflow.com/questions/252683/is-linq-to-sql-doa)

[微软真的杀死了 LINQ to SQL 吗？](https://stackoverflow.com/questions/253263/has-microsoft-really-killed-linq-to-sql)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T14:02:54.887

我正在使用 LINQ 查询数组或通用列表。`foreach`即使我浏览多个列表，它也很容易阅读并且为我节省了很多输入 for -loops 的时间。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T15:25:30.867

最初的发布者将 Linq（用于查询的 lambda 表达式）与 DLinq（用于轻量级数据库的 Linq）混淆了，因为它们几乎被社区同义地使用。

您可以将 Linq 与任何集合一起使用，并在其上使用类似 Sql 的语法。它非常整洁。

是的，您可以使用 DLinq 执行存储过程。请参阅下面的链接

[http://weblogs.asp.net/scottgu/archive/2007/08/23/linq-to-sql-part-7-updating-our-database-using-stored-procedures.aspx](http://weblogs.asp.net/scottgu/archive/2007/08/23/linq-to-sql-part-7-updating-our-database-using-stored-procedures.aspx)

-RVZ

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-11T15:37:52.637

我们还不能使用 Linq，因为我们还在 2.0 上，并且不允许升级到更新的版本。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-11T14:29:24.397

我还没有为 LINQ 烦恼，因为我没有任何真正的需要。

多年来，我学会了“按需学习”——新技术来去匆匆，以至于你可以浪费大量时间研究最新趋势，只是为了让它在第二年消失。

并不是说 LINQ 会，因为它似乎已经被很好地吸收了，但是只要我的设计是合理的，我就不会因为“旧方式”的编码而失眠。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-11T13:52:59.027

当然，使用存储过程或 Linq 是您的选择，两者各有利弊。

基本上作为 Linq 的专业人士，您不需要花时间创建数据层，但在存储过程中，您必须为每个实体编写一个新的存储过程（也许您可以为“存储过程地狱”提供通用解决方案但我认为维护起来会很复杂）。而且我也认为存储过程的维护比Linq复杂（当然在你用Linq花了一点时间之后。）

但正如预期的那样，使用存储过程获取数据比使用 Linq 更快。

而以后Oracle等数据库对Linq的支持就会出现；如果您仍然使用存储过程并且您必须更改数据库或者您想要支持另一个数据库，那么您需要编写这些存储过程的 Oracle 和其他数据库版本，我认为那将是一个真正的地狱，但不是在 Linq 中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-11T14:10:04.157

我目前正在为 Windows XP Embedded 创建软件。我使用 linq 做了几个尖峰，不得不把它拿出来，因为目前 XP 嵌入式只支持 .Net 3.0 或更低版本，真可惜。工作量不大，但我的代码使用 Linq 看起来比没有使用要好得多。

我还没有使用过 Linq to SQL。我确实尝试了一个 Linq to NHibernate 测试版，当它准备好时，当我必须再次对数据库做一些事情时，这绝对是我的选择。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-11T13:47:27.757

我讨厌 SQL，并且在过去一年左右一直在使用 LINQ。我绝对喜欢 LINQ 语法而不是 SQL 语法。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-11T14:15:04.410

我喜欢 LINQ。它易于阅读和书写。我不必担心我的 sql 查询优化。它是一个延迟操作，使它更酷。我可以返回 IQueryable，这很棒。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-11T14:54:37.030

我工作的公司有一个不使用 Linq（to SQL）的商业案例：

他们喜欢存储过程，因为它们可以在部署后更改，而无需重新编译、重新安装等。

就个人而言，我不太喜欢这种说法。因为很多人可以（并且确实）在客户站点对 sps 进行更改，所以很难提供有效的支持。

Linq 是一项非常好的技术，它使 .net 中的许多任务非常容易和高效（开发时间明智）实现。此外，Linq to SQL 确实为调用存储过程提供了非常好的机制。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-11T15:05:47.413

现在，缺乏知识/学习曲线（缺乏时间）是问题所在。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-10-30T07:39:35.750

我更喜欢使用 SQL 直接（通过存储过程）查询数据库，然后使用 LINQ 对数据进行额外处理，例如分组。

# sql-server - 仅当 SQL Server 中满足条件时触发

> ID：280904
> 
> 赞同：34
> 
> 时间：2008-11-11T13:45:47.760
> 
> 标签：sql-server, triggers

我希望这对于任何 SQL 人来说都是一个足够简单的问题......

我们有一个保存系统配置数据的表，它通过触发器与历史表相关联，因此我们可以跟踪谁更改了什么以及何时更改。

我需要在此表中添加另一个值，但它会经常从代码中更改，并且要求我们不跟踪它的历史记录（我们不想用成千上万的每天更新。

目前我们的触发器是这样的……

```
CREATE TRIGGER 
    [dbo].[SystemParameterInsertUpdate]
ON 
    [dbo].[SystemParameter]
FOR INSERT, UPDATE 
AS
  BEGIN
    SET NOCOUNT ON
      INSERT INTO SystemParameterHistory 
      (
        Attribute,
        ParameterValue,
        ParameterDescription,
        ChangeDate
      )
    SELECT
      Attribute,
      ParameterValue,
      ParameterDescription,
      ChangeDate
    FROM Inserted AS I
END 
```

如果属性列值以特定字符串为前缀（例如“NoHist_”），我希望能够添加一些逻辑来阻止它创建记录

鉴于我几乎没有使用触发器的经验，我想知道如何最好地实现它......我尝试了一个 where 子句，如下所示

```
where I.Attribute NOT LIKE 'NoHist_%' 
```

但它似乎不起作用。该值仍被复制到历史表中。

您可以提供的任何帮助将不胜感激。

* * *

好的 - 正如 Cade Roux 所预测的那样，这在多次更新时都失败了。我将不得不采取一种新的方法来解决这个问题。请问有人有其他建议吗？

* * *

伙计们 - 请在这里教育我......为什么在这种情况下 LEFT() 比 LIKE 更可取？我知道我已经接受了答案，但我想知道我自己的教育。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-11-11T14:04:13.387

鉴于 WHERE 子句不起作用，也许这会：

```
CREATE TRIGGER 
    [dbo].[SystemParameterInsertUpdate]
ON 
    [dbo].[SystemParameter]
FOR INSERT, UPDATE 
AS
  BEGIN
    SET NOCOUNT ON

      If (SELECT Attribute FROM INSERTED) LIKE 'NoHist_%'
      Begin
          Return
      End

      INSERT INTO SystemParameterHistory 
      (
        Attribute,
        ParameterValue,
        ParameterDescription,
        ChangeDate
      )
    SELECT
      Attribute,
      ParameterValue,
      ParameterDescription,
      ChangeDate
    FROM Inserted AS I
END 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-11T14:08:36.843

这个怎么样？

```
CREATE TRIGGER 
[dbo].[SystemParameterInsertUpdate]
ON 
[dbo].[SystemParameter]
FOR INSERT, UPDATE 
AS
BEGIN
SET NOCOUNT ON
  IF (LEFT((SELECT Attribute FROM INSERTED), 7) <> 'NoHist_') 
  BEGIN
      INSERT INTO SystemParameterHistory 
      (
        Attribute,
        ParameterValue,
        ParameterDescription,
        ChangeDate
      )
    SELECT
      Attribute,
      ParameterValue,
      ParameterDescription,
      ChangeDate
   FROM Inserted AS I
END
END 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-11T19:07:25.053

顺便说一句，该`_`字符也是通配符，但我不确定为什么这对您不起作用：

```
CREATE TRIGGER 
    [dbo].[SystemParameterInsertUpdate]
ON 
    [dbo].[SystemParameter]
FOR INSERT, UPDATE 
AS
  BEGIN
    SET NOCOUNT ON
      INSERT INTO SystemParameterHistory 
      (
        Attribute,
        ParameterValue,
        ParameterDescription,
        ChangeDate
      )
    SELECT
      I.Attribute,
      I.ParameterValue,
      I.ParameterDescription,
      I.ChangeDate
    FROM Inserted AS I
    WHERE I.Attribute NOT LIKE 'NoHist[_]%'
END 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-11T14:24:29.790

您的 where 子句应该有效。我不知道为什么没有。让我向您展示我如何解决 where 子句的问题，因为它可能对您未来有所帮助。

当我创建触发器时，我从查询窗口开始，创建一个名为#inserted（和或#deleted）的临时表，其中包含表的所有列。然后我用典型值填充它（总是多条记录，我尝试在值中点击测试用例）

然后我编写我的触发器逻辑，我可以在它实际上不在触发器中的情况下进行测试。在像您的 where 子句没有达到预期效果的情况下，我可以通过注释掉插入来轻松测试，以查看选择返回的内容。然后我可能很容易就能看出问题所在。我向您保证，如果编写正确，哪些子句在触发器中起作用。

一旦我知道代码在所有情况下都能正常工作，我将 #inserted 全局替换为 insert 并在其周围添加创建触发器代码，瞧，一个经过测试的触发器。

正如我在评论中所说，我担心您选择的解决方案在多记录插入或更新中无法正常工作。应该始终编写触发器来解释这一点，因为您无法预测它们是否以及何时发生（并且它们最终确实会发生在几乎每个表中。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-09-02T23:14:21.983

```
CREATE TRIGGER
    [dbo].[SystemParameterInsertUpdate]
ON 
    [dbo].[SystemParameter]
FOR INSERT, UPDATE 
AS
  BEGIN
    SET NOCOUNT ON 

    DECLARE @StartRow int
    DECLARE @EndRow int
    DECLARE @CurrentRow int

    SET @StartRow = 1
    SET @EndRow = (SELECT count(*) FROM inserted)
    SET @CurrentRow = @StartRow

    WHILE @CurrentRow <= @EndRow BEGIN

        IF (SELECT Attribute FROM (SELECT ROW_NUMBER() OVER (ORDER BY Attribute ASC) AS 'RowNum', Attribute FROM inserted) AS INS WHERE RowNum = @CurrentRow) LIKE 'NoHist_%' BEGIN

            INSERT INTO SystemParameterHistory(
                Attribute,
                ParameterValue,
                ParameterDescription,
                ChangeDate)
            SELECT
                I.Attribute,
                I.ParameterValue,
                I.ParameterDescription,
                I.ChangeDate
            FROM
                (SELECT Attribute, ParameterValue, ParameterDescription, ChangeDate FROM (
                                                                                            SELECT ROW_NUMBER() OVER (ORDER BY Attribute ASC) AS 'RowNum', * 
                                                                                            FROM inserted)
                                                                                    AS I 
            WHERE RowNum = @CurrentRow

        END --END IF

    SET @CurrentRow = @CurrentRow + 1

    END --END WHILE
END --END TRIGGER 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-11T15:06:43.400

使用 LIKE 将为您提供定义字符串其余部分应该是什么样子的选项，但如果规则只是以 'NoHist_' 开头，那并不重要。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-18T19:23:21.380

对于一般的触发器，您需要使用游标来处理多行的插入或更新。例如：

```
DECLARE @Attribute;
DECLARE @ParameterValue;
DECLARE mycursor CURSOR FOR SELECT Attribute, ParameterValue FROM inserted;
OPEN mycursor;
FETCH NEXT FROM mycursor into @Attribute, @ParameterValue;
WHILE @@FETCH_STATUS = 0
BEGIN

If @Attribute LIKE 'NoHist_%'
      Begin
          Return
      End

etc.

FETCH NEXT FROM mycursor into @Attribute, @ParameterValue;
END 
```

触发器，至少在 SQL Server 中，是一个很大的痛苦，我完全避免使用它们。

# c - 如何在 Linux 中为 C 或 C++ 的进程设置 CPU 亲和性？

> ID：280909
> 
> 赞同：42
> 
> 时间：2008-11-11T13:47:00.207
> 
> 标签：c, linux, smp, affinity

是否有一种编程方法可以为 Linux 操作系统的 c/c++ 中的进程设置 CPU 亲和性？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-11-11T13:52:48.417

你需要使用[`sched_setaffinity(2)`](http://linux.die.net/man/2/sched_setaffinity).

例如，仅在 CPU 0 和 2 上运行：

```
#define _GNU_SOURCE
#include <sched.h>

cpu_set_t  mask;
CPU_ZERO(&mask);
CPU_SET(0, &mask);
CPU_SET(2, &mask);
int result = sched_setaffinity(0, sizeof(mask), &mask); 
```

（`0`对于第一个参数表示当前进程，如果它是您想要控制的其他进程，请提供 PID）。

另请参阅[`sched_getcpu(3)`](https://linux.die.net/man/3/sched_getcpu)。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-11T13:57:05.867

在进程级别使用 sched_setaffinity，或对单个线程使用[pthread_attr_setaffinity_np](http://www.kernel.org/doc/man-pages/online/pages/man3/pthread_attr_setaffinity_np.3.html)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2016-12-23T10:36:57.590

我做了很多努力来意识到正在发生的事情，所以我添加了这个答案来帮助像我这样的人（我`gcc`在 linux mint 中使用编译器）

```
#include <sched.h> 
cpu_set_t  mask;

inline void assignToThisCore(int core_id)
{
    CPU_ZERO(&mask);
    CPU_SET(core_id, &mask);
    sched_setaffinity(0, sizeof(mask), &mask);
}
int main(){
    //cal this:
    assignToThisCore(2);//assign to core 0,1,2,...

    return 0;
} 
```

但不要忘记将此选项添加到编译器命令：`-D _GNU_SOURCE` 因为操作系统可能会为特定内核分配一个进程，您可以将其添加`GRUB_CMDLINE_LINUX_DEFAULT="quiet splash isolcpus=2,3"`到位于的 grub 文件`/etc/default`和运行 `sudo update-grub`终端中以保留您想要的内核

**更新：** 如果你想分配更多的核心，你可以按照这段代码：

```
inline void assignToThisCores(int core_id1, int core_id2)
{
    CPU_ZERO(&mask1);
    CPU_SET(core_id1, &mask1);
    CPU_SET(core_id2, &mask1);
    sched_setaffinity(0, sizeof(mask1), &mask1);
    //__asm__ __volatile__ ( "vzeroupper" : : : ); // It is hear because of that bug which dirtied the AVX registers, so, if you rely on AVX uncomment it.
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2019-02-01T11:09:31.433

**`sched_setaffinity`+`sched_getaffinity`最小的 C 可运行示例**

这个例子摘自我的回答：[How to use sched_getaffinity and sched_setaffinity in Linux from C?](https://stackoverflow.com/questions/10490756/how-to-use-sched-getaffinity-and-sched-setaffinity-in-linux-from-c/50117787#50117787) 我相信这些问题不是重复的，因为它是这个问题的一个子集，因为它只询问`sched_getaffinity`，并且没有提到 C++。

在这个例子中，我们获取了affinity，修改它，并检查它是否已经生效[`sched_getcpu()`](https://stackoverflow.com/a/16574301/895245)。

主程序

```
#define _GNU_SOURCE
#include <assert.h>
#include <sched.h>
#include <stdbool.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

void print_affinity() {
    cpu_set_t mask;
    long nproc, i;

    if (sched_getaffinity(0, sizeof(cpu_set_t), &mask) == -1) {
        perror("sched_getaffinity");
        assert(false);
    }
    nproc = sysconf(_SC_NPROCESSORS_ONLN);
    printf("sched_getaffinity = ");
    for (i = 0; i < nproc; i++) {
        printf("%d ", CPU_ISSET(i, &mask));
    }
    printf("\n");
}

int main(void) {
    cpu_set_t mask;

    print_affinity();
    printf("sched_getcpu = %d\n", sched_getcpu());
    CPU_ZERO(&mask);
    CPU_SET(0, &mask);
    if (sched_setaffinity(0, sizeof(cpu_set_t), &mask) == -1) {
        perror("sched_setaffinity");
        assert(false);
    }
    print_affinity();
    /* TODO is it guaranteed to have taken effect already? Always worked on my tests. */
    printf("sched_getcpu = %d\n", sched_getcpu());
    return EXIT_SUCCESS;
} 
```

[GitHub 上游](https://github.com/cirosantilli/linux-kernel-module-cheat/blob/4aff114c4c654014a97ef23b1513dda5409e79f3/userland/linux/sched_getaffinity.c).

编译并运行：

```
gcc -ggdb3 -O0 -std=c99 -Wall -Wextra -pedantic -o main.out main.c
./main.out 
```

样本输出：

```
sched_getaffinity = 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
sched_getcpu = 9
sched_getaffinity = 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
sched_getcpu = 0 
```

意思就是：

*   最初，我的所有 16 个内核都已启用，并且该进程在内核 9（第 10 个）上随机运行
*   在我们将亲和性设置为仅第一个核心后，进程必然移动到核心 0（第一个）

通过以下方式运行此程序也很有趣`taskset`：

```
taskset -c 1,3 ./a.out 
```

这给出了形式的输出：

```
sched_getaffinity = 0 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 
sched_getcpu = 2
sched_getaffinity = 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
sched_getcpu = 0 
```

所以我们看到它从一开始就限制了亲和力。

这是因为亲和性是由子进程继承的，即`taskset`分叉：[如何防止子分叉进程继承 CPU 亲和性？](https://stackoverflow.com/questions/8336191/how-to-prevent-inheriting-cpu-affinity-by-child-forked-process)

**蟒蛇：`os.sched_getaffinity`和`os.sched_setaffinity`**

请参阅：[如何使用 python 找出 CPU 的数量](https://stackoverflow.com/questions/1006289/how-to-find-out-the-number-of-cpus-using-python/55423170#55423170)

在 Ubuntu 16.04 中测试。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-11T14:20:56.817

简而言之

```
unsigned long mask = 7; /* processors 0, 1, and 2 */
unsigned int len = sizeof(mask);
if (sched_setaffinity(0, len, &mask) < 0) {
    perror("sched_setaffinity");
} 
```

查看[CPU Affinity](http://www.linuxjournal.com/article/6799 "CPU 亲和性")以获取更多详细信息

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-11-22T22:52:14.187

也可以通过 shell 实现，而无需对带有[cgroups](https://man7.org/linux/man-pages/man7/cgroups.7.html)和*cpuset*子系统的程序进行任何修改。Cgroups（至少 v1）通常安装在cpuset*子系统*所在的*/sys/fs/cgroup上。*例如：

 *```
$ ls -l /sys/fs/cgroup/
total 0
drwxr-xr-x 15 root root 380 nov.   22 20:00 ./
drwxr-xr-x  8 root root   0 nov.   22 20:00 ../
dr-xr-xr-x  2 root root   0 nov.   22 20:00 blkio/
[...]
lrwxrwxrwx  1 root root  11 nov.   22 20:00 cpuacct -> cpu,cpuacct/
dr-xr-xr-x  2 root root   0 nov.   22 20:00 cpuset/
dr-xr-xr-x  5 root root   0 nov.   22 20:00 devices/
dr-xr-xr-x  3 root root   0 nov.   22 20:00 freezer/
[...] 
```

在*cpuset*下，*cpuset.cpus*定义了允许属于该 cgroup 的进程运行的 CPU 范围。在这里，在顶层，为系统的所有进程配置了所有 CPU。在这里，系统有 8 个 CPU：

```
$ cd /sys/fs/cgroup/cpuset
$ cat cpuset.cpus
0-7 
```

属于该 cgroup 的进程列表在*cgroup.procs*文件中列出：

```
$ cat cgroup.procs
1
2
3
[...]
12364
12423
12424
12425
[...] 
```

可以创建允许一部分 CPU 进入的子 cgroup。例如，让我们定义一个具有 CPU 核心 1 和 3 的子 cgroup：

```
$ pwd
/sys/fs/cgroup/cpuset
$ sudo mkdir subset1
$ cd subset1
$ pwd
/sys/fs/cgroup/cpuset/subset1
$ ls -l 
total 0
-rw-r--r-- 1 root root 0 nov.   22 23:28 cgroup.clone_children
-rw-r--r-- 1 root root 0 nov.   22 23:28 cgroup.procs
-rw-r--r-- 1 root root 0 nov.   22 23:28 cpuset.cpu_exclusive
-rw-r--r-- 1 root root 0 nov.   22 23:28 cpuset.cpus
-r--r--r-- 1 root root 0 nov.   22 23:28 cpuset.effective_cpus
-r--r--r-- 1 root root 0 nov.   22 23:28 cpuset.effective_mems
-rw-r--r-- 1 root root 0 nov.   22 23:28 cpuset.mem_exclusive
-rw-r--r-- 1 root root 0 nov.   22 23:28 cpuset.mem_hardwall
-rw-r--r-- 1 root root 0 nov.   22 23:28 cpuset.memory_migrate
-r--r--r-- 1 root root 0 nov.   22 23:28 cpuset.memory_pressure
-rw-r--r-- 1 root root 0 nov.   22 23:28 cpuset.memory_spread_page
-rw-r--r-- 1 root root 0 nov.   22 23:28 cpuset.memory_spread_slab
-rw-r--r-- 1 root root 0 nov.   22 23:28 cpuset.mems
-rw-r--r-- 1 root root 0 nov.   22 23:28 cpuset.sched_load_balance
-rw-r--r-- 1 root root 0 nov.   22 23:28 cpuset.sched_relax_domain_level
-rw-r--r-- 1 root root 0 nov.   22 23:28 notify_on_release
-rw-r--r-- 1 root root 0 nov.   22 23:28 tasks
$ cat cpuset.cpus

$ sudo sh -c "echo 1,3 > cpuset.cpus"
$ cat cpuset.cpus 
1,3 
```

在将任何进程移入此 cgroup 之前，必须填充*cpuset.mems文件。*在这里，我们将当前的 shell 移动到这个新的 cgroup 中（我们只是将进程的 pid 写入到*cgroup.procs*文件中）：

```
$ cat cgroup.procs

$ echo $$
4753
$ sudo sh -c "echo 4753 > cgroup.procs"
sh: 1: echo: echo: I/O error
$ cat cpuset.mems

$ sudo sh -c "echo 0 > cpuset.mems"
$ cat cpuset.mems
0
$ sudo sh -c "echo 4753 > cgroup.procs"
$ cat cgroup.procs
4753
12569 
```

后者显示当前 shell (pid#4753) 现在位于新创建的 cgroup 中（第二个 pid 12569 是*cat*的命令之一，作为当前 shell 的子级，它继承了它的 cgroups）。使用格式化的*ps*命令，可以验证进程在哪个 CPU 上运行（*PSR*列）：

```
$ ps -o pid,ppid,psr,command
    PID    PPID PSR COMMAND
   4753    2372   3 bash
  12672    4753   1 ps -o pid,ppid,psr,command 
```

我们可以看到当前 shell 正在 CPU#3 上运行，其继承其 cgroups的子 ( *ps命令) 正在 CPU#1 上运行。*

作为结论，可以不使用*sched_setaffinity()*或任何*pthread*服务，而是在 cgroups 树中创建一个*cpuset*层次结构，并通过将进程的 pid 写入相应的*cgroup.procs*文件中来将进程移动到其中。

# video - 如何将照片和声音文件组合成 youtube 上可接受的视频文件？

> ID：280913
> 
> 赞同：1
> 
> 时间：2008-11-11T13:48:24.793
> 
> 标签：video, audio, youtube

我想将照片和一些声音文件组合在一起并上传到 youtube，不知道该怎么做。

任何建议都会非常有帮助。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T13:50:39.437

在我看来，免费的 Movie Maker 在 Windows 上是小型 youtube 视频的最佳解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T14:06:44.957

谢谢。

那是用户界面工具，我希望我能找到一些 Web API 工具，以便我的应用程序可以以编程方式调用它。

顺便说一句，我找到了一个站点：[http](http://www.mediaconverter.org/) ://www.mediaconverter.org/进行手动上传。

有什么建议吗？

# sql-server-2005 - ROLAP 不起作用 - 如何为 ROLAP 设计多维数据集/DSV？

> ID：280914
> 
> 赞同：2
> 
> 时间：2008-11-11T13:49:06.507
> 
> 标签：sql-server-2005, ssas, rolap

我正在尝试为现有 SSAS 多维数据集中的分区配置存储模式 ROLAP。多维数据集有点混乱，因为度量值组是由命名查询（而不是表）定义的，而维度是在几个不同的数据源视图 (DSV) 中定义的。

这是我在使用 mdx 查询多维数据集时收到的错误消息：

```
Executing the query ...
Server: The operation has been cancelled.
Errors in the high-level relational engine. The 'dbo_dim_account' table that is required for a join cannot be reached based on the relationships in the data source view.
Execution complete 
```

请注意，具有主动缓存的 MOLAP 存储模式可以正常工作。仅当存储模式为 ROLAP 或 HOLAP 时才会出现此问题。

另外，我尝试将所有维度的表添加到相关多维数据集的 DSV 中，但这似乎没有帮助。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-13T20:49:52.617

这里不是专家，但您可以尝试在 Visual Studio.NET 中导入 AS DB - 在“新项目...”对话框中的“导入分析服务数据库”。

在那里，您可以看到数据源视图的表模式（这是定义关系表的地方，从中提取多维数据集）。接下来，确保“dbo_dim_account”表存在并且您的事实表与其相关。

维度和事实可能必须在同一个 DSV 中才能使关系起作用？

另外，也许 SSAS 飞行记录器或应用程序日志会有更多问题？

# java - 在 Java 中查明 Sun Directory Server 5.2 中的 LDAP 用户是否被锁定

> ID：280922
> 
> 赞同：3
> 
> 时间：2008-11-11T13:51:30.637
> 
> 标签：java, spring, ldap, sun

我正在开发一个使用 Java、Tomcat、Spring Framework 和 Spring LDAP 1.2.1 进行 LDAP 访问的应用程序。

根据我们的 LDAP 管理员的说法，如果某个特定用户被锁定在目录中，则无法以编程方式查明 - 只是不会返回该用户。这让我很难过，因为我需要识别被锁定的用户。

我们的管理员是否正确，或者是否有可能找出某个特定用户是否被锁定？如果是，如何？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T14:16:26.780

我会回答自己：原来有一个属性nsaccountlock，可以用于此目的。无法与被锁定的用户绑定，但可以搜索。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-18T11:19:33.817

passwordretryont 属性还建议帐户是否被锁定。通常，LDAP 配置为允许最多 3 次登录尝试。如果 3 次尝试全部失败，密码重试计数将设置为 3。值为 0 表示帐户未锁定。

# c# - 如何验证 ASP 密码登录表单？

> ID：280923
> 
> 赞同：0
> 
> 时间：2008-11-11T13:52:08.730
> 
> 标签：c#, ado.net

我有一个 ADO.Net 登录表单作为我的前端，我想检查用户输入的用户名和密码是否与数据库中的正确值匹配。我怎样才能尽可能容易地做到这一点？

顺便说一下，我在数据库中的用户信息表叫Login。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T13:56:00.033

1.  不要在数据库中存储纯文本密码。**绝不。**
2.  ASP.NET 登录表单有一个 OnLogin 或类似的事件。您需要为其附加一个方法。
3.  在数据库中查询尝试登录的用户的凭据。即：

SELECT * FROM LOGIN WHERE USERNAME = @P_USERNAME;

然后将您从数据库中获得的密码与用户输入的密码进行比较，您就完成了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T13:56:46.303

请改用[Membership 提供程序](http://msdn.microsoft.com/en-us/library/f1kyba5e.aspx)。比使用登录控件。

布鲁诺·菲格雷多

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T13:57:39.967

对于最少的代码行，使用表单身份验证和 asp 登录控件：

[http://msdn.microsoft.com/en-us/library/ms178331.aspx](http://msdn.microsoft.com/en-us/library/ms178331.aspx)

# linux - 如何编写标准 Linux 构建脚本？

> ID：280938
> 
> 赞同：0
> 
> 时间：2008-11-11T13:57:02.887
> 
> 标签：linux

我将再次重建我的 Linux 机器。我必须创建一些用户组、用户帐户并安装我的标准包。到目前为止，我只是使用了 GUI 工具。我想知道在我对最新的 Fedora 版本进行最小安装后，是否有人对编写脚本来创建用户、组和安装标准包有任何建议？有时我运行 Ubuntu，所以我希望脚本有点通用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T23:33:07.467

对于 .deb 发行版，使用[FAI](http://www.informatik.uni-koeln.de/fai/)。对于 .rpm 发行版，使用[Kickstart](http://www.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5.2/html/Installation_Guide/ch-kickstart2.html)。对于安装后的系统管理，请使用[cfengine](http://www.cfengine.org/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T14:31:24.113

Fedora 和 Ubuntu 使用完全不同的包管理器，所以你不能以任何通用的方式轻松地做到这一点。

在 CentOS（它是 RedHat 企业版，序列号已归档，因此非常接近 Fedora），我们[使用 Kickstart 文件来](http://www.redhat.com/docs/manuals/linux/RHL-9-Manual/custom-guide/ch-kickstart2.html)完成此操作。这些文件具有简单的语法，使您能够指定要安装的用户、组和包，甚至可以编写一些自定义内容的脚本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-11T14:36:05.880

虽然我还没有这样做，但我有一个类似的问题。我正在考虑一个虚拟化主机和多个客户端操作系统（Ubuntu 和 CentOS 是前 2 名候选者）——这样，一旦我按照我的需要配置了客户端，我就可以将其保存起来，以便根据需要重新加载。

无法解决最初的设置问题，但确实限制了“再次重建我的 Linux 机器”问题。

你可能想考虑一下。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-11T14:50:39.800

这可能有点矫枉过正，但您可以查看[Puppet](http://reductivelabs.com/trac/puppet)。

从他们的网站：

> Puppet 是一个用于自动执行系统管理任务的系统。

我刚刚开始寻找自动化系统管理的方法，所以我还没有太多经验。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T15:16:49.747

如果您需要做的只是创建用户和组并安装软件包，那么我建议您只编写两个单独的脚本。

可能是您可以共享用户和组部分，但前提是您使用的所有发行版都具有相同的创建策略（例如，Ubuntu 为每个用户创建一个组，而我确信某些发行版具有“用户”组作为好）。

您可以查看应该随处可用的 useradd 和 groupadd 命令。对于 Ubuntu，还有更友好的 adduser 和 addgroup，如果 Fedora 有一组类似的命令，我不会感到惊讶。

设置组后，您只需向软件包管理器提供您需要安装的软件包的大列表。尝试安装已安装的软件包应该是安全的，因此您可以在“干净”的新安装中安装所需的软件包，然后转储软件包列表。

总结一下：如果您不打算支持两个以上的发行版，那么我建议您分别编写两个脚本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-11T14:50:37.520

帮助不断重建盒子的另一个选项是 Norton Ghost，您可以使用 ghost 制作映像，然后根据需要重新映像驱动器。您安装它并根据自己的喜好对其进行配置，然后拍摄图像。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T14:51:45.570

使脚本通用化会很困难，但是您可以使用任何类型的脚本工具（bash 或 ruby​​ 或其他）并尝试检查正在运行的发行版，然后运行适当的命令来安装软件。有多种方法可以检查[此处运行的发行版](https://stackoverflow.com/questions/264290/how-to-discover-what-linux-distro-is-in-use)

在所有发行版上创建组应该是相同的，您甚至可以放入已经配置的 /etc/passwd 和 /etc/groups （尽管我没有尝试过，它可能不起作用）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-11T15:36:27.163

上面关于使用不同方法的不同发行版的回应已经死了。这就像试图为雪佛兰和福特使用相同的部件（对你来说，这就是汽车的类比）。

我发现的最简单的方法是学习为不同的挂载点设置分区，即 / ；/家 ; /var ; /opt 是大的。

这使您可以在重建期间保留您的用户、组和许多应用程序。更改发行版会破坏很多东西，但您的用户帐户应该仍然存在。

# c - 动态调用带有可变参数参数的 C 函数

> ID：280940
> 
> 赞同：15
> 
> 时间：2008-11-11T13:57:07.147
> 
> 标签：c

我在 C 语言中针对第三方库（在 HP/Mercury Loadrunner 中）进行编程，该库允许其中一个函数使用 varargs 样式的可变大小参数列表。我想调用这个函数，但我不知道我会有多少参数。

我的一位前辈制作了一个功能，但这里的问题是这个函数假设了最坏的情况（超过 3000 个参数）和手动代码。

为了说明，这是代码（开始）。我们调用的函数是`web_submit_data()`. 它将 HTTP 发布一组表单数据。这种实现是在处理具有任意数量字段的动态生成的表单时出现的。（从原版中清理了相当多的内容，其中也手动编码了索引..）

* * *

```
web_submit_data_buffer_gazillion_items( const char *bufferName, const char *bufferValue)
{
    const int size = 129;
    int i = 0;
    int j = 11;

    web_submit_data(&bufferName[i++ * size], //"some form"
                &bufferName[i++ * size], //"Action=https://blah.blah/form");
                &bufferName[i++ * size], //"Method=POST");
                &bufferName[i++ * size], //"TargetFrame=");
                &bufferName[i++ * size], //"RecContentType=text/html");
                &bufferName[i++ * size], //"Referer=https://blah.blah/index.html");
                &bufferName[i++ * size], //"Snapshot=t1.inf");
                &bufferName[i++ * size], //"Mode=HTML");
                ITEMDATA,  // missing in action: indexes 8 through 10
                &bufferName[j * size],&bufferValue[j++ * size], ENDITEM, 
                &bufferName[j * size],&bufferValue[j++ * size], ENDITEM, 
                &bufferName[j * size],&bufferValue[j++ * size], ENDITEM, 
..
(repeat the last 3 lines ad nauseum)
..
                &bufferName[j * size],&bufferValue[j++ * size], ENDITEM,
                &bufferName[j * size]);  
} 
```

现在我找到了一个可能工作的外部库（[http://www.dyncall.org](http://www.dyncall.org)），但我宁愿不 a) 完全依赖处理器，b) 尝试教 Loadrunner 关于外部源的链接..

编辑：原始函数使用硬编码索引而不是使用变量。如果事实证明太不可预测，仍然可以恢复到那个状态。但是，由于我不太可能使用不同的编译器或硬件/操作系统来运行它，我怀疑这真的值得。

另外：我无法控制 web_submit_data() 的实现。因此，仅将问题推低一级并不能解决问题。

另一件需要注意的事情：规范`web_submit_data()`使用名为 LAST 的常量来标记参数列表的结尾。原始实现不使用它。大概呼叫站点确实..

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-12T09:43:30.340

在 CamelBones 中，我使用[libffi](http://sourceware.org/libffi/)调用 objc_msgSend()，这是一个可变参数函数。工作一种享受。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-12T09:53:33.207

可变长度参数基本上只是一个指向传递给所​​需函数的一堆打包数据的指针。被调用函数负责解释这些打包数据。

架构安全的方法是使用 va_list 宏（n-alexander 提到的），否则您可能会遇到如何在内存中填充各种数据类型的问题。

设计可变参数函数的正确方法是实际上有两个版本，一个接受“...”，然后提取 va_list 并将其传递给一个接受 va_list 的函数。这样，您可以在需要时动态构造参数，并且可以调用函数的 va_list 版本。

大多数标准 IO 函数都有可变参数版本：vprintf 用于 printf，vsprintf 用于 sprintf ......你明白了。看看你的库是否实现了一个名为“vweb_submit_data”的函数或类似的东西。如果他们不这样做，请给他们发电子邮件并告诉他们修复他们的库。

3000 行相同的东西（即使它是由预处理器引起的）让我畏缩

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T18:19:07.973

由于将比函数期望的变量参数*更多*的参数传递给函数通常不是问题（参见脚注 #1），因此您可以执行以下操作：

```
// you didn't give a clear specification of what you want/need, so this 
// example may not be quite what you want as I've had to guess at
// some of the specifications. Hopefully the comments will make clear
// what I may have assumed.
//
// NOTE:  while I have compiled this example, I have not tested it,
//        so there is a distinct possiblity of bugs (particularly
//        off-by-one errors). Check me on this stuff, please.

// I made these up so I could compile the example
#define ITEMDATA ((char const*) NULL)
#define ENDITEM  ((char const*) 0xffffffff)

void web_submit_data_wrapper( const char*bufferName, 
                              const char* bufferValue, 
                              size_t headerCount,       // number of header pointers to pass (8 in your example)
                              size_t itemStartIndex,    // index where items start in the buffers (11 in your example)
                              size_t itemCount,         // number of items to pass (unspecified in your example)
                              size_t dataSize )         // size of each header or item (129 in your example)
{
    // kMaxVarArgs would be 3000 or a gazillion in your case

    // size_t const kMaxVarArgs = 20;  // I'd prefer to use this in C++
    #define kMaxVarArgs (20)

    typedef char const* char_ptr_t;
    typedef char_ptr_t char_ptr_array_t[kMaxVarArgs];

    char_ptr_array_t varargs = {0};

    size_t idx = 0;

    // build up the array of pararmeters we'll pass to the variable arg list

    // first the headers
    while (headerCount--) {
        varargs[idx++] = &bufferName[idx * dataSize];
    }

    // mark the end of the header data
    varargs[idx++] = ITEMDATA;

    // now the "items"
    while (itemCount--) {
        varargs[idx++] = &bufferName[itemStartIndex * dataSize];
        varargs[idx++] = &bufferValue[itemStartIndex * dataSize];
        varargs[idx++] = ENDITEM;

        ++itemStartIndex;
    }

    // the thing after the last item 
    // (I'm not sure what this is from your example)
    varargs[idx] = &bufferName[itemStartIndex * dataSize];

    // now call the target function - the fact that we're passing more arguments
    //  than necessary should not matter due to the way VA_ARGS are handled 
    //  but see the Footnote in the SO answer for a disclaimer

    web_submit_data( 
        varargs[0],
        varargs[1],
        varargs[2],

        //... ad nasuem until

        varargs[kMaxVarArgs-1]
        );

} 
```

* * *

脚注#1：如果您考虑一下宏在实际中的`stdargs.h`作用，这将变得很清楚。但是，我并不声称这种技术符合标准。事实上，在最近的历史中，我在我发布此免责声明的地方发布的 stackoverflow 答案实际上已被发现不符合标准（通常由警惕的[litb 提供](https://stackoverflow.com/users/34509/litb)）。因此，使用这种技术需要您自担风险，并验证、验证、验证）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-11T14:18:00.520

没有可移植的方法在运行时为 C 中的可变参数函数构建参数列表。那里有一些依赖于实现的[技巧](http://c-faq.com/varargs/wacky.html)，您发现的 dyncall 库看起来不错，并且可能比大多数更可移植。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T17:41:56.083

请注意，您发布的代码示例具有未定义的行为 - 分隔函数参数的逗号不是序列点（这些逗号不是逗号运算符），因此在函数调用参数列表中修改`i`和/或`j`多次会导致未定义的行为。

更不用说标准没有指定函数调用参数的评估顺序 - 所以即使您修改`i`并`j`使用函数来评估参数（函数调用本身就是序列点），您几乎可以通过指针的顺序不确定。

另外，我不知道如何`web_submit_data()`知道它已经通过了多少个参数 - 最后我没有看到计数或明确的哨兵参数。但我想你的例子可能就是这样——一个可能没有完整、准确细节的例子。另一方面，`web_submit_data()`无论如何，这都是问题，对吧？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-12T08:51:32.753

There are two way to pass a variable number of arguments: to a function that accepts "..." or to a function that accepts va_list.

You can not dynamically define the number of arguments for the "..." interface, but you should be able to do so for the va_list one. Google for va_start, va_end, and va_list.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-11T14:33:42.767

注意：代码已经依赖于编译器（尽管可能不依赖于处理器），因为调用`web_submit_data`假设过程调用中的参数子表达式是从左到右的顺序计算的，但是 C 语言的顺序是参数评估未指定。

请参阅：[http ://en.wikipedia.org/wiki/Evaluation_strategy#Call_by_value](http://en.wikipedia.org/wiki/Evaluation_strategy#Call_by_value)

因此，也许非便携式解决方案不会让您的情况变得更糟。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-11T14:43:25.257

你可以重组你的代码，这样就没有必要了吗？也许您可以采用传入缓冲区并使其更具确定性：

```
struct form_field
{
  char[FIELD_NAME_MAX] name;
  char[FIELD_VALUE_MAX] val;
};

web_submit_data_buffer_gazillion_items( const char *bufferName, const char *bufferValue)
{
    /*
      loop over bufferName somehow, either with a known size or terminating record,
      and build an array of form_field records
    */
    //loop
    {
      // build array of records
    }

    web_submit_data(record_array, array_len);

} 
```

抱歉，这不能再充实了——我的妻子叫我进来吃早餐。:-)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-11T15:10:39.713

用预处理器编写一次，永不回头。

```
#define WEB_SUBMIT_BUFFER(name, val)         \
    do {                                     \
        const int size = 129;                \
        int i = 0;                           \
        int j = 11;                          \
        web_submit_data(&(name)[i++ * size], \
                        &(name)[i++ * size], \
        /* etc ad nauseum */                 \
    } while (0) 
```

或者，如果每个特定调用的参数数量是固定的，则编写一个脚本来生成预处理器定义以隐藏该调用的令人发指的程度。

```
#define WEB_SUBMIT_BUFFER_32(name, val)      \
    do {                                     \
        const int size = 129;                \
        int i = 0;                           \
        int j = 11;                          \
        web_submit_data(&(name)[i++ * size], \
                        &(name)[i++ * size], \
        /* 32 times */                       \
    } while (0)
#define WEB_SUBMIT_BUFFER_33(name, val) ...
#define WEB_SUBMIT_BUFFER_34(name, val) /* etc */ 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-01-25T15:18:37.783

我知道这是一个旧线程，但我只是遇到了它。在 LoadRunner 中处理可变长度提交表单数据的正确方法是使用 web_custom_request()。您为参数的可变长度构建名称|值对结构作为字符串，并将其作为函数的一部分传入。

将一次调用记录为 web_custom_request() ，名称|值对的参数字符串的结构将变得显而易见。只需使用您希望构造相关字符串的任何 C 字符串处理函数，并将其作为 web_custom_request() 的参数列表的一部分包含在内。

# c# - 使用业务对象对 DataGridView 列进行排序

> ID：280948
> 
> 赞同：5
> 
> 时间：2008-11-11T13:58:55.037
> 
> 标签：c#, .net, datagridview

我正在像这样设置我的 DataGridView：

```
 jobs = new List<DisplayJob>();

        uxJobList.AutoGenerateColumns = false;
        jobListBindingSource.DataSource = jobs;
        uxJobList.DataSource = jobListBindingSource;

        int newColumn;
        newColumn = uxJobList.Columns.Add("Id", "Job No.");
        uxJobList.Columns[newColumn].DataPropertyName = "Id";
        uxJobList.Columns[newColumn].DefaultCellStyle.Format = Global.JobIdFormat;
        uxJobList.Columns[newColumn].DefaultCellStyle.Font = new Font(uxJobList.DefaultCellStyle.Font, FontStyle.Bold);
        uxJobList.Columns[newColumn].AutoSizeMode = DataGridViewAutoSizeColumnMode.None;
        uxJobList.Columns[newColumn].Width = 62;
        uxJobList.Columns[newColumn].Resizable = DataGridViewTriState.False;
        uxJobList.Columns[newColumn].SortMode = DataGridViewColumnSortMode.Automatic;
        :
        : 
```

DisplayJob 类如下所示：

```
 public class DisplayJob
{
    public DisplayJob(int id)
    {
        Id = id;
    }

    public DisplayJob(JobEntity job)
    {
        Id = job.Id;
        Type = job.JobTypeDescription;
        CreatedAt = job.CreatedAt;
        StartedAt = job.StartedAt;
        ExternalStatus = job.ExternalStatus;
        FriendlyExternalStatus = job.FriendlyExternalStatus;
        ExternalStatusFriendly = job.ExternalStatusFriendly;
        CustomerName = job.Customer.Name;
        CustomerKey = job.Customer.CustomerKey;
        WorkAddress = job.WorkAddress;
        CreatedBy = job.CreatedBy;
        CancelledAt = job.CancelledAt;
        ClosedAt = job.ClosedAt;
        ReasonWaiting = job.ReasonWaiting;
        CancelledBy = job.CancelledBy;
        CancelledReason = job.CancelledReason;
        DisplayCreator = Global.GetDisplayName(CreatedBy);
        ActionRedoNeeded = job.ActionRedoNeeded;
        if (job.Scheme != null)
        {
            SchemeCode = job.Scheme.Code;
        }

    }

    public int Id { get; private set; }
    public string Type { get; private set; }
    public DateTime CreatedAt { get; private set; }
    public DateTime? StartedAt { get; private set; }
    public string ExternalStatus { get; private set; }
    public string FriendlyExternalStatus { get; private set; }
    public string ExternalStatusFriendly { get; private set; }
    public string CustomerName { get; private set; }
    public string CustomerKey { get; private set; }
    public string WorkAddress { get; private set; }
    public string CreatedBy { get; private set; }
    public DateTime? CancelledAt { get; private set; }
    public DateTime? ClosedAt { get; private set; }
    public string CancelledBy { get; private set; }
    public string ReasonWaiting { get; private set; }
    public string DisplayCreator { get; private set; }
    public string CancelledReason { get; private set; }
    public string SchemeCode { get; private set; }
    public bool ActionRedoNeeded { get; private set; }
} 
```

但是列排序不起作用。让这个工作的最佳方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-11T14:17:50.990

如果您想支持对集合进行排序和搜索，**只需从您的 BindingList 参数化类型派生一个类**，并覆盖一些基类方法和属性。

最好的方法是扩展 BindingList 并执行以下操作：

```
protected override bool SupportsSearchingCore
{
    get
    {
        return true;
    }
}

protected override bool SupportsSortingCore
{
    get { return true; }
} 
```

您还需要实现排序代码：

```
ListSortDirection sortDirectionValue;
PropertyDescriptor sortPropertyValue;

protected override void ApplySortCore(PropertyDescriptor prop, 
    ListSortDirection direction)
{
    sortedList = new ArrayList();

    // Check to see if the property type we are sorting by implements
    // the IComparable interface.
    Type interfaceType = prop.PropertyType.GetInterface("IComparable");

    if (interfaceType != null)
    {
        // If so, set the SortPropertyValue and SortDirectionValue.
        sortPropertyValue = prop;
        sortDirectionValue = direction;

        unsortedItems = new ArrayList(this.Count);

        // Loop through each item, adding it the the sortedItems ArrayList.
        foreach (Object item in this.Items) {
            sortedList.Add(prop.GetValue(item));
            unsortedItems.Add(item);
        }
        // Call Sort on the ArrayList.
        sortedList.Sort();
        T temp;

        // Check the sort direction and then copy the sorted items
        // back into the list.
        if (direction == ListSortDirection.Descending)
            sortedList.Reverse();

        for (int i = 0; i < this.Count; i++)
        {
            int position = Find(prop.Name, sortedList[i]);
            if (position != i) {
                temp = this[i];
                this[i] = this[position];
                this[position] = temp;
            }
        }

        isSortedValue = true;

        // Raise the ListChanged event so bound controls refresh their
        // values.
        OnListChanged(new ListChangedEventArgs(ListChangedType.Reset, -1));
    }
    else
        // If the property type does not implement IComparable, let the user
        // know.
        throw new NotSupportedException("Cannot sort by " + prop.Name +
            ". This" + prop.PropertyType.ToString() + 
            " does not implement IComparable");
} 
```

如果您需要更多信息，您可以随时去那里获取有关[如何扩展绑定列表的](http://msdn.microsoft.com/en-us/library/aa480736.aspx)所有说明。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-11T19:57:50.460

Daok 的解决方案是正确的。它也经常比它的价值更多的工作。

懒人获得所需功能的方法是从业务对象中创建和填充 DataTable，并将 DataGridView 绑定到它。

这种方法无法处理很多用例（例如编辑），而且显然浪费时间和空间。正如我所说，它很懒惰。

但它很容易编写，并且生成的代码比`IBindingList`.

此外，无论如何，您已经编写了很多代码，或者至少是类似的代码：您编写定义 DataTable 的代码使您不必编写代码来创建 DataGridView 的列，因为 DataGridView 将构建它的列绑定数据表时关闭它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-11T14:07:38.543

最简单的方法之一是使用[BindingListView](http://blw.sourceforge.net/)类来包装您的 DisplayJobs 列表。该类实现了一些在 DataGridView 中启用排序和筛选所需的接口。那是快速的方法。不过，它工作得很好——唯一需要注意的是，如果你从 DataGridView 中投射东西，你需要投射到包装对象 (ObjectView) 而不是实际项目 (DisplayJob)。

不太懒惰的方法是创建一个实现 IBindingList 的自定义集合时间，在那里实现排序方法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-01-22T07:30:32.943

Daok 建议的 MS 文章让我走上了正轨，但我对 MS 的 SortableSearchableList 实现并不满意。我发现这个实现很奇怪，当列中有重复值时它不能很好地工作。它也不会覆盖 DataGridView 似乎需要的 IsSortedCore。如果 IsSortedCore 未被覆盖，则不会出现搜索字形，并且无法在升序和降序之间切换。

请参阅下面我的 SortableSearchableList 版本。在 ApplySortCore() 中，它使用设置为匿名方法的比较委托进行排序。此版本还支持为特定属性设置自定义比较，可以由派生类使用 AddCustomCompare() 添加。

我不确定版权声明是否仍然适用，但我只是把它留在了里面。

```
//---------------------------------------------------------------------
//  Copyright (C) Microsoft Corporation.  All rights reserved.
// 
//THIS CODE AND INFORMATION ARE PROVIDED AS IS WITHOUT WARRANTY OF ANY
//KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
//IMPLIED WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A
//PARTICULAR PURPOSE.
//---------------------------------------------------------------------

using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;
using System.Reflection;
using System.Collections;

namespace SomethingSomething
{
    /// <summary>
    /// Supports sorting of list in data grid view.
    /// </summary>
    /// <typeparam name="T">Type of object to be displayed in data grid view.</typeparam>
    public class SortableSearchableList<T> : BindingList<T>
    {
        #region Data Members

        private ListSortDirection _sortDirectionValue;
        private PropertyDescriptor _sortPropertyValue = null;

        /// <summary>
        /// Dictionary from property name to custom comparison function.
        /// </summary>
        private Dictionary<string, Comparison<T>> _customComparisons = new Dictionary<string, Comparison<T>>();

        #endregion

        #region Constructors

        /// <summary>
        /// Default constructor.
        /// </summary>
        public SortableSearchableList()
        {
        }

        #endregion

        #region Properties

        /// <summary>
        /// Indicates if sorting is supported.
        /// </summary>
        protected override bool SupportsSortingCore
        {
            get
            {
                return true;
            }
        }

        /// <summary>
        /// Indicates if list is sorted.
        /// </summary>
        protected override bool IsSortedCore
        {
            get
            {
                return _sortPropertyValue != null;
            }
        }

        /// <summary>
        /// Indicates which property the list is sorted.
        /// </summary>
        protected override PropertyDescriptor SortPropertyCore
        {
            get
            {
                return _sortPropertyValue;
            }
        }

        /// <summary>
        /// Indicates in which direction the list is sorted on.
        /// </summary>
        protected override ListSortDirection SortDirectionCore
        {
            get
            {
                return _sortDirectionValue;
            }
        }

        #endregion

        #region Methods       

        /// <summary>
        /// Add custom compare method for property.
        /// </summary>
        /// <param name="propertyName"></param>
        /// <param name="compareProperty"></param>
        protected void AddCustomCompare(string propertyName, Comparison<T> comparison)
        {
            _customComparisons.Add(propertyName, comparison);
        }

        /// <summary>
        /// Apply sort.
        /// </summary>
        /// <param name="prop"></param>
        /// <param name="direction"></param>
        protected override void ApplySortCore(PropertyDescriptor prop, ListSortDirection direction)
        {
            Comparison<T> comparison;
            if (!_customComparisons.TryGetValue(prop.Name, out comparison))
            {
                // Check to see if the property type we are sorting by implements
                // the IComparable interface.
                Type interfaceType = prop.PropertyType.GetInterface("IComparable");
                if (interfaceType != null)
                {
                    comparison = delegate(T t1, T t2)
                        {
                            IComparable val1 = (IComparable)prop.GetValue(t1);
                            IComparable val2 = (IComparable)prop.GetValue(t2);
                            return val1.CompareTo(val2);
                        };
                }
                else
                {
                    // Last option: convert to string and compare.
                    comparison = delegate(T t1, T t2)
                        {
                            string val1 = prop.GetValue(t1).ToString();
                            string val2 = prop.GetValue(t2).ToString();
                            return val1.CompareTo(val2);
                        };
                }
            }

            if (comparison != null)
            {
                // If so, set the SortPropertyValue and SortDirectionValue.
                _sortPropertyValue = prop;
                _sortDirectionValue = direction;

                // Create sorted list.
                List<T> _sortedList = new List<T>(this);                   
                _sortedList.Sort(comparison);

                // Reverse order if needed.
                if (direction == ListSortDirection.Descending)
                {
                    _sortedList.Reverse();
                }

                // Update list.
                int count = this.Count;
                for (int i = 0; i < count; i++)
                {
                    this[i] = _sortedList[i];
                }

                // Raise the ListChanged event so bound controls refresh their
                // values.
                OnListChanged(new ListChangedEventArgs(ListChangedType.Reset, -1));
            }
        }

        // Method below was in the original implementation from MS. Don't know what it's for.
        // -- Martijn Boeker, Jan 21, 2010

        //protected override void RemoveSortCore()
        //{
        //    //int position;
        //    //object temp;
        //    //// Ensure the list has been sorted.
        //    //if (unsortedItems != null)
        //    //{
        //    //    // Loop through the unsorted items and reorder the
        //    //    // list per the unsorted list.
        //    //    for (int i = 0; i < unsortedItems.Count; )
        //    //    {
        //    //        position = this.Find(SortPropertyCore.Name,
        //    //            unsortedItems[i].GetType().
        //    //            GetProperty(SortPropertyCore.Name).
        //    //            GetValue(unsortedItems[i], null));
        //    //        if (position >= 0 && position != i)
        //    //        {
        //    //            temp = this[i];
        //    //            this[i] = this[position];
        //    //            this[position] = (T)temp;
        //    //            i++;
        //    //        }
        //    //        else if (position == i)
        //    //            i++;
        //    //        else
        //    //            // If an item in the unsorted list no longer exists, delete it.
        //    //            unsortedItems.RemoveAt(i);
        //    //    }
        //    //    OnListChanged(new ListChangedEventArgs(ListChangedType.Reset, -1));
        //    //}
        //}

        /// <summary>
        /// Ability to search an item.
        /// </summary>
        protected override bool SupportsSearchingCore
        {
            get
            {
                return true;
            }
        }

        /// <summary>
        /// Finds an item in the list.
        /// </summary>
        /// <param name="prop"></param>
        /// <param name="key"></param>
        /// <returns></returns>
        protected override int FindCore(PropertyDescriptor prop, object key)
        {
            // Implementation not changed from MS example code.

            // Get the property info for the specified property.
            PropertyInfo propInfo = typeof(T).GetProperty(prop.Name);
            T item;

            if (key != null)
            {
                // Loop through the the items to see if the key
                // value matches the property value.
                for (int i = 0; i < Count; ++i)
                {
                    item = (T)Items[i];
                    if (propInfo.GetValue(item, null).Equals(key))
                        return i;
                }
            }
            return -1;
        }

        /// <summary>
        /// Finds an item in the list.
        /// </summary>
        /// <param name="prop"></param>
        /// <param name="key"></param>
        /// <returns></returns>
        private int Find(string property, object key)
        {
            // Implementation not changed from MS example code.

            // Check the properties for a property with the specified name.
            PropertyDescriptorCollection properties =
                TypeDescriptor.GetProperties(typeof(T));
            PropertyDescriptor prop = properties.Find(property, true);

            // If there is not a match, return -1 otherwise pass search to
            // FindCore method.
            if (prop == null)
                return -1;
            else
                return FindCore(prop, key);
        }

        #endregion
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-11T14:04:49.797

我相信你的类必须实现`IComparable`接口。

希望能帮助到你，

布鲁诺·菲格雷多

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-01-26T05:42:04.977

我建议更换：

```
jobs = new List<DisplayJob>(); 
```

和：

```
jobs = new SortableBindingList<DisplayJob>(); 
```

SortableBindingList 的代码在这里：[http ://www.timvw.be/presenting-the-sortablebindinglistt/](http://www.timvw.be/presenting-the-sortablebindinglistt/)

我在生产中使用了基于此的代码，没有任何问题。唯一的限制是它不是一个稳定的排序。

如果您希望排序稳定，请替换：

```
itemsList.Sort(delegate(T t1, T t2)
{
    object value1 = prop.GetValue(t1);
    object value2 = prop.GetValue(t2);

    return reverse * Comparer.Default.Compare(value1, value2);
}); 
```

使用插入排序：

```
int j;
T index;
for (int i = 0; i < itemsList.Count; i++)
{
    index = itemsList[i];
    j = i;

    while ((j > 0) && (reverse * Comparer.Default.Compare(prop.GetValue(itemsList[j - 1]), prop.GetValue(index)) > 0))
    {
        itemsList[j] = itemsList[j - 1];
        j = j - 1;
    }

    itemsList[j] = index;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-26T01:03:18.187

Martijn 优秀的代码，但您只需要验证空单元格或空单元格的一个细节:)

```
if (!_customComparisons.TryGetValue(prop.Name, out comparison))
{
    // Check to see if the property type we are sorting by implements
    // the IComparable interface.
    Type interfaceType = prop.PropertyType.GetInterface("IComparable");
    if (interfaceType != null)
    {
        comparison = delegate(T t1, T t2)
            {
                IComparable val1 = (IComparable)prop.GetValue(t1) ?? "";
                IComparable val2 = (IComparable)prop.GetValue(t2) ?? "";
                return val1.CompareTo(val2);
            };
    }
    else
    {
        // Last option: convert to string and compare.
        comparison = delegate(T t1, T t2)
            {
                string val1 = (prop.GetValue(t1) ?? "").ToString();
                string val2 = (prop.GetValue(t2) ?? "").ToString();
                return val1.CompareTo(val2);
            };
    }
} 
```

这都是运气

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-04-14T11:39:36.470

您是否尝试为每一列设置 SortMemberPath？

`uxJobList.Columns[newColumn].SortMemberPath="Id";`

而不是 List im 只是使用 ObservableCollection

# sharepoint - 为什么我的 Web 部件会引发有关“NT 授权/匿名用户”的错误？

> ID：280951
> 
> 赞同：3
> 
> 时间：2008-11-11T14:00:05.673
> 
> 标签：sharepoint, kerberos, delegation

我的 Sharepoint 2007 Web 部件执行代码以启动 K2 工作流程。工作流服务器驻留在另一台服务器上。

当我的代码执行时，我收到以下错误：“24408 K2:NT AUTHORITY\ANONYMOUS LOGON from 172.172.172.172:1721 没有权限启动进程 MyProject\MyProcessName”

我确定这是一个一般的 IIS 委派问题（不是特定于 K2），但我不确定如何解决它。为什么 Sharepoint 在应该模拟当前域用户时尝试以 AnonymousLogon 身份连接到另一台服务器？

注意： - 我的 Sharepoint AppPool 身份是域用户（不是网络服务）。- 启用 ASP.NET 模拟。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-11T15:10:32.443

您正在尝试做的事情称为委托而不是模仿。模拟仅在本地服务器上。有很多事情必须是正确的，代表团才能发挥作用。

一个开始的地方是[Kerberos 身份验证和故障排除委派问题](http://support.microsoft.com/kb/907272)

[David Wang 博客](http://blogs.msdn.com/david.wang/)是关于这些问题的非常有用的资源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T18:51:07.067

您还应该前往[K2 Underground](http://www.k2underground.com)，这里有大量关于如何让 Kerberos 委托与他们的产品一起工作的信息。K2 附带的安装指南还包含有关如何安装 K2 并将其配置为与 Kerberos 一起使用的分步说明。

# c# - C# 中的 AddressOf 替代方案

> ID：280953
> 
> 赞同：6
> 
> 时间：2008-11-11T14:01:58.697
> 
> 标签：c#, address-operator

任何人都可以帮助我使用 C# 中关于**VB6 中的 AddressOf 运算符**的替代解决方案吗？AddressOf 返回一个长值。我可以通过什么方式在 C# 中获得输出？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-11T14:56:25.670

扩展 Harper Shelby 的回答，是的，它可以做到，但在 .NET 中这样做通常是一种代码味道。

要在 C# 中获取变量的地址，可以使用 C 样式的指针 (*) /地址 (&) / 取消引用 (->) 语法。为此，您必须使用 /unsafe 编译器开关编译应用程序，因为一旦您开始直接处理内存地址，您就会跳出托管代码的安全网。

来自 MSDN 的示例讲述了大部分故事：

```
int number;
int* p = &number;
Console.WriteLine("Value pointed to by p: {0}", p->ToString()); 
```

这会将`number`变量的地址分配给指向 int 的指针`p`。

这有一些问题：

1.  必须初始化您要获取其地址的变量。对于默认值类型不是问题，但对于引用类型是问题。
2.  在 .NET 中，变量可以在您不知道的情况下在内存中移动。如果你需要处理一个变量的地址，你真的想用[`fixed`](http://msdn.microsoft.com/en-us/library/f58wzh21(VS.80).aspx)把变量固定在 RAM 中。
3.  & 只能应用于变量，不能应用于常量或值。（换句话说，您不能使用类似的构造`int* p = &GetSomeInt();`）
4.  同样，您的代码必须在不安全模式下编译，这会标记 CLR，您将使用托管代码“安全网”之外的功能。

一般来说，我在这个世界上的建议是认真考虑*为什么*你认为你需要在 .NET 世界中这样做。.NET 的任务之一是保护开发人员免于与金属作对，而此功能与该任务背道而驰。它存在于那些需要它的（罕见的）场景中；如果您发现自己只是因为可以而轻率地使用它，那么您可能会误用它并引入代码异味。

如果可能，请避免使用它，但如果绝对必须要知道如何使用它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-11T14:05:26.020

C# 具有将函数分配给委托/事件的特殊语法。只需使用`<delegate> += <function>;`

如果您实际上是在尝试获取地址以用于其他用途，那么您就不走运了。托管代码的其中一件事是这些地址不一定是固定的。虽然大多数功能不太可能发生变化，但在某些情况下是可能的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-11T14:06:55.520

显然，这是可以做到的（虽然我不确定你在哪里需要它）。这是[MSDN 页面](http://msdn.microsoft.com/en-us/library/zcbcf4ta(VS.80).aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-11T14:06:59.030

```
EventHandler handler1 = this.button1_Click;
EventHandler handler2 = new EventHandler( this.button1_Click );
...
...
...
void button1_Click( object sender, EventArgs e ){
    // ....
} 
```

两种表示法是等价的。

# windows - 遍历文件夹字符串并解析出最后一个文件夹名称

> ID：280969
> 
> 赞同：15
> 
> 时间：2008-11-11T14:07:44.863
> 
> 标签：windows, batch-file, cmd

我需要获取当前正在执行的批处理文件的文件夹名称。我一直在尝试使用以下语法（目前是错误的）循环当前目录：

```
set mydir = %~p0
for /F "delims=\" %i IN (%mydir%) DO @echo %i 
```

几个问题，我似乎无法将“mydir”变量值作为搜索字符串传递。它似乎只有在我传递命令时才有效；我的语法错误，无法弄清楚原因。

我的想法是用'\'分隔符循环文件夹字符串，但这也会引起问题。如果我在每个循环上设置一个变量，那么最后一个值设置将是当前文件夹名称。例如，给定以下路径：

> C:\Folder1\Folder2\Folder3\Archive.bat

我希望解析出值'Folder3'。

我需要解析该值，因为它的名称将是我将在批处理文件中进一步创建的另一个文件夹的一部分。

如果有人可以提供帮助，非常感谢。我可能完全是在叫错树，所以任何其他方法也会受到极大的欢迎。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2011-01-03T19:08:23.110

在尝试了其中一些建议后，我发现成功使用了以下 1 班轮（在 windows 2008 中）

```
for %%a in (!FullPath!) do set LastFolder=%%~nxa 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-11T14:47:54.797

你非常接近它:) 这应该有效：

```
@echo OFF
set mydir="%~p0"
SET mydir=%mydir:\=;%

for /F "tokens=* delims=;" %%i IN (%mydir%) DO call :LAST_FOLDER %%i
goto :EOF

:LAST_FOLDER
if "%1"=="" (
    @echo %LAST%
    goto :EOF
)

set LAST=%1
SHIFT

goto :LAST_FOLDER 
```

由于某种原因 for 命令不喜欢 '\' 作为分隔符，所以我将所有 '\' 转换为 ';' 第一个 ( `SET mydir=%mydir:\=;%`)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-09-24T13:25:40.017

当我寻找当前目录的最后一段时，我发现了这个旧线程。以前的作家的回答使我得出以下结论：

```
FOR /D %%I IN ("%CD%") DO SET _LAST_SEGMENT_=%%~nxI
ECHO Last segment = "%_LAST_SEGMENT_%" 
```

正如前面所解释的，不要忘记在使用 %_LAST_SEGMENT_% 创建的任何路径周围加上引号（就像我在示例中使用 %CD% 所做的那样）。

希望这可以帮助某人...

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-07-04T21:40:19.890

这个问题有点老了，但我不止一次地寻找解决方案，所以这是我刚刚整理的一个全新的解决方案。

诀窍是我们采用所需的路径，备份一个级别以创建用于替换的文件夹掩码，然后将文件夹掩码替换为空。

要对其进行测试，只需复制并粘贴到任何目录中的命令脚本 (.cmd) 中，然后运行它。它只会吐出您当前所在的最深目录。

笔记：

*   将 %~dp0 替换为您喜欢的任何路径（实际上，它将返回运行批处理文件的最深文件夹。这与 %cd% 不同。）
*   指定 'pathtofind' 变量时，请确保没有引号，例如 c:\some path 而不是 "c​​:\some path"。
*   文件夹屏蔽的最初想法是我的
*   路径中的空格没有问题
*   文件夹深度不是问题
*   这个批处理脚本技巧的天才使之成为可能[http://www.dostips.com/DtCodeBatchFiles.php#Batch.FindAndReplace](http://www.dostips.com/DtCodeBatchFiles.php#Batch.FindAndReplace)

希望这对其他人有帮助。

```
@echo off
set pathtofind=%~dp0
if not exist %pathtofind% echo Path does not exist&pause>nul&goto :eof

cd /d %pathtofind%
set path1=%cd%
cd ..
set path2=%cd%

call set "path3=%%path1:%path2%\=%%"

echo %path3%

pause>nul 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-11-03T04:08:55.970

3行脚本得到结果......

找到了 2 种额外的方法来实现目标，与此问题的其他答案不同，它不需要批处理“功能”，不需要延迟扩展，也没有 Tim Peel 的答案对目录深度的限制：

```
@echo off
SET CDIR=%~p0
SET CDIR=%CDIR:~1,-1%
SET CDIR=%CDIR:\=,%
SET CDIR=%CDIR: =#%
FOR %%a IN (%CDIR%) DO SET "CNAME=%%a"
ECHO Current directory path: %CDIR%
SET CNAME=%CNAME:#= %
ECHO Current directory name: %CNAME%
pause 
```

修订：在我的新修订之后，这是一个示例输出：

```
Current directory path: Documents#and#Settings,username,.sqldeveloper,tmp,my_folder,MY.again
Current directory name: MY.again
Press any key to continue . . . 
```

这意味着脚本不处理文件夹名称中的“#”或“,”，但可以对其进行调整。

附录：在[dostips](http://www.dostips.com/forum/viewforum.php)论坛中询问某人后，找到了一种更简单的方法：

```
@echo off
SET "CDIR=%~dp0"
:: for loop requires removing trailing backslash from %~dp0 output
SET "CDIR=%CDIR:~0,-1%"
FOR %%i IN ("%CDIR%") DO SET "PARENTFOLDERNAME=%%~nxi"
ECHO Parent folder: %PARENTFOLDERNAME%
ECHO Full path: %~dp0
pause>nul 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-05-10T14:36:30.733

要返回原始海报的问题：

> 例如，给定以下路径：C:\Folder1\Folder2\Folder3\Archive.bat 我希望解析出值“Folder3”。

简单的解决方案是：

```
for /D %%I in ("C:\Folder1\Folder2\Folder3\Archive.bat\..") do echo parentdir=%%~nxI 
```

会给'Folder3'。文件/路径不需要存在。当然，......对于父母的父母目录，或者......对于上面的那个（等等）也可以工作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-11T15:56:56.530

如果任何文件夹的名称中有空格，请稍作改动 - 在操作之前和之后将空格替换为“：”：

```
set mydir="%~p0"
set mydir=%mydir:\=;%
set mydir=%mydir: =:%

for /F "tokens=* delims=;" %%i IN (%mydir%) DO call :LAST_FOLDER %%i
goto :EOF

:LAST_FOLDER
if "%1"=="" (
  set LAST=%LAST::= %
  goto :EOF
)

set LAST=%1
SHIFT

goto :LAST_FOLDER 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-18T20:04:23.077

伙计们，真是一团糟。这很容易，而且在没有 CD 的情况下在内存中执行此操作会更快。

这将获取路径的最后两个目录。根据需要修改它以获取任何行的最后一个标记。我基于此的原始代码出于我自己的目的而具有更多的复杂性。

仅供参考，这可能不允许带有感叹号的路径，因为我使用的是 enabledelayedexpansion，但这可以修复。

它也不适用于普通驱动器根目录。这可以通过多种方式避免。检查输入路径以什么结尾，或计数器，或修改令牌并检查行为等。

```
@echo off&setlocal enableextensions,enabledelayedexpansion

call :l_truncpath "C:\Windows\temp"

----------

:l_truncpath
set "_pathtail=%~1"
:l_truncpathloop
for /f "delims=\ tokens=1*" %%x in ("!_pathtail!") do (
if "%%y"=="" (
set "_result=!_path!\!_pathtail!"
echo:!_result!
exit/b
)
set "_path=%%x"
set "_pathtail=%%y"
)
goto l_truncpathloop 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-10-05T07:06:03.343

我修改了[@Jonathan](https://stackoverflow.com/users/561648/jonathan)给出的[答案](https://stackoverflow.com/a/4587447/12167722)，因为它在批处理文件中对我不起作用，但下面的这个确实有效，并且还支持其中包含空格的文件夹。：

```
for %%a in ("%CD%") do set LastFolder=%%~nxa
echo %LastFolder% 
```

这将获取当前目录并**回显最后一个最深的文件夹，**如下例所示，如果文件夹是这样的：

```
C:\Users\SuperPDX\OneDrive\Desktop Environment\ 
```

批处理代码与此相呼应：**桌面环境**

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-11T14:22:10.590

在 FOR 命令的批处理文件中，您需要在 %whatever 前面加上一个额外的 %（例如 %%whatever）。

'echo %~p0' 将打印批处理文件的当前目录。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-11T15:04:23.797

这就是我们最终得到的（稍微粗暴一点，只能深入：）

```
@echo off
for /f "tokens=1-10 delims=\" %%A in ('echo %~p0') do (
    if NOT .%%A==. set new=%%A
    if NOT .%%B==. set new=%%B
    if NOT .%%C==. set new=%%C
    if NOT .%%D==. set new=%%D
    if NOT .%%E==. set new=%%E
    if NOT .%%F==. set new=%%F
    if NOT .%%G==. set new=%%G
    if NOT .%%H==. set new=%%H
    if NOT .%%I==. set new=%%I
    if NOT .%%J==. set new=%%J
)

@echo %new% 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-06-11T19:10:46.440

我不知道它是否是我正在使用的 Windows 版本（win2k3），但 FOR 循环并没有给我任何有用的信息来尝试遍历单个字符串。根据我的观察（以及 FOR /? 信息），对于 FOR 的每一行输入，您都会获得一次迭代，并且无法将其更改为在一行内进行迭代。您可以为给定的行分成多个标记，但这只是 FOR 循环体的一次调用。

我确实认为这些答案中的 CALL :LABEL 方法做得很好。直到看到这个我才知道是那个“;” 和 "," 都被识别为参数分隔符。因此，一旦将反斜杠替换为分号，就可以调用标签并使用 SHIFT 进行迭代。

因此，根据其他人在这里发布的内容，我有以下解决方案。实际上，我并不想获取最后一个文件夹名称，而是想找到直到某个已知目录名称之前的所有内容。这就是下面实现的内容。

```
@echo off
if "%1"=="" goto :USAGE

set FULLPATH=%~f1
set STOPDIR=%2
set PATHROOT=

:: Replace backslashes with semicolons
set FULLPATH=%FULLPATH:\=;%

:: Iterate through path (the semicolons cause each dir name to be a new argument)
call :LOOP %FULLPATH%
goto :EOF

:LOOP

::Exit loop if reached the end of the path, or the stop dir
if "%1"=="" (goto :EOF)
if "%1"=="%STOPDIR%" (goto :EOF)

::If this is the first segment of the path, set value directly. Else append.
if not defined PATHROOT (set PATHROOT=%1) else (set PATHROOT=%PATHROOT%\%1)

::shift the arguments - the next path segment becomes %i
SHIFT

goto :LOOP

:USAGE
echo Usage:
echo %~0 ^<full path to parse^> ^<dir name to stop at^>
echo E.g. for a command:
echo %~0 c:\root1\child1\child2 child2
echo The value of c:\root1\child1 would be assigned to env variable PATHROOT 
```

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2010-08-23T00:54:28.420

不幸的是，这只有在深入一些但在山顶有问题时才能很好地工作......将此程序放入“C：\ Windows”例如将导致......“C：\ Windows” ，不是预期的“Windows”。仍然很棒，并且仍然可以修复损坏。我的做法：

```
@echo off
set pathtofind=%~dp0
if not exist %pathtofind% echo Path does not exist&pause>nul&goto :eof

cd /d %pathtofind%
set path1=%cd%
cd ..
set path2=%cd%
set path4=%~dp1
call set "path3=%%path1:%path2%\=%%"
call set "path5=%%path3:%path4%*\=%%"
echo %path5%

pause>nul 
```

现在它对我来说工作得很好，谢谢你的想法，我一直在寻找类似的东西。

# sharepoint - 如何使重复表中的 InfoPath 文本字段自动递增？

> ID：280971
> 
> 赞同：1
> 
> 时间：2008-11-11T14:07:54.177
> 
> 标签：sharepoint, infopath

在我的 InfoPath 表单（必须通过浏览器在 SharePoint 门户中加载）中，我有一个包含多个字段的重复表。现在我想让第一个文本字段从 1 开始自动递增。我该怎么做呢？

我已经听说过一种使用“计数”功能的方法，但这会产生错误，或者在最好的情况下会产生一个静态数字，不幸的是它不计数。我为该字段添加的函数是“count(.) + 1”

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T15:33:57.887

假设您的重复组称为“项目”，您的自动增量字段称为“索引”。索引字段的默认值应该是

```
count(/my:myFields/my:item) 
```

这应该为您正确计算。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T04:56:30.670

我怀疑你真的想要位置（）。Count 只会返回与您提供的 xpath 表达式匹配的节点总数。

# firefox - 保护 FF 扩展中的 Javascript 代码

> ID：280980
> 
> 赞同：2
> 
> 时间：2008-11-11T14:13:40.827
> 
> 标签：firefox, firefox-addon

我希望保护我的 Firefox 扩展程序的代码，因为它有服务器调用，如果有人可以将它们放在扩展程序之外，则不会有安全风险。关于如何加密它的任何建议？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-11T14:23:48.200

这基本上是不可能的。您想将可执行代码提供给其中包含“秘密”调用的不受信任的客户端，但不让客户端知道秘密？那么，它将如何执行代码？

在某些时候，它必须被解密。这意味着客户端拥有执行解密所需的一切，这意味着用户可以这样做，并构建扩展的恶意版本。

您唯一的选择是重新设计，使易受攻击的服务不公开。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T14:16:26.403

如果它要在客户端执行，没有可靠的秘密，那么基本上你肯定有一个安全漏洞。

在不了解您的扩展程序的情况下，很难提出解决此问题的方法。一个明显的建议是请求用户名/密码，向服务器进行身份验证（通过 HTTPS）并接收限时令牌，然后将该令牌与“狡猾”的请求一起呈现。不过，这不会阻止任何拥有正确用户名和密码的人......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-13T20:05:05.173

您可以使用 xauth，它是 OAuth 的一种变体，旨在解决此类问题。Twitter 使用 xauth：[http ://dev.twitter.com/pages/xauth](http://dev.twitter.com/pages/xauth)

此外，您可以混淆您的 Javascript 代码，甚至用 C 语言编写（作为 NPAPI 插件）。

# c# - 正则表达式替换值，包括新行

> ID：280990
> 
> 赞同：-1
> 
> 时间：2008-11-11T14:17:11.503
> 
> 标签：c#, regex

我有一个类似于下面的片段。

```
string bodyTypeAssemblyQualifiedName = "XXX.XX.XI.CustomerPayment.Schemas.r1.CustomerPayments_v01, XXX.XX.XI.CustomerPaym" +
                "ent.Schemas.r1, Version=1.0.0.0, Culture=neutral, PublicKeyToken=ac564f277cd4488" +
                "e"; 
```

我想在 C# 中使用正则表达式来获得它：

```
string bodyTypeAssemblyQualifiedName = null; 
```

我试过使用如下所示的正则表达式，但它与换行符不匹配......

```
bodyTypeAssemblyQualifiedName\s=\s(?<location>.*?); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-11T15:24:05.363

@Will，通过用否定字符类替换点，您消除了对单行修饰符的需要。如果我没看错，你也不需要使用环视。

```
bodyTypeAssemblyQualifiedName\s+=\s+(?<location>[^;]+); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T14:34:33.047

这有效：

> (?<=string\sbodyTypeAssemblyQualifiedName\s=\s)(?s:[^;]*)(?=;)

相当于：

1.  在字符串“string bodyTypeAssemblyQualifiedName =”之后
2.  打开单行（将 \r\n 视为任何其他字符）（这是 (?s: ) 所做的）
3.  匹配每个不是分号的字符
4.  直到到达一个分号

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-11T14:27:23.730

你可以试试

```
bodyTypeAssemblyQualifiedName\s=\s(?<location>[.\n]*?); 
```

或者你`RegexOptions.Singleline`为你的模式设置。

> **RegexOptions.Singleline** - 指定单行模式。更改点 (.) 的含义，使其匹配每个字符（而不是除 \n 之外的每个字符）。

# wcf - WCF 服务之间的共享会话

> ID：280991
> 
> 赞同：8
> 
> 时间：2008-11-11T14:17:21.927
> 
> 标签：wcf

我一直致力于拆分 Web 应用程序的应用层和 Web 层。在应用层中，我设法将业务逻辑分离成一堆使用 WCF 代理公开的服务。问题是这些服务与另一个使用大型 CLR 对象作为其主要通信方式的遗留应用程序进行通信。为了保持快速，我在第一次创建该对象后在会话中保留了该对象的副本。现在我知道 WCF 可以进行会话，但是会话存储是每个服务的，而我的业务逻辑现在被拆分为多个服务（应该如此）。

现在的问题：

1.  有没有办法在同一主机上托管的 WCF 服务之间共享会话存储？
2.  这甚至是我应该做的事情吗？
3.  如果不是，那么这里的最佳做法是什么？

这可能不是第一次有人在服务器上拥有大型业务对象。对我来说不幸的是，我确实需要为每个用户缓存这个对象（因此是会话）。

答案可能很明显，而我只是没有看到。请帮忙！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-20T09:31:40.340

我认为实例上下文共享可以提供帮助

[http://msdn.microsoft.com/en-us/library/aa354514.aspx](http://msdn.microsoft.com/en-us/library/aa354514.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-09T14:58:58.230

As far as I understand WCF, it is designed to be as stateless as it could be. In a session you can remember some values in your service, but objects are not meant to live outside the scope of a session.

Therefore, I'd think you are in trouble.

Of course, there might be some way to store and exchange objects between sessions that I don't know (I use WCF, but I don't know very much about it, apart from what I need for myself).

(if there is a way to share objects between services, it probably would only work on services you host yourself. IIS hosting might recycle your service sometimes)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T20:42:06.057

也许您可以将此对象包装在单例服务中。这是一个只有一个实例的服务，在调用之间不会被销毁。因为您需要为每个用户创建一个对象，所以该服务必须管理他们的列表，并且调用服务必须提供所需的身份验证数据（或 sessionid）。不要忘记超时以摆脱不需要的对象...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-09T21:45:59.657

创建代表其他应用层服务托管大型 CLR 对象的[外观服务。](http://martinfowler.com/eaaCatalog/remoteFacade.html)它可以作为[适配器](http://www.dofactory.com/Patterns/PatternAdapter.aspx)工作，允许将更具体的会话标识符用于您创建的更高级的应用层服务。外观可以提供会话标识符，例如 GUID，您的应用层服务可以使用它来重新连接大型 CLR 对象。

这提供了一些优点：

1.  您的某些应用程序层可能根本不需要了解 CLR 对象。他们只与远程门面通信。

2.  “大型 CLR 对象”主机代表现在可以共享它的其他服务保留会话对象。

3.  应用程序层现在有一个外观，它们通过它与旧服务对话。当您努力重构此旧服务时，应用程序层不必更改。

根据您的设置，您可以通过 in proc 托管来托管外观，这将提高您正在寻求的保留性能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-12T18:20:09.003

如果您希望能够将应用程序分散到整个农场，将事物分解为子服务似乎是一个好主意。然而，重要的是要记住，每当一个对象至少跨越 appdomain 边界时，它都必须被复制到内存中。

这一切都取决于对象有多大以及它拥有什么样的数据。

如果您不想传递对象，因为它太大了，您可能需要为接收它的服务创建一个查询 API。通过这种方式，您可以操作该对象，而无需进行昂贵的序列化或远程处理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-22T06:08:42.907

把事情简单化。由于您已经可以访问 WCF 中的 Session，因此您可以从那里使用 SessionID。现在：

1.  在某处创建一个静态字典，其中键是您的 sessionId，值是您要存储的业务对象。

2.  无需访问会话中的业务对象，只需访问 sessionid 并从字典的值中获取业务对象。

（例如`System.Web.Caching`，如果您愿意，您也可以使用某种类型的缓存，这样您就不必手动清理字典）*``***********