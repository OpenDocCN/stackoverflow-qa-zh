# StackOverflow 问答 000616000-000616999

# vb.net - 发送多线程 SendEmail 请求返回一般 Mapi 失败

> ID：616000
> 
> 赞同：6
> 
> 时间：2009-03-05T18:33:23.813
> 
> 标签：vb.net, mapi

我正在使用[Dave Brooks 的 MAPI 代码](http://www.codeproject.com/KB/IP/SendFileToNET.aspx)。

我正在尝试以编程方式发送生成的 Crystal Report。

当我在没有线程的情况下运行代码时，一切都运行良好。问题是当我使用线程时，我得到返回错误“General MAPI failure [2]”。

我以前从未使用过线程，并且了解其中存在危险。任何人都可以提供有关此问题的任何见解吗？注意：我删除了异常处理以使代码更清晰。

```
Private Sub RunReport()
    SetParameters()
    SaveReportFile()

    Dim operation As New ThreadStart(AddressOf SendEmail)
    Dim theThread As New Thread(operation)
    theThread.Start()
End Sub

Public Sub SendEmail()
   Dim m As MAPI
   m = New MAPI()
   Dim email As String
   For Each email In emailAddress
       m.AddRecipientBCC(email)
   Next email
   m.AddAttachment(@"c:\temp\report.pdf")
   m.SendMailPopup("Requested Report", "")
End Sub 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-01-27T10:21:13.247

一个很晚的答案，但我想我还是会添加它，因为我刚刚遇到这个并且在其他地方找不到答案。

在开始使用之前，您需要将线程的 appartment 状态设置为 STA：

```
theThread.SetApartmentState(ApartmentState.STA); 
```

请注意，来自线程池的线程（例如由 BackgroundWorker 组件使用）是 MTA。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-10-24T16:06:14.007

我遇到了同样的错误（General MAPI failure [2]）并且在我调试的早期就遇到了这个解决方案；但是，我的错误的原因是由于 Outlook 以我的用户身份运行时以管理员身份运行我的应用程序。我很难找到错误的原因，所以希望这会帮助与我进行相同搜索的人。

如果上述答案不能解决您的问题，请尽可能尝试在没有提升权限的情况下运行您的应用程序，或者找到一种使用用户模拟调用 MAPI 的方法。

# sql - 禁用特定外键的快速而肮脏的方法

> ID：616001
> 
> 赞同：0
> 
> 时间：2009-03-05T18:33:35.577
> 
> 标签：sql

理想情况下，我会在表中有一个“isActive”字段来指示记录是否处于活动状态，但它会涉及多个存储过程的更改，以使该字段执行其应做的事情。

我想出了一个肮脏的把戏，有点想实施它。由于结果集是由几个连接生成的，因此我正在考虑通过附加“*”、“x”或通常不会出现在键中的任何符号来稍微更改其中一个表中的外键。

有什么我应该害怕的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T18:36:45.397

在不更改所有其他存储过程的情况下获得“非活动”状态的一种方法是在记录不活动时将记录移动到“非活动”表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T18:41:14.763

> 有什么我应该害怕的吗？

是否存在由于附加特殊字符而导致数据不一致且与不可读数据不一致的问题？

如果这个问题稍后会出现，我认为是时候重构您的存储过程或表了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T18:42:32.980

您的意思是进入数据库并手动将字符添加到特定行以禁用单个客户或其他什么？

联接怎么样 - 您可以暂时将 ...AND CustomerId NOT IN ( 1234, ...) 添加到 WHERE 子句吗？

我不认为你应该开始弄乱这样的数据，即使参照完整性允许你这样做。

# java - 我可以使用 Hibernate Annotations 自动将 EnumSet 映射到一系列布尔列吗？

> ID：616012
> 
> 赞同：4
> 
> 时间：2009-03-05T18:35:31.437
> 
> 标签：java, hibernate, persistence, data-mapping

我有一个 EnumSet，我认为映射到一系列布尔列会很好。这将使使用 SQL 工具进行检查变得容易，并且对可用枚举值的更改也具有弹性。但是，我真的不想为此手写所有的 getter 和 setter。

有没有人有一个聪明的解决方案，使用某种休眠元数据将此对象拆分为一堆属性？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-08T23:36:42.373

如果我理解正确，对于像这样的枚举：

```
public enum Color { RED, GREEN, BLUE; } 
```

您将在数据库中有 3 个真/假列，每个可能的枚举值对应一个。然后一个`EnumSet`包含，比如说，红色和蓝色，应该映射到：

```
RED    GREEN    BLUE
true   false    true 
```

如果是这种情况，我知道的唯一方法是编写自己的`org.hibernate.usertype.UserType`. 这是一项非常简单的任务，在 Hibernate 站点上提供了一些示例，例如，[这里](http://www.scribd.com/doc/4857635/Advanced-Hibernate)。

**编辑**：我刚刚意识到事情必须更复杂一些。如果您希望在您的应用程序中为所有可能的情况使用一种 Hibernate 类型映射`EnumSet`，则必须执行以下操作：

1.  使用`org.hibernate.usertype.ParameterizedType`枚举类并使用户类型可参数化。
2.  根据枚举类的值，确定要读/写的列数和列数。
3.  每次使用 an 时都实例化类型`EnumSet`。
4.  考虑在一个表中映射多个集合的可能性，以及添加新枚举值将如何影响现有类型的工作。

这很容易相当于一整天的工作，但似乎很可行。希望你从这里弄清楚。

# .net - 可以按名称实例化和调用委托吗？

> ID：616018
> 
> 赞同：2
> 
> 时间：2009-03-05T18:36:35.023
> 
> 标签：.net, vb.net, delegates

我试图弄清楚是否可以按名称而不是显式实例化和调用委托。我认为下面的代码很好地解释了它......我想接受一个函数名称，然后基于它实例化委托。在示例中，我使用了一个选择案例，但我想消除它并只使用 methodName 参数本身。

尊敬的......请避免告诉我这很疯狂的冲动，我应该采取一些完全不同的方法来解决这个问题。:)

```
 Private Delegate Sub myDelegate()  

    Private Sub myDelegate_Implementation1()
        'Some code
    End Sub
    Private Sub myDelegate_Implementation2()
        'Some code
    End Sub

    Public Sub InvokeMethod(ByVal methodName As String)
        Dim func As myDelegate = Nothing
        '??? HOW TO GET RID OF THIS SELECT CASE BLOCK?:
        Select Case methodName
            Case "myDelegate_Implementation1"
                func = AddressOf myDelegate_Implementation1
            Case "myDelegate_Implementation2"
                func = AddressOf myDelegate_Implementation2
        End Select
        func.Invoke()
    End Sub 
```

谢谢基思，正是我想要的。（不过，BFree 的方法在大多数情况下也同样适用）。

这是VB中的工作代码：

```
Public Delegate Sub xxxDelegate()

Sub xxxAnImplementation()

End Sub

Sub zzzDoIt(ByVal xxxImplementerName As String)
    Dim theDelegate As xxxDelegate = CType(System.Delegate.CreateDelegate(GetType(xxxDelegate), Me, xxxImplementerName), xxxDelegate)
    theDelegate.Invoke()
End Sub

Private Sub LoadFunctions()
    Dim thisClass As Type = Type.GetType(Me.GetType.BaseType.FullName.ToString)
    For Each method As MethodInfo In thisClass.GetMethods(System.Reflection.BindingFlags.DeclaredOnly)
        If 1 = 1 OrElse method.Name.Substring(0, 3) = "Get" Then
            Me.ddlCodeSamples.Items.Add(method.Name)
        End If
    Next
End Sub 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T18:45:53.487

我不会完全回答问题，因为我不确定您所问的是否可能。但是，通过反射，可以调用一个给定方法名称的方法。IE：

```
 string methodName = "MyMethod";
    MethodInfo method = this.GetType().GetMethod(methodName);
    method.Invoke(this, null); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T20:23:51.100

如果您有该方法的委托，您也可以这样做：

```
public delegate void MethodDelegate( ... ) ...

//create the delegate we expect
(MethodDelegate) Delegate.CreateDelegate(
    typeof( MethodDelegate ), this, "methodName", true ); 
```

C#，我知道，但类似的方法在 VB 中也可以使用。

通常我会选择@BFree的答案，但这在使用事件驱动反射时效果很好 - 我认为如果多次调用结果委托会稍微快一些。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T18:41:25.323

为什么不使用 HashTable 而不是 Select 语句？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T18:53:05.483

[BFree的回答](https://stackoverflow.com/questions/616018/possible-to-instantiate-and-invoke-a-delegate-by-name/616062#616062)有效；

我的回答只是一个建议；

为什么不直接将方法的地址传递给 InvokeMethod 而不是在字符串中传递方法名称？

```
Module Module1
Sub Main()
    InvokeMethod(AddressOf myDelegate_Implementation1)
    InvokeMethod(AddressOf myDelegate_Implementation2)
End Sub

Public Delegate Sub myDelegate()

Private Sub myDelegate_Implementation1()
    Console.WriteLine("myDelegate_Implementation1")
End Sub
Private Sub myDelegate_Implementation2()
    Console.WriteLine("myDelegate_Implementation2")
End Sub

Public Sub InvokeMethod(ByVal func As myDelegate)
    func()
End Sub
End Module 
```

# iis - IIS 7 可靠性和性能监视器

> ID：616024
> 
> 赞同：1
> 
> 时间：2009-03-05T18:38:13.007
> 
> 标签：iis

我正在尝试找出我可以监控的一些类别。其中之一是 .NET CLR Remoting 类别下的上下文代理。上下文代理实际上有多少代理用于连接到诸如 WCF 服务之类的东西？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T11:15:04.007

你到底想监控什么？IIS 是系统的一部分，因此您可以使用通用计数器对其进行监控（进程、Web 服务等）。

您引用的上下文代理应该是 .NET 特定的，而不是 IIS 特定的。

# c# - c# DataBinding 到泛型上的字符串属性

> ID：616026
> 
> 赞同：0
> 
> 时间：2009-03-05T18:38:36.610
> 
> 标签：c#, data-binding, properties, generics

我正在尝试将数据绑定到我的自定义字典类。在 formLoad 中，我可以绑定到 Car.Desc，但不能绑定到 RatesCache.Desc。它们都是公共字符串属性。

我错过了什么？

谢谢！

System.ArgumentException 未处理 Message="无法绑定到 DataSource 上的属性或列 Desc。\r\n参数名称: dataMember" Source="System.Windows.Forms" ParamName="dataMember"

```
 public class RatesCache : Dictionary<int, Rate>
    {
        public string Desc { get; set; }
    }

    public class Car
    {
        public string Desc { get; set; }
    }

    static Car car = new Car();

    static RatesCache rc = new RatesCache();

    private void Form1_Load(object sender, EventArgs e)
    {
        rc.Desc = "hello too";
        car.Desc = "Im a car";
        textBox1.DataBindings.Add("Text", rc, "Desc");
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-03-22T11:36:35.720

```
private void Form1_Load(object sender, EventArgs e)
{
    rc.Desc = "hello too";
    car.Desc = "Im a car";
    textBox1.DataBindings.Add("Text", rc, "Desc");
    textBox1.TextChanged .TextChanged += _textBox1_TextChanged;
}

private void _messagesReceviedLabel_TextChanged(object sender, EventArgs e)
{
    _textBox1.Text = rc.Desc.ToString();
}

public class RatesCache : Dictionary<int, Rate>
{
    public string Desc { get; set; }

    public override string ToString()
    {
        return Desc;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T19:02:24.820

我的猜测是，因为您的类是从作为集合的 Dictionary 继承的，所以它会丢弃文本框的 DataBinding。Windows 窗体有自己的方式来处理与集合的数据绑定，这与直接绑定到类的属性时不同。我知道，答案不多，但我认为没有办法解决它。我的建议是要么不直接从 Dictionary 继承；而是保留一个内部字典，并根据需要公开方法。或者，不要直接对 texbox 进行数据绑定。相反，只要您的 RatesCache 类中的“Desc”属性发生变化，就引发一个事件，然后在您的表单中监听该事件。当它改变时，更新你的文本框。

# c# - Control.Refresh() 跨线程

> ID：616035
> 
> 赞同：0
> 
> 时间：2009-03-05T18:40:01.177
> 
> 标签：c#, .net, multithreading, controls

好的，请忽略之前发生的事情。我不再收到错误，所以我的问题似乎是当我更改图表数据绑定的值时要更新图表。

//这里忽略下面

大家好。我有一个带有面板的 WinForms 应用程序，`panel1`. 后台线程创建一些其他控件，然后`panel1`像这样添加

```
panel1.Controls.AddRange(myArrayOfControls); 
```

这很好用，我可以看到我的控件被添加了。但是，当新数据进入另一个线程时，我会更新控件父对象中的值，然后需要`Refresh()`让显示更新为新值。在任一上下文中调用`Refresh()`数据进入的线程或接收更新数据的对象都会导致 InvalidOperation 异常，因为需要调用。我已经尝试在我的模型对象以及数据传入的线程中使用 Invoke 并且似乎无法消除错误。

如果有人有一些指导，我将不胜感激。

更新：这里有更多信息。我不认为它会需要它，但我错了。:)

我有一个对象类 MyObject。这个 MyObject 类是在一个名为 topologyThread 的线程中创建的。数据来自 dataThread。MyObject 的实例有一个 Panel 实例变量，并且 Panel 有子控件，包括来自 System.Windows.Forms.DataVisualization.Charting 命名空间的两个图表。因此，当数据进入 dataThread 时，我会更新 MyObject 对象中的相应数据值，然后需要刷新图表以显示更新的数据。

我知道数据处理得很好。在我的 MyObject 类中，我将新值记录到属性设置器中的 Console 中，并看到新值出现。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T18:51:46.920

您必须从主 UI 线程执行这两项操作（刷新和更新控件的父对象）。如果您正在从后台线程修改控件并且没有收到异常，那是倒霉的，因为这绝对是一个错误。

最好的方法是使用

```
theControl.Invoke(new MethodInvoker(MyUpdateMethod)); 
```

如果您有如何完成更新的示例，我们可以提供更好的示例来说明如何从后台线程正确调用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T19:27:33.013

JaredPar 是一个很好的答案。我想补充一点你的代码工作的原因。

使用 Windows 窗体，您可以从其他线程与 UI 线程对话。在所有情况下，这都是非常糟糕的做法。

问题是，当你这样做时，很难抓住，因为有时 UI 会像没有任何问题一样工作。项目将被添加或更改，并且 UI 将反映更改。但是其他时候运行相同的确切代码，它将不起作用。

这就是从除 UI 线程之外的任何线程触摸 UI 的问题。结果不一致，这就是为什么是非常糟糕的做法。

上帝，我希望我能发表评论。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T19:08:33.293

JaredPar 的回答很好。在某些情况下，它可能会导致问题（特别是在表单构建完成之前调用该方法时）。这是一个更健壮的实现（使用扩展方法）

```
public static class ControlInvokeExtensions
{
    public static void InvokeOnHostThread(Control host, MethodInvoker method)
    {
        if (IsHandleCreated)
            Invoke(new EventHandler(delegate { method(); }));
        else
            method();
    }
} 
```

现在你可以这样称呼它

```
panel1.InvokeOnHostThread(() => panel1.Controls.AddRange(myArrayOfControls)); 
```

或者，如果您是以下形式：

```
InvokeOnHostThread(() => panel1.Controls.AddRange(myArrayOfControls)); 
```

# excel - 在 Excel 中的行/列中重新排序/随机排列值

> ID：616036
> 
> 赞同：16
> 
> 时间：2009-03-05T18:40:03.890
> 
> 标签：excel

是否可以随机洗牌，在 Excel 表中的行或列中的值。有什么功能/宏吗？我该怎么做呢？

-广告。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-05T19:09:38.190

Hm... just as simple solution without programming. For example, you have a column of data (A):

```
23
78
12
78 
```

Just add another one column - B. Each cell of column B must be a function RAND():

```
A     B
--    --
23    =RAND()
78    =RAND()
12    =RAND()
78    =RAND() 
```

Now you can sort rows by column B and get desired solution.

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-05T19:15:38.160

Let's assume your values are in cells A1:A8

1.  Enter the formula =RANDBETWEEN(1,100000)+ROW()/100000 in cells B1:B8
2.  Enter the formula =RANK(B1,$B$1:$B$8) in cells C1:C8
3.  Enter the formula =INDEX($A$1:$A$8,C1) in cells D1:D8

Every time you calculate (hit F9), a newly shuffled list will appear in cells D1:D8

# perl - 使用 Perl，我如何在搜索结果中显示搜索词周围的上下文？

> ID：616041
> 
> 赞同：1
> 
> 时间：2009-03-05T18:41:04.153
> 
> 标签：perl, search, full-text-search

我正在编写一个在大部分文本中搜索术语的 Perl 脚本。我想向用户显示的是搜索词周围文本的一小部分，因此用户可以了解使用此搜索词的位置的上下文。谷歌搜索结果是我试图完成的一个很好的例子，你的搜索词的上下文显示在链接的标题下。

我的基本搜索是使用这个：

```
if ($text =~ /$search/i ) {
    print "${title}:${text}\n";
} 
```

（$title 包含在其中找到搜索词的项目的标题）但这太多了，因为有时 $text 将包含数百行文本。

这将显示在网络上，所以我可以只提供标题作为实际文本的链接，但没有用户的上下文。

我尝试修改我的正则表达式以捕获搜索词之前的 4 个词和之后的 4 个词，但如果搜索词位于 $text 的开头或结尾，则会遇到问题。

什么是实现这一目标的好方法？我尝试搜索 CPAN，因为我确定有人为此提供了一个模块，但我想不出要搜索的正确术语。如果可能的话，我想*在*没有模块的情况下这样做，因为在这里安装模块很痛苦。有没有人有任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T19:36:59.527

您可以使用 $ `and $' to get the string before and after the match. Then truncate those values appropriately. But as blixtor points out, shlomif is correct to suggest using`@+ `and`@-`to avoid the performance penalty imposed by $`和 #' -

```
$foo =~ /(match)/;

my $match = $1;
#my $before = $`;
#my $after = $';
my $before = substr($foo, 0, $-[0]);
my $after =  substr($foo, $+[0]);

$after =~ s/((?:(?:\w+)(?:\W+)){4}).*/$1/;
$before = reverse $before;                   # reverse the string to limit backtracking.
$before =~ s/((?:(?:\W+)(?:\w+)){4}).*/$1/;
$before = reverse $before;

print "$before -> $match <- $after\n"; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T19:15:04.167

您在之前/之后的 4 个单词的初始尝试并没有太远。

尝试：

```
if ($text =~ /((\S+\s+){0,4})($search)((\s+\S+){0,4})/i) {
    my ($pre, $match, $post) = ($1, $3, $4);
    ...
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T20:53:55.643

我建议使用位置参数 - @+ 和 @-（参见 perldoc perlvar）来查找匹配字符串中的位置，以及需要多少。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T19:01:28.333

您可以尝试以下方法：

```
if ($text =~ /(.*)$search(.*)/i ) {

  my @before_words = split ' ', $1;
  my @after_words = split ' ',$2;

  my $before_str = get_last_x_words_from_array(@before_words);
  my $after_str = get_first_x_words_from_array(@after_words); 

  print $before_str . ' ' . $search . ' ' . $after_str;

} 
```

一些代码显然被省略了，但这应该让您对这种方法有所了解。

至于提取标题......我认为这种方法并不适合。

# sql-server - 如何通过代理服务器连接到 SQL Server

> ID：616042
> 
> 赞同：7
> 
> 时间：2009-03-05T18:41:04.467
> 
> 标签：sql-server, networking, proxy, database-connection

是否可以使用 SQLSERVER oledb 提供程序通过代理 (http) 连接到 SQL Server 服务器？

如果可能，如何在连接字符串中指定代理地址和端口？

如果不可能，您会推荐哪些绕过代理的非标准方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T00:19:33.310

本文似乎特定于 MS ISA 服务器，但理论上可能成立。

2008年

[http://msdn.microsoft.com/en-us/library/ms190801.aspx](http://msdn.microsoft.com/en-us/library/ms190801.aspx)

2005年

[http://msdn.microsoft.com/en-us/library/ms190801(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms190801(SQL.90).aspx)

* * *

编辑：

也许 sql 2005 Web 服务会满足您的需要？ [http://technet.microsoft.com/en-us/library/ms345140(SQL.90).aspx](http://technet.microsoft.com/en-us/library/ms345140(SQL.90).aspx)

它不会给你正常的 odbc 功能。顺便说一句，您不应该将您的 SQL 服务器暴露在互联网上。

另外，见评论。

# asp.net - 在 ASP.NET 应用程序之间传递会话数据

> ID：616046
> 
> 赞同：7
> 
> 时间：2009-03-05T18:42:25.617
> 
> 标签：asp.net, web-applications, session

我们有几个 ASP.NET 应用程序部署到几个服务器。如果用户已经通过身份验证，在从一个应用程序移动到另一个应用程序时，是否有一种重用会话数据的标准方法或其他一些方法不要求用户登录到下一个应用程序？我希望你们知道这样做的最佳实践方法。我觉得我应该缺少一些简单的东西。

谢谢。

**编辑：**更清楚地说，我想传递的会话中的主要信息是经过身份验证的用户 ID，但也可能是其他一些会话变量。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T18:49:47.847

您可以为您的应用程序实施单点登录策略。

[http://aspalliance.com/1545_Understanding_Single_SignOn_in_ASPNET_20.all](http://aspalliance.com/1545_Understanding_Single_SignOn_in_ASPNET_20.all)

[http://blah.winsmarts.com/2006/05/19/aspnet-20-implementing-single-sign-on-sso-with-membership-api.aspx](http://blah.winsmarts.com/2006/05/19/aspnet-20-implementing-single-sign-on-sso-with-membership-api.aspx)

[http://johndyer.name/post/2005/12/Single-SignOn-with-ASPNET-Membership-and-WebServices.aspx](http://johndyer.name/post/2005/12/Single-SignOn-with-ASPNET-Membership-and-WebServices.aspx)

[http://msdn.microsoft.com/en-us/library/ms972971.aspx](http://msdn.microsoft.com/en-us/library/ms972971.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T18:45:30.680

[单点登录 (SSO)](http://en.wikipedia.org/wiki/Single_sign-on)

[http://msdn.microsoft.com/en-us/library/ms972971.aspx](http://msdn.microsoft.com/en-us/library/ms972971.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T18:48:12.343

对于会话检查： http: [//www.codeproject.com/KB/aspnet/Sharing_session_state.aspx](http://www.codeproject.com/KB/aspnet/Sharing_session_state.aspx)

对此进行补充，以便共享 cookie：http: [//mgrzyb.blogspot.com/2007/12/aspnet-and-subdomains.html](http://mgrzyb.blogspot.com/2007/12/aspnet-and-subdomains.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T19:16:23.837

您的问题并不清楚您是否只关心登录，或者您是否真的需要在应用程序之间共享会话数据。

假设后者，你可以尝试这样的事情：

*   首先，确保所有应用程序都在同一个域中运行。如果没有，所有赌注都取消。我不知道是否有一种简单的方法来配置会话 cookie 的域属性，所以你可能必须自己做，通过将 cookie 域属性设置为域：

    Response.Cookies["ASP.NET_SessionId"].Domain = ".mydomain.com";

*   您需要确保每个应用程序都配置为使用公共状态服务器或数据库支持的会话。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T05:04:21.440

在应用程序之间共享登录（如上所述）与在应用程序之间共享 ASP.NET 会话完全不同。

为什么要在应用程序之间共享 Sessions？

ASP.NET 会话是用户当前与一个 ASP.NET 应用程序交互的隐喻。它存在于 ASP.NET 中，为我们提供了一个地方来存储用户在使用您的应用程序时发出的各种页面请求之间的临时状态数据。

如果您的应用程序非常密切相关，例如用户同时或几乎同时使用两者，您可以考虑将它们合并到单个 ASP.NET 应用程序中。

如果您的应用程序没有那么密切相关，也许它们应该共享相同的数据库作为交换数据的一种方式，或者使用基于 Web 服务的 API 来交换信息。

希望有帮助。

# ssl - 供内部使用的 HTTPS 证书

> ID：616055
> 
> 赞同：56
> 
> 时间：2009-03-05T18:44:50.290
> 
> 标签：ssl, https, certificate

**我正在为仅**需要通过 HTTPS 在**内部网络**上使用的系统设置网络服务器（无法从外部访问）

现在我用自签名证书设置了它，它工作正常，除了一个令人讨厌的警告，所有浏览器都会启动，因为用来签名它的 CA 权威自然是不受信任的。

访问由本地 DNS 服务器上解析的本地 DNS 域名提供（例如：[https://myapp.local/](https://myapp.local/)），该地址将该地址映射到 192.168.xy

是否有一些提供商可以向我颁发一个适当的证书以用于内部域名 (myapp.local)？还是我唯一的选择是在真实域上使用 FQDN，然后将其映射到本地 IP 地址？

**注意**：我想要一个不需要在每个浏览器上将服务器公钥标记为受信任的选项，因为我无法控制工作站。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-03-05T18:48:25.353

您有两个实用的选择：

1.  建立自己的 CA。你可以用 OpenSSL 来做，那里有很多谷歌信息。

2.  继续使用您的自签名证书，但在浏览器中将公钥添加到您信任的证书中。如果您在 Active Directory 域中，则可以使用组策略自动完成。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2016-12-05T23:03:10.403

我做了以下，这对我很有效：

我获得了 *.mydomain.com 的通配符 SSL 证书（例如，Namecheap 以低廉的价格提供）

我创建了一个 CNAME DNS 记录，将“mybox.mydomain.com”指向“mybox.local”。

我希望这会有所帮助 - 不幸的是，您需要为您的域名购买通配符证书，但您可能已经拥有了。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-05T19:23:22.260

您必须为此询问典型的证书人员。不过，为了便于使用，我会使用 FQDN，您可以使用已注册子域的子域：[https ://mybox.example.com](https://mybox.example.com)

此外，您可能想查看通配符证书，为（例如）https://*.example.com/ 提供一揽子证书 - 如果您需要的不仅仅是这个证书，甚至可用于虚拟主机。

认证 FQDN 的子域或子域*应该*是标准业务——也许不适合那些以在 2 分钟内提供证书而自豪的大人物。

简而言之：要使证书受工作站信任，您必须要么

*   更改工作站上的设置（您不想要）或
*   使用已经信任的一方来签署您的密钥（您正在寻找解决方法）。

这就是你*所有*的选择。选择你的毒药。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-30T14:06:18.107

*我会将此添加为评论，但它有点长..*

这并不是您问题的真正答案，但实际上我发现不建议使用 .local 域 - 即使它在您的“本地”测试环境中，使用您自己的 DNS 服务器。

我知道 Active Directory 在您安装 DNS 时默认使用 .local 名称，但即使是微软的人也说要避免使用它。

如果您可以控制 DNS 服务器，则可以使用 .com、.net 或 .org 域 - 即使它只是内部的和私有的。这样，您实际上可以购买您在内部使用的域名，然后为该域名购买证书并将其应用于您的本地域。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2020-02-25T18:29:56.833

我有类似的要求，让我们公司的浏览器信任我们的内部网站。

我不希望我们的公共 DNS 为我们的内部站点发布公共 DNS，所以我发现完成这项工作的唯一方法是使用内部 CA。

这是为此而写的文章，

[https://medium.com/@mike.reider/getting-firefox-chrome-to-trust-your-internal-websites-internal-certificate-authority-a53ba2d4c2af](https://medium.com/@mike.reider/getting-firefox-chrome-to-trust-your-internal-websites-internal-certificate-authority-a53ba2d4c2af)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-23T13:46:07.083

我认为答案是否定的。

开箱即用，浏览器不会信任证书，除非它最终被预先编程到浏览器中的人验证，例如威瑞信、register.com。

您只能获得全球唯一域的经过验证的证书。

所以我建议您使用 myapp.local.yourcompany.com 而不是 myapp.local，如果您拥有 yourcompany.com，您应该能够获得证书。这会花费你的想法，每年几百美元。

还要注意通配符证书可能只会下降到一个级别 - 因此您可以将其用于 a.yourcompany.com 和 local.yourcompany.com 但可能不能用于 bayourcompany.com 或 myapp.local.yourcompany.com，除非您支付更多.

（有谁知道，这取决于通配符证书的类型吗？是主要浏览器信任的子子域吗？）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-09-03T16:59:40.043

### 仅用于开发目的

这个 docker 镜像解决了这个问题（感谢 local-ip.co）：[https](https://github.com/medic/nginx-local-ip) ://github.com/medic/nginx-local-ip 。

它在端口 443 中启动一个反向代理，并使用适用于任何`*.my.local-ip.co`域的公共证书。例如。您的本地 IP 是 192.168.10.10 → **192-168-10-10.my.local-ip.co**已经指向它（这是一个公共域）！假设应用程序在您的计算机上的 8080 端口运行，您只需执行此操作即可代理传递您的应用程序并将其公开在 URL [https://192-168-10-10.my.local-ip.co](https://192-168-10-10.my.local-ip.co)：

```
$ APP_URL=http://192.168.10.10:8080 docker-compose up 
```

使用您在要访问应用程序的设备中配置的任何公共 DNS 解析域，但您的流量在您的应用程序和客户端之间保持本地（通过代理），因此您甚至可以使用它来连接内部的设备同一个 LAN 网络，没有任何流量到互联网，所有流量都是本地的。

对开发最有用的原因是任何人都可以使用相同的证书启动应用程序，因此并不是很安全，但是当您需要在开发或测试时使用 HTTPS 公开您的应用程序时很有帮助（例如，加载的 Android 中的 HTML5 应用程序）与网络视图）。

# jsp - JSP 标记生命周期

> ID：616064
> 
> 赞同：11
> 
> 时间：2009-03-05T18:46:12.473
> 
> 标签：jsp, jsp-tags, lifecycle

我刚刚在我的代码中引入了一个错误，因为我似乎误解了 jsp 标签的生命周期。

在出现错误之前，标签的工作方式是这样的：我将一些集合作为属性传递给标签，并将其显示为表格。集合从控制器传递到 JSP。

错误之后：我删除了设置集合的属性。相反，在标签中我检查集合是否为空，然后从请求中按名称获取它（使用命名约定）。

出乎我意料的是：集合最初设置在标签中之后，在后续执行中它永远不会变为 null！它仍然被定义为 TLD 中的非必需属性。

我**希望**标签在执行之间不会保留以前的值。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-05T19:08:34.570

你自己回答了这个问题 - 它是汇集的。请参阅[标签教程](http://java.sun.com/products/jsp/tutorial/TagLibraries8.html)以了解在 java 实现中要实现的内容，以及从那里链接的页面，其中包含[调用序列](http://java.sun.com/products/jsp/tutorial/TagLibraries18.html#62842)：

```
ATag t = new ATag();
t.setPageContext(...);
t.setParent(...);
t.setAttribute1(value1);
t.setAttribute2(value2);
t.doStartTag();
t.doEndTag();
t.release(); 
```

也就是说，根据 API 的需要，在 doEndTag() 中重新初始化您的标签实例。（由 Julien Kronegg 更改评论，谢谢）

请注意，池化可能是容器相关的，但非常合法（并且，由于 API 设置，可能在任何地方都进行）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-05-18T11:55:17.003

简短的回答：你不应该自己写属性属性。通过这样做，您将清洁国家作为您的责任。

对于更长的答案，[JSP 2.0 规范](http://jcp.org/aboutJava/communityprocess/final/jsr152/)规定了以下内容（第 2-51 页）：

*   *为特定标签出现的所有指定*属性调用设置器
*   **不**为*省略*的属性调用设置器（保持默认值不变，在您的情况下，内部状态为非法值）
*   标记处理程序只能被具有相同的一组指定属性的事件重用

这三点共同保证属性属性始终正确初始化，同时仍保留默认值（在构造函数或属性的声明中定义）。作为回报，它仅在只有容器操纵属性属性（通过调用设置器）的假设下才起作用。

为了完整起见：

*   `release()`不应用于在标记处理程序的调用之间重置内部状态。它只保证在 GC 之前被调用，并且应该用于释放长期资源。
*   如果要在 中初始化实例变量`doStartTag()`，请注意不要覆盖属性，因为此时容器已经调用了 setter。
*   `doEndTag()`应该可以安全地用于初始化，因为在异常情况下绝不应重复使用标记（请参阅第 2-54 页 [2]）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-03-05T19:09:54.033

JSP 1.2 规范添加了 TryCatchFinally 接口。 [http://docs.oracle.com/javaee/1.4/api/javax/servlet/jsp/tagext/TryCatchFinally.html](http://docs.oracle.com/javaee/1.4/api/javax/servlet/jsp/tagext/TryCatchFinally.html)

所以看起来你应该在 doStartTag() 方法中分配资源并在 doFinally() 方法中清理。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T18:57:29.620

所以答案是：标签被汇集到魔法池中，并在执行之间重复使用。标签规范说：

“不应设置未指定的属性/属性（使用 setter 方法）。”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-05T20:55:53.417

对 Tomcat 6 的观察表明 release() 仅在容器关闭时调用。标记处理程序实例成员应在 doEndTag() 中清除实例状态。从 api 文档：

“必须重置与此实例关联的所有实例状态。”

请参阅[TagSupport.doEndTag()](http://java.sun.com/products/servlet/2.2/javadoc/javax/servlet/jsp/tagext/TagSupport.html#doEndTag())

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-04-21T00:31:16.343

release方法是JSP使用完标签的时间段，用来让标签释放。

# asp.net-mvc - 具有多个视图的单个控制器

> ID：616072
> 
> 赞同：1
> 
> 时间：2009-03-05T18:48:31.797
> 
> 标签：asp.net-mvc, model-view-controller

我正在尝试创建具有多个视图但使用单个控制器的 MVC 应用程序。我首先使用另一个属性创建第二条路由，我可以使用它来重定向到第二个文件夹。

```
 public static void RegisterRoutes(RouteCollection routes)
    {
        routes.IgnoreRoute("{resource}.axd/{*pathInfo}");

        routes.MapRoute(
            "xml",                                              // Route name
            "xml/{controller}/{action}/{id}",                           // URL with parameters
            new { mode = "xml", controller = "Home", action = "Index", id = "" }  // Parameter defaults
        );

        routes.MapRoute(
            "Default",                                              // Route name
            "{controller}/{action}/{id}",                           // URL with parameters
            new { controller = "Home", action = "Index", id = "" }  // Parameter defaults
        );
    }
    protected void Application_Start()
    {
        RegisterRoutes(RouteTable.Routes);
        SessionManager.Instance.InitSessionFactory("acstech.helpWanted");
        ViewEngines.Engines.Clear();
        ViewEngines.Engines.Add(new ModeViewEngine()); 
    } 
```

我随后从 WebFormViewEngine 下降并将路径从 ~/View 更改为 ~/{mode}View。这工作并运行正确地呈现了页面。我遇到的问题是 Html.ActionLink 始终使用模式版本，无论视图呈现什么。这是实现我的目标的正确方向吗？如果是这样，我缺少什么来让动作链接正常工作。下面是 ViewEngine。这是一个实验室测试，所以有些自由。

```
public class ModeViewEngine : WebFormViewEngine
{
    public ModeViewEngine()
    {

    }

    protected override IView CreatePartialView(ControllerContext controllerContext, string partialPath)
    {
        string mode = String.Empty;
        if (controllerContext.RouteData.Values["mode"] != null)
            mode = controllerContext.RouteData.Values["mode"] as string;
        return new WebFormView(partialPath.Replace("~/Views", "~/" + mode + "Views"), null);
    }

    protected override IView CreateView(ControllerContext controllerContext, string viewPath, string masterPath)
    {
        string mode = String.Empty;
        if (controllerContext.RouteData.Values["mode"] != null)
            mode = controllerContext.RouteData.Values["mode"] as string;
        return new WebFormView(viewPath.Replace("~/Views", "~/" + mode + "Views"), masterPath);
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T22:14:06.047

您是否尝试在默认路由的默认数组中添加 mode="" ？也就是说，据我了解，“索引”操作是如何从 URL 中省略的，所以理论上应该使它与我相信的默认路由相匹配。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T18:55:18.067

为什么不让您的控制器根据模式选择不同的视图？然后您可以返回您的主页视图或 Home_Xml。

我猜你的方式将这个决定移出控制器并集中逻辑，但它也需要你在你拥有的每个模式中创建一个匹配的视图。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T19:54:05.243

Asp.Net 框架的优点在于它是非常可扩展的。我认为您应该查看此链接。它将拥有您正在寻找的东西。我和作者的意见是创建一个 ActionFilter 并在需要 XML 甚至 JSON 视图的控制器中装饰您的视图。我什至见过所有对 XML 的序列化都发生在过滤器中并返回的情况，因此不需要 ViewEngine。

[http://jesschadwick.blogspot.com/2008/06/aspnet-mvc-using-custom-view-engines.html](http://jesschadwick.blogspot.com/2008/06/aspnet-mvc-using-custom-view-engines.html)

# html - 避免元素在“溢出：隐藏”元素内时被切断

> ID：616074
> 
> 赞同：6
> 
> 时间：2009-03-05T18:48:47.007
> 
> 标签：html, css

[我正在使用本页](http://www.ejeliot.com/blog/61)概述的等高 CSS 技巧。

直到今天，当我需要在其中一列中添加一个对话框时，一切都运行良好，该对话框的绝对位置可以使其脱离流程。问题是由于容器上有“溢出：隐藏”，当它溢出时对话被切断。

除了将对话带到容器元素之外，有没有办法让它通过 CSS 显示？

这是一个小例子，展示了我提到的内容。

```
<style>
.container { overflow: hidden; margin-top: 30px }
.col { 
    float: left;
    padding-bottom: 2000px;
    margin-bottom: -2000px;
    border-right: 1px solid black;
    width: 100px;
    background-color: grey;
}
.col.third { border-right: none }

#div-a { position: relative }
#div-b {
    position: absolute;
    background-color: red;
    width: 35px;
    height: 350px;
    bottom: 0;
    right: 0;
    margin: 5px;
    border: 2px solid black;
}
</style>

<div class="container">
    <div class="col first">
        <p style="height: 100px">One</p>
    </div>
    <div class="col second">
        <p style="height: 300px">Two</p>
        <div id="div-a">
            <!-- this gets cut off by the "overflow: hidden" on div.container -->
            <div id="div-b">
                Foo
            </div>
        </div>
    </div>
    <div class="col third">
        <p style="height: 200px">Three</p>
    </div>
</div> 
```

当它在元素中溢出时，您会看到它`div#div-b`在顶部被切断。`div.container`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T19:07:01.080

不幸的是，如果不将对话带到容器元素之外，您想要做的事情是不可能的。

最好的办法是让对话框元素成为容器的同级元素并以这种方式定位。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T19:08:28.737

不幸的是，没有......我认为没有办法绕过溢出：用绝对位置隐藏。您可以尝试使用 position: fixed，但如果使用它，您将不会在完全相同的条件下进行定位。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T19:13:39.160

一种选择是将溢出：隐藏容器的内容放入子容器（可能是子 div）。然后，使子容器与容器的尺寸相匹配，并将溢出：隐藏从容器移动到子容器。

然后，您可以使对话框成为容器的子容器（子容器的兄弟），它现在将存在于没有溢出：隐藏的元素中。

我没有对此进行测试，并且从容器中删除溢出：隐藏可能会破坏您的设计。如果是这种情况，我建议像其他人一样将对话框完全移出容器。如果您无法选择将对话框的代码放在其他任何地方，这甚至可以通过 Javascript 完成。（当您需要显示对话框时，Javascript 可以使对话框成为 BODY 或其他标签的子级）

# makefile - 为什么 *nix 上的 makefile 中的一些特殊/控制字符有时会在 make 过程中出错？

> ID：616075
> 
> 赞同：0
> 
> 时间：2009-03-05T18:48:54.337
> 
> 标签：makefile

我有时经历过，如果任何特殊/控制字符（$、^M 或其他内容）以某种方式进入 makefile，那么如果您尝试使用该 makefile 制作 -f Makefile 则会出错。

我想知道，

1.) 有没有人经历过这样的事情，如果有，是什么导致了这些错误？这些特殊字符有什么特别之处？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T18:55:13.217

UNIX 传统上对程序的输入不是很宽容。这种态度自最初成立以来并没有太大变化。`^M`是回车，通常只有在 Windows 环境中编辑文件时才会进入文件。UNIX 使用换行符 (\n, 0x0a) 作为行终止符，许多工具抱怨 CR (\r, 0x0d)，因为他们看不出该字符应该存在的原因。

`$`是一个不同的问题，就像`$`makefile 语法的一部分一样。它用于指示生成文件中的变量/常量。这些可以是上下文的，比如`$<`or `$*`，或者命名的比如`$(CC)`。

您可以使用该`dos2unix`实用程序来摆脱`^M`和转义美元符号`\$`。

尽管如此，还有更多的特性要做。例如，目标的命令行需要用制表符缩进的要求。据我所知，只有`make`不是很广泛使用的才解除了这个限制。

# orm - 不允许使用 Orm 工具：你在做什么？

> ID：616080
> 
> 赞同：7
> 
> 时间：2009-03-05T18:49:24.447
> 
> 标签：orm, data-access-layer

假设您在一家不允许使用任何类型的 ORM 工具的 IT 商店。他们不想购买，您也不能使用开源解决方案。

你会怎么做？放弃真正的领域模型和以工作表为中心？制作自己的 DAL？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-05T18:57:16.377

严格来说，您的选择是：

1.  不要使用关系数据库
2.  不要使用 OOP 语言

否则某种 ORM 解决方案是不可避免的（即使你自己推出，它仍然是一个简单的 ORM 层）。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-05T19:20:47.413

Based on your username, I'd say "use LINQ." It's built into .NET and it's not an ORM (strictly speaking).

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-05T18:51:30.307

选项：

1.  自己滚
2.  退出
3.  无论如何都要使用开源的，不要告诉他们，在原型运行良好时向他们展示原型，然后让他们重新考虑开源。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-05T19:29:12.977

如果您确实无法使用现有的 ORM 之一，那么我不建议您创建自己的 ORM。本地种植的 ORM 往往是半实施、设计不佳、长满疣的野兽，在前六个月似乎有所帮助，然后逐渐成为项目中最耗时的问题。

如果您应用 Fowler 的企业应用程序架构模式中的“RowDataGateway”或“TableDataGateway”等模式，则可以不使用 ORM。

您最终仍会发展自己的隔离层以将您的域与数据库分开，但创建它不会像滚动您自己的 ORM 那样昂贵。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-05T19:08:59.767

There are three possibilities here:

1.  Your bosses don't understand the benefits of using an ORM.
2.  Your bosses are doing things the way they always have done things and won't consider changing.
3.  Your bosses have valid reasons for not choosing an ORM.

More than likely though, it's a combination of these three things. They probably have valid concerns that could be cured through better understanding of ORMs. My advice is to try selling them on ORMs. Find a particularly nasty piece of code that could be cured by using an ORM and make a prototype that shows how much that code could be simplified. Also, be willing to compromise.

If they're not willing to budge on this, you need to ask yourself if this is really a place you want to work. Not because they won't let you use ORMs (which you could probably live without), but because they won't listen to you. You can't always have your way, but you should have input on the development process.

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-05T19:18:56.793

If it's about the company being too cheap to buy one, then write your own, and at the end of the project show them the cost in terms of your time. (I assume they're against free alternatives on principle)

If it's about performance, you might have to check whether they have a point.

If they worry that it adds a layer of complexity which other developers will have to learn, then show some examples of code simplified with the ORM.

If it's because the application is already very "table-centric" you'll also have to think whether adding an ORM will improve things or just add a lot of unnecessary mapping complexity.

(Oh, and read this : [http://blogs.tedneward.com/2006/06/26/The+Vietnam+Of+Computer+Science.aspx](http://blogs.tedneward.com/2006/06/26/The+Vietnam+Of+Computer+Science.aspx) )

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-05T18:51:53.147

我会推出我自己的 DAL，使用类似于[Generic DAO](http://www.hibernate.org/328.html)的东西来抽象它，这样我的代码的其余部分就不会紧密耦合，但我正在获取数据。

如果它们稍后出现，这使得将其全部交换到 ORM 变得很容易。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-05T18:53:33.547

制作你自己的 DAL，就像我们在很久以前，很久以前...... 2004 年所做的那样。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-05T19:04:11.900

First off, it's absolutely retarded that you can't even use an open source one.

If you have to roll your own, it's not a huge deal. You can still have domain models just fine. You might have an easier time if you model each record, and then build the domain models to load data from that as an intermediate format.

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-05T19:21:41.000

See what they think about iBatis ([http://ibatis.apache.org/](http://ibatis.apache.org/)) which isn't an ORM but helps you get objects from database queries without inscrutable ORM magic, lots of XML though.

How are they doing things now?

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-05T20:05:10.847

我会推出自己的解决方案，可能会使用某种代码生成工具。从技术上讲，如果您将结果（无论是数据读取器、表格、记录集还是其他）转换为您的对象，您就有一个小的 o/r 映射器，非常缺乏但仍然......我猜这是定义问题。

我的主要目标是避免在我的代码中重复 CRUD，这需要时间，很无聊并且是缺陷的来源。

如前所述：如果不需要关系数据库，您总是可以使用一些对象数据库。但是那些更不常见，如果你的老板反对 orm:s 他不太可能这样做。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-05T18:54:39.253

询问为什么不允许使用 ORM，什么构成 ORM，然后从那里决定两种可能性中的一种：

1.  交易
2.  没有交易（退出）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-04-06T06:27:18.123

如果你决定构建我们自己的 DAL，[Davy Brion](http://davybrion.com/)有一个很好的教程。
查看[构建您自己的数据访问层系列](http://davybrion.com/blog/2009/08/build-your-own-data-access-layer-series/)。

* * *

## 回答 #14

> 赞同：-4
> 
> 时间：2009-03-05T19:37:11.913

> “没有任何类型的 ORM 工具。他们不想购买，你也不能使用开源解决方案。”

没有任何类型的 ORM**或者**只是开源/$$$？

优秀的 ORM 工具有免费版本：

*   **Telerik Open Access Express**：与 Express 数据库一起使用
    *   网址：[http ://www.telerik.com/products/orm.aspx](http://www.telerik.com/products/orm.aspx)
*   **Lightspeed Express**：仅限于八个模型类别
    *   网址： http: [//www.mindscape.co.nz/products/LightSpeed/download.aspx](http://www.mindscape.co.nz/products/LightSpeed/download.aspx)

# ms-access - 访问缓存 ODBC 连接设置

> ID：616083
> 
> 赞同：1
> 
> 时间：2009-03-05T18:49:52.790
> 
> 标签：ms-access, odbc

我的公司大量使用 SAI，为了从这个系统创建报告，我们使用 ODBC 连接到数据库。我们目前的设置是区域性的，因此我们为每个区域设置了单独的环境。当尝试使用 MS ACCESS 访问这些环境时，我发现我无法链接到不同环境中的表并检索准确的数据。

我可以使用特定的 DSN 创建到各种环境的链接。然后我可以访问数据，但是我打开的第一个表，无论它属于哪个区域，都可以正常工作。然而，在那之后，所有的表，无论它们属于哪个区域，都使用打开的第一个表中的 DSN 设置。如果我关闭 Access 并重新启动，我可以从另一个环境中的数据开始，然后这些数据将起作用，但是其余数据将反映这些 DSN 设置。此外，当我查看属性表时，DSN 设置应如此。

我还要补充一点，每个区域的表都具有相同的名称。即销售表是所有环境的销售，生产表是所有地区的生产表。因此，当我从多个环境链接到销售表时，需要在 MS ACCESS 中重命名。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T03:06:38.070

我会看看上个月回答的这个[SO Question 。](https://stackoverflow.com/questions/564265/how-to-refresh-linked-tables-in-an-access-mdb-when-odbc-changes/564454#564454)

它描述了一些强制 Access 重新链接 ODBC 表的方法，如果都失败了，它会为您提供一种使用[我的博客上的小函数以](http://blog.nkadesign.com/2008/ms-access-restarting-the-database-programmatically/)编程方式重新启动数据库的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-04-04T00:14:43.113

我怀疑你遗漏了我们需要的一些细节。

当您打开第一个表时，是否会提示您登录？（这是关键信息）。如果您使用“不同”链接并在这些链接中保存用户 ID/密码，那么您应该不会收到任何 ODBC 提示，因此您可以轻松地使用多个区域。

但是，听起来您有一组链接，并且想要重新指向/重新链接到不同的服务器。这可以工作 - 但如果您看到/允许 ODBC 提示，则不能。

如果您在链接中包含用户 ID/密码，那么您应该能够重新链接（切换）到任一系统。但是，当您执行此操作时，uid/密码组合都将在同一给定时间处于活动状态。

事情变得非常错误的地方是，如果您使用不正确的登录重新链接，那么将使用以前的 uid/密码！事实上，如果您测试登录（即使是错误的登录！），那么将使用第一个合法登录！归根结底，这意味着这里的弱点是当/如果您要求登录，即使登录错误，它也会返回“是”以获得合法登录！（因为 Access 将恢复到以前使用的合法登录）您必须处理此问题。

很可能事情指向您的代码在重新链接之前进行了登录“测试”。我建议您的“测试”登录代码返回 OK，然后执行传递查询以返回数据库名称——如果该数据库名称/服务器错误，则拒绝该登录并且不重新链接。

这里至关重要的是您如何测试新的登录/服务器？而且您绝对不希望出现 ODBC 登录提示 - 因为如果用户取消或输入错误的登录，那么您的重新链接代码将使用先前缓存的登录。

您应该能够重新链接相同的给定表集并将它们指向另一台服务器 - 但您需要确保您使用的登录确实有效。

最后但并非最不重要的一点是：Access 始终使用 DSN 较少的连接。唯一的例外是您使用的是系统 DSN。因此，当您创建文件 DSN 并重新链接时，从该点开始的 DSN 将被忽略，并且不会被使用。（这使您可以说将应用程序分发到其他桌面，而无需复制/包含 DSN）。因此，实际上您几乎总是使用无 DSN 连接，如果不是，那么我建议您转储系统 DSN，因为 Access 无法使用此类系统 DSN 中的用户/密码——即使您在其中包含用户/密码DSN 它仍然被忽略。

此外，当您重新链接时，您是否使用 dbAttachSavePWD - 您不应该这样做，但我会为了测试包括它。

如果您正在使用/允许 ODBC 驱动程序提示用户登录 - 那么您必须消除这种情况并确保您的代码进行登录。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T16:35:20.490

您可能拥有的一个选项（虽然有点冗长）是为每个区域创建一个访问数据库，该数据库链接到一个区域表。例如，将欧洲地区的销售表和生产表放在一个访问数据库中，并将来自亚洲的销售表和生产表放入另一个数据库中。

完成此设置后，您可能会发现使用第三个访问数据库链接到其他两个访问数据库要容易得多。

希望这是有用的。

# .net - 如果 .net sha1 hash 需要一个字节数组，而 php sha1() 需要一个字符串，我可以匹配结果吗？

> ID：616087
> 
> 赞同：2
> 
> 时间：2009-03-05T18:51:17.843
> 
> 标签：.net, php, sha1

我有一组要应用 sha1 哈希的字节。一个散列在 .net 中，另一个在 PHP 中。然后我会测试它们是否匹配。

在 .net 中，您可以创建一个字节数组并使用 sha.ComputeHash()。

```
byte[] data = new byte[DATA_SIZE];
byte[] result; 

SHA1 sha = new SHA1CryptoServiceProvider(); 
// This is one implementation of the abstract class SHA1.
result = sha.ComputeHash(data); 
```

在 PHP 中，您调用 sha1($string)。

我无法对代码的 .net 端做任何事情，但是如何从 PHP 中获得与 .net 生成的相同的哈希值？

请注意：我只能在 PHP 方面工作。.net 的东西是固定的，不能修改。谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T18:58:41.677

由于 SHA1 是一种通用的标准算法，因此它在 PHP 中的实现方式与在 .NET 中的实现方式相同。唯一不同的部分是调用这两个函数的方式。

从技术上讲，SHA1 是在字节而不是字符串上定义的，但是（如果我错了，请纠正我）PHP 字符串适用于单字节字符，因此从 SHA1 算法的角度来看，字节和字符应该是可互换的。

您必须确保二进制字符串的值与 .NET 的字节数组相同，顺序相同。我不是 PHP 人，所以你必须得到别人的答案才能做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T18:57:17.483

看起来 sha1 函数采用十六进制表示法的字节数组。所以如果你有两个字节，FA 和 A1，你的字符串就是“FAA1”。

然后，您会将结果字符串解析回字节并与 .NET 输出进行比较。

请注意，您可以很容易地在 .NET 中以相同格式创建此字符串（在每个字节上调用 ToString 时使用“x2”格式并将所有内容附加在一起）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-24T16:10:01.793

这对我有用：

```
string str = user.Salt + pepper + password;
SHA1 sha1 = new SHA1CryptoServiceProvider();
ASCIIEncoding encoder = new ASCIIEncoding();
byte[] input = encoder.GetBytes(str);
byte[] hash = sha1.ComputeHash(input);
string hashStr = "";
for (int i = 0; i < hash.Length; i++)
     hashStr += hash[i].ToString("X").ToLower();
if (hashStr != user.Hash)
     return false; 
```

# visual-studio - 已经有 MSDN 和 Team System 测试版，我该怎么做

> ID：616089
> 
> 赞同：0
> 
> 时间：2009-03-05T18:51:27.343
> 
> 标签：visual-studio, visual-studio-2008

已经拥有带有 Team System 测试版的 MSDN，我该如何获得开发者版？在 MSDN 上找不到。

我需要为此购买一个完整的其他 MSDN 许可证吗？

您能否将另一个 SKU 添加到 Team System 系列中，换句话说，您可以有 2 个 Team System 版本，还是必须是 Team $uite MegaVersion 或单个版本？

另外，你可以在 VS 测试版中使用 FxCop 和 VS 外壳集成吗？

任何网址/提示将不胜感激。在我看来，关于如何混合和匹配 VS 版本的文档很少。如果 MSFT 在 VS 中有一个“Visual Studio 商店”菜单项，您可以去那里自动购买/下载不同的 SKU，那就太好了。我的意思是我只需点击几下就可以将额外的状态下载到 TurboTax，但 MSFT 很难做到这一点。

PS 与 Visual Studio 数据库版相同的一组问题.....是的，我是一名身兼数职的开发人员。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T18:55:20.330

首先，一旦您登录到 MSDN 站点，请确保您已单击页面顶部的“下载”选项卡，然后在右下角附近单击“MSDN 订阅者下载”。您在订阅级别可以访问的软件将显示在列表中。

其次，如果您仍然看不到您要查找的内容，您可以考虑查看您的 MSDN 订阅级别的详细信息。

我希望这有帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T18:57:18.670

如果您真的要使用所有不同的产品，那么最好拥有完整的系统许可证。我认为其中 2 种产品的价格是全价的，如果您使用的是 3...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T00:34:26.193

您会看到 3 个常见的许可级别：

**Visual Studio Pro** - 不包括任何团队系统功能

**Visual Studio Team System xxxxx 版**- 其中 xxxx 是开发人员、测试人员、架构师或 DBPro。包括 VS Pro 的所有功能 + 与您选择的角色相关的功能。

**Visual Studio Team Suite** - 包括所有不同角色版本的功能。

如果您拥有 VSTS 开发人员版并且想要其他角色的某些功能，则必须为其他角色购买第二个 VSTS 许可证，或者升级到 VSTS Team Suite。如果我没记错的话，VSTS Team Suite 的成本大约是 VSTS 特定角色版本的两倍，因此大多数人不会购买多个角色版本，而是选择升级到 Team Suite，因为成本约为。相同。

您可以在此处比较标价：http: [//www.microsoft.com/visualstudio/en-us/howtobuy/compare-price.mspx](http://www.microsoft.com/visualstudio/en-us/howtobuy/compare-price.mspx)

# ruby-on-rails - Rails：索引多个模型？

> ID：616094
> 
> 赞同：1
> 
> 时间：2009-03-05T18:52:38.713
> 
> 标签：ruby-on-rails

我有 3 个模型：母公司、公司和联系人，然后我想在一个索引页面上列出所有这些模型，其中包含 3 个不同的部分，具体取决于模型。

有没有干净的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T19:11:48.543

也许是这样的？

```
<% @objects.each do |obj| %>
  <% klass = obj.class_name.to_s.tableize.singularize %>
  <%= render :partial => "#{klass}", :locals => {"#{klass}".to_sym => obj} %>
<% end %> 
```

还是四行代码，你就失去了清晰度。为什么不只列出对部分的三个调用？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T18:55:29.500

您可以定义一个视图模型类，其中包含您需要获取到 UI 的列表。

# perl - 如何在不使用 CPAN.pm 的情况下安装 Perl 模块？

> ID：616097
> 
> 赞同：19
> 
> 时间：2009-03-05T18:52:45.093
> 
> 标签：perl, cpan

可能吗？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-03-05T19:15:47.283

If you download the source code, and read the `README` file. This will probably tell you you should do

```
perl Makefile.PL
make
make test
make install 
```

or

```
perl Build.PL
./Build
./Build test
./Build install 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-05T18:57:14.333

如果您下载源代码，它通常会有一个 Makefile.PL。你运行“perl Makefile.PL; make; make test; make install”，它会为你构建和安装。

显然，如果您不使用 CPAN.pm，您将不得不自己处理依赖关系。

另外，如果你不能使用 CPAN.pm 的原因是你没有安装到 /usr/lib/perl 的权限，你可以强制 CPAN.pm 在本地安装，但我忘记了如何安装。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-05T22:36:34.913

If you are on a Linux box, a very large portion of the packages can usually be obtained using the built in package manager. For instance, on an Ubuntu system, if you want to install the PostgreSQL Perl module you'd simple do:

```
sudo apt-get install libpg-perl 
```

You can see a list of the modules for Ubuntu here: [http://packages.ubuntu.com/hardy/perl/](http://packages.ubuntu.com/hardy/perl/)

I find I can often guess at the names myself. Not sure if this helps at all, but for myself I often find this easier to use than CPAN as it does a lot better at resolving dependencies.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-03-07T11:47:53.837

请参阅此处：[如何在没有 root 的情况下使用 CPAN 安装 perl 模块](http://sial.org/howto/perl/life-with-cpan/non-root/)

我刚刚在没有 root 访问权限的服务器上进行了设置，CPAN 会自动完成所有操作。

但是如果你*真的*想安装一个没有 CPAN 的模块并且你没有 root（假设这是因为你不想使用 CPAN），你可以这样做

```
perl Makefile.PL PREFIX=$HOME
make
make install 
```

您将不得不自己寻找依赖项，因此最好使用 CPAN。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-05T21:04:27.727

如果问题是没有 root 访问权限，我建议查看CPAN.pm[`local::lib`](http://p3rl.org/local::lib)和非 root 安装的[网页。](http://alumni.soe.ucsc.edu/%7Eyou/notes/perl-module-install.html)

但要回答所提出的问题，CPAN 或 CPANPLUS 会有所帮助，但不是必需的。正如 Leon 所说，你总是可以用老式的方式来做——虽然通常情况下，不这样做更容易。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-05T18:58:30.400

If the .pm file is pure Perl and doesn't need to be compiled you can just put it in your application's lib folder and use it as normal.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-06T00:36:53.253

如果您使用 Red Hat（Fedora、CentOS），您应该尽可能使用 RPM 来获取 Perl 依赖项。Perl 包*几乎总是*命名为 perl-Module-Name，例如 perl-DBI、perl-Spreadsheet-WriteExcel 等。

在 Ubuntu 上，命名方案是 libmodule-name-perl。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-12-22T10:42:10.430

我们可以在 ubuntu 中甚至使用终端安装所有 perl 模块。如果您使用的是 ubuntu 服务器，则执行以下命令，'sudo apt-get install "perl_module"' 您想要在“perl_module”中给出名称的模块意味着如果您要安装 Apache2::Cookie，它将位于“libapreq2”所以你必须给出“sudo apt-get install libapreq2”

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2009-03-07T14:53:43.170

我和其他人一样强烈建议使用 CPAN.pm。使用起来轻而易举，并且可以自动解决与您需要的模块相关的任何依赖项。

另一方面，我建议您在[perldoc上阅读](http://perldoc.perl.org)[perlmodinstall](http://perldoc.perl.org/perlmodinstall.html)文档，因为它还提供了其他操作系统的详细信息。

问候，

杰夫

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2015-11-27T10:49:50.830

如果你问这个是因为你在使用 CPAN 时遇到问题……你可能内存不足，这就是你不能使用 CPAN 的原因。

也许你没有交换文件。尝试这个：

```
$ sudo su
# dd if=/dev/zero of=/swap bs=1M count=1k # create a 1GB file
# mkswap /swap
# swapon /swap 
```

否则...停止一些服务。

```
$ sudo service mysql stop
$ sudo service nginx stop 
```

...然后再试一次

```
$ cpan install CPAN
$ cpan install MIME::Lite::TT::HTML 
```

# caching - 缓存目录结构

> ID：616099
> 
> 赞同：6
> 
> 时间：2009-03-05T18:53:11.363
> 
> 标签：caching, directory-structure

我正在为我的项目实施缓存。查看缓存目录结构后，我看到了许多示例，例如：

```
cache
cache/a
cache/a/a/
cache/a/...
cache/a/z
cache/...
cache/z
... 
```

你明白了。另一个存储文件的例子，假设我们的文件名为`IMG_PARTY.JPG`，一种常见的方法是将它放在一个名为的目录中：

```
files/i/m/IMG_PARTY.JPG 
```

一些想法浮现在脑海中，但我想知道真正的原因。

*   当目录中的文件较少时，执行线性查找的文件系统会更快地找到文件。这种结构将文件分散得很薄。

*   为了不搞乱 *nix 等实用程序`rm`，它接受有限数量的参数并一次删除大量文件往往是 hacky（必须通过它`find`等等）

真正的原因是什么？什么是“好的”缓存目录结构，为什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T19:01:46.787

每次我这样做时，都是为了避免在文件系统中进行缓慢的线性搜索。幸运的是，至少在 Linux 上，这已成为过去。

然而，即使在今天，使用基于 b-tree 的目录，一个非常大的目录也很难处理，因为要获得所有文件的列表需要永远和一天的时间，更不用说找到正确的文件了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T21:07:29.823

只需使用日期。因为您将按日期删除。:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-02-10T02:31:15.780

如果这样做`ls -l`，则需要`stat()`编辑所有文件以获取详细信息，这会大大增加列出时间 - 无论 FS 使用散列结构还是线性结构，都会发生这种情况。

因此，即使 FS 有能力处理非常大的目录大小，也有充分的理由不使用大型扁平结构（它们也是要备份的猪）

我已经在一个目录中或以树结构排列的 32,000 个文件对 GFS2（集群）进行了基准测试 - 递归列表比在平面结构中获取列表快大约 300 倍（可能需要长达 10 分钟才能获得目录列表）

EXT4 显示了类似的比率，但由于终点只有几秒钟，大多数人不会注意到。

# sql-server - SQL Server 中“CREATE TABLE ... LIKE ...”的等价物是什么

> ID：616104
> 
> 赞同：25
> 
> 时间：2009-03-05T18:54:06.243
> 
> 标签：sql-server, tsql, alter

我正在使用 SQL Server（我是 SQL Server 菜鸟）并尝试更改表。我想`CREATE TABLE LIKE`在删除键和约束以及 SQL Server 在更改原始表时似乎需要的所有其他 rigamorole 时安全地存储数据，但我无法找到与该命令匹配的...

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-03-05T20:05:35.417

您想重新创建相同的结构吗？

这个怎么样

```
 SELECT *
 into test
 FROM myRealTable
 where 0=1 
```

不会向新表中插入任何数据

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-05T18:58:16.000

你可以做

```
SELECT * INTO #MyTable_tmp FROM MyTable 
```

然后修改您的 MyTable，并将您的数据复制回去。我见过的其他方法是创建一个名为 Mytable_Tmp（不是临时表）的新表，这将是您的新表。

然后复制您的数据进行所需的任何迁移。然后您将删除原始表并在 Mytable 上进行重命名。

或者，您可以获得比较数据库并生成差异脚本或 VSTS DB 版（开发人员随附）的众多出色工具之一，您可以从项目文件到数据库执行差异脚本。

# 编辑

当您运行时`SELECT * INTO #MyTable FROM MyTable`，SQL Server 会创建一个名为 #MyTable 的新临时表，该表与您的 select 子句中的每个列和数据类型相匹配。在这种情况下，我们选择 *，因此它将匹配 MyTable。这只会创建不复制默认值、约束索引或其他任何内容的列。

# c# - SQL Insert Performance Improvement

> ID：616118
> 
> 赞同：0
> 
> 时间：2009-03-05T18:57:07.533
> 
> 标签：c#, sql, sql-server, database, performance

I am writing an application that logs status updates (GPS locations) from devices to a database. The updates occur at a set interval for each device, which is currently every 3 seconds. I'm using a simple table in SQL Server 08 for storing each update.

I've noticed that running the inserts is an area of slow down in my application. Its not a severe slow down, but noticable. Naturally, I'd like to write to the database in as an efficient way as possible. I have an idea to improve the performance and am looking for input and advice to see if it will help:

The status updates come in from an asynchronous Socket thread. In my current implementation, the database insert call is executed from this thread. I'm thinking I can create a queue for holding update data that the Socket thread can quickly add its update to and then go on its merry way. There would then be a separate thread whose sole responsibility would be checking the update queue and inserting the updates into the database.

Basically this whole process rests on the assumption that writing to the database from one location with a bunch of data all at once is more efficient than writing one row of data at a random time. Is my assumption correct, or way off base? Also, on the SQL side, is there a command to tell it to write a bunch of rows at once that would improve write performance?

This is how the database is being written to:

I'm using LinqToSQL in C#, so for each insert, I first create a DataContext instance. From the DataContext object I then call a stored procedure which inserts the location update. The table is indexed by datetime, for the time of the update.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T19:13:01.130

Have a look at the SqlBulkCopy class - this allows you to use BCP to insert chunks of data very quickly.

Also, make sure your indexes are efficient. If you have a clustered index on anything that does not increase sequentially (integer, date) then you will suffer performance slowdowns as the pages are filled up.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T19:02:03.120

Have you looked MSMQ ( Microsoft Message Queuing (MSMQ)) ? That seems to me an option to take a look.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T19:08:11.560

Yes, inserting in batches will typically be faster than separate inserts given your description. Each insert will require a connection to be set up and packets to be transferred. If you have a single small insert that takes one packet and you issue three of those, but you alternatively have three inserts that are small enough that they can all fit in one packet then it will help.

Quantifying it is difficult just based on your description - you'll need to do testing for that. For example, if you are keeping a dedicated connection open at all times anyway, as hova suggests, then you might see less of an impact.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T19:02:14.417

Another area you might want to take a look at is whether you are setting up and tearing down a connection for each insert. That alone might make a performance improvement, negating the need for batching.

You'll also want to have as few indexes on the table as possible.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T19:02:25.960

It sounds like a good idea. Why not give it a shot and see how it performs?

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T19:05:40.443

On the SQL side you'd want to have a look at making sure you are using parameterized queries.

Also batching your INSERT statements will certainly increase the performance.

Connection management is also key, of course that depends on how the application is built and whether it depends on a connection being there.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-27T23:43:46.120

Are you not afraid to loose data while are you collecting data to batch copy?

I'm writing application doing the same. At start I will have to write data from 3,5k GPS devices. One device should send data each minute but it can send faster. Destination number of devices is 10,5k.

I'm wondering about inserting performance too. For now I'm saving received data to db on every packet using pure ADO.NET ICommand and stored procedure. On my test serwer (Xeon 3,4GHz and one 1TB hard disk - normal desktop ;) it takes for now 1ms or less.

@GRIMUS - should I wondering if there will be more devices?

# javascript - 如何从口袋里的 javascript 中引用 div 即？

> ID：616126
> 
> 赞同：0
> 
> 时间：2009-03-05T18:57:38.200
> 
> 标签：javascript, internet-explorer, pocketpc

您好，我正在开发一个袖珍ie 网站。我正在运行带有口袋的袖珍 PC 2003 SE 模拟器，即。

我有一个并想从 javascript 中引用它。

`getElementById`并且`document.getElementsByTagName`不工作。在我看到的一个例子中`document.all[]`，甚至`xx.id`但都不起作用。

谁能启发我？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T18:09:38.480

最后变成了..

```
document.[id of the div] 
```

所以：`<div id="xx"> => document.xx`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T19:26:58.757

您可以从[这里](http://msdn.microsoft.com/en-us/library/ms838090.aspx)开始查看此类设备的确切支持。

在他们提到的 Web 开发部分下，[有关更多信息，请参阅为移动设备设计网站。](http://msdn.microsoft.com/en-us/library/aa458690.aspx).

在[此](http://msdn.microsoft.com/en-us/library/aa457277.aspx)页面上，您的选择看起来很严峻... :-(

# django - 带有 ModelChoiceField 的表单上的 Django ForeignKey 消失了

> ID：616131
> 
> 赞同：0
> 
> 时间：2009-03-05T18:58:22.163
> 
> 标签：django, forms, django-forms

Django中的奇怪问题与表单：

我有一个这样定义的 Form.class ...

```
class MeetingForm(forms.Form):
    owner = forms.ModelChoiceField(
            queryset=Profile.objects.all(),
            widget=forms.HiddenInput() )
    date = forms.DateTimeField()
    name = forms.CharField(max_length=30)
    etc. 
```

我通过调用这样的函数来创建新实例......

```
def newMeetingForm(request,profile) :
    mf = MeetingForm( {
        'date' : date.today(),        
        } )
    return mf 
```

哪个按预期工作。除了，会议的“所有者”字段是空白的。我认为我应该做的是像这样在 newMeetingForm 中预先填写所有者字段：

```
def newMeetingForm(request,profile) :
    mf = MeetingForm( {
        'date' : date.today(),
        'owner' : profile,
        } )
    return mf 
```

其中参数“profile”是一个 Profile 对象。

但是，当我运行它时，表单不会呈现。

我在模板中使用它：

```
{{ form.as_p }} 
```

但是在 newMeetingForm 中添加了额外的“所有者”行，它实际上似乎是一个空字符串。我假设它以某种方式默默地失败了，也许是因为 ModelChoiceField 试图呈现我预先填充的所有者值。但是这些值看起来还可以。那么我还应该寻找什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T19:19:20.583

你的代码看起来是正确的，很大程度上来说。实际上，我使用您拥有的表单和表单创建代码在我的机器上运行了一个“存根”项目，并取得了成功的结果（诚然，我猜到了 Profile 模型的外观）。

需要考虑的一件事是，尽管它不会影响渲染，但您应该使用字典作为`initial`数据来实例化 MeetingForm。如果您将它作为第一个位置参数传递，django 将假定您的意思是该数据是 POST 数据，因此应该验证表单。（抱歉，如果您已经知道这一点，并且只是为了提出问题而走捷径）。

我经常发现 django 视图会吞下重要的错误。要测试您的表单，请尝试在 Django shell 中执行此操作：

```
$ python manage.py shell
>>> from blah.models import Profile
>>> from blah.forms import MeetingForm
>>> from datetime import date
>>> p = Profile.objects.get(id=someid)
>>> mf = MeetingForm(initial={'date':date.today(), 'owner':p})
>>> print mf.as_p() 
```

这将输出表单，如果有严重的爆炸，也会输出错误。

另外，我知道这很愚蠢，但我也做过这样的事情:-)（额外的眼睛......等等......），你确定你正在将'form'变量传递给上下文你的模板渲染？并且该变量被称为“form”，而不是“mf”或类似的东西？

希望有帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T19:05:18.120

您确定要将 Profile 的实际实例传递给 newMeetingForm 吗？

# java - 在 JDBC 中，为什么准备好的语句的参数索引从 1 而不是 0 开始？

> ID：616135
> 
> 赞同：38
> 
> 时间：2009-03-05T18:58:49.540
> 
> 标签：java, jdbc, indexing, prepared-statement

在 Java 的其他任何地方，任何有索引的东西都从 0 开始。这里有改变的原因还是这只是糟糕的设计？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-03-05T19:04:54.003

从历史上看，数据库对绑定参数使用基于 1 的索引。这可能反映了集合论和数学中关系数据库的起源，它索引元素以 1 开头，并使用 0 来表示空集或空集。

在 shell 脚本和正则表达式中，零索引通常意味着“特殊”。例如，在 shell 脚本的情况下，第零个“参数”实际上是被调用的命令。

选择 JDBC 是经过深思熟虑的，但最终可能会导致比它解决的更多的困惑和困难。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-05T19:23:55.813

这是原始语言设计者淘汰弱者的阴谋的一部分。在原始规范中，数组从 -1 开始编号，具有 1 个元素的列表返回长度 =0。

今天，这个恶魔般的情节中只剩下 java Calendar API。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T19:04:18.857

就我个人而言，我会把这归咎于糟糕的设计。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T19:20:26.960

我了解 JDBC 和 ODBC 都基于 X/Open 调用级别接口。所以，它是 Java 之前的历史，比如从 0 开始的月份数字。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T19:02:52.760

很可能 JDBC 是以 ODBC 为模型的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T19:03:22.977

也许更人性化？此外，Java 的正则表达式 Matcher 的组以 1 作为第一个匹配组开始。

# c# - 我如何以及为什么要设置 C# 构建机器？

> ID：616149
> 
> 赞同：144
> 
> 时间：2009-03-05T19:03:47.483
> 
> 标签：c#, build, continuous-integration, build-automation, hudson

我正在与一个小型（4 人）开发团队合作开发一个 C# 项目。我建议设置一台构建机器，它会在夜间对项目进行构建和测试，因为我知道这是一件好事。麻烦的是，我们这里没有很多预算，所以我必须向当权者证明费用是合理的。所以我想知道：

*   我需要什么样的工具/许可证？现在，我们使用 Visual Studio 和 Smart Assembly 进行构建，使用 Perforce 进行源代码控制。我是否需要其他东西，或者是否有相当于运行自动化脚本的 cron 作业？*   除了表明构建损坏之外，这究竟会给我带来什么？我是否应该在此解决方案（sln 文件）中设置将由这些脚本运行的测试项目，以便我可以测试特定的功能？目前，我们有两个这样的测试，因为我们没有时间（或者坦率地说，经验）来进行良好的单元测试。*   我需要什么样的硬件？*   一旦构建完成并经过测试，将构建放在 ftp 站点上还是有其他方式进行内部访问是一种常见的做法？这个想法是这台机器进行*构建*，我们都去它，但如果我们必须进行调试构建。
    *   我们应该多久进行一次这种构建？*   空间如何管理？如果我们在夜间进行构建，我们应该保留所有旧构建，还是在大约一周左右后开始放弃它们？*   还有什么我在这里看不到的吗？

    我意识到这是一个非常大的话题，而我才刚刚开始。我在这里找不到这个问题的副本，如果那里有我应该得到的书，请告诉我。

    编辑：我终于让它工作了！Hudson 非常棒，FxCop 表明我们认为实现的一些功能实际上是不完整的。我们还必须将安装程序类型从 Old-And-Busted vdproj 更改为 New Hotness WiX。

    基本上，对于那些关注的人来说，如果您可以从命令行运行您的构建，那么您可以将其放入 hudson。通过 MSBuild 从命令行运行构建本身就是一个有用的练习，因为它强制您的工具是最新的。

* * *

## 回答 #1

> 赞同：147
> 
> 时间：2009-03-05T19:18:06.577

更新：[**Jenkins**](http://jenkins-ci.org/)是 Hudson 的最新版本。现在每个人都应该使用 Jenkins。我将相应地更新链接。

[**Hudson**](https://wiki.jenkins-ci.org/display/JENKINS/Meet+Jenkins)是免费的，并且非常易于配置，并且可以轻松地在 VM 上运行。

部分来自我的旧帖子：

我们用它来

*   部署 Windows 服务
*   部署网络服务
*   运行 MSTests 并显示与任何 junit 测试一样多的信息
*   跟踪低、中、高任务
*   趋势图警告和错误

以下是 Hudson 支持的一些内置 .net 内容

*   [微软构建](https://wiki.jenkins-ci.org/display/JENKINS/MSBuild+Plugin)
*   [南安特](https://wiki.jenkins-ci.org/display/JENKINS/NAnt+Plugin)
*   [测试](https://stackoverflow.com/questions/352703/integrating-hudson-with-ms-test/512092#512092)
*   [单位](https://wiki.jenkins-ci.org/display/JENKINS/NUnit+Plugin)
*   [团队基础服务器](https://wiki.jenkins-ci.org/display/JENKINS/Team+Foundation+Server+Plugin)
*   [外汇警察](https://wiki.jenkins-ci.org/display/JENKINS/Violations)
*   [风格警察](https://wiki.jenkins-ci.org/display/JENKINS/Violations)
*   [编译器警告](https://wiki.jenkins-ci.org/display/JENKINS/Warnings+Plugin)
*   [代码任务](https://wiki.jenkins-ci.org/display/JENKINS/Task+Scanner+Plugin)

另外，上帝禁止你使用安全的视觉源，[它也支持](https://wiki.jenkins-ci.org/display/JENKINS/Visual+SourceSafe+Plugin)。我建议你看看[Redsolo 关于使用 Hudson 构建 .net 项目的文章](http://redsolo.blogspot.com/2008/04/guide-to-building-net-projects-using.html)

**你的问题**

*   **问**：我需要什么样的工具/许可证？现在，我们使用 Visual Studio 和 Smart Assembly 进行构建，使用 Perforce 进行源代码控制。我是否需要其他东西，或者是否有相当于运行自动化脚本的 cron 作业？

*   **答：**我刚刚在一个新的虚拟机副本上安装了 Visual Studio，该虚拟机运行一个全新的、修补过的、安装的 Windows 服务器操作系统。所以你需要许可证来处理它。Hudson 将自己安装为 Windows 服务并在端口 8080 上运行，您将配置您希望它扫描您的代码存储库以获取更新代码的频率，或者您可以告诉它在特定时间构建。所有这些都可以通过浏览器进行配置。

*   **问：**除了表明构建损坏之外，这究竟会给我带来什么？我是否应该在此解决方案（sln 文件）中设置将由这些脚本运行的测试项目，以便我可以测试特定的功能？目前，我们有两个这样的测试，因为我们没有时间（或者坦率地说，经验）来进行良好的单元测试。

    **答：**您将在第一次构建失败或变得不稳定时收到一封电子邮件。如果单元测试失败，或者可以通过您设置的任意数量的标准将其标记为不稳定，则构建是不稳定的。当单元测试或构建失败时，您将收到电子邮件，它会告诉您失败的位置、原因和方式。通过我的配置，我们得到：

    *   自上次工作构建以来的所有提交列表
    *   这些提交的提交注释
    *   提交中更改的文件列表
    *   构建本身的控制台输出，显示错误或测试失败
*   **问：**我需要什么样的硬件？

    **A：**一个虚拟机就足够了

*   **问：**一旦构建完成并经过测试，通常的做法是将构建放在 ftp 站点上还是通过其他方式进行内部访问？这个想法是这台机器进行构建，我们都去它，但如果我们必须进行调试构建。

    **答：** Hudson 可以用它做任何你想做的事情，包括通过 md5 哈希对其进行标识、上传、复制、归档等。它会自动执行此操作，并为您提供长期运行的构建工件历史。

*   **问：**我们应该多久进行一次这种构建？

    **答：**我们每小时轮询一次 SVN，寻找代码更改，然后运行构建。每晚都可以，但在 IMO 中有点毫无价值，因为您昨天所做的工作在您早上进来时不会在您的脑海中浮现。

*   **问：** 空间如何管理？如果我们在夜间进行构建，我们应该保留所有旧构建，还是在大约一周左右后开始放弃它们？

    **A：**这取决于你，经过这么长时间我将我们的构建工件移动到长期存储或删除它们，但所有存储在我保留的文本文件/xml文件中的数据，这让我可以存储更改日志、趋势图、等在服务器上消耗很少的空间。您还可以将 Hudson 设置为仅保留来自尾随 # 构建的工件

*   **问：**还有什么我在这里没有看到的吗？

    **A:**不，现在就去找哈德森，你不会失望的！

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-03-05T19:09:21.683

我们对以下组合非常幸运：

1.  Visual Studio（具体来说，使用 MSBuild.exe 命令行工具并将我们的解决方案文件传递给它。无需 msbuild 脚本）
2.  [NAnt](http://nant.sourceforge.net/)（比如比 MSBuild 更好的 XML 语法/任务库。还有 P4 src 控制操作的选项）
3.  [CruiseControl.net](http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET) - 用于监控/启动构建的内置 Web 仪表板。

CCNet 内置了在构建成功/失败时发送电子邮件的通知器

关于理由：这减轻了开发人员进行手动构建的负担，并在很大程度上消除了人为错误。很难量化这种影响，但一旦你做到了，你就永远不会回头。拥有一个可重复的过程来构建和发布软件是至关重要的。我敢肯定，您曾经去过他们手工构建软件的地方，并且它在野外传播，只是让您的构建人员说“糟糕，我一定忘记包含那个新的 DLL！”

在硬件上：尽可能强大。更多功率/内存 = 更快的构建时间。如果你能负担得起，你永远不会后悔得到一台一流的构建机器，无论团队有多小。

在空间上：有助于拥有足够的硬盘空间。您可以制作您的 NAnt 脚本以在每次构建开始时删除中间文件，因此真正的问题是保留日志历史记录和旧的应用程序安装程序。我们有监控磁盘空间和发送警报的软件。然后我们手动清理驱动器。通常需要每3-4个月进行一次。

关于构建通知：这是内置在 CCNet 中的，但如果您要添加自动化测试作为附加步骤，请从一开始就将其构建到项目中。一旦项目变大，就很难进行回拟合测试。那里有大量关于测试框架的信息（可能也有大量关于 SO 的信息），所以我将推迟命名任何特定工具。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-06T08:08:25.447

在我以前的工作场所，我们使用了[TeamCity](http://www.jetbrains.com/teamcity/)。它使用起来非常简单且功能强大。它可以免费使用，但有一些限制。还有一个关于[Dime Casts](http://dimecasts.net/Casts/ByTag/Team%20City)的教程。我们没有使用 CruiseControl.NET 的原因是我们有很多小项目，在 CC.NET 中设置每个项目非常痛苦。我强烈推荐 TeamCity。总结一下，如果你是开源的，那么 CC.NET 是学习曲线稍高的老爹。如果您的预算允许，您肯定会选择 TeamCity 或查看免费版本。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-03-05T19:34:45.930

如何？看看 Carel Lotz 的[博客](http://fromthedevtrenches.blogspot.co.uk/2009/11/continuous-integration-from-theory-to.html)。

为什么？我能想到的原因有几个：

*   正确实施的工作构建意味着您的所有开发人员*都可以*在构建绿色时在他们的机器上构建
*   正确实施的工作构建意味着您随时可以部署
*   正确实施的工作构建意味着您发布的任何内容都已访问您的源代码控制系统。
*   正确实施的工作构建意味着您可以尽早并经常集成，从而降低集成风险。

Martin Fowler 关于[持续集成](http://martinfowler.com/articles/continuousIntegration.html)的文章仍然是权威文本。看看它！

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-05T19:12:12.677

赞成的主要论点是，它将通过尽快提醒您构建损坏或测试失败来降低开发过程的成本。

集成多个开发人员的工作的问题是发展团队的主要危险。团队越大，就越难协调他们的工作并阻止他们互相干扰对方的更改。唯一好的解决方案是告诉他们“尽早并经常集成”，方法是在完成时检查小型工作单元（有时称为“故事”）。

您应该在一天中每次签入时都重建构建机器。使用 Cruise Control，您可以在任务栏上看到一个图标，该图标会在构建损坏时变为红色（甚至与您对话！）。

然后，您应该每晚进行一次完整的干净构建，其中标记了源版本（给定一个唯一的构建号），您可以选择将其发布给您的利益相关者（产品经理、QA 人员）。这样一来，当报告错误时，它会针对已知的内部版本号（这非常重要）。

理想情况下，您应该有一个可以下载构建的内部站点，并有一个可以单击以发布以前的夜间构建的按钮。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-05T19:23:32.243

只是想在 mjmarsh 所说的基础上有所建树，因为他奠定了良好的基础......

*   视觉工作室。MSBuild 工作正常。
*   [南安特](http://nant.sourceforge.net/)。
*   [南特贡献](http://nantcontrib.sourceforge.net/)。这将提供额外的任务，例如 Perforce 操作。
*   [CruiseControl.net](http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET)。这基本上又是您的“构建仪表板”。

以上所有内容（除了 VS）都是开源的，因此您无需考虑任何额外的许可。

正如 Earwicker 所说，尽早构建，经常构建。知道有什么东西坏了，你可以生产一个可交付的东西，这对于及早发现东西很有用。

NAnt 还包括**nunit** / **nunit2**的任务，因此您实际上可以自动化您的单元测试。然后，您可以将样式表应用于结果，并在 CruiseControl.net 提供的框架的帮助下，为每个构建提供可读、可打印的单元测试结果。

这同样适用于**ndoc**任务。为每个构建制作并提供您的文档。

您甚至可以使用**exec**任务来执行其他命令，例如，使用 InstallShield 生成 Windows Installer。

* * *

这个想法是尽可能地自动化构建，因为人类会犯错误。在前面花费的时间是在路上节省的时间。人们不必通过构建过程来照看构建。确定构建的所有步骤，为每个任务创建 NAnt 脚本，并一个一个地构建您的 NAnt 脚本，直到您完全自动化整个构建过程。然后它还将您的所有构建放在一个地方，这有利于比较。Build 426 中的某些问题在 Build 380 中运行良好？好吧，已经准备好测试的可交付成果——抓住它们并进行测试。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-05T19:28:40.810

*   无需许可证。CruiseControl.net 是免费提供的，只需要构建 .NET sdk。
*   构建服务器，即使没有自动化单元测试，仍然为构建版本提供受控环境。不再有“约翰通常在他的机器上构建，但他生病了。出于某种原因，我无法在我的机器上构建”
*   现在我在 Virtual PC 会话中设置了一个。
*   是的。构建需要转储到可访问的地方。开发版本应该打开调试。发布版本应该将其关闭。
*   多久取决于你。如果设置正确，您可以在每次签入后构建，开销将非常小。如果您有（或计划有）单元测试，这是一个好主意。
*   根据需要保留里程碑和发布。其他任何事情都取决于您构建的频率：持续？丢弃。日常？保持一周的价值。每周？留两个月的钱。

您的项目越大，您就越能看到自动构建机器的好处。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-05T19:15:09.890

这一切都与构建的健康有关。这让你得到的是，你可以设置任何你想在构建中发生的事情。其中，您可以运行测试、静态分析和分析器。当您最近处理应用程序的那部分时，问题的处理速度要快得多。如果您提交小的更改，那么它几乎会告诉您您在哪里破坏了它:)

这当然假设，您将其设置为在每次签入时构建（持续集成）。

它还可以帮助 QA 和 Dev 更紧密地联系起来。因为您可以设置功能测试来运行它，以及分析器和其他任何改进对开发团队的反馈的东西。这并不意味着每次签入都会运行功能测试（可能需要一段时间），而是您使用整个团队通用的工具设置构建/测试。我一直在自动化烟雾测试，所以就我而言，我们的合作更加密切。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-11-01T01:31:33.210

原因：10 年前，作为软件开发人员，我们习惯于对某事进行第 n 级分析，得到文件（用人类语言编写）“签字”，然后开始编写代码。我们会进行单元测试、字符串测试，然后进行系统测试：第一次将整个系统作为一个整体一起运行，有时是在我们签署文件后数周或数月。只有到那时，我们才会发现我们在分析一切时的所有假设和误解。

持续集成和想法使您能够构建一个完整的（尽管最初非常简单）端到端的系统。随着时间的推移，系统功能会正交构建。每次您进行完整的构建时，您都在尽早且经常地进行系统测试。这意味着您可以尽早发现并修复错误和假设，此时修复它们的成本最低。

如何：至于如何，我前一阵子写过这个：[[点击这里](http://jenkinsheaven.blogspot.com.au/2011/04/welcome.html?m=0)]

超过 8 篇文章逐步介绍了如何在 Windows 环境中为 .NET 解决方案设置 Jenkins 服务器。

# mysql - MySQL中的重复PK

> ID：616154
> 
> 赞同：2
> 
> 时间：2009-03-05T19:04:21.150
> 
> 标签：mysql, primary-key, many-to-many

不久前在这个网站上有人告诉我，使用多对多（在我的情况下是 facebook-ish“交友”系统）的唯一方法是执行以下操作：

```
uid(PK) friend_id
4       23
4       20
4       54
32      20
32      89 
```

这不会给我留下很多相同的主键（我相信这是不可能的吗？）如果我不能将 uid 设置为 PK，我怎样才能快速搜索表格？必须有一种方法可以通过 PK 来解决这个问题。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T19:07:39.083

使其成为复合键

PK = (uid,frield_id)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T19:07:15.153

如果您有一个多对多关系，您可以在其中创建一个带有 UID 和 Friend_ID 的双主键的表。这样，一对 UID/Friend_ID 应该只有一个实例。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T19:07:57.257

使用 uid 和friend_id 的组合作为主键。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T19:08:20.330

使它们都成为主键的一部分。

但是，您还需要在 uid（可能还有friend_id）上建立索引，这样搜索速度就不会受到影响。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T19:10:06.877

您可以只制作一个复合主键：

```
create table fbook (uid int, friend_id int, primary key(uid, friend_id)); 
```

# c++ - How to make a copyable boost::signal?

> ID：616161
> 
> 赞同：3
> 
> 时间：2009-03-05T19:06:12.033
> 
> 标签：c++, boost-signals, noncopyable

I get why `boost::signal` is noncopyable (it's because copying a signal doesn't have a clear meaning), but I need a version of it that does provide *some* sort of copy ctor (either a no-op or one that copies all connections).

The reason I need this is because in my project many objects become noncopyable *just by virtue of featuring signals*, and to treat them with comfortable value semantics (shared_ptrs are *not* as comfortable) I need to manually provide copy-ctors, violating DRY. Clearly a sort of quasi-copyable signal would be a good workaround for C++'s ugliness here.

First solution that comes to mind is inheriting `signal` and providing a copy ctor in the derived class, but that's a no-go because signal doesn't have a virtual dtor.

Thoughts?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T19:23:19.077

尝试在信号上保持指针（或 shared_ptr ）而不是信号。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T20:49:05.390

我会在 shared_ptr 内部保存信号。这样，您的对象将直接可复制，并且您可以使用值语义。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T19:27:51.187

不要衍生。这是个坏主意，而且对你没有任何好处——你的派生类也不能复制。无论您想要公开信号的任何部分，以及您想要实现的任何行为，都可以使用您自己的类来完成，并且只需在幕后使用 boost::signal。

```
namespace Iraimbilanja {

// the copy constructor doesn't copy the signal, so it doesn't copy the connections...
struct EmptyOnCopySignal
{
private:
    boost::shared_ptr<boost::signal> _signal;
};

// the copy constructor references the same signal, so it copies the connections...
struct CopyableSignal
{
private:
    boost::shared_ptr<boost::signal> _signal;
};

} // namespace Iraimbilanja 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T19:11:19.493

Can you not have a proxy object for your signals? The proxy will maintain both a signal and a reference count. Instead of creating copies of signals, talk to the proxy which will in turn increase/decrease the count. Does that work?

You may want to refer to the [Decorator](http://en.wikipedia.org/wiki/Decorator_pattern#C.2B.2B) pattern as well.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-03-21T18:52:35.137

在 shared_ptr 内部保存信号将（默认情况下）导致信号被所有复制的对象共享。在一个对象中触发信号将导致通知所有副本上连接到信号的每个插槽。这可能不是您想要的行为。

如果您不希望这种情况发生，您可以编写自己的复制构造函数和复制赋值运算符，然后您将能够指定复制对象时想要发生的情况。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-05T23:36:50.370

绝对可以使用[boost::ref](http://www.boost.org/doc/libs/1_38_0/doc/html/ref.html)。这是这个类的主要目的。当线程无法复制时，它也用于以前版本的 boost。唯一的缺点是信号可能在类之外进行管理，因此存储在所有复制的类上的引用始终有效。

# sql-server - 检查表上的约束

> ID：616163
> 
> 赞同：0
> 
> 时间：2009-03-05T19:06:37.447
> 
> 标签：sql-server

如果我按如下方式检查列的存在性，在添加它之前，我将如何对 UNIQUE 约束执行等效操作？

```
IF NOT EXISTS (SELECT * FROM sys.columns WHERE object_id=OBJECT_ID('[Table]') AND [Name]='Column')
    ALTER TABLE [Table] 
    ADD 
    [Column] varchar(500) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T19:14:17.943

对于约束 FK_myTable (SQL 2000) 是这样的：

```
if not exists ( select *
    from sysconstraints sc
    inner join sysobjects tbl on sc.id = tbl.id
    inner join sysobjects con on sc.constid = con.id
    where tbl.name = 'myTable' and con.name = 'FK_myTable' ) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T19:17:23.363

select * from sys.objects where type = 'uq' and parent_object_id = OBJECT_ID('[Table]')

# c# - 我在哪里可以提交 C# 语言的新功能请求？

> ID：616164
> 
> 赞同：25
> 
> 时间：2009-03-05T19:06:47.837
> 
> 标签：c#

我知道微软有一个类似于 uservoice.com 的论坛来提交功能和错误，但它让我忘记了，我的 google-fu 今天下午失败了。然后我想......嘿，对于 Stack Overflow 来说，这是一个多么好的问题！所以：

我在哪里可以提交有关 C# 语言新功能的官方请求？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2015-03-19T17:54:45.013

GitHub 问题：

*   [C#语言](https://github.com/dotnet/csharplang)
*   [VB语言](https://github.com/dotnet/vblang)
*   [C#横切VB](https://github.com/dotnet/csharplang)
*   [关于 Rosyln 编译器的Roslyn](https://github.com/dotnet/roslyn/issues)讨论（仅限）
*   [CoreFX](https://github.com/dotnet/runtime/issues/)这包括 System.Collections、System.IO for .NET Core (.NET Core 2.0)
*   [CoreCLR](https://github.com/dotnet/coreclr/issues)这包括 .NET Core (.NET Core 2.0) 的 RyuJIT、GC 和 mscorlib
*   [ASP.NET Core](https://github.com/aspnet/home/issues)这适用于 ASP.NET Core (.NET Core 2.0)
*   ASP.NET 4.7 - 未知

当前不讨论的历史地点：

*   ~~[Roslyn C# 语言设计论坛](https://roslyn.codeplex.com/discussions/topics/5998/c-language-design)~~
*   ~~[Roslyn](https://github.com/dotnet/roslyn/issues)关于 C# 6.0、C# 7.0 及更高版本的讨论~~

还有专门针对与 Visual Studio 相关的请求的[Visual Studio Uservoice](https://visualstudio.uservoice.com/forums/121579-visual-studio/category/30931-languages-c)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2017-05-04T10:11:45.003

GitHub 是提交这些请求的正确位置。将它们作为 GitHub 问题提出。

[https://github.com/dotnet/csharplang](https://github.com/dotnet/csharplang)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-05T19:08:23.933

~~[https://connect.microsoft.com/](https://connect.microsoft.com/)~~

更新：Connect 已停用。[这个 GitHub 存储库](https://github.com/dotnet/csharplang)现在是添加建议的地方。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-01-19T17:22:37.047

~~[这](http://visualstudio.uservoice.com/forums/121579-visual-studio/category/30931-languages-c)是有关 C# 语言的建议和想法的官方用户语音频道。~~

更新：UserVoice 频道已停用。[这个 GitHub 存储库](https://github.com/dotnet/csharplang)现在是添加建议的地方。

# sql - TSQL - 何时使用“非空”

> ID：616181
> 
> 赞同：5
> 
> 时间：2009-03-05T19:08:45.227
> 
> 标签：sql, sql-server

在考虑是否应该将字段标记为“非空”而不是仅声明除主键为空之外的所有内容时，我应该遵循哪些一般准则？

'not null' 字段是否应该具有 DEFAULT 值？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-05T19:12:07.170

取决于您希望应用程序的行为方式。

*   首先，永远不会有此值不包含有意义数据的行，然后使用 NOT NULL。也就是说，这个值总是有意义的并且代表着一些东西。
*   您是否希望用户或程序员始终以某种形式或方式填写该值？使用不带 DEFAULT 的 NOT NULL
*   您希望它对用户和程序员来说是可选的吗？将 NOT NULL 与 DEFAULT 一起使用

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T19:19:01.583

我想你有两个问题：

您应该将字段标记为不为空吗？

是的，假设您从不打算让*有效*行在该字段中具有空值。将“not null”视为您可以对字段施加的最简单的约束类型。数据库中的约束有助于确保数据通过满足预期保持一致。

空字段不应该有默认值吗？

仅当存在明显的默认值时。例如，发票表的已付款字段可能具有默认值 0 (false)。一般来说，它的工作方式相反——如果一个字段有一个默认值，那么它可能也不应该为空。

不要仅仅为了默认值而创建默认值——如果一个字段不应该为空，但没有通用默认值，那么就让它保持不变。这确保了任何 INSERT 语句都必须为该字段提供一个值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T19:10:46.190

很多人看不起所谓的“幻数”，并主张将该字段保留为空，而不是设置默认值。我唯一一次使用默认值是当我有一个位字段并且我只是希望它默认为 false 时。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T21:04:48.147

非空字段需要有默认值，如果它们是适当的，特别是如果您向表中添加新字段（或将字段从允许空值更改为不允许空值）并且您需要为所有现有记录赋予值。但是，默认值不适用于所有可能的字段或不可用。例如，我们有一个 person 表，lastname 不允许为空。但是，我们没有可以指定的默认姓氏，如果此人没有姓名，则不会创建记录。另一方面，您可能有一个 DateCreated 字段，其默认值是当前日期。这也是您希望不为空的字段，并且您希望确保输入当前日期，无论记录是从用户界面插入还是从导入或从查询窗口插入。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T19:18:42.597

做语义上正确的事情。

*   NULL - 并不总是存在
*   NOT NULL - 始终存在

尽量不要定义和保留人为的值，例如下拉字段的“未选择值”，或员工经理的“无经理”。

是否使用默认值取决于插入数据的方式。如果有一个带有验证的 UI，你不需要默认值，恕我直言。

# python - Django 标签和翻译 - 模型设计

> ID：616187
> 
> 赞同：2
> 
> 时间：2009-03-05T19:09:49.187
> 
> 标签：python, django, django-models, localization

假设我有以下 Django 模型：

```
class StandardLabel(models.Model):
    id = models.AutoField(primary_key=True)
    label = models.CharField(max_length=255)
    abbreviation = models.CharField(max_length=255) 
```

每个标签都有一个 ID 号、标签文本和缩写。现在，我想让这些标签可以翻译成其他语言。做这个的最好方式是什么？

在我看来，我有几个选择：

1：将翻译添加为模型上的字段：

```
class StandardLabel(models.Model):
    id = models.AutoField(primary_key=True)
    label_english = models.CharField(max_length=255)
    abbreviation_english = models.CharField(max_length=255)
    label_spanish = models.CharField(max_length=255)
    abbreviation_spanish = models.CharField(max_length=255) 
```

这显然不理想——添加语言需要编辑模型，正确的字段名称取决于语言。

2：添加语言作为外键：

```
class StandardLabel(models.Model):
    id = models.AutoField(primary_key=True)
    label = models.CharField(max_length=255)
    abbreviation = models.CharField(max_length=255)
    language = models.ForeignKey('languages.Language') 
```

这好多了，现在我可以要求使用某种语言的所有标签，并将它们放入字典中：

```
labels = StandardLabel.objects.filter(language=1)
labels = dict((x.pk, x) for x in labels) 
```

但这里的问题是标签 dict 是一个查找表，如下所示：

```
x = OtherObjectWithAReferenceToTheseLabels.object.get(pk=3)
thelabel = labels[x.labelIdNumber].label 
```

如果每个标签有一行，这不起作用，一个标签可能有多种语言。为了解决这个问题，我需要另一个字段：

```
class StandardLabel(models.Model):
    id = models.AutoField(primary_key=True)
    group_id = models.IntegerField(db_index=True)
    label = models.CharField(max_length=255)
    abbreviation = models.CharField(max_length=255)
    language = models.ForeignKey('languages.Language')
    class Meta:
        unique_together=(("group_id", "language"),)
#and I need to group them differently:
labels = StandardLabel.objects.filter(language=1)
labels = dict((x.group_id, x) for x in labels) 
```

3：将标签文本扔到新模型中：

```
class StandardLabel(models.Model):
    id = models.AutoField(primary_key=True)
    text = models.ManyToManyField('LabelText')

class LabelText(models.Model):
    id = models.AutoField(primary_key=True)
    label = models.CharField(max_length=255)
    abbreviation = models.CharField(max_length=255)
    language = models.ForeignKey('languages.Language')

labels = StandardLabel.objects.filter(text__language=1)
labels = dict((x.pk, x) for x in labels) 
```

但这不起作用，并且每次我引用标签的文本时都会导致数据库命中：

```
x = OtherObjectWithAReferenceToTheseLabels.object.get(pk=3)
thelabel = labels[x.labelIdNumber].text.get(language=1) 
```

我已经实现了选项 2，但我觉得它非常难看 - 我不喜欢 group_id 字段，我想不出更好的名字来命名它。此外，我使用的 StandardLabel 是一个抽象模型，我将其子类化以获得不同字段的不同标签集。

我想如果选项 3 /没有/命中数据库，这就是我会选择的。我相信真正的问题是过滤器`text__language=1`没有缓存`LabelText`实例，所以当我点击数据库时`text.get(language=1)`

您对此有何看法？谁能推荐一个更清洁的解决方案？

**编辑**：为了清楚起见，这些不是表单标签，所以 Django 国际化系统没有帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T19:51:20.523

当然，根据您的应用程序设计，您可能会考虑的另一个选择是利用 Django 的国际化功能。他们使用的方法与桌面软件中的方法很常见。

我看到该问题已被编辑以添加对 Django 国际化的引用，因此您确实知道，但 Django 中的 intl 功能不仅仅适用于表单；它涉及很多，只需要对您的应用程序设计进行一些调整。

他们的文档在这里：[http ://docs.djangoproject.com/en/dev/topics/i18n/#topics-i18n](http://docs.djangoproject.com/en/dev/topics/i18n/#topics-i18n)

这个想法是你定义你的模型，就好像只有一种语言一样。换句话说，根本不提及语言，并且只在模型中放置例如英语。

所以：

```
class StandardLabel(models.Model):
    abbreviation = models.CharField(max_length=255)
    label = models.CharField(max_length=255) 
```

我知道这看起来您已经完全排除了语言问题，但实际上您只是重新定位了它。您已经将语言推送到视图中，而不是数据模型中的语言。

django 国际化功能允许您生成文本翻译文件，并提供许多用于将文本从系统中提取到文件中的功能。这实际上非常有用，因为它允许您将纯文件发送给您的翻译，这使他们的工作更容易。添加新语言就像将文件翻译成新语言一样简单。

翻译文件定义数据库中的标签，以及该语言的翻译。有一些函数可以在运行时动态处理模型、管理视图、javascript 和模板的语言翻译。

例如，在模板中，您可能会执行以下操作：

```
<b>Hello {% trans "Here's the string in english" %}</b> 
```

或者在查看代码中，你可以这样做：

```
# See docs on setting language, or getting Django to auto-set language
s = StandardLabel.objects.get(id=1)
lang_specific_label = ugettext(s.label) 
```

当然，如果您的应用程序都是关于输入新语言`on the fly`的，那么这种方法可能不适合您。不过，请查看 Internationalization 项目，因为您可能可以“按原样”使用它，或者受到启发，找到适合您的域的 django 解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T19:38:25.873

我会让事情尽可能简单。查找会更快，代码更清晰，如下所示：

```
class StandardLabel(models.Model):
    abbreviation = models.CharField(max_length=255)
    label = models.CharField(max_length=255)
    language = models.CharField(max_length=2)
    # or, alternately, specify language as a foreign key:
    #language = models.ForeignKey(Language)

    class Meta:
        unique_together = ('language', 'abbreviation') 
```

然后根据缩写和语言查询：

```
l = StandardLabel.objects.get(language='en', abbreviation='suite') 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T19:26:19.903

我更喜欢为每种语言添加一个字段，而不是为每种语言添加一个新模型实例。添加新语言时确实需要更改架构，但这并不难，您希望多久添加一次语言？同时，它会为您提供更好的数据库性能（不添加连接或索引），并且您不必用翻译的东西弄乱您的查询逻辑；将其全部保存在它所属的模板中。

更好的是，使用像[django-transmeta](http://code.google.com/p/django-transmeta/)或[django-modeltranslation](http://code.google.com/p/django-modeltranslation/)这样的可重复使用的应用程序，这使得这个愚蠢的简单并且几乎完全透明。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T21:30:00.567

虽然我会选择[Daniel 的解决方案](https://stackoverflow.com/questions/616187/django-labels-and-translations-model-design/616317#616317)，但这是我从您的评论中了解到的另一种选择：

您可以使用[XMLField](http://docs.djangoproject.com/en/dev/ref/models/fields/#xmlfield)或 JSONField 来存储您的语言/翻译对。这将允许引用标签的对象对所有翻译使用单个`id`。然后你可以有一个自定义的管理器方法来调用一个特定的翻译：

```
Label.objects.get_by_language('ru', **kwargs) 
```

或者一个稍微干净和稍微复杂一点的解决方案可以很好地使用，`admin`将 XMLField 非规范化为另一个与模型具有多对一关系的`Label`模型。相同的 API，但它可以查询相关模型，而不是解析 XML。

对于这两个建议，标签的用户都会指向一个对象。

我不会过多地担心查询，Django 缓存查询，您的 DBMS 可能也有更好的缓存。

# visual-studio - VS tool to find candidates for expressions

> ID：616191
> 
> 赞同：0
> 
> 时间：2009-03-05T19:10:10.997
> 
> 标签：visual-studio, intellisense

Are there any tools that augment/replace intellisense with a search of for expressions that will result in a given type?

I'm thinking of the case where I need to get some particular object and I known the type and will recognize the name but don't know what sequence of objects to jump thought to get to it. Such a tool would do a breadth first search of all options and list anything that has the correct type.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-10-31T03:44:30.887

这是一个老问题，我知道，但如果你什么都没找到，我会试一试。Intellisense 具有 Resolve 选项（至少从 Visual Studio 2005 开始），您可以使用该选项直接键入特定对象，然后右键单击您可以选择 Resolve，这会将所需的库添加到类顶部的列表中。

同样，[ReSharper](http://www.jetbrains.com/resharper/)可能会为您提供一些更有趣的东西。

# html - 从 A4 中的 html 页面打印

> ID：616200
> 
> 赞同：3
> 
> 时间：2009-03-05T19:12:17.603
> 
> 标签：html, printing-web-page

我正在设计这个网站，供技术工程师打印，页面大小各不相同。打印页面时，表格会被切成两半，这使得它们难以阅读。是否有任何代码可以使打印件适合每页一张 A4 纸。

另一种解决方案是我制作 A4 大小的每一页的 PDF，并在每一页上放置一个“打印此页”按钮，但这似乎有点不专业，有什么想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T19:14:49.737

尝试使用 CSS 媒体属性来指定不同的 CSS 进行打印。

您还需要记住，每个浏览器都会以自己的方式实现打印（就像 CSS 渲染一样）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T19:28:31.823

使用打印 CSS。这完全取决于用户如何在对话框中设置打印设置，记住，web!=print。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T15:58:47.407

我发现最大化 A4 布局的最佳方法是让我的 CSS 打印使用 % 而不是像素，这将确保没有项目超出 A4 打印区域。

# .net - IConvertible 对比 隐式/显式运算符类型转换？

> ID：616205
> 
> 赞同：0
> 
> 时间：2009-03-05T19:13:41.970
> 
> 标签：.net

我创建了一个 Base36 类型的类，并且正在编写类型转换函数。实现 IConvertible 是否有好处，或者我应该使用静态隐式/显式运算符定义我的类型转换？

```
 public static implicit operator long(Base36 value) {
        return value.NumericValue;
    } 
```

编辑：我想我也在寻找每种方法提供给我的东西。有什么不同？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T19:16:29.107

正确的答案是，如果您认为值得付出努力和受益，您应该同时提供。

# wpf - 如何在 ContextMenu 中为 MenuItem 设置 CommandTarget？

> ID：616206
> 
> 赞同：11
> 
> 时间：2009-03-05T19:14:07.257
> 
> 标签：wpf, user-controls, contextmenu

（这个问题与[另一个](https://stackoverflow.com/questions/607370/wpf-how-do-i-set-the-owner-window-of-a-dialog-shown-by-a-usercontrol)问题有关，但差异很大，我认为它值得放在这里。）

这是一个（严重剪断）`Window`：

```
<Window x:Class="Gmd.TimeTracker2.TimeTrackerMainForm"
    xmlns:local="clr-namespace:Gmd.TimeTracker2"
    xmlns:localcommands="clr-namespace:Gmd.TimeTracker2.Commands"
    x:Name="This"
    DataContext="{Binding ElementName=This}">
    <Window.CommandBindings>
        <CommandBinding Command="localcommands:TaskCommands.ViewTaskProperties" 
                        Executed="HandleViewTaskProperties" 
                        CanExecute="CanViewTaskPropertiesExecute" />
    </Window.CommandBindings>
    <DockPanel>
<!-- snip stuff -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
<!-- snip more stuff -->
            <Button Content="_Create a new task" Grid.Row="1" x:Name="btnAddTask" Click="HandleNewTaskClick" />
        </Grid>
    </DockPanel>
</Window> 
```

这是一个（严重剪断）`UserControl`：

```
<UserControl x:Class="Gmd.TimeTracker2.TaskStopwatchControl"
             xmlns:local="clr-namespace:Gmd.TimeTracker2"
             xmlns:localcommands="clr-namespace:Gmd.TimeTracker2.Commands"
             x:Name="This"
             DataContext="{Binding ElementName=This}">
    <UserControl.ContextMenu>
        <ContextMenu>
            <MenuItem x:Name="mnuProperties" Header="_Properties" Command="{x:Static localcommands:TaskCommands.ViewTaskProperties}" 
                      CommandTarget="What goes here?" />
        </ContextMenu>
    </UserControl.ContextMenu>
    <StackPanel>
        <TextBlock MaxWidth="100" Text="{Binding Task.TaskName, Mode=TwoWay}" TextWrapping="WrapWithOverflow" TextAlignment="Center" />
        <TextBlock Text="{Binding Path=ElapsedTime}" TextAlignment="Center" />
        <Button Content="{Binding Path=IsRunning, Converter={StaticResource boolToString}, ConverterParameter='Stop Start'}" Click="HandleStartStopClicked" />
    </StackPanel>
</UserControl> 
```

通过各种技术，`UserControl`可以将 a 动态添加到`Window`. 也许通过窗口中的按钮。也许，更有问题的是，当应用程序启动时，来自持久性后备存储。

从 xaml 可以看出，我认为尝试使用命令来处理用户可以使用`Task`s 执行的各种操作对我来说是有意义的。我这样做的最终目标是将所有命令逻辑分解为更正式定义的控制器层，但我试图一次重构一个步骤。

我遇到的问题与`UserControl`'s中的命令和Window 中定义`ContextMenu`的 command's之间的交互有关。`CanExecute`当应用程序第一次启动并将保存的任务恢复到窗口上的 TaskStopwatches 时，没有选择实际的 UI 元素。如果我随后立即 r-单击 a`UserControl`以`Window`尝试执行`ViewTaskProperties`命令，则`CanExecute`处理程序永远不会运行并且菜单项保持禁用状态。如果我然后单击某个 UI 元素（例如，按钮）只是为了获得焦点，则`CanExecute`处理程序将在运行时将`CanExecuteRoutedEventArgs`的 Source 属性设置为具有焦点的 UI 元素。

在某些方面，这种行为似乎是已知的——我了解到菜单将通过最后一个具有焦点的元素路由事件，以避免总是从菜单项发送事件。不过，我想我想要的是事件的源是控件本身，或者是控件环绕的任务（但`Task`不是元素，所以我认为它不能是来源）。

我想也许我错过了 中的属性`CommandTarget`，我的第一个想法是我希望命令来自 UserControl，所以我自然首先尝试了：`MenuItem``UserControl`

```
<MenuItem x:Name="mnuProperties" 
          Header="_Properties" 
          Command="{x:Static localcommands:TaskCommands.ViewTaskProperties}" 
          CommandTarget="{Binding ElementName=This}" /> 
```

这作为无效绑定失败。我不确定为什么。然后我想，“嗯，我正在查找树，所以也许我需要的是一个 RelativeSource”，然后我尝试了这个：

```
<MenuItem x:Name="mnuProperties" 
          Header="_Properties" 
          Command="{x:Static localcommands:TaskCommands.ViewTaskProperties}" 
          CommandTarget="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type local:TaskStopwatchControl}}}" /> 
```

那也失败了，但是当我再次查看我的 xaml 时，我意识到它`ContextMenu`位于 UserControl 的属性中，它不是子元素。所以我猜到了（在这一点上这是一个猜测）：

```
<MenuItem x:Name="mnuProperties" 
          Header="_Properties" 
          Command="{x:Static localcommands:TaskCommands.ViewTaskProperties}" 
          CommandTarget="{Binding RelativeSource={x:Static RelativeSource.Self}}" /> 
```

这也失败了。

不过，像这样一次失败的猜测和检查就足以让我退缩并意识到我在这里遗漏了某种基本概念。那我该怎么办？

1.  我的理解是：`CommandTarget`正确的作用在于它提供了一种修改命令源的机制吗？
2.  如何从`MenuItem`in绑定`UserControl.ContextMenu`到 owning `UserControl`？还是我做错了什么仅仅是因为我觉得有必要？
3.  我希望通过单击以生成上下文菜单的元素设置命令的上下文，而不是在上下文菜单之前具有焦点的元素，这不正确吗？也许我需要编写自己的命令而不是使用`RoutedUICommand`：

    ```
    private static RoutedUICommand viewTaskPropertiesCommand = new RoutedUICommand("View a task's details.", "ViewTaskProperties", typeof(TaskCommands));
    public static RoutedUICommand ViewTaskProperties
    {
        get { return viewTaskPropertiesCommand; }
    } 
    ```

4.  我的设计中是否存在一些更深层次的基本缺陷？这是我的第一个重要的 WPF 项目，我在自己的时间做这件事作为学习经验，所以我绝对不反对学习卓越的解决方案架构。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T20:22:55.110

1：是的，[CommandTarget](http://msdn.microsoft.com/en-us/library/system.windows.input.icommandsource.commandtarget.aspx)控制 RoutedCommand 从何处开始路由。

2：[ContextMenu](http://msdn.microsoft.com/en-us/library/system.windows.controls.contextmenu(VS.85).aspx)有一个[PlacementTarget](http://msdn.microsoft.com/en-us/library/system.windows.controls.contextmenu.placementtarget(VS.85).aspx)属性，允许访问您的 UserControl：

```
<MenuItem x:Name="mnuProperties" Header="_Properties"
          Command="{x:Static localcommands:TaskCommands.ViewTaskProperties}"
          CommandTarget="{Binding PlacementTarget,
                                  RelativeSource={RelativeSource FindAncestor,
                                                                 AncestorType={x:Type ContextMenu}}}"/> 
```

为避免在每个 MenuItem 中重复此操作，您可以使用 Style。

3 & 4：我会说你的愿望是合理的。由于 Execute 处理程序位于 Window 上，所以现在无关紧要，但是如果您有应用程序的不同区域，每个区域都有自己的 Execute 处理程序用于相同的命令，那么焦点在哪里就很重要。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-12-22T13:57:39.223

我发现的类似解决方案是使用父级的 Tag 属性来获取数据上下文：

```
<Grid Tag="{Binding Path=DataContext, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}">
    <Grid.ContextMenu>
        <ContextMenu DataContext="{Binding Path=PlacementTarget.Tag, RelativeSource={RelativeSource Self}}">
            <MenuItem 
                Header="{Binding Path=ToolbarDelete, Mode=Default, Source={StaticResource Resx}}" 
                Command="{Binding RemoveCommand}" 
                CommandParameter="{Binding DataContext.Id, RelativeSource={RelativeSource TemplatedParent}}"/>
        </ContextMenu>
    </Grid.ContextMenu>

    <TextBlock Text="{Binding Name}" Padding="2" />

</Grid> 
```

# assembly - 使用 x86 CMPXCHG 比较和交换的 D 函数

> ID：616207
> 
> 赞同：3
> 
> 时间：2009-03-05T19:14:10.080
> 
> 标签：assembly, x86, d, cas

我正在寻找一个函数，它为Intel x86 上的[原子 CAS](http://en.wikipedia.org/wiki/Compare-and-swap)提供高级[D](http://www.digitalmars.com/d/1.0/)接口。

我知道我可以使用内联 ASM 来做到这一点（如果需要，我会这样做），但如果可以的话，我宁愿从其他人那里获取代码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T19:35:23.260

来自以下文档：[http ://www.digitalmars.com/d/2.0/overview.html](http://www.digitalmars.com/d/2.0/overview.html)

> **内联汇编器**
> 
> 设备驱动程序、高性能系统应用程序、嵌入式系统和专用代码有时需要使用汇编语言来完成工作。虽然 D 实现不需要实现内联汇编器，但它是定义的并且是语言的一部分。大多数汇编代码需求都可以用它来处理，无需单独的汇编程序或 DLL。
> 
> 许多 D 实现还将支持内部函数，类似于 C 对 I/O 端口操作、直接访问特殊浮点操作等的内部函数的支持。

所以理论上你可以直接使用 CMPXCHG。

* * *

**编辑**

你可能想看看：[http ://www.dsource.org/projects/tango/browser/trunk/tango/core/Atomic.d?rev=4277](http://www.dsource.org/projects/tango/browser/trunk/tango/core/Atomic.d?rev=4277)

由于某种原因，加载确实需要一段时间，但它在内部使用 CMPXCHG 指令，为您的目的重新调整它应该是微不足道的。

# c# - 异步回发后重置滚动位置 - ASP.NET

> ID：616210
> 
> 赞同：7
> 
> 时间：2009-03-05T19:14:19.970
> 
> 标签：c#, asp.net, gridview, asp.net-ajax, scroll-position

异步回发后将滚动位置重置到页面顶部的最佳方法是什么？

异步回发从 ASP.NET GridView CommandField 列启动，并在 GridView OnRowCommand 中调用 ASP.NET 更新面板 Update 方法。

我当前的应用程序是一个 ASP.NET 3.5 网站。

**编辑：**我收到了大家的优秀反馈，我结束了在脚本标签中使用 PageRequestManager 方法，但我的下一个问题是：

如何将其配置为仅在用户单击 GridView 控件中的 ASP.NET CommandField 时执行？我在页面上有其他按钮执行异步回发，我不想滚动到页面顶部。

**编辑 1：**我开发了一个不需要使用 PageRequestManager 的解决方案。请参阅我的后续答案以获取解决方案。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-05T20:04:56.620

当您使用 UpdatePanels 时，您需要连接到 ASP.NET AJAX [PageRequestManager](http://msdn.microsoft.com/en-us/library/bb311028.aspx)

您需要向[endRequest](http://msdn.microsoft.com/en-us/library/bb383810.aspx)事件挂钩添加一个方法，这些挂钩是：

> 在异步回发完成并将控制权返回给浏览器后引发。

所以你会有类似的东西：

```
<script type="text/javascript">
  Sys.WebForms.PageRequestManager.getInstance().add_endRequest(pageLoaded);

  function pageLoaded(sender, args) {
     window.scrollTo(0,0);
  }
</script> 
```

一旦更新请求完成，这将强制浏览器滚动回页面顶部。

当然，您还可以加入其他事件：

```
beginRequest // Raised before the request is sent
initializeRequest // Raised as the request is initialised (good for cancelling)
pageLoaded // Raised once the request has returned, and content is loaded
pageLoading // Raised once the request has returned, and before content is loaded 
```

异步回发的美妙之处在于页面将保持滚动高度，而无需您设置 MaintainScrollPosition，因为没有“整页重新加载”发生，在这种情况下，您实际上希望发生这种效果，所以您需要手动创建它。

***编辑以回应更新的问题***

好的，所以如果您只需要在某些按钮按下时重置位置，您需要执行以下操作：

首先连接到 BeginRequest 代替/以及：

```
Sys.WebForms.PageRequestManager.getInstance().add_beginRequest(BeginRequestHandler); 
```

这是因为在 args 参数中您可以访问：

```
args.get_postBackElement().id 
```

它将告诉您启动整个事件的按钮的 id - 然后您可以检查此处的值，移动页面，或将其存储在变量中，并在最终请求中查询它 - 了解竞争条件，等用户在原始更新完成之前单击另一个按钮。

这应该会让你走运 - 在[使用 PageRequestManager 事件上有很多例子](http://msdn.microsoft.com/en-us/library/bb398976.aspx)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-06-04T15:58:23.127

这是在 AJAX 中将滚动条位置重置为 TOP 的完美解决方案

客户端代码

```
function ResetScrollPosition()
{
    setTimeout("window.scrollTo(0,0)", 0);
} 
```

服务器端代码

```
ScriptManager.RegisterStartupScript(Page, this.GetType(), "ScrollPage", "ResetScrollPosition();", true); 
```

只有，window.scrollTo(0,0) 不起作用。在这种情况下，Ajax 将优先，因此您必须使用 setTimeout 函数。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-05T21:22:23.907

这是我基于此[源开发的以下解决方案](http://www.codeproject.com/KB/webforms/Gridview_Delete_confirmLS.aspx?display=Print)

ASP.NET 网络表单

```
<script language="javascript" type="text/javascript">
   function SetScrollEvent() {
      window.scrollTo(0,0);
   }
</script> 

<asp:GridView id="MyGridView" runat="server" OnRowDataBound="MyGridView_OnRowDataBound">
    <Columns>
        <asp:CommandField ButtonType="Link" ShowEditButton="true" />
    </Columns>
</asp:GridView> 
```

背后的 ASP.NET Webform 代码

```
protected void MyGridView_OnRowDataBound(object sender, GridViewRowEventArgs e)
{
    if(e.Row.RowType.Equals(DataControlRowType.DataRow))
    {
        foreach (DataControlFieldCell cell in e.Row.Cells)
        {
            foreach(Control control in cell.Controls)
            {
                LinkButton lb = control as LinkButton;

                if (lb != null && lb.CommandName == "Edit")
                    lb.Attributes.Add("onclick", "SetScrollEvent();");
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T20:06:35.650

你在使用 asp.net AJAX 吗？如果是这样，在客户端库 beginRequest 和 endRequest 中有两个非常有用的事件，部分/异步回发的问题之一是，一般页面不知道您在做什么。begin 和 endrequest 事件将允许您在客户端保持滚动位置，您可以在 js 中有一个 var 设置为 beginrequest 上的滚动位置，然后在结束请求时您可以重置您需要的任何元素的 scrollTop ..确实我以前看过这个，但找不到链接。如果我找到一个例子，我会发帖

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-07T01:25:11.180

取自本教程：

[http://aspnet.4guysfromrolla.com/articles/111407-1.aspx](http://aspnet.4guysfromrolla.com/articles/111407-1.aspx)

我们设置 MaintainScrollPositionOnPostback=true

然后如果我们需要重置滚动位置调用方法：

```
Private Sub ResetScrollPosition()
If Not ClientScript.IsClientScriptBlockRegistered(Me.GetType(), "CreateResetScrollPosition") Then
   'Create the ResetScrollPosition() function
   ClientScript.RegisterClientScriptBlock(Me.GetType(), "CreateResetScrollPosition", _
                    "function ResetScrollPosition() {" & vbCrLf & _
                    " var scrollX = document.getElementById('__SCROLLPOSITIONX');" & vbCrLf & _
                    " var scrollY = document.getElementById('__SCROLLPOSITIONY');" & vbCrLf & _
                    " if (scrollX && scrollY) {" & vbCrLf & _
                    "    scrollX.value = 0;" & vbCrLf & _
                    "    scrollY.value = 0;" & vbCrLf & _
                    " }" & vbCrLf & _
                    "}", True)

   'Add the call to the ResetScrollPosition() function
   ClientScript.RegisterStartupScript(Me.GetType(), "CallResetScrollPosition", "ResetScrollPosition();", True)
End If
End Sub 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T19:21:04.853

您是否设置了页面属性MaintainScrollPosition？不确定如果您执行异步回发是否会有任何不同。

编辑：您可以尝试的一件事是将焦点放在页面顶部附近的特定项目上，这可能会有所帮助并且是一项肮脏的工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T22:02:40.330

我使用了一个名为 hScrollTop 的隐藏输入，它是在 asp.net 表单回发之前设置的。然后，当页面加载时，它会根据隐藏输入的值设置 scrollTop。

在新页面上尝试此代码。

```
<div style="height:500px"></div>

<form id="Form1" runat=server onsubmit="javascript:saveScrollTop();">
    <input type=submit value="Submit" runat=server>
    <input type="hidden" id="hScrollTop" runat=server>
</form>

<div style="height:1000px"></div>

<script language="javascript">
    function saveScrollTop() {
        document.getElementById("<%= hScrollTop.ClientID %>").value = document.body.scrollTop;
        return true;
    }

    window.onload = function() {
        document.body.scrollTop = document.getElementById("<%= hScrollTop.ClientID %>").value;
    }

</script> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-03-26T16:34:21.207

```
Page.RegisterStartupScript("MyScript", "<script language=javascript>setTimeout('window.scrollTo(0,0)', 0);</script>"); 
```

将上面的内容放在您想要告诉页面顶部的功能中。就像页面无效时一样，拥有它，它会添加临时 javascript 将您带到页面顶部。

# onlinebanking - How would you go about making an application that automatically retrieves your bank account balance twice a day?

> ID：616212
> 
> 赞同：8
> 
> 时间：2009-03-05T19:14:45.010
> 
> 标签：onlinebanking

I'm building a utility that will hopefully keep my wife in tune with how much money we have available.

I need a simple secure way of logging into my bank account and retrieving the balance.

Something like [mechanize](http://wwwsearch.sourceforge.net/mechanize/) is the only method I can think of. I'm not even sure if that would work given the properly authenticated https that banks use.

Any ideas?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T19:18:50.913

Write a perl script using [LWP::UserAgent](http://search.cpan.org/dist/libwww-perl/). It supports HTTPS connections. The only issue might be if the site requires javascript.

[Web Client Programming with Perl](http://oreilly.com/openbook/webclient/ch06.html) has a few examples to get you started if you're not too familiar with perl.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T20:25:15.603

如果你真的想去那里，请为 Firefox 获取这些扩展：[Live HTTP Headers](https://addons.mozilla.org/en-US/firefox/addon/3829)、[Firebug](https://addons.mozilla.org/en-US/firefox/addon/1843)、[FireCookie](https://addons.mozilla.org/en-US/firefox/addon/6683)和[HttpFox](https://addons.mozilla.org/en-US/firefox/addon/6647)。还下载[cURL](http://curl.haxx.se/)和可以运行 cURL 命令行任务的脚本语言（或可以直接访问 cURL 库的脚本语言，如 PHP 或 Perl）。

我已经开始在这条路上进行一些幂等的 GET 任务，例如从我的在线经纪公司获取标准普尔报告（我跟踪的股票）的 PDF 文件，以及为我的银行账户下载支票图像。这两项任务都是重复且缓慢的将数据下载到我的计算机的方法，而金融机构没有提供任何使其更容易的方法。

这就是你不应该这样做的原因：（作为捷径，我将把典型的大型银行、经纪公司或其他金融机构称为“BloatBank”）

1.  BloatBank 不太可能公开其用于访问此类信息的 API。所以它可以随时改变，你所有的努力都将付诸东流。每当他们改变他们的机制时，你就必须适应。
2.  如果 BloatBank 发现您一直在使用自动脚本来尝试访问您的帐户信息，他们可能会因为您违反了他们的服务条款而禁止您。
3.  您可能会搞砸，并且 BloatBank 服务器上的大杂烩脚本与访问您帐户的脚本之间的交互可能会导致像关闭您的帐户这样的坏事。测试这种脚本非常困难，因为您没有任何关于他们的在线服务如何工作的文档，而且您没有可以弄乱的测试帐户。
4.  （上面的一个变体）你认为你是安全的，因为你正在发出 GET 请求。但是 BloatBank 只是一个对 REST 一无所知的疯狂银行，所以有一些 GET 请求可能会弄乱你的帐户。
5.  如果其他人确实使用您的脚本恶意嗅探您的在线密码或弄乱您的帐户，则 BloatBank 的任何责任保险都可能会消失，因为您打开了一个安全漏洞。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T19:37:56.403

你为什么不教你的妻子如何自己登录银行呢？或者使用 Quicken（或 Mint 等）并教她如何使用自动下载功能？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T20:31:17.617

你检查过[Watir](http://wtr.rubyforge.org/)吗？它非常适合自动化 Web 浏览器操作。由于它是用 Ruby 编写的，如果需要，您可以获取结果并将它们存储在数据库中（或通过电子邮件将它们发送给您自己）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T19:22:12.043

如果您对 AIR 持开放态度，我会说构建一个 AIR 应用程序。我曾与 mechanize 合作过，我认为这很酷。AIR 通过更丰富的 GUI 为您提供了类似的功能（请参阅 HTMLLoader 和网页的 DOM 操作）。

如果我是你，我会简单地拉动页面并操作 DOM 以满足我的视觉需求。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T19:42:46.143

请，如果您发现这对您的银行来说很容易，请发布您的银行名称。如果我有相同的，我将关闭我的帐户。

更多关于你的问题。在代码中而不是在浏览器中加载网页的过程可能是一种黑色艺术，特别是如果它们涉及任何 javascript。您最好的选择可能是在您的应用程序中嵌入 IE Web 浏览器控件，然后模拟击键和鼠标点击以到达您的余额页面。然后为余额抓取 HTML。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T20:31:16.057

我可以尝试为 Quicken 付费并让它完成余额下载。然后我只需要找到一种方法来自动从软件中取出号码。

这样我就不会违反任何服务条款，而且我还降低了安全风险，因为所有“黑客攻击”都在本地进行。

# asp.net - 获取现有设计模板并将其放入母版页的资源？

> ID：616219
> 
> 赞同：0
> 
> 时间：2009-03-05T19:15:31.200
> 
> 标签：asp.net, master-pages

我不是设计师，所以我从[http://www.opendesigns.org/ 获取](http://www.opendesigns.org/)了一个设计模板，并成功地在一个页面中实现了该设计，但是当我尝试将其放入母版页时，它看起来很有趣，所以我很好奇是否有任何关于获取设计模板并将它们放入母版页的资源/教程。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T19:17:44.470

母版页只是带有内容占位符的 HTML/ASP。

只要一切格式正确，它就应该正常显示。

在构建母版页时，我会构建我的设计，然后复制并粘贴到母版页中，并将占位符插入到我需要的位置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T19:36:24.177

您说的有些内容很混乱，我认为您需要更清楚一些。母版页是您的站点或子站点上的布局模板，您永远不会将母版页用作内容，您将始终使用母版页作为内容页的基础，母版页允许您定义一组占位符原则上，您的页面框架的全局定义，用于将使用母版页的区域。通常将站点范围（或子站点范围 - 取决于您在做什么）内容放置到母版页本身，例如菜单，横幅等。然后让使用母版页的页面定义内容占位符中包含的内容这将特定于页面实例。

当您说您将设计放入页面时，它是纯 html 吗？还是它是一个 aspx ？你不清楚你是怎么来的

1）设计模板到“页面”（请解释html或aspx）

2）您如何获取页面并将其“放入”您的母版页（我认为如果您解释一下，可能会更容易提供帮助）

# php - 为 PHP 导入包或自动加载？

> ID：616231
> 
> 赞同：4
> 
> 时间：2009-03-05T19:18:37.433
> 
> 标签：php, autoload, package-managers

对于在 PHP 项目中包含文件，您会推荐什么解决方案？

1.  不需要手动调用 require/include 函数 - 一切都通过自动加载函数加载
2.  需要时导入包。

这是包导入API：

```
import('util.html.HTMLParser');
import('template.arras.*'); 
```

在此函数声明中，您可以用点（包层次结构分隔符）分解字符串，循环遍历特定包（文件夹）中的文件以仅包含其中一个或全部，如果在字符串末尾找到星号符号，例如('template.arras.*')。

我在包导入方法中看到的好处之一是它可以迫使您使用更好的对象分解和类分组。

我在自动加载方法中看到的缺点之一是自动加载功能可能变得非常大并且不是很明显/可读。

你怎么看待这件事？

*   您可以在每种方法中说出哪些优点/缺点？
*   我怎样才能找到项目的最佳解决方案？
*   如果使用包管理，我如何知道是否会有任何性能问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T20:17:04.593

我广泛使用 __autoload()。我们在应用程序中使用的 autload 函数对旧类的向后兼容性进行了一些调整，但我们通常在创建允许 autoload() 工作的新类时遵循一个约定：

*   **一致的类命名**：每个类在其自己的文件中，每个类以驼峰命名，并用下划线分隔。这映射到类路径。例如，Some_CoolClass 映射到我们的类目录，然后是“Some/CoolClass.class.php”。我认为一些框架使用这种约定。
*   **显式需要外部类**：由于我们无法控制我们使用的任何外部库的命名，我们使用 PHP 的 require_once() 函数加载它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T19:41:16.473

导入方法是一种改进，但仍会加载超出需要的内容。
通过使用星号或在脚本开头加载它们（因为在每个“新类名”之前导入会变得很麻烦）

我是`__autoload()`甚至更好的粉丝， 因为它将仅包括您正在使用的课程以及不关心课程所在位置的额外好处。如果您的大学将文件移动到另一个目录，您不会受到影响。[`spl_autoload_register()`](http://php.net/manual/en/function.spl-autoload-register.php)

缺点是它需要额外的逻辑才能使其与目录一起正常工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T19:53:34.930

我使用 require_once("../path-to-auto-load-script.php.inc") 自动加载

我对所有类和 inc 文件都有一个标准命名约定，这使得以编程方式确定当前请求的类名变得更加容易。

例如，所有类都有一个特定的扩展名，比如 inc.php
（所以我知道它们将在 /cls 目录中）
并且
所有 inc 文件都以 .ht 开头（所以它们将在 /inc 目录中）

auto load 接受一个参数：className，然后我用它来确定文件的实际位置。一旦我知道我的目标目录是什么就循环，每次添加“../”来说明子子页面，（这对我来说似乎破坏了自动加载），最后一旦找到实际的代码文件就需要一次。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T19:38:59.990

我强烈建议您改为执行以下操作：

将所有类放入一个静态数组中，className => filepath/classFile。自动加载功能可以使用它来加载类。

这可确保您始终加载最少数量的文件。这也意味着您避免完全愚蠢的类名，以及对所述名称的解析。

如果它很慢，您可以使用一些加速器，这将为您带来更多收益，如果它仍然很慢，您可以通过“编译”过程运行，经常使用的文件只是转储到公共文件中，并且可以更新自动加载引用以指向正确的位置。

如果您开始遇到自动加载太慢的问题，我很难相信，您可以根据包将其拆分，并具有多个自动加载功能，这样只需要数组的子集，如果您的软件包是围绕您的软件模块定义的（登录、管理、电子邮件...）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T19:50:53.363

我不是`__autoload()`. 在很多库（例如一些 PEAR 库）中，开发人员`class_exists()`在使用时没有传入相对较新的第二个参数。您拥有的任何遗留代码也可能存在此问题。如果您已`__autoload()`定义，这可能会导致警告和错误。

如果您的库很清晰，并且您没有要处理的遗留代码，那么它是一个很棒的工具。有时我希望 PHP 在他们如何管理行为方面更聪明一点`class_exists()`，因为我认为问题在于该功能而不是`__autoload()`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T22:30:08.003

滚动你自己的包装系统可能是个坏主意。我建议您使用明确的手动包含或自动加载（或就此而言的组合）。

# ms-office - VS 2005 against Office XP PIA on system with Office 2003/2007?

> ID：616243
> 
> 赞同：4
> 
> 时间：2009-03-05T19:21:14.823
> 
> 标签：ms-office, office-interop, office-pia

On my development system, I am running Office 2007, and previously had Office 2003 installed, and thus have the Microsoft Office 11.0 and 12.0 Object Models available. Our production environment is in the process of being upgraded to Office 2007, but it hasn't happened yet - still running Office XP in production, and I need to be able to debug an (inherited) VB.Net (VS 2005) app that uses Office Interop against Office XP (10.0) (Excel).

**Can I simply download, install, and reference the Office XP PIA's** ([http://www.microsoft.com/downloads/details.aspx?familyid=C41BD61E-3060-4F71-A6B4-01FEBA508E52](http://www.microsoft.com/downloads/details.aspx?familyid=C41BD61E-3060-4F71-A6B4-01FEBA508E52)) **in order to compile an run the app?** A previous build has been tested against Office 2007 and it seemed to work with the "old" interop/PIAs.

I have the "old" Interop.Excel, etc., the only reference that is giving me a problem is the Microsoft Office 10.0 Object Model (which says Microsoft Office 12.0 Object Model but has an Exclamation mark in my IDE).

I also found [http://www.codeproject.com/KB/office/Compile2003VstoVista2007.aspx](http://www.codeproject.com/KB/office/Compile2003VstoVista2007.aspx) (for Office 2003 on a system with 2007) which suggests installing the older version of Office and then massaging the project files in a text editor. While I don't mind using a text editor on the project files, I'd prefer not to install Office XP unless I have to (I have access to it if I do). And I'd prefer to be able to load the project as is (with the "old" reference).

# wii - Wii Fit 数据格式？

> ID：616249
> 
> 赞同：11
> 
> 时间：2009-03-05T19:23:14.333
> 
> 标签：wii

所以老板只是来买告诉我他正在为办公室买一台 Wii + Wii Fit。起初我觉得这太棒了，我们得到了一个 Wii。但是，我们是一个非常健康的群体，为什么我们也需要 Wii Fit？当然，当我本应该沉浸在这一刻的荣耀中时，我张开愚蠢的嘴问这个问题。叹息……工作永无止境……

显然，Wii Fit 将某种数据保存到 SD 卡中，他想知道我们是否可以访问这些数据。快速搜索几乎一无所获，只是注意到数据存储为文本文件，但使用日语。老板还在外面买东西，所以我还不能亲眼看到。

有没有人试图获取 Wii Fit 数据？运气好的话？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T11:06:02.507

可以解码 WiiFit 保存数据。

一旦 WiiFit 保存数据存储到 SD 卡，它将被命名为 private\wii\title\RFNP\data.bin（用于 pal）或 private\wii\title\RFNN\data.bin（用于 NTSC）

这是所有游戏都使用的标准化 Wii 格式，在[http://wiibrew.org/wiki/Savegame_Files中有描述](http://wiibrew.org/wiki/Savegame_Files)

[使用http://hackmii.com/2008/04/keys-keys-keys/](http://hackmii.com/2008/04/keys-keys-keys/)中的密钥解密标题和数据区域后，您会发现 data.bin 包含以下文件：

```
RPFitCap.dat
RPHealth.dat
RPWiiFit.dat

```

这些文件是未加密的，但我没有分析它们的内容，只是为了能够为我自己的 Mii 提取体重和 bmi 数据。

我有一个非常脏的 vb6 类，它生成一个带有日期和重量的 CSV 文件，但它远离任何类型的发布。

这是我提取的一些数据：

```
15.11.2008 13:18:00;92
16.11.2008 15:30:00;91,1
17.11.2008 19:02:00;91,3
18.11.2008 08:23:00;90,8
19.11.2008 07:20:00;90,5
20.11.2008 09:34:00;90,5
21.11.2008 09:32:00;91,1
22.11.2008 09:11:00;91,3
23.11.2008 10:25:00;91,6
24.11.2008 10:36:00;91,2
25.11.2008 10:37:00;91,4
26.11.2008 13:40:00;90,8
27.11.2008 10:45:00;91,2
28.11.2008 11:32:00;91,4
29.11.2008 13:09:00;91
30.11.2008 13:18:00;90
01.12.2008 12:38:00;90,1
02.12.2008 13:16:00;91,2
03.12.2008 10:34:00;91,2
04.12.2008 12:06:00;91
05.12.2008 13:05:00;91,2
06.12.2008 16:28:00;90,3
07.12.2008 14:03:00;90,9
08.12.2008 12:38:00;91,3
09.12.2008 14:18:00;90,4
10.12.2008 13:43:00;90,5
11.12.2008 13:36:00;90,5
12.12.2008 14:15:00;90,3
13.12.2008 14:17:00;89,9
14.12.2008 10:42:00;90

```

./铝

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-27T05:58:21.790

我能够使用此信息来创建数据在 Wii Fit 游戏存档文件中存储位置的表格。

以下博客文章中有更多详细信息：http: [//jansenprice.com/blog ?id=9-Extracting-Data-from-Wii-Fit-Plus-Savegame-Files](http://jansenprice.com/blog?id=9-Extracting-Data-from-Wii-Fit-Plus-Savegame-Files)

```
File FitPlus0.dat
-----------------
Byte Offset | Length | Description
-----------------------------------
0x0         | 8      | RPHE0000 (header)
0x8         | 22     | Name of Mii
0x1E        | 1      | Unknown
0x1F        | 1      | Height (in cm)
0x20        | 4      | Date of birth (stored in BCD: e.g. 1980 0228)
0x24        |        | Unknown
0x95        |        | Dates with data (rowlen=10)
0x35CF      |        | Start of some other section (unknown)
0x38A1      |        | Body Test measurement data section (rowlen=21)
  +0        | 4      | Date (in bitfield format)
  +4        | 2      | Weight (in kg * 10)
  +6        | 2      | BMI (* 100)
  +8        | 2      | Balance percent (* 10)
  +10       | 2      | simple value 4 ??
  +12       | 1      | extended 1 ??
  +13       | 1      | extended 2 ??
  +14       | 1      | extended 3 ??
  +15       | 1      | extended 4 ??
  +16       | 2      | extended 5 ??
  +18       | 1      | extended 6 ??
  +19       | 1      | extended 7 ??
0x9288      | 1      | Last byte of profile 
```

# svn - 将 SVN 设置为 Best Suit Dev -> QA -> Prod

> ID：616254
> 
> 赞同：6
> 
> 时间：2009-03-05T19:24:36.967
> 
> 标签：svn

很抱歉，如果已经有人问过这个问题，但我无法找到针对这种情况的答案：

对于我们的 Web 应用程序，我们有 3 个系统：开发、QA 和生产。目前，第三方正在维护代码，但很快它就会掌握在我们手中。我们将为每个阶段提供单独的构建环境。此外，我们使用 RAD 进行代码开发，因此实际上会有一个主要步骤，即测试/沙箱。

理想情况下，我们希望以某种方式隔离每个阶段的存储库，以便我们从 DEV 签出，进行一些更改，在本地测试它们，然后将它们签回 DEV。如果 Dev 上一切正常，我们将检查 QA，等等。

我们是否应该为每个单独的存储库，或者这是否属于“分支”，我们将为 dev、QA 和 prod 设置一个单独的分支。您能否提供实现理想路线的最佳方法？

如果还有其他问题，请告诉我。

谢谢克里斯

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T19:35:04.290

使用分支和合并

我们执行以下操作：

当我们发布时，我们创建一个当前发布分支。我们在版本之间进行错误修复，然后将它们合并回我们的主干。

我们在主干上开发，当我们准备好发布时，我们会创建一个 QA 分支。我们对其进行测试和修复，然后将其推出，它成为我们当前的发布分支。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T19:35:01.480

您应该有一个可以在部署过程中检出或导出的存储库。

我们也有类似的设置。开发人员检查本地工作副本并在他们的开发环境中进行开发。当我们准备好部署到阶段或您所说的 QA 时，我们会将 svn 导出到该环境（通常是 head，但我们始终跟踪特定的修订）。

在 QA 过程中，我们继续在 dev 中开发并部署到 QA。

最后，当我们准备好生产时，我们将正确的修订版从存储库导出到生产环境中。

效果很好！

[编辑：就“这是分支”而言-您所描述的可能更像是跟踪修订。然而，分支是管理不同开发线的一项非常重要的技术。这不应该与每个阶段（开发、阶段、现场）都有不同的分支相混淆，必须]

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T19:49:33.897

如果您正在使用易于确认的任务进行单一开发流，则此方法可以正常工作。但是，随着多个开发流程以及任务被取消或延迟的可能性，它将被证明更具挑战性。然后，您的应用程序中需要某种时间依赖性。您还可以使用功能分支之类的东西，一旦构建了功能，它们就会合并回主干。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T09:08:33.100

我们有类似的架构。在 SVN 中，我们有 3 个分支`trunk`，`PREPROD`和`PROD`。每当准备好尝试新功能时，它就会被合并到`PREPROD`分支中（仅使用特定的修订号并且仅用于特定文件），如果它通过了 QA，它就会被提交并合并到`PROD`分支中。当更改在`PROD`分支中提交时，它们会自动部署在所有生产服务器中。测试新功能时除外，`PREPROD`并且`PROD`是平等的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-06T16:00:52.300

我们为每个错误修复、功能或任务都有一个开发分支，并且涉及的项目往往有多个子分支。

最初为一行代码修复创建一个新分支有点奇怪，但它允许将主干合并到分支中，然后进行回归测试，最后合并回主干。

理想情况下，这意味着合并到主干中的任何内容都不会破​​坏构建，这意味着您不必害怕提交代码来构建脆弱的构建。

我经常为一个问题使用多个分支，测试不同的解决方案，同时仍然获得 SCM 的好处。

我们还标记特定版本或发布，允许基于已知的良好代码进行快速部署。

我们很多基于 Web 的系统使用 svn:externals 来指向特定版本的依赖项，例如库和供应商代码。部署是从外部获取的，而不是直接签出或导出。

# reporting-services - 双轴图 - Reporting Services 2005

> ID：616259
> 
> 赞同：4
> 
> 时间：2009-03-05T19:25:51.223
> 
> 标签：reporting-services, charts, reportingservices-2005

我需要在 Reporting Services 2005 中输出带有 2 个 Y 轴的图表。看来这在 RS2005 中是不可能的，我不知道我可以使用哪些选项。听起来 RS2008 可以解决这个问题，但我不相信这对我来说是可行的。我还有什么其他选择？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T19:28:21.140

我们在 SSRS 2005 中使用了 Dundas 报告。它确实成本高，但带来了很多价值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-02T12:59:28.843

不可能 - 所以说 MSFT

[http://social.technet.microsoft.com/Forums/en-US/sqlreportingservices/thread/b6389cb5-7a54-44bc-aa0b-f88c03a9704e/](http://social.technet.microsoft.com/Forums/en-US/sqlreportingservices/thread/b6389cb5-7a54-44bc-aa0b-f88c03a9704e/)

# c - C 数学计算未按预期工作

> ID：616263
> 
> 赞同：4
> 
> 时间：2009-03-05T19:26:44.137
> 
> 标签：c, math

我在程序中有以下内容（更大功能的一部分，但这是相关的测试位）：

```
int test = 100 + (100 * (9 / 100));
sprintf (buf, "Test: %d\n\r", test);
display_to_pc (buf, player); 
```

基本上它相当于：

```
x = a + (a * (b / 100)) 
```

其中a是给定的数字，b是百分比修饰符，x是结果（原始加上原始的百分比）......我希望这是有道理的。

它给了我：

```
Test: 100 
```

我认为我脑海中的数学可能是错误的，但我已经检查了几个计算器，甚至是我 IDE 中的表达式评估器，它们都给了我第一个表达式的预期结果 109。

谁能告诉我我在这里缺少什么？

非常感谢。:)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-05T19:31:29.290

代替

```
int test = 100 + (100 * (9 / 100)); 
```

和

```
int test = 100 + (100 * 9 / 100);
// x = a + (a * b / 100) 
```

它会按预期工作。 `9 / 100`使用整数除法执行；最接近的整数`.09`是`0`（并且`0 * 100`仍然是`0`）。

首先进行乘法运算会得到`900 / 100`，这会得到您`9`所期望的结果。

如果您需要超过整数精度，则可能需要走浮点路线。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-05T19:30:18.967

您正在使用整数数学。

9/100 = 0。

100 + (100 * (0) = 100。

您的计算器使用浮点数学，并且可以适当地处理小数。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-05T19:32:30.193

正如其他人指出的那样，问题在于您正在做整数运算。您需要通过将变量转换为 double 或使用 double 常量来将计算作为浮点数进行，然后允许截断只为您提供整数部分。

```
x = a + (a * (b / 100.0)); 
```

或者

```
x = a + (a * ((double)b / 100))); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-05T19:29:35.380

整数测试 = 100 + (100 * (9 / 100));

9/100 = 0

0 * 100 = 0

100 + 0 = 100

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-05T19:32:06.607

您的错误是 9 / 100 被解释为整数除法，计算结果为 0 而不是 0.09。

您可以改写 9 / 100.0，或重新排列表达式。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-05T19:30:22.553

你正在使用整数除法所以 9 / 100 是零所以`test = 100 + 0 = 100`

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-05T19:33:41.157

如果您只使用将导致整个整数值的表达式，请使用 Daniel L 的答案。如果您将使用的值不太干净，请使用双字面量而不是整数字面量：

```
int test = 100.0 + (100.0 * (9.0 / 100.0)); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-05T19:29:40.310

9/10 的答案被截断为 0，然后将其乘以 100，然后再加上 100。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-05T19:32:31.237

改变：

```
int test = 100 + (100 * (9 / 100)); 
```

到

```
int test = (int)(100 + (100 * (9 / 100.0))); 
```

看看它是否按预期工作。

编辑：哇。在我打字的时候有很多答案。他们中的大多数也将工作。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-05T19:32:39.037

您应该使用浮点运算，因此 9/100 变为 0.09。

整数测试 = 100.0 + (100.0 * 9.0 / 100.0);

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-05T19:35:07.440

您正在为变量类型使用整数，因此最里面的表达式 (9 / 100) 将导致 0。然后下一个表达式将是 100 * 0，即 0，最后是 100 + 0...

要获得您想要的结果，请尝试使用 float 代替：

浮动测试 = 100.0 + (100.0 * (9.0 / 100.0));

printf("结果：%0.2f\n", test);

# c++ - 堆栈展开失败的原因

> ID：616270
> 
> 赞同：0
> 
> 时间：2009-03-05T19:28:29.110
> 
> 标签：c++, winapi, mfc

我正在调试一个应用程序并遇到以下代码：

```
int Func()
{

 try 
 {

   CSingleLock aLock(&m_CriticalSection, TRUE);
   {
     //user code
   }
 }
 catch(...)
 {
     //exception handling
 }
 return -1;

} 
```

m_CriticalSection 是 CCrialSection。

我发现用户代码抛出了一个异常，以至于 m_CriticalSection 根本没有被释放。这意味着由于某些原因堆栈已损坏，因此展开失败。

我的问题是：1）在哪些不同的情况下，堆栈展开可能会失败？

2) 可以抛出哪些不同的异常可能性导致堆栈展开失败。

3）我可以通过将 CSingleLock 放在 try 块之外来解决这个问题吗？

谢谢，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T19:48:07.987

您是否遇到程序异常终止？

我相信你的`CCriticalSection`对象会被释放`CSingleLock`的析构函数。析构函数总是会被调用，因为这是堆栈上的一个对象。当用户代码抛出时，`throw`函数中的和 catch 之间的所有堆栈都将被解除。

但是，您的用户代码中的某些其他对象甚至`CSingleLock`析构函数中的某些其他对象可能同时引发了另一个异常。在这种情况下，该`m_CriticalSection`对象将无法正确释放并被`std::terminate`调用并且您的程序会死掉。

这是一些示例来演示。注意：我正在使用`std::terminate`处理函数来通知我状态。您还可以使用`std::uncaught_exception`来查看是否有任何未捕获的异常。这里有一个很好的讨论和示例[代码](http://msdn.microsoft.com/en-us/library/k1atwat8(VS.80).aspx)。

```
struct S {
    S() { std::cout << __FUNCTION__ << std::endl; }
    ~S() { throw __FUNCTION__; std::cout << __FUNCTION__ << std::endl;  }
};

void func() {
    try {
        S s;
        {
            throw 42;
        }
    } catch(int e) {            
         std::cout << "Exception: " << e << std::endl; 
    }
}

void rip() {
    std::cout << " help me, O mighty Lord!\n"; // pray
}

int main() {
    std::set_terminate(rip);
    try {
        func();
    }
    catch(char *se) {
        std::cout << "Exception: " << se << std::endl;
    }
} 
```

为了清楚起见，请阅读[此](http://www.parashift.com/c++-faq-lite/exceptions.html#faq-17.3)常见问题解答。

> 我可以通过将 CSingleLock 放在 try 块之外来解决这个问题吗？

如果不查看堆栈和错误/崩溃，很难说。你为什么不试一试。它还可能通过隐藏真正的问题来引入一个微妙的错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-06T01:30:46.713

我的问题是：
1）在哪些不同的情况下，堆栈展开可能会失败？

*   如果 exit() terminate() abort() 或 unexpected() 被调用。

    *   除了直接调用之外，可能会发生哪些情况：
    *   抛出未处理的异常。（此处不适用）
    *   [在另一个异常弹出时从析构函数抛出异常](https://stackoverflow.com/questions/130117/throwing-exceptions-out-of-a-destructor/130123#130123)

2) 可以抛出哪些不同的异常可能性导致堆栈展开失败。

*   throw 表达式的构造函数抛出异常
*   异常传播时从析构函数抛出异常。
*   抛出的异常从未被捕获（如果这实际上展开堆栈，则定义实现）。
*   异常规范中未指定的异常抛出。
*   跨 C ABI 引发的异常。
*   在未捕获的线程内抛出异常（实现定义了发生的情况）

3）我可以通过将 CSingleLock 放在 try 块之外来解决这个问题吗？

不会。以上所有情况都会导致应用程序终止，而无需进一步展开堆栈。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T19:48:15.443

首先让我说我不知道​​ CSingleLock 和 CCriticalSection 是做什么的。

我所知道的是，在“用户代码”部分中引发的异常*应该*展开堆栈并破坏在 try { } 块中创建的任何变量。

在我看来，我希望您的 aLock 变量会被异常破坏，而不是 m_CriticalSection。您正在将指向 m_CriticalSection 的指针传递给 aLock 变量，但 m_CriticalSection 对象已经存在，并且是在其他地方创建的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T20:03:33.533

*   你确定你的 m_CriticalSection 的生命周期比 CSingleLock 长吗？
*   也许有人破坏了你的堆栈？
*   > > 3）我可以通过将 CSingleLock 放在 try 块之外来解决这个问题吗？

    在这种情况下 - 是的。但是请记住，将大块放入互斥锁中对性能不利。

*   顺便说一句，catch(...) 通常不是一个好习惯。在 Win32 中，它 (catch(...)) 也捕获 SEH 异常，而不仅仅是 c++ 异常。也许你在这个函数中有核心并用 catch(...) 捕获它。

# iphone - 扩展实用程序模板

> ID：616282
> 
> 赞同：0
> 
> 时间：2009-03-05T19:30:38.717
> 
> 标签：iphone, objective-c, sdk

扩展实用程序模板

我正在使用 Xcode Utility 模板（Mainside/Flipside），我需要添加一个新屏幕。我已经添加：

```
 docView.xib (copy of FlipsideView.xib)
 docView.m
 docView.h
 docViewController.m
 docViewController.h 
```

在 rootViewController.h 我添加了：

```
 UINavigationBar *docNavigationBar;
 docViewController *docViewController;

 @property (nonatomic, retain) UINavigationBar *docNavigationBar;
 @property (nonatomic, retain) docViewController *docViewController; 
```

在 rootViewController.m 中，我合成了添加的内容：

```
 @synthesize docNavigationBar;
 @synthesize docViewController; 
```

我确实将我的 .h 导入 rootViewController.m：

```
 #import "docViewController.h" 
```

当我尝试编译时，我出错了：

```
RootViewController.m:22: error: syntax error before 'docViewController' 
```

警告：

```
RootViewController.m:160: warning: property 'docViewController' requires method       '-docViewController' to be defined - use @synthesize, @dynamic or provide a method implementation 
```

RootViewController.m:160：警告：属性 'docViewController' 需要定义方法 'setDocViewController:' - 使用 @synthesize、@dynamic 或提供方法实现

我错过了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T21:25:50.810

实际上，我认为他的意思是放置 docViewController （它是新的视图控制器，对吧？）。无论如何，如果这是您的意思，而不是 Eric 所说的 FlipsideViewController，那么您的问题是您将其命名为与属性相同的名称。馊主意。正常的 Objective-C 约定是将类名的第一个字母大写，然后在将它们用作属性时将它们小写，等等。

```
docViewController *docViewController; 
```

应该：

```
DocViewController *docViewController; 
```

这样会更好地工作:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T19:39:16.823

在 rootViewController.h 中，看起来像您的声明行：

```
docViewController *docViewController; 
```

应该：

```
FlipsideViewController *docViewController 
```

# ruby - 如何从我创建的 NetBeans 安装 RubyGem？

> ID：616289
> 
> 赞同：0
> 
> 时间：2009-03-05T19:33:26.197
> 
> 标签：ruby, netbeans, rubygems

是否可以通过 NetBeans 安装我在 NetBeans 中创建的 RubyGem 而无需将其上传到 RubyForge？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T19:46:42.017

从[这里](http://www.rubygems.org/read/chapter/10)：

> `gem install`将安装命名的 gem。它将尝试进行本地安装（即当前目录中的 .gem 文件），如果失败，它将尝试下载并安装您想要的最新版本的 gem。

因此，您应该能够使用 .gem 文件从目录中运行 gem。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-13T17:07:32.567

看起来目前没有办法做到这一点。只需按照正常方式从命令行安装您的 gem。

# css - 使 CSS 页脚位于浏览器窗口的底部或内容的底部

> ID：616290
> 
> 赞同：14
> 
> 时间：2009-03-05T19:33:34.293
> 
> 标签：css

**[这个问题](https://stackoverflow.com/questions/42294/how-do-you-get-the-footer-to-stay-at-the-bottom-of-a-web-page)的重复。**

我有一个现有的网站（[jacquelinewhite.co.uk](http://www.jacquelinewhite.co.uk)），上面有一个页脚。目前，此页脚始终位于主要内容下方。我试图让它浮动到浏览器窗口的底部，或者如果内容大于窗口，则留在内容的底部。

实际上，HTML 的结构如下：

```
<div id="container">
  <div id="top_bar">
  </div>
<div id="header">
</div>
<div id="left_menu">
</div>
<div id="right_content">
</div>
<div class="clear">
</div>
<!-- FOOTER AREA -->
<div id="footer">
</div>
<!-- END FOOTER AREA -->
</div> 
```

我试过绝对位置，底部 0，它将页脚放在窗口的底部，但如果窗口的内容更大，那么页脚会覆盖内容。

我应该如何解决这个问题？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-03-05T19:35:42.650

这个对我来说总是很好用：[CSS Sticky Footer](http://ryanfait.com/sticky-footer/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T20:39:36.117

试驾这...

```
 body {
    margin:0;
    padding:0;
    z-index:0;
  }

  #toolbar {
    background:#ddd;
    border-top:solid 1px #666;
    bottom:0;
    height:15px;
    padding:5px;
    position:fixed;
    width:100%;
    z-index:1000;
  } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-01-31T11:14:03.233

假设您正在使用 footer() 元素，我发现将其添加到 CSS 对我有用

```
html, body {
  height: 100%;
}

body {
  display: flex;
  flex-direction: column;
}

footer {
  margin-top: auto;
} 
```

# regex - 计算机是否可以通过用户提供的示例“学习”正则表达式？

> ID：616292
> 
> 赞同：102
> 
> 时间：2009-03-05T19:34:26.240
> 
> 标签：regex, artificial-intelligence, theory, automata

计算机是否可以通过用户提供的示例“学习”正则表达式？

澄清：

*   我**不想**学习正则表达式。
*   我想创建一个程序，该程序从用户交互式提供的示例中“学习”正则表达式，可能是通过从文本中选择部分或选择开始或结束标记。

是否可以？是否有算法、关键字等可供我使用 Google 搜索？

**编辑**：感谢您的回答，但我对*提供*此功能的工具不感兴趣。我正在寻找理论信息，比如论文、教程、源代码、算法名称，这样我就可以为自己创造一些东西。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2014-12-22T19:59:49.577

是的，有可能，我们可以从示例中生成正则表达式（文本 -> 所需的提取）。这是一个可以完成这项工作的在线工具：[http ://regex.inginf.units.it/](http://regex.inginf.units.it/)

Regex Generator++ 在线工具使用 GP 搜索算法从提供的示例生成正则表达式。GP 算法由多目标适应度驱动，从而导致更高的性能和更简单的解决方案结构（奥卡姆剃刀）。该工具是的里雅斯特大学 (Università degli studi di Trieste) 机器学习实验室的演示应用程序。请看[这里](http://regex.inginf.units.it/demo.html)的视频教程。

[这是一个研究项目，因此您可以在此处](http://regex.inginf.units.it/how.html)阅读有关使用的算法的信息。

**看哪！**:-)

**当且仅当**提供的示例很好地描述了问题时，才有可能从示例中找到有意义的正则表达式/解决方案。考虑这些描述提取任务的示例，我们正在寻找特定的项目代码；示例是文本/提取对：

```
"The product code is 467-345A" -> "467-345A"
"The item 789-345B is broken"  -> "789-345B" 
```

一个（人类）人，看着这些例子，可能会说：“项目代码类似于 \d++-345[AB]”

当项目代码更宽松但我们没有提供其他示例时，我们没有证据来很好地理解问题。将人工生成的解决方案 \d++-345[AB] 应用于以下文本时，它会失败：

```
"On the back of the item there is a code: 966-347Z" 
```

您必须提供其他示例，以便更好地描述什么是匹配，什么不是所需的匹配：--ie：

```
"My phone is +39-128-3905 , and the phone product id is 966-347Z" -> "966-347Z" 
```

电话号码不是产品ID，这可能是一个重要的证明。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-03-05T20:18:21.050

[《计算学习理论导论](http://books.google.com/books?id=vCA01wY6iywC&printsec=frontcover)》一书包含一种学习有限自动机的算法。由于每种正则语言都等价于一个有限自动机，因此可以通过程序学习一些正则表达式。[Kearns 和 Valiant](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.76.893&rep=rep1&type=pdf)展示了一些无法学习有限自动机的情况。一个相关的问题是[学习隐马尔可夫模型](http://uirvli.ai.uiuc.edu/dugad/hmm_tut.html)，它是可以描述字符序列的概率自动机。请注意，编程语言中使用的大多数现代“正则表达式”实际上比正则语言更强大，因此有时更难学习。

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2009-03-07T01:42:42.713

没有计算机程序能够**仅**根据有效匹配列表生成有意义的正则表达式。让我告诉你为什么。

假设您提供示例 111111 和 999999，计算机应生成：

1.  与这两个示例完全匹配的正则表达式：`(111111|999999)`
2.  匹配 6 个相同数字的正则表达式`(\d)\1{5}`
3.  匹配 6 个 1 和 9 的正则表达式`[19]{6}`
4.  匹配任何 6 位数字的正则表达式`\d{6}`
5.  以上三个中的任何一个，带有单词边界，例如`\b\d{6}\b`
6.  前三个中的任何一个，前面或后面都没有数字，例如 `(?<!\d)\d{6}(?!\d)`

如您所见，可以通过多种方式将示例泛化为正则表达式。计算机构建可预测的正则表达式的唯一方法是要求您列出**所有**可能的匹配项。然后它可以生成与这些匹配项完全匹配的搜索模式。

如果您不想列出所有可能的匹配项，则需要更高级别的描述。这正是正则表达式旨在提供的。您只需告诉程序匹配“任何六位数字”，而不是提供一长串 6 位数字。在正则表达式语法中，这变为 \d{6}。

任何提供与正则表达式一样灵活的高级描述的方法也将与正则表达式一样复杂。[RegexBuddy 之](http://www.regexbuddy.com)类的所有工具都可以让创建和测试高级描述变得更容易。RegexBuddy 不是直接使用简洁的正则表达式语法，而是让您能够使用简单的英语构建块。但它无法为您创建高级描述，因为它无法神奇地知道何时应该概括您的示例，何时不应该概括。

当然可以创建一个工具，该工具使用示例文本以及用户提供的指南来生成正则表达式。设计这样一个工具的难点在于它如何向用户询问所需的指导信息，而不会使工具比正则表达式本身更难学习，并且不将工具限制为常见的正则表达式工作或简单的正则表达式。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-05T19:46:51.500

是的，这当然是“可能的”；这是伪代码：

```
string MakeRegexFromExamples(<listOfPosExamples>, <listOfNegExamples>)
{
   if HasIntersection(<listOfPosExamples>, <listOfNegExamples>)
     return <IntersectionError>

   string regex = "";
   foreach(string example in <listOfPosExamples>)
   {
      if(regex != "")
      {
         regex += "|";
      }
      regex += DoRegexEscaping(example);
   }
   regex = "^(" + regex + ")$";

   // Ignore <listOfNegExamples>; they're excluded by definition

   return regex;
} 
```

问题是有无数的正则表达式可以匹配示例列表。此代码提供了集合中最简单/最愚蠢的正则表达式，基本上匹配正面示例列表中的任何内容（没有其他内容，包括任何负面示例）。

我想真正的挑战是找到与所有示例匹配的最短正则表达式，但即便如此，用户也必须提供非常好的输入以确保生成的表达式是“正确的”。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-03-05T19:40:42.967

我相信这个词是“感应”。你想诱导一个规则的语法。

我认为有限的示例集（正面或负面）是不可能的。但是，如果我没记错的话，如果有可以咨询的 Oracle 就可以做到。（基本上你必须让程序问用户是/否问题，直到它满足为止。）

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-05T19:36:41.930

你可能想玩一下这个网站，它很酷，听起来和你所说的类似：http: [//txt2re.com](http://txt2re.com)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-07T01:53:24.433

有一种基于 prolog 的语言专门用于解决此类问题。它被称为[progol](http://www.doc.ic.ac.uk/~shm/progol.html)。

正如其他人所提到的，基本思想是归纳学习，在 AI 圈子中通常称为 ILP（[归纳逻辑编程）。](http://en.wikipedia.org/wiki/Inductive_Logic_Programming)

第二个链接是关于 ILP 的 wiki 文章，如果您有兴趣了解有关该主题的更多信息，其中包含许多有用的源材料。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-06T21:19:04.220

@Yuval 是正确的。您正在研究计算学习理论，或“归纳推理”。

这个问题比你想象的要复杂，因为“学习”的定义并不简单。一个常见的定义是学习者可以随时吐出答案，但最终，它必须要么停止吐出答案，要么总是吐出相同的答案。这假设输入的数量是无限的，并且绝对不会给出程序何时会做出决定的保证。此外，您无法判断它何时做出决定，因为它可能稍后仍会输出不同的内容。

根据这个定义，我很确定常规语言是可以学习的。根据其他定义，没有那么多...

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-07T13:04:30.700

我对 Google 和[CiteSeer](http://citeseer.ist.psu.edu/)做了一些研究，发现了这些技术/论文：

*   [语言识别在极限](http://en.wikipedia.org/wiki/Language_identification_in_the_limit)
*   [大概是正确的学习](http://en.wikipedia.org/wiki/Probably_approximately_correct_learning)

此外，Dana Angluin 的“Learning regular sets from queries and counterexamples”似乎很有希望，但我找不到 PS 或 PDF 版本，只有引用和研讨会论文。

即使在理论上，这似乎也是一个棘手的问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-05T19:43:59.103

如果一个人可以学习一个正则表达式，那么它从根本上来说是一个程序是可能的。但是，该程序需要正确编程才能学习。幸运的是，这是一个相当有限的逻辑空间，所以它不会像教程序能够看到对象或类似的东西那么复杂。

# firefox - Firebug：在控制台中访问您刚刚在 DOM 检查器中“查看”的对象

> ID：616301
> 
> 赞同：1
> 
> 时间：2009-03-05T19:35:20.623
> 
> 标签：firefox, console, firebug

1.  你的代码中有一个`console.log(o)`。
2.  现在在 Firebug 中，您可以单击控制台中的对象，这会将您带到 DOM 检查器。
3.  我认为有一种方法可以从控制台命令行访问您刚刚检查过的对象`$0`，但它似乎不起作用。

也许在 Firebug 中发生了一些变化，或者我记错了。在 Firebug 中还有其他方法可以做到这一点吗？如果没有，您是否有建议的解决方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-02-23T19:54:53.487

这在 Firebug 1.5 中再次起作用：您可以使用 $0 从控制台访问您在 HTML 选项卡中查看的最后一个活动元素。这非常方便。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T22:05:44.240

从 HTML 视图或 DOM 视图中，您可以获得所检查元素的 XPath。然后，您可以将 XPath 粘贴到此代码中以将其作为 var 获取：

```
var $0 = new XPathEvaluator().evaluate('my-xpath', document, new XPathEvaluator().createNSResolver(document), 0, null).iterateNext(); 
```

# xml - 如何解析/忽略格式错误的 XML 部分？

> ID：616313
> 
> 赞同：2
> 
> 时间：2009-03-05T19:37:19.247
> 
> 标签：xml, apache-flex, actionscript-3, air

我正在编写一个使用 beta 网络服务 API 的 Air 应用程序。有时，这个 API 会返回一个格式错误的 XML 节点，当我尝试从中创建 XML 对象时，actionscript 会引发错误。

我一直在做的只是尝试/捕获结果并在 XML 错误时忽略整个响应，但我可以忽略格式错误的节点。

例如：

```
<result>
  <Song>
    <location>http://www.anyurl.com/audio/loftparty092108_pt4.mp3</location>
    <title>Phonte party @ The Loft, 9/21/08 (pt. 4)</title>
    <artist>Statik, Jahsonic &amp; Stylus        <artist>Statik, Jahsonic &amp; Stylusre />
  </Song>
</result> 
```

看到那个标签了吗？如果我犯了这样的错误，我想跳过整首歌曲并获得下一首。

有什么办法可以做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T19:41:57.457

[Beautiful Soup](http://www.crummy.com/software/BeautifulSoup/)可以做到这一点，但它是用 Python 编写的。你当然可以一直挖掘源代码，看看他们是如何实现的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T19:54:08.753

1.  写信给网络服务提供商。告诉他们格式错误的 XML。他们可能只是修复它。
2.  当一个格式不正确的 XML 被传回时，Flex 的默认 XML 解码器会不知所措并抛出异常。
3.  如果您想尝试处理滚动您自己的解码器。见 的[`xmlDecode`](http://livedocs.adobe.com/flex/3/langref/mx/rpc/http/HTTPService.html#xmlDecode)成员`HTTPService`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T20:00:47.147

如果错误类别的数量很少，请预处理 XML 以删除错误，然后将其交给解析器。这将使您能够在问题得到解决后轻松删除解决方法。在上述情况下，您将文件作为文本加载，查找具有重复标签的节点，然后从 XML 文本中删除整个节点。

或者只是通知 Web 服务提供商并等待 - 如果他们返回格式错误的 XML，几乎每个解析器都会阻塞它，并且应该有动力尽快修复它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T22:53:33.080

不，您不能使用普通的 XML 解析器忽略格式错误的 XML 文档的一部分。这就像要求 Flex 编译器忽略语法错误并弄清楚编码器的真正意图。您将不得不编写自己的解析器来尝试推断畸形是什么以及它可以忽略什么。

老实说，任何发送不良 XML 的 Web 服务，甚至是测试版，都是不可靠的。这意味着他们正在“手动”而不是使用编程类来编写 XML。任何这样做的人都可能会犯很多其他错误，尤其是回归。你的时间太宝贵了，不能依赖他们。

干杯

# wcf - 将 Castle ActiveRecord/NHibernate 与 WCF 一起使用时是否有任何问题？

> ID：616314
> 
> 赞同：0
> 
> 时间：2009-03-05T19:37:50.647
> 
> 标签：wcf, nhibernate, castle-activerecord

Activerecord 为我们的数据库设计提供的那种灵活性，我们正在为我们的 DAL 寻找它并围绕它构建模型。我们将在这一切之上创建一个 WCF 服务。使用基于 NHibernate 的 Castle Activerecord 时是否有任何问题或兼容性问题？特别是当涉及到 WCF 使用的 DataContractSerializer 时。既然 ActiveRecord 不会使用 IQueryable，是不是太错过了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T21:40:46.763

序列化对象 = 分离对象。一旦您通过 WCF 通过网络发送对象，这就是您所拥有的。

所以最大的问题是，当您将 NHibernate 与 WCF 结合使用时，您将要处理的是分离的对象，这迫使您编写代码的方式有所不同。你失去了 NHibernate 的缓存能力和延迟加载特性。您必须在通过电线运送它们之前预先加载您的聚合。

当然，如果您改用数据传输对象，那一切都没有实际意义，但是既然您提到了 ActiveRecord，我猜这不是计划。

我可能离这里很远。希望 ActiveRecord 大师可以提供更多细节。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T21:50:19.910

虽然不特定于 WCF 和 Castle Activerecord，但我确实提供了警告。

确保您没有在持久层定义任何 CASCADING DELETE。让 ActiveRecord 为您处理这些，否则您稍后会遇到烦人的错误（收到 0 预期 1）键入不太清楚的内容。

此外，如果您需要频繁进行批量删除，则可能需要小心使用 ActiveRecord，因为 Castle 实现不支持批量删除，而是需要对要删除的每个项目进行昂贵的循环并进行单独的删除。

# iphone - 在 iPhone 上构建多视图应用程序

> ID：616316
> 
> 赞同：8
> 
> 时间：2009-03-05T19:38:18.930
> 
> 标签：iphone, cocoa-touch

我有一个带有根视图控制器、主视图控制器和辅助视图控制器的应用程序。我希望能够从辅助视图控制器向主视图控制器发送消息。我怎样才能获得对主要的参考，以便我可以向它发送消息？有没有更好的方法来构建这个？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T20:10:14.393

简短的回答：您可以像这样返回您的应用程序委托：

```
YourAppDelegate *delegate = [[UIApplication sharedApplication] delegate]; 
```

您可能已经在应用程序委托类中有一个指向根视图控制器的指针。您可能在根控制器对象中有指向主视图控制器和辅助视图控制器的指针。因此，您可以编写如下代码：

```
SecondaryViewController *primary = delegate.rootController.primaryController; 
```

然后，您可以随心所欲地向它发送消息。无需网点；只是每个视图控制器的属性。

有许多更长的答案，并且还讨论了为什么这种做法可能会受到质疑，因为它会在对象之间引入潜在的不需要的链接。在“纯粹的”面向对象设计中，您将遵循简洁的设计模式，在各个方向的对象之间具有清晰的链接，从而使您可以更好地重用代码。

另一种选择是传递指向类在初始化时需要的对象的指针。为您的视图控制器类实现一个新的 initWithSomethingOrOther 并将对象作为参数传入。缓存您需要的这些指针（不要忘记保留它们）以供以后使用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-06T01:24:20.347

干净的方法是为辅助控制器的委托定义一个协议，其中列出了它需要主控制器提供的方法：

```
@protocol SecondaryControllerDelegate <NSObject>
- (void)secondaryController:(SecondaryController*)secondaryController 
             frobFooWithBar:(Bar*)myBar;
- (BOOL)secondaryController:(SecondaryController*)secondaryController
           shouldTwiddleBaz:(Baz*)currentBaz;
@end 
```

现在向 SecondaryController 添加一个委托属性：

```
@interface SecondaryController : UIViewController {
    id <SecondaryControllerDelegate> delegate;
    ...
}

// delegates are one of the few places you don't retain an object
@property (assign) id <SecondaryControllerDelegate> delegate;
... 
```

在 SecondaryController 的实现部分，合成委托属性。（不要*在*析构函数中释放。）当SecondaryController需要和PrimaryController通信时，应该调用delegate上的相应方法。

现在让您的 PrimaryController 实现 SecondaryControllerDelegate 协议：

```
@interface PrimaryController : UIViewController <SecondaryControllerDelegate> {
... 
```

在 PrimaryController 中实现委托方法。

最后，让您的 PrimaryController 将自己设置为 SecondaryController 的委托。具体如何操作取决于您是否在 nib 中创建 SecondaryController。如果这样做，请在那里建立连接；如果没有，请在分配并初始化 SecondaryController 之后进行。

你为什么做这首歌和跳舞？好吧，当您必须在 Primary 和 Secondary 之间引入另一个控制器，或者在应用程序的其他地方使用 Secondary，甚至在*另一个*应用程序中使用 Secondary 时（我的四个应用程序中的三个都使用了一个控制器），你不需要'根本不必改变SecondaryController; 您只需更改现在应该成为其代表的任何类。从长远来看，这是一个令人难以置信的节省时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T19:52:06.090

如果控制器是从 NIB 加载的，您可以在辅助控制器上定义一个插座并将其连接到接口构建器中的主控制器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T14:08:53.440

使用 NSNotificationCenter 进行对象之间的解耦通信。

# c# - 实现预计算数据的最佳方式是什么？

> ID：616318
> 
> 赞同：1
> 
> 时间：2009-03-05T19:38:26.810
> 
> 标签：c#

我有一个计算，可以根据某些输入计算得到的百分比。但是这些计算可能需要相当长的时间，这可能很烦人。由于大约有 12500 个可能的输入，我认为预先计算所有数据并在正常程序执行期间查找这些数据是个好主意。

我的第一个想法是创建一个在程序初始化时读取并填充一些数组的简单文件。虽然这会起作用，但我想知道是否还有其他选择？例如，在编译期间填充数组。

顺便说一句，我正在用 C# 编写我的代码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T19:43:31.070

[本教程在这里](http://www.switchonthecode.com/tutorials/csharp-tutorial-serialize-objects-to-a-file)实现了一个序列化程序，您可以使用它轻松地将对象转换为二进制文件并返回。一旦掌握了序列化程序，您就可以创建一个包含所有数据的对象并对其进行序列化；当您实际运行程序时，只需反序列化对象并使用它。

这具有将对象保存到硬盘驱动器的所有好处，其实现与对象无关（意味着您不必为要序列化的任何对象编写太多代码）并以二进制输出（从而节省空间，如果这是一个问题）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T19:41:23.963

包含数据的文件可能是实现它的最简单和最灵活的方式。

如果您希望它在内存中而不需要从某个地方读取它，我会编写一个程序以类似 C# 的 CSV 格式输出您的数据，适合复制和粘贴到数组/集合初始化程序中，从而为您的预计算生成源代码数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T19:45:11.473

创建一个输出有效 C# 代码的程序，该代码初始化您的查找表。将这部分作为构建过程的一部分，以便它自动创建源文件，然后构建项目的其余部分。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T19:50:11.587

我总是首先考虑是否有任何方法可以避免预先计算。如果有 12500 个可能的输入，每个用户请求需要多少个？会同时需要所有 12500 还是会及时分散？如果你可以一次计算几个，我会用延迟初始化来做到这一点。我更喜欢这个解决方案只是因为从长远来看我会遇到更少的问题。当持久化格式改变或数据改变时你会怎么做。当文件丢失或损坏时，您将如何处理？持久化到文件不会创建*更少的*代码。

如果我必须保留预加载的版本，我*会将这样的文件序列化为人类可读的格式。*我可能会使用[xml 序列化](http://www.devhood.com/Tutorials/tutorial_details.aspx?tutorial_id=236)，因为它很简单。但经常存在无效和重新计算的问题。这些值是*从不*改变还是很少改变？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T19:55:15.490

正如 Daniel Lew 所说，将其序列化为二进制文件。
如果您需要速度，请使用字典。字典是根据它的键索引的，即使有大量数据也应该允许快速查找。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-05T19:56:39.933

我同意 mquander 和 Trent 的观点。使用您最喜欢的语言或脚本生成定义数据所需的整个 C# 文件（无需复制粘贴，这是手动步骤且容易出错）。在 Visual Studio 中将其添加为 Pre-Build 事件。您甚至可以检测到您有一个最新的文件并避免大多数版本的重新生成。

肯定有一种方法可以使用 C++ 中的模板元编程静态生成几乎任何数据，尽管它可能会很痛苦。除非您在程序的几个部分中需要许多不同的数据集，否则这是不值得的。我对 C# 中的元编程不够熟悉，无法评估您案例中的一般工作。你应该调查一下。

# c# - Xml 序列化后删除空的 xmlns=""

> ID：616328
> 
> 赞同：7
> 
> 时间：2009-03-05T19:41:35.723
> 
> 标签：c#, .net, xml, xml-serialization

所以我仍然在问关于这个话题的问题:-(

所以我创建了一个对象，用 Xml 序列化属性装饰它，据我所知，我向 xml 序列化命名空间集合添加了一个空命名空间，以免获得我不打算拥有的多余属性。

**编辑：**我的意思是这些属性：

```
<url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"; xmlns:xsd="http://www.w3.org/2001/XMLSchema"; xmlns=""> 
```

所以它给了我两个额外的属性。

经过进一步调查，如果我将文件的开头更改为：**

```
writer.WriteStartElement("urlset","http://www.sitemaps.org/schemas/sitemap/0.9"); 
```

到

```
writer.WriteStartElement("urlset"); 
```

**然后我在 url 标签中没有得到空的 xmlns="" 属性。这很好，但我确实要求根元素具有`xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"`，即：

```
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"> 
```

但是我仍然在序列化类型中得到一个空`xmlns=""`属性。

```
[XmlRoot(ElementName = "url", Namespace="")]
public class SitemapNode
{
    [XmlElement(ElementName = "loc")]
    public string Location { get; set; }
    [XmlElement(ElementName = "lastmod")]
    public DateTime LastModified { get; set; }
    [XmlElement(ElementName = "changefreq")]
    public SitemapChangeFrequency ChangeFrequency { get; set; }
    [XmlElement(ElementName = "priority")]
    public decimal Priority { get; set; }

    public SitemapNode()
    {
        Location = String.Empty;
        LastModified = DateTime.Now;
        ChangeFrequency = SitemapChangeFrequency.monthly;
        Priority = 0.5M;
    }

    public SitemapNode(string location, DateTime lastModified, SitemapChangeFrequency changeFrequency, decimal priority)
    {
        Location = location;
        LastModified = lastModified;
        ChangeFrequency = changeFrequency;
        Priority = priority;
    }
} 
```

然后我使用以下内容附加到我的 XmlWriter：

```
foreach (uk.co.andrewrea.SitemapNode node in List)
{
    XmlSerializerNamespaces ns = new XmlSerializerNamespaces();
    ns.Add(String.Empty, String.Empty);
    Serializer.Serialize(Writer, node, ns);
} 
```

这很好，除了我留下一个像这样的 emtpy xmlns=""

```
<url xmlns=""> 
```

有人有什么想法吗？同样，我可以使用 XmlTextWriter 和 XmlDocument 来实现这一点，但我需要使用 XmlWriter 来实现它。

任何帮助是极大的赞赏。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-05T20:37:14.843

这行得通（您只需要它们位于同一个命名空间中，并且使用命名空间类，这样作者就不会混淆）：

```
[TestMethod]
public void TestMethod3()
{
    var list = new []{new SitemapNode("1", DateTime.Now, 1), new SitemapNode("2", DateTime.Now.AddDays(1), 2)};
    var serializer = new XmlSerializer(typeof(SitemapNode));
    var st = new MemoryStream();
    using (var writer = XmlWriter.Create(st))
    {
        var ns = new XmlSerializerNamespaces();
        ns.Add("", "test");
        writer.WriteStartElement("test", "test");
        foreach (SitemapNode node in list)
        {
            serializer.Serialize(writer, node, ns);
        }
        writer.WriteEndElement();
    }
    st.Position = 0;
    TestContext.WriteLine(new StreamReader(st).ReadToEnd());
}

[XmlRoot(ElementName = "url", Namespace = "test")]
public class SitemapNode
{
    [XmlElement(ElementName = "loc")]
    public string Location { get; set; }
    [XmlElement(ElementName = "lastmod")]
    public DateTime LastModified { get; set; }
    [XmlElement(ElementName = "priority")]
    public decimal Priority { get; set; }

    public SitemapNode()
    {
        Location = String.Empty;
        LastModified = DateTime.Now;
        Priority = 0.5M;
    }

    public SitemapNode(string location, DateTime lastModified, decimal priority)
    {
        Location = location;
        LastModified = lastModified;
        Priority = priority;
    }
} 
```

输出是（基于您正在寻找的评论）：

```
 <?xml version="1.0" encoding="utf-8"?><test xmlns="test">
<url><loc>1</loc><lastmod>2009-03-05T13:35:54.6468-07:00</lastmod><priority>1</priority></url>
<url><loc>2</loc><lastmod>2009-03-06T13:35:54.6478-07:00</lastmod><priority>2</priority></url></test> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-11-30T17:00:24.513

我无法将节点插入到具有多个命名空间的现有文档中。

无论我将命名空间设置为什么，它每次都会添加 xmlns 引用属性，无论如何。这打破了下游的黑匣子。

我最终通过做这样的事情来解决这个问题。

```
XmlNode newNode = newDoc.SelectSingleNode(xpathQuery, manager);
newNode.Attributes.RemoveAll();   
node.ParentNode.InsertAfter(node.OwnerDocument.ImportNode(newNode, true), node); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T19:48:00.123

您是否尝试过不在 XmlRoot 属性中指定命名空间？

IE：

```
[XmlRoot(ElementName = "url")]
public class SitemapNode
{ 
...
} 
```

# visual-studio - 注册程序集的权限错误

> ID：616342
> 
> 赞同：0
> 
> 时间：2009-03-05T19:46:49.707
> 
> 标签：visual-studio, com, interop

我已经等了很长时间才同意从 IIS 迁移到内置 Web 服务器以调试我们的 Web 应用程序，主要原因之一是我不必总是以管理员身份运行 VS。

我们现在在解决方案中包含（导出）一个 COM dll，在构建它时，VS 尝试注册它并抱怨，因为我的普通用户没有所需的注册表访问权限。有没有办法解决？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T20:51:52.000

确定拒绝访问的父注册表项并更改其权限。您可以使用 sysinternals 中的 regmon 来确定权限失败发生的位置： [http ://technet.microsoft.com/en-us/sysinternals/bb896652.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896652.aspx)

您可以使用 regedit 更改权限（右键单击一个键并选择权限...条目）。在win2000上你需要使用regedt32（常规regedit没有权限菜单项）。

# java - TextMate source.java 注释块折叠

> ID：616344
> 
> 赞同：1
> 
> 时间：2009-03-05T19:47:07.850
> 
> 标签：java, textmate, textmatebundles

如何修改 java 语言定义包 foldStartMarker 和 foldStopMarker 条目以允许折叠这些类型的注释块？

这是评论风格：

```
/**
 * 这是评论...
 * 还有一条评论...
 */

```

我试过这个：

```
foldStartMarker = '(\{\s*(//.*)?$|^\s*// \{\{\{|^\s*\/\*\*)';
foldStopMarker = '^\s*(\}|// \}\}\}$|\*\/)';

```

我得到了'/**'字符的第一个匹配项，但我无法找到 StopMarker '*/'。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-28T17:24:13.150

这对我有用（用 Javascript 语言）：

```
foldingStartMarker = '^\s*\/\*';
foldingStopMarker = '\s*\*\/$'; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-28T11:15:20.847

同样的问题（自定义语言，但相同的注释块样式）。似乎`foldingStopMarker`永远不会在以空格开头的行上工作。

我尝试了许多组合，只要该行确实以空格开头，我就无法构建一个`foldingStopMarker`匹配它的正则表达式，而与该行中的其他字符无关。

似乎是一个错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-02T16:17:40.420

这并不理想，但我发现如果您在 C++ 源文件中以 **/ 而不是 */ 结束您的评论，它会识别它们进行折叠。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-07-07T11:23:30.477

暂时无法完成。记录的 textmate 行为、折叠开始和停止必须具有完全相同的缩进级别。使用 **/ 解决方法。

# iphone - iPhone - 从照片中获取位置信息

> ID：616346
> 
> 赞同：9
> 
> 时间：2009-03-05T19:47:56.943
> 
> 标签：iphone, cocoa-touch, geolocation, geocoding

是否有可能在 iPhone 应用程序中从用 iPhone 相机拍摄的照片中提取位置信息（我想它被称为地理编码）？

如果没有 API 调用来做到这一点，是否有任何已知的方法来解析数据字节以提取信息？我可以自己滚动的东西？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T19:55:35.380

很不幸的是，不行。

问题是这样的；

一个 jpeg 文件由几个部分组成。对于这个问题，我们感兴趣的是图像数据和 exif 数据。图像数据是图片，exif 数据是存储地理编码、快门速度、相机类型等信息的地方。

UIImage（和 CGI​​mage）只包含图像数据，没有标签。

当图像选择器选择图像（从库或相机中）时，它返回 UIImage，而不是 jpeg。这个 UIImage 是从 jpeg 图像数据创建的，但是 jpeg 中的 exif 数据被丢弃了。

这意味着这些数据根本不在 UIImage 中，因此无法访问。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-12-11T21:33:35.400

实际上，我认为选择的答案是错误的。嗯，没有错。它所说的一切都是正确的，但是有办法绕过这个限制。

`UIImagePickerController`传递一个字典以及`UIImage`它返回。其中一个关键是`UIImagePickerControllerMediaURL`“电影的文件系统 URL”。但是，正如[这里](https://stackoverflow.com/questions/2280479/in-the-uiimagepickercontroller-is-it-possible-to-get-the-nsurl-value-for-uiimage/3394878#3394878)在较新的 iOS 版本中所指出的，它也会返回图像的 url。将它与@Jasper 提到的[exif 库结合起来，您也许可以从照片中提取地理标签。](http://iphone-exif.googlecode.com/files/iphone-exif-guide-0.8.pdf)

我没有尝试过这种方法，但正如@tomtaylor 所提到的，这必须以某种方式成为可能，因为有一些应用程序可以做到这一点。（例如[实验室](http://itunes.apple.com/us/app/lab/id370554283?mt=8)）。

# ruby-on-rails - Rails 动态多模型表单属性

> ID：616363
> 
> 赞同：2
> 
> 时间：2009-03-05T19:52:52.157
> 
> 标签：ruby-on-rails

这个问题一直在杀死我。我玩弄了 Ryan Bates 复杂的表格，但我无法完全弄清楚我的问题。我有这个架构：

```
 Location has_many :targets
Target has_many :target_classifications
```

所有位置都显示在页面上。用户可以通过 jscript 为任何位置动态创建目标，然后在位置 3 选择下添加一个表格行（包含目标的可用分类）和一个目标值。在单击保存之前，可以为任何位置创建任意数量的目标。
我正在使用 rjs 来呈现具有以下代码的 target_partial：我以这种方式使用 fields_for：

对于每个选择。提交后，我得到了这个哈希：

```
“新目标”=>
  {"7"=>[{"id"=>"13"}, {"id"=>"15"}, {"value"=>"67", "id"=>""}],
   “4”=>
    [{"id"=>"12"},
     {"id"=>"15"},
     {"值"=>"23", "id"=>""},
     {"id"=>"11"},
     {"id"=>"16"},
     {"值"=>"67", "id"=>""}]},

```

因此，它按位置分隔每个目标（在本例中为“7”和“4”），但不分隔每个目标。我想要的是这样的：

```
“新目标”=>
  {"7"=>[
          {"target"=>[{"id"=>"13"}, {"id"=>"15"}, {"tonnes"=>"67"}]}
        ],
   “4”=>[
          {"目标"=>[{"id"=>"12"},{"id"=>"15"},{"tonnes"=>"23"]},
          {"目标"=>[{"id"=>"11"},{"id"=>"16"},{"tonnes"=>"67"]}
        ]
  }

```

所以我可以遍历每个位置的每个目标。我似乎无法在我的 field_for 方法中添加一个新的 [target] 大括号（它会爆炸），但这就是我想要做的。有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T16:15:09.023

不知道你是不是这样做的，但是在使用fields_for的时候需要指定一个字符串而不是对象。我看不到你的部分代码，所以我可能会走开。无论如何，我这样做的方式是在一个助手中：

```
def fields_for_target(target, &block)
  prefix = target.new_record? ? 'new' : 'existing'
  fields_for("location[#{prefix}_target_attributes][]", target, &block)
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T22:38:25.037

This sort of issue is discussed here:

> [http://wonderfullyflawed.com/2009/02/17/rails-forms-microformat/](http://wonderfullyflawed.com/2009/02/17/rails-forms-microformat/)

But it seems to be a rails 2.3 solution (not an option for me). Basically, I want a form like they've posted on the site:

```
<input name="creator[widget_attributes][0][id]" />
<input name="creator[widget_attributes][0][name]" />
<input name="creator[widget_attributes][0][price]" />

<input name="creator[widget_attributes][1][id]" />
<input name="creator[widget_attributes][1][name]" />
<input name="creator[widget_attributes][1][price]" /> 
```

Just some way to create a unique identifier for each target (or in this case, widget attribute) I want to add. Kind of tough given that a new target is added with jscript. I feel like there should be some way for rails to automatically do this for me

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-07-29T19:01:51.380

简单的。抬头看`accepts_nested_attributes_for`。:)

# http - 关于 URL 的可用性是否有任何安全的假设？

> ID：616365
> 
> 赞同：4
> 
> 时间：2009-03-05T19:53:08.927
> 
> 标签：http, url

我正在尝试确定是否有一种方法可以检查可能很大的 url 列表（> 1000000）的可用性，而不必向每一个发送 GET 请求。

假设如果[http://www.example.com](http://www.example.com)无法访问（如无法连接到服务器或域的 DNS 请求失败），或者我收到 4XX 或 5XX 响应，那么是否可以安全地假设来自该域的任何内容也将无法访问（例如[http://www.example.com/some/path/to/a/resource/named/whatever.jpg](http://www.example.com/some/path/to/a/resource/named/whatever.jpg)）？302 响应（比如whatever.jpg）是否足以使第一个假设无效？我想子域应该被认为是不同的，因为[http://subdomain.example.com](http://subdomain.example.com)和[http://www.example.com](http://www.example.com)可能不会指向同一个 IP？

对于我想出的每条捷径，我似乎都能想出一个反例。我应该硬着头皮向每个 URL 发送 GET 请求吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T19:55:51.510

不幸的是，不，你不能从`4xx`或`5xx`或任何其他代码中推断出任何东西。

这些代码是针对单个页面的，而不是针对服务器的。很可能一页关闭而另一页打开，或者一个有 500 服务器端错误而另一个没有。

您可以做的是使用`HEAD`而不是`GET`. 这会检索页面的 MIME 标头，但不会检索页面内容。这节省了服务器端的时间（因为它不必呈现页面）和您自己（因为您不必缓冲然后丢弃内容）。

另外我建议您使用`keep-alive`来加速来自同一服务器的响应。许多 HTTP 客户端库将为您执行此操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T19:58:46.557

对主机（例如 www.example.com）的 DNS 查找失败应该足以使该主机的所有 URL 无效。但是，必须单独检查子域或其他主机。

4xx 代码可能会告诉您某个特定页面不可用，但您无法据此对其他页面做出任何假设。

5xx 代码真的不会告诉你任何事情。例如，可能页面在那里，但服务器目前太忙了。如果您稍后再试一次，它可能会正常工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T19:57:36.887

您应该对 URL 的可用性做出的唯一假设是“获取 URL 会失败”。

假设父域请求失败时子域请求将失败是不安全的。也就是说，因为在您的两个请求之间，您的网络连接可能会上升、下降或通常行为不端。在请求之间更改域也是可能的。

忽略所有互联网连接问题。您仍在处理一个可以并且将不断变化的实时网站。当他们决定改变他们的页面结构或改变显示特定页面的方式时，现在的真实情况可能在 5 分钟内不真实。你最好的选择是假设任何获取都会失败。

这似乎是一个极端的观点。但这些事件**会**发生。你如何处理它们将决定你的程序的健壮性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T19:59:32.873

首先不要假设任何基于单个页面失败的事情。我见过很多情况，IIS 将继续提供静态内容，但不能提供任何动态内容。

您必须将每个主机名视为唯一的，您不能假设 subdomain.example.com 和 example.com 指向相同的 IP。或者即使他们这样做，也没有同一个站点的保证。IIS 再次具有允许您使用单个 IP 地址运行多个站点的主机标头。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T19:57:37.853

如果与服务器的连接实际失败，则没有理由检查该服务器上的 URL。否则，你不能假设任何事情。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T20:03:01.803

除了其他人所说的之外，使用[HEAD](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.4)请求而不是 GET 请求。它们的功能相同，但响应不包含消息正文，因此您可以为每个人节省一些带宽。

# simulation - 您将如何使用 Box2D 物理引擎保持火车在轨道上的俯视图？

> ID：616375
> 
> 赞同：2
> 
> 时间：2009-03-05T19:57:31.443
> 
> 标签：simulation, physics, box2d

我认为使用像 Box2D 这样的物理库来模拟火车的顶视图沿着轨道、穿越开关等会很有趣。我需要什么关节和马达来完成这项工作？

我很好奇如何实现使汽车遵循样条轨道所需的力，以便它可以撞到其他火车车厢、行人、DeLoreans 等。只需对每个时间步说“汽车现在处于样条曲线（t）”会在物理引擎中产生过大的力。如果我理解正确，您必须用一种力将汽车固定在轨道上，用另一种力将其角度限制为与轨道平行（或用两种力将汽车的前部和后部固定在轨道上），然后创建另一个推动火车前进的力量。我正在寻找有关如何完成这些事情的一些细节。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T09:39:08.883

我相信没有“真正的”物理会更容易，比如 Luxor 或 Tumble Bugs 等游戏的球运动。含义：让火车遵循由轨道定义的样条线。

使用 phyiscs 来让火车跟随轨道可能是矫枉过正的，并且可能导致各种不良副作用，包括颠簸运动、火车脱轨、火车卡在路口等。

但是，您仍然可以使用物理接头将各个货车连接在一起。只需确保只有机车获得加速力，火车的其余部分只是跟随或被推动但保持在花键上。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T20:07:51.683

你为什么担心让它“走上正轨”？它要去哪里？重力应该让它保持向下，物体相交应该保持它向上，所以你需要担心的唯一方向是向前和向后。这就是马达进来的地方，你就完成了。剩下的就是装饰品了。

针对问题的编辑：

护栏。与宽度相比，让火车足够长/足够坚固，以便您可以通过交叉口（使它们更接近直角，以尽量减少交叉口问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T08:47:12.457

自上而下的视图（即从天空看火车）并不需要 2d 物理引擎 - 如果我理解正确的话。事实上，它似乎对解决问题并没有真正的帮助（如果你想要一个火车模拟），但也许你只是想试试看。:)

但是，在火车和汽车上安装滑块接头，在机车上安装电机怎么样。滑块关节可能需要一些特殊的实现；您可能想沿着样条线而不是直线段运行火车，对吗？

某种球形接头将汽车连接在一起。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-26T08:16:17.403

实现不是那么困难，我能够在几个小时内完成基本工作的原型。它需要大量工作才能使其顺利运行，但它本质上只是“侧轨”。

自上而下你显然首先必须在 Box2D 中关闭重力。二是造火车。像对待汽车车轮一样对待火车车轮，它会突然变得简单得多。对于曲目，您有几个选择：

*   创建您自己的游戏对象（不在 box2D 世界中），它是一条简单的线，然后火车将“跟随”（您可以使用火车车轮上的电机“引导”朝向该线）。然后用一些漂亮的宽“铁路”图形覆盖这条线，你就有了一个很好的伪造系统。如果车轮偏离线路太远，请告诉车轮关闭，然后你就出轨了。

*   创建实际的物理轨道 - 火车“车轮”会撞到的外部轨道（如侧轨）。在这种情况下，它们必须具有柔和的曲线，考虑到您拥有的资源有限，这可能非常困难（在 Box2D 中模拟一个很好的慢速曲线在处理器上很粗糙）

那就让你的火车去吧！

# c++ - 多重继承+虚函数混乱

> ID：616380
> 
> 赞同：19
> 
> 时间：2009-03-05T19:59:13.950
> 
> 标签：c++, multiple-inheritance, virtual-functions, diamond-problem

我有一个像这样的菱形多重继承场景：

```
 A
  /   \
 B     C
  \   /
    D 
```

公共父节点 A 定义了一个虚函数 fn()。
B和C都可以定义`fn()`吗？
如果是，那么下一个问题是 - D 可以无歧义地访问 B 和 C 的 fn() 吗？我假设这有一些语法..
D 是否有可能在不知道具体谁是 B 和 C 的情况下这样做？B 和 C 可以被其他一些类替换，我希望 D 中的代码是通用的。

我想要做的是让 D 以某种方式枚举它在其祖先中拥有的所有 fn() 实例。这是否可能以其他方式表示虚拟功能？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-05T20:48:46.373

`fn`除非您在 中再次覆盖`D`，否则这是不可能的。因为在 D 对象中没有最终覆盖器： Both`C`和`B`override `A::fn`。你有几个选择：

*   丢弃`C::fn`或`B::fn`。然后，仍然覆盖的那个`A::fn`拥有最终的覆盖者。
*   在 D 中放置一个最终覆盖器。然后，该覆盖`A::fn`器以及`fn`在`C`和中覆盖`B`。

例如，以下导致编译时错误：

```
#include <iostream>

class A {
public:
    virtual void fn() { }
};

class B : public virtual A {
public:
    virtual void fn() { }
};

class C : public virtual A {
public:
    virtual void fn() { }
};

// does not override fn!!
class D : public B, public C {
public:
    virtual void doit() {
        B::fn();
        C::fn();
    }
};

int main(int argc, char **argv) {
  D d;
  d.doit();
  return 0;
} 
```

但是，您可以从 C 和 B 中的 A 派生非虚拟，但是您不再有钻石继承。也就是说，A 中的每个数据成员在 B 和 C 中出现两次，因为在 D 对象中有两个 A 基类子对象。我建议您重新考虑该设计。尝试消除需要虚拟继承的双重对象。它经常导致这种冲突的情况。

与此非常相似的情况是当您想要覆盖特定函数时。想象一下，你在 B 和 C 中有一个同名的虚函数（现在没有共同的基 A）。在 D 中，您希望覆盖每个函数，但为每个函数赋予不同的行为。根据您是使用 B 指针还是 C 指针调用函数，您会有不同的行为。[Herb Sutter 的Multiple Inheritance Part III](http://www.gotw.ca/gotw/039.htm)描述了一个很好的方法。它可能会帮助您决定您的设计。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T20:08:56.657

第一个问题，是的，B和C可以定义`fn()`为虚函数。`B::fn()`其次，D当然可以`C::fn()`通过使用范围操作符来访问：:: 第三个问题：D必须至少知道B和C，因为你必须在继承列表中定义它们。您可以使用模板让 B 和 C 的类型打开：

```
class A
{
public:
   virtual ~A() {}
   virtual void fn() = 0;
};

class B: public A
{
public:
   virtual ~B() {}
   virtual void fn(){ std::cout << "B::fn()" << std::endl; }
};

class C: public A
{
public:
   virtual ~C() {}
   virtual void fn(){ std::cout << "C::fn()" << std::endl; }
};

template <typename TypeB, typename TypeC>
class D: public TypeB, public TypeC
{
public:
   void Do()
   {
      static_cast<TypeB*>(this)->fn();
      static_cast<TypeC*>(this)->fn();
   }
};

typedef D<B, C> DInst;

DInst d;
d.Do(); 
```

关于自动枚举 D 继承自的所有类的所有 fn() 函数的愿望：我不确定如果不求助于 MPL 是否可行。至少您可以使用处理 3 个或更多模板参数的版本扩展我上面的示例，但我猜类模板参数的数量存在上限（内部编译器）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T21:01:54.533

如果您确实需要能够跟踪祖先和枚举类型，您可能需要查看[Loki TypeLists。](http://loki-lib.sourceforge.net/)我不确定如果没有大量工作，您所要求的是否真的可行。确保你没有在这里过度设计。

稍微不同的是，如果您打算以这种方式使用 MI（即可*怕的菱形*），那么您应该非常明确地说明您想要哪个虚拟成员。我想不出一个好的案例，你想选择`B::fn()`over的语义`C::fn()`而不在编写时明确做出决定`D`。您可能会根据单个方法的作用来选择一个（甚至两者）。一旦做出决定，要求继承的更改不会改变期望或语义接口。

如果您真的担心换入一个新类，`E`而不是say `B`where`E`不下降`B`但提供相同的接口，那么您应该真正使用模板方法，尽管我不确定为什么那里有一个`static_cast<>`.. .

```
struct A {
    virtual ~A() {}
    virtual void f() = 0;
};
struct B: A {
    virtual void f() { std::cout << "B::f()" << std::endl; }
};
struct C: A {
    virtual void f() { std::cout << "C::f()" << std::endl; }
};

template <typename Base1, typename Base2>
struct D: Base1, Base2 {
    void g() { Base1::f(); Base2::f(); }
};

int main() {
    D<B,C> d1;
    D<C,B> d2;
    d1.g();
    d2.g();
    return 0;
}

// Outputs:
//   B::f()
//   C::f()
//   C::f()
//   B::f() 
```

工作正常，看起来更容易看。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T20:09:18.560

您无法在祖先中枚举 fn() 的定义。C++ 缺乏反射。我能想象的唯一方法是一个巨大的循环测试所有可能祖先的 typeid。想象这一点很痛苦。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T20:48:11.167

Vividos 已经回答了帖子的主要部分。即使我会使用范围运算符而不是更繁琐的 static_cast<> + 取消引用运算符。

根据手头的任务，也许您可​​以将继承关系从 D 更改为 B 和 C，以减少耦合组合（加上可能从 A 继承）。这是假设您不需要将 D 多态地用作 B 或 C，并且您实际上并不需要 B 和 C 共享相同的基本实例。

如果您选择组合，您可以接收 B 和 C 作为构造函数的参数作为类型 A 的引用/指针，使 D 完全不知道类型 B 和 C。此时，您可以使用容器来容纳尽可能多的一个派生对象。您自己的 fn() 实现（如果您决定）或任何其他方法。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-05T20:06:10.923

已经有几个问题可以解决这个问题。似乎我们已经没有问题要问了。也许搜索框应该比“提问”按钮大。

看

*   [使用多重继承时如何避免死亡钻石？](https://stackoverflow.com/questions/137282/how-can-avoid-the-diamond-of-death-in-c-if-i-use-multiple-inheritance)
*   [多重继承的确切问题是什么？](https://stackoverflow.com/questions/225929/what-is-the-exact-problem-with-multiple-inheritance)
*   [多重继承是邪恶的吗？](https://stackoverflow.com/questions/364941/is-multiple-inheritance-evil)

# regex - 正则表达式词法分析

> ID：616384
> 
> 赞同：2
> 
> 时间：2009-03-05T20:01:01.747
> 
> 标签：regex

为什么像 [wcw|w is a string of a's and b's] 这样的重复字符串不能用正则表达式表示？请。给我详细的答案，因为我是词法分析的新手。谢谢 ...

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T20:18:05.903

原始形式的正则表达式描述了正则语言/语法。那些不能包含嵌套结构，因为这些语言可以用简单的有限状态机来描述。简化后，您可以想象该语言的每个单词都严格从左到右（或从右到左）增长，其中重复结构必须明确定义并且是静态的。

这意味着，任何来自先前状态的信息都不能传递到以后的状态（输入中的几个字符）。因此，如果您有符号*w*，则不能指定输入*必须*在序列后面具有完全相同的字符串*w 。*同样，您不能确保每个左括号也需要一个闭括号（因此正则表达式本身甚至不是正则语言，因此不能用正则表达式描述:-)）。

在理论计算机科学中，我们使用了一组非常有限的正则表达式运算符，基本上只由序列、替代 (|) 和重复 (*) 组成，其他一切都可以用这些操作来描述。

但是，通常正则表达式引擎允许将某些子模式分组为匹配项，然后可以在以后引用或提取这些匹配项。一些引擎甚至允许在搜索表达式字符串本身中使用这种反向引用，从而允许表达式描述的不仅仅是常规语言。如果我没记错的话，这种反向引用的使用甚至可以产生非上下文无关的语言。

附加提示：

*   [这个](https://stackoverflow.com/questions/612654/is-regex-in-modern-programming-langauges-really-context-sensitive-grammar)StackOverflow 问题
*   [维基百科](http://en.wikipedia.org/wiki/Regular_expression#Patterns_for_non-regular_languages)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T20:04:29.337

可以，您只是不能保证它是*相同*的“a”和“b”字符串，因为没有办法保留在遍历前半部分时获得的信息以用于遍历第二部分。

# xslt - XSLT 排序子元素跟进

> ID：616387
> 
> 赞同：2
> 
> 时间：2009-03-05T20:01:56.270
> 
> 标签：xslt, sorting

类似于前面的子元素排序，但我有一些额外的节点层。我想不出对先前有效答案的简单扩展。 [如何使用 XSLT 对 XML 的子元素进行排序](https://stackoverflow.com/questions/572854/how-to-sort-a-subelement-of-xml-with-xslt)

简化的输入示例：

```
 <Iteration>
  <Iteration_query-ID>NODE_10008</Iteration_query-ID>
  <Iteration_query-def>NODE_10008</Iteration_query-def>
  <Iteration_query-len>339</Iteration_query-len>
  <Iteration_hits>
    <Hit>
      <Hit_id>110679166</Hit_id>
      <Hit_def>[Roseobacter litoralis Och 149]</Hit_def>
      <Hit_len>68</Hit_len>
      <Hit_hsps>
        <Hsp>
          <Hsp_score>300.0</Hsp_score>
          <Hsp_evalue>4.94413E-26</Hsp_evalue>
          <Hsp_query-from>69</Hsp_query-from>
          <Hsp_query-to>272</Hsp_query-to>
        </Hsp>
      </Hit_hsps>
    </Hit>
    <Hit>
      <Hit_id>114767284</Hit_id>
      <Hit_def>[Roseovarius sp. HTCC2601]</Hit_def>
      <Hit_len>68</Hit_len>
      <Hit_hsps>
        <Hsp>
          <Hsp_bit-score>127.487</Hsp_bit-score>
          <Hsp_score>319.0</Hsp_score>
          <Hsp_evalue>3.0968E-28</Hsp_evalue>
          <Hsp_query-from>69</Hsp_query-from>
          <Hsp_query-to>272</Hsp_query-to>
        </Hsp>
      </Hit_hsps>
    </Hit>
  </Iteration_hits>
</Iteration> 
```

我想按 Hsp 属性之一进行排序，例如 Hsp_score。我已经能够对其进行排序，但我不知道如何防止它丢失一些命中节点：

```
 <xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
version="1.0">

    <xsl:import href="identity.xsl"/>

    <!--
    Iteration/Iteration_hits/Hit/Hit_hsps/Hsp
    -->
    <xsl:template match="Iteration_hits">
        <xsl:copy>
           <xsl:apply-templates select="Hit/Hit_hsps/Hsp">
                <xsl:sort select="Hsp_score" order="descending"/>
            </xsl:apply-templates>
        </xsl:copy>
    </xsl:template>
</xsl:stylesheet> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T04:01:33.683

**大卫的代码有一个*小*问题**：

正如所写，120 将出现*在*90 之后，尽管排序顺序被指定为`descending`.

使用数字排序键进行排序的正确方法如下所示：

```
<xsl:stylesheet version="1.0" 
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:output omit-xml-declaration="yes" indent="yes"/>
<!--                                                    --> 
    <xsl:param name="pNewType" select="'myNewType'"/>
    <xsl:template match="node()|@*">
        <xsl:copy>
            <xsl:apply-templates select="node()|@*"/>
        </xsl:copy>
    </xsl:template>
<!--                                                    -->
    <xsl:template match="Iteration_hits">
        <xsl:copy>
            <xsl:apply-templates select="Hit">
                <xsl:sort select="Hit_hsps/Hsp/Hsp_score"  
                 data-type="number"
                 order="descending"/>
            </xsl:apply-templates>
        </xsl:copy>
    </xsl:template>
</xsl:stylesheet> 
```

应用于此 XML 文档时：

```
<Iteration>
    <Iteration_query-ID>NODE_10008</Iteration_query-ID>
    <Iteration_query-def>NODE_10008</Iteration_query-def>
    <Iteration_query-len>339</Iteration_query-len>
    <Iteration_hits>
        <Hit>
            <Hit_id>110679166</Hit_id>
            <Hit_def>[Roseobacter litoralis Och 149]</Hit_def>
            <Hit_len>68</Hit_len>
            <Hit_hsps>
                <Hsp>
                    <Hsp_score>120.0</Hsp_score>
                    <Hsp_evalue>4.94413E-26</Hsp_evalue>
                    <Hsp_query-from>69</Hsp_query-from>
                    <Hsp_query-to>272</Hsp_query-to>
                </Hsp>
            </Hit_hsps>
        </Hit>
        <Hit>
            <Hit_id>114767284</Hit_id>
            <Hit_def>[Roseovarius sp. HTCC2601]</Hit_def>
            <Hit_len>68</Hit_len>
            <Hit_hsps>
                <Hsp>
                    <Hsp_bit-score>127.487</Hsp_bit-score>
                    <Hsp_score>90.0</Hsp_score>
                    <Hsp_evalue>3.0968E-28</Hsp_evalue>
                    <Hsp_query-from>69</Hsp_query-from>
                    <Hsp_query-to>272</Hsp_query-to>
                </Hsp>
            </Hit_hsps>
        </Hit>
    </Iteration_hits>
</Iteration> 
```

**产生正确的结果**：

```
<Iteration>
    <Iteration_query-ID>NODE_10008</Iteration_query-ID>
    <Iteration_query-def>NODE_10008</Iteration_query-def>
    <Iteration_query-len>339</Iteration_query-len>
    <Iteration_hits><Hit>
            <Hit_id>110679166</Hit_id>
            <Hit_def>[Roseobacter litoralis Och 149]</Hit_def>
            <Hit_len>68</Hit_len>
            <Hit_hsps>
                <Hsp>
                    <Hsp_score>120.0</Hsp_score>
                    <Hsp_evalue>4.94413E-26</Hsp_evalue>
                    <Hsp_query-from>69</Hsp_query-from>
                    <Hsp_query-to>272</Hsp_query-to>
                </Hsp>
            </Hit_hsps>
        </Hit><Hit>
            <Hit_id>114767284</Hit_id>
            <Hit_def>[Roseovarius sp. HTCC2601]</Hit_def>
            <Hit_len>68</Hit_len>
            <Hit_hsps>
                <Hsp>
                    <Hsp_bit-score>127.487</Hsp_bit-score>
                    <Hsp_score>90.0</Hsp_score>
                    <Hsp_evalue>3.0968E-28</Hsp_evalue>
                    <Hsp_query-from>69</Hsp_query-from>
                    <Hsp_query-to>272</Hsp_query-to>
                </Hsp>
            </Hit_hsps>
        </Hit></Iteration_hits>
</Iteration> 
```

**请注意*`data-type`属性*的使用[`xsl:sort`](http://www.w3.org/TR/xslt#sorting)。**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T20:21:02.290

这行得通吗？

```
<xsl:apply-templates select="Hit">
    <xsl:sort select="Hit_hsps/Hsp/Hsp_score" order="descending"/>
</xsl:apply-templates> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T20:36:39.900

测试大卫的代码。

这将起作用。

```
<xsl:apply-templates select="Hit">
    <xsl:sort select="Hit_hsps/Hsp/Hsp_score" data-type="number" order="descending"/>
</xsl:apply-templates> 
```

[W3 文档同意。](http://www.w3schools.com/xsl/el_sort.asp)

**编辑：**添加了 Dimitre 的数据类型属性。谢谢迪米特！

# sql-server - 什么分析器与 sql express 一起使用？

> ID：616388
> 
> 赞同：20
> 
> 时间：2009-03-05T20:02:23.537
> 
> 标签：sql-server, sql-server-express

有没有办法在 express 版本中监控 sql 调用的详细信息？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-03-05T20:08:40.683

试试[SQL Express Profiler](http://expressprofiler.codeplex.com)。

我已经使用了一点，它似乎像宣传的那样工作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-01-25T12:21:11.687

由于上面提到的大多数分析器似乎已经死亡或商业化，我想分享我几天前发现的内容：

[SQL Express 探查器](https://github.com/OleksiiKovalov/expressprofiler)

由于 CodePlex 已经退役，该项目转移到 GitHub 并且似乎不再有二进制下载选项，因此您必须从源代码编译它。

我目前正在将它与 SQL Server Express 2012 一起使用来监视来自我的 NHibernate 应用程序的查询（不想仅为此目的添加 log4net 并且仅将 show_sql 输出添加到我的 WCF 服务中没有的控制台窗口）。

非常好的和稳定的实用程序。我发现它比需要各种设置的 MS SQL Profiler 更容易使用，各种服务器版本的跟踪配置文件等等。Express Profiler - 只需启动，点击运行，所有 T-SQL 和 sp_execute 查询都会显示出来。

它是开源的，您可以根据需要添加更多功能。我想，清除按钮会很有用，因为现在您必须再次停止并运行才能清除列表。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-08T10:46:45.627

提到的[SqlProfiler For Express Edition](http://www.DataWizard.com/)适用于开发。

但是我发现它在解决生产紧急情况时并不总是有用的，比如当 sqlexpress 占用 100% 的服务器处理器容量时。在这种情况下，我无法让探查器产生任何跟踪。或许有类似的经历？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-08T11:01:54.077

Express 版只是完整版，有一些限制（2GB 内存、2 个 cpu 内核、4GB DB），所以如果你有完整版的工具，请使用它们。我认为 MS 网站上的试用版将允许您使用这些工具 - 但不是引擎 - 超过 60 天.....虽然可能有一个官方的工具包用于快递

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-07-23T11:29:39.403

我使用 AnjLab Sql Profiler 已经有一段时间了。我没有遇到任何问题。

**编辑：** 这是链接：[http ://anjlab.com/en/projects/opensource/sqlprofiler](http://anjlab.com/en/projects/opensource/sqlprofiler)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-07-06T06:18:31.583

其他人提到的免费 SQL 分析器似乎不再可用。下一个最佳选择可能是这样的：

[http://www.codeproject.com/Articles/20173/MS-SQL-Server-Profiler-with-NET](http://www.codeproject.com/Articles/20173/MS-SQL-Server-Profiler-with-NET)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-03-06T19:13:42.690

您宁愿使用 SQL Server 扩展事件而不是任何 Profiler。Express 版本中提供了扩展事件。在对象资源管理器窗口中服务器的管理文件夹下有来自 SQL Server 2012 的 UI 管理。

您可以在 Stack Exchange 上阅读有关使用扩展事件而不是 SQL Profiler 的优势的一个很好的答案 - 其中包括更少的性能开销 - [https://dba.stackexchange.com/questions/2665/when-should-extended-events-be -used-instead-of-sql-profiler-perfmon](https://dba.stackexchange.com/questions/2665/when-should-extended-events-be-used-instead-of-sql-profiler-perfmon)

“扩展事件是监控和故障排除的未来，在未来的某一天，SQL 跟踪将被删除”

问候。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-05-25T14:15:50.253

作为开发人员，我们可以购买价格为 50 美元左右的 SQL Server 2005/08 开发人员版。它具有功能齐全的 SQL Profiler，并且超出了 SQL Server Express SKU 的限制。

如果不是使用[SQL Express Profiler](http://www.DataWizard.com)

希望这可以帮助！

# svn - SVN 分支和合并在快速变化的高周转特征环境中

> ID：616389
> 
> 赞同：2
> 
> 时间：2009-03-05T20:02:59.933
> 
> 标签：svn, branch, merge

我希望这是有道理的，如果这已经被覆盖过，我深表歉意。

情况：我们定期发布到生产环境。至少每两周发布一次，但通常一周最多可以发布三个版本。我们有一个由 3xSE、2xWD、3xQA 和技术经理/主管（我）组成的专注团队。团队会根据需求波动，但我们通常会发现 QA 的规模会在接近尾声时急剧增加，以应对延迟的需求/资产或大型回归测试阶段。6 个通常针对发布日期的标准功能分支和一个兼作发布分支的主干。有合并和分支开销，但我们已经非常擅长将其归结为美术。因此，只要从某个功能分支合并到主干，我们就会定期从主干合并到功能分支来维护分支。

问题：我想看看改进这个过程的方法，我们已经研究了在主干存储库中完成所有工作的选项，分支到 QA 存储库，然后进入发布分支。如果需要从主干中使用功能分支，我们仍然可以使用，尽管这可能会令人不悦。我的观点是，要将网站的两个主要元素（内容和功能）结合在一起，我们需要让事情依赖于时间。即提供一种将时间依赖于内容的机制（我不确定您是否可以使用该功能）。这个过程的成本会相对较高，如果它不起作用，我们会很快发现，因为我们无法足够快地响应客户。

有没有人有任何建议或以前遇到过类似的情况？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T20:08:33.243

您是否使用 SVN 1.5，如果您是，我会认真研究“svn merge --reintegrate”功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T20:14:03.290

根据您描述的场景。我建议将实验性开发转移到主干，并在冻结发布的功能时创建发布分支。从那时起，只在发布分支中引入错误修复。发布分支可以根据需要保留。发布发布后无需删除分支。（当然这样做不会有什么坏处。使用 SVN 不会永久删除任何内容）。

# c# - C# dropdownmenuitem 单击和列表视图编辑

> ID：616403
> 
> 赞同：0
> 
> 时间：2009-03-05T20:07:03.370
> 
> 标签：c#, visual-studio, winforms, listview, drop-down-menu

我有两个关于 C# 的问题。

1）我有一个下拉菜单，里面有几个项目。它们是可点击的，但是当我点击一个时，较旧的点击一个保持选中状态。单击另一个，两个原始的保持选中状态，依此类推。我不想要这个。我想要的是，当我单击其中一个下拉项时，那个是选定的，而其他的不是。

2）我在winform上有一个listview项目。我从文件中加载了一些字符串元素。现在我想做的是能够编辑这些字符串，甚至添加字符串，只需单击数据所在的行。

我已经检查了 google 和 MSDN 是否有这些问题，但没有任何帮助，所以我转向这里。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T20:10:37.760

2) ListView 不支持该类型的操作。您可以自己滚动（@$$ 中的痛苦），或者 DataGrid 可能更适合您的目的。

编辑：

[这个链接也可以帮助](http://msdn.microsoft.com/en-us/library/ms745183.aspx)
[这个](http://www.codeproject.com/KB/list/LeerGridView.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T20:17:02.270

对于＃1，我有点困惑。如果 DropDownStyle 未设置为 simple，则会发生一些奇怪的事情。这并不多，但也许你可以尝试重新创建控件。

对于#2，我能想到的最简单的解决方案是将 TextBox 设置为等于从列表视图中选择的文本值。之后编写一个小函数来使用列表视图中的编辑文本更新列表视图的选定索引。

如果您有关于#1 的更多信息，请发表评论。

# svn - 源代码控制：同一项目的多个存储库

> ID：616404
> 
> 赞同：6
> 
> 时间：2009-03-05T20:07:05.413
> 
> 标签：svn, version-control, tortoisesvn, repository, commit

**同一个项目可以有多个存储库吗？**

我目前正在将 SVN 与 TortoiseSVN 一起使用，并将存储库放在我家的外部硬盘上，并且关于备份解决方案，这并不理想。

因此，我的想法是创建一个[unfuddle](http://unfuddle.com/)帐户并拥有**第二个**（我的家是第一个）存储库，我可以在那里提交（即使是远程备份解决方案）。

现在，当然，我希望我的代码保持完整性，并且我不希望两个（或更多？）存储库之间存在差异，这意味着当我提交我的代码时，两个存储库都应该更新。

那么我能做些什么来实现这一点呢？

**我的想法是提交到我的主存储库（主存储库），然后它会自动自动**提交到在线存储库（unfuddle 存储库）（因为我当然不想每次都手动提交到两个存储库）提交我的代码）

这可能吗 ？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T20:12:03.343

[一切皆有可能](http://www.codegobbler.com/mirror-svn-repository-svnsync):)

**编辑**：匆忙永远不会导致质量，我的回答也没有，错过了问题中的所有 Windows 引用。所以这里有一个关于如何让同步在 Windows 上工作的问题。

在这种情况下，您有 2 台机器：

*   机器 A：存储库现在运行的位置。
*   机器 B：您要同步到的位置。

在 B 上创建一个您希望从 A 同步到的新存储库。此存储库为空白（在 rev0 上运行）非常重要。

在 B 上，在新创建的存储库的 SVN 文件夹中，浏览到 /hooks 并创建以下 BAT 文件：

**开始提交.bat**

```
IF "%2" == "someusername" (goto :label1) else (echo "Only the someusername account may commit new revisions" >&2 )

exit 1
goto :eof

:label1
exit 0 
```

**pre-revprop-change.bat**

```
IF "%3" == "someuser" (goto :label1) else (echo "Only the someuser user may change revision properties" >&2 )

exit 1
goto :eof

:label1
exit 0 
```

`someuser`是机器 A 的存储库中存在的同步用户，并且是机器 B 的存储库中唯一拥有权限的用户。非常重要的是，没有手动提交到机器 B 的存储库。

在`/hooks`机器 A 上存储库的文件夹中

**提交后.bat**

```
CD PATH_TO_SUBVERSION\bin
svnsync sync svn://machineB/repos --non-interactive --no-auth-cache --source-username machineAusername --source-password machineApassword --sync-username machineBusername --sync-password machineBpassword 
```

一旦这些批处理文件就位，我们需要告诉 B 上的存储库我们想要同步到它：

`svnsync initialize svn://`**机器B**`/repos svn://`**机器**`/repos --non-interactive --no-auth-cache --source-username` **A机器用户名机器** **密码机用户名**`--source-password` **机器** `--sync-username` **B密码** `--sync-password`

 **它应该返回如下内容：`Copied properties for revision 0.`

现在，每次您提交到机器 A 上的存储库时，它都会被复制到机器 B 的存储库中。

请务必注意，如果您想同步到[Google 代码](http://en.wikipedia.org/wiki/Google_Code)或其他在线存储库，他们将主干/分支/标签结构提交到修订版 1。如果您希望使用这些第三方存储库，您必须联系他们重置存储库位置作为同步存储库。

[为了给予应有的荣誉，我从http://www.svnforum.org/2017/viewtopic.php?t=5745&sid=06551a22d9c0b5780cf1faab6b0e8ce9](http://www.svnforum.org/2017/viewtopic.php?t=5745&sid=06551a22d9c0b5780cf1faab6b0e8ce9)复制了 pre-revprop-change.bat 和 start-commit.bat

我刚刚自己在一个测试存储库上实现了这个，它看起来就像一个魅力。我很高兴我注意到了这个问题，尽管 svnsync 在我的头骨中已经陷入太深了。我打算在工作中设置 svn 时进行设置。所以我知道我明天上班的第一件事是什么，谢谢！

**编辑2：**

如果您像我一样拥有大量存储库，那么这个通用的 post-commit.bat 可能会吸引您：

```
SET REPOS=%1
SET REV=%2
SET REPOS=%REPOS:D:\SVN=%

CD "C:\Program Files\Subversion\bin"

svnsync sync svn://machineB/%REPOS%-sync --non-interactive --no-auth-cache --source-username usernameA --source-password passwordA --sync-username usernameB --sync-password passwordB 
```

这会捕获存储库名称并使用它来动态确定同步 URL。为了清楚起见，我为机器 B 上的所有同步存储库添加了后缀`-sync`。这个`D:\SVN`位是**machineB**上的 svnserve 根，即使这个通用 BAT 文件应该放在**machineA**的 svnserve 根的 /hooks 中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T21:02:41.053

我不确定我是否完全理解您的问题，但我认为您正在寻找的是[svnsync](http://svnbook.red-bean.com/en/1.5/svn.reposadmin.maint.html#svn.reposadmin.maint.tk.svnsync)。

您可以将主存储库放在笔记本硬盘中，并将镜像存储库放在桌面/家庭服务器上。

只需将您的更改提交到主存储库，然后将其同步到您的镜像存储库。此过程是增量的，因此仅传输自上次同步以来的修订，但请注意未版本化的属性。

你也可能想看看[这里](http://svn.collab.net/repos/svn/trunk/notes/svnsync.txt)和[这里](http://svnbook.red-bean.com/en/1.5/svn.reposadmin.maint.html#svn.reposadmin.maint.replication)。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-05T21:04:45.727

从纯 SVN 的角度来看，您只能拥有一个 .svn 文件夹，该文件夹指向您的工作文件夹中的 1 个 repo。

您可以在您的 svn repo 上使用 post-commit-hooks 来尝试使两个 repos 保持同步.. 但实际上，如果这是您想要的，那么您只是使用了错误的工具。

您所描述的问题的核心是像 GIT 这样的分布式版本控制系统。这允许您在本地进行提交并将其推送到远程存储库。

如果你愿意的话，你甚至可以在本地使用 GIT 和 SVN 作为你的远程仓库。

*   请参阅[GIT](http://git-scm.com/)获取该工具
*   参见[GitHub](https://github.com/)免费公共托管

# c# - 在 VS2008 中自动重新格式化整个 C# 源代码树的工具？

> ID：616406
> 
> 赞同：4
> 
> 时间：2009-03-05T20:07:20.453
> 
> 标签：c#, visual-studio, visual-studio-2008, formatting

我继承了一个大型源代码树 C#、Visual Studio 2008。

它有许多质量问题，其中之一是代码通常格式错误。

我正在寻找一种工具，最好是 Visual Studio 的插件，它将检查整个解决方案并应用与 Visual Studio 本身相同的基本格式，例如，当您在代码块周围关闭花括号时。

有什么建议么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T20:09:50.913

在 vs2005 中，您可以对单个文件执行 Edit->Advanced->Format Document，这将（我相信）按照您的要求进行。我假设 vs2008 在某处有类似的功能。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-09T19:53:37.080

好的，那为什么不试试宏，如果你想做整个解决方案，这里有一个vb示例

[http://blogs.msdn.com/kevinpilchbisson/archive/2004/05/17/133371.aspx](http://blogs.msdn.com/kevinpilchbisson/archive/2004/05/17/133371.aspx)

它会打开每个文件并应用与 VS 相同的格式，但宏将在整个解决方案中工作（如果您的解决方案很大，运行它可能不是那么明智），除了反映 VS 中格式文档代码的内部结构和将其插入某种流中，这似乎是利用我认为在 Visual Studio 中非常有用的功能的最简单方法

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T20:16:22.537

[ReSharper](http://www.jetbrains.com/resharper/index.html)应该可以满足您的需求。看看他们的[代码清理功能](http://www.jetbrains.com/resharper/features/code_formatting.html)。这可以应用于多个文件，包括整个解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T20:20:29.237

如果您已经在 vs 编辑器选项中设置了您的偏好，您应该可以点击 CTRL K、CTRL D 这将根据您的偏好整理代码

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T20:01:17.517

这是简单的方法（对我来说）......

我将我的 Visual Studio 设置为在“粘贴”上重新格式化

```
Tools | Options | Text Editor | C# | Formatting

**Automatically format on paste** (checked) 
```

当我遇到丑陋的文件时，我会使用 CTRL-A、CTRL-X、CTRL-V——噗，即时格式 :)

希望这可以帮助。

凯文

# iphone - Cocoa/iPhone：如何防止 ibtool 在 xib 文件中输出不可本地化的字符串？

> ID：616410
> 
> 赞同：0
> 
> 时间：2009-03-05T20:08:06.037
> 
> 标签：iphone, cocoa, localization, internationalization

我正在对 iPhone 应用程序进行国际化，我正在使用 ibtool 从我的 xib 文件中提取字符串，以便它们可以由本地化公司翻译，如下所示：

```
ibtool --generate-strings-file BlahBlahView.strings English.lproj/BlahBlahView.xib 
```

问题在于，当我真的想要 i18n 真正关心的子集时，我最终得到的 .strings 文件包含 xib 中包含的*所有字符串。*是否有任何最佳实践来处理这个问题？理想情况下，我希望能够在界面生成器中添加某种注释来说明“这是可本地化的”或“这是不可本地化的”，并且 ibtool 在我运行它时只输出可本地化的字符串。

谢谢！

编辑：好的，让我稍微扩展一下参数。该解决方案不需要仅使用 ibtool。Ibtool + xib 中的一些数据 + shell 脚本很好。只要有效！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T15:27:41.847

Ibtool 在其字符串文件输出中非常冗长，并通过 object-id 而不是唯一的源字符串生成stirngs。当您尝试重新创建界面构建器或需要对 xib 文件中的对象进行广泛控制时，这种类型的输出非常有用，但当您只是想本地化您的软件时则不太有用。

Digitalwaters.net 的 Matteo 找到了一种将 ibtool 的输出与其前身 nibtool 使用的格式相互转换的方法，它的功能不那么强大，但更容易用于本地化。更多信息[在这里](http://www.digitalwaters.net/koan/ing/2007/11/27/from-nibtool-to-ibtool.html)。

我重新使用了他的脚本来简化我们的 Mac OS X 应用程序的本地化，它们对我很有效。祝你好运 ：）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T05:00:39.647

我认为您可以自动执行此操作，但需要几个步骤。您可以使用 ibtool 从您的 xib 中提取任意属性，因此您可以将不可本地化项目的标签设置为特定值（例如，-1），然后提取标签并使用它来过滤字符串文件并删除不需要的条目。

查看 ibtool 的手册页，尤其是 -export 选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-12-16T09:46:48.967

`ibtool`不输出空字符串的条目。因此，例如，如果您将 UILabel 的文本留空，它将不会包含在`ibtool --generate-strings-file`. 然后，您可以在视图控制器中设置元素的文本。

# iphone - (iPhone) 如何处理 UITextView 上的触摸？

> ID：616411
> 
> 赞同：24
> 
> 时间：2009-03-05T20:08:23.163
> 
> 标签：iphone, uitextview

我正在尝试处理 iPhone 的 UITextView 上的触摸。例如，我通过创建 UIImageViews 的子类并实现 touchesBegan 方法成功地处理了点击和其他触摸事件......但是这显然不适用于 UITextView :(

UITextView 启用了用户交互和多点触控，只是为了确保......没有快乐。有人设法处理这个吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-08T16:38:33.157

UITextView（UIScrollView 的子类）包含很多事件处理。它处理复制和粘贴以及数据检测器。也就是说，它可能是一个错误，它不会传递未处理的事件。

有一个简单的解决方案：您可以继承 UITextView 并在您自己的版本中实现您自己的 touchesEnded （和其他事件处理消息），您应该`[super touchesBegan:touches withEvent:event];`在每个触摸处理方法中调用。

```
#import "MyTextView.h"  //MyTextView:UITextView
@implementation MyTextView

- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event{
    NSLog(@"touchesBegan");
}

- (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event{
        [super touchesBegan:touches withEvent:event];
    NSLog(@"touchesMoved");
}

- (void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event{
    NSLog(@"****touchesEnded");
    [self.nextResponder touchesEnded: touches withEvent:event]; 
    NSLog(@"****touchesEnded");
    [super touchesEnded:touches withEvent:event];
    NSLog(@"****touchesEnded");
}

- (void)touchesCancelled:(NSSet *)touches withEvent:(UIEvent *)event{
[super touches... etc]; 
NSLog(@"touchesCancelled");
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-08-11T05:02:49.880

如果您想在 UITextView 上处理单/双/三次点击，您可以委托 UIGestureRecongnizer 并在您的 textview 上添加手势识别器。

继承人相同的代码（在 viewDidLoad 中）：

```
UITapGestureRecognizer *singleTap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(handleSingleTap)];

//modify this number to recognizer number of tap
[singleTap setNumberOfTapsRequired:1];
[self.textView addGestureRecognizer:singleTap];
[singleTap release]; 
```

和

```
-(void)handleSingleTap{
   //handle tap in here 
   NSLog(@"Single tap on view");
} 
```

希望这有帮助：D

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-11-21T12:40:47.143

**更好的解决方案** *（无需调整任何内容或使用任何私有 API :D）*

如下所述，将 new 添加`UITapGestureRecognizers`到 textview 并没有预期的结果，处理程序方法永远不会被调用。那是因为他们`UITextView`已经设置了一些点击手势识别器，我认为他们的委托不允许我的手势识别器*正常工作*，并且更改他们的委托可能会导致更糟糕的结果，我相信。

幸运的是，`UITextView`我已经设置了手势识别器，问题是它会根据视图的状态而变化（即：输入日语时的手势识别器集合与输入英语时以及不处于编辑模式时的手势识别器不同）。我通过在 UITextView 的子类中覆盖这些来解决这个问题：

```
- (void)addGestureRecognizer:(UIGestureRecognizer *)gestureRecognizer
{
    [super addGestureRecognizer:gestureRecognizer];
    // Check the new gesture recognizer is the same kind as the one we want to implement
    // Note:
    // This works because `UITextTapRecognizer` is a subclass of `UITapGestureRecognizer`
    // and the text view has some `UITextTapRecognizer` added :)
    if ([gestureRecognizer isKindOfClass:[UITapGestureRecognizer class]]) {
        UITapGestureRecognizer *tgr = (UITapGestureRecognizer *)gestureRecognizer;
        if ([tgr numberOfTapsRequired] == 1 &&
            [tgr numberOfTouchesRequired] == 1) {
            // If found then add self to its targets/actions
            [tgr addTarget:self action:@selector(_handleOneFingerTap:)];
        }
    }
}
- (void)removeGestureRecognizer:(UIGestureRecognizer *)gestureRecognizer
{
    // Check the new gesture recognizer is the same kind as the one we want to implement
    // Read above note
    if ([gestureRecognizer isKindOfClass:[UITapGestureRecognizer class]]) {
        UITapGestureRecognizer *tgr = (UITapGestureRecognizer *)gestureRecognizer;
        if ([tgr numberOfTapsRequired] == 1 &&
            [tgr numberOfTouchesRequired] == 1) {
            // If found then remove self from its targets/actions
            [tgr removeTarget:self action:@selector(_handleOneFingerTap:)];
        }
    }
    [super removeGestureRecognizer:gestureRecognizer];
}

- (void)_handleOneFingerTap:(UITapGestureRecognizer *)tgr
{
    NSDictionary *userInfo = [NSDictionary dictionaryWithObject:tgr forKey:@"UITapGestureRecognizer"];
    [[NSNotificationCenter defaultCenter] postNotificationName:@"TextViewOneFingerTapNotification" object:self userInfo:userInfo];
    // Or I could have handled the action here directly ...
} 
```

通过这种方式，无论 textview 何时更改其手势识别器，我们将始终捕获我们想要的点击手势识别器 → 因此，我们的处理程序方法将被相应地调用 :)

**结论：** 如果你想在 中添加手势识别器`UITextView`，你必须检查文本视图是否已经有它。

*   如果没有它，只需按照常规方式进行即可。（创建你的手势识别器，设置它，然后将它添加到文本视图中）你就完成了！
*   如果*确实*有，那么您可能需要执行与上述类似的操作。

* * *

**旧答案**

我通过***调配私有方法***得出了这个答案，因为以前的答案有缺点，而且它们没有按预期工作。这里，我并没有修改 的敲击行为，`UITextView`而是截取被调用的方法，然后调用原来的方法。

**进一步说明**

`UITextView`有一堆专门的`UIGestureRecognizers`，每个都有 a`target`和 a`action`但它们`target`不是它`UITextView`本身，它是 forward 类的一个对象`UITextInteractionAssistant`。（此助手是一个`@package`ivar，`UITextView`但前向定义在公共头文件中：UITextField.h）。

`UITextTapRecognizer`识别点击和调用`oneFingerTap:`，`UITextInteractionAssistant`所以我们要拦截该调用:)

```
#import <objc/runtime.h>

// Prototype and declaration of method that is going be swizzled
// When called: self and sender are supposed to be UITextInteractionAssistant and UITextTapRecognizer objects respectively
void proxy_oneFingerTap(id self, SEL _cmd, id sender);
void proxy_oneFingerTap(id self, SEL _cmd, id sender){ 
    [[NSNotificationCenter defaultCenter] postNotificationName:@"TextViewOneFinderTap" object:self userInfo:nil];
    if ([self respondsToSelector:@selector(proxy_oneFingerTap:)]) {
        [self performSelector:@selector(proxy_oneFingerTap:) withObject:sender];
    }
}

...
// subclass of UITextView
// Add above method and swizzle it with.
- (void)doTrickForCatchingTaps
{
    Class class = [UITextInteractionAssistant class]; // or below line to avoid ugly warnings
    //Class class = NSClassFromString(@"UITextInteractionAssistant");
    SEL new_selector = @selector(proxy_oneFingerTap:);
    SEL orig_selector = @selector(oneFingerTap:);

    // Add method dynamically because UITextInteractionAssistant is a private class
    BOOL success = class_addMethod(class, new_selector, (IMP)proxy_oneFingerTap, "v@:@");
    if (success) {
        Method originalMethod = class_getInstanceMethod(class, orig_selector);
        Method newMethod = class_getInstanceMethod(class, new_selector);
        if ((originalMethod != nil) && (newMethod != nil)){
            method_exchangeImplementations(originalMethod, newMethod); // Method swizzle
        }
    }
}

//... And in the UIViewController, let's say

[textView doTrickForCatchingTaps];
[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(textViewWasTapped:) name:@"TextViewOneFinderTap" object:nil];

- (void)textViewWasTapped:(NSNotification *)noti{
    NSLog(@"%@", NSStringFromSelector:@selector(_cmd));
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-06T05:37:38.693

您需要分配 UITextView instance.delegate = self （假设您要处理同一控制器中的事件）

并确保在界面中实现 UITextViewDelegate 协议...例如：

```
@interface myController : UIViewController <UITextViewDelegate>{
} 
```

然后你可以实现以下任何一个

```
 - (BOOL)textViewShouldBeginEditing:(UITextView *)textView;
- (BOOL)textViewShouldEndEditing:(UITextView *)textView;

- (void)textViewDidBeginEditing:(UITextView *)textView;
- (void)textViewDidEndEditing:(UITextView *)textView;

- (BOOL)textView:(UITextView *)textView shouldChangeTextInRange:(NSRange)range replacementText:(NSString *)text;
- (void)textViewDidChange:(UITextView *)textView;

- (void)textViewDidChangeSelection:(UITextView *)textView; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-25T21:18:40.833

我正在使用 textview 作为更大视图的子视图。我需要用户能够滚动文本视图，但不能编辑它。我想检测对文本视图的超级视图的单击，包括文本视图本身。

当然，我遇到了 textview 吞噬了从它开始的触摸的问题。禁用用户交互将解决此问题，但随后用户将无法滚动文本视图。

我的解决方案是使 textview 可编辑并使用 textview 的 shouldBeginEditing 委托方法来检测 textview 中的点击。我只是返回 NO，从而阻止编辑，但现在我知道 textview（以及超级视图）已被点击。在这个方法和 superview 的 touchesEnded 方法之间，我有我需要的东西。

我知道这对想要获得实际触摸的人不起作用，但如果你想做的只是检测点击，这种方法有效！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-25T21:57:54.383

制作一个 UIScrollView 以及`[scrollView addSubview: textview]`它可以滚动 textview 怎么样？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-07-08T00:26:12.063

您也可以发送`Touch Down`事件。通过 Interface Builder 连接此事件。

![在此处输入图像描述](https://i.stack.imgur.com/wEBzk.png)

然后在您的事件处理程序中添加代码

```
- (IBAction)onAppIDTap:(id)sender {
    //Your code
} 
```

# c# - 练习示例测试 C# 代码

> ID：616414
> 
> 赞同：15
> 
> 时间：2009-03-05T20:08:49.513
> 
> 标签：c#, unit-testing

我已经阅读了有关单元测试的内容，并听到很多其他人吹捧它的用处的喧嚣，并希望看到它在行动中。因此，我从我创建的一个简单应用程序中选择了这个基本类。我不知道测试对我有什么帮助，我希望你们中的一个人能够通过指出可以测试这段代码的哪些部分以及这些测试可能是什么样子来帮助我看到它的好处。那么，我将如何为以下代码编写单元测试？

```
public class Hole : INotifyPropertyChanged
{
    #region Field Definitions
    private double _AbsX;
    private double _AbsY;
    private double _CanvasX { get; set; }
    private double _CanvasY { get; set; }
    private bool _Visible;
    private double _HoleDia = 20;
    private HoleTypes _HoleType;
    private int _HoleNumber;
    private double _StrokeThickness = 1;
    private Brush _StrokeColor = new SolidColorBrush(Colors.Black);
    private HolePattern _ParentPattern;
    #endregion

    public enum HoleTypes { Drilled, Tapped, CounterBored, CounterSunk };
    public Ellipse HoleEntity = new Ellipse();
    public Ellipse HoleDecorator = new Ellipse();
    public TextBlock HoleLabel = new TextBlock();

    private static DoubleCollection HiddenLinePattern = 
               new DoubleCollection(new double[] { 5, 5 });

    public int HoleNumber
    {
        get
         {
            return _HoleNumber;
         }
        set
        {
            _HoleNumber = value;
            HoleLabel.Text = value.ToString();
            NotifyPropertyChanged("HoleNumber");
        }
    }
    public double HoleLabelX { get; set; }
    public double HoleLabelY { get; set; }
    public string AbsXDisplay { get; set; }
    public string AbsYDisplay { get; set; }

    public event PropertyChangedEventHandler PropertyChanged;
    //public event MouseEventHandler MouseActivity;

    // Constructor
    public Hole()
    {
        //_HoleDia = 20.0;
        _Visible = true;
        //this.ParentPattern = WhoIsTheParent;
        HoleEntity.Tag = this;
        HoleEntity.Width = _HoleDia;
        HoleEntity.Height = _HoleDia;

        HoleDecorator.Tag = this;
        HoleDecorator.Width = 0;
        HoleDecorator.Height = 0;

        //HoleLabel.Text = x.ToString();
        HoleLabel.TextAlignment = TextAlignment.Center;
        HoleLabel.Foreground = new SolidColorBrush(Colors.White);
        HoleLabel.FontSize = 12;

        this.StrokeThickness = _StrokeThickness;
        this.StrokeColor = _StrokeColor;
        //HoleEntity.Stroke = Brushes.Black;
        //HoleDecorator.Stroke = HoleEntity.Stroke;
        //HoleDecorator.StrokeThickness = HoleEntity.StrokeThickness;
        //HiddenLinePattern=DoubleCollection(new double[]{5, 5});
    }

    public void NotifyPropertyChanged(String info)
    {
        if (PropertyChanged != null)
        {
            PropertyChanged(this, 
                       new PropertyChangedEventArgs(info));
        }
    }

    #region Properties
    public HolePattern ParentPattern
    {
        get
        {
            return _ParentPattern;
        }
        set
        {
            _ParentPattern = value;
        }
    }

    public bool Visible
    {
        get { return _Visible; }
        set
        {
            _Visible = value;
            HoleEntity.Visibility = value ? 
             Visibility.Visible : 
             Visibility.Collapsed;
            HoleDecorator.Visibility = HoleEntity.Visibility;
            SetCoordDisplayValues();
            NotifyPropertyChanged("Visible");
        }
    }

    public double AbsX
    {
        get { return _AbsX; }
        set
        {
            _AbsX = value;
            SetCoordDisplayValues();
            NotifyPropertyChanged("AbsX");
        }
    }

    public double AbsY
    {
        get { return _AbsY; }
        set
        {
            _AbsY = value;
            SetCoordDisplayValues();
            NotifyPropertyChanged("AbsY");
        }
    }

    private void SetCoordDisplayValues()
    {
        AbsXDisplay = HoleEntity.Visibility == 
        Visibility.Visible ? String.Format("{0:f4}", _AbsX) : "";
        AbsYDisplay = HoleEntity.Visibility == 
        Visibility.Visible ? String.Format("{0:f4}", _AbsY) : "";
        NotifyPropertyChanged("AbsXDisplay");
        NotifyPropertyChanged("AbsYDisplay");
    }

    public double CanvasX
    {
        get { return _CanvasX; }
        set
        {
            if (value == _CanvasX) { return; }
            _CanvasX = value;
            UpdateEntities();
            NotifyPropertyChanged("CanvasX");
        }
    }

    public double CanvasY
    {
        get { return _CanvasY; }
        set
        {
            if (value == _CanvasY) { return; }
            _CanvasY = value;
            UpdateEntities();
            NotifyPropertyChanged("CanvasY");
        }
    }

    public HoleTypes HoleType
    {
        get { return _HoleType; }
        set
        {
            if (value != _HoleType)
            {
                _HoleType = value;
                UpdateHoleType();
                NotifyPropertyChanged("HoleType");
            }
        }
    }

    public double HoleDia
    {
        get { return _HoleDia; }
        set
        {
            if (value != _HoleDia)
            {
                _HoleDia = value;
                HoleEntity.Width = value;
                HoleEntity.Height = value;
                UpdateHoleType(); 
                NotifyPropertyChanged("HoleDia");
            }
        }
    }

    public double StrokeThickness
    {
        get { return _StrokeThickness; }
        //Setting this StrokeThickness will also set Decorator
        set
        {
            _StrokeThickness = value;
            this.HoleEntity.StrokeThickness = value;
            this.HoleDecorator.StrokeThickness = value;
            NotifyPropertyChanged("StrokeThickness");
        }
    }

    public Brush StrokeColor
    {
        get { return _StrokeColor; }
        //Setting this StrokeThickness will also set Decorator
        set
        {
            _StrokeColor = value;
            this.HoleEntity.Stroke = value;
            this.HoleDecorator.Stroke = value;
            NotifyPropertyChanged("StrokeColor");
        }
    }

    #endregion

    #region Methods

    private void UpdateEntities()
    {
        //-- Update Margins for graph positioning
        HoleEntity.Margin = new Thickness
        (CanvasX - HoleDia / 2, CanvasY - HoleDia / 2, 0, 0);
        HoleDecorator.Margin = new Thickness
        (CanvasX - HoleDecorator.Width / 2, 
         CanvasY - HoleDecorator.Width / 2, 0, 0);
        HoleLabel.Margin = new Thickness
        ((CanvasX * 1.0) - HoleLabel.FontSize * .3, 
         (CanvasY * 1.0) - HoleLabel.FontSize * .6, 0, 0);
    }

    private void UpdateHoleType()
    {
        switch (this.HoleType)
        {
            case HoleTypes.Drilled: //Drilled only
                HoleDecorator.Visibility = Visibility.Collapsed;
                break;
            case HoleTypes.Tapped: // Drilled & Tapped
                HoleDecorator.Visibility = (this.Visible == true) ? 
                Visibility.Visible : Visibility.Collapsed;
                HoleDecorator.Width = HoleEntity.Width * 1.2;
                HoleDecorator.Height = HoleDecorator.Width;
                HoleDecorator.StrokeDashArray = 
                LinePatterns.HiddenLinePattern(1);
                break;
            case HoleTypes.CounterBored: // Drilled & CounterBored
                HoleDecorator.Visibility = (this.Visible == true) ? 
                Visibility.Visible : Visibility.Collapsed;
                HoleDecorator.Width = HoleEntity.Width * 1.5;
                HoleDecorator.Height = HoleDecorator.Width;
                HoleDecorator.StrokeDashArray = null;
                break;
            case HoleTypes.CounterSunk: // Drilled & CounterSunk
                HoleDecorator.Visibility = (this.Visible == true) ? 
                Visibility.Visible : Visibility.Collapsed;
                HoleDecorator.Width = HoleEntity.Width * 1.8;
                HoleDecorator.Height = HoleDecorator.Width;
                HoleDecorator.StrokeDashArray = null;
                break;
        }
        UpdateEntities();
    }

    #endregion

} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T20:20:59.873

单元测试示例：

*   验证使用正确的事件参数触发 PropertyChanged 事件。在测试中使用反射来迭代设置值并检查事件的所有属性。

通常这是使用[NUnit](http://www.nunit.com/index.php)之类的测试框架完成的。

（有点有趣，您会注意到 ParentPattern 属性不会触发事件。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T20:12:11.797

除非还给出了规范，否则您无法正确测试此代码。“测试”通常意味着确保软件按设计工作。

编辑：这真的不是一个“逃避”的答案。我以前做过测试员，我可以告诉你，我写的几乎所有测试用例都直接来自软件规范。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-05T20:57:08.587

我会告诉你测试的奥秘。

当您编写测试时，您正在编写检查其他软件的软件。它检查您的假设是否正确。你的假设只是陈述。这是一个愚蠢的简单测试，加法有效。

```
if( 1 + 1 == 2 ) {
    print "ok - 1 plus 1 equals 2\n";
}
else {
    print "not ok\n";
} 
```

那些陈述，那些断言，必须是真实的，否则就会出现错误或缺少功能。这可以更快地发现错误，在它们变成毛茸茸的系统性错误之前，在用户看到它们之前。失败指向一个必须解决的问题。理想情况下，它还可以为您提供足够的信息来诊断问题。集中测试和诊断使调试更快。

您正在编写此软件来为您完成工作。比你能做得更好。您可以手动测试软件，目测输出，但是一旦编写测试就不会消失。他们构建、构建和构建，直到有大量的人测试新功能、旧功能、新错误和旧错误。手动测试新代码以及确保没有重新引入一些旧错误的任务很快变得不堪重负。人类将简单地停止对旧错误的测试。它们将被重新引入，时间将被浪费。只需按一下按钮，测试程序就可以为您完成所有这些工作。这是一项枯燥而死记硬背的任务。人类很讨厌它们，这就是我们发明计算机的原因。通过编写软件来测试您的软件，您可以按照预期使用计算机：节省时间。

我之所以这么简单，是因为刚接触测试的人常常不知所措。他们认为有一些魔法。他们必须使用一些特殊的框架。他们甚至经常忘记测试仍然是程序，并且突然无法考虑使用循环或编写子程序。还有很多很多要学的东西，但希望这会给你一个内核，围绕它来弄清楚这个“测试”是什么。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T20:21:20.857

测试不仅仅是工程——它是一门艺术。需要你阅读的东西。我不太确定我们是否有可能通过这个单一的问题教给您您想要/需要/应该/应该/必须知道的一切。首先，您可以测试以下几项内容。

*   单元（接口按预期工作）
*   集成（组件之间的行为）
*   可用性（客户满意）
*   功能性（功能齐全）

针对每个（指标）定义一组标准并开始测试。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-05T20:45:42.107

在单元测试中，您只测试您的“可见”方法/属性，而不是私有的。

因此，例如在您的代码中，您可以添加以下测试：

```
hole.Visible = false;

Debug.Assert( "".Equals( hole.AbsXDisplay ) );
Debug.Assert( "".Equals( hole.AbsYDisplay ) ); 
```

您可能会认为“这**很明显**！” 但几周后，您可能会忘记它。如果您的代码的某些部分取决于*AbsXDisplay*的值（这是一个公共属性）并且由于某种原因在您将属性设置为 false 后，它不再是“”而是“空”或“NotSet”，那么这个测试将失败，您将立即收到通知。

您应该为每个具有某些业务规则或影响类的其他部分的公共方法或属性执行此操作。

有些人发现首先测试更容易（并使测试失败）然后编写代码以满足测试，这样你就只编写你测试的代码，你只测试你关心的东西（搜索 TDD）

这只是一个简单的例子，说明你可以做些什么来测试你的代码。

我希望它可以帮助您更好地了解测试的全部内容。

正如其他人所建议的那样，寻找一个测试框架。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-05T20:39:59.907

顺便说一句，如果课程以不同的方式编写，似乎大多数课程都不需要测试（除了[Gord 的答案）。](https://stackoverflow.com/questions/616414/teach-me-how-to-test/616459#616459)例如，您将模型信息（孔型等）与视图信息（厚度）混合在一起。另外，我认为您缺少 WPF 和数据绑定/触发器的要点。UpdateHoleType() 应该在 .xaml 文件中表示为一组 DataTrigger，与 UpdateEntities() 相同，以及您拥有的大多数其他属性。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-05T20:56:25.780

这是一个例子。请记住，您的示例代码缺少许多依赖项的定义：

```
[TestFixture()]
public class TestHole 
{

    private Hole _unitUnderTest;

    [SetUp()]
    public void SetUp() 
    {
        _unitUnderTest = new Hole();
    }

    [TearDown()]
    public void TearDown() 
    {
        _unitUnderTest = null;
    }

    [Test]
    public void TestConstructorHole()
    {
        Hole testHole = new Hole();
        Assert.IsNotNull(testHole, "Constructor of type, Hole failed to create instance.");
    }

    [Test]
    public void TestNotifyPropertyChanged()
    {
        string info = null;
        _unitUnderTest.NotifyPropertyChanged(info);
    }
} 
```

您可以看到它正在测试构造函数是否正在生成一个有效对象（通常不需要完整的测试夹具，构造通常得到很好的锻炼）并且它还在测试类中唯一的公共方法。在这种情况下，您需要一个事件处理程序委托和一个 Assert 来检查 info 参数的内容。

目标是编写测试来练习您班级的每种方法。通常这包括上限和下限以及故障条件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-05T21:06:37.020

通过测试，我假设您的意思是测试驱动设计。测试驱动设计主要关注单元测试，有时也关注集成测试。单元测试测试最小的代码可测试代码元素，集成测试测试组件与应用程序之间的交互。

还有更多形式的测试，但这些是开发人员通常自己做的。其他测试主要从外部查看应用程序，并测试针对正确性、性能和可扩展性等各种质量公开的用户界面。

单元测试涉及测试您的方法以查看它们是否按照您的意愿进行。这些通常测试如此简单，您几乎会认为它们微不足道。你要测试的是你的类的逻辑。您提供的课程实际上并没有那么多逻辑。

只有`private void UpdateHoleType(){...}`包含任何逻辑，它似乎是面向视觉的逻辑，总是最难测试的。编写测试非常简单。下面是钻孔类型的示例。

```
[Test]
public void testDrilledHole()
{
  Hole hole = new Hole();
  hole.HoleType = HoleTypes.Drilled;
  Assert.AreEqual(Visibility.Collapsed, hole.HoleDecorator.Visibility);
} 
```

如果你看它，你几乎不会认为它值得。测试是微不足道的和显而易见的。该`[Test]`属性将方法声明为测试，`Assert.AreEquals()`如果提供的值不相等，该方法将引发异常。实际构造可能会因使用的测试框架而异，但它们都同样简单。

这里的诀窍是您为类中执行业务逻辑的所有方法编写这些方法并测试许多值。`null`总是值得尝试。

单元测试的力量在于所有这些测试的结合。现在，如果您更改课堂上的某些内容，则会有许多测试检查您所做的更改是否会破坏您在测试中定义的行为之一。这使您可以处理更大的项目，更改和实施新功能，同时测试保留您已经编码的功能。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-05T22:02:35.933

如果您需要进行更改，测试会有所帮助。

根据 Feathers (Feathers, [Working Effectively with Legacy Code](https://rads.stackoverflow.com/amzn/click/com/0131177052) , p. 3)，有四个改变的原因：

*   添加功能
*   修复错误
*   改进设计
*   优化资源使用

当需要改变时，你要确信自己不会破坏任何东西。更准确地说：您不想破坏任何行为（Hunt，Thomas，[Pragmatic Unit Testing in C# with NUnit](https://rads.stackoverflow.com/amzn/click/com/0977616673)，第 31 页）。

有了单元测试，您可以更有信心地进行更改，因为它们会（如果它们被正确编程）捕获行为的变化。这就是单元测试的好处。

对您作为示例给出的类进行单元测试会很困难，*因为单元测试还需要被测代码的某种结构*。我看到的一个原因是班级做得太多了。您将在该课程上应用的任何单元测试都将非常脆弱。微小的更改可能会使您的单元测试崩溃，最终您将浪费大量时间来修复测试代码而不是生产代码中的问题。

要获得单元测试的好处，需要更改生产代码。仅仅应用单元测试原则，而不考虑这一点不会给你积极的单元测试经验。

如何获得积极的单元测试体验？**对此保持开放的态度并学习。**

我建议您在现有代码基础上[有效地使用旧代码](https://rads.stackoverflow.com/amzn/click/com/0131177052)（如您上面提供的那段代码）。为了轻松开始单元测试，请尝试[使用 NUnit 在 C# 中进行实用单元测试](https://rads.stackoverflow.com/amzn/click/com/0977616673)。真正让我大开眼界的是[xUnit 测试模式：重构测试代码](https://rads.stackoverflow.com/amzn/click/com/0131495054)。

祝你旅途愉快！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-05T20:12:47.210

一个例子，

为了

公共孔型孔型

测试/检查集合中的空值

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-05T20:58:35.197

> 我们必须测试它，对吗？

测试是验证代码是否按预期工作。现在为这个类编写测试不会给你带来任何真正的好处（除非你在编写测试时发现了一个错误）。真正的好处是您必须返回并修改此类。您可能会在应用程序的多个不同位置使用此类。如果没有测试，对类的更改可能会产生无法预料的影响。通过测试，您可以更改课程并确信如果您的所有测试都通过了，您不会破坏其他东西。当然，测试需要编写良好并涵盖类的所有功能。

> 那么，如何测试呢？

在课堂级别，您将需要编写单元测试。有几个单元测试框架。我更喜欢[NUnit](http://www.nunit.org/)。

> 我在测试什么？

您正在测试一切的行为是否符合您的预期。如果你给出一个方法 X，那么你期望 Y 被返回。在[Gord 的](https://stackoverflow.com/users/12560/gord)回答中，他建议测试您的事件是否真正触发。这将是一个很好的测试。

[Bob 大叔所著的 C# 中的敏捷原则、模式和实践](https://rads.stackoverflow.com/amzn/click/com/0131857258)一书确实帮助我理解了测试的内容和方法。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-05T22:25:42.023

在通知事件触发方面，您当然应该确保您的课程是否按照规范工作，即：

*   无论设置的值如何，父级都不会触发
*   StrokeColour 和 StrokeThickness 总是触发事件，即使设置了相同的值
*   CanvasX/Y、HoleType/Dia 仅在设置与前一个不同的值时触发

Then you want to check a couple of side effects that setting your properties cause. After that you could think about refactoring the thing because, *dang, this ain't a pretty class!*

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-03-05T20:46:24.540

好吧，故事从理论开始。

这就是我所做的。

首先，如果您使用 OO 语言编程，请学习设计模式。如果您组建一个学习小组并与一些朋友和同事一起学习，这是最简单的。

花几个月的时间来轻松消化所有的模式。

然后，转向重构技术，您将学习如何将任何代码转换为将使用先前学习的块的代码，例如设计模式。

经过这些准备后，测试将与任何其他编程技术一样简单。

# python - 是否可以从此函数中删除递归？

> ID：616416
> 
> 赞同：4
> 
> 时间：2009-03-05T20:09:17.047
> 
> 标签：python, recursion

我一直在玩这个，只是看不到明显的解决方案。我想从 XinY_Go 函数中删除递归。

```
def XinY_Go(x,y,index,slots):
   if (y - index) == 1:
      slots[index] = x
      print slots
      slots[index] = 0
      return
   for i in range(x+1):
      slots[index] = x-i
      XinY_Go(x-(x-i), y, index + 1, slots)

def XinY(x,y):
   return XinY_Go(x,y,0,[0] * y) 
```

该函数正在计算将 X 弹珠放入 Y 槽的方法数。这是一些示例输出：

```
>>> xy.XinY(1,2)
 [1, 0]
 [0, 1]
 >>> xy.XinY(2,3)
 [2, 0, 0]
 [1, 1, 0]
 [1, 0, 1]
 [0, 2, 0]
 [0, 1, 1]
 [0, 0, 2]

```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-05T20:12:19.473

我们认为递归的一切也可以认为是基于堆栈的问题，其中递归函数只是使用程序的调用堆栈，而不是创建单独的堆栈。这意味着任何递归函数都可以改用堆栈重写。

我不太了解python，无法为您提供实现，但这应该为您指明正确的方向。但简而言之，将函数的初始参数压入堆栈并添加一个循环，只要堆栈的大小大于零，该循环就会运行。每次循环迭代弹出一次，每次函数当前调用自身时推送。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-05T21:19:22.993

[@Joel Coehoorn 的建议](https://stackoverflow.com/questions/616416/is-it-possible-to-remove-recursion-from-this-function/616432#616432)的幼稚实现如下：

```
def XinY_Stack(x, y):
    stack = [(x, 0, [0]*y)]
    while stack:
        x, index, slots = stack.pop()
        if (y - index) == 1:
            slots[index] = x
            print slots
            slots[index] = 0
        else:
            for i in range(x + 1):
                slots[index] = x-i
                stack.append((i, index + 1, slots[:])) 
```

例子：

```
>>> XinY_Stack(2, 3)
[0, 0, 2]
[0, 1, 1]
[0, 2, 0]
[1, 0, 1]
[1, 1, 0]
[2, 0, 0] 
```

### 基于[`itertools.product`](http://docs.python.org/library/itertools.html#itertools.product)

```
def XinY_Product(nmarbles, nslots):
    return (slots
            for slots in product(xrange(nmarbles + 1), repeat=nslots)
            if sum(slots) == nmarbles) 
```

### 基于嵌套循环

```
def XinY_Iter(nmarbles, nslots):
    assert 0 < nslots < 22 # 22 -> too many statically nested blocks
    if nslots == 1: return iter([nmarbles])
    # generate code for iter solution
    TAB = "  "
    loopvars   = []
    stmt       = ["def f(n):\n"]
    for i in range(nslots - 1):
        var = "m%d" % i
        stmt += [TAB * (i + 1), "for %s in xrange(n - (%s)):\n"
                 % (var, '+'.join(loopvars) or 0)]
        loopvars.append(var)

    stmt += [TAB * (i + 2), "yield ", ','.join(loopvars),
             ', n - 1 - (', '+'.join(loopvars), ')\n']
    print ''.join(stmt)
    # exec the code within empty namespace
    ns = {}
    exec(''.join(stmt), ns, ns)
    return ns['f'](nmarbles + 1) 
```

例子：

```
>>> list(XinY_Product(2, 3))
[(0, 0, 2), (0, 1, 1), (0, 2, 0), (1, 0, 1), (1, 1, 0), (2, 0, 0)]
>>> list(XinY_Iter(2, 3))
def f(n):
  for m0 in xrange(n - (0)):
    for m1 in xrange(n - (m0)):
      yield m0,m1, n - 1 - (m0+m1)

[(0, 0, 2), (0, 1, 1), (0, 2, 0), (1, 0, 1), (1, 1, 0), (2, 0, 0)] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T20:20:19.440

看看这个创建所有排列的代码，我想我会相对简单地为你的问题实现类似的东西。

[如何在python中生成列表的所有排列？](https://stackoverflow.com/questions/104420/how-to-generate-all-permutations-of-a-list-in-python)

# delphi - 如何在 Delphi 2007 上显示透明的 PNG？

> ID：616417
> 
> 赞同：4
> 
> 时间：2009-03-05T20:09:17.233
> 
> 标签：delphi, png, delphi-2007, timage

TImage 控件不支持 PNG。是否有一些第三方组件会？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-05T20:46:56.800

尝试[PngComponents](http://www.thany.org/download/14/pngcomponentssetup.zip) - 只要它们可用...

D2009 版本可以在[这里找到](http://cc.embarcadero.com/Item/26127)

**在谷歌代码上编辑**
旧版本的 Delphi 的以下链接：
[http ://code.google.com/p/cubicexplorer/downloads/detail?name=PngComponents.zip&can=2&q=](http://code.google.com/p/cubicexplorer/downloads/detail?name=PngComponents.zip&can=2&q=)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T20:19:11.657

试试[Delphi PNG 和 MNG 库](http://delphi.pjh2.de/articles/graphic/png.php/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-06T09:02:04.023

[GraphicEx](http://www.soft-gems.net/index.php?option=com_content&task=view&id=13&Itemid=33)将为您提供对 png 和许多其他格式的支持。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T09:02:06.050

我已经成功地将 TPaintBox 组件与支持 PNG 的 DevExpress TcxImageList 一起使用，然后使用列表的工具在 OnPaint 中绘制图像。工作得很好。DevEx 也有一个 TcxImage，但我没有尝试过。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-25T07:40:27.303

DevEx TCXImage 组件直接支持 PNG。

```
CXImage1.Picture.LoadFromFile(myimage.png) 
```

# encryption - 数据加密是否属于存储库模式？

> ID：616421
> 
> 赞同：2
> 
> 时间：2009-03-05T20:09:58.980
> 
> 标签：encryption, repository-pattern

我正在使用应用程序级加密来保护敏感数据。我需要在将字段存储到物理数据库之前对其进行加密，并且在将其显示在用户界面上之前我需要对其进行解密。

我在应用程序中应用存储库模式。

数据加解密代码是属于 Repository 类内部还是外部？

我目前的想法是，当数据处于静止状态时，加密是存储库的一个方面，使用存储库的服务类不应与此加密代码混淆。

服务类负责验证和业务逻辑，但加密算法和静态数据存储方式取决于存储库实现。

这是一种合理的做法还是我错过了什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T20:26:50.203

您当然不希望在服务类中进行加密。

在某种意义上，当你说时，你实际上是在回答你自己的问题

> 但是加密算法和静态数据的存储方式取决于存储库的实现。

由于加密是数据存储方式的一部分，因此它属于存储库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T01:16:35.013

我会把它放在服务层。原因如下：

从业务规则/领域需求的角度来看，加密数据是一种需求吗？是否应该通过测试进行验证？如果是这样，你应该把它放在你放置所有其他可测试业务逻辑的地方。换句话说，在服务中。

就我而言，业务逻辑（加密什么，不加密什么）不属于存储库。当要持久化的对象被提供给存储库时，它们应该准备好持久化（或尽可能接近）。否则，存储库负责持久化*和*实现业务规则，然后您就不再真正使用存储库模式了......

# .net - .Net - 检测所需的标识符是否是关键字

> ID：616425
> 
> 赞同：2
> 
> 时间：2009-03-05T20:10:54.033
> 
> 标签：.net, code-generation

.net 中有没有办法检测一个单词是否是给定 .net 语言中的关键字？

我正在为这个项目使用一个相当简单的代码生成器，我想开始自动化它。现在我每一个都是手工完成的，所以解决出现的任何问题都很容易。但是，一旦这种情况开始自动发生，我将需要一种方法来检测我需要用作标识符的单词是否是关键字。我仍然可以使用它，我只需要正确引用它。

我知道我可以简单地引用我生成的*所有内容*，但我想保持生成的代码漂亮:)

我需要引用的例子：

```
vb:  Public [Class] As String = "CLASS"
c#:  public String @class = "CLASS"; 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T20:32:28.847

也许你正在寻找[`IsValidIdentifier`](http://msdn.microsoft.com/en-us/library/system.codedom.compiler.codedomprovider.isvalididentifier.aspx)

> [ `IsValidIdentifier`] 仅当值符合语言规则并且**不与关键字冲突**时才返回 [s] 真。

或者[`CreateEscapedIdentifier`](http://msdn.microsoft.com/en-us/library/system.codedom.compiler.codedomprovider.createescapedidentifier.aspx)

> `CreateEscapedIdentifier`测试**标识符是否与任何保留或语言关键字冲突**，如果是，则返回具有特定语言转义码格式的等效名称

例如：

```
 CSharpCodeProvider csProvider = new CSharpCodeProvider();

    bool isValid1 = csProvider.IsValidIdentifier("class");
    // returns false

    string escapedId1 = csProvider.CreateEscapedIdentifier("foo");
    // escapedId1 = "foo"
    string escapedId2 = csProvider.CreateEscapedIdentifier("do");
    // escapedId2 = "@do"
    string escapedId3 = csProvider.CreateEscapedIdentifier("AndAlso");
    // escapedId3 = "AndAlso" (not reserved in c#)

    VBCodeProvider vbProvider = new VBCodeProvider();

    string escapedId4 = vbProvider.CreateEscapedIdentifier("AndAlso");
    // escapedId4  = "[AndAlso]" (reserved in VB) 
```

似乎扩展/使用这个设施来满足您的需求并不难。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T20:25:17.710

[见这里](http://bytes.com/groups/net-c/730472-c-keyword-list-programatically)。伙计，Jon Skeet 无处不在！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T20:33:42.277

[CodeDOM](http://msdn.microsoft.com/en-us/library/y2k85ax6.aspx)不是已经解决了这个问题吗？您可以通过这种方式构建生成的代码，并自动获得对任何支持 CodeDOM 的语言的支持。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T20:15:43.537

我不相信有任何自然的方式可以以编程方式执行此操作，但您可以在[此处](http://msdn.microsoft.com/en-us/library/x53a06bb(vs.71).aspx)获得 C#和 VB.Net[的](http://msdn.microsoft.com/en-us/library/ksh7h19t(VS.71).aspx)完整关键字列表。

# xml - XSLT：如何在“匹配”属性中表示 OR？

> ID：616427
> 
> 赞同：29
> 
> 时间：2009-03-05T20:10:58.557
> 
> 标签：xml, xslt

我想对匹配名称“A”或“B”的元素执行一系列操作。我在想下面这样的事情，但它不起作用。

```
<xsl:template match= " 'A' or 'B'" >
     <!-- whatever I want to do here -->
</xsl:template> 
```

找不到合适的 XSLT 语言参考。请帮忙！谢谢！！

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-03-05T20:17:16.387

试试这个：

```
<xsl:template match= "A | B" > 
```

[有关详细信息，请参阅此页面。](http://msdn.microsoft.com/en-us/library/ms256074(VS.85).aspx)

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-03-05T21:14:45.157

通常`A | B`是这样做的正确方法。但管道字符基本上是两个完整 XPath 表达式的联合。在这样的情况下使用它可能会很烦人：

```
/red/yellow/blue/green/gold | red/orange/blue/green/gold 
```

因为你在重复整个表达式，除了一小部分是变化的。

`name()`在这种情况下，使用谓词和函数通常是有意义的：

```
/red/*[name() = 'yellow' or name()='orange']/blue/green/gold 
```

这种技术使您可以访问更广泛的逻辑操作。它也（可以想象）更快，因为 XPath 导航器只需要遍历它正在测试的节点一次。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-03-06T09:32:54.307

我认为使用这个 XPath 更方便

```
/red/(yellow | orange)/blue/green/gold 
```

而不是

```
/red/*[name() = 'yellow' or name()='orange']/blue/green/gold 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-06T03:44:48.183

> `<xsl:template match= " 'A' or 'B'" >`

**这种匹配模式存在一些问题**：

1.  模板匹配**节点**，而不是字符串。因此，要匹配的元素的名称不应指定为带引号的字符串。

2.  **[XPath 运算符“或”](http://www.w3.org/TR/xpath#NT-OrExpr)**作用于两个布尔值，而不是节点。这里需要的是[**另一个 XPath 操作符——*联合*操作符“|”**](http://www.w3.org/TR/xpath#node-sets) .

考虑到上述情况，可以正确地将模板规则指定为：

```
<xsl:template match= "A | B" >
     <!-- whatever I want to do here -->
</xsl:template> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T20:36:20.867

以下信息来自： http: [//www.cafeconleche.org/books/bible2/chapters/ch17.html#d1e2090](http://www.cafeconleche.org/books/bible2/chapters/ch17.html#d1e2090)

我将解释一下，请搜索文本“使用或运算符|” 在那个文件中。

语法是：

```
<xsl:template match="A|B">
   <!-- Do your stuff> -->
</xsl:template> 
```

# reporting-services - Reporting Services 矩阵中计算字段的小计错误

> ID：616428
> 
> 赞同：0
> 
> 时间：2009-03-05T20:11:12.470
> 
> 标签：reporting-services, reportingservices-2005

我有一个 Reporting Services 报表，它有两个行组：Category 和 SubCategory。对于列，它有 LastYearDataA、ThisYearDataA、LastYearDataB、ThisYearDataB。

我添加了两列（一列用于 A，一列用于 B）来处理表达式计算（以显示从 LastYear 到 ThisYear 每个的百分比）。那行得通。问题出现在每个类别的小计中。原始数字总计正确。如果 SubCat1 的 LastYear/ThisYear A 有 10//5，而 SubCat2 有 5//1，那么我得到的总数是 15/5。但我在总列中报告的百分比为“50%”，与 SubCat1 匹配。每个子类别的百分比计算正确（无论如何，根据我的备份数学）。但小计 % 始终与组中的第一个 SubCategory 匹配。这在 Reporting Services 2005 中是不可能的吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-10T13:36:38.617

好吧，我从来没有深究这一点。我将存储过程更改为返回类别总数和总计以及所有数据。这会再次出现，所以我会继续寻找，也许我会通过更多的搜索来发现原因。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-12T02:58:01.423

解决方案是更改矩阵中详细信息字段的值。所以你在哪里：

```
=Fields!FieldName.Value 
```

将其更改为：

```
=Sum(Fields!FieldName.Value) 
```

当它在正常的行或列中显示一个值时，我猜它只是对一个值求和，所以它不会改变它，但是当它在一个小计列中时，它会像你想要的那样对它们求和。我知道违反直觉。我也必须搜索才能弄清楚。

# thread-safety - PRNG 需要是线程安全的吗？

> ID：616434
> 
> 赞同：4
> 
> 时间：2009-03-05T20:13:25.307
> 
> 标签：thread-safety, random, prng

只要并发调用不会导致 seg-v 或返回相同的值，当这些错误的主要影响是不可预测的结果并且这就是 PRNG 的重点时，有什么理由可以防止[PRNG中的竞争条件和数据损坏？](http://en.wikipedia.org/wiki/Pseudorandom_number_generator)

* * *

*编辑：*是否有任何 PRNG 在竞争条件和数据损坏下​​不会受到影响？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T21:42:24.827

> 当这些错误的主要影响是不可预测的结果时，这就是 PRNG 的重点？

“随机”与不可预测不同 - 随机意味着某种分布，如果您想要真正的随机数，则该分布非常重要。如果您的随机数以任何方式可预测，则可能是安全问题，或者至少是程序错误

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T21:32:10.263

PRNG 是精心构建的工具——坦率地说，如果竞争条件和线程错误是一个好的 PRNG，那么实现就会这样编写。

添加线程错误以增加随机性的问题在于它是对生成器的*未经*研究的更改。现有的安全算法和实现已经过详尽的测试；如果你想尝试一个不安全的变体，你需要做统计工作来证明它至少和普通 PRNG 一样随机。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-11-27T00:18:23.970

它通常会使它们的确定性降低（如果您依赖于它们的确定性，这是很糟糕的，很多人都会这样做），并且可能会或可能不会使它们的伪随机性降低，这取决于它们的特定实现细节和硬件行为的微妙之处。

但通常编写多线程应用程序的人会在 TLS（线程本地存储）中声明他们的 PRNG 状态。这样就没有关系，每个线程都有自己的 PRNG，除非你故意创建它们，否则不会发生比赛。反正不在 PRNG 代码中。这是无锁且或多或少的完整性能（取决于使用的 TLS 实现）。

# python - tcsh 中的 Python

> ID：616440
> 
> 赞同：7
> 
> 时间：2009-03-05T20:16:30.400
> 
> 标签：python, tcsh

我对tcsh没有太多经验，但我有兴趣学习。我在让 Python 看到 PYTHONPATH 时遇到问题。我可以回显 $PYTHONPATH，这是正确的，但是当我启动 Python 时，我的路径不会显示在 sys.path 中。有任何想法吗？

编辑：

```
[dmcdonal@tg-steele ~]$ echo $PYTHONPATH
/home/ba01/u116/dmcdonal/PyCogent-v1.1

>>> from sys import path
>>> from os import environ
>>> path
['', '/apps/steele/Python-2.5.2/lib/python2.5/site-packages/setuptools-0.6c8-py2.5.egg', '/apps/steele/Python-2.5.2/lib/python2.5/site-packages/FiPy-2.0-py2.5.egg', '/apps/steele/Python-2.5.2', '/apps/steele/Python-2.5.2/lib/python25.zip', '/apps/steele/Python-2.5.2/lib/python2.5', '/apps/steele/Python-2.5.2/lib/python2.5/plat-linux2', '/apps/steele/Python-2.5.2/lib/python2.5/lib-tk', '/apps/steele/Python-2.5.2/lib/python2.5/lib-dynload', '/apps/steele/Python-2.5.2/lib/python2.5/site-packages', '/apps/steele/Python-2.5.2/lib/python2.5/site-packages/Numeric']
>>> environ['PYTHONPATH']
'/apps/steele/Python-2.5.2' 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-05T20:54:26.940

你是如何设置 PYTHONPATH 的？您可能会混淆 tcsh 的 set 与 setenv。使用“set”设置 tcsh 调用的*shell 变量*，使用“setenv”设置*环境变量*。因此，您需要使用 setenv 才能让 Python 看到它。例如：

```
$ set FOO='bar'
$ echo $FOO
bar
$ python -c 'import os; print os.getenv("FOO")'
None

$ setenv BAR 'wiz'
$ echo $BAR
wiz
$ python -c 'import os; print os.getenv("BAR")'
wiz 
```

[tcsh 文档的变量部分](http://wings.buffalo.edu/computing/Documentation/unix/tcsh.html)提供了更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T20:26:27.270

确保您没有使用该`-E`选项启动 python（即：忽略环境变量）。如果您通过 shell 脚本或其他应用程序启动 python，只需仔细检查它不会添加任何内容。

由于 sys.path 的列表很长，因此很难错过您的路径。PYTHONPATH 的东西通常被添加到列表的中间，在所有库路径之后。有没有可能你的路径在那里，只是埋在中间？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T20:43:58.930

查看：

1.  PYTHONPATH 在 os.environ 中，
2.  并设置为以冒号分隔的路径列表的正确值。

如果是，并且您可以确认您的路径不在 sys.path 中，那么您发现了一个错误。

如果它不在 os.environ 中，则您的环境没有传递给 Python（可能是另一个错误）。

当然，向我们展示实际的代码/导出，很快就会有人告诉你。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-20T07:45:11.953

我也有同样的问题，即使我在使用 Python时`PYTHONPATH`正确设置了环境，当我切换到 Python 时，它工作正常。看起来这是一个python错误。`.cshrc``2.5.1``2.6.2`

# c# - 强制执行必须在 *不同* 字段中的每个子类中实现的属性的最佳方法是什么？

> ID：616447
> 
> 赞同：3
> 
> 时间：2009-03-05T20:17:22.410
> 
> 标签：c#, .net, oop, ssds

我正在尝试提出实现[SQL 数据服务灵活实体模型](http://msdn.microsoft.com/en-us/library/cc512402.aspx)的“最佳”方法，其中每个类都可以存储为实体，甚至是派生类。

示例：每个子类都有*不同的*

```
string Id
string Kind
Dictionary<string, object> Properties 
```

到目前为止，我正朝着同时拥有实体类（如上）和具有某种集合的基类的方向前进，例如

```
Dictionary<string, Entity> data 
```

并让每个子类添加到该字典中，然后获取/设置属性，例如

```
data["EntityKind"].Properties["PropertyName"] 
```

但是，由于每个类只有一个实体，所以似乎我应该使用某种堆栈（而不是字典），其中层次结构的每一级都知道它在哪里。然后我想到类继承就是堆栈，所以我想也许我只是错过了一些可以真正简化所有这些的巨大的 OO 概念。就像是

```
abstract eachsubclassmusthaveitsown Entity entity 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T20:24:59.020

每个类都是一个实体，你想关联一些实体元数据吗？

听起来[属性](http://msdn.microsoft.com/en-us/library/aa287992(VS.71).aspx)可能是你最好的选择。

您将定义一个类`EntityAttribute`，其中包含用于存储描述实体所需的元数据的成员。这将允许您使用 [Entity] 标记实体类。如果所有字段都是必需的，则为属性类提供一个要求传递值的构造函数。

然后使用反射来发现实体类。请注意，您只需要执行一次该发现过程然后将其缓存，因此反射的性能应该不是问题。

# asp.net - 场景中的身份验证选项，其中 silverlight 应用程序正在调用自托管的 wcf 服务

> ID：616454
> 
> 赞同：2
> 
> 时间：2009-03-05T20:19:57.647
> 
> 标签：asp.net, wcf, silverlight, authentication

我们的系统由一个自托管（非 IIS）WCF 服务和一个托管 Silverlight 应用程序的 Asp.net 网站组成。该应用程序应该做几乎所有事情，在这种情况下，网站只是一个“外壳”。

我们很难弄清楚如何安全地解决用户身份验证问题。

据我所知，Silverlight 无法处理 Windows 身份验证，没有任何类型的凭据对象。我们能想到的最好的方法是在用户请求托管应用程序的页面时对用户进行身份验证。然后我们可以将用户名传递给应用程序的 init 参数。

这样我们就有了一个可以发送到 wcf 服务的用户名，并且可以作为处理角色的基础。问题是，任何人都可以在没有 silverlight 客户端的情况下调用我们的服务，并传入用户名。此外，在 WCF 服务和 Silverlight 应用程序之间发送未加密的敏感数据也是一个坏主意。所以，我的问题是：

**在这种情况下如何安全地对客户端进行身份验证？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-27T11:13:37.347

有人用 Silverlight 3 试过这个吗？我有类似的情况，想使用消息头实现身份验证（我肯定不想使用 ASP.Net cookie），但这里给出的解决方案似乎已经过时（不能使用 SL3 正确编译）。我即将尝试查找并修复错误，只是希望有人可能有一个固定的例子，或者可能是一个更好的解决方案？

在我看来，每当有人询问使用 SL 和 WCF 进行身份验证时，标准解决方案是网站中内置的 RIA 服务和 ASP.Net Forms Auth，我希望得到一个更好的答案:-)

# iphone - 关于不使用 Interface Builder 进行 iPhone GUI 设计的教程？

> ID：616456
> 
> 赞同：9
> 
> 时间：2009-03-05T20:20:24.227
> 
> 标签：iphone, user-interface, interface-builder

有谁知道只使用代码而不是 Interface Builder 的 iPhone GUI 设计的好教程？

我是 iPhone 开发的新手，我想更好地了解幕后发生的事情。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-05T20:24:52.733

查看 SDK 中的 UI 目录示例。

它展示了以多种方式使用的所有单个控件。所有的屏幕、视图控制器和导航栏都是由代码生成的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T20:29:39.120

我发现 Erica Sadun 的*The iPhone Developer's Cookbook*非常有价值。本书假设您已经熟悉了 Objective-C，并且她的示例简短但重点突出。她的大多数示例都以编程方式构建了 GUI，我发现这对理解 IB 为您做什么非常有帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T21:34:41.820

[Bill Dudney 有几篇关于“揭秘 iPhone 应用程序启动”](http://bill.dudney.net/roller/objc/entry/demystifying_iphone_app_startup)和[“揭开视图控制器和视图](http://bill.dudney.net/roller/objc/entry/demystifying_view_controllers_and_views)的神秘面纱”的博文，它们很好地介绍了幕后发生的一些事情，UI 方面。虽然不是关于以编程方式生成视图，但这些帖子可以帮助您了解 Interface Builder 为您做了什么。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-06T00:19:03.390

Jonathan Zdziarski 的 iPhone SDK 在前两章之后就放弃了设计师。本书的其余部分包含使用代码创建 UI 元素的示例。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-06T00:37:13.020

如果您想了解，请查看 Jonathan Zdziarski 的 Open iPhone Development book（不是他较新的 SDK book）。当他在演示如何使用开放的 iphone 工具链进行开发时，这自然意味着不涉及 IB，并且您对如何以编程方式执行通常使用 IB 执行的操作有了更深入的了解。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-06T13:57:55.700

只是一个警告：最好以“Apple 方式”做事，因为这将使 Apple 的工程师更容易梳理您的代码并批准它进入 App Store。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-11-03T04:42:09.443

请记住，IB 可以加快您的开发速度，并防止您将尺寸和坐标硬编码到您的应用程序中。当需要本地化您的应用程序时，它也是一个有用的工具。

如果您是初学者，您应该熟悉更多有趣的 SDK，而不是试图弄清楚 UIButton 如何绘制框架并设置其字体。当您掌握了 OBJ-C 并开发了一些应用程序后，您总是可以更深入地研究每个 IB 辅助框架。

IB 存在是有原因的，就像 Xcode 存在是有原因的一样，我们并不是都在输入“make myApp -flags xyz -opts ab c...”，甚至直接调用 gcc。从命令行手动构建项目可以学到很多东西，但实际上，它应该仅次于实际开发应用程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-11-03T04:46:57.843

PeachPit 的新 iPhone SDK 3 可视化快速入门指南书专门使用所有示例的代码 - 没有 IB。

[http://mark.aufflick.com/bookshelf#0321669533](http://mark.aufflick.com/bookshelf#0321669533)

免责声明：那本书的作者参加了我组织的悉尼 CocoaHeads :)

# excel - 如何在 C# 程序中嵌入 Excel 电子表格

> ID：616462
> 
> 赞同：0
> 
> 时间：2009-03-05T20:21:45.050
> 
> 标签：excel, embed

我一直在尝试使用 ActiveX 控件 axOWC10.axSpreadsheet 但我不知道如何指定 DataSource 和 DataMember 属性。我不应该使用这个特定的 ActiveX 控件吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-08T18:11:05.247

[SpreadsheetGear for .NET](http://www.spreadsheetgear.com/)将允许您在 C# 程序中嵌入 Excel 工作簿。[您可以在此处](https://www.spreadsheetgear.com/downloads/register.aspx)下载免费评估。

免责声明：我拥有 SpreadsheetGear LLC

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T20:27:11.293

[这个教程怎么](http://www.codeproject.com/KB/office/csharp_excel.aspx)样？

编辑：对不起，我认为这会在单独的窗口中打开 Excel。这不是你想要的，对吧？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-04-27T10:25:07.703

您需要将 XML 文件分配为数据源，例如

```
spreadSheet.XMLURL = _filePath; 
```

# c# - 组件服务和 C#

> ID：616464
> 
> 赞同：0
> 
> 时间：2009-03-05T20:22:18.450
> 
> 标签：c#, com+, component-services

我有一个包装在 COM+（组件服务）中的 VB6 COM dll。对于我的一生，我无法弄清楚如何获取对在 C# 中导入/工作的服务的引用。谷歌根本没有帮助我。添加引用对话框中没有显示任何内容，甚至与我的服务名称相近。有没有人有任何代码/提示如何做到这一点？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T20:26:18.113

如果您已经注册了应该显示在 COM 选项卡中的 dll，您也可以尝试直接浏览到 dll 或 tlb，然后以这种方式添加引用。

# 编辑

不，它不会，它会被重定向到服务。就像您在 vb 中使用 CreateObject("MyCom.MyClass") 创建对象一样，SCM（我希望自从我处理 COM+ 以来它被称为很长时间）将激活 COM+ 服务中的组件，如果它服务应用程序或在您的进程中（如果它是库）。

# django - 如何更快地运行 django 单元测试（通过 manage.py）

> ID：616474
> 
> 赞同：9
> 
> 时间：2009-03-05T20:26:03.263
> 
> 标签：django, unit-testing, testing

当我为我的 django 应用程序开发单元测试时，我发现自己一遍又一遍地运行 manage.py 测试。我正在使用 MySQL 后端并且项目中有许多模型，因此创建所有测试数据库的加速时间约为 30 秒。

如何通过保持创建的数据库表并在运行“manage.py test”命令之间清除所有记录来使每个单元测试更快？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-06T20:26:40.570

请注意，您不必每次都运行整个测试套件。您可以通过运行`manage.py test appname`（或使用 一次为多个应用程序`manage.py test app1 app2 ...`）运行单个应用程序的测试套件。

我通常的工作流程是在我工作时为我正在开发的应用程序运行测试，并在我提交下一组更改之前运行整个套件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T20:39:06.150

我还没有尝试过，但是最近有一个签入应该有助于通过允许测试在事务中运行然后回滚：

[文档](http://docs.djangoproject.com/en/dev/topics/testing/#testcase)和[开发人员评论](http://groups.google.com/group/django-developers/browse_thread/thread/b1ed118916d17a7f/6098c0e3cc901148?lnk=gst&q=test+transaction#6098c0e3cc901148)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-01-25T13:32:37.447

我为我的 MySQL 数据库使用 ram-disk，fast 甚至没有描述它，结合仅在您正在开发的特定应用程序中测试特定测试可以显着缩短测试时间。有一些脚本可以自动为您的数据库创建 ramdisk，我使用我的一位同事制作的[mysql-ramdisk.py](https://github.com/mkelley33/python-dev-utils)，这个版本适用于 Mac OS X。还有一个适用于 Linux 的版本[在这里](https://github.com/ksolademi/python-dev-utils)。我花了大约 30 秒来为 django dev 设置好整个过程，我的测试有时会在 5 秒内运行，包括创建默认测试数据库。;)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-29T16:27:07.833

您可以使用 sqlite 数据库后端运行测试。它不适合完整的测试运行（因为数据库不同），但对于健全性检查，它可以节省大量时间。见： http: [//mindlesstechnology.wordpress.com/2008/08/16/faster-django-unit-tests/](http://mindlesstechnology.wordpress.com/2008/08/16/faster-django-unit-tests/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-10-10T16:24:03.163

您可以使用以下标志防止您的测试数据库在 Django 1.8+ 的测试运行之间被破坏：

```
--keepdb 
```

（[https://docs.djangoproject.com/en/1.10/ref/django-admin/#cmdoption-test-keepdb](https://docs.djangoproject.com/en/1.10/ref/django-admin/#cmdoption-test-keepdb)）

在 Django 1.9+ 中，如果你有一个多核处理器，另一个不错的选择是 flag：

```
--parallel 
```

这需要您 pip install tblib 但可以让您在多个内核上同时运行单元测试。（[https://docs.djangoproject.com/en/1.10/ref/django-admin/#cmdoption-test-parallel](https://docs.djangoproject.com/en/1.10/ref/django-admin/#cmdoption-test-parallel)）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-09-03T17:18:39.023

正如此线程中所发布的：[如何对生产数据库运行单元测试？](https://stackoverflow.com/questions/2589147/how-do-i-run-a-unit-test-against-the-production-database/7294615#7294615)，我创建了一个测试套件，可以针对生产数据库（在我的本地开发机器上，通过“manage.py shell”）或常规 django“manage.py 测试”测试套件运行。在开发过程中进行快速健全性检查和提交时间验证对我来说是一个真正的节省时间。在任何一种情况下，我都在同一个数据库（MySQL）上运行，并在我的测试中获得 django ORM。

# asp.net - ListView 编辑命令按钮不会响应

> ID：616479
> 
> 赞同：0
> 
> 时间：2009-03-05T20:27:25.070
> 
> 标签：asp.net, listview

我在 ListView 的 ItemTemplate 中设置了一个 LinkBut​​ton。它显示正常，但单击时它没有做任何事情。它应该是一个简单的编辑按钮，但它让我发疯了。这是按钮：

```
<asp:LinkButton ID="EditLinkButton" runat="server" CommandName="Edit" Text="Edit" /> 
```

这是代码隐藏：

```
Protected Sub MyListView_ItemEditing(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.ListViewEditEventArgs) Handles MyListView.ItemEditing
    MyListView.EditIndex = e.NewEditIndex
    GetListViewData()
End Sub 
```

什么可能导致链接什么也不做？

如果有帮助，这是整个列表视图：

```
<asp:ListView ID="MyListView" runat="server" DataKeyNames="my_id">
    <LayoutTemplate>
        <table cellpadding="3">
            <tr class="tableHeader">
                <th>
                    Name
                </th>
                <th>
                </th>
            </tr>
            <asp:PlaceHolder ID="itemPlaceHolder" runat="server" />
        </table>
    </LayoutTemplate>
    <ItemTemplate>
        <tr class="tableRow">
            <td>
                <%#Eval("my_name")%>
            </td>
            <td>
                <asp:LinkButton ID="EditLinkButton" runat="server" CommandName="Edit" Text="Edit" />
                |
                <asp:LinkButton ID="DeleteLinkButton" runat="server" CommandName="Delete" Text="Delete" />
            </td>
        </tr>
    </ItemTemplate>
    <EditItemTemplate>
        <tr class="tableRow">
            <td>
                <asp:TextBox ID="NameTextBox" runat="server" Columns="30" />
            </td>
            <td>
                <asp:LinkButton ID="CancelLinkButton" runat="server" CommandName="Cancel" Text="Cancel" />
                |
                <asp:LinkButton ID="DeleteLinkButton2" runat="server" CommandName="Delete" Text="Delete" />
            </td>
        </tr>
    </EditItemTemplate>
</asp:ListView> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-06T19:45:35.083

我的错 - 我在表单的其他地方有验证器，所以链接似乎没有做任何事情，因为它正在触发验证。

# python - 在 OS X 10.4.11 上升级 Python

> ID：616480
> 
> 赞同：2
> 
> 时间：2009-03-05T20:27:35.147
> 
> 标签：python, macos, bash, terminal

我下载了 Python 2.6.1 的包安装程序，但是当我在终端 (bash) 中使用 python 命令时，Apple 发布的 2.3.5 版本会加载。我怎样才能让 2.6.1 加载呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T20:29:57.217

您可能需要编辑 ~/.profile 文件。它包含你的 PATH 变量，它告诉命令行在哪里可以找到东西。你可以这样做：

```
export PATH=/path/to/new/python:$PATH 
```

这会将您的新路径作为首先查看的位置。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T20:34:23.540

我正在运行 Leopard，10.5.5。python 二进制文件 ,`/usr/bin/python`只是版本特定 Python 文件夹中实际二进制文件的符号链接。例如：

```
$ ls -l /usr/bin/python
lrwxr-xr-x  1 root  wheel  72 Aug 31  2008 /usr/bin/python -> ../../System/Library/Frameworks/Python.framework/Versions/2.5/bin/python 
```

看看那个`/Versions`文件夹就会发现：

```
$ ls -l /System/Library/Frameworks/Python.framework/Versions/
total 8
drwxr-xr-x   7 root  wheel  238 Aug 31  2008 2.3
drwxr-xr-x  13 root  wheel  442 Nov 22 20:40 2.5
lrwxr-xr-x   1 root  wheel    3 Aug 31  2008 Current -> 2.5 
```

借助`ln`创建符号链接的命令，您将能够`python`在路径中设置指向您要使用的 python 版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T21:15:18.637

除了制作符号链接或放在环境变量`/usr/local`的前面之外`PATH`，您可以尝试使用[MacPorts](http://www.macports.org/)。从端口安装 Python 需要更长的时间（它必须从源代码编译），但端口为您提供了将 PIL 安装到 Python 中的最可靠方法（除了`sudo apt-get install python-imaging`在 Ubuntu 中发布......）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T16:08:01.377

您可以尝试输入`python2.6`而不是`python`. 这可能需要您“正确”设置 PATH

如果您想在 Mac 上进行单机 python 开发以使用[MacPorts](http://www.macports.org/) ，我建议您这样做。它使您可以控制您使用的 python 版本（因为默认情况下，所有内容都安装在 中`/opt/local`）（假设您可以修改 $PATH 变量）。它还使得同时安装多个版本的 python 及其可选的二进制包变得简单易行。

我系统上 python2.6 的 MacPorts 路径是：

```
/opt/local/bin/python2.6 
```

如果您使用类似的东西`#!/usr/bin/env python2.6`，您可能需要修改 PATH 环境变量以包含 MacPorts（或您的其他 python2.6 版本），以便在脚本运行时引入所需的 python 版本

这是一个假设 BASH shell 的示例命令，以及我的 MacPorts`bin`目录的位置：

```
export PATH=/opt/local/bin:$PATH 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-08T20:06:25.530

As for putting environment variables in your profiles... If you're on Leopard, try putting them in /etc/paths.d

see [here](http://littlesquare.com/2008/01/24/upgraded-to-leopard-making-use-of-etcpathsd-and-path_helper/) for more...

# c# - 如何获取类中的文件路径？

> ID：616481
> 
> 赞同：0
> 
> 时间：2009-03-05T20:27:59.607
> 
> 标签：c#, xml, file-io

我有这个 Xml 文件，我从我的 HDD 浏览到我的 C# 程序。现在这个 Xml 文档的节点显示在我的 winform 中的树视图中。我所有的逻辑现在都在winform中。有以下三种方法：

1.  将 Xml 文档加载到内存中。
2.  将节点添加到由第 1 点中的前一个方法调用的树。
3.  当我单击任何节点以查找其属性时，该事件起作用。

休息，我有各种按钮，如浏览、展开树、清除。都在winform中。我的浏览按钮单击事件也在 winform 类中，这是显而易见的。

现在我必须做的是，我必须为业务逻辑创建一个单独的类，其中包括第 1 点和第 2 点中的方法。其余部分保留在 winform 类中。这个新课程在同一个项目中。现在这个项目有两个类——一个是winforms，另一个是我用来存储我的业务逻辑，以使前端类不受业务逻辑的影响。

我不能通过使用对象来做到这一点，但我必须利用在具有逻辑的类中提供文件路径。这样，该类就知道文件路径。你知道我该怎么做吗？

请告诉我语法，因为我是新手。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T20:33:50.030

如果您希望用户能够指定文件的路径，我相信您正在寻找[OpenFileDialog组件。](http://msdn.microsoft.com/en-us/library/system.windows.forms.openfiledialog.aspx)

如果没有，那么只需将路径作为业务类逻辑中的参数传递：

```
public class MyBusinessLogic {
   public MyBusinessLogic(String filePath) {
      this.FilePath = filePath;
   }
   public String FilePath { get; private set; }
   public void Process() {
      // whatever you do here
   }
} 
```

# apache-flex - 在 Flex 应用程序中嵌入 Flash 组件的多个实例

> ID：616482
> 
> 赞同：1
> 
> 时间：2009-03-05T20:28:15.550
> 
> 标签：apache-flex, flash

我有一个 Flash 应用程序（纯 AS，没有 Flex 框架），我想使用 SWFLoader 将它嵌入到 flex 应用程序中。

嵌入一​​个实例效果很好。但是，当我尝试嵌入多个实例（每个实例都有一个单独的 SwfLoader）时，确实会出现奇怪的行为，这似乎是由多个实例的类定义之间的冲突引起的。这个 Flash 应用程序是用很多单例类编写的，所以我的猜测是这些单例相互覆盖并导致了奇怪的行为。

我尝试将 Flash 应用程序加载到子应用程序域中，但这似乎也没有多大帮助。有没有人遇到过这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T01:16:55.630

您可能希望将 SWF 加载到其自己的应用程序域（而不是子应用程序域）中以避免名称冲突。

有三种类型的应用程序域：

```
var swfLoader:Loader = new Loader();
var loaderContext:LoaderContext = new LoaderContext();

// child SWF adds its unique definitions to
// parent SWF; both SWFs share the same domain
// child SWFs definitions do not overwrite parents
loaderContext.applicationDomain = new ApplicationDomain(ApplicationDomain.currentDomain);

// child SWF uses parent domain definitions
// if defined there, otherwise its own
loaderContext.applicationDomain = ApplicationDomain.currentDomain;

// child SWF domain is completely separate and
// each SWF uses its own definitions
loaderContext.applicationDomain = new ApplicationDomain();

// Load the swf file
swfLoader.load(new URLRequest("file.swf"), loaderContext); 
```

我建议使用第一种方法，因为它不会覆盖定义。

# iphone - 如何在 iPhone 上实现一个自动选择文本框，如用于电子邮件地址的自动选择文本框？

> ID：616483
> 
> 赞同：3
> 
> 时间：2009-03-05T20:28:35.347
> 
> 标签：iphone, uitextview, touch

在 iPhone 的邮件应用程序上，您可以输入多个邮件地址...然后删除一个您只需点击它，然后单击删除。我怎样才能在我的应用程序中实现类似的东西？我试图处理 UITextView 上的点击，但看起来 touchesBegan 和相关的委托方法没有为此类及其子类触发:(

任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T18:44:26.413

我已经实现了一个与 mail.app 中的相同的视图。我使用了一个由自定义 UIView 组成的复合视图，其中包含几个其他类型的视图。我使用 UITextField 作为文本输入。当用户完成一个地址时，我将文本放在一个带有自定义背景图像的按钮中（以使文本看起来周围有气泡）并将 UITextField 移动到右侧（或视情况而定到下一行） . 当用户点击地址“气泡”之一时，它被选中。如果他们按下删除键，我会从视图中删除该气泡并重新布局所有内容。这是一个非常重要的视图，可以构建许多有趣的边缘案例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-06-27T21:46:29.567

这可能会有所帮助：[链接](https://github.com/thermogl/TITokenFieldView)

> TITokenFieldView 模拟邮件和消息中的收件人：字段的控件。有点像 NSTokenField。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-28T13:37:14.190

查看 Joe Hewitt [three20](http://github.com/joehewitt/three20/)项目，它包括可以执行此类操作的“更好的文本字段”。

# java - 如何使用 ConcurrentLinkedQueue？

> ID：616484
> 
> 赞同：104
> 
> 时间：2009-03-05T20:29:16.343
> 
> 标签：java, concurrency

如何`ConcurrentLinkedQueue`在 Java 中使用 a？
使用这个`LinkedQueue`，我是否需要担心队列中的并发？还是我只需要定义两种方法（一种从列表中检索元素，另一种将元素添加到列表中）？
注意：显然这两种方法必须同步。对？

* * *

**编辑：**我要做的是：我有一个类（在Java中），它具有一种从队列中检索项目的方法，而另一个类具有一种将项目添加到队列中的方法。从列表中添加和检索的项目是我自己的类的对象。

还有一个问题：我是否需要在 remove 方法中执行此操作：

```
while (queue.size() == 0){ 
  wait(); 
  queue.poll();
} 
```

我只有一个消费者和一个生产者。

* * *

## 回答 #1

> 赞同：165
> 
> 时间：2009-03-05T20:36:09.150

不，方法不需要同步，也不需要定义任何方法；它们已经在 ConcurrentLinkedQueue 中，只需使用它们。ConcurrentLinkedQueue 在内部完成您需要的所有锁定和其他操作；您的生产者将数据添加到队列中，并且您的消费者轮询它。

首先，创建您的队列：

```
Queue<YourObject> queue = new ConcurrentLinkedQueue<YourObject>(); 
```

现在，无论你在哪里创建你的生产者/消费者对象，在队列中传递，这样他们就有地方放置他们的对象（你可以为此使用一个 setter，但我更喜欢在构造函数中做这种事情）：

```
YourProducer producer = new YourProducer(queue); 
```

和：

```
YourConsumer consumer = new YourConsumer(queue); 
```

并在你的生产者中添加东西：

```
queue.offer(myObject); 
```

并在你的消费者中取出东西（如果队列为空， poll() 将返回 null，所以检查一下）：

```
YourObject myObject = queue.poll(); 
```

有关更多信息，请参阅[Javadoc](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ConcurrentLinkedQueue.html)

# 编辑：

如果您需要阻止等待队列不为空，您可能需要使用[LinkedBlockingQueue](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/LinkedBlockingQueue.html)并使用 take() 方法。但是，LinkedBlockingQueue 具有最大容量（默认为 Integer.MAX_VALUE，超过 20 亿），因此根据您的情况可能合适也可能不合适。

如果您只有一个线程将内容放入队列，而另一个线程将内容从队列中取出，则 ConcurrentLinkedQueue 可能是矫枉过正。当您可能有数百甚至数千个线程同时访问队列时，它更有用。您的需求可能会通过使用来满足：

```
Queue<YourObject> queue = Collections.synchronizedList(new LinkedList<YourObject>()); 
```

这样做的一个优点是它锁定实例（队列），因此您可以在队列上同步以确保复合操作的原子性（正如 Jared 所解释的）。您不能使用 ConcurrentLinkedQueue 执行此操作，因为所有操作都是在没有锁定实例的情况下完成的（使用 java.util.concurrent.atomic 变量）。如果您想在队列为空时阻塞，则不需要这样做，因为 poll() 将在队列为空时简单地返回 null，而 poll() 是原子的。检查 poll() 是否返回 null。如果是，wait()，然后再试一次。无需锁定。

# 最后：

老实说，我只会使用 LinkedBlockingQueue。对于您的应用程序来说，它仍然是矫枉过正，但很有可能它会正常工作。如果它的性能不够（PROFILE！），您可以随时尝试其他方法，这意味着您不必处理任何同步的东西：

```
BlockingQueue<YourObject> queue = new LinkedBlockingQueue<YourObject>();

queue.put(myObject); // Blocks until queue isn't full.

YourObject myObject = queue.take(); // Blocks until queue isn't empty. 
```

其他一切都是一样的。Put*可能*不会阻塞，因为您不太可能将 20 亿个对象放入队列中。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-03-05T21:21:52.753

这在很大程度上是[另一个问题的重复](https://stackoverflow.com/questions/435069/java-util-concurrentlinkedqueue/435941#435941)。

这是与该问题相关的答案部分：

**如果我使用 java.util.ConcurrentLinkedQueue，是否需要自己进行同步？**

并发集合上的原子操作会为您同步。换句话说，对队列的每个单独调用都保证是线程安全的，无需您进行任何操作。**不能**保证线程安全的是您对集合执行的任何非原子操作。

例如，这是线程安全的，您无需执行任何操作：

```
queue.add(obj); 
```

或者

```
queue.poll(obj); 
```

然而; 对队列的非原子调用不是自动线程安全的。例如，以下操作**不是**自动线程安全的：

```
if(!queue.isEmpty()) {
   queue.poll(obj);
} 
```

最后一个不是线程安全的，因为很有可能在调用 isEmpty 和调用 poll 之间，其他线程会从队列中添加或删除项目。执行此操作的线程安全方式如下：

```
synchronized(queue) {
    if(!queue.isEmpty()) {
       queue.poll(obj);
    }
} 
```

再次......对队列的原子调用是自动线程安全的。非原子调用不是。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-10-24T22:54:53.497

在尝试使用队列中的所有内容时，这可能是您在线程安全和“漂亮”方面正在寻找的内容：

```
for (YourObject obj = queue.poll(); obj != null; obj = queue.poll()) {
} 
```

这将保证您在队列为空时退出，并且只要队列不为空，您就可以继续从中弹出对象。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-05T20:37:37.400

使用[poll](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ConcurrentLinkedQueue.html#poll())获取第一个元素，并使用[add](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ConcurrentLinkedQueue.html#add(E))添加新的最后一个元素。就是这样，没有同步或其他任何东西。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-06T00:59:06.977

ConcurentLinkedQueue 是一种非常高效的无等待/无锁实现（请参阅 javadoc 以供参考），因此您不仅不需要同步，而且队列也不会锁定任何东西，因此几乎与非同步（非线程）一样快安全）一。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-05T20:39:26.663

就像使用非并发集合一样使用它。Concurrent[Collection] 类包装了常规集合，因此您不必考虑同步访问。

**编辑：** ConcurrentLinkedList 实际上不仅仅是一个包装器，而是一个更好的并发实现。无论哪种方式，您都不必担心同步问题。

# c# - C# 与 Java ReentrantLock 和条件的最佳匹配？

> ID：616487
> 
> 赞同：12
> 
> 时间：2009-03-05T20:30:11.397
> 
> 标签：c#, java, multithreading

另一个跨语言问题：谁能告诉我什么 C# 线程构造最匹配 Java ReentrantLock 和 Condition 类？ReentrantLock 有 lockInterruptibly() 和 unlock() 方法，而 Condition 有 signal() 和 await() 方法。正是这种组合，我希望能够在 C# 代码中保留 - 或类似的东西......在此先感谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-05T20:52:47.973

我认为您正在寻找的是静态[Monitor](http://msdn.microsoft.com/en-us/library/system.threading.monitor.aspx)类。我允许[阻塞](http://msdn.microsoft.com/en-us/library/de0542zz.aspx)和[非阻塞](http://msdn.microsoft.com/en-us/library/system.threading.monitor.tryenter.aspx)互斥体获取，以及[条件变量](http://en.wikipedia.org/wiki/Condition_variable)操作。（他们称它们为[Pulse](http://msdn.microsoft.com/en-us/library/system.threading.monitor.pulse.aspx)、[PulseAll](http://msdn.microsoft.com/en-us/library/system.threading.monitor.pulseall.aspx)和[Wait](http://msdn.microsoft.com/en-us/library/system.threading.monitor.wait.aspx)而不是 signal 和 await ）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-31T06:46:05.593

ReaderWriterLock类也值得研究[。](http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlock.aspx)这类似于Java 中的[ReentrantReadWriteLock](http://java.sun.com/javase/6/docs/api/java/util/concurrent/locks/ReentrantReadWriteLock.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T20:55:45.610

**免责声明**：我不知道这些 Java 类，我在这里暗中尝试。

在 C# 中，您有一个可以锁定任何对象的`lock`语句（我认为这类似于 Java 的语句）。`synchronized`我想使用那个语句，或者`Monitor.Enter(obj)`有点`Monitor.Exit(obj)`像 ReentrantLock。

有两个类称为`ManualResetEvent`和`AutoResetEvent`。这些类有一个`Wait`方法和一个`Set`方法，我想这就像 Condition 的信号和等待。这两个类之间的区别在于 a`ManualResetEvent`保持设置（不再阻止任何人）并且必须是`Reset`. 并且`AutoResetEvent`- 就像它的名字所暗示的那样 - 自动重置。

# visual-studio - MSTEST/VSTS 反射工具

> ID：616488
> 
> 赞同：1
> 
> 时间：2009-03-05T20:30:23.190
> 
> 标签：visual-studio, mstest

有谁知道一个工具可以在解决方案中吐出所有具有 [TestMethod] 属性的方法列表？

我们试图完成的是与客户一起根据要求审查我们的单元测试（名称，而不是通过/失败状态）。我们正在为团队系统使用 VSTS 2008 和 Scrum，所以我不确定这是否是在某个地方构建的，或者它是否是我只需要为了我们的目的而组合在一起的工具。任何帮助都会很棒。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-30T00:14:33.247

VS 本质上是通过生成 TRX 文件来总结测试运行的结果，从而免费提供此功能。有许多不同的方法可以运行项目中的所有测试，但选择一个，然后 mstest 将使用 [TestMethod] 属性运行每个方法并在结果文件中生成 UnitTestResult。

您所要求的基本上是测试结果窗口在完成测试运行后向您显示的内容。如果您正在寻找 VS 外部的东西，您总是可以针对测试结果 (.trx) 文件运行一个简单的 XSLT 转换，从而为您提供自定义摘要。这是一个非常粗略的示例，它证明了这个概念，生成一个 HTML 文档，其中包含一个无序列表，每个单元测试都有一个列表项（测试名称和结果）：

```
<?xml version='1.0'?>
<xsl:stylesheet version="1.0"
            xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
            xmlns:vs="http://microsoft.com/schemas/VisualStudio/TeamTest/2006">

    <xsl:template match="/">
        <html>
            <head>
                <style type="text/css">

                    body { font-family: verdana; font-size: 12px; }

                    .pass { color: green; }
                    .nopass { color: red; }

                    h1 { font-size: 13px; margin: 3px; }

                    ul { margin: 3px 20px 3px 40px; }
                </style>
            </head>
            <body>

                <h1>Test Results</h1>
                <ul>

            <xsl:apply-templates select="//vs:Results//vs:UnitTestResult" />

                </ul>
            </body>
        </html>

    </xsl:template>
    <xsl:template match="vs:UnitTestResult" >
        <li>
            <xsl:value-of select="@testName" />
            &#160;

            <xsl:variable name="Result">
                <xsl:choose>
                    <xsl:when test="@outcome='Passed'">pass</xsl:when>
                    <xsl:otherwise>nopass</xsl:otherwise>
                </xsl:choose>
            </xsl:variable>

            <b class="{$Result}">
                <xsl:value-of select="@outcome" />
            </b>
        </li>

    </xsl:template>
</xsl:stylesheet> 
```

# sharepoint - Sharepoint 自定义 Web 部件属性未显示在工具箱中

> ID：616490
> 
> 赞同：13
> 
> 时间：2009-03-05T20:30:33.720
> 
> 标签：sharepoint, properties, web-parts

我定义了一个布尔属性，如下所示：

```
 [Browsable(true), Category("Display"), DefaultValue(false),
  WebPartStorage(Storage.Shared), FriendlyName("Obey Workflow"),
  Description("")]
  public bool ObeyWorkflow { get; set; } 
```

我希望它在 webpart 的属性工具箱中呈现为一个复选框，但是它没有显示出来。我的 Web 部件派生自 Sharepoint WebPart 基类。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-07T09:18:21.133

你在正确的轨道上。你只需要使用不同的属性。

```
[Personalizable(PersonalizationScope.Shared)]
[WebBrowsable(true)]
[Category("Display")]
[WebDisplayName("Obey Workflow")]  
[Description("")]  
public bool ObeyWorkflow { get; set; } 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-15T21:45:04.993

@Jason，你是对的。语法“可浏览”和“类别”是特定于 Sharepoint 2003 的。对于 SharePoint 2007，它分别是“WebBrowsable”和“SPWebCategoryName”。

DefaultValue(false) 也是特定于 SharePoint 2003 的。

据我所知，2007 年的等价物是事先声明它，如下所示：

```
 private string _strMainFolder = "Reports"; //Here is the default value

    [WebBrowsable(true)]
    [WebDisplayName("SharePoint List Name")]
    [SPWebCategoryName("SharePoint List Name Settings")]
    [WebPartStorage(Storage.Shared)]
    [WebDescription("You would put the description here.")]
    [Personalizable(PersonalizationScope.Shared)]
    public string strMainFolder
    {
        get { return _strMainFolder; }
        set { _strMainFolder = value; }
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T04:00:27.757

我认为它`WebBrowsable(true)`而不是`Browsable(true)`

# c# - Winforms：当有垂直滚动条时，如何以编程方式显示 C# 列表视图中的最后一项？

> ID：616491
> 
> 赞同：12
> 
> 时间：2009-03-05T20:31:01.207
> 
> 标签：c#, winforms, listview, scrollbar

当有垂直滚动条时，如何以编程方式显示 C# 列表视图中的最后一项？我研究了与列表视图相关的所有方法，但找不到任何东西。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-05T20:37:12.753

滚动列表视图实际上并不容易/不可能。您需要告诉该项目以确保它是可见的。

```
var items = listView.Items;
var last = items[items.Count-1];
last.EnsureVisible(); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-05T20:37:31.910

```
this.listView1.Items[this.listView1.Items.Count - 1].EnsureVisible(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T20:35:38.963

WINFORMS：

您是否尝试在 ListView 的 Items 集合的最后一项中将 Selected 值设置为 TRUE？

我认为这样做将专注于最后一项......如果需要，向下滚动。但我自己没有试过。

编辑： **这可以解决问题：**

```
Me.ListView1.Items(Me.ListView1.Items.Count - 1).EnsureVisible() 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T20:36:25.890

ListViewItem.EnsureVisible()

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T20:34:53.630

WPF 还是 WinForms？

在 WPF 中，您会得到`ListViewItem`并调用`BringIntoView`它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-15T21:53:11.260

这是一个使用 windows 功能隐藏水平和强制垂直显示的链接：

[http://social.msdn.microsoft.com/Forums/en-US/winforms/thread/4aa4dade-53a2-4e2e-a8b4-b4980da1f39c/](http://social.msdn.microsoft.com/Forums/en-US/winforms/thread/4aa4dade-53a2-4e2e-a8b4-b4980da1f39c/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-03-13T07:41:45.133

以下 hack 将选择并显示最后一个 ListView 项。
不知道为什么这有效，但它有效。

```
listview.SelectedIndices.Clear();  
listview.FocusedItem = listview.Items[listview.Items.Count - 1];  
listview.FocusedItem.Selected = true;  
listview.BeginInvoke((MethodInvoker)delegate { 
    listview.FocusedItem.EnsureVisible(); 
}); 
```

此外，如果您不希望显示水平滚动条，则需要`ClientArea`在调用之前调整 ListView 列的大小以适合 ListView 的宽度`BeginInvoke`。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-05-06T22:03:39.523

我有一个继承 ListView 的自定义控件，但由于它不公开内部 ListView，我无法使用上述`items...EnsureVisible()`解决方案。

`Ctrl`我通过将+`End`键直接发送到该控件以手动将滚动固定到底部来解决某种工作：

```
logMsgList.Focus();
SendKeys.Send("^{END}"); 
```

# .net - Windows 从多图标文件中选择错误的图标并自行渲染为正确的大小

> ID：616500
> 
> 赞同：9
> 
> 时间：2009-03-05T20:33:59.950
> 
> 标签：.net, windows, rendering, icons

我有一个 .ico 文件，其中嵌入了 5 个图标大小，用作主应用程序图标和系统托盘图标。

当它出现在任务栏中时，该图标使用的是所需的 16x16 格式。当图标出现在通知区域/系统托盘中时，它使用 32x32 格式，而 Windows 将其渲染为 16x16 图标，这看起来很糟糕。

如何强制 Windows 在通知区域中使用 16x16 图标大小？这是我将图标放入系统托盘的代码：

```
ContextMenu cmNotify = new ContextMenu();
MenuItem miNotify = new MenuItem(Properties.Resources.Notify_Text);
miNotify.DefaultItem = true;
miNotify.Click += new EventHandler(notifyHandler);
cmNotify.MenuItems.Add(miNotify);

notifyIcon = new NotifyIcon();
notifyIcon.Icon = this.Icon;
notifyIcon.Visible = true;
notifyIcon.ContextMenu = cmNotify;
notifyIcon.Text = AppConstants.APPLICATION_NAME; 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-11-03T23:15:44.517

两种反应都很接近，但含有一种微妙的毒药。您不应将请求的大小硬编码为 16x16。

相反，查询 SystemInformation.SmallIconSize 以确定适当的维度。虽然默认值肯定是 16x16，但这可以通过各种方式进行更改，例如 DPI 缩放。

有关此属性的详细信息，请参阅[MSDN 文章](http://msdn.microsoft.com/en-us/library/system.windows.forms.systeminformation.smalliconsize.aspx "MSDN")。

一个使用示例是

```
notifyIcon.Icon = new System.Drawing.Icon(this.Icon, SystemInformation.SmallIconSize), 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-05T21:19:20.217

改变这个：

```
notifyIcon.Icon = this.Icon; 
```

对此：

```
notifyIcon.Icon = new System.Drawing.Icon(this.Icon, 16, 16); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T21:03:45.013

您需要创建图标的新实例。创建（加载）新实例时，指定大小。Icon 类构造函数有几个不同的重载供您选择。如果图标文件嵌入到您的主可执行文件中（通常是这种情况），您可以这样做：

```
Assembly asm = this.GetType().Assembly;

var smallIconSize = new System.Drawing.Size(16, 16);
notifyIcon.Icon = new System.Drawing.Icon(
    asm.GetManifestResourceStream("MyPrettyAppIcon.ico"), smallIconSize); 
```

# linux - 301 所有 404 到主页

> ID：616525
> 
> 赞同：1
> 
> 时间：2009-03-05T20:42:51.147
> 
> 标签：linux, apache, tomcat, http-status-code-404, http-status-code-301

有谁知道做到这一点的最佳方法？阿帕奇，tomcat，Linux

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T22:02:52.047

不要，除非真的是一个永久的举动。否则，返回 404。

告诉任何人您的 404 页面是 301，意味着它将显示与所要求的 URL 相关的实际内容。对 SEO 很重要。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T22:06:47.590

404s应该是404s。设计一个良好且可用的 404 页面，其中包含适当的消息、返回主页的链接、搜索表单和自动发现的可能相关页面。

Smashing Magazine 有[一篇关于设计 404 页的非常好的文章](http://www.smashingmagazine.com/2007/07/25/wanted-your-404-error-pages/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T20:43:46.217

试试这个`ErrorDocument`指令：

```
ErrorDocument 404 http://example.com/ 
```

正在重定向绝对 URL。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T21:59:25.347

还有tomcat方式：坚持web.xml：

```
<error-page>
        <error-code>404</error-code>
        <location>/homepage.html</location>
</error-page> 
```

相对于 Web 应用程序上下文。

# sharepoint - 在 Sharepoint 中自定义 accessdenied.aspx

> ID：616528
> 
> 赞同：2
> 
> 时间：2009-03-05T20:43:31.833
> 
> 标签：sharepoint, sharepoint-2007

我在 Sharepoint 2007 中有一个网站。我的网站具有某些角色的权限。当用户的角色没有获得进入站点的权限时，Sharepoint 会将他/她重定向到具有 Sharepoint 设计的 accessdenied.aspx。如何更改此重定向以使其转到自定义重定向？我不知道服务器是否会与其他 Sharepoint 网站共享，所以我不敢直接编辑 accesdenied.aspx（我还没有验证是否可以）。

我需要精确的代码和指示，因为我不是 Sharepoint 的专家。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T20:52:37.053

我希望我能在精确代码方面为您提供更多信息，但[这个网站](http://balajinjl.wordpress.com/2008/06/18/customizing-access-denied-page-in-moss-2007/)似乎有非常明确的说明。

希望有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-04-17T09:09:57.393

当您创建自己的自定义访问被拒绝错误页面和我的帖子中提出的解决方案时，请查看本文以了解您面临的问题。

[http://social.technet.microsoft.com/Forums/sharepoint/en-US/9332cbe8-fda4-48de-a397-5f42bff9bf73/sharepoint-2010-custom-access-denied-page](http://social.technet.microsoft.com/Forums/sharepoint/en-US/9332cbe8-fda4-48de-a397-5f42bff9bf73/sharepoint-2010-custom-access-denied-page)

感谢和问候，

赛阿巴斯

# java - Java 5 和 Java 6 的动态内存中 Java 代码编译

> ID：616532
> 
> 赞同：18
> 
> 时间：2009-03-05T20:44:48.100
> 
> 标签：java, compiler-construction, runtime, compilation, runtime-compilation

如何从 Java 5 和 Java 6 中的任意字符串（在内存中）编译 java 代码，加载它并在其上运行特定方法（预定义）？

在你发火之前，我查看了现有的实现：

*   大多数依赖于 Java 6 Compiler API。
*   那些没有，依靠技巧。
*   是的，我查看了 commons-jci。要么我太密集而无法理解它是如何工作的，要么就是没有。
*   我找不到如何为编译器提供我当前的类路径（这是相当大的）。
*   在有效的实现上（在 Java 6 中），我找不到如何正确加载内部类（或内部匿名类）。
*   如果整个东西都在内存中，我会非常喜欢它，因为它可以在多个环境中运行。

我确信这已经解决了，但是我在谷歌上找不到任何看起来甚至是半生产质量的东西（除了 jci，正如我之前所说，我还没有设法使用）。

编辑：

*   我查看了 JavaAssist - 我需要内部类、Java 5.0 语言级别支持以及使用整个类路径进行编译。另外，我想即时创建新课程。我可能弄错了，但我找不到如何使用 JavaAssit 执行此操作。
*   我愿意使用基于文件系统的解决方案（调用 javac），但我不知道如何预测类路径，也不知道以后如何使用特殊的类加载器加载文件（不在我的类路径中）为多次调用而回收。虽然我确实知道如何研究它，但我更喜欢现成的解决方案。

Edit2：目前，我对 BeanShell“评估”感到满意。显然它做了我需要它做的一切（获取一个字符串，在“当前”类路径的上下文中评估它。它确实错过了一些 Java 5 功能，但它可以使用枚举（未定义）和编译的“通用”（删除) 类，所以对于我想要的应该足够了。

~~我不想将答案标记为已接受，因为我确实希望出现更好的解决方案。~~

Edit3：接受了 beanshell 的建议——它真的很有效。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-05T20:52:57.690

JCI 看起来不错。此代码段应该是您的基础：

```
JavaCompiler compiler = new JavaCompilerFactory().createCompiler("eclipse");

MemoryResourceReader mrr = new MemoryResourceReader();
mrr.add("resource name string", yourJavaSourceString.getBytes());

MemoryResourceStore mrs = new MemoryResourceStore();

CompilationResult result = compiler.compile(sources, mrr, mrs);

// don't need the result, unless you care for errors/warnings
// the class should have been compiled to your destination dir 
```

任何理由这不应该工作？

* * *

**编辑：**添加了一个`MemoryResourceStore`将编译后的类输出发送到内存，如请求。

此外，设置`javac`设置，如您的情况下的类路径，可以通过[`setCustomArguments(String[] pCustomArguments)`](http://commons.apache.org/jci/apidocs/org/apache/commons/jci/compilers/JavacJavaCompilerSettings.html#setCustomArguments(java.lang.String[]))在`JavacJavaCompilerSettings`课堂上完成。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-05T21:32:06.270

您可能还想看看 Janino。

从他们的网站：

Janino 是一个编译器，它读取 JavaTM 表达式、块、类主体、源文件或一组源文件，并生成直接加载和执行的 JavaTM 字节码。Janino 并不是一个开发工具，而是一个用于运行时编译目的的嵌入式编译器，例如表达式评估器或像 JSP 这样的“服务器页面”引擎。

[http://www.janino.net/](http://www.janino.net/)

我目前在一个相当大的关键任务项目中使用它，它工作得很好

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T21:08:58.230

如果你不完全依赖于编译，像 Beanshell、groovy 和其他脚本语言这样的解决方案很容易嵌入（事实上，java 内置了对插入脚本语言的支持，所以你的代码甚至不知道是什么语言脚本写在）

Beanshell 应该运行任何 100% java 代码 IIRC，我相信 Groovy 可以运行大多数 java 代码——可能全部。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T20:49:50.507

[Javassist](http://www.csg.is.titech.ac.jp/~chiba/javassist/)可能会让您感兴趣

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T21:39:35.927

在 Tomcat 等 Web 容器中运行，首先生成一个 JSP 页面，然后调用它。

这也允许您通过简单地覆盖 JSP 页面而不是让您的类加载器缓慢运行满来摆脱旧的类定义。

“内存”要求是由于速度还是由于不更改代码库？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-13T18:04:51.673

[ECJ Eclipse Java 编译器](http://blog.deepakazad.com/2010/05/ecj-eclipse-java-compiler.html)

Eclipse 提供并使用它自己的编译器，它不是 javac

*   Eclipse 编译器在 IDE (Eclipse) 内部使用
*   Eclipse 编译器也可以用作 Eclipse 之外的纯批处理编译器

编译源文件

`$ java -jar ecj-3.5.2.jar HelloWorld.java`

# php - PHP Sessions + 用户代理加盐

> ID：616545
> 
> 赞同：4
> 
> 时间：2009-03-05T20:49:26.093
> 
> 标签：php, user-agent, salt, session-hijacking

最近几天我一直在想它，但我读了一些关于如何使 PHP 会话更安全的文章。几乎所有这些文章都说您需要在会话中使用额外的盐保存用户代理。像这样的东西：

```
$fingerprint = md5('SECRET-SALT'.$_SERVER['HTTP_USER_AGENT']); 
```

盐会使攻击者更难劫持或任何会话。但是为什么每次检查时都要加盐：

```
md5('SECRET-SALT'.$_SERVER['HTTP_USER_AGENT']) == $_SESSION [ 'fingerprint' ] 
```

那么为什么盐会让它更安全，因为攻击者仍然只需要用户代理（相对而言是一小组不同的用户代理）和 sessionid？

可能是我忽略了一些小东西，但无法弄清楚，让我抓狂哈哈

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T21:47:34.690

建议加盐的原因很简单。一般来说，当你创建这个“指纹”时——如果你只使用一个数据项，它的数据集有限，那么外部黑客就更容易生成它，并劫持会话。

在上面的示例中，是的，如果攻击者同时拥有“指纹”和用户代理，那么他们将能够劫持会话。

添加盐只会使攻击者更难生成指纹，这是“如果他们只有一条信息，那么最后一条信息将变得无用”的情况

我建议您添加更多内容，例如，在 vBulletin（我曾经从事的一个项目）中，使用以下代码生成会话 ID 哈希（与指纹基本相同）。

```
define('SESSION_IDHASH', md5($_SERVER['HTTP_USER_AGENT'] . $this->fetch_substr_ip($registry->alt_ip))); // this should *never* change during a session 
```

此外，会话哈希是使用生成的

```
md5(uniqid(microtime(), true)); 
```

这些都在尝试识别会话时被检查

因此，要劫持会话，此人需要知道以下内容

*   创建会话时服务器上的时间（准确）
*   用户浏览器代理字符串
*   用户的 IP 地址

他们还必须欺骗 IP 地址（或至少前 2/3 个八位字节）才能做到这一点。

如果他们实际上已经设法获得了上述信息，那么他们很可能能够以其他方式进行攻击，而不仅仅是会话劫持。

vBulletin 实际上并没有使用“盐”本身，但是，在你上面的例子中，盐只是增加了有限量的熵，总是最好找到尽可能多的熵。

例如，在我目前正在用 python 编写的东西中，我生成了一个散列以用于 XSRF 保护。以下是我使用的。

```
 self.key = sha1(
        self.user.username +
        self.user.password +
        settings.SECRET_KEY +
        strftime("%a, %d %b %Y %H:%M:%S +0000", gmtime())
    ).hexdigest() 
```

它需要用户的用户名和密码、当前时间和预设的盐来生成它。由于盐和时间，这对于攻击者来说很难生成（不过，请注意，这只是因为一旦使用它就会改变，随着时间的推移，某人不需要太多如果它没有改变，则为特定用户破解它）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T21:50:15.073

如果我理解正确，您想防止猜测会话 ID 的远程攻击者劫持会话？

如果不是这种情况，那么你就严重超出了你的深度 - 可以窥探流量的攻击者也可以模仿用户代理，并且获得对会话存储的访问权限的攻击者无论如何都会让你得到控制。

如果您存储用户代理字符串以将会话“锁定”到当前用户代理，那么散列它真的没有意义 - 完整用户代理字符串上的字符串比较更快（然后散列然后比较）并且不会更多在存储方面昂贵。

我不相信存储用户代理能提供足够的差异化——更好的办法是在会话开始时生成一个更大的 ID（具有更多位）（可能是 sha1 当前时间戳+用户名+用户代理+某些东西），然后将其存储在 cookie 和会话中，并在每个附加请求中匹配它。这不会对攻击向量有太大的改变（您仍然需要猜测一些数字），但是通过大量增加攻击的难度，很容易显着增加成功攻击必须猜测的位数。

#### 更新：

其他答案顺便提到的但对于加盐哈希很重要的一点：如果您希望攻击者可以访问您存储的哈希而不是您的代码，然后以某种方式使用它来利用攻击，那么加盐您的哈希才有意义.

这对于长时间存储的密码很有意义，通常在众所周知的位置，并且由难以定位的代码使用。

这对您的用例没有意义，因为：

1.  该信息仅在会话正在进行时（超时之前）才有效，这很少超过几个小时，之后 - 即使他们获得了存储并解码了所有内容 - 会话也无法被劫持，因为它已经结束。
2.  通常，如果攻击者能够及时访问您的会话存储，他们就可以访问您的纯文本 PHP 代码并且可以看到您的 salt。
3.  除非您将会话存储在完全不合理的位置（例如 S3 存储桶），否则与许多其他更有用的攻击相比，哈希窃取攻击的可能性要小得多。

简而言之：不要浪费时间编写会话验证代码——PHP 内置的会话管理已经足够安全了。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-22T02:37:17.650

如果您在自己的服务器上，加密会话变量是没有意义的，因为它们不会离开服务器。请参阅**Linead**回答[用户登录时我需要在 php 会话中存储什么？](https://stackoverflow.com/questions/1221447/what-do-i-need-to-store-in-the-php-session-when-user-logged-in)了解更多信息。如果您在共享服务器中，您可能需要加密除会话 ID 之外的每个会话变量，因为它们存储在所有邻居正在使用的同一 Web 服务器可以读取的临时文件中。

无论如何，如果您真的担心安全性，您最好使用自己的（虚拟或非虚拟）服务器，这样危险只会来自您的服务器外部。

您的会话风险的一些示例：

*   您的服务器在 URL 中发送会话 ID，您的用户点击 badguys.com 的链接他们将在服务器变量中获取引用者（完整的 URL，包括您的会话 ID）、浏览器和用户的 IP 地址。如果您不检查 IP，或者您的用户使用开放代理，他们只需安装相同的浏览器版本，粘贴 URL，就可以完成。
*   用户去公共电脑，登录，然后离开而不关闭他的会话（嘿，他毕竟是人）。行中的下一个人打开浏览器，检查历史记录并找到一个打开的会话。呸。

因此，按照我通常的偏好，您可以采取一些措施：

1.  不要在 URL 中发送会话 ID；`session.use_only_cookies`在 PHP 中启用。缺点：用户需要启用 cookie。
    *   在危险操作（更改密码、下订单...）时，再次要求用户输入密码。您也可以定期进行。缺点：烦人。
    *   超时会话快。缺点：在大多数网站中，这会迫使用户经常登录，让他们很恼火。
    *   使用 SSL（避免“中间人”攻击的唯一方法）。缺点：慢。愚蠢的浏览器消息。服务器上需要 SSL。
    *   检查IP。缺点：对使用公共代理的访问者无效。烦人的动态IP。
    *   检查用户代理（浏览器）。缺点：几乎没用，UA 容易获得且难以模仿。

（我理所当然地认为您已经为最大安全性配置了 PHP）。

一些更极端的措施：

*   保持服务器和浏览器之间的永久连接，例如使用 Java 小程序。没有连接，没有会话。缺点：用户需要 Java、ActiveX 或任何你使用的东西。会话通过浏览器关闭（这可能很好）。不适用于非常慢的连接。服务器负载较高。你需要打开端口，有一个专门的小程序服务器。
*   相同，但使用异步请求（例如 AJAX）非常频繁地刷新会话，并且超时时间很短。或刷新隐藏的 IFRAME。缺点：用户需要 JavaScript。不适用于非常慢的连接。服务器负载较高。
*   相同，但重新加载整个页面。缺点：用户需要 JavaScript。阅读页面时自动重新加载**非常**烦人。

在某些极端情况下，您可以忘记会话并改用 Apache 身份验证。最简单的解决方案，但有很多限制。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T20:54:20.387

由于指纹存储在服务器端，因此您不需要使用加盐哈希。“正常”散列足以减少数据。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-20T13:04:19.757

我认为加盐你的指纹有一个目的。如果一个坏人掌握了你的会话数据库（天知道为什么）但没有掌握你的代码，他就无法通过尝试常见的用户代理来“猜测”你的指纹识别方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T21:31:09.440

请记住，如果您这样做，如果他们升级浏览器，您将强制人们再次登录。这可以，但只要确保这是您的意图。

Using the user's remote address is not without problems either. Many people use the same computer from different locations. Mobile devices, laptops being used at home and work, laptops being used at Wifi hotspots and so on. IMHO it's a bad idea to use IP address in such a way that a new IP address requires a login **unless you're dealing with highly sensitive information** such as online banking. Is that the case?

What are you concerned about? External attack? Or in a shared host situation that someone can read your session information?

If it's the latter, the solution is simple: just don't store anything sensitive in the session. Anything sensitive should be stored in the database.

在创建秘密盐方面，您需要使用不可猜测的东西。我会选择在创建用户时创建的随机字符串之类的东西。如有必要，每次会话无效时重新创建它。

至于什么会让它更安全，你自己说过：用户代理字符串是有限的（不到一百个可能会覆盖 99.99% 的用户）。盐只是增加了可能性的数量。话虽如此，如果您在所有会话中使用相同的盐，那么用蛮力发现它只是时间问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T20:52:36.677

我这样做也是为了[部分保护免受会话模拟攻击](http://blog.cherouvim.com/an-http-session-impersonation-protection-filter/)。您还需要包括 IP 地址。

请记住，当客户端的浏览器自动更新用户代理更改时，您会认为他的会话已被劫持；）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-06T17:46:34.557

好的，例如我正在使用以下虚构代码：

```
<?php

// The sessionid cookie is now a certain hash
if ( array_key_exists ( $_COOKIE [ 'sessionid' ] ) )
{
    // Get the session from database
    $db_sessid = $pdo -> getStuff ( 'session_database', $_COOKIE [ 'sessionid' ] );

    if ( $db_sessid !== null && $db_sessid [ 'fingerprint' ] == sha1 ( 'SOMESALT' . $_SERVER [ 'HTTP_USER_AGENT' ] ) )
    {
        set_cookie ( ... ); // New sessionid and write also to DB

        // User is now logged in, execute some user stuff
    }
    else
    {
        // Session doesn't exist, or the fingerprint does not match
    }
} 
```

现在攻击者只需要 sessionid，它在 cookie（随 HTTP 标头发送）和用户代理中。那么添加盐还有什么意义呢？

在我看来，检查 IP 也不是一个好选择，一些提供商或代理会在每个请求中更改它们。

到目前为止感谢（-：

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2020-02-08T21:59:45.303

在满足所有安全参数后，您允许 cookie 仅设置一个 cookie，如果不满足参数，则 cokkie 将永远不会设置得很好，但如果 cookie 有一个可见的参数，那么会发生什么。同样，如果条件从未满足，则会议将不会被满足。这就是你真正想要的。记住检查满足条件通过 cookie 提供会话和查看数据的方式记住 cokkie 坐在客户端浏览器上问候 stelios

# c# - 反射真的那么慢以至于我不应该在有意义的时候使用它吗？

> ID：616554
> 
> 赞同：18
> 
> 时间：2009-03-05T20:53:02.417
> 
> 标签：c#, .net, vb.net, oop, reflection

> **可能重复：**
> [.NET 反射的成本是多少？](https://stackoverflow.com/questions/25458/how-costly-is-net-reflection)

[我遇到的问题](https://stackoverflow.com/questions/616447/what-is-the-best-way-to-enforce-properties-that-must-be-implemented-at-each-subcl)的“优雅”解决方案是使用属性将一个类及其属性与另一个类相关联。问题是，要将其转换为另一个，我必须使用反射。我正在考虑将它用于将托管在云上的服务器端应用程序。

我听过很多关于“反射慢，不要使用它”的隆隆声，慢有多慢？CPU 密集度是否如此之高，以至于我的 CPU 时间会大大增加，以至于我真的会为我在云端架构底部使用反射的决定付出代价？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-05T20:56:18.120

以防万一您没有看到原始问题的更新：当您反思以查找支持某个属性的所有类型时，您有一个使用缓存的绝佳机会。这意味着您不必在运行时多次使用反射。

回答一般问题，反射比原始编译方法调用慢，但比访问数据库或文件系统快得多，而且几乎所有的 Web 服务器一直都在做这些事情。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-05T20:55:34.283

它比文件系统访问快很多倍。

它比通过网络访问数据库要快很多倍。

它比向浏览器发送 HTTP 响应快很多很多倍。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-05T20:55:05.110

可能你甚至不会注意到它。在考虑优化之前总是先分析。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-05T20:56:10.803

我想知道同样的事情；但事实证明，反射并不是那么糟糕。我找不到资源（我会在找到它们时尝试列出它们），但我想我记得读过它可能慢了 2 到 3 倍。50% 或 33% 的快仍然是快。

另外，我在 ASP.net webforms 和 MVC 的后台做了一堆反射，那么它到底有多慢呢？

**编辑**

这是我记得读过的一个资源：[.Net Reflection and Performance](http://www.west-wind.com/weblog/posts/351.aspx)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-05T20:57:16.557

嗯，如果可以的话，我会尽量避免反射，但是如果我必须创建一个解决方案，并且反射给了我解决手头问题的优雅方法，我会很乐意使用反射。

但是，必须告诉我，我认为反射不应该被用来做“肮脏的把戏”。此时此刻，我也在研究一个解决方案，我使用自定义属性来装饰一些类，是的，我必须使用反射来知道一个类/属性/任何东西是否已经被我的自定义装饰属性。

我也认为这是一个“你打多少反思电话”的问题？如果可以的话，我会尝试缓存我的结果。就像，在我正在处理的解决方案中：在应用程序启动时，我检查某个程序集中的某些类型，这些类型是否已经用我的属性进行了修饰，并且我将它们保存在字典中。

# git - 你如何使用 git format-patch 将提交压缩到一个补丁中？

> ID：616556
> 
> 赞同：174
> 
> 时间：2009-03-05T20:53:59.390
> 
> 标签：git, patch, squash, git-squash

我在一个分支上有八个提交，我想通过电子邮件发送给一些还没有 git 开明的人。到目前为止，我所做的一切要么给了我 8 个补丁文件，要么从一开始就开始给我分支历史中每个提交的补丁文件。我使用 git rebase --interactive 来压缩提交，但现在我尝试的一切从一开始就给了我无数的补丁。我究竟做错了什么？

```
git format-patch master HEAD # yields zillions of patches, even though there's 
                             # only one commit since master 
```

* * *

## 回答 #1

> 赞同：195
> 
> 时间：2009-03-05T21:46:58.997

我建议在一次性分支上执行此操作，如下所示。如果您的提交在“换行符”分支中并且您已经切换回“主”分支，那么这应该可以解决问题：

```
[adam@mbp2600 example (master)]$ git checkout -b tmpsquash
Switched to a new branch "tmpsquash"

[adam@mbp2600 example (tmpsquash)]$ git merge --squash newlines
Updating 4d2de39..b6768b2
Fast forward
Squash commit -- not updating HEAD
 test.txt |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

[adam@mbp2600 example (tmpsquash)]$ git commit -a -m "My squashed commits"
[tmpsquash]: created 75b0a89: "My squashed commits"
 1 files changed, 2 insertions(+), 0 deletions(-)

[adam@mbp2600 example (tmpsquash)]$ git format-patch master
0001-My-squashed-commits.patch 
```

* * *

## 回答 #2

> 赞同：140
> 
> 时间：2009-12-12T08:28:45.487

只是在锅中再添加一种解决方案：如果您改用它：

```
git format-patch master --stdout > my_new_patch.diff 
```

然后它仍然是 8 个补丁......但它们都将在一个补丁文件中，并将作为一个补丁应用：

```
git am < my_new_patch.diff 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-03-05T22:03:20.703

我总是使用 git diff 所以在你的例子中，比如

```
git diff master > patch.txt 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2009-03-05T21:46:02.150

如您所知，a`git format-patch -8 HEAD`将为您提供八个补丁。

如果您希望您的 8 个提交作为一个提交，并且不介意重写您的分支 ( `o-o-X-A-B-C-D-E-F-G-H`) 的历史记录，您可以：

```
git rebase -i
// squash A, B, C, D, E ,F, G into H 
```

或者，这将是一个更好的解决方案，**在新分支上****重播所有 8 次提交（8 次提交之前的提交）`X`**

```
git branch delivery X
git checkout delivery
git merge --squash master
git format-patch HEAD 
```

这样，你在“delivery”分支上只有一个提交，它代表了你最后 8 个提交

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2010-10-17T15:52:38.423

这是对亚当亚历山大回答的改编，以防您的更改在主分支中。执行以下操作：

*   从我们想要的点创建一个新的一次性分支“tmpsquash”（查找运行“git --log”或使用 gitg 的 SHA 密钥。选择您想要成为 tmpsquash 头的提交，之后在 master 中的提交将是压扁的提交）。
*   合并从 master 到 tmpsquash 的更改。
*   将压缩的更改提交到 tmpsquash。
*   使用压缩的提交创建补丁。
*   回到主分支

* * *

```
laura@rune:~/example (master)$ git branch tmpsquash ba3c498878054e25afc5e22e207d62eb40ff1f38
laura@rune:~/example (master)$ git checkout tmpsquash
Switched to branch 'tmpsquash'
laura@rune:~/example (tmpsquash)$ git merge --squash master
Updating ba3c498..40386b8
Fast-forward
Squash commit -- not updating HEAD

[snip, changed files]

11 files changed, 212 insertions(+), 59 deletions(-)
laura@rune:~/example  (tmpsquash)$ git commit -a -m "My squashed commits"
[test2 6127e5c] My squashed commits
11 files changed, 212 insertions(+), 59 deletions(-)
laura@rune:~/example  (tmpsquash)$ git format-patch master
0001-My-squashed-commits.patch
laura@rune:~/example  (tmpsquash)$ git checkout master
Switched to branch 'master'
laura@rune:~/example  (master)$ 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2015-09-03T10:31:39.440

最简单的方法是使用`git diff`,`git log`如果您想要 squash 方法将输出的组合提交消息，请添加。例如，要在 commit`abcd`和之间创建补丁`1234`：

```
git diff abcd..1234 > patch.diff
git log abcd..1234 > patchmsg.txt 
```

然后在应用补丁时：

```
git apply patch.diff
git add -A
git reset patch.diff patchmsg.txt
git commit -F patchmsg.txt 
```

不要忘记处理非文本文件时的`--binary`论点，例如图像或视频。`git diff`

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2013-09-02T11:39:16.970

两个标签之间的格式补丁：

```
git checkout <source-tag>
git checkout -b <tmpsquash>
git merge --squash <target-tag>
git commit -a -m "<message>"
git format-patch <source-tag> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-12-30T22:25:56.557

根据亚当亚历山大的回答：

```
git checkout newlines
## must be rebased to master
git checkout -b temporary
# squash the commits
git rebase -i master
git format-patch master 
```

# asp.net - 默认模型绑定器和包含列表的复杂类型

> ID：616559
> 
> 赞同：5
> 
> 时间：2009-03-05T20:54:46.453
> 
> 标签：asp.net, asp.net-mvc, binding

我正在使用 ASP.NET MVC 的 RC1。

我正在尝试扩展[Phil Haack 的](http://haacked.com/archive/2008/10/23/model-binding-to-a-list.aspx)模型绑定示例。我正在尝试使用默认模型绑定器来绑定以下对象：

```
public class ListOfProducts
{
    public int Id { get; set; }
    public string Title{ get; set; }
    List<Product> Items { get; set; }
}

public class Product
{
    public string Name { get; set; }
    public decimal Price { get; set; }
} 
```

我正在使用 Phil 示例中的代码进行一些更改：

控制器：

```
using System.Collections.Generic;
using System.Web.Mvc;

namespace TestBinding.Controllers
{
    [HandleError]
    public class HomeController : Controller
    {
        public ActionResult Index()
        {
            ViewData["Message"] = "Welcome to ASP.NET MVC!";

            return View();
        }

        //Action method on HomeController
        public ActionResult UpdateProducts(ListOfProducts productlist)
        {
            return View(productlist);
        }
    }

    public class Product
    {
        public string Name { get; set; }
        public decimal Price { get; set; }
    }

    public class ListOfProducts
    {
        public int Id { get; set; }
        public string Title { get; set; }
        List<Product> Items { get; set; }
    }
} 
```

看法：

```
<%@ Page Language="C#" MasterPageFile="~/Views/Shared/Site.Master" Inherits="System.Web.Mvc.ViewPage" %>

    <asp:Content ID="indexHead" ContentPlaceHolderID="head" runat="server">
        <title>Home Page</title>
    </asp:Content>

    <asp:Content ID="indexContent" ContentPlaceHolderID="MainContent" runat="server">
        <form method="post" action="/Home/UpdateProducts">
            <input type="text" name="productlist.id" value="99" />
            <input type="text" name="productlist.Title" value="SomeTitle" />

            <input type="hidden" name="productlist.Index" value="0" />
            <input type="text" name="productlist.items[0].Name" value="Beer" />
            <input type="text" name="productlist.items[0].Price" value="7.32" />

            <input type="hidden" name="productlist.Index" value="1" />
            <input type="text" name="productlist.Items[1].Name" value="Chips" />
            <input type="text" name="productlist.Items[1].Price" value="2.23" />

            <input type="hidden" name="productlist.Index" value="2" />
            <input type="text" name="productlist.Items[2].Name" value="Salsa" />
            <input type="text" name="productlist.Items[2].Price" value="1.23" />

            <input type="submit" />
        </form>
    </asp:Content> 
```

我的问题是简单类型（Id 和 Title）出现在 productlist 对象中，而不是 List。所以：

*   我的代码不好（不会感到惊讶）？
*   默认模型绑定器可以处理 ListOfProducts 对象吗？
*   如果默认模型绑定器不能处理这种类型的对象，我需要做什么（如果可能的话）？

提前致谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-06T19:35:25.497

回答我自己的问题：

我是个假人！

我的示例不起作用，因为 ListOfProducts 类的 Items 属性不是公共的：

```
public class ListOfProducts
{
    public int Id { get; set; }
    public string Title{ get; set; }
    List<Product> Items { get; set; }
} 
```

我变了：

```
List<Product> Items { get; set; } 
```

到：

```
public List<Product> Items { get; set; } 
```

然后我的代码就起作用了。

总而言之，默认模型绑定器确实适用于包含 List 类型属性的类型。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T20:59:35.943

从 RC 1 开始：

*   不再需要隐藏索引
*   [] 中的数字**必须**以 0 开头，并且**必须**升序。

您的编号看起来不错。

另外，我注意到您在 items 属性名称上使用了不同的大小写。这应该没什么区别，但值得检查。

# asp.net - 可以在自定义服务器控件上有内部控件吗？

> ID：616560
> 
> 赞同：1
> 
> 时间：2009-03-05T20:54:49.590
> 
> 标签：asp.net, custom-controls, custom-server-controls, asp.net-controls, asp.net-customcontrol

我希望能够做类似的事情：

```
<ui:Tab Title="A nice title">
  <TabTemplate>
    <asp:Literal runat="server" ID="SetMe">With Text or Something</asp:Literal>
  </TabTemplate>
</ui:Tab> 
```

但也能做到：

```
<ui:Tab Title="A nice title">
  <TabTemplate>
    <asp:DataList runat="server" ID="BindMe"></asp:DataList>
  </TabTemplate>
</ui:Tab> 
```

我最终想出了答案代码：

```
[ParseChildren(true)]
public class Node : SiteMapNodeBaseControl, INamingContainer
{
    private ITemplate tabTemplate;
    [Browsable(false),
    DefaultValue(null),
    Description("The tab template."),
    PersistenceMode(PersistenceMode.InnerProperty),
    TemplateContainer(typeof(TabTemplate))]
    public ITemplate TabTemplate
    {
        get { return tabTemplate; }
        set { tabTemplate = value; }
    }
    protected override void CreateChildControls()
    {
        if (TabTemplate != null)
        {
            Controls.Clear();
            TabTemplate i = new TabTemplate();
            TabTemplate.InstantiateIn(i);
            Controls.Add(i);
        }
    }
    protected override void Render(HtmlTextWriter writer)
    {
        EnsureChildControls();
        base.Render(writer);
    }
}

public class TabTemplate : Control, INamingContainer
{
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T21:37:30.720

ParseChildren 属性告诉 .NET 是将控件的子项视为属性还是控件。对于您的第一个示例，您希望将孩子视为控件，因此添加

```
[ ParseChildren(ChildrenAsProperties = false) ] 
```

对于第二个，您需要 ChildrenAsProperties=true，以及 ITemplate 类型的 TabTemplate 属性。之后涉及到一些管道，[这个 MSDN 示例](http://msdn.microsoft.com/en-us/library/ms178657.aspx#)描述了这些。但是，如果您只需要一个模板，它不会增加很多价值。

# c# - 如何生成唯一的 4 位字符串

> ID：616561
> 
> 赞同：2
> 
> 时间：2009-03-05T20:54:59.777
> 
> 标签：c#

我正在寻找一种方法来生成一个（相当）唯一（非自动递增）4 位字符串，使用 C# 为每个数字使用数字 0 - 9。如果发现重复，我可以验证唯一性并生成另一个数字。我曾考虑过以某种方式将数字基于 DateTime 对象的 Ticks 属性，但很难将这些部分组合在一起。

任何想法或专业知识将不胜感激。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-05T20:56:30.910

如果它不增加自己，那么它第二次如何是唯一的？

您是说要从所有可能未使用的 4 位字符串的集合中生成一个随机的 4 位字符串吗？

如果是这样，正确的方法通常是生成所有可能的 4 位字符串，并将它们随机排列。然后按顺序排列它们，因为你需要新的。

**澄清：** 其他答案建议简单地生成一个随机的 4 位字符串并将其保留。大概您会检查它是否已被使用，如果已使用，则生成另一个。这有可能具有极其次优的性能。假设您已经使用了从 0000 到 9999 的 9,999 个（除一个之外的所有）可能的 4 位字符串。要生成最后一个，此方法可能需要多次尝试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T20:58:57.550

使用 short 类型创建一个包含所有 10000 个值的数组，然后对其进行[随机播放](http://dotnetperls.com/Content/Shuffle-Array.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T21:47:57.247

取决于你的要求。您预计会生成多少个？如果你只需要几百个，你可以生成一个 0 到 9999 的随机数。如果你希望生成所有 10,000 个，那么你应该像 Earwicker 所说的那样做，并维护一个所有未使用值的列表。

我建议你从最简单的算法开始（选择一个 1 到 9999 的随机数），然后一直使用它直到它太慢。然后回去并放入Earwicker's。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-05T20:56:04.703

生成四个从 0 到 9 的随机数，然后对它们进行字符串连接。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-03-05T20:58:09.240

```
Random randomNumberGenerator = new Random();
return string.Concat(
    randomNumberGenerator.Next(0, 9),
    randomNumberGenerator.Next(0, 9),
    randomNumberGenerator.Next(0, 9),
    randomNumberGenerator.Next(0, 9)); 
```

# database - 为什么 django 检查 settings.DATABASE_NAME db 是否确实存在用于运行测试用例？

> ID：616567
> 
> 赞同：3
> 
> 时间：2009-03-05T20:56:09.150
> 
> 标签：database, django, testing

我会经常为我的 django 项目运行测试用例。但是有一天，我突然想到 django 在运行测试用例时实际上检查了 settings.DATABASE_NAME db 的实际存在。为什么会这样。我以为 django 将采用 settings.DATABASE_NAME 并创建一个名为“test_”+ settings.DATABASE_NAME 的测试数据库。它还检查名称 = settings.DATABASE_NAME 的数据库是否实际存在（用于创建测试数据库）？理想情况下，应该只检查名称而不检查数据库的实际存在，对吗？

我浏览了 django 源代码，发现用于创建 testdb 的“连接”实际上是使用 DATABASE 设置选项创建的。它应该被设置的值而不是它们的实际存在所困扰。对？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T21:43:30.923

好问题……你知道，我从来没有想到过。简短的回答是 Django 本身**不需要**验证 DATABASE_NAME 是否确实存在，但它确实需要连接到数据库才能创建测试数据库。大多数数据库接受（并且有些需要）DATABASE_NAME 以制定连接字符串；这通常是因为您要连接的数据库名称会影响您的连接会话的权限。

因为 test 数据库还不存在，django 必须首先使用普通的 settings.DATABASE_NAME 连接才能创建 test 数据库。

所以，它是这样工作的：

*   Django 的测试运行器传递给特定于后端的数据库处理程序
*   特定于后端的数据库处理程序有一个调用的函数`create_test_db`，它将使用正常设置连接到数据库。它使用一个简单的`cursor = self.connection.cursor()`命令来执行此操作，该命令显然使用正常的设置值，因为这就是它所知道的目前存在的全部内容。
*   一旦连接到数据库，后端特定的处理程序将发出一个`CREATE DATABASE`带有新测试数据库名称的命令。
*   特定于后端的处理程序关闭连接，然后返回到测试运行程序，它将正常交换`settings.DATABASE_NAME`test_database_name
*   然后测试将正常运行。所有后续调用都`connection.cursor()`将使用正常的设置模块，但现在该模块已换出数据库名称
*   最后，测试运行程序在调用后端特定处理程序的`destroy_test_db`函数后恢复旧的数据库名称。

如果您有兴趣，主要部分的相关代码在 django.db.backends.creation 中。看看`_create_test_db`功能。

我想 Django 设计人员可以逐个数据库地进行例外处理，因为并非每个数据库都需要连接字符串中的当前数据库名称，但这需要进行一些重构。现在，该`create_test_db`函数实际上位于其中一个`backend`基类中，并且大多数实际的后端处理程序都不会覆盖它，因此有相当多的代码要推送到下游并在每个后端中复制。

# c++ - 工厂模式与全局状态不是一回事吗？

> ID：616573
> 
> 赞同：4
> 
> 时间：2009-03-05T20:56:35.013
> 
> 标签：c++, global-variables, factory, global

假设我有这样的课程：

```
猴鱼类
{
   MonkeyFish(GlobalObjectA & a, GlobalObjectB & b, GlobalObjectC & c);

   私人的：
     GlobalObjectA & m_a;
     GlobalObjectB & m_b;
     GlobalObjectC & m_c;
}

```

如果没有工厂，我需要执行以下操作才能实例化`MonkeyFish`.

```
全局对象A a；
全局对象B b;
全局对象 C c;

主函数（）
{
  MonkeyFish * monkey_fish = new MonkeyFish(a, b, c);
  猴子鱼->去（）；
}

```

另一方面，如果我有`MonkeyFishFactory`，似乎我必须这样做：

```
全局对象A a；
全局对象B b;
全局对象 C c;

主函数（）
{
  MonkeyFishFactory mf_factory(a, b, c);
  MonkeyFish * monkey_fish = mf_factory.buildMonkeyFish("Bob");
  猴子鱼->去（）；
}

```

1.  我仍然有全局对象。

2.  即使 MonkeyFishFactory 本身在`GlobalObjects`内部创建了（所以它们现在在 MonkeyFishFactory 内部而不是真正的全局变量中），看起来 MonkeyFishFactory**本身**仍然需要是一个全局对象，以便我可以随时访问它来创建一个`MonkeyFish`.

在这种情况下，工厂模式与全局状态不是一回事吗？

（我目前的假设是全局状态是一件坏事，消除它是一件好事。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T21:30:11.143

你在这里混淆概念吗？

当您返回隐藏在抽象接口后面的具体类的实例时，通常会应用工厂模式。这个想法是调用者将只看到接口，甚至不必知道对象的具体类型是什么。这一切都是关于基于参数创建对象实例，并将与决定创建什么对象相关的逻辑与创建对象的用户解耦。

您所描述的是 Singleton（或 MonoState）和 Factory 的混合物。你的工厂有状态，所以它不能变成静态的。在这种情况下，您将需要应用类似于 Singleton 模式的东西来控制单个 Factory 实例的创建，其中隐藏了适当的全局变量：

```
class IMonkeyFish {
public:
    virtual ~IMonkeyFish() = 0;
    virtual void go() = 0;
};

class Factory {
public:
    static Factory& instance();
    IMonkeyFish* createMonkeyFish();
protected:
    Factory(GlobalObjectA& a, GlobalObjectB& b, GlobalObjectC& c);
private:
    static Factory *theInstance;
    GlobalObjectA&  instanceOfA;
    GlobalObjectB&  instanceOfB;
    GlobalObjectC&  instanceOfC;
};

Factory& factory = Factory::instance();
IMonkeyFish* fishie = factory.createMonkeyFish();
fishie->go(); 
```

该`Singleton`模式控制工厂实例的创建。该`Factory`模式隐藏了围绕创建实现`IMonkeyFish`接口的对象的细节。好东西（TM）是隐藏全局状态并将`MonkeyFish`具体细节与创建实例解耦。

不过，使用这些东西的用法或正确性`Singleton`是另一个问题。可能还有一堆关于它的线程。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-05T21:01:22.133

全局状态本身并不是一件坏事。 **公共**全局状态是一件坏事。工厂模式有助于封装全局状态，这是一件好事。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-05T21:02:00.493

工厂中没有全局状态。它只是创建对象。由于它在工厂中没有任何状态。全球化是可以的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-05T21:03:03.813

您不必离开全局对象。猴鱼工厂应按需创建那些 GlobalOjectA|B|C。使用 switch 或 if inside 方法来确定是哪一个。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-05T21:20:12.850

您已经封装了对工厂中对象创建的控制。你希望你的实例化细节被隐藏起来，而不是在你需要新 MonkeyFish 的任何地方复制。想想测试、单一职责和得墨忒耳法则。为什么你的班级想要使用 MonkeyFish 需要了解构建一个 MonkeyFish 所需的工作。如果你想测试 MonkeyFish 怎么办？如果你没有封装创建细节，你会怎么做？

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-05T21:31:12.093

工厂类的工作是实例化一个对象并将其传回给调用者；不要选择使用哪个全局实例化对象。因此，您的工厂示例不正确。它应该是：

```
int main()
{
  MonkeyFish * monkey_fish = MonkeyFishFactory::buildMonkeyFish("Bob");
  monkey_fish->go();
} 
```

注意，没有全局对象，并且 MonkeyFishFactory 没有被实例化。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-05T21:23:03.750

我认为您正在考虑单例模式，而不是工厂模式。在单例模式中，你只有一个类的实例，这基本上使它相当于一个全局对象，除非它没有附加全局变量。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-05T21:35:22.050

如果你想得到一个好的答案，你应该说明你的约束和要求。要得到一个好的答案，最重要的是知道要问什么问题。

在您提供的代码片段中，您决定使用全局变量，但这与您是否使用工厂无关。如果您使用仍然依赖于这些全局变量的工厂，那么您只需将另一段代码与其余代码堆积起来。

尝试清楚地说明您要达到的目标，您可能会得到更好的答案。

# c# - 使用内联 SQL 语句而不是使用 DAL 设计时是否存在性能问题？

> ID：616577
> 
> 赞同：1
> 
> 时间：2009-03-05T20:57:53.357
> 
> 标签：c#, asp.net, sql

我创建了一个相当大的社交网络类型的网站，只使用内联 SQL 语句来访问数据库（我是该语言的新手，所以退后吧！）

与使用大量 XSD DataSet 文件来处理所有查询相比，以这种方式执行此操作是否存在任何性能问题？或者这只是糟糕的设计？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T21:00:19.170

我认为维护问题/成本会产生更大的影响，会比性能影响大得多（如果有任何性能影响的话）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T21:29:03.783

当您遇到真正的数据库性能问题时，您使用存储过程还是直接 SQL 语句并不重要（性能方面）。

在这种情况下，您最好的选择是首先避免使用 DB。换句话说，最好规划和构建一个**好的缓存机制**，因为当真正涉及到严重的流量时，这将产生重大影响。

存储过程或内联代码......再次，性能方面（我不是在谈论可维护性，安全性......）简单不再那么重要了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T21:05:23.340

如果是 SQL Server 将您的内联 SQL 语句更改为参数化调用 sp_ExecuteSQL 应该会产生非常显着的性能改进 - 并且可能比移动到存储过程而不是内联代码更容易重构。

IME 最终，返回多个记录集的存储过程（即执行多个工作/逻辑，而不仅仅是替换单个内联查询）将产生更多的性能改进。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T21:07:19.153

严格来说，如果使用内联 sql 语句而不是 XSD 数据集，SQL 性能会更好。这是假设您至少使用参数化查询（尽管 SQL Server 2005 甚至针对非参数化查询进行了优化）。

内联sql不能被数据库引擎优化的说法是不正确的。存储过程的优化与使用 SQL Server 的内联 sql 相同。

但从设计的角度来看，这是否有意义则完全是另一回事了。你是否过早地过度优化是另一个问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T21:09:32.800

远离生成的类型化数据集。表现不是那么好。如果您需要功能类型，请查看 LINQ；否则只需抓住企业库并直接进入。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-06T07:30:51.090

当拥有大量数据时，数据库在以下方面更好：维护和性能。例如，存储过程可以将工作和查询优化委托给专业的 DBA，无需重新编译。当拥有 XSD/XML 数据文件时，您必须为每次更改重新生成代码。

还要看看并发性：更多的用户，更多的网络请求，更多的并发性......你最终可能会在数据文件中锁定。您可以实施高级缓存机制以获得更高的性能，但这也是额外的维护和复杂性。

# c# - 如何在 C# 中获取当前可执行文件的名称？

> ID：616584
> 
> 赞同：391
> 
> 时间：2009-03-05T21:00:07.080
> 
> 标签：c#, command-line

我想获取当前正在运行的程序的名称，即程序的可执行名称。在 C/C++ 中，您可以从`args[0]`.

* * *

## 回答 #1

> 赞同：440
> 
> 时间：2009-03-05T21:33:15.393

```
System.AppDomain.CurrentDomain.FriendlyName 
```

* * *

## 回答 #2

> 赞同：288
> 
> 时间：2011-02-25T16:56:48.733

[`System.AppDomain.CurrentDomain.FriendlyName`](http://msdn.microsoft.com/en-us/library/system.appdomain.friendlyname.aspx)- 返回带有扩展名的文件名（例如 MyApp.exe）。

[`System.Diagnostics.Process.GetCurrentProcess().ProcessName`](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.processname.aspx)- 返回*不带*扩展名的文件名（例如 MyApp）。

[`System.Diagnostics.Process.GetCurrentProcess().MainModule.FileName`](http://msdn.microsoft.com/en-us/library/system.diagnostics.processmodule.modulename.aspx)- 返回完整路径和文件名（例如 C:\Examples\Processes\MyApp.exe）。然后，您可以将其传递给`System.IO.Path.GetFileName()`或`System.IO.Path.GetFileNameWithoutExtension()`实现与上述相同的结果。

* * *

## 回答 #3

> 赞同：111
> 
> 时间：2009-03-05T21:03:00.693

这应该足够了：

```
Environment.GetCommandLineArgs()[0]; 
```

* * *

## 回答 #4

> 赞同：110
> 
> 时间：2009-03-05T21:03:58.773

`System.Diagnostics.Process.GetCurrentProcess()`获取当前正在运行的进程。您可以使用该[`ProcessName`](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.processname.aspx)属性来确定名称。下面是一个示例控制台应用程序。

```
using System;
using System.Diagnostics;

class Program
{
    static void Main(string[] args)
    {
        Console.WriteLine(Process.GetCurrentProcess().ProcessName);
        Console.ReadLine();
    }
} 
```

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2012-06-20T13:12:43.053

这是对我有用的代码：

```
string fullName = Assembly.GetEntryAssembly().Location;
string myName = Path.GetFileNameWithoutExtension(fullName); 
```

上面的所有示例都给了我带有 vshost 的 processName 或正在运行的 dll 名称。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2009-03-05T21:01:49.340

试试这个：

```
System.Reflection.Assembly.GetExecutingAssembly() 
```

这将为您返回一个[`System.Reflection.Assembly`](https://docs.microsoft.com/en-us/dotnet/api/system.reflection.assembly)实例，其中包含您可能想知道的有关当前应用程序的所有数据。我认为该[`Location`](https://docs.microsoft.com/en-us/dotnet/api/system.reflection.assembly.location)物业可能会得到您特别追求的东西。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2014-04-24T12:52:45.007

为什么没有人建议这个，很简单。

```
Path.GetFileName(Application.ExecutablePath) 
```

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2011-01-02T22:05:13.547

更多选择：

*   `System.Reflection.Assembly.GetExecutingAssembly().GetName().Name`
*   `Path.GetFileName(System.Reflection.Assembly.GetExecutingAssembly().GetName().CodeBase`

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2013-04-09T14:06:23.833

```
System.Reflection.Assembly.GetExecutingAssembly().ManifestModule.Name; 
```

会给你你的应用程序的文件名，比如；“我的应用程序.exe”

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2016-04-29T17:25:11.330

如果您需要程序名称来设置防火墙规则，请使用：

```
System.Diagnostics.Process.GetCurrentProcess().MainModule.FileName 
```

这将确保在 VisualStudio 中调试和直接在 Windows 中运行应用程序时名称正确。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2010-01-26T16:08:42.677

*   `System.Reflection.Assembly.GetEntryAssembly().Location`如果程序集未从内存加载，则返回 exe 名称的位置。
*   `System.Reflection.Assembly.GetEntryAssembly().CodeBase`将位置作为 URL 返回。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2012-01-08T03:19:30.947

当不确定或有疑问时，绕圈跑，尖叫和喊叫。

```
class Ourself
{
    public static string OurFileName() {
        System.Reflection.Assembly _objParentAssembly;

        if (System.Reflection.Assembly.GetEntryAssembly() == null)
            _objParentAssembly = System.Reflection.Assembly.GetCallingAssembly();
        else
            _objParentAssembly = System.Reflection.Assembly.GetEntryAssembly();

        if (_objParentAssembly.CodeBase.StartsWith("http://"))
            throw new System.IO.IOException("Deployed from URL");

        if (System.IO.File.Exists(_objParentAssembly.Location))
            return _objParentAssembly.Location;
        if (System.IO.File.Exists(System.AppDomain.CurrentDomain.BaseDirectory + System.AppDomain.CurrentDomain.FriendlyName))
            return System.AppDomain.CurrentDomain.BaseDirectory + System.AppDomain.CurrentDomain.FriendlyName;
        if (System.IO.File.Exists(System.Reflection.Assembly.GetExecutingAssembly().Location))
            return System.Reflection.Assembly.GetExecutingAssembly().Location;

        throw new System.IO.IOException("Assembly not found");
    }
} 
```

我不能声称已经测试了每个选项，但它不会做任何愚蠢的事情，比如在调试会话期间返回虚拟主机。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-03-05T21:04:04.997

您可以使用[`Environment.GetCommandLineArgs()`](http://msdn.microsoft.com/en-us/library/system.environment.getcommandlineargs.aspx)获取参数并[`Environment.CommandLine`](http://msdn.microsoft.com/en-us/library/system.environment.commandline.aspx)获取输入的实际命令行。

此外，您可以使用[`Assembly.GetEntryAssembly()`](http://msdn.microsoft.com/en-us/library/system.reflection.assembly.getentryassembly.aspx)或[`Process.GetCurrentProcess()`](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.getcurrentprocess.aspx)。

但是，在调试时，您应该小心，因为最后一个示例可能会给出调试器的可执行文件名称（取决于您附加调试器的方式），而不是您的可执行文件，就像其他示例一样。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2013-03-14T06:01:29.360

如果您正在寻找可执行文件的完整路径信息，可靠的方法是使用以下内容：

```
 var executable = System.Diagnostics.Process.GetCurrentProcess().MainModule
                       .FileName.Replace(".vshost", ""); 
```

这消除了中间 dll、vshost 等的任何问题。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2018-05-23T08:03:41.663

如果您只需要没有扩展名的应用程序名称，则此方法有效：

```
Path.GetFileNameWithoutExtension(AppDomain.CurrentDomain.FriendlyName); 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-03-05T21:03:24.017

这是你想要的吗：

```
Assembly.GetExecutingAssembly ().Location 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2017-02-03T18:13:26.017

超级简单，看这里：

```
Environment.CurrentDirectory + "\\" + Process.GetCurrentProcess().ProcessName 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-03-31T21:53:32.573

在 .Net Core（或 Mono）上，当定义进程的二进制文件是 Mono 或 .Net Core（dotnet）的运行时二进制文件而不是您感兴趣的实际应用程序时，大多数答案都不适用。在这种情况下， 用这个：

```
var myName = Path.GetFileNameWithoutExtension(System.Reflection.Assembly.GetEntryAssembly().Location); 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2017-07-15T00:06:56.007

对于 Windows 应用程序（表单和控制台），我使用这个：

然后在 VS 中添加对 System.Windows.Forms 的引用：

```
using System.Windows.Forms;
namespace whatever
{
    class Program
    {
        static string ApplicationName = Application.ProductName.ToString();
        static void Main(string[] args)
        {
            ........
        }
    }
} 
```

无论我是在 VS 中运行实际的可执行文件还是调试，这对我来说都是正确的。

请注意，它返回不带扩展名的应用程序名称。

约翰

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2021-12-29T18:07:55.643

如果您在 .NET 6.0 或更高版本中发布单个文件应用程序，则可以使用[Environment.ProcessPath](https://docs.microsoft.com/en-us/dotnet/api/system.environment.processpath?view=net-6.0#System_Environment_ProcessPath)

* * *

## 回答 #21

> 赞同：-2
> 
> 时间：2020-02-07T21:05:03.793

获取路径和名称

System.Diagnostics.Process.GetCurrentProcess().MainModule.FileName

# .net - .NET 和 COM - 对象超出范围时的 Class_Terminate/Disposing

> ID：616586
> 
> 赞同：1
> 
> 时间：2009-03-05T21:00:21.323
> 
> 标签：.net, com, vb6, asp-classic

据我了解，对于 VB6 COM 对象，当它超出范围时，会立即在对象上调用 Class_Terminate 以允许它进行清理。

是否可以为 COM 调用的 .NET 对象提供相同的功能？

问题的背景基于 MSDN 文章：http: [//msdn.microsoft.com/en-us/library/aa479313.aspx](http://msdn.microsoft.com/en-us/library/aa479313.aspx)

这将 ASP 页中的 Session 对象替换为一个自定义对象，该对象通过利用 Class_Terminate 在页面完成后立即将 Session 信息序列化回数据库。

我想在 .NET 中实现该对象，但是由于 GC 不会立即调用终结器，这有点问题，因为我不想在序列化之前等待对象被清理进入数据库。

我可以只实现 IDisposiable 并在完成会话后手动调用 Dispose()，但这需要更改每个现有的 ASP 经典页面，而不仅仅是能够在标准包含文件中包含几行。

那么有没有办法在页面完成时自动调用代码来完成所需的工作？:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T21:04:34.573

代表团。将 .NET COM 类包装在作为外壳的 VB6 Com 类和包装器调用 dispose 的 Class_Terminate 事件中。

如果您不想在 VB6 COM 类中重新实现整个接口，那么您可以执行类似的操作

```
Public MyNETCOMObject as MyNETCOMObject

Private Class_Initialize()
  Set MyNETCOMObject = New MyNetCOMObject
End Sub

Private Class_Terminate()
  If Not MyNETCOMObject = Nothing then MyNETCOMObject.Dispose
  Set MyNETCOMObject = Nothing
End Sub 
```

# jakarta-ee - 正确：Java“企业”版 = Java“互联网”版？

> ID：616598
> 
> 赞同：1
> 
> 时间：2009-03-05T21:02:53.907
> 
> 标签：jakarta-ee, naming-conventions, enterprise, java

我正在阅读有关中间件、Spring、Hibernate 等方面的书籍，并且想知道为什么开发人员为 Java“web”或“internet”库发明了一个新名称，即“企业版”？由于我的心态比较个人化，“企业”版听起来就像“社会主义”版……我需要知道什么才能更好地区分？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T21:05:39.097

来自[韦氏词典](http://www.merriam-webster.com/dictionary/enterprise)：

> 主条目：**en·ter·prise**
> 
> 发音：\ˈen-tə(r)-ˌprīz\
> 
> **3 a：**经济组织或活动单位；*尤*指：商业组织

“企业”只是指 Java 中被认为是构建业务（或*企业*）应用程序（servlet、Web、持久性、数据库接口、应用程序框架等）的关键部分。

该名称将其与核心库区分开来。这里没有潜伏的社会主义！如果有的话，这就是资本家的爪哇。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T21:18:58.440

> “企业”版听起来很像“社会主义”版。

这对我来说是左场。我不知道如何从“企业”跳到“社会主义”。无论如何，J2EE（企业版）添加了对拥有大型数据库、许多客户端、附加安全约束等的大型企业最重要的特性。J2SE（标准版）是大多数人都熟悉的标准 Java“桌面应用程序”版本。

大多数 Java 程序员永远不会使用 J2EE，除非使用 Tomcat 或其他 JSP 和 Servlet 容器。按百分比计算，很少有 Java 程序员会使用任何类型的企业 bean，或添加到 J2EE 的任何可伸缩特性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T21:11:34.353

我通常认为 J2SE 用于常规 Java 应用程序（小程序、Swing、控制台等），而 J2EE 是“在容器中运行的东西”——JSP、Servlet、EJB 等。

有点简化，但这是两者之间的一般区别。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T21:25:50.873

您可以在企业的“内联网”上进行思考。

在**企业**中，您的系统可能会使用 Web 技术公开，而无需为此上网。

在**标准**版中，您不会获得任何那些“企业”功能（没有 jsp，没有应用程序服务器），只是库的核心。

**微型**版适用于手机等。

这些工具更适合“企业”环境，但它们不仅限于此。

您可以将 spring 用于桌面应用程序，或者将 Hibernate 用于本地数据库，但大多数时候，Hibernate 用于访问企业数据库。

所有这些（Spring、Hibernate 和许多其他工具）都不是 Java 平台核心的一部分，它们是第 3 方解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T21:25:54.490

这来自 Sun 的网站：

Java Platform, Standard Edition (Java SE) 允许您在桌面和服务器以及当今要求苛刻的嵌入式和实时环境中开发和部署 Java 应用程序。

Java Platform, Enterprise Edition (Java EE) 建立在 Java Platform, Standard Edition (Java SE) 的坚实基础之上，是实现企业级面向服务架构 (SOA) 和下一代 Web 应用程序的行业标准。

# java - HttpSession 线程安全吗，设置/获取属性线程安全操作吗？

> ID：616601
> 
> 赞同：55
> 
> 时间：2009-03-05T21:03:17.587
> 
> 标签：java, session, thread-safety, synchronized

此外，正在设置的对象是否必须是线程安全的，以保证我们知道存储在会话中的对象的状态是什么。

另外，我在网上阅读了一些建议使用的内容：

```
synchronized(session) {
  session.setAttribute("abc", "abc");
} 
```

这是一个有效的建议吗？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-03-05T21:34:53.830

Servlet 2.5 规范：

> 多个执行请求线程的 servlet 可以同时对同一个会话对象进行主动访问。容器必须确保以线程安全的方式执行表示会话属性的内部数据结构的操作。开发人员负责对属性对象本身进行线程安全访问。这将保护 HttpSession 对象内的属性集合免受并发访问，从而消除应用程序导致该集合损坏的机会。

这是安全的：

```
// guaranteed by the spec to be safe
request.getSession().setAttribute("foo", 1); 
```

这是**不安全**的：

```
HttpSession session = request.getSession();
Integer n = (Integer) session.getAttribute("foo");
// not thread safe
// another thread might be have got stale value between get and set
session.setAttribute("foo", (n == null) ? 1 : n + 1); 
```

这**不能**保证是安全的：

```
// no guarantee that same instance will be returned,
// nor that session will lock on "this"
HttpSession session = request.getSession();
synchronized (session) {
  Integer n = (Integer) session.getAttribute("foo");
  session.setAttribute("foo", (n == null) ? 1 : n + 1);
} 
```

我已经看到提倡的最后一种方法（包括在 J2EE 书籍中），但是 Servlet 规范不能保证它可以工作。您可以[使用会话 ID 创建 mutex](http://illegalargumentexception.blogspot.com/2008/04/java-synchronizing-on-transient-id.html)，但必须有更好的方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T21:22:50.317

不。并且由于您不希望同一个客户端（带有会话）进行并发请求，因此您应该像Spring MVC 中的[AbstractController那样序列化这些请求](http://static.springsource.org/spring/docs/current/javadoc-api//org/springframework/web/servlet/mvc/AbstractController.html#setSynchronizeOnSession%28boolean%29)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-05T21:27:20.807

在某些方面，这取决于您的客户端设计。

在您的网页设计中，您是否有机会让单个客户端使用同一个 HTTP 会话同时处理多个未完成的请求？除非您将单个 HTTP 会话绑定到多个套接字，否则这似乎很难做到。（又名，AJAX）如果不这样做，就服务器而言，给定客户端的 HTTP 访问将是单线程的，这意味着单个会话实际上是线程安全的。

会话对象的同步将使应用程序更安全地应对未来的变化，使您的 Web 应用程序能够同时处理多个请求，所以这不是一个坏主意。在现代 Java 实现中，同步没有以前与之相关的大成本，尤其是当同步通常没有竞争时。如果您的应用程序使用 AJAX，这意味着您希望对 Web 服务器有多个正在进行的同时请求，那么同步是必须的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T21:36:21.160

它们不是，但大多数情况下，您的客户端只会使用单个线程访问它们。

不同的客户端会有不同的线程，每个都有自己的 Session。

正如 Eddie 所指出的，您可能面临两个线程访问同一会话的一种情况是两个 ajax 调用试图修改同一会话属性。否则你不会有问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T21:27:27.140

会话不是线程安全的，get 和 set 方法都不能保证是线程安全的。通常，在 servlet 容器中，您应该假设处于多线程环境中，并且没有提供的工具是安全的。

这也适用于您存储在会话中的对象。会话本身不会操作存储的对象，但您可以在不同的线程中检索对象并尝试操作它。您可以检查自己的代码以查看是否可能出现竞争条件。

您发布的代码示例是有效的，但问题可能存在于您示例的有限范围之外。它确保在设置会话时没有条件，但没有什么能阻止其他线程覆盖该集合。如果您请求中的代码取决于保持不变的值，您仍然可能会遇到麻烦。

# .net - 使用数据源控件进行绑定的好处

> ID：616605
> 
> 赞同：2
> 
> 时间：2009-03-05T21:03:49.507
> 
> 标签：.net, asp.net

我已经开始学习数据源控件了

据我了解，使用数据源控件而不是使用常规数据绑定的唯一好处如下：

*   您不必编写数据访问逻辑（因此您不必创建 SqlCommand、SqlConnection 等，也不必创建 Datareader 或 DataSet）

*   您可以在 VS 设计器中看到哪些列将选择查询产生

*   您可以将参数绑定到其他控件

a) 使用数据源控件还有其他好处吗？

b) 至于数据源控件，可以让您摆脱编写数据访问逻辑的繁琐任务：难道数据源控件实际上最多可以让您编写 10 行代码吗？这真的那么有益还是我又错过了一些非常明显的东西？

再见

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T22:47:08.947

关于列出的好处：

“因此您不必创建 SqlCommand、SqlConnection 等”-linq2sql、实体框架或 [在此处插入一个好的 ORM] 可以更好地帮助您。假设您想在 ListView 中显示其前 3 名员工的公司，使用普通的旧 sql 查询并不能很好地快速启动它（并且工作正常，即不单独访问数据库以获得前 3 名员工您展示的每家公司）

额外的好处：你可以告诉它在那里缓存

将其与编写数据访问逻辑的繁琐任务进行比较：见上文 :)

附言。我个人的看法是，它肯定会将您推向一种代码与 UI 更紧密相关的模式。我将答案保留在更直接地解决问题的要点上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T21:10:24.730

我对“数据源”位的正常使用是为了更快地设置我的网格和表单。完成后，我将使用其他方法进行绑定，因为我不想要拖放 UI 共有的两个工件：

1.  将所有层合并到一个控件中
2.  依赖额外的 FUD 来保持应用程序正常运行

但是，使用数据源来设置 UI？是的，这很酷。在盒子外面？当然。:-)

我非常喜欢拖放来做平凡的事情，但我不喜欢把我困在盒子里的东西。

# reporting-services - 使用 SSRS 折线图在 y 轴上绘制时间段

> ID：616608
> 
> 赞同：0
> 
> 时间：2009-03-05T21:04:05.433
> 
> 标签：reporting-services, charts

我希望使用 SSRS 折线图来绘制作业的结束运行时间。我在 y 轴上使用运行时，在 x 轴上使用日期。该图看起来像一条平线，并且时间不会显示在 y 轴上，但会显示整数。

我还想在特定时间放一条目标线来显示我们的 SLA 时间。

这是我试图绘制的数据示例，但我想要一条线。

```
+-------+----------+
|   y   |    x     |
+-------+----------+
| 10:05 | 3/1/2009 |
| 11:00 | 3/2/2009 |
| 10:15 | 3/3/2009 |
+-------+----------+

+-------+----------+----------+----------+
| 11:00 |          |    x     |          |
| 10:45 |          |          |          |
| 10:30 |          |          |          |
| 10:15 |          |          |    x     |
| 10:00 |    x     |          |          |
+-------+----------+----------+----------+
|       | 3/1/2009 | 3/2/2009 | 3/3/2009 |
+-------+----------+----------+----------+ 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-07T20:22:25.127

假设您有带有日期和时间的表格时间。声明报告参数@LimitHourParam 十进制 - 用于目标时间。设置数据集查询：

```
SELECT Date, SUM(Hours) AS Hours, 'Actual Hours' AS LimitHour
FROM Times 
GROUP BY Date
UNION ALL
SELECT DISTINCT Date, @LimitHourParam AS Hours, 'Hours Limit' AS LimitHour
FROM Times 
```

因此，您将获得按日期分组的结果小时数以及每个唯一日期的小时数限制。

将图表控件放置在报表页面中。

转到图表属性-> 数据

按“添加值”
擦除标签的值并将值设置为

```
=Sum(Fields!Hours.Value) 
```

转到“编辑图表值”对话框的“点标签”选项卡，选中“显示点标签”，将数据标签设置为

```
= String.Format("{0}:{1}",  (Fields!Hours.Value / 1) - (Fields!Hours.Value Mod 1), (Fields!Hours.Value Mod 1)*60/1 - (Fields!Hours.Value Mod 1)*60 Mod 1) 
```

添加类别组，将“Group On”表达式设置为

```
=Fields!Date.Value 
```

添加系列组，将“Group On”表达式和标签值设置为

```
=Fields!LimitHour.Value 
```

转到图表属性-> X 轴，设置标签格式 dd/mm/yyyy

结果应如下所示： [![http://img9.imageshack.us/img9/3838/ssrschart.jpg](https://i.stack.imgur.com/pzXyS.jpg)](https://i.stack.imgur.com/pzXyS.jpg)

# neural-network - 从神经网络领域寻找有趣的话题

> ID：616621
> 
> 赞同：5
> 
> 时间：2009-03-05T21:07:17.250
> 
> 标签：neural-network

我正准备谈谈我从人工智能领域（神经网络）中选择的一些话题。我正在寻找一些有趣的东西，在现实生活中使用，最好不要太复杂（越简单，学生越容易理解，他们就会越感兴趣）。我认为这是一个寻求建议的好地方；）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T21:32:01.950

[将神经网络应用于文本识别的](http://www.codeproject.com/KB/dotnet/simple_ocr.aspx)代码。

我认为文本识别的概念很有趣并且可以理解。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T21:38:17.207

Toby Segaran 的有趣著作《[Programming Collective Intelligence](https://rads.stackoverflow.com/amzn/click/com/0596529325)》包含一个用于学习搜索结果相关性的简单神经网络示例。[他在他的网站](http://blog.kiwitobes.com/?p=44)上免费提供书中的代码。

神经网络在第 4 章代码中。不确定您是否可以在没有文字的情况下弄清楚代码 - 如果您不介意花一点钱，这本书肯定不会受到伤害。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T21:09:12.660

学习你的神经网络正弦波。这很简单。你只需要 4 个神经元。权重将清楚地显示它是如何工作的。正是这个例子让我点击了它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T18:11:29.630

（英文）维基百科关于“人工神经网络”的文章的“现实生活应用”[部分列出了神经网络的一些（相当普遍的）应用。](http://en.wikipedia.org/wiki/Artificial_neural_network#Real_life_applications)

# c# - 在 WPF 中显示“等待”屏幕

> ID：616629
> 
> 赞同：7
> 
> 时间：2009-03-05T21:08:38.683
> 
> 标签：c#, .net, wpf, multithreading, xaml

我正在尝试为长时间运行的操作显示请等待对话框。问题是因为这是单线程的，即使我告诉 WaitScreen 显示它永远不会。有没有办法可以更改该屏幕的可见性并使其立即显示？我以 Cursor 调用为例。在我调用 this.Cursor 之后，光标会立即更新。这正是我想要的行为。

```
private void Button_Click(object sender, RoutedEventArgs e)
{
  this.Cursor = System.Windows.Input.Cursors.Pen;
  WaitScreen.Visibility = Visibility.Visible;

  // Do something long here
  for (Int32 i = 0; i < 100000000; i++)
  {
    String s = i.ToString();
  }

  WaitScreen.Visibility = Visibility.Collapsed;
  this.Cursor = System.Windows.Input.Cursors.Arrow; 
} 
```

WaitScreen 只是一个 Z-index 为 99 的网格，我将其隐藏和显示。

更新：除非必须，否则我真的不想使用后台工作人员。代码中有很多地方会发生这种开始和停止。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-05T21:12:22.653

做单线程真的会很痛苦，而且它永远不会像你想要的那样工作。窗口最终会在 WPF 中变黑，程序将变为“无响应”。

我建议使用 BackgroundWorker 来完成您的长时间运行的任务。

没那么复杂。像这样的东西会起作用。

```
private void DoWork(object sender, DoWorkEventArgs e)
{
    //Do the long running process
}

private void WorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
{
    //Hide your wait dialog
}

private void StartWork()
{
   //Show your wait dialog
   BackgroundWorker worker = new BackgroundWorker();
   worker.DoWork += DoWork;
   worker.RunWorkerCompleted += WorkerCompleted;
   worker.RunWorkerAsync();
} 
```

然后，您可以根据需要查看 ProgressChanged 事件以显示进度（请记住将 WorkerReportsProgress 设置为 true）。如果您的 DoWork 方法需要一个对象（在 e.Argument 中可用），您还可以将参数传递给 RunWorkerAsync。

这确实是最简单的方法，而不是试图做单线程。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-05T21:22:08.150

我找到了一个方法！感谢[这个线程](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/6fce9b7b-4a13-4c8d-8c3e-562667851baa/)。

```
public static void ForceUIToUpdate()
{
  DispatcherFrame frame = new DispatcherFrame();

  Dispatcher.CurrentDispatcher.BeginInvoke(DispatcherPriority.Render, new DispatcherOperationCallback(delegate(object parameter)
  {
    frame.Continue = false;
    return null;
  }), null);

  Dispatcher.PushFrame(frame);
} 
```

该函数需要在长时间运行操作之前调用。这将强制 UI 线程更新。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-09-18T04:10:52.637

看看我对这个非常微妙的话题的综合研究。如果您无法提高实际性能，您可以选择以下选项来显示等待消息：

**选项#1**执行代码以与执行实际任务相同的方法同步显示等待消息。只需将这一行放在漫长的过程之前：

```
Dispatcher.CurrentDispatcher.Invoke(DispatcherPriority.Normal, (Action)(() => { /* Your code to display a waiting message */ })); 
```

它将在*Invoke()*结束时处理主调度程序线程上的待处理消息。

*注意：*[这里](https://stackoverflow.com/a/10449345/888052)解释了选择 Application.Current.Dispatcher 但 Dispatcher.CurrentDispatcher 的原因。

**选项 #2**显示“等待”屏幕并更新 UI（处理待处理消息）。

为此，*WinForms*开发人员执行了[Application.DoEvents](http://msdn.microsoft.com/en-au/library/system.windows.forms.application.doevents.aspx)方法。WPF 提供了两种替代方案来实现类似的结果：

**选项 #2.1**使用[DispatcherFrame 类](http://msdn.microsoft.com/en-au/library/system.windows.threading.dispatcherframe.aspx)。

[检查来自MSDN](http://msdn.microsoft.com/en-au/library/system.windows.threading.dispatcherframe.aspx)的一个有点笨重的例子：

```
[SecurityPermissionAttribute(SecurityAction.Demand, Flags = SecurityPermissionFlag.UnmanagedCode)]
public void DoEvents()
{
    DispatcherFrame frame = new DispatcherFrame();
    Dispatcher.CurrentDispatcher.BeginInvoke(DispatcherPriority.Background, new DispatcherOperationCallback(ExitFrame), frame);
    Dispatcher.PushFrame(frame);
}

public object ExitFrame(object f)
{
    ((DispatcherFrame)f).Continue = false;
    return null;
} 
```

**选项#2.2**调用一个空动作

```
Dispatcher.CurrentDispatcher.Invoke(DispatcherPriority.Background, (Action)(() => { })); 
```

[在此处](http://social.msdn.microsoft.com/Forums/vstudio/en-US/6fce9b7b-4a13-4c8d-8c3e-562667851baa/forcing-update-of-ui-before-my-function-exits)查看哪个（2.1 或 2.2）更好的讨论。恕我直言，选项 #1 仍然比 #2 好。

**选项#3**在单独的窗口中显示等待消息。

当您显示的不是简单的等待消息而是动画时，它会派上用场。在我们等待另一个长时间的渲染操作完成的同时渲染加载动画是一个问题。基本上，我们需要两个渲染线程。您不能在单个窗口中拥有多个渲染线程，但您可以将加载动画放在具有自己的渲染线程的新窗口中，并使其看起来不是一个单独的窗口。

从[这个 github](https://github.com/graeme-hill/gblog/tree/master/www/resources/samples)下载*WpfLoadingOverlay.zip*（它是文章“ *WPF 响应性：渲染期间的异步加载动画*”的示例，但我在 Web 上找不到它了）或者看看下面的主要思想：

 *```
public partial class LoadingOverlayWindow : Window
{
    /// <summary>
    ///     Launches a loading window in its own UI thread and positions it over <c>overlayedElement</c>.
    /// </summary>
    /// <param name="overlayedElement"> An element for overlaying by the waiting form/message </param>
    /// <returns> A reference to the created window </returns>
    public static LoadingOverlayWindow CreateAsync(FrameworkElement overlayedElement)
    {
        // Get the coordinates where the loading overlay should be shown
        var locationFromScreen = overlayedElement.PointToScreen(new Point(0, 0));

        // Launch window in its own thread with a specific size and position
        var windowThread = new Thread(() =>
            {
                var window = new LoadingOverlayWindow
                    {
                        Left = locationFromScreen.X,
                        Top = locationFromScreen.Y,
                        Width = overlayedElement.ActualWidth,
                        Height = overlayedElement.ActualHeight
                    };
                window.Show();
                window.Closed += window.OnWindowClosed;
                Dispatcher.Run();
            });
        windowThread.SetApartmentState(ApartmentState.STA);
        windowThread.Start();

        // Wait until the new thread has created the window
        while (windowLauncher.Window == null) {}

        // The window has been created, so return a reference to it
        return windowLauncher.Window;
    }

    public LoadingOverlayWindow()
    {
        InitializeComponent();
    }

    private void OnWindowClosed(object sender, EventArgs args)
    {
        Dispatcher.InvokeShutdown();
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-05T21:35:13.643

另一种选择是将长时间运行的例程编写为返回`IEnumerable<double>`以指示进度的函数，然后说：

```
yield return 30; 
```

例如，这将表明完成了 30%。然后，您可以使用 WPF 计时器在“后台”中将其作为协作协程执行。

[这里有一些详细的描述，带有示例代码。](http://incrediblejourneysintotheknown.blogspot.com/2008/04/coroutines-with-ienumerable-and-yield.html)

# c# - 在 .NET ThreadPool.QueueUserWorkItem 中使用匿名委托

> ID：616634
> 
> 赞同：6
> 
> 时间：2009-03-05T21:09:36.230
> 
> 标签：c#, closures

我打算发布一个问题，但提前弄清楚并决定发布问题和答案 - 或者至少是我的观察结果。

当使用匿名委托作为 WaitCallback 时，在 foreach 循环中调用 ThreadPool.QueueUserWorkItem 时，似乎将相同的一个 foreach-value 传递到每个线程。

```
List< Thing > things = MyDb.GetTheThings();
foreach( Thing t in Things)
{
    localLogger.DebugFormat( "About to queue thing [{0}].", t.Id );
    ThreadPool.QueueUserWorkItem(
        delegate()
        {
            try
            {
                WorkWithOneThing( t );
            }
            finally
            {
                Cleanup();
                localLogger.DebugFormat("Thing [{0}] has been queued and run by the delegate.", t.Id ); 
            }
        });
 } 
```

对于 Things 中 16 个 Thing 实例的集合，我观察到传递给 WorkWithOneThing 的每个“Thing”都对应于“things”列表中的最后一项。

我怀疑这是因为委托正在访问“t”外部变量。请注意，我还尝试将 Thing 作为参数传递给匿名委托，但行为仍然不正确。

当我重构代码以使用命名的 WaitCallback 方法并将 Thing 't' 传递给该方法时，瞧……Thing 的第 i 个实例被正确传递到 WorkWithOneThing。

我猜是并行性的一课。我还想象 Parallel.For 家族解决了这个问题，但此时该库不是我们的选择。

希望这可以节省其他人一些时间。

霍华德霍夫曼

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T21:11:32.903

这是正确的，并描述了 C# 如何在闭包内捕获外部变量。这不是关于并行性的直接问题，而是关于匿名方法和 lambda 表达式的问题。

[这个问题](https://stackoverflow.com/questions/512166/cthe-foreach-identifier-and-closures)详细讨论了这种语言特性及其含义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T21:13:12.230

这在使用闭包时很常见，在构造 LINQ 查询时尤其明显。闭包引用变量，而不是其内容，因此，为了使您的示例正常工作，您只需在循环内指定一个变量，该变量取 t 的值，然后在闭包中引用它。这将确保您的匿名委托的每个版本都引用不同的变量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T21:15:11.833

下面是一个链接，详细说明了为什么会发生这种情况。它是为 VB 编写的，但 C# 具有相同的语义。

[http://blogs.msdn.com/jaredpar/archive/2007/07/26/closures-in-vb-part-5-looping.aspx](http://blogs.msdn.com/jaredpar/archive/2007/07/26/closures-in-vb-part-5-looping.aspx)

# sql-server - 将多个数据库迁移并合并为一个

> ID：616639
> 
> 赞同：-2
> 
> 时间：2009-03-05T21:11:21.297
> 
> 标签：sql-server, data-migration

在更新项目中，我必须执行以下操作：

将3个数据库从SQL2000移动到SQL2005，同时合并。SP 和视图中已经使用了相当多的跨数据库查询。当前计划是将每个旧数据库移动到 1 个数据库中的单独架构中。

这意味着我们还必须更改我们当前的 SP 和视图，我们现在有：

```
SELECT OrderId, OrderDate FROM Sales.dbo.Orders 
```

并期望我们将不得不将其更改为

```
SELECT OrderId, OrderDate FROM Sales.Orders 
```

问题是：我们如何尽可能自动化地做到这一点？

我知道 SED 和类似的更改脚本。我会欢迎有关如何对此“聪明”的提示，例如对脚本进行分区的策略、性能（大量的 INSERT INTO 行）等。

注意：我确实查看了导入/导出向导，但显然我必须在每个输出表上手动设置模式并通过 ALTER 脚本修复 SP。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-09T12:50:59.093

几年前我这样做了，我遇到了一些你想知道的问题。

假设：

*   您有一个带有 3 个数据库 A/B/C 的 SQL 2000 数据库服务器
*   您希望所有对象都以数据库 A 中的 SQL 2005 结束（我们将其称为目标）
*   您希望最终摆脱数据库 B 和 C（旧的 Sources）
*   您没有一个成熟的测试环境，您可以每天自动恢复生产数据库，并一次又一次地编写脚本，直到它正确为止。（这是最好的方法，我也采用了这种方法，但它是劳动密集型的。）

这是我的惨痛教训：

**不要在同一天进行合并和 SQL 2005 更改。**在您进入 2005 年之前或之后进行合并，但不要试图在一次中断中完成所有操作。这将是一个相互指责的混乱。如果是我，我会先去 2005 年，只是为了不碍事。这样，我知道任何中断都不是因为架构更改，并且这些类型的中断更容易修复。在宣布胜利并继续进行合并之前，您需要在 2005 盒子上至少有一周的最终用户活动。

**提前在 Target 中构建新对象。**即使它们没有在您的现场制作应用程序中被查询，也请立即构建它们。这样您就可以在其中填充虚假的测试数据以提前测试您的应用程序。是的，这意味着混合实时数据和测试数据，但坦率地说，您已经在没有网络的情况下工作了。但是，请注意身份字段，因为您最终可能会得到具有相同身份编号但目标和源数据库中的数据不同的记录冲突。

**提前在 Target 中创建视图。**您提到您有已经执行跨数据库查询的视图。现在将它们从 Source 复制到 Target，并告诉任何其他开发人员（报告人员、高级用户）开始引用 Target 视图。这不会加快您自己的工作，但会加快他们的工作。如果您可以验证它们是否仅命中 Target（即使 Target 视图仍指向 Source 中的表），那么它将使迁移当天的故障排除变得更容易。然后，您可以提前开始拒绝对源视图的权限。

**提前同步表格。** 列出需要从源中移出的所有表，并为每个表分析它是如何更新的。如果它只是被插入（未更新或删除），例如日志表，则编写一个 T-SQL 脚本以开始使其在 Target 中保持同步。在服务器上的低活动期间（例如每晚）通过 SQL 代理作业运行该脚本。这样，在上线日时，您不必推送尽可能多的记录，这意味着您的上线窗口将更小，并且您的 Target 事务日志可以保持更小。不断更新或删除的表格并不容易，您是否决定同步这些表格取决于您。我们对任何超过一百万行的表格都这样做了。

**检查源数据库之间的记录冲突。**听起来这个不适用于您，但我在这里指出，以防其他人进行合并并且他们正在阅读它以获取提示。如果您有多个 Source 数据库，请转储对象列表。如果您有两个具有相同名称的对象，请检查它们的架构。我曾处理过在每个数据库中都有一个 State 或 Region 表的实例，它们应该是相同的，但它们的主键具有标识字段。每个子表（如客户，它链接到区域表）通过主键（身份字段）引用父表（区域） - 从一个数据库到另一个数据库不匹配。在这种情况下，明智的做法是在迁移前提前一个中断窗口，使用手动更新脚本清理这些记录。

1.  禁用任何约束或外键关系
2.  更改身份字段（如果它们是查找表，您可以关闭身份内容并使用手动指定的 pk 编号运行）
3.  修改 Region 表以添加一个 NewID 字段，匹配它将成为什么，以及一个 OldID 字段，显示它曾经是什么
4.  更新所有子表（客户）以使用 NewID 编号而不是原始编号
5.  更新 Region 表，使真实 ID 字段现在具有 NewID 值，而 OldID 字段具有以前的 Region 值。（你可能会搞砸一些事情，比如想念一张你不知道的儿童桌，你会想知道它曾经是什么。）

**将迁移分解成碎片。**列出所有数据库中的每个存储过程。如果其中任何一个可以在不移动数据的情况下移动，请先执行此操作。例如，如果您有 Source.dbo.usp_RunReport，并且它仅引用目标数据库中的表，则在第一阶段执行此操作。如果您有仅在应用程序内部使用的小型系统查找表，对客户或报告不可见，那么也将其放在第一阶段。听起来它太小了，无法打扰，但这个想法是为了减少迁移日的恐慌。您想知道的越少，您就越能排除故障。我们提前移动了每个静态查找表（州、地区、日历等）。第 1 阶段所需的工作量 - 只是移动那些小的静态表格 - 让管理层了解移动其余部分的工作量有多大，

**预增长 Target 的数据文件。**如果您没有使用 SQL 2005 的新即时文件初始化，那么数据文件的增长需要相当长的时间。如果您有选择，请启用即时文件初始化，然后增长数据文件以确保它们没有碎片化。如果它们只是在您迁移的那一天自然生长，它们可能会变得支离破碎。如果您不能使用即时文件初始化，您仍然需要预先增长文件，但您希望在活动较少的期间提前执行此操作以加快维护窗口。

**在迁移当天，一次运行一个表，或者更小。** 您希望尽可能严格地保持插入事务。插入事务越小，事务日志中所需的空间就越少。请记住，即使在简单模式下，事务日志也会随着插入语句增长。在每一轮插入之后，进行完整性检查以确保它们正常工作，并且您不会用完数据文件或 t-log 文件的驱动器空间。

**更新完成后，更改源数据库的安全性。**将每个非 SA 登录放入源数据库中的 dbdenydatareader 和 dbdenydatawriter 角色。这样，如果他们在连接字符串中硬编码了数据库名称，他们仍然可以登录，但他们将无法做任何事情。这也使您的故障排除变得更容易：如果应用程序或查询遇到问题，您可以考虑将他们的登录退出拒绝角色并查看它是否有效 - 如果有效，它就会失败。这样做的风险是他们可能会运行使用源数据库数据更新目标数据库的事务（从源获取客户，在目标中更新他们），这可能会导致问题。

源数据库的其他选项是：

*   重命名它们，这样您仍然可以查询它们，但应用程序不会触及它们
*   分离它们，但保持文件可用，以防您需要排除故障
*   删除所有登录名，并使用新登录名访问现有数据库以防万一。然后，如果某人的只读报告完全失效，您可以通过向他们发出新的登录名并告诉他们它指的是错误的数据库来让它暂时工作。

**更新完成后，在 Target 上重建索引和统计信息。**如果您只是在进行连续插入，这没什么大不了的，但是如果您要合并多个数据库（例如两个已分解为该国区域的销售数据库），那么您将需要清理.

**恕我直言，除非您能证明从多个模式中获益，否则请使用一种模式。**最后一个只是我的两分钱，但听起来您要经历大量工作才能从 3 个数据库（每个数据库 1 个模式）到 1 个数据库（具有 3 个模式）。如果您不太确定 3 模式的事情，您可能会考虑使用 1 模式 - 否则您将在以后的道路上再次进行混乱的返工。如果您有特定的安全需求，3 种模式确实有意义，但除此之外，只要确保您物有所值即可。现在将是进入一个模式的好时机。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T23:28:37.160

您可以试一试 Redgate SQL 比较和数据比较。他们有一个模式映射功能，应该让您将 dbo 模式映射到另一个中的销售模式，然后移动表和过程。这样您就不必弄乱 SQL 导出向导了。不过，您仍然需要重构您的其他对象。

我喜欢这两个工具。

* * *

编辑：我认为您也可以获得功能齐全的演示。

* * *

编辑：此外，他们提供 SQL Refactor，它可以“智能”重命名。分数！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T21:25:37.910

你能有一个名为 SALES 的虚拟数据库，它有一个名为 [Orders] 的视图：

```
CREATE VIEW Sales.dbo.Orders
AS
SELECT OrderId, OrderDate, ...
FROM CombinedDatabase.Sales.Orders 
```

进而

SELECT ... FROM Sales.dbo.Order

仍然可以工作。

但是，如果没有进一步的游戏，您将无法插入/更新该表。

如果你能有这样的 VIEWs 日志，它们被使用，这将使你能够修复调用它们的代码！但我想不出办法做到这一点；但是，您可以依次禁用每个测试，运行一些测试，修复任何损坏的部分，然后继续进行下一个...从而通过重构来根除它们，但在此过程中拥有一个大部分工作的应用程序。

我已经将 SED 用于这种类型的事情，但是我们的所有表和所有列都有唯一的名称，并且我们在应用程序中使用与数据库列名称匹配的变量名称 - 所以我很有信心将 xxx_yyy_ID 更改为我们的应用程序中的 aaa_bbb_ID 可以很好地工作，并且不会产生意外的副作用。

如果您有实际的列/表名称，例如“Sales”和“Orders”，我认为像 SED 这样的东西会有风险

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T22:26:19.057

好的，所以我对您的问题的基本理解是这样的：

1.  您拥有三个不同的数据库（即 Sales、Manu、Inventory）
2.  它们具有不同的表和过程名称（Manu 或 Inventory 中不存在 Sales 中的表/过程名称）
3.  您希望所有三个数据库中的所有表/过程都在一个数据库中（即 SaleManInv）
4.  每个数据库中的一些存储过程显式引用其他数据库中的表（即 Sales.dbo.lookupItem() 显式引用 Inventory.dbo.Items 表）

导出和导入表似乎不是问题，我会为 procs 做什么：

1.  将一个 proc 从 SQL Server 2000 db 导出到 SQL Server 2005 DB，以确定是否需要删除“.dbo”。交叉引用的一部分。
2.  将所有 procs 导出到文本文件（所有 procs 的同一文件夹）
3.  使用带有“在文件中搜索和替换”的文本编辑器（我使用 PSPAD）并替换所有“Sales.dbo”。使用“SaleManInv.dbo.”，然后是所有“Iventory.dbo”。使用“SameManInv.dbo”。等将所有引用转换为新数据库。
4.  然后将导出和修改的 procs 运行到您的新数据库中。

这有什么意义吗？:-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-10-05T15:11:13.820

我处于类似的位置，我有几个 SQL Server 2008 数据库被合并为 1。我的解决方案是使用 Integration Services 的传输服务器对象任务到一个新的目标数据库中。所有数据都与表格一起复制。之后 - 在一个非常复杂的查询中，我编写了所有存储过程/函数/视图/等的脚本。到一个文件并更改所有跨数据库引用并重新创建存储过程和其他对象。

存储过程的技巧是按顺序或 syscontraints 编写脚本，以确保最后创建内部引用其他存储过程/函数的存储过程或函数。

如果有一个我觉得可以以自动化方式处理这项任务的工具，我会立即购买它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T21:47:23.567

我想知道它是否是同一种数据。反正。我将创建一个名为“SourceSystem”的新列。所以当老板追上来时：

“ - 2004 年 databasesystem1 和 db2 之间的销售差异是多少”。

那你就可以回答了。然后在一两年内，如果这些问题没有出现。您可以删除该列。合并数据会删除数据的来源。

# gimp - 如何复制 The Gimp 中的指导线？

> ID：616644
> 
> 赞同：1
> 
> 时间：2009-03-05T21:11:47.600
> 
> 标签：gimp, script-fu

是否可以将引导线从一张图像复制到另一张图像？
我需要这个，因为我有几张图像需要完全相同的构图，所以我想为此使用指南。
没有选择和复制指南的选项，所以我必须手动添加它们。

如果有一个小的 script-fu 脚本，那就太好了。

好的，我发现了一些有趣的功能：

```
(gimp-image-find-next-guide image index)
(gimp_image_add_hguide image xposition)
(gimp_image_add_vguide image yposition)
(gimp_image_get_guide_orientation image guide)
(gimp_image_get_guide_position image guide) 
```

提前致谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-13T01:09:49.703

我真的很想帮助你，但我不确定我是否理解你想要做什么。您能否编辑问题以提供更多详细信息？

猜测一下（等待更多信息）你在寻找这样的东西吗？

```
guide = 0
while guide = gimp_image_find_next_guide (image_1,guide) != 0
     position = gimp_image_get_guide_position (image_1,guide)
     if gimp_image_get_guide_orientation (image_1,guide) == 0
          gimp_image_add_hguide (image_2,position)
        else
          gimp_image_add_vguide (image_2,position) 
```

请注意，这是伪代码，因为您提到的函数似乎是 API 的一部分，该 API 使用的语法不是 scheme-ish 脚本 fu。

但第一个问题是*你想要完成什么？*-- 之后我们可以担心如何做的细节。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-03-06T17:17:04.457

一直想学习 Gimp Scripts (PythonFu) 并需要这个功能，我使用了 MarkusQ 提供的伪代码和这个方便的教程[https://jacksonbates.wordpress.com/python-fu-gimp-scripting-tutorial-pages /](https://jacksonbates.wordpress.com/python-fu-gimp-scripting-tutorial-pages/)创建一个脚本以将指南从一个图像复制到另一个图像。

```
#!/usr/bin/env python

from gimpfu import *

def CopyGuidelines(image_1, drawable, image_2):     
    guide = pdb.gimp_image_find_next_guide(image_1, 0)
    while guide != 0 :
        position = pdb.gimp_image_get_guide_position (image_1,guide)        
        if pdb.gimp_image_get_guide_orientation (image_1,guide) == 0:
            pdb.gimp_image_add_hguide (image_2,position)
        else:
            pdb.gimp_image_add_vguide (image_2,position)
        guide = pdb.gimp_image_find_next_guide (image_1,guide)      

register(
    "python-fu-CopyGuidelines",
    "Copy Guidelines",
    "Copy Guidelines from one image to another",
    "Anthony", "JustAGuyCoding", "2017",
    "Copy Guidelines",
    "", # type of image it works on (*, RGB, RGB*, RGBA, GRAY etc...)
    [
        (PF_IMAGE, "image_1", "takes current image", None),
        (PF_DRAWABLE, "drawable", "Input layer", None),
        (PF_IMAGE, "image_2", "takes other image", None)
    ],
    [],
    CopyGuidelines, menu="<Image>/Tools")  

main() 
```

您需要将其复制到 CopyGuidelines.py 文件中，并将其放入 Gimp 的插件目录（请参阅 Preferences > Folders ）并重新启动 Gimp 以查看 Tools 下的 CopyGuideline 选项。然后打开两张图片，选择带有指南的一张并选择 CopyGuidelines 以运行脚本。

# python - 如何将 sys.stdout 复制到日志文件？

> ID：616645
> 
> 赞同：161
> 
> 时间：2009-03-05T21:12:13.400
> 
> 标签：python, tee

编辑：因为似乎没有解决方案，或者我正在做一些非常不标准的事情以至于没人知道 - 我会修改我的问题来问：当 python 应用程序正在制作时，完成日志记录的最佳方法是什么？很多系统调用？

我的应用程序有两种模式。在交互模式下，我希望所有输出到屏幕以及日志文件，包括来自任何系统调用的输出。在守护程序模式下，所有输出都进入日志。守护程序模式使用`os.dup2()`. 在不修改每个系统调用的情况下，我找不到一种将所有输出“发送”到交互模式下的日志的方法。

* * *

换句话说，我希望命令行 'tee' 的功能适用于 python 应用程序生成的任何输出，**包括系统调用 output**。

澄清：

为了重定向所有输出，我做了这样的事情，效果很好：

```
# open our log file
so = se = open("%s.log" % self.name, 'w', 0)

# re-open stdout without buffering
sys.stdout = os.fdopen(sys.stdout.fileno(), 'w', 0)

# redirect stdout and stderr to the log file opened above
os.dup2(so.fileno(), sys.stdout.fileno())
os.dup2(se.fileno(), sys.stderr.fileno()) 
```

这样做的好处是它不需要来自其余代码的特殊打印调用。该代码还运行一些 shell 命令，因此不必单独处理它们的每个输出也很好。

简单地说，我想做同样的事情，除了*复制*而不是重定向。

起初，我认为简单地反转`dup2`'s 应该可以工作。为什么不呢？这是我的测试：

```
import os, sys

### my broken solution:
so = se = open("a.log", 'w', 0)
sys.stdout = os.fdopen(sys.stdout.fileno(), 'w', 0)

os.dup2(sys.stdout.fileno(), so.fileno())
os.dup2(sys.stderr.fileno(), se.fileno())
###

print("foo bar")

os.spawnve("P_WAIT", "/bin/ls", ["/bin/ls"], {})
os.execve("/bin/ls", ["/bin/ls"], os.environ) 
```

文件“a.log”应该与屏幕上显示的相同。

* * *

## 回答 #1

> 赞同：149
> 
> 时间：2009-03-05T21:24:48.473

我之前遇到过同样的问题，发现这个片段非常有用：

```
class Tee(object):
    def __init__(self, name, mode):
        self.file = open(name, mode)
        self.stdout = sys.stdout
        sys.stdout = self
    def __del__(self):
        sys.stdout = self.stdout
        self.file.close()
    def write(self, data):
        self.file.write(data)
        self.stdout.write(data)
    def flush(self):
        self.file.flush() 
```

来自： http: [//mail.python.org/pipermail/python-list/2007-May/438106.html](http://mail.python.org/pipermail/python-list/2007-May/438106.html)

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2009-03-05T21:21:21.070

**该`print`语句将调用`write()`您分配给 sys.stdout 的任何对象的方法。**

我会开设一个小班，一次写到两个地方……

```
import sys

class Logger(object):
    def __init__(self):
        self.terminal = sys.stdout
        self.log = open("log.dat", "a")

    def write(self, message):
        self.terminal.write(message)
        self.log.write(message)  

sys.stdout = Logger() 
```

**现在该`print`语句将回显到屏幕并附加到您的日志文件中：**

```
# prints "1 2" to <stdout> AND log.dat
print "%d %d" % (1,2) 
```

这显然是快速而肮脏的。一些注意事项：

*   您可能应该参数化日志文件名。
*   `<stdout>`如果您在程序期间不进行日志记录，您可能应该将 sys.stdout 恢复为。
*   您可能希望能够一次写入多个日志文件，或处理不同的日志级别等。

这些都很简单，我很乐意将它们作为练习留给读者。这里的关键见解是`print`只调用分配给`sys.stdout`.

* * *

## 回答 #3

> 赞同：65
> 
> 时间：2009-03-05T21:31:47.817

您真正想要的是`logging`标准库中的模块。创建一个记录器并附加两个处理程序，一个将写入文件，另一个写入 stdout 或 stderr。

有关详细信息，请参阅 [记录到多个目标](https://docs.python.org/3/howto/logging-cookbook.html#multiple-handlers-and-formatters)

* * *

## 回答 #4

> 赞同：62
> 
> 时间：2009-03-16T19:00:09.473

由于您很乐意从代码中生成外部进程，因此您可以使用`tee`它自己。我不知道有任何 Unix 系统调用能完全做到这`tee`一点。

```
# Note this version was written circa Python 2.6, see below for
# an updated 3.3+-compatible version.
import subprocess, os, sys

# Unbuffer output (this ensures the output is in the correct order)
sys.stdout = os.fdopen(sys.stdout.fileno(), 'w', 0)

tee = subprocess.Popen(["tee", "log.txt"], stdin=subprocess.PIPE)
os.dup2(tee.stdin.fileno(), sys.stdout.fileno())
os.dup2(tee.stdin.fileno(), sys.stderr.fileno())

print "\nstdout"
print >>sys.stderr, "stderr"
os.spawnve("P_WAIT", "/bin/ls", ["/bin/ls"], {})
os.execve("/bin/ls", ["/bin/ls"], os.environ) 
```

`tee`您还可以使用[multiprocessing](http://docs.python.org/dev/library/multiprocessing.html)包进行模拟（如果您使用的是 Python 2.5 或更早版本，则使用[处理）。](http://pypi.python.org/pypi/processing)

**更新**

这是一个 Python 3.3+ 兼容的版本：

```
import subprocess, os, sys

tee = subprocess.Popen(["tee", "log.txt"], stdin=subprocess.PIPE)
# Cause tee's stdin to get a copy of our stdin/stdout (as well as that
# of any child processes we spawn)
os.dup2(tee.stdin.fileno(), sys.stdout.fileno())
os.dup2(tee.stdin.fileno(), sys.stderr.fileno())

# The flush flag is needed to guarantee these lines are written before
# the two spawned /bin/ls processes emit any output
print("\nstdout", flush=True)
print("stderr", file=sys.stderr, flush=True)

# These child processes' stdin/stdout are 
os.spawnve("P_WAIT", "/bin/ls", ["/bin/ls"], {})
os.execve("/bin/ls", ["/bin/ls"], os.environ) 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2013-05-14T19:52:43.810

这是另一种解决方案，它比其他解决方案更通用——它支持将输出（写入`sys.stdout`）拆分为任意数量的类似文件的对象。不要求`__stdout__`包含它本身。

```
import sys

class multifile(object):
    def __init__(self, files):
        self._files = files
    def __getattr__(self, attr, *args):
        return self._wrap(attr, *args)
    def _wrap(self, attr, *args):
        def g(*a, **kw):
            for f in self._files:
                res = getattr(f, attr, *args)(*a, **kw)
            return res
        return g

# for a tee-like behavior, use like this:
sys.stdout = multifile([ sys.stdout, open('myfile.txt', 'w') ])

# all these forms work:
print 'abc'
print >>sys.stdout, 'line2'
sys.stdout.write('line3\n') 
```

注意：这是一个概念验证。这里的实现并不完整，因为它只包装了类似文件的对象（例如）的*方法*`write`，而忽略了成员/属性/setattr 等。但是，对于目前的大多数人来说，它可能已经足够好了。

我喜欢它的地方，除了它的通用性之外，它是干净的，因为它不会直接调用`write`, `flush`,`os.dup2`等。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2010-02-07T09:20:32.327

如其他地方所述，也许最好的解决方案是直接使用日志记录模块：

```
import logging

logging.basicConfig(level=logging.DEBUG, filename='mylog.log')
logging.info('this should to write to the log file') 
```

但是，在某些（罕见的）情况下，您*确实想要*重定向标准输出。当我扩展使用 print 的 django 的 runserver 命令时，我遇到了这种情况：我不想破解 django 源，但需要打印语句才能进入文件。

这是一种使用 logging 模块将 stdout 和 stderr 重定向到 shell 之外的方法：

```
import logging, sys

class LogFile(object):
    """File-like object to log text using the `logging` module."""

    def __init__(self, name=None):
        self.logger = logging.getLogger(name)

    def write(self, msg, level=logging.INFO):
        self.logger.log(level, msg)

    def flush(self):
        for handler in self.logger.handlers:
            handler.flush()

logging.basicConfig(level=logging.DEBUG, filename='mylog.log')

# Redirect stdout and stderr
sys.stdout = LogFile('stdout')
sys.stderr = LogFile('stderr')

print 'this should to write to the log file' 
```

如果您确实不能直接使用日志记录模块，则应仅使用此 LogFile 实现。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2014-07-05T05:24:52.240

我知道这个问题已被反复回答，但为此我从[John T 的](https://stackoverflow.com/a/616686)回答中获取了主要答案并对其进行了修改，使其包含建议的刷新并遵循其链接的修订版本。我还添加了[cladmi 的](https://stackoverflow.com/a/17942748)答案中提到的进入和退出，以便与 with 语句一起使用。此外，[文档](http://docs.python.org/2/library/stdtypes.html#file.flush)提到使用刷新文件，`os.fsync()`所以我也添加了它。我不知道你是否*真的*需要它，但它就在那里。

```
import sys, os

class Logger(object):
    "Lumberjack class - duplicates sys.stdout to a log file and it's okay"
    #source: https://stackoverflow.com/q/616645
    def __init__(self, filename="Red.Wood", mode="a", buff=0):
        self.stdout = sys.stdout
        self.file = open(filename, mode, buff)
        sys.stdout = self

    def __del__(self):
        self.close()

    def __enter__(self):
        pass

    def __exit__(self, *args):
        self.close()

    def write(self, message):
        self.stdout.write(message)
        self.file.write(message)

    def flush(self):
        self.stdout.flush()
        self.file.flush()
        os.fsync(self.file.fileno())

    def close(self):
        if self.stdout != None:
            sys.stdout = self.stdout
            self.stdout = None

        if self.file != None:
            self.file.close()
            self.file = None 
```

然后你可以使用它

```
with Logger('My_best_girlie_by_my.side'):
    print("we'd sing sing sing") 
```

或者

```
Log=Logger('Sleeps_all.night')
print('works all day')
Log.close() 
```

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2013-07-30T09:07:29.150

完成 John T 的回答：[https ://stackoverflow.com/a/616686/395687](https://stackoverflow.com/a/616686/395687)

我添加了将其用作带有关键字的上下文管理器的方法，它给出了这段`__enter__`代码`__exit__``with`

```
class Tee(object):
    def __init__(self, name, mode):
        self.file = open(name, mode)
        self.stdout = sys.stdout
        sys.stdout = self

    def __del__(self):
        sys.stdout = self.stdout
        self.file.close()

    def write(self, data):
        self.file.write(data)
        self.stdout.write(data)

    def __enter__(self):
        pass

    def __exit__(self, _type, _value, _traceback):
        pass 
```

然后它可以用作

```
with Tee('outfile.log', 'w'):
    print('I am written to both stdout and outfile.log') 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2010-08-06T11:39:55.580

我用 Python 编写了一个`tee()`适用于大多数情况的实现，它也适用于 Windows。

[https://github.com/pycontribs/tendo](https://github.com/pycontribs/tendo)

`logging`此外，如果需要，您可以将它与Python中的模块结合使用。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2009-03-15T18:49:54.890

（啊，只需重新阅读您的问题，发现这并不完全适用。）

[这是一个使用python logging 模块](http://docs.python.org/library/logging.html)的示例程序。自 2.3 以来，此日志记录模块已存在于所有版本中。在此示例中，日志记录可通过命令行选项进行配置。

在相当模式下，它只会记录到文件，在正常模式下，它会同时记录到文件和控制台。

```
import os
import sys
import logging
from optparse import OptionParser

def initialize_logging(options):
    """ Log information based upon users options"""

    logger = logging.getLogger('project')
    formatter = logging.Formatter('%(asctime)s %(levelname)s\t%(message)s')
    level = logging.__dict__.get(options.loglevel.upper(),logging.DEBUG)
    logger.setLevel(level)

    # Output logging information to screen
    if not options.quiet:
        hdlr = logging.StreamHandler(sys.stderr)
        hdlr.setFormatter(formatter)
        logger.addHandler(hdlr)

    # Output logging information to file
    logfile = os.path.join(options.logdir, "project.log")
    if options.clean and os.path.isfile(logfile):
        os.remove(logfile)
    hdlr2 = logging.FileHandler(logfile)
    hdlr2.setFormatter(formatter)
    logger.addHandler(hdlr2)

    return logger

def main(argv=None):
    if argv is None:
        argv = sys.argv[1:]

    # Setup command line options
    parser = OptionParser("usage: %prog [options]")
    parser.add_option("-l", "--logdir", dest="logdir", default=".", help="log DIRECTORY (default ./)")
    parser.add_option("-v", "--loglevel", dest="loglevel", default="debug", help="logging level (debug, info, error)")
    parser.add_option("-q", "--quiet", action="store_true", dest="quiet", help="do not log to console")
    parser.add_option("-c", "--clean", dest="clean", action="store_true", default=False, help="remove old log file")

    # Process command line options
    (options, args) = parser.parse_args(argv)

    # Setup logger format and output locations
    logger = initialize_logging(options)

    # Examples
    logger.error("This is an error message.")
    logger.info("This is an info message.")
    logger.debug("This is a debug message.")

if __name__ == "__main__":
    sys.exit(main()) 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2010-05-15T19:46:49.050

使用日志记录模块的另一种解决方案：

```
import logging
import sys

log = logging.getLogger('stdxxx')

class StreamLogger(object):

    def __init__(self, stream, prefix=''):
        self.stream = stream
        self.prefix = prefix
        self.data = ''

    def write(self, data):
        self.stream.write(data)
        self.stream.flush()

        self.data += data
        tmp = str(self.data)
        if '\x0a' in tmp or '\x0d' in tmp:
            tmp = tmp.rstrip('\x0a\x0d')
            log.info('%s%s' % (self.prefix, tmp))
            self.data = ''

logging.basicConfig(level=logging.INFO,
                    filename='text.log',
                    filemode='a')

sys.stdout = StreamLogger(sys.stdout, '[stdout] ')

print 'test for stdout' 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2021-03-25T23:26:23.327

我已经使用 Jacob Gabrielson 接受的解决方案大约 1 年了，但现在不可避免的事情已经发生，我的一个用户希望在 Windows 上使用它。看看其他提出的答案，我认为这些答案中的大多数都未能**捕获衍生过程的输出**（如原始海报所示）；我认为做到这一点的唯一方法就是这样做`os.dup2()`。我想我已经弄清楚了如何回答原始发帖人的**确切**问题，并且无需使用 Unix 特定工具`tee`：我现在可以捕获我的 Python 程序的所有输出，包括任何衍生的 shell 命令。这适用于 Windows、Mac 和 Linux。代码如下：

```
import os, sys, threading, platform

class StreamCapture:
    def __init__(self,stream,writer,echo=True,monkeypatch=None):
        self.active = True
        self.writer = writer
        self.stream = stream
        self.fd = stream.fileno()
        self.echo = echo
        (r,w) = os.pipe()
        self.pipe_read_fd = r
        self.pipe_write_fd = w
        self.dup_fd = os.dup(self.fd)
        os.dup2(w,self.fd)
        self.monkeypatch = monkeypatch if monkeypatch is not None else platform.system()=='Windows'
        if self.monkeypatch:
            self.oldwrite = stream.write
            stream.write = lambda z: os.write(self.fd,z.encode() if type(z)==str else z)
        t = threading.Thread(target=self.printer)
        self.thread = t
        t.start()
    def printer(self):
        while True:
            data = os.read(self.pipe_read_fd,100000)
            if(len(data)==0):
                self.writer.close()
                os.close(self.dup_fd)
                os.close(self.pipe_read_fd)
                return
            self.writer.write(data)
            if self.echo:
                os.write(self.dup_fd,data)
    def close(self):
        if not self.active:
            return
        self.active = False
        self.stream.flush()
        if self.monkeypatch:
            self.stream.write = self.oldwrite
        os.dup2(self.dup_fd,self.fd)
        os.close(self.pipe_write_fd)
    def __enter__(self):
        return self
    def __exit__(self,a,b,c):
        self.close() 
```

你像这样使用它（注意除了 Jacob Gabrielson 的解决方案之外的其他解决方案无法捕获的困难案例）：

```
print("This does not get saved to the log file")
with StreamCapture(sys.stdout,open('logfile.txt','wb')):
        os.write(sys.stdout.fileno(),b"Hello, captured world!\n")
        os.system('echo Hello from the shell')     # Hard case
        print("More capturing")
print("This also does not get saved to the log file") 
```

这不是一个简短而甜蜜的答案，但我尽量保持简洁，并且尽可能简单。这很复杂，原因如下：

1.  由于我不能使用`tee`，我必须以某种方式`tee`从我的 Python 进程中执行任务。我不清楚是否有一种可移植的方式`fork()`与 an 进行通信和通信`os.pipe()`（[这](https://stackoverflow.com/a/52476456/959894)表明在 Windows 中很难与分叉进程共享文件描述符）所以我决定使用`threading`.

2.  在 Windows 中，当它们的底层通过via重新路由时`sys.stdout`，`sys.stderr`真的不喜欢。Python 解释器在第一个命令后立即崩溃。`fileno()``os.pipe()``os.dup2()``print(...)`

3.  仅在 Windows 上，为了解决解释器崩溃，我`sys.stdout.write = ...`通过将其设置为一个简单调用`os.write(...)`. 默认情况下，我只在检测到 Windows 时执行此操作。因为我做了猴子补丁，我希望这将覆盖所有缓存的`sys.stdout`. 我选择了这种猴子修补方法而不是分配一个全新的流，例如`sys.stdout=...`，因为我担心旧的副本`sys.stdout`会保留在解释器的各个部分中，但我猜想`sys.stdout.write`直接缓存的可能性较小。

4.  如果您对处理管道输出的线程进行守护进程，则该线程会在主线程完成后立即被终止，但这并不能保证所有输出都已写入日志文件。实际上有必要*不*守护这些辅助线程，并让它们在管道关闭时优雅地终止自己。

实际上，我并不完全确定我是否正确地解决了所有极端情况——与微妙的操作系统功能交互的线程代码编写起来很可怕。尽管如此，它到目前为止通过了我的测试。因为它有点毛茸茸，所以我做了一个 PyPI 包：

```
pip install streamcapture 
```

Github 在[这里](https://github.com/sloisel/streamcapture)。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2011-08-26T15:04:46.230

上面的答案似乎都没有真正回答所提出的问题。我知道这是一个旧线程，但我认为这个问题比每个人都简单得多：

```
class tee_err(object):

 def __init__(self):
    self.errout = sys.stderr

    sys.stderr = self

    self.log = 'logfile.log'
    log = open(self.log,'w')
    log.close()

 def write(self, line):

    log = open(self.log,'a')
    log.write(line)
    log.close()   

    self.errout.write(line) 
```

现在这将对正常的 sys.stderr 处理程序和您的文件重复所有操作。`tee_out`为.创建另一个类`sys.stdout`。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2017-03-10T21:07:36.750

根据@user5359531 在@John T's [answer](https://stackoverflow.com/a/616686/355230)下的评论中的请求，这是该答案中链接讨论的修订版的引用帖子的副本：

```
Issue of redirecting the stdout to both file and screen
Gabriel Genellina gagsl-py2 at yahoo.com.ar
Mon May 28 12:45:51 CEST 2007

    Previous message: Issue of redirecting the stdout to both file and screen
    Next message: Formal interfaces with Python
    Messages sorted by: [ date ] [ thread ] [ subject ] [ author ]

En Mon, 28 May 2007 06:17:39 -0300, 人言落日是天涯，望极天涯不见家
<kelvin.you at gmail.com> escribió:

> I wanna print the log to both the screen and file, so I simulatered a
> 'tee'
>
> class Tee(file):
>
>     def __init__(self, name, mode):
>         file.__init__(self, name, mode)
>         self.stdout = sys.stdout
>         sys.stdout = self
>
>     def __del__(self):
>         sys.stdout = self.stdout
>         self.close()
>
>     def write(self, data):
>         file.write(self, data)
>         self.stdout.write(data)
>
> Tee('logfile', 'w')
> print >>sys.stdout, 'abcdefg'
>
> I found that it only output to the file, nothing to screen. Why?
> It seems the 'write' function was not called when I *print* something.

You create a Tee instance and it is immediately garbage collected. I'd
restore sys.stdout on Tee.close, not __del__ (you forgot to call the
inherited __del__ method, btw).
Mmm, doesn't work. I think there is an optimization somewhere: if it looks
like a real file object, it uses the original file write method, not yours.
The trick would be to use an object that does NOT inherit from file:

import sys
class TeeNoFile(object):
     def __init__(self, name, mode):
         self.file = open(name, mode)
         self.stdout = sys.stdout
         sys.stdout = self
     def close(self):
         if self.stdout is not None:
             sys.stdout = self.stdout
             self.stdout = None
         if self.file is not None:
             self.file.close()
             self.file = None
     def write(self, data):
         self.file.write(data)
         self.stdout.write(data)
     def flush(self):
         self.file.flush()
         self.stdout.flush()
     def __del__(self):
         self.close()

tee=TeeNoFile('logfile', 'w')
print 'abcdefg'
print 'another line'
tee.close()
print 'screen only'
del tee # should do nothing

--
Gabriel Genellina 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-10-14T19:51:00.057

我正在编写一个脚本来运行命令行脚本。（因为在某些情况下，Linux 命令没有可行的替代品——例如 rsync 的情况。）

我真正想要的是在任何可能的情况下都使用默认的 python 日志记录机制，但是当出现意外的错误时仍然捕获任何错误。

这段代码似乎可以解决问题。它可能不是特别优雅或高效（尽管它不使用 string+=string，所以至少它没有那个特定的潜在瓶颈）。我发布它以防它给其他人任何有用的想法。

```
import logging
import os, sys
import datetime

# Get name of module, use as application name
try:
  ME=os.path.split(__file__)[-1].split('.')[0]
except:
  ME='pyExec_'

LOG_IDENTIFIER="uuu___( o O )___uuu "
LOG_IDR_LENGTH=len(LOG_IDENTIFIER)

class PyExec(object):

  # Use this to capture all possible error / output to log
  class SuperTee(object):
      # Original reference: http://mail.python.org/pipermail/python-list/2007-May/442737.html
      def __init__(self, name, mode):
          self.fl = open(name, mode)
          self.fl.write('\n')
          self.stdout = sys.stdout
          self.stdout.write('\n')
          self.stderr = sys.stderr

          sys.stdout = self
          sys.stderr = self

      def __del__(self):
          self.fl.write('\n')
          self.fl.flush()
          sys.stderr = self.stderr
          sys.stdout = self.stdout
          self.fl.close()

      def write(self, data):
          # If the data to write includes the log identifier prefix, then it is already formatted
          if data[0:LOG_IDR_LENGTH]==LOG_IDENTIFIER:
            self.fl.write("%s\n" % data[LOG_IDR_LENGTH:])
            self.stdout.write(data[LOG_IDR_LENGTH:])

          # Otherwise, we can give it a timestamp
          else:

            timestamp=str(datetime.datetime.now())
            if 'Traceback' == data[0:9]:
              data='%s: %s' % (timestamp, data)
              self.fl.write(data)
            else:
              self.fl.write(data)

            self.stdout.write(data)

  def __init__(self, aName, aCmd, logFileName='', outFileName=''):

    # Using name for 'logger' (context?), which is separate from the module or the function
    baseFormatter=logging.Formatter("%(asctime)s \t %(levelname)s \t %(name)s:%(module)s:%(lineno)d \t %(message)s")
    errorFormatter=logging.Formatter(LOG_IDENTIFIER + "%(asctime)s \t %(levelname)s \t %(name)s:%(module)s:%(lineno)d \t %(message)s")

    if logFileName:
      # open passed filename as append
      fl=logging.FileHandler("%s.log" % aName)
    else:
      # otherwise, use log filename as a one-time use file
      fl=logging.FileHandler("%s.log" % aName, 'w')

    fl.setLevel(logging.DEBUG)
    fl.setFormatter(baseFormatter)

    # This will capture stdout and CRITICAL and beyond errors

    if outFileName:
      teeFile=PyExec.SuperTee("%s_out.log" % aName)
    else:
      teeFile=PyExec.SuperTee("%s_out.log" % aName, 'w')

    fl_out=logging.StreamHandler( teeFile )
    fl_out.setLevel(logging.CRITICAL)
    fl_out.setFormatter(errorFormatter)

    # Set up logging
    self.log=logging.getLogger('pyExec_main')
    log=self.log

    log.addHandler(fl)
    log.addHandler(fl_out)

    print "Test print statement."

    log.setLevel(logging.DEBUG)

    log.info("Starting %s", ME)
    log.critical("Critical.")

    # Caught exception
    try:
      raise Exception('Exception test.')
    except Exception,e:
      log.exception(str(e))

    # Uncaught exception
    a=2/0

PyExec('test_pyExec',None) 
```

显然，如果您不像我那样受制于奇思妙想，请将 LOG_IDENTIFIER 替换为另一个您不希望看到有人写入日志的字符串。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-12-07T11:46:24.707

如果您希望将所有输​​出记录到文件并将其输出到文本文件，则可以执行以下操作。这有点hacky，但它有效：

```
import logging
debug = input("Debug or not")
if debug == "1":
    logging.basicConfig(level=logging.DEBUG, filename='./OUT.txt')
    old_print = print
    def print(string):
        old_print(string)
        logging.info(string)
print("OMG it works!") 
```

### 编辑：请注意，除非您将 sys.stderr 重定向到 sys.stdout，否则这不会记录错误

### EDIT2：第二个问题是您必须传递 1 个参数，这与内置函数不同。

### EDIT3：查看代码之前将标准输入和标准输出写入控制台并使用标准错误写入文件

```
import logging, sys
debug = input("Debug or not")
if debug == "1":
    old_input = input
    sys.stderr.write = logging.info
    def input(string=""):
        string_in = old_input(string)
        logging.info("STRING IN " + string_in)
        return string_in
    logging.basicConfig(level=logging.DEBUG, filename='./OUT.txt')
    old_print = print
    def print(string="", string2=""):
        old_print(string, string2)
        logging.info(string)
        logging.info(string2)
print("OMG")
b = input()
print(a) ## Deliberate error for testing 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-08-11T13:52:22.093

您也可以`stderr`根据上面 shx2[的回答](https://stackoverflow.com/a/16551730/703421)`class multifile`添加：

```
class Log(object):

    def __init__(self, path_log, mode="w", encoding="utf-8"):
        h = open(path_log, mode, encoding=encoding)
        sys.stdout = multifile([ sys.stdout, h ])
        sys.stderr = multifile([ sys.stderr, h ])

    def __enter__(self):
        """ Necessary if called by with (or with... as) """
        return self     # only necessary if "as"

    def __exit__(self, type, value, tb):
        """ Necessary if call by with """
        pass

    def __del__(self):
        if sys is not None:
            # restoring
            sys.stdout = sys.__stdout__
            sys.stderr = sys.__stderr__

log = Log("test.txt")
print("line 1")
print("line 2", file=sys.stderr)
del log
print("line 3 only on screen") 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2018-02-25T04:14:53.700

我写了一个完整的替换`sys.stderr`，只是复制了重命名的代码`stderr`，`stdout`使其也可用于替换`sys.stdout`。

为此，我创建了与当前`stderr`and相同的对象类型`stdout`，并将所有方法转发到原始系统`stderr`and `stdout`：

```
import os
import sys
import logging

class StdErrReplament(object):
    """
        How to redirect stdout and stderr to logger in Python
        https://stackoverflow.com/questions/19425736/how-to-redirect-stdout-and-stderr-to-logger-in-python

        Set a Read-Only Attribute in Python?
        https://stackoverflow.com/questions/24497316/set-a-read-only-attribute-in-python
    """
    is_active = False

    @classmethod
    def lock(cls, logger):
        """
            Attach this singleton logger to the `sys.stderr` permanently.
        """
        global _stderr_singleton
        global _stderr_default
        global _stderr_default_class_type

        # On Sublime Text, `sys.__stderr__` is set to None, because they already replaced `sys.stderr`
        # by some `_LogWriter()` class, then just save the current one over there.
        if not sys.__stderr__:
            sys.__stderr__ = sys.stderr

        try:
            _stderr_default
            _stderr_default_class_type

        except NameError:
            _stderr_default = sys.stderr
            _stderr_default_class_type = type( _stderr_default )

        # Recreate the sys.stderr logger when it was reset by `unlock()`
        if not cls.is_active:
            cls.is_active = True
            _stderr_write = _stderr_default.write

            logger_call = logger.debug
            clean_formatter = logger.clean_formatter

            global _sys_stderr_write
            global _sys_stderr_write_hidden

            if sys.version_info <= (3,2):
                logger.file_handler.terminator = '\n'

            # Always recreate/override the internal write function used by `_sys_stderr_write`
            def _sys_stderr_write_hidden(*args, **kwargs):
                """
                    Suppress newline in Python logging module
                    https://stackoverflow.com/questions/7168790/suppress-newline-in-python-logging-module
                """

                try:
                    _stderr_write( *args, **kwargs )
                    file_handler = logger.file_handler

                    formatter = file_handler.formatter
                    terminator = file_handler.terminator

                    file_handler.formatter = clean_formatter
                    file_handler.terminator = ""

                    kwargs['extra'] = {'_duplicated_from_file': True}
                    logger_call( *args, **kwargs )

                    file_handler.formatter = formatter
                    file_handler.terminator = terminator

                except Exception:
                    logger.exception( "Could not write to the file_handler: %s(%s)", file_handler, logger )
                    cls.unlock()

            # Only create one `_sys_stderr_write` function pointer ever
            try:
                _sys_stderr_write

            except NameError:

                def _sys_stderr_write(*args, **kwargs):
                    """
                        Hides the actual function pointer. This allow the external function pointer to
                        be cached while the internal written can be exchanged between the standard
                        `sys.stderr.write` and our custom wrapper around it.
                    """
                    _sys_stderr_write_hidden( *args, **kwargs )

        try:
            # Only create one singleton instance ever
            _stderr_singleton

        except NameError:

            class StdErrReplamentHidden(_stderr_default_class_type):
                """
                    Which special methods bypasses __getattribute__ in Python?
                    https://stackoverflow.com/questions/12872695/which-special-methods-bypasses-getattribute-in-python
                """

                if hasattr( _stderr_default, "__abstractmethods__" ):
                    __abstractmethods__ = _stderr_default.__abstractmethods__

                if hasattr( _stderr_default, "__base__" ):
                    __base__ = _stderr_default.__base__

                if hasattr( _stderr_default, "__bases__" ):
                    __bases__ = _stderr_default.__bases__

                if hasattr( _stderr_default, "__basicsize__" ):
                    __basicsize__ = _stderr_default.__basicsize__

                if hasattr( _stderr_default, "__call__" ):
                    __call__ = _stderr_default.__call__

                if hasattr( _stderr_default, "__class__" ):
                    __class__ = _stderr_default.__class__

                if hasattr( _stderr_default, "__delattr__" ):
                    __delattr__ = _stderr_default.__delattr__

                if hasattr( _stderr_default, "__dict__" ):
                    __dict__ = _stderr_default.__dict__

                if hasattr( _stderr_default, "__dictoffset__" ):
                    __dictoffset__ = _stderr_default.__dictoffset__

                if hasattr( _stderr_default, "__dir__" ):
                    __dir__ = _stderr_default.__dir__

                if hasattr( _stderr_default, "__doc__" ):
                    __doc__ = _stderr_default.__doc__

                if hasattr( _stderr_default, "__eq__" ):
                    __eq__ = _stderr_default.__eq__

                if hasattr( _stderr_default, "__flags__" ):
                    __flags__ = _stderr_default.__flags__

                if hasattr( _stderr_default, "__format__" ):
                    __format__ = _stderr_default.__format__

                if hasattr( _stderr_default, "__ge__" ):
                    __ge__ = _stderr_default.__ge__

                if hasattr( _stderr_default, "__getattribute__" ):
                    __getattribute__ = _stderr_default.__getattribute__

                if hasattr( _stderr_default, "__gt__" ):
                    __gt__ = _stderr_default.__gt__

                if hasattr( _stderr_default, "__hash__" ):
                    __hash__ = _stderr_default.__hash__

                if hasattr( _stderr_default, "__init__" ):
                    __init__ = _stderr_default.__init__

                if hasattr( _stderr_default, "__init_subclass__" ):
                    __init_subclass__ = _stderr_default.__init_subclass__

                if hasattr( _stderr_default, "__instancecheck__" ):
                    __instancecheck__ = _stderr_default.__instancecheck__

                if hasattr( _stderr_default, "__itemsize__" ):
                    __itemsize__ = _stderr_default.__itemsize__

                if hasattr( _stderr_default, "__le__" ):
                    __le__ = _stderr_default.__le__

                if hasattr( _stderr_default, "__lt__" ):
                    __lt__ = _stderr_default.__lt__

                if hasattr( _stderr_default, "__module__" ):
                    __module__ = _stderr_default.__module__

                if hasattr( _stderr_default, "__mro__" ):
                    __mro__ = _stderr_default.__mro__

                if hasattr( _stderr_default, "__name__" ):
                    __name__ = _stderr_default.__name__

                if hasattr( _stderr_default, "__ne__" ):
                    __ne__ = _stderr_default.__ne__

                if hasattr( _stderr_default, "__new__" ):
                    __new__ = _stderr_default.__new__

                if hasattr( _stderr_default, "__prepare__" ):
                    __prepare__ = _stderr_default.__prepare__

                if hasattr( _stderr_default, "__qualname__" ):
                    __qualname__ = _stderr_default.__qualname__

                if hasattr( _stderr_default, "__reduce__" ):
                    __reduce__ = _stderr_default.__reduce__

                if hasattr( _stderr_default, "__reduce_ex__" ):
                    __reduce_ex__ = _stderr_default.__reduce_ex__

                if hasattr( _stderr_default, "__repr__" ):
                    __repr__ = _stderr_default.__repr__

                if hasattr( _stderr_default, "__setattr__" ):
                    __setattr__ = _stderr_default.__setattr__

                if hasattr( _stderr_default, "__sizeof__" ):
                    __sizeof__ = _stderr_default.__sizeof__

                if hasattr( _stderr_default, "__str__" ):
                    __str__ = _stderr_default.__str__

                if hasattr( _stderr_default, "__subclasscheck__" ):
                    __subclasscheck__ = _stderr_default.__subclasscheck__

                if hasattr( _stderr_default, "__subclasses__" ):
                    __subclasses__ = _stderr_default.__subclasses__

                if hasattr( _stderr_default, "__subclasshook__" ):
                    __subclasshook__ = _stderr_default.__subclasshook__

                if hasattr( _stderr_default, "__text_signature__" ):
                    __text_signature__ = _stderr_default.__text_signature__

                if hasattr( _stderr_default, "__weakrefoffset__" ):
                    __weakrefoffset__ = _stderr_default.__weakrefoffset__

                if hasattr( _stderr_default, "mro" ):
                    mro = _stderr_default.mro

                def __init__(self):
                    """
                        Override any super class `type( _stderr_default )` constructor, so we can 
                        instantiate any kind of `sys.stderr` replacement object, in case it was already 
                        replaced by something else like on Sublime Text with `_LogWriter()`.

                        Assures all attributes were statically replaced just above. This should happen in case
                        some new attribute is added to the python language.

                        This also ignores the only two methods which are not equal, `__init__()` and `__getattribute__()`.
                    """
                    different_methods = ("__init__", "__getattribute__")
                    attributes_to_check = set( dir( object ) + dir( type ) )

                    for attribute in attributes_to_check:

                        if attribute not in different_methods \
                                and hasattr( _stderr_default, attribute ):

                            base_class_attribute = super( _stderr_default_class_type, self ).__getattribute__( attribute )
                            target_class_attribute = _stderr_default.__getattribute__( attribute )

                            if base_class_attribute != target_class_attribute:
                                sys.stderr.write( "    The base class attribute `%s` is different from the target class:\n%s\n%s\n\n" % (
                                        attribute, base_class_attribute, target_class_attribute ) )

                def __getattribute__(self, item):

                    if item == 'write':
                        return _sys_stderr_write

                    try:
                        return _stderr_default.__getattribute__( item )

                    except AttributeError:
                        return super( _stderr_default_class_type, _stderr_default ).__getattribute__( item )

            _stderr_singleton = StdErrReplamentHidden()
            sys.stderr = _stderr_singleton

        return cls

    @classmethod
    def unlock(cls):
        """
            Detach this `stderr` writer from `sys.stderr` and allow the next call to `lock()` create
            a new writer for the stderr.
        """

        if cls.is_active:
            global _sys_stderr_write_hidden

            cls.is_active = False
            _sys_stderr_write_hidden = _stderr_default.write

class StdOutReplament(object):
    """
        How to redirect stdout and stderr to logger in Python
        https://stackoverflow.com/questions/19425736/how-to-redirect-stdout-and-stderr-to-logger-in-python

        Set a Read-Only Attribute in Python?
        https://stackoverflow.com/questions/24497316/set-a-read-only-attribute-in-python
    """
    is_active = False

    @classmethod
    def lock(cls, logger):
        """
            Attach this singleton logger to the `sys.stdout` permanently.
        """
        global _stdout_singleton
        global _stdout_default
        global _stdout_default_class_type

        # On Sublime Text, `sys.__stdout__` is set to None, because they already replaced `sys.stdout`
        # by some `_LogWriter()` class, then just save the current one over there.
        if not sys.__stdout__:
            sys.__stdout__ = sys.stdout

        try:
            _stdout_default
            _stdout_default_class_type

        except NameError:
            _stdout_default = sys.stdout
            _stdout_default_class_type = type( _stdout_default )

        # Recreate the sys.stdout logger when it was reset by `unlock()`
        if not cls.is_active:
            cls.is_active = True
            _stdout_write = _stdout_default.write

            logger_call = logger.debug
            clean_formatter = logger.clean_formatter

            global _sys_stdout_write
            global _sys_stdout_write_hidden

            if sys.version_info <= (3,2):
                logger.file_handler.terminator = '\n'

            # Always recreate/override the internal write function used by `_sys_stdout_write`
            def _sys_stdout_write_hidden(*args, **kwargs):
                """
                    Suppress newline in Python logging module
                    https://stackoverflow.com/questions/7168790/suppress-newline-in-python-logging-module
                """

                try:
                    _stdout_write( *args, **kwargs )
                    file_handler = logger.file_handler

                    formatter = file_handler.formatter
                    terminator = file_handler.terminator

                    file_handler.formatter = clean_formatter
                    file_handler.terminator = ""

                    kwargs['extra'] = {'_duplicated_from_file': True}
                    logger_call( *args, **kwargs )

                    file_handler.formatter = formatter
                    file_handler.terminator = terminator

                except Exception:
                    logger.exception( "Could not write to the file_handler: %s(%s)", file_handler, logger )
                    cls.unlock()

            # Only create one `_sys_stdout_write` function pointer ever
            try:
                _sys_stdout_write

            except NameError:

                def _sys_stdout_write(*args, **kwargs):
                    """
                        Hides the actual function pointer. This allow the external function pointer to
                        be cached while the internal written can be exchanged between the standard
                        `sys.stdout.write` and our custom wrapper around it.
                    """
                    _sys_stdout_write_hidden( *args, **kwargs )

        try:
            # Only create one singleton instance ever
            _stdout_singleton

        except NameError:

            class StdOutReplamentHidden(_stdout_default_class_type):
                """
                    Which special methods bypasses __getattribute__ in Python?
                    https://stackoverflow.com/questions/12872695/which-special-methods-bypasses-getattribute-in-python
                """

                if hasattr( _stdout_default, "__abstractmethods__" ):
                    __abstractmethods__ = _stdout_default.__abstractmethods__

                if hasattr( _stdout_default, "__base__" ):
                    __base__ = _stdout_default.__base__

                if hasattr( _stdout_default, "__bases__" ):
                    __bases__ = _stdout_default.__bases__

                if hasattr( _stdout_default, "__basicsize__" ):
                    __basicsize__ = _stdout_default.__basicsize__

                if hasattr( _stdout_default, "__call__" ):
                    __call__ = _stdout_default.__call__

                if hasattr( _stdout_default, "__class__" ):
                    __class__ = _stdout_default.__class__

                if hasattr( _stdout_default, "__delattr__" ):
                    __delattr__ = _stdout_default.__delattr__

                if hasattr( _stdout_default, "__dict__" ):
                    __dict__ = _stdout_default.__dict__

                if hasattr( _stdout_default, "__dictoffset__" ):
                    __dictoffset__ = _stdout_default.__dictoffset__

                if hasattr( _stdout_default, "__dir__" ):
                    __dir__ = _stdout_default.__dir__

                if hasattr( _stdout_default, "__doc__" ):
                    __doc__ = _stdout_default.__doc__

                if hasattr( _stdout_default, "__eq__" ):
                    __eq__ = _stdout_default.__eq__

                if hasattr( _stdout_default, "__flags__" ):
                    __flags__ = _stdout_default.__flags__

                if hasattr( _stdout_default, "__format__" ):
                    __format__ = _stdout_default.__format__

                if hasattr( _stdout_default, "__ge__" ):
                    __ge__ = _stdout_default.__ge__

                if hasattr( _stdout_default, "__getattribute__" ):
                    __getattribute__ = _stdout_default.__getattribute__

                if hasattr( _stdout_default, "__gt__" ):
                    __gt__ = _stdout_default.__gt__

                if hasattr( _stdout_default, "__hash__" ):
                    __hash__ = _stdout_default.__hash__

                if hasattr( _stdout_default, "__init__" ):
                    __init__ = _stdout_default.__init__

                if hasattr( _stdout_default, "__init_subclass__" ):
                    __init_subclass__ = _stdout_default.__init_subclass__

                if hasattr( _stdout_default, "__instancecheck__" ):
                    __instancecheck__ = _stdout_default.__instancecheck__

                if hasattr( _stdout_default, "__itemsize__" ):
                    __itemsize__ = _stdout_default.__itemsize__

                if hasattr( _stdout_default, "__le__" ):
                    __le__ = _stdout_default.__le__

                if hasattr( _stdout_default, "__lt__" ):
                    __lt__ = _stdout_default.__lt__

                if hasattr( _stdout_default, "__module__" ):
                    __module__ = _stdout_default.__module__

                if hasattr( _stdout_default, "__mro__" ):
                    __mro__ = _stdout_default.__mro__

                if hasattr( _stdout_default, "__name__" ):
                    __name__ = _stdout_default.__name__

                if hasattr( _stdout_default, "__ne__" ):
                    __ne__ = _stdout_default.__ne__

                if hasattr( _stdout_default, "__new__" ):
                    __new__ = _stdout_default.__new__

                if hasattr( _stdout_default, "__prepare__" ):
                    __prepare__ = _stdout_default.__prepare__

                if hasattr( _stdout_default, "__qualname__" ):
                    __qualname__ = _stdout_default.__qualname__

                if hasattr( _stdout_default, "__reduce__" ):
                    __reduce__ = _stdout_default.__reduce__

                if hasattr( _stdout_default, "__reduce_ex__" ):
                    __reduce_ex__ = _stdout_default.__reduce_ex__

                if hasattr( _stdout_default, "__repr__" ):
                    __repr__ = _stdout_default.__repr__

                if hasattr( _stdout_default, "__setattr__" ):
                    __setattr__ = _stdout_default.__setattr__

                if hasattr( _stdout_default, "__sizeof__" ):
                    __sizeof__ = _stdout_default.__sizeof__

                if hasattr( _stdout_default, "__str__" ):
                    __str__ = _stdout_default.__str__

                if hasattr( _stdout_default, "__subclasscheck__" ):
                    __subclasscheck__ = _stdout_default.__subclasscheck__

                if hasattr( _stdout_default, "__subclasses__" ):
                    __subclasses__ = _stdout_default.__subclasses__

                if hasattr( _stdout_default, "__subclasshook__" ):
                    __subclasshook__ = _stdout_default.__subclasshook__

                if hasattr( _stdout_default, "__text_signature__" ):
                    __text_signature__ = _stdout_default.__text_signature__

                if hasattr( _stdout_default, "__weakrefoffset__" ):
                    __weakrefoffset__ = _stdout_default.__weakrefoffset__

                if hasattr( _stdout_default, "mro" ):
                    mro = _stdout_default.mro

                def __init__(self):
                    """
                        Override any super class `type( _stdout_default )` constructor, so we can 
                        instantiate any kind of `sys.stdout` replacement object, in case it was already 
                        replaced by something else like on Sublime Text with `_LogWriter()`.

                        Assures all attributes were statically replaced just above. This should happen in case
                        some new attribute is added to the python language.

                        This also ignores the only two methods which are not equal, `__init__()` and `__getattribute__()`.
                    """
                    different_methods = ("__init__", "__getattribute__")
                    attributes_to_check = set( dir( object ) + dir( type ) )

                    for attribute in attributes_to_check:

                        if attribute not in different_methods \
                                and hasattr( _stdout_default, attribute ):

                            base_class_attribute = super( _stdout_default_class_type, self ).__getattribute__( attribute )
                            target_class_attribute = _stdout_default.__getattribute__( attribute )

                            if base_class_attribute != target_class_attribute:
                                sys.stdout.write( "    The base class attribute `%s` is different from the target class:\n%s\n%s\n\n" % (
                                        attribute, base_class_attribute, target_class_attribute ) )

                def __getattribute__(self, item):

                    if item == 'write':
                        return _sys_stdout_write

                    try:
                        return _stdout_default.__getattribute__( item )

                    except AttributeError:
                        return super( _stdout_default_class_type, _stdout_default ).__getattribute__( item )

            _stdout_singleton = StdOutReplamentHidden()
            sys.stdout = _stdout_singleton

        return cls

    @classmethod
    def unlock(cls):
        """
            Detach this `stdout` writer from `sys.stdout` and allow the next call to `lock()` create
            a new writer for the stdout.
        """

        if cls.is_active:
            global _sys_stdout_write_hidden

            cls.is_active = False
            _sys_stdout_write_hidden = _stdout_default.write 
```

要使用它，您只需调用`StdErrReplament::lock(logger)`并`StdOutReplament::lock(logger)` 传递要用于发送输出文本的记录器。例如：

```
import os
import sys
import logging

current_folder = os.path.dirname( os.path.realpath( __file__ ) )
log_file_path = os.path.join( current_folder, "my_log_file.txt" )

file_handler = logging.FileHandler( log_file_path, 'a' )
file_handler.formatter = logging.Formatter( "%(asctime)s %(name)s %(levelname)s - %(message)s", "%Y-%m-%d %H:%M:%S" )

log = logging.getLogger( __name__ )
log.setLevel( "DEBUG" )
log.addHandler( file_handler )

log.file_handler = file_handler
log.clean_formatter = logging.Formatter( "", "" )

StdOutReplament.lock( log )
StdErrReplament.lock( log )

log.debug( "I am doing usual logging debug..." )
sys.stderr.write( "Tests 1...\n" )
sys.stdout.write( "Tests 2...\n" ) 
```

运行此代码，您将在屏幕上看到：

[![在此处输入图像描述](https://i.stack.imgur.com/7jPuY.png)](https://i.stack.imgur.com/7jPuY.png)

并在文件内容上：

[![在此处输入图像描述](https://i.stack.imgur.com/xgFZS.png)](https://i.stack.imgur.com/xgFZS.png)

如果您还想`log.debug`在屏幕上查看调用的内容，则需要将流处理程序添加到您的记录器。在这种情况下，它将是这样的：

```
import os
import sys
import logging

class ContextFilter(logging.Filter):
    """ This filter avoids duplicated information to be displayed to the StreamHandler log. """
    def filter(self, record):
        return not "_duplicated_from_file" in record.__dict__

current_folder = os.path.dirname( os.path.realpath( __file__ ) )
log_file_path = os.path.join( current_folder, "my_log_file.txt" )

stream_handler = logging.StreamHandler()
file_handler = logging.FileHandler( log_file_path, 'a' )

formatter = logging.Formatter( "%(asctime)s %(name)s %(levelname)s - %(message)s", "%Y-%m-%d %H:%M:%S" )
file_handler.formatter = formatter
stream_handler.formatter = formatter
stream_handler.addFilter( ContextFilter() )

log = logging.getLogger( __name__ )
log.setLevel( "DEBUG" )
log.addHandler( file_handler )
log.addHandler( stream_handler )

log.file_handler = file_handler
log.stream_handler = stream_handler
log.clean_formatter = logging.Formatter( "", "" )

StdOutReplament.lock( log )
StdErrReplament.lock( log )

log.debug( "I am doing usual logging debug..." )
sys.stderr.write( "Tests 1...\n" )
sys.stdout.write( "Tests 2...\n" ) 
```

运行时会这样输出：

[![在此处输入图像描述](https://i.stack.imgur.com/RYHqg.png)](https://i.stack.imgur.com/RYHqg.png)

虽然它仍会将其保存到文件中`my_log_file.txt`：

[![在此处输入图像描述](https://i.stack.imgur.com/ZAcoY.png)](https://i.stack.imgur.com/ZAcoY.png)

当用 禁用它时`StdErrReplament:unlock()`，它只会恢复`stderr`流的标准行为，因为附加的记录器不能永远分离，因为其他人可以引用它的旧版本。这就是为什么它是一个永远不会死的全局单例。因此，如果用`imp`其他东西重新加载这个模块，它永远不会重新捕获电流`sys.stderr`，因为它已经注入到它上面并在内部保存它。

# sharepoint - 如何在不使用 _layouts 目录的情况下配置自定义页面？

> ID：616647
> 
> 赞同：1
> 
> 时间：2009-03-05T21:12:34.413
> 
> 标签：sharepoint, sharepoint-2007, moss

我需要提供一个自定义的 aspx 页面，它会做一些工作，然后重定向到另一个页面。使用 _layouts 页面，AKA 应用程序页面将不起作用，因为我只希望该页面可供一个网站集访问。

我从博客文章*[Application Development on MOSS 2007 and WSS V3](http://blogs.msdn.com/cjohnson/archive/2006/09/05/740498.aspx)*中查看了使用模式 #4 。感觉很hacky，它要求你删除DLL。将其放入网站集的 bin 中，并通过 SP Designer 上传文件。

我宁愿让这个页面成为包含在我的站点定义中或装订到现有站点定义中的功能。我想我可以使用功能接收器将文件部署到页面 SP 列表中。博客文章中的一条评论同样如此：

> 请原谅我对此的无知，也许我完全忽略了这一点，但是通过以编程方式将自定义页面添加到页面splist来部署自定义页面不是更容易吗？
> 
> 我基本上有一个带有用户控件的简单 .aspx 页面。我通过这种方法部署了它。

如何在不使用 _layouts 页面的情况下配置自定义页面？

我想另一种选择是继续使用 _layouts 页面，但要确保引用者是正确的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T21:42:04.983

除了应用程序页面，您还可以创建站点页面。

站点页面本质上与应用程序页面相关，但它们驻留在不在 _LAYOUTS 中的站点中。

欢迎页面 (default.aspx) 就是此类页面的一个示例。

与应用程序页面一样，可以在这些页面中执行代码隐藏（查看 AC 关于此主题的文章，*[在 SharePoint v3 站点中使用 ASP.NET 2.0 代码隐藏文件](http://www.andrewconnell.com/blog/articles/UsingCodeBehindFilesInSharePointSites.aspx)*）

您可以阅读这篇文章，了解应用程序页面和网站页面之间的细微差别：*[SharePoint 应用程序和网站页面 - 第 1 部分，共 2 部分](http://aspalliance.com/1720_SharePoint_Application_and_Site_Pages__Part_1_of_2)*

您可以使用一项功能部署此自定义页面，在其中将文件指定为可幻影（查看 ACs 文章中的示例）。

# c++ - 异常时的可移植 C++ 堆栈跟踪

> ID：616653
> 
> 赞同：13
> 
> 时间：2009-03-05T21:14:59.137
> 
> 标签：c++, portability, stack-trace

我正在编写一个我希望可移植的库。因此，它不应该依赖于 glibc 或 Microsoft 扩展或任何其他不在标准中的东西。我有一个很好的从 std::exception 派生的类层次结构，我用它来处理逻辑和输入中的错误。知道在特定文件和行号处引发了特定类型的异常是有用的，但是知道执行是如何到达那里的可能更有价值，所以我一直在寻找获取堆栈跟踪的方法。

我知道在使用 execinfo.h 中的函数（参见[问题 76822](https://stackoverflow.com/questions/76822/how-to-generate-a-stacktrace-when-my-c-app-crashes-using-gcc-compiler)）和通过 Microsoft C++ 实现中的 StackWalk 接口（参见[问题](https://stackoverflow.com/questions/126450/call-stack-at-runtime)126450）针对 glibc 构建时，这些数据是可用的，但我非常想避免任何不便携。

我正在考虑以这种形式自己实现此功能：

```
class myException : public std::exception
{
public:
  ...
  void AddCall( std::string s )
  { m_vCallStack.push_back( s ); }
  std::string ToStr() const
  {
    std::string l_sRet = "";
    ...
    l_sRet += "Call stack:\n";
    for( int i = 0; i < m_vCallStack.size(); i++ )
      l_sRet += "  " + m_vCallStack[i] + "\n";
    ...
    return l_sRet;
  }
private:
  ...
  std::vector< std::string > m_vCallStack;
};

ret_type some_function( param_1, param_2, param_3 )
{
  try
  {
    ...
  }
  catch( myException e )
  {
    e.AddCall( "some_function( " + param_1 + ", " + param_2 + ", " + param_3 + " )" );
    throw e;
  }
}

int main( int argc, char * argv[] )
{
  try
  {
    ...
  }
  catch ( myException e )
  {
    std::cerr << "Caught exception: \n" << e.ToStr();
    return 1;
  }
  return 0;
} 
```

这是一个可怕的想法吗？这意味着为每个函数添加 try/catch 块需要做很多工作，但我可以接受。当异常的原因是内存损坏或内存不足时，它不会起作用，但在那一点上你几乎已经搞砸了。如果堆栈中的某些函数没有捕获异常、将自身添加到列表中并重新抛出，它可能会提供误导性信息，但我至少可以保证我的所有库函数都这样做。与“真正的”堆栈跟踪不同，我不会在调用函数时获得行号，但至少我会有一些东西。

我主要担心的是，即使实际上没有抛出异常，这也会导致速度变慢。所有这些 try/catch 块是否需要对每个函数调用进行额外的设置和拆卸，或者在编译时以某种方式处理？还是有其他我没有考虑过的问题？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-05T21:27:05.970

我认为这是一个非常糟糕的主意。

可移植性是一个非常有价值的目标，但当它导致解决方案具有侵入性、降低性能和实现低劣时则不然。

我工作过的每个平台（Windows/Linux/PS2/iPhone/etc）都提供了一种在发生异常时遍历堆栈并将地址与函数名称匹配的方法。是的，这些都不是可移植的，但报告框架可以，并且通常需要不到一两天的时间来编写特定于平台的堆栈遍历代码版本。

这不仅比创建/维护跨平台解决方案所花费的时间更少，而且结果要好得多；

*   无需修改功能
*   陷阱标准或第三方库中的崩溃
*   无需在每个函数中都尝试/捕获（缓慢且占用大量内存）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-05T21:55:40.927

抬头看`Nested Diagnostic Context`一次。这里有一个小提示：

```
class NDC {
public:
    static NDC* getContextForCurrentThread();
    int addEntry(char const* file, unsigned lineNo);
    void removeEntry(int key);
    void dump(std::ostream& os);
    void clear();
};

class Scope {
public:
    Scope(char const *file, unsigned lineNo) {
       NDC *ctx = NDC::getContextForCurrentThread();
       myKey = ctx->addEntry(file,lineNo);
    }
    ~Scope() {
       if (!std::uncaught_exception()) {
           NDC *ctx = NDC::getContextForCurrentThread();
           ctx->removeEntry(myKey);
       }
    }
private:
    int myKey;
};
#define DECLARE_NDC() Scope s__(__FILE__,__LINE__)

void f() {
    DECLARE_NDC(); // always declare the scope
    // only use try/catch when you want to handle an exception
    // and dump the stack
    try {
       // do stuff in here
    } catch (...) {
       NDC* ctx = NDC::getContextForCurrentThread();
       ctx->dump(std::cerr);
       ctx->clear();
    }
} 
```

开销是在 NDC 的实施中。我正在玩一个懒惰评估的版本，以及一个只保留固定数量条目的版本。关键是，如果您使用构造函数和析构函数来处理堆栈，那么您就不需要所有那些讨厌的`try`/`catch`块和无处不在的显式操作。

唯一特定于平台的头痛是`getContextForCurrentThread()`方法。在大多数情况下，如果不是所有情况，您都可以使用使用线程本地存储的平台特定实现来处理作业。

如果您更注重性能并且生活在日志文件的世界中，那么将范围更改为包含指向文件名和行号的指针并完全省略 NDC 事物：

```
class Scope {
public:
    Scope(char const* f, unsigned l): fileName(f), lineNo(l) {}
    ~Scope() {
        if (std::uncaught_exception()) {
            log_error("%s(%u): stack unwind due to exception\n",
                      fileName, lineNo);
        }
    }
private:
    char const* fileName;
    unsigned lineNo;
}; 
```

当抛出异常时，这将在您的日志文件中为您提供一个很好的堆栈跟踪。不需要任何真正的堆栈遍历，只需在抛出异常时发出一点日志消息；）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T21:25:44.803

我认为没有“平台独立”的方式来做到这一点 - 毕竟，如果有，就不需要 StackWalk 或你提到的特殊 gcc 堆栈跟踪功能。

这会有点混乱，但我实现它的方式是创建一个类，该类为访问堆栈跟踪提供一致的接口，然后在实现中使用#ifdefs，使用适当的特定于平台的方法来实际放置堆栈跟踪在一起。

这样，您对类的使用就与平台无关，如果您想针对其他平台，只需修改该类。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T01:04:59.567

在调试器中：

要获取异常抛出位置的堆栈跟踪，我只需在 std::exception 构造函数中设置断点。

因此，当创建异常时，调试器停止，然后您可以在该点看到堆栈跟踪。并不完美，但它在大多数情况下都有效。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-12-12T13:51:31.333

堆栈管理是那些很快变得复杂的简单事情之一。最好把它留给专门的图书馆。你试过 libunwind 吗？效果很好，而且 AFAIK 它是可移植的，尽管我从未在 Windows 上尝试过。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T21:29:43.717

这会更慢，但看起来应该可以工作。

据我了解，制作快速、可移植的堆栈跟踪的问题在于堆栈实现是特定于操作系统和 CPU 的，因此它隐含地是一个特定于平台的问题。另一种方法是使用 MS/glibc 函数并使用 #ifdef 和适当的预处理器定义（例如 _WIN32）在不同的构建中实现平台特定的解决方案。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T21:31:11.343

由于堆栈的使用高度依赖于平台和实现，因此无法直接进行完全可移植的操作。但是，您可以为平台和编译器特定实现构建可移植接口，尽可能本地化问题。恕我直言，这将是您最好的方法。

然后，跟踪器实现将链接到任何可用的特定于平台的帮助程序库。然后它只会在发生异常时运行，即使这样也只有在你从 catch 块中调用它时才会运行。它的最小 API 将简单地返回一个包含整个跟踪的字符串。

要求编码器在调用链中注入 catch 和 rethrow 处理在某些平台上具有显着的运行时成本，并且会带来很大的未来维护成本。

也就是说，如果您确实选择使用 catch/throw 机制，请不要忘记即使 C++ 仍然有可用的 C 预处理器，并且宏`__FILE__`和`__LINE__`已定义。您可以使用它们在跟踪信息中包含源文件名和行号。

# actionscript-3 - 对 stage.displayState 的更改：事件在哪里？（闪存，AS3）

> ID：616654
> 
> 赞同：1
> 
> 时间：2009-03-05T21:15:09.603
> 
> 标签：actionscript-3, flash, fullscreen, stage

我应该寻找什么事件（在舞台上：舞台上，我想）来更改 stage.displayState？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T21:20:32.103

这行得通

```
stage.addEventListener(Event.FULLSCREEN, doThisOnChange); 
```

全屏和正常更改。在您的`doThisOnChange`方法中，您可以通过查看`if (stage.displayState == StageDisplayState.NORMAL) {`等来确定您所在的位置......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T22:00:15.017

只要您的 SWF 没有嵌入到 HTML 中，您应该没问题。您需要一些额外的技巧才能使 HTML 包装器正常工作。

从[文档](http://livedocs.adobe.com/flex/3/html/help.html?content=05_Display_Programming_10.html)中：

> 您可以使用`Stage`类的`fullScreen`事件来检测和响应全屏模式何时打开或关闭。例如，您可能希望在进入或离开全屏模式时重新定位、添加或删除屏幕上的项目，如下例所示：

# c# - 如何从只读方法返回对 Dictionary 的引用？

> ID：616657
> 
> 赞同：1
> 
> 时间：2009-03-05T21:16:29.740
> 
> 标签：c#

我想让用户遍历我的字典而不修改它。

我考虑两种解决方案：

1.ReadOnlyDictionary - 是否有可用的实现？

2\. 复制整个字典——复制它的最有效方法是什么？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T21:21:47.280

最简单的方法可能是实现您自己的集合，它是字典的包装器，类似于：

```
public class ReadOnlyDictionary<T, U>
{
    private IDictionary<T, U> BackingStore;

    public ReadOnlyDictionary<T, U>(IDictionary<T, U> baseDictionary) {
        this.BackingStore = baseDictionary;
    }

    public U this[T index] { get { return BackingStore[index]; } }

    // provide whatever other methods and/or interfaces you need
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T21:33:09.420

请记住，您的值不会仅使用为仅使用属性获取器包装 Dictionary 提供的解决方案来读取；例如：

```
ReadOnlyDictionary<int, Employee> readOnlyDict = GetDictionaryHoweverYouLike();
ReadOnlyDictionary[5].EmployeeName = "Ooops" 
```

为此，您还需要将值包装在只读包装类中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-01-11T12:10:14.137

这是我为所有需要准备好代码片段的人使用的实现。如前所述，这只会使 Dictionary 成为只读，而不是其中的对象！

```
/// <summary>
/// Read only wrapper for generics based dictionary.
/// Only provides lookup retrieval abilities.
/// </summary>
/// <typeparam name="TKey"></typeparam>
/// <typeparam name="TValue"></typeparam>
public class DictionaryReadOnly<TKey, TValue> : IDictionary<TKey, TValue>
{
    #region Private Members

    private IDictionary<TKey, TValue> _item;
    private bool _throwOnWritableAction = false;

    #endregion

    #region Constructors

    /// <summary>
    /// Constructor requiring the generic dictionary being wrapped.
    /// </summary>
    /// <param name="item"></param>
    public DictionaryReadOnly(IDictionary<TKey, TValue> items)
    {
        _throwOnWritableAction = true;
        _item = items;
    }

    /// <summary>
    /// Constructor requiring the generic dictionary being wrapped.
    /// </summary>
    /// <param name="item"></param>
    public DictionaryReadOnly(IDictionary<TKey, TValue> items, bool throwOnWritableAction)
    {            
        _throwOnWritableAction = throwOnWritableAction;
        _item = items;
    }
    #endregion

    #region IDictionary<TKey,TValue> Members

    /// <summary>
    /// Number of items in the dictionary.
    /// </summary>
    public int Count
    {
        get { return _item.Count; }
    }

    /// <summary>
    /// Determine if the underlying collection contains the key.
    /// </summary>
    /// <param name="key"></param>
    /// <returns></returns>
    public bool ContainsKey(TKey key)
    {
        return _item.ContainsKey(key);
    }

    /// <summary>
    /// Returns the value associated with the key.
    /// </summary>
    /// <param name="key"></param>
    /// <returns></returns>
    public TValue this[TKey key]
    {
        get { return _item[key]; }
        set
        {
            CheckAndThrow("Set");
        }
    }

    /// <summary>
    /// Return keys.
    /// </summary>
    public ICollection<TKey> Keys
    {
        get { return _item.Keys; }
    }

    /// <summary>
    /// Not-supported.
    /// </summary>
    /// <param name="key"></param>
    /// <param name="value"></param>
    public void Add(TKey key, TValue value)
    {
        CheckAndThrow("Add");
    }

    /// <summary>
    /// Not-supported.
    /// </summary>
    /// <param name="key"></param>
    /// <returns></returns>
    public bool Remove(TKey key)
    {
        CheckAndThrow("Remove");
        return false;
    }

    /// <summary>
    /// Try to get the value.
    /// </summary>
    /// <param name="key"></param>
    /// <param name="value"></param>
    /// <returns></returns>
    public bool TryGetValue(TKey key, out TValue value)
    {
        value = default(TValue);

        if (_item.ContainsKey(key))
        {
            value = _item[key];
            return true;
        }
        return false;
    }

    /// <summary>
    /// Get the values.
    /// </summary>
    public ICollection<TValue> Values
    {
        get { return _item.Values; }
    }

    #endregion

    #region ICollection<KeyValuePair<TKey,TValue>> Members

    /// <summary>
    /// Not-supported.
    /// </summary>
    /// <param name="item"></param>
    public void Add(KeyValuePair<TKey, TValue> item)
    {
        CheckAndThrow("Add");
    }

    /// <summary>
    /// Not-Supported.
    /// </summary>
    public void Clear()
    {
        CheckAndThrow("Clear");
    }

    /// <summary>
    /// Determine whether key value pair is in dictionary.
    /// </summary>
    /// <param name="item"></param>
    /// <returns></returns>
    public bool Contains(KeyValuePair<TKey, TValue> item)
    {
        return _item.Contains(item);
    }

    /// <summary>
    /// Copy items to the array.
    /// </summary>
    /// <param name="array"></param>
    /// <param name="arrayIndex"></param>
    public void CopyTo(KeyValuePair<TKey, TValue>[] array, int arrayIndex)
    {
        this._item.CopyTo(array, arrayIndex);
    }

    /// <summary>
    /// Indicate read-only
    /// </summary>
    public bool IsReadOnly
    {
        get { return true; }
    }

    /// <summary>
    /// Non-supported action.
    /// </summary>
    /// <param name="item"></param>
    /// <returns></returns>
    public bool Remove(KeyValuePair<TKey, TValue> item)
    {
        CheckAndThrow("Remove");
        return false;
    }

    #endregion

    #region IEnumerable<KeyValuePair<TKey,TValue>> Members
    /// <summary>
    /// Get the enumerator.
    /// </summary>
    /// <returns></returns>
    public IEnumerator<KeyValuePair<TKey, TValue>> GetEnumerator()
    {
        return _item.GetEnumerator();
    }

    #endregion

    #region IEnumerable Members
    /// <summary>
    /// Get the enumerator.
    /// </summary>
    /// <returns></returns>
    IEnumerator IEnumerable.GetEnumerator()
    {
        return _item.GetEnumerator();
    }

    #endregion

    /// <summary>
    /// Check and thrown based on flag.
    /// </summary>
    /// <param name="action"></param>
    void CheckAndThrow(string action)
    {
        if (_throwOnWritableAction)
            throw new InvalidOperationException("Can not perform action : " + action + " on this read-only collection.");
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T21:21:44.940

如果您只想提供枚举，则可以将其公开为[`IEnumerable`](http://msdn.microsoft.com/en-us/library/9eekhta0.aspx)键/值对类型。但是，这显然限制了一些可以执行的只读任务。

另一种选择是编写一个新类，[`IDictionary<TKey, TValue>`](http://msdn.microsoft.com/en-us/library/s4ys34ea.aspx)通过将这些调用映射到真实的包装字典并在任何修改调用（如`Add`.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T21:18:43.480

公开一个枚举（IEnumerable）。

*编辑：*示例：

```
class A : IEnumerable<B>
{
  ...
  public IEnumerator<B> GetEnumerator ( )
  {
    return _dictionary.GetEnumerator ( );
  }
  private Dictionary<B> _dictionary;
} 
```

# internet-explorer - 有没有办法强制 IE 卸载 ActiveX 控件？

> ID：616658
> 
> 赞同：15
> 
> 时间：2009-03-05T21:16:31.817
> 
> 标签：internet-explorer, com, activex

我们有一些动态 HTML 页面，其中包含一个`<OBJECT>`实例化 ActiveX 控件的标记。然后用户可以导航到另一个页面，该页面包含一个`<OBJECT>`指向更新版本的 ActiveX 控件的标记。

IE 将在第二页下载并安装新的 ActiveX，这就是该页面的用途。问题是，由于 IE 在第一页加载了 ActiveX，它现在将强制用户在完全安装下载的 ActiveX 之前重新启动，因为它正在被进程 (IE) 使用。

在普通容器中，我会在尝试升级之前简单地卸载 ActiveX。有没有办法强制 IE 这样做？浏览一个不使用控件的页面是可以接受的，如果这样做的话。

**编辑：**

需要 ActiveX 本身做某事的解决方案不会起作用，因为问题是当 IE 开始安装新版本的 ActiveX 时 ActiveX 仍在内存中。我要做的是在 IE 启动该进程时不在内存中拥有 ActiveX，因此显然我不能依赖 ActiveX 控件本身中的任何内容。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-22T09:45:14.517

试试 javascript delete 语句：

```
function unloadObject(objId) {

    var obj = document.getElementById(objId);

    obj.parentNode.removeChild(obj);

    delete obj;
} 
```

`unloadObject(targetActiveXTagId)`在打开第二页之前打电话。

理想情况下，您应该将升级机制构建到您的 ActiveX 本身中。我见过几个在线游戏平台这样做效果很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-04T09:47:58.097

虽然我不知道让 IE 卸载 DLL 的方法（它使 DLL 文件句柄保持打开状态——我希望它能正确释放对象本身......）我使用的一种解决方案是将 DLL 复制到临时文件（基于程序集版本），然后再打开它，然后显式破坏 IE/COM/whatever 缓存。因此，即使旧的 DLL 文件句柄保持打开状态，我也可以加载“新”版本。

*只有在满足所有*这些条件时，我才能打破缓存：

1.  不同的 ProgID（动态生成，可能与 DLL 不同）
2.  不同的 CLSID（也是动态生成的——就像一个魅力）
3.  不同的 DLL 名称（通过制作原始文件的副本并使用程序集版本，这可以避免 DLL-in-use-access 错误）
4.  不同的程序集版本（这是用于 .NET）

我正在开发侧边栏小工具，因此我可以只使用一些特权 ActiveX 脚本友好组件来完成上述工作，但预加载器（未更新）ActiveX 组件也可以完成这项工作。

我依靠 .NET/mscoree.dll 来处理 COM 的东西，所以可能会有一个更清洁的方法进入较低的级别。

不同的“版本控制”通过暂时加载到 HKCU\Software\Classes 结构中来处理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T08:39:12.687

我认为这是不可能的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T08:37:04.173

你不能改变工作流程吗？首先检查更新并避免整个问题！

无论您实施何种解决方案，浏览器都由客户端控制，任何（安全）更新或新版本都可能破坏您的系统。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T19:04:22.100

您是否尝试过使用 Javascript 来杀死 ActiveX 控件所在的 DOM 元素？如果你这样做，IE 会告诉控件卸载，但你必须确保控件实际上会卸载。然后，您应该能够使用较新的对象引用访问页面，这将启动较新的对象......

如果做不到这一点，您可以尝试打开一个弹出窗口，将您定向到一个从不加载您的对象的页面，同时，使用对主浏览器的命名引用，将其重定向到不引用您的对象的页面，给出它有机会卸载，然后重新引用您更新的 ActiveX。这应该加载您的新控件。

无论你走哪条路，这都是一个棘手的问题，但你也许可以让它做你想做的事。

如果您的控件行为不正常，它可能无法正确卸载，因此您必须注意这一点。

拉里

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T03:04:47.460

您可以尝试的一件事是让安装程序调用[CoFreeUnusedLibraries()](http://msdn.microsoft.com/en-us/library/ms679712(VS.85).aspx)，然后在 ActiveX 控件中的[DllCanUnloadNow()中使用 S_OK 响应。](http://msdn.microsoft.com/en-us/library/ms690368(VS.85).aspx)这可能会让你卸载，但我想知道 IE 是否仍会尝试回调到你卸载的模块。简单到可以尝试。

您也可以只编写一个存根 DLL 来实现您拥有的触摸 IE 的所有接口，然后只需 thunk 到您实际实现该功能的*真实DLL。*然后你可以让你的安装程序广播一条消息，上面写着“卸载真正的 DLL”。然后，您在完成后广播另一条消息并加载新消息。在进行更新时，您的存根会显示“请稍候，我正在更新...”消息。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-17T00:52:12.513

愚蠢的回答，对不起。如果您仍然有这个问题，我猜重定向不起作用。如果您没有尝试，只需创建一个重定向到您更新的 ActiveX 页面的页面并链接到那里。

中间人.html：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>blank page</title>
<meta http-equiv="REFRESH" content="0;url=http://www.newactivexcontrol.com"></HEAD>
<BODY>
</BODY>
</HTML> 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-19T06:25:46.900

显然是和不是。

它可能会发生，但前提是您通过安全漏洞“破解”它。所以不是通过任何合法的程序，不。

这是一篇描述漏洞状态的文章： [http ://www.juniper.net/security/auto/vulnerabilities/vuln16409.html](http://www.juniper.net/security/auto/vulnerabilities/vuln16409.html)

这里有一篇关于 Technet 的文章，讨论 DWORD ActiveX 如何杀死进程 [http://support.microsoft.com/default.aspx?scid=KB;EN-US;Q240797&sd=tech](http://support.microsoft.com/default.aspx?scid=KB;EN-US;Q240797&sd=tech)

这是 MSDN 网站上关于 ActiveX 控件的引用：

“用户不能直接与由 APPLET、EMBED 或 OBJECT 元素加载的 Microsoft ActiveX 控件进行交互。用户可以在激活其用户界面后与此类控件进行交互。” [http://msdn.microsoft.com/en-us/library/ms537508.aspx](http://msdn.microsoft.com/en-us/library/ms537508.aspx)

# security - 在拥有大量 SAP 投资的公司中，内部安全标准的最佳实践是什么？

> ID：616662
> 
> 赞同：2
> 
> 时间：2009-03-05T21:18:57.863
> 
> 标签：security, architecture, active-directory, single-sign-on, sap

我在一家大公司工作，我对内部安全标准的最佳实践很感兴趣。我们在 SAP 上投入了大量资金（超过 5 亿美元），我们的内部环境中也有 .Net 和一些 Java EE。

我从 MS 和 SAP 中找到了一些文档，但它已经过时并且不是很具体。

到目前为止，看起来我们最终可以将 Active Directory 用作所有非 SAP 应用程序的标准用户存储，并将 SAP CUA / Portal 用作 SAP 应用程序。

我对 AD 的一些担忧是：

*   能够为共享计算机上的应用程序主动超时（我们的少数应用程序在农村地区的远程办公室运行，共享计算机数量有限。在这些情况下，具有“超级用户”权限的主管可以使用应用程序，然后应该只有基本特权的职员可以立即使用同一台机器）

*   能够强制用户输入用户名和密码，而不仅仅是从用户的工作站读取凭据 - 因为它为桌面和电子邮件提取相同的凭据，所以它目前不会要求用户登录。这是一个也关注共享计算机上的应用程序。（参见上一个项目符号中的解释）

    就 AD 和 CUA 之间的同步而言，我想非常小心地处理这个问题。我们的预算有限，我想确保如果我们最终将一些东西放在适当的位置来同步商店，它会卖得很好并且提供卓越的价值。如果我们找不到这样的东西，我会很乐意回来建议商店保持独立。SSO 将是理想的，但我曾尝试在 SAML 之前启动 SSO 应用程序，但它并不漂亮。

首字母缩略词：

*   SSO：单点登录 SAML：安全性

*   断言标记语言

*   CUA：中央用户管理（适用于 SAP）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T16:48:38.563

关于这个问题有很多可能性。

我们有一个客户从 SAP HR 更新了他们的 AD 和 SAP 用户列表。这个想法是 OM 模块包含所有员工。您可以每天将所有活跃员工的列表导出到 LDAP，其中包含基本信息（名字、姓氏、员工 ID、登录名...）。对于 SAP 系统，需要 sap 访问的单元/功能/作业在哪里标记，用户在哪里创建/删除。

事实上，所有员工都有一个 SAP 帐户，但只有那些被标记的人有一个“对话”帐户。允许这些帐户通过 SAPGUI 连接，其他帐户必须使用门户，这是一种成本较低的许可证。一组允许为受管用户设置角色的规则。目标是最大限度地减少用户管理，并限制从一个组织的工作到另一个工作的自动化的不可阻挡的增长。（这是针对 105000 名员工的，人员流动很大）。

因此，SAP 没有直接链接到 AD，但它们是同步的。根据系统（开发、质量、集成、生产），SAP 配置了超时。您还可以为不同的系统设置不同的密码。

当然反过来也是可能的：从 SAP 询问 LDAP 来管理 SAP 的帐户，而不需要直接链接到 LDAP。事务 LDAP 可能会为您提供一些信息。

希望这可以帮助

**编辑**：同步是由 ABAP 程序完成的。该程序每天四点运行，并在 LDAP 中创建/删除/修改了一些帐户。之后，另一个程序向 LDAP 条目添加了一些技术信息，这些信息在 SAP RH 系统中不可用（例如用于给定员工的邮件服务器，具体取决于其在世界各地的位置）。然后检查一致性的条目，并将其发送到主 LDAP。

这个程序只管理人员和单位。手动或由其他程序管理的组（对其他应用程序的授权）。因此，非 SAP 数据也存储在 LDAP 中。

问候

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T22:59:20.150

如果用户不必登录，为什么会出现问题？对用户来说不是更方便吗？难道这不会给他们更多的动力来退出应用程序吗？

我现在正在做的项目使用 AD，我们在 SAP 内部有一个映射表来映射 AD 帐户和 SAP 帐户。同步是手动的，可能对您有用，也可能不适用，但没有真正的技术风险。

我希望我能给你更多的信息，但我并没有参与到这方面的事情上。不过，我可以调查一下。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T16:16:55.107

您可能想查看[OpenSSO](http://opensso.org/) - 它具有 SAP 代理，并将与 AD 集成作为用户存储。它也非常可靠[——Verizon 使用它让 4000 万客户登录到他们的网站](http://blogs.oracle.com/superpat/entry/verizon_wireless_on_improving_security)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2022-02-06T13:36:58.807

恕我直言。这不是在一个 Windows 会话中使用不同用户的好解决方案。特别是在 AD 中经过身份验证的用户。通常情况下，USER1 会在不关闭的情况下运行 sap 客户端，然后使用另一个 USER2。你会得到非人格化的用户。并且不要忘记用户不喜欢执行所有指令。

我们使用像 citrix 和 SSO 这样的瘦客户端。它是用户之间的完全拆分数据和授权。您必须为工作站上的用户使用不同的会话。好的想法是工作站上没有关键数据存储。

不是好主意，也不安全，但您可以 在同一会话中在 Windows 环境中**以不同用户应用程序的身份运行。**
但对于大公司来说，这不是安全的解决方案。

# c# - 如何删除只读的自定义 UITypeEditor 的省略号？

> ID：616671
> 
> 赞同：1
> 
> 时间：2009-03-05T21:20:49.853
> 
> 标签：c#, winforms, propertygrid

我的属性网格中有两个相同类型的字段。但是，一个是只读的，另一个是可编辑的。

这两个字段都是自定义类型，因此有一个自定义 UITypeEditor，它将省略号 ([...]) 按钮放在字段上。

```
[
     CategoryAttribute("5 - Wind"),
     DisplayName("Factored Area"),
     Description("The factored area for the segment."),
     EditorAttribute(typeof(umConversionTypeEditor), typeof(UITypeEditor)),
     TypeConverter(typeof(umConversionTypeConverter)),
     ReadOnly(true)
]
public FactoredAreaClass FactoredArea { ... }

[
     CategoryAttribute("5 - Wind"),
     DisplayName("Factored Area Modifier"),
     Description("The factored area modifier."),
     EditorAttribute(typeof(umConversionTypeEditor), typeof(UITypeEditor)),
     TypeConverter(typeof(umConversionTypeConverter))
]
public FactoredAreaClass FactoredAreaMod { ... } 
```

在这个例子中，FactoredAreaMod 是可以编辑的，但是 BOTH 都有省略号，这会给用户造成很大的混乱。有什么办法关掉吗？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T21:24:35.273

使用[ReadOnly](http://msdn.microsoft.com/en-us/library/system.componentmodel.readonlyattribute.aspx)属性。这将其标记为设计时只读，同时保持其读/写以供运行时使用。

此外，您应该将[Editor](http://msdn.microsoft.com/en-us/library/system.componentmodel.editorattribute.aspx)属性应用于类型而不是属性。如果您不希望该属性可编辑，则将其应用于属性没有任何好处。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T21:55:03.283

感谢 Jeff Yates，我想出了一个替代解决方案。这是我解决它的方法...

最大的问题是 EditorAttribute 实际上是在 FactoredAreaClass 中分配的。我把它放在原始示例中只是为了表明分配了一个编辑器属性。

```
[
    CategoryAttribute("5 - Wind"),
    DisplayName("Factored Area"),
    Description("The factored area for the segment."),
    EditorAttribute(typeof(UITypeEditor), typeof(UITypeEditor)), // RESET THE UITYPEEDITOR to "nothing"
    ReadOnly(true)
]
public FactoredAreaClass FactoredArea { ... }

[
    CategoryAttribute("5 - Wind"),
    DisplayName("Factored Area Modifier"),
    Description("The factored area modifier."),
    // the EditorAttribute and TypeConverter are part of FactoredAreaClass
]
public FactoredAreaClass FactoredAreaMod { ... } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-01-16T23:25:36.983

当有界属性为只读时，诀窍是不要使用 Modal 样式。幸运的是，在 GetEditStyle 方法中提供了上下文。一个简单的代码就可以完成这项工作：

```
public override UITypeEditorEditStyle GetEditStyle(ITypeDescriptorContext context)
{
  return context.PropertyDescriptor.IsReadOnly 
          ? UITypeEditorEditStyle.None 
          : UITypeEditorEditStyle.Modal;       
} 
```

# asp.net-mvc - 在 ASP.NET MVC RC2 中修改数据绑定

> ID：616682
> 
> 赞同：1
> 
> 时间：2009-03-05T21:23:21.487
> 
> 标签：asp.net-mvc, data-binding

如何修改 ASP.net MVC 中自动绑定的行为？

例如，假设我有一个简单的 Employee 对象。其中一个领域可能会被雇用。当此字段绑定到文本框时，它会显示 mm/dd/yyyy hh:mm:ss 而不仅仅是日期。

我知道我可以修改视图以添加格式，但我很确定我可以修改自动绑定，我只是不确定如何。

**编辑**

如果可能，请包含示例代码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-13T20:25:56.693

您必须创建一个自定义模型绑定器，但这有点痛苦。

这篇精彩的帖子准确地解释了你所追求的。在其中 Scott Hanselman 将日期拆分为多个字段，但您也可以对其进行调整以省略时间部分：

[http://www.hanselman.com/blog/SplittingDateTimeUnitTestingASPNETMVCCustomModelBinders.aspx](http://www.hanselman.com/blog/SplittingDateTimeUnitTestingASPNETMVCCustomModelBinders.aspx)

希望能有所帮助，答案还不算太晚；）

# java - Java接口扩展问题

> ID：616684
> 
> 赞同：3
> 
> 时间：2009-03-05T21:24:31.623
> 
> 标签：java, interface

我必须实现一个 RMI 服务器，它将作为其他两个 RMI 服务的前端。所以我决定做一个合乎逻辑的事情是让这个接口实现其他两个服务的接口。

```
public interface FrontEndServer extends Remote, BookServer, StudentServer
{
    // Block empty so far
} 
```

但是 StudentServer 上有一个方法

```
/**
 * Allows a student to borrow a book
 * 
 * @param studentID of the student who wishes to borrow a book
 * @param bookID of the book the student wishes to borrow
 * @throws RemoteException
 * @throws StudentNotFoundException when a student is not found in the system
 */
void addBookToStudent(int studentID, int bookID) throws RemoteException, StudentNotFoundException; 
```

我还想`FrontEndServer`抛出一个`BookNotFoundException`，因为该服务还将在尝试添加详细信息之前验证这本书是否确实存在。

这是可能的还是我的设计理念完全不成立，这实际上是一个糟糕的设计理念，就好像其他接口发生了变化一样？我会更好地为 中的所有方法编写方法签名`FrontEndServer`吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-05T21:33:40.837

如果你扩展一个接口（如果你实现一个接口，同样适用），你不能重写一个方法并让它抛出比原来**更多**的检查异常。你可以抛出相同或更少但不能更多。

想一想：

```
interface A {
  void foo();
}

interface B extends A {
  void foo() throws IOException;
}

A a = new B() { ... }
a.foo(); 
```

可能会引发 IOException 但您无法知道。这就是为什么你不能这样做。

这当然是完全可以接受的：

```
interface A {
  void foo() throws IOException;
}

interface B extends A {
  void foo();
}

A a = new B() { ... }
try {
    a.foo();
} catch (IOException e) {
    // must catch even though B.foo() won't throw one
} 
```

但是，您`BookNotFoundException`可以扩展`RuntimeException`或`RemoteException`. 但是不确定这是一个好方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-05T21:49:53.170

扩展这两个接口的单一类型有什么好处？当客户端依赖于两个不同的对象时，您会丢失任何东西吗？

过度使用继承是初学者常见的错误，因为“继承”是面向对象编程的显着特征之一。但是，在大多数情况下，组合是更好的选择。在这种情况下，为什么不拥有两个独立的服务呢？然后，添加`CafeteriaService`和`DormitoryService`以后不会影响任何现有接口。

关于设计，该`addBookToStudent`方法将受益于能够 throw `BookNotFoundException`。接口很脆弱，从某种意义上说，以任何方式更改它们都会破坏大量代码。在他们的初始设计中你必须非常小心。例如，`BookNotFoundException`大概是具体的；难道不能存在各种例外情况来阻止向学生“添加”一本书吗？（我猜学生正在借阅图书馆借书。）例如：`CheckOutLimitExceededException`、`UnpaidFinePendingException`、`AdultLiteraturePermissionException`等。

在设计接口时仔细考虑可能适合抽象级别的检查异常的类型，因为它们以后很难更改。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T21:37:28.817

给你一些想法：

1.  在接口中声明 addBookToStudent 方法抛出 BookNotFoundException。即使 StudentServer 可能永远不会真正抛出异常，但这并不意味着您无论如何都不能将它放在接口中。

2.  您可以创建一个新异常 - ObjectNotFoundException 并从那里继承 BookNotFoundException 和 StudentNotFoundException，然后声明 addBookToStudent 以抛出 ObjectNotFoundException。

3.  我在“现实生活”中可能会做的事情 - 让 StudentServer 与 BookServer 对话以验证书籍 ID 并自行抛出异常，而不是在 FrontEndServer 中进行检查。特别是如果 StudentServer 实际上会被 FrontEndServer 以外的任何东西直接使用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T21:40:30.963

我建议您尝试将暴露的 API 与用于实现您的功能的 API 分开。我的猜测是，RMI 服务前端的目的是提供与调用应用程序的分离和稳定性。

有了这个，我建议你：

*   编写要公开的 API
*   编写在您的 API 和后端服务之间架起桥梁的实现

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T21:35:26.327

如果 BookNotFoundException 扩展 RemoteExcepiton，理论上是可能的。

但是，我假设您无法控制 StudentServer 接口。该接口的目的似乎是不抛出 BookNotFoundException。虽然我能理解您为什么要这样做，但界面似乎并不鼓励这样做。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-05T21:45:40.730

异常是由方法而不是接口或类引发的。因此，如果接口中有一个方法，`BookServer`当您将其添加到接口时，它可能会抛出异常。

如果您正在考虑将异常添加到接口中的`addBookToStudent`方法`FrontEndServer`，答案是否定的，这是不可能的。类和接口中的重写方法只能缩小异常范围或将其完全删除，但不会添加新异常。

如果你仔细想想，你会发现这是合乎逻辑的。您`FrontEndServer`可以通过某些代码用作 BookServer。编译期间的代码需要 BookServer 中定义的异常。然后在运行时突然一个异常由 BookServer 引发，该异常未在 BookServer 接口中定义。如果那段代码只知道 BookException 是意外的，则没有 catch 或 throws 语句来处理它。

# asp.net - 在 asp.net Masterpage 中使用 JQuery

> ID：616694
> 
> 赞同：3
> 
> 时间：2009-03-05T21:26:26.767
> 
> 标签：asp.net, jquery, master-pages

当我在母版页中使用时，JQuery 无法识别标签。以下代码：

```
<script type="text/javascript">
    $("body").append('<div id="test"><p>Hello</p></div>');
</script> 
```

在普通页面中工作正常，但是当正文在母版页中并且我将相同的代码放在母版页中时 - 没有任何反应！

如何从 ASP 母版页附加到页面正文？这有什么技巧吗？

任何帮助将不胜感激。

标记。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T21:31:29.313

看起来你需要将它包装在一个 document.ready 块中，这样它就会在页面准备好时发生。

请记住 ASP.NET 页面生命周期（请参阅[此处](https://stackoverflow.com/questions/597042/what-is-the-page-lifecycle-of-an-asp-net-webform/597051#597051)以获取参考）。我认为这在您的基本页面而不是母版页中有效，因为页面恰好在基本页面加载后准备就绪，而不是在主页面加载后。

```
<script type="text/javascript">
    $(function() {
        $("body").append('<div id="test"><p>Hello</p></div>');
    });
</script> 
```

这也与

```
<script type="text/javascript">
    $(document).ready(function() {
        $("body").append('<div id="test"><p>Hello</p></div>');
    });
</script> 
```

# java - 如何使用 Java 关闭命令窗口

> ID：616700
> 
> 赞同：1
> 
> 时间：2009-03-05T21:29:22.410
> 
> 标签：java, window, command, runtime.exec

每次使用`Runtime.exec("cmd /c start....")`时，我都会打开一个 cmd 窗口。我想通过关闭每个以前的 cmd 窗口来创建一个更无缝的应用程序。我怎样才能做到这一点？

如果有人知道在同一个 cmd 窗口中运行一系列命令而不是每次执行命令时都打开新命令的更好方法，请告诉我。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-05T21:36:24.637

不要使用开始，这会打开另一个窗口

代替：

```
Runtime.exec("cmd /c start....") 
```

和：

```
Runtime.exec("cmd /c ....") 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T21:47:05.550

为什么需要 cmd windows？

我会直接在 Java 中运行命令并捕获输出并将其显示在本地窗口中（如果需要的话）。

只要确保您使用了程序的所有输出，否则它可能会停止。还要记住关闭 stdout、stderr 和 stdin 流，否则某些文件句柄可能会泄漏（嗯，在某些 Unix 操作系统上的某些 JDK 上确实如此……Windows，谁知道呢）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T22:11:52.087

您无法从 Java 控制打开的窗口。但我为您建议两种解决方案：

**首先**：

```
Runtime.exec("cmd /c start /MIN ...") 
```

/MIN 参数将阻止窗口出现。

**第二**：将您必须调用的所有应用程序放在同一个批处理文件中并调用一次。:-)

# javascript - javascript挂起浏览器

> ID：616710
> 
> 赞同：1
> 
> 时间：2009-03-05T21:31:52.807
> 
> 标签：javascript, browser

```
xmlDoc.load("cd_catalog.xml")

var cd=xmlDoc.getElementsByTagName("CD");
var id_set=1;
var id=xmlDoc.getElementsByTagName("ID"+id_set);

i=0;

function next()
{
if (i<id.length-1)
  {
  i++;
  display();

  }
}

function display()
{
document.write('<div class="dd">')
        document.write('<div class="blue" style="WIDTH:')
        document.write(cd[0].getElementsByTagName("ID"+id_set)[i].childNodes[0].nodeValue)
        document.write('"></div>')

document.write('</div>')

}

}
</script>

    <script type="text/javascript"> display()   </script>

    <br><input type="button" onclick="next()" value="next" ID="Button2" NAME="Button2"/> 
```

我看到了[相关的问题](https://stackoverflow.com/questions/575222/newbie-hanging-browser-on-function-call)，但不确定是否有帮助。我添加了 next() 函数，浏览器挂起，好像它正在加载某些东西，从来没有。如果没有 next() 调用，显示函数就可以工作。我正在尝试对此进行[更改](http://www.w3schools.com/xml/tryit.asp?filename=tryxml_app_navigate)。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-05T21:43:22.670

那个[相关的问题](https://stackoverflow.com/questions/575222/newbie-hanging-browser-on-function-call) *确实有*帮助。`document.write()`文档加载完成后，您将无法使用。请参阅其他问题的答案以了解如何替换`document.write()`.

# c# - SQL SMO 未枚举表

> ID：616717
> 
> 赞同：6
> 
> 时间：2009-03-05T21:33:53.177
> 
> 标签：c#, t4, sql-smo

我只是问这个问题，我觉得自己很笨，但我没有从谷歌那里得到任何帮助，我通过简单的搜索 SMO 浏览了所有 SO 的结果，也没有看到它。

简短的版本是我开始玩 T4。我正在扩展[Oleg Sych 的初始教程](http://www.olegsych.com/2008/09/t4-tutorial-creatating-your-first-code-generator/)，以提供对所有表的枚举以创建一个（恕我直言，相当愚蠢）删除过程。这只是一个实验，所以它完全没用并不会打扰我。:)

我对 Oleg 教程的扩展如下所示：

```
<#@ template language="C#" hostspecific="true" #>
<#@ output extension="SQL" #>
<#@ assembly name="Microsoft.SqlServer.ConnectionInfo" #>
<#@ assembly name="Microsoft.SqlServer.Smo" #>
<#@ import namespace="Microsoft.SqlServer.Management.Smo" #>
<#@ include file="T4Toolbox.tt" #>
<#
    // Config variables
    string serverName = "dbserver\\dbinstance";
    string dbName = "dbname";
#>
USE <#= dbName #>
<#  
    // Iterate over tables and generate procs
    Server server = new Server(serverName);
    Database database = new Database(server, dbName);

    WriteLine("/* Number of tables: " + database.Tables.Count.ToString() + " */");

    foreach (Table table in database.Tables)
    {
        table.Refresh();
#>
CREATE PROCEDURE <#= table.Name #>_Delete
<#
        PushIndent("    ");
        foreach (Column column in table.Columns)
        {
            if (column.InPrimaryKey)
                WriteLine("@" + column.Name + " " + column.DataType.Name);
        }
        PopIndent();
#>
AS
    DELETE FROM 
        <#= table.Name #>
    WHERE
<#
        PushIndent("        ");
        foreach (Column column in table.Columns)
        {
            if (column.InPrimaryKey)
                WriteLine(column.Name + " = @" + column.Name);
        }
        PopIndent();
        WriteLine("GO");
    }
#> 
```

问题是`Tables`集合中没有返回表。这由我生成的表计数 SQL 注释验证，它输出`0`.

如所写，上面的代码生成以下内容：

```
USE dbname
/* Number of tables: 0 */ 
```

但是，如果我删除 for 循环并手动提供此数据库中存在的有效表名，它会为该表生成（又是愚蠢的）proc。

这些表被分成一个模式，这有关系吗？此外，这与 SQL2005 实例背道而驰——这可能会导致问题吗？

最后，我还发现我无法通过 Synonyms 集合枚举同义词。（我想我会很聪明，走那条路，因为表在一个模式中，但是定义了同义词。但是......没有骰子。）

再次重申，上面的代码自然不是生产，甚至不值得生产。我只是想同时学习 T4 和 SMO，并在尝试做一些我认为简单得可笑的事情时遇到了障碍。:)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-05T23:01:53.670

如果您只是创建 Database 类的新实例，SMO 不会自动检索元数据。检索元数据可能需要一段时间，尤其是在寒冷的环境中。在循环之前调用 database.Refresh()。

# c# - 如何在 C# 中获取常用文件类型图标？

> ID：616718
> 
> 赞同：18
> 
> 时间：2009-03-05T21:34:01.897
> 
> 标签：c#, .net, windows, icons, file-type

如[This SO question on getting icons](https://stackoverflow.com/questions/524137/get-icons-for-common-file-types) for common file types 中所见，Windows 程序很可能使用 C++ Shell API 获取已注册文件类型的图标。这些图标可能存在也可能不存在于磁盘上——例如，我们想要制作自己的自定义文件浏览器，并希望显示与文件相关的系统图标。

是否有本机 C# 方法来获取各种文件类型的图标（如果有，如何），还是必须通过带有 shell API 的 PInvoke 来完成？

作为后续，如果有本地 .NET 方式来做这件事，是否有跨平台方式来做这件事？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-03-05T22:27:18.213

我的一个旧开源项目包括一个完全可以做到这一点的[Icon 类](http://win32iam.svn.sourceforge.net/viewvc/win32iam/trunk/BlackFox.UninstallInformations/IconHandler.cs?view=markup)，请随意撕掉它，看看我把这个文件放在公共领域的年龄无论如何它只是 PInvoke 大部分。

要获取您使用的图标，例如：

```
Icon zipIcon = BlackFox.Win32.Icons.IconFromExtension(".zip", SystemIconSize.Small); 
```

完整样本：

```
using System;
using System.Windows.Forms;
using BlackFox.Win32;
using System.Drawing;

class Program
{
    static void Main(string[] args)
    {
        PictureBox pict = new PictureBox();
        pict.Image = Icons.IconFromExtension(".zip", Icons.SystemIconSize.Large).ToBitmap();
        pict.Dock = DockStyle.Fill;
        pict.SizeMode = PictureBoxSizeMode.CenterImage;

        Form form = new Form();
        form.Controls.Add(pict);

        Application.Run(form);        
    }
} 
```

图书馆 ：

```
using System;
using System.Drawing;
using System.Runtime.InteropServices;
using Microsoft.Win32;
using System.Reflection;
using System.Collections.Generic;

namespace BlackFox.Win32
{
    public static class Icons
    {
        #region Custom exceptions class

        public class IconNotFoundException : Exception
        {
            public IconNotFoundException(string fileName, int index)
                : base(string.Format("Icon with Id = {0} wasn't found in file {1}", index, fileName))
            {
            }
        }

        public class UnableToExtractIconsException : Exception
        {
            public UnableToExtractIconsException(string fileName, int firstIconIndex, int iconCount)
                : base(string.Format("Tryed to extract {2} icons starting from the one with id {1} from the \"{0}\" file but failed", fileName, firstIconIndex, iconCount))
            {
            }
        }

        #endregion

        #region DllImports

        /// <summary>
        /// Contains information about a file object. 
        /// </summary>
        struct SHFILEINFO
        {
            /// <summary>
            /// Handle to the icon that represents the file. You are responsible for
            /// destroying this handle with DestroyIcon when you no longer need it. 
            /// </summary>
            public IntPtr hIcon;

            /// <summary>
            /// Index of the icon image within the system image list.
            /// </summary>
            public IntPtr iIcon;

            /// <summary>
            /// Array of values that indicates the attributes of the file object.
            /// For information about these values, see the IShellFolder::GetAttributesOf
            /// method.
            /// </summary>
            public uint dwAttributes;

            /// <summary>
            /// String that contains the name of the file as it appears in the Microsoft
            /// Windows Shell, or the path and file name of the file that contains the
            /// icon representing the file.
            /// </summary>
            [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 260)]
            public string szDisplayName;

            /// <summary>
            /// String that describes the type of file.
            /// </summary>
            [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 80)]
            public string szTypeName;
        };

        [Flags]
        enum FileInfoFlags : int
        {
            /// <summary>
            /// Retrieve the handle to the icon that represents the file and the index 
            /// of the icon within the system image list. The handle is copied to the 
            /// hIcon member of the structure specified by psfi, and the index is copied 
            /// to the iIcon member.
            /// </summary>
            SHGFI_ICON = 0x000000100,
            /// <summary>
            /// Indicates that the function should not attempt to access the file 
            /// specified by pszPath. Rather, it should act as if the file specified by 
            /// pszPath exists with the file attributes passed in dwFileAttributes.
            /// </summary>
            SHGFI_USEFILEATTRIBUTES = 0x000000010
        }

        /// <summary>
        ///     Creates an array of handles to large or small icons extracted from
        ///     the specified executable file, dynamic-link library (DLL), or icon
        ///     file. 
        /// </summary>
        /// <param name="lpszFile">
        ///     Name of an executable file, DLL, or icon file from which icons will
        ///     be extracted.
        /// </param>
        /// <param name="nIconIndex">
        ///     <para>
        ///         Specifies the zero-based index of the first icon to extract. For
        ///         example, if this value is zero, the function extracts the first
        ///         icon in the specified file.
        ///     </para>
        ///     <para>
        ///         If this value is �1 and <paramref name="phiconLarge"/> and
        ///         <paramref name="phiconSmall"/> are both NULL, the function returns
        ///         the total number of icons in the specified file. If the file is an
        ///         executable file or DLL, the return value is the number of
        ///         RT_GROUP_ICON resources. If the file is an .ico file, the return
        ///         value is 1\. 
        ///     </para>
        ///     <para>
        ///         Windows 95/98/Me, Windows NT 4.0 and later: If this value is a 
        ///         negative number and either <paramref name="phiconLarge"/> or 
        ///         <paramref name="phiconSmall"/> is not NULL, the function begins by
        ///         extracting the icon whose resource identifier is equal to the
        ///         absolute value of <paramref name="nIconIndex"/>. For example, use -3
        ///         to extract the icon whose resource identifier is 3\. 
        ///     </para>
        /// </param>
        /// <param name="phIconLarge">
        ///     An array of icon handles that receives handles to the large icons
        ///     extracted from the file. If this parameter is NULL, no large icons
        ///     are extracted from the file.
        /// </param>
        /// <param name="phIconSmall">
        ///     An array of icon handles that receives handles to the small icons
        ///     extracted from the file. If this parameter is NULL, no small icons
        ///     are extracted from the file. 
        /// </param>
        /// <param name="nIcons">
        ///     Specifies the number of icons to extract from the file. 
        /// </param>
        /// <returns>
        ///     If the <paramref name="nIconIndex"/> parameter is -1, the
        ///     <paramref name="phIconLarge"/> parameter is NULL, and the
        ///     <paramref name="phiconSmall"/> parameter is NULL, then the return
        ///     value is the number of icons contained in the specified file.
        ///     Otherwise, the return value is the number of icons successfully
        ///     extracted from the file. 
        /// </returns>
        [DllImport("Shell32", CharSet = CharSet.Auto)]
        extern static int ExtractIconEx(
            [MarshalAs(UnmanagedType.LPTStr)] 
            string lpszFile,
            int nIconIndex,
            IntPtr[] phIconLarge,
            IntPtr[] phIconSmall,
            int nIcons);

        [DllImport("Shell32", CharSet = CharSet.Auto)]
        extern static IntPtr SHGetFileInfo(
            string pszPath,
            int dwFileAttributes,
            out SHFILEINFO psfi,
            int cbFileInfo,
            FileInfoFlags uFlags);

        #endregion

        /// <summary>
        /// Two constants extracted from the FileInfoFlags, the only that are
        /// meaningfull for the user of this class.
        /// </summary>
        public enum SystemIconSize : int
        {
            Large = 0x000000000,
            Small = 0x000000001
        }

        /// <summary>
        /// Get the number of icons in the specified file.
        /// </summary>
        /// <param name="fileName">Full path of the file to look for.</param>
        /// <returns></returns>
        static int GetIconsCountInFile(string fileName)
        {
            return ExtractIconEx(fileName, -1, null, null, 0);
        }

        #region ExtractIcon-like functions

        public static void ExtractEx(string fileName, List<Icon> largeIcons,
            List<Icon> smallIcons, int firstIconIndex, int iconCount)
        {
            /*
             * Memory allocations
             */

            IntPtr[] smallIconsPtrs = null;
            IntPtr[] largeIconsPtrs = null;

            if (smallIcons != null)
            {
                smallIconsPtrs = new IntPtr[iconCount];
            }
            if (largeIcons != null)
            {
                largeIconsPtrs = new IntPtr[iconCount];
            }

            /*
             * Call to native Win32 API
             */

            int apiResult = ExtractIconEx(fileName, firstIconIndex, largeIconsPtrs, smallIconsPtrs, iconCount);
            if (apiResult != iconCount)
            {
                throw new UnableToExtractIconsException(fileName, firstIconIndex, iconCount);
            }

            /*
             * Fill lists
             */

            if (smallIcons != null)
            {
                smallIcons.Clear();
                foreach (IntPtr actualIconPtr in smallIconsPtrs)
                {
                    smallIcons.Add(Icon.FromHandle(actualIconPtr));
                }
            }
            if (largeIcons != null)
            {
                largeIcons.Clear();
                foreach (IntPtr actualIconPtr in largeIconsPtrs)
                {
                    largeIcons.Add(Icon.FromHandle(actualIconPtr));
                }
            }
        }

        public static List<Icon> ExtractEx(string fileName, SystemIconSize size,
            int firstIconIndex, int iconCount)
        {
            List<Icon> iconList = new List<Icon>();

            switch (size)
            {
                case SystemIconSize.Large:
                    ExtractEx(fileName, iconList, null, firstIconIndex, iconCount);
                    break;

                case SystemIconSize.Small:
                    ExtractEx(fileName, null, iconList, firstIconIndex, iconCount);
                    break;

                default:
                    throw new ArgumentOutOfRangeException("size");
            }

            return iconList;
        }

        public static void Extract(string fileName, List<Icon> largeIcons, List<Icon> smallIcons)
        {
            int iconCount = GetIconsCountInFile(fileName);
            ExtractEx(fileName, largeIcons, smallIcons, 0, iconCount);
        }

        public static List<Icon> Extract(string fileName, SystemIconSize size)
        {
            int iconCount = GetIconsCountInFile(fileName);
            return ExtractEx(fileName, size, 0, iconCount);
        }

        public static Icon ExtractOne(string fileName, int index, SystemIconSize size)
        {
            try
            {
                List<Icon> iconList = ExtractEx(fileName, size, index, 1);
                return iconList[0];            
            }
            catch (UnableToExtractIconsException)
            {
                throw new IconNotFoundException(fileName, index);
            }
        }

        public static void ExtractOne(string fileName, int index,
            out Icon largeIcon, out Icon smallIcon)
        {
            List<Icon> smallIconList = new List<Icon>();
            List<Icon> largeIconList = new List<Icon>();
            try
            {
                ExtractEx(fileName, largeIconList, smallIconList, index, 1);
                largeIcon = largeIconList[0];
                smallIcon = smallIconList[0];
            }
            catch (UnableToExtractIconsException)
            {
                throw new IconNotFoundException(fileName, index);
            }
        }

        #endregion

        //this will look throw the registry 
        //to find if the Extension have an icon.
        public static Icon IconFromExtension(string extension,
                                                SystemIconSize size)
        {
            // Add the '.' to the extension if needed
            if (extension[0] != '.') extension = '.' + extension;

            //opens the registry for the wanted key.
            RegistryKey Root = Registry.ClassesRoot;
            RegistryKey ExtensionKey = Root.OpenSubKey(extension);
            ExtensionKey.GetValueNames();
            RegistryKey ApplicationKey =
                Root.OpenSubKey(ExtensionKey.GetValue("").ToString());

            //gets the name of the file that have the icon.
            string IconLocation =
                ApplicationKey.OpenSubKey("DefaultIcon").GetValue("").ToString();
            string[] IconPath = IconLocation.Split(',');

            if (IconPath[1] == null) IconPath[1] = "0";
            IntPtr[] Large = new IntPtr[1], Small = new IntPtr[1];

            //extracts the icon from the file.
            ExtractIconEx(IconPath[0],
                Convert.ToInt16(IconPath[1]), Large, Small, 1);
            return size == SystemIconSize.Large ?
                Icon.FromHandle(Large[0]) : Icon.FromHandle(Small[0]);
        }

        public static Icon IconFromExtensionShell(string extension, SystemIconSize size)
        {
            //add '.' if nessesry
            if (extension[0] != '.') extension = '.' + extension;

            //temp struct for getting file shell info
            SHFILEINFO fileInfo = new SHFILEINFO();

            SHGetFileInfo(
                extension,
                0,
                out fileInfo,
                Marshal.SizeOf(fileInfo),
                FileInfoFlags.SHGFI_ICON | FileInfoFlags.SHGFI_USEFILEATTRIBUTES | (FileInfoFlags)size);

            return Icon.FromHandle(fileInfo.hIcon);
        }

        public static Icon IconFromResource(string resourceName)
        {
            Assembly assembly = Assembly.GetCallingAssembly();

            return new Icon(assembly.GetManifestResourceStream(resourceName));
        }

        /// <summary>
        /// Parse strings in registry who contains the name of the icon and
        /// the index of the icon an return both parts.
        /// </summary>
        /// <param name="regString">The full string in the form "path,index" as found in registry.</param>
        /// <param name="fileName">The "path" part of the string.</param>
        /// <param name="index">The "index" part of the string.</param>
        public static void ExtractInformationsFromRegistryString(
            string regString, out string fileName, out int index)
        {
            if (regString == null)
            {
                throw new ArgumentNullException("regString");
            }
            if (regString.Length == 0)
            {
                throw new ArgumentException("The string should not be empty.", "regString");
            }

            index = 0;
            string[] strArr = regString.Replace("\"", "").Split(',');
            fileName = strArr[0].Trim();
            if (strArr.Length > 1)
            {
                int.TryParse(strArr[1].Trim(), out index);
            }
        }

        public static Icon ExtractFromRegistryString(string regString, SystemIconSize size)
        {
            string fileName;
            int index;
            ExtractInformationsFromRegistryString(regString, out fileName, out index);
            return ExtractOne(fileName, index, size);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-05T21:58:36.410

看看： http: [//mvolo.com/display-pretty-file-icons-in-your-aspnet-applications-with-iconhandler/](http://mvolo.com/display-pretty-file-icons-in-your-aspnet-applications-with-iconhandler/)

这不是最干净的解决方案，但它有效。否则，请尝试使用基于 mime 类型或文件扩展名的图标库。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-08-28T07:49:38.877

我确定您已经找到了解决问题的方法，但为了其他人的利益，我对 VirtualBlackFox 的解决方案进行了一些修改。

只需替换 IconFromExtension 方法...

```
public static Icon IconFromExtension(string extension,
                                            SystemIconSize size)
    {
        // Add the '.' to the extension if needed
        if (extension[0] != '.') extension = '.' + extension;

        //opens the registry for the wanted key.
        RegistryKey Root = Registry.ClassesRoot;
        RegistryKey ExtensionKey = Root.OpenSubKey(extension);
        ExtensionKey.GetValueNames();
        RegistryKey ApplicationKey =
            Root.OpenSubKey(ExtensionKey.GetValue("").ToString());

        RegistryKey CurrentVer = null;
        try
        {
            CurrentVer = Root.OpenSubKey(ApplicationKey.OpenSubKey("CurVer").GetValue("").ToString());
        }
        catch (Exception ex)
        {
            //current version not found... carry on without it?
        }

        if (CurrentVer != null)
            ApplicationKey = CurrentVer;

        //gets the name of the file that have the icon.
        string IconLocation =
            ApplicationKey.OpenSubKey("DefaultIcon").GetValue("").ToString();
        string[] IconPath = IconLocation.Split(',');

        IntPtr[] Large = null;
        IntPtr[] Small = null;
        int iIconPathNumber = 0;

        if (IconPath.Length > 1)
            iIconPathNumber = 1;
        else
            iIconPathNumber = 0;

        if (IconPath[iIconPathNumber] == null) IconPath[iIconPathNumber] = "0";
        Large = new IntPtr[1];
        Small = new IntPtr[1];

        //extracts the icon from the file.
        if (iIconPathNumber > 0)
        {
            ExtractIconEx(IconPath[0],
                Convert.ToInt16(IconPath[iIconPathNumber]), Large, Small, 1);
        }
        else
        {
            ExtractIconEx(IconPath[0],
                Convert.ToInt16(0), Large, Small, 1);
        }

        return size == SystemIconSize.Large ?
            Icon.FromHandle(Large[0]) : Icon.FromHandle(Small[0]);
    } 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-05T21:59:39.667

Icon.ExtractAssociatedIcon() 不会成功。正如[MSDN](http://msdn.microsoft.com/en-us/library/system.drawing.icon.extractassociatedicon.aspx)所说，它只提取文件**中包含**的图标。所以创建虚拟文件也无济于事。据我所知，您必须使用 p/invoke 方式才能访问这些图标。与此相关的一个问题是[this](https://stackoverflow.com/questions/462270/get-file-icon-used-by-shell)。[MaLio](http://www.dotnetjunkies.com/WebLog/malio/archive/2004/10/04/27603.aspx)似乎有一个非常完整的例子来说明如何使用 p/invoke 获取图标。

我也不知道有一种与平台无关的方法来做到这一点（而且我认为没有）。

对不起，我无法为您提供更好的消息！

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-11-06T14:17:34.213

[可以使用IQueryAssociations](http://msdn.microsoft.com/en-us/library/bb761400.aspx)接口，而不是通过注册表浏览。此接口还可用于获取有关已注册文件类型的更多信息（参见即 ASSOCSTR 类型）。下面我附上替换 VirtualBlackFox 解决方案中的 IconFromExtension 方法的代码（他的部分代码保持不变）：

```
public static Icon IconFromExtension(string extension, SystemIconSize size)
  {
     if (extension[0] != '.') extension = '.' + extension;

     object obj;
     shell.AssocCreate(shell.CLSID_QueryAssociations, ref shell.IID_IQueryAssociations, out obj);
     var qa = (shell.IQueryAssociations)obj;
     qa.Init(shell.ASSOCF.INIT_DEFAULTTOSTAR, Convert.ToString(extension), UIntPtr.Zero, IntPtr.Zero);

     var bufSize = 0;
     qa.GetString(shell.ASSOCF.NOTRUNCATE, shell.ASSOCSTR.DEFAULTICON, null, null, ref bufSize);

     var sb = new StringBuilder(bufSize);
     qa.GetString(shell.ASSOCF.NOTRUNCATE, shell.ASSOCSTR.DEFAULTICON, null, sb, ref bufSize);

     if (!String.IsNullOrEmpty(sb.ToString()))
     {
        var iconLocation = sb.ToString();
        var iconPath = iconLocation.Split(',');

        var iIconPathNumber = iconPath.Length > 1 ? 1 : 0;

        if (iconPath[iIconPathNumber] == null) iconPath[iIconPathNumber] = "0";
        var large = new IntPtr[1];
        var small = new IntPtr[1];

        //extracts the icon from the file.
        ExtractIconEx(iconPath[0],
                      iIconPathNumber > 0 ? Convert.ToInt16(iconPath[iIconPathNumber]) : Convert.ToInt16(0),
                      large,
                      small, 1);

        return size == SystemIconSize.Large
                  ? Icon.FromHandle(large[0])
                  : Icon.FromHandle(small[0]);
     }
     return IntPtr.Zero;
  } 
```

除了上面的代码之外，还需要一个“shell”类——Shell API 的一个包装器（下面仅限于 AssocCreate 和必要的类型）：

```
using System;
using System.Runtime.InteropServices;
using System.Text;
#pragma warning disable 1591
// ReSharper disable InconsistentNaming

namespace <put_your_appropriate_namespace_here>
{
   public class shell
   {
      [DllImport("shlwapi.dll")]
      public extern static int AssocCreate(
         Guid clsid,
         ref Guid riid,
         [MarshalAs(UnmanagedType.Interface)] out object ppv);

      [Flags]
      public enum ASSOCF
      {
         INIT_NOREMAPCLSID = 0x00000001,
         INIT_BYEXENAME = 0x00000002,
         OPEN_BYEXENAME = 0x00000002,
         INIT_DEFAULTTOSTAR = 0x00000004,
         INIT_DEFAULTTOFOLDER = 0x00000008,
         NOUSERSETTINGS = 0x00000010,
         NOTRUNCATE = 0x00000020,
         VERIFY = 0x00000040,
         REMAPRUNDLL = 0x00000080,
         NOFIXUPS = 0x00000100,
         IGNOREBASECLASS = 0x00000200,
         INIT_IGNOREUNKNOWN = 0x00000400
      }

      public enum ASSOCSTR
      {
         COMMAND = 1,
         EXECUTABLE,
         FRIENDLYDOCNAME,
         FRIENDLYAPPNAME,
         NOOPEN,
         SHELLNEWVALUE,
         DDECOMMAND,
         DDEIFEXEC,
         DDEAPPLICATION,
         DDETOPIC,
         INFOTIP,
         QUICKTIP,
         TILEINFO,
         CONTENTTYPE,
         DEFAULTICON,
         SHELLEXTENSION
      }

      public enum ASSOCKEY
      {
         SHELLEXECCLASS = 1,
         APP,
         CLASS,
         BASECLASS
      }

      public enum ASSOCDATA
      {
         MSIDESCRIPTOR = 1,
         NOACTIVATEHANDLER,
         QUERYCLASSSTORE,
         HASPERUSERASSOC,
         EDITFLAGS,
         VALUE
      }

      [Guid("c46ca590-3c3f-11d2-bee6-0000f805ca57"), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
      public interface IQueryAssociations
      {
         void Init(
           [In] ASSOCF flags,
           [In, MarshalAs(UnmanagedType.LPWStr)] string pszAssoc,
           [In] UIntPtr hkProgid,
           [In] IntPtr hwnd);

         void GetString(
           [In] ASSOCF flags,
           [In] ASSOCSTR str,
           [In, MarshalAs(UnmanagedType.LPWStr)] string pwszExtra,
           [Out, MarshalAs(UnmanagedType.LPWStr)] StringBuilder pwszOut,
           [In, Out] ref int pcchOut);

         void GetKey(
           [In] ASSOCF flags,
           [In] ASSOCKEY str,
           [In, MarshalAs(UnmanagedType.LPWStr)] string pwszExtra,
           [Out] out UIntPtr phkeyOut);

         void GetData(
           [In] ASSOCF flags,
           [In] ASSOCDATA data,
           [In, MarshalAs(UnmanagedType.LPWStr)] string pwszExtra,
           [Out, MarshalAs(UnmanagedType.LPArray, SizeParamIndex = 4)] out byte[] pvOut,
           [In, Out] ref int pcbOut);

         void GetEnum(); // not used actually
      }

      public static Guid CLSID_QueryAssociations = new Guid("a07034fd-6caa-4954-ac3f-97a27216f98a");
      public static Guid IID_IQueryAssociations = new Guid("c46ca590-3c3f-11d2-bee6-0000f805ca57");

   }
} 
```

对于需要 ImageSource 的 WPF 用户：

将返回类型从 Icon 替换为 ImageSource 并将 return 子句替换为：

```
 var iconPtr = size == SystemIconSize.Large ? large[0] : small[0];
     if (iconPtr != IntPtr.Zero)
     {
        return Imaging.CreateBitmapSourceFromHIcon(
           iconPtr,
           Int32Rect.Empty,
           BitmapSizeOptions.FromEmptyOptions());
     } 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-06-29T20:11:52.223

这个类应该做的工作。传递文件名（带路径）或文件夹名称（带路径）。

```
public static class FileIcon
{
    [DllImport("shell32.dll")]
    private static extern IntPtr SHGetFileInfo(string pszPath, uint dwFileAttributes, ref SHFILEINFO psfi, uint cbSizeFileInfo, uint uFlags);
    [StructLayout(LayoutKind.Sequential)]
    private struct SHFILEINFO
    {
        public IntPtr hIcon;
        public IntPtr iIcon;
        public uint dwAttributes;
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 260)]
        public string szDisplayName;
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 80)]
        public string szTypeName;
    };
    private const uint SHGFI_ICON = 0x100;
    private const uint SHGFI_LARGEICON = 0x0; // 'Large icon
    private const uint SHGFI_SMALLICON = 0x1; // 'Small icon

    public static System.Drawing.Icon GetLargeIcon(string file)
    {
        FileIcon.SHFILEINFO shinfo = new FileIcon.SHFILEINFO();
        IntPtr hImgLarge = FileIcon.SHGetFileInfo(file, 0, ref shinfo, (uint)Marshal.SizeOf(shinfo), FileIcon.SHGFI_ICON | FileIcon.SHGFI_LARGEICON);
        return System.Drawing.Icon.FromHandle(shinfo.hIcon);
    }

    public static System.Drawing.Icon GetSmallIcon(string file)
    {
        FileIcon.SHFILEINFO shinfo = new FileIcon.SHFILEINFO();
        IntPtr hImgLarge = FileIcon.SHGetFileInfo(file, 0, ref shinfo, (uint)Marshal.SizeOf(shinfo), FileIcon.SHGFI_ICON | FileIcon.SHGFI_SMALLICON);
        return System.Drawing.Icon.FromHandle(shinfo.hIcon);
    }
} 
```

# c# - C#，事件与委托有何不同？

> ID：616719
> 
> 赞同：1
> 
> 时间：2009-03-05T21:34:03.693
> 
> 标签：c#

event 关键字的真正作用是什么？

[msdn](http://msdn.microsoft.com/en-us/library/8627sbea.aspx)说它用于在发布者类中声明事件

```
// Declare the event.
public event SampleEventHandler SampleEvent; 
```

如果我不将事件放在它前面，这是否意味着 SampleEvent 不再是 SampleEventHandler 了？

除了超级棒的 -= 和 += 运算符之外，我还能从 List<MyDelegate> 中得不到的事件/事件处理程序中得到什么？我什么时候应该使用其中一种？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T21:37:27.663

委托支持 += 和 -= 操作，事件也是如此。您也可以将它们称为方法。

但不同的是，调用事件对于它所属的类来说是私有的，而 += 和 -= 是公共的。此外，您也不能在课堂外使用 = 分配给事件。

# sharepoint - 对 Sharepoint 2007 网络中的页面实施投票？

> ID：616721
> 
> 赞同：2
> 
> 时间：2009-03-05T21:34:34.597
> 
> 标签：sharepoint, sharepoint-2007

我在 Sharepoint 2007 中开发了一个网站。我有一个包含内容的richhtml 字段的页面。我需要添加任何用户添加评论的可能性，以及使用下拉列表对页面进行评分的选项，其值为 1-5，然后汇总所有投票并显示页面的全局评分。我不知道如何在 Sharepoint 中执行此操作，或者我的选择是什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T09:12:01.953

您应该尝试一下[SharePoint 工具篮](http://sptoolbasket.codeplex.com/)的[文档评级系统。](http://sptoolbasket.codeplex.com/Wiki/View.aspx?title=SharePoint%20-%20Document%20Rating%20System&referringTitle=Home)

> 该项目允许经过身份验证的用户评价：
> 
> *   自定义列表、文档库、图片库、问题列表、日历、链接
> *   讨论板
> *   页。
> *   博客文章
> *   主持人模块
> *   该系统还包含一个站点定义，现在提供英语、法语和荷兰语版本

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T13:40:01.763

此外，SharePoint 的播客工具包[http://www.codeplex.com/pks](http://www.codeplex.com/pks)（由 Microsoft 开发）包含一个不错的评级控制。

# xml - ThreadContext 属性不写入 AdoNetAppender

> ID：616729
> 
> 赞同：0
> 
> 时间：2009-03-05T21:36:10.957
> 
> 标签：xml, configuration, log4net, adonetappender

我正在使用 log4net 1.2.10.0。我已经扩展了 ILog 和 LogManager 以包含一个新级别“AUDIT”。我想使用一个`AdoNetAppender`记录`%message`到数据库。我需要记录其他信息，我尝试使用`log4net.ThreadContext.Properties`.

当我尝试将上下文属性用作 SQL 参数的值时，我没有得到任何输出。

```
<log4net>
  <level>
    <name value="AUDIT" />
    <value value="35000" />
  </level>
  <appender name="AdoNetAppender.Audit" type="log4net.Appender.AdoNetAppender">
    <filter type="log4net.Filter.LevelMatchFilter">
      <levelToMatch value="AUDIT" />
    </filter>
    <filter type="log4net.Filter.DenyAllFilter" />
    <connectionType value="System.Data.OracleClient.OracleConnection, System.Data.OracleClient, Version=1.0.3300.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
    <connectionString value="data source=db1;User ID=user;Password=pass" />
    <commandText value="INSERT INTO table1 VALUES(:custom_prop, :message)" />
    <parameter>
      <parameterName value=":custom_prop" />
      <dbType value="String" />
      <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%property{custom_prop}" />
      </layout>
    </parameter>
    <parameter>
      <parameterName value=":message" />
      <dbType value="String" />
      <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%message" />
      </layout>
    </parameter>
  </appender>
  <root>
    <level value="ALL" />
    <appender-ref ref="AdoNetAppender.Audit" />
  </root>
</log4net> 
```

执行代码是（假设 log4net 已被初始化并创建了一个记录器“log”）。

```
log4net.ThreadContext.Properties["custom_prop"] = "value";
log.Audit("a message"); 
```

如果我硬编码一个值而不是使用 SQL 参数，则附加程序与 AUDIT 过滤器一起使用。

```
...
<commandText value="INSERT INTO table1 VALUES('value', :message)" />
... 
```

如果我在内置级别（如 INFO）进行过滤，则附加程序与 context 属性一起使用。

```
...
<filter type="log4net.Filter.LevelMatchFilter">
  <levelToMatch value="INFO" />
</filter>
... 
```

A`FileAppender`适用于 AUDIT 过滤器和上下文属性！

```
<appender name="FileAppender" type="log4net.Appender.FileAppender" >
  <filter type="log4net.Filter.LevelMatchFilter">
    <levelToMatch value="AUDIT" />
    </filter>
  <filter type="log4net.Filter.DenyAllFilter" />
  <file value="test.log" />
  <layout type="log4net.Layout.PatternLayout" >
    <conversionPattern value="%-5level [%property{custom_prop}] - %message%newline" />
  </layout>
</appender> 
```

导致

```
AUDIT [value] - a message 
```

使用全局上下文属性`AdoNetAppender`与 AUDIT 过滤器一起使用。但是，我需要线程上下文解析。

```
log4net.GlobalContext.Properties["custom_prop"] = "value";
log.Audit("a message"); 
```

导致

```
table1
custom_prop message
=========== =======
value       a message 
```

所以，我不知道这是否是`AdoNetAppender`我的扩展类或我的配置的问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-06T14:40:50.680

该问题是由前台线程的早期中止引起的。我认为 log4net 正在运行异步操作。在测试应用程序结束时休眠解决了问题

```
...
log4net.ThreadContext.Properties["custom_prop"] = "value";
log.Audit("a message");
...
Thread.Sleep(1000); 
```

或者，当在一个单独的线程中时，加入它

```
Thread t = new Thread(new ThreadStart(delegate
{
    log4net.ThreadContext.Properties["custom_prop"] = "value";
    log.Audit("a message");        
}));
t.Start();
...
t.Join(); 
```

在正常操作中，log4net 在最近一次 AUDIT 调用和执行结束之间应该有足够的时间。

# groovy - 如何使用 Groovy 创建 Junit4 套件？

> ID：616733
> 
> 赞同：2
> 
> 时间：2009-03-05T21:37:03.373
> 
> 标签：groovy, junit

我有

```
@RunWith(Suite.class)
 @Suite.SuiteClasses( [ 
     First.class,Second.class
 ])
 public class MySuite{

} 
```

但是eclipse没有给我“Run As Junit4 Test”。所有单独的测试类都可以在 GUnit 中正常工作，GUnit 是 eclipse 中内置的 groovy 单元测试运行器。

有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-14T01:17:22.900

我发现这样做的唯一方法是像往常一样创建一个带有 @Suite.SuiteClasses 注释的 java 类。您可以输入用于测试的 Groovy 类的 .class 名称，它运行良好。

如果您还没有一些 Java 代码来这样做，那有点蹩脚，但我混合了 Java 和 Groovy，所以这没什么大不了的。

另一种选择是根本不使用套件，而是使用名称模式来查找和运行测试。ant 和 maven 都支持这种模式匹配。我发现这比确保套件保持最新要容易得多，如果我想这样做，Eclipse 可以在一个包中运行所有测试。

谢谢您的帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T05:41:55.740

@Suite.SuiteClasses 接受 Class[] 作为其参数。

你可以试试：

```
 @RunWith(Suite.class)
 @Suite.SuiteClasses([First.class, Second.class] as Class[])
 public class MySuite {

 } 
```

# wcf - BizTalk 动态 WCF-WSHttp 发送端口恢复为 Http 适配器

> ID：616741
> 
> 赞同：0
> 
> 时间：2009-03-05T21:38:33.040
> 
> 标签：wcf, biztalk

我正在尝试使用来自业务流程的动态发送端口向 WCF-WSHttp 适配器发送消息，但 BizTalk 似乎总是恢复到 HTTP 适配器。

根据我找到的文档，我应该只需要从我的表达式形状中设置传输类型，就可以让 BizTalk 使用 WCF-WSHttp 适配器，我是，但它似乎仍在恢复。下面是我设置属性的表达式形状的示例（如您所见，我已尝试过 Microsoft.XLANGs.BaseTypes.TransportType 和 BTS.OutboundTransportType）：

```
Body(BTS.OutboundTransportType) = "WCF-WSHttp";

SendMessagePort(Microsoft.XLANGs.BaseTypes.Address) =
System.String.Format("{0}/Accept{1}", "http://myserver/myservice/
myservice.svc/Accept{0}", messageInfo.MessageType);
SendMessagePort(Microsoft.XLANGs.BaseTypes.TransportType) = "WCF-
WSHttp"; 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-09T08:19:57.280

可能是克雷格:-)

使用动态发送端口时，BizTalk 使用 url 的“方案”部分来决定使用哪个适配器。

当您的 url 以“Http://”或“Https://”开头时，BizTalk 将始终使用 HTTP 适配器。同样，以 ftp:// 开头的 url 将使用 FTP 适配器。同样适用于自定义适配器 - 当您安装适配器的配置时，您注册要使用的名字对象；例如 - 开源计划任务适配器使用 schedule:// （我相信）。

由于所需的各种配置，使用 WCF 的动态发送端口比大多数其他适配器稍微复杂一些，但您可以[在此处](http://msdn.microsoft.com/en-us/library/dd203050.aspx)找到详细说明，只需向下滚动到大约一半的“动态发送端口”部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-25T10:27:12.370

我最终解决了我的问题，但仍然不确定我看到的行为的原因。

问题中提到的表达式形状位于原子范围内。一旦业务流程退出包含表达式形状的范围，传输类型就会重置回其原始值。将表达式移出原子范围解决了这个问题，因为 TransportType 设置正确。

# c# - 抽象基类还是接口？似乎都不对

> ID：616743
> 
> 赞同：4
> 
> 时间：2009-03-05T21:39:54.457
> 
> 标签：c#, .net, inheritance, interface, abstract

给定以下代码：

```
using System.Collections.Generic;
static class Program {
    static void Main() {
        bar Bar = new bar();
        baz Baz = new baz();
        System.Console.WriteLine(
            "We have {0} bars, rejoice!", bar.Cache.Count);
    }
}

public abstract class foo {
    public static List<foo> Cache = new List<foo>(); 
}

public class bar : foo {
    public bar() { Cache.Add(this); }
}
public class baz : foo {
    public baz() { Cache.Add(this); }
} 
```

你会得到（有点预期的）输出“我们有 2 个酒吧，高兴！”。

这太棒了，我们现在有两倍的地方可以喝啤酒（显然），但我真正想要的是每个班级都有自己的缓存。我不想只在子类中实现这个缓存的原因是因为我的抽象类中还有一些方法需要能够对缓存进行操作（即遍历所有方法）。有没有办法做到这一点？我已经研究过使用接口`foo`，但该接口不允许将静态成员定义为接口的一部分。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-05T21:50:21.093

foo 的每个派生类都应该定义如何/在哪里获取缓存，因此每个都可以（可能）拥有自己的缓存。foo 中的方法可以在不知道实现的情况下引用 GetCache()。

```
public abstract class foo
{
    public abstract ICache GetCache();

    public void DoSomethingToCache()
    {
        ICache cache = this.GetCache();
        cache.DoSomething();
    }
}

public class bar : foo
{
    public static ICache BarCache = new FooCache();

    public override ICache GetCache()
    {
        return bar.BarCache;
    }
}

public class FooCache : ICache { } 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T21:50:13.950

使用用子类参数化的通用基类：

```
using System.Collections;
using System.Collections.Generic;

static class Program
{
    static void Main()
    {
        bar Bar = new bar();
        baz Baz = new baz();
        System.Console.WriteLine(
                "We have {0} bars, rejoice!", Bar.GetCache().Count);
    }
}

public abstract class foo<T>
{
    private static List<foo<T> > Cache = new List<foo<T> >();

    public IList GetCache()
    {
        return Cache;
    }
}

public class bar : foo<bar>
{
    public bar() { GetCache().Add(this); }
}
public class baz : foo<baz>
{
    public baz() { GetCache().Add(this); }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T21:47:09.807

```
public abstract class foo {
    public abstract List<foo> Cache { get; }

    protected static Dictionary<Type, List<foo>> InnerCache = new Dictionary<Type, List<foo>>(); 
}

public class bar : foo {
    public override List<foo> Cache { 
       get { return foo.InnerCache[typeof(bar)]; } 
    }

    public bar() { Cache.Add(this); }
}

public class baz : foo {
    public override List<foo> Cache { 
       get { return foo.InnerCache[typeof(baz)]; } 
    }

    public baz() { Cache.Add(this); }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T21:42:03.750

这是你的答案：

```
using System;
using System.Collections.Generic;
static class Program
{
    static void Main()
    {
        var bar = new Bar();
        var baz = new Baz();
        System.Console.WriteLine(
                "We have {0} bars, rejoice!", Bar.Cache.Count);

        bar.PrintList();
        baz.PrintList();
    }
}

public abstract class Foo<T>
{
    public static List<T> Cache = new List<T>();

    public void PrintList()
    {
        foreach(var item in Cache)
        {
            Console.WriteLine(item);

        }
    }
}

public class Bar : Foo<Bar>
{
    public Bar() { Cache.Add(this); }
}
public class Baz : Foo<Baz>
{
    public Baz() { Cache.Add(this); }
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-05T21:46:43.710

试试这个：

```
using System.Collections.Generic;
using System;
static class Program
{
  static void Main()
  {
    Bar bar = new Bar();
    Baz baz = new Baz();
    System.Console.WriteLine(
            "We have {0} bars, rejoice!", bar.Cache.Count);
    System.Console.ReadKey();
  }
}

public abstract class Foo
{
  public Foo()
  {
    Cache = new List<string>();
  }
  public List<String> Cache { get; set; }
}

public class Bar : Foo
{
  public Bar() 
  { 
    Cache.Add("Bar"); 
  }
}
public class Baz : Foo
{
  public Baz() { Cache.Add("Baz"); }
} 
```

抱歉，我不得不更换外壳。它让我的头爆炸了

# svn - Subversion中的单个文件合并

> ID：616752
> 
> 赞同：46
> 
> 时间：2009-03-05T21:42:24.467
> 
> 标签：svn

我正在使用 Subversion 1.5 并且在一个分支中有一个文件，我想合并到另一个分支中。当我这样做时，`svn merge http://path/to/file`我得到一个错误，

> 不能用 替换目录。

这是否意味着 Subversion 不能这样做？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-03-05T22:45:10.823

尝试指定本地文件的路径。

例如，

```
svn merge -r1234:1235 svn://your_svn_url/to/file ./local_file 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2017-04-13T11:20:33.723

我正在使用颠覆 1.8.8 和

```
svn merge ^/trunk/path_to_file ./branch/path_to_local_file 
```

对我来说很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-21T15:21:13.523

正如 Andrew 推荐的那样，合并对我有用，但不是对每个文件都有效。我有三个文件，但第三个文件出现错误“...找不到路径”。添加参数“--ignore-ancestry”解决了这个问题。

`svn:mergeinfo`但是在合并后，我有奇怪的修改/合并文件状态，并且在我的工作副本中添加了很多内容。

所以我决定只对单个文件做一个简单的复制和粘贴，以避免这些令人困惑的东西，直到我们切换到这些任务真的没有问题的 Git ;)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T22:24:12.370

我认为你需要做一个

```
svn merge http://server/repos/path/to -r <REV> 
```

其中 <REV> 是添加文件的版本。以这种方式记录合并信息（如果是 Subversion 1.5 或更高版本的存储库）。

* * *

## 回答 #5

> 赞同：-45
> 
> 时间：2009-03-05T21:44:05.073

我认为最好的方法是从一个分支到另一个分支的 svn 副本。

# hibernate - Hibernate：如何将 *.hbm.xml 文件映射到不同的文件夹中？

> ID：616754
> 
> 赞同：1
> 
> 时间：2009-03-05T21:43:08.180
> 
> 标签：hibernate, nhibernate-mapping, schemaexport, hibernate.cfg.xml

我有一些 *.hbm.xml 文件放在 hibernate.cfg.xml 文件的同一文件夹中。现在，我想映射此文件夹子文件夹中的其他一些 *.hbm.xml 文件。我怎么能做到？谢谢！

这是我的一部分`hibernate.cfg.xml`：

```
 <hibernate-configuration>
        <session-factory name="MySessionFactory">
             <!-- some hibernate properties here --> 

             <!--This below works fine-->
             <mapping resource="A.hbm.xml"/>

             <!--This doesn't-->
             <mapping resource="/dir/B.hbm.xml"/>

        </session-factory>
   </hibernate-configuration> 
```

这是我的 Ant 文件的一部分：

```
 <target name="generateHibernateSql">

        <taskdef name="SchemaExportTask"
            classname="org.hibernate.tool.hbm2ddl.SchemaExportTask"
        >
            <classpath>
                <pathelement location="${build.classes.main.dir}"/>
                <pathelement location="${base.configuration.hibernate.dir}"/>
                <path refid="build.classpath.lib"/>
            </classpath>
        </taskdef> 
```

这是我的文件夹结构

```
${base.configuration.hibernate.dir}
   | hibernate.cfg.xml
   | A.hbm.xml
   |--dir
   |---| B.hbm.xml
${build.classes.main.dir} 
```

# [编辑]

正如莫里斯建议的那样，我首先尝试并失败了，将线路改为

```
 <mapping resource="dir/B.hbm.xml"/> 
```

仍然给出相同的错误：

```
Schema text failed: Could not parse mapping document from resource dir/B.hbm.xml 
```

然后我继续尝试按照 Mark 的建议添加到我的 schemaexpoert 中。然后它甚至再也找不到我的“A.hbm.xml”了。给出错误：

```
Schema text failed: Could not parse mapping document from resource A.hbm.xml 
```

我的 SchemaExportTask 现在看起来像：

```
 <SchemaExportTask
            config="${base.configuration.hibernate.dir}\hibernate.cfg.xml"
            quiet="no"
            text="no"
            drop="no"
            delimiter=";"
            create="yes"
            output="${dist.database.dir}\schema-export.sql"
        >
            <fileset dir="${base.configuration.hibernate.dir}">
                <include name="**/*.hbm.xml"/>
            </fileset>
        </SchemaExportTask> 
```

# [解决]

结论是我真的很愚蠢。它与在不同的目录中无关。我很困惑，因为我在测试阶段一次更改了两件事，然后我将这一切归咎于无辜的“目录更改”。很抱歉浪费了大家的时间。

如果有人感兴趣，这就是发生的事情。我使用本地 DTD 文件进行了一些 XSLT 转换，并在我的 XSL 文件中使用相对路径指定了本地 DTD 文件。但是我将生成的 hbm.xml 文件放到了不同的目录中——因此 SchemaExportTask 无法再找到 DTD 文件并且无法解析新的 hbm.xml 文件。由于一些愚蠢的原因，我认为以下完全不同的错误消息意味着相同的事情......非常感谢 Mark 提醒我人们写错误消息是有充分理由的！现在添加`fileset`仍然不起作用，但我现在知道阅读错误信息......我相信我会尽快修复它。=.=''

```
Schema text failed: resource: B.hbm.xml not found
Schema text failed: Could not parse mapping document from resource dir/B.hbm.xml 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T21:51:16.647

```
<mapping resource="dir/B.hbm.xml"/> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T21:59:28.653

对于一般的 Hibernate 用法，我同意 Maurice 建议的更改，但我认为我会给出更多解释。Hibernate 映射文件作为资源从类路径加载。由于您的类路径中有 ${base.configuration.hibernate.dir} ，因此您必须提供相对于此的映射文件的路径，因此应该删除前面的 / 。

对于使用 ant 的模式导出工具，[文档](http://www.hibernate.org/hib_docs/v3/reference/en-US/html/toolsetguide.html#toolsetguide-s1)说您应该将映射文件定义为文件集，而不是期望在类路径中找到它们。看

# apache - 我的 Apache 与 IIS 一起设置

> ID：616757
> 
> 赞同：0
> 
> 时间：2009-03-05T21:43:46.040
> 
> 标签：apache, iis, windows-vista

我正在努力学习 PHP。我无法让 Apache 在我的 Vista Home Premium 机器上正常工作。

我有 IIS7 正在运行，我想让 Apache 与它一起运行。我在网上四处寻找，有人说只要他们正在查看不同的端口，将两者放在一起就可以了。

我让 IIS 在端口 80 上进行监听，并编辑 apache2triad/conf 文件夹中的 httpd.conf 文件以监听端口 8080，并将服务器名称更改为 localhost:8080。当我转到 localhost:8080/phpmyadmin 时，允许我创建数据库的页面看起来好像所有页面样式都已关闭，所以我知道有些东西已经很不稳定了。

我输入数据库名称并单击创建按钮，然后从 IIS 收到 404 错误。它说它正在寻找一个文件：

请求的 URL： [http://localhost:80/phpmyadmin/db_create.php](http://localhost:80/phpmyadmin/db_create.php)

物理路径：C:\inetpub\wwwroot\phpmyadmin\db_create.php

它指向我的 inetpub 文件夹，但我所有的 PHP 内容都在 c:\apache2triad 文件夹中。

有人可以告诉我我做错了什么吗？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T22:34:59.630

If you want to get a URL from your Apache server, you need to use port 8080 instead of port 80 (which is where you say IIS is running) - so your URL should be [http://localhost:8080/phpmyadmin/db_create.php](http://localhost:8080/phpmyadmin/db_create.php)

As Shawn said, if you're not familiar with apache at all, you're probably better off setting up PHP under IIS - see [http://www.php.net/install.windows](http://www.php.net/install.windows)

# exception-handling - 如何实现顶级异常处理？

> ID：616759
> 
> 赞同：9
> 
> 时间：2009-03-05T21:44:13.480
> 
> 标签：exception-handling

我最近不得不为同事开发的现有服务开发一个附加模块。他在主工作函数中放置了一个 try/catch 块，用于捕获所有冒泡到此级别的未处理异常，并将它们与堆栈跟踪信息等一起记录：

```
try
{
    // do main work
}
catch(Exception ex)
{
    // log exception info
} 
```

虽然这使程序非常稳定（如“不太可能崩溃”），但我讨厌它，因为当我测试我的代码时，我看不到由它引起的异常。当然，我可以查看异常日志，看看是否有新条目，但我更喜欢在异常被抛出的那一刻得到直接反馈（请将光标放在代码的右侧）。

至少在我还在编码和测试的时候，我删除了这个顶级的 try/catch。但现在我的任务完成了，我必须决定是否将其放回发布。我认为我应该这样做，因为它使服务更稳定，而且它的全部意义在于它在后台运行，不需要任何监督。另一方面，我读到应该只调用特定的异常（如`IoException`），而不是一般`Exception`的 。

你对这个问题有什么建议？

顺便说一句，该项目是用 C# 编写的，但我也对非 .NET 语言的答案感兴趣。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-05T21:50:26.320

放回去。

异常应该只在测试时相关。否则，将其弹出给用户是没有意义的。

记录很好。

您还可以使用 Visual Studio 为调试构建定义的 DEBUG 符号作为标志。

```
 ...
    } catch( Exception e ) { 
#if DEBUG
          throw;
#else
          log as usual 
#endif
    } 
```

因此，下次需要修改时，应将调试标志设置为 true，并且会弹出异常。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T21:58:21.060

在任何 Java 应用程序中，您几乎总是希望为未捕获的异常定义一个异常处理程序，如下所示：

```
Thread.setDefaultUncaughtExceptionHandler( ... ); 
```

捕获这些未捕获异常的对象至少会记录失败，以便您有机会了解它。否则，无法保证您甚至会收到线程发生异常的通知——除非它是您的主线程。

除了这样做之外，我的大多数线程都有一个 try/catch ，我会在其中捕获`RunnableException`（但不是`Error`）并记录它......当这种情况发生时，一些线程会死掉，其他人会记录并忽略，其他人会向用户并让用户根据应用程序的需要来决定。这个 try/catch 位于 Thread 的根部，在`Runnable.run()`方法或等效项中。由于 try/catch 位于 Thread 的根目录，因此有时无需禁用此 catch。

When I write in C#, I code similarly. But this all depends on the need of the application. Is the Exception one that will corrupt data? Well then, don't catch and ignore it. ALWAYS log it, but then Let the application die. Most Exceptions are not of this sort, however.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T21:54:31.973

理想情况下，您希望在尽可能接近异常发生的地方处理异常，但这并不意味着全局异常处理程序是一个坏主意。特别是对于必须不惜一切代价保持运行的服务。我会继续你一直在做的事情。在调试时禁用它，但将其保留在生产环境中。

请记住，它应该用作安全网。仍然尝试在它们提升到那么远之前捕获所有异常。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T22:01:08.463

The urge to catch all exceptions and make the program 'stable' is very strong and the idea seems very enticing indeed to everyone. The problem as you point out is that this is just a ruse and the program may very well be buggy and worse, w/o indications of failures. No one monitors the logs regularly.
My advice would be to try and convince the other developer to do extensive testing and then deploy it in production w/o the outer catch.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-03-14T16:55:24.643

If you want to see the exception when it occurs, in Visual Studio you can go to the DEBUG menu, select EXCEPTIONS and you can tell the debugger to Break as soon as an Exception is thrown. You even get to pick what type of Exceptions. :)

# database - 将文件与数据相关联的最佳方法是什么？

> ID：616762
> 
> 赞同：9
> 
> 时间：2009-03-05T21:45:37.097
> 
> 标签：database, file

我有一个在表中创建记录的应用程序（我知道火箭科学）。用户希望将文件（.doc、.xls、.pdf 等）关联到表中的单个记录。

*   我应该将文件的内容存储在数据库中吗？这不会使数据库膨胀吗？

*   我应该将文件存储在文件服务器上，并将路径存储在数据库中吗？

做这个的最好方式是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-05T22:00:42.863

我认为您已经准确地掌握了解决此问题的两种最流行的方法。各有利弊：

## 将文件存储在数据库中

大多数 rbms 支持在 db 中存储 blob（或二进制文件数据、.doc、.xls 等）。所以你没有在这里开辟新天地。

### 优点

*   简化数据备份：您备份数据库，您拥有所有文件。
*   元数据（关于文件的其他列）与文件本身之间的联系是稳固的并内置在数据库中；因此，它是获取有关文件数据的一站式商店。

### 缺点

*   当您将所有二进制数据存储在数据库中时，备份很快就会变成一场巨大的噩梦。您可以通过将文件保存在单独的数据库中来减轻一些麻烦。
*   如果没有 DB 或 DB 的接口，就没有简单的方法来获取文件内容以修改或更新它。
*   一般来说，与文件系统相比，更难编码和协调数据上传和存储到数据库。

## 将文件存储在文件系统上

这种方法非常简单，您将文件本身存储在文件系统中。您的数据库存储对文件位置的引用（以及有关文件的所有元数据）。这里的一个有用提示是标准化磁盘上文件的命名模式（不要使用用户提供的文件，自己创建一个并将其存储在数据库中）。

### 优点

*   使您的文件数据与数据库完全分离。
*   易于维护文件本身（如果您需要更改文件或更新文件），您可以在文件系统本身中进行。您也可以通过新的上传从应用程序轻松完成。

### 缺点

*   如果您不小心，您的文件数据库可能会与文件本身不同步。
*   安全性可能是一个问题（如果您不小心的话），这取决于您存储文件的位置以及该文件系统是否可供公众使用（通过我在这里假设的网络）。

最终，我们选择了文件系统路线。一旦我们锁定任何漏洞并将文件流式传输（而不是直接从文件系统提供服务），它就更容易快速实现，备份简单，非常安全。它在两个不同的政府应用程序中以几乎相同的格式运行了大约 6 年。

Ĵ

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-06T01:30:19.990

您在数据库中存储二进制文件或 BLOB 的程度将高度依赖于您使用的 DBMS。

如果您在文件系统上存储二进制文件，则需要考虑在文件名冲突的情况下会发生什么，您尝试存储两个具有相同名称的不同文件 - 以及这是否是有效操作。因此，除了对文件在文件系统上的位置的引用之外，您可能还需要存储原始文件名。

此外，如果您要存储大量文件，请注意将所有文件存储在一个文件夹中可能会影响性能。（您没有指定您的操作系统，但您可能希望查看[此](https://stackoverflow.com/questions/197162/ntfs-performance-and-large-volumes-of-files-and-directories)问题的 NTFS 或ext3 的[此](http://en.wikipedia.org/wiki/Ext3#cite_note-0)参考。）

我们有一个系统，它必须在文件系统上存储数千个文件，在我们关心任何一个文件夹中的文件数量的文件系统上（我认为它可能是 FAT32）。

我们的系统将添加一个新文件，并为其生成一个 MD5 校验和（以十六进制表示）。它将前两个字符作为第一个文件夹，接下来的两个字符将第二个文件夹作为第一个文件夹的子文件夹，然后将接下来的两个作为第三个文件夹作为子文件夹第二个文件夹。

这样，我们最终得到了一组三层文件夹，并且文件分散得相当好，因此没有一个文件夹填得太多。

如果在那之后我们*仍然*有文件名冲突，那么我们只需将“_ *n* ”添加到文件名（在扩展名之前），其中*n*只是一个递增的数字，直到我们得到一个不存在的名称（甚至然后，我想我们做了原子文件创建，只是为了确定）。

当然，您需要工具来偶尔将数据库记录与文件系统进行比较，标记任何丢失的文件并清理数据库记录不再存在的任何孤立文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T21:48:24.233

使用数据库存储数据，使用文件系统存储文件。只需将文件路径存储在数据库中。

此外，您的网络服务器可能比您的应用程序代码更有效地提供文件（以便将文件从数据库流式传输回客户端）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T21:49:13.407

将路径存储在数据库中。这可以防止您的数据库膨胀，并且还允许您单独备份外部文件。您还可以更轻松地重新定位它们；只需将它们移动到新位置，然后更新数据库。

要记住的另一件事：为了使用您提到的大多数文件类型，您最终必须：

*   查询数据库以获取 blob 中的文件内容
*   将 blob 数据写入磁盘文件
*   启动应用程序以打开/编辑/您刚刚创建的任何文件
*   将文件从磁盘读回 Blob
*   使用新内容更新数据库

所有这些都与：

*   从数据库中读取文件路径
*   启动应用程序以打开/编辑/任何文件

我更喜欢第二组步骤，我自己。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-05T21:50:22.263

只有当您有理由确定您知道这些文件的大小不会失控时，您才应该将文件存储在数据库中。

我使用我们的数据库来存储小的横幅图像，我总是知道它们的大小。您的数据库将在一行内存储指向数据的指针，然后将数据本身插入其他地方，因此它不一定会影响速度。

但是，如果未知数太多，则使用文件系统是更安全的途径。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-05T21:53:06.533

最好的解决方案是将文档放入数据库中。这简化了所有链接、备份和恢复问题 - 但它可能无法解决用户可能拥有的基本“我们只想指向文件服务器上的文档”的心态。

这一切都取决于（最终）实际的用户需求。

但是我的建议是将它们全部放在数据库中，以便您保留对它们的控制权。将它们留在文件系统中会使它们容易被删除、移动、ACL 或任何其他数百种更改，这些更改可能会使您与它们的链接变得毫无意义甚至有害。

数据库膨胀只是一个问题，如果您没有调整它的大小。做一些测试，看看它有什么效果。磁盘上 100GB 的文件可能与数据库中的相同文件一样大。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-05T21:54:08.840

我会尝试将其全部存储在数据库中。没做过。但如果没有。文件名与磁盘上的文件不同步的风险很小。那你就有大问题了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-06T01:39:34.740

现在对于完全不可行的建议 - 您可以考虑将二进制文件作为[附件](http://wiki.apache.org/couchdb/HTTP_Document_API)存储在[CouchDB](http://couchdb.apache.org/)文档数据库中。这将避免文件名冲突问题，因为您将使用生成的 UID 作为每个文档 ID（您将存储在 RDBMS 中的内容），并且实际附件的文件名与文档一起保存。

如果您正在构建一个基于 Web 的系统，那么也可以利用 CouchDB 使用 REST over HTTP 的事实。而且，还有可以证明有用的复制设施。

当然，CouchDB 仍处于孵化阶段，尽管[有些](http://wiki.apache.org/couchdb/CouchDB_in_the_wild)人已经在“野外”使用它。

# sysadmin - 有没有从 Mailman 列表迁移到网络论坛的好方法？

> ID：616772
> 
> 赞同：9
> 
> 时间：2009-03-05T21:47:26.810
> 
> 标签：sysadmin, forum, mailing-list, mailman

我有一个具有多年历史的 Mailman 管理列表，我想将其迁移到基于 Web 的论坛中。最好做的事情：

*   为那些习惯并喜欢它而不是 Web 界面的人保留邮件列表，但让它与 Web 论坛活动集成。

*   获取基于网络的论坛帖子，并将它们发送到邮件列表。

我已经运行了基于 phpBB、Drupal、Simple Machines 等的站点，并且如果需要将某些包集成到 Mailman 中或完全替换它，我能够进行一些编码。但我不知道什么是可用的、商业的或开源的，可以实现这一点。我也愿意*替换*Mailman，如果候选包可以很好地执行其功能并很好地集成到自己的论坛中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-15T21:10:44.363

即使 phpBB/mail2forum 选项使用的是旧版本，它也是一个不错的选择。 [OpenSceneGraph](http://forum.openscenegraph.org)刚刚为他们长期运行的邮件列表实现了这一点，它似乎可以完美地工作。这是我见过的唯一一个选项，它允许论坛帖子和邮件列表消息非常无缝地工作，并允许标签将论坛主题与邮件列表帖子等分开。

他们的 v2 开发人员也可以与 phpBB3 一起使用 - 因此，如果您愿意生活在最前沿，那可能是一个选择。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-09T05:13:24.780

到目前为止，这是我调查的内容：

**Drupal**及其 Mailmanager 和 Listmanager 模块，尽管我在打开 IMAP 功能以便它可以与我的邮箱通信（客户可以正常访问它）时遇到问题，并且 Drupal 的论坛模块并不真正符合该功能我想要的水平。

**PhpBB, mail2forum**，虽然它看起来目前只适用于较旧的 phpBB 版本，所以对我来说并不是真正的替代品。

唯一似乎真正“工作”的是**FUDforum**及其 maillist.php 模块，它直接集成在 procmail 级别，很好。我可以将我所有的 Mailman 档案和“formmail -ds”直接放入选定的论坛。

我已经为这个问题开始了赏金，我正在寻找一些东西，甚至是商业的，真正将电子邮件界面集成到最终用户的论坛体验中，特别是帐户处理。对于 FUDforum，我仍然需要解决 Mailman 帐户与 FUDforum 帐户的分离问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-30T09:37:33.970

我在网上遇到了这个：http: [//mail2forum.com/](http://mail2forum.com/)

我没有使用它，但它看起来很有前途，并且有一个 1.2 稳定版本和一个 2.0 开发版本，所以它不是一个废弃的 SourceForge 项目，只有 1 个开发人员，没有提交，或任何东西 :)

理论上，我的组织可能会在未来一两年的某个时候使用它，但我们必须先完成我们自己的 Listserv 到 Mailman 的转换。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-13T05:37:24.660

好吧，根据您所说的（首先，您可以进行一些编码，其次，除了维护列表成员资格的问题之外，FUDForum 将为您工作，您是否考虑过：

*   Mailman 将其用户信息存储在[纯文本文件](http://wiki.list.org/display/DOC/Setting+up+Web+access+using+MM+list+passwords+-+for+Apache)中，并且
*   FUDForums 将*其*用户信息存储在[单个 sql 表中](http://cvs.prohost.org/c/index.cgi/FUDforum/fileview?f=install/forum_data/sql/fud_users.tbl&v=1.31)

显而易见的解决方案是声明这些主服务器之一（可能是 FUDForum，因为它看起来好像拥有 Mailman 信息的适当超集）并有一个小脚本/cron 作业将更改从主服务器复制到从服务器。

顺便说一句——这两个系统看起来都不是很安全（实际上，它们看起来都很有漏洞）并且将它们结合起来很可能会进一步降低集体安全性。如果您正在做任何远程机密的事情，您应该重新考虑您的目标，并且无论如何您都应该采取适当的措施来保护您的系统免受攻击。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-13T07:28:14.440

我认识一个从邮件列表切换到 phpBB 的 SME！如果您想保留您的邮件列表，您还必须对其进行维护。

最后，我认识的人禁用了邮件列表服务。

# ruby-on-rails - 为什么我会收到此 Cache-money 错误？

> ID：616776
> 
> 赞同：1
> 
> 时间：2009-03-05T21:48:35.420
> 
> 标签：ruby-on-rails, ruby, memcached, cache-money

我完全按照 github 页面上的说明进行操作。我会发布我的一些配置，但它与[http://github.com/nkallen/cache-money/tree/master上的内容相匹配](http://github.com/nkallen/cache-money/tree/master)

错误如下：

```
/!\ FAILSAFE /!\  Thu Mar 05 16:45:09 -0500 2009
  Status: 500 Internal Server Error
  undefined method `indices' for nil:NilClass
    (__DELEGATION__):2:in `__send__'
    (__DELEGATION__):2:in `indices'
    (__DELEGATION__):2:in `__send__'
    (__DELEGATION__):2:in `indices'
    /usr/lib/ruby/gems/1.8/gems/nkallen-cache-money-0.2.5/lib/cash/query/abstract.rb:114:in `indexed_on?'
    /usr/lib/ruby/gems/1.8/gems/nkallen-cache-money-0.2.5/lib/cash/query/abstract.rb:56:in `cacheable?'
    /usr/lib/ruby/gems/1.8/gems/nkallen-cache-money-0.2.5/lib/cash/query/abstract.rb:15:in `perform'
    /usr/lib/ruby/gems/1.8/gems/nkallen-cache-money-0.2.5/lib/cash/query/abstract.rb:7:in `perform'
    /usr/lib/ruby/gems/1.8/gems/nkallen-cache-money-0.2.5/lib/cash/finders.rb:24:in `find_every'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/base.rb:1452:in `find_initial'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/base.rb:587:in `find'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/session/active_record_store.rb:113:in `find_by_session_id'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/session/active_record_store.rb:79:in `find_by_session_id'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/session/active_record_store.rb:288:in `initialize'
    /usr/lib/ruby/gems/1.8/gems/activerecord-2.2.2/lib/active_record/base.rb:1398:in `silence'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/session/active_record_store.rb:288:in `initialize'
    /usr/lib/ruby/1.8/cgi/session.rb:279:in `new'
    /usr/lib/ruby/1.8/cgi/session.rb:279:in `initialize_without_cgi_reader'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/cgi_ext/session.rb:19:in `initialize'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/cgi_process.rb:94:in `new'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/cgi_process.rb:94:in `session'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/cgi_process.rb:130:in `stale_session_check!'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/cgi_process.rb:78:in `session'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/base.rb:1205:in `assign_shortcuts_without_flash'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/flash.rb:166:in `assign_shortcuts'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/base.rb:519:in `process_without_filters'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/filters.rb:606:in `process_without_session_management_support'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/session_management.rb:134:in `process'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/base.rb:392:in `process'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:183:in `handle_request'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:110:in `dispatch_unlocked'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:123:in `dispatch'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:122:in `synchronize'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:122:in `dispatch'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:132:in `dispatch_cgi'
    /usr/lib/ruby/gems/1.8/gems/actionpack-2.2.2/lib/action_controller/dispatcher.rb:39:in `dispatch'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/rails.rb:76:in `process'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/rails.rb:74:in `synchronize'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/bin/../lib/mongrel/rails.rb:74:in `process'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:159:in `process_client'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:158:in `each'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:158:in `process_client'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:285:in `run'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:285:in `initialize'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:285:in `new'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:285:in `run'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:268:in `initialize'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:268:in `new'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:268:in `run'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel/configurator.rb:282:in `run'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel/configurator.rb:281:in `each'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel/configurator.rb:281:in `run'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/bin/mongrel_rails:128:in `run'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel/command.rb:212:in `run'
    /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/bin/mongrel_rails:281
    /usr/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:142:in `load_without_new_constant_marking'
    /usr/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:142:in `load'
    /usr/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
    /usr/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:142:in `load'
    /usr/lib/ruby/gems/1.8/gems/rails-2.2.2/lib/commands/servers/mongrel.rb:64
    /usr/local/lib/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
    /usr/local/lib/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'
    /usr/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:153:in `require'
    /usr/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:521:in `new_constants_in'
    /usr/lib/ruby/gems/1.8/gems/activesupport-2.2.2/lib/active_support/dependencies.rb:153:in `require'
    /usr/lib/ruby/gems/1.8/gems/rails-2.2.2/lib/commands/server.rb:49
    /usr/local/lib/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
    /usr/local/lib/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'
    script/server:3 
```

有任何想法吗？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T02:22:51.017

**config/initializers/cache_money.rb**中的 cache-money 初始化程序似乎需要*session_store*作为*mem_cache_store*

对我来说，它是这样工作的：

**配置/环境.rb**：

```
config.action_controller.session_store = :mem_cache_store 
```

**配置/环境/production.rb**：

```
config.after_initialize do
  ActionController::Base.session_store = :active_record_store
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-17T15:02:19.850

问题是由使用 ActiveRecord 作为我的会话存储引起的。

在缓存资金 github 上使用给定的初始化程序尝试将缓存资金用于 ActiveRecord::SessionStore (rails 2.3)，这不是一个完整的 ActiveRecord (我假设是出于性能原因)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T12:00:32.633

更新到 Rails 2.3 后，我遇到了类似的问题。我还有线

```
config.action_controller.session_store = :active_record_store 
```

在我的 environment.rb 中，我通过替换它来修复它

```
ActionController::Base.session_store = :active_record_store 
```

在初始化文件中。

# c# - 我可以检查 C# 编译器是否内联了方法调用吗？

> ID：616779
> 
> 赞同：28
> 
> 时间：2009-03-05T21:49:39.940
> 
> 标签：c#, optimization, inline, compilation

我正在编写一个 XNA 游戏，我在其中进行逐像素碰撞检查。检查这一点的循环是通过移位一个 int 和按位 ORing 来实现的，通常难以阅读和理解。

我想添加私有方法，例如`private bool IsTransparent(int pixelColorValue)`使循环更具可读性，但我不想要方法调用的开销，因为这是对性能非常敏感的代码。

有没有办法强制编译器内联这个调用或者我会这样做我只是希望编译器会做这个优化？

如果没有办法强制这样做，有没有办法检查该方法是否内联，而不是阅读反汇编？如果该方法被内联并且不存在其他调用者，它会在反射中显示吗？

**编辑：**我不能强迫它，所以我可以检测到它吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-03-05T21:56:50.393

不，你不能。更重要的是，决定内联的不是 VS 编译器，它接收你的代码并将其转换为 IL，而是 JIT 编译器，它接收 IL 并将其转换为机器代码。这是因为只有 JIT 编译器对处理器架构有足够的了解，才能决定将方法内联是否合适，因为它是指令流水线和缓存大小之间的权衡。

因此，即使查看 .NET Reflector 也无济于事。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-03-05T21:56:01.410

> “您可以检查 System.Reflection.MethodBase.GetCurrentMethod().Name。如果方法是内联的，它将返回调用者的名称。”

——[乔尔·科霍恩](https://stackoverflow.com/users/3043/joel-coehoorn)

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2012-03-20T17:48:45.493

在 .net 4.5 中有一种鼓励更积极内联的新方法，如下所述：http: [//blogs.microsoft.co.il/blogs/sasha/archive/2012/01/20/aggressive-inlining-in-the -clr-4-5-jit.aspx](http://blogs.microsoft.co.il/blogs/sasha/archive/2012/01/20/aggressive-inlining-in-the-clr-4-5-jit.aspx)

基本上它只是一个告诉编译器尽可能内联的标志。不幸的是，它在当前版本的 XNA (Game Studio 4.0) 中不可用，但当 XNA 今年某个时间赶上 VS 2012 时应该可用。如果您以某种方式在 Mono 上运行，它已经可用。

```
[MethodImpl(MethodImplOptions.AggressiveInlining)] 
public static int LargeMethod(int i, int j)
{ 
    if (i + 14 > j) 
    { 
        return i + j; 
    } 
    else if (j * 12 < i) 
    { 
        return 42 + i - j * 7; 
    } 
    else 
    { 
        return i % 14 - j; 
    } 
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-06T11:57:00.653

请注意，Xbox 的工作方式不同。

谷歌出现了这个：

“内联方法可减轻方法调用的开销。JIT 形成内联，满足以下条件。

*   IL 代码大小为 16 字节或更少。
*   不使用分支命令（如果句子等）。
*   不使用局部变量。
*   未进行异常处理（try、catch 等）。
*   float 不用作方法的参数或返回值（可能由 Xbox 360 使用，未应用）。
*   当一个方法中有两个或多个参数时，它用于声明的轮次。

但是，虚函数不会形成内联函数。”

[http://xnafever.blogspot.com/2008/07/inline-method-by-xna-on-xbox360.html](http://xnafever.blogspot.com/2008/07/inline-method-by-xna-on-xbox360.html)

我不知道他是否正确。任何人？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T21:51:19.733

不，你不能。

基本上，您也不能在大多数现代 C++ 编译器中这样做。`inline`只是对编译器的一个提议。接受与否是自由的。

C# 编译器不会在 IL 级别执行任何特殊的内联。JIT 优化器就是这样做的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-05T23:01:19.740

为什么不使用不安全的代码（已知的内联 c）并使用 c/c++ 样式指针，这对 GC 是安全的（即不受收集影响），但有其自身的安全隐患（不能用于 Internet 区域应用程序）但是对于您想要实现的那种东西来说非常棒，尤其是在性能方面，尤其是在数组和按位运算方面？

总而言之，您想要应用程序的一小部分性能？使用不安全的代码并使用指针等对我来说似乎是最好的选择

编辑：有点首发？ [http://msdn.microsoft.com/en-us/library/aa288474(VS.71).aspx](http://msdn.microsoft.com/en-us/library/aa288474(VS.71).aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-06T12:04:08.530

检查这一点的唯一方法是获取或编写探查器，并挂钩到 JIT 事件，您还必须确保在探查时默认情况下没有关闭内联。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-05T22:03:55.197

您可以在运行时使用前面提到的 GetCurrentMethod 调用来检测它。但是，这似乎有点浪费[1]。最简单的事情就是只 ILDASM 和 MSIL 并在那里检查。

请注意，这专门用于*编译器*内联调用，并在 MSDN 上的各种[反射](http://msdn.microsoft.com/en-us/library/system.reflection.assembly.getcallingassembly.aspx)文档中进行了介绍。

> 如果调用 GetCallingAssembly 方法的方法被编译器内联扩展（即，如果编译器将函数体插入到发出的 Microsoft 中间语言 (MSIL) 中，而不是发出函数调用），则 GetCallingAssembly 返回的程序集方法是包含内联代码的程序集。这可能与包含原始方法的程序集不同。要确保调用 GetCallingAssembly 方法的方法不被编译器内联，您可以使用 MethodImplOptions.NoInlining 应用 MethodImplAttribute 属性。

然而，JITter 也可以自由地内联调用——但我认为反汇编器将是验证在该级别上做了什么和没有做什么的唯一方法。

编辑：为了澄清这个线程中的一些混乱，[csc.exe*将*内联 MSIL 调用](http://blog.vuscode.com/malovicn/archive/2007/08/05/releasing-the-build.aspx)- 尽管 JITter 将（可能）在其中更具侵略性。

[1] 而且，浪费 - 我的意思是 (a) 由于反射查找，它破坏了内联的目的（更好的性能）。并且（b），它可能会改变内联行为，使其不再内联。而且，在您认为您可以使用 Assert 或其他东西打开它之前 - 请意识到它不会在 Debug 期间内联，但可能在 Release 中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-06T00:07:22.607

> 有没有办法强制编译器内联这个调用或者我会这样做我只是希望编译器会做这个优化？

如果内联函数更便宜，它会。所以不要担心它，除非你的分析器说它确实是一个问题。

了解更多信息

[.NET 3.5 SP1 中的 JIT 增强功能](http://www.infoq.com/news/2008/09/JIT-Inlining)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-03-02T23:37:10.487

*   对于简单的代码，你可以尝试在线获取asm：[https ://sharplab.io/](https://sharplab.io/)
*   对于更复杂的情况，请尝试[https://github.com/szehetner/InliningAnalyzer](https://github.com/szehetner/InliningAnalyzer)（我还没有尝试过）。

# mysql - 为什么在我构建 Mysql 查询时我的变量不能正确插值？

> ID：616794
> 
> 赞同：1
> 
> 时间：2009-03-05T21:53:27.297
> 
> 标签：mysql, perl

我正在尝试从 Perl 程序在 mysql 中编写正则表达式。我想要这样的查询：

```
WHERE a.keywords REGEXP '[[:<:]]something[[:>:]]' 
```

但是，在 Perl 中，当我进行此查询时，连接时出现错误：

```
for($i=0;$i<$count;$i++){
    $where = $where . "'[[:<:]]$andkeywords[$i][[:>:]]' ";  #errors 
```

因为这不会给我一个错误：

```
for($i=0;$i<$count;$i++){
    $where = $where . "'[[:<:]] $andkeywords[$i] [[:>:]]' ";  #no error 
```

在“无错误”代码中注意有多余的空格。但是，如果我有额外的空格，那么我不会得到我想要的结果，因为在数据库中没有“额外的空格”。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-05T22:45:34.300

只是为了完整起见，这也有效：

```
for ($i = 0; $i < $count; $i++) {
    $where .= "'[[:<:]]${andkeywords[$i]}[[:>:]]' ";
} 
```

`${blah}`在字符串外无效，但在可插值字符串内，它等价于`$blah`.

我会认为这种模式比其他答案更常见，但......毕竟，你还想输入`"foo${var}bar"`什么？显然`"foo$var\bar"`不起作用，因为`\b`是公认的转义序列。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-05T22:33:41.210

在这种情况下，原因是 "$andkeywords[$i][[:>:]]" 被解释为多维数组，而 :>: 不是有效的数组索引。

我个人更喜欢 Mykroft 的方法，但您也可以通过转义最终的左括号来获得相同的结果，如下所示：

```
$where=$where."'[[:<:]]$andkeywords[$i]\[[:>:]]' "; 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-06T02:43:05.633

`<Obligatory security moan>`

**请**为每个正则表达式值使用一个`DBI`参数，而不是对其进行插值。为什么？

1.  对于允许使用的字符不再有任何限制。目前，如果 的任何元素`@andkeywords`包含引号、反斜杠或特殊的正则表达式字符，事情就会中断。例如，关键字`"O'Reilly"`将导致数据库错误。
2.  人们将无法构建恶意关键字来揭示他们不应该看到或造成严重破坏的信息。（想象一下，如果用户输入`"'; drop database;"`了关键字。）这称为 SQL 注入攻击，网络上*充斥*着易受攻击的编码不良的网站。不要让你的成为其中之一。

即使`@andkeywords`不是从用户输入的数据中填充，使用 DBI 参数也几乎不需要额外的努力，并且您的代码将在未来未知环境中安全使用。

`</Obligatory security moan>`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T21:56:29.630

我从来没有真正信任过这样的字符串中变量的自动替换。您可能需要考虑明确地执行您想要的连接，如下所示：

```
for($i=0;$i<$count;$i++){
    $where=$where . "'[[:<:]]" . $andkeywords[$i] . "[[:>:]]' "; 
```

**编辑：** 正如[ehemient](https://stackoverflow.com/users/20713/ephemient)指出的那样，普遍接受的内联方式是

```
for($i=0;$i<$count;$i++){
    $where=$where . "'[[:<:]]${andkeywords[$i]}[[:>:]]' "; 
```

就我个人而言，我发现第一种方式更具可读性，但与所有 Perl、[TIMTOWTDI 一样](http://en.wikipedia.org/wiki/There_is_more_than_one_way_to_do_it)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-07T19:29:41.307

如果您包含任何错误消息的文本，将会很有帮助。

有件事告诉我

```
for($i=0;$i<$count;$i++){
    $where=$where . "'[[:<:]]" . $andkeywords[$i] . "[[:>:]]' ";
    ...
} 
```

可以简化为

```
for (@andkeywords) {
    $where .= qq('[[:<:]]${_}[[:>]]' );
    ...
} 
```

也许

```
$where .= join ' ', map { qq('[[:<:]]${_}[[:>:]]') } @andkeywords; 
```

# java - 工厂模式和策略模式有什么区别？

> ID：616796
> 
> 赞同：180
> 
> 时间：2009-03-05T21:53:42.570
> 
> 标签：java, design-patterns, factory-pattern, strategy-pattern, abstract-factory

谁能解释工厂模式和策略模式之间的区别？

对我来说，除了一个额外的工厂类（在工厂模式中创建一个产品对象）之外，两者看起来都一样

* * *

## 回答 #1

> 赞同：281
> 
> 时间：2009-03-05T22:00:32.163

工厂模式是一种创建模式。策略模式是一种操作模式。换句话说，工厂模式用于创建特定类型的对象。策略模式用于以特定方式执行操作（或操作集）。在经典示例中，工厂可能会创建不同类型的动物：狗、猫、老虎，而策略模式将执行特定动作，例如移动；使用跑步、步行或 Lope 策略。

实际上两者可以一起使用。例如，您可能有一个创建业务对象的工厂。它可能会根据持久性介质使用不同的策略。如果您的数据以 XML 格式存储在本地，它将使用一种策略。如果数据在不同的数据库中是远程的，它将使用另一个。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-03-05T22:10:14.277

策略模式允许你多态地改变一个类的行为。

工厂模式允许您封装对象创建。

加里提出了一个很好的观点。如果您将编码原则用于抽象而不是“具体化”，那么许多模式开始看起来像是主题的变体。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2009-03-05T22:14:36.527

只是补充一下 tvanfosson 所说的，就实现而言，许多模式看起来都是一样的。也就是说，很多时候你创建了一个接口，而你的代码中以前可能没有一个接口，然后创建了一堆该接口的实现。不同之处在于它们的用途和使用方式。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2013-01-28T00:00:19.463

首先必须区分简单工厂和抽象工厂。第一个是一个简单的工厂，您只有一个类充当创建对象的工厂，而在后者中，您连接到工厂接口（定义方法名称），然后调用实现此接口的不同工厂应该基于某些标准具有相同方法的不同实现。例如，我们有一个 ButtonCreationFactory 接口，它由两个工厂实现，第一个 WindowsButtonCreationFactory（创建具有 Windows 外观的按钮）和第二个 LinuxButtonCreationFactory（创建具有 Linux 外观的按钮）。因此，这两个工厂确实具有相同的创建方法和不同的实现（算法）。

例如，如果您想要具有 Linux 外观的按钮：

```
ButtonCreationFactory myFactory = new LinuxButtonCreationFactory();
Button button1 = myFactory.createButton(...); 
```

或者如果你想要 Windows 按钮

```
ButtonCreationFactory myFactory = new WindowsButtonCreationFactory();
Button button1 = myFactory.createButton(...); 
```

正是在这种情况下，它产生了一种策略模式，因为它区分了进行某些创建的算法。但是，它在语义上与它不同，因为它用于创建对象而不是操作算法。因此，基本上使用抽象工厂，您可以使用不同的策略创建对象，这使得它与策略模式非常相似。然而，AbstractFactory 是创建性的，而 Strategy 模式是可操作的。在实施方面，它们的结果是相同的。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2016-02-10T08:00:12.780

*工厂（以及工厂返回的 FactoryMethod）*：

1.  创造模式
2.  基于继承
3.  工厂返回一个工厂方法（接口），该方法又返回具体对象
4.  您可以用新的具体对象替换接口和客户端（调用者）不应该知道所有具体实现
5.  客户端始终只访问接口，您可以在工厂方法中隐藏对象创建细节

看看这篇[维基百科文章](https://en.wikipedia.org/wiki/Factory_(object-oriented_programming))和[javarevisited 文章](http://javarevisited.blogspot.in/2011/12/factory-design-pattern-java-example.html)

*策略模式：*

1.  这是一种行为模式
2.  它基于委托
3.  它通过修改方法行为来改变对象的内容
4.  它用于在算法系列之间切换
5.  它在运行时改变对象的行为

例子：

*您可以为特定项目（机票或购物车项目）配置折扣策略。在此示例中，您将在 7 月至 12 月期间为某件商品提供 25% 的折扣，而在 1 月至 6 月期间为该商品提供 25% 的折扣。*

相关文章：

[策略模式的真实示例](https://stackoverflow.com/questions/370258/real-world-example-of-the-strategy-pattern/35180265#35180265)

[设计模式：工厂 vs 工厂方法 vs 抽象工厂](https://stackoverflow.com/questions/13029261/design-patterns-factory-vs-factory-method-vs-abstract-factory/35851402#35851402)

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2009-03-05T22:34:45.060

*   工厂（方法）模式。

仅创建具体实例。不同的论点可能导致不同的对象。这取决于逻辑等。

*   策略模式。

封装算法（步骤）以执行操作。因此，您可以更改策略并使用另一种算法。

虽然两者看起来非常相似，但目的却大不相同，一个目的是创造另一个目的是执行一个动作。

所以。如果你的工厂方法是固定的，你可能会这样：

```
 public Command getCommand( int operatingSystem ) { 
      switch( operatingSystem ) { 
           case UNIX    :
           case LINUX   : return new UnixCommand();
           case WINDOWS : return new WindowsCommand();
           case OSX     : return new OSXCommand();
       }
  } 
```

但是假设您的工厂需要更高级或动态的创建。您可以向工厂方法添加策略并更改它而无需重新编译，该策略可能会在运行时更改。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-05-14T00:51:48.790

扩展 Oscar 所说的并参考他的代码：

getCommand 是工厂，UnixCommand、WindowsCommand 和 OSXCommand 类是策略

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2014-11-19T07:12:52.780

简单来说，策略模式更多的是在运行时创建行为，而您不关心实现类。另一方面，工厂是具体类实例的运行时创建，您可以使用已实现接口公开的任何行为（方法）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-01-28T07:52:46.223

工厂模式是一种创建模式，它是使用指定的属性（行为）创建的。在创建后的运行时，您不能更改它的属性（行为）。因此，如果您需要不同的属性（行为），您必须删除对象并创建具有所需属性（行为）的新对象。这不是 gud。而在策略模式的情况下，您可以在运行时更改属性（行为）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-10-28T17:37:14.450

您无法仅通过查看代码或分类来理解差异。要正确掌握 GoF 模式，请寻找它们的意图：

策略：“定义一系列算法，封装每个算法，并使它们可互换。策略让算法独立于使用它的客户而变化。”

工厂方法：“定义一个用于创建对象的接口，但让子类决定实例化哪个类。工厂方法让一个类将实例化推迟到子类。”

以下是关于这两种模式的意图和区别的详细解释：[工厂方法和策略设计模式之间的区别](http://web.archive.org/web/20170715223127/http://www.deadschool.com/article/difference-between-factory-method-and-strategy-design-patterns)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-11-08T22:12:51.180

我可能会偏离 Oscar，因为他的 Factory 实现示例非常紧密耦合且非常封闭，难怪您选择的是策略模式。工厂实现不应依赖于任何固定数量的被实例化的特定类，例如：

```
public Command getCommand( int operatingSystem ) {        
   return commandTable.get(operatingSystem); 
}

...

public class WindowsCommand implements Command {
    ...
    static {
        CommandTable.getInstance().registerCommand(WIN_COMMAND_ID, new WindowsCommand());
    }

} 
```

我想选择一个或另一个的最合适的标准主要是你用来命名你的类和方法的术语，考虑到我们都应该倾向于对接口而不是类进行编程，并且也关注目标：我们的目标是确定哪些代码将在运行时执行。也就是说，我们可以通过使用这两种模式中的任何一种来实现目标。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-02-11T04:33:45.920

战略和工厂是不同的目的。在策略中，您定义了方法，使用此模式您可以交换行为（算法）。来到工厂，周围有很多变化。但是 GO4 的原始模式声明工厂将对象的创建留给子类。在这里，您将替换完整的实例而不是您感兴趣的行为。通过这种方式，您将替换完整的系统而不是算法。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-11-21T08:21:21.433

简单来说：

`Factory`用于创建具有相同行为的多个对象，但`Strategy`用于具有不同工作方式的一个对象。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2022-01-06T00:28:26.750

`Factory Pattern`和之间的主要区别在于`Strategy Pattern`操作在哪里完成。`Factory Pattern`对创建的对象进行操作（工厂类在创建后完成工作），而`Strategy Pattern`对上下文类本身进行操作。

要将 a 更改`Factory Pattern`为 a `Strategy Pattern`，而不是从工厂类返回创建的对象，将对象保存在上下文类中，并在上下文类中创建一个包装器方法来执行操作，而不是直接从创建的对象执行操作。

虽然有人可能会问我们是否可以对创建的对象进行操作，为什么我们仍然需要创建一个包装器来执行上下文类？好的，关键是操作。`Strategy Pattern`可以根据策略改变操作，不需要改变对象，可以依赖上下文对象做不同的操作，而不用改变对象本身。

# sql-server - 关于安装 sql server 2008 express 的选项？

> ID：616802
> 
> 赞同：0
> 
> 时间：2009-03-05T21:54:13.800
> 
> 标签：sql-server

我正在安装 sqlserver 2008 express，我有几个问题，

默认情况下，排序规则有**SQL_Latin1_General_CP1_CI_AS** 我只是想知道我应该选择哪种排序规则，以便它可以存储所有语言、英语、亚洲等。

这也是全新盒子上的全新安装，我应该使用默认实例还是命名实例。

谢谢你，雷。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T23:15:11.843

如果在新机器上，请使用默认值。

这是关于亚洲字符的讨论。 [http://social.technet.microsoft.com/Forums/en-US/sqlexpress/thread/fa221a0b-fd81-4f5e-8298-2a3afecbd7ea](http://social.technet.microsoft.com/Forums/en-US/sqlexpress/thread/fa221a0b-fd81-4f5e-8298-2a3afecbd7ea)

# c# - 如果您使用声明性数据源，您可以通过编程方式访问数据对象吗？

> ID：616804
> 
> 赞同：0
> 
> 时间：2009-03-05T21:54:43.020
> 
> 标签：c#, asp.net, objectdatasource

我正在使用 asp.net 2.0。我正在使用声明性数据源。对于后面代码中的某些内容，我想访问 Foo.Bar 返回的对象（在下面的示例中）。系统正在缓存它，所以我应该能够访问该版本，而不必重新调用 Foo.Bar()。我该怎么做呢？

```
<asp:ObjectDataSource ID="MyLuckDataSource1" runat="server" 
    TypeName="Foo.Bar" SelectMethod="GetMoreFoo" 
    CacheDuration="Infinite" CacheExpirationPolicy="Sliding" 
    EnableCaching="True">
    <SelectParameters>
        <asp:ControlParameter ControlID="BarID" Name="bar_code" Type="String" Direction="Input" DefaultValue="1011" />
    </SelectParameters>
</asp:ObjectDataSource>

<asp:GridView ID="GridView1" runat="server"  runat="server" DataSourceID="MyLuckDataSource1" ... 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T21:58:17.487

试试 GridView 的 OnRowDataBound 事件。

就像：

```
protected void GridView2_RowDataBound(object sender, GridViewRowEventArgs e)
{
    if (e.Row.RowType == DataControlRowType.DataRow)
    {
        var some = (Foo.SomeBar) e.Row.DataItem;
        somelabel.Text = some.Date.ToString();
    }
} 
```

附言。尝试一下，我的意思是它有效:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T22:00:41.943

我认为 Freddy 对 OnRowDataBound 的看法是正确的。虽然我认为您只能在gridview上绑定期间检查单元格的文本结果，而不是底层对象，但我不记得了。

至少在从 GetMoreFoo() 返回结果之前，您可以将结果存储在会话中。

我完成了整个模型视图展示器 (MVP) 的工作，并将对象数据源连接到展示器，因此当调用 GetMoreFoo() 函数时，我可以在视图 (aspx.cs) 或展示器上访问我想要的任何内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-23T20:21:18.143

您还可以通过检查 e.ReturnValue 属性在 ObjectDataSource.Selected 事件中捕获您的收集结果。

```
protected void MyLuckDataSource1_Selected(object sender, ObjectDataSourceStatusEventArgs e)
{
    List<Foo> x = (List<Foo>)e.ReturnValue;

    // do whatever you need with the results here...
} 
```

# java - 私有字符串成员用什么初始化

> ID：616807
> 
> 赞同：0
> 
> 时间：2009-03-05T21:55:16.387
> 
> 标签：java

在Java中初始化私有字符串成员的最佳实践是什么

```
class A {
       private String mem = ??//
       private int num;
       A (int a) {
          this.num = a;
       }
       A (int a, String s) {
           this.num = a;
           this.mem  = s; //What if s is null (Is this a good practice)
       }

} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T22:21:50.957

完全取决于你在做什么......

问自己这些问题（每当你做出任何变量时）

*   价值会改变吗？
*   允许的值是多少？

在这种情况下，如果 "mem" 和 "num" 永远不会改变，则将它们标记为 final（如果您发现必须更改它们，您可以随时删除 final）。

同样在这种情况下，“mem”可以为空吗？num 可以永远小于 0 吗？

以下是我可能进行的更改的示例：

类 A { 私有最终字符串内存；私有整数；

```
 A (final int a) 
   {
       this(a, null); 
   }

   A (final int a, 
      final String s) 
   {
       if(a < 0)
       {
           throw new IllegalAgumentException("a cannot be < 0, was: " + a);
       }

       num = a;
       mem = s; 
   } 
```

}

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T22:36:52.760

There is a trick with this (and most variables, actually).

If you NEVER initialize the variable, you are actually giving the compiler more information.

In some cases you have to, but this case is really interesting:

```
String s;

if(a==5)
    s="It was Five";
if(a==6)
    s="It was Six";

System.out.print(s); 
```

This is very bad code, but the neat thing is, Java will catch it and tell you "Hey, there is a good chance that you'll hit that print with a null".

If you had started with either of these two lines:

```
String s=null;
String s=""; 
```

The compiler couldn't have helped you with that mistake. (It's not likely that you meant to print "", is it?)

The correct fix when you see this "variable might not have been initialized" message is NOT to initialize the string to null or "". It's to actually be sure s is set to a valid value in every possible path:

```
if(a==5)
    s="It was Five";
else if(a==6)
    s="It was Six";
else
    s="It was something else, who knows?"; 
```

This will compile fine, even without initializing s. This works on complex if/else, looping and exception cases, so don't just assume it will only catch trivial cases like this!

So "Best Practice" is to NEVER initialize variables to "", 0 or null. Don't initialize them unless it really makes sense and you are using the value you set it to in some way.

Once you get the error in my example, instead of the else you might just initialize s to "It was something else, who knows?" instead of adding the else--that would be perfectly valid; but by not initializing it to null or "" as a matter of habit, at least it was able to remind you that you had to do so.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T21:59:40.323

简而言之，没有最佳实践。

取决于你的型号。某些字符串可能需要为空，而其他字符串（强制）应始终包含一个值。有时不仅仅是一个空字符串。

我不会盲目地将空字符串分配给所有内容。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-05T21:59:57.250

留空：`private String mem;`

关于“如果 s 为空怎么办”，应该将所有对象构造为有效状态作为重点。但是什么是“有效的”完全取决于您的应用程序。当您的程序的其余部分引用`mem`并发现它是`null`时，会发生什么？将其设置为空字符串或其他默认值会更好吗？视情况而定。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-05T22:00:47.997

这取决于该属性的用法。

null 在您的程序中是有效的输入吗？

如果不是，那么您应该验证它并抛出 Npe。

```
A ( int a, String s  ) { 
    if( s == null ) { 
        throw new NullPointerException("The value of s cannot be null"); 
    }
    ....
} 
```

如果它是一个有效值，那么就不会有问题。

尽管您只在一个地方分配值是一种很好的做法，因此如果您在构造函数中进行验证，您不会感到意外，但稍后 setter 会更改该值。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-06T06:53:20.430

如果 String 永远不应该为 null，则可以将其声明为 final，这样编译器可以确保所有构造函数都为其分配一个值。

```
class A {
   private final String mem;
   private int num;
   A (int a) {
      this.num = a; // <= compile error, mem must be assigned
   }
   A (int a, String s) {
       this.num = a;
       this.mem  = s; // <= you need to null-check yourself
   }
} 
```

仍然由构造函数来确保它们不只是分配 null。

或许未来会带来@NotNull注解……

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-05T22:02:10.380

如果 String 永远不应该为 null，则从参数设置它的构造函数应在参数为 null 时抛出异常，并且其他构造函数应将其设置为有用的默认值。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-05T22:00:10.337

您应该定义一个合同，然后对其进行编码。如果您允许成员为空，则将其初始化为空。如果没有，通常初始化为空字符串`""`是个好主意。但同样，这取决于您的数据模型，有时空字符串也是无效的。

在所有情况下，您的构造函数都应该抛出`NullPointerException`，或者`IllegalArgumentException`如果传入了无效的字符串。

# c# - 基于抽象类公开 WCF 子类

> ID：616808
> 
> 赞同：4
> 
> 时间：2009-03-05T21:55:39.723
> 
> 标签：c#, wcf, abstract-class

我有一个抽象类，我希望能够将其公开给 WCF，以便任何子类也可以作为 WCF 服务启动。
这是我到目前为止所拥有的：

```
[ServiceContract(Name = "PeopleManager", Namespace = "http://localhost:8001/People")]
[ServiceBehavior(IncludeExceptionDetailInFaults = true)]
[DataContract(Namespace="http://localhost:8001/People")]
[KnownType(typeof(Child))]
public abstract class Parent
{
    [OperationContract]
    [WebInvoke(Method = "PUT", UriTemplate = "{name}/{description}")]
    public abstract int CreatePerson(string name, string description);

    [OperationContract]
    [WebGet(UriTemplate = "Person/{id}")]
    public abstract Person GetPerson(int id);
}

public class Child : Parent
{
    public int CreatePerson(string name, string description){...}
    public Person GetPerson(int id){...}
} 
```

尝试在我的代码中创建服务时，我使用此方法：

```
public static void RunService()
{
    Type t = typeof(Parent); //or typeof(Child)
    ServiceHost svcHost = new ServiceHost(t, new Uri("http://localhost:8001/People"));
    svcHost.AddServiceEndpoint(t, new BasicHttpBinding(), "Basic");
    svcHost.Open();
} 
```

当使用 Parent 作为我得到的服务类型
`The contract name 'Parent' could not be found in the list of contracts implemented by the service 'Parent'.` 或 `Service implementation type is an interface or abstract class and no implementation object was provided.`

当使用 Child 作为我得到的服务类型时
`The service class of type Namespace.Child both defines a ServiceContract and inherits a ServiceContract from type Namespace.Parent. Contract inheritance can only be used among interface types. If a class is marked with ServiceContractAttribute, then another service class cannot derive from it.`

有没有办法在 Child 类中公开函数，这样我就不必专门添加 WCF 属性？

**编辑**
所以这个

```
[ServiceContract(Name= "WCF_Mate", Namespace="http://localhost:8001/People")]  
    public interface IWcfClass{}  

    public abstract class Parent : IWcfClass {...}  
    public class Child : Parent, IWcfClass {...} 
```

使用 Child 返回启动服务
`The contract type Namespace.Child is not attributed with ServiceContractAttribute. In order to define a valid contract, the specified type (either contract interface or service class) must be attributed with ServiceContractAttribute.`

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-05T21:59:09.060

The service contract is usually an interface, not a class. Place your contract into an interface, have the abstract class implement this interface, and let us know what happens when you use Child to start the service.

Edit: Ok, now you need to modify your RunService method to this below. The contract type if IWcfClass, not Child or Parent.

```
public static void RunService()
{
        Type t = typeof(Child);
        ServiceHost svcHost = new ServiceHost(t, new Uri("http://localhost:8001/People"));
        svcHost.AddServiceEndpoint(typeof(IWcfClass), new BasicHttpBinding(), "Basic");
        svcHost.Open();
} 
```

# unit-testing - 硒的意义何在？

> ID：616810
> 
> 赞同：28
> 
> 时间：2009-03-05T21:55:53.950
> 
> 标签：unit-testing, testing, selenium

好吧，也许我错过了一些东西，但我真的不明白 Selenium 的意义。使用代码打开浏览器、使用代码单击按钮、使用代码检查文本的意义何在？我阅读了该网站，我看到理论上自动对您的 Web 应用程序进行单元测试会很好，但最后编写所有这些代码而不是仅仅点击并直观地验证事情是否工作需要更多的时间?

我不明白...

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-03-05T22:01:07.310

它允许您在“单元”测试框架中编写功能测试（问题是后者的命名）。

当您通过浏览器测试您的应用程序时，您通常是在测试完全集成的系统。考虑到您已经必须在提交更改之前对其进行测试（冒烟测试），您不想一遍又一遍地手动测试它。

非常棒的一点是，您可以自动化烟雾测试，而 QA 可以增强这些。非常有效，因为它减少了重复工作并使整个团队更加紧密。

Ps 与您第一次使用的任何练习一样，它具有学习曲线，因此第一次通常需要更长的时间。我还建议您查看[页面对象](http://code.google.com/p/webdriver/wiki/PageObjects)模式，它有助于保持测试干净。

**更新 1：**请注意，测试还将在页面上运行 javascript，这有助于测试高度动态的页面。另请注意，您可以使用不同的浏览器运行它，因此您可以检查跨浏览器问题（至少在功能方面，因为您仍然需要检查视觉效果）。

另请注意，随着测试覆盖的页面数量的增加，您可以快速创建具有完整交互周期的测试。使用页面对象模式，它们看起来像：

```
 LastPage aPage = somePage
      .SomeAction()
      .AnotherActionWithParams("somevalue")
      //... other actions
      .AnotherOneThatKeepsYouOnthePage(); 
  // add some asserts using methods that give you info
  // on LastPage (or that check the info is there).
  // you can of course break the statements to add additional 
  // asserts on the multi-steps story. 
```

重要的是要了解您对此要循序渐进。如果它是一个已经构建的系统，您可以为您正在处理的功能/更改添加测试。在此过程中添加越来越多的覆盖范围。改为手动，通常会隐藏您错过测试的内容，因此如果您进行了影响每个页面的更改并且您将检查一个子集（因为时间不允许），您知道您实际测试了哪些并且 QA 可以使用那里（希望通过添加更多测试）。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-05T21:59:54.580

这是关于单元测试的普遍说法。“我需要编写两倍的代码进行测试？” 同样的原则也适用于此。回报是改变你的代码并知道你没有破坏任何东西的能力。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-03-06T03:17:48.530

因为您可以一遍又一遍地重复相同的测试**。**

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-05T21:59:29.153

如果您的应用程序甚至超过 50 个页面，并且您需要进行频繁的构建并针对 X 数量的主要浏览器对其进行测试，那么这很有意义。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-05T22:15:05.060

想象一下，你有 50 个页面，每个页面都有 10 个链接，有些页面包含多阶段表单，需要你浏览表单，输入大约 100 组不同的信息，以验证它们是否适用于所有信用卡号、所有地址在所有国家等

手动测试几乎是不可能的。它变得如此容易出现人为错误，以至于您无法保证测试是正确的，更不用说测试证明了被测试的东西是什么。

此外，如果您遵循现代开发模型，许多开发人员都以不连贯的分布式方式在同一个站点上工作（例如，有些开发人员在飞机上通过笔记本电脑在站点上工作），那么人工测试人员不会甚至可以访问它，更不用说每次单个开发人员尝试新事物时都有耐心重新测试。

在任何体面大小的网站上，测试都必须自动化。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-05T22:07:50.180

这一点与任何类型的自动化测试都是一样的：编写代码可能比“只是点击并直观地验证事情是否有效”需要更多的时间，可能要多 10 倍甚至 50 倍。

但是任何不平凡的应用程序最终都必须测试超过 50 次，而手动测试是一件烦人的苦差事，可能会被省略或在压力下粗制滥造，这导致直到重要截止日期之前（或之后）才发现错误，这会导致紧张的通宵编码课程，甚至由于合同罚款而导致彻底的金钱损失。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-08T21:57:24.763

Selenium（以及类似的工具，如 Watir）允许您以计算机擅长的方式针对 Web 应用程序的用户界面运行测试：一夜之间数千次，或在每次源签入后的几秒钟内。（请注意，还有很多其他人类更擅长的 UI 测试部分，例如注意到一些与测试没有直接关系的奇怪事情是错误的。）

通过查看生成的 HTML 而不是启动浏览器来呈现它，还有其他方法可以让整个应用程序堆栈参与进来，例如[Webrat](http://webrat.rubyforge.org)和[Mechanize](http://mechanize.rubyforge.org/mechanize)。其中大多数没有办法与大量 JavaScript 的 UI 交互；Selenium 在这里为您提供了一些帮助。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-09T17:16:00.657

**Selenium 将记录并重新运行您为测试 Web 应用程序所做的所有手动单击和键入操作。一遍又一遍。**

随着时间的推移，对我自己的研究表明，我倾向于做更少的测试并开始跳过一些，或者忘记它们。

Selenium 将改为进行每个测试，运行它，如果它没有返回您期望的结果，它可以让您知道。

记录所有这些测试需要预先花费时间。我会像单元测试一样推荐它——**如果你还没有它，就开始使用它来处理代码中最复杂、最敏感或更新最多的部分。**

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-05T22:00:39.447

如果您将这些测试保存为 JUnit 类，您可以在闲暇时重新运行它们，作为自动构建的一部分，或者使用 JMeter 在穷人的负载测试中重新运行它们。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-05T22:07:04.050

在过去的工作中，我们曾经对我们的 web 应用程序进行单元测试。如果网络应用程序改变了它的外观，则不需要重新编写测试。记录和回放类型测试都需要重新进行。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-06T00:44:12.643

为什么需要硒？因为测试人员是人。他们每天回家，不能总是在周末工作，请病假，请公共假期，时不时去度假，厌倦了重复性的工作，不能总是依赖他们在你需要的时候在身边。

我并不是说你应该摆脱测试人员，而是一个自动化的 UI 测试工具补充了系统测试人员。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-05T22:04:06.117

关键是能够使手动和耗时的测试之前的工作自动化。是的，编写测试需要时间，但是一旦编写完成，就可以按照团队的意愿多次运行。每次运行时，它们都会验证 Web 应用程序的行为是否一致。Selenium 不是一个完美的产品，但它非常擅长自动化现实的用户与浏览器的交互。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-05T22:13:09.307

如果您不喜欢 Selenium 方法，可以尝试[HtmlUnit](http://htmlunit.sourceforge.net/)，我发现它更有用且易于集成到现有的单元测试中。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-10T16:02:35.240

对于具有丰富 Web 界面的应用程序（如许多 GWT 项目），Selenium/Windmill/WebDriver/etc 是创建验收测试的方法。在 GWT/GXT 的情况下，最终的用户界面代码在 JavaScript 中，因此使用普通的 junit 测试用例创建验收测试基本上是不可能的。使用 Selenium，您可以创建匹配真实用户操作和预期结果的测试场景。

根据我对 Selenium 的经验，它可以揭示应用程序逻辑和用户界面中的错误（如果您的测试用例编写得很好）。处理 AJAX 前端需要一些额外的努力，但它仍然是可行的。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-10T16:09:38.313

我用它来测试多页表单，因为这样可以减轻一遍又一遍地输入相同内容的负担。并且能够检查某些元素是否存在是很棒的。同样，以表格为例，您的最终硒测试可以检查是否在订购过程结束时出现“感谢 Rogers 先生订购...”之类的内容。

# asp.net - JQuery ajaxStart 事件未在 ASP.net AJAX 中捕获

> ID：616814
> 
> 赞同：3
> 
> 时间：2009-03-05T21:56:46.447
> 
> 标签：asp.net, jquery, asynchronous, updatepanel

我在更新面板和内容模板中有一个带有保存按钮的 asp.net 页面。保存效果很好，但我试图在使用 JQuery 进行保存时添加一个“等待”gif，但 ajaxStart 事件没有触发。我放了一个简单的捕获如下所示：

```
$(document).ajaxStart(function () {
    alert('starting');
}).ajaxStop(function () {
    alert('done');
}); 
```

单击保存时不显示任何警报。尝试捕获 ASP.net Ajax 事件时是否存在问题，asp 是否正在执行一些无法被 Jquery 捕获的时髦类型的 Ajax 调用？

谢谢，如果您对此有任何想法，请告诉我，

标记。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-05T22:01:19.273

ASP.NET 更新面板似乎在做自己的事情...点击 PageReuqestManager 并在此处设置您自己的调用...

**编辑**
我在下面简化了一些功能，以使您的样本更加匹配......

```
<script type="text/javascript">
    function pageLoad() {
        if (!Sys.WebForms.PageRequestManager.getInstance().get_isInAsyncPostBack()) {
            Sys.WebForms.PageRequestManager.getInstance().add_endRequest(AjaxEnd);
            Sys.WebForms.PageRequestManager.getInstance().add_initializeRequest(AjaxBegin);
        }
    }

    function AjaxEnd(sender, args) {
        alert("I am done...");
    }

    function AjaxBegin(sender, args) {
        alert("I am about to start...");
    }
</script> 
```

# vb6 - 寻找VB6在线帮助

> ID：616816
> 
> 赞同：0
> 
> 时间：2009-03-05T21:56:56.897
> 
> 标签：vb6, msdn

我再也找不到包含 VB6 的 MSDN 帮助的 CD，但我订阅了 MSDN。当前的 MSDN 库显然没有 VB6 在线帮助。

最后一个包含 VB6 帮助的 MSDN 库是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-05T22:08:32.907

也可在[MSDN Library](http://msdn.microsoft.com/en-us/library/aa338032(VS.60).aspx)上在线获取。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-05T21:58:22.557

难怪你是“愤怒的黑客”。

我相信那是 2001 年 10 月。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-09-18T22:13:06.503

您可以轻松下载适用于 Visual Basic 6 (VB6) 的正确 MSDN 副本，但您需要订阅 MSDN。如果您有该订阅，这里分步说明如何查找、下载、提取、安装和测试适用于 VB6 的正确 MSDN 库（使用 VB6 /studio 的 F1 上下文相关帮助方法）：

[http://www.kimgentes.com/worshiptech-web-tools-page/2014/9/18/finding-downloading-and-installing-msdn-library-for-vb6-on-m.html](http://www.kimgentes.com/worshiptech-web-tools-page/2014/9/18/finding-downloading-and-installing-msdn-library-for-vb6-on-m.html)

# .net - 如何使用 Visual Basic 从 XML 文件中提取数据？

> ID：616817
> 
> 赞同：0
> 
> 时间：2009-03-05T21:57:41.747
> 
> 标签：.net, xml, vb.net, soap, xpath

我没有过多地使用 XML，我需要一点帮助。

我的 .NET 应用程序从 W3C 的公共验证服务器获取此 XML 响应：

```
<?xml version="1.0" encoding="UTF-8" ?> 
<env:Envelope xmlns:env="http://www.w3.org/2003/05/soap-envelope">
    <env:Body>
        <m:markupvalidationresponse env:encodingStyle="http://www.w3.org/2003/05/soap-encoding" xmlns:m="http://www.w3.org/2005/10/markup-validator">
            <m:uri>upload://Form Submission</m:uri> 
            <m:checkedby>http://validator.w3.org/</m:checkedby> 
            <m:doctype>-//W3C//DTD XHTML 1.1//EN</m:doctype> 
            <m:charset>utf-8</m:charset> 
            <m:validity>true</m:validity> 
            <m:errors>
                <m:errorcount>0</m:errorcount> 
                <m:errorlist /> 
            </m:errors>
            <m:warnings>
                <m:warningcount>0</m:warningcount> 
                <m:warninglist /> 
            </m:warnings>
        </m:markupvalidationresponse>
    </env:Body>
</env:Envelope> 
```

我想从中提取以下值：

*   Uri 作为字符串
*   Checkedby 作为字符串
*   文档类型为字符串
*   字符集为字符串
*   布尔值的有效性
*   ErrorList 作为 System.Collections.Generic.List(Of W3CError)
*   警告列表作为 System.Collections.Generic.List(Of W3CError)

该类型 W3CError 是我创建的一个小类，具有以下属性：

*   行为整数
*   Col 作为整数
*   消息作为字符串
*   MessageId 作为字符串
*   解释为字符串
*   源为字符串

这是我到目前为止所做的。但是，**这行不通**...

```
Dim ResponseReader As Xml.XmlTextReader = New Xml.XmlTextReader(ResponseStream)
将 ResponseDocument 变暗为新的 Xml.XPath.XPathDocument(ResponseReader)
将 ResponseNavigator 调暗为 Xml.XPath.XPathNavigator = ResponseDocument.CreateNavigator()
Dim ResponseIterator As Xml.XPath.XPathNodeIterator

乌里
ResponseIterator = ResponseNavigator.Select("uri")
ResponseIterator.MoveNext()
_Uri = ResponseIterator.Current.Value

'通过检查
ResponseIterator = ResponseNavigator.Select("checkedby")
ResponseIterator.MoveNext()
_Checkedby = ResponseIterator.Current.Value

...ETC...

```

如何修复上面损坏的代码？或者：我是否偏离了轨道？有什么更好的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T22:07:35.610

您听说过 XPath 吗？

```
XmlDocument doc  = new XmlDocument()
doc.Load(xml)
// set the namspace manager, I don't remember exact syntax
....
XmlNode node = doc.SelectSingleNode("//m:checkedby", namespaceManagerThatDeclaresMNamespace); 
```

您的代码可能不起作用，因为您忽略了 xml 中的命名空间

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-06T16:18:28.717

试试这个

```
'Import these Namespaces at the top of your file
Imports System.Linq
Imports System.Xml.Linq
Imports <xmlns:env="http://www.w3.org/2003/05/soap-envelope">
Imports <xmlns:m="http://www.w3.org/2005/10/markup-validator">

'in a procedure do this
Dim doc As XDocument = <?xml version="1.0" encoding="UTF-8" ?> 
<env:Envelope xmlns:env="http://www.w3.org/2003/05/soap-envelope">
    <env:Body>
        <m:markupvalidationresponse env:encodingStyle="http://www.w3.org/2003/05/soap-encoding" xmlns:m="http://www.w3.org/2005/10/markup-validator">
            <m:uri>upload://Form Submission</m:uri> 
            <m:checkedby>http://validator.w3.org/</m:checkedby> 
            <m:doctype>-//W3C//DTD XHTML 1.1//EN</m:doctype> 
            <m:charset>utf-8</m:charset> 
            <m:validity>true</m:validity> 
            <m:errors>
                <m:errorcount>0</m:errorcount> 
                <m:errorlist /> 
            </m:errors>
            <m:warnings>
                <m:warningcount>0</m:warningcount> 
                <m:warninglist /> 
            </m:warnings>
        </m:markupvalidationresponse>
    </env:Body>
</env:Envelope>

_Uri = doc.Root.<env:Body>.<m:markupvalidationresponse>.<m:uri>.Value
_Checkedby = doc.Root.<env:Body>.<m:markupvalidationresponse>.<m:checkedby>.Value
'note that the following code assumes you have a class named W3CError
_errorList = (From er in doc.Root...<m:errors> _
             Select New W3CError With {.Line = CInt(er.<m:line>.Value), .Col = CInt(er.<m:col>.Value), .Message = er.<m:message>.Value, .MessageId = er.<m:messageId>.Value, .Explanation = er.<m:explanation>.Value, .Source = er.<m:source>.Value}).ToList
'do the same for the _warningList as above
'now do what you want with it 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T22:10:52.807

还有linq2xml。它位于 System.Xml.Linq 中。它有一个新的 XDocument 类，它比旧的 System.Xml.XmlDocument 类更易于使用。

# 3d - 平滑的 3D 样条

> ID：616819
> 
> 赞同：0
> 
> 时间：2009-03-05T21:58:09.313
> 
> 标签：3d, geometry, spline

REF：[曲线拟合 3D 数据集](https://stackoverflow.com/questions/588438/curve-fitting-3d-data-set)

有谁知道如何用**3D 控制点构建****平滑的 3D 样条曲线**？

 **如果您查看上面提供的参考资料，红点将用作样条曲线的控制点（这应该是 3D 点云的最佳拟合表示）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T22:32:57.903

您可以将其解构为 2 个 2D 问题：

1.  沿 X 轴和 Y 轴拆分数据。
2.  用所有未知系数形成样条的完整 3D 方程。
3.  想象一下您的数据投影到 YZ 和 XZ 平面上。
4.  在 XZ 平面中，求解一半系数的方程。
5.  然后，在 YZ 平面上，求解另一半。

# linq - linq 缓存和处理数据上下文

> ID：616820
> 
> 赞同：0
> 
> 时间：2009-03-05T21:58:09.377
> 
> 标签：linq, caching

处理完我的数据上下文后，linq 仍然为其他单独的调用保存数据，这些调用具有新的数据上下文。这不应该被清除吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T22:13:28.497

您可能持有对其中一个实体的引用。它们在内部指向 DataContext。如果是这种情况，您正在寻找如何更改实体的上下文，无论您尝试使用 dispose 释放什么。免责声明：我不知道 dispose 是否应该清除跟踪的实体列表，但如果您持有对这些实体的引用，那将是非常糟糕的。

# delphi - 如何创建用于 Internet Explorer 7+ 的 Active X 控件？

> ID：616852
> 
> 赞同：2
> 
> 时间：2009-03-05T22:03:38.473
> 
> 标签：delphi, internet-explorer, activex

我正在使用 Delphi 2007，我正在寻找一些资源和最佳实践来编写用于嵌入 Internet Explorer 7.0（及更高版本）的 ActiveX 控件。

我使用此 ActiveX 控件的目标是能够检索有关用户正在访问的网站以及连接类型（例如 HTTPS、HTTP、FTP 等）的信息。我不想嗅探流量，只是为了查看他们正在访问的地址。

或者，如果它更容易，我最好编写一个类似于 AVG Anti-Virus 的免费工具栏的工具栏，它安装在 IE 中，用于“验证”页面上的链接是否为安全链接。如果您有任何建议，请让我知道。

问候。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T22:16:36.070

如果您创建一个新项目，您可以选择多个选项，其中之一是 ActiveX 控件。

我过去做过（delphi 7）并在网页上使用它没有问题。

# sql - 从同一张表中获取一对多关系中的数据

> ID：616853
> 
> 赞同：0
> 
> 时间：2009-03-05T22:03:40.780
> 
> 标签：sql

我有一个表，它包含 4 列：

```
身份证|医院| 医生|病人
1 A D1 P11
2 B D6 P61
3 A D2 P21
4 A D1 P12
5 B D7 P71
6 B D6 P62
7 B D6 P63
```

医生是医院独有的。他们不在其他医院工作。病人对医生来说是独一无二的。他们不去看任何其他医生。每家医院都有多名医生。

如果您观察到每个医生有多个患者。

现在的问题是，我怎样才能得到与每个医生相关的“只有一个病人”？它可以是记录中的任何患者。

我期待看到这样的事情：

```
医院医生病人
  A D1 P11
  A D2 P21
  B D6 P61
  B D7 P71
```

如何在上表中获取 id，例如：

```
id 医院 医生 病人
 1 A D1 P11
 3 A D2 P21
 2 B D6 P61
 5 B D7 P71
```

提前致谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T22:09:20.237

像这样：

```
SELECT Hospital, Doctor, MAX(Patient)
FROM table
GROUP BY Hospital, Doctor
ORDER BY Hospital, Doctor 
```

既然你说你不关心哪个病人，我只使用了 MAX，但你也可以使用 MIN 或其他一些分组函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T22:23:38.987

我不禁要问，这不应该是三张桌子，而不是一张。当然，Hospital 和 Doctor 之间存在 1:m 的关系，Doctor 和 Patient 之间也存在 1:m 的关系。每个实体必须具有其他属性。为什么所有这些都在一个表中？我会正常化它。

我不明白 B 医院 D6 应该首选 P61 或 P63 的要求，但我相信你会。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T22:23:52.043

鉴于上表，埃里克已经回答了这个问题。

如果您可以控制数据库设计：

如果一个医生只能在一家医院工作，那么 Doctor 表应该有一个 HospitalId。如果一个病人真的只能有一个医生，那么 Patient 表应该有一个 DoctorId。

病人>>医生>>医院。

这将完全消除这个表，它看起来支持医生、医院和患者之间的多对多关系，你说这是不可能的。但是，您可能希望保持灵活。

# eclipse - Eclipse PDT、PHPUnit 自动完成

> ID：616874
> 
> 赞同：3
> 
> 时间：2009-03-05T22:07:55.547
> 
> 标签：eclipse, eclipse-pdt

有没有办法让 PHPUnit 自动完成在 Eclipse PDT 中工作而不在项目中包含库？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T22:13:00.963

您是否尝试过将 PHPUnit 代码放在项目的包含路径中？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-11T16:02:34.750

[如何将 PHP 框架添加到 Eclipse PDT 中的代码完成/辅助，并且可以将框架添加为所有项目的默认框架吗？](https://stackoverflow.com/questions/903769/how-do-you-add-a-php-framework-to-code-completion-assist-in-eclipse-pdt-and-can-t)
一般来说，在 Eclipse 中，您可以通过以下方式将库或框架添加到代码辅助/完成：

1.  进入项目>属性
2.  在 PHP 包含路径下，选择“库”选项卡。
3.  添加一个带有框架所在路径的“外部文件夹”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-08T13:04:48.183

您需要启用它。

进入菜单：`Window -> Preferences`。然后下`PHP -> Editor -> Code Assist`。在自动激活下`enable auto activation`选中复选框（注意：200 ms 默认有点慢）。你可以调整时间。

# f# - 格式字符串中的 F# 类型推断

> ID：616879
> 
> 赞同：4
> 
> 时间：2009-03-05T22:11:40.030
> 
> 标签：f#

F# 如何在编译时检查格式字符串以确定 x 在以下定义中具有 int 类型？

```
let foo x = sprintf "%d" x`? 
```

这是硬编码到语言中还是有人可以编写自己的“my_print”函数来使用具有不同语法的格式字符串？例如：

```
let foo x = my_print "{integer}" x 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T22:18:45.457

您可以在[此处](http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/spec2.aspx)阅读 6.4.17（'printf' 格式）中的一些相关信息，但简要介绍一下

*   它内置在语言中
*   字符串文字可以有效地被“强制”为奇怪的“格式”类型
*   printf 和朋友们期望 Format 类型的第一个参数，使强制发生

最终结果是您可以构建自己的 printf 样式函数，但必须使用相同的 %s 格式，因为这些东西是内置的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T16:16:33.953

[下面](http://diditwith.net/2008/12/29/PrintfAndFormattingDebugOutputInF.aspx)是如何在 F# 中构建自己的 printf 样式函数的示例。您不能更改格式说明符（例如“%d”），但您可以利用现有说明符来构建编译器将进行类型检查的附加字符串格式化函数。

# unit-testing - 哪些测试场景对于详尽的黑盒测试重复约会模型是必要且足够的？

> ID：616881
> 
> 赞同：3
> 
> 时间：2009-03-05T22:11:53.493
> 
> 标签：unit-testing, testing, django-models, automated-tests

我在日历中有一个约会的 django 模型，我正在尝试为其编写一个非常全面的测试驱动程序。定期约会发生在某个时间点，可以无限运行，也可以重复固定次数。该约会反映了可用于 Google 日历约会的功能（可以每月/每年/每周、每两周、每 3 年重复一次。）

我正在尝试提出一个单元测试，它将详尽地测试此实现的基础知识。我正在寻找定义最基本测试的边缘案例。

我有很多基本的，但我正在寻找帮助确定最重要案例的建议：1）创建一个约会 2）创建一个每周重复的约会 3）......每月重复 4）每 2 周重复 5）每 2 个月重复一次 6) 每年重复一次

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-05T22:22:05.137

测试月份的最后几天，闰年，以及当一年有额外的一秒时它是否会变得疯狂（这个在 zune 播放器中击中了一个驱动程序）。

测试它在跨年时表现良好。

也就是说，请考虑您是否正在重新测试属于框架的一部分。测试日期逻辑可能会很快变得丑陋，因此您想在应用程序的一部分和框架的一部分上划清界限。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T22:16:07.240

不要忘记在闰年测试 2 月 29 日的年度重复；）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T18:03:02.363

在你开始讨论场景之前，你真的需要根据你对需求的理解来制定一个测试计划。

考虑您的用户群和任何其他可能/未来的用户群（作为较低优先级）。他们主要将它用于什么？这些用例对他们的业务有多大价值？

理想情况下，创建应用程序模型并从那里开始。

对您计划做的事情进行风险分析。然后计划做功能、安全、本地化测试等。

然后，您可以开始根据场景的“风险”程度（来自风险分析）来考虑场景。首先专注于编写和执行“风险更大”的内容。

获取有关您对风险的分析以及打算如何使用它的业务输入（如果可能的话）。

只是把随机场景扔出去并不是一个好的测试实践，应该得到开发人员的所有嘲笑。测试应该是一个更加工程化、有计划的练习。他们可以雇佣街上的任何人来运行他们脑海中浮现的场景。

话虽如此，我同意前面提到的场景是经过验证的。好主意。还要进行夏令时测试。使用不同的电子邮件客户端。尝试发布忙/闲日期。让开发人员解释他们是如何发布这些信息的。是通过网络服务吗？他们是否希望只有 Exchange 用户才能使用它？不同国家/地区的日期格式不同的人吗？然后，您可以找到弱点并找到更多错误。

快乐测试。

# asp.net - 为什么更新面板会为自定义控件做一个完整的回传？

> ID：616884
> 
> 赞同：3
> 
> 时间：2009-03-05T22:12:10.510
> 
> 标签：asp.net, asp.net-ajax, updatepanel

我有一个相当复杂的自定义控件 - 自定义控件中有几个更新面板。

我正在尝试在更新面板中使用这样的控件：

```
 <asp:UpdatePanel ID="up1" runat="server">
    <ContentTemplate>
     <asp:Button ID="btn1" runat="server" Text="Sample Button" />&nbsp;&nbsp;<asp:Label ID="lblTime" runat="server"></asp:Label>    
     <cc1:MyCustomControl ID="MyCustomControl1" runat="server" >
    </cc1:MyCustomControl>
    </ContentTemplate>
</asp:UpdatePanel> 
```

当我单击更新面板中的按钮时，它会执行异步回发并且没有屏幕“闪烁”当我单击自定义控件中的按钮时，页面会闪烁并执行完整回发。

在自定义控件内部，有一些更新面板正在尝试执行完整的回发（基于触发器）。

无论自定义控件内部发生什么，如何使页面级别 UpdatePanel 不执行完整回发？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T23:53:51.873

您是否考虑过在 up1 UpdatePanel 控件中使用 btn1 控件显式设置 asp:AsyncPostBackTrigger。

```
<asp:UpdatePanel ID="up1" runat="server">
    <Triggers>
        <asp:AsyncPostBackTrigger ControlID="btn1" EventName="Click" />
    </Triggers>
    <ContentTemplate>     
        <asp:Button ID="btn1" runat="server" Text="Sample Button" />  
        <asp:Label ID="lblTime" runat="server"></asp:Label>         
        <cc1:MyCustomControl ID="MyCustomControl1" runat="server" />                 
    </ContentTemplate>
</asp:UpdatePanel> 
```

**编辑：** 您如何尝试在更新面板的按钮的 OnClick 事件中显式调用 Update 方法？这包括嵌入在自定义控件中的更新面板。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T00:58:57.427

想出了与此类似的解决方案： [如何让 UpdatePanel 拦截 CompositeControl 的 DropDownList](https://stackoverflow.com/questions/225666/how-can-i-get-an-updatepanel-to-intercept-a-compositecontrols-dropdownlist)

除了我导致回发的控件位于具有完整回发触发器的更新面板中。我能够将该控件拉出，因此它没有嵌套在更新面板中并解决了它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T23:40:22.563

我会首先查看导致整个页面回发的自定义控件是否存在其他问题，因为无论如何应该发生的是整个更新面板刷新（仍然使用 ajax）。

之后，只需查看其中的 Nesting UpdatePanel Controls 部分：http: [//msdn.microsoft.com/en-us/library/bb398867.aspx#](http://msdn.microsoft.com/en-us/library/bb398867.aspx#)

还要确保将属性 EnablePartialRendering 设置为 true 的 ScriptManager 控件。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-03-05T23:33:49.177

在 UpdatePanel 上，设置属性`ChildrenAsTriggers="true"`。这告诉 UpdatePanel 拦截源自 UpdatePanel 内部的*所有PostBack 调用。*

您可能还想探索[UpdateMode 属性](http://msdn.microsoft.com/en-us/library/d9w023sx.aspx)，它决定了触发更新的事件类型。（默认情况下，如果屏幕上的任何其他面板被刷新，UpdatePanel 将刷新。这让我呆了一会儿，直到我意识到发生了什么。）

# google-app-engine - 使用 Google App Engine 解析收到的邮件？

> ID：616889
> 
> 赞同：4
> 
> 时间：2009-03-05T22:13:18.277
> 
> 标签：google-app-engine, email

我们使用 Google Apps 设置了邮件。我们希望能够对传入的邮件运行一些正则表达式并处理这些信息。

现在使用 Google App Engine 可以做到这一点吗？谷歌是否提供某种可以做到这一点的基础设施？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-04-17T19:14:47.420

[从这里](http://code.google.com/appengine/docs/python/mail/overview.html#Receiving_Mail)的谷歌文档：

**接收邮件**

您的应用可以通过以下形式的地址接收电子邮件：

```
string@appid.appspotmail.com 
```

请注意，即使您的应用程序部署在自定义域上，您的应用程序也无法接收发送到该域上地址的电子邮件。电子邮件作为 HTTP 请求发送到您的应用程序。这些请求由 App Engine 生成并发布到您的应用程序。在您的应用程序配置中，您指定将被调用以处理这些 HTTP 请求的处理程序。在您的处理程序中，您会收到电子邮件的 MIME 数据，然后将其解析为各个字段。

使用以下 URL 将电子邮件作为 HTTP POST 请求发送到您的应用程序：

```
/_ah/mail/address 
```

其中地址是完整的电子邮件地址，包括域名。默认情况下，在您的应用程序中接收邮件的功能被禁用。要使您的应用程序能够接收邮件，您必须在 app.yaml 文件中指定您希望启用此服务，方法是包含以下内容：

```
inbound_services:
- mail 
```

Python SDK 定义了 InboundMailHandler，这是一个用于处理传入电子邮件的 webapp 类。要使用 InboundMailHandler，请将其子类化并覆盖 receive() 方法。使用 InboundEmailMessage 类的参数调用 receive() 方法，该类是 Python SDK 定义的另一个类。

InboundMailHandler 位于 google.appengine.ext.webapp.mail_handlers 包中。您可以像这样创建 InboundEmailMessage 的实例：

```
import logging, email
from google.appengine.ext import webapp 
from google.appengine.ext.webapp.mail_handlers import InboundMailHandler 
from google.appengine.ext.webapp.util import run_wsgi_app

class LogSenderHandler(InboundMailHandler):
    def receive(self, mail_message):
        logging.info("Received a message from: " + mail_message.sender) 
```

InboundEmailMessage 对象包括访问其他消息字段的属性：

```
subject contains the message subject.
sender is the sender's email address.
to is a list of the message's primary recipients.
cc contains a list of the cc recipients.
date returns the message date.
attachments is a list of file attachments, possibly empty. Each value in the list is a tuple of two elements: the filename and the file contents.
original is the complete message, including data not exposed by the other fields such as email headers, as a Python email.message.Message. 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-01-09T02:40:00.580

[handle_incoming_email.py](https://github.com/dustingetz/foodlog/blob/master/logfood/handle_incoming_email.py)
[app.yaml](https://github.com/dustingetz/foodlog/blob/master/logfood/app.yaml)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T23:03:58.373

Update: It's now [supported](http://code.google.com/appengine/docs/python/mail/receivingmail.html).

Processing incoming email is not yet supported. It is however on their roadmap: [http://code.google.com/appengine/docs/roadmap.html](http://code.google.com/appengine/docs/roadmap.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-06T09:27:42.323

Google 目前不支持在 App Engine 中处理电子邮件，尽管它在路线图上。同时，像[smtp2web](http://www.smtp2web.com/)这样的服务会为你处理（免责声明：我写了 smtp2web）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-06T06:56:36.757

您可以设置一个电子邮件帐户并让外部服务器（您在 AE 之外创建和托管的服务器）通过 IMAP 访问 gmail 帐户。然后，您的“邮件服务器”会读取消息并访问您在 AE 上的应用程序的 /email API。

Python 有一个电子邮件模块，因此您可以在那里发布整个消息，或者如果这不起作用（由于任何限制），您可以在您的邮件服务器上对其进行预处理并将简化版本发布到您的应用程序。

不利的一面是您必须通过轮询来获取信息，但这应该没问题，因为接受电子邮件会有些延迟。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-06-05T16:45:20.250

[*作为 Gabriel答案*](https://stackoverflow.com/a/2659656/4058484)的另一个选择，我建议使用[`go`](https://cloud.google.com/appengine/docs/go/)环境[`App Engine`](http://appengine.google.com)on [*Sending and Receiving Mail with the Mail API*](https://cloud.google.com/appengine/docs/standard/go/mail/sending-receiving-with-mail-api)。

从文档：

**接收邮件**

您的应用可以通过以下形式的地址接收电子邮件：

```
anything@appid.appspotmail.com 
```

[*与此处*](https://stackoverflow.com/q/36462956/4058484)`python`讨论的处理传入邮件的配置相比，在应用程序文件中启用传入邮件相当简单：[](https://stackoverflow.com/q/36462956/4058484)*[`app.yaml`](https://cloud.google.com/appengine/docs/standard/go/config/appref)*

 *```
inbound_services:
- mail 
```

将您的应用程序文件命名为`mail.go`，然后将处理程序注册到路径并从使用中`/_ah/mail/`读取电子邮件的数据，如下所示：`*http.Requestlike`[`net/mail`](https://golang.org/pkg/net/mail/)

```
func incomingMail(w http.ResponseWriter, r *http.Request) {
        ctx := appengine.NewContext(r)
        defer r.Body.Close()
        var b bytes.Buffer
        if _, err := b.ReadFrom(r.Body); err != nil {
                log.Errorf(ctx, "Error reading body: %v", err)
                return
        }
        log.Infof(ctx, "Received mail: %v", b)
} 
```

**发送邮件**

按照此*[指南](https://cloud.google.com/appengine/docs/standard/go/mail/)*将您的发件人电子邮件注册为*[授权发件人](https://cloud.google.com/appengine/docs/standard/python/mail/#who_can_send_mail)*

使用`mail.Message`类型设置邮件的发件人、收件人、主题和正文。使用该功能
发送电子邮件。`mail.Send`

```
func confirm(w http.ResponseWriter, r *http.Request) {
    ctx := appengine.NewContext(r)
    addr := r.FormValue("email")
    url := createConfirmationURL(r)
    msg := &mail.Message{
        Sender:  "Example.com Support <support@example.com>",
        To:      []string{addr},
        Subject: "Confirm your registration",
        Body:    fmt.Sprintf(confirmMessage, url),
    }
    if err := mail.Send(ctx, msg); err != nil {
        log.Errorf(ctx, "Couldn't send email: %v", err)
    }
} 
```

**部署**

接收和发送的完整示例代码可在 GitHub 上找到：

> [GoogleCloudPlatform/golang-samples/docs/appengine/mail/mail.go](https://github.com/GoogleCloudPlatform/golang-samples/blob/master/docs/appengine/mail/mail.go)

要克隆示例代码，请转到您的[`Console`](https://console.cloud.google.com/appengine). 单击按钮打开[`Cloud Shell`](https://cloud.google.com/shell/docs/)： [![在此处输入图像描述](https://i.stack.imgur.com/LV1LH.png)](https://cloud.google.com/shell/docs/) 然后与[*此快速入门*](https://cloud.google.com/appengine/docs/flexible/go/quickstart#download_the_hello_world_app)类似，输入以下步骤：

```
$ SOURCEDIR=https://github.com/GoogleCloudPlatform/golang-samples.git
$ TUTORIALDIR=~/src/your-application-id/go_gae_samples
$ git clone $SOURCEDIR $TUTORIALDIR
$ cd $TUTORIALDIR
$ git checkout master
$ cat docs/appengine/mail/app.yaml
$ cat docs/appengine/mail/mail.go
$ goapp serve docs/appengine/mail/app.yaml 
```

从这里您可以使用[`Web preview`![网页预览](https://i.stack.imgur.com/o8lIm.png)](https://cloud.google.com/shell/docs/using-web-preview).
要终止`Ctrl+C`按`Cloud Shell`。
最后，您可以部署您的应用程序

```
goapp deploy -application your-application-id -version 0 
```

点击网址访问

```
http://your-application-id.appspot.com/ 
```

然后发送一封电子邮件，`anything@your-application-id.appspotmail.com`看看它是否有效。

# java - 如何测量使用 UDP 协议进行通信的服务器和客户端之间的响应时间？

> ID：616896
> 
> 赞同：2
> 
> 时间：2009-03-05T22:15:23.220
> 
> 标签：java, networking, udp, client-server

测试的目的是检查两个主机（客户端和服务器）之间的网络响应时间的形状。网络响应 = 发送数据包并接收回数据包所需的往返时间。我正在使用 UDP 协议。我如何计算响应时间？我可以减去 TimeOfClientRequest - TimeOfClientResponseRecieved。但我不确定这是否是最好的方法。我不能仅从代码内部执行此操作，并且我认为操作系统和计算机负载可能会干扰客户端启动的测量过程。顺便说一句，我正在使用Java。

我想听听你的想法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-12T13:19:06.507

只需使用 ping - RTT（往返时间）是它衡量的标准之一。如果您发送的数据包的大小很重要，那么 ping 还可以让您指定每个数据包中数据的大小。

例如，我刚刚向我的网关发送了 10 个数据包，每个数据包的有效负载为 1024 字节，仅显示摘要统计信息：

ping -c 10 -s 1024 -q 192.168.2.1

PING 192.168.2.1 (192.168.2.1) 1024(1052) 字节数据。

--- 192.168.2.1 ping 统计 ---

发送 10 个数据包，接收 10 个数据包，0% 丢包，时间 9004ms

rtt 最小值/平均值/最大值/mdev = 2.566/4.921/8.411/2.035 毫秒

以 rtt （往返时间）开头的最后一行是您可能正在寻找的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T22:18:09.123

我认为你提到的方法很好。操作系统和计算机负载可能会干扰，但与通过网络发送数据包所需的时间相比，它们的影响可能可以忽略不计。

为了使事情变得更均匀，您总是可以来回发送几个数据包并平均超时。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T11:36:55.367

如果您可以访问代码，那么可以，只需测量发送请求和收到答案之间的时间。请记住，Java 中的标准计时器只有毫秒分辨率。

或者，使用 Wireshark 捕获网络上的数据包 - 该软件还记录数据包的时间戳。

显然，在这两种情况下，测量的时间取决于另一端对您的原始请求的响应速度。

如果您真的只想测量*网络*延迟并自己控制远端，请使用`echo 7/udp`许多 UNIX 服务器仍然支持的服务（尽管它通常被禁用以防止其在反射 DDoS 攻击中的使用）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T00:50:37.400

如果您可以发送 ICMP 包会很好 - 我想，因为它们直接由网络层回答，您的回答不会在服务器上的用户模式下浪费时间。

然而，在 java 中发送 ICMP 包似乎是不可能的。你可以：

```
 boolean status = InetAddress.getByName(host).isReachable(timeOut) 
```

这将发送一个 ICMP 包，但这不是你想要的。

但是，如果您在具有更高优先级的服务器端启动响应程序守护程序，您将减少服务器负载的影响。

实际上，服务器负载不会起作用，只要它低于 100% CPU。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-13T21:15:10.100

首先使用 ping，但您可以通过发送数据包并让另一端发回数据包来测量 RTT。

测量盒子何时处于*典型*负载下很重要，因为这会告诉您通常可以获得的 RTT。

您可以对许多数据包、数百万甚至数十亿数据包的延迟进行平均，以获得一致的值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-12-18T07:18:02.337

除了提到使用 ICMP ping 测量 RTT 时间的几个答案是一个好方法。

如果您可以同时控制服务器和客户端，我想提供另一种通过 UDP 测量 RTT 的方法。基本流程如下：

1.  从客户端向服务器发送带有时间戳 C1 的 UDP 数据包 P1
2.  服务器在收到 P1 时将当前时间戳 S1 放入数据包。
3.  服务器端处理
4.  服务器将当前时间戳 S2 放入数据包，然后再将其发送回客户端。
5.  客户端在收到 P1 时将当前时间戳 C2 放入数据包。

之后，我们可以计算 RTT = (C2-C1) - (S2-S1)。

它可能不像 ICMP ping 那样准确，并且需要在客户端和服务器端进行额外控制，但它是可管理的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-01-13T13:51:20.740

虽然 ping 是测量延迟的良好开端，但它使用的是 ICMP 协议而不是 UDP。不同协议的数据包通常在路由器等上具有不同的优先级。

您可以使用 netperf 测量 UDP 往返时间： http: [//www.netperf.org/netperf/training/Netperf.html#0.2.2Z141Z1.SUJSTF.9R2DBD.T](http://www.netperf.org/netperf/training/Netperf.html#0.2.2Z141Z1.SUJSTF.9R2DBD.T)

# c# - 如何制作粉红噪声发生器？

> ID：616897
> 
> 赞同：32
> 
> 时间：2009-03-05T22:15:39.957
> 
> 标签：c#, .net, audio, noise

（（（已选择答案 - 请参阅下面的编辑 5。））

我需要用 C# 编写一个简单的粉红噪声生成器。问题是，我以前从未做过任何音频工作，所以我不知道如何与声卡等交互。我知道我想远离使用 DirectX，主要是因为我不想为这个小项目下载一个海量的 SDK。

所以我有两个问题：

1.  如何生成粉红噪声？
2.  如何将其流式传输到声卡？

**编辑**：我*真的*很想制作一个粉红噪声发生器......我知道还有其他方法可以解决根本问题。=)

**编辑 2**：我们的防火墙阻止流式音频和视频 - 否则我会按照评论中的建议访问[www.simplynoise.com 。](http://www.simplynoise.com):(

**编辑 3**：我已经降低了白噪声的产生，并将输出发送到声卡 - 现在我需要知道的是如何将白噪声变成粉红噪声。哦 - 我不想循环一个 wav 文件，因为我尝试用于循环的每个应用程序最终都会在循环之间出现一点点中断，这足以让我一开始就朝着这个方向前进...

**编辑4**：......我很惊讶有这么多人非常明确地*不*回答问题。如果我对为什么需要粉红噪声撒谎，我可能会得到更好的回应......这个问题更多的是关于如何生成数据并将数据流式传输到声卡，而不是关于我应该使用哪种耳机。为此，我已经编辑了背景细节 - 你可以在编辑中阅读它......

**编辑 5**：我在下面选择了 Paul 的答案，因为他提供的链接给了我将白噪声（很容易通过随机数生成器生成）转换为粉红噪声的公式。除此之外，我还使用[了 Ianier Munoz 的 CodeProject 条目“Programming Audio Effects in C#”](http://www.codeproject.com/KB/audio-video/cswavplayfx.aspx)来学习如何生成、修改和输出声音数据到声卡。谢谢你们的帮助。=)

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-05T22:33:41.927

也许您可以将此处的 C/C++ 代码转换为 C#：

[http://www.firstpr.com.au/dsp/pink-noise/](http://www.firstpr.com.au/dsp/pink-noise/)

将声音传送到声卡的最简单方法是生成一个 wav（吐出一些硬编码的标头，然后采样数据）。然后你就可以播放 .wav 文件了。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-05T22:31:23.150

粉红噪声只是通过 -3dB/倍频程 LPF 的白噪声。您可以使用 rand() （或任何生成均匀随机数的函数）生成白噪声。

只要您有 Google 方便，将内容流式传输到声卡就相当简单。如果您选择避免使用 DirectX，请考虑使用 PortAudio 或 ASIO 来连接声卡……尽管我认为您将不得不使用 C++ 或 C。

除此之外，为什么要浪费 CPU 时间来生成它？循环一个该死的 WAV 文件！

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-08-22T12:26:36.920

我意识到这一点有点晚了，但是任何遇到它的人都应该知道粉红噪声是-3dB / octave的白噪声，而不是如上所述的-6，实际上是棕色噪声。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2018-10-14T12:41:49.450

这是创建粉红噪声的一种非常简单的方法，它只是将大量以对数间隔分开的波加在一起！如果您想要实时创建声音，这对于您的目的可能太慢，但肯定可以进一步优化（例如：更快的余弦函数）。

这些函数输出一个值从 -1 到 1 的双精度数组。这分别表示波形中的最低点和最高点。

该`quality`参数表示为发出声音而产生的波数。我发现 5000 个波（每个半音大约 40 个间隔）大约是我无法检测到更高值的任何明显改进的阈值，但为了安全起见，您可以（可选）将其增加到大约 10,000 个波或更高. 此外，根据 Wikipedia 的说法，就我们能听到的声音而言，20 赫兹大约是人类感知的下限，但如果你愿意，你也可以改变它。

请注意，由于技术原因，声音会随着`quality`值的增加而变得更安静，因此您可能（可选）希望通过`volumeAdjust`参数调整音量。

```
public double[] createPinkNoise(double seconds, int quality=5000, double lowestFrequency=20, double highestFrequency = 20000, double volumeAdjust=1.0)
{
    long samples = (long)(44100 * seconds);
    double[] d = new double[samples];
    double[] offsets = new double[samples];
    double lowestWavelength = highestFrequency / lowestFrequency;
    Random r = new Random();
    for (int j = 0; j < quality; j++)
    {
        double wavelength = Math.Pow(lowestWavelength, (j * 1.0) / quality)  * 44100 / highestFrequency;
        double offset = r.NextDouble() * Math.PI*2;     // Important offset is needed, as otherwise all the waves will be almost in phase, and this will ruin the effect!
        for (long i = 0; i < samples; i++)
        {
            d[i] += Math.Cos(i * Math.PI * 2 / wavelength + offset) / quality * volumeAdjust;
        }
    }
    return d;
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-05T23:35:01.890

这是播放线程的示例。我正在使用 DirectSound 创建一个写入样本的 SecondaryBuffer。如您所见，它非常简单：

```
 /// <summary>
    /// Thread in charge of feeding the playback buffer.
    /// </summary>
    private void playbackThreadFn()
    {
        // Begin playing the sound buffer.
        m_playbackBuffer.Play( 0, BufferPlayFlags.Looping );

        // Change playing state.
        IsPlaying = true;

        // Playback loop.
        while( IsPlaying )
        {
            // Suspend thread until the playback cursor steps into a trap...
            m_trapEvent.WaitOne();

            // ...read audio from the input stream... (In this case from your pink noise buffer)
            Input.Collect( m_target, m_target.Length );

            // ...calculate the next writing position...
            var writePosition = m_traps[ ((1 & m_pullCounter++) != 0) ? 0 : 1 ].Offset;

            // ...and copy audio to the device buffer.
            m_playbackBuffer.Write( writePosition, m_deviceBuffer, LockFlag.None );
        }

        // Stop playback.
        m_playbackBuffer.Stop();
    } 
```

如果您需要有关其工作原理的更多详细信息，我将很乐意提供帮助。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-09-22T19:42:17.530

如果你在 Linux 上，你可以使用 SOX（你可能已经有了，试试这个`play`命令）。

`play -t sl - synth 3 pinknoise band -n 1200 200 tremolo .1 40 < /dev/zero`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T22:28:31.067

作为一种快速而肮脏的方法，在你的音频播放器中循环播放粉红噪声 wav 怎么样？（是的，我知道部分乐趣是自己动手做......）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-05T22:28:40.207

重复播放粉红噪声的 .mp3 样本怎么样？

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-03-05T22:31:45.503

你可以使用[Audacity](http://audacity.sourceforge.net/)来产生你想要的尽可能多的粉红噪声，然后重复它。

或者您可以深入研究源代码，看看 Audacity 如何生成粉红噪声。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-03-05T22:21:21.410

我不能谈论 C#，但你可能会更好地使用一些好的降噪耳机和你最喜欢的 mp3。

# c# - Process.StartInfo.FileName 是否接受长文件名？

> ID：616898
> 
> 赞同：3
> 
> 时间：2009-03-05T22:16:04.510
> 
> 标签：c#

好像不是。

如果我将文件名转换为其短值，则 Process.Start() 有效。

```
Process runScripts = new Process();
runScripts.StartInfo.FileName = @"C:\long file path\run.cmd";
runScripts.StartInfo.WindowStyle = ProcessWindowStyle.Hidden;
runScripts.StartInfo.UseShellExecute = true;
runScripts.StartInfo.RedirectStandardOutput = false;
runScripts.Start(); 
```

上面的代码失败了。但...

```
Process runScripts = new Process();
runScripts.StartInfo.FileName = @"C:\short\file\path\run.cmd";
runScripts.StartInfo.WindowStyle = ProcessWindowStyle.Hidden;
runScripts.StartInfo.UseShellExecute = true;
runScripts.StartInfo.RedirectStandardOutput = false;
runScripts.Start(); 
```

成功。

我设法通过将长路径名转换为短路径名来解决这个问题。但我有点惊讶地发现这一点。有任何原因或背景信息吗？

谢谢。

**更新 1**
Microsoft .NET Framework 版本 2.0.50727

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T17:07:04.257

很好奇，我有效地重现了该行为，它并没有像您所说的那样执行，但是修改它，它起作用了：

```
 System.Diagnostics.Process runScripts = new System.Diagnostics.Process();
    runScripts.StartInfo.FileName = @"run.cmd";
    // new
    runScripts.StartInfo.WorkingDirectory = @"C:\long file path";
    runScripts.StartInfo.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden;
    runScripts.StartInfo.UseShellExecute = true;
    runScripts.StartInfo.RedirectStandardOutput = false;
    runScripts.Start(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-20T16:58:19.100

我无法重现您描述的行为。以下代码适用于我。

```
string path = @"X:\Temp\long file path\run.cmd";
Process p = new Process();
p.StartInfo.FileName = path;

// Works with both true (default) and false.
p.StartInfo.UseShellExecute = true;
p.Start(); 
```

**编辑**

我可以使用以下代码重现

```
 string path = @"X:\Temp\long file path";
  string file = "run.cmd";

  Process p = new Process();
  p.StartInfo.FileName = file;
  p.StartInfo.WorkingDirectory = path;
  p.StartInfo.UseShellExecute = false; // only fails with false.
  p.Start();
  return; 
```

这显示（使用进程监视器） ConsoleApplication.vshost.exe 尝试在 project\bin\Release、System32、System、Windows、System32\Wbem 中查找 run.cmd，然后进一步查找一些（我猜）路径变量。但是，如果我设置 UseShellExecute = true，它会起作用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-22T13:30:46.990

为了重现您的问题，我使用了以下程序：

```
// file test.cs
using System;
using System.ComponentModel;
using System.Diagnostics;

public class Test
{
    public static int Main()
    {
        string error;
        try {
            ProcessStartInfo i = new ProcessStartInfo();
            i.FileName = @"C:\long file path\run.cmd";
            i.WindowStyle = ProcessWindowStyle.Hidden;
            i.UseShellExecute = true;
            i.RedirectStandardOutput = false;
            using (Process p = Process.Start(i)) {
                error = "No process object was returned from Process.Start";
                if (p != null) {
                    p.WaitForExit();
                    if (p.ExitCode == 0) {
                        Console.ForegroundColor = ConsoleColor.Green;
                        Console.WriteLine("OK");
                        Console.ResetColor();
                        return 0;
                    }
                    error = "Process exit code was " + p.ExitCode;
                }
            }
        }
        catch (Win32Exception ex) {
            error = "(Win32Exception) " + ex.Message;
        }
        Console.ForegroundColor = ConsoleColor.Red;
        Console.WriteLine("Whooops: " + error);
        Console.ResetColor();
        return 1;
    }
} 
```

该代码启动一个新进程（根据您的代码示例）并报告它可能无法执行的不同方式。您可以从命令行编译程序：

```
c:\windows\Microsoft.NET\Framework\v2.0.50727\csc test.cs 
```

（假设 test.cs 在当前目录中；它将在与 test.cs 相同的目录中创建 test.exe）

正如预期的那样，当“C:\long file path\run.cmd”不存在时，程序失败并显示：

```
Whooops: (Win32Exception) The system cannot find the file specified 
```

现在让我们创建一个目录“C:\long file path”并在其中放置一个非常简单的 run.cmd：

```
rem file run.cmd
echo I ran at %Time% > "%~dp0\run.out.txt" 
```

但是，此时我无法重现您的失败。一旦上面的run.cmd 就位，test.exe 运行成功（即run.cmd 执行正确——您可以通过查找新创建的文件“C:\long file path\run.out.txt”来验证这一点。

我在 Vista x64（我的主要开发机器）、Windows XP SP3 x86（虚拟机）、Windows Server 2008 x64（虚拟机）上运行了 test.exe，它可以在任何地方运行。

您能否尝试在您的环境中运行上述代码并报告它是否对您失败？这样，我们至少会建立相同的测试上下文（相同的 .NET 程序将尝试在相同的位置为您运行相同的批处理文件，就像对我一样）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-09-07T12:41:24.223

我设法通过使用以下行为实际运行它。

```
 private string StartProcessAndGetResult(string executableFile, string arguments)
    //NOTE executable file should be passed as string with a full path
    //For example: C:\Windows\Microsoft.NET\Framework\v3.0\Windows Communication Foundation\ServiceModelReg.exe
    //Without """ and @ signs
    {
        var result = String.Empty;
        var workingDirectory = Path.GetDirectoryName(executableFile);

        var processStartInfo = new ProcessStartInfo(executableFile, arguments)
                                   {
                                       WorkingDirectory = workingDirectory,
                                       UseShellExecute = false,
                                       ErrorDialog = false,
                                       CreateNoWindow = true,
                                       RedirectStandardOutput = true
                                   };
        var process = Process.Start(processStartInfo);
        if (process != null)
        {
            using (var streamReader = process.StandardOutput)
            {
                result = streamReader.ReadToEnd();
            }
        }
        return result;
    } 
```

在我的情况下，使用 @ 或将字符串加引号 (""") 的解决方案并不适用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-05T22:20:16.047

尝试

```
runScripts.StartInfo.FileName = @"""C:\long file path\run.cmd"""; 
```

虽然我确信它是由 Process 类自动为您完成的。你确定你提供了正确的路径吗？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-20T17:49:11.037

我有一个假设。Win32 有一个限制，即用于描述文件名的字符串不能长于 MAX_PATH（260 字节），包括终止 '\0'。

也许这个问题已经泄露到 C# 中了？

（我所做的测试表明了这一点，但我无法确认是哪些问题困扰着我。）

所以，试着在你的路径前加上“\\?\”。（反斜杠、反斜杠、问号、反斜杠）即

```
runScripts.StartInfo.FileName = @"\\?\C:\long file path\run.cmd"; 
```

有关 MAX_PATH 的更多详细信息：http: [//msdn.microsoft.com/en-us/library/aa365247.aspx](http://msdn.microsoft.com/en-us/library/aa365247.aspx)

/莱夫

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-21T09:17:53.690

## （更新）

我想我从 Process.Start 方法的逆向工程中发现了更多问题。我是正确的，**它没有设置 WorkingDirectory 就失败了。**

所以换句话说，CreateProcess 需要一个有效的工作目录，而不是 .NET（它应该真的从文件名中推断出来，但显然不是）

这是证明：

```
namespace SoTest
{
    class Program
    {
        [DllImport("kernel32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        public static extern bool CreateProcess([MarshalAs(UnmanagedType.LPTStr)] string lpApplicationName, StringBuilder lpCommandLine, SECURITY_ATTRIBUTES lpProcessAttributes, SECURITY_ATTRIBUTES lpThreadAttributes, bool bInheritHandles, int dwCreationFlags, IntPtr lpEnvironment, [MarshalAs(UnmanagedType.LPTStr)] string lpCurrentDirectory, STARTUPINFO lpStartupInfo, PROCESS_INFORMATION lpProcessInformation);

        static void Main(string[] args)
        {
            Process process = new Process();
            process.StartInfo.FileName = @"C:\my test folder\my test.bat";

            StringBuilder cmdLine = new StringBuilder();
            cmdLine.Append(process.StartInfo.FileName);
            STARTUPINFO lpStartupInfo = new STARTUPINFO();
            PROCESS_INFORMATION lpProcessInformation = new PROCESS_INFORMATION();

            // This fails
            //string workingDirectory = process.StartInfo.WorkingDirectory;
            string workingDirectory = @"C:\my test folder\";

            CreateProcess(null, cmdLine, null, null, true, 0, IntPtr.Zero, workingDirectory, lpStartupInfo, lpProcessInformation);
        }
    }

    [StructLayout(LayoutKind.Sequential)]
    internal class PROCESS_INFORMATION
    {
        public IntPtr hProcess;
        public IntPtr hThread;
        public int dwProcessId;
        public int dwThreadId;

        public PROCESS_INFORMATION()
        {
            this.hProcess = IntPtr.Zero;
            this.hThread = IntPtr.Zero;
        }
    }

    [StructLayout(LayoutKind.Sequential)]
    internal class SECURITY_ATTRIBUTES
    {
        public int nLength;
        public long lpSecurityDescriptor;
        public bool bInheritHandle;
    }

    [StructLayout(LayoutKind.Sequential)]
    internal class STARTUPINFO
    {
        public int cb;
        public IntPtr lpReserved;
        public IntPtr lpDesktop;
        public IntPtr lpTitle;
        public int dwX;
        public int dwY;
        public int dwXSize;
        public int dwYSize;
        public int dwXCountChars;
        public int dwYCountChars;
        public int dwFillAttribute;
        public int dwFlags;
        public short wShowWindow;
        public short cbReserved2;
        public IntPtr lpReserved2;
        public IntPtr hStdInput;
        public IntPtr hStdOutput;
        public IntPtr hStdError;

        public STARTUPINFO()
        {
            this.lpReserved = IntPtr.Zero;
            this.lpDesktop = IntPtr.Zero;
            this.lpTitle = IntPtr.Zero;
            this.lpReserved2 = IntPtr.Zero;
            this.hStdInput = IntPtr.Zero;
            this.hStdOutput = IntPtr.Zero;
            this.hStdError = IntPtr.Zero;
            this.cb = Marshal.SizeOf(this);
        }
    }       
} 
```

我已经从原始代码中删除了 SafeFileHandle，因为我们正在做的事情不需要它。也没有设置开始标志，但无窗口版本需要这些标志。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-05T22:21:13.500

试试这个：

```
Process runScripts = new Process();
runScripts.StartInfo.FileName = @"""C:\long file path\run.cmd""";
runScripts.StartInfo.WindowStyle = ProcessWindowStyle.Hidden;
runScripts.StartInfo.UseShellExecute = true;
runScripts.StartInfo.RedirectStandardOutput = false;
runScripts.Start(); 
```

即，当 FileName 有空格时，使用带引号的字符串作为 FileName。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-27T05:23:34.347

您的代码可能由于与长/短路径问题无关的各种原因而失败。您应该将确切的异常描述（包括调用堆栈）添加到您的问题中。

# php - 检查网站并决定 CSS 样式？

> ID：616902
> 
> 赞同：0
> 
> 时间：2009-03-05T22:16:47.520
> 
> 标签：php, if-statement

我的目标是在顶部有一个类似的酒吧：http: [//www.keltainenporssi.fi/](http://www.keltainenporssi.fi/) 当前站点的颜色为红色，而其他站点为黑色。

你将如何达到我的目标？也许通过php？

伪代码中的语法可能是

```
if $site = A
    use-styleA
if $site = B
    use-styleB
else
    use-FinalStyle 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T22:20:00.710

通常使用诸如 PHP 之类的服务器端脚本来做这样的事情。例如：

```
<?PHP

echo '<ul id="top-nav">';

foreach($page as $pageId => $text) {
    echo '<li';
    if($curPage == $pageId)
        echo ' class="active"';
    echo '>';
    echo '<a href="pages/' . htmlspecialchars($pageId) . '">';
    echo htmlspecialchars($text);
    echo '</a>';
    echo '</li>';
}

echo '</ul>';

?> 
```

这将产生如下输出：（ *格式化为可读性）*

```
<ul id="top-nav">
    <li><a href="pages/home">Home</a></li>
    <li class="active"><a href="pages/one">Page one</a></li>
    <li><a href="pages/two">Page two</a></li>
</ul> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T22:19:19.760

您可以为所有域都将获取的栏设置一个 CSS。确保在该 css 上添加 !important 规则，这样它的规则就不会被其他任何东西覆盖。否则，通过在 list/div 上添加一个 id 或您将用来实现它的任何内容来屏蔽“命名空间”中的栏。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T22:23:12.810

非动态方法：

您可以为每个站点使用 CSS 规则，如下所示：

```
/* site-one.css */
#top-nav li.site-one a {
    color: red;
}

/* site-two.css */
#top-nav li.site-two a {
    color: red;
}

/* site-three.css */
#top-nav li.site-three a {
    color: red;
} 
```

HTML：

```
<ul id="top-nav">
    <li class="page-one"><a href="pages/one">Page one</a></li>
    <li class="page-two"><a href="pages/two">Page two</a></li>
    <li class="page-three"><a href="pages/three">Page three</a></li>
</ul> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T22:21:51.673

是的，您可以根据当前站点分配锚元素的类。

# asp.net - IHTTPModule 在 ASP.NET 中在 HTTP 和 HTTPS 之间切换

> ID：616904
> 
> 赞同：2
> 
> 时间：2009-03-05T22:17:46.630
> 
> 标签：asp.net, ssl

我正在一个网站上工作，其中包含需要通过 SSL 保护的部分。

我已将站点配置为在始终使用 SSL 时运行良好，我在 IE7/IE8/FireFox/Safari/Chrome 中看到 SSL 挂锁

为了实现 SSL 切换，我创建了一个实现 IHTTPModule 并连接 HTTPApplication.PreRequestHandlerExecute 的类。

我通过一些自定义逻辑来确定我的请求是否应该使用 SSL，然后我重定向。我必须处理两种情况：

*   目前在 SSL 中，请求不需要 SSL
*   目前不在 SSL 中，但请求需要 SSL

我最终做了以下事情（其中 ctx 是 HttpContext.Current 而 pathAndQuery 是 ctx.Request.Url.PathAndQuery）

```
// SSL required and current connection is not SSL
if (requestRequiresSSL & !ctx.Request.IsSecureConnection)
   ctx.Response.Redirect("https://www.myurl.com" + pathAndQuery);
// SSL not required but current connection is SSL
if (!requestRequiresSSL & ctx.Request.IsSecureConnection)
   ctx.Response.Redirect("http://www.myurl.com" + pathAndQuery); 
```

现在来回切换工作正常。但是，当我进入 SSL 模式时，FireFox 和 IE8 会警告我我的请求没有完全加密。

看起来我的模块以某种方式使我的请求短路，不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T22:43:00.827

我怀疑，当您确定哪些资源需要加密，哪些不需要加密时，您不包括图像，或一些页眉和页脚，甚至 CSS 文件（如果您使用的话）。

由于您总是为此类内容丢弃 SSL，因此页面的一部分（主 html）可能需要 SSL，但在此页面上对图像的相应请求却不需要。

浏览器警告您，页面的某些部分未使用 SSL 传递。

我将检查请求是否针对 HTML，然后才在需要时删除 SSL。否则，保持原样（很可能图像等是用相对路径引用的，而不是完整的 url）。

即，如果您有：

```
<html>
<body>
   Some content...
   <img src="images/someimage.jpg">
</body>
</html> 
```

并且您使用 SSL 请求此页面，但您对*requestRequiresSSL*的评估未将图像视为安全资源，它将形成 http，而不是 https 请求，您将看到警告。

确保在请求资源并评估*requestRequiresSSL*时，检查引荐来源网址以及这是否是图像：

```
// SSL not required but current connection is SSL
if (!requestRequiresSSL && ctx.Request.IsSecureConnection && !isHtmlContent)
   ctx.Response.Redirect("http://www.myurl.com" + pathAndQuery); 
```

只需弄清楚如何确定 isHtmlContent（如果您不从数据库等提供图像，而是从磁盘位置提供图像），只需检查资源文件名（.aspx、.asmx、.ashx、.html 等） .

这样，如果连接是加密的，但资源本身不是 html，并且没有设置“加密”，你就不会放弃加密。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T00:04:47.200

我强烈建议使用这个（免费/开源）组件来做你正在尝试的事情：

> [http://www.codeproject.com/KB/web-security/WebPageSecurity_v2.aspx](http://www.codeproject.com/KB/web-security/WebPageSecurity_v2.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T23:28:53.010

.Net 不能正常处理的任何内容（例如常规 html 和大多数图形文件）都不会执行 httpmodule，因为它不经过 .net

您最好的选择是在 IIS 级别处理此问题。有关如何配置服务器的信息，请参阅以下内容。

[http://www.jameskovacs.com/blog/HowToAutoRedirectToASSLsecuredSiteInIIS.aspx](http://www.jameskovacs.com/blog/HowToAutoRedirectToASSLsecuredSiteInIIS.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-02T03:37:06.347

我强烈推荐你这个产品：

[http://www.e2xpert.com/web/Http-Https-Switch.aspx](http://www.e2xpert.com/web/Http-Https-Switch.aspx)

它专业且易于使用。自带强大的配置工具，一键为您完成整个配置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-02T03:41:19.227

只需在整个站点、所有页面和所有图像/脚本/样式表中使用 SSL。这让一切变得如此简单。IE 和 Firefox 将不再抱怨，您将不再有疯狂的模块试图猜测是否应该重定向任何给定的请求等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-05T21:38:36.223

对于普通用户来说，他们几乎不可能做出明智的决定，因为 Firefox 唯一模糊地告诉他们的是，“您正在查看的部分页面在通过 Internet 传输之前没有加密。” 这与“有问题”的引擎灯一样有用，实际上是在他们的信息传输后告诉他们。

此消息至少应附有一个列表，提供 URL、内容类型（图像、javascript、css）及其对用户的意义。顺便说一句，我在使用 GMail 时收到此消息。

在此之前，正如其他人所说，一旦您确定了不安全的元素，您的代码应该可以工作。然后，您可以使用 Firebug (http://getfirebug.com) 检查通过连接传递的内容。

# c - 编译 K&R 示例时出现问题

> ID：616906
> 
> 赞同：5
> 
> 时间：2009-03-05T22:18:22.243
> 
> 标签：c

我在编译本书第 5.11 节中介绍的示例程序时遇到了麻烦。我已经删除了大部分代码，只留下了相关的东西。

```
#define MAXLINES 5000
char *lineptr[MAXLINES];

void qsort1(void *lineptr[], int left, int right, int (*comp)(void *, void *));
int numcmp(char *, char *);

main(int argc, char *argv[]) {
    int numeric = 1;
    /* ... */
    qsort1((void**) lineptr, 0, 100, (int (*)(void*, void*))(numeric ? numcmp : strcmp));
}

void qsort1(void *v[], int left, int right, int (*comp)(void *, void *)) {
    /* ... */
}

int numcmp(char *s1, char *s2) {
    /* ... */
} 
```

问题是代码无法编译（我使用的是 Digital Mars 编译器）。我得到的错误是这样的：

```
 qsort1((void**) lineptr, 0, nlines - 1, (int (*)(void*, void*))(numeric
? numcmp : strcmp));

                 ^
go.c(19) : Error: need explicit cast to convert
from: int (*C func)(char const *,char const *)
to  : int (*C func)(char *,char *)
--- errorlevel 1 
```

尽管我正确粘贴了书中的代码，但声明一定有问题。我没有足够的知识来做出正确的改变（关于函数指针的部分当然可以写得更广泛）。

编辑：我应该提到我正在阅读本书的 ANSI 版本。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-05T22:27:04.517

我认为错误来自于旧 C 还不知道 const 的事实：我认为 strcmp 有两个指向非 const 字符（`char *`）的指针（这可能是它当时编译的原因，但不是用你的编译器编译的）。但是，现在 strcmp 需要`char const*`(`const char*`是同一件事)。将您的函数原型更改为：

```
int numcmp(char const*, char const*); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T22:26:08.340

预期的标准函数指针`qsort()`或`bsearch()`具有原型：

```
int comparator(const void *v1, const void *v2); 
```

代码中`qsort1()`定义的期望：

```
int comparator(void *v1, void *v2); 
```

代码中定义的比较器函数没有那个原型，不同函数指针类型之间也没有自动转换。

因此，修复`qsort1()`是：

1.  引入演员表：`(int (*)(void *, void *))`，或
2.  重写比较器：

    ```
    int numcmp(void *v1, void *v2)
    {
        char *s1 = v1;
        char *s2 = v2;
        ...
    }

    int str_cmp(void *v1, void *v2)  // Note new function name!
    {
        return(strcmp(v1, v2));
    } 
    ```

显然，调用`qsort1()`将引用`str_cmp`而不是`strcmp`. 作者试图避免中间函数，但与当今使用的（合法的）更复杂的编译器相冲突。

的标准版本`qsort()`需要一堆`const`限定符，就像这个答案的第一个版本一样。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T22:26:33.067

这是一个常见的问题:)

以下行告诉`qsort`我们期望一个指向具有两个 void* 参数的函数的指针。不幸的是，`strcmp`需要两个不可修改的字符串，因此它的签名是

```
int (*comp)(const char*, const char*) 
```

而不是你所拥有的：

```
int (*comp)(void *, void *) 
```

更改 和 的`qsort1`签名`numeric`：

```
qsort1(void *v[], int left, int right, int (*comp)(const void *, const void *)) 
```

和：

```
int numcmp(const char*, const char*) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-05T22:29:03.263

请注意，它`strcmp`需要两个**const**参数，而您的`numcmp`则不需要。因此，两个函数的类型不匹配，`? :`操作者会抱怨。

执行以下操作之一：

1.  在 constness 方面进行更改`numcmp`以匹配`strcmp`原型
2.  `(int (*)(void*, void*))`将铸件推入其中`? :`，例如

    ```
    numeric ? (int (*)(void*, void*))numcmp : (int (*)(void*, void*))strcmp 
    ```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T22:23:44.307

自从我完成任何纯 C 编程以来已经有一段时间了，我不确定新标准。

但是，强制转换为 void ** 会创建一个指向指针的指针，其中函数需要指向数组的指针。当然，它们在内部是相同的，但是强类型检查会将其视为错误。

重写 qsort 以接受 ** 而不是 *[] ，你应该没问题。

# asp.net - IIS虚拟目录，根路径部署ASP.NET

> ID：616907
> 
> 赞同：0
> 
> 时间：2009-03-05T22:18:36.470
> 
> 标签：asp.net, iis, cassini

我需要一些关于如何制作项目结构以便从 VSS 迁移到 SVN 的指示，因为它现在具有：

> 开发主干--------------------------------> [http://localhost/myapp](http://localhost/myapp)
> 
> 测试环境分支 ----------> [http://test.myapp.com](http://test.myapp.com)
> 
> 生产环境分支--> [http://www.myapp.com](http://www.myapp.com)

这里的交易是路径，因为您看到每个环境的根因使用 IIS 6 本地站点（主干）而发生变化，并且更多，我们使用的是绝对路径，这是由于路径而导致分支之间的不一致合并，甚至当我做了很多更改并在服务器控件中使用 ~/ 时得到 <% Virtualpath("~/") & /js/test.js %> 或 runat="server" enableviewstate="false"一些客户端控件，但一般来说，这种方法对环境不透明并且容易出错，并且破坏了一些javascript路径（仍然没有解决）。

我知道 VS 中包含的 Web 开发服务器，但我也注意到我们可能会遇到使用中的功能问题，例如身份验证、上下文安全、虚拟文件夹。

所有这些都使用本地 IIS 6，VS2005，您能否分享一些您如何处理此问题的经验？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-09T20:01:44.830

您可能应该只在源代码控制中维护您的 DEV 分支，使用项目部署来移动网站进行测试，然后通过代码将其推广到生产中。

这样你就可以确定：

1.  代码在源代码控制中
2.  代码已经过测试
3.  不能直接更改生产。

良好地使用源代码控制分支/标签（在 VSS 或 SVN 或其他中）可以让您的开发人员查看、调试和修改测试或产品代码，但代码应该遵循结构化路径通过您的测试通道，并且只升级到生产使用定义的代码提升过程。

# task - Scrum 板/任务板和颜色编码

> ID：616911
> 
> 赞同：2
> 
> 时间：2009-03-05T22:19:59.540
> 
> 标签：task, agile, scrum, user-stories, scrumboard

就故事板上使用的良好颜色编码而言，您会推荐什么？

根据您的经验，这是一个好的模式吗？
[http://maxheapsize.com/static/ScrumBoardCheatSheet.pdf](http://maxheapsize.com/static/ScrumBoardCheatSheet.pdf)
最标准的颜色编码是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-07T21:50:40.950

我建议白色用于正常的积压项目，即具有业务价值的项目，红色用于错误修复。这使错误脱颖而出并帮助团队改进。

从简单开始 - 尽可能简单 - 并按照 Scrum 团队在 sprint 回顾中提出的建议进行创新。一次只有一项创新；尝试足够长的时间，看看它的实际效果如何；如果它们不是真正必要的，请丢弃它们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-10T16:03:08.453

不要做任何花哨的事情。使用常识。我没有使用颜色代码，因为我认为它们没有多大帮助——它们甚至使其他利益相关者更难理解任务板。这导致透明度降低。否则我同意莫伦迪尔。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-11-28T20:37:38.953

对于待办事项，我使用大型便利贴（4x4）：用户故事（蓝色/绿色）、缺陷（红色）、异常（黄色）、调查（紫色）。

对于任务，我们使用常规大小的便利贴 (3x3)：开发任务（黄色：因为它们最容易获得，而且大部分板上都是开发任务）、QA（绿色）、设计（蓝色）、错误（粉红色)，ScrumMaster/障碍（橙色）。

我们用浅色/柔和的便利贴开始冲刺，在冲刺计划之后添加的任何东西都是在相同颜色的霓虹灯上完成的。所以淡黄色与霓虹黄色，等等。这样，如果我们没有做好细分，或者在冲刺开始时有大量未知数，我们就可以看到添加的内容以真正突出显示。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-11T12:54:28.070

当涉及到卡片颜色和故障时，我已经看到了光谱。一些团队使用一种卡片颜色，因为任务就是任务就是任务，无论涉及什么工作。其他团队对每种类型的任务都有颜色，我有点喜欢它，因为它可以很好地查看剩下的工作类型，而无需阅读每张卡片。

故事卡：蓝色 技术债务：绿色 错误：黄色 分析：红色 QA（不是故事 QA，而是 QA 在正常 QA 之外所做的任务）：白色

当我们有一个庞大的团队和一些非开发人员围坐在桌子旁时，这很有帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-11-24T10:48:26.740

我同意**你使用的颜色越多，你就越失明**。我更喜欢突出缺陷、故事和史诗。在 sprint backlog 中只有两种颜色——橙色代表缺陷，黄色代表故事。[例如， ScrumDesk](http://www.scrumdesk.com)允许为故事模板中的卡片分配颜色，这有助于保持 backlog 正确着色。

如果 backlog 描述了更多的产品（program backlog），这些颜色非常有用。在这种情况下，颜色可能会根据产品突出史诗。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-06T05:12:46.180

它看起来很合我的口味。几年前我学习 Scrum 时，唯一的颜色代码是白色和红色。红色故事是整合故事。如果产品积压中的太多产品彼此靠近 - 你就有麻烦了。无论如何，我在第一个 sprint 中就放弃了使用技术含量低的电路板，因为我有远程团队成员，所以我们使用了一些电子格式 - Excel、TWiki、VersionOne、Rally。

# php - PHP 配置 --bindir

> ID：616918
> 
> 赞同：4
> 
> 时间：2009-03-05T22:21:09.477
> 
> 标签：php

使用下面的configure flags时，报如下错误，这是为什么呢？显然该目录存在。这是在 64 位 CentOS 5.2 操作系统上安装的 PHP 5.2.9。

./phpconfig.scr：第 11 行：--bindir=/usr/bin：没有这样的文件或目录

'
./configure'\'--host=x86_64-redhat-linux-gnu'\'--build=x86_64-redhat-linux-gnu'\'--target=x86_64-redhat-linux'\'--program
_
_
_
-prefix='\ ' --prefix=/usr'\'--exec
-prefix=/usr'\
'--bindir=/usr/bin'\
'--sbindir=/usr/sbin'\
'-- sysconfdir=/etc'\
'--datadir=/usr/share'\
'--includedir=/usr/include'\
'--libdir=/usr/lib64'\
'--libexecdir=/usr/libexec'\
'--localstatedir=/var'\
'--sharedstatedir=/usr/com'\
'--mandir=/usr/share/man'\
'--infodir=/usr/share/info'\
'--cache -文件=../配置。缓存'\
'--with-libdir=lib64'\
'--with-config-file-path=/etc'\
'--with-config-file-scan-dir=/etc/php.d'\
'--disable-debug'\
'​​--with-pic'\
'--disable-rpath'\
'--without- pear'\
'--with-bz2'\
'--with-curl'\
'--with-exec-dir=/usr/bin'\
'--with-freetype-dir=/usr'\
'-- with-png-dir=/usr'\
'--enable-gd-native-ttf'\
'--without-gdbm'\
'--with-gettext'\
'--with-gmp'\
'--with -iconv'\
'--with-jpeg-dir=/usr'\
'--with-openssl'\
'--with-png'\
'--with-pspell'\
'--with-expat-dir= /usr'\
'--with-pcre-regex=/usr'\
'--with-zlib'\
'--with-layout=GNU'\
'--enable-exif'\
'--enable-ftp'\
'--enable-magic-quotes'\ '--enable
-sockets'\
'--enable-sysvsem'\
'--enable-sysvshm'\'--enable-sysvmsg'\
'--enable
-track-vars '\
'--enable-trans-sid'\
'--enable-yp'\
'--enable-wddx'\
'--with-kerberos'\
'--enable-ucd-snmp-hack'\
'- -with-unixODBC=shared,/usr'\
'--enable-memory-limit'\
'--enable-shmop'\
'--enable-calendar'\
'--enable-dbx'\
' --enable- dio'\
'--without-mime-magic'\
'--without-sqlite'\
'--with-libxml-dir=/usr'\
'--with-xml'\
'--with-apxs2=/usr/sbin/apxs'\
'--without-mysql'\
'--without-gd'\
'--without-odbc'\
'--disable-dom'\
'--disable-dba'\
'--without-unixODBC'\
'--disable-pdo'\
'--disable-xmlreader'\
'- -disable-xmlwriter'\
'--disable-json'

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-06T23:00:08.657

感谢您的回复。事实证明，问题出在用于实际调用 ./configure 的脚本上。在脚本本身内，bindir 配置标志上方有一个额外的空间。所以...

'--exec-prefix=/usr' \_<-下划线表示的多余空格。
'--bindir=/usr/bin' \

所以转义字符是转义一个空格而不是返回。

错误。

希望这将帮助其他人避免浪费一个下午试图挖掘比显而易见的更深的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T22:41:04.110

我不确定您为什么会收到错误消息，但我相信 --host、--target、--build 等参数是由配置过程推断出来的，因此不需要设置。如果您让配置过程收集此类信息，它可能会正确构建。尝试删除默认设置或不需要明确更改的所有选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T17:54:17.160

您是否使用正确的权限进行安装？尝试使用 sudo。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-06T20:14:05.140

运行 configure 命令的完整输出会很有用。运行 configure 命令不需要任何权限，除了包含您的 php 源的目录。您只需要 root 即可运行“make install”。您是否已验证您拥有该目录中的所有文件。你可以试试跑步

“sudo chown -R [youruser]:[yourgroup] 。”

即使使用无效的 bindir 运行 configure 命令对我来说也可以完成。我使用 php 5.2.9 进行了测试，但我运行的是 32 位操作系统。

# java - java - 如何检查按下的键是否是Java KeyListener中的箭头键？

> ID：616924
> 
> 赞同：34
> 
> 时间：2009-03-05T22:22:02.343
> 
> 标签：java, events

你能帮我重构这段代码吗：

```
public void keyPressed(KeyEvent e)
    {

    if (e.getKeyCode()==39)
    {
                //Right arrow key code
    }

    else if (e.getKeyCode()==37)
    {
                //Left arrow key code
    }

    repaint();

} 
```

请提及如何检查向上/向下箭头键。谢谢！

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2009-03-05T22:41:41.330

```
public void keyPressed(KeyEvent e) {
    int keyCode = e.getKeyCode();
    switch( keyCode ) { 
        case KeyEvent.VK_UP:
            // handle up 
            break;
        case KeyEvent.VK_DOWN:
            // handle down 
            break;
        case KeyEvent.VK_LEFT:
            // handle left
            break;
        case KeyEvent.VK_RIGHT :
            // handle right
            break;
     }
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-05T22:37:23.947

```
public void keyPressed(KeyEvent e) {
    if (e.getKeyCode() == KeyEvent.VK_RIGHT ) {
            //Right arrow key code
    } else if (e.getKeyCode() == KeyEvent.VK_LEFT ) {
            //Left arrow key code
    } else if (e.getKeyCode() == KeyEvent.VK_UP ) {
            //Up arrow key code
    } else if (e.getKeyCode() == KeyEvent.VK_DOWN ) {
            //Down arrow key code
    }

    repaint();
} 
```

KeyEvent 代码都是 API 的一部分：http: [//docs.oracle.com/javase/7/docs/api/java/awt/event/KeyEvent.html](http://docs.oracle.com/javase/7/docs/api/java/awt/event/KeyEvent.html)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-05T22:40:38.273

只是为了完成答案（使用 KeyEvent 是要走的路），但向上箭头是 38，向下箭头是 40，所以：

```
 else if (e.getKeyCode()==38)
    {
            //Up arrow key code
    }
    else if (e.getKeyCode()==40)
    {
            //down arrow key code
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T22:24:25.630

如果您的意思是要将其附加到您的面板（您正在使用的窗口）。

然后你必须创建一个从 IKeyListener 接口扩展的内部类，然后将该方法添加到类中。

然后，通过以下方式将该类附加到您的面板： this.addKeyListener(new subclass());

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T22:26:30.697

您应该使用以下内容： KeyEvent.VK_UP 而不是实际代码。

你想如何重构它？重构的目标是什么？

# syntax - F# 语法糖

> ID：616934
> 
> 赞同：4
> 
> 时间：2009-03-05T22:24:46.020
> 
> 标签：syntax, f#

F# 显然包含很多语法糖，当我尝试学习它时——没有书的帮助——我被各种各样的语法所淹没。在所有语法糖的背后是否隐藏着一种更简单的“核心”语言？是否有语法糖的备忘单列表以及它们如何映射到核心语言？

嘿，F# 需要一个不同于 lambdas 的函数定义的“赋值”运算符，或者这是一个随机决定，有什么原因吗？例如“让公司 x = x+1”与“有趣的 x -> x+1”

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T22:34:07.447

A great deal of F# syntax comes from OCaml - many OCaml programs will compile and run in F# with no changes.

Good starter links:

[http://msdn.microsoft.com/en-us/fsharp/default.aspx](http://msdn.microsoft.com/en-us/fsharp/default.aspx)

[http://en.wikibooks.org/wiki/F_Sharp_Programming](http://en.wikibooks.org/wiki/F_Sharp_Programming)

[http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!887.entry?_c=BlogPart](http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!887.entry?_c=BlogPart)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-14T15:01:10.470

除了 Brian 的链接，我还想传递指向我自己的博客系列的链接，[为什么我爱 F#](http://diditwith.net/CategoryView,category,Why%2BI%2BLove%2BF%23.aspx)，它涵盖了一些基础知识。

关于你的第二个问题，“let inc x = x+1”与“fun x -> x+1”是表达函数的两种方式，但只有第一种使用赋值运算符。实际上，

```
let inc x = x + 1 
```

相当于：

```
let inc = (fun x -> x + 1) 
```

第一个是第二个的简写，但第二个可能说明 F# 中的所有函数实际上是如何绑定到名称的 lambda。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-06T16:37:54.270

F#，除了 .NET 互操作之外，似乎比 C# 简单得多。（并没有特别挑剔它，但因为它是另一种流行的 .NET 语言......）

以 F# 函数为例：

*   没有神奇的“空”类型——那不是真正的类型
    *   因此，一切都是一种表达
*   所有功能都是一元的
*   函数是一流的类型

就在那里，你有一个比 C# 简单得多的函数系统，其中 void 创建了一个特殊情况，并且不可能对所有函数进行泛化。

至于您的具体问题，“let fx = x”与“let f = fun x -> x”，这可能是 ML 的继承特征。（我看不出它不能是“let f = fun x = x”的任何特殊原因，只是它可能会更令人困惑并且可能会使语法更复杂？。（我个人更喜欢“ let f = \xx".)) 无论如何，虽然在大多数情况下它们是等价的，但有时您必须定义一个语法函数而不是函数值。

不幸的是，.NET 互操作会使事情变得更复杂一些，尽管可能不会比其他 .NET 语言更多或更多。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T22:32:44.783

Only one of the two expressions you mentioned uses an assignment operator.

This defines a function bound to the identifier "inc" which takes a single argument of type int and returns the argument +1\.

```
let inc x = x + 1; 
```

This on the other hand, is an expression which represents a lambda. It is bound to no identifier cannot exist solely by itself. It must be part of a larger expression.

```
fun x -> x + 1 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-31T14:12:36.047

如果您正在寻找 F# 的备忘单，这是我经常使用的备忘单。

[fsharpheatsheet.pdf](http://www.scribd.com/doc/37687368/fsharpcheatsheet)

它没有涵盖所有内容，例如度量单位或引用，也没有讨论各种库，但它确实涵盖了很多语法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-04-22T16:01:01.357

[http://www.samskivert.com/code/fsharp/fsharp-cheat-sheet.pdf](http://www.samskivert.com/code/fsharp/fsharp-cheat-sheet.pdf)

这是一个非常全面的备忘单，对我学习 F# 有很大帮助

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-15T21:51:30.053

请注意，您可以直接在表达式中应用 lambda。

```
let i = (fun x -> x + 1)0  //i equal 1 
```

# c++ - 如何在 Excel 2007 中获取最后一个活动单元格

> ID：616936
> 
> 赞同：2
> 
> 时间：2009-03-05T22:25:05.270
> 
> 标签：c++, excel-2007

我正在使用 C++ 非托管和 Excel 2007。我正在使用对 Excel4 API 的调用来获取用户选择的单元格范围。

当用户选择我所谓的“通用”范围时，此调用会返回类似“R1C1:R4C3”的范围，这正是我在应用程序中执行其他操作所需的格式。

但是，当用户决定选择整个列时，此 API 调用仅返回一个包含列的范围，例如“C1:C3”，这当然是一个有效的 excel 范围，但这对我来说意味着我必须修改它所以它看起来像上面的范围；换句话说，我必须手动将其添加到行范围。

所以我把这个范围“C1C3”改为“R1C1:R65534C3”。

也许此时您已经注意到我的问题，正如您所看到的，我将行范围硬编码为 Excel 2003 支持的最大行数（该应用程序也适用于该版本的 excel）。

这当然不是我要找的，因为一旦我得到选定的范围，我就会读取该范围内的信息并使用该信息向服务器进行查询，所以想象用户只输入数据直到第 534 行仍然我的查询将有 65000 行没有任何内容。

所以我的问题是如何获得用户输入数据的最后一个单元格，我认为它被称为最后一个活动单元格，所以我可以将我的范围划定到该行，请记住我正在使用非托管代码。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-11T04:33:33.423

Excel 4 API？真的吗？

有一个命令 xlcSelectEnd 您可以使用它从给定单元格以任意方向跳转到最后一个单元格中输入的文本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T02:59:48.390

尝试将 range.selection 转换为 Range 对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T09:43:19.757

# 区域获取最后使用的行

```
 Excel.ApplicationClass app = new Excel.ApplicationClass();
        Excel.Workbook workBook = app.Workbooks.Open(_PathFile,
                 System.Reflection.Missing.Value,
                 System.Reflection.Missing.Value,
                 System.Reflection.Missing.Value,
                 System.Reflection.Missing.Value,
                 System.Reflection.Missing.Value,
                 System.Reflection.Missing.Value,
                 System.Reflection.Missing.Value,
                 System.Reflection.Missing.Value,
                 System.Reflection.Missing.Value,
                 System.Reflection.Missing.Value,
                 System.Reflection.Missing.Value,
                 System.Reflection.Missing.Value,
                 System.Reflection.Missing.Value,
                 System.Reflection.Missing.Value);
        // Get the active worksheet using sheet name or active sheet
        Excel.Worksheet workSheet = (Excel.Worksheet)workBook.ActiveSheet;
        // Find the last real row
        int _InLastRow = workSheet.Cells.Find("*",System.Reflection.Missing.Value,
            System.Reflection.Missing.Value, System.Reflection.Missing.Value, Excel.XlSearchOrder.xlByRows,Excel.XlSearchDirection.xlPrevious, false,System.Reflection.Missing.Value,System.Reflection.Missing.Value).Row;
#endregion 
```

# c# - 记录文件访问时间

> ID：616942
> 
> 赞同：0
> 
> 时间：2009-03-05T22:26:18.217
> 
> 标签：c#, sql, ms-access, file

因此，我们有一些（或更多，没人知道）由现在离开的人编写的应用程序，这些应用程序访问存储在这台开发人员旧 PC 上的 Microsoft Access 数据库，而这些数据库又从我们的生产 SQL 数据库中读取。现在要跟踪所有这些程序，以及它们的运行时间，我想记录文件访问时间，这可能吗？显然，如果我阅读访问时间，我会修改它。我们不能依赖修改时间，因为某些 Access 数据库只是链接到 SQL 数据库的表。

更喜欢在 C# 中执行此操作，但这没关系。只需要跟踪运行的内容，一旦我找到它们，就可以对其进行修改。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T00:07:48.113

[http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)

```
public class Watcher 
```

{

```
public static void Main()
{
Run();

}

[PermissionSet(SecurityAction.Demand, Name="FullTrust")]
public static void Run()
{
    string[] args = System.Environment.GetCommandLineArgs();

    // If a directory is not specified, exit program.
    if(args.Length != 2)
    {
        // Display the proper way to call the program.
        Console.WriteLine("Usage: Watcher.exe (directory)");
        return;
    }

    // Create a new FileSystemWatcher and set its properties.
    FileSystemWatcher watcher = new FileSystemWatcher();
    watcher.Path = args[1];
    /* Watch for changes in LastAccess and LastWrite times, and
       the renaming of files or directories. */
    watcher.NotifyFilter = NotifyFilters.LastAccess | NotifyFilters.LastWrite
       | NotifyFilters.FileName | NotifyFilters.DirectoryName;
    // Only watch text files.
    watcher.Filter = "*.txt";

    // Add event handlers.
    watcher.Changed += new FileSystemEventHandler(OnChanged);
    watcher.Created += new FileSystemEventHandler(OnChanged);
    watcher.Deleted += new FileSystemEventHandler(OnChanged);
    watcher.Renamed += new RenamedEventHandler(OnRenamed);

    // Begin watching.
    watcher.EnableRaisingEvents = true;

    // Wait for the user to quit the program.
    Console.WriteLine("Press \'q\' to quit the sample.");
    while(Console.Read()!='q');
}

// Define the event handlers.
private static void OnChanged(object source, FileSystemEventArgs e)
{
    // Specify what is done when a file is changed, created, or deleted.
   Console.WriteLine("File: " +  e.FullPath + " " + e.ChangeType);
}

private static void OnRenamed(object source, RenamedEventArgs e)
{
    // Specify what is done when a file is renamed.
    Console.WriteLine("File: {0} renamed to {1}", e.OldFullPath, e.FullPath);
} 
```

}

# wpf - 如何从 HierarchicalDataTemplate 项中获取 TreeViewItem？

> ID：616948
> 
> 赞同：36
> 
> 时间：2009-03-05T22:27:29.273
> 
> 标签：wpf, treeview, hierarchicaldatatemplate

我有一个`TreeView`使用 a`HierarchicalDataTemplate`来绑定它的数据。

它看起来像这样：

```
<TreeView x:Name="mainTreeList" ItemsSource="{Binding MyCollection}>
  <TreeView.Resources>
    <HierarchicalDataTemplate 
     DataType="{x:Type local:MyTreeViewItemViewModel}" 
     ItemsSource="{Binding Children}">
      <!-- code code code -->
    </HierarchicalDataTemplate>
  </TreeView.Resources>
</TreeView> 
```

现在，从主窗口的代码隐藏中，我想获取当前 selected `TreeViewItem`。但是，如果我使用：

```
this.mainTreeList.SelectedItem; 
```

selectedItem 的类型为`MyTreeViewItemViewModel`。但我想得到 'parent' 或 'bound' `TreeViewItem`。我没有将它传递给我的`TreeViewItemModel`对象（甚至不知道如何）。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2010-07-05T04:59:02.210

```
TreeViewItem item = (TreeViewItem)(mainTreeList
    .ItemContainerGenerator
    .ContainerFromIndex(mainTreeList.Items.CurrentPosition)); 
```

**不工作**（对我来说）因为 mainTreeList.Items.CurrentPosition 在使用 HierarchicalDataTemplate 的树视图中将始终为-1。

**使用 HierarchicalDataTemplate 的树视图中的mainTreeList.Items.CurrentItem**以下都不会始终为空。

```
TreeViewItem item = (TreeViewItem)mainTreeList
    .ItemContainerGenerator
    .ContainerFromItem(mainTreeList.Items.CurrentItem); 
```

**相反**，我必须在路由的 TreeViewItem.Selected 事件中设置一个最后选择的 TreeViewItem，该事件会冒泡到树视图（TreeViewItem 本身在设计时不存在，因为我们使用的是 HierarchicalDataTemplate）。

可以在 XAML 中捕获该事件，如下所示：

```
<TreeView TreeViewItem.Selected="TreeViewItemSelected" .../> 
```

然后可以在事件中设置最后选择的 TreeViewItem：

```
 private void TreeViewItemSelected(object sender, RoutedEventArgs e)
    {
        TreeViewItem tvi = e.OriginalSource as TreeViewItem;

        // set the last tree view item selected variable which may be used elsewhere as there is no other way I have found to obtain the TreeViewItem container (may be null)
        this.lastSelectedTreeViewItem = tvi;

        ...
     } 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-06T03:03:08.020

从[Bea Stollnitz](http://bea.stollnitz.com/blog/?p=7)的博客文章中，尝试

```
TreeViewItem item = (TreeViewItem)(mainTreeList
    .ItemContainerGenerator
    .ContainerFromIndex(mainTreeList.Items.CurrentPosition)); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-09-21T17:20:45.803

我遇到了同样的问题。我需要到达 TreeViewItem 以便我可以选择它。然后我意识到我可以将一个属性 IsSelected 添加到我的 ViewModel，然后我将其绑定到 TreeViewItems IsSelectedProperty。这可以通过 ItemContainerStyle 来实现：

```
<TreeView>
            <TreeView.ItemContainerStyle>
                <Style TargetType="{x:Type TreeViewItem}">
                    <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                    <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                </Style>
            </TreeView.ItemContainerStyle>
</TreeView> 
```

现在，如果我想在树视图中选择一个项目，我只需直接在我的 ViewModel 类上调用 IsSelected 。

希望它可以帮助某人。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-01-09T10:39:21.077

```
TreeViewItem item = (TreeViewItem)(mainTreeList
    .ItemContainerGenerator
    .ContainerFromIndex(mainTreeList.Items.CurrentPosition)); gives first item in the TreeView because CurrentPosition is always 0. 
```

怎么样

```
TreeViewItem item = (TreeViewItem)(mainTreeList
    .ItemContainerGenerator
    .ContainerFromItem(mainTreeList.SelectedItem))); 
```

这对我来说效果更好。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-03-26T13:33:13.073

受 Fëanor 的回答的启发，我试图让创建`TreeViewItem`a 的每个数据项都易于访问`TreeViewItem`。

这个想法是向`TreeViewItem`视图模型添加一个 -typed 字段，也通过接口公开，并在创建容器`TreeView`时自动填充它。`TreeViewItem`

这是通过子类`TreeView`化并将一个事件附加到 来完成的`ItemContainerGenerator`，该事件记录了`TreeViewItem`它的创建时间。陷阱包括`TreeViewItem`s 是懒惰地创建的，因此在某些时候可能真的没有可用的。

自从发布这个答案以来，我已经进一步开发并在一个项目中使用了很长时间。到目前为止没有任何问题，除了这违反了 MVVM （但也为您节省了大量简单案例的样板文件）。来源[在这里](https://bitbucket.org/rstarkov/wpfcrutches/src/tip/TreeViewWithItem.cs)。

**用法**

选择所选项目的父项并将其折叠，确保它在视图中：

```
...
var selected = myTreeView.SelectedItem as MyItem;
selected.Parent.TreeViewItem.IsSelected = true;
selected.Parent.TreeViewItem.IsExpanded = false;
selected.Parent.TreeViewItem.BringIntoView();
... 
```

声明：

```
<Window ...
        xmlns:tvi="clr-namespace:TreeViewItems"
        ...>
    ...
    <tvi:TreeViewWithItem x:Name="myTreeView">
        <HierarchicalDataTemplate DataType = "{x:Type src:MyItem}"
                                  ItemsSource = "{Binding Children}">
            <TextBlock Text="{Binding Path=Name}"/>
        </HierarchicalDataTemplate>
    </tvi:TreeViewWithItem>
    ...
</Window> 
```

```
class MyItem : IHasTreeViewItem
{
    public string Name { get; set; }
    public ObservableCollection<MyItem> Children { get; set; }
    public MyItem Parent;
    public TreeViewItem TreeViewItem { get; set; }
    ...
} 
```

**代码**

```
public class TreeViewWithItem : TreeView
{
    public TreeViewWithItem()
    {
        ItemContainerGenerator.StatusChanged += ItemContainerGenerator_StatusChanged;
    }

    private void ItemContainerGenerator_StatusChanged(object sender, EventArgs e)
    {
        var generator = sender as ItemContainerGenerator;
        if (generator.Status == GeneratorStatus.ContainersGenerated)
        {
            int i = 0;
            while (true)
            {
                var container = generator.ContainerFromIndex(i);
                if (container == null)
                    break;

                var tvi = container as TreeViewItem;
                if (tvi != null)
                    tvi.ItemContainerGenerator.StatusChanged += ItemContainerGenerator_StatusChanged;

                var item = generator.ItemFromContainer(container) as IHasTreeViewItem;
                if (item != null)
                    item.TreeViewItem = tvi;

                i++;
            }
        }
    }
}

interface IHasTreeViewItem
{
    TreeViewItem TreeViewItem { get; set; }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-02-07T05:04:01.247

尝试这样的事情：

```
 public bool UpdateSelectedTreeViewItem(PropertyNode dateItem, ItemsControl itemsControl)
    {
        if (itemsControl == null || itemsControl.Items == null || itemsControl.Items.Count == 0)
        {
            return false;
        }
        foreach (var item in itemsControl.Items.Cast<PropertyNode>())
        {
            var treeViewItem = itemsControl.ItemContainerGenerator.ContainerFromItem(item) as TreeViewItem;
            if (treeViewItem == null)
            {
                continue;
            }
            if (item == dateItem)
            {
                treeViewItem.IsSelected = true;
                return true;
            }
            if (treeViewItem.Items.Count > 0 && UpdateSelectedTreeViewItem(dateItem, treeViewItem))
            {
                return true;
            }
        }
        return false;
    } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-06-08T19:36:17.717

由于树视图项目控制器和树视图项目数据的分离，单个“ItemContainerGenerator.ContainerFromItem”或“ItemContainerGenerator.ItemContainerGenerator”调用无法找到与树视图对象关联的TreeViewItem。有必要创建一个递归函数来使用“ItemContainerGenerator.ContainerFromItem”和“ItemContainerGenerator.ItemContainerGenerator”，在树视图中定位 TreeViewItem。示例递归函数可能如下所示：

```
private TreeViewItem GetTreeViewItemFromObject(ItemContainerGenerator container, object tvio)
{
    var item = container.ContainerFromItem(tvio) as TreeViewItem;
    if (item != null)
    {
        return item;
    }

    for (int i = 0; i < container.Items.Count; i++)
    {
        var subContainer = (TreeViewItem)container.ContainerFromIndex(i);
        if (subContainer != null)
        {
            item = GetTreeViewItemFromObject(subContainer.ItemContainerGenerator, tvio);
            if (item != null)
            {
                return item;
            }
        }
    }

    return null;
} 
```

由 var target = GetTreeViewItemFromObject(treeView.ItemContainerGenerator, item); 调用

递归函数仅在树视图的“ItemContainerGenerator.Status”为“ContainersGenerated”后才有效。因此，在初始化视图期间，“GetTreeViewItemFromObject”不起作用。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-01-11T19:46:07.273

我将 William 的递归搜索修改为更紧凑的版本：

```
public TreeViewItem GetTreeViewItemFromObject(ItemContainerGenerator container, object targetObject) {
    if (container.ContainerFromItem(targetObject) is TreeViewItem target) return target;
    for (int i = 0; i < container.Items.Count; i++)
        if ((container.ContainerFromIndex(i) as TreeViewItem)?.ItemContainerGenerator is ItemContainerGenerator childContainer)
            if (GetTreeViewItemFromObject(childContainer, targetObject) is TreeViewItem childTarget) return childTarget;
    return null;
} 
```

可以通过提供 TreeView 实例的 ItemContainerGenerator 和目标数据对象来调用它：

```
TreeViewItem tvi = GetTreeViewItemFromObject(treeView.ItemContainerGenerator, targetDataObject); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-09-22T02:47:08.580

您是否需要 TreeViewItem 因为您要修改正在显示的内容？如果是这种情况，我建议使用样式来更改项目的显示方式，而不是使用代码隐藏而不是直接修改 TreeViewItem。它应该希望更清洁。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-09-06T11:02:52.780

如果您必须在孩子的孩子中找到项目，您可能必须像这样使用递归

```
public bool Select(TreeViewItem item, object select) // recursive function to set item selection in treeview
{
    if (item == null)
        return false;
    TreeViewItem child = item.ItemContainerGenerator.ContainerFromItem(select) as TreeViewItem;
    if (child != null)
    {
        child.IsSelected = true;
        return true;
    }
    foreach (object c in item.Items)
    {
        bool result = Select(item.ItemContainerGenerator.ContainerFromItem(c) as TreeViewItem, select);
        if (result == true)
            return true;
    }
    return false;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-10-09T07:28:38.410

这是解决方案。rtvEsa 是树视图。HierarchicalDataTemplate 是树视图模板标签使当前项目真正的消费。这不是选定项，它是树控件中使用 HierarchicalDataTemplate 的当前项。

Items.CurrentItem 是内部树集合的一部分。您无法获得许多不同的数据。例如 Items.ParenItem 也是。

```
 <HierarchicalDataTemplate ItemsSource="{Binding ChildItems}">

  <TextBox Tag="{Binding ElementName=rtvEsa, Path=Items.CurrentItem }" /> 
```

# hibernate - 在 Grails 中使用 GORM 时的并发性

> ID：616949
> 
> 赞同：2
> 
> 时间：2009-03-05T22:27:56.637
> 
> 标签：hibernate, grails, concurrency, transactions, grails-orm

假设我有一个计数器函数，它使用原始 SQL 更新计数器：

```
 public void updateCounter() {
   executeSql("UPDATE counter SET count_value = count_value + 1 WHERE id = 1;");
 } 
```

数据库将确保按预期处理对计数器的两个并发调用 - 所有调用都会以一个增量更新计数器，并且不会丢失任何更新。

我不想通过发出原始 SQL 命令来执行此操作，而是使用 GORM。天真的方法是这样的：

```
 public void updateCounter() {
   Counter c = Counter.get(1)
   c.countValue += 1
   c.save()
 } 
```

在这种情况下，我假设如果两个线程同时调用 updateCounter() 方法，更新可能会丢失。处理此并发问题的正确“Grails/GORM 方式”是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-06T15:09:49.893

您可以使用“悲观”或“乐观”锁定策略，Hibernate 和 GORM 都支持这两种策略。默认的 GORM 策略是“乐观的”（它利用默认创建的持久域实体的版本列/属性）。它可以这样使用：

```
...
try {
 Counter c = Counter.get(1)
 c.countValue += 1
 c.save(flush:true)
}
catch(org.springframework.dao.OptimisticLockingFailureException e) {
// deal with concurrent modification here
}
... 
```

如果您更喜欢“悲观”锁定策略（这将阻止所有其他并发读取，顺便说一句），您可以使用显式“锁定”GORM 元方法来执行此操作，如下所示：

```
...
Counter c = Counter.lock(1) //lock the entire row for update
c.countValue += 1
c.save(flush:true) //GORM will autorelease the lock once the TX is committed
... 
```

希望这可以帮助。

# c++ - Copy-on-write with shared_ptr when multithreading

> ID：616951
> 
> 赞同：3
> 
> 时间：2009-03-05T22:28:37.117
> 
> 标签：c++, multithreading, boost, c++11

In the absence of multithreading, the implementation of copy-on-write for `shared_ptr` (either from boost or tr1) using `unique()` is straightforward. Which changes need to be made when multithreading? The reference count is atomic so I assume I can create, copy-construct, read and destroy instances of `shared_ptr` without further concerns. How about updating them, in general, and particularly when implementing copy-on-write? Are locks needed? Or use `boost::atomic_store` (why is it not documented)? Or wait for a fully atomic version of `shared_ptr` (not an option)?

Edit:
sfossen, thank you for your helpful reply.
So I conclude that if I change a pointed-to object only after detaching it via COW, so that only the current thread owns it, no locking is needed and the COW implementation looks just like the single-threaded one when using shared_ptr with atomic ref-counts.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T23:20:40.690

使用 COW，您只需在复制可能正在更改的对象时进行锁定。

因此，如果对象的 COW 是在线程之前设置且永不更改的对象，则不需要锁定。

但是，如果您正在制作副本的副本，那么您至少需要在初始写入期间锁定，或者确保副本具有所有更改，然后才能再次复制。

如果您不能完全保证这些，请使用锁定或原子更新。

## 如果要锁定：

现在在后备箱中似乎确实有一个原子版本。

如果您无法更新 boost，您可以暂时导入所需的函数，或者将其包装在像读/写锁这样的锁中。

来自 shared_ptr.hpp

```
template<class T> shared_ptr<T> atomic_exchange( shared_ptr<T> * p, shared_ptr<T> r )
{
    boost::detail::spinlock & sp = boost::detail::spinlock_pool<2>::spinlock_for( p );

    sp.lock();
    p->swap( r );
    sp.unlock();

    return r; // return std::move( r )
} 
```

关于[RWLocks的文章](http://www.paulbridger.com/read_write_lock/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T14:18:10.517

在没有某种形式的同步的情况下复制 shared_ptr 是不安全的，除非它由执行复制的线程拥有。线程安全保证仅适用于由线程拥有的 shared_ptr，其中 shared_ptr 的内部引用计数可能由其他线程拥有的 shared_ptr 共享。

你想要的行为是我会调用原子线程安全的，它当前在 shared_ptr 中不存在，甚至在 C++0x 之后也可能不会。名称 shared_ptr 在这里可能有点令人困惑，因为您无法在没有同步的情况下在线程之间真正共享 shared_ptr。

# c# - Fluent nHibernate Configuration

> ID：616956
> 
> 赞同：3
> 
> 时间：2009-03-05T22:30:07.550
> 
> 标签：c#, nhibernate, fluent-nhibernate

I am trying to configure fluent nHibernate and have this code

```
Assembly mappingAssembly = Assembly.ReflectionOnlyLoadFrom("LibrarySample.Model.dll");
sessionFactory = Fluently.Configure()
  .Database(MsSqlConfiguration.MsSql2005
     .ConnectionString(c => c
        .FromAppSetting("ConnectionString"))
     .ShowSql())
   .Mappings(m => m
     .FluentMappings.AddFromAssembly(mappingAssembly))
   .BuildSessionFactory(); 
```

When I run I get this message though "FluentNHibernate.Cfg.FluentConfigurationException: An invalid or incomplete configuration was used while creating a SessionFactory".

If I use this code it works, but I don't want to reference the Model assembly directly from the Core assembly that has the nHibernate session manager.

```
sessionFactory = Fluently.Configure()
  .Database(MsSqlConfiguration.MsSql2005
     .ConnectionString(c => c
        .FromAppSetting("ConnectionString"))
     .ShowSql())
   .Mappings(m => m
     .FluentMappings.AddFromAssemblyOf<LibrarySample.Model.Book>())
   .BuildSessionFactory(); 
```

Can someone help?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-05T22:47:16.153

I worked it out. One of the properties in the Entity class was not marked as virtual.

# java - Swing中的虚拟列表框

> ID：616958
> 
> 赞同：1
> 
> 时间：2009-03-05T22:30:25.960
> 
> 标签：java, swing, list, virtual

我试图弄清楚如何在 Swing 中创建一个虚拟列表框（或树或大纲）——这将是列表框可以在数据库的大型结果集中显示“视图”而无需获取整个结果集的地方内容; 它只需要提醒我项目 N1 - N2 将需要很快显示，所以我可以获取它们，并询问项目 N 的内容。

我知道如何在 Win32 ( [ListView + LVS_OWNERDATA](http://msdn.microsoft.com/en-us/library/bb774735(VS.85).aspx) ) 和 XUL ( [custom treeview](https://developer.mozilla.org/en/XUL_Tutorial/Tree_View_Details) ) 中做到这一点，并且我找到了[SWT](http://www.java2s.com/Tutorial/Java/0280__SWT/Createatablewith1000000itemslazy.htm)的东西，但不是 Swing。

有什么建议么？

* * *

更新：啊哈，我不明白在搜索引擎中寻找什么，并且教程似乎没有将其称为“虚拟列表框”或使用这个想法。我找到了一个[很好的教程](http://www.java2s.com/Tutorial/Java/0240__Swing/extendsAbstractListModel.htm)，我可以从它开始，其中一个[Sun 教程](https://docs.oracle.com/javase/tutorial/uiswing/components/list.html)似乎也不错。

这是我的示例程序，它按我期望的方式工作......*除了*列表框似乎查询我的 AbstractListModel 的**所有**行，而不仅仅是可见的行。对于一百万行的虚拟表，这是不切实际的。我怎样才能解决这个问题？（编辑：似乎 setPrototypeCellValue 解决了这个问题。但我不明白为什么......）

```
package com.example.test;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import javax.swing.AbstractListModel;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JSpinner;
import javax.swing.SpinnerModel;
import javax.swing.SpinnerNumberModel;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;

// based on:
// http://www.java2s.com/Tutorial/Java/0240__Swing/extendsAbstractListModel.htm
// http://www.java2s.com/Tutorial/Java/0240__Swing/SpinnerNumberModel.htm
// http://java.sun.com/j2se/1.4.2/docs/api/javax/swing/SpinnerNumberModel.html
// http://www.java2s.com/Tutorial/Java/0240__Swing/ListeningforJSpinnerEventswithaChangeListener.htm

public class HanoiMoves extends JFrame {
    public static void main(String[] args) {
        HanoiMoves hm = new HanoiMoves();
    }

    static final int initialLevel = 6;
    final private JList list1 = new JList();
    final private HanoiData hdata = new HanoiData(initialLevel);

    public HanoiMoves() {
        this.setTitle("Solution to Towers of Hanoi");
        this.getContentPane().setLayout(new BorderLayout());
        this.setSize(new Dimension(400, 300));
        list1.setModel(hdata);

        SpinnerModel model1 = new SpinnerNumberModel(initialLevel,1,31,1);
        final JSpinner spinner1 = new JSpinner(model1);

        this.getContentPane().add(new JScrollPane(list1), BorderLayout.CENTER);
        JLabel label1 = new JLabel("Number of disks:");
        JPanel panel1 = new JPanel(new BorderLayout());
        panel1.add(label1, BorderLayout.WEST);
        panel1.add(spinner1, BorderLayout.CENTER);
        this.getContentPane().add(panel1, BorderLayout.SOUTH);      

        ChangeListener listener = new ChangeListener() {
            public void stateChanged(ChangeEvent e) {
                Integer newLevel = (Integer)spinner1.getValue();
                hdata.setLevel(newLevel);
            }
        };

        spinner1.addChangeListener(listener);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setVisible(true);
    }
}

class HanoiData extends AbstractListModel {
    public HanoiData(int level) { this.level = level; }

    private int level;
    public int getLevel() { return level; }
    public void setLevel(int level) {
        int oldSize = getSize();
        this.level = level;
        int newSize = getSize();

        if (newSize > oldSize)
            fireIntervalAdded(this, oldSize+1, newSize);
        else if (newSize < oldSize)
            fireIntervalRemoved(this, newSize+1, oldSize);
    }   

    public int getSize() { return (1 << level); }

    // the ruler function (http://mathworld.wolfram.com/RulerFunction.html)
    // = position of rightmost 1
    // see bit-twiddling hacks page:
    // http://www-graphics.stanford.edu/~seander/bithacks.html#ZerosOnRightMultLookup
    public int rulerFunction(int i)
    {
        long r1 = (i & (-i)) & 0xffffffff;
        r1 *= 0x077CB531;
        return MultiplyDeBruijnBitPosition[(int)((r1 >> 27) & 0x1f)];       
    }
    final private static int[] MultiplyDeBruijnBitPosition = 
    {
        0, 1, 28, 2, 29, 14, 24, 3, 30, 22, 20, 15, 25, 17, 4, 8, 
        31, 27, 13, 23, 21, 19, 16, 7, 26, 12, 18, 6, 11, 5, 10, 9
    };  

    public Object getElementAt(int index) {
        int move = index+1;
        if (move >= getSize())
            return "Done!";

        int disk = rulerFunction(move)+1;
        int x = move >> (disk-1); // guaranteed to be an odd #
        x = (x - 1) / 2;
        int K = 1 << (disk&1); // alternate directions for even/odd # disks
        x = x * K;
        int post_before = (x % 3) + 1;
        int post_after  = ((x+K) % 3) + 1;
        return String.format("%d. move disk %d from post %d to post %d", 
                move, disk, post_before, post_after);
    }
} 
```

* * *

更新：

根据 jfpoilpret 的建议，我在`getElementData()`函数中放置了一个断点。

```
if ((index & 0x3ff) == 0)
{
  System.out.println("getElementAt("+index+")");
} 
```

我查看了相关线程的堆栈跟踪。它并没有那么有用（在下面发布）。然而，从其他一些调整来看，罪魁祸首似乎是 fireIntervalAdded()/fireIntervalRemoved() 和 getSize() 结果的变化。fireIntervalxxxx 似乎提示 Swing 检查 getSize() 函数，如果大小发生变化，它会立即重新获取所有行内容（或至少将请求放入事件队列中）。

**一定**有办法告诉它不要那样做！！！！但我不知道是什么。

```
com.example.test.HanoiMoves at localhost:3333   
    Thread [main] (Suspended (breakpoint at line 137 in HanoiData)) 
        HanoiData.getElementAt(int) line: 137   
        BasicListUI.updateLayoutState() line: not available 
        BasicListUI.maybeUpdateLayoutState() line: not available    
        BasicListUI.getPreferredSize(JComponent) line: not available    
        JList(JComponent).getPreferredSize() line: not available    
        ScrollPaneLayout$UIResource(ScrollPaneLayout).layoutContainer(Container) line: not available    
        JScrollPane(Container).layout() line: not available 
        JScrollPane(Container).doLayout() line: not available   
        JScrollPane(Container).validateTree() line: not available   
        JPanel(Container).validateTree() line: not available    
        JLayeredPane(Container).validateTree() line: not available  
        JRootPane(Container).validateTree() line: not available 
        HanoiMoves(Container).validateTree() line: not available    
        HanoiMoves(Container).validate() line: not available    
        HanoiMoves(Window).show() line: not available   
        HanoiMoves(Component).show(boolean) line: not available 
        HanoiMoves(Component).setVisible(boolean) line: not available   
        HanoiMoves(Window).setVisible(boolean) line: not available  
        HanoiMoves.<init>() line: 69    
        HanoiMoves.main(String[]) line: 37  
    Thread [AWT-Shutdown] (Running) 
    Daemon Thread [AWT-Windows] (Running)   
    Thread [AWT-EventQueue-0] (Running) 
```

* * *

更新：我尝试使用[Advanced JList Programming 文章](http://java.sun.com/products/jfc/tsc/tech%5Ftopics/jlist%5F1/jlist.html)中的一些 FastRenderer.java 代码并修复了它。但事实证明它根本不是渲染器！一行代码解决了我的问题，我不明白为什么：

```
list1.setPrototypeCellValue(list1.getModel().getElementAt(0)); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-06T10:16:11.270

问题是即使使用智能预取，您也不能保证在需要时预取所有可见行。

我将绘制一个我曾经在项目中使用过的解决方案，并且效果非常好。

我的解决方案是让 ListModel 返回一个用于告诉用户该项目正在加载的缺失行的存根。`ListCellRenderer`（您可以使用专门呈现存根的自定义来增强视觉体验）。此外，使入`ListModel`队请求获取丢失的行。将`ListModel`不得不产生一个线程来读取队列并获取丢失的行。获取一行后，调用`fireContentsChanges`获取的行。您还可以在列表模型中使用 Executor：

```
private Map<Integer,Object> cache = new HashMap<Integer,Object>();
private Executor executor = new ThreadPoolExecutor(...);
...
public Object getElementAt(final int index) {
  if(cache.containsKey(index)) return cache.get(index);
  executor.execute(new Runnable() {
        Object row = fetchRowByIndex(index);
        cache.put(index, row);
        fireContentsChanged(this, index, index);
  }
} 
```

您可以通过以下方式改进此草图解决方案：

*   不仅获取请求的项目，还获取“周围”的一些项目。用户可能会上下滚动。
*   如果列表非常大，请`ListModel`忘记那些远离最后获取的行。
*   使用 LRU 缓存
*   如果需要，可以预取后台线程中的所有项目。
*   使 ListModel 成为 ListModel 急切实现的装饰器（这就是我所做的）
*   如果您有多个同时可见的列表的“大”ListModel，请使用中央请求队列来获取丢失的项目。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T22:38:52.163

看看[jgoodies 绑定](https://binding.dev.java.net/)。我不确定他们会做你想做的事（我没有使用过它们......我只是知道这个项目）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-06T00:28:24.803

扩展[AbstractListModel](http://java.sun.com/j2se/1.4.2/docs/api/javax/swing/AbstractListModel.html)，您可以将其传递给 JList 构造函数。

在您的实现中，使您的列表大小尽可能大（使用从 getSize 返回的值）。如果列表中该项目的数据不可用，则返回一个空行（通过 getElementAt）。当数据可用时，为更新的行调用[fireContentsChanged](http://java.sun.com/j2se/1.4.2/docs/api/javax/swing/AbstractListModel.html#fireContentsChanged(java.lang.Object,%20int,%20int))。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-09T10:52:32.623

我怀疑访问整个模型的原因可能与列表大小计算有关。

您可以尝试在模型 getElementAt() 方法中添加一些断点。我建议你这样做：

```
if (index == 100)
{
    System.out.println("Something");//Put the breakpoint on this line
} 
```

100 常量是一个值 < getSize() 但大于初始可见行数（这样您就不会对所有可见行都有中断）。当你进入这个断点时，看看你的模型是从哪里调用的，这可能会给你一些提示。您可以在此处发布堆栈跟踪，以便我们尝试进一步帮助您。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T14:38:27.447

Aha: the rendering is the problem, but I don't really understand why.

I used the TextCellRenderer mentioned in the FastRenderer.java program from the article [Advanced JList Programming](http://java.sun.com/products/jfc/tsc/tech_topics/jlist_1/jlist.html). But I don't really understand why that works and what the caveats are about doing this.... :/

# visual-studio-2005 - Why can I not see the VS 2005 dataset visualizer anymore?

> ID：616970
> 
> 赞同：0
> 
> 时间：2009-03-05T22:33:31.693
> 
> 标签：visual-studio-2005, dataset, visualizer

I cannot see the magnifying glass next to my `Dataset` anymore. Is there a way to re-enable it?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-12-30T07:09:05.280

我有一个类似的问题，并找到了一个解决方案：[解决方案消失数据集可视化器](https://stackoverflow.com/questions/239206/datatable-visualizer-disappeared-from-my-visual-studio/1978806#1978806)

# syntax - 这两个 F# 序列有什么区别？

> ID：616973
> 
> 赞同：3
> 
> 时间：2009-03-05T22:34:03.547
> 
> 标签：syntax, f#

```
> seq { for i in 0..3 do yield float i };;
val it : seq<float> = seq [0.0; 1.0; 2.0; 3.0]
> seq [ for i in 0..3 do yield float i ];;
val it : seq<float> = [0.0; 1.0; 2.0; 3.0] 
```

PS 为什么 F# 最初期望没有“seq”前缀的序列，但现在他们想要前缀？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-06T16:48:44.383

关于您发布的两种表格的更多说明：

第一个使用直接序列理解，“seq { ... }”。“seq”部分以前是可选的，但将来不会支持。我想这会使诸如“async { ... }”之类的事情和工作流语法变得更加困难或其他什么。

现在，第二个是一个纯粹的列表：

```
> let x = [ for i in 0..3 do yield float i ];;

val x : float list 
```

“seq”也是一个函数：

```
> seq;;
val it : (seq<'a> -> seq<'a>) = <fun:clo@0_1> 
```

由于任何列表也是一个序列，因此执行“seq [1;2;3;]”只是将 seq 函数应用于列表。这有点像将它从列表类型转换为 seq 。

```
> x;;
val it : float list = [0.0; 1.0; 2.0; 3.0]

> seq x;;
val it : seq<float> = [0.0; 1.0; 2.0; 3.0] 
```

编辑： seq 函数的来源是：

```
let seq (x : seq<_>) = (x :> seq<_>) 
```

因此，“有点像投射它”应该读作“通过辅助函数投射它”。至于括号内序列的打印，我认为这只是一个漂亮的打印神器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-05T22:41:45.683

第一个是 seq (IEnumerable)。

第二个很奇怪；摆脱'seq'，它是一个列表理解（列表）。没有理由按原样编写它。使用 seq{ } 或 [ ] 或 [| |] 创建一个序列或一个列表或一个数组。

curlies-not-prefixed-by-seq 是一种将被弃用的形式，因为它使语言的其他部分可能不明确。

# .net - 处理用户定义的数据结构

> ID：616979
> 
> 赞同：2
> 
> 时间：2009-03-05T22:35:38.427
> 
> 标签：.net, database-design, orm

有没有人对处理用户定义的数据结构有任何建议？即您的用户必须能够定义额外的字段，有时是表格，才能与系统中的“固定”实体相关联。我似乎总是很不幸地最终从事以这是主要组成部分的项目。通常，解决方案最终是动态生成的 SQL 表，在 ORM 的边缘添加了一些可怕的 SQL 生成来加载和保存动态数据。

必须有更好的方法来处理这个问题，如果你以前处理过这类事情，你是如何设法让模型的动态部分与 ORM 很好地配合使用的？动态生成表来存储数据是相当标准的，还是最好使用大名称/值表之类的东西？

从性能的角度来看，我所考虑的项目类型在插入/更新速度方面的要求并不高，但在查询和报告大量数据时需要做出响应（尤其是针对动态字段进行过滤和聚合） .

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T23:27:47.350

不知道 ORM 是什么，但我想我明白你的要求。

对于像这个应用程序这样的系统中的客户扩展数据，我已将数据存储在数据库的 Xml 字段中，并将客户端对象存储为 XmlDocuments。SQL Server 中的 Xml 字段很容易查询，我的对象类包装了自定义 Xml 数据。

# http-referer - 你如何欺骗 HTTP_REFERER？

> ID：616980
> 
> 赞同：4
> 
> 时间：2009-03-05T22:36:12.577
> 
> 标签：http-referer, spoofing

我需要尝试欺骗 HTTP_REFERER 传递我的另一个页面，以便在目标页面中，我可以确定请求来自“正确”页面并执行适当的逻辑。

1.  我如何在 JavaScript (AJAX) 中做到这一点？
2.  我可以在 ASP.Net 中做到这一点吗？

TIA 公羊

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-05T22:44:33.773

一般来说，您不能在没有漏洞利用、插件或其他扩展的情况下导致其他浏览器返回错误的 HTTP_REFERER。如果您想修改从 Web 浏览器发送的值并且您使用的是 FireFox，请查看[Modify Headers](http://modifyheaders.mozdev.org/)扩展。

在任何情况下，您都不应依赖 HTTP_REFERER 的准确性。无法保证您收到的 HTTP_REFERER 不是伪造的或根本没有发送。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T22:47:30.067

如果您想在目标页面测试请求是否来自“正确”页面，则无需欺骗引荐来源网址。您需要做的就是从不同的页面发出请求。在与您认为“正确”的 URL 不同的 URL 上设置一个页面，并从那里发出请求，方法是单击目标页面的链接或放置来自目标的图像。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-12-13T16:39:04.263

已经提到你不能真正欺骗事物。但需要澄清的是， HTTP_REFERER 标头是*由浏览器生成的*，因此在服务器端您无法控制它（包括传递 javascript 的东西，可能会或可能不会启用）。

如果您只想测试页面对某些标题的响应（例如“Referer:”），您可以使用大多数 BSD 和 Linux 变体（包括 OS/X）中可用的[curl](http://curl.haxx.se/)或[wget等命令行工具。](http://www.gnu.org/s/wget/)如果您使用的是 MS Windows，则可以使用[Cygwin](http://www.cygwin.com/)获取 curl 或 wget 。

```
 wget -O - --referer="http://example.com/some/path" http://example.com/ 
```

或者

```
 curl -e "http://example.com/some/path" http://example.com/ 
```

但我认为，您这样做的核心原因显然是为了“保护”一个页面。如果您真的想确保仅在首先访问其他页面（“A”）之后才访问页面（称为“B”），那么您需要在服务器端进行更复杂的逻辑。

If you're storing a session cookie, then you can embed some logic on page "A" that sets a boolean variable. Then add logic on page "B" that checks to make sure the variable has been set.

I'll leave it as an exercise for the reader to figure out how to do this in ASP.NET. (Because I'm a PHP programmer. ;-] )

# compact-framework - Cab 替换所有文件 vs 替换一个文件

> ID：616982
> 
> 赞同：1
> 
> 时间：2009-03-05T22:36:45.210
> 
> 标签：compact-framework, cab

当用户单击 cab 文件以更新应用程序时，我希望他们可以选择不每次都替换所有文件。即使出现的对话框中有 2 个选项，YES 和 YES TO ALL 将替换所有文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T13:00:20.300

内置的 wceload 没有这样做的规定。[您始终可以使用CAB 安装程序 SDK](http://www.opennetcf.com/Products/CABInstallerSDK/tabid/272/Default.aspx)之类的东西编写自己的 wceload 替代品，该替代品确实具有自定义 UI 。

# iphone - iPhone SDK - wifi list

> ID：616987
> 
> 赞同：0
> 
> 时间：2009-03-05T22:38:00.653
> 
> 标签：iphone

this may be a newbie question...but I am in the world of MAC/iPhone development, I'm looking if there is anyway of retrieving a list of Wifi networks in the area. For example, if the Wifi on the iPhone is on i want to get that list of Networks available. I've searched through the Apple documentation but I can't seem to filter out what I need.

Thanks.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T22:58:19.950

Yes, though only using undocumented API's.

The Stumbler source code is a good reference;

[http://code.google.com/p/iphone-wireless/](http://code.google.com/p/iphone-wireless/)

# c# - C#：如何制作监听/tcp 服务器？

> ID：616988
> 
> 赞同：0
> 
> 时间：2009-03-05T22:38:07.143
> 
> 标签：c#, visual-studio-2008

我如何制作一个 tcp（我听说它称为侦听器？）服务器（此时简单性是可选的），它可以从连接的客户端接收数据并将数据发送回该单个客户端（更多多个客户端）？

我做了几个教程，但我无法让其中任何一个工作，或者他们没有做我希望他们做的事情。无论如何，非常感谢任何帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-05T22:41:31.517

网上到处都是样品，他们对你没有做什么？

基本样本

[http://www.codeproject.com/KB/IP/socketsincsharp.aspx](http://www.codeproject.com/KB/IP/socketsincsharp.aspx)

正确的服务器示例

[http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx](http://www.codeproject.com/KB/IP/AsyncSocketServerandClien.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-05T22:40:18.337

您可以手动使用 a`Socket`或更高级别的视图，使用[`TcpListener`class](http://msdn.microsoft.com/en-us/library/system.net.sockets.tcplistener(VS.71).aspx)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T22:46:40.617

[试试这个样本](http://www.csharp-examples.net/socket-send-receive/)

当我需要学习如何编写监听器时，我使用了这个站点。它相当简单，但比那里的许多其他样本要复杂一些。在您尝试过的以前的教程中，究竟有什么不适合您？

# .net - .net：System.Design.NativeMethods 在哪里？

> ID：616995
> 
> 赞同：0
> 
> 时间：2009-03-05T22:40:16.530
> 
> 标签：.net

我正在查找对此命名空间的引用，但它实际上不在 System.Design 中。如果我添加 LOGFONT lf; 对于我的代码，编辑器下拉建议包括：

System.Design.NativeMethods.LOGFONT

你知道去哪里取吗？我很难追踪它。它是某种第 3 方附加组件吗？它不在添加引用对话框列表中。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-05T22:43:10.890

这正是您认为的位置。但正如[反射器](http://www.red-gate.com/products/reflector/)所示，它是内部的：

```
internal class NativeMethods 
```

您可以通过反射访问它（并添加对框架版本的依赖项，因为内部 API 无法保证）或编写自己的方法。

对于 pinvoke，最简单的方法是[Pinvoke.net](http://www.pinvoke.net)，您可以在其中找到[LOGFONT](http://www.pinvoke.net/default.aspx/Structures/LOGFONT.html)结构。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T22:43:11.887

这是一个`internal`类。这意味着，它只能被该程序集中定义的类访问。******